var er=Object.defineProperty;var tr=(l,e,t)=>e in l?er(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var Ct=(l,e,t)=>(tr(l,typeof e!="symbol"?e+"":e,t),t);import{aa as It,S as mt,i as _t,s as dt,q as f,Y as P,b as R,y as s,Z as ve,I as Ce,j as T,ak as je,F as ut,m as tl,a as g,v as c,l as se,E as lt,au as Ft,r as me,z as _e,t as M,d as B,B as he,av as lr,aw as Vt,H as et,U as st,V as rt,ax as Kt,ay as nr,g as Ue,e as ze,O as tt,af as Rt,o as Wl,W as we,az as kl,aA as St,aB as Bl,aC as or,a1 as De,C as pt,aD as Je,aE as Jl,D as pl,G as ml,aF as Gt,w as Pt,x as ht,A as Vl,a2 as sr,aG as Ht,ac as rr,a5 as ir,a7 as ar,a9 as cr,n as ur,k as Ql,aH as fr,aI as Qt,_ as Hl}from"./vendor-ui-23b77d6f.js";import{R as Nt,S as Ul,f as dr,Y as Fl}from"./vendor-utils-100b0668.js";import{J as zs,_ as pr,d as Hs,P as mr,k as _r,D as hr,l as gr,E as vr,o as yn}from"./vendor-editor-2c949df9.js";import{P as Fs,T as jl,u as Ks,y as br,A as kr,S as wr,q as yr}from"./vendor-atomic-607c53bf.js";import{t as $r,E as Cr}from"./novel-editor-9dab4c70.js";import{s as Kl,z as Tr,a as Sr,l as Rr,m as Ar,c as Er,b as Lr,B as Ir,d as Dr}from"./vendor-charts-e6a4a6c9.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function t(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=t(o);fetch(o.href,a)}})();const Ye={ServerURL:location.protocol+"//"+window.location.host||"/"},vl=It([]),Nr={id:"Desktop",global_shortcut:"",roles:{},default_role:{original:"",lowercase:""},selected_role:{original:"",lowercase:""}},bl=It("spacelab"),At=It("selected"),ct=It(!1),Or=It(`${Ye.ServerURL}/documents/search`),Lt=It(Nr),$n=It([]);let Bt=It("");const Tt=It(!1);let el=null;function Pr(l){if(typeof document>"u")return;const e=`/assets/bulmaswatch/${l}/bulmaswatch.min.css`;if(el!=null&&el.href.endsWith(e))return;const t=document.createElement("link");t.rel="stylesheet",t.href=e,t.id="bulma-theme",t.onload=()=>{el&&el!==t&&el.remove(),el=t},document.head.appendChild(t);const n=document.head.querySelector('meta[name="color-scheme"]');n&&n.setAttribute("content",l)}bl.subscribe(Pr);function Mr(l){let e,t;return{c(){e=f("option"),t=P(l[1]),e.__value=l[0],e.value=e.__value},m(n,o){R(n,e,o),s(e,t)},p(n,[o]){o&2&&ve(t,n[1]),o&1&&(e.__value=n[0],e.value=e.__value)},i:Ce,o:Ce,d(n){n&&T(e)}}}function jr(l,e,t){let n,{subject:o}=e;const a=Fs(o),r=jl(a,Ks.properties.name);return je(l,r,u=>t(1,n=u)),jl(a,"http://localhost:9883/property/theme"),l.$$set=u=>{"subject"in u&&t(0,o=u.subject)},[o,n,r]}class Ur extends mt{constructor(e){super(),_t(this,e,jr,Mr,dt,{subject:0})}}function Cn(l){let e,t,n,o,a,r,u=l[0]&&Tn();return{c(){e=f("button"),t=f("span"),t.innerHTML='<i class="fas fa-arrow-left"></i>',n=g(),u&&u.c(),c(t,"class","icon svelte-rnsqpo"),c(e,"class",o="button is-light back-button "+l[1]+" svelte-rnsqpo"),c(e,"title","Go back"),c(e,"aria-label","Go back")},m(i,d){R(i,e,d),s(e,t),s(e,n),u&&u.m(e,null),a||(r=[se(e,"click",l[3]),se(e,"keydown",l[6])],a=!0)},p(i,d){i[0]?u||(u=Tn(),u.c(),u.m(e,null)):u&&(u.d(1),u=null),d&2&&o!==(o="button is-light back-button "+i[1]+" svelte-rnsqpo")&&c(e,"class",o)},d(i){i&&T(e),u&&u.d(),a=!1,lt(r)}}}function Tn(l){let e;return{c(){e=f("span"),e.textContent="Back",c(e,"class","back-text svelte-rnsqpo")},m(t,n){R(t,e,n)},d(t){t&&T(e)}}}function zr(l){let e,t=l[2]&&Cn(l);return{c(){t&&t.c(),e=ut()},m(n,o){t&&t.m(n,o),R(n,e,o)},p(n,[o]){n[2]?t?t.p(n,o):(t=Cn(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Ce,o:Ce,d(n){t&&t.d(n),n&&T(e)}}}function Hr(l,e,t){let{fallbackPath:n="/"}=e,{showText:o=!0}=e,{customClass:a=""}=e,{hideOnPaths:r=["/"]}=e,u=!0;function i(){var m;try{const _=((m=window.location)==null?void 0:m.pathname)||"/";t(2,u=!r.includes(_))}catch{t(2,u=!0)}}function d(){window.history.length>1?window.history.back():window.location.href=n}tl(()=>(i(),window.addEventListener("popstate",i),window.addEventListener("hashchange",i),()=>{window.removeEventListener("popstate",i),window.removeEventListener("hashchange",i)}));const p=m=>{(m.key==="Enter"||m.key===" ")&&(m.preventDefault(),d())};return l.$$set=m=>{"fallbackPath"in m&&t(4,n=m.fallbackPath),"showText"in m&&t(0,o=m.showText),"customClass"in m&&t(1,a=m.customClass),"hideOnPaths"in m&&t(5,r=m.hideOnPaths)},[o,a,u,d,n,r,p]}class _l extends mt{constructor(e){super(),_t(this,e,Hr,zr,dt,{fallbackPath:4,showText:0,customClass:1,hideOnPaths:5})}}function Fr(){return window.crypto.getRandomValues(new Uint32Array(1))[0]}function Gl(l,e=!1){const t=Fr(),n=`_${t}`;return Object.defineProperty(window,n,{value:o=>(e&&Reflect.deleteProperty(window,n),l==null?void 0:l(o)),writable:!1,configurable:!0}),t}async function Ge(l,e={}){return new Promise((t,n)=>{const o=Gl(r=>{t(r),Reflect.deleteProperty(window,`_${a}`)},!0),a=Gl(r=>{n(r),Reflect.deleteProperty(window,`_${o}`)},!0);window.__TAURI_IPC__({cmd:l,callback:o,error:a,...e})})}function Sn(l,e,t){const n=l.slice();return n[25]=e[t],n}function Kr(l){let e,t,n;function o(r){l[13](r)}let a={};return l[5]!==void 0&&(a.value=l[5]),e=new Vt({props:a}),et.push(()=>st(e,"value",o)),{c(){me(e.$$.fragment)},m(r,u){_e(e,r,u),n=!0},p(r,u){const i={};!t&&u&32&&(t=!0,i.value=r[5],rt(()=>t=!1)),e.$set(i)},i(r){n||(M(e.$$.fragment,r),n=!0)},o(r){B(e.$$.fragment,r),n=!1},d(r){he(e,r)}}}function Gr(l){let e,t,n;function o(r){l[14](r)}let a={type:"password",placeholder:"secret",icon:"fas fa-lock",expanded:!0};return l[6]!==void 0&&(a.value=l[6]),e=new Vt({props:a}),et.push(()=>st(e,"value",o)),{c(){me(e.$$.fragment)},m(r,u){_e(e,r,u),n=!0},p(r,u){const i={};!t&&u&64&&(t=!0,i.value=r[6],rt(()=>t=!1)),e.$set(i)},i(r){n||(M(e.$$.fragment,r),n=!0)},o(r){B(e.$$.fragment,r),n=!1},d(r){he(e,r)}}}function qr(l){let e;return{c(){e=P("Save")},m(t,n){R(t,e,n)},d(t){t&&T(e)}}}function Wr(l){let e,t;return e=new Kt({props:{type:"is-success",class:"is-right",iconPack:"fa",iconLeft:"check",$$slots:{default:[qr]},$$scope:{ctx:l}}}),e.$on("click",l[8]),e.$on("submit",l[8]),{c(){me(e.$$.fragment)},m(n,o){_e(e,n,o),t=!0},p(n,o){const a={};o&268435456&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function Br(l){let e,t,n,o,a,r;return e=new Ft({props:{$$slots:{default:[Kr]},$$scope:{ctx:l}}}),n=new Ft({props:{grouped:!0,$$slots:{default:[Gr]},$$scope:{ctx:l}}}),a=new Ft({props:{grouped:!0,$$slots:{default:[Wr]},$$scope:{ctx:l}}}),{c(){me(e.$$.fragment),t=g(),me(n.$$.fragment),o=g(),me(a.$$.fragment)},m(u,i){_e(e,u,i),R(u,t,i),_e(n,u,i),R(u,o,i),_e(a,u,i),r=!0},p(u,i){const d={};i&268435488&&(d.$$scope={dirty:i,ctx:u}),e.$set(d);const p={};i&268435520&&(p.$$scope={dirty:i,ctx:u}),n.$set(p);const m={};i&268435456&&(m.$$scope={dirty:i,ctx:u}),a.$set(m)},i(u){r||(M(e.$$.fragment,u),M(n.$$.fragment,u),M(a.$$.fragment,u),r=!0)},o(u){B(e.$$.fragment,u),B(n.$$.fragment,u),B(a.$$.fragment,u),r=!1},d(u){he(e,u),u&&T(t),he(n,u),u&&T(o),he(a,u)}}}function Jr(l){let e,t,n;function o(r){l[15](r)}let a={type:"search",placeholder:"Fetch JSON",icon:"search"};return l[3]!==void 0&&(a.value=l[3]),e=new Vt({props:a}),et.push(()=>st(e,"value",o)),{c(){me(e.$$.fragment)},m(r,u){_e(e,r,u),n=!0},p(r,u){const i={};!t&&u&8&&(t=!0,i.value=r[3],rt(()=>t=!1)),e.$set(i)},i(r){n||(M(e.$$.fragment,r),n=!0)},o(r){B(e.$$.fragment,r),n=!1},d(r){he(e,r)}}}function Vr(l){let e;return{c(){e=P("WikiPage")},m(t,n){R(t,e,n)},d(t){t&&T(e)}}}function Qr(l){let e,t,n,o,a,r;function u(m){l[16](m)}let i={type:"search",placeholder:"Post JSON",icon:"search"};l[4]!==void 0&&(i.value=l[4]),e=new Vt({props:i}),et.push(()=>st(e,"value",u));function d(m){l[17](m)}let p={$$slots:{default:[Vr]},$$scope:{ctx:l}};return l[2]!==void 0&&(p.checked=l[2]),o=new nr({props:p}),et.push(()=>st(o,"checked",d)),{c(){me(e.$$.fragment),n=g(),me(o.$$.fragment)},m(m,_){_e(e,m,_),R(m,n,_),_e(o,m,_),r=!0},p(m,_){const h={};!t&&_&16&&(t=!0,h.value=m[4],rt(()=>t=!1)),e.$set(h);const b={};_&268435456&&(b.$$scope={dirty:_,ctx:m}),!a&&_&4&&(a=!0,b.checked=m[2],rt(()=>a=!1)),o.$set(b)},i(m){r||(M(e.$$.fragment,m),M(o.$$.fragment,m),r=!0)},o(m){B(e.$$.fragment,m),B(o.$$.fragment,m),r=!1},d(m){he(e,m),m&&T(n),he(o,m)}}}function Yr(l){let e;return{c(){e=P("Fetch")},m(t,n){R(t,e,n)},d(t){t&&T(e)}}}function Zr(l){let e,t;return e=new Kt({props:{type:"is-primary",$$slots:{default:[Yr]},$$scope:{ctx:l}}}),e.$on("click",l[9]),e.$on("submit",l[9]),{c(){me(e.$$.fragment)},m(n,o){_e(e,n,o),t=!0},p(n,o){const a={};o&268435456&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function Xr(l){let e,t,n,o,a,r;return e=new Ft({props:{grouped:!0,$$slots:{default:[Jr]},$$scope:{ctx:l}}}),n=new Ft({props:{grouped:!0,$$slots:{default:[Qr]},$$scope:{ctx:l}}}),a=new Ft({props:{grouped:!0,$$slots:{default:[Zr]},$$scope:{ctx:l}}}),{c(){me(e.$$.fragment),t=g(),me(n.$$.fragment),o=g(),me(a.$$.fragment)},m(u,i){_e(e,u,i),R(u,t,i),_e(n,u,i),R(u,o,i),_e(a,u,i),r=!0},p(u,i){const d={};i&268435464&&(d.$$scope={dirty:i,ctx:u}),e.$set(d);const p={};i&268435476&&(p.$$scope={dirty:i,ctx:u}),n.$set(p);const m={};i&268435456&&(m.$$scope={dirty:i,ctx:u}),a.$set(m)},i(u){r||(M(e.$$.fragment,u),M(n.$$.fragment,u),M(a.$$.fragment,u),r=!0)},o(u){B(e.$$.fragment,u),B(n.$$.fragment,u),B(a.$$.fragment,u),r=!1},d(u){he(e,u),u&&T(t),he(n,u),u&&T(o),he(a,u)}}}function xr(l){let e,t,n,o,a;return o=new zs({props:{content:l[1],onChange:l[7]}}),{c(){e=f("p"),e.innerHTML=`<i>The best editing experience is to configure Atomic Server, in the
        meantime use editor below. You will need to refresh page via Command R
        or Ctrl-R to see changes</i>`,t=g(),n=f("div"),me(o.$$.fragment),c(n,"class","editor")},m(r,u){R(r,e,u),R(r,t,u),R(r,n,u),_e(o,n,null),a=!0},p(r,u){const i={};u&2&&(i.content=r[1]),o.$set(i)},i(r){a||(M(o.$$.fragment,r),a=!0)},o(r){B(o.$$.fragment,r),a=!1},d(r){r&&T(e),r&&T(t),r&&T(n),he(o)}}}function Rn(l){let e,t;return e=new Ur({props:{subject:l[25]}}),{c(){me(e.$$.fragment)},m(n,o){_e(e,n,o),t=!0},p(n,o){const a={};o&1&&(a.subject=n[25]),e.$set(a)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function ei(l){let e,t,n=l[0]??[],o=[];for(let r=0;r<n.length;r+=1)o[r]=Rn(Sn(l,n,r));const a=r=>B(o[r],1,1,()=>{o[r]=null});return{c(){for(let r=0;r<o.length;r+=1)o[r].c();e=ut()},m(r,u){for(let i=0;i<o.length;i+=1)o[i]&&o[i].m(r,u);R(r,e,u),t=!0},p(r,u){if(u&1){n=r[0]??[];let i;for(i=0;i<n.length;i+=1){const d=Sn(r,n,i);o[i]?(o[i].p(d,u),M(o[i],1)):(o[i]=Rn(d),o[i].c(),M(o[i],1),o[i].m(e.parentNode,e))}for(Ue(),i=n.length;i<o.length;i+=1)a(i);ze()}},i(r){if(!t){for(let u=0;u<n.length;u+=1)M(o[u]);t=!0}},o(r){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)B(o[u]);t=!1},d(r){tt(o,r),r&&T(e)}}}function ti(l){let e,t;return e=new lr({props:{$$slots:{default:[ei]},$$scope:{ctx:l}}}),{c(){me(e.$$.fragment)},m(n,o){_e(e,n,o),t=!0},p(n,o){const a={};o&268435457&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function li(l){let e,t,n,o,a,r,u,i,d,p,m,_,h,b,v;return e=new _l({props:{fallbackPath:"/"}}),o=new Nt({props:{path:"/atomic",$$slots:{default:[Br]},$$scope:{ctx:l}}}),r=new Nt({props:{path:"/json",$$slots:{default:[Xr]},$$scope:{ctx:l}}}),i=new Nt({props:{path:"/editor",$$slots:{default:[xr]},$$scope:{ctx:l}}}),_=new Ft({props:{grouped:!0,position:"is-right",$$slots:{default:[ti]},$$scope:{ctx:l}}}),{c(){me(e.$$.fragment),t=g(),n=f("div"),me(o.$$.fragment),a=g(),me(r.$$.fragment),u=g(),me(i.$$.fragment),d=g(),p=f("hr"),m=g(),me(_.$$.fragment),h=g(),b=f("nav"),b.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
    <a class="navbar-item" href="/fetch/json">Fetch JSON Data</a> 
    <a class="navbar-item" href="/fetch/atomic">Set Atomic Server</a> 
    <a class="navbar-item" href="/fetch/editor">Edit JSON config</a></div>`,c(n,"class","box"),c(b,"class","navbar")},m(w,y){_e(e,w,y),R(w,t,y),R(w,n,y),_e(o,n,null),s(n,a),_e(r,n,null),s(n,u),_e(i,n,null),R(w,d,y),R(w,p,y),R(w,m,y),_e(_,w,y),R(w,h,y),R(w,b,y),v=!0},p(w,[y]){const $={};y&268435552&&($.$$scope={dirty:y,ctx:w}),o.$set($);const k={};y&268435484&&(k.$$scope={dirty:y,ctx:w}),r.$set(k);const S={};y&268435458&&(S.$$scope={dirty:y,ctx:w}),i.$set(S);const j={};y&268435457&&(j.$$scope={dirty:y,ctx:w}),_.$set(j)},i(w){v||(M(e.$$.fragment,w),M(o.$$.fragment,w),M(r.$$.fragment,w),M(i.$$.fragment,w),M(_.$$.fragment,w),v=!0)},o(w){B(e.$$.fragment,w),B(o.$$.fragment,w),B(r.$$.fragment,w),B(i.$$.fragment,w),B(_.$$.fragment,w),v=!1},d(w){he(e,w),w&&T(t),w&&T(n),he(o),he(r),he(i),w&&T(d),w&&T(p),w&&T(m),he(_,w),w&&T(h),w&&T(b)}}}function ni(l,e,t){let n,o,a,r,u;je(l,br,A=>t(19,a=A)),je(l,ct,A=>t(20,r=A)),je(l,Lt,A=>t(21,u=A));let i={json:u};function d(A){if(console.log("contents changed:",A),console.log("is tauri",r),Lt.update(C=>(C=A.json,C)),ct)console.log("Updating config on server"),Ge("update_config",{configNew:A.json}).then(C=>{console.log(`Message: ${C}`)}).catch(C=>console.error(C));else{let C=`${Ye.ServerURL}/config/`;fetch(C,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(A.json)})}t(1,i=A)}let p=!1,m="https://raw.githubusercontent.com/terraphim/terraphim-cloud-fastapi/main/data/ref_arch.json",_="http://localhost:8000/documents/",h="http://localhost:9883/",b;const v=async()=>{console.log("Updating atomic server configuration");const A=kr.fromSecret(b);a.setServerUrl(h),console.log("Server set.Setting agent"),a.setAgent(A)},w=async()=>{k()},y=({data:{msg:A,data:C}})=>{console.log(A,C)};let $;const k=async()=>{const A=await pr(()=>import("./fetcher.worker-7e58969a.js"),[]);$=new A.default,$.onmessage=y;const C={msg:"fetcher",data:{url:m,postUrl:_,isWiki:p}};$.postMessage(C)},S=Fs("http://localhost:9883/config/y3zx5wtm0bq"),j=jl(S,Ks.properties.name);je(l,j,A=>t(12,o=A));const D=jl(S,"http://localhost:9883/property/role");je(l,D,A=>t(0,n=A));function O(A){h=A,t(5,h)}function E(A){b=A,t(6,b)}function U(A){m=A,t(3,m)}function Z(A){_=A,t(4,_)}function V(A){p=A,t(2,p)}return l.$$.update=()=>{l.$$.dirty&4096&&console.log("Print name",o),l.$$.dirty&1&&console.log("Print roles",n)},[n,i,p,m,_,h,b,d,v,w,j,D,o,O,E,U,Z,V]}class oi extends mt{constructor(e){super(),_t(this,e,ni,li,dt,{})}}function Jt(){return Rt(ct)||typeof window<"u"&&window.__TAURI__!==void 0}class si{constructor(){Ct(this,"baseUrl");Ct(this,"autocompleteIndexBuilt",!1);Ct(this,"sessionId");Ct(this,"currentRole","Default");Ct(this,"connectionRetries",0);Ct(this,"maxRetries",3);Ct(this,"retryDelay",1e3);Ct(this,"isConnecting",!1);this.baseUrl=typeof window<"u"?(window.location.protocol==="https:"?"https://":"http://")+window.location.hostname+":8001":"http://localhost:8001",this.sessionId=`novel-${Date.now()}`,typeof window<"u"&&!Jt()&&this.shouldPerformHealthCheck()?this.detectServerPort():typeof window<"u"&&!Jt()&&console.log("NovelAutocompleteService: Skipping server detection - not needed for current page")}setRole(e){this.currentRole=e,this.autocompleteIndexBuilt=!1}async detectServerPort(){if(Jt())return;if(!this.shouldPerformHealthCheck()){console.log("NovelAutocompleteService: Skipping health check - service not needed");return}const t=[8001,3e3];for(const n of t)try{const o=typeof window<"u"?(window.location.protocol==="https:"?"https://":"http://")+window.location.hostname+":"+n:"http://localhost:"+n,a=await fetch(`${o}/message?sessionId=health-check`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:0,method:"ping",params:{}}),signal:AbortSignal.timeout(1e3)});if(a.ok||a.status===404){this.baseUrl=o,console.log(`NovelAutocompleteService: Detected server at ${o}`);return}}catch{continue}console.warn("NovelAutocompleteService: Could not detect running server, using default:",this.baseUrl)}shouldPerformHealthCheck(){return!(typeof window<"u"&&(!window.location.pathname.startsWith("/chat")||!(document.querySelector('[contenteditable="true"]')||document.querySelector("textarea")||document.querySelector('input[type="text"]'))))}async buildAutocompleteIndex(){if(this.isConnecting)return await new Promise(e=>setTimeout(e,1e3)),this.autocompleteIndexBuilt;this.isConnecting=!0;try{return Jt()?(console.log("Using Tauri backend - no index building required"),this.autocompleteIndexBuilt=!0,this.connectionRetries=0,console.log("Tauri autocomplete ready"),!0):await this.buildMCPIndex()}catch(e){return console.error("Error building Novel autocomplete index:",e),!1}finally{this.isConnecting=!1}}async buildMCPIndex(){for(let e=0;e<=this.maxRetries;e++)try{const t=await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:Date.now(),method:"tools/call",params:{name:"build_autocomplete_index",arguments:{}}}),signal:AbortSignal.timeout(1e4)});if(t.ok){const n=await t.json();if(console.log(`MCP build index response (attempt ${e+1}):`,n),n.result&&!n.result.is_error)return this.autocompleteIndexBuilt=!0,this.connectionRetries=0,console.log("MCP autocomplete index built successfully"),!0}else if(t.status>=500&&e<this.maxRetries){console.warn(`MCP server error ${t.status}, retrying in ${this.retryDelay}ms...`),await new Promise(n=>setTimeout(n,this.retryDelay*(e+1)));continue}console.warn(`MCP build index failed (attempt ${e+1}):`,t.status,t.statusText)}catch(t){t instanceof Error&&t.name==="AbortError"?console.warn(`MCP request timeout (attempt ${e+1})`):console.warn(`MCP connection error (attempt ${e+1}):`,t),e<this.maxRetries&&await new Promise(n=>setTimeout(n,this.retryDelay*(e+1)))}return console.error("Failed to build MCP autocomplete index after all retries"),!1}async getCompletion(e){if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return{text:""};try{const t=this.extractLastWord(e.prompt);if(!t||t.length<1)return{text:""};const n=await this.getSuggestionsWithSnippets(t,5);if(n.length===0)return{text:""};let a=n[0].text;a.toLowerCase().startsWith(t.toLowerCase())&&(a=a.substring(t.length));const r=e.prompt.length/4,u=a.length/4;return{text:a,usage:{promptTokens:Math.round(r),completionTokens:Math.round(u),totalTokens:Math.round(r+u)}}}catch(t){return console.error("Error getting Novel autocomplete completion:",t),{text:""}}}async getSuggestions(e,t=10){if(!e||e.trim().length===0)return[];if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return console.warn("Autocomplete index not built, returning empty suggestions"),[];try{return Jt()?await this.getTauriSuggestions(e,t):await this.getMCPSuggestions(e,t,"autocomplete_terms")}catch(n){return console.error("Error getting autocomplete suggestions:",n),[]}}async getTauriSuggestions(e,t){const n=await Ge("get_autocomplete_suggestions",{query:e.trim(),role_name:this.currentRole,limit:t});return console.log("Tauri autocomplete response:",n),n&&n.status==="success"&&n.suggestions?n.suggestions.map(o=>({text:o.term||o.text||"",snippet:o.url||o.snippet||"",score:o.score||1})).filter(o=>o.text.length>0):(n&&n.error&&console.error("Tauri autocomplete error:",n.error),[])}async getMCPSuggestions(e,t,n){const o=Date.now(),a=await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:o,method:"tools/call",params:{name:n,arguments:{query:e.trim(),limit:t,role:this.currentRole}}}),signal:AbortSignal.timeout(5e3)});if(!a.ok)return console.error(`MCP ${n} request failed:`,a.status,a.statusText),[];const r=await a.json();return console.log(`MCP ${n} response:`,r),r.result&&!r.result.is_error&&r.result.content?n==="autocomplete_with_snippets"?this.parseAutocompleteWithSnippetsContent(r.result.content):this.parseAutocompleteContent(r.result.content):(r.error&&console.error(`MCP ${n} error:`,r.error),[])}async getSuggestionsWithSnippets(e,t=10){if(!e||e.trim().length===0)return[];if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return console.warn("Autocomplete index not built, returning empty suggestions with snippets"),[];try{return Jt()?await this.getTauriSuggestions(e,t):await this.getMCPSuggestions(e,t,"autocomplete_with_snippets")}catch(n){return console.error("Error getting autocomplete suggestions with snippets:",n),[]}}extractLastWord(e){const t=e.trim().split(/\s+/);return t[t.length-1]||""}parseAutocompleteContent(e){const t=[];for(const n of e)if(n.type==="text"&&n.text){if(!n.text.startsWith("Found")&&!n.text.startsWith("‚Ä¢"))t.push({text:n.text.trim()});else if(n.text.startsWith("‚Ä¢")){const o=n.text.replace("‚Ä¢","").trim();o&&t.push({text:o})}}return t}parseAutocompleteWithSnippetsContent(e){const t=[];for(const n of e)if(n.type==="text"&&n.text){if(!n.text.startsWith("Found")&&!n.text.startsWith("‚Ä¢")){const o=n.text.split(" ‚Äî ");o.length===2?t.push({text:o[0].trim(),snippet:o[1].trim()}):t.push({text:n.text.trim()})}else if(n.text.startsWith("‚Ä¢")){const o=n.text.replace("‚Ä¢","").trim();o&&t.push({text:o})}}return t}isReady(){return this.autocompleteIndexBuilt}getStatus(){return{ready:this.autocompleteIndexBuilt,baseUrl:this.baseUrl,sessionId:this.sessionId,usingTauri:Jt(),currentRole:this.currentRole,connectionRetries:this.connectionRetries,isConnecting:this.isConnecting}}async refreshIndex(){return this.autocompleteIndexBuilt=!1,this.connectionRetries=0,await this.buildAutocompleteIndex()}async testConnection(){try{if(Jt()){const e=await Ge("get_autocomplete_suggestions",{query:"test",role_name:this.currentRole,limit:1});return e&&(e.status==="success"||e.status==="error")}else return(await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:Date.now(),method:"tools/list",params:{}}),signal:AbortSignal.timeout(3e3)})).ok}catch(e){return console.warn("Connection test failed:",e),!1}}}const Ot=new si;function ri(l){var e;const{char:t,allowSpaces:n,allowToIncludeChar:o,allowedPrefixes:a,startOfLine:r,$position:u}=l,i=n&&!o,d=gr(t),p=new RegExp(`\\s${d}$`),m=r?"^":"",_=o?"":d,h=i?new RegExp(`${m}${d}.*?(?=\\s${_}|$)`,"gm"):new RegExp(`${m}(?:^)?${d}[^\\s${_}]*`,"gm"),b=((e=u.nodeBefore)===null||e===void 0?void 0:e.isText)&&u.nodeBefore.text;if(!b)return null;const v=u.pos-b.length,w=Array.from(b.matchAll(h)).pop();if(!w||w.input===void 0||w.index===void 0)return null;const y=w.input.slice(Math.max(0,w.index-1),w.index),$=new RegExp(`^[${a==null?void 0:a.join("")}\0]?$`).test(y);if(a!==null&&!$)return null;const k=v+w.index;let S=k+w[0].length;return i&&p.test(b.slice(S-1,S+1))&&(w[0]+=" ",S+=1),k<u.pos&&S>=u.pos?{range:{from:k,to:S},query:w[0].slice(t.length),text:w[0]}:null}const ii=new Hs("suggestion");function ai({pluginKey:l=ii,editor:e,char:t="@",allowSpaces:n=!1,allowToIncludeChar:o=!1,allowedPrefixes:a=[" "],startOfLine:r=!1,decorationTag:u="span",decorationClass:i="suggestion",decorationContent:d="",decorationEmptyClass:p="is-empty",command:m=()=>null,items:_=()=>[],render:h=()=>({}),allow:b=()=>!0,findSuggestionMatch:v=ri}){let w;const y=h==null?void 0:h(),$=new mr({key:l,view(){return{update:async(k,S)=>{var j,D,O,E,U,Z,V;const A=(j=this.key)===null||j===void 0?void 0:j.getState(S),C=(D=this.key)===null||D===void 0?void 0:D.getState(k.state),ne=A.active&&C.active&&A.range.from!==C.range.from,q=!A.active&&C.active,le=A.active&&!C.active,Y=!q&&!le&&A.query!==C.query,H=q||ne&&Y,oe=Y||ne,N=le||ne&&Y;if(!H&&!oe&&!N)return;const z=N&&!H?A:C,I=k.dom.querySelector(`[data-decoration-id="${z.decorationId}"]`);w={editor:e,range:z.range,query:z.query,text:z.text,items:[],command:L=>m({editor:e,range:z.range,props:L}),decorationNode:I,clientRect:I?()=>{var L;const{decorationId:F}=(L=this.key)===null||L===void 0?void 0:L.getState(e.state),ee=k.dom.querySelector(`[data-decoration-id="${F}"]`);return(ee==null?void 0:ee.getBoundingClientRect())||null}:null},H&&((O=y==null?void 0:y.onBeforeStart)===null||O===void 0||O.call(y,w)),oe&&((E=y==null?void 0:y.onBeforeUpdate)===null||E===void 0||E.call(y,w)),(oe||H)&&(w.items=await _({editor:e,query:z.query})),N&&((U=y==null?void 0:y.onExit)===null||U===void 0||U.call(y,w)),oe&&((Z=y==null?void 0:y.onUpdate)===null||Z===void 0||Z.call(y,w)),H&&((V=y==null?void 0:y.onStart)===null||V===void 0||V.call(y,w))},destroy:()=>{var k;w&&((k=y==null?void 0:y.onExit)===null||k===void 0||k.call(y,w))}}},state:{init(){return{active:!1,range:{from:0,to:0},query:null,text:null,composing:!1}},apply(k,S,j,D){const{isEditable:O}=e,{composing:E}=e.view,{selection:U}=k,{empty:Z,from:V}=U,A={...S};if(A.composing=E,O&&(Z||e.view.composing)){(V<S.range.from||V>S.range.to)&&!E&&!S.composing&&(A.active=!1);const C=v({char:t,allowSpaces:n,allowToIncludeChar:o,allowedPrefixes:a,startOfLine:r,$position:U.$from}),ne=`id_${Math.floor(Math.random()*4294967295)}`;C&&b({editor:e,state:D,range:C.range,isActive:S.active})?(A.active=!0,A.decorationId=S.decorationId?S.decorationId:ne,A.range=C.range,A.query=C.query,A.text=C.text):A.active=!1}else A.active=!1;return A.active||(A.decorationId=null,A.range={from:0,to:0},A.query=null,A.text=null),A}},props:{handleKeyDown(k,S){var j;const{active:D,range:O}=$.getState(k.state);return D&&((j=y==null?void 0:y.onKeyDown)===null||j===void 0?void 0:j.call(y,{view:k,event:S,range:O}))||!1},decorations(k){const{active:S,range:j,decorationId:D,query:O}=$.getState(k);if(!S)return null;const E=!(O!=null&&O.length),U=[i];return E&&U.push(p),_r.create(k.doc,[hr.inline(j.from,j.to,{nodeName:u,class:U.join(" "),"data-decoration-id":D,"data-decoration-content":d})])}}});return $}const An=vr.create({name:"terraphimSuggestion",addOptions(){return{trigger:"++",pluginKey:new Hs("terraphimSuggestion"),allowSpaces:!1,limit:8,minLength:1,debounce:300}},addCommands(){return{insertSuggestion:l=>({commands:e,chain:t})=>t().insertContent(l.text).run()}},addProseMirrorPlugins(){const l={editor:this.editor,char:this.options.trigger,pluginKey:this.options.pluginKey,allowSpaces:this.options.allowSpaces,startOfLine:!1,command:({editor:e,range:t,props:n})=>{const o=n;e.chain().focus().insertContentAt(t,o.text+" ").run()},items:async({query:e,editor:t})=>new Promise(n=>{setTimeout(async()=>{if(e.length<this.options.minLength){n([]);return}try{const o=await Ot.getSuggestionsWithSnippets(e,this.options.limit);console.log(`TerraphimSuggestion: Found ${o.length} suggestions for "${e}"`),n(o)}catch(o){console.error("TerraphimSuggestion: Error getting suggestions:",o),n([])}},this.options.debounce)}),render:()=>{let e,t;return{onStart:n=>{e=new ci({items:n.items,command:n.command}),n.clientRect&&(t=$r("body",{getReferenceClientRect:n.clientRect,appendTo:()=>document.body,content:e.element,showOnCreate:!0,interactive:!0,trigger:"manual",placement:"bottom-start",theme:"terraphim-suggestion",maxWidth:"none"})[0])},onUpdate(n){e==null||e.updateItems(n.items),n.clientRect&&(t==null||t.setProps({getReferenceClientRect:n.clientRect}))},onKeyDown(n){return n.event.key==="Escape"?(t==null||t.hide(),!0):(e==null?void 0:e.onKeyDown(n))??!1},onExit(){t==null||t.destroy(),e==null||e.destroy()}}}};return[ai(l)]}});class ci{constructor(e){Ct(this,"element");Ct(this,"items",[]);Ct(this,"selectedIndex",0);Ct(this,"command");this.items=e.items,this.command=e.command,this.element=document.createElement("div"),this.element.className="terraphim-suggestion-dropdown",this.render()}updateItems(e){this.items=e,this.selectedIndex=0,this.render()}onKeyDown({event:e}){return e.key==="ArrowUp"?(this.selectPrevious(),!0):e.key==="ArrowDown"?(this.selectNext(),!0):e.key==="Enter"||e.key==="Tab"?(this.selectItem(this.selectedIndex),!0):!1}selectPrevious(){this.selectedIndex=Math.max(0,this.selectedIndex-1),this.render()}selectNext(){this.selectedIndex=Math.min(this.items.length-1,this.selectedIndex+1),this.render()}selectItem(e){const t=this.items[e];t&&this.command({id:t.text,...t})}render(){if(this.element.innerHTML="",this.items.length===0){this.element.innerHTML=`
        <div class="terraphim-suggestion-item terraphim-suggestion-empty">
          <div class="terraphim-suggestion-text">No suggestions found</div>
          <div class="terraphim-suggestion-hint">Try a different search term</div>
        </div>
      `;return}const e=document.createElement("div");e.className="terraphim-suggestion-header",e.innerHTML=`
      <div class="terraphim-suggestion-count">${this.items.length} suggestions</div>
      <div class="terraphim-suggestion-hint">‚Üë‚Üì Navigate ‚Ä¢ Tab/Enter Select ‚Ä¢ Esc Cancel</div>
    `,this.element.appendChild(e),this.items.forEach((t,n)=>{const o=document.createElement("div");o.className=`terraphim-suggestion-item ${n===this.selectedIndex?"terraphim-suggestion-selected":""}`,o.innerHTML=`
        <div class="terraphim-suggestion-main">
          <div class="terraphim-suggestion-text">${this.escapeHtml(t.text)}</div>
          ${t.snippet?`<div class="terraphim-suggestion-snippet">${this.escapeHtml(t.snippet)}</div>`:""}
        </div>
        ${t.score?`<div class="terraphim-suggestion-score">${Math.round(t.score*100)}%</div>`:""}
      `,o.addEventListener("click",()=>this.selectItem(n)),o.addEventListener("mouseenter",()=>{this.selectedIndex=n,this.render()}),this.element.appendChild(o)})}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}destroy(){this.element.remove()}}const ui=`
.terraphim-suggestion-dropdown {
  background: white;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  box-shadow: 0 10px 38px -10px rgba(22, 23, 24, 0.35), 0 10px 20px -15px rgba(22, 23, 24, 0.2);
  max-height: 300px;
  min-width: 300px;
  overflow-y: auto;
  z-index: 1000;
}

.terraphim-suggestion-header {
  padding: 8px 12px;
  border-bottom: 1px solid #f1f5f9;
  background: #f8fafc;
  font-size: 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.terraphim-suggestion-count {
  font-weight: 600;
  color: #475569;
}

.terraphim-suggestion-hint {
  color: #64748b;
}

.terraphim-suggestion-item {
  padding: 8px 12px;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  border-bottom: 1px solid #f1f5f9;
}

.terraphim-suggestion-item:hover {
  background: #f8fafc;
}

.terraphim-suggestion-selected {
  background: #eff6ff !important;
  border-left: 3px solid #3b82f6;
}

.terraphim-suggestion-empty {
  color: #64748b;
  font-style: italic;
  text-align: center;
  cursor: default;
}

.terraphim-suggestion-main {
  flex: 1;
}

.terraphim-suggestion-text {
  font-weight: 500;
  color: #1e293b;
  margin-bottom: 2px;
}

.terraphim-suggestion-snippet {
  font-size: 12px;
  color: #64748b;
  line-height: 1.3;
}

.terraphim-suggestion-score {
  font-size: 11px;
  color: #10b981;
  font-weight: 600;
  background: #ecfdf5;
  padding: 2px 6px;
  border-radius: 4px;
  margin-left: 8px;
}

/* Dark theme support */
@media (prefers-color-scheme: dark) {
  .terraphim-suggestion-dropdown {
    background: #1e293b;
    border-color: #334155;
  }

  .terraphim-suggestion-header {
    background: #0f172a;
    border-color: #334155;
  }

  .terraphim-suggestion-item:hover {
    background: #334155;
  }

  .terraphim-suggestion-selected {
    background: #1e40af !important;
  }

  .terraphim-suggestion-text {
    color: #f1f5f9;
  }

  .terraphim-suggestion-snippet {
    color: #94a3b8;
  }
}

/* Tippy.js theme */
.tippy-box[data-theme~='terraphim-suggestion'] {
  background: transparent;
  box-shadow: none;
}

.tippy-box[data-theme~='terraphim-suggestion'] > .tippy-backdrop {
  background: transparent;
}

.tippy-box[data-theme~='terraphim-suggestion'] > .tippy-arrow {
  display: none;
}
`;function En(l){let e,t,n,o,a,r,u,i,d,p,m,_,h,b,v,w,y,$,k,S,j,D,O,E,U,Z,V=l[12]?"Tauri (native)":`MCP Server (${Ot.getStatus().baseUrl})`,A,C,ne,q,le,Y,H,oe,N,z,I,L,F,ee,J,X,Q,re,pe,ie,ae=l[6]!==1?"s":"",be,K,x,ce,ge,ke,Te,Ze,Be,Ne,Pe,fe,Re,Me,Xe,xe,ye,He,Ke=l[3]?"Enabled":"Disabled",qe,Le,Ie,it,Oe=l[11]&&!l[8]&&Ln(l);function We(W,ue){if(W[8])return mi;if(W[11])return pi}let G=We(l),te=G&&G(l);return{c(){e=f("div"),t=f("div"),n=f("strong"),n.textContent="Local Autocomplete Status:",o=g(),a=f("div"),r=f("button"),u=P("Test"),d=g(),p=f("button"),p.textContent="Rebuild Index",m=g(),_=f("button"),h=P("Demo"),v=g(),w=f("div"),y=P(l[10]),$=g(),Oe&&Oe.c(),k=g(),S=f("div"),j=f("strong"),j.textContent="Configuration:",D=g(),O=f("br"),E=P("‚Ä¢ "),U=f("strong"),U.textContent="Backend:",Z=g(),A=P(V),C=g(),ne=f("br"),q=P("‚Ä¢ "),le=f("strong"),le.textContent="Role:",Y=g(),H=P(l[9]),oe=g(),N=f("br"),z=P("‚Ä¢ "),I=f("strong"),I.textContent="Trigger:",L=P(' "'),F=P(l[4]),ee=P(`" + text
      `),J=f("br"),X=P("‚Ä¢ "),Q=f("strong"),Q.textContent="Min Length:",re=g(),pe=P(l[6]),ie=P(" character"),be=P(ae),K=g(),x=f("br"),ce=P("‚Ä¢ "),ge=f("strong"),ge.textContent="Max Results:",ke=g(),Te=P(l[5]),Ze=g(),Be=f("br"),Ne=P("‚Ä¢ "),Pe=f("strong"),Pe.textContent="Debounce:",fe=g(),Re=P(l[7]),Me=P(`ms
      `),Xe=f("br"),xe=P("‚Ä¢ "),ye=f("strong"),ye.textContent="Snippets:",He=g(),qe=P(Ke),Le=g(),te&&te.c(),we(n,"color","#495057"),we(r,"padding","4px 8px"),we(r,"background","#007bff"),we(r,"color","white"),we(r,"border","none"),we(r,"border-radius","4px"),we(r,"cursor","pointer"),we(r,"font-size","12px"),r.disabled=i=!l[8],we(p,"padding","4px 8px"),we(p,"background","#28a745"),we(p,"color","white"),we(p,"border","none"),we(p,"border-radius","4px"),we(p,"cursor","pointer"),we(p,"font-size","12px"),we(_,"padding","4px 8px"),we(_,"background","#ffc107"),we(_,"color","#212529"),we(_,"border","none"),we(_,"border-radius","4px"),we(_,"cursor","pointer"),we(_,"font-size","12px"),_.disabled=b=!l[8],we(a,"display","flex"),we(a,"gap","8px"),we(t,"display","flex"),we(t,"justify-content","space-between"),we(t,"align-items","center"),we(t,"margin-bottom","8px"),we(w,"font-size","13px"),we(w,"color","#6c757d"),we(w,"margin-bottom","8px"),we(w,"font-family","monospace"),we(S,"font-size","12px"),we(S,"color","#6c757d"),we(e,"margin-top","10px"),we(e,"padding","12px"),we(e,"background","#f8f9fa"),we(e,"border-radius","6px"),we(e,"border","1px solid #e9ecef")},m(W,ue){R(W,e,ue),s(e,t),s(t,n),s(t,o),s(t,a),s(a,r),s(r,u),s(a,d),s(a,p),s(a,m),s(a,_),s(_,h),s(e,v),s(e,w),s(w,y),s(e,$),Oe&&Oe.m(e,null),s(e,k),s(e,S),s(S,j),s(S,D),s(S,O),s(S,E),s(S,U),s(S,Z),s(S,A),s(S,C),s(S,ne),s(S,q),s(S,le),s(S,Y),s(S,H),s(S,oe),s(S,N),s(S,z),s(S,I),s(S,L),s(S,F),s(S,ee),s(S,J),s(S,X),s(S,Q),s(S,re),s(S,pe),s(S,ie),s(S,be),s(S,K),s(S,x),s(S,ce),s(S,ge),s(S,ke),s(S,Te),s(S,Ze),s(S,Be),s(S,Ne),s(S,Pe),s(S,fe),s(S,Re),s(S,Me),s(S,Xe),s(S,xe),s(S,ye),s(S,He),s(S,qe),s(e,Le),te&&te.m(e,null),Ie||(it=[se(r,"click",l[14]),se(p,"click",l[15]),se(_,"click",l[16])],Ie=!0)},p(W,ue){ue&256&&i!==(i=!W[8])&&(r.disabled=i),ue&256&&b!==(b=!W[8])&&(_.disabled=b),ue&1024&&ve(y,W[10]),W[11]&&!W[8]?Oe?Oe.p(W,ue):(Oe=Ln(W),Oe.c(),Oe.m(e,k)):Oe&&(Oe.d(1),Oe=null),ue&4096&&V!==(V=W[12]?"Tauri (native)":`MCP Server (${Ot.getStatus().baseUrl})`)&&ve(A,V),ue&512&&ve(H,W[9]),ue&16&&ve(F,W[4]),ue&64&&ve(pe,W[6]),ue&64&&ae!==(ae=W[6]!==1?"s":"")&&ve(be,ae),ue&32&&ve(Te,W[5]),ue&128&&ve(Re,W[7]),ue&8&&Ke!==(Ke=W[3]?"Enabled":"Disabled")&&ve(qe,Ke),G===(G=We(W))&&te?te.p(W,ue):(te&&te.d(1),te=G&&G(W),te&&(te.c(),te.m(e,null)))},d(W){W&&T(e),Oe&&Oe.d(),te&&te.d(),Ie=!1,lt(it)}}}function Ln(l){let e,t,n,o;function a(i,d){return i[12]?di:fi}let r=a(l),u=r(l);return{c(){e=f("div"),t=f("strong"),t.textContent="‚ö†Ô∏è Autocomplete Not Available",n=f("br"),o=g(),u.c(),we(e,"font-size","12px"),we(e,"color","#dc3545"),we(e,"margin-bottom","8px"),we(e,"padding","6px"),we(e,"background","#f8d7da"),we(e,"border-radius","4px")},m(i,d){R(i,e,d),s(e,t),s(e,n),s(e,o),u.m(e,null)},p(i,d){r===(r=a(i))&&u?u.p(i,d):(u.d(1),u=r(i),u&&(u.c(),u.m(e,null)))},d(i){i&&T(e),u.d()}}}function fi(l){let e,t=Ot.getStatus().baseUrl+"",n;return{c(){e=P("MCP server not responding. Ensure the server is running on "),n=P(t)},m(o,a){R(o,e,a),R(o,n,a)},p:Ce,d(o){o&&T(e),o&&T(n)}}}function di(l){let e;return{c(){e=P("Tauri backend connection failed. Ensure the application has proper permissions.")},m(t,n){R(t,e,n)},p:Ce,d(t){t&&T(e)}}}function pi(l){let e;return{c(){e=f("div"),e.innerHTML=`<strong>‚ùå Autocomplete Unavailable</strong> 
        <div style="font-size: 11px; margin-top: 4px; color: #721c24;">Click &quot;Rebuild Index&quot; to retry or check server/backend status.</div>`,we(e,"margin-top","8px"),we(e,"padding","8px"),we(e,"background","#f8d7da"),we(e,"border","1px solid #f5c6cb"),we(e,"border-radius","4px")},m(t,n){R(t,e,n)},p:Ce,d(t){t&&T(e)}}}function mi(l){let e,t,n,o,a,r,u,i,d,p,m,_,h,b,v,w,y;return{c(){e=f("div"),t=f("strong"),t.textContent="üéØ Autocomplete Active",n=g(),o=f("div"),a=P("Type "),r=f("code"),u=P(l[4]),i=P(" in the editor above to trigger suggestions."),d=f("br"),p=P(`
          Example: `),m=f("code"),_=P(l[4]),h=P("terraphim"),b=P(" or "),v=f("code"),w=P(l[4]),y=P("graph"),we(o,"font-size","11px"),we(o,"margin-top","4px"),we(o,"color","#0056b3"),we(e,"margin-top","8px"),we(e,"padding","8px"),we(e,"background","#d1edff"),we(e,"border","1px solid #b3d9ff"),we(e,"border-radius","4px")},m($,k){R($,e,k),s(e,t),s(e,n),s(e,o),s(o,a),s(o,r),s(r,u),s(o,i),s(o,d),s(o,p),s(o,m),s(m,_),s(m,h),s(o,b),s(o,v),s(v,w),s(v,y)},p($,k){k&16&&ve(u,$[4]),k&16&&ve(_,$[4]),k&16&&ve(w,$[4])},d($){$&&T(e)}}}function _i(l){let e,t,n,o;e=new Cr({props:{defaultValue:l[0],isEditable:!l[1],disableLocalStorage:!0,onUpdate:l[13],extensions:[yn,...l[2]?[An.configure({trigger:l[4],allowSpaces:!1,limit:l[5],minLength:l[6],debounce:l[7]})]:[]]}});let a=l[2]&&En(l);return{c(){me(e.$$.fragment),t=g(),a&&a.c(),n=ut()},m(r,u){_e(e,r,u),R(r,t,u),a&&a.m(r,u),R(r,n,u),o=!0},p(r,[u]){const i={};u&1&&(i.defaultValue=r[0]),u&2&&(i.isEditable=!r[1]),u&244&&(i.extensions=[yn,...r[2]?[An.configure({trigger:r[4],allowSpaces:!1,limit:r[5],minLength:r[6],debounce:r[7]})]:[]]),e.$set(i),r[2]?a?a.p(r,u):(a=En(r),a.c(),a.m(n.parentNode,n)):a&&(a.d(1),a=null)},i(r){o||(M(e.$$.fragment,r),o=!0)},o(r){B(e.$$.fragment,r),o=!1},d(r){he(e,r),r&&T(t),a&&a.d(r),r&&T(n)}}}function hi(l,e,t){let n,o;je(l,At,E=>t(9,n=E)),je(l,ct,E=>t(12,o=E));let{html:a=""}=e,{readOnly:r=!1}=e,{outputFormat:u="html"}=e,{enableAutocomplete:i=!0}=e,{showSnippets:d=!0}=e,{suggestionTrigger:p="++"}=e,{maxSuggestions:m=8}=e,{minQueryLength:_=1}=e,{debounceDelay:h=300}=e,b=null,v="‚è≥ Initializing...",w=!1,y=!1,$=null;tl(async()=>{i&&await k(),typeof document<"u"&&($=document.createElement("style"),$.textContent=ui,document.head.appendChild($))}),Wl(()=>{$&&$.parentNode&&$.parentNode.removeChild($)});async function k(){t(10,v="‚è≥ Initializing autocomplete..."),t(8,w=!1),t(11,y=!1);try{Ot.setRole(n),t(10,v="üîó Testing connection...");const E=await Ot.testConnection();t(11,y=!0),E?(t(10,v="üî® Building autocomplete index..."),await Ot.buildAutocompleteIndex()?(o?t(10,v="‚úÖ Ready - Using Tauri backend"):t(10,v="‚úÖ Ready - Using MCP server backend"),t(8,w=!0)):t(10,v="‚ùå Failed to build autocomplete index")):o?t(10,v="‚ùå Tauri backend not available"):t(10,v="‚ùå MCP server not responding")}catch(E){console.error("Error initializing autocomplete:",E),t(10,v="‚ùå Autocomplete initialization error")}}const S=E=>{b=E,u==="markdown"?t(0,a=E.storage.markdown.getMarkdown()):t(0,a=E.getHTML())},j=async()=>{if(!y){alert("Please wait for connection test to complete");return}if(!w){alert("Autocomplete service not ready. Check the status above.");return}try{t(10,v="üß™ Testing autocomplete...");const E="terraphim",U=await Ot.getSuggestions(E,5);if(console.log("Autocomplete test results:",U),U.length>0){const Z=U.map((V,A)=>`${A+1}. ${V.text}${V.snippet?` (${V.snippet})`:""}`).join(`
`);alert(`‚úÖ Found ${U.length} suggestions for '${E}':

${Z}`),o?t(10,v="‚úÖ Ready - Using Tauri backend"):t(10,v="‚úÖ Ready - Using MCP server backend")}else alert(`‚ö†Ô∏è No suggestions found for '${E}'. This might be normal if the term isn't in your knowledge graph.`)}catch(E){console.error("Autocomplete test failed:",E),alert(`‚ùå Autocomplete test failed: ${E.message}`),t(10,v="‚ùå Test failed - check console for details")}},D=async()=>{t(10,v="‚è≥ Rebuilding index..."),t(8,w=!1);try{await Ot.refreshIndex()?(o?t(10,v="‚úÖ Ready - Tauri index rebuilt successfully"):t(10,v="‚úÖ Ready - MCP server index rebuilt successfully"),t(8,w=!0)):t(10,v="‚ùå Failed to rebuild index")}catch(E){console.error("Error rebuilding index:",E),t(10,v="‚ùå Index rebuild failed - check console for details")}},O=()=>{if(!b){alert("Editor not ready yet");return}const E=`# Terraphim Autocomplete Demo

This is a demonstration of the integrated Terraphim autocomplete system.

## How to Use:
1. Type "${p}" to trigger autocomplete
2. Start typing any term (e.g., "${p}terraphim", "${p}graph")
3. Use ‚Üë‚Üì arrows to navigate suggestions
4. Press Tab or Enter to select
5. Press Esc to cancel

## Try these queries:
- ${p}terraphim
- ${p}graph
- ${p}service
- ${p}automata
- ${p}role

The autocomplete system uses your local knowledge graph to provide intelligent suggestions based on your selected role: **${n}**.

---

Start typing below:`;b.commands.setContent(E),setTimeout(()=>{b.commands.focus("end")},100),alert(`Demo content inserted!

Type "${p}" followed by any term to see autocomplete suggestions.

Example: "${p}terraphim"`)};return l.$$set=E=>{"html"in E&&t(0,a=E.html),"readOnly"in E&&t(1,r=E.readOnly),"outputFormat"in E&&t(17,u=E.outputFormat),"enableAutocomplete"in E&&t(2,i=E.enableAutocomplete),"showSnippets"in E&&t(3,d=E.showSnippets),"suggestionTrigger"in E&&t(4,p=E.suggestionTrigger),"maxSuggestions"in E&&t(5,m=E.maxSuggestions),"minQueryLength"in E&&t(6,_=E.minQueryLength),"debounceDelay"in E&&t(7,h=E.debounceDelay)},l.$$.update=()=>{l.$$.dirty&772&&n&&i&&w&&(Ot.setRole(n),k())},[a,r,i,d,p,m,_,h,w,n,v,y,o,S,j,D,O,u]}class gi extends mt{constructor(e){super(),_t(this,e,hi,_i,dt,{html:0,readOnly:1,outputFormat:17,enableAutocomplete:2,showSnippets:3,suggestionTrigger:4,maxSuggestions:5,minQueryLength:6,debounceDelay:7})}}function In(l){let e,t,n,o,a,r,u,i,d,p,m;return{c(){e=f("div"),t=f("h3"),n=f("span"),n.textContent="Knowledge Graph",o=P(`
          Term: `),a=f("strong"),r=P(l[2]),u=P(" | Rank: "),i=f("strong"),d=P(l[3]),p=g(),m=f("hr"),c(n,"class","tag is-info svelte-329px1"),c(t,"class","subtitle is-6 svelte-329px1"),c(m,"class","svelte-329px1"),c(e,"class","kg-context svelte-329px1")},m(_,h){R(_,e,h),s(e,t),s(t,n),s(t,o),s(t,a),s(a,r),s(t,u),s(t,i),s(i,d),s(e,p),s(e,m)},p(_,h){h&4&&ve(r,_[2]),h&8&&ve(d,_[3])},d(_){_&&T(e)}}}function vi(l){let e,t,n,o,a,r,u,i;const d=[wi,ki],p=[];function m(_,h){return _[5]?0:1}return t=m(l),n=p[t]=d[t](l),{c(){e=f("div"),n.c(),o=g(),a=f("div"),a.innerHTML='<span class="hint-text svelte-329px1">Double-click to edit ‚Ä¢ Ctrl+E to edit ‚Ä¢ Ctrl+S to save ‚Ä¢ Click KG links to explore</span>',c(a,"class","edit-hint svelte-329px1"),c(e,"class","content-viewer svelte-329px1"),c(e,"tabindex","0"),c(e,"role","button"),c(e,"aria-label","Double-click to edit article content")},m(_,h){R(_,e,h),p[t].m(e,null),s(e,o),s(e,a),l[20](e),r=!0,u||(i=[se(e,"dblclick",l[14]),se(e,"keydown",l[15]),se(e,"click",l[13])],u=!0)},p(_,h){let b=t;t=m(_),t===b?p[t].p(_,h):(Ue(),B(p[b],1,1,()=>{p[b]=null}),ze(),n=p[t],n?n.p(_,h):(n=p[t]=d[t](_),n.c()),M(n,1),n.m(e,o))},i(_){r||(M(n),r=!0)},o(_){B(n),r=!1},d(_){_&&T(e),p[t].d(),l[20](null),u=!1,lt(i)}}}function bi(l){let e,t,n,o,a,r,u,i,d,p;function m(h){l[18](h)}let _={outputFormat:l[11]};return l[1].body!==void 0&&(_.html=l[1].body),e=new gi({props:_}),et.push(()=>st(e,"html",m)),{c(){me(e.$$.fragment),n=g(),o=f("div"),a=f("button"),a.textContent="Save",r=g(),u=f("button"),u.textContent="Cancel",c(a,"class","button is-primary"),c(u,"class","button is-light"),c(o,"class","edit-controls svelte-329px1")},m(h,b){_e(e,h,b),R(h,n,b),R(h,o,b),s(o,a),s(o,r),s(o,u),i=!0,d||(p=[se(a,"click",l[12]),se(u,"click",l[19])],d=!0)},p(h,b){const v={};b&2048&&(v.outputFormat=h[11]),!t&&b&2&&(t=!0,v.html=h[1].body,rt(()=>t=!1)),e.$set(v)},i(h){i||(M(e.$$.fragment,h),i=!0)},o(h){B(e.$$.fragment,h),i=!1},d(h){he(e,h),h&&T(n),h&&T(o),d=!1,lt(p)}}}function ki(l){let e,t,n;return t=new Ul({props:{source:l[1].body}}),{c(){e=f("div"),me(t.$$.fragment),c(e,"class","markdown-content svelte-329px1")},m(o,a){R(o,e,a),_e(t,e,null),n=!0},p(o,a){const r={};a&2&&(r.source=o[1].body),t.$set(r)},i(o){n||(M(t.$$.fragment,o),n=!0)},o(o){B(t.$$.fragment,o),n=!1},d(o){o&&T(e),he(t)}}}function wi(l){let e,t=l[1].body+"";return{c(){e=f("div"),c(e,"class","prose svelte-329px1")},m(n,o){R(n,e,o),e.innerHTML=t},p(n,o){o&2&&t!==(t=n[1].body+"")&&(e.innerHTML=t)},i:Ce,o:Ce,d(n){n&&T(e)}}}function yi(l){let e,t,n,o,a,r=l[1].title+"",u,i,d,p,m,_,h,b=l[2]&&l[3]!==null&&In(l);const v=[bi,vi],w=[];function y($,k){return $[4]?0:1}return d=y(l),p=w[d]=v[d](l),{c(){e=f("div"),t=f("button"),n=g(),b&&b.c(),o=g(),a=f("h2"),u=P(r),i=g(),p.c(),c(t,"class","delete is-large modal-close-btn svelte-329px1"),c(t,"aria-label","close"),c(a,"class","svelte-329px1"),c(e,"class","box wrapper svelte-329px1")},m($,k){R($,e,k),s(e,t),s(e,n),b&&b.m(e,null),s(e,o),s(e,a),s(a,u),s(e,i),w[d].m(e,null),m=!0,_||(h=se(t,"click",l[17]),_=!0)},p($,k){$[2]&&$[3]!==null?b?b.p($,k):(b=In($),b.c(),b.m(e,o)):b&&(b.d(1),b=null),(!m||k&2)&&r!==(r=$[1].title+"")&&ve(u,r);let S=d;d=y($),d===S?w[d].p($,k):(Ue(),B(w[S],1,1,()=>{w[S]=null}),ze(),p=w[d],p?p.p($,k):(p=w[d]=v[d]($),p.c()),M(p,1),p.m(e,null))},i($){m||(M(p),m=!0)},o($){B(p),m=!1},d($){$&&T(e),b&&b.d(),w[d].d(),_=!1,h()}}}function Dn(l){let e,t,n;function o(r){l[23](r)}let a={$$slots:{default:[Ti]},$$scope:{ctx:l}};return l[7]!==void 0&&(a.active=l[7]),e=new kl({props:a}),et.push(()=>st(e,"active",o)),{c(){me(e.$$.fragment)},m(r,u){_e(e,r,u),n=!0},p(r,u){const i={};u&536872832&&(i.$$scope={dirty:u,ctx:r}),!t&&u&128&&(t=!0,i.active=r[7],rt(()=>t=!1)),e.$set(i)},i(r){n||(M(e.$$.fragment,r),n=!0)},o(r){B(e.$$.fragment,r),n=!1},d(r){he(e,r)}}}function Nn(l){let e,t,n,o,a,r,u,i,d,p,m;return{c(){e=f("div"),t=f("h3"),n=f("span"),n.textContent="Knowledge Graph",o=P(`
            Term: `),a=f("strong"),r=P(l[9]),u=P(" | Rank: "),i=f("strong"),d=P(l[10]),p=g(),m=f("hr"),c(n,"class","tag is-info svelte-329px1"),c(t,"class","subtitle is-6 svelte-329px1"),c(m,"class","svelte-329px1"),c(e,"class","kg-context svelte-329px1")},m(_,h){R(_,e,h),s(e,t),s(t,n),s(t,o),s(t,a),s(a,r),s(t,u),s(t,i),s(i,d),s(e,p),s(e,m)},p(_,h){h&512&&ve(r,_[9]),h&1024&&ve(d,_[10])},d(_){_&&T(e)}}}function $i(l){let e,t,n;return t=new Ul({props:{source:l[8].body}}),{c(){e=f("div"),me(t.$$.fragment),c(e,"class","markdown-content svelte-329px1")},m(o,a){R(o,e,a),_e(t,e,null),n=!0},p(o,a){const r={};a&256&&(r.source=o[8].body),t.$set(r)},i(o){n||(M(t.$$.fragment,o),n=!0)},o(o){B(t.$$.fragment,o),n=!1},d(o){o&&T(e),he(t)}}}function Ci(l){let e,t=l[8].body+"";return{c(){e=f("div"),c(e,"class","prose svelte-329px1")},m(n,o){R(n,e,o),e.innerHTML=t},p(n,o){o&256&&t!==(t=n[8].body+"")&&(e.innerHTML=t)},i:Ce,o:Ce,d(n){n&&T(e)}}}function Ti(l){let e,t,n,o,a,r=l[8].title+"",u,i,d,p,m,_,h,b,v,w,y,$=l[9]&&l[10]!==null&&Nn(l);const k=[Ci,$i],S=[];function j(D,O){return O&256&&(p=null),p==null&&(p=!!(D[8].body&&(/<html/i.test(D[8].body)||/<body/i.test(D[8].body)||/<head/i.test(D[8].body)))),p?0:1}return m=j(l,-1),_=S[m]=k[m](l),{c(){e=f("div"),t=f("button"),n=g(),$&&$.c(),o=g(),a=f("h2"),u=P(r),i=g(),d=f("div"),_.c(),h=g(),b=f("div"),b.innerHTML='<span class="hint-text svelte-329px1">Knowledge Graph document ‚Ä¢ Click KG links to explore further</span>',c(t,"class","delete is-large modal-close-btn svelte-329px1"),c(t,"aria-label","close"),c(a,"class","svelte-329px1"),c(b,"class","edit-hint svelte-329px1"),c(d,"class","content-viewer svelte-329px1"),c(d,"tabindex","0"),c(d,"role","button"),c(d,"aria-label","KG document content - click KG links to explore further"),c(e,"class","box wrapper svelte-329px1")},m(D,O){R(D,e,O),s(e,t),s(e,n),$&&$.m(e,null),s(e,o),s(e,a),s(a,u),s(e,i),s(e,d),S[m].m(d,null),s(d,h),s(d,b),v=!0,w||(y=[se(t,"click",l[22]),se(d,"click",l[13])],w=!0)},p(D,O){D[9]&&D[10]!==null?$?$.p(D,O):($=Nn(D),$.c(),$.m(e,o)):$&&($.d(1),$=null),(!v||O&256)&&r!==(r=D[8].title+"")&&ve(u,r);let E=m;m=j(D,O),m===E?S[m].p(D,O):(Ue(),B(S[E],1,1,()=>{S[E]=null}),ze(),_=S[m],_?_.p(D,O):(_=S[m]=k[m](D),_.c()),M(_,1),_.m(d,h))},i(D){v||(M(_),v=!0)},o(D){B(_),v=!1},d(D){D&&T(e),$&&$.d(),S[m].d(),w=!1,lt(y)}}}function Si(l){let e,t,n,o,a;function r(d){l[21](d)}let u={$$slots:{default:[yi]},$$scope:{ctx:l}};l[0]!==void 0&&(u.active=l[0]),e=new kl({props:u}),et.push(()=>st(e,"active",r));let i=l[8]&&Dn(l);return{c(){me(e.$$.fragment),n=g(),i&&i.c(),o=ut()},m(d,p){_e(e,d,p),R(d,n,p),i&&i.m(d,p),R(d,o,p),a=!0},p(d,[p]){const m={};p&536873087&&(m.$$scope={dirty:p,ctx:d}),!t&&p&1&&(t=!0,m.active=d[0],rt(()=>t=!1)),e.$set(m),d[8]?i?(i.p(d,p),p&256&&M(i,1)):(i=Dn(d),i.c(),M(i,1),i.m(o.parentNode,o)):i&&(Ue(),B(i,1,1,()=>{i=null}),ze())},i(d){a||(M(e.$$.fragment,d),M(i),a=!0)},o(d){B(e.$$.fragment,d),B(i),a=!1},d(d){he(e,d),d&&T(n),i&&i.d(d),d&&T(o)}}}function Ri(l,e,t){let n,o,a,r;je(l,ct,q=>t(25,a=q)),je(l,At,q=>t(26,r=q));let{active:u=!1}=e,{item:i}=e,{initialEdit:d=!1}=e,{kgTerm:p=null}=e,{kgRank:m=null}=e,_=!1,h,b=!1,v=null,w=null,y=null;async function $(){if(a)try{const q=await Ge("get_document",{documentId:i.id});q!=null&&q.document&&t(1,i=q.document)}catch(q){console.error("Failed to load document",q)}}async function k(){if(!a){t(4,_=!1);return}try{await Ge("create_document",{document:i}),t(4,_=!1)}catch(q){console.error("Failed to save document",q)}}async function S(q){var le,Y,H,oe,N;t(9,w=q),console.log("üîç KG Link Click Debug Info:"),console.log("  Term clicked:",q),console.log("  Current role:",r),console.log("  Is Tauri mode:",a);try{if(a){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:r,term:q});const z=await Ge("find_documents_for_kg_term",{roleName:r,term:q});console.log("  üì• Tauri response received:"),console.log("    Status:",z.status),console.log("    Results count:",((le=z.results)==null?void 0:le.length)||0),console.log("    Total:",z.total||0),console.log("    Full response:",JSON.stringify(z,null,2)),z.status==="success"&&z.results&&z.results.length>0?(t(8,v=z.results[0]),t(10,y=v.rank||0),console.log("  ‚úÖ Found KG document:"),console.log("    Title:",v.title),console.log("    Rank:",y),console.log("    Body length:",((Y=v.body)==null?void 0:Y.length)||0,"characters"),t(7,b=!0)):(console.warn(`  ‚ö†Ô∏è  No KG documents found for term: "${q}" in role: "${r}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const z=Ye.ServerURL,I=encodeURIComponent(r),L=encodeURIComponent(q),F=`${z}/roles/${I}/kg_search?term=${L}`;console.log("  üì§ HTTP Request details:"),console.log("    Base URL:",z),console.log("    Role (encoded):",I),console.log("    Term (encoded):",L),console.log("    Full URL:",F);const ee=await fetch(F);if(console.log("  üì• HTTP Response received:"),console.log("    Status code:",ee.status),console.log("    Status text:",ee.statusText),console.log("    Headers:",Object.fromEntries(ee.headers.entries())),!ee.ok)throw new Error(`HTTP error! Status: ${ee.status} - ${ee.statusText}`);const J=await ee.json();console.log("  üìÑ Response data:"),console.log("    Status:",J.status),console.log("    Results count:",((H=J.results)==null?void 0:H.length)||0),console.log("    Total:",J.total||0),console.log("    Full response:",JSON.stringify(J,null,2)),J.status==="success"&&J.results&&J.results.length>0?(t(8,v=J.results[0]),t(10,y=v.rank||0),console.log("  ‚úÖ Found KG document:"),console.log("    Title:",v.title),console.log("    Rank:",y),console.log("    Body length:",((oe=v.body)==null?void 0:oe.length)||0,"characters"),t(7,b=!0)):(console.warn(`  ‚ö†Ô∏è  No KG documents found for term: "${q}" in role: "${r}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",F))}}catch(z){console.error("‚ùå Error fetching KG document:"),console.error("  Error type:",z.constructor.name),console.error("  Error message:",z.message||z),console.error("  Request details:",{term:q,role:r,isTauri:a,timestamp:new Date().toISOString()}),!a&&((N=z.message)!=null&&N.includes("Failed to fetch"))&&(console.error("  üí° Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{}}function j(q){const le=q.target;if(le.tagName==="A"){const Y=le.getAttribute("href");if(Y&&Y.startsWith("kg:")){q.preventDefault();const H=Y.substring(3);S(H)}}}function D(){t(4,_=!0)}function O(q){q.type!=="dblclick"&&((q.ctrlKey||q.metaKey)&&q.key==="e"&&(q.preventDefault(),t(4,_=!0)),_&&(q.ctrlKey||q.metaKey)&&q.key==="s"&&(q.preventDefault(),k()),q.key==="Escape"&&(q.preventDefault(),_?t(4,_=!1):t(0,u=!1)))}const E=()=>t(0,u=!1);function U(q){l.$$.not_equal(i.body,q)&&(i.body=q,t(1,i))}const Z=()=>t(4,_=!1);function V(q){et[q?"unshift":"push"](()=>{h=q,t(6,h)})}function A(q){u=q,t(0,u)}const C=()=>t(7,b=!1);function ne(q){b=q,t(7,b)}return l.$$set=q=>{"active"in q&&t(0,u=q.active),"item"in q&&t(1,i=q.item),"initialEdit"in q&&t(16,d=q.initialEdit),"kgTerm"in q&&t(2,p=q.kgTerm),"kgRank"in q&&t(3,m=q.kgRank)},l.$$.update=()=>{l.$$.dirty&65537&&u&&d&&t(4,_=!0),l.$$.dirty&19&&u&&i&&!_&&$(),l.$$.dirty&2&&t(5,n=i!=null&&i.body?/<html/i.test(i.body)||/<body/i.test(i.body)||/<head/i.test(i.body)||/^\s*<(!DOCTYPE|html|head|body|div|p|span)/i.test(i.body.trim()):!1),l.$$.dirty&32&&t(11,o=n?"html":"markdown")},[u,i,p,m,_,n,h,b,v,w,y,o,k,j,D,O,d,E,U,Z,V,A,C,ne]}class Yl extends mt{constructor(e){super(),_t(this,e,Ri,Si,dt,{active:0,item:1,initialEdit:16,kgTerm:2,kgRank:3})}}function On(l,e,t){const n=l.slice();return n[33]=e[t],n}function Pn(l,e,t){const n=l.slice();return n[36]=e[t],n}function Mn(l,e,t){const n=l.slice();return n[39]=e[t],n}function jn(l){let e,t;return e=new Bl({props:{type:"is-success",$$slots:{default:[Ai]},$$scope:{ctx:l}}}),{c(){me(e.$$.fragment)},m(n,o){_e(e,n,o),t=!0},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function Ai(l){let e,t,n;return{c(){e=f("p"),e.innerHTML="<strong>Success!</strong> Article saved to atomic server successfully.",t=g(),n=f("p"),n.textContent="The modal will close automatically..."},m(o,a){R(o,e,a),R(o,t,a),R(o,n,a)},p:Ce,d(o){o&&T(e),o&&T(t),o&&T(n)}}}function Un(l){let e,t;return e=new Bl({props:{type:"is-danger",$$slots:{default:[Ei]},$$scope:{ctx:l}}}),{c(){me(e.$$.fragment)},m(n,o){_e(e,n,o),t=!0},p(n,o){const a={};o[0]&8|o[1]&2048&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function Ei(l){let e,t,n,o;return{c(){e=f("p"),t=f("strong"),t.textContent="Error:",n=g(),o=P(l[3])},m(a,r){R(a,e,r),s(e,t),s(e,n),s(e,o)},p(a,r){r[0]&8&&ve(o,a[3])},d(a){a&&T(e)}}}function zn(l){var ne,q,le,Y;let e,t,n,o,a,r=(((ne=l[1])==null?void 0:ne.title)||"Untitled")+"",u,i,d,p,m,_,h=(((q=l[1])==null?void 0:q.rank)||0)+"",b,v,w,y,$,k,S,j,D,O,E=((le=l[1])==null?void 0:le.description)&&Hn(l),U=((Y=l[1])==null?void 0:Y.tags)&&Fn(l);function Z(H,oe){return H[10].length>0?Ii:Li}let V=Z(l),A=V(l),C=l[10].length>0&&qn(l);return{c(){e=f("div"),t=f("label"),t.textContent="Document to Save",n=g(),o=f("div"),a=f("h5"),u=P(r),i=g(),E&&E.c(),d=g(),p=f("div"),m=f("span"),_=P("Rank: "),b=P(h),v=g(),U&&U.c(),w=g(),y=f("div"),$=f("label"),$.textContent="Atomic Server",k=g(),S=f("div"),A.c(),j=g(),C&&C.c(),D=ut(),c(t,"class","label"),c(a,"class","title is-6"),c(m,"class","tag is-info svelte-48g63o"),c(p,"class","tags svelte-48g63o"),c(o,"class","box document-preview svelte-48g63o"),c(e,"class","field"),c($,"class","label"),c($,"for","atomic-server-select"),c(S,"class","control"),c(y,"class","field")},m(H,oe){R(H,e,oe),s(e,t),s(e,n),s(e,o),s(o,a),s(a,u),s(o,i),E&&E.m(o,null),s(o,d),s(o,p),s(p,m),s(m,_),s(m,b),s(p,v),U&&U.m(p,null),R(H,w,oe),R(H,y,oe),s(y,$),s(y,k),s(y,S),A.m(S,null),R(H,j,oe),C&&C.m(H,oe),R(H,D,oe),O=!0},p(H,oe){var N,z,I,L;(!O||oe[0]&2)&&r!==(r=(((N=H[1])==null?void 0:N.title)||"Untitled")+"")&&ve(u,r),(z=H[1])!=null&&z.description?E?E.p(H,oe):(E=Hn(H),E.c(),E.m(o,d)):E&&(E.d(1),E=null),(!O||oe[0]&2)&&h!==(h=(((I=H[1])==null?void 0:I.rank)||0)+"")&&ve(b,h),(L=H[1])!=null&&L.tags?U?U.p(H,oe):(U=Fn(H),U.c(),U.m(p,null)):U&&(U.d(1),U=null),V===(V=Z(H))&&A?A.p(H,oe):(A.d(1),A=V(H),A&&(A.c(),A.m(S,null))),H[10].length>0?C?(C.p(H,oe),oe[0]&1024&&M(C,1)):(C=qn(H),C.c(),M(C,1),C.m(D.parentNode,D)):C&&(Ue(),B(C,1,1,()=>{C=null}),ze())},i(H){O||(M(C),O=!0)},o(H){B(C),O=!1},d(H){H&&T(e),E&&E.d(),U&&U.d(),H&&T(w),H&&T(y),A.d(),H&&T(j),C&&C.d(H),H&&T(D)}}}function Hn(l){let e,t=l[1].description+"",n;return{c(){e=f("p"),n=P(t),c(e,"class","content")},m(o,a){R(o,e,a),s(e,n)},p(o,a){a[0]&2&&t!==(t=o[1].description+"")&&ve(n,t)},d(o){o&&T(e)}}}function Fn(l){let e,t=l[1].tags,n=[];for(let o=0;o<t.length;o+=1)n[o]=Kn(Mn(l,t,o));return{c(){for(let o=0;o<n.length;o+=1)n[o].c();e=ut()},m(o,a){for(let r=0;r<n.length;r+=1)n[r]&&n[r].m(o,a);R(o,e,a)},p(o,a){if(a[0]&2){t=o[1].tags;let r;for(r=0;r<t.length;r+=1){const u=Mn(o,t,r);n[r]?n[r].p(u,a):(n[r]=Kn(u),n[r].c(),n[r].m(e.parentNode,e))}for(;r<n.length;r+=1)n[r].d(1);n.length=t.length}},d(o){tt(n,o),o&&T(e)}}}function Kn(l){let e,t=l[39]+"",n;return{c(){e=f("span"),n=P(t),c(e,"class","tag svelte-48g63o")},m(o,a){R(o,e,a),s(e,n)},p(o,a){a[0]&2&&t!==(t=o[39]+"")&&ve(n,t)},d(o){o&&T(e)}}}function Li(l){let e,t,n,o,a,r,u,i,d;return{c(){e=f("div"),t=f("p"),t.innerHTML="<strong>No atomic servers available</strong>",n=g(),o=f("p"),a=P('Your current role "'),r=P(l[12]),u=P(`" doesn't have any writable atomic server configurations.`),i=g(),d=f("p"),d.textContent="Please configure an atomic server haystack in your role settings.",c(e,"class","notification is-warning")},m(p,m){R(p,e,m),s(e,t),s(e,n),s(e,o),s(o,a),s(o,r),s(o,u),s(e,i),s(e,d)},p(p,m){m[0]&4096&&ve(r,p[12])},d(p){p&&T(e)}}}function Ii(l){let e,t,n,o,a,r,u=l[10],i=[];for(let d=0;d<u.length;d+=1)i[d]=Gn(Pn(l,u,d));return{c(){e=f("div"),t=f("select");for(let d=0;d<i.length;d+=1)i[d].c();n=g(),o=f("p"),o.textContent=`Select the atomic server from your current role configuration.
              üîê = Authenticated, ‚ö†Ô∏è = Anonymous access`,c(t,"id","atomic-server-select"),t.disabled=l[2],l[11]===void 0&&pt(()=>l[18].call(t)),c(e,"class","select is-fullwidth"),c(o,"class","help svelte-48g63o")},m(d,p){R(d,e,p),s(e,t);for(let m=0;m<i.length;m+=1)i[m]&&i[m].m(t,null);Je(t,l[11],!0),R(d,n,p),R(d,o,p),a||(r=se(t,"change",l[18]),a=!0)},p(d,p){if(p[0]&1024){u=d[10];let m;for(m=0;m<u.length;m+=1){const _=Pn(d,u,m);i[m]?i[m].p(_,p):(i[m]=Gn(_),i[m].c(),i[m].m(t,null))}for(;m<i.length;m+=1)i[m].d(1);i.length=u.length}p[0]&4&&(t.disabled=d[2]),p[0]&3072&&Je(t,d[11])},d(d){d&&T(e),tt(i,d),d&&T(n),d&&T(o),a=!1,r()}}}function Di(l){let e;return{c(){e=f("span"),e.textContent="‚ö†Ô∏è No Auth",c(e,"class","has-text-warning")},m(t,n){R(t,e,n)},d(t){t&&T(e)}}}function Ni(l){let e;return{c(){e=f("span"),e.textContent="üîê",c(e,"class","has-text-success")},m(t,n){R(t,e,n)},d(t){t&&T(e)}}}function Gn(l){let e,t=l[36].location+"",n,o,a,r;function u(p,m){return p[36].atomic_server_secret?Ni:Di}let i=u(l),d=i(l);return{c(){e=f("option"),n=P(t),o=g(),d.c(),a=g(),e.__value=r=l[36].location,e.value=e.__value},m(p,m){R(p,e,m),s(e,n),s(e,o),d.m(e,null),s(e,a)},p(p,m){m[0]&1024&&t!==(t=p[36].location+"")&&ve(n,t),i!==(i=u(p))&&(d.d(1),d=i(p),d&&(d.c(),d.m(e,a))),m[0]&1024&&r!==(r=p[36].location)&&(e.__value=r,e.value=e.__value)},d(p){p&&T(e),d.d()}}}function qn(l){var G,te;let e,t,n,o,a,r,u,i,d,p,m,_,h,b,v,w,y,$,k,S,j,D,O,E,U,Z,V,A,C,ne,q,le,Y,H,oe,N,z,I,L,F,ee,J,X,Q=(l[8]||"Untitled")+"",re,pe,ie,ae,be,K=(((te=(G=l[1])==null?void 0:G.body)==null?void 0:te.length)||0)+"",x,ce,ge,ke,Te,Ze,Be=l[14]()+"",Ne,Pe,fe,Re,Me,Xe=l[15]()+"",xe,ye,He,Ke,qe;function Le(W){l[19](W)}let Ie={id:"article-title",placeholder:"Enter article title",disabled:l[2],required:!0};l[8]!==void 0&&(Ie.value=l[8]),a=new Vt({props:Ie}),et.push(()=>st(a,"value",Le));const it=[Pi,Oi],Oe=[];function We(W,ue){return W[7]?1:0}return Z=We(l),V=Oe[Z]=it[Z](l),q=new Kt({props:{type:"is-primary",loading:l[2],disabled:l[2]||!l[8].trim()||!l[11],$$slots:{default:[Mi]},$$scope:{ctx:l}}}),q.$on("click",l[16]),H=new Kt({props:{type:"is-light",disabled:l[2],$$slots:{default:[ji]},$$scope:{ctx:l}}}),H.$on("click",l[17]),He=or(l[22][0]),{c(){e=f("div"),t=f("label"),t.textContent="Article Title",n=g(),o=f("div"),me(a.$$.fragment),u=g(),i=f("div"),d=f("label"),d.textContent="Description",p=g(),m=f("div"),_=f("textarea"),h=g(),b=f("div"),v=f("label"),v.textContent="Parent Collection",w=g(),y=f("div"),$=f("label"),k=f("input"),S=P(`
              Use predefined collection`),j=g(),D=f("label"),O=f("input"),E=P(`
              Custom parent URL/path`),U=g(),V.c(),A=g(),C=f("div"),ne=f("div"),me(q.$$.fragment),le=g(),Y=f("div"),me(H.$$.fragment),oe=g(),N=f("div"),z=f("div"),I=f("p"),I.innerHTML="<strong>What will be saved:</strong>",L=g(),F=f("ul"),ee=f("li"),J=f("strong"),J.textContent="Title:",X=g(),re=P(Q),pe=g(),ie=f("li"),ae=f("strong"),ae.textContent="Body:",be=P(" Original document content ("),x=P(K),ce=P(" characters)"),ge=g(),ke=f("li"),Te=f("strong"),Te.textContent="Parent:",Ze=g(),Ne=P(Be),Pe=g(),fe=f("li"),Re=f("strong"),Re.textContent="Subject URL:",Me=g(),xe=P(Xe),c(t,"class","label"),c(t,"for","article-title"),c(o,"class","control"),c(e,"class","field"),c(d,"class","label"),c(d,"for","article-description"),c(_,"id","article-description"),c(_,"class","textarea"),c(_,"placeholder","Brief description of the article"),_.disabled=l[2],c(_,"rows","3"),c(m,"class","control"),c(i,"class","field"),c(v,"class","label"),c(k,"type","radio"),k.__value=!1,k.value=k.__value,k.disabled=l[2],c($,"class","radio svelte-48g63o"),c(O,"type","radio"),O.__value=!0,O.value=O.__value,O.disabled=l[2],c(D,"class","radio svelte-48g63o"),c(y,"class","control"),c(b,"class","field"),c(ne,"class","control"),c(Y,"class","control"),c(C,"class","field is-grouped"),c(ee,"class","svelte-48g63o"),c(ie,"class","svelte-48g63o"),c(ke,"class","svelte-48g63o"),c(fe,"class","svelte-48g63o"),c(F,"class","svelte-48g63o"),c(z,"class","notification is-info is-light svelte-48g63o"),c(N,"class","field"),He.p(k,O)},m(W,ue){R(W,e,ue),s(e,t),s(e,n),s(e,o),_e(a,o,null),R(W,u,ue),R(W,i,ue),s(i,d),s(i,p),s(i,m),s(m,_),De(_,l[9]),R(W,h,ue),R(W,b,ue),s(b,v),s(b,w),s(b,y),s(y,$),s($,k),k.checked=k.__value===l[7],s($,S),s(y,j),s(y,D),s(D,O),O.checked=O.__value===l[7],s(D,E),R(W,U,ue),Oe[Z].m(W,ue),R(W,A,ue),R(W,C,ue),s(C,ne),_e(q,ne,null),s(C,le),s(C,Y),_e(H,Y,null),R(W,oe,ue),R(W,N,ue),s(N,z),s(z,I),s(z,L),s(z,F),s(F,ee),s(ee,J),s(ee,X),s(ee,re),s(F,pe),s(F,ie),s(ie,ae),s(ie,be),s(ie,x),s(ie,ce),s(F,ge),s(F,ke),s(ke,Te),s(ke,Ze),s(ke,Ne),s(F,Pe),s(F,fe),s(fe,Re),s(fe,Me),s(fe,xe),ye=!0,Ke||(qe=[se(_,"input",l[20]),se(k,"change",l[21]),se(O,"change",l[23])],Ke=!0)},p(W,ue){var de,Ae;const Se={};ue[0]&4&&(Se.disabled=W[2]),!r&&ue[0]&256&&(r=!0,Se.value=W[8],rt(()=>r=!1)),a.$set(Se),(!ye||ue[0]&4)&&(_.disabled=W[2]),ue[0]&512&&De(_,W[9]),(!ye||ue[0]&4)&&(k.disabled=W[2]),ue[0]&128&&(k.checked=k.__value===W[7]),(!ye||ue[0]&4)&&(O.disabled=W[2]),ue[0]&128&&(O.checked=O.__value===W[7]);let $e=Z;Z=We(W),Z===$e?Oe[Z].p(W,ue):(Ue(),B(Oe[$e],1,1,()=>{Oe[$e]=null}),ze(),V=Oe[Z],V?V.p(W,ue):(V=Oe[Z]=it[Z](W),V.c()),M(V,1),V.m(A.parentNode,A));const Ve={};ue[0]&4&&(Ve.loading=W[2]),ue[0]&2308&&(Ve.disabled=W[2]||!W[8].trim()||!W[11]),ue[1]&2048&&(Ve.$$scope={dirty:ue,ctx:W}),q.$set(Ve);const nt={};ue[0]&4&&(nt.disabled=W[2]),ue[1]&2048&&(nt.$$scope={dirty:ue,ctx:W}),H.$set(nt),(!ye||ue[0]&256)&&Q!==(Q=(W[8]||"Untitled")+"")&&ve(re,Q),(!ye||ue[0]&2)&&K!==(K=(((Ae=(de=W[1])==null?void 0:de.body)==null?void 0:Ae.length)||0)+"")&&ve(x,K)},i(W){ye||(M(a.$$.fragment,W),M(V),M(q.$$.fragment,W),M(H.$$.fragment,W),ye=!0)},o(W){B(a.$$.fragment,W),B(V),B(q.$$.fragment,W),B(H.$$.fragment,W),ye=!1},d(W){W&&T(e),he(a),W&&T(u),W&&T(i),W&&T(h),W&&T(b),W&&T(U),Oe[Z].d(W),W&&T(A),W&&T(C),he(q),he(H),W&&T(oe),W&&T(N),He.r(),Ke=!1,lt(qe)}}}function Oi(l){let e,t,n,o,a,r,u;function i(p){l[25](p)}let d={placeholder:"e.g., my-collection or http://server/custom-parent",disabled:l[2]};return l[6]!==void 0&&(d.value=l[6]),n=new Vt({props:d}),et.push(()=>st(n,"value",i)),{c(){e=f("div"),t=f("div"),me(n.$$.fragment),a=g(),r=f("p"),r.textContent=`Enter a collection name (e.g., "my-articles") or full URL.
              If the collection doesn't exist, it will be created.`,c(t,"class","control"),c(r,"class","help svelte-48g63o"),c(e,"class","field")},m(p,m){R(p,e,m),s(e,t),_e(n,t,null),s(e,a),s(e,r),u=!0},p(p,m){const _={};m[0]&4&&(_.disabled=p[2]),!o&&m[0]&64&&(o=!0,_.value=p[6],rt(()=>o=!1)),n.$set(_)},i(p){u||(M(n.$$.fragment,p),u=!0)},o(p){B(n.$$.fragment,p),u=!1},d(p){p&&T(e),he(n)}}}function Pi(l){let e,t,n,o,a,r,u=l[13],i=[];for(let d=0;d<u.length;d+=1)i[d]=Wn(On(l,u,d));return{c(){e=f("div"),t=f("div"),n=f("div"),o=f("select");for(let d=0;d<i.length;d+=1)i[d].c();o.disabled=l[2],l[5]===void 0&&pt(()=>l[24].call(o)),c(n,"class","select is-fullwidth"),c(t,"class","control"),c(e,"class","field")},m(d,p){R(d,e,p),s(e,t),s(t,n),s(n,o);for(let m=0;m<i.length;m+=1)i[m]&&i[m].m(o,null);Je(o,l[5],!0),a||(r=se(o,"change",l[24]),a=!0)},p(d,p){if(p[0]&8192){u=d[13];let m;for(m=0;m<u.length;m+=1){const _=On(d,u,m);i[m]?i[m].p(_,p):(i[m]=Wn(_),i[m].c(),i[m].m(o,null))}for(;m<i.length;m+=1)i[m].d(1);i.length=u.length}p[0]&4&&(o.disabled=d[2]),p[0]&8224&&Je(o,d[5])},i:Ce,o:Ce,d(d){d&&T(e),tt(i,d),a=!1,r()}}}function Wn(l){let e,t=l[33].label+"",n;return{c(){e=f("option"),n=P(t),e.__value=l[33].value,e.value=e.__value},m(o,a){R(o,e,a),s(e,n)},p:Ce,d(o){o&&T(e)}}}function Mi(l){let e,t,n;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-cloud-upload-alt"></i>',t=g(),n=f("span"),n.textContent="Save to Atomic Server",c(e,"class","icon")},m(o,a){R(o,e,a),R(o,t,a),R(o,n,a)},p:Ce,d(o){o&&T(e),o&&T(t),o&&T(n)}}}function ji(l){let e;return{c(){e=P("Cancel")},m(t,n){R(t,e,n)},d(t){t&&T(e)}}}function Ui(l){let e,t,n,o,a,r,u,i,d,p,m,_,h,b=l[4]&&jn(l),v=l[3]&&Un(l),w=!l[4]&&zn(l);return{c(){e=f("div"),t=f("div"),n=f("div"),n.innerHTML=`<div class="level-item"><h3 class="title is-4"><span class="icon"><i class="fas fa-save"></i></span>
            Save to Atomic Server</h3></div>`,o=g(),a=f("div"),r=f("div"),u=f("button"),i=g(),b&&b.c(),d=g(),v&&v.c(),p=g(),w&&w.c(),c(n,"class","level-left"),c(u,"class","delete is-large"),u.disabled=l[2],c(u,"aria-label","close"),c(r,"class","level-item"),c(a,"class","level-right"),c(t,"class","level svelte-48g63o"),c(e,"class","box")},m(y,$){R(y,e,$),s(e,t),s(t,n),s(t,o),s(t,a),s(a,r),s(r,u),s(e,i),b&&b.m(e,null),s(e,d),v&&v.m(e,null),s(e,p),w&&w.m(e,null),m=!0,_||(h=se(u,"click",l[17]),_=!0)},p(y,$){(!m||$[0]&4)&&(u.disabled=y[2]),y[4]?b?$[0]&16&&M(b,1):(b=jn(y),b.c(),M(b,1),b.m(e,d)):b&&(Ue(),B(b,1,1,()=>{b=null}),ze()),y[3]?v?(v.p(y,$),$[0]&8&&M(v,1)):(v=Un(y),v.c(),M(v,1),v.m(e,p)):v&&(Ue(),B(v,1,1,()=>{v=null}),ze()),y[4]?w&&(Ue(),B(w,1,1,()=>{w=null}),ze()):w?(w.p(y,$),$[0]&16&&M(w,1)):(w=zn(y),w.c(),M(w,1),w.m(e,null))},i(y){m||(M(b),M(v),M(w),m=!0)},o(y){B(b),B(v),B(w),m=!1},d(y){y&&T(e),b&&b.d(),v&&v.d(),w&&w.d(),_=!1,h()}}}function zi(l){let e,t,n;function o(r){l[26](r)}let a={$$slots:{default:[Ui]},$$scope:{ctx:l}};return l[0]!==void 0&&(a.active=l[0]),e=new kl({props:a}),et.push(()=>st(e,"active",o)),e.$on("close",l[17]),{c(){me(e.$$.fragment)},m(r,u){_e(e,r,u),n=!0},p(r,u){const i={};u[0]&8190|u[1]&2048&&(i.$$scope={dirty:u,ctx:r}),!t&&u[0]&1&&(t=!0,i.active=r[0],rt(()=>t=!1)),e.$set(i)},i(r){n||(M(e.$$.fragment,r),n=!0)},o(r){B(e.$$.fragment,r),n=!1},d(r){he(e,r)}}}function Hi(l,e,t){let n,o,a;je(l,ct,N=>t(27,n=N)),je(l,Lt,N=>t(28,o=N)),je(l,At,N=>t(12,a=N));let{active:r=!1}=e,{document:u}=e,i=!1,d=null,p=!1,m="",_="",h=!1,b="",v="",w=[],y="";const $=[{label:"Root (Server Root)",value:""},{label:"Articles Collection",value:"articles"},{label:"Documents Collection",value:"documents"},{label:"Knowledge Base",value:"knowledge-base"},{label:"Research",value:"research"},{label:"Projects",value:"projects"}];function k(){t(2,i=!1),t(3,d=null),t(4,p=!1),t(5,m=""),t(6,_=""),t(7,h=!1),t(8,b=(u==null?void 0:u.title)||""),t(9,v=(u==null?void 0:u.description)||`Article saved from Terraphim search: ${u==null?void 0:u.title}`),t(10,w=[]),t(11,y="")}function S(){var L;const N=a,z=o;if(!(z!=null&&z.roles)||!N){console.warn("No role configuration found");return}let I=null;try{for(const[F,ee]of Object.entries(z.roles)){const J=ee,X=typeof J.name=="object"?J.name.original:String(J.name);if(F===N||X===N){I=J;break}}}catch(F){console.warn("Error checking role configuration:",F);return}if(!I){console.warn(`Role "${N}" not found in configuration`);return}t(10,w=((L=I.haystacks)==null?void 0:L.filter(F=>F.service==="Atomic"&&F.location&&!F.read_only))||[]),w.length>0&&t(11,y=w[0].location),console.log("Loaded atomic servers:",w)}function j(){const N=w.find(z=>z.location===y);return N==null?void 0:N.atomic_server_secret}function D(){const N=y.replace(/\/$/,"");if(h&&_.trim()){const z=_.trim();return z.startsWith("http://")||z.startsWith("https://")?z:`${N}/${z.replace(/^\//,"")}`}else return m?`${N}/${m}`:N}function O(){return b.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,50)}function E(){const N=y.replace(/\/$/,""),z=O(),I=Date.now();return`${N}/${z}-${I}`}async function U(){if(!y||!b.trim()){t(3,d="Please select an atomic server and provide a title");return}t(2,i=!0),t(3,d=null);try{const N=E(),z=D(),I=j();console.log("üîÑ Saving article to atomic server:",{subject:N,parent:z,server:y,hasSecret:!!I});const L={subject:N,title:b.trim(),description:v.trim(),body:u.body,parent:z,shortname:O(),original_id:u.id,original_url:u.url,original_rank:u.rank,tags:u.tags||[]};if(n)await Ge("save_article_to_atomic",{article:L,serverUrl:y,atomicSecret:I});else{const F=await fetch(`${Ye.ServerURL}/atomic/save`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({article:L,server_url:y,atomic_secret:I})});if(!F.ok){const ee=await F.json().catch(()=>({error:F.statusText}));throw new Error(ee.error||`HTTP ${F.status}: ${F.statusText}`)}}t(4,p=!0),console.log("‚úÖ Article saved successfully to atomic server"),setTimeout(()=>{t(0,r=!1)},2e3)}catch(N){console.error("‚ùå Failed to save article to atomic server:",N),t(3,d=N.message||"Failed to save article to atomic server")}finally{t(2,i=!1)}}function Z(){i||t(0,r=!1)}const V=[[]];function A(){y=St(this),t(11,y),t(10,w)}function C(N){b=N,t(8,b)}function ne(){v=this.value,t(9,v)}function q(){h=this.__value,t(7,h)}function le(){h=this.__value,t(7,h)}function Y(){m=St(this),t(5,m),t(13,$)}function H(N){_=N,t(6,_)}function oe(N){r=N,t(0,r)}return l.$$set=N=>{"active"in N&&t(0,r=N.active),"document"in N&&t(1,u=N.document)},l.$$.update=()=>{l.$$.dirty[0]&3&&r&&u&&(k(),S())},[r,u,i,d,p,m,_,h,b,v,w,y,a,$,D,E,U,Z,A,C,ne,q,V,le,Y,H,oe]}class Fi extends mt{constructor(e){super(),_t(this,e,Hi,zi,dt,{active:0,document:1},null,[-1,-1])}}async function Zl(l){return Ge("tauri",l)}async function Ki(l,e){return Zl({__tauriModule:"Event",message:{cmd:"unlisten",event:l,eventId:e}})}async function Gi(l,e,t){return Zl({__tauriModule:"Event",message:{cmd:"listen",event:l,windowLabel:e,handler:Gl(t)}}).then(n=>async()=>Ki(l,n))}var Bn;(function(l){l.WINDOW_RESIZED="tauri://resize",l.WINDOW_MOVED="tauri://move",l.WINDOW_CLOSE_REQUESTED="tauri://close-requested",l.WINDOW_CREATED="tauri://window-created",l.WINDOW_DESTROYED="tauri://destroyed",l.WINDOW_FOCUS="tauri://focus",l.WINDOW_BLUR="tauri://blur",l.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",l.WINDOW_THEME_CHANGED="tauri://theme-changed",l.WINDOW_FILE_DROP="tauri://file-drop",l.WINDOW_FILE_DROP_HOVER="tauri://file-drop-hover",l.WINDOW_FILE_DROP_CANCELLED="tauri://file-drop-cancelled",l.MENU="tauri://menu",l.CHECK_UPDATE="tauri://update",l.UPDATE_AVAILABLE="tauri://update-available",l.INSTALL_UPDATE="tauri://update-install",l.STATUS_UPDATE="tauri://update-status",l.DOWNLOAD_PROGRESS="tauri://update-download-progress"})(Bn||(Bn={}));async function qi(l,e){return Gi(l,null,e)}function Jn(l,e,t){const n=l.slice();return n[9]=e[t],n}function Vn(l){let e,t=l[9].name+"",n,o;return{c(){e=f("option"),n=P(t),e.__value=o=l[9].name,e.value=e.__value},m(a,r){R(a,e,r),s(e,n)},p(a,r){r&1&&t!==(t=a[9].name+"")&&ve(n,t),r&1&&o!==(o=a[9].name)&&(e.__value=o,e.value=e.__value)},d(a){a&&T(e)}}}function Wi(l){let e,t,n,o,a,r,u=l[0],i=[];for(let d=0;d<u.length;d+=1)i[d]=Vn(Jn(l,u,d));return{c(){e=f("div"),t=f("div"),n=f("div"),o=f("select");for(let d=0;d<i.length;d+=1)i[d].c();c(n,"class","select"),c(t,"class","control"),c(e,"class","field is-grouped is-grouped-right")},m(d,p){R(d,e,p),s(e,t),s(t,n),s(n,o);for(let m=0;m<i.length;m+=1)i[m]&&i[m].m(o,null);Je(o,l[1]),a||(r=se(o,"change",l[2]),a=!0)},p(d,[p]){if(p&1){u=d[0];let m;for(m=0;m<u.length;m+=1){const _=Jn(d,u,m);i[m]?i[m].p(_,p):(i[m]=Vn(_),i[m].c(),i[m].m(o,null))}for(;m<i.length;m+=1)i[m].d(1);i.length=u.length}p&3&&Je(o,d[1])},i:Ce,o:Ce,d(d){d&&T(e),tt(i,d),a=!1,r()}}}function Bi(l,e,t){let n,o,a,r;je(l,Lt,_=>t(5,n=_)),je(l,ct,_=>t(6,o=_)),je(l,$n,_=>t(0,a=_)),je(l,At,_=>t(1,r=_));let u="";async function i(){try{ct.set(window.__TAURI__!==void 0),o?(console.log("Loading config from Tauri"),Ge("get_config").then(_=>{console.log("get_config response",_),_&&_.status==="success"&&d(_.config)}).catch(_=>console.error("Error fetching config in Tauri:",_))):(console.log("Loading config from server"),u=`${Ye.ServerURL}/config/`,fetch(u).then(_=>_.json()).then(_=>{console.log("Config received",_),_&&_.status==="success"&&d(_.config)}).catch(_=>console.error("Error fetching config:",_)))}catch(_){console.error("Unhandled error in loadConfig:",_)}}function d(_){var w;console.log("Updating stores from config:",_);const h={default_role:_.selected_role,..._};Lt.set(h);const b=Object.entries(_.roles).map(([y,$])=>({name:y,...$}));$n.set(b),At.set(_.selected_role);const v=_.roles[_.selected_role];if(console.log("Selected role settings:",v),v){const y=v.theme||"spacelab";console.log("Setting theme to:",y),bl.set(y),(w=v.kg)!=null&&w.publish?o?Ge("publish_thesaurus",{roleName:_.selected_role}).then($=>{console.log("publish_thesaurus response",$),vl.set($),Tt.set(!0)}).catch($=>{console.error("Error publishing thesaurus:",$),Tt.set(!1)}):(console.log("Fetching thesaurus from HTTP endpoint for role",_.selected_role),fetch(`${Ye.ServerURL}/thesaurus/${encodeURIComponent(_.selected_role)}`).then($=>$.json()).then($=>{console.log("thesaurus HTTP response",$),$&&$.status==="success"&&$.thesaurus?(vl.set($.thesaurus),Tt.set(!0)):(console.error("Failed to fetch thesaurus:",$),Tt.set(!1))}).catch($=>{console.error("Error fetching thesaurus:",$),Tt.set(!1)})):Tt.set(!1)}else console.warn("No role settings found for:",_.selected_role),bl.set("spacelab")}typeof window<"u"&&window.__TAURI__&&qi("role_changed",_=>{console.log("Role changed event received from backend:",_.payload),d(_.payload)});async function p(){await i()}p(),console.log("Using Terraphim Server URL:",Ye.ServerURL);function m(_){var y,$;const b=_.currentTarget.value;console.log("Role change requested:",b),At.set(b);const v=a.find(k=>k.name===b);if(!v){console.error(`No role settings found for role: ${b}.`);return}const w=v.theme||"spacelab";bl.set(w),console.log(`Theme changed to ${w}`),Lt.update(k=>(k.selected_role=b,k)),o?(Ge("select_role",{roleName:b}).catch(k=>console.error("Error selecting role:",k)),(y=v.kg)!=null&&y.publish?(console.log("Publishing thesaurus for role",b),Ge("publish_thesaurus",{roleName:b}).then(k=>{vl.set(k),Tt.set(!0)})):Tt.set(!1)):(fetch(`${Ye.ServerURL}/config/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).catch(k=>console.error("Error updating config on server:",k)),($=v.kg)!=null&&$.publish?(console.log("Fetching thesaurus from HTTP endpoint for role",b),fetch(`${Ye.ServerURL}/thesaurus/${encodeURIComponent(b)}`).then(k=>k.json()).then(k=>{console.log("thesaurus HTTP response",k),k&&k.status==="success"&&k.thesaurus?(vl.set(k.thesaurus),Tt.set(!0)):(console.error("Failed to fetch thesaurus:",k),Tt.set(!1))}).catch(k=>{console.error("Error fetching thesaurus:",k),Tt.set(!1)})):Tt.set(!1))}return[a,r,m,i]}class Ml extends mt{constructor(e){super(),_t(this,e,Bi,Wi,dt,{loadConfig:3})}get loadConfig(){return this.$$.ctx[3]}}function Qn(l,e,t){const n=l.slice();return n[41]=e[t],n}function Yn(l,e,t){const n=l.slice();return n[44]=e[t],n}function Zn(l){let e,t;return e=new Jl({props:{$$slots:{default:[Vi]},$$scope:{ctx:l}}}),{c(){me(e.$$.fragment)},m(n,o){_e(e,n,o),t=!0},p(n,o){const a={};o[0]&129|o[1]&65536&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function Ji(l){let e=l[44]+"",t;return{c(){t=P(e)},m(n,o){R(n,t,o)},p(n,o){o[0]&1&&e!==(e=n[44]+"")&&ve(t,e)},d(n){n&&T(t)}}}function Xn(l){let e,t,n,o,a,r;t=new Gt({props:{rounded:!0,$$slots:{default:[Ji]},$$scope:{ctx:l}}});function u(){return l[19](l[44])}return{c(){e=f("button"),me(t.$$.fragment),n=g(),c(e,"class","tag-button svelte-2smypa"),e.disabled=l[7],c(e,"title","Click to view knowledge graph document")},m(i,d){R(i,e,d),_e(t,e,null),s(e,n),o=!0,a||(r=se(e,"click",u),a=!0)},p(i,d){l=i;const p={};d[0]&1|d[1]&65536&&(p.$$scope={dirty:d,ctx:l}),t.$set(p),(!o||d[0]&128)&&(e.disabled=l[7])},i(i){o||(M(t.$$.fragment,i),o=!0)},o(i){B(t.$$.fragment,i),o=!1},d(i){i&&T(e),he(t),a=!1,r()}}}function Vi(l){let e,t,n=l[0].tags,o=[];for(let r=0;r<n.length;r+=1)o[r]=Xn(Yn(l,n,r));const a=r=>B(o[r],1,1,()=>{o[r]=null});return{c(){for(let r=0;r<o.length;r+=1)o[r].c();e=ut()},m(r,u){for(let i=0;i<o.length;i+=1)o[i]&&o[i].m(r,u);R(r,e,u),t=!0},p(r,u){if(u[0]&131201){n=r[0].tags;let i;for(i=0;i<n.length;i+=1){const d=Yn(r,n,i);o[i]?(o[i].p(d,u),M(o[i],1)):(o[i]=Xn(d),o[i].c(),M(o[i],1),o[i].m(e.parentNode,e))}for(Ue(),i=n.length;i<o.length;i+=1)a(i);ze()}},i(r){if(!t){for(let u=0;u<n.length;u+=1)M(o[u]);t=!0}},o(r){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)B(o[u]);t=!1},d(r){tt(o,r),r&&T(e)}}}function Qi(l){let e,t=(l[0].rank||0)+"",n;return{c(){e=P("Rank "),n=P(t)},m(o,a){R(o,e,a),R(o,n,a)},p(o,a){a[0]&1&&t!==(t=(o[0].rank||0)+"")&&ve(n,t)},d(o){o&&T(e),o&&T(n)}}}function Yi(l){let e,t;return e=new Gt({props:{rounded:!0,$$slots:{default:[Qi]},$$scope:{ctx:l}}}),{c(){me(e.$$.fragment)},m(n,o){_e(e,n,o),t=!0},p(n,o){const a={};o[0]&1|o[1]&65536&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function Zi(l){let e;return{c(){e=f("small"),e.textContent="No description available",c(e,"class","no-description svelte-2smypa")},m(t,n){R(t,e,n)},p:Ce,i:Ce,o:Ce,d(t){t&&T(e)}}}function Xi(l){let e,t;return e=new Ul({props:{source:l[0].description}}),{c(){me(e.$$.fragment)},m(n,o){_e(e,n,o),t=!0},p(n,o){const a={};o[0]&1&&(a.source=n[0].description),e.$set(a)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function xn(l){let e,t,n,o,a,r;return{c(){e=f("button"),t=f("span"),t.innerHTML='<i class="fas fa-magic" aria-hidden="true"></i>',n=g(),o=f("span"),o.textContent="AI Summary",c(t,"class","icon is-small"),c(e,"class","button is-small is-info is-outlined ai-summary-button svelte-2smypa"),e.disabled=l[9],c(e,"title","Generate AI-powered summary using OpenRouter")},m(u,i){R(u,e,i),s(e,t),s(e,n),s(e,o),a||(r=se(e,"click",l[18]),a=!0)},p(u,i){i[0]&512&&(e.disabled=u[9])},d(u){u&&T(e),a=!1,r()}}}function eo(l){let e;return{c(){e=f("div"),e.innerHTML=`<span class="icon"><i class="fas fa-spinner fa-spin" aria-hidden="true"></i></span> 
                <small>Generating AI summary...</small>`,c(e,"class","ai-summary-loading svelte-2smypa")},m(t,n){R(t,e,n)},d(t){t&&T(e)}}}function to(l){let e,t,n,o,a,r,u,i,d,p;return{c(){e=f("div"),t=f("span"),t.innerHTML='<i class="fas fa-exclamation-triangle" aria-hidden="true"></i>',n=g(),o=f("small"),a=P("Summary error: "),r=P(l[10]),u=g(),i=f("button"),i.textContent="Retry",c(t,"class","icon has-text-danger"),c(o,"class","has-text-danger"),c(i,"class","button is-small is-text svelte-2smypa"),c(i,"title","Retry generating summary"),c(e,"class","ai-summary-error svelte-2smypa")},m(m,_){R(m,e,_),s(e,t),s(e,n),s(e,o),s(o,a),s(o,r),s(e,u),s(e,i),d||(p=se(i,"click",l[20]),d=!0)},p(m,_){_[0]&1024&&ve(r,m[10])},d(m){m&&T(e),d=!1,p()}}}function lo(l){let e,t,n,o,a,r,u,i,d,p,m,_,h,b,v,w,y,$,k,S;function j(E,U){return E[12]?ea:xi}let D=j(l),O=D(l);return p=new Ul({props:{source:l[8]}}),{c(){e=f("div"),t=f("div"),n=f("small"),o=f("span"),o.innerHTML='<i class="fas fa-robot" aria-hidden="true"></i>',a=P(`
                    AI Summary
                    `),O.c(),r=g(),u=f("button"),u.innerHTML='<span class="icon is-small"><i class="fas fa-times" aria-hidden="true"></i></span>',i=g(),d=f("div"),me(p.$$.fragment),m=g(),_=f("div"),h=f("button"),b=f("span"),b.innerHTML='<i class="fas fa-redo" aria-hidden="true"></i>',v=g(),w=f("span"),w.textContent="Regenerate",c(o,"class","icon is-small"),c(n,"class","ai-summary-label svelte-2smypa"),c(u,"class","button is-small is-text svelte-2smypa"),c(u,"title","Hide AI summary"),c(t,"class","ai-summary-header svelte-2smypa"),c(d,"class","ai-summary-content svelte-2smypa"),c(b,"class","icon is-small"),c(h,"class","button is-small is-text svelte-2smypa"),h.disabled=l[9],c(h,"title","Regenerate summary"),c(_,"class","ai-summary-actions svelte-2smypa"),c(e,"class","ai-summary svelte-2smypa")},m(E,U){R(E,e,U),s(e,t),s(t,n),s(n,o),s(n,a),O.m(n,null),s(t,r),s(t,u),s(e,i),s(e,d),_e(p,d,null),s(e,m),s(e,_),s(_,h),s(h,b),s(h,v),s(h,w),$=!0,k||(S=[se(u,"click",l[21]),se(h,"click",l[22])],k=!0)},p(E,U){D!==(D=j(E))&&(O.d(1),O=D(E),O&&(O.c(),O.m(n,null)));const Z={};U[0]&256&&(Z.source=E[8]),p.$set(Z),(!$||U[0]&512)&&(h.disabled=E[9])},i(E){$||(M(p.$$.fragment,E),pt(()=>{$&&(y||(y=pl(e,ml,{},!0)),y.run(1))}),$=!0)},o(E){B(p.$$.fragment,E),y||(y=pl(e,ml,{},!1)),y.run(0),$=!1},d(E){E&&T(e),O.d(),he(p),E&&y&&y.end(),k=!1,lt(S)}}}function xi(l){let e;return{c(){e=f("span"),e.textContent="fresh",c(e,"class","tag is-small is-success")},m(t,n){R(t,e,n)},d(t){t&&T(e)}}}function ea(l){let e;return{c(){e=f("span"),e.textContent="cached",c(e,"class","tag is-small is-light")},m(t,n){R(t,e,n)},d(t){t&&T(e)}}}function no(l){let e;function t(a,r){return a[41].disabled?na:a[41].isLink?la:ta}let n=t(l),o=n(l);return{c(){o.c(),e=ut()},m(a,r){o.m(a,r),R(a,e,r)},p(a,r){n===(n=t(a))&&o?o.p(a,r):(o.d(1),o=n(a),o&&(o.c(),o.m(e.parentNode,e)))},d(a){o.d(a),a&&T(e)}}}function ta(l){let e,t,n,o,a,r,u,i,d,p;return{c(){var m,_,h;e=f("button"),t=f("span"),n=f("i"),a=g(),c(n,"class",o=Pt(l[41].icon)+" svelte-2smypa"),c(t,"class","icon is-medium"),ht(t,"has-text-primary",(m=l[41].className)==null?void 0:m.includes("primary")),ht(t,"has-text-success",(_=l[41].className)==null?void 0:_.includes("success")),ht(t,"has-text-danger",(h=l[41].className)==null?void 0:h.includes("danger")),c(e,"type","button"),c(e,"class","level-item button is-ghost svelte-2smypa"),c(e,"aria-label",r=l[41].title),c(e,"title",u=l[41].title),c(e,"data-testid",i=l[41].testId||"")},m(m,_){R(m,e,_),s(e,t),s(t,n),s(e,a),d||(p=se(e,"click",function(){Vl(l[41].action)&&l[41].action.apply(this,arguments)}),d=!0)},p(m,_){var h,b,v;l=m,_[0]&32768&&o!==(o=Pt(l[41].icon)+" svelte-2smypa")&&c(n,"class",o),_[0]&32768&&ht(t,"has-text-primary",(h=l[41].className)==null?void 0:h.includes("primary")),_[0]&32768&&ht(t,"has-text-success",(b=l[41].className)==null?void 0:b.includes("success")),_[0]&32768&&ht(t,"has-text-danger",(v=l[41].className)==null?void 0:v.includes("danger")),_[0]&32768&&r!==(r=l[41].title)&&c(e,"aria-label",r),_[0]&32768&&u!==(u=l[41].title)&&c(e,"title",u),_[0]&32768&&i!==(i=l[41].testId||"")&&c(e,"data-testid",i)},d(m){m&&T(e),d=!1,p()}}}function la(l){let e,t,n,o,a,r,u,i;return{c(){e=f("a"),t=f("span"),n=f("i"),a=g(),c(n,"class",o=Pt(l[41].icon)+" svelte-2smypa"),c(t,"class","icon is-medium"),ht(t,"has-text-primary",l[41].className),c(e,"href",r=l[41].href),c(e,"target","_blank"),c(e,"class","level-item"),c(e,"aria-label",u=l[41].title),c(e,"title",i=l[41].title)},m(d,p){R(d,e,p),s(e,t),s(t,n),s(e,a)},p(d,p){p[0]&32768&&o!==(o=Pt(d[41].icon)+" svelte-2smypa")&&c(n,"class",o),p[0]&32768&&ht(t,"has-text-primary",d[41].className),p[0]&32768&&r!==(r=d[41].href)&&c(e,"href",r),p[0]&32768&&u!==(u=d[41].title)&&c(e,"aria-label",u),p[0]&32768&&i!==(i=d[41].title)&&c(e,"title",i)},d(d){d&&T(e)}}}function na(l){let e,t,n,o,a,r,u;return{c(){e=f("button"),t=f("span"),n=f("i"),a=g(),c(n,"class",o=Pt(l[41].icon)+" svelte-2smypa"),c(t,"class","icon is-medium"),ht(t,"has-text-primary",l[41].className),c(e,"type","button"),c(e,"class","level-item button is-ghost svelte-2smypa"),c(e,"aria-label",r=l[41].title),c(e,"title",u=l[41].title),e.disabled=!0},m(i,d){R(i,e,d),s(e,t),s(t,n),s(e,a)},p(i,d){d[0]&32768&&o!==(o=Pt(i[41].icon)+" svelte-2smypa")&&c(n,"class",o),d[0]&32768&&ht(t,"has-text-primary",i[41].className),d[0]&32768&&r!==(r=i[41].title)&&c(e,"aria-label",r),d[0]&32768&&u!==(u=i[41].title)&&c(e,"title",u)},d(i){i&&T(e)}}}function oo(l){let e,t=l[41].visible&&no(l);return{c(){t&&t.c(),e=ut()},m(n,o){t&&t.m(n,o),R(n,e,o)},p(n,o){n[41].visible?t?t.p(n,o):(t=no(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(n){t&&t.d(n),n&&T(e)}}}function so(l){let e,t,n,o,a,r;return{c(){e=f("div"),t=f("button"),n=g(),o=P(l[13]),c(t,"class","delete svelte-2smypa"),c(e,"class","notification is-danger is-light mt-2")},m(u,i){R(u,e,i),s(e,t),s(e,n),s(e,o),a||(r=se(t,"click",l[23]),a=!0)},p(u,i){i[0]&8192&&ve(o,u[13])},d(u){u&&T(e),a=!1,r()}}}function ro(l){let e,t,n;function o(r){l[25](r)}let a={item:l[4],kgTerm:l[5],kgRank:l[6]};return l[2]!==void 0&&(a.active=l[2]),e=new Yl({props:a}),et.push(()=>st(e,"active",o)),{c(){me(e.$$.fragment)},m(r,u){_e(e,r,u),n=!0},p(r,u){const i={};u[0]&16&&(i.item=r[4]),u[0]&32&&(i.kgTerm=r[5]),u[0]&64&&(i.kgRank=r[6]),!t&&u[0]&4&&(t=!0,i.active=r[2],rt(()=>t=!1)),e.$set(i)},i(r){n||(M(e.$$.fragment,r),n=!0)},o(r){B(e.$$.fragment,r),n=!1},d(r){he(e,r)}}}function io(l){let e,t,n;function o(r){l[26](r)}let a={document:l[0]};return l[3]!==void 0&&(a.active=l[3]),e=new Fi({props:a}),et.push(()=>st(e,"active",o)),{c(){me(e.$$.fragment)},m(r,u){_e(e,r,u),n=!0},p(r,u){const i={};u[0]&1&&(i.document=r[0]),!t&&u[0]&8&&(t=!0,i.active=r[3],rt(()=>t=!1)),e.$set(i)},i(r){n||(M(e.$$.fragment,r),n=!0)},o(r){B(e.$$.fragment,r),n=!1},d(r){he(e,r)}}}function oa(l){let e,t,n,o,a,r,u,i,d,p,m,_,h=l[0].title+"",b,v,w,y,$,k,S,j,D,O,E,U,Z,V,A,C,ne,q,le,Y,H,oe,N,z,I,L,F,ee,J,X,Q,re=l[0].tags&&Zn(l);i=new Jl({props:{$$slots:{default:[Yi]},$$scope:{ctx:l}}});const pe=[Xi,Zi],ie=[];function ae(fe,Re){return fe[0].description?0:1}S=ae(l),j=ie[S]=pe[S](l);let be=!l[11]&&!l[9]&&!l[10]&&xn(l),K=l[9]&&eo(),x=l[10]&&to(l),ce=l[11]&&l[8]&&lo(l),ge=l[15],ke=[];for(let fe=0;fe<ge.length;fe+=1)ke[fe]=oo(Qn(l,ge,fe));let Te=l[13]&&so(l);function Ze(fe){l[24](fe)}let Be={item:l[0]};l[1]!==void 0&&(Be.active=l[1]),z=new Yl({props:Be}),et.push(()=>st(z,"active",Ze));let Ne=l[4]&&ro(l),Pe=l[14]&&io(l);return{c(){e=f("div"),t=f("article"),n=f("div"),o=f("div"),a=f("div"),re&&re.c(),r=g(),u=f("div"),me(i.$$.fragment),d=g(),p=f("div"),m=f("button"),_=f("h2"),b=P(h),v=g(),w=f("div"),y=f("small"),y.textContent="Description:",$=g(),k=f("div"),j.c(),D=g(),O=f("div"),be&&be.c(),E=g(),K&&K.c(),U=g(),x&&x.c(),Z=g(),ce&&ce.c(),V=g(),A=f("br"),ne=g(),q=f("div"),le=f("nav"),Y=f("div");for(let fe=0;fe<ke.length;fe+=1)ke[fe].c();oe=g(),Te&&Te.c(),N=g(),me(z.$$.fragment),L=g(),Ne&&Ne.c(),F=g(),Pe&&Pe.c(),ee=ut(),c(a,"class","level-right"),c(u,"class","level-right"),c(_,"class","title svelte-2smypa"),c(m,"class","svelte-2smypa"),c(y,"class","description-label svelte-2smypa"),c(k,"class","description-content svelte-2smypa"),c(w,"class","description svelte-2smypa"),c(O,"class","ai-summary-section svelte-2smypa"),c(o,"class","content"),c(Y,"class","level-right"),c(le,"class","level is-mobile"),c(q,"class","level-right"),c(n,"class","media-content"),c(t,"class","media"),c(e,"class","box")},m(fe,Re){R(fe,e,Re),s(e,t),s(t,n),s(n,o),s(o,a),re&&re.m(a,null),s(o,r),s(o,u),_e(i,u,null),s(o,d),s(o,p),s(p,m),s(m,_),s(_,b),s(p,v),s(p,w),s(w,y),s(w,$),s(w,k),ie[S].m(k,null),s(p,D),s(p,O),be&&be.m(O,null),s(O,E),K&&K.m(O,null),s(O,U),x&&x.m(O,null),s(O,Z),ce&&ce.m(O,null),s(p,V),s(p,A),s(n,ne),s(n,q),s(q,le),s(le,Y);for(let Me=0;Me<ke.length;Me+=1)ke[Me]&&ke[Me].m(Y,null);s(e,oe),Te&&Te.m(e,null),R(fe,N,Re),_e(z,fe,Re),R(fe,L,Re),Ne&&Ne.m(fe,Re),R(fe,F,Re),Pe&&Pe.m(fe,Re),R(fe,ee,Re),J=!0,X||(Q=se(m,"click",l[16]),X=!0)},p(fe,Re){fe[0].tags?re?(re.p(fe,Re),Re[0]&1&&M(re,1)):(re=Zn(fe),re.c(),M(re,1),re.m(a,null)):re&&(Ue(),B(re,1,1,()=>{re=null}),ze());const Me={};Re[0]&1|Re[1]&65536&&(Me.$$scope={dirty:Re,ctx:fe}),i.$set(Me),(!J||Re[0]&1)&&h!==(h=fe[0].title+"")&&ve(b,h);let Xe=S;if(S=ae(fe),S===Xe?ie[S].p(fe,Re):(Ue(),B(ie[Xe],1,1,()=>{ie[Xe]=null}),ze(),j=ie[S],j?j.p(fe,Re):(j=ie[S]=pe[S](fe),j.c()),M(j,1),j.m(k,null)),!fe[11]&&!fe[9]&&!fe[10]?be?be.p(fe,Re):(be=xn(fe),be.c(),be.m(O,E)):be&&(be.d(1),be=null),fe[9]?K||(K=eo(),K.c(),K.m(O,U)):K&&(K.d(1),K=null),fe[10]?x?x.p(fe,Re):(x=to(fe),x.c(),x.m(O,Z)):x&&(x.d(1),x=null),fe[11]&&fe[8]?ce?(ce.p(fe,Re),Re[0]&2304&&M(ce,1)):(ce=lo(fe),ce.c(),M(ce,1),ce.m(O,null)):ce&&(Ue(),B(ce,1,1,()=>{ce=null}),ze()),Re[0]&32768){ge=fe[15];let ye;for(ye=0;ye<ge.length;ye+=1){const He=Qn(fe,ge,ye);ke[ye]?ke[ye].p(He,Re):(ke[ye]=oo(He),ke[ye].c(),ke[ye].m(Y,null))}for(;ye<ke.length;ye+=1)ke[ye].d(1);ke.length=ge.length}fe[13]?Te?Te.p(fe,Re):(Te=so(fe),Te.c(),Te.m(e,null)):Te&&(Te.d(1),Te=null);const xe={};Re[0]&1&&(xe.item=fe[0]),!I&&Re[0]&2&&(I=!0,xe.active=fe[1],rt(()=>I=!1)),z.$set(xe),fe[4]?Ne?(Ne.p(fe,Re),Re[0]&16&&M(Ne,1)):(Ne=ro(fe),Ne.c(),M(Ne,1),Ne.m(F.parentNode,F)):Ne&&(Ue(),B(Ne,1,1,()=>{Ne=null}),ze()),fe[14]?Pe?(Pe.p(fe,Re),Re[0]&16384&&M(Pe,1)):(Pe=io(fe),Pe.c(),M(Pe,1),Pe.m(ee.parentNode,ee)):Pe&&(Ue(),B(Pe,1,1,()=>{Pe=null}),ze())},i(fe){J||(M(re),M(i.$$.fragment,fe),M(j),M(ce),pt(()=>{J&&(C||(C=pl(p,ml,{},!0)),C.run(1))}),pt(()=>{J&&(H||(H=pl(le,ml,{},!0)),H.run(1))}),M(z.$$.fragment,fe),M(Ne),M(Pe),J=!0)},o(fe){B(re),B(i.$$.fragment,fe),B(j),B(ce),C||(C=pl(p,ml,{},!1)),C.run(0),H||(H=pl(le,ml,{},!1)),H.run(0),B(z.$$.fragment,fe),B(Ne),B(Pe),J=!1},d(fe){fe&&T(e),re&&re.d(),he(i),ie[S].d(),be&&be.d(),K&&K.d(),x&&x.d(),ce&&ce.d(),fe&&C&&C.end(),tt(ke,fe),fe&&H&&H.end(),Te&&Te.d(),fe&&T(N),he(z,fe),fe&&T(L),Ne&&Ne.d(fe),fe&&T(F),Pe&&Pe.d(fe),fe&&T(ee),X=!1,Q()}}}function sa(l,e,t){let n,o,a,r,u;je(l,At,Q=>t(31,a=Q)),je(l,ct,Q=>t(32,r=Q)),je(l,Lt,Q=>t(33,u=Q));let{document:i}=e,d=!1,p=!1,m=!1,_=null,h=null,b=null,v=!1,w=null,y=!1,$=null,k=!1,S=!1,j=!1,D=!1,O=null,E=!1,U=!1;function Z(){const Q=[];return Q.push({id:"download-markdown",label:"Download to Markdown",icon:"fas fa-download",action:()=>le(),visible:!0,title:"Download document as markdown file"}),n&&Q.push({id:"save-atomic",label:"Save to Atomic Server",icon:"fas fa-cloud-upload-alt",action:()=>C(),visible:!0,title:"Save article to Atomic Server",className:"has-text-primary"}),i.url&&Q.push({id:"external-url",label:"Open URL",icon:"fas fa-link",action:()=>window.open(i.url,"_blank"),visible:!0,title:"Open original URL in new tab",isLink:!0,href:i.url}),Q.push({id:"open-vscode",label:"Open in VSCode",icon:"fas fa-code",action:()=>Y(),visible:!0,title:"Open document in VSCode",isLink:!0,href:`vscode://${encodeURIComponent(i.title)}.md?${encodeURIComponent(i.body)}`}),Q.push({id:"add-context",label:D?"Added to Context ‚úì":j?"Adding...":"Add to Context",icon:D?"fas fa-check-circle":j?"fas fa-spinner fa-spin":"fas fa-plus-circle",action:()=>H(),visible:!0,title:D?"Document successfully added to chat context. Go to Chat tab to see it.":"Add document to LLM conversation context",disabled:j||D,className:D?"has-text-success":O?"has-text-danger":"",testId:"add-to-context-button"}),Q.push({id:"chat-with-document",label:U?"Opening Chat...":E?"Adding to Chat...":"Chat with Document",icon:U?"fas fa-external-link-alt":E?"fas fa-spinner fa-spin":"fas fa-comment-dots",action:()=>oe(),visible:!0,title:U?"Opening chat with this document":"Add document to context and open chat",disabled:E||U||j,className:U?"has-text-info":O?"has-text-danger":"has-text-primary",testId:"chat-with-document-button"}),Q}function V(){var ae;const Q=a,re=u;if(!(re!=null&&re.roles)||!Q)return!1;let pe=null;try{for(const[be,K]of Object.entries(re.roles)){const x=K,ce=typeof x.name=="object"?x.name.original:String(x.name);if(be===Q||ce===Q){pe=x;break}}}catch(be){return console.warn("Error checking role configuration:",be),!1}return pe?(((ae=pe.haystacks)==null?void 0:ae.filter(be=>be.service==="Atomic"&&be.location&&!be.read_only))||[]).length>0:!1}const A=()=>{t(1,d=!0)},C=()=>{console.log("üîÑ Opening atomic save modal for document:",i.title),t(3,m=!0)};async function ne(Q){var re,pe,ie,ae,be;t(7,v=!0),t(5,h=Q),console.log("üîç KG Search Debug Info:"),console.log("  Tag clicked:",Q),console.log("  Current role:",a),console.log("  Is Tauri mode:",r);try{if(r){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:a,term:Q});const K=await Ge("find_documents_for_kg_term",{roleName:a,term:Q});console.log("  üì• Tauri response received:"),console.log("    Status:",K.status),console.log("    Results count:",((re=K.results)==null?void 0:re.length)||0),console.log("    Total:",K.total||0),console.log("    Full response:",JSON.stringify(K,null,2)),K.status==="success"&&K.results&&K.results.length>0?(t(4,_=K.results[0]),t(6,b=_.rank||0),console.log("  ‚úÖ Found KG document:"),console.log("    Title:",_.title),console.log("    Rank:",b),console.log("    Body length:",((pe=_.body)==null?void 0:pe.length)||0,"characters"),t(2,p=!0)):(console.warn(`  ‚ö†Ô∏è  No KG documents found for term: "${Q}" in role: "${a}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const K=Ye.ServerURL,x=encodeURIComponent(a),ce=encodeURIComponent(Q),ge=`${K}/roles/${x}/kg_search?term=${ce}`;console.log("  üì§ HTTP Request details:"),console.log("    Base URL:",K),console.log("    Role (encoded):",x),console.log("    Term (encoded):",ce),console.log("    Full URL:",ge);const ke=await fetch(ge);if(console.log("  üì• HTTP Response received:"),console.log("    Status code:",ke.status),console.log("    Status text:",ke.statusText),console.log("    Headers:",Object.fromEntries(ke.headers.entries())),!ke.ok)throw new Error(`HTTP error! Status: ${ke.status} - ${ke.statusText}`);const Te=await ke.json();console.log("  üìÑ Response data:"),console.log("    Status:",Te.status),console.log("    Results count:",((ie=Te.results)==null?void 0:ie.length)||0),console.log("    Total:",Te.total||0),console.log("    Full response:",JSON.stringify(Te,null,2)),Te.status==="success"&&Te.results&&Te.results.length>0?(t(4,_=Te.results[0]),t(6,b=_.rank||0),console.log("  ‚úÖ Found KG document:"),console.log("    Title:",_.title),console.log("    Rank:",b),console.log("    Body length:",((ae=_.body)==null?void 0:ae.length)||0,"characters"),t(2,p=!0)):(console.warn(`  ‚ö†Ô∏è  No KG documents found for term: "${Q}" in role: "${a}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",ge))}}catch(K){console.error("‚ùå Error fetching KG document:"),console.error("  Error type:",K.constructor.name),console.error("  Error message:",K.message||K),console.error("  Request details:",{tag:Q,role:a,isTauri:r,timestamp:new Date().toISOString()}),!r&&((be=K.message)!=null&&be.includes("Failed to fetch"))&&(console.error("  üí° Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{t(7,v=!1)}}async function q(){var Q;if(!(y||!i.id||!a)){t(9,y=!0),t(10,$=null),console.log("ü§ñ AI Summary Debug Info:"),console.log("  Document ID:",i.id),console.log("  Current role:",a),console.log("  Is Tauri mode:",r);try{const re={document_id:i.id,role:a,max_length:250,force_regenerate:!1};console.log("  üì§ Summarization request:",re);let pe;if(r){const be=`${Ye.ServerURL}/documents/summarize`;pe=await fetch(be,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(re)})}else{const be=`${Ye.ServerURL}/documents/summarize`;pe=await fetch(be,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(re)})}if(console.log("  üì• Summary response received:"),console.log("    Status code:",pe.status),console.log("    Status text:",pe.statusText),!pe.ok)throw new Error(`HTTP error! Status: ${pe.status} - ${pe.statusText}`);const ie=await pe.json();console.log("  üìÑ Summary response data:",ie),ie.status==="success"&&ie.summary?(t(8,w=ie.summary),t(12,S=ie.from_cache||!1),t(11,k=!0),console.log("  ‚úÖ Summary generated successfully"),console.log("    Summary length:",w.length,"characters"),console.log("    From cache:",S),console.log("    Model used:",ie.model_used)):(t(10,$=ie.error||"Failed to generate summary"),console.error("  ‚ùå Summary generation failed:",$))}catch(re){console.error("‚ùå Error generating summary:"),console.error("  Error type:",re.constructor.name),console.error("  Error message:",re.message||re),console.error("  Request details:",{document_id:i.id,role:a,isTauri:r,timestamp:new Date().toISOString()}),t(10,$=re.message||"Network error occurred"),(Q=re.message)!=null&&Q.includes("Failed to fetch")&&(console.error("  üí° Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Verify OpenRouter is enabled for this role"),console.error("    3. Check OPENROUTER_KEY environment variable"),console.error("    4. Verify server URL in CONFIG.ServerURL"))}finally{t(9,y=!1)}}}function le(){console.log("üì• Downloading document as markdown:",i.title);let Q=`# ${i.title}

`;Q+=`**Source:** Terraphim Search
`,Q+=`**Rank:** ${i.rank||"N/A"}
`,i.url&&(Q+=`**URL:** ${i.url}
`),i.tags&&i.tags.length>0&&(Q+=`**Tags:** ${i.tags.join(", ")}
`),Q+=`**Downloaded:** ${new Date().toISOString()}

`,i.description&&(Q+=`## Description

${i.description}

`),Q+=`## Content

${i.body}
`;const re=`${i.title.replace(/[^a-z0-9]/gi,"_").toLowerCase()}_${Date.now()}.md`,pe=new Blob([Q],{type:"text/markdown"}),ie=URL.createObjectURL(pe),ae=window.document.createElement("a");ae.href=ie,ae.download=re,window.document.body.appendChild(ae),ae.click(),window.document.body.removeChild(ae),URL.revokeObjectURL(ie),console.log("‚úÖ Markdown file downloaded:",re)}function Y(){const Q=`vscode://${encodeURIComponent(i.title)}.md?${encodeURIComponent(i.body)}`;window.open(Q,"_blank")}async function H(){console.log("üìù Adding document to LLM context:",i.title),j=!0,D=!1,t(13,O=null);try{let Q=null;if(r){try{const ae=await Ge("list_conversations");if(console.log("üìã Available conversations:",ae),ae!=null&&ae.conversations&&ae.conversations.length>0)Q=ae.conversations[0].id,console.log("üéØ Using existing conversation:",Q);else{const be=await Ge("create_conversation",{title:"Search Context",role:a||"default"});if(be.status==="success"&&be.conversation_id)Q=be.conversation_id,console.log("üÜï Created new conversation:",Q);else throw new Error("Failed to create conversation: "+(be.error||"Unknown error"))}}catch(ae){throw console.error("‚ùå Failed to manage conversations:",ae),new Error("Could not create or find conversation: "+ae.message)}const pe={source_type:"document",document_id:i.id};i.url&&(pe.url=i.url),i.tags&&i.tags.length>0&&(pe.tags=i.tags.join(", ")),i.rank!==void 0&&(pe.rank=i.rank.toString());const ie=await Ge("add_context_to_conversation",{conversationId:Q,contextType:"document",title:i.title,content:i.body,metadata:pe});console.log("‚úÖ Document added to context via Tauri:",ie)}else{const pe=Ye.ServerURL;try{const K=await fetch(`${pe}/conversations`);if(K.ok){const x=await K.json();if(x.conversations&&x.conversations.length>0)Q=x.conversations[0].id,console.log("üéØ Using existing conversation:",Q);else{const ce=await fetch(`${pe}/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"Search Context",role:a||"default"})});if(ce.ok){const ge=await ce.json();if(ge.status==="success"&&ge.conversation_id)Q=ge.conversation_id,console.log("üÜï Created new conversation:",Q);else throw new Error("Failed to create conversation: "+(ge.error||"Unknown error"))}else throw new Error(`Failed to create conversation: ${ce.status} ${ce.statusText}`)}}else throw new Error(`Failed to list conversations: ${K.status} ${K.statusText}`)}catch(K){throw console.error("‚ùå Failed to manage conversations:",K),new Error("Could not create or find conversation: "+K.message)}const ie=`${pe}/conversations/${Q}/context`,ae=await fetch(ie,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context_type:"document",title:i.title,content:i.body,metadata:{source_type:"document",document_id:i.id,url:i.url||"",tags:i.tags?i.tags.join(", "):"",rank:i.rank?i.rank.toString():"0"}})});if(!ae.ok)throw new Error(`HTTP error! Status: ${ae.status} - ${ae.statusText}`);const be=await ae.json();console.log("‚úÖ Document added to context via HTTP:",be)}console.log("‚úÖ Successfully added document to LLM context"),D=!0;const re=window.document.createElement("div");re.className="notification is-success is-light",re.innerHTML=`
        <button class="delete" onclick="this.parentElement.remove()"></button>
        <strong>‚úì Added to Chat Context</strong><br>
        <small>Document added successfully. <a href="/chat" class="has-text-success has-text-weight-bold">Go to Chat ‚Üí</a> to see it in the context panel.</small>
      `,re.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(re),setTimeout(()=>{re.remove()},8e3),setTimeout(()=>{D=!1},5e3)}catch(Q){console.error("‚ùå Error adding document to context:",Q),t(13,O=Q.message||"Failed to add document to context");const re=window.document.createElement("div");re.className="notification is-danger is-light",re.innerHTML=`
        <button class="delete" onclick="this.parentElement.remove()"></button>
        <strong>‚úó Failed to Add Context</strong><br>
        <small>${O}</small>
      `,re.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(re),setTimeout(()=>{re.remove()},8e3),setTimeout(()=>{t(13,O=null)},5e3)}finally{j=!1}}async function oe(){console.log("üí¨ Adding document to context and opening chat:",i.title),E=!0,U=!1,t(13,O=null);try{let Q=null;if(r){try{const ae=await Ge("list_conversations");if(console.log("üìã Available conversations:",ae),ae!=null&&ae.conversations&&ae.conversations.length>0)Q=ae.conversations[0].id,console.log("üéØ Using existing conversation:",Q);else{const be=await Ge("create_conversation",{title:"Chat with Documents",role:a||"default"});if(be.status==="success"&&be.conversation_id)Q=be.conversation_id,console.log("üÜï Created new conversation:",Q);else throw new Error("Failed to create conversation: "+(be.error||"Unknown error"))}}catch(ae){throw console.error("‚ùå Failed to manage conversations:",ae),new Error("Could not create or find conversation: "+ae.message)}const pe={source_type:"document",document_id:i.id};i.url&&(pe.url=i.url),i.tags&&i.tags.length>0&&(pe.tags=i.tags.join(", ")),i.rank!==void 0&&(pe.rank=i.rank.toString());const ie=await Ge("add_context_to_conversation",{conversationId:Q,contextType:"document",title:i.title,content:i.body,metadata:pe});console.log("‚úÖ Document added to context via Tauri:",ie)}else{const pe=Ye.ServerURL;try{const K=await fetch(`${pe}/conversations`);if(K.ok){const x=await K.json();if(x.conversations&&x.conversations.length>0)Q=x.conversations[0].id,console.log("üéØ Using existing conversation:",Q);else{const ce=await fetch(`${pe}/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"Chat with Documents",role:a||"default"})});if(ce.ok){const ge=await ce.json();if(ge.status==="success"&&ge.conversation_id)Q=ge.conversation_id,console.log("üÜï Created new conversation:",Q);else throw new Error("Failed to create conversation: "+(ge.error||"Unknown error"))}else throw new Error(`Failed to create conversation: ${ce.status} ${ce.statusText}`)}}else throw new Error(`Failed to list conversations: ${K.status} ${K.statusText}`)}catch(K){throw console.error("‚ùå Failed to manage conversations:",K),new Error("Could not create or find conversation: "+K.message)}const ie=`${pe}/conversations/${Q}/context`,ae=await fetch(ie,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context_type:"document",title:i.title,content:i.body,metadata:{source_type:"document",document_id:i.id,url:i.url||"",tags:i.tags?i.tags.join(", "):"",rank:i.rank?i.rank.toString():"0"}})});if(!ae.ok)throw new Error(`HTTP error! Status: ${ae.status} - ${ae.statusText}`);const be=await ae.json();console.log("‚úÖ Document added to context via HTTP:",be)}console.log("‚úÖ Successfully added document to chat context, navigating to chat..."),U=!0;const re=window.document.createElement("div");re.className="notification is-success is-light",re.innerHTML=`
        <strong>üí¨ Opening Chat with Document</strong><br>
        <small>Context added successfully. Redirecting to chat...</small>
      `,re.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(re),setTimeout(()=>{re.remove(),dr.goto("/chat")},1500),setTimeout(()=>{U=!1},2e3)}catch(Q){console.error("‚ùå Error adding document to context and opening chat:",Q),t(13,O=Q.message||"Failed to add document to context");const re=window.document.createElement("div");re.className="notification is-danger is-light",re.innerHTML=`
        <button class="delete" onclick="this.parentElement.remove()"></button>
        <strong>‚úó Failed to Open Chat with Document</strong><br>
        <small>${O}</small>
      `,re.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(re),setTimeout(()=>{re.remove()},8e3),setTimeout(()=>{t(13,O=null)},5e3)}finally{E=!1}}Ml[a]!==void 0&&(console.log("Have attribute",Ml[a]),Ml[a].hasOwnProperty("enableLogseq")?console.log("enable logseq True"):console.log("Didn't make it"));const N=Q=>ne(Q),z=()=>{t(10,$=null),q()},I=()=>t(11,k=!1),L=()=>{q()},F=()=>t(13,O=null);function ee(Q){d=Q,t(1,d)}function J(Q){p=Q,t(2,p)}function X(Q){m=Q,t(3,m)}return l.$$set=Q=>{"document"in Q&&t(0,i=Q.document)},t(14,n=V()),t(15,o=Z()),[i,d,p,m,_,h,b,v,w,y,$,k,S,O,n,o,A,ne,q,N,z,I,L,F,ee,J,X]}class ra extends mt{constructor(e){super(),_t(this,e,sa,oa,dt,{document:0},null,[-1,-1])}}const ia="/assets/terraphim_gray.png";function Pl(l){const e=l.trim();if(!e)return{hasOperator:!1,operator:null,terms:[l],originalQuery:l};const t=/\b(AND)\b/,n=/\b(OR)\b/,o=/\b(and)\b/i,a=/\b(or)\b/i,r=t.test(e),u=n.test(e),i=o.test(e)&&!r,d=a.test(e)&&!u;if(r&&!u)return{hasOperator:!0,operator:"AND",terms:e.split(t).filter((m,_)=>_%2===0).map(m=>m.trim()).filter(m=>m.length>0),originalQuery:l};if(u&&!r)return{hasOperator:!0,operator:"OR",terms:e.split(n).filter((m,_)=>_%2===0).map(m=>m.trim()).filter(m=>m.length>0),originalQuery:l};if(r&&u){const p=e.indexOf(" AND "),m=e.indexOf(" OR ");if(p!==-1&&(m===-1||p<m))return{hasOperator:!0,operator:"AND",terms:e.split(/\s+(?:AND|OR)\s+/i).map(h=>h.trim()).filter(h=>h.length>0),originalQuery:l};if(m!==-1)return{hasOperator:!0,operator:"OR",terms:e.split(/\s+(?:AND|OR)\s+/i).map(h=>h.trim()).filter(h=>h.length>0),originalQuery:l}}if(i&&!d)return{hasOperator:!0,operator:"AND",terms:e.split(o).filter((m,_)=>_%2===0).map(m=>m.trim()).filter(m=>m.length>0),originalQuery:l};if(d&&!i)return{hasOperator:!0,operator:"OR",terms:e.split(a).filter((m,_)=>_%2===0).map(m=>m.trim()).filter(m=>m.length>0),originalQuery:l};if(i&&d){const p=e.toLowerCase().indexOf(" and "),m=e.toLowerCase().indexOf(" or ");if(p!==-1&&(m===-1||p<m))return{hasOperator:!0,operator:"AND",terms:e.split(/\s+(?:and|or)\s+/i).map(h=>h.trim()).filter(h=>h.length>0),originalQuery:l};if(m!==-1)return{hasOperator:!0,operator:"OR",terms:e.split(/\s+(?:and|or)\s+/i).map(h=>h.trim()).filter(h=>h.length>0),originalQuery:l}}return{hasOperator:!1,operator:null,terms:[e],originalQuery:l}}function aa(l,e){var n,o;if(l.hasOperator&&l.terms.length>1){const a=l.terms.filter(r=>r.trim().length>0);if(a.length>1)return{search_term:a[0],search_terms:a,operator:(n=l.operator)==null?void 0:n.toLowerCase(),skip:0,limit:50,role:e||null}}return{search_term:((o=l.terms[0])==null?void 0:o.trim())||"",search_terms:void 0,operator:void 0,skip:0,limit:50,role:e||null}}function ao(l,e,t){const n=l.slice();return n[35]=e[t],n}function co(l,e,t){const n=l.slice();return n[38]=e[t],n[40]=t,n}function uo(l,e,t){const n=l.slice();return n[41]=e[t],n[40]=t,n}function fo(l){let e,t=l[3],n=[];for(let o=0;o<t.length;o+=1)n[o]=po(uo(l,t,o));return{c(){e=f("ul");for(let o=0;o<n.length;o+=1)n[o].c();c(e,"class","suggestions svelte-sfnt4t")},m(o,a){R(o,e,a);for(let r=0;r<n.length;r+=1)n[r]&&n[r].m(e,null)},p(o,a){if(a[0]&4120){t=o[3];let r;for(r=0;r<t.length;r+=1){const u=uo(o,t,r);n[r]?n[r].p(u,a):(n[r]=po(u),n[r].c(),n[r].m(e,null))}for(;r<n.length;r+=1)n[r].d(1);n.length=t.length}},d(o){o&&T(e),tt(n,o)}}}function po(l){let e,t=l[41]+"",n,o,a,r,u,i;function d(){return l[20](l[41])}function p(...m){return l[21](l[41],...m)}return{c(){e=f("li"),n=P(t),o=g(),c(e,"tabindex","0"),c(e,"role","option"),c(e,"aria-selected",a=l[40]===l[4]),c(e,"aria-label",r=`Apply suggestion: ${l[41]}`),c(e,"class","svelte-sfnt4t"),ht(e,"active",l[40]===l[4])},m(m,_){R(m,e,_),s(e,n),s(e,o),u||(i=[se(e,"click",d),se(e,"keydown",p)],u=!0)},p(m,_){l=m,_[0]&8&&t!==(t=l[41]+"")&&ve(n,t),_[0]&16&&a!==(a=l[40]===l[4])&&c(e,"aria-selected",a),_[0]&8&&r!==(r=`Apply suggestion: ${l[41]}`)&&c(e,"aria-label",r),_[0]&16&&ht(e,"active",l[40]===l[4])},d(m){m&&T(e),u=!1,lt(i)}}}function mo(l){let e,t,n,o,a,r,u;return t=new Jl({props:{$$slots:{default:[fa]},$$scope:{ctx:l}}}),{c(){e=f("div"),me(t.$$.fragment),n=g(),o=f("button"),o.textContent="Clear all",c(o,"type","button"),c(o,"class","clear-terms-btn svelte-sfnt4t"),c(e,"class","selected-terms-section svelte-sfnt4t")},m(i,d){R(i,e,d),_e(t,e,null),s(e,n),s(e,o),a=!0,r||(u=se(o,"click",l[14]),r=!0)},p(i,d){const p={};d[0]&96|d[1]&4096&&(p.$$scope={dirty:d,ctx:i}),t.$set(p)},i(i){a||(M(t.$$.fragment,i),a=!0)},o(i){B(t.$$.fragment,i),a=!1},d(i){i&&T(e),he(t),r=!1,u()}}}function ca(l){let e=l[38].value+"",t,n,o,a,r,u,i;function d(){return l[22](l[38])}return{c(){t=P(e),n=g(),o=f("button"),a=P("√ó"),c(o,"class","remove-tag-btn svelte-sfnt4t"),c(o,"aria-label",r=`Remove term: ${l[38].value}`)},m(p,m){R(p,t,m),R(p,n,m),R(p,o,m),s(o,a),u||(i=se(o,"click",ir(d)),u=!0)},p(p,m){l=p,m[0]&32&&e!==(e=l[38].value+"")&&ve(t,e),m[0]&32&&r!==(r=`Remove term: ${l[38].value}`)&&c(o,"aria-label",r)},d(p){p&&T(t),p&&T(n),p&&T(o),u=!1,i()}}}function _o(l){let e,t,n,o;return t=new Gt({props:{class:"operator-tag",rounded:!0,$$slots:{default:[ua]},$$scope:{ctx:l}}}),{c(){e=f("div"),me(t.$$.fragment),n=g(),c(e,"class","operator-tag-wrapper svelte-sfnt4t")},m(a,r){R(a,e,r),_e(t,e,null),s(e,n),o=!0},p(a,r){const u={};r[0]&64|r[1]&4096&&(u.$$scope={dirty:r,ctx:a}),t.$set(u)},i(a){o||(M(t.$$.fragment,a),o=!0)},o(a){B(t.$$.fragment,a),o=!1},d(a){a&&T(e),he(t)}}}function ua(l){let e=(l[6]||"AND")+"",t;return{c(){t=P(e)},m(n,o){R(n,t,o)},p(n,o){o[0]&64&&e!==(e=(n[6]||"AND")+"")&&ve(t,e)},d(n){n&&T(t)}}}function ho(l){let e,t,n,o,a;function r(){return l[23](l[38])}t=new Gt({props:{rounded:!0,title:"Click to remove term",$$slots:{default:[ca]},$$scope:{ctx:l}}}),t.$on("click",r);let u=l[40]<l[5].length-1&&_o(l);return{c(){e=f("div"),me(t.$$.fragment),n=g(),u&&u.c(),o=ut(),c(e,"class","term-tag-wrapper svelte-sfnt4t"),ht(e,"from-kg",l[38].isFromKG)},m(i,d){R(i,e,d),_e(t,e,null),R(i,n,d),u&&u.m(i,d),R(i,o,d),a=!0},p(i,d){l=i;const p={};d[0]&32|d[1]&4096&&(p.$$scope={dirty:d,ctx:l}),t.$set(p),(!a||d[0]&32)&&ht(e,"from-kg",l[38].isFromKG),l[40]<l[5].length-1?u?(u.p(l,d),d[0]&32&&M(u,1)):(u=_o(l),u.c(),M(u,1),u.m(o.parentNode,o)):u&&(Ue(),B(u,1,1,()=>{u=null}),ze())},i(i){a||(M(t.$$.fragment,i),M(u),a=!0)},o(i){B(t.$$.fragment,i),B(u),a=!1},d(i){i&&T(e),he(t),i&&T(n),u&&u.d(i),i&&T(o)}}}function fa(l){let e,t,n=l[5],o=[];for(let r=0;r<n.length;r+=1)o[r]=ho(co(l,n,r));const a=r=>B(o[r],1,1,()=>{o[r]=null});return{c(){for(let r=0;r<o.length;r+=1)o[r].c();e=ut()},m(r,u){for(let i=0;i<o.length;i+=1)o[i]&&o[i].m(r,u);R(r,e,u),t=!0},p(r,u){if(u[0]&8288){n=r[5];let i;for(i=0;i<n.length;i+=1){const d=co(r,n,i);o[i]?(o[i].p(d,u),M(o[i],1)):(o[i]=ho(d),o[i].c(),M(o[i],1),o[i].m(e.parentNode,e))}for(Ue(),i=n.length;i<o.length;i+=1)a(i);ze()}},i(r){if(!t){for(let u=0;u<n.length;u+=1)M(o[u]);t=!0}},o(r){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)B(o[u]);t=!1},d(r){tt(o,r),r&&T(e)}}}function go(l){let e,t,n,o;return{c(){e=f("div"),t=f("button"),t.textContent="Parse Terms",c(t,"type","button"),c(t,"class","button is-small is-info"),c(e,"class","search-hint-container svelte-sfnt4t")},m(a,r){R(a,e,r),s(e,t),n||(o=se(t,"click",l[24]),n=!0)},p:Ce,d(a){a&&T(e),n=!1,o()}}}function da(l){let e,t,n,o,a,r,u,i=l[0]&&(l[0].includes(" AND ")||l[0].includes(" OR "))&&l[5].length===0,d;function p(v){l[19](v)}let m={type:"search",placeholder:l[8]?`Search over Knowledge graph for ${l[7]}`:"Search",icon:"search",expanded:!0,autofocus:!0};l[0]!==void 0&&(m.value=l[0]),n=new Vt({props:m}),et.push(()=>st(n,"value",p)),n.$on("click",l[15]),n.$on("submit",l[15]),n.$on("keydown",l[11]),n.$on("input",l[10]);let _=l[3].length>0&&fo(l),h=l[5].length>0&&mo(l),b=i&&go(l);return{c(){e=f("div"),t=f("div"),me(n.$$.fragment),a=g(),_&&_.c(),r=g(),h&&h.c(),u=g(),b&&b.c(),c(t,"class","input-wrapper svelte-sfnt4t"),c(e,"class","search-row svelte-sfnt4t")},m(v,w){R(v,e,w),s(e,t),_e(n,t,null),s(t,a),_&&_.m(t,null),s(e,r),h&&h.m(e,null),s(e,u),b&&b.m(e,null),d=!0},p(v,w){const y={};w[0]&384&&(y.placeholder=v[8]?`Search over Knowledge graph for ${v[7]}`:"Search"),!o&&w[0]&1&&(o=!0,y.value=v[0],rt(()=>o=!1)),n.$set(y),v[3].length>0?_?_.p(v,w):(_=fo(v),_.c(),_.m(t,null)):_&&(_.d(1),_=null),v[5].length>0?h?(h.p(v,w),w[0]&32&&M(h,1)):(h=mo(v),h.c(),M(h,1),h.m(e,u)):h&&(Ue(),B(h,1,1,()=>{h=null}),ze()),w[0]&33&&(i=v[0]&&(v[0].includes(" AND ")||v[0].includes(" OR "))&&v[5].length===0),i?b?b.p(v,w):(b=go(v),b.c(),b.m(e,null)):b&&(b.d(1),b=null)},i(v){d||(M(n.$$.fragment,v),M(h),d=!0)},o(v){B(n.$$.fragment,v),B(h),d=!1},d(v){v&&T(e),he(n),_&&_.d(),h&&h.d(),b&&b.d()}}}function pa(l){let e,t,n,o,a,r,u,i,d,p;return{c(){e=f("section"),t=f("div"),n=f("img"),a=g(),r=f("p"),r.textContent="I am Terraphim, your personal assistant.",u=g(),i=f("button"),i.innerHTML=`<span class="icon"><i class="fas fa-magic"></i></span> 
        <span>Configuration Wizard</span>`,rr(n.src,o=ia)||c(n,"src",o),c(n,"alt","Terraphim Logo"),c(n,"class","svelte-sfnt4t"),c(i,"class","button is-primary"),c(i,"data-testid","wizard-start"),c(t,"class","content has-text-grey has-text-centered svelte-sfnt4t"),c(e,"class","section")},m(m,_){R(m,e,_),s(e,t),s(t,n),s(t,a),s(t,r),s(t,u),s(t,i),d||(p=se(i,"click",l[25]),d=!0)},p:Ce,i:Ce,o:Ce,d(m){m&&T(e),d=!1,p()}}}function ma(l){let e,t,n=l[1],o=[];for(let r=0;r<n.length;r+=1)o[r]=vo(ao(l,n,r));const a=r=>B(o[r],1,1,()=>{o[r]=null});return{c(){for(let r=0;r<o.length;r+=1)o[r].c();e=ut()},m(r,u){for(let i=0;i<o.length;i+=1)o[i]&&o[i].m(r,u);R(r,e,u),t=!0},p(r,u){if(u[0]&2){n=r[1];let i;for(i=0;i<n.length;i+=1){const d=ao(r,n,i);o[i]?(o[i].p(d,u),M(o[i],1)):(o[i]=vo(d),o[i].c(),M(o[i],1),o[i].m(e.parentNode,e))}for(Ue(),i=n.length;i<o.length;i+=1)a(i);ze()}},i(r){if(!t){for(let u=0;u<n.length;u+=1)M(o[u]);t=!0}},o(r){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)B(o[u]);t=!1},d(r){tt(o,r),r&&T(e)}}}function _a(l){let e,t;return{c(){e=f("p"),t=P(l[2]),c(e,"class","error svelte-sfnt4t")},m(n,o){R(n,e,o),s(e,t)},p(n,o){o[0]&4&&ve(t,n[2])},i:Ce,o:Ce,d(n){n&&T(e)}}}function vo(l){let e,t;return e=new ra({props:{document:l[35]}}),{c(){me(e.$$.fragment)},m(n,o){_e(e,n,o),t=!0},p(n,o){const a={};o[0]&2&&(a.document=n[35]),e.$set(a)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function ha(l){let e,t,n,o,a,r,u,i,d,p,m;e=new _l({props:{fallbackPath:"/"}}),o=new Ft({props:{$$slots:{default:[da]},$$scope:{ctx:l}}});const _=[_a,ma,pa],h=[];function b(v,w){return v[2]?0:v[1].length?1:2}return r=b(l),u=h[r]=_[r](l),{c(){me(e.$$.fragment),t=g(),n=f("form"),me(o.$$.fragment),a=g(),u.c(),i=ut()},m(v,w){_e(e,v,w),R(v,t,w),R(v,n,w),_e(o,n,null),R(v,a,w),h[r].m(v,w),R(v,i,w),d=!0,p||(m=se(n,"submit",sr(l[15])),p=!0)},p(v,w){const y={};w[0]&505|w[1]&4096&&(y.$$scope={dirty:w,ctx:v}),o.$set(y);let $=r;r=b(v),r===$?h[r].p(v,w):(Ue(),B(h[$],1,1,()=>{h[$]=null}),ze(),u=h[r],u?u.p(v,w):(u=h[r]=_[r](v),u.c()),M(u,1),u.m(i.parentNode,i))},i(v){d||(M(e.$$.fragment,v),M(o.$$.fragment,v),M(u),d=!0)},o(v){B(e.$$.fragment,v),B(o.$$.fragment,v),B(u),d=!1},d(v){he(e,v),v&&T(t),v&&T(n),he(o),v&&T(a),h[r].d(v),v&&T(i),p=!1,m()}}}function ga(l,e,t){let n,o,a,r,u,i,d;je(l,Or,I=>t(27,o=I)),je(l,Bt,I=>t(0,a=I)),je(l,ct,I=>t(28,r=I)),je(l,At,I=>t(7,u=I)),je(l,vl,I=>t(18,i=I)),je(l,Tt,I=>t(8,d=I));let p=[],m=null,_=[],h=-1,b=[],v=null,w=!1,y=null;Wl(()=>{y&&clearTimeout(y)});function $(I){const L=Pl(I);if(L.hasOperator&&L.terms.length>1){const F=L.terms.map(X=>{const Q=n.some(([re])=>re.toLowerCase()===X.toLowerCase());return{value:X,isFromKG:Q}}),ee=b.map(X=>X.value),J=F.map(X=>X.value);(JSON.stringify(ee)!==JSON.stringify(J)||v!==L.operator)&&(t(5,b=F),t(6,v=L.operator))}else L.terms.length===1&&b.length>0?(t(5,b=[]),t(6,v=null)):L.terms.length===0&&(t(5,b=[]),t(6,v=null))}async function k(I){try{if(r){const L=await Ge("get_autocomplete_suggestions",{query:I,roleName:u,limit:8});if(L.status==="success"&&L.suggestions)return L.suggestions.map(F=>F.term)}else{const L=await fetch(`${o.replace("/documents/search","")}/autocomplete/${encodeURIComponent(u)}/${encodeURIComponent(I)}`);if(L.ok){const F=await L.json();if(F.status==="success"&&F.suggestions)return F.suggestions.map(ee=>ee.term)}}return n.filter(([L])=>L.toLowerCase().includes(I.toLowerCase())).map(([L])=>L).slice(0,8)}catch(L){return console.warn("Error fetching term suggestions:",L),[]}}async function S(I){const L=I.trim();if(L.length===0)return[];const ee=Pl(L),J=L.split(/\s+/),X=J[J.length-1].toLowerCase();if(ee.hasOperator&&ee.terms.length>0){const re=ee.terms[ee.terms.length-1];return re&&re.length>=2?k(re):[]}if(J.length>1){const re=[];if("and".startsWith(X)&&re.push("AND"),"or".startsWith(X)&&re.push("OR"),re.length>0)return re}const Q=L.toLowerCase();if(Q.includes(" and ")||Q.includes(" or ")||Q.includes(" AND ")||Q.includes(" OR ")){const re=X;return re.length<2?[]:k(re)}try{return(await k(L)).slice(0,7)}catch(re){return console.warn("Error fetching autocomplete suggestions:",re),n.filter(([ie])=>ie.toLowerCase().includes(L.toLowerCase())).map(([ie])=>ie).slice(0,5).slice(0,7)}}async function j(I){const L=I.target;if(!L||L.selectionStart==null)return;const F=L.selectionStart,J=a.slice(0,F).split(/\s+/),X=J[J.length-1];if(X.toLowerCase()==="a"||X.toLowerCase()==="an")t(3,_=["AND"]);else if(X.toLowerCase()==="o"||X.toLowerCase()==="or")t(3,_=["OR"]);else if(X.length>=2)try{const Q=await S(X);t(3,_=Q)}catch(Q){console.warn("Failed to get suggestions:",Q),t(3,_=[])}else t(3,_=[]);t(4,h=-1)}function D(I){_.length>0?I.key==="ArrowDown"?(I.preventDefault(),t(4,h=(h+1)%_.length)):I.key==="ArrowUp"?(I.preventDefault(),t(4,h=(h-1+_.length)%_.length)):(I.key==="Enter"||I.key==="Tab")&&h!==-1?(I.preventDefault(),E(_[h])):I.key==="Escape"&&(I.preventDefault(),t(3,_=[]),t(4,h=-1)):I.key==="Enter"&&(I.preventDefault(),O())}function O(){$(a),ne()}function E(I){if(I==="AND"||I==="OR"){t(6,v=I);const L=Pl(a);L.terms.length>0&&!b.some(F=>F.value===L.terms[L.terms.length-1])&&Z(L.terms[L.terms.length-1]),Ht(Bt,a=a+` ${I} `,a)}else{const L=a.trim().split(/\s+/),F=L[L.length-1];I.toLowerCase().startsWith(F.toLowerCase())?(L[L.length-1]=I,Ht(Bt,a=L.join(" "),a)):Z(I,v)}t(3,_=[]),t(4,h=-1)}function U(){const I=a.trim();if(!I)return null;const L=Pl(I);return{...aa(L,u),skip:0,limit:10}}function Z(I,L=null){const F=n.some(([ee])=>ee.toLowerCase()===I.toLowerCase());b.some(ee=>ee.value.toLowerCase()===I.toLowerCase())||(t(5,b=[...b,{value:I,isFromKG:F}]),L&&b.length>1&&t(6,v=L),A())}function V(I){t(5,b=b.filter(L=>L.value!==I)),A()}function A(){if(t(16,w=!0),b.length===0)Ht(Bt,a="",a),t(6,v=null);else if(b.length===1)Ht(Bt,a=b[0].value,a),t(6,v=null);else{const I=v||"AND";Ht(Bt,a=b.map(L=>L.value).join(` ${I} `),a)}setTimeout(()=>{t(16,w=!1)},10)}function C(){t(5,b=[]),t(6,v=null),Ht(Bt,a="",a)}async function ne(){if(t(2,m=null),r){if(!a.trim())return;try{const I=U();if(!I)return;const L=await Ge("search",{searchQuery:I});L.status==="success"?(t(1,p=L.results),console.log("Response results"),console.log(p)):(t(2,m=`Search failed: ${L.status}`),console.error("Search failed:",L))}catch(I){t(2,m=`Error in Tauri search: ${I}`),console.error("Error in Tauri search:",I)}}else{if(!a.trim())return;const I=U();if(!I)return;const L=JSON.stringify(I);try{const F=await fetch(o,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:L}),ee=await F.json();if(!F.ok)throw new Error(`HTTP error! Status: ${F.status}`);t(1,p=ee.results)}catch(F){console.error("Error fetching data:",F),t(2,m=`Error fetching data: ${F}`)}}}function q(I){a=I,Bt.set(a)}const le=I=>E(I),Y=(I,L)=>{(L.key==="Enter"||L.key===" ")&&(L.preventDefault(),E(I))},H=I=>V(I.value),oe=I=>V(I.value),N=()=>$(a),z=()=>window.location.href="/config/wizard";return l.$$.update=()=>{l.$$.dirty[0]&262144&&(n=Object.entries(i)),l.$$.dirty[0]&196609&&a&&!w&&(a.includes(" AND ")||a.includes(" OR ")||a.includes(" and ")||a.includes(" or "))&&(y&&clearTimeout(y),t(17,y=setTimeout(()=>{$(a),t(17,y=null)},300)))},[a,p,m,_,h,b,v,u,d,$,j,D,E,V,C,ne,w,y,i,q,le,Y,H,oe,N,z]}class va extends mt{constructor(e){super(),_t(this,e,ga,ha,dt,{},null,[-1,-1])}}async function bo(l={}){return typeof l=="object"&&Object.freeze(l),Zl({__tauriModule:"Dialog",message:{cmd:"openDialog",options:l}})}function ko(l,e,t){const n=l.slice();return n[71]=e[t],n[79]=t,n}function wo(l,e,t){const n=l.slice();return n[77]=e[t],n[78]=e,n[79]=t,n}function yo(l,e,t){const n=l.slice();return n[80]=e[t],n}function $o(l,e,t){const n=l.slice();return n[80]=e[t],n}function Co(l,e,t){const n=l.slice();return n[85]=e[t],n[86]=e,n[87]=t,n}function To(l,e,t){const n=l.slice();return n[88]=e[t][0],n[89]=e[t][1],n[90]=e,n[91]=t,n}function So(l,e,t){const n=l.slice();return n[74]=e[t],n}function Ro(l,e,t){const n=l.slice();return n[71]=e[t],n}function Ao(l,e,t){const n=l.slice();return n[74]=e[t],n}function Eo(l){let e,t,n,o,a;return{c(){e=f("div"),t=f("button"),n=P(`
      Configuration saved successfully!`),c(t,"class","delete"),c(e,"class","notification is-success"),c(e,"data-testid","wizard-success")},m(r,u){R(r,e,u),s(e,t),s(e,n),o||(a=se(t,"click",l[20]),o=!0)},p:Ce,d(r){r&&T(e),o=!1,a()}}}function Lo(l){let e,t,n,o,a;return{c(){e=f("div"),t=f("button"),n=P(`
      Failed to save configuration. Please try again.`),c(t,"class","delete"),c(e,"class","notification is-danger"),c(e,"data-testid","wizard-error")},m(r,u){R(r,e,u),s(e,t),s(e,n),o||(a=se(t,"click",l[21]),o=!0)},p:Ce,d(r){r&&T(e),o=!1,a()}}}function ba(l){let e,t,n,o,a,r,u,i,d,p=l[3].id+"",m,_,h,b,v,w=l[3].global_shortcut+"",y,$,k,S,j,D=l[3].default_theme+"",O,E,U,Z,V,A=l[3].default_role+"",C,ne,q,le,Y,H,oe=JSON.stringify(l[3],null,2)+"",N,z=l[3].roles,I=[];for(let L=0;L<z.length;L+=1)I[L]=Io(ko(l,z,L));return{c(){e=f("h4"),e.textContent="Review",t=g(),n=f("div"),o=f("h5"),o.textContent="Configuration Summary:",a=g(),r=f("ul"),u=f("li"),i=f("strong"),i.textContent="Configuration ID:",d=g(),m=P(p),_=g(),h=f("li"),b=f("strong"),b.textContent="Global Shortcut:",v=g(),y=P(w),$=g(),k=f("li"),S=f("strong"),S.textContent="Default Theme:",j=g(),O=P(D),E=g(),U=f("li"),Z=f("strong"),Z.textContent="Default Role:",V=g(),C=P(A),ne=g(),q=f("h5"),q.textContent="Roles:",le=g();for(let L=0;L<I.length;L+=1)I[L].c();Y=g(),H=f("pre"),N=P(oe),c(e,"class","title is-5"),c(n,"class","content"),we(H,"max-height","300px"),we(H,"overflow","auto")},m(L,F){R(L,e,F),R(L,t,F),R(L,n,F),s(n,o),s(n,a),s(n,r),s(r,u),s(u,i),s(u,d),s(u,m),s(r,_),s(r,h),s(h,b),s(h,v),s(h,y),s(r,$),s(r,k),s(k,S),s(k,j),s(k,O),s(r,E),s(r,U),s(U,Z),s(U,V),s(U,C),s(n,ne),s(n,q),s(n,le);for(let ee=0;ee<I.length;ee+=1)I[ee]&&I[ee].m(n,null);R(L,Y,F),R(L,H,F),s(H,N)},p(L,F){if(F[0]&8&&p!==(p=L[3].id+"")&&ve(m,p),F[0]&8&&w!==(w=L[3].global_shortcut+"")&&ve(y,w),F[0]&8&&D!==(D=L[3].default_theme+"")&&ve(O,D),F[0]&8&&A!==(A=L[3].default_role+"")&&ve(C,A),F[0]&10){z=L[3].roles;let ee;for(ee=0;ee<z.length;ee+=1){const J=ko(L,z,ee);I[ee]?I[ee].p(J,F):(I[ee]=Io(J),I[ee].c(),I[ee].m(n,null))}for(;ee<I.length;ee+=1)I[ee].d(1);I.length=z.length}F[0]&8&&oe!==(oe=JSON.stringify(L[3],null,2)+"")&&ve(N,oe)},d(L){L&&T(e),L&&T(t),L&&T(n),tt(I,L),L&&T(Y),L&&T(H)}}}function ka(l){let e,t,n=[],o=new Map,a,r,u,i,d=l[3].roles;const p=m=>m[77].name;for(let m=0;m<d.length;m+=1){let _=wo(l,d,m),h=p(_);o.set(h,n[m]=Bo(h,_))}return{c(){e=f("h4"),e.textContent="Roles",t=g();for(let m=0;m<n.length;m+=1)n[m].c();a=g(),r=f("button"),r.textContent="Add Role",c(e,"class","title is-5"),c(r,"class","button is-link is-light"),c(r,"data-testid","add-role")},m(m,_){R(m,e,_),R(m,t,_);for(let h=0;h<n.length;h+=1)n[h]&&n[h].m(m,_);R(m,a,_),R(m,r,_),u||(i=se(r,"click",l[12]),u=!0)},p(m,_){_[0]&516985&&(d=m[3].roles,n=ar(n,_,p,1,m,d,o,a.parentNode,cr,Bo,a,wo))},d(m){m&&T(e),m&&T(t);for(let _=0;_<n.length;_+=1)n[_].d(m);m&&T(a),m&&T(r),u=!1,i()}}}function wa(l){let e,t,n,o,a,r,u,i,d,p,m,_,h,b,v,w,y,$,k,S,j,D,O,E,U,Z,V,A,C,ne,q,le=l[8],Y=[];for(let N=0;N<le.length;N+=1)Y[N]=Jo(Ao(l,le,N));let H=l[3].roles,oe=[];for(let N=0;N<H.length;N+=1)oe[N]=Vo(Ro(l,H,N));return{c(){e=f("div"),t=f("label"),t.textContent="Configuration ID",n=g(),o=f("div"),a=f("div"),r=f("select"),u=f("option"),u.textContent="Desktop",i=f("option"),i.textContent="Server",d=f("option"),d.textContent="Embedded",p=g(),m=f("div"),_=f("label"),_.textContent="Global shortcut",h=g(),b=f("div"),v=f("input"),w=g(),y=f("div"),$=f("label"),$.textContent="Default theme",k=g(),S=f("div"),j=f("div"),D=f("select");for(let N=0;N<Y.length;N+=1)Y[N].c();O=g(),E=f("div"),U=f("label"),U.textContent="Default Role",Z=g(),V=f("div"),A=f("div"),C=f("select");for(let N=0;N<oe.length;N+=1)oe[N].c();c(t,"class","label"),c(t,"for","config-id"),u.__value="Desktop",u.value=u.__value,i.__value="Server",i.value=i.__value,d.__value="Embedded",d.value=d.__value,c(r,"id","config-id"),l[3].id===void 0&&pt(()=>l[22].call(r)),c(a,"class","select"),c(o,"class","control"),c(e,"class","field"),c(_,"class","label"),c(_,"for","global-shortcut"),c(v,"class","input"),c(v,"id","global-shortcut"),c(v,"type","text"),c(b,"class","control"),c(m,"class","field"),c($,"class","label"),c($,"for","default-theme"),c(D,"id","default-theme"),l[3].default_theme===void 0&&pt(()=>l[24].call(D)),c(j,"class","select is-fullwidth"),c(S,"class","control"),c(y,"class","field"),c(U,"class","label"),c(U,"for","default-role"),c(C,"id","default-role"),l[3].default_role===void 0&&pt(()=>l[25].call(C)),c(A,"class","select"),c(V,"class","control"),c(E,"class","field")},m(N,z){R(N,e,z),s(e,t),s(e,n),s(e,o),s(o,a),s(a,r),s(r,u),s(r,i),s(r,d),Je(r,l[3].id,!0),R(N,p,z),R(N,m,z),s(m,_),s(m,h),s(m,b),s(b,v),De(v,l[3].global_shortcut),R(N,w,z),R(N,y,z),s(y,$),s(y,k),s(y,S),s(S,j),s(j,D);for(let I=0;I<Y.length;I+=1)Y[I]&&Y[I].m(D,null);Je(D,l[3].default_theme,!0),R(N,O,z),R(N,E,z),s(E,U),s(E,Z),s(E,V),s(V,A),s(A,C);for(let I=0;I<oe.length;I+=1)oe[I]&&oe[I].m(C,null);Je(C,l[3].default_role,!0),ne||(q=[se(r,"change",l[22]),se(v,"input",l[23]),se(D,"change",l[24]),se(C,"change",l[25])],ne=!0)},p(N,z){if(z[0]&264&&Je(r,N[3].id),z[0]&264&&v.value!==N[3].global_shortcut&&De(v,N[3].global_shortcut),z[0]&256){le=N[8];let I;for(I=0;I<le.length;I+=1){const L=Ao(N,le,I);Y[I]?Y[I].p(L,z):(Y[I]=Jo(L),Y[I].c(),Y[I].m(D,null))}for(;I<Y.length;I+=1)Y[I].d(1);Y.length=le.length}if(z[0]&264&&Je(D,N[3].default_theme),z[0]&8){H=N[3].roles;let I;for(I=0;I<H.length;I+=1){const L=Ro(N,H,I);oe[I]?oe[I].p(L,z):(oe[I]=Vo(L),oe[I].c(),oe[I].m(C,null))}for(;I<oe.length;I+=1)oe[I].d(1);oe.length=H.length}z[0]&264&&Je(C,N[3].default_role)},d(N){N&&T(e),N&&T(p),N&&T(m),N&&T(w),N&&T(y),tt(Y,N),N&&T(O),N&&T(E),tt(oe,N),ne=!1,lt(q)}}}function Io(l){let e,t,n=l[71].name+"",o,a,r,u,i,d=l[71].shortname+"",p,m,_,h,b,v=l[71].theme+"",w,y,$,k,S,j=l[71].relevance_function+"",D,O,E,U,Z,V;return{c(){e=f("div"),t=f("h6"),o=P(n),a=g(),r=f("p"),u=f("strong"),u.textContent="Shortname:",i=g(),p=P(d),m=g(),_=f("p"),h=f("strong"),h.textContent="Theme:",b=g(),w=P(v),y=g(),$=f("p"),k=f("strong"),k.textContent="Relevance Function:",S=g(),D=P(j),O=g(),E=f("button"),E.textContent="Edit Role",U=g(),c(t,"data-testid","review-role-name-"+l[79]),c(E,"class","button is-small"),c(E,"data-testid","edit-role-"+l[79]),c(e,"class","box")},m(A,C){R(A,e,C),s(e,t),s(t,o),s(e,a),s(e,r),s(r,u),s(r,i),s(r,p),s(e,m),s(e,_),s(_,h),s(_,b),s(_,w),s(e,y),s(e,$),s($,k),s($,S),s($,D),s(e,O),s(e,E),s(e,U),Z||(V=se(E,"click",l[68]),Z=!0)},p(A,C){C[0]&8&&n!==(n=A[71].name+"")&&ve(o,n),C[0]&8&&d!==(d=A[71].shortname+"")&&ve(p,d),C[0]&8&&v!==(v=A[71].theme+"")&&ve(w,v),C[0]&8&&j!==(j=A[71].relevance_function+"")&&ve(D,j)},d(A){A&&T(e),Z=!1,V()}}}function Do(l){let e,t=l[74]+"",n;return{c(){e=f("option"),n=P(t),e.__value=l[74],e.value=e.__value},m(o,a){R(o,e,a),s(e,n)},p:Ce,d(o){o&&T(e)}}}function ya(l){let e;return{c(){e=P("Directory Path")},m(t,n){R(t,e,n)},d(t){t&&T(e)}}}function $a(l){let e;return{c(){e=P("Server URL")},m(t,n){R(t,e,n)},d(t){t&&T(e)}}}function No(l){let e;return{c(){e=f("p"),e.textContent="Click to select directory",c(e,"class","help")},m(t,n){R(t,e,n)},d(t){t&&T(e)}}}function Oo(l){let e,t,n,o,a,r,u,i,d,p,m,_;function h(){l[34].call(u,l[79],l[87])}return{c(){e=f("div"),t=f("label"),n=P("Atomic Server Secret"),a=g(),r=f("div"),u=f("input"),d=g(),p=f("p"),p.textContent="Leave empty for anonymous access",c(t,"class","label"),c(t,"for",o=`haystack-secret-${l[79]}-${l[87]}`),c(u,"class","input"),c(u,"id",i=`haystack-secret-${l[79]}-${l[87]}`),c(u,"type","password"),c(u,"placeholder","Base64 encoded secret (optional)"),c(r,"class","control"),c(p,"class","help"),c(e,"class","field")},m(b,v){R(b,e,v),s(e,t),s(t,n),s(e,a),s(e,r),s(r,u),De(u,l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret),s(e,d),s(e,p),m||(_=se(u,"input",h),m=!0)},p(b,v){l=b,v[0]&264&&o!==(o=`haystack-secret-${l[79]}-${l[87]}`)&&c(t,"for",o),v[0]&264&&i!==(i=`haystack-secret-${l[79]}-${l[87]}`)&&c(u,"id",i),v[0]&264&&u.value!==l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret&&De(u,l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret)},d(b){b&&T(e),m=!1,_()}}}function Po(l){let e,t,n,o,a,r,u,i,d,p,m,_,h,b,v,w,y,$,k,S,j,D,O,E,U,Z,V,A,C,ne,q,le,Y,H,oe,N,z,I,L,F,ee,J,X;function Q(){l[35].call(p,l[79],l[87])}function re(...x){return l[36](l[79],l[87],...x)}let pe=Object.entries(l[3].roles[l[79]].haystacks[l[87]].extra_parameters||{}),ie=[];for(let x=0;x<pe.length;x+=1)ie[x]=Mo(To(l,pe,x));function ae(){return l[40](l[79],l[87])}function be(){return l[41](l[79],l[87])}function K(){return l[42](l[79],l[87])}return{c(){e=f("div"),t=f("label"),t.textContent="Extra Parameters (for filtering)",n=g(),o=f("div"),a=f("div"),r=f("label"),u=P("Hashtag"),d=g(),p=f("input"),_=g(),h=f("div"),b=f("div"),v=f("label"),w=P("Presets"),$=g(),k=f("div"),S=f("select"),j=f("option"),j.textContent="(choose)",D=f("option"),D.textContent="#rust",O=f("option"),O.textContent="#docs",E=f("option"),E.textContent="#test",U=f("option"),U.textContent="#todo",V=g(),A=f("p"),A.innerHTML="When set, searches will enforce the hashtag alongside your query (AND), e.g. <code>-e &quot;search&quot; -e &quot;#rust&quot;</code>.",C=g();for(let x=0;x<ie.length;x+=1)ie[x].c();ne=g(),q=f("div"),le=f("div"),Y=f("button"),Y.textContent="+ Tag Filter",H=g(),oe=f("div"),N=f("button"),N.textContent="+ Max Results",z=g(),I=f("div"),L=f("button"),L.textContent="+ Custom Parameter",F=g(),ee=f("p"),ee.innerHTML=`Common parameters: <code>tag</code> (e.g., &quot;#rust&quot;), <code>glob</code> (e.g., &quot;*.md&quot;),
                  <code>max_count</code> (e.g., &quot;10&quot;), <code>context</code> (e.g., &quot;5&quot;)`,c(t,"class","label"),c(r,"class","label"),c(r,"for",i=`ripgrep-hashtag-${l[79]}-${l[87]}`),c(p,"class","input"),c(p,"id",m=`ripgrep-hashtag-${l[79]}-${l[87]}`),c(p,"type","text"),c(p,"placeholder","#rust"),c(a,"class","control"),c(o,"class","field is-grouped"),c(v,"class","label"),c(v,"for",y=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`),j.__value="",j.value=j.__value,D.__value="#rust",D.value=D.__value,O.__value="#docs",O.value=O.__value,E.__value="#test",E.value=E.__value,U.__value="#todo",U.value=U.__value,c(S,"id",Z=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`),c(k,"class","select is-small"),c(b,"class","control"),c(h,"class","field is-grouped"),we(h,"margin-bottom",".5rem"),c(A,"class","help"),c(Y,"class","button is-small is-link is-light"),c(le,"class","control"),c(N,"class","button is-small is-link is-light"),c(oe,"class","control"),c(L,"class","button is-small is-link is-light"),c(I,"class","control"),c(q,"class","field is-grouped"),c(ee,"class","help"),c(e,"class","field")},m(x,ce){R(x,e,ce),s(e,t),s(e,n),s(e,o),s(o,a),s(a,r),s(r,u),s(a,d),s(a,p),De(p,l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag),s(e,_),s(e,h),s(h,b),s(b,v),s(v,w),s(b,$),s(b,k),s(k,S),s(S,j),s(S,D),s(S,O),s(S,E),s(S,U),s(e,V),s(e,A),s(e,C);for(let ge=0;ge<ie.length;ge+=1)ie[ge]&&ie[ge].m(e,null);s(e,ne),s(e,q),s(q,le),s(le,Y),s(q,H),s(q,oe),s(oe,N),s(q,z),s(q,I),s(I,L),s(e,F),s(e,ee),J||(X=[se(p,"input",Q),se(S,"change",re),se(Y,"click",ae),se(N,"click",be),se(L,"click",K)],J=!0)},p(x,ce){if(l=x,ce[0]&264&&i!==(i=`ripgrep-hashtag-${l[79]}-${l[87]}`)&&c(r,"for",i),ce[0]&264&&m!==(m=`ripgrep-hashtag-${l[79]}-${l[87]}`)&&c(p,"id",m),ce[0]&264&&p.value!==l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag&&De(p,l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag),ce[0]&264&&y!==(y=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`)&&c(v,"for",y),ce[0]&264&&Z!==(Z=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`)&&c(S,"id",Z),ce[0]&393224){pe=Object.entries(l[3].roles[l[79]].haystacks[l[87]].extra_parameters||{});let ge;for(ge=0;ge<pe.length;ge+=1){const ke=To(l,pe,ge);ie[ge]?ie[ge].p(ke,ce):(ie[ge]=Mo(ke),ie[ge].c(),ie[ge].m(e,ne))}for(;ge<ie.length;ge+=1)ie[ge].d(1);ie.length=pe.length}},d(x){x&&T(e),tt(ie,x),J=!1,lt(X)}}}function Mo(l){let e,t,n,o,a,r,u,i,d,p,m,_,h;function b(...y){return l[37](l[79],l[87],l[88],...y)}function v(){l[38].call(u,l[79],l[87],l[88])}function w(){return l[39](l[79],l[87],l[88])}return{c(){e=f("div"),t=f("div"),n=f("input"),a=g(),r=f("div"),u=f("input"),i=g(),d=f("div"),p=f("button"),p.textContent="√ó",m=g(),c(n,"class","input"),c(n,"type","text"),c(n,"placeholder","Parameter name"),n.value=o=l[88],c(t,"class","control"),c(u,"class","input"),c(u,"type","text"),c(u,"placeholder","Parameter value"),c(r,"class","control is-expanded"),c(p,"class","button is-small is-danger"),c(d,"class","control"),c(e,"class","field is-grouped")},m(y,$){R(y,e,$),s(e,t),s(t,n),s(e,a),s(e,r),s(r,u),De(u,l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]]),s(e,i),s(e,d),s(d,p),s(e,m),_||(h=[se(n,"blur",b),se(u,"input",v),se(p,"click",w)],_=!0)},p(y,$){l=y,$[0]&264&&o!==(o=l[88])&&n.value!==o&&(n.value=o),$[0]&264&&u.value!==l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]]&&De(u,l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]])},d(y){y&&T(e),_=!1,lt(h)}}}function jo(l){let e,t,n,o,a,r,u,i,d,p,m,_,h,b,v,w,y,$,k,S,j,D,O,E,U,Z,V,A,C,ne,q,le,Y,H,oe,N,z,I,L;function F(){l[31].call(d,l[79],l[87])}function ee(x,ce){return x[3].roles[x[79]].haystacks[x[87]].service==="Atomic"?$a:ya}let J=ee(l),X=J(l);function Q(){l[32].call(k,l[79],l[87])}function re(){return l[33](l[79],l[87])}let pe=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"&&No(),ie=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"&&Oo(l),ae=l[3].roles[l[79]].haystacks[l[87]].service==="Ripgrep"&&Po(l);function be(){l[43].call(C,l[79],l[87])}function K(){return l[44](l[79],l[87])}return{c(){e=f("div"),t=f("div"),n=f("label"),o=P("Service Type"),r=g(),u=f("div"),i=f("div"),d=f("select"),p=f("option"),p.textContent="Ripgrep (File Search)",m=f("option"),m.textContent="Atomic Server",h=g(),b=f("div"),v=f("label"),X.c(),y=g(),$=f("div"),k=f("input"),O=g(),pe&&pe.c(),E=g(),ie&&ie.c(),U=g(),ae&&ae.c(),Z=g(),V=f("div"),A=f("label"),C=f("input"),q=P(`
                ¬†Read-only`),Y=g(),H=f("div"),oe=f("button"),N=P("Remove Haystack"),c(n,"class","label"),c(n,"for",a=`haystack-service-${l[79]}-${l[87]}`),p.__value="Ripgrep",p.value=p.__value,m.__value="Atomic",m.value=m.__value,c(d,"id",_=`haystack-service-${l[79]}-${l[87]}`),l[3].roles[l[79]].haystacks[l[87]].service===void 0&&pt(F),c(i,"class","select"),c(u,"class","control"),c(t,"class","field"),c(v,"class","label"),c(v,"for",w=`haystack-path-${l[79]}-${l[87]}`),c(k,"class","input"),c(k,"id",S=`haystack-path-${l[79]}-${l[87]}`),c(k,"type","text"),c(k,"placeholder",j=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?"https://localhost:9883":"/path/to/documents"),k.readOnly=D=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic",c($,"class","control"),c(b,"class","field"),c(C,"id",ne=`haystack-readonly-${l[79]}-${l[87]}`),c(C,"type","checkbox"),c(A,"class","checkbox"),c(A,"for",le=`haystack-readonly-${l[79]}-${l[87]}`),c(V,"class","field"),c(oe,"class","button is-small is-danger"),c(oe,"data-testid",z="remove-haystack-"+l[79]+"-"+l[87]),c(H,"class","field"),c(e,"class","box is-light")},m(x,ce){R(x,e,ce),s(e,t),s(t,n),s(n,o),s(t,r),s(t,u),s(u,i),s(i,d),s(d,p),s(d,m),Je(d,l[3].roles[l[79]].haystacks[l[87]].service,!0),s(e,h),s(e,b),s(b,v),X.m(v,null),s(b,y),s(b,$),s($,k),De(k,l[3].roles[l[79]].haystacks[l[87]].path),s($,O),pe&&pe.m($,null),s(e,E),ie&&ie.m(e,null),s(e,U),ae&&ae.m(e,null),s(e,Z),s(e,V),s(V,A),s(A,C),C.checked=l[3].roles[l[79]].haystacks[l[87]].read_only,s(A,q),s(e,Y),s(e,H),s(H,oe),s(oe,N),I||(L=[se(d,"change",F),se(k,"input",Q),se(k,"click",function(){Vl(l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?re:void 0)&&(l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?re:void 0).apply(this,arguments)}),se(C,"change",be),se(oe,"click",K)],I=!0)},p(x,ce){l=x,ce[0]&264&&a!==(a=`haystack-service-${l[79]}-${l[87]}`)&&c(n,"for",a),ce[0]&264&&_!==(_=`haystack-service-${l[79]}-${l[87]}`)&&c(d,"id",_),ce[0]&264&&Je(d,l[3].roles[l[79]].haystacks[l[87]].service),J!==(J=ee(l))&&(X.d(1),X=J(l),X&&(X.c(),X.m(v,null))),ce[0]&264&&w!==(w=`haystack-path-${l[79]}-${l[87]}`)&&c(v,"for",w),ce[0]&264&&S!==(S=`haystack-path-${l[79]}-${l[87]}`)&&c(k,"id",S),ce[0]&264&&j!==(j=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?"https://localhost:9883":"/path/to/documents")&&c(k,"placeholder",j),ce[0]&280&&D!==(D=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic")&&(k.readOnly=D),ce[0]&264&&k.value!==l[3].roles[l[79]].haystacks[l[87]].path&&De(k,l[3].roles[l[79]].haystacks[l[87]].path),l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?pe||(pe=No(),pe.c(),pe.m($,null)):pe&&(pe.d(1),pe=null),l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?ie?ie.p(l,ce):(ie=Oo(l),ie.c(),ie.m(e,U)):ie&&(ie.d(1),ie=null),l[3].roles[l[79]].haystacks[l[87]].service==="Ripgrep"?ae?ae.p(l,ce):(ae=Po(l),ae.c(),ae.m(e,Z)):ae&&(ae.d(1),ae=null),ce[0]&264&&ne!==(ne=`haystack-readonly-${l[79]}-${l[87]}`)&&c(C,"id",ne),ce[0]&264&&(C.checked=l[3].roles[l[79]].haystacks[l[87]].read_only),ce[0]&264&&le!==(le=`haystack-readonly-${l[79]}-${l[87]}`)&&c(A,"for",le),ce[0]&264&&z!==(z="remove-haystack-"+l[79]+"-"+l[87])&&c(oe,"data-testid",z)},d(x){x&&T(e),X.d(),pe&&pe.d(),ie&&ie.d(),ae&&ae.d(),I=!1,lt(L)}}}function Uo(l){var oe;let e,t,n,o,a,r,u,i,d,p,m,_,h,b,v,w,y,$,k,S,j,D,O,E,U,Z,V,A,C;function ne(){l[47].call(u,l[79])}function q(){return l[48](l[79])}let le=((oe=l[0][l[79]])==null?void 0:oe.length)&&zo(l);function Y(){l[50].call(k,l[79])}function H(){l[51].call(E,l[79])}return{c(){e=f("div"),t=f("label"),n=P("Model"),a=g(),r=f("div"),u=f("input"),d=g(),p=f("button"),p.textContent="Fetch models",m=g(),le&&le.c(),_=g(),h=f("div"),b=f("label"),v=P("Base URL"),y=g(),$=f("div"),k=f("input"),j=g(),D=f("div"),O=f("label"),E=f("input"),Z=P(`
              ¬†Automatically summarize search results`),c(t,"class","label"),c(t,"for",o=`llm-model-${l[79]}`),c(u,"class","input"),c(u,"id",i=`llm-model-${l[79]}`),c(u,"type","text"),c(u,"placeholder","llama3.1"),c(r,"class","control"),c(p,"class","button is-small"),c(e,"class","field"),c(b,"class","label"),c(b,"for",w=`llm-base-url-${l[79]}`),c(k,"class","input"),c(k,"id",S=`llm-base-url-${l[79]}`),c(k,"type","text"),c(k,"placeholder","http://127.0.0.1:11434"),c($,"class","control"),c(h,"class","field"),c(E,"id",U=`llm-auto-summarize-${l[79]}`),c(E,"type","checkbox"),c(O,"class","checkbox"),c(O,"for",V=`llm-auto-summarize-${l[79]}`),c(D,"class","field")},m(N,z){R(N,e,z),s(e,t),s(t,n),s(e,a),s(e,r),s(r,u),De(u,l[3].roles[l[79]].llm_model),s(e,d),s(e,p),s(e,m),le&&le.m(e,null),R(N,_,z),R(N,h,z),s(h,b),s(b,v),s(h,y),s(h,$),s($,k),De(k,l[3].roles[l[79]].llm_base_url),R(N,j,z),R(N,D,z),s(D,O),s(O,E),E.checked=l[3].roles[l[79]].llm_auto_summarize,s(O,Z),A||(C=[se(u,"input",ne),se(p,"click",q),se(k,"input",Y),se(E,"change",H)],A=!0)},p(N,z){var I;l=N,z[0]&264&&o!==(o=`llm-model-${l[79]}`)&&c(t,"for",o),z[0]&264&&i!==(i=`llm-model-${l[79]}`)&&c(u,"id",i),z[0]&264&&u.value!==l[3].roles[l[79]].llm_model&&De(u,l[3].roles[l[79]].llm_model),(I=l[0][l[79]])!=null&&I.length?le?le.p(l,z):(le=zo(l),le.c(),le.m(e,null)):le&&(le.d(1),le=null),z[0]&264&&w!==(w=`llm-base-url-${l[79]}`)&&c(b,"for",w),z[0]&264&&S!==(S=`llm-base-url-${l[79]}`)&&c(k,"id",S),z[0]&264&&k.value!==l[3].roles[l[79]].llm_base_url&&De(k,l[3].roles[l[79]].llm_base_url),z[0]&264&&U!==(U=`llm-auto-summarize-${l[79]}`)&&c(E,"id",U),z[0]&264&&(E.checked=l[3].roles[l[79]].llm_auto_summarize),z[0]&264&&V!==(V=`llm-auto-summarize-${l[79]}`)&&c(O,"for",V)},d(N){N&&T(e),le&&le.d(),N&&T(_),N&&T(h),N&&T(j),N&&T(D),A=!1,lt(C)}}}function zo(l){let e,t,n,o,a=l[0][l[79]],r=[];for(let i=0;i<a.length;i+=1)r[i]=Ho($o(l,a,i));function u(...i){return l[49](l[79],...i)}return{c(){e=f("div"),t=f("select");for(let i=0;i<r.length;i+=1)r[i].c();c(e,"class","select is-fullwidth"),we(e,"margin-top","0.5rem")},m(i,d){R(i,e,d),s(e,t);for(let p=0;p<r.length;p+=1)r[p]&&r[p].m(t,null);n||(o=se(t,"change",u),n=!0)},p(i,d){if(l=i,d[0]&9){a=l[0][l[79]];let p;for(p=0;p<a.length;p+=1){const m=$o(l,a,p);r[p]?r[p].p(m,d):(r[p]=Ho(m),r[p].c(),r[p].m(t,null))}for(;p<r.length;p+=1)r[p].d(1);r.length=a.length}},d(i){i&&T(e),tt(r,i),n=!1,o()}}}function Ho(l){let e,t=l[80]+"",n,o;return{c(){e=f("option"),n=P(t),e.__value=o=l[80],e.value=e.__value},m(a,r){R(a,e,r),s(e,n)},p(a,r){r[0]&9&&t!==(t=a[80]+"")&&ve(n,t),r[0]&265&&o!==(o=a[80])&&(e.__value=o,e.value=e.__value)},d(a){a&&T(e)}}}function Fo(l){var ce;let e,t,n,o,a,r,u,i,d,p,m,_,h,b,v,w,y,$,k,S,j,D,O,E,U,Z,V,A,C,ne,q,le,Y,H,oe,N,z,I,L,F,ee,J,X,Q;function re(){l[53].call(u,l[79])}function pe(){l[54].call($,l[79])}function ie(){return l[55](l[79])}let ae=((ce=l[0][l[79]])==null?void 0:ce.length)&&Ko(l);function be(){l[57].call(A,l[79])}function K(){l[58].call(z,l[79])}let x=l[3].roles[l[79]].openrouter_chat_enabled&&qo(l);return{c(){e=f("div"),t=f("label"),n=P("OpenRouter API Key"),a=g(),r=f("div"),u=f("input"),d=g(),p=f("p"),p.innerHTML='Get your API key from <a href="https://openrouter.ai" target="_blank" rel="noopener">OpenRouter</a>',m=g(),_=f("div"),h=f("label"),b=P("Model"),w=g(),y=f("div"),$=f("input"),S=g(),j=f("button"),j.textContent="Fetch models",D=g(),ae&&ae.c(),O=g(),E=f("p"),E.textContent="Choose the language model for generating summaries. Different models offer different speed/quality tradeoffs.",U=g(),Z=f("div"),V=f("label"),A=f("input"),ne=P(`
              ¬†Automatically summarize search results`),le=g(),Y=f("p"),Y.textContent="When enabled, summaries will be generated and shown in search results.",H=g(),oe=f("div"),N=f("label"),z=f("input"),L=P(`
              ¬†Enable Chat interface (OpenRouter)`),ee=g(),x&&x.c(),J=ut(),c(t,"class","label"),c(t,"for",o=`openrouter-api-key-${l[79]}`),c(u,"class","input"),c(u,"id",i=`openrouter-api-key-${l[79]}`),c(u,"type","password"),c(u,"placeholder","sk-or-v1-..."),c(r,"class","control"),c(p,"class","help"),c(e,"class","field"),c(h,"class","label"),c(h,"for",v=`openrouter-model-${l[79]}`),c($,"class","input"),c($,"id",k=`openrouter-model-${l[79]}`),c($,"type","text"),c($,"placeholder","openai/gpt-4-turbo"),c(y,"class","control"),c(j,"class","button is-small"),c(E,"class","help"),c(_,"class","field"),c(A,"id",C=`openrouter-auto-summarize-${l[79]}`),c(A,"type","checkbox"),c(V,"class","checkbox"),c(V,"for",q=`openrouter-auto-summarize-${l[79]}`),c(Y,"class","help"),c(Z,"class","field"),c(z,"id",I=`openrouter-chat-enabled-${l[79]}`),c(z,"type","checkbox"),c(N,"class","checkbox"),c(N,"for",F=`openrouter-chat-enabled-${l[79]}`),c(oe,"class","field")},m(ge,ke){R(ge,e,ke),s(e,t),s(t,n),s(e,a),s(e,r),s(r,u),De(u,l[3].roles[l[79]].openrouter_api_key),s(e,d),s(e,p),R(ge,m,ke),R(ge,_,ke),s(_,h),s(h,b),s(_,w),s(_,y),s(y,$),De($,l[3].roles[l[79]].openrouter_model),s(_,S),s(_,j),s(_,D),ae&&ae.m(_,null),s(_,O),s(_,E),R(ge,U,ke),R(ge,Z,ke),s(Z,V),s(V,A),A.checked=l[3].roles[l[79]].openrouter_auto_summarize,s(V,ne),s(Z,le),s(Z,Y),R(ge,H,ke),R(ge,oe,ke),s(oe,N),s(N,z),z.checked=l[3].roles[l[79]].openrouter_chat_enabled,s(N,L),R(ge,ee,ke),x&&x.m(ge,ke),R(ge,J,ke),X||(Q=[se(u,"input",re),se($,"input",pe),se(j,"click",ie),se(A,"change",be),se(z,"change",K)],X=!0)},p(ge,ke){var Te;l=ge,ke[0]&264&&o!==(o=`openrouter-api-key-${l[79]}`)&&c(t,"for",o),ke[0]&264&&i!==(i=`openrouter-api-key-${l[79]}`)&&c(u,"id",i),ke[0]&264&&u.value!==l[3].roles[l[79]].openrouter_api_key&&De(u,l[3].roles[l[79]].openrouter_api_key),ke[0]&264&&v!==(v=`openrouter-model-${l[79]}`)&&c(h,"for",v),ke[0]&264&&k!==(k=`openrouter-model-${l[79]}`)&&c($,"id",k),ke[0]&264&&$.value!==l[3].roles[l[79]].openrouter_model&&De($,l[3].roles[l[79]].openrouter_model),(Te=l[0][l[79]])!=null&&Te.length?ae?ae.p(l,ke):(ae=Ko(l),ae.c(),ae.m(_,O)):ae&&(ae.d(1),ae=null),ke[0]&264&&C!==(C=`openrouter-auto-summarize-${l[79]}`)&&c(A,"id",C),ke[0]&264&&(A.checked=l[3].roles[l[79]].openrouter_auto_summarize),ke[0]&264&&q!==(q=`openrouter-auto-summarize-${l[79]}`)&&c(V,"for",q),ke[0]&264&&I!==(I=`openrouter-chat-enabled-${l[79]}`)&&c(z,"id",I),ke[0]&264&&(z.checked=l[3].roles[l[79]].openrouter_chat_enabled),ke[0]&264&&F!==(F=`openrouter-chat-enabled-${l[79]}`)&&c(N,"for",F),l[3].roles[l[79]].openrouter_chat_enabled?x?x.p(l,ke):(x=qo(l),x.c(),x.m(J.parentNode,J)):x&&(x.d(1),x=null)},d(ge){ge&&T(e),ge&&T(m),ge&&T(_),ae&&ae.d(),ge&&T(U),ge&&T(Z),ge&&T(H),ge&&T(oe),ge&&T(ee),x&&x.d(ge),ge&&T(J),X=!1,lt(Q)}}}function Ko(l){let e,t,n,o,a=l[0][l[79]],r=[];for(let i=0;i<a.length;i+=1)r[i]=Go(yo(l,a,i));function u(...i){return l[56](l[79],...i)}return{c(){e=f("div"),t=f("select");for(let i=0;i<r.length;i+=1)r[i].c();c(e,"class","select is-fullwidth"),we(e,"margin-top","0.5rem")},m(i,d){R(i,e,d),s(e,t);for(let p=0;p<r.length;p+=1)r[p]&&r[p].m(t,null);n||(o=se(t,"change",u),n=!0)},p(i,d){if(l=i,d[0]&9){a=l[0][l[79]];let p;for(p=0;p<a.length;p+=1){const m=yo(l,a,p);r[p]?r[p].p(m,d):(r[p]=Go(m),r[p].c(),r[p].m(t,null))}for(;p<r.length;p+=1)r[p].d(1);r.length=a.length}},d(i){i&&T(e),tt(r,i),n=!1,o()}}}function Go(l){let e,t=l[80]+"",n,o;return{c(){e=f("option"),n=P(t),e.__value=o=l[80],e.value=e.__value},m(a,r){R(a,e,r),s(e,n)},p(a,r){r[0]&9&&t!==(t=a[80]+"")&&ve(n,t),r[0]&265&&o!==(o=a[80])&&(e.__value=o,e.value=e.__value)},d(a){a&&T(e)}}}function qo(l){let e,t,n,o,a,r,u,i,d,p,m,_,h,b,v,w,y,$,k,S,j,D,O,E,U;function Z(){l[59].call(i,l[79])}function V(){l[60].call(D,l[79])}return{c(){e=f("div"),t=f("label"),n=P("Chat Model"),a=g(),r=f("div"),u=f("div"),i=f("select"),d=f("option"),d.textContent="GPT-3.5 Turbo",p=f("option"),p.textContent="GPT-4",m=f("option"),m.textContent="Claude 3 Sonnet",_=f("option"),_.textContent="Claude 3 Haiku",h=f("option"),h.textContent="Mixtral 8x7B",v=g(),w=f("div"),y=f("label"),$=P("System Prompt (optional)"),S=g(),j=f("div"),D=f("textarea"),c(t,"class","label"),c(t,"for",o=`openrouter-chat-model-${l[79]}`),d.__value="openai/gpt-3.5-turbo",d.value=d.__value,p.__value="openai/gpt-4",p.value=p.__value,m.__value="anthropic/claude-3-sonnet",m.value=m.__value,_.__value="anthropic/claude-3-haiku",_.value=_.__value,h.__value="mistralai/mixtral-8x7b-instruct",h.value=h.__value,c(i,"id",b=`openrouter-chat-model-${l[79]}`),l[3].roles[l[79]].openrouter_chat_model===void 0&&pt(Z),c(u,"class","select is-fullwidth"),c(r,"class","control"),c(e,"class","field"),c(y,"class","label"),c(y,"for",k=`openrouter-chat-system-${l[79]}`),c(D,"class","textarea"),c(D,"id",O=`openrouter-chat-system-${l[79]}`),c(D,"rows","3"),c(D,"placeholder","You are a helpful Rust engineer assistant..."),c(j,"class","control"),c(w,"class","field")},m(A,C){R(A,e,C),s(e,t),s(t,n),s(e,a),s(e,r),s(r,u),s(u,i),s(i,d),s(i,p),s(i,m),s(i,_),s(i,h),Je(i,l[3].roles[l[79]].openrouter_chat_model,!0),R(A,v,C),R(A,w,C),s(w,y),s(y,$),s(w,S),s(w,j),s(j,D),De(D,l[3].roles[l[79]].openrouter_chat_system_prompt),E||(U=[se(i,"change",Z),se(D,"input",V)],E=!0)},p(A,C){l=A,C[0]&264&&o!==(o=`openrouter-chat-model-${l[79]}`)&&c(t,"for",o),C[0]&264&&b!==(b=`openrouter-chat-model-${l[79]}`)&&c(i,"id",b),C[0]&264&&Je(i,l[3].roles[l[79]].openrouter_chat_model),C[0]&264&&k!==(k=`openrouter-chat-system-${l[79]}`)&&c(y,"for",k),C[0]&264&&O!==(O=`openrouter-chat-system-${l[79]}`)&&c(D,"id",O),C[0]&264&&De(D,l[3].roles[l[79]].openrouter_chat_system_prompt)},d(A){A&&T(e),A&&T(v),A&&T(w),E=!1,lt(U)}}}function Wo(l){let e;return{c(){e=f("p"),e.textContent="Click to select directory",c(e,"class","help")},m(t,n){R(t,e,n)},d(t){t&&T(e)}}}function Bo(l,e){let t,n,o,a,r,u,i,d,p,m,_,h,b,v,w,y,$,k,S,j,D,O,E,U,Z,V,A,C,ne,q,le,Y,H,oe,N,z,I,L,F,ee,J,X,Q,re,pe,ie,ae,be,K,x,ce,ge,ke,Te,Ze,Be,Ne,Pe,fe,Re,Me,Xe,xe,ye,He,Ke,qe,Le,Ie,it,Oe,We,G,te,W,ue,Se,$e,Ve,nt,de,Ae,ot,ft,Mt,at,qt,ll,Yt,hl,jt,yt,Xl,wl,xl,yl,Et,$l,en,nl,ol,tn,Cl,ln,Zt,gt,Tl,nn,on,Sl,sl,rl,sn,Rl,rn,Al,Dt,il,al,El,an,cl,Wt,Ut,Ll,cn,Il,un,Xt,zt,Dl,fn,Nl,dn,pn,mn,xt,_n,Ol,zl,hn;function qs(){e[26].call(d,e[79])}function Ws(){e[27].call($,e[79])}let ul=e[8],vt=[];for(let Qe=0;Qe<ul.length;Qe+=1)vt[Qe]=Do(So(e,ul,Qe));function gn(){e[28].call(A,e[79])}function vn(){e[29].call(I,e[79])}function Bs(){e[30].call(ae,e[79])}let fl=e[77].haystacks,bt=[];for(let Qe=0;Qe<fl.length;Qe+=1)bt[Qe]=jo(Co(e,fl,Qe));function Js(){return e[45](e[79])}function bn(){e[46].call(Le,e[79])}let kt=e[3].roles[e[79]].llm_provider==="ollama"&&Uo(e);function Vs(){e[52].call(de,e[79])}let wt=e[3].roles[e[79]].openrouter_enabled&&Fo(e);function Qs(){e[61].call(Et,e[79])}function Ys(){e[62].call(gt,e[79])}function kn(){return e[63](e[79])}let $t=e[4]&&Wo();function wn(){e[64].call(Dt,e[79])}function Zs(){e[65].call(Ut,e[79])}function Xs(){e[66].call(zt,e[79])}function xs(){return e[67](e[79])}return{key:l,first:null,c(){t=f("div"),n=f("div"),o=f("label"),a=P("Role name"),u=g(),i=f("div"),d=f("input"),m=g(),_=f("div"),h=f("label"),b=P("Short name"),w=g(),y=f("div"),$=f("input"),S=g(),j=f("div"),D=f("label"),O=P("Theme"),U=g(),Z=f("div"),V=f("div"),A=f("select");for(let Qe=0;Qe<vt.length;Qe+=1)vt[Qe].c();ne=g(),q=f("div"),le=f("label"),Y=P("Relevance function"),oe=g(),N=f("div"),z=f("div"),I=f("select"),L=f("option"),L.textContent="title-scorer",F=f("option"),F.textContent="terraphim-graph",ee=f("option"),ee.textContent="bm25",J=f("option"),J.textContent="bm25f",X=f("option"),X.textContent="bm25plus",re=g(),pe=f("div"),ie=f("label"),ae=f("input"),K=P(`
            Enable Terraphim IT features (KG preprocessing, auto-linking)`),ce=g(),ge=f("h5"),ge.textContent="Haystacks",ke=g();for(let Qe=0;Qe<bt.length;Qe+=1)bt[Qe].c();Te=g(),Ze=f("button"),Be=P("Add Haystack"),Pe=g(),fe=f("h5"),fe.textContent="AI-Enhanced Summaries (LLM Provider)",Re=g(),Me=f("div"),Xe=f("label"),xe=P("Provider"),He=g(),Ke=f("div"),qe=f("div"),Le=f("select"),Ie=f("option"),Ie.textContent="(none)",it=f("option"),it.textContent="OpenRouter",Oe=f("option"),Oe.textContent="Ollama (local)",G=g(),te=f("p"),te.textContent="Choose a provider. OpenRouter uses API key; Ollama runs locally.",W=g(),kt&&kt.c(),ue=g(),Se=f("h5"),Se.textContent="AI-Enhanced Summaries (OpenRouter)",$e=g(),Ve=f("div"),nt=f("label"),de=f("input"),ot=P(`
            ¬†Enable AI-generated article summaries`),Mt=g(),at=f("p"),at.textContent="Generate intelligent summaries using OpenRouter's language models",qt=g(),wt&&wt.c(),ll=g(),Yt=f("h5"),Yt.textContent="Knowledge Graph",hl=g(),jt=f("div"),yt=f("label"),Xl=P("Remote automata URL"),xl=g(),yl=f("div"),Et=f("input"),en=g(),nl=f("div"),ol=f("label"),tn=P("Local KG path"),ln=g(),Zt=f("div"),gt=f("input"),nn=g(),$t&&$t.c(),on=g(),Sl=f("div"),sl=f("div"),rl=f("label"),sn=P("Local KG type"),rn=g(),Al=f("div"),Dt=f("select"),il=f("option"),il.textContent="markdown",al=f("option"),al.textContent="json",an=g(),cl=f("div"),Wt=f("label"),Ut=f("input"),cn=P(`
            ¬†Public`),un=g(),Xt=f("label"),zt=f("input"),fn=P(`
            ¬†Publish`),dn=g(),pn=f("hr"),mn=g(),xt=f("button"),_n=P("Remove Role"),c(o,"class","label"),c(o,"for",r=`role-name-${e[79]}`),c(d,"class","input"),c(d,"id",p=`role-name-${e[79]}`),c(d,"type","text"),c(i,"class","control"),c(n,"class","field"),c(h,"class","label"),c(h,"for",v=`role-shortname-${e[79]}`),c($,"class","input"),c($,"id",k=`role-shortname-${e[79]}`),c($,"type","text"),c(y,"class","control"),c(_,"class","field"),c(D,"class","label"),c(D,"for",E=`role-theme-${e[79]}`),c(A,"id",C=`role-theme-${e[79]}`),e[3].roles[e[79]].theme===void 0&&pt(gn),c(V,"class","select is-fullwidth"),c(Z,"class","control"),c(j,"class","field"),c(le,"class","label"),c(le,"for",H=`role-relevance-${e[79]}`),L.__value="title-scorer",L.value=L.__value,F.__value="terraphim-graph",F.value=F.__value,ee.__value="bm25",ee.value=ee.__value,J.__value="bm25f",J.value=J.__value,X.__value="bm25plus",X.value=X.__value,c(I,"id",Q=`role-relevance-${e[79]}`),e[3].roles[e[79]].relevance_function===void 0&&pt(vn),c(z,"class","select is-fullwidth"),c(N,"class","control"),c(q,"class","field"),c(ae,"class","checkbox"),c(ae,"id",be=`role-terraphim-it-${e[79]}`),c(ae,"type","checkbox"),c(ie,"class","label"),c(ie,"for",x=`role-terraphim-it-${e[79]}`),c(pe,"class","field"),c(ge,"class","title is-6"),c(Ze,"class","button is-small"),c(Ze,"data-testid",Ne="add-haystack-"+e[79]),c(fe,"class","title is-6"),c(Xe,"class","label"),c(Xe,"for",ye=`llm-provider-${e[79]}`),Ie.__value="",Ie.value=Ie.__value,it.__value="openrouter",it.value=it.__value,Oe.__value="ollama",Oe.value=Oe.__value,c(Le,"id",We=`llm-provider-${e[79]}`),e[3].roles[e[79]].llm_provider===void 0&&pt(bn),c(qe,"class","select"),c(Ke,"class","control"),c(te,"class","help"),c(Me,"class","field"),c(Se,"class","title is-6"),c(de,"id",Ae=`openrouter-enabled-${e[79]}`),c(de,"type","checkbox"),c(nt,"class","checkbox"),c(nt,"for",ft=`openrouter-enabled-${e[79]}`),c(at,"class","help"),c(Ve,"class","field"),c(Yt,"class","title is-6"),c(yt,"class","label"),c(yt,"for",wl=`kg-url-${e[79]}`),c(Et,"class","input"),c(Et,"id",$l=`kg-url-${e[79]}`),c(Et,"type","text"),c(Et,"placeholder","https://example.com/thesaurus.json"),c(yl,"class","control"),c(jt,"class","field"),c(ol,"class","label"),c(ol,"for",Cl=`kg-local-path-${e[79]}`),c(gt,"class","input"),c(gt,"id",Tl=`kg-local-path-${e[79]}`),c(gt,"type","text"),c(gt,"placeholder","/path/to/markdown"),gt.readOnly=e[4],c(Zt,"class","control"),c(nl,"class","field"),c(rl,"class","label"),c(rl,"for",Rl=`kg-local-type-${e[79]}`),il.__value="markdown",il.value=il.__value,al.__value="json",al.value=al.__value,c(Dt,"id",El=`kg-local-type-${e[79]}`),e[3].roles[e[79]].kg.local_type===void 0&&pt(wn),c(Al,"class","select"),c(sl,"class","control"),c(Sl,"class","field is-grouped"),c(Ut,"id",Ll=`kg-public-${e[79]}`),c(Ut,"type","checkbox"),c(Wt,"class","checkbox"),c(Wt,"for",Il=`kg-public-${e[79]}`),we(Wt,"margin-right","1rem"),c(zt,"id",Dl=`kg-publish-${e[79]}`),c(zt,"type","checkbox"),c(Xt,"class","checkbox"),c(Xt,"for",Nl=`kg-publish-${e[79]}`),c(cl,"class","field is-grouped"),c(xt,"class","button is-small is-danger"),c(xt,"data-testid",Ol="remove-role-"+e[79]),c(t,"class","box"),this.first=t},m(Qe,Ee){R(Qe,t,Ee),s(t,n),s(n,o),s(o,a),s(n,u),s(n,i),s(i,d),De(d,e[3].roles[e[79]].name),s(t,m),s(t,_),s(_,h),s(h,b),s(_,w),s(_,y),s(y,$),De($,e[3].roles[e[79]].shortname),s(t,S),s(t,j),s(j,D),s(D,O),s(j,U),s(j,Z),s(Z,V),s(V,A);for(let Fe=0;Fe<vt.length;Fe+=1)vt[Fe]&&vt[Fe].m(A,null);Je(A,e[3].roles[e[79]].theme,!0),s(t,ne),s(t,q),s(q,le),s(le,Y),s(q,oe),s(q,N),s(N,z),s(z,I),s(I,L),s(I,F),s(I,ee),s(I,J),s(I,X),Je(I,e[3].roles[e[79]].relevance_function,!0),s(t,re),s(t,pe),s(pe,ie),s(ie,ae),ae.checked=e[3].roles[e[79]].terraphim_it,s(ie,K),s(t,ce),s(t,ge),s(t,ke);for(let Fe=0;Fe<bt.length;Fe+=1)bt[Fe]&&bt[Fe].m(t,null);s(t,Te),s(t,Ze),s(Ze,Be),s(t,Pe),s(t,fe),s(t,Re),s(t,Me),s(Me,Xe),s(Xe,xe),s(Me,He),s(Me,Ke),s(Ke,qe),s(qe,Le),s(Le,Ie),s(Le,it),s(Le,Oe),Je(Le,e[3].roles[e[79]].llm_provider,!0),s(Me,G),s(Me,te),s(t,W),kt&&kt.m(t,null),s(t,ue),s(t,Se),s(t,$e),s(t,Ve),s(Ve,nt),s(nt,de),de.checked=e[3].roles[e[79]].openrouter_enabled,s(nt,ot),s(Ve,Mt),s(Ve,at),s(t,qt),wt&&wt.m(t,null),s(t,ll),s(t,Yt),s(t,hl),s(t,jt),s(jt,yt),s(yt,Xl),s(jt,xl),s(jt,yl),s(yl,Et),De(Et,e[3].roles[e[79]].kg.url),s(t,en),s(t,nl),s(nl,ol),s(ol,tn),s(nl,ln),s(nl,Zt),s(Zt,gt),De(gt,e[3].roles[e[79]].kg.local_path),s(Zt,nn),$t&&$t.m(Zt,null),s(t,on),s(t,Sl),s(Sl,sl),s(sl,rl),s(rl,sn),s(sl,rn),s(sl,Al),s(Al,Dt),s(Dt,il),s(Dt,al),Je(Dt,e[3].roles[e[79]].kg.local_type,!0),s(t,an),s(t,cl),s(cl,Wt),s(Wt,Ut),Ut.checked=e[3].roles[e[79]].kg.public,s(Wt,cn),s(cl,un),s(cl,Xt),s(Xt,zt),zt.checked=e[3].roles[e[79]].kg.publish,s(Xt,fn),s(t,dn),s(t,pn),s(t,mn),s(t,xt),s(xt,_n),zl||(hn=[se(d,"input",qs),se($,"input",Ws),se(A,"change",gn),se(I,"change",vn),se(ae,"change",Bs),se(Ze,"click",Js),se(Le,"change",bn),se(de,"change",Vs),se(Et,"input",Qs),se(gt,"input",Ys),se(gt,"click",function(){Vl(e[4]?kn:void 0)&&(e[4]?kn:void 0).apply(this,arguments)}),se(Dt,"change",wn),se(Ut,"change",Zs),se(zt,"change",Xs),se(xt,"click",xs)],zl=!0)},p(Qe,Ee){if(e=Qe,Ee[0]&264&&r!==(r=`role-name-${e[79]}`)&&c(o,"for",r),Ee[0]&264&&p!==(p=`role-name-${e[79]}`)&&c(d,"id",p),Ee[0]&264&&d.value!==e[3].roles[e[79]].name&&De(d,e[3].roles[e[79]].name),Ee[0]&264&&v!==(v=`role-shortname-${e[79]}`)&&c(h,"for",v),Ee[0]&264&&k!==(k=`role-shortname-${e[79]}`)&&c($,"id",k),Ee[0]&264&&$.value!==e[3].roles[e[79]].shortname&&De($,e[3].roles[e[79]].shortname),Ee[0]&264&&E!==(E=`role-theme-${e[79]}`)&&c(D,"for",E),Ee[0]&256){ul=e[8];let Fe;for(Fe=0;Fe<ul.length;Fe+=1){const gl=So(e,ul,Fe);vt[Fe]?vt[Fe].p(gl,Ee):(vt[Fe]=Do(gl),vt[Fe].c(),vt[Fe].m(A,null))}for(;Fe<vt.length;Fe+=1)vt[Fe].d(1);vt.length=ul.length}if(Ee[0]&264&&C!==(C=`role-theme-${e[79]}`)&&c(A,"id",C),Ee[0]&264&&Je(A,e[3].roles[e[79]].theme),Ee[0]&264&&H!==(H=`role-relevance-${e[79]}`)&&c(le,"for",H),Ee[0]&264&&Q!==(Q=`role-relevance-${e[79]}`)&&c(I,"id",Q),Ee[0]&264&&Je(I,e[3].roles[e[79]].relevance_function),Ee[0]&264&&be!==(be=`role-terraphim-it-${e[79]}`)&&c(ae,"id",be),Ee[0]&264&&(ae.checked=e[3].roles[e[79]].terraphim_it),Ee[0]&264&&x!==(x=`role-terraphim-it-${e[79]}`)&&c(ie,"for",x),Ee[0]&491576){fl=e[77].haystacks;let Fe;for(Fe=0;Fe<fl.length;Fe+=1){const gl=Co(e,fl,Fe);bt[Fe]?bt[Fe].p(gl,Ee):(bt[Fe]=jo(gl),bt[Fe].c(),bt[Fe].m(t,Te))}for(;Fe<bt.length;Fe+=1)bt[Fe].d(1);bt.length=fl.length}Ee[0]&264&&Ne!==(Ne="add-haystack-"+e[79])&&c(Ze,"data-testid",Ne),Ee[0]&264&&ye!==(ye=`llm-provider-${e[79]}`)&&c(Xe,"for",ye),Ee[0]&264&&We!==(We=`llm-provider-${e[79]}`)&&c(Le,"id",We),Ee[0]&264&&Je(Le,e[3].roles[e[79]].llm_provider),e[3].roles[e[79]].llm_provider==="ollama"?kt?kt.p(e,Ee):(kt=Uo(e),kt.c(),kt.m(t,ue)):kt&&(kt.d(1),kt=null),Ee[0]&264&&Ae!==(Ae=`openrouter-enabled-${e[79]}`)&&c(de,"id",Ae),Ee[0]&264&&(de.checked=e[3].roles[e[79]].openrouter_enabled),Ee[0]&264&&ft!==(ft=`openrouter-enabled-${e[79]}`)&&c(nt,"for",ft),e[3].roles[e[79]].openrouter_enabled?wt?wt.p(e,Ee):(wt=Fo(e),wt.c(),wt.m(t,ll)):wt&&(wt.d(1),wt=null),Ee[0]&264&&wl!==(wl=`kg-url-${e[79]}`)&&c(yt,"for",wl),Ee[0]&264&&$l!==($l=`kg-url-${e[79]}`)&&c(Et,"id",$l),Ee[0]&264&&Et.value!==e[3].roles[e[79]].kg.url&&De(Et,e[3].roles[e[79]].kg.url),Ee[0]&264&&Cl!==(Cl=`kg-local-path-${e[79]}`)&&c(ol,"for",Cl),Ee[0]&264&&Tl!==(Tl=`kg-local-path-${e[79]}`)&&c(gt,"id",Tl),Ee[0]&16&&(gt.readOnly=e[4]),Ee[0]&264&&gt.value!==e[3].roles[e[79]].kg.local_path&&De(gt,e[3].roles[e[79]].kg.local_path),e[4]?$t||($t=Wo(),$t.c(),$t.m(Zt,null)):$t&&($t.d(1),$t=null),Ee[0]&264&&Rl!==(Rl=`kg-local-type-${e[79]}`)&&c(rl,"for",Rl),Ee[0]&264&&El!==(El=`kg-local-type-${e[79]}`)&&c(Dt,"id",El),Ee[0]&264&&Je(Dt,e[3].roles[e[79]].kg.local_type),Ee[0]&264&&Ll!==(Ll=`kg-public-${e[79]}`)&&c(Ut,"id",Ll),Ee[0]&264&&(Ut.checked=e[3].roles[e[79]].kg.public),Ee[0]&264&&Il!==(Il=`kg-public-${e[79]}`)&&c(Wt,"for",Il),Ee[0]&264&&Dl!==(Dl=`kg-publish-${e[79]}`)&&c(zt,"id",Dl),Ee[0]&264&&(zt.checked=e[3].roles[e[79]].kg.publish),Ee[0]&264&&Nl!==(Nl=`kg-publish-${e[79]}`)&&c(Xt,"for",Nl),Ee[0]&264&&Ol!==(Ol="remove-role-"+e[79])&&c(xt,"data-testid",Ol)},d(Qe){Qe&&T(t),tt(vt,Qe),tt(bt,Qe),kt&&kt.d(),wt&&wt.d(),$t&&$t.d(),zl=!1,lt(hn)}}}function Jo(l){let e,t=l[74]+"",n;return{c(){e=f("option"),n=P(t),e.__value=l[74],e.value=e.__value},m(o,a){R(o,e,a),s(e,n)},p:Ce,d(o){o&&T(e)}}}function Vo(l){let e,t=l[71].name+"",n,o;return{c(){e=f("option"),n=P(t),e.__value=o=l[71].name,e.value=e.__value},m(a,r){R(a,e,r),s(e,n)},p(a,r){r[0]&8&&t!==(t=a[71].name+"")&&ve(n,t),r[0]&264&&o!==(o=a[71].name)&&(e.__value=o,e.value=e.__value)},d(a){a&&T(e)}}}function Qo(l){let e,t,n;return{c(){e=f("button"),e.textContent="Back",c(e,"class","button"),c(e,"data-testid","wizard-back")},m(o,a){R(o,e,a),t||(n=se(e,"click",l[11]),t=!0)},p:Ce,d(o){o&&T(e),t=!1,n()}}}function Ca(l){let e,t,n;return{c(){e=f("button"),e.textContent="Save",c(e,"class","button is-success"),c(e,"data-testid","wizard-save")},m(o,a){R(o,e,a),t||(n=se(e,"click",l[19]),t=!0)},p:Ce,d(o){o&&T(e),t=!1,n()}}}function Ta(l){let e,t,n;return{c(){e=f("button"),e.textContent="Next",c(e,"class","button is-primary"),c(e,"data-testid","wizard-next")},m(o,a){R(o,e,a),t||(n=se(e,"click",l[10]),t=!0)},p:Ce,d(o){o&&T(e),t=!1,n()}}}function Sa(l){let e,t,n,o,a,r,u,i,d,p,m,_,h,b,v,w,y,$;e=new _l({props:{fallbackPath:"/"}});let k=l[2]==="success"&&Eo(l),S=l[2]==="error"&&Lo(l);function j(A,C){return A[1]===1?wa:A[1]===2?ka:ba}let D=j(l),O=D(l),E=l[1]>1&&Qo(l);function U(A,C){return A[1]<Gs?Ta:Ca}let Z=U(l),V=Z(l);return{c(){me(e.$$.fragment),t=g(),n=f("div"),o=f("div"),a=f("h3"),a.textContent="Configuration Wizard",r=g(),u=f("button"),u.textContent="Close",i=g(),k&&k.c(),d=g(),S&&S.c(),p=g(),O.c(),m=g(),_=f("nav"),h=f("div"),E&&E.c(),b=g(),v=f("div"),V.c(),c(a,"class","title is-4"),we(a,"margin-bottom","0"),c(u,"class","button is-small is-light"),c(u,"aria-label","Close configuration wizard"),c(o,"class","is-flex is-justify-content-space-between is-align-items-center"),we(o,"gap",".5rem"),c(h,"class","level-left"),c(v,"class","level-right"),c(_,"class","level"),c(n,"class","box")},m(A,C){_e(e,A,C),R(A,t,C),R(A,n,C),s(n,o),s(o,a),s(o,r),s(o,u),s(n,i),k&&k.m(n,null),s(n,d),S&&S.m(n,null),s(n,p),O.m(n,null),s(n,m),s(n,_),s(_,h),E&&E.m(h,null),s(_,b),s(_,v),V.m(v,null),w=!0,y||($=se(u,"click",Ra),y=!0)},p(A,C){A[2]==="success"?k?k.p(A,C):(k=Eo(A),k.c(),k.m(n,d)):k&&(k.d(1),k=null),A[2]==="error"?S?S.p(A,C):(S=Lo(A),S.c(),S.m(n,p)):S&&(S.d(1),S=null),D===(D=j(A))&&O?O.p(A,C):(O.d(1),O=D(A),O&&(O.c(),O.m(n,m))),A[1]>1?E?E.p(A,C):(E=Qo(A),E.c(),E.m(h,null)):E&&(E.d(1),E=null),Z===(Z=U(A))&&V?V.p(A,C):(V.d(1),V=Z(A),V&&(V.c(),V.m(v,null)))},i(A){w||(M(e.$$.fragment,A),w=!0)},o(A){B(e.$$.fragment,A),w=!1},d(A){he(e,A),A&&T(t),A&&T(n),k&&k.d(),S&&S.d(),O.d(),E&&E.d(),V.d(),y=!1,$()}}}const Gs=3;function Ra(){typeof window<"u"&&window.history.back()}function Aa(l,e,t){let n,o;je(l,ct,G=>t(4,o=G));const a=It(null);async function r(G,te){if(Rt(ct))try{const W=await bo({directory:!0,multiple:!1});W&&typeof W=="string"&&i.update(ue=>(ue.roles[G].haystacks[te].path=W,ue))}catch(W){console.error("Failed to open folder selector:",W)}}async function u(G){if(Rt(ct))try{const te=await bo({directory:!0,multiple:!1});te&&typeof te=="string"&&i.update(W=>(W.roles[G].kg.local_path=te,W))}catch(te){console.error("Failed to open folder selector:",te)}}const i=It({id:"Desktop",global_shortcut:"Ctrl+X",default_theme:"spacelab",default_role:"Default",roles:[]});je(l,i,G=>t(3,n=G));const d=["default","darkly","cerulean","cosmo","cyborg","flatly","journal","litera","lumen","lux","materia","minty","nuclear","pulse","sandstone","simplex","slate","solar","spacelab","superhero","united","yeti"];tl(async()=>{try{let G;Rt(ct)?G=await Ge("get_config_schema"):G=await(await fetch("/config/schema")).json(),a.set(G);const te=Rt(Lt);te&&te.id&&i.update(W=>{var ue;return{...W,id:te.id,global_shortcut:te.global_shortcut,default_theme:((ue=te.roles[te.default_role])==null?void 0:ue.theme)??"spacelab",default_role:te.default_role,roles:Object.values(te.roles).map(Se=>{var de,Ae,ot,ft,Mt,at,qt,ll,Yt,hl,jt;const $e=(de=Se.kg)==null?void 0:de.automata_path,Ve=($e==null?void 0:$e.Remote)??"",nt=((ot=(Ae=Se.kg)==null?void 0:Ae.knowledge_graph_local)==null?void 0:ot.path)??"";return{name:Se.name,shortname:Se.shortname,relevance_function:Se.relevance_function,terraphim_it:Se.terraphim_it??!1,theme:Se.theme,haystacks:(Se.haystacks??[]).map(yt=>({path:yt.location||yt.path||"",read_only:yt.read_only??!1,service:yt.service||"Ripgrep",atomic_server_secret:yt.atomic_server_secret||"",extra_parameters:yt.extra_parameters||{}})),kg:{url:Ve,local_path:nt,local_type:((Mt=(ft=Se.kg)==null?void 0:ft.knowledge_graph_local)==null?void 0:Mt.input_type)??"markdown",public:((at=Se.kg)==null?void 0:at.public)??!1,publish:((qt=Se.kg)==null?void 0:qt.publish)??!1},openrouter_enabled:Se.openrouter_enabled??!1,openrouter_api_key:Se.openrouter_api_key??"",openrouter_model:Se.openrouter_model??"openai/gpt-3.5-turbo",openrouter_auto_summarize:Se.openrouter_auto_summarize??!1,openrouter_chat_enabled:Se.openrouter_chat_enabled??!1,openrouter_chat_model:Se.openrouter_chat_model??Se.openrouter_model??"openai/gpt-3.5-turbo",openrouter_chat_system_prompt:Se.openrouter_chat_system_prompt??"",llm_provider:((ll=Se.extra)==null?void 0:ll.llm_provider)??"",llm_model:((Yt=Se.extra)==null?void 0:Yt.llm_model)??"",llm_base_url:((hl=Se.extra)==null?void 0:hl.llm_base_url)??"",llm_auto_summarize:((jt=Se.extra)==null?void 0:jt.llm_auto_summarize)??!1}})}})}catch(G){console.error("Failed to load schema",G)}}),tl(()=>{const G=te=>{te.key==="Escape"&&typeof window<"u"&&window.history.back()};return window.addEventListener("keydown",G),()=>window.removeEventListener("keydown",G)});let p={};async function m(G){var $e;const W=Rt(i).roles[G],ue=W.llm_provider||(W.openrouter_enabled?"openrouter":""),Se=[];try{if(ue==="ollama"){const Ve=(W.llm_base_url||"http://127.0.0.1:11434").replace(/\/$/,""),de=await(await fetch(`${Ve}/api/tags`)).json();if(Array.isArray(de==null?void 0:de.models))for(const Ae of de.models)Ae!=null&&Ae.name&&Se.push(Ae.name)}else if(ue==="openrouter"){const Ve=($e=W.openrouter_api_key)==null?void 0:$e.trim();if(!Ve)throw new Error("OpenRouter API key required");const de=await(await fetch("https://openrouter.ai/api/v1/models",{headers:{Authorization:`Bearer ${Ve}`,"HTTP-Referer":"https://terraphim.ai","X-Title":"Terraphim Desktop"}})).json(),Ae=Array.isArray(de==null?void 0:de.data)?de.data:[];for(const ot of Ae)ot!=null&&ot.id&&Se.push(ot.id)}}catch(Ve){console.error("Failed to fetch models",Ve)}t(0,p={...p,[G]:Se})}let _=1,h="";function b(){_<Gs&&t(1,_+=1)}function v(){_>1&&t(1,_-=1)}function w(){i.update(G=>({...G,roles:[...G.roles,{name:"New Role",shortname:"new",relevance_function:"title-scorer",terraphim_it:!1,theme:"spacelab",haystacks:[],kg:{url:"",local_path:"",local_type:"markdown",public:!1,publish:!1},openrouter_enabled:!1,openrouter_api_key:"",openrouter_model:"openai/gpt-3.5-turbo",openrouter_auto_summarize:!1,openrouter_chat_enabled:!1,openrouter_chat_model:"openai/gpt-3.5-turbo",openrouter_chat_system_prompt:"",llm_provider:"",llm_model:"",llm_base_url:"",llm_auto_summarize:!1}]}))}function y(G){i.update(te=>({...te,roles:te.roles.filter((W,ue)=>ue!==G)}))}function $(G){i.update(te=>(te.roles[G].haystacks.push({path:"",read_only:!1,service:"Ripgrep",atomic_server_secret:"",extra_parameters:{}}),te))}function k(G,te){i.update(W=>(W.roles[G].haystacks=W.roles[G].haystacks.filter((ue,Se)=>Se!==te),W))}function S(G,te,W="",ue=""){i.update(Se=>{Se.roles[G].haystacks[te].extra_parameters||(Se.roles[G].haystacks[te].extra_parameters={});const $e=W||`param_${Date.now()}`;return Se.roles[G].haystacks[te].extra_parameters[$e]=ue,Se})}function j(G,te,W){i.update(ue=>(delete ue.roles[G].haystacks[te].extra_parameters[W],ue))}function D(G,te,W,ue){i.update(Se=>{const $e=Se.roles[G].haystacks[te].extra_parameters;return $e[W]!==void 0&&W!==ue&&($e[ue]=$e[W],delete $e[W]),Se})}function O(G,te,W,ue){const Se=ue.target.value;D(G,te,W,Se)}async function E(){var Se;const G=Rt(i),te=Rt(Lt);let W={...te};W.id=G.id,W.global_shortcut=G.global_shortcut,W.default_role=G.default_role;const ue={};G.roles.forEach($e=>{var Ae,ot;const Ve=$e.name,nt=Ve.replace(/^"|"$/g,"");ue[nt]={extra:((ot=(Ae=te.roles)==null?void 0:Ae[Ve])==null?void 0:ot.extra)??{},name:$e.name,shortname:$e.shortname,theme:$e.theme,relevance_function:$e.relevance_function,terraphim_it:$e.terraphim_it??!1,haystacks:$e.haystacks.map(ft=>({location:ft.path,service:ft.service,read_only:ft.read_only,atomic_server_secret:ft.service==="Atomic"?ft.atomic_server_secret:void 0,extra_parameters:ft.extra_parameters||{}})),kg:$e.kg.url||$e.kg.local_path?{automata_path:$e.kg.url?{Remote:$e.kg.url}:null,knowledge_graph_local:$e.kg.local_path?{input_type:$e.kg.local_type,path:$e.kg.local_path}:null,public:$e.kg.public,publish:$e.kg.publish}:null,...$e.openrouter_enabled&&{openrouter_enabled:$e.openrouter_enabled,openrouter_api_key:$e.openrouter_api_key,openrouter_model:$e.openrouter_model,openrouter_auto_summarize:$e.openrouter_auto_summarize??!1,openrouter_chat_enabled:$e.openrouter_chat_enabled??!1,openrouter_chat_model:$e.openrouter_chat_model??$e.openrouter_model,openrouter_chat_system_prompt:$e.openrouter_chat_system_prompt??""}};const de={};$e.llm_provider&&(de.llm_provider=$e.llm_provider),$e.llm_model&&(de.llm_model=$e.llm_model),$e.llm_base_url&&(de.llm_base_url=$e.llm_base_url),typeof $e.llm_auto_summarize=="boolean"&&(de.llm_auto_summarize=$e.llm_auto_summarize),ue[nt].extra={...ue[nt].extra||{},...de}}),W.roles=ue,(!W.default_role||!ue[W.default_role])&&(W.default_role=((Se=G.roles[0])==null?void 0:Se.name)??"Default"),W.selected_role=W.default_role;try{if(Rt(ct))await Ge("update_config",{configNew:W});else{const $e=await fetch("/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(W)});if(!$e.ok)throw new Error(`HTTP ${$e.status}: ${$e.statusText}`)}Lt.set(W),t(2,h="success"),setTimeout(()=>{t(2,h="")},3e3)}catch($e){console.error($e),t(2,h="error"),setTimeout(()=>{t(2,h="")},3e3)}}const U=()=>t(2,h=""),Z=()=>t(2,h="");function V(){n.id=St(this),i.set(n),t(8,d)}function A(){n.global_shortcut=this.value,i.set(n),t(8,d)}function C(){n.default_theme=St(this),i.set(n),t(8,d)}function ne(){n.default_role=St(this),i.set(n),t(8,d)}function q(G){n.roles[G].name=this.value,i.set(n),t(8,d)}function le(G){n.roles[G].shortname=this.value,i.set(n),t(8,d)}function Y(G){n.roles[G].theme=St(this),i.set(n),t(8,d)}function H(G){n.roles[G].relevance_function=St(this),i.set(n),t(8,d)}function oe(G){n.roles[G].terraphim_it=this.checked,i.set(n),t(8,d)}function N(G,te){n.roles[G].haystacks[te].service=St(this),i.set(n),t(8,d)}function z(G,te){n.roles[G].haystacks[te].path=this.value,i.set(n),t(8,d)}const I=(G,te)=>r(G,te);function L(G,te){n.roles[G].haystacks[te].atomic_server_secret=this.value,i.set(n),t(8,d)}function F(G,te){n.roles[G].haystacks[te].extra_parameters.tag=this.value,i.set(n),t(8,d)}const ee=(G,te,W)=>{const ue=W.currentTarget.value;ue&&Ht(i,n.roles[G].haystacks[te].extra_parameters.tag=ue,n)},J=(G,te,W,ue)=>O(G,te,W,ue);function X(G,te,W){n.roles[G].haystacks[te].extra_parameters[W]=this.value,i.set(n),t(8,d)}const Q=(G,te,W)=>j(G,te,W),re=(G,te)=>S(G,te,"tag","#rust"),pe=(G,te)=>S(G,te,"max_count","10"),ie=(G,te)=>S(G,te,"","");function ae(G,te){n.roles[G].haystacks[te].read_only=this.checked,i.set(n),t(8,d)}const be=(G,te)=>k(G,te),K=G=>$(G);function x(G){n.roles[G].llm_provider=St(this),i.set(n),t(8,d)}function ce(G){n.roles[G].llm_model=this.value,i.set(n),t(8,d)}const ge=G=>m(G),ke=(G,te)=>{Ht(i,n.roles[G].llm_model=te.currentTarget.value,n)};function Te(G){n.roles[G].llm_base_url=this.value,i.set(n),t(8,d)}function Ze(G){n.roles[G].llm_auto_summarize=this.checked,i.set(n),t(8,d)}function Be(G){n.roles[G].openrouter_enabled=this.checked,i.set(n),t(8,d)}function Ne(G){n.roles[G].openrouter_api_key=this.value,i.set(n),t(8,d)}function Pe(G){n.roles[G].openrouter_model=this.value,i.set(n),t(8,d)}const fe=G=>m(G),Re=(G,te)=>{Ht(i,n.roles[G].openrouter_model=te.currentTarget.value,n)};function Me(G){n.roles[G].openrouter_auto_summarize=this.checked,i.set(n),t(8,d)}function Xe(G){n.roles[G].openrouter_chat_enabled=this.checked,i.set(n),t(8,d)}function xe(G){n.roles[G].openrouter_chat_model=St(this),i.set(n),t(8,d)}function ye(G){n.roles[G].openrouter_chat_system_prompt=this.value,i.set(n),t(8,d)}function He(G){n.roles[G].kg.url=this.value,i.set(n),t(8,d)}function Ke(G){n.roles[G].kg.local_path=this.value,i.set(n),t(8,d)}const qe=G=>u(G);function Le(G){n.roles[G].kg.local_type=St(this),i.set(n),t(8,d)}function Ie(G){n.roles[G].kg.public=this.checked,i.set(n),t(8,d)}function it(G){n.roles[G].kg.publish=this.checked,i.set(n),t(8,d)}return[p,_,h,n,o,r,u,i,d,m,b,v,w,y,$,k,S,j,O,E,U,Z,V,A,C,ne,q,le,Y,H,oe,N,z,I,L,F,ee,J,X,Q,re,pe,ie,ae,be,K,x,ce,ge,ke,Te,Ze,Be,Ne,Pe,fe,Re,Me,Xe,xe,ye,He,Ke,qe,Le,Ie,it,G=>y(G),()=>{t(1,_=2)}]}class Ea extends mt{constructor(e){super(),_t(this,e,Aa,Sa,dt,{},null,[-1,-1,-1,-1])}}function La(l){let e,t,n,o,a,r,u,i;return e=new _l({props:{fallbackPath:"/"}}),u=new zs({props:{content:l[0],onChange:l[1]}}),{c(){me(e.$$.fragment),t=g(),n=f("div"),o=f("p"),o.innerHTML="<i>The best editing experience is to configure Atomic Server, in the meantime use editor below. You will need to refresh page via Command R or Ctrl-R to see changes</i>",a=g(),r=f("div"),me(u.$$.fragment),c(r,"class","editor"),c(n,"class","box")},m(d,p){_e(e,d,p),R(d,t,p),R(d,n,p),s(n,o),s(n,a),s(n,r),_e(u,r,null),i=!0},p(d,[p]){const m={};p&1&&(m.content=d[0]),u.$set(m)},i(d){i||(M(e.$$.fragment,d),M(u.$$.fragment,d),i=!0)},o(d){B(e.$$.fragment,d),B(u.$$.fragment,d),i=!1},d(d){he(e,d),d&&T(t),d&&T(n),he(u)}}}function Ia(l,e,t){let n,o;je(l,Lt,u=>t(2,n=u)),je(l,ct,u=>t(3,o=u));let a={json:n};function r(u){if(console.log("contents changed:",u),console.log("is tauri",o),Lt.update(i=>(i=u.json,i)),Rt(ct))console.log("Updating config on server"),Ge("update_config",{configNew:u.json}).then(i=>{console.log(`Message: ${i}`)}).catch(i=>console.error(i));else{let i=`${Ye.ServerURL}/config/`;fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u.json)})}t(0,a=u)}return tl(()=>{t(0,a={json:n})}),[a,r]}class Da extends mt{constructor(e){super(),_t(this,e,Ia,La,dt,{})}}const{window:ql}=ur;function Na(l){let e,t,n,o,a,r,u,i,d,p;return{c(){e=f("div"),t=f("div"),n=f("h3"),n.textContent="Error loading graph",o=g(),a=f("p"),r=P(l[3]),u=g(),i=f("button"),i.textContent="Retry",c(i,"class","button is-primary"),c(t,"class","error-content svelte-1ry9pkl"),c(e,"class","error-overlay svelte-1ry9pkl")},m(m,_){R(m,e,_),s(e,t),s(t,n),s(t,o),s(t,a),s(a,r),s(t,u),s(t,i),d||(p=se(i,"click",l[11]),d=!0)},p(m,_){_&8&&ve(r,m[3])},d(m){m&&T(e),d=!1,p()}}}function Oa(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="loading-content svelte-1ry9pkl"><div class="loader svelte-1ry9pkl"></div> 
        <p>Loading knowledge graph...</p></div>`,c(e,"class","loading-overlay svelte-1ry9pkl")},m(t,n){R(t,e,n)},p:Ce,d(t){t&&T(e)}}}function Yo(l){let e,t,n;return{c(){e=f("button"),e.innerHTML='<i class="fas fa-times svelte-1ry9pkl"></i>',c(e,"class","close-button svelte-1ry9pkl"),c(e,"title","Close Graph")},m(o,a){R(o,e,a),t||(n=se(e,"click",l[17]),t=!0)},p:Ce,d(o){o&&T(e),t=!1,n()}}}function Zo(l){let e;return{c(){e=f("div"),e.innerHTML="<span><strong>Left-click:</strong> View node ‚Ä¢ <strong>Right-click:</strong> Edit node ‚Ä¢ <strong>Drag:</strong> Move ‚Ä¢ <strong>Scroll:</strong> Zoom</span>",c(e,"class","controls-info svelte-1ry9pkl")},m(t,n){R(t,e,n)},d(t){t&&T(e)}}}function Xo(l){let e,t;return{c(){e=f("div"),t=P(l[8]),c(e,"class","debug-message svelte-1ry9pkl")},m(n,o){R(n,e,o),s(e,t)},p(n,o){o&256&&ve(t,n[8])},d(n){n&&T(e)}}}function xo(l){let e=l[5].id,t,n,o=es(l);return{c(){o.c(),t=ut()},m(a,r){o.m(a,r),R(a,t,r),n=!0},p(a,r){r&32&&dt(e,e=a[5].id)?(Ue(),B(o,1,1,Ce),ze(),o=es(a),o.c(),M(o,1),o.m(t.parentNode,t)):o.p(a,r)},i(a){n||(M(o),n=!0)},o(a){B(o),n=!1},d(a){a&&T(t),o.d(a)}}}function es(l){let e,t,n;function o(r){l[18](r)}let a={item:l[5],initialEdit:l[7]};return l[6]!==void 0&&(a.active=l[6]),e=new Yl({props:a}),et.push(()=>st(e,"active",o)),e.$on("close",l[12]),e.$on("save",l[13]),{c(){me(e.$$.fragment)},m(r,u){_e(e,r,u),n=!0},p(r,u){const i={};u&32&&(i.item=r[5]),u&128&&(i.initialEdit=r[7]),!t&&u&64&&(t=!0,i.active=r[6],rt(()=>t=!1)),e.$set(i)},i(r){n||(M(e.$$.fragment,r),n=!0)},o(r){B(e.$$.fragment,r),n=!1},d(r){he(e,r)}}}function Pa(l){let e,t,n,o,a,r,u,i,d,p,m;pt(l[15]),e=new _l({props:{fallbackPath:"/"}});function _(k,S){if(k[2])return Oa;if(k[3])return Na}let h=_(l),b=h&&h(l),v=l[0]&&Yo(l),w=!l[2]&&!l[3]&&l[4].length>0&&Zo(),y=l[8]&&Xo(l),$=l[5]&&xo(l);return{c(){me(e.$$.fragment),t=g(),n=f("div"),b&&b.c(),o=g(),v&&v.c(),a=g(),w&&w.c(),r=g(),y&&y.c(),u=g(),$&&$.c(),i=ut(),c(n,"class","graph-container svelte-1ry9pkl"),we(n,"width",l[0]?"100vw":"600px"),we(n,"height",l[0]?"100vh":"400px"),ht(n,"fullscreen",l[0])},m(k,S){_e(e,k,S),R(k,t,S),R(k,n,S),b&&b.m(n,null),l[16](n),R(k,o,S),v&&v.m(k,S),R(k,a,S),w&&w.m(k,S),R(k,r,S),y&&y.m(k,S),R(k,u,S),$&&$.m(k,S),R(k,i,S),d=!0,p||(m=se(ql,"resize",l[15]),p=!0)},p(k,[S]){h===(h=_(k))&&b?b.p(k,S):(b&&b.d(1),b=h&&h(k),b&&(b.c(),b.m(n,null))),(!d||S&1)&&we(n,"width",k[0]?"100vw":"600px"),(!d||S&1)&&we(n,"height",k[0]?"100vh":"400px"),(!d||S&1)&&ht(n,"fullscreen",k[0]),k[0]?v?v.p(k,S):(v=Yo(k),v.c(),v.m(a.parentNode,a)):v&&(v.d(1),v=null),!k[2]&&!k[3]&&k[4].length>0?w||(w=Zo(),w.c(),w.m(r.parentNode,r)):w&&(w.d(1),w=null),k[8]?y?y.p(k,S):(y=Xo(k),y.c(),y.m(u.parentNode,u)):y&&(y.d(1),y=null),k[5]?$?($.p(k,S),S&32&&M($,1)):($=xo(k),$.c(),M($,1),$.m(i.parentNode,i)):$&&(Ue(),B($,1,1,()=>{$=null}),ze())},i(k){d||(M(e.$$.fragment,k),M($),d=!0)},o(k){B(e.$$.fragment,k),B($),d=!1},d(k){he(e,k),k&&T(t),k&&T(n),b&&b.d(),l[16](null),k&&T(o),v&&v.d(k),k&&T(a),w&&w.d(k),k&&T(r),y&&y.d(k),k&&T(u),$&&$.d(k),k&&T(i),p=!1,m()}}}function ts(l){return{id:`kg-node-${l.id}`,url:`#/graph/node/${l.id}`,title:l.label,body:`# ${l.label}

**Knowledge Graph Node**

ID: ${l.id}
Rank: ${l.rank}

This is a concept node from the knowledge graph. You can edit this content to add more information about "${l.label}".`,description:`Knowledge graph concept: ${l.label}`,tags:["knowledge-graph","concept"],rank:l.rank,stub:`Knowledge graph concept: ${l.label}`}}function Ma(l,e,t){let n,o;je(l,At,C=>t(20,n=C)),je(l,ct,C=>t(21,o=C));let{apiUrl:a="/rolegraph"}=e,{fullscreen:r=!0}=e,u,i=!0,d=null,p=[],m=[],_=null,h=!1,b=!1,v="",w=window.innerWidth,y=window.innerHeight;function $(){t(9,w=window.innerWidth),t(10,y=window.innerHeight),!i&&!d&&E()}async function k(){t(2,i=!0),t(3,d=null);try{if(o){console.log("Loading rolegraph from Tauri");const C=await Ge("get_rolegraph",{role_name:n||void 0});if(C&&C.status==="success")t(4,p=C.nodes),m=C.edges;else throw new Error(`Tauri rolegraph fetch failed: ${(C==null?void 0:C.status)||"unknown error"}`)}else{console.log("Loading rolegraph from server");const C=n?`${a}?role=${encodeURIComponent(n)}`:a,ne=await fetch(C);if(!ne.ok)throw new Error(`Failed to fetch: ${ne.status}`);const q=await ne.json();t(4,p=q.nodes),m=q.edges}}catch(C){t(3,d=C.message),console.error("Error fetching rolegraph:",C)}finally{t(2,i=!1)}}function S(C,ne){C.stopPropagation(),console.log("Node clicked:",ne.label),t(5,_=ts(ne)),t(7,b=!1),t(6,h=!0)}function j(C,ne){C.preventDefault(),C.stopPropagation(),console.log("Node right-clicked:",ne.label),t(8,v=`Right-clicked: ${ne.label}`),t(5,_=ts(ne)),t(7,b=!0),t(6,h=!0),setTimeout(()=>{t(8,v="")},2e3)}function D(){t(6,h=!1),t(5,_=null),t(7,b=!1)}async function O(){if(_)try{const C=await fetch("/documents",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(_)});C.ok?console.log("Successfully saved KG record:",_.id):console.error("Failed to save KG record:",C.statusText)}catch(C){console.error("Error saving KG record:",C)}finally{t(6,h=!1),t(5,_=null),t(7,b=!1)}}function E(){if(!u)return;t(1,u.innerHTML="",u);const C=Kl(u).append("svg").attr("width",w).attr("height",y),ne=Tr().scaleExtent([.1,10]).on("zoom",L=>{q.attr("transform",L.transform)});C.call(ne);const q=C.append("g"),le=Sr(p).force("link",Rr(m).id(L=>L.id).distance(100)).force("charge",Ar().strength(-200)).force("center",Er(w/2,y/2)).force("collision",Lr().radius(20)),Y=q.append("g").attr("class","links").selectAll("line").data(m).enter().append("line").attr("stroke","#666").attr("stroke-opacity",.7).attr("stroke-width",L=>{const F=L.weight||L.rank||1;return Math.max(1,Math.min(8,F*2))}),H=q.append("g").attr("class","nodes").selectAll("circle").data(p).enter().append("circle").attr("r",L=>{const F=L.rank||1;return Math.max(6,Math.min(20,F*2))}).attr("fill",L=>{const F=L.rank||1,ee=Math.min(F/10,1);return Ir(.2+ee*.6)}).attr("stroke","#fff").attr("stroke-width",2).style("cursor","pointer").on("click",(L,F)=>S(L,F)).on("contextmenu",(L,F)=>j(L,F)).on("mouseover",function(L,F){Kl(this).transition().duration(150).attr("stroke-width",3).attr("r",ee=>{const J=ee.rank||1;return Math.max(8,Math.min(24,J*2.5))})}).on("mouseout",function(L,F){Kl(this).transition().duration(150).attr("stroke-width",2).attr("r",ee=>{const J=ee.rank||1;return Math.max(6,Math.min(20,J*2))})}).call(Dr().on("start",N).on("drag",z).on("end",I)),oe=q.append("g").attr("class","labels").selectAll("text").data(p).enter().append("text").attr("text-anchor","middle").attr("dy",".35em").attr("font-size","11px").attr("font-family","Arial, sans-serif").attr("fill","#333").attr("pointer-events","none").text(L=>L.label.length>12?L.label.substring(0,12)+"...":L.label);le.on("tick",()=>{Y.attr("x1",L=>L.source.x).attr("y1",L=>L.source.y).attr("x2",L=>L.target.x).attr("y2",L=>L.target.y),H.attr("cx",L=>L.x).attr("cy",L=>L.y),oe.attr("x",L=>L.x).attr("y",L=>L.y)});function N(L,F){L.active||le.alphaTarget(.3).restart(),F.fx=F.x,F.fy=F.y}function z(L,F){F.fx=L.x,F.fy=L.y}function I(L,F){L.active||le.alphaTarget(0),F.fx=null,F.fy=null}}tl(()=>{k().then(()=>{d||E()});const C=ne=>{ne.preventDefault()};return u&&u.addEventListener("contextmenu",C),window.addEventListener("resize",$),()=>{u&&u.removeEventListener("contextmenu",C),window.removeEventListener("resize",$)}});function U(){t(9,w=ql.innerWidth),t(10,y=ql.innerHeight)}function Z(C){et[C?"unshift":"push"](()=>{u=C,t(1,u)})}const V=()=>history.back();function A(C){h=C,t(6,h)}return l.$$set=C=>{"apiUrl"in C&&t(14,a=C.apiUrl),"fullscreen"in C&&t(0,r=C.fullscreen)},[r,u,i,d,p,_,h,b,v,w,y,k,D,O,a,U,Z,V,A]}class ja extends mt{constructor(e){super(),_t(this,e,Ma,Pa,dt,{apiUrl:14,fullscreen:0})}}function ls(l,e,t){const n=l.slice();return n[19]=e[t][0],n[20]=e[t][1],n[21]=e,n[22]=t,n}function ns(l,e,t){const n=l.slice();return n[23]=e[t],n}function os(l){let e,t,n,o,a,r,u,i,d,p,m,_,h,b,v=l[2].title.trim()==="",w,y,$,k,S,j,D,O,E,U,Z,V,A,C,ne,q=l[2].content.trim()==="",le,Y,H,oe,N,z,I,L,F,ee,J,X,Q,re,pe,ie,ae,be,K,x,ce,ge=l[1]==="edit"?"Save Changes":"Add Context",ke,Te,Ze,Be,Ne,Pe,fe,Re,Me,Xe,xe=l[4],ye=[];for(let te=0;te<xe.length;te+=1)ye[te]=ss(ns(l,xe,te));let He=v&&rs();function Ke(te,W){return te[2].summary?za:Ua}let qe=Ke(l),Le=qe(l),Ie=q&&is();function it(te,W){return W&4&&(J=null),J==null&&(J=Object.keys(te[2].metadata).length===0),J?Fa:Ha}let Oe=it(l,-1),We=Oe(l),G=l[1]==="edit"&&cs(l);return{c(){e=f("section"),t=f("div"),n=f("label"),n.textContent="Type",o=g(),a=f("div"),r=f("div"),u=f("select");for(let te=0;te<ye.length;te+=1)ye[te].c();i=g(),d=f("div"),p=f("label"),p.textContent="Title *",m=g(),_=f("div"),h=f("input"),b=g(),He&&He.c(),w=g(),y=f("div"),$=f("label"),$.textContent="Summary",k=g(),S=f("div"),j=f("textarea"),D=g(),O=f("p"),Le.c(),E=g(),U=f("div"),Z=f("label"),Z.textContent="Content *",V=g(),A=f("div"),C=f("textarea"),ne=g(),Ie&&Ie.c(),le=g(),Y=f("details"),H=f("summary"),H.innerHTML=`<span class="icon-text"><span class="icon"><i class="fas fa-cog"></i></span> 
              <span>Advanced Options</span></span>`,oe=g(),N=f("div"),z=f("label"),z.textContent="Metadata",I=g(),L=f("div"),F=f("p"),F.textContent="Additional key-value pairs for this context item",ee=g(),We.c(),X=g(),Q=f("button"),Q.innerHTML=`<span class="icon"><i class="fas fa-plus"></i></span> 
                <span>Add Metadata</span>`,re=g(),pe=f("footer"),ie=f("div"),ae=f("div"),be=f("button"),K=f("span"),K.innerHTML='<i class="fas fa-save"></i>',x=g(),ce=f("span"),ke=P(ge),Ze=g(),Be=f("div"),Ne=f("button"),Ne.innerHTML="<span>Cancel</span>",Pe=g(),G&&G.c(),fe=g(),Re=f("div"),Re.innerHTML=`<strong>Keyboard shortcuts:</strong>
          Ctrl/Cmd + Enter to save, Escape to close`,c(n,"class","label"),c(n,"for","context-type"),c(u,"id","context-type"),c(u,"data-testid","context-type-select"),l[2].context_type===void 0&&pt(()=>l[10].call(u)),c(r,"class","select is-fullwidth"),c(a,"class","control"),c(t,"class","field"),c(p,"class","label"),c(p,"for","context-title"),c(h,"id","context-title"),c(h,"class","input"),c(h,"type","text"),c(h,"placeholder","Enter title..."),c(h,"data-testid","context-title-input"),h.required=!0,c(_,"class","control"),c(d,"class","field"),c($,"class","label"),c($,"for","context-summary"),c(j,"id","context-summary"),c(j,"class","textarea svelte-1oesbw7"),c(j,"placeholder","Brief summary of the content (optional)..."),c(j,"data-testid","context-summary-textarea"),c(j,"rows","3"),c(j,"maxlength","500"),c(S,"class","control"),c(O,"class","help svelte-1oesbw7"),c(y,"class","field"),c(Z,"class","label"),c(Z,"for","context-content"),c(C,"id","context-content"),c(C,"class","textarea svelte-1oesbw7"),c(C,"placeholder","Enter the full content..."),c(C,"data-testid","context-content-textarea"),c(C,"rows","8"),C.required=!0,c(A,"class","control"),c(U,"class","field"),c(H,"class","summary svelte-1oesbw7"),c(z,"class","label"),c(F,"class","help svelte-1oesbw7"),c(Q,"class","button is-small is-light"),c(L,"class","content"),c(N,"class","field mt-4"),c(Y,"class","details svelte-1oesbw7"),c(e,"class","modal-card-body svelte-1oesbw7"),c(K,"class","icon"),c(be,"class","button is-primary"),be.disabled=Te=!l[3],c(be,"data-testid","save-context-button"),c(ae,"class","control"),c(Ne,"class","button is-light"),c(Ne,"data-testid","cancel-context-button"),c(Be,"class","control"),c(ie,"class","field is-grouped"),c(Re,"class","help svelte-1oesbw7"),c(pe,"class","modal-card-foot")},m(te,W){R(te,e,W),s(e,t),s(t,n),s(t,o),s(t,a),s(a,r),s(r,u);for(let ue=0;ue<ye.length;ue+=1)ye[ue]&&ye[ue].m(u,null);Je(u,l[2].context_type,!0),s(e,i),s(e,d),s(d,p),s(d,m),s(d,_),s(_,h),De(h,l[2].title),s(d,b),He&&He.m(d,null),s(e,w),s(e,y),s(y,$),s(y,k),s(y,S),s(S,j),De(j,l[2].summary),s(y,D),s(y,O),Le.m(O,null),s(e,E),s(e,U),s(U,Z),s(U,V),s(U,A),s(A,C),De(C,l[2].content),s(U,ne),Ie&&Ie.m(U,null),s(e,le),s(e,Y),s(Y,H),s(Y,oe),s(Y,N),s(N,z),s(N,I),s(N,L),s(L,F),s(L,ee),We.m(L,null),s(L,X),s(L,Q),R(te,re,W),R(te,pe,W),s(pe,ie),s(ie,ae),s(ae,be),s(be,K),s(be,x),s(be,ce),s(ce,ke),s(ie,Ze),s(ie,Be),s(Be,Ne),s(ie,Pe),G&&G.m(ie,null),s(pe,fe),s(pe,Re),Me||(Xe=[se(u,"change",l[10]),se(h,"input",l[11]),se(j,"input",l[12]),se(C,"input",l[13]),se(Q,"click",l[17]),se(be,"click",l[6]),se(Ne,"click",l[5])],Me=!0)},p(te,W){if(W&16){xe=te[4];let ue;for(ue=0;ue<xe.length;ue+=1){const Se=ns(te,xe,ue);ye[ue]?ye[ue].p(Se,W):(ye[ue]=ss(Se),ye[ue].c(),ye[ue].m(u,null))}for(;ue<ye.length;ue+=1)ye[ue].d(1);ye.length=xe.length}W&20&&Je(u,te[2].context_type),W&20&&h.value!==te[2].title&&De(h,te[2].title),W&4&&(v=te[2].title.trim()===""),v?He||(He=rs(),He.c(),He.m(d,null)):He&&(He.d(1),He=null),W&20&&De(j,te[2].summary),qe===(qe=Ke(te))&&Le?Le.p(te,W):(Le.d(1),Le=qe(te),Le&&(Le.c(),Le.m(O,null))),W&20&&De(C,te[2].content),W&4&&(q=te[2].content.trim()===""),q?Ie||(Ie=is(),Ie.c(),Ie.m(U,null)):Ie&&(Ie.d(1),Ie=null),Oe===(Oe=it(te,W))&&We?We.p(te,W):(We.d(1),We=Oe(te),We&&(We.c(),We.m(L,X))),W&2&&ge!==(ge=te[1]==="edit"?"Save Changes":"Add Context")&&ve(ke,ge),W&8&&Te!==(Te=!te[3])&&(be.disabled=Te),te[1]==="edit"?G?G.p(te,W):(G=cs(te),G.c(),G.m(ie,null)):G&&(G.d(1),G=null)},d(te){te&&T(e),tt(ye,te),He&&He.d(),Le.d(),Ie&&Ie.d(),We.d(),te&&T(re),te&&T(pe),G&&G.d(),Me=!1,lt(Xe)}}}function ss(l){let e,t=l[23].label+"",n;return{c(){e=f("option"),n=P(t),e.__value=l[23].value,e.value=e.__value},m(o,a){R(o,e,a),s(e,n)},p:Ce,d(o){o&&T(e)}}}function rs(l){let e;return{c(){e=f("p"),e.textContent="Title is required",c(e,"class","help is-danger svelte-1oesbw7")},m(t,n){R(t,e,n)},d(t){t&&T(e)}}}function Ua(l){let e;return{c(){e=P("Optional brief summary (up to 500 characters)")},m(t,n){R(t,e,n)},p:Ce,d(t){t&&T(e)}}}function za(l){let e=l[2].summary.length+"",t,n;return{c(){t=P(e),n=P("/500 characters")},m(o,a){R(o,t,a),R(o,n,a)},p(o,a){a&4&&e!==(e=o[2].summary.length+"")&&ve(t,e)},d(o){o&&T(t),o&&T(n)}}}function is(l){let e;return{c(){e=f("p"),e.textContent="Content is required",c(e,"class","help is-danger svelte-1oesbw7")},m(t,n){R(t,e,n)},d(t){t&&T(e)}}}function Ha(l){let e,t=Object.entries(l[2].metadata),n=[];for(let o=0;o<t.length;o+=1)n[o]=as(ls(l,t,o));return{c(){for(let o=0;o<n.length;o+=1)n[o].c();e=ut()},m(o,a){for(let r=0;r<n.length;r+=1)n[r]&&n[r].m(o,a);R(o,e,a)},p(o,a){if(a&4){t=Object.entries(o[2].metadata);let r;for(r=0;r<t.length;r+=1){const u=ls(o,t,r);n[r]?n[r].p(u,a):(n[r]=as(u),n[r].c(),n[r].m(e.parentNode,e))}for(;r<n.length;r+=1)n[r].d(1);n.length=t.length}},d(o){tt(n,o),o&&T(e)}}}function Fa(l){let e;return{c(){e=f("p"),e.textContent="No metadata defined",c(e,"class","has-text-grey-light")},m(t,n){R(t,e,n)},p:Ce,d(t){t&&T(e)}}}function as(l){let e,t,n,o,a,r,u,i,d,p,m,_,h;function b(...y){return l[14](l[19],l[20],...y)}function v(){l[15].call(u,l[19])}function w(){return l[16](l[19])}return{c(){e=f("div"),t=f("div"),n=f("input"),a=g(),r=f("div"),u=f("input"),i=g(),d=f("div"),p=f("button"),p.innerHTML='<span class="icon"><i class="fas fa-times"></i></span>',m=g(),c(n,"class","input is-small"),c(n,"type","text"),c(n,"placeholder","Key"),n.value=o=l[19],c(t,"class","control is-expanded"),c(u,"class","input is-small"),c(u,"type","text"),c(u,"placeholder","Value"),c(r,"class","control is-expanded"),c(p,"class","button is-small is-danger is-outlined"),c(d,"class","control"),c(e,"class","field is-grouped")},m(y,$){R(y,e,$),s(e,t),s(t,n),s(e,a),s(e,r),s(r,u),De(u,l[2].metadata[l[19]]),s(e,i),s(e,d),s(d,p),s(e,m),_||(h=[se(n,"input",b),se(u,"input",v),se(p,"click",w)],_=!0)},p(y,$){l=y,$&20&&o!==(o=l[19])&&n.value!==o&&(n.value=o),$&20&&u.value!==l[2].metadata[l[19]]&&De(u,l[2].metadata[l[19]])},d(y){y&&T(e),_=!1,lt(h)}}}function cs(l){let e,t,n,o,a,r;return{c(){e=f("div"),t=g(),n=f("div"),o=f("button"),o.innerHTML=`<span class="icon"><i class="fas fa-trash"></i></span> 
                <span>Delete</span>`,c(e,"class","control is-expanded"),c(o,"class","button is-danger is-outlined"),c(o,"data-testid","delete-context-button"),c(n,"class","control")},m(u,i){R(u,e,i),R(u,t,i),R(u,n,i),s(n,o),a||(r=se(o,"click",l[7]),a=!0)},p:Ce,d(u){u&&T(e),u&&T(t),u&&T(n),a=!1,r()}}}function Ka(l){let e,t,n,o=l[1]==="edit"?"Edit Context Item":"Add Context Item",a,r,u,i,d,p,m=l[2]&&os(l);return{c(){e=f("div"),t=f("header"),n=f("p"),a=P(o),r=g(),u=f("button"),i=g(),m&&m.c(),c(n,"class","modal-card-title"),c(u,"class","delete"),c(u,"aria-label","close"),c(t,"class","modal-card-head"),c(e,"class","modal-card")},m(_,h){R(_,e,h),s(e,t),s(t,n),s(n,a),s(t,r),s(t,u),s(e,i),m&&m.m(e,null),d||(p=se(u,"click",l[5]),d=!0)},p(_,h){h&2&&o!==(o=_[1]==="edit"?"Edit Context Item":"Add Context Item")&&ve(a,o),_[2]?m?m.p(_,h):(m=os(_),m.c(),m.m(e,null)):m&&(m.d(1),m=null)},d(_){_&&T(e),m&&m.d(),d=!1,p()}}}function Ga(l){let e,t,n,o;return e=new kl({props:{active:l[0],$$slots:{default:[Ka]},$$scope:{ctx:l}}}),e.$on("close",l[5]),{c(){me(e.$$.fragment)},m(a,r){_e(e,a,r),t=!0,n||(o=se(window,"keydown",l[8]),n=!0)},p(a,[r]){const u={};r&1&&(u.active=a[0]),r&67108878&&(u.$$scope={dirty:r,ctx:a}),e.$set(u)},i(a){t||(M(e.$$.fragment,a),t=!0)},o(a){B(e.$$.fragment,a),t=!1},d(a){he(e,a),n=!1,o()}}}function qa(l,e,t){let n,{active:o=!1}=e,{context:a=null}=e,{mode:r="edit"}=e;const u=Ql();let i=null,d=[{value:"Document",label:"Document"},{value:"SearchResult",label:"Search Result"},{value:"UserInput",label:"User Input"},{value:"System",label:"System"},{value:"External",label:"External"}];function p(){t(0,o=!1),t(2,i=null),u("close")}function m(){!n||!i||(u(r==="edit"?"update":"create",i),p())}function _(){r==="edit"&&a&&(u("delete",a.id),p())}function h(D){D.key==="Escape"?p():D.key==="Enter"&&(D.ctrlKey||D.metaKey)&&m()}function b(){i.context_type=St(this),t(2,i),t(0,o),t(9,a),t(1,r),t(4,d)}function v(){i.title=this.value,t(2,i),t(0,o),t(9,a),t(1,r),t(4,d)}function w(){i.summary=this.value,t(2,i),t(0,o),t(9,a),t(1,r),t(4,d)}function y(){i.content=this.value,t(2,i),t(0,o),t(9,a),t(1,r),t(4,d)}const $=(D,O,E)=>{const U={...i.metadata};delete U[D],U[E.target.value]=O,t(2,i.metadata=U,i)};function k(D){i.metadata[D]=this.value,t(2,i),t(0,o),t(9,a),t(1,r),t(4,d)}const S=D=>{const O={...i.metadata};delete O[D],t(2,i.metadata=O,i)},j=()=>{t(2,i.metadata={...i.metadata,[`key_${Date.now()}`]:""},i)};return l.$$set=D=>{"active"in D&&t(0,o=D.active),"context"in D&&t(9,a=D.context),"mode"in D&&t(1,r=D.mode)},l.$$.update=()=>{l.$$.dirty&515&&(o&&a?t(2,i={...a,metadata:{...a.metadata}}):o&&r==="create"&&t(2,i={id:"",context_type:"UserInput",title:"",summary:"",content:"",metadata:{},created_at:new Date().toISOString(),relevance_score:null})),l.$$.dirty&4&&t(3,n=i&&i.title.trim()!==""&&i.content.trim()!=="")},[o,r,i,n,d,p,m,_,h,a,b,v,w,y,$,k,S,j]}class Wa extends mt{constructor(e){super(),_t(this,e,qa,Ga,dt,{active:0,context:9,mode:1})}}function us(l,e,t){const n=l.slice();return n[26]=e[t],n}function Ba(l){let e,t,n,o;function a(i){l[16](i)}function r(i){l[17](i)}let u={placeholder:"Search knowledge graph terms...",type:"search",disabled:l[4]};return l[2]!==void 0&&(u.element=l[2]),l[1]!==void 0&&(u.value=l[1]),e=new Vt({props:u}),et.push(()=>st(e,"element",a)),et.push(()=>st(e,"value",r)),e.$on("input",l[8]),{c(){me(e.$$.fragment)},m(i,d){_e(e,i,d),o=!0},p(i,d){const p={};d&16&&(p.disabled=i[4]),!t&&d&4&&(t=!0,p.element=i[2],rt(()=>t=!1)),!n&&d&2&&(n=!0,p.value=i[1],rt(()=>n=!1)),e.$set(p)},i(i){o||(M(e.$$.fragment,i),o=!0)},o(i){B(e.$$.fragment,i),o=!1},d(i){he(e,i)}}}function fs(l){let e,t;return e=new Bl({props:{type:"is-danger",$$slots:{default:[Ja]},$$scope:{ctx:l}}}),{c(){me(e.$$.fragment)},m(n,o){_e(e,n,o),t=!0},p(n,o){const a={};o&536870944&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function Ja(l){let e;return{c(){e=P(l[5])},m(t,n){R(t,e,n)},p(t,n){n&32&&ve(e,t[5])},d(t){t&&T(e)}}}function Va(l){let e,t,n,o,a,r,u;return{c(){e=f("div"),t=f("p"),t.textContent="Enter at least 2 characters to search the knowledge graph",n=g(),o=f("p"),a=P('This will search terms from the knowledge graph for role "'),r=P(l[7]),u=P('"'),c(t,"class","has-text-centered"),c(o,"class","has-text-centered is-size-7 mt-2"),c(e,"class","notification is-info is-light")},m(i,d){R(i,e,d),s(e,t),s(e,n),s(e,o),s(o,a),s(o,r),s(o,u)},p(i,d){d&128&&ve(r,i[7])},i:Ce,o:Ce,d(i){i&&T(e)}}}function Qa(l){let e,t,n,o,a,r,u,i,d,p,m;return{c(){e=f("div"),t=f("p"),n=P('No knowledge graph terms found for "'),o=f("strong"),a=P(l[1]),r=P('"'),u=g(),i=f("p"),d=P('Try different keywords or check if the role "'),p=P(l[7]),m=P('" has a knowledge graph enabled.'),c(t,"class","has-text-centered"),c(i,"class","has-text-centered is-size-7 has-text-grey mt-2"),c(e,"class","notification is-light")},m(_,h){R(_,e,h),s(e,t),s(t,n),s(t,o),s(o,a),s(t,r),s(e,u),s(e,i),s(i,d),s(i,p),s(i,m)},p(_,h){h&2&&ve(a,_[1]),h&128&&ve(p,_[7])},i:Ce,o:Ce,d(_){_&&T(e)}}}function Ya(l){let e,t,n,o=l[3],a=[];for(let r=0;r<o.length;r+=1)a[r]=_s(us(l,o,r));return{c(){e=f("div"),t=f("div"),n=f("ul");for(let r=0;r<a.length;r+=1)a[r].c();c(n,"class","menu-list"),c(t,"class","menu"),c(e,"class","box")},m(r,u){R(r,e,u),s(e,t),s(t,n);for(let i=0;i<a.length;i+=1)a[i]&&a[i].m(n,null)},p(r,u){if(u&584){o=r[3];let i;for(i=0;i<o.length;i+=1){const d=us(r,o,i);a[i]?a[i].p(d,u):(a[i]=_s(d),a[i].c(),a[i].m(n,null))}for(;i<a.length;i+=1)a[i].d(1);a.length=o.length}},i:Ce,o:Ce,d(r){r&&T(e),tt(a,r)}}}function Za(l){let e,t,n,o,a,r;return n=new fr({}),{c(){e=f("div"),t=f("div"),me(n.$$.fragment),o=g(),a=f("p"),a.textContent="Searching knowledge graph...",c(t,"class","progress"),c(e,"class","empty-state")},m(u,i){R(u,e,i),s(e,t),_e(n,t,null),s(e,o),s(e,a),r=!0},p:Ce,i(u){r||(M(n.$$.fragment,u),r=!0)},o(u){B(n.$$.fragment,u),r=!1},d(u){u&&T(e),he(n)}}}function ds(l){let e,t,n=l[26].normalized_term+"",o;return{c(){e=f("span"),t=P("‚Üí "),o=P(n),c(e,"class","has-text-grey ml-2")},m(a,r){R(a,e,r),s(e,t),s(e,o)},p(a,r){r&8&&n!==(n=a[26].normalized_term+"")&&ve(o,n)},d(a){a&&T(e)}}}function ps(l){let e,t=l[26].suggestion_type+"",n;return{c(){e=f("span"),n=P(t),c(e,"class","tag is-small is-light ml-2")},m(o,a){R(o,e,a),s(e,n)},p(o,a){a&8&&t!==(t=o[26].suggestion_type+"")&&ve(n,t)},d(o){o&&T(e)}}}function ms(l){let e,t=l[26].url+"",n;return{c(){e=f("div"),n=P(t),c(e,"class","has-text-grey is-italic is-size-7 mt-1")},m(o,a){R(o,e,a),s(e,n)},p(o,a){a&8&&t!==(t=o[26].url+"")&&ve(n,t)},d(o){o&&T(e)}}}function _s(l){let e,t,n,o,a=l[26].term+"",r,u,i,d,p=(l[26].score*100).toFixed(0)+"",m,_,h,b,v,w,y,$,k,S=l[26].normalized_term&&l[26].normalized_term!==l[26].term&&ds(l),j=l[26].suggestion_type&&ps(l),D=l[26].url&&ms(l);function O(){return l[18](l[26])}function E(...U){return l[19](l[26],...U)}return{c(){var U;e=f("li"),t=f("a"),n=f("div"),o=f("div"),r=P(a),u=g(),i=f("div"),d=f("span"),m=P(p),_=P("%"),h=g(),S&&S.c(),b=g(),j&&j.c(),v=g(),D&&D.c(),y=g(),c(o,"class","has-text-weight-semibold"),c(d,"class","tag is-info is-small"),c(i,"class","is-size-7 mt-1"),c(t,"class",w="menu-item "+(((U=l[6])==null?void 0:U.term)===l[26].term?"is-active":"")),c(t,"href","#")},m(U,Z){R(U,e,Z),s(e,t),s(t,n),s(n,o),s(o,r),s(n,u),s(n,i),s(i,d),s(d,m),s(d,_),s(i,h),S&&S.m(i,null),s(i,b),j&&j.m(i,null),s(n,v),D&&D.m(n,null),s(e,y),$||(k=[se(t,"click",O),se(t,"keydown",E)],$=!0)},p(U,Z){var V;l=U,Z&8&&a!==(a=l[26].term+"")&&ve(r,a),Z&8&&p!==(p=(l[26].score*100).toFixed(0)+"")&&ve(m,p),l[26].normalized_term&&l[26].normalized_term!==l[26].term?S?S.p(l,Z):(S=ds(l),S.c(),S.m(i,b)):S&&(S.d(1),S=null),l[26].suggestion_type?j?j.p(l,Z):(j=ps(l),j.c(),j.m(i,null)):j&&(j.d(1),j=null),l[26].url?D?D.p(l,Z):(D=ms(l),D.c(),D.m(n,null)):D&&(D.d(1),D=null),Z&72&&w!==(w="menu-item "+(((V=l[6])==null?void 0:V.term)===l[26].term?"is-active":""))&&c(t,"class",w)},d(U){U&&T(e),S&&S.d(),j&&j.d(),D&&D.d(),$=!1,lt(k)}}}function Xa(l){let e;return{c(){e=P("Cancel")},m(t,n){R(t,e,n)},d(t){t&&T(e)}}}function hs(l){let e,t,n;return t=new Kt({props:{type:"is-primary",disabled:!l[6],$$slots:{default:[xa]},$$scope:{ctx:l}}}),t.$on("click",l[10]),{c(){e=f("p"),me(t.$$.fragment),c(e,"class","control")},m(o,a){R(o,e,a),_e(t,e,null),n=!0},p(o,a){const r={};a&64&&(r.disabled=!o[6]),a&536870976&&(r.$$scope={dirty:a,ctx:o}),t.$set(r)},i(o){n||(M(t.$$.fragment,o),n=!0)},o(o){B(t.$$.fragment,o),n=!1},d(o){o&&T(e),he(t)}}}function xa(l){let e,t=l[6].term+"",n,o;return{c(){e=P('Add "'),n=P(t),o=P('" to Context')},m(a,r){R(a,e,r),R(a,n,r),R(a,o,r)},p(a,r){r&64&&t!==(t=a[6].term+"")&&ve(n,t)},d(a){a&&T(e),a&&T(n),a&&T(o)}}}function ec(l){let e;return{c(){e=P("Add Complete Thesaurus to Context")},m(t,n){R(t,e,n)},d(t){t&&T(e)}}}function tc(l){let e,t,n,o,a,r,u,i,d,p,m,_,h,b,v,w,y,$,k,S,j,D,O,E,U,Z,V;o=new Ft({props:{$$slots:{default:[Ba]},$$scope:{ctx:l}}});let A=l[5]&&fs(l);const C=[Za,Ya,Qa,Va],ne=[];function q(Y,H){return H&2&&(u=null),Y[4]?0:Y[3].length>0?1:(u==null&&(u=Y[1].trim().length>=2),u?2:3)}i=q(l,-1),d=ne[i]=C[i](l),h=new Kt({props:{$$slots:{default:[Xa]},$$scope:{ctx:l}}}),h.$on("click",l[12]);let le=l[6]&&hs(l);return E=new Kt({props:{type:"is-link",size:"is-small",$$slots:{default:[ec]},$$scope:{ctx:l}}}),E.$on("click",l[11]),{c(){e=f("div"),t=f("div"),t.innerHTML=`<h3 class="title is-4">Knowledge Graph Search</h3> 
      <p class="subtitle is-6">Search and add terms from the knowledge graph to your context</p>`,n=g(),me(o.$$.fragment),a=g(),A&&A.c(),r=g(),d.c(),p=g(),m=f("div"),_=f("p"),me(h.$$.fragment),b=g(),le&&le.c(),v=g(),w=f("div"),y=f("div"),$=f("p"),k=f("strong"),k.textContent="Alternative:",S=P(' Add the complete thesaurus for role "'),j=P(l[7]),D=P('". This includes all domain-specific terms and their normalized mappings in JSON format for comprehensive vocabulary context.'),O=g(),me(E.$$.fragment),c(t,"class","mb-5"),c(_,"class","control"),c(m,"class","field is-grouped is-grouped-right mt-5"),c(y,"class","content is-small mb-3"),c(w,"class","mt-5 pt-5"),we(w,"border-top","1px solid hsl(0, 0%, 86%)"),c(e,"class","kg-search-container svelte-1parw1b")},m(Y,H){R(Y,e,H),s(e,t),s(e,n),_e(o,e,null),s(e,a),A&&A.m(e,null),s(e,r),ne[i].m(e,null),s(e,p),s(e,m),s(m,_),_e(h,_,null),s(m,b),le&&le.m(m,null),s(e,v),s(e,w),s(w,y),s(y,$),s($,k),s($,S),s($,j),s($,D),s(w,O),_e(E,w,null),U=!0,Z||(V=se(e,"keydown",l[13]),Z=!0)},p(Y,H){const oe={};H&536870934&&(oe.$$scope={dirty:H,ctx:Y}),o.$set(oe),Y[5]?A?(A.p(Y,H),H&32&&M(A,1)):(A=fs(Y),A.c(),M(A,1),A.m(e,r)):A&&(Ue(),B(A,1,1,()=>{A=null}),ze());let N=i;i=q(Y,H),i===N?ne[i].p(Y,H):(Ue(),B(ne[N],1,1,()=>{ne[N]=null}),ze(),d=ne[i],d?d.p(Y,H):(d=ne[i]=C[i](Y),d.c()),M(d,1),d.m(e,p));const z={};H&536870912&&(z.$$scope={dirty:H,ctx:Y}),h.$set(z),Y[6]?le?(le.p(Y,H),H&64&&M(le,1)):(le=hs(Y),le.c(),M(le,1),le.m(m,null)):le&&(Ue(),B(le,1,1,()=>{le=null}),ze()),(!U||H&128)&&ve(j,Y[7]);const I={};H&536870912&&(I.$$scope={dirty:H,ctx:Y}),E.$set(I)},i(Y){U||(M(o.$$.fragment,Y),M(A),M(d),M(h.$$.fragment,Y),M(le),M(E.$$.fragment,Y),U=!0)},o(Y){B(o.$$.fragment,Y),B(A),B(d),B(h.$$.fragment,Y),B(le),B(E.$$.fragment,Y),U=!1},d(Y){Y&&T(e),he(o),A&&A.d(),ne[i].d(),he(h),le&&le.d(),he(E),Z=!1,V()}}}function lc(l){let e,t,n;function o(r){l[20](r)}let a={$$slots:{default:[tc]},$$scope:{ctx:l}};return l[0]!==void 0&&(a.active=l[0]),e=new kl({props:a}),et.push(()=>st(e,"active",o)),e.$on("close",l[12]),{c(){me(e.$$.fragment)},m(r,u){_e(e,r,u),n=!0},p(r,[u]){const i={};u&536871166&&(i.$$scope={dirty:u,ctx:r}),!t&&u&1&&(t=!0,i.active=r[0],rt(()=>t=!1)),e.$set(i)},i(r){n||(M(e.$$.fragment,r),n=!0)},o(r){B(e.$$.fragment,r),n=!1},d(r){he(e,r)}}}function nc(l,e,t){let n,o;je(l,At,C=>t(7,n=C)),je(l,ct,C=>t(22,o=C));let{active:a=!1}=e,{initialQuery:r=""}=e,{conversationId:u=null}=e;const i=Ql();let d="",p=[],m=!1,_=null,h=null,b=null,v;function w(){b&&clearTimeout(b),b=setTimeout(()=>{d.trim().length>=2?y():(t(3,p=[]),t(6,h=null))},300)}async function y(){if(!d.trim()||d.trim().length<2){t(3,p=[]);return}t(4,m=!0),t(5,_=null);try{if(o){const C=await Ge("search_kg_terms",{request:{query:d.trim(),role_name:n,limit:20,min_similarity:.6}});C.status==="success"?(t(3,p=C.suggestions||[]),p.length>0&&!h&&t(6,h=p[0])):(t(5,_=C.error||"Search failed"),t(3,p=[]))}else{if(!u){t(5,_="No active conversation. Please start a conversation first."),t(3,p=[]);return}const C=await fetch(`${Ye.ServerURL}/conversations/${u}/context/kg/search?query=${encodeURIComponent(d.trim())}&role=${encodeURIComponent(n)}`);if(C.ok){const ne=await C.json();ne.status==="success"?(t(3,p=ne.suggestions||[]),p.length>0&&!h&&t(6,h=p[0])):(t(5,_=ne.error||"Search failed"),t(3,p=[]))}else t(5,_=`HTTP ${C.status}: ${C.statusText}`),t(3,p=[])}}catch(C){console.error("KG search error:",C),t(5,_=`Search failed: ${C}`),t(3,p=[])}finally{t(4,m=!1)}}function $(C){t(6,h=C)}async function k(){if(h){if(!u){t(5,_="No active conversation. Please start a conversation first.");return}try{if(o)await Ge("add_kg_term_context",{request:{conversation_id:u,term:h.term,role_name:n}}),i("termAdded",{term:h.term,suggestion:h}),j();else{const C=await fetch(`${Ye.ServerURL}/conversations/${u}/context/kg/term`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({term:h.term,role:n})});if(C.ok){const ne=await C.json();ne.status==="success"?(i("termAdded",{term:h.term,suggestion:h}),j()):t(5,_=ne.error||"Failed to add term to context")}else t(5,_=`HTTP ${C.status}: ${C.statusText}`)}}catch(C){console.error("Error adding term to context:",C),t(5,_=`Failed to add term to context: ${C}`)}}}async function S(){if(!u){t(5,_="No active conversation. Please start a conversation first.");return}try{if(o)await Ge("add_kg_index_context",{request:{conversation_id:u,role_name:n}}),i("kgIndexAdded",{role:n}),j();else{const C=await fetch(`${Ye.ServerURL}/conversations/${u}/context/kg/index`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({role:n})});if(C.ok){const ne=await C.json();ne.status==="success"?(i("kgIndexAdded",{role:n}),j()):t(5,_=ne.error||"Failed to add KG index to context")}else t(5,_=`HTTP ${C.status}: ${C.statusText}`)}}catch(C){console.error("Error adding KG index to context:",C),t(5,_=`Failed to add KG index to context: ${C}`)}}function j(){t(0,a=!1),t(1,d=""),t(3,p=[]),t(6,h=null),t(5,_=null),t(4,m=!1),b&&(clearTimeout(b),b=null)}function D(C){switch(C.key){case"Escape":j();break;case"ArrowDown":C.preventDefault(),O(1);break;case"ArrowUp":C.preventDefault(),O(-1);break;case"Enter":C.preventDefault(),h&&k();break}}function O(C){if(p.length===0)return;let q=(h?p.findIndex(le=>le.term===(h==null?void 0:h.term)):-1)+C;q<0?q=p.length-1:q>=p.length&&(q=0),t(6,h=p[q])}Wl(()=>{b&&clearTimeout(b)});function E(C){v=C,t(2,v)}function U(C){d=C,t(1,d),t(0,a),t(14,r)}const Z=C=>$(C),V=(C,ne)=>ne.key==="Enter"&&$(C);function A(C){a=C,t(0,a)}return l.$$set=C=>{"active"in C&&t(0,a=C.active),"initialQuery"in C&&t(14,r=C.initialQuery),"conversationId"in C&&t(15,u=C.conversationId)},l.$$.update=()=>{l.$$.dirty&16387&&a&&r!==d&&(t(1,d=r),d.trim()&&y()),l.$$.dirty&5&&a&&v&&setTimeout(()=>{v==null||v.focus(),t(5,_=null)},100)},[a,d,v,p,m,_,h,n,w,$,k,S,j,D,r,u,E,U,Z,V,A]}class oc extends mt{constructor(e){super(),_t(this,e,nc,lc,dt,{active:0,initialQuery:14,conversationId:15})}}function sc(l){const e=l.slice(),t=e[0].kg_index_info;return e[9]=t,e}function rc(l){const e=l.slice(),t=e[0].kg_term_definition;return e[8]=t,e}function ic(l){let e=l[0].context_type==="KGTermDefinition"?"KG Term":"KG Index",t;return{c(){t=P(e)},m(n,o){R(n,t,o)},p(n,o){o&1&&e!==(e=n[0].context_type==="KGTermDefinition"?"KG Term":"KG Index")&&ve(t,e)},d(n){n&&T(t)}}}function ac(l){let e,t;return e=new Qt({props:{icon:"fas fa-eye",size:"is-small"}}),{c(){me(e.$$.fragment)},m(n,o){_e(e,n,o),t=!0},p:Ce,i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function gs(l){let e,t;return e=new Kt({props:{size:"is-small",type:"is-ghost",title:"Remove from context",$$slots:{default:[cc]},$$scope:{ctx:l}}}),e.$on("click",l[5]),{c(){me(e.$$.fragment)},m(n,o){_e(e,n,o),t=!0},p(n,o){const a={};o&1024&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function cc(l){let e,t;return e=new Qt({props:{icon:"fas fa-times",size:"is-small"}}),{c(){me(e.$$.fragment)},m(n,o){_e(e,n,o),t=!0},p:Ce,i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function uc(l){let e,t,n,o=dl(l[9].total_terms)+"",a,r,u,i,d,p,m,_=dl(l[9].total_nodes)+"",h,b,v,w,y,$,k,S=dl(l[9].total_edges)+"",j,D,O,E,U,Z,V,A=(l[9].version||"N/A")+"",C,ne,q,le,Y,H,oe,N=!l[2]&&vs();return{c(){e=f("div"),t=f("div"),n=f("div"),a=P(o),u=g(),i=f("div"),i.textContent="Terms",d=g(),p=f("div"),m=f("div"),h=P(_),v=g(),w=f("div"),w.textContent="Nodes",y=g(),$=f("div"),k=f("div"),j=P(S),O=g(),E=f("div"),E.textContent="Edges",U=g(),Z=f("div"),V=f("div"),C=P(A),q=g(),le=f("div"),le.textContent="Version",H=g(),N&&N.c(),oe=ut(),c(n,"class",r="stat-value "+(l[2]?"compact":"")+" svelte-lkmjyw"),c(i,"class","stat-label svelte-lkmjyw"),c(t,"class","stat-item svelte-lkmjyw"),c(m,"class",b="stat-value "+(l[2]?"compact":"")+" svelte-lkmjyw"),c(w,"class","stat-label svelte-lkmjyw"),c(p,"class","stat-item svelte-lkmjyw"),c(k,"class",D="stat-value "+(l[2]?"compact":"")+" svelte-lkmjyw"),c(E,"class","stat-label svelte-lkmjyw"),c($,"class","stat-item svelte-lkmjyw"),c(V,"class",ne="stat-value "+(l[2]?"compact":"")+" svelte-lkmjyw"),c(le,"class","stat-label svelte-lkmjyw"),c(Z,"class","stat-item svelte-lkmjyw"),c(e,"class",Y="kg-index-stats "+(l[2]?"compact":"")+" svelte-lkmjyw")},m(z,I){R(z,e,I),s(e,t),s(t,n),s(n,a),s(t,u),s(t,i),s(e,d),s(e,p),s(p,m),s(m,h),s(p,v),s(p,w),s(e,y),s(e,$),s($,k),s(k,j),s($,O),s($,E),s(e,U),s(e,Z),s(Z,V),s(V,C),s(Z,q),s(Z,le),R(z,H,I),N&&N.m(z,I),R(z,oe,I)},p(z,I){I&1&&o!==(o=dl(z[9].total_terms)+"")&&ve(a,o),I&4&&r!==(r="stat-value "+(z[2]?"compact":"")+" svelte-lkmjyw")&&c(n,"class",r),I&1&&_!==(_=dl(z[9].total_nodes)+"")&&ve(h,_),I&4&&b!==(b="stat-value "+(z[2]?"compact":"")+" svelte-lkmjyw")&&c(m,"class",b),I&1&&S!==(S=dl(z[9].total_edges)+"")&&ve(j,S),I&4&&D!==(D="stat-value "+(z[2]?"compact":"")+" svelte-lkmjyw")&&c(k,"class",D),I&1&&A!==(A=(z[9].version||"N/A")+"")&&ve(C,A),I&4&&ne!==(ne="stat-value "+(z[2]?"compact":"")+" svelte-lkmjyw")&&c(V,"class",ne),I&4&&Y!==(Y="kg-index-stats "+(z[2]?"compact":"")+" svelte-lkmjyw")&&c(e,"class",Y),z[2]?N&&(N.d(1),N=null):N||(N=vs(),N.c(),N.m(oe.parentNode,oe))},i:Ce,o:Ce,d(z){z&&T(e),z&&T(H),N&&N.d(z),z&&T(oe)}}}function fc(l){let e,t,n,o,a,r,u,i,d,p=l[8].definition&&bs(l),m=l[8].synonyms.length>0&&ks(l),_=l[8].related_terms.length>0&&ws(l),h=l[8].usage_examples.length>0&&ys(l),b=l[8].url&&$s(l);return{c(){e=f("div"),p&&p.c(),t=g(),n=f("div"),m&&m.c(),o=g(),_&&_.c(),a=g(),h&&h.c(),r=g(),b&&b.c(),c(n,"class",u="term-metadata "+(l[2]?"compact":"")+" svelte-lkmjyw"),c(e,"class",i="term-definition "+(l[2]?"compact":"")+" svelte-lkmjyw")},m(v,w){R(v,e,w),p&&p.m(e,null),s(e,t),s(e,n),m&&m.m(n,null),s(n,o),_&&_.m(n,null),s(n,a),h&&h.m(n,null),s(n,r),b&&b.m(n,null),d=!0},p(v,w){v[8].definition?p?p.p(v,w):(p=bs(v),p.c(),p.m(e,t)):p&&(p.d(1),p=null),v[8].synonyms.length>0?m?(m.p(v,w),w&1&&M(m,1)):(m=ks(v),m.c(),M(m,1),m.m(n,o)):m&&(Ue(),B(m,1,1,()=>{m=null}),ze()),v[8].related_terms.length>0?_?(_.p(v,w),w&1&&M(_,1)):(_=ws(v),_.c(),M(_,1),_.m(n,a)):_&&(Ue(),B(_,1,1,()=>{_=null}),ze()),v[8].usage_examples.length>0?h?(h.p(v,w),w&1&&M(h,1)):(h=ys(v),h.c(),M(h,1),h.m(n,r)):h&&(Ue(),B(h,1,1,()=>{h=null}),ze()),v[8].url?b?w&1&&M(b,1):(b=$s(v),b.c(),M(b,1),b.m(n,null)):b&&(Ue(),B(b,1,1,()=>{b=null}),ze()),(!d||w&4&&u!==(u="term-metadata "+(v[2]?"compact":"")+" svelte-lkmjyw"))&&c(n,"class",u),(!d||w&4&&i!==(i="term-definition "+(v[2]?"compact":"")+" svelte-lkmjyw"))&&c(e,"class",i)},i(v){d||(M(m),M(_),M(h),M(b),d=!0)},o(v){B(m),B(_),B(h),B(b),d=!1},d(v){v&&T(e),p&&p.d(),m&&m.d(),_&&_.d(),h&&h.d(),b&&b.d()}}}function vs(l){let e;return{c(){e=f("div"),e.innerHTML='<p class="is-size-7"><strong>Thesaurus Data:</strong> This context item contains the complete thesaurus as JSON, providing all domain-specific vocabulary and term mappings for comprehensive AI understanding.</p>',c(e,"class","notification is-success is-light mt-3")},m(t,n){R(t,e,n)},d(t){t&&T(e)}}}function bs(l){let e,t=l[8].definition+"",n,o;return{c(){e=f("div"),n=P(t),c(e,"class",o="definition-text "+(l[2]?"compact":"")+" svelte-lkmjyw")},m(a,r){R(a,e,r),s(e,n)},p(a,r){r&1&&t!==(t=a[8].definition+"")&&ve(n,t),r&4&&o!==(o="definition-text "+(a[2]?"compact":"")+" svelte-lkmjyw")&&c(e,"class",o)},d(a){a&&T(e)}}}function ks(l){let e,t;return e=new Gt({props:{type:"is-light",size:"is-small",title:"Synonyms",$$slots:{default:[dc]},$$scope:{ctx:l}}}),{c(){me(e.$$.fragment)},m(n,o){_e(e,n,o),t=!0},p(n,o){const a={};o&1025&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function dc(l){let e,t,n,o=l[8].synonyms.length+"",a,r,u=l[8].synonyms.length!==1?"s":"",i,d;return e=new Qt({props:{icon:"fas fa-equals",size:"is-small"}}),{c(){me(e.$$.fragment),t=g(),n=f("span"),a=P(o),r=P(" synonym"),i=P(u)},m(p,m){_e(e,p,m),R(p,t,m),R(p,n,m),s(n,a),s(n,r),s(n,i),d=!0},p(p,m){(!d||m&1)&&o!==(o=p[8].synonyms.length+"")&&ve(a,o),(!d||m&1)&&u!==(u=p[8].synonyms.length!==1?"s":"")&&ve(i,u)},i(p){d||(M(e.$$.fragment,p),d=!0)},o(p){B(e.$$.fragment,p),d=!1},d(p){he(e,p),p&&T(t),p&&T(n)}}}function ws(l){let e,t;return e=new Gt({props:{type:"is-light",size:"is-small",title:"Related Terms",$$slots:{default:[pc]},$$scope:{ctx:l}}}),{c(){me(e.$$.fragment)},m(n,o){_e(e,n,o),t=!0},p(n,o){const a={};o&1025&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function pc(l){let e,t,n,o=l[8].related_terms.length+"",a,r,u;return e=new Qt({props:{icon:"fas fa-link",size:"is-small"}}),{c(){me(e.$$.fragment),t=g(),n=f("span"),a=P(o),r=P(" related")},m(i,d){_e(e,i,d),R(i,t,d),R(i,n,d),s(n,a),s(n,r),u=!0},p(i,d){(!u||d&1)&&o!==(o=i[8].related_terms.length+"")&&ve(a,o)},i(i){u||(M(e.$$.fragment,i),u=!0)},o(i){B(e.$$.fragment,i),u=!1},d(i){he(e,i),i&&T(t),i&&T(n)}}}function ys(l){let e,t;return e=new Gt({props:{type:"is-light",size:"is-small",title:"Usage Examples",$$slots:{default:[mc]},$$scope:{ctx:l}}}),{c(){me(e.$$.fragment)},m(n,o){_e(e,n,o),t=!0},p(n,o){const a={};o&1025&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function mc(l){let e,t,n,o=l[8].usage_examples.length+"",a,r,u=l[8].usage_examples.length!==1?"s":"",i,d;return e=new Qt({props:{icon:"fas fa-quote-left",size:"is-small"}}),{c(){me(e.$$.fragment),t=g(),n=f("span"),a=P(o),r=P(" example"),i=P(u)},m(p,m){_e(e,p,m),R(p,t,m),R(p,n,m),s(n,a),s(n,r),s(n,i),d=!0},p(p,m){(!d||m&1)&&o!==(o=p[8].usage_examples.length+"")&&ve(a,o),(!d||m&1)&&u!==(u=p[8].usage_examples.length!==1?"s":"")&&ve(i,u)},i(p){d||(M(e.$$.fragment,p),d=!0)},o(p){B(e.$$.fragment,p),d=!1},d(p){he(e,p),p&&T(t),p&&T(n)}}}function $s(l){let e,t;return e=new Gt({props:{type:"is-link",size:"is-small",$$slots:{default:[_c]},$$scope:{ctx:l}}}),{c(){me(e.$$.fragment)},m(n,o){_e(e,n,o),t=!0},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function _c(l){let e,t,n,o;return e=new Qt({props:{icon:"fas fa-external-link-alt",size:"is-small"}}),{c(){me(e.$$.fragment),t=g(),n=f("span"),n.textContent="Source"},m(a,r){_e(e,a,r),R(a,t,r),R(a,n,r),o=!0},p:Ce,i(a){o||(M(e.$$.fragment,a),o=!0)},o(a){B(e.$$.fragment,a),o=!1},d(a){he(e,a),a&&T(t),a&&T(n)}}}function Cs(l){let e,t=l[0].summary+"",n;return{c(){e=f("div"),n=P(t),c(e,"class","context-summary svelte-lkmjyw")},m(o,a){R(o,e,a),s(e,n)},p(o,a){a&1&&t!==(t=o[0].summary+"")&&ve(n,t)},d(o){o&&T(e)}}}function Ts(l){let e,t,n=(l[0].relevance_score*100).toFixed(0)+"",o,a;return{c(){e=f("span"),t=P("Relevance: "),o=P(n),a=P("%"),c(e,"class","relevance-score svelte-lkmjyw")},m(r,u){R(r,e,u),s(e,t),s(e,o),s(e,a)},p(r,u){u&1&&n!==(n=(r[0].relevance_score*100).toFixed(0)+"")&&ve(o,n)},d(r){r&&T(e)}}}function Ss(l){let e,t,n,o=(l[0].metadata.document_title||l[0].metadata.source_document)+"",a,r;return t=new Qt({props:{icon:"fas fa-file-alt",size:"is-small"}}),{c(){e=f("span"),me(t.$$.fragment),n=g(),a=P(o),c(e,"title","Source Document")},m(u,i){R(u,e,i),_e(t,e,null),s(e,n),s(e,a),r=!0},p(u,i){(!r||i&1)&&o!==(o=(u[0].metadata.document_title||u[0].metadata.source_document)+"")&&ve(a,o)},i(u){r||(M(t.$$.fragment,u),r=!0)},o(u){B(t.$$.fragment,u),r=!1},d(u){u&&T(e),he(t)}}}function hc(l){let e,t,n,o,a,r,u=l[0].title+"",i,d,p,m,_,h,b,v,w,y,$,k,S,j,D,O,E,U,Z,V=Rs(l[0].created_at)+"",A,C,ne,q,le,Y;o=new Qt({props:{icon:l[4],size:"is-small"}}),m=new Gt({props:{type:l[3],size:"is-small",$$slots:{default:[ic]},$$scope:{ctx:l}}}),b=new Kt({props:{size:"is-small",type:"is-ghost",title:"View details",$$slots:{default:[ac]},$$scope:{ctx:l}}}),b.$on("click",l[6]);let H=l[1]&&gs(l);const oe=[fc,uc],N=[];function z(J,X){return J[0].context_type==="KGTermDefinition"&&J[0].kg_term_definition?0:J[0].context_type==="KGIndex"&&J[0].kg_index_info?1:-1}function I(J,X){if(X===0)return rc(J);if(X===1)return sc(J)}~(k=z(l))&&(S=N[k]=oe[k](I(l,k)));let L=l[0].summary&&!l[2]&&Cs(l),F=l[0].relevance_score&&Ts(l),ee=l[0].metadata.source_document&&Ss(l);return{c(){e=f("div"),t=f("div"),n=f("div"),me(o.$$.fragment),a=g(),r=f("span"),i=P(u),p=g(),me(m.$$.fragment),_=g(),h=f("div"),me(b.$$.fragment),v=g(),H&&H.c(),y=g(),$=f("div"),S&&S.c(),j=g(),L&&L.c(),O=g(),E=f("div"),U=f("span"),Z=P("Added "),A=P(V),C=g(),F&&F.c(),ne=g(),ee&&ee.c(),c(r,"class",d="context-title-text "+(l[2]?"compact":"")+" svelte-lkmjyw"),c(n,"class","context-title svelte-lkmjyw"),c(h,"class","context-actions svelte-lkmjyw"),c(t,"class",w="context-header "+(l[2]?"compact":"")+" svelte-lkmjyw"),c($,"class",D="context-content "+(l[2]?"compact":"")+" svelte-lkmjyw"),c(E,"class",q="context-meta "+(l[2]?"compact":"")+" svelte-lkmjyw"),c(e,"class",le="kg-context-item "+(l[2]?"compact":"")+" svelte-lkmjyw")},m(J,X){R(J,e,X),s(e,t),s(t,n),_e(o,n,null),s(n,a),s(n,r),s(r,i),s(n,p),_e(m,n,null),s(t,_),s(t,h),_e(b,h,null),s(h,v),H&&H.m(h,null),s(e,y),s(e,$),~k&&N[k].m($,null),s($,j),L&&L.m($,null),s(e,O),s(e,E),s(E,U),s(U,Z),s(U,A),s(E,C),F&&F.m(E,null),s(E,ne),ee&&ee.m(E,null),Y=!0},p(J,[X]){const Q={};X&16&&(Q.icon=J[4]),o.$set(Q),(!Y||X&1)&&u!==(u=J[0].title+"")&&ve(i,u),(!Y||X&4&&d!==(d="context-title-text "+(J[2]?"compact":"")+" svelte-lkmjyw"))&&c(r,"class",d);const re={};X&8&&(re.type=J[3]),X&1025&&(re.$$scope={dirty:X,ctx:J}),m.$set(re);const pe={};X&1024&&(pe.$$scope={dirty:X,ctx:J}),b.$set(pe),J[1]?H?(H.p(J,X),X&2&&M(H,1)):(H=gs(J),H.c(),M(H,1),H.m(h,null)):H&&(Ue(),B(H,1,1,()=>{H=null}),ze()),(!Y||X&4&&w!==(w="context-header "+(J[2]?"compact":"")+" svelte-lkmjyw"))&&c(t,"class",w);let ie=k;k=z(J),k===ie?~k&&N[k].p(I(J,k),X):(S&&(Ue(),B(N[ie],1,1,()=>{N[ie]=null}),ze()),~k?(S=N[k],S?S.p(I(J,k),X):(S=N[k]=oe[k](I(J,k)),S.c()),M(S,1),S.m($,j)):S=null),J[0].summary&&!J[2]?L?L.p(J,X):(L=Cs(J),L.c(),L.m($,null)):L&&(L.d(1),L=null),(!Y||X&4&&D!==(D="context-content "+(J[2]?"compact":"")+" svelte-lkmjyw"))&&c($,"class",D),(!Y||X&1)&&V!==(V=Rs(J[0].created_at)+"")&&ve(A,V),J[0].relevance_score?F?F.p(J,X):(F=Ts(J),F.c(),F.m(E,ne)):F&&(F.d(1),F=null),J[0].metadata.source_document?ee?(ee.p(J,X),X&1&&M(ee,1)):(ee=Ss(J),ee.c(),M(ee,1),ee.m(E,null)):ee&&(Ue(),B(ee,1,1,()=>{ee=null}),ze()),(!Y||X&4&&q!==(q="context-meta "+(J[2]?"compact":"")+" svelte-lkmjyw"))&&c(E,"class",q),(!Y||X&4&&le!==(le="kg-context-item "+(J[2]?"compact":"")+" svelte-lkmjyw"))&&c(e,"class",le)},i(J){Y||(M(o.$$.fragment,J),M(m.$$.fragment,J),M(b.$$.fragment,J),M(H),M(S),M(ee),Y=!0)},o(J){B(o.$$.fragment,J),B(m.$$.fragment,J),B(b.$$.fragment,J),B(H),B(S),B(ee),Y=!1},d(J){J&&T(e),he(o),he(m),he(b),H&&H.d(),~k&&N[k].d(),L&&L.d(),F&&F.d(),ee&&ee.d()}}}function dl(l){return new Intl.NumberFormat().format(l)}function Rs(l){try{return new Date(l).toLocaleDateString()}catch{return l}}function gc(l,e,t){let n,o,{contextItem:a}=e,{removable:r=!0}=e,{compact:u=!1}=e;const i=Ql();function d(){i("remove",{contextId:a.id})}function p(){i("viewDetails",{contextItem:a})}return l.$$set=m=>{"contextItem"in m&&t(0,a=m.contextItem),"removable"in m&&t(1,r=m.removable),"compact"in m&&t(2,u=m.compact)},l.$$.update=()=>{l.$$.dirty&1&&t(4,n=a.context_type==="KGTermDefinition"?"fas fa-tag":"fas fa-sitemap"),l.$$.dirty&1&&t(3,o=a.context_type==="KGTermDefinition"?"is-info":"is-primary")},[a,r,u,o,n,d,p]}class vc extends mt{constructor(e){super(),_t(this,e,gc,hc,dt,{contextItem:0,removable:1,compact:2})}}function As(l,e,t){const n=l.slice();return n[47]=e[t],n[49]=t,n}function Es(l,e,t){const n=l.slice();return n[50]=e[t],n[52]=t,n}function Ls(l){let e,t,n;return{c(){e=f("p"),t=P("Conversation ID: "),n=P(l[5]),c(e,"class","is-size-7 has-text-grey")},m(o,a){R(o,e,a),s(e,t),s(e,n)},p(o,a){a[0]&32&&ve(n,o[5])},d(o){o&&T(e)}}}function Is(l){let e,t,n,o=l[50].content+"",a,r;return{c(){e=f("div"),t=f("div"),n=f("pre"),a=P(o),c(n,"class","svelte-rbq0zi"),c(t,"class","bubble svelte-rbq0zi"),c(e,"class",r=Pt(`msg ${l[50].role}`)+" svelte-rbq0zi")},m(u,i){R(u,e,i),s(e,t),s(t,n),s(n,a)},p(u,i){i[0]&1&&o!==(o=u[50].content+"")&&ve(a,o),i[0]&1&&r!==(r=Pt(`msg ${u[50].role}`)+" svelte-rbq0zi")&&c(e,"class",r)},d(u){u&&T(e)}}}function Ds(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="bubble loading svelte-rbq0zi"><span class="icon is-small"><i class="fas fa-spinner fa-spin"></i></span> 
            <span>Thinking...</span></div>`,c(e,"class","msg assistant svelte-rbq0zi")},m(t,n){R(t,e,n)},d(t){t&&T(e)}}}function Ns(l){let e,t,n;return{c(){e=f("p"),t=P("Model: "),n=P(l[4]),c(e,"class","is-size-7 has-text-grey")},m(o,a){R(o,e,a),s(e,t),s(e,n)},p(o,a){a[0]&16&&ve(n,o[4])},d(o){o&&T(e)}}}function Os(l){let e,t;return{c(){e=f("p"),t=P(l[3]),c(e,"class","has-text-danger is-size-7")},m(n,o){R(n,e,o),s(e,t)},p(n,o){o[0]&8&&ve(t,n[3])},d(n){n&&T(e)}}}function bc(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-refresh"></i>',c(e,"class","icon is-small")},m(t,n){R(t,e,n)},d(t){t&&T(e)}}}function kc(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-spinner fa-spin"></i>',c(e,"class","icon is-small")},m(t,n){R(t,e,n)},d(t){t&&T(e)}}}function Ps(l){let e,t,n,o,a,r,u,i,d,p,m,_,h,b,v,w,y,$,k,S,j,D,O,E,U,Z,V,A,C,ne,q,le,Y,H,oe,N,z,I;function L(J,X){return J[12]?yc:wc}let F=L(l),ee=F(l);return{c(){e=f("div"),t=f("div"),n=f("label"),n.textContent="Context Type",o=g(),a=f("div"),r=f("div"),u=f("select"),i=f("option"),i.textContent="Document",d=f("option"),d.textContent="Search Result",p=f("option"),p.textContent="User Input",m=f("option"),m.textContent="Note",_=g(),h=f("div"),b=f("label"),b.textContent="Title",v=g(),w=f("div"),y=f("input"),$=g(),k=f("div"),S=f("label"),S.textContent="Content",j=g(),D=f("div"),O=f("textarea"),E=g(),U=f("div"),Z=f("div"),V=f("button"),ee.c(),A=g(),C=f("span"),C.textContent="Save Context",q=g(),le=f("div"),Y=f("button"),H=f("span"),H.innerHTML='<i class="fas fa-times"></i>',oe=g(),N=f("span"),N.textContent="Cancel",c(n,"class","label is-small"),i.__value="document",i.value=i.__value,d.__value="search_result",d.value=d.__value,p.__value="user_input",p.value=p.__value,m.__value="note",m.value=m.__value,c(u,"data-testid","context-type-select"),l[11]===void 0&&pt(()=>l[30].call(u)),c(r,"class","select is-small is-fullwidth"),c(a,"class","control"),c(t,"class","field"),c(b,"class","label is-small"),c(y,"class","input is-small"),c(y,"type","text"),c(y,"placeholder","Enter context title"),c(y,"data-testid","context-title-input"),c(w,"class","control"),c(h,"class","field"),c(S,"class","label is-small"),c(O,"class","textarea is-small"),c(O,"rows","4"),c(O,"placeholder","Enter context content"),c(O,"data-testid","context-content-textarea"),c(D,"class","control"),c(k,"class","field"),c(V,"class","button is-primary is-small"),V.disabled=ne=l[12]||!l[9].trim()||!l[10].trim(),c(V,"data-testid","add-context-submit-button"),c(Z,"class","control"),c(H,"class","icon is-small"),c(Y,"class","button is-light is-small"),Y.disabled=l[12],c(le,"class","control"),c(U,"class","field is-grouped"),c(e,"class","box has-background-light mb-4"),c(e,"data-testid","add-context-form")},m(J,X){R(J,e,X),s(e,t),s(t,n),s(t,o),s(t,a),s(a,r),s(r,u),s(u,i),s(u,d),s(u,p),s(u,m),Je(u,l[11],!0),s(e,_),s(e,h),s(h,b),s(h,v),s(h,w),s(w,y),De(y,l[9]),s(e,$),s(e,k),s(k,S),s(k,j),s(k,D),s(D,O),De(O,l[10]),s(e,E),s(e,U),s(U,Z),s(Z,V),ee.m(V,null),s(V,A),s(V,C),s(U,q),s(U,le),s(le,Y),s(Y,H),s(Y,oe),s(Y,N),z||(I=[se(u,"change",l[30]),se(y,"input",l[31]),se(O,"input",l[32]),se(V,"click",l[19]),se(Y,"click",l[18])],z=!0)},p(J,X){X[0]&2048&&Je(u,J[11]),X[0]&512&&y.value!==J[9]&&De(y,J[9]),X[0]&1024&&De(O,J[10]),F!==(F=L(J))&&(ee.d(1),ee=F(J),ee&&(ee.c(),ee.m(V,A))),X[0]&5632&&ne!==(ne=J[12]||!J[9].trim()||!J[10].trim())&&(V.disabled=ne),X[0]&4096&&(Y.disabled=J[12])},d(J){J&&T(e),ee.d(),z=!1,lt(I)}}}function wc(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-save"></i>',c(e,"class","icon is-small")},m(t,n){R(t,e,n)},d(t){t&&T(e)}}}function yc(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-spinner fa-spin"></i>',c(e,"class","icon is-small")},m(t,n){R(t,e,n)},d(t){t&&T(e)}}}function $c(l){let e,t,n=l[6],o=[];for(let r=0;r<n.length;r+=1)o[r]=Us(As(l,n,r));const a=r=>B(o[r],1,1,()=>{o[r]=null});return{c(){e=f("div");for(let r=0;r<o.length;r+=1)o[r].c();c(e,"class","context-items svelte-rbq0zi"),c(e,"data-testid","conversation-context")},m(r,u){R(r,e,u);for(let i=0;i<o.length;i+=1)o[i]&&o[i].m(e,null);t=!0},p(r,u){if(u[0]&7340096){n=r[6];let i;for(i=0;i<n.length;i+=1){const d=As(r,n,i);o[i]?(o[i].p(d,u),M(o[i],1)):(o[i]=Us(d),o[i].c(),M(o[i],1),o[i].m(e,null))}for(Ue(),i=n.length;i<o.length;i+=1)a(i);ze()}},i(r){if(!t){for(let u=0;u<n.length;u+=1)M(o[u]);t=!0}},o(r){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)B(o[u]);t=!1},d(r){r&&T(e),tt(o,r)}}}function Cc(l){let e;return{c(){e=f("div"),e.innerHTML=`<span class="icon is-large"><i class="fas fa-inbox fa-2x"></i></span> 
              <p class="is-size-6">No context items yet</p> 
              <p class="is-size-7">Add documents from search results to provide context for your chat.</p>`,c(e,"class","has-text-centered has-text-grey-light"),c(e,"data-testid","empty-context-message")},m(t,n){R(t,e,n)},p:Ce,i:Ce,o:Ce,d(t){t&&T(e)}}}function Tc(l){let e,t,n,o,a,r=l[47].context_type.replace(/([A-Z])/g," $1").trim()+"",u,i,d,p,m,_,h,b,v,w,y,$,k,S,j,D=l[47].title+"",O,E,U,Z,V,A,C=new Date(l[47].created_at).toLocaleString()+"",ne,q,le,Y,H,oe=l[47].relevance_score&&Ms(l);function N(){return l[35](l[47])}function z(){return l[36](l[47])}function I(ee,J){return ee[47].summary?Ac:Rc}let L=I(l),F=L(l);return{c(){e=f("div"),t=f("div"),n=f("div"),o=f("div"),a=f("span"),u=P(r),d=g(),p=f("div"),m=f("div"),oe&&oe.c(),_=g(),h=f("div"),b=f("div"),v=f("div"),w=f("button"),w.innerHTML='<span class="icon is-small"><i class="fas fa-edit"></i></span>',y=g(),$=f("div"),k=f("button"),k.innerHTML='<span class="icon is-small"><i class="fas fa-trash"></i></span>',S=g(),j=f("h6"),O=P(D),E=g(),U=f("div"),F.c(),Z=g(),V=f("div"),A=P("Added: "),ne=P(C),c(a,"class",i="tag is-small "+(l[47].context_type==="Document"?"is-info":l[47].context_type==="SearchResult"?"is-primary":l[47].context_type==="UserInput"?"is-warning":"is-light")),c(a,"data-testid",`context-type-${l[49]}`),c(o,"class","level-item"),c(n,"class","level-left"),c(m,"class","level-item"),c(w,"class","button is-small is-light"),c(w,"data-testid",`edit-context-${l[49]}`),c(w,"title","Edit context"),c(v,"class","control"),c(k,"class","button is-small is-light is-danger"),c(k,"data-testid",`delete-context-${l[49]}`),c(k,"title","Delete context"),c($,"class","control"),c(b,"class","field is-grouped"),c(h,"class","level-item context-actions svelte-rbq0zi"),c(p,"class","level-right"),c(t,"class","level is-mobile"),c(j,"class","title is-6 has-text-dark"),c(j,"data-testid",`context-title-${l[49]}`),c(U,"class","content is-small"),c(V,"class","is-size-7 has-text-grey"),c(e,"class","context-item svelte-rbq0zi"),c(e,"data-context-id",q=l[47].id),c(e,"data-testid",`context-item-${l[49]}`),c(e,"data-context-type",le=l[47].context_type)},m(ee,J){R(ee,e,J),s(e,t),s(t,n),s(n,o),s(o,a),s(a,u),s(t,d),s(t,p),s(p,m),oe&&oe.m(m,null),s(p,_),s(p,h),s(h,b),s(b,v),s(v,w),s(b,y),s(b,$),s($,k),s(e,S),s(e,j),s(j,O),s(e,E),s(e,U),F.m(U,null),s(e,Z),s(e,V),s(V,A),s(V,ne),Y||(H=[se(w,"click",N),se(k,"click",z)],Y=!0)},p(ee,J){l=ee,J[0]&64&&r!==(r=l[47].context_type.replace(/([A-Z])/g," $1").trim()+"")&&ve(u,r),J[0]&64&&i!==(i="tag is-small "+(l[47].context_type==="Document"?"is-info":l[47].context_type==="SearchResult"?"is-primary":l[47].context_type==="UserInput"?"is-warning":"is-light"))&&c(a,"class",i),l[47].relevance_score?oe?oe.p(l,J):(oe=Ms(l),oe.c(),oe.m(m,null)):oe&&(oe.d(1),oe=null),J[0]&64&&D!==(D=l[47].title+"")&&ve(O,D),L===(L=I(l))&&F?F.p(l,J):(F.d(1),F=L(l),F&&(F.c(),F.m(U,null))),J[0]&64&&C!==(C=new Date(l[47].created_at).toLocaleString()+"")&&ve(ne,C),J[0]&64&&q!==(q=l[47].id)&&c(e,"data-context-id",q),J[0]&64&&le!==(le=l[47].context_type)&&c(e,"data-context-type",le)},i:Ce,o:Ce,d(ee){ee&&T(e),oe&&oe.d(),F.d(),Y=!1,lt(H)}}}function Sc(l){let e,t;return e=new vc({props:{contextItem:l[47],compact:!0}}),e.$on("remove",l[33]),e.$on("viewDetails",l[34]),{c(){me(e.$$.fragment)},m(n,o){_e(e,n,o),t=!0},p(n,o){const a={};o[0]&64&&(a.contextItem=n[47]),e.$set(a)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function Ms(l){let e,t=l[47].relevance_score.toFixed(1)+"",n;return{c(){e=f("span"),n=P(t),c(e,"class","tag is-light is-small")},m(o,a){R(o,e,a),s(e,n)},p(o,a){a[0]&64&&t!==(t=o[47].relevance_score.toFixed(1)+"")&&ve(n,t)},d(o){o&&T(e)}}}function Rc(l){let e,t=l[47].content.substring(0,150)+"",n,o=l[47].content.length>150?"...":"",a;return{c(){e=f("p"),n=P(t),a=P(o),c(e,"class","context-preview svelte-rbq0zi"),c(e,"data-testid",`context-content-${l[49]}`)},m(r,u){R(r,e,u),s(e,n),s(e,a)},p(r,u){u[0]&64&&t!==(t=r[47].content.substring(0,150)+"")&&ve(n,t),u[0]&64&&o!==(o=r[47].content.length>150?"...":"")&&ve(a,o)},d(r){r&&T(e)}}}function Ac(l){let e,t=l[47].summary+"",n;return{c(){e=f("p"),n=P(t),c(e,"class","context-summary svelte-rbq0zi"),c(e,"data-testid",`context-summary-${l[49]}`)},m(o,a){R(o,e,a),s(e,n)},p(o,a){a[0]&64&&t!==(t=o[47].summary+"")&&ve(n,t)},d(o){o&&T(e)}}}function js(l){let e;return{c(){e=f("hr"),c(e,"class","context-divider svelte-rbq0zi")},m(t,n){R(t,e,n)},d(t){t&&T(e)}}}function Us(l){let e,t,n,o,a;const r=[Sc,Tc],u=[];function i(p,m){return p[47].context_type==="KGTermDefinition"||p[47].context_type==="KGIndex"?0:1}e=i(l),t=u[e]=r[e](l);let d=l[49]<l[6].length-1&&js();return{c(){t.c(),n=g(),d&&d.c(),o=ut()},m(p,m){u[e].m(p,m),R(p,n,m),d&&d.m(p,m),R(p,o,m),a=!0},p(p,m){let _=e;e=i(p),e===_?u[e].p(p,m):(Ue(),B(u[_],1,1,()=>{u[_]=null}),ze(),t=u[e],t?t.p(p,m):(t=u[e]=r[e](p),t.c()),M(t,1),t.m(n.parentNode,n)),p[49]<p[6].length-1?d||(d=js(),d.c(),d.m(o.parentNode,o)):d&&(d.d(1),d=null)},i(p){a||(M(t),a=!0)},o(p){B(t),a=!1},d(p){u[e].d(p),p&&T(n),d&&d.d(p),p&&T(o)}}}function Ec(l){let e,t,n,o,a,r,u,i,d,p,m,_,h,b,v,w,y,$,k,S,j,D,O,E,U,Z,V,A,C,ne,q,le,Y,H,oe,N,z,I,L,F,ee,J,X,Q,re,pe,ie,ae,be,K,x=l[6].length+"",ce,ge,ke,Te,Ze,Be,Ne,Pe,fe,Re,Me,Xe,xe;e=new _l({props:{fallbackPath:"/"}});let ye=l[5]&&Ls(l),He=l[0],Ke=[];for(let de=0;de<He.length;de+=1)Ke[de]=Is(Es(l,He,de));let qe=l[2]&&Ds(),Le=l[4]&&Ns(l),Ie=l[3]&&Os(l);function it(de,Ae){return de[7]?kc:bc}let Oe=it(l),We=Oe(l),G=l[8]&&Ps(l);const te=[Cc,$c],W=[];function ue(de,Ae){return de[6].length===0?0:1}X=ue(l),Q=W[X]=te[X](l);function Se(de){l[37](de)}let $e={context:l[14],mode:l[15]};l[13]!==void 0&&($e.active=l[13]),Be=new Wa({props:$e}),et.push(()=>st(Be,"active",Se)),Be.$on("update",l[38]),Be.$on("delete",l[39]),Be.$on("close",l[40]);function Ve(de){l[41](de)}let nt={conversationId:l[5]};return l[16]!==void 0&&(nt.active=l[16]),fe=new oc({props:nt}),et.push(()=>st(fe,"active",Ve)),fe.$on("termAdded",l[27]),fe.$on("kgIndexAdded",l[28]),{c(){me(e.$$.fragment),t=g(),n=f("section"),o=f("div"),a=f("div"),r=f("div"),u=f("h2"),u.textContent="Chat",i=g(),d=f("p"),d.textContent=`Role: ${Rt(At)}`,p=g(),ye&&ye.c(),m=g(),_=f("div");for(let de=0;de<Ke.length;de+=1)Ke[de].c();h=g(),qe&&qe.c(),b=g(),Le&&Le.c(),v=g(),Ie&&Ie.c(),w=g(),y=f("div"),$=f("div"),k=f("textarea"),S=g(),j=f("div"),D=f("button"),O=f("span"),O.innerHTML='<i class="fas fa-paper-plane"></i>',U=g(),Z=f("div"),V=f("div"),A=f("div"),C=f("div"),ne=f("div"),q=f("h4"),q.textContent="Context",le=g(),Y=f("div"),H=f("button"),H.innerHTML=`<span class="icon is-small"><i class="fas fa-plus"></i></span> 
                    <span>Add</span>`,oe=g(),N=f("button"),N.innerHTML=`<span class="icon is-small"><i class="fas fa-sitemap"></i></span> 
                    <span>KG Search</span>`,z=g(),I=f("div"),L=f("div"),F=f("button"),We.c(),ee=g(),G&&G.c(),J=g(),Q.c(),re=g(),pe=f("div"),ie=f("div"),ae=f("div"),be=f("div"),K=f("span"),ce=P(x),ge=P(" context items"),ke=g(),Te=f("div"),Te.innerHTML='<div class="level-item"><span class="is-size-7 has-text-grey">Context is automatically included in your chat</span></div>',Ze=g(),me(Be.$$.fragment),Pe=g(),me(fe.$$.fragment),c(u,"class","title is-4"),c(d,"class","subtitle is-6"),c(_,"class","chat-window svelte-rbq0zi"),c(_,"data-testid","chat-messages"),c(k,"class","textarea"),c(k,"rows","3"),c(k,"placeholder","Type your message and press Enter..."),c(k,"data-testid","chat-input"),c($,"class","control is-expanded"),c(O,"class","icon"),c(D,"class","button is-primary"),D.disabled=E=l[2]||!l[1].trim(),c(D,"data-testid","send-message-button"),c(j,"class","control"),c(y,"class","field has-addons chat-input svelte-rbq0zi"),c(r,"class","column is-8"),c(q,"class","title is-5"),c(H,"class","button is-small is-primary"),c(H,"data-testid","show-add-context-button"),c(N,"class","button is-small is-info"),c(N,"data-testid","kg-search-button"),c(Y,"class","buttons has-addons"),c(ne,"class","level-item"),c(C,"class","level-left"),c(F,"class","button is-small is-light"),F.disabled=l[7],c(F,"data-testid","refresh-context-button"),c(L,"class","level-item"),c(I,"class","level-right"),c(A,"class","level is-mobile"),c(K,"class","tag is-light is-small"),c(K,"data-testid","context-summary"),c(be,"class","level-item"),c(ae,"class","level-left"),c(Te,"class","level-right"),c(ie,"class","level is-mobile"),c(pe,"class","mt-4"),c(V,"class","box context-panel svelte-rbq0zi"),c(V,"data-testid","context-panel"),c(Z,"class","column is-4"),c(a,"class","columns svelte-rbq0zi"),c(o,"class","container"),c(n,"class","section"),c(n,"data-testid","chat-interface")},m(de,Ae){_e(e,de,Ae),R(de,t,Ae),R(de,n,Ae),s(n,o),s(o,a),s(a,r),s(r,u),s(r,i),s(r,d),s(r,p),ye&&ye.m(r,null),s(r,m),s(r,_);for(let ot=0;ot<Ke.length;ot+=1)Ke[ot]&&Ke[ot].m(_,null);s(_,h),qe&&qe.m(_,null),s(r,b),Le&&Le.m(r,null),s(r,v),Ie&&Ie.m(r,null),s(r,w),s(r,y),s(y,$),s($,k),De(k,l[1]),s(y,S),s(y,j),s(j,D),s(D,O),s(a,U),s(a,Z),s(Z,V),s(V,A),s(A,C),s(C,ne),s(ne,q),s(ne,le),s(ne,Y),s(Y,H),s(Y,oe),s(Y,N),s(A,z),s(A,I),s(I,L),s(L,F),We.m(F,null),s(V,ee),G&&G.m(V,null),s(V,J),W[X].m(V,null),s(V,re),s(V,pe),s(pe,ie),s(ie,ae),s(ae,be),s(be,K),s(K,ce),s(K,ge),s(ie,ke),s(ie,Te),R(de,Ze,Ae),_e(Be,de,Ae),R(de,Pe,Ae),_e(fe,de,Ae),Me=!0,Xe||(xe=[se(k,"input",l[29]),se(k,"keydown",l[25]),se(D,"click",l[24]),se(H,"click",l[18]),se(N,"click",l[26]),se(F,"click",l[17])],Xe=!0)},p(de,Ae){if(de[5]?ye?ye.p(de,Ae):(ye=Ls(de),ye.c(),ye.m(r,m)):ye&&(ye.d(1),ye=null),Ae[0]&1){He=de[0];let at;for(at=0;at<He.length;at+=1){const qt=Es(de,He,at);Ke[at]?Ke[at].p(qt,Ae):(Ke[at]=Is(qt),Ke[at].c(),Ke[at].m(_,h))}for(;at<Ke.length;at+=1)Ke[at].d(1);Ke.length=He.length}de[2]?qe||(qe=Ds(),qe.c(),qe.m(_,null)):qe&&(qe.d(1),qe=null),de[4]?Le?Le.p(de,Ae):(Le=Ns(de),Le.c(),Le.m(r,v)):Le&&(Le.d(1),Le=null),de[3]?Ie?Ie.p(de,Ae):(Ie=Os(de),Ie.c(),Ie.m(r,w)):Ie&&(Ie.d(1),Ie=null),Ae[0]&2&&De(k,de[1]),(!Me||Ae[0]&6&&E!==(E=de[2]||!de[1].trim()))&&(D.disabled=E),Oe!==(Oe=it(de))&&(We.d(1),We=Oe(de),We&&(We.c(),We.m(F,null))),(!Me||Ae[0]&128)&&(F.disabled=de[7]),de[8]?G?G.p(de,Ae):(G=Ps(de),G.c(),G.m(V,J)):G&&(G.d(1),G=null);let ot=X;X=ue(de),X===ot?W[X].p(de,Ae):(Ue(),B(W[ot],1,1,()=>{W[ot]=null}),ze(),Q=W[X],Q?Q.p(de,Ae):(Q=W[X]=te[X](de),Q.c()),M(Q,1),Q.m(V,re)),(!Me||Ae[0]&64)&&x!==(x=de[6].length+"")&&ve(ce,x);const ft={};Ae[0]&16384&&(ft.context=de[14]),Ae[0]&32768&&(ft.mode=de[15]),!Ne&&Ae[0]&8192&&(Ne=!0,ft.active=de[13],rt(()=>Ne=!1)),Be.$set(ft);const Mt={};Ae[0]&32&&(Mt.conversationId=de[5]),!Re&&Ae[0]&65536&&(Re=!0,Mt.active=de[16],rt(()=>Re=!1)),fe.$set(Mt)},i(de){Me||(M(e.$$.fragment,de),M(Q),M(Be.$$.fragment,de),M(fe.$$.fragment,de),Me=!0)},o(de){B(e.$$.fragment,de),B(Q),B(Be.$$.fragment,de),B(fe.$$.fragment,de),Me=!1},d(de){he(e,de),de&&T(t),de&&T(n),ye&&ye.d(),tt(Ke,de),qe&&qe.d(),Le&&Le.d(),Ie&&Ie.d(),We.d(),G&&G.d(),W[X].d(),de&&T(Ze),he(Be,de),de&&T(Pe),he(fe,de),Xe=!1,lt(xe)}}}function Lc(l,e,t){let n;je(l,ct,K=>t(43,n=K));let o=[],a="",r=!1,u=null,i=null,d=null,p=[],m=!1,_=!1,h="",b="",v="document",w=!1,y=!1,$=null,k="edit",S=null,j=!1;function D(K){t(0,o=[...o,{role:"user",content:K}])}async function O(){try{if(n){const K=await Ge("list_conversations");K!=null&&K.conversations&&K.conversations.length>0?(t(5,d=K.conversations[0].id),console.log("üéØ Using existing conversation:",d),await U()):await E()}else{const K=await fetch(`${Ye.ServerURL}/conversations`);if(K.ok){const x=await K.json();x.conversations&&x.conversations.length>0?(t(5,d=x.conversations[0].id),console.log("üéØ Using existing conversation:",d),await U()):await E()}else await E()}}catch(K){console.error("‚ùå Error initializing conversation:",K)}}async function E(){try{const K=Rt(At);if(n){const x=await Ge("create_conversation",{title:"Chat Conversation",role:K});x.status==="success"&&x.conversation_id&&(t(5,d=x.conversation_id),console.log("üÜï Created new conversation:",d))}else{const x=await fetch(`${Ye.ServerURL}/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"Chat Conversation",role:K})});if(x.ok){const ce=await x.json();ce.status==="Success"&&ce.conversation_id&&(t(5,d=ce.conversation_id),console.log("üÜï Created new conversation:",d))}}}catch(K){console.error("‚ùå Error creating conversation:",K)}}async function U(){if(!d){console.warn("‚ö†Ô∏è Cannot load context: no conversation ID available");return}t(7,m=!0),console.log("üîÑ Loading conversation context for:",d);try{if(n){console.log("üì± Loading context via Tauri...");const K=await Ge("get_conversation",{conversationId:d});if(console.log("üì• Tauri response:",K),K.status==="success"&&K.conversation){const x=K.conversation.global_context||[];t(6,p=x),console.log(`‚úÖ Loaded ${x.length} context items via Tauri`)}else console.error("‚ùå Failed to get conversation via Tauri:",K.error||"Unknown error"),t(6,p=[])}else{console.log("üåê Loading context via HTTP...");const K=await fetch(`${Ye.ServerURL}/conversations/${d}`);if(console.log("üì• HTTP response status:",K.status,K.statusText),K.ok){const x=await K.json();if(console.log("üìÑ HTTP response data:",x),x.status==="success"&&x.conversation){const ce=x.conversation.global_context||[];t(6,p=ce),console.log(`‚úÖ Loaded ${ce.length} context items via HTTP`)}else console.error("‚ùå Failed to get conversation via HTTP:",x.error||"Unknown error"),t(6,p=[])}else console.error("‚ùå HTTP request failed:",K.status,K.statusText),t(6,p=[])}}catch(K){console.error("‚ùå Error loading conversation context:",{error:K.message||K,conversationId:d,isTauri:n,timestamp:new Date().toISOString()}),t(6,p=[])}finally{t(7,m=!1),console.log("üèÅ Context loading completed. Items count:",p.length)}}function Z(){t(8,_=!_),_||(t(9,h=""),t(10,b=""),t(11,v="document"))}async function V(){if(!(!d||!h.trim()||!b.trim())){t(12,w=!0);try{const K={title:h.trim(),summary:null,content:b.trim(),context_type:v};if(n){const x=await Ge("add_context_to_conversation",{conversationId:d,contextData:K});x.status==="success"?(await U(),Z(),console.log("‚úÖ Context added successfully via Tauri")):console.error("‚ùå Failed to add context via Tauri:",x.error)}else{const x=await fetch(`${Ye.ServerURL}/conversations/${d}/context`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(K)});if(x.ok){const ce=await x.json();ce.status==="success"?(await U(),Z(),console.log("‚úÖ Context added successfully via HTTP")):console.error("‚ùå Failed to add context via HTTP:",ce.error)}else console.error("‚ùå HTTP request failed:",x.status,x.statusText)}}catch(K){console.error("‚ùå Error adding manual context:",K)}finally{t(12,w=!1)}}}function A(K){t(14,$=K),t(15,k="edit"),t(13,y=!0)}function C(K){confirm(`Are you sure you want to delete "${K.title}"?`)&&ne(K.id)}async function ne(K){if(!(!d||S)){S=K,console.log("üóëÔ∏è Deleting context:",K);try{if(n){const x=await Ge("delete_context",{conversationId:d,contextId:K});(x==null?void 0:x.status)==="success"?(console.log("‚úÖ Context deleted successfully via Tauri"),await U()):console.error("‚ùå Failed to delete context via Tauri:",x==null?void 0:x.error)}else{const x=await fetch(`${Ye.ServerURL}/conversations/${d}/context/${K}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(x.ok){const ce=await x.json();ce.status==="success"?(console.log("‚úÖ Context deleted successfully via HTTP"),await U()):console.error("‚ùå Failed to delete context via HTTP:",ce.error)}else console.error("‚ùå HTTP delete request failed:",x.status)}}catch(x){console.error("‚ùå Error deleting context:",x)}finally{S=null}}}async function q(K){if(d){console.log("üìù Updating context:",K.id);try{const x={context_type:K.context_type,title:K.title,summary:K.summary,content:K.content,metadata:K.metadata};if(n){const ce=await Ge("update_context",{conversationId:d,contextId:K.id,request:x});(ce==null?void 0:ce.status)==="success"?(console.log("‚úÖ Context updated successfully via Tauri"),await U()):console.error("‚ùå Failed to update context via Tauri:",ce==null?void 0:ce.error)}else{const ce=await fetch(`${Ye.ServerURL}/conversations/${d}/context/${K.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(x)});if(ce.ok){const ge=await ce.json();ge.status==="success"?(console.log("‚úÖ Context updated successfully via HTTP"),await U()):console.error("‚ùå Failed to update context via HTTP:",ge.error)}else console.error("‚ùå HTTP update request failed:",ce.status)}}catch(x){console.error("‚ùå Error updating context:",x)}}}async function le(){var ce;if(!a.trim()||r)return;t(3,u=null);const K=Rt(At),x=a.trim();t(1,a=""),d||await O(),D(x),t(2,r=!0);try{const ge={role:K,messages:o};d&&(ge.conversation_id=d);const ke=await fetch(`${Ye.ServerURL}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ge)});if(!ke.ok)throw new Error(`HTTP ${ke.status}`);const Te=await ke.json();t(4,i=Te.model_used??null),((ce=Te.status)==null?void 0:ce.toLowerCase())==="success"&&Te.message?t(0,o=[...o,{role:"assistant",content:Te.message}]):t(3,u=Te.error||"Chat failed")}catch(ge){t(3,u=(ge==null?void 0:ge.message)||String(ge))}finally{t(2,r=!1)}}function Y(K){(K.key==="Enter"||K.key==="Return")&&!K.shiftKey&&(K.preventDefault(),le())}function H(){t(16,j=!0)}function oe(K){console.log("‚úÖ KG term added to context:",K.detail.term),U()}function N(K){console.log("‚úÖ KG index added to context for role:",K.detail.role),U()}tl(()=>{if(t(0,o=[{role:"assistant",content:"Hi! How can I help you? Ask me anything about your search results or documents."}]),O(),typeof window<"u"){const K=()=>{d&&U()};return window.addEventListener("focus",K),()=>{window.removeEventListener("focus",K)}}});function z(){a=this.value,t(1,a)}function I(){v=St(this),t(11,v)}function L(){h=this.value,t(9,h)}function F(){b=this.value,t(10,b)}const ee=K=>ne(K.detail.contextId),J=K=>A(K.detail.contextItem),X=K=>A(K),Q=K=>C(K);function re(K){y=K,t(13,y)}const pe=K=>q(K.detail),ie=K=>ne(K.detail),ae=()=>{t(13,y=!1),t(14,$=null)};function be(K){j=K,t(16,j)}return[o,a,r,u,i,d,p,m,_,h,b,v,w,y,$,k,j,U,Z,V,A,C,ne,q,le,Y,H,oe,N,z,I,L,F,ee,J,X,Q,re,pe,ie,ae,be]}class Ic extends mt{constructor(e){super(),_t(this,e,Lc,Ec,dt,{},null,[-1,-1])}}function Dc(l){let e,t;return e=new va({}),{c(){me(e.$$.fragment)},m(n,o){_e(e,n,o),t=!0},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function Nc(l){let e,t;return e=new Ic({}),{c(){me(e.$$.fragment)},m(n,o){_e(e,n,o),t=!0},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function Oc(l){let e,t;return e=new ja({}),{c(){me(e.$$.fragment)},m(n,o){_e(e,n,o),t=!0},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function Pc(l){let e,t;return e=new oi({}),{c(){me(e.$$.fragment)},m(n,o){_e(e,n,o),t=!0},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function Mc(l){let e,t;return e=new Ea({}),{c(){me(e.$$.fragment)},m(n,o){_e(e,n,o),t=!0},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function jc(l){let e,t;return e=new Da({}),{c(){me(e.$$.fragment)},m(n,o){_e(e,n,o),t=!0},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function Uc(l){let e;return{c(){e=f("nav"),e.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
            <a class="navbar-item" href="/config/wizard">Wizard</a> 
            <a class="navbar-item" href="/config/json">JSON¬†Editor</a> 
            <a class="navbar-item" href="/graph">Graph</a> 
            <a class="navbar-item" href="/chat">Chat</a></div>`,c(e,"class","navbar")},m(t,n){R(t,e,n)},p:Ce,d(t){t&&T(e)}}}function zc(l){let e,t,n,o,a,r,u,i,d,p,m,_,h,b,v,w,y,$,k,S,j,D,O,E,U,Z,V,A,C,ne,q,le,Y,H,oe,N,z,I,L,F,ee,J;return k=new Ml({}),D=new Nt({props:{path:"/",$$slots:{default:[Dc]},$$scope:{ctx:l}}}),E=new Nt({props:{path:"/chat",$$slots:{default:[Nc]},$$scope:{ctx:l}}}),Z=new Nt({props:{path:"/graph",$$slots:{default:[Oc]},$$scope:{ctx:l}}}),ne=new Nt({props:{path:"/fetch/*",$$slots:{default:[Pc]},$$scope:{ctx:l}}}),le=new Nt({props:{path:"/config/wizard",$$slots:{default:[Mc]},$$scope:{ctx:l}}}),H=new Nt({props:{path:"/config/json",$$slots:{default:[jc]},$$scope:{ctx:l}}}),I=new Nt({props:{path:"/",$$slots:{default:[Uc]},$$scope:{ctx:l}}}),{c(){e=f("meta"),t=g(),n=f("div"),o=f("main"),a=f("div"),r=f("div"),u=f("div"),i=f("ul"),d=f("li"),p=f("a"),p.innerHTML=`<span class="icon is-small"><i class="fas fa-search"></i></span> 
                <span>Search</span>`,m=g(),_=f("li"),h=f("a"),h.innerHTML=`<span class="icon is-small"><i class="fas fa-comments"></i></span> 
                <span>Chat</span>`,b=g(),v=f("li"),w=f("a"),w.innerHTML=`<span class="icon is-small"><i class="fas fa-project-diagram"></i></span> 
                <span>Graph</span>`,y=g(),$=f("div"),me(k.$$.fragment),S=g(),j=f("div"),me(D.$$.fragment),O=g(),me(E.$$.fragment),U=g(),me(Z.$$.fragment),V=g(),A=f("br"),C=g(),me(ne.$$.fragment),q=g(),me(le.$$.fragment),Y=g(),me(H.$$.fragment),oe=g(),N=f("footer"),z=f("div"),me(I.$$.fragment),c(e,"name","color-scheme"),c(e,"content",l[1]),document.title="Terraphim",c(p,"href","/"),c(p,"data-exact",""),c(p,"data-testid","search-tab"),c(d,"class","svelte-1nmgbjk"),c(h,"href","/chat"),c(h,"data-testid","chat-tab"),c(_,"class","svelte-1nmgbjk"),c(w,"href","/graph"),c(w,"data-testid","graph-tab"),c(v,"class","svelte-1nmgbjk"),c(u,"class","tabs is-boxed svelte-1nmgbjk"),c(r,"class","main-navigation svelte-1nmgbjk"),c($,"class","role-selector svelte-1nmgbjk"),c(a,"class","top-controls svelte-1nmgbjk"),c(j,"class","main-area svelte-1nmgbjk"),c(o,"class","main-content svelte-1nmgbjk"),c(z,"class",L=Pt(l[0])+" svelte-1nmgbjk"),c(N,"class","svelte-1nmgbjk"),c(n,"class","is-full-height svelte-1nmgbjk")},m(X,Q){s(document.head,e),R(X,t,Q),R(X,n,Q),s(n,o),s(o,a),s(a,r),s(r,u),s(u,i),s(i,d),s(d,p),s(i,m),s(i,_),s(_,h),s(i,b),s(i,v),s(v,w),s(a,y),s(a,$),_e(k,$,null),s(o,S),s(o,j),_e(D,j,null),s(j,O),_e(E,j,null),s(j,U),_e(Z,j,null),s(o,V),s(o,A),s(o,C),_e(ne,o,null),s(o,q),_e(le,o,null),s(o,Y),_e(H,o,null),s(n,oe),s(n,N),s(N,z),_e(I,z,null),F=!0,ee||(J=[Hl(Fl.call(null,p)),Hl(Fl.call(null,h)),Hl(Fl.call(null,w)),se(N,"mouseover",l[2]),se(N,"focus",l[2])],ee=!0)},p(X,[Q]){(!F||Q&2)&&c(e,"content",X[1]);const re={};Q&16&&(re.$$scope={dirty:Q,ctx:X}),D.$set(re);const pe={};Q&16&&(pe.$$scope={dirty:Q,ctx:X}),E.$set(pe);const ie={};Q&16&&(ie.$$scope={dirty:Q,ctx:X}),Z.$set(ie);const ae={};Q&16&&(ae.$$scope={dirty:Q,ctx:X}),ne.$set(ae);const be={};Q&16&&(be.$$scope={dirty:Q,ctx:X}),le.$set(be);const K={};Q&16&&(K.$$scope={dirty:Q,ctx:X}),H.$set(K);const x={};Q&16&&(x.$$scope={dirty:Q,ctx:X}),I.$set(x),(!F||Q&1&&L!==(L=Pt(X[0])+" svelte-1nmgbjk"))&&c(z,"class",L)},i(X){F||(M(k.$$.fragment,X),M(D.$$.fragment,X),M(E.$$.fragment,X),M(Z.$$.fragment,X),M(ne.$$.fragment,X),M(le.$$.fragment,X),M(H.$$.fragment,X),M(I.$$.fragment,X),F=!0)},o(X){B(k.$$.fragment,X),B(D.$$.fragment,X),B(E.$$.fragment,X),B(Z.$$.fragment,X),B(ne.$$.fragment,X),B(le.$$.fragment,X),B(H.$$.fragment,X),B(I.$$.fragment,X),F=!1},d(X){T(e),X&&T(t),X&&T(n),he(k),he(D),he(E),he(Z),he(ne),he(le),he(H),he(I),ee=!1,lt(J)}}}function Hc(l,e,t){let n;je(l,bl,r=>t(1,n=r));let o="is-hidden";function a(){t(0,o="")}return[o,n,a]}class Fc extends mt{constructor(e){super(),_t(this,e,Hc,zc,dt,{})}}const Kc=new wr;yr(Kc);new Fc({target:document.getElementById("app")});
