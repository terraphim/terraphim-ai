var Li=Object.defineProperty;var Ei=(l,e,t)=>e in l?Li(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var Xt=(l,e,t)=>(Ei(l,typeof e!="symbol"?e+"":e,t),t);import{aa as el,S as Pt,i as Ut,s as Ot,q as f,Y as M,b as T,y as s,Z as ce,I as $e,j as S,ak as qe,au as dl,r as be,a as b,v as a,z as ke,t as W,d as x,B as we,av as Ai,aw as bl,H as mt,U as kt,V as wt,ax as pl,ay as Di,F as St,g as We,e as Je,O as _t,af as ht,m as vl,o as rn,W as Te,l as ee,E as st,az as Ul,aA as Wt,aB as an,aC as Ni,a1 as Pe,C as It,aD as rt,aE as cn,D as Al,G as Dl,aF as ml,w as rl,x as vt,A as jl,a2 as Ii,aG as ol,ac as ii,a5 as Vl,aH as ri,a7 as ai,a9 as ci,n as Oi,k as un,_ as xl}from"./vendor-ui-ec1c326c.js";import{R as sl,S as Hl,f as ui,Y as en}from"./vendor-utils-8620e3e4.js";import{J as fi,_ as Pl,c as di,P as Mi,i as Pi,D as Ui,j as ji,E as Hi,k as Tn}from"./vendor-editor-5741781d.js";import{P as pi,T as Yl,b as mi,y as Fi,A as zi}from"./vendor-atomic-ec100559.js";import{t as Ki,E as Gi}from"./novel-editor-ff46bbca.js";import{s as tn,z as qi,a as Wi,l as Ji,m as Bi,c as Qi,b as Vi,B as Yi,d as Zi}from"./vendor-charts-e6a4a6c9.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(o){if(o.ep)return;o.ep=!0;const r=t(o);fetch(o.href,r)}})();const ct={ServerURL:location.protocol+"//"+window.location.host||"/"},Ol=el([]),Xi={id:"Desktop",global_shortcut:"",roles:{},default_role:{original:"",lowercase:""},selected_role:{original:"",lowercase:""}},Ml=el("spacelab"),$t=el("selected"),bt=el(!1),xi=el(`${ct.ServerURL}/documents/search`),Jt=el(Xi),$n=el([]);let fl=el("");const xt=el(!1),Jl=el(null),Rn=el(!1);let Sl=null;function er(l){if(typeof document>"u")return;const e=`/assets/bulmaswatch/${l}/bulmaswatch.min.css`;if(Sl!=null&&Sl.href.endsWith(e))return;const t=document.createElement("link");t.rel="stylesheet",t.href=e,t.id="bulma-theme",t.onload=()=>{Sl&&Sl!==t&&Sl.remove(),Sl=t},document.head.appendChild(t);const n=document.head.querySelector('meta[name="color-scheme"]');n&&n.setAttribute("content",l)}Ml.subscribe(er);function tr(l){let e,t;return{c(){e=f("option"),t=M(l[1]),e.__value=l[0],e.value=e.__value},m(n,o){T(n,e,o),s(e,t)},p(n,[o]){o&2&&ce(t,n[1]),o&1&&(e.__value=n[0],e.value=e.__value)},i:$e,o:$e,d(n){n&&S(e)}}}function lr(l,e,t){let n,{subject:o}=e;const r=pi(o),i=Yl(r,mi.properties.name);return qe(l,i,u=>t(1,n=u)),Yl(r,"http://localhost:9883/property/theme"),l.$$set=u=>{"subject"in u&&t(0,o=u.subject)},[o,n,i]}class nr extends Pt{constructor(e){super(),Ut(this,e,lr,tr,Ot,{subject:0})}}function or(){return window.crypto.getRandomValues(new Uint32Array(1))[0]}function nn(l,e=!1){const t=or(),n=`_${t}`;return Object.defineProperty(window,n,{value:o=>(e&&Reflect.deleteProperty(window,n),l==null?void 0:l(o)),writable:!1,configurable:!0}),t}async function He(l,e={}){return new Promise((t,n)=>{const o=nn(i=>{t(i),Reflect.deleteProperty(window,`_${r}`)},!0),r=nn(i=>{n(i),Reflect.deleteProperty(window,`_${o}`)},!0);window.__TAURI_IPC__({cmd:l,callback:o,error:r,...e})})}function Ln(l,e,t){const n=l.slice();return n[25]=e[t],n}function sr(l){let e,t,n;function o(i){l[13](i)}let r={};return l[5]!==void 0&&(r.value=l[5]),e=new bl({props:r}),mt.push(()=>kt(e,"value",o)),{c(){be(e.$$.fragment)},m(i,u){ke(e,i,u),n=!0},p(i,u){const c={};!t&&u&32&&(t=!0,c.value=i[5],wt(()=>t=!1)),e.$set(c)},i(i){n||(W(e.$$.fragment,i),n=!0)},o(i){x(e.$$.fragment,i),n=!1},d(i){we(e,i)}}}function ir(l){let e,t,n;function o(i){l[14](i)}let r={type:"password",placeholder:"secret",icon:"fas fa-lock",expanded:!0};return l[6]!==void 0&&(r.value=l[6]),e=new bl({props:r}),mt.push(()=>kt(e,"value",o)),{c(){be(e.$$.fragment)},m(i,u){ke(e,i,u),n=!0},p(i,u){const c={};!t&&u&64&&(t=!0,c.value=i[6],wt(()=>t=!1)),e.$set(c)},i(i){n||(W(e.$$.fragment,i),n=!0)},o(i){x(e.$$.fragment,i),n=!1},d(i){we(e,i)}}}function rr(l){let e;return{c(){e=M("Save")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function ar(l){let e,t;return e=new pl({props:{type:"is-success",class:"is-right",iconPack:"fa",iconLeft:"check",$$slots:{default:[rr]},$$scope:{ctx:l}}}),e.$on("click",l[8]),e.$on("submit",l[8]),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},p(n,o){const r={};o&268435456&&(r.$$scope={dirty:o,ctx:n}),e.$set(r)},i(n){t||(W(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function cr(l){let e,t,n,o,r,i;return e=new dl({props:{$$slots:{default:[sr]},$$scope:{ctx:l}}}),n=new dl({props:{grouped:!0,$$slots:{default:[ir]},$$scope:{ctx:l}}}),r=new dl({props:{grouped:!0,$$slots:{default:[ar]},$$scope:{ctx:l}}}),{c(){be(e.$$.fragment),t=b(),be(n.$$.fragment),o=b(),be(r.$$.fragment)},m(u,c){ke(e,u,c),T(u,t,c),ke(n,u,c),T(u,o,c),ke(r,u,c),i=!0},p(u,c){const p={};c&268435488&&(p.$$scope={dirty:c,ctx:u}),e.$set(p);const d={};c&268435520&&(d.$$scope={dirty:c,ctx:u}),n.$set(d);const m={};c&268435456&&(m.$$scope={dirty:c,ctx:u}),r.$set(m)},i(u){i||(W(e.$$.fragment,u),W(n.$$.fragment,u),W(r.$$.fragment,u),i=!0)},o(u){x(e.$$.fragment,u),x(n.$$.fragment,u),x(r.$$.fragment,u),i=!1},d(u){we(e,u),u&&S(t),we(n,u),u&&S(o),we(r,u)}}}function ur(l){let e,t,n;function o(i){l[15](i)}let r={type:"search",placeholder:"Fetch JSON",icon:"search"};return l[3]!==void 0&&(r.value=l[3]),e=new bl({props:r}),mt.push(()=>kt(e,"value",o)),{c(){be(e.$$.fragment)},m(i,u){ke(e,i,u),n=!0},p(i,u){const c={};!t&&u&8&&(t=!0,c.value=i[3],wt(()=>t=!1)),e.$set(c)},i(i){n||(W(e.$$.fragment,i),n=!0)},o(i){x(e.$$.fragment,i),n=!1},d(i){we(e,i)}}}function fr(l){let e;return{c(){e=M("WikiPage")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function dr(l){let e,t,n,o,r,i;function u(m){l[16](m)}let c={type:"search",placeholder:"Post JSON",icon:"search"};l[4]!==void 0&&(c.value=l[4]),e=new bl({props:c}),mt.push(()=>kt(e,"value",u));function p(m){l[17](m)}let d={$$slots:{default:[fr]},$$scope:{ctx:l}};return l[2]!==void 0&&(d.checked=l[2]),o=new Di({props:d}),mt.push(()=>kt(o,"checked",p)),{c(){be(e.$$.fragment),n=b(),be(o.$$.fragment)},m(m,_){ke(e,m,_),T(m,n,_),ke(o,m,_),i=!0},p(m,_){const g={};!t&&_&16&&(t=!0,g.value=m[4],wt(()=>t=!1)),e.$set(g);const h={};_&268435456&&(h.$$scope={dirty:_,ctx:m}),!r&&_&4&&(r=!0,h.checked=m[2],wt(()=>r=!1)),o.$set(h)},i(m){i||(W(e.$$.fragment,m),W(o.$$.fragment,m),i=!0)},o(m){x(e.$$.fragment,m),x(o.$$.fragment,m),i=!1},d(m){we(e,m),m&&S(n),we(o,m)}}}function pr(l){let e;return{c(){e=M("Fetch")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function mr(l){let e,t;return e=new pl({props:{type:"is-primary",$$slots:{default:[pr]},$$scope:{ctx:l}}}),e.$on("click",l[9]),e.$on("submit",l[9]),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},p(n,o){const r={};o&268435456&&(r.$$scope={dirty:o,ctx:n}),e.$set(r)},i(n){t||(W(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function _r(l){let e,t,n,o,r,i;return e=new dl({props:{grouped:!0,$$slots:{default:[ur]},$$scope:{ctx:l}}}),n=new dl({props:{grouped:!0,$$slots:{default:[dr]},$$scope:{ctx:l}}}),r=new dl({props:{grouped:!0,$$slots:{default:[mr]},$$scope:{ctx:l}}}),{c(){be(e.$$.fragment),t=b(),be(n.$$.fragment),o=b(),be(r.$$.fragment)},m(u,c){ke(e,u,c),T(u,t,c),ke(n,u,c),T(u,o,c),ke(r,u,c),i=!0},p(u,c){const p={};c&268435464&&(p.$$scope={dirty:c,ctx:u}),e.$set(p);const d={};c&268435476&&(d.$$scope={dirty:c,ctx:u}),n.$set(d);const m={};c&268435456&&(m.$$scope={dirty:c,ctx:u}),r.$set(m)},i(u){i||(W(e.$$.fragment,u),W(n.$$.fragment,u),W(r.$$.fragment,u),i=!0)},o(u){x(e.$$.fragment,u),x(n.$$.fragment,u),x(r.$$.fragment,u),i=!1},d(u){we(e,u),u&&S(t),we(n,u),u&&S(o),we(r,u)}}}function gr(l){let e,t,n,o,r;return o=new fi({props:{content:l[1],onChange:l[7]}}),{c(){e=f("p"),e.innerHTML=`<i>The best editing experience is to configure Atomic Server, in the
        meantime use editor below. You will need to refresh page via Command R
        or Ctrl-R to see changes</i>`,t=b(),n=f("div"),be(o.$$.fragment),a(n,"class","editor")},m(i,u){T(i,e,u),T(i,t,u),T(i,n,u),ke(o,n,null),r=!0},p(i,u){const c={};u&2&&(c.content=i[1]),o.$set(c)},i(i){r||(W(o.$$.fragment,i),r=!0)},o(i){x(o.$$.fragment,i),r=!1},d(i){i&&S(e),i&&S(t),i&&S(n),we(o)}}}function En(l){let e,t;return e=new nr({props:{subject:l[25]}}),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},p(n,o){const r={};o&1&&(r.subject=n[25]),e.$set(r)},i(n){t||(W(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function hr(l){let e,t,n=l[0]??[],o=[];for(let i=0;i<n.length;i+=1)o[i]=En(Ln(l,n,i));const r=i=>x(o[i],1,1,()=>{o[i]=null});return{c(){for(let i=0;i<o.length;i+=1)o[i].c();e=St()},m(i,u){for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(i,u);T(i,e,u),t=!0},p(i,u){if(u&1){n=i[0]??[];let c;for(c=0;c<n.length;c+=1){const p=Ln(i,n,c);o[c]?(o[c].p(p,u),W(o[c],1)):(o[c]=En(p),o[c].c(),W(o[c],1),o[c].m(e.parentNode,e))}for(We(),c=n.length;c<o.length;c+=1)r(c);Je()}},i(i){if(!t){for(let u=0;u<n.length;u+=1)W(o[u]);t=!0}},o(i){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)x(o[u]);t=!1},d(i){_t(o,i),i&&S(e)}}}function vr(l){let e,t;return e=new Ai({props:{$$slots:{default:[hr]},$$scope:{ctx:l}}}),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},p(n,o){const r={};o&268435457&&(r.$$scope={dirty:o,ctx:n}),e.$set(r)},i(n){t||(W(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function br(l){let e,t,n,o,r,i,u,c,p,d,m,_,g;return t=new sl({props:{path:"/atomic",$$slots:{default:[cr]},$$scope:{ctx:l}}}),o=new sl({props:{path:"/json",$$slots:{default:[_r]},$$scope:{ctx:l}}}),i=new sl({props:{path:"/editor",$$slots:{default:[gr]},$$scope:{ctx:l}}}),d=new dl({props:{grouped:!0,position:"is-right",$$slots:{default:[vr]},$$scope:{ctx:l}}}),{c(){e=f("div"),be(t.$$.fragment),n=b(),be(o.$$.fragment),r=b(),be(i.$$.fragment),u=b(),c=f("hr"),p=b(),be(d.$$.fragment),m=b(),_=f("nav"),_.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
    <a class="navbar-item" href="/fetch/json">Fetch JSON Data</a> 
    <a class="navbar-item" href="/fetch/atomic">Set Atomic Server</a> 
    <a class="navbar-item" href="/fetch/editor">Edit JSON config</a></div>`,a(e,"class","box"),a(_,"class","navbar")},m(h,v){T(h,e,v),ke(t,e,null),s(e,n),ke(o,e,null),s(e,r),ke(i,e,null),T(h,u,v),T(h,c,v),T(h,p,v),ke(d,h,v),T(h,m,v),T(h,_,v),g=!0},p(h,[v]){const y={};v&268435552&&(y.$$scope={dirty:v,ctx:h}),t.$set(y);const k={};v&268435484&&(k.$$scope={dirty:v,ctx:h}),o.$set(k);const w={};v&268435458&&(w.$$scope={dirty:v,ctx:h}),i.$set(w);const $={};v&268435457&&($.$$scope={dirty:v,ctx:h}),d.$set($)},i(h){g||(W(t.$$.fragment,h),W(o.$$.fragment,h),W(i.$$.fragment,h),W(d.$$.fragment,h),g=!0)},o(h){x(t.$$.fragment,h),x(o.$$.fragment,h),x(i.$$.fragment,h),x(d.$$.fragment,h),g=!1},d(h){h&&S(e),we(t),we(o),we(i),h&&S(u),h&&S(c),h&&S(p),we(d,h),h&&S(m),h&&S(_)}}}function kr(l,e,t){let n,o,r,i,u;qe(l,Fi,D=>t(19,r=D)),qe(l,bt,D=>t(20,i=D)),qe(l,Jt,D=>t(21,u=D));let c={json:u};function p(D){if(console.log("contents changed:",D),console.log("is tauri",i),Jt.update(A=>(A=D.json,A)),bt)console.log("Updating config on server"),He("update_config",{configNew:D.json}).then(A=>{console.log(`Message: ${A}`)}).catch(A=>console.error(A));else{let A=`${ct.ServerURL}/config/`;fetch(A,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(D.json)})}t(1,c=D)}let d=!1,m="https://raw.githubusercontent.com/terraphim/terraphim-cloud-fastapi/main/data/ref_arch.json",_="http://localhost:8000/documents/",g="http://localhost:9883/",h;const v=async()=>{console.log("Updating atomic server configuration");const D=zi.fromSecret(h);r.setServerUrl(g),console.log("Server set.Setting agent"),r.setAgent(D)},y=async()=>{$()},k=({data:{msg:D,data:A}})=>{console.log(D,A)};let w;const $=async()=>{const D=await Pl(()=>import("./fetcher.worker-7e58969a.js"),[]);w=new D.default,w.onmessage=k;const A={msg:"fetcher",data:{url:m,postUrl:_,isWiki:d}};w.postMessage(A)},C=pi("http://localhost:9883/config/y3zx5wtm0bq"),R=Yl(C,mi.properties.name);qe(l,R,D=>t(12,o=D));const I=Yl(C,"http://localhost:9883/property/role");qe(l,I,D=>t(0,n=D));function N(D){g=D,t(5,g)}function E(D){h=D,t(6,h)}function O(D){m=D,t(3,m)}function Q(D){_=D,t(4,_)}function Z(D){d=D,t(2,d)}return l.$$.update=()=>{l.$$.dirty&4096&&console.log("Print name",o),l.$$.dirty&1&&console.log("Print roles",n)},[n,c,d,m,_,g,h,p,v,y,R,I,o,N,E,O,Q,Z]}class wr extends Pt{constructor(e){super(),Ut(this,e,kr,br,Ot,{})}}function hl(){return ht(bt)||typeof window<"u"&&window.__TAURI__!==void 0}class yr{constructor(){Xt(this,"baseUrl");Xt(this,"autocompleteIndexBuilt",!1);Xt(this,"sessionId");Xt(this,"currentRole","Default");Xt(this,"connectionRetries",0);Xt(this,"maxRetries",3);Xt(this,"retryDelay",1e3);Xt(this,"isConnecting",!1);this.baseUrl=typeof window<"u"?(window.location.protocol==="https:"?"https://":"http://")+window.location.hostname+":8001":"http://localhost:8001",this.sessionId=`novel-${Date.now()}`,typeof window<"u"&&!hl()&&this.shouldPerformHealthCheck()?this.detectServerPort():typeof window<"u"&&!hl()&&console.log("NovelAutocompleteService: Skipping server detection - not needed for current page")}setRole(e){this.currentRole=e,this.autocompleteIndexBuilt=!1}async detectServerPort(){if(hl())return;if(!this.shouldPerformHealthCheck()){console.log("NovelAutocompleteService: Skipping health check - service not needed");return}const t=[8001,3e3];for(const n of t)try{const o=typeof window<"u"?(window.location.protocol==="https:"?"https://":"http://")+window.location.hostname+":"+n:"http://localhost:"+n,r=await fetch(`${o}/message?sessionId=health-check`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:0,method:"ping",params:{}}),signal:AbortSignal.timeout(1e3)});if(r.ok||r.status===404){this.baseUrl=o,console.log(`NovelAutocompleteService: Detected server at ${o}`);return}}catch{continue}console.warn("NovelAutocompleteService: Could not detect running server, using default:",this.baseUrl)}shouldPerformHealthCheck(){return!(typeof window<"u"&&(!window.location.pathname.startsWith("/chat")||!(document.querySelector('[contenteditable="true"]')||document.querySelector("textarea")||document.querySelector('input[type="text"]'))))}async buildAutocompleteIndex(){if(this.isConnecting)return await new Promise(e=>setTimeout(e,1e3)),this.autocompleteIndexBuilt;this.isConnecting=!0;try{return hl()?(console.log("Using Tauri backend - no index building required"),this.autocompleteIndexBuilt=!0,this.connectionRetries=0,console.log("Tauri autocomplete ready"),!0):await this.buildMCPIndex()}catch(e){return console.error("Error building Novel autocomplete index:",e),!1}finally{this.isConnecting=!1}}async buildMCPIndex(){for(let e=0;e<=this.maxRetries;e++)try{const t=await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:Date.now(),method:"tools/call",params:{name:"build_autocomplete_index",arguments:{}}}),signal:AbortSignal.timeout(1e4)});if(t.ok){const n=await t.json();if(console.log(`MCP build index response (attempt ${e+1}):`,n),n.result&&!n.result.is_error)return this.autocompleteIndexBuilt=!0,this.connectionRetries=0,console.log("MCP autocomplete index built successfully"),!0}else if(t.status>=500&&e<this.maxRetries){console.warn(`MCP server error ${t.status}, retrying in ${this.retryDelay}ms...`),await new Promise(n=>setTimeout(n,this.retryDelay*(e+1)));continue}console.warn(`MCP build index failed (attempt ${e+1}):`,t.status,t.statusText)}catch(t){t instanceof Error&&t.name==="AbortError"?console.warn(`MCP request timeout (attempt ${e+1})`):console.warn(`MCP connection error (attempt ${e+1}):`,t),e<this.maxRetries&&await new Promise(n=>setTimeout(n,this.retryDelay*(e+1)))}return console.error("Failed to build MCP autocomplete index after all retries"),!1}async getCompletion(e){if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return{text:""};try{const t=this.extractLastWord(e.prompt);if(!t||t.length<1)return{text:""};const n=await this.getSuggestionsWithSnippets(t,5);if(n.length===0)return{text:""};let r=n[0].text;r.toLowerCase().startsWith(t.toLowerCase())&&(r=r.substring(t.length));const i=e.prompt.length/4,u=r.length/4;return{text:r,usage:{promptTokens:Math.round(i),completionTokens:Math.round(u),totalTokens:Math.round(i+u)}}}catch(t){return console.error("Error getting Novel autocomplete completion:",t),{text:""}}}async getSuggestions(e,t=10){if(!e||e.trim().length===0)return[];if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return console.warn("Autocomplete index not built, returning empty suggestions"),[];try{return hl()?await this.getTauriSuggestions(e,t):await this.getMCPSuggestions(e,t,"autocomplete_terms")}catch(n){return console.error("Error getting autocomplete suggestions:",n),[]}}async getTauriSuggestions(e,t){const n=await He("get_autocomplete_suggestions",{query:e.trim(),role_name:this.currentRole,limit:t});return console.log("Tauri autocomplete response:",n),n&&n.status==="success"&&n.suggestions?n.suggestions.map(o=>({text:o.term||o.text||"",snippet:o.url||o.snippet||"",score:o.score||1})).filter(o=>o.text.length>0):(n&&n.error&&console.error("Tauri autocomplete error:",n.error),[])}async getMCPSuggestions(e,t,n){const o=Date.now(),r=await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:o,method:"tools/call",params:{name:n,arguments:{query:e.trim(),limit:t,role:this.currentRole}}}),signal:AbortSignal.timeout(5e3)});if(!r.ok)return console.error(`MCP ${n} request failed:`,r.status,r.statusText),[];const i=await r.json();return console.log(`MCP ${n} response:`,i),i.result&&!i.result.is_error&&i.result.content?n==="autocomplete_with_snippets"?this.parseAutocompleteWithSnippetsContent(i.result.content):this.parseAutocompleteContent(i.result.content):(i.error&&console.error(`MCP ${n} error:`,i.error),[])}async getSuggestionsWithSnippets(e,t=10){if(!e||e.trim().length===0)return[];if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return console.warn("Autocomplete index not built, returning empty suggestions with snippets"),[];try{return hl()?await this.getTauriSuggestions(e,t):await this.getMCPSuggestions(e,t,"autocomplete_with_snippets")}catch(n){return console.error("Error getting autocomplete suggestions with snippets:",n),[]}}extractLastWord(e){const t=e.trim().split(/\s+/);return t[t.length-1]||""}parseAutocompleteContent(e){const t=[];for(const n of e)if(n.type==="text"&&n.text){if(!n.text.startsWith("Found")&&!n.text.startsWith("•"))t.push({text:n.text.trim()});else if(n.text.startsWith("•")){const o=n.text.replace("•","").trim();o&&t.push({text:o})}}return t}parseAutocompleteWithSnippetsContent(e){const t=[];for(const n of e)if(n.type==="text"&&n.text){if(!n.text.startsWith("Found")&&!n.text.startsWith("•")){const o=n.text.split(" — ");o.length===2?t.push({text:o[0].trim(),snippet:o[1].trim()}):t.push({text:n.text.trim()})}else if(n.text.startsWith("•")){const o=n.text.replace("•","").trim();o&&t.push({text:o})}}return t}isReady(){return this.autocompleteIndexBuilt}getStatus(){return{ready:this.autocompleteIndexBuilt,baseUrl:this.baseUrl,sessionId:this.sessionId,usingTauri:hl(),currentRole:this.currentRole,connectionRetries:this.connectionRetries,isConnecting:this.isConnecting}}async refreshIndex(){return this.autocompleteIndexBuilt=!1,this.connectionRetries=0,await this.buildAutocompleteIndex()}async testConnection(){try{if(hl()){const e=await He("get_autocomplete_suggestions",{query:"test",role_name:this.currentRole,limit:1});return e&&(e.status==="success"||e.status==="error")}else return(await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:Date.now(),method:"tools/list",params:{}}),signal:AbortSignal.timeout(3e3)})).ok}catch(e){return console.warn("Connection test failed:",e),!1}}}const il=new yr;function Cr(l){var e;const{char:t,allowSpaces:n,allowToIncludeChar:o,allowedPrefixes:r,startOfLine:i,$position:u}=l,c=n&&!o,p=ji(t),d=new RegExp(`\\s${p}$`),m=i?"^":"",_=o?"":p,g=c?new RegExp(`${m}${p}.*?(?=\\s${_}|$)`,"gm"):new RegExp(`${m}(?:^)?${p}[^\\s${_}]*`,"gm"),h=((e=u.nodeBefore)===null||e===void 0?void 0:e.isText)&&u.nodeBefore.text;if(!h)return null;const v=u.pos-h.length,y=Array.from(h.matchAll(g)).pop();if(!y||y.input===void 0||y.index===void 0)return null;const k=y.input.slice(Math.max(0,y.index-1),y.index),w=new RegExp(`^[${r==null?void 0:r.join("")}\0]?$`).test(k);if(r!==null&&!w)return null;const $=v+y.index;let C=$+y[0].length;return c&&d.test(h.slice(C-1,C+1))&&(y[0]+=" ",C+=1),$<u.pos&&C>=u.pos?{range:{from:$,to:C},query:y[0].slice(t.length),text:y[0]}:null}const Sr=new di("suggestion");function Tr({pluginKey:l=Sr,editor:e,char:t="@",allowSpaces:n=!1,allowToIncludeChar:o=!1,allowedPrefixes:r=[" "],startOfLine:i=!1,decorationTag:u="span",decorationClass:c="suggestion",decorationContent:p="",decorationEmptyClass:d="is-empty",command:m=()=>null,items:_=()=>[],render:g=()=>({}),allow:h=()=>!0,findSuggestionMatch:v=Cr}){let y;const k=g==null?void 0:g(),w=new Mi({key:l,view(){return{update:async($,C)=>{var R,I,N,E,O,Q,Z;const D=(R=this.key)===null||R===void 0?void 0:R.getState(C),A=(I=this.key)===null||I===void 0?void 0:I.getState($.state),te=D.active&&A.active&&D.range.from!==A.range.from,ne=!D.active&&A.active,B=D.active&&!A.active,le=!ne&&!B&&D.query!==A.query,F=ne||te&&le,U=le||te,P=B||te&&le;if(!F&&!U&&!P)return;const L=P&&!F?D:A,H=$.dom.querySelector(`[data-decoration-id="${L.decorationId}"]`);y={editor:e,range:L.range,query:L.query,text:L.text,items:[],command:K=>m({editor:e,range:L.range,props:K}),decorationNode:H,clientRect:H?()=>{var K;const{decorationId:V}=(K=this.key)===null||K===void 0?void 0:K.getState(e.state),ie=$.dom.querySelector(`[data-decoration-id="${V}"]`);return(ie==null?void 0:ie.getBoundingClientRect())||null}:null},F&&((N=k==null?void 0:k.onBeforeStart)===null||N===void 0||N.call(k,y)),U&&((E=k==null?void 0:k.onBeforeUpdate)===null||E===void 0||E.call(k,y)),(U||F)&&(y.items=await _({editor:e,query:L.query})),P&&((O=k==null?void 0:k.onExit)===null||O===void 0||O.call(k,y)),U&&((Q=k==null?void 0:k.onUpdate)===null||Q===void 0||Q.call(k,y)),F&&((Z=k==null?void 0:k.onStart)===null||Z===void 0||Z.call(k,y))},destroy:()=>{var $;y&&(($=k==null?void 0:k.onExit)===null||$===void 0||$.call(k,y))}}},state:{init(){return{active:!1,range:{from:0,to:0},query:null,text:null,composing:!1}},apply($,C,R,I){const{isEditable:N}=e,{composing:E}=e.view,{selection:O}=$,{empty:Q,from:Z}=O,D={...C};if(D.composing=E,N&&(Q||e.view.composing)){(Z<C.range.from||Z>C.range.to)&&!E&&!C.composing&&(D.active=!1);const A=v({char:t,allowSpaces:n,allowToIncludeChar:o,allowedPrefixes:r,startOfLine:i,$position:O.$from}),te=`id_${Math.floor(Math.random()*4294967295)}`;A&&h({editor:e,state:I,range:A.range,isActive:C.active})?(D.active=!0,D.decorationId=C.decorationId?C.decorationId:te,D.range=A.range,D.query=A.query,D.text=A.text):D.active=!1}else D.active=!1;return D.active||(D.decorationId=null,D.range={from:0,to:0},D.query=null,D.text=null),D}},props:{handleKeyDown($,C){var R;const{active:I,range:N}=w.getState($.state);return I&&((R=k==null?void 0:k.onKeyDown)===null||R===void 0?void 0:R.call(k,{view:$,event:C,range:N}))||!1},decorations($){const{active:C,range:R,decorationId:I,query:N}=w.getState($);if(!C)return null;const E=!(N!=null&&N.length),O=[c];return E&&O.push(d),Pi.create($.doc,[Ui.inline(R.from,R.to,{nodeName:u,class:O.join(" "),"data-decoration-id":I,"data-decoration-content":p})])}}});return w}const An=Hi.create({name:"terraphimSuggestion",addOptions(){return{trigger:"++",pluginKey:new di("terraphimSuggestion"),allowSpaces:!1,limit:8,minLength:1,debounce:300}},addCommands(){return{insertSuggestion:l=>({commands:e,chain:t})=>t().insertContent(l.text).run()}},addProseMirrorPlugins(){const l={editor:this.editor,char:this.options.trigger,pluginKey:this.options.pluginKey,allowSpaces:this.options.allowSpaces,startOfLine:!1,command:({editor:e,range:t,props:n})=>{const o=n;e.chain().focus().insertContentAt(t,o.text+" ").run()},items:async({query:e,editor:t})=>new Promise(n=>{setTimeout(async()=>{if(e.length<this.options.minLength){n([]);return}try{const o=await il.getSuggestionsWithSnippets(e,this.options.limit);console.log(`TerraphimSuggestion: Found ${o.length} suggestions for "${e}"`),n(o)}catch(o){console.error("TerraphimSuggestion: Error getting suggestions:",o),n([])}},this.options.debounce)}),render:()=>{let e,t;return{onStart:n=>{e=new $r({items:n.items,command:n.command}),n.clientRect&&(t=Ki("body",{getReferenceClientRect:n.clientRect,appendTo:()=>document.body,content:e.element,showOnCreate:!0,interactive:!0,trigger:"manual",placement:"bottom-start",theme:"terraphim-suggestion",maxWidth:"none"})[0])},onUpdate(n){e==null||e.updateItems(n.items),n.clientRect&&(t==null||t.setProps({getReferenceClientRect:n.clientRect}))},onKeyDown(n){return n.event.key==="Escape"?(t==null||t.hide(),!0):(e==null?void 0:e.onKeyDown(n))??!1},onExit(){t==null||t.destroy(),e==null||e.destroy()}}}};return[Tr(l)]}});class $r{constructor(e){Xt(this,"element");Xt(this,"items",[]);Xt(this,"selectedIndex",0);Xt(this,"command");this.items=e.items,this.command=e.command,this.element=document.createElement("div"),this.element.className="terraphim-suggestion-dropdown",this.render()}updateItems(e){this.items=e,this.selectedIndex=0,this.render()}onKeyDown({event:e}){return e.key==="ArrowUp"?(this.selectPrevious(),!0):e.key==="ArrowDown"?(this.selectNext(),!0):e.key==="Enter"||e.key==="Tab"?(this.selectItem(this.selectedIndex),!0):!1}selectPrevious(){this.selectedIndex=Math.max(0,this.selectedIndex-1),this.render()}selectNext(){this.selectedIndex=Math.min(this.items.length-1,this.selectedIndex+1),this.render()}selectItem(e){const t=this.items[e];t&&this.command({id:t.text,...t})}render(){if(this.element.innerHTML="",this.items.length===0){this.element.innerHTML=`
        <div class="terraphim-suggestion-item terraphim-suggestion-empty">
          <div class="terraphim-suggestion-text">No suggestions found</div>
          <div class="terraphim-suggestion-hint">Try a different search term</div>
        </div>
      `;return}const e=document.createElement("div");e.className="terraphim-suggestion-header",e.innerHTML=`
      <div class="terraphim-suggestion-count">${this.items.length} suggestions</div>
      <div class="terraphim-suggestion-hint">↑↓ Navigate • Tab/Enter Select • Esc Cancel</div>
    `,this.element.appendChild(e),this.items.forEach((t,n)=>{const o=document.createElement("div");o.className=`terraphim-suggestion-item ${n===this.selectedIndex?"terraphim-suggestion-selected":""}`,o.innerHTML=`
        <div class="terraphim-suggestion-main">
          <div class="terraphim-suggestion-text">${this.escapeHtml(t.text)}</div>
          ${t.snippet?`<div class="terraphim-suggestion-snippet">${this.escapeHtml(t.snippet)}</div>`:""}
        </div>
        ${t.score?`<div class="terraphim-suggestion-score">${Math.round(t.score*100)}%</div>`:""}
      `,o.addEventListener("click",()=>this.selectItem(n)),o.addEventListener("mouseenter",()=>{this.selectedIndex=n,this.render()}),this.element.appendChild(o)})}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}destroy(){this.element.remove()}}const Rr=`
.terraphim-suggestion-dropdown {
  background: white;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  box-shadow: 0 10px 38px -10px rgba(22, 23, 24, 0.35), 0 10px 20px -15px rgba(22, 23, 24, 0.2);
  max-height: 300px;
  min-width: 300px;
  overflow-y: auto;
  z-index: 1000;
}

.terraphim-suggestion-header {
  padding: 8px 12px;
  border-bottom: 1px solid #f1f5f9;
  background: #f8fafc;
  font-size: 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.terraphim-suggestion-count {
  font-weight: 600;
  color: #475569;
}

.terraphim-suggestion-hint {
  color: #64748b;
}

.terraphim-suggestion-item {
  padding: 8px 12px;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  border-bottom: 1px solid #f1f5f9;
}

.terraphim-suggestion-item:hover {
  background: #f8fafc;
}

.terraphim-suggestion-selected {
  background: #eff6ff !important;
  border-left: 3px solid #3b82f6;
}

.terraphim-suggestion-empty {
  color: #64748b;
  font-style: italic;
  text-align: center;
  cursor: default;
}

.terraphim-suggestion-main {
  flex: 1;
}

.terraphim-suggestion-text {
  font-weight: 500;
  color: #1e293b;
  margin-bottom: 2px;
}

.terraphim-suggestion-snippet {
  font-size: 12px;
  color: #64748b;
  line-height: 1.3;
}

.terraphim-suggestion-score {
  font-size: 11px;
  color: #10b981;
  font-weight: 600;
  background: #ecfdf5;
  padding: 2px 6px;
  border-radius: 4px;
  margin-left: 8px;
}

/* Dark theme support */
@media (prefers-color-scheme: dark) {
  .terraphim-suggestion-dropdown {
    background: #1e293b;
    border-color: #334155;
  }

  .terraphim-suggestion-header {
    background: #0f172a;
    border-color: #334155;
  }

  .terraphim-suggestion-item:hover {
    background: #334155;
  }

  .terraphim-suggestion-selected {
    background: #1e40af !important;
  }

  .terraphim-suggestion-text {
    color: #f1f5f9;
  }

  .terraphim-suggestion-snippet {
    color: #94a3b8;
  }
}

/* Tippy.js theme */
.tippy-box[data-theme~='terraphim-suggestion'] {
  background: transparent;
  box-shadow: none;
}

.tippy-box[data-theme~='terraphim-suggestion'] > .tippy-backdrop {
  background: transparent;
}

.tippy-box[data-theme~='terraphim-suggestion'] > .tippy-arrow {
  display: none;
}
`;function Dn(l){let e,t,n,o,r,i,u,c,p,d,m,_,g,h,v,y,k,w,$,C,R,I,N,E,O,Q,Z=l[12]?"Tauri (native)":`MCP Server (${il.getStatus().baseUrl})`,D,A,te,ne,B,le,F,U,P,L,H,K,V,ie,re,ye,Y,oe,me,G,j=l[6]!==1?"s":"",X,ue,ge,ae,pe,_e,Re,Ve,Be,Le,Ee,he,Ae,Ye,Ke,Ue,Ne,ze,tt=l[3]?"Enabled":"Disabled",dt,Ze,Qe,pt,Fe=l[11]&&!l[8]&&Nn(l);function nt(J,se){if(J[8])return Dr;if(J[11])return Ar}let Xe=nt(l),z=Xe&&Xe(l);return{c(){e=f("div"),t=f("div"),n=f("strong"),n.textContent="Local Autocomplete Status:",o=b(),r=f("div"),i=f("button"),u=M("Test"),p=b(),d=f("button"),d.textContent="Rebuild Index",m=b(),_=f("button"),g=M("Demo"),v=b(),y=f("div"),k=M(l[10]),w=b(),Fe&&Fe.c(),$=b(),C=f("div"),R=f("strong"),R.textContent="Configuration:",I=b(),N=f("br"),E=M("• "),O=f("strong"),O.textContent="Backend:",Q=b(),D=M(Z),A=b(),te=f("br"),ne=M("• "),B=f("strong"),B.textContent="Role:",le=b(),F=M(l[9]),U=b(),P=f("br"),L=M("• "),H=f("strong"),H.textContent="Trigger:",K=M(' "'),V=M(l[4]),ie=M(`" + text
      `),re=f("br"),ye=M("• "),Y=f("strong"),Y.textContent="Min Length:",oe=b(),me=M(l[6]),G=M(" character"),X=M(j),ue=b(),ge=f("br"),ae=M("• "),pe=f("strong"),pe.textContent="Max Results:",_e=b(),Re=M(l[5]),Ve=b(),Be=f("br"),Le=M("• "),Ee=f("strong"),Ee.textContent="Debounce:",he=b(),Ae=M(l[7]),Ye=M(`ms
      `),Ke=f("br"),Ue=M("• "),Ne=f("strong"),Ne.textContent="Snippets:",ze=b(),dt=M(tt),Ze=b(),z&&z.c(),Te(n,"color","#495057"),Te(i,"padding","4px 8px"),Te(i,"background","#007bff"),Te(i,"color","white"),Te(i,"border","none"),Te(i,"border-radius","4px"),Te(i,"cursor","pointer"),Te(i,"font-size","12px"),i.disabled=c=!l[8],Te(d,"padding","4px 8px"),Te(d,"background","#28a745"),Te(d,"color","white"),Te(d,"border","none"),Te(d,"border-radius","4px"),Te(d,"cursor","pointer"),Te(d,"font-size","12px"),Te(_,"padding","4px 8px"),Te(_,"background","#ffc107"),Te(_,"color","#212529"),Te(_,"border","none"),Te(_,"border-radius","4px"),Te(_,"cursor","pointer"),Te(_,"font-size","12px"),_.disabled=h=!l[8],Te(r,"display","flex"),Te(r,"gap","8px"),Te(t,"display","flex"),Te(t,"justify-content","space-between"),Te(t,"align-items","center"),Te(t,"margin-bottom","8px"),Te(y,"font-size","13px"),Te(y,"color","#6c757d"),Te(y,"margin-bottom","8px"),Te(y,"font-family","monospace"),Te(C,"font-size","12px"),Te(C,"color","#6c757d"),Te(e,"margin-top","10px"),Te(e,"padding","12px"),Te(e,"background","#f8f9fa"),Te(e,"border-radius","6px"),Te(e,"border","1px solid #e9ecef")},m(J,se){T(J,e,se),s(e,t),s(t,n),s(t,o),s(t,r),s(r,i),s(i,u),s(r,p),s(r,d),s(r,m),s(r,_),s(_,g),s(e,v),s(e,y),s(y,k),s(e,w),Fe&&Fe.m(e,null),s(e,$),s(e,C),s(C,R),s(C,I),s(C,N),s(C,E),s(C,O),s(C,Q),s(C,D),s(C,A),s(C,te),s(C,ne),s(C,B),s(C,le),s(C,F),s(C,U),s(C,P),s(C,L),s(C,H),s(C,K),s(C,V),s(C,ie),s(C,re),s(C,ye),s(C,Y),s(C,oe),s(C,me),s(C,G),s(C,X),s(C,ue),s(C,ge),s(C,ae),s(C,pe),s(C,_e),s(C,Re),s(C,Ve),s(C,Be),s(C,Le),s(C,Ee),s(C,he),s(C,Ae),s(C,Ye),s(C,Ke),s(C,Ue),s(C,Ne),s(C,ze),s(C,dt),s(e,Ze),z&&z.m(e,null),Qe||(pt=[ee(i,"click",l[14]),ee(d,"click",l[15]),ee(_,"click",l[16])],Qe=!0)},p(J,se){se&256&&c!==(c=!J[8])&&(i.disabled=c),se&256&&h!==(h=!J[8])&&(_.disabled=h),se&1024&&ce(k,J[10]),J[11]&&!J[8]?Fe?Fe.p(J,se):(Fe=Nn(J),Fe.c(),Fe.m(e,$)):Fe&&(Fe.d(1),Fe=null),se&4096&&Z!==(Z=J[12]?"Tauri (native)":`MCP Server (${il.getStatus().baseUrl})`)&&ce(D,Z),se&512&&ce(F,J[9]),se&16&&ce(V,J[4]),se&64&&ce(me,J[6]),se&64&&j!==(j=J[6]!==1?"s":"")&&ce(X,j),se&32&&ce(Re,J[5]),se&128&&ce(Ae,J[7]),se&8&&tt!==(tt=J[3]?"Enabled":"Disabled")&&ce(dt,tt),Xe===(Xe=nt(J))&&z?z.p(J,se):(z&&z.d(1),z=Xe&&Xe(J),z&&(z.c(),z.m(e,null)))},d(J){J&&S(e),Fe&&Fe.d(),z&&z.d(),Qe=!1,st(pt)}}}function Nn(l){let e,t,n,o;function r(c,p){return c[12]?Er:Lr}let i=r(l),u=i(l);return{c(){e=f("div"),t=f("strong"),t.textContent="⚠️ Autocomplete Not Available",n=f("br"),o=b(),u.c(),Te(e,"font-size","12px"),Te(e,"color","#dc3545"),Te(e,"margin-bottom","8px"),Te(e,"padding","6px"),Te(e,"background","#f8d7da"),Te(e,"border-radius","4px")},m(c,p){T(c,e,p),s(e,t),s(e,n),s(e,o),u.m(e,null)},p(c,p){i===(i=r(c))&&u?u.p(c,p):(u.d(1),u=i(c),u&&(u.c(),u.m(e,null)))},d(c){c&&S(e),u.d()}}}function Lr(l){let e,t=il.getStatus().baseUrl+"",n;return{c(){e=M("MCP server not responding. Ensure the server is running on "),n=M(t)},m(o,r){T(o,e,r),T(o,n,r)},p:$e,d(o){o&&S(e),o&&S(n)}}}function Er(l){let e;return{c(){e=M("Tauri backend connection failed. Ensure the application has proper permissions.")},m(t,n){T(t,e,n)},p:$e,d(t){t&&S(e)}}}function Ar(l){let e;return{c(){e=f("div"),e.innerHTML=`<strong>❌ Autocomplete Unavailable</strong> 
        <div style="font-size: 11px; margin-top: 4px; color: #721c24;">Click &quot;Rebuild Index&quot; to retry or check server/backend status.</div>`,Te(e,"margin-top","8px"),Te(e,"padding","8px"),Te(e,"background","#f8d7da"),Te(e,"border","1px solid #f5c6cb"),Te(e,"border-radius","4px")},m(t,n){T(t,e,n)},p:$e,d(t){t&&S(e)}}}function Dr(l){let e,t,n,o,r,i,u,c,p,d,m,_,g,h,v,y,k;return{c(){e=f("div"),t=f("strong"),t.textContent="🎯 Autocomplete Active",n=b(),o=f("div"),r=M("Type "),i=f("code"),u=M(l[4]),c=M(" in the editor above to trigger suggestions."),p=f("br"),d=M(`
          Example: `),m=f("code"),_=M(l[4]),g=M("terraphim"),h=M(" or "),v=f("code"),y=M(l[4]),k=M("graph"),Te(o,"font-size","11px"),Te(o,"margin-top","4px"),Te(o,"color","#0056b3"),Te(e,"margin-top","8px"),Te(e,"padding","8px"),Te(e,"background","#d1edff"),Te(e,"border","1px solid #b3d9ff"),Te(e,"border-radius","4px")},m(w,$){T(w,e,$),s(e,t),s(e,n),s(e,o),s(o,r),s(o,i),s(i,u),s(o,c),s(o,p),s(o,d),s(o,m),s(m,_),s(m,g),s(o,h),s(o,v),s(v,y),s(v,k)},p(w,$){$&16&&ce(u,w[4]),$&16&&ce(_,w[4]),$&16&&ce(y,w[4])},d(w){w&&S(e)}}}function Nr(l){let e,t,n,o;e=new Gi({props:{defaultValue:l[0],isEditable:!l[1],disableLocalStorage:!0,onUpdate:l[13],extensions:[Tn,...l[2]?[An.configure({trigger:l[4],allowSpaces:!1,limit:l[5],minLength:l[6],debounce:l[7]})]:[]]}});let r=l[2]&&Dn(l);return{c(){be(e.$$.fragment),t=b(),r&&r.c(),n=St()},m(i,u){ke(e,i,u),T(i,t,u),r&&r.m(i,u),T(i,n,u),o=!0},p(i,[u]){const c={};u&1&&(c.defaultValue=i[0]),u&2&&(c.isEditable=!i[1]),u&244&&(c.extensions=[Tn,...i[2]?[An.configure({trigger:i[4],allowSpaces:!1,limit:i[5],minLength:i[6],debounce:i[7]})]:[]]),e.$set(c),i[2]?r?r.p(i,u):(r=Dn(i),r.c(),r.m(n.parentNode,n)):r&&(r.d(1),r=null)},i(i){o||(W(e.$$.fragment,i),o=!0)},o(i){x(e.$$.fragment,i),o=!1},d(i){we(e,i),i&&S(t),r&&r.d(i),i&&S(n)}}}function Ir(l,e,t){let n,o;qe(l,$t,E=>t(9,n=E)),qe(l,bt,E=>t(12,o=E));let{html:r=""}=e,{readOnly:i=!1}=e,{outputFormat:u="html"}=e,{enableAutocomplete:c=!0}=e,{showSnippets:p=!0}=e,{suggestionTrigger:d="++"}=e,{maxSuggestions:m=8}=e,{minQueryLength:_=1}=e,{debounceDelay:g=300}=e,h=null,v="⏳ Initializing...",y=!1,k=!1,w=null;vl(async()=>{c&&await $(),typeof document<"u"&&(w=document.createElement("style"),w.textContent=Rr,document.head.appendChild(w))}),rn(()=>{w&&w.parentNode&&w.parentNode.removeChild(w)});async function $(){t(10,v="⏳ Initializing autocomplete..."),t(8,y=!1),t(11,k=!1);try{il.setRole(n),t(10,v="🔗 Testing connection...");const E=await il.testConnection();t(11,k=!0),E?(t(10,v="🔨 Building autocomplete index..."),await il.buildAutocompleteIndex()?(o?t(10,v="✅ Ready - Using Tauri backend"):t(10,v="✅ Ready - Using MCP server backend"),t(8,y=!0)):t(10,v="❌ Failed to build autocomplete index")):o?t(10,v="❌ Tauri backend not available"):t(10,v="❌ MCP server not responding")}catch(E){console.error("Error initializing autocomplete:",E),t(10,v="❌ Autocomplete initialization error")}}const C=E=>{h=E,u==="markdown"?t(0,r=E.storage.markdown.getMarkdown()):t(0,r=E.getHTML())},R=async()=>{if(!k){alert("Please wait for connection test to complete");return}if(!y){alert("Autocomplete service not ready. Check the status above.");return}try{t(10,v="🧪 Testing autocomplete...");const E="terraphim",O=await il.getSuggestions(E,5);if(console.log("Autocomplete test results:",O),O.length>0){const Q=O.map((Z,D)=>`${D+1}. ${Z.text}${Z.snippet?` (${Z.snippet})`:""}`).join(`
`);alert(`✅ Found ${O.length} suggestions for '${E}':

${Q}`),o?t(10,v="✅ Ready - Using Tauri backend"):t(10,v="✅ Ready - Using MCP server backend")}else alert(`⚠️ No suggestions found for '${E}'. This might be normal if the term isn't in your knowledge graph.`)}catch(E){console.error("Autocomplete test failed:",E),alert(`❌ Autocomplete test failed: ${E.message}`),t(10,v="❌ Test failed - check console for details")}},I=async()=>{t(10,v="⏳ Rebuilding index..."),t(8,y=!1);try{await il.refreshIndex()?(o?t(10,v="✅ Ready - Tauri index rebuilt successfully"):t(10,v="✅ Ready - MCP server index rebuilt successfully"),t(8,y=!0)):t(10,v="❌ Failed to rebuild index")}catch(E){console.error("Error rebuilding index:",E),t(10,v="❌ Index rebuild failed - check console for details")}},N=()=>{if(!h){alert("Editor not ready yet");return}const E=`# Terraphim Autocomplete Demo

This is a demonstration of the integrated Terraphim autocomplete system.

## How to Use:
1. Type "${d}" to trigger autocomplete
2. Start typing any term (e.g., "${d}terraphim", "${d}graph")
3. Use ↑↓ arrows to navigate suggestions
4. Press Tab or Enter to select
5. Press Esc to cancel

## Try these queries:
- ${d}terraphim
- ${d}graph
- ${d}service
- ${d}automata
- ${d}role

The autocomplete system uses your local knowledge graph to provide intelligent suggestions based on your selected role: **${n}**.

---

Start typing below:`;h.commands.setContent(E),setTimeout(()=>{h.commands.focus("end")},100),alert(`Demo content inserted!

Type "${d}" followed by any term to see autocomplete suggestions.

Example: "${d}terraphim"`)};return l.$$set=E=>{"html"in E&&t(0,r=E.html),"readOnly"in E&&t(1,i=E.readOnly),"outputFormat"in E&&t(17,u=E.outputFormat),"enableAutocomplete"in E&&t(2,c=E.enableAutocomplete),"showSnippets"in E&&t(3,p=E.showSnippets),"suggestionTrigger"in E&&t(4,d=E.suggestionTrigger),"maxSuggestions"in E&&t(5,m=E.maxSuggestions),"minQueryLength"in E&&t(6,_=E.minQueryLength),"debounceDelay"in E&&t(7,g=E.debounceDelay)},l.$$.update=()=>{l.$$.dirty&772&&n&&c&&y&&(il.setRole(n),$())},[r,i,c,p,d,m,_,g,y,n,v,k,o,C,R,I,N,u]}class Or extends Pt{constructor(e){super(),Ut(this,e,Ir,Nr,Ot,{html:0,readOnly:1,outputFormat:17,enableAutocomplete:2,showSnippets:3,suggestionTrigger:4,maxSuggestions:5,minQueryLength:6,debounceDelay:7})}}function In(l){let e,t,n,o,r,i,u,c,p,d,m;return{c(){e=f("div"),t=f("h3"),n=f("span"),n.textContent="Knowledge Graph",o=M(`
          Term: `),r=f("strong"),i=M(l[2]),u=M(" | Rank: "),c=f("strong"),p=M(l[3]),d=b(),m=f("hr"),a(n,"class","tag is-info svelte-329px1"),a(t,"class","subtitle is-6 svelte-329px1"),a(m,"class","svelte-329px1"),a(e,"class","kg-context svelte-329px1")},m(_,g){T(_,e,g),s(e,t),s(t,n),s(t,o),s(t,r),s(r,i),s(t,u),s(t,c),s(c,p),s(e,d),s(e,m)},p(_,g){g&4&&ce(i,_[2]),g&8&&ce(p,_[3])},d(_){_&&S(e)}}}function Mr(l){let e,t,n,o,r,i,u,c;const p=[jr,Ur],d=[];function m(_,g){return _[5]?0:1}return t=m(l),n=d[t]=p[t](l),{c(){e=f("div"),n.c(),o=b(),r=f("div"),r.innerHTML='<span class="hint-text svelte-329px1">Double-click to edit • Ctrl+E to edit • Ctrl+S to save • Click KG links to explore</span>',a(r,"class","edit-hint svelte-329px1"),a(e,"class","content-viewer svelte-329px1"),a(e,"tabindex","0"),a(e,"role","button"),a(e,"aria-label","Double-click to edit article content")},m(_,g){T(_,e,g),d[t].m(e,null),s(e,o),s(e,r),l[20](e),i=!0,u||(c=[ee(e,"dblclick",l[14]),ee(e,"keydown",l[15]),ee(e,"click",l[13])],u=!0)},p(_,g){let h=t;t=m(_),t===h?d[t].p(_,g):(We(),x(d[h],1,1,()=>{d[h]=null}),Je(),n=d[t],n?n.p(_,g):(n=d[t]=p[t](_),n.c()),W(n,1),n.m(e,o))},i(_){i||(W(n),i=!0)},o(_){x(n),i=!1},d(_){_&&S(e),d[t].d(),l[20](null),u=!1,st(c)}}}function Pr(l){let e,t,n,o,r,i,u,c,p,d;function m(g){l[18](g)}let _={outputFormat:l[11]};return l[1].body!==void 0&&(_.html=l[1].body),e=new Or({props:_}),mt.push(()=>kt(e,"html",m)),{c(){be(e.$$.fragment),n=b(),o=f("div"),r=f("button"),r.textContent="Save",i=b(),u=f("button"),u.textContent="Cancel",a(r,"class","button is-primary"),a(u,"class","button is-light"),a(o,"class","edit-controls svelte-329px1")},m(g,h){ke(e,g,h),T(g,n,h),T(g,o,h),s(o,r),s(o,i),s(o,u),c=!0,p||(d=[ee(r,"click",l[12]),ee(u,"click",l[19])],p=!0)},p(g,h){const v={};h&2048&&(v.outputFormat=g[11]),!t&&h&2&&(t=!0,v.html=g[1].body,wt(()=>t=!1)),e.$set(v)},i(g){c||(W(e.$$.fragment,g),c=!0)},o(g){x(e.$$.fragment,g),c=!1},d(g){we(e,g),g&&S(n),g&&S(o),p=!1,st(d)}}}function Ur(l){let e,t,n;return t=new Hl({props:{source:l[1].body}}),{c(){e=f("div"),be(t.$$.fragment),a(e,"class","markdown-content svelte-329px1")},m(o,r){T(o,e,r),ke(t,e,null),n=!0},p(o,r){const i={};r&2&&(i.source=o[1].body),t.$set(i)},i(o){n||(W(t.$$.fragment,o),n=!0)},o(o){x(t.$$.fragment,o),n=!1},d(o){o&&S(e),we(t)}}}function jr(l){let e,t=l[1].body+"";return{c(){e=f("div"),a(e,"class","prose svelte-329px1")},m(n,o){T(n,e,o),e.innerHTML=t},p(n,o){o&2&&t!==(t=n[1].body+"")&&(e.innerHTML=t)},i:$e,o:$e,d(n){n&&S(e)}}}function Hr(l){let e,t,n,o,r,i=l[1].title+"",u,c,p,d,m,_,g,h=l[2]&&l[3]!==null&&In(l);const v=[Pr,Mr],y=[];function k(w,$){return w[4]?0:1}return p=k(l),d=y[p]=v[p](l),{c(){e=f("div"),t=f("button"),n=b(),h&&h.c(),o=b(),r=f("h2"),u=M(i),c=b(),d.c(),a(t,"class","delete is-large modal-close-btn svelte-329px1"),a(t,"aria-label","close"),a(r,"class","svelte-329px1"),a(e,"class","box wrapper svelte-329px1")},m(w,$){T(w,e,$),s(e,t),s(e,n),h&&h.m(e,null),s(e,o),s(e,r),s(r,u),s(e,c),y[p].m(e,null),m=!0,_||(g=ee(t,"click",l[17]),_=!0)},p(w,$){w[2]&&w[3]!==null?h?h.p(w,$):(h=In(w),h.c(),h.m(e,o)):h&&(h.d(1),h=null),(!m||$&2)&&i!==(i=w[1].title+"")&&ce(u,i);let C=p;p=k(w),p===C?y[p].p(w,$):(We(),x(y[C],1,1,()=>{y[C]=null}),Je(),d=y[p],d?d.p(w,$):(d=y[p]=v[p](w),d.c()),W(d,1),d.m(e,null))},i(w){m||(W(d),m=!0)},o(w){x(d),m=!1},d(w){w&&S(e),h&&h.d(),y[p].d(),_=!1,g()}}}function On(l){let e,t,n;function o(i){l[24](i)}let r={$$slots:{default:[Kr]},$$scope:{ctx:l}};return l[7]!==void 0&&(r.active=l[7]),e=new Ul({props:r}),mt.push(()=>kt(e,"active",o)),{c(){be(e.$$.fragment)},m(i,u){ke(e,i,u),n=!0},p(i,u){const c={};u&1073743744&&(c.$$scope={dirty:u,ctx:i}),!t&&u&128&&(t=!0,c.active=i[7],wt(()=>t=!1)),e.$set(c)},i(i){n||(W(e.$$.fragment,i),n=!0)},o(i){x(e.$$.fragment,i),n=!1},d(i){we(e,i)}}}function Mn(l){let e,t,n,o,r,i,u,c,p,d,m;return{c(){e=f("div"),t=f("h3"),n=f("span"),n.textContent="Knowledge Graph",o=M(`
            Term: `),r=f("strong"),i=M(l[9]),u=M(" | Rank: "),c=f("strong"),p=M(l[10]),d=b(),m=f("hr"),a(n,"class","tag is-info svelte-329px1"),a(t,"class","subtitle is-6 svelte-329px1"),a(m,"class","svelte-329px1"),a(e,"class","kg-context svelte-329px1")},m(_,g){T(_,e,g),s(e,t),s(t,n),s(t,o),s(t,r),s(r,i),s(t,u),s(t,c),s(c,p),s(e,d),s(e,m)},p(_,g){g&512&&ce(i,_[9]),g&1024&&ce(p,_[10])},d(_){_&&S(e)}}}function Fr(l){let e,t,n;return t=new Hl({props:{source:l[8].body}}),{c(){e=f("div"),be(t.$$.fragment),a(e,"class","markdown-content svelte-329px1")},m(o,r){T(o,e,r),ke(t,e,null),n=!0},p(o,r){const i={};r&256&&(i.source=o[8].body),t.$set(i)},i(o){n||(W(t.$$.fragment,o),n=!0)},o(o){x(t.$$.fragment,o),n=!1},d(o){o&&S(e),we(t)}}}function zr(l){let e,t=l[8].body+"";return{c(){e=f("div"),a(e,"class","prose svelte-329px1")},m(n,o){T(n,e,o),e.innerHTML=t},p(n,o){o&256&&t!==(t=n[8].body+"")&&(e.innerHTML=t)},i:$e,o:$e,d(n){n&&S(e)}}}function Kr(l){let e,t,n,o,r,i=l[8].title+"",u,c,p,d,m,_,g,h,v,y,k,w=l[9]&&l[10]!==null&&Mn(l);const $=[zr,Fr],C=[];function R(I,N){return N&256&&(d=null),d==null&&(d=!!(I[8].body&&(/<html/i.test(I[8].body)||/<body/i.test(I[8].body)||/<head/i.test(I[8].body)))),d?0:1}return m=R(l,-1),_=C[m]=$[m](l),{c(){e=f("div"),t=f("button"),n=b(),w&&w.c(),o=b(),r=f("h2"),u=M(i),c=b(),p=f("div"),_.c(),g=b(),h=f("div"),h.innerHTML='<span class="hint-text svelte-329px1">Knowledge Graph document • Click KG links to explore further</span>',a(t,"class","delete is-large modal-close-btn svelte-329px1"),a(t,"aria-label","close"),a(r,"class","svelte-329px1"),a(h,"class","edit-hint svelte-329px1"),a(p,"class","content-viewer svelte-329px1"),a(p,"tabindex","0"),a(p,"role","button"),a(p,"aria-label","KG document content - click KG links to explore further"),a(e,"class","box wrapper svelte-329px1")},m(I,N){T(I,e,N),s(e,t),s(e,n),w&&w.m(e,null),s(e,o),s(e,r),s(r,u),s(e,c),s(e,p),C[m].m(p,null),s(p,g),s(p,h),v=!0,y||(k=[ee(t,"click",l[22]),ee(p,"click",l[13]),ee(p,"keydown",l[23])],y=!0)},p(I,N){I[9]&&I[10]!==null?w?w.p(I,N):(w=Mn(I),w.c(),w.m(e,o)):w&&(w.d(1),w=null),(!v||N&256)&&i!==(i=I[8].title+"")&&ce(u,i);let E=m;m=R(I,N),m===E?C[m].p(I,N):(We(),x(C[E],1,1,()=>{C[E]=null}),Je(),_=C[m],_?_.p(I,N):(_=C[m]=$[m](I),_.c()),W(_,1),_.m(p,g))},i(I){v||(W(_),v=!0)},o(I){x(_),v=!1},d(I){I&&S(e),w&&w.d(),C[m].d(),y=!1,st(k)}}}function Gr(l){let e,t,n,o,r;function i(p){l[21](p)}let u={$$slots:{default:[Hr]},$$scope:{ctx:l}};l[0]!==void 0&&(u.active=l[0]),e=new Ul({props:u}),mt.push(()=>kt(e,"active",i));let c=l[8]&&On(l);return{c(){be(e.$$.fragment),n=b(),c&&c.c(),o=St()},m(p,d){ke(e,p,d),T(p,n,d),c&&c.m(p,d),T(p,o,d),r=!0},p(p,[d]){const m={};d&1073743999&&(m.$$scope={dirty:d,ctx:p}),!t&&d&1&&(t=!0,m.active=p[0],wt(()=>t=!1)),e.$set(m),p[8]?c?(c.p(p,d),d&256&&W(c,1)):(c=On(p),c.c(),W(c,1),c.m(o.parentNode,o)):c&&(We(),x(c,1,1,()=>{c=null}),Je())},i(p){r||(W(e.$$.fragment,p),W(c),r=!0)},o(p){x(e.$$.fragment,p),x(c),r=!1},d(p){we(e,p),p&&S(n),c&&c.d(p),p&&S(o)}}}function qr(l,e,t){let n,o,r,i;qe(l,bt,B=>t(26,r=B)),qe(l,$t,B=>t(27,i=B));let{active:u=!1}=e,{item:c}=e,{initialEdit:p=!1}=e,{kgTerm:d=null}=e,{kgRank:m=null}=e,_=!1,g,h=!1,v=null,y=null,k=null;async function w(){if(r)try{const B=await He("get_document",{documentId:c.id});B!=null&&B.document&&t(1,c=B.document)}catch(B){console.error("Failed to load document",B)}}async function $(){if(!r){t(4,_=!1);return}try{await He("create_document",{document:c}),t(4,_=!1)}catch(B){console.error("Failed to save document",B)}}async function C(B){var le,F,U,P,L;t(9,y=B),console.log("🔍 KG Link Click Debug Info:"),console.log("  Term clicked:",B),console.log("  Current role:",i),console.log("  Is Tauri mode:",r);try{if(r){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:i,term:B});const H=await He("find_documents_for_kg_term",{roleName:i,term:B});console.log("  📥 Tauri response received:"),console.log("    Status:",H.status),console.log("    Results count:",((le=H.results)==null?void 0:le.length)||0),console.log("    Total:",H.total||0),console.log("    Full response:",JSON.stringify(H,null,2)),H.status==="success"&&H.results&&H.results.length>0?(t(8,v=H.results[0]),t(10,k=v.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",v.title),console.log("    Rank:",k),console.log("    Body length:",((F=v.body)==null?void 0:F.length)||0,"characters"),t(7,h=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${B}" in role: "${i}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const H=ct.ServerURL,K=encodeURIComponent(i),V=encodeURIComponent(B),ie=`${H}/roles/${K}/kg_search?term=${V}`;console.log("  📤 HTTP Request details:"),console.log("    Base URL:",H),console.log("    Role (encoded):",K),console.log("    Term (encoded):",V),console.log("    Full URL:",ie);const re=await fetch(ie);if(console.log("  📥 HTTP Response received:"),console.log("    Status code:",re.status),console.log("    Status text:",re.statusText),console.log("    Headers:",Object.fromEntries(re.headers.entries())),!re.ok)throw new Error(`HTTP error! Status: ${re.status} - ${re.statusText}`);const ye=await re.json();console.log("  📄 Response data:"),console.log("    Status:",ye.status),console.log("    Results count:",((U=ye.results)==null?void 0:U.length)||0),console.log("    Total:",ye.total||0),console.log("    Full response:",JSON.stringify(ye,null,2)),ye.status==="success"&&ye.results&&ye.results.length>0?(t(8,v=ye.results[0]),t(10,k=v.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",v.title),console.log("    Rank:",k),console.log("    Body length:",((P=v.body)==null?void 0:P.length)||0,"characters"),t(7,h=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${B}" in role: "${i}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",ie))}}catch(H){console.error("❌ Error fetching KG document:"),console.error("  Error type:",H.constructor.name),console.error("  Error message:",H.message||H),console.error("  Request details:",{term:B,role:i,isTauri:r,timestamp:new Date().toISOString()}),!r&&((L=H.message)!=null&&L.includes("Failed to fetch"))&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{}}function R(B){const le=B.target;if(le.tagName==="A"){const F=le.getAttribute("href");if(F&&F.startsWith("kg:")){B.preventDefault();const U=F.substring(3);C(U)}}}function I(){t(4,_=!0)}function N(B){B.type!=="dblclick"&&((B.ctrlKey||B.metaKey)&&B.key==="e"&&(B.preventDefault(),t(4,_=!0)),_&&(B.ctrlKey||B.metaKey)&&B.key==="s"&&(B.preventDefault(),$()),B.key==="Escape"&&(B.preventDefault(),_?t(4,_=!1):t(0,u=!1)))}const E=()=>t(0,u=!1);function O(B){l.$$.not_equal(c.body,B)&&(c.body=B,t(1,c))}const Q=()=>t(4,_=!1);function Z(B){mt[B?"unshift":"push"](()=>{g=B,t(6,g)})}function D(B){u=B,t(0,u)}const A=()=>t(7,h=!1),te=B=>(B.key==="Enter"||B.key===" ")&&R(B);function ne(B){h=B,t(7,h)}return l.$$set=B=>{"active"in B&&t(0,u=B.active),"item"in B&&t(1,c=B.item),"initialEdit"in B&&t(16,p=B.initialEdit),"kgTerm"in B&&t(2,d=B.kgTerm),"kgRank"in B&&t(3,m=B.kgRank)},l.$$.update=()=>{l.$$.dirty&65537&&u&&p&&t(4,_=!0),l.$$.dirty&19&&u&&c&&!_&&w(),l.$$.dirty&2&&t(5,n=c!=null&&c.body?/<html/i.test(c.body)||/<body/i.test(c.body)||/<head/i.test(c.body)||/^\s*<(!DOCTYPE|html|head|body|div|p|span)/i.test(c.body.trim()):!1),l.$$.dirty&32&&t(11,o=n?"html":"markdown")},[u,c,d,m,_,n,g,h,v,y,k,o,$,R,I,N,p,E,O,Q,Z,D,A,te,ne]}class Zl extends Pt{constructor(e){super(),Ut(this,e,qr,Gr,Ot,{active:0,item:1,initialEdit:16,kgTerm:2,kgRank:3})}}function Pn(l,e,t){const n=l.slice();return n[33]=e[t],n}function Un(l,e,t){const n=l.slice();return n[36]=e[t],n}function jn(l,e,t){const n=l.slice();return n[39]=e[t],n}function Hn(l){let e,t;return e=new an({props:{type:"is-success",$$slots:{default:[Wr]},$$scope:{ctx:l}}}),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},i(n){t||(W(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function Wr(l){let e,t,n;return{c(){e=f("p"),e.innerHTML="<strong>Success!</strong> Article saved to atomic server successfully.",t=b(),n=f("p"),n.textContent="The modal will close automatically..."},m(o,r){T(o,e,r),T(o,t,r),T(o,n,r)},p:$e,d(o){o&&S(e),o&&S(t),o&&S(n)}}}function Fn(l){let e,t;return e=new an({props:{type:"is-danger",$$slots:{default:[Jr]},$$scope:{ctx:l}}}),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},p(n,o){const r={};o[0]&8|o[1]&2048&&(r.$$scope={dirty:o,ctx:n}),e.$set(r)},i(n){t||(W(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function Jr(l){let e,t,n,o;return{c(){e=f("p"),t=f("strong"),t.textContent="Error:",n=b(),o=M(l[3])},m(r,i){T(r,e,i),s(e,t),s(e,n),s(e,o)},p(r,i){i[0]&8&&ce(o,r[3])},d(r){r&&S(e)}}}function zn(l){var te,ne,B,le;let e,t,n,o,r,i=(((te=l[1])==null?void 0:te.title)||"Untitled")+"",u,c,p,d,m,_,g=(((ne=l[1])==null?void 0:ne.rank)||0)+"",h,v,y,k,w,$,C,R,I,N,E=((B=l[1])==null?void 0:B.description)&&Kn(l),O=((le=l[1])==null?void 0:le.tags)&&Gn(l);function Q(F,U){return F[10].length>0?Qr:Br}let Z=Q(l),D=Z(l),A=l[10].length>0&&Jn(l);return{c(){e=f("div"),t=f("div"),t.textContent="Document to Save",n=b(),o=f("div"),r=f("h5"),u=M(i),c=b(),E&&E.c(),p=b(),d=f("div"),m=f("span"),_=M("Rank: "),h=M(g),v=b(),O&&O.c(),y=b(),k=f("div"),w=f("label"),w.textContent="Atomic Server",$=b(),C=f("div"),D.c(),R=b(),A&&A.c(),I=St(),a(t,"class","label"),a(r,"class","title is-6"),a(m,"class","tag is-info svelte-48g63o"),a(d,"class","tags svelte-48g63o"),a(o,"class","box document-preview svelte-48g63o"),a(e,"class","field"),a(w,"class","label"),a(w,"for","atomic-server-select"),a(C,"class","control"),a(k,"class","field")},m(F,U){T(F,e,U),s(e,t),s(e,n),s(e,o),s(o,r),s(r,u),s(o,c),E&&E.m(o,null),s(o,p),s(o,d),s(d,m),s(m,_),s(m,h),s(d,v),O&&O.m(d,null),T(F,y,U),T(F,k,U),s(k,w),s(k,$),s(k,C),D.m(C,null),T(F,R,U),A&&A.m(F,U),T(F,I,U),N=!0},p(F,U){var P,L,H,K;(!N||U[0]&2)&&i!==(i=(((P=F[1])==null?void 0:P.title)||"Untitled")+"")&&ce(u,i),(L=F[1])!=null&&L.description?E?E.p(F,U):(E=Kn(F),E.c(),E.m(o,p)):E&&(E.d(1),E=null),(!N||U[0]&2)&&g!==(g=(((H=F[1])==null?void 0:H.rank)||0)+"")&&ce(h,g),(K=F[1])!=null&&K.tags?O?O.p(F,U):(O=Gn(F),O.c(),O.m(d,null)):O&&(O.d(1),O=null),Z===(Z=Q(F))&&D?D.p(F,U):(D.d(1),D=Z(F),D&&(D.c(),D.m(C,null))),F[10].length>0?A?(A.p(F,U),U[0]&1024&&W(A,1)):(A=Jn(F),A.c(),W(A,1),A.m(I.parentNode,I)):A&&(We(),x(A,1,1,()=>{A=null}),Je())},i(F){N||(W(A),N=!0)},o(F){x(A),N=!1},d(F){F&&S(e),E&&E.d(),O&&O.d(),F&&S(y),F&&S(k),D.d(),F&&S(R),A&&A.d(F),F&&S(I)}}}function Kn(l){let e,t=l[1].description+"",n;return{c(){e=f("p"),n=M(t),a(e,"class","content")},m(o,r){T(o,e,r),s(e,n)},p(o,r){r[0]&2&&t!==(t=o[1].description+"")&&ce(n,t)},d(o){o&&S(e)}}}function Gn(l){let e,t=l[1].tags,n=[];for(let o=0;o<t.length;o+=1)n[o]=qn(jn(l,t,o));return{c(){for(let o=0;o<n.length;o+=1)n[o].c();e=St()},m(o,r){for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(o,r);T(o,e,r)},p(o,r){if(r[0]&2){t=o[1].tags;let i;for(i=0;i<t.length;i+=1){const u=jn(o,t,i);n[i]?n[i].p(u,r):(n[i]=qn(u),n[i].c(),n[i].m(e.parentNode,e))}for(;i<n.length;i+=1)n[i].d(1);n.length=t.length}},d(o){_t(n,o),o&&S(e)}}}function qn(l){let e,t=l[39]+"",n;return{c(){e=f("span"),n=M(t),a(e,"class","tag svelte-48g63o")},m(o,r){T(o,e,r),s(e,n)},p(o,r){r[0]&2&&t!==(t=o[39]+"")&&ce(n,t)},d(o){o&&S(e)}}}function Br(l){let e,t,n,o,r,i,u,c,p;return{c(){e=f("div"),t=f("p"),t.innerHTML="<strong>No atomic servers available</strong>",n=b(),o=f("p"),r=M('Your current role "'),i=M(l[12]),u=M(`" doesn't have any writable atomic server configurations.`),c=b(),p=f("p"),p.textContent="Please configure an atomic server haystack in your role settings.",a(e,"class","notification is-warning")},m(d,m){T(d,e,m),s(e,t),s(e,n),s(e,o),s(o,r),s(o,i),s(o,u),s(e,c),s(e,p)},p(d,m){m[0]&4096&&ce(i,d[12])},d(d){d&&S(e)}}}function Qr(l){let e,t,n,o,r,i,u=l[10],c=[];for(let p=0;p<u.length;p+=1)c[p]=Wn(Un(l,u,p));return{c(){e=f("div"),t=f("select");for(let p=0;p<c.length;p+=1)c[p].c();n=b(),o=f("p"),o.textContent=`Select the atomic server from your current role configuration.
              🔐 = Authenticated, ⚠️ = Anonymous access`,a(t,"id","atomic-server-select"),t.disabled=l[2],l[11]===void 0&&It(()=>l[18].call(t)),a(e,"class","select is-fullwidth"),a(o,"class","help svelte-48g63o")},m(p,d){T(p,e,d),s(e,t);for(let m=0;m<c.length;m+=1)c[m]&&c[m].m(t,null);rt(t,l[11],!0),T(p,n,d),T(p,o,d),r||(i=ee(t,"change",l[18]),r=!0)},p(p,d){if(d[0]&1024){u=p[10];let m;for(m=0;m<u.length;m+=1){const _=Un(p,u,m);c[m]?c[m].p(_,d):(c[m]=Wn(_),c[m].c(),c[m].m(t,null))}for(;m<c.length;m+=1)c[m].d(1);c.length=u.length}d[0]&4&&(t.disabled=p[2]),d[0]&3072&&rt(t,p[11])},d(p){p&&S(e),_t(c,p),p&&S(n),p&&S(o),r=!1,i()}}}function Vr(l){let e;return{c(){e=f("span"),e.textContent="⚠️ No Auth",a(e,"class","has-text-warning")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function Yr(l){let e;return{c(){e=f("span"),e.textContent="🔐",a(e,"class","has-text-success")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function Wn(l){let e,t=l[36].location+"",n,o,r,i;function u(d,m){return d[36].atomic_server_secret?Yr:Vr}let c=u(l),p=c(l);return{c(){e=f("option"),n=M(t),o=b(),p.c(),r=b(),e.__value=i=l[36].location,e.value=e.__value},m(d,m){T(d,e,m),s(e,n),s(e,o),p.m(e,null),s(e,r)},p(d,m){m[0]&1024&&t!==(t=d[36].location+"")&&ce(n,t),c!==(c=u(d))&&(p.d(1),p=c(d),p&&(p.c(),p.m(e,r))),m[0]&1024&&i!==(i=d[36].location)&&(e.__value=i,e.value=e.__value)},d(d){d&&S(e),p.d()}}}function Jn(l){var Xe,z;let e,t,n,o,r,i,u,c,p,d,m,_,g,h,v,y,k,w,$,C,R,I,N,E,O,Q,Z,D,A,te,ne,B,le,F,U,P,L,H,K,V,ie,re,ye,Y=(l[8]||"Untitled")+"",oe,me,G,j,X,ue=(((z=(Xe=l[1])==null?void 0:Xe.body)==null?void 0:z.length)||0)+"",ge,ae,pe,_e,Re,Ve,Be=l[14]()+"",Le,Ee,he,Ae,Ye,Ke=l[15]()+"",Ue,Ne,ze,tt,dt;function Ze(J){l[19](J)}let Qe={id:"article-title",placeholder:"Enter article title",disabled:l[2],required:!0};l[8]!==void 0&&(Qe.value=l[8]),r=new bl({props:Qe}),mt.push(()=>kt(r,"value",Ze));const pt=[Xr,Zr],Fe=[];function nt(J,se){return J[7]?1:0}return Q=nt(l),Z=Fe[Q]=pt[Q](l),ne=new pl({props:{type:"is-primary",loading:l[2],disabled:l[2]||!l[8].trim()||!l[11],$$slots:{default:[xr]},$$scope:{ctx:l}}}),ne.$on("click",l[16]),F=new pl({props:{type:"is-light",disabled:l[2],$$slots:{default:[ea]},$$scope:{ctx:l}}}),F.$on("click",l[17]),ze=Ni(l[22][0]),{c(){e=f("div"),t=f("label"),t.textContent="Article Title",n=b(),o=f("div"),be(r.$$.fragment),u=b(),c=f("div"),p=f("label"),p.textContent="Description",d=b(),m=f("div"),_=f("textarea"),g=b(),h=f("div"),v=f("div"),v.textContent="Parent Collection",y=b(),k=f("div"),w=f("label"),$=f("input"),C=M(`
              Use predefined collection`),R=b(),I=f("label"),N=f("input"),E=M(`
              Custom parent URL/path`),O=b(),Z.c(),D=b(),A=f("div"),te=f("div"),be(ne.$$.fragment),B=b(),le=f("div"),be(F.$$.fragment),U=b(),P=f("div"),L=f("div"),H=f("p"),H.innerHTML="<strong>What will be saved:</strong>",K=b(),V=f("ul"),ie=f("li"),re=f("strong"),re.textContent="Title:",ye=b(),oe=M(Y),me=b(),G=f("li"),j=f("strong"),j.textContent="Body:",X=M(" Original document content ("),ge=M(ue),ae=M(" characters)"),pe=b(),_e=f("li"),Re=f("strong"),Re.textContent="Parent:",Ve=b(),Le=M(Be),Ee=b(),he=f("li"),Ae=f("strong"),Ae.textContent="Subject URL:",Ye=b(),Ue=M(Ke),a(t,"class","label"),a(t,"for","article-title"),a(o,"class","control"),a(e,"class","field"),a(p,"class","label"),a(p,"for","article-description"),a(_,"id","article-description"),a(_,"class","textarea"),a(_,"placeholder","Brief description of the article"),_.disabled=l[2],a(_,"rows","3"),a(m,"class","control"),a(c,"class","field"),a(v,"class","label"),a($,"type","radio"),$.__value=!1,$.value=$.__value,$.disabled=l[2],a(w,"class","radio svelte-48g63o"),a(N,"type","radio"),N.__value=!0,N.value=N.__value,N.disabled=l[2],a(I,"class","radio svelte-48g63o"),a(k,"class","control"),a(h,"class","field"),a(te,"class","control"),a(le,"class","control"),a(A,"class","field is-grouped"),a(ie,"class","svelte-48g63o"),a(G,"class","svelte-48g63o"),a(_e,"class","svelte-48g63o"),a(he,"class","svelte-48g63o"),a(V,"class","svelte-48g63o"),a(L,"class","notification is-info is-light svelte-48g63o"),a(P,"class","field"),ze.p($,N)},m(J,se){T(J,e,se),s(e,t),s(e,n),s(e,o),ke(r,o,null),T(J,u,se),T(J,c,se),s(c,p),s(c,d),s(c,m),s(m,_),Pe(_,l[9]),T(J,g,se),T(J,h,se),s(h,v),s(h,y),s(h,k),s(k,w),s(w,$),$.checked=$.__value===l[7],s(w,C),s(k,R),s(k,I),s(I,N),N.checked=N.__value===l[7],s(I,E),T(J,O,se),Fe[Q].m(J,se),T(J,D,se),T(J,A,se),s(A,te),ke(ne,te,null),s(A,B),s(A,le),ke(F,le,null),T(J,U,se),T(J,P,se),s(P,L),s(L,H),s(L,K),s(L,V),s(V,ie),s(ie,re),s(ie,ye),s(ie,oe),s(V,me),s(V,G),s(G,j),s(G,X),s(G,ge),s(G,ae),s(V,pe),s(V,_e),s(_e,Re),s(_e,Ve),s(_e,Le),s(V,Ee),s(V,he),s(he,Ae),s(he,Ye),s(he,Ue),Ne=!0,tt||(dt=[ee(_,"input",l[20]),ee($,"change",l[21]),ee(N,"change",l[23])],tt=!0)},p(J,se){var et,lt;const Oe={};se[0]&4&&(Oe.disabled=J[2]),!i&&se[0]&256&&(i=!0,Oe.value=J[8],wt(()=>i=!1)),r.$set(Oe),(!Ne||se[0]&4)&&(_.disabled=J[2]),se[0]&512&&Pe(_,J[9]),(!Ne||se[0]&4)&&($.disabled=J[2]),se[0]&128&&($.checked=$.__value===J[7]),(!Ne||se[0]&4)&&(N.disabled=J[2]),se[0]&128&&(N.checked=N.__value===J[7]);let Ie=Q;Q=nt(J),Q===Ie?Fe[Q].p(J,se):(We(),x(Fe[Ie],1,1,()=>{Fe[Ie]=null}),Je(),Z=Fe[Q],Z?Z.p(J,se):(Z=Fe[Q]=pt[Q](J),Z.c()),W(Z,1),Z.m(D.parentNode,D));const Ce={};se[0]&4&&(Ce.loading=J[2]),se[0]&2308&&(Ce.disabled=J[2]||!J[8].trim()||!J[11]),se[1]&2048&&(Ce.$$scope={dirty:se,ctx:J}),ne.$set(Ce);const ot={};se[0]&4&&(ot.disabled=J[2]),se[1]&2048&&(ot.$$scope={dirty:se,ctx:J}),F.$set(ot),(!Ne||se[0]&256)&&Y!==(Y=(J[8]||"Untitled")+"")&&ce(oe,Y),(!Ne||se[0]&2)&&ue!==(ue=(((lt=(et=J[1])==null?void 0:et.body)==null?void 0:lt.length)||0)+"")&&ce(ge,ue)},i(J){Ne||(W(r.$$.fragment,J),W(Z),W(ne.$$.fragment,J),W(F.$$.fragment,J),Ne=!0)},o(J){x(r.$$.fragment,J),x(Z),x(ne.$$.fragment,J),x(F.$$.fragment,J),Ne=!1},d(J){J&&S(e),we(r),J&&S(u),J&&S(c),J&&S(g),J&&S(h),J&&S(O),Fe[Q].d(J),J&&S(D),J&&S(A),we(ne),we(F),J&&S(U),J&&S(P),ze.r(),tt=!1,st(dt)}}}function Zr(l){let e,t,n,o,r,i,u;function c(d){l[25](d)}let p={placeholder:"e.g., my-collection or http://server/custom-parent",disabled:l[2]};return l[6]!==void 0&&(p.value=l[6]),n=new bl({props:p}),mt.push(()=>kt(n,"value",c)),{c(){e=f("div"),t=f("div"),be(n.$$.fragment),r=b(),i=f("p"),i.textContent=`Enter a collection name (e.g., "my-articles") or full URL.
              If the collection doesn't exist, it will be created.`,a(t,"class","control"),a(i,"class","help svelte-48g63o"),a(e,"class","field")},m(d,m){T(d,e,m),s(e,t),ke(n,t,null),s(e,r),s(e,i),u=!0},p(d,m){const _={};m[0]&4&&(_.disabled=d[2]),!o&&m[0]&64&&(o=!0,_.value=d[6],wt(()=>o=!1)),n.$set(_)},i(d){u||(W(n.$$.fragment,d),u=!0)},o(d){x(n.$$.fragment,d),u=!1},d(d){d&&S(e),we(n)}}}function Xr(l){let e,t,n,o,r,i,u=l[13],c=[];for(let p=0;p<u.length;p+=1)c[p]=Bn(Pn(l,u,p));return{c(){e=f("div"),t=f("div"),n=f("div"),o=f("select");for(let p=0;p<c.length;p+=1)c[p].c();o.disabled=l[2],l[5]===void 0&&It(()=>l[24].call(o)),a(n,"class","select is-fullwidth"),a(t,"class","control"),a(e,"class","field")},m(p,d){T(p,e,d),s(e,t),s(t,n),s(n,o);for(let m=0;m<c.length;m+=1)c[m]&&c[m].m(o,null);rt(o,l[5],!0),r||(i=ee(o,"change",l[24]),r=!0)},p(p,d){if(d[0]&8192){u=p[13];let m;for(m=0;m<u.length;m+=1){const _=Pn(p,u,m);c[m]?c[m].p(_,d):(c[m]=Bn(_),c[m].c(),c[m].m(o,null))}for(;m<c.length;m+=1)c[m].d(1);c.length=u.length}d[0]&4&&(o.disabled=p[2]),d[0]&8224&&rt(o,p[5])},i:$e,o:$e,d(p){p&&S(e),_t(c,p),r=!1,i()}}}function Bn(l){let e,t=l[33].label+"",n;return{c(){e=f("option"),n=M(t),e.__value=l[33].value,e.value=e.__value},m(o,r){T(o,e,r),s(e,n)},p:$e,d(o){o&&S(e)}}}function xr(l){let e,t,n;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-cloud-upload-alt"></i>',t=b(),n=f("span"),n.textContent="Save to Atomic Server",a(e,"class","icon")},m(o,r){T(o,e,r),T(o,t,r),T(o,n,r)},p:$e,d(o){o&&S(e),o&&S(t),o&&S(n)}}}function ea(l){let e;return{c(){e=M("Cancel")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function ta(l){let e,t,n,o,r,i,u,c,p,d,m,_,g,h=l[4]&&Hn(l),v=l[3]&&Fn(l),y=!l[4]&&zn(l);return{c(){e=f("div"),t=f("div"),n=f("div"),n.innerHTML=`<div class="level-item"><h3 class="title is-4"><span class="icon"><i class="fas fa-save"></i></span>
            Save to Atomic Server</h3></div>`,o=b(),r=f("div"),i=f("div"),u=f("button"),c=b(),h&&h.c(),p=b(),v&&v.c(),d=b(),y&&y.c(),a(n,"class","level-left"),a(u,"class","delete is-large"),u.disabled=l[2],a(u,"aria-label","close"),a(i,"class","level-item"),a(r,"class","level-right"),a(t,"class","level svelte-48g63o"),a(e,"class","box")},m(k,w){T(k,e,w),s(e,t),s(t,n),s(t,o),s(t,r),s(r,i),s(i,u),s(e,c),h&&h.m(e,null),s(e,p),v&&v.m(e,null),s(e,d),y&&y.m(e,null),m=!0,_||(g=ee(u,"click",l[17]),_=!0)},p(k,w){(!m||w[0]&4)&&(u.disabled=k[2]),k[4]?h?w[0]&16&&W(h,1):(h=Hn(k),h.c(),W(h,1),h.m(e,p)):h&&(We(),x(h,1,1,()=>{h=null}),Je()),k[3]?v?(v.p(k,w),w[0]&8&&W(v,1)):(v=Fn(k),v.c(),W(v,1),v.m(e,d)):v&&(We(),x(v,1,1,()=>{v=null}),Je()),k[4]?y&&(We(),x(y,1,1,()=>{y=null}),Je()):y?(y.p(k,w),w[0]&16&&W(y,1)):(y=zn(k),y.c(),W(y,1),y.m(e,null))},i(k){m||(W(h),W(v),W(y),m=!0)},o(k){x(h),x(v),x(y),m=!1},d(k){k&&S(e),h&&h.d(),v&&v.d(),y&&y.d(),_=!1,g()}}}function la(l){let e,t,n;function o(i){l[26](i)}let r={$$slots:{default:[ta]},$$scope:{ctx:l}};return l[0]!==void 0&&(r.active=l[0]),e=new Ul({props:r}),mt.push(()=>kt(e,"active",o)),e.$on("close",l[17]),{c(){be(e.$$.fragment)},m(i,u){ke(e,i,u),n=!0},p(i,u){const c={};u[0]&8190|u[1]&2048&&(c.$$scope={dirty:u,ctx:i}),!t&&u[0]&1&&(t=!0,c.active=i[0],wt(()=>t=!1)),e.$set(c)},i(i){n||(W(e.$$.fragment,i),n=!0)},o(i){x(e.$$.fragment,i),n=!1},d(i){we(e,i)}}}function na(l,e,t){let n,o,r;qe(l,bt,P=>t(27,n=P)),qe(l,Jt,P=>t(28,o=P)),qe(l,$t,P=>t(12,r=P));let{active:i=!1}=e,{document:u}=e,c=!1,p=null,d=!1,m="",_="",g=!1,h="",v="",y=[],k="";const w=[{label:"Root (Server Root)",value:""},{label:"Articles Collection",value:"articles"},{label:"Documents Collection",value:"documents"},{label:"Knowledge Base",value:"knowledge-base"},{label:"Research",value:"research"},{label:"Projects",value:"projects"}];function $(){t(2,c=!1),t(3,p=null),t(4,d=!1),t(5,m=""),t(6,_=""),t(7,g=!1),t(8,h=(u==null?void 0:u.title)||""),t(9,v=(u==null?void 0:u.description)||`Article saved from Terraphim search: ${u==null?void 0:u.title}`),t(10,y=[]),t(11,k="")}function C(){var K;const P=r,L=o;if(!(L!=null&&L.roles)||!P){console.warn("No role configuration found");return}let H=null;try{for(const[V,ie]of Object.entries(L.roles)){const re=ie,ye=typeof re.name=="object"?re.name.original:String(re.name);if(V===P||ye===P){H=re;break}}}catch(V){console.warn("Error checking role configuration:",V);return}if(!H){console.warn(`Role "${P}" not found in configuration`);return}t(10,y=((K=H.haystacks)==null?void 0:K.filter(V=>V.service==="Atomic"&&V.location&&!V.read_only))||[]),y.length>0&&t(11,k=y[0].location),console.log("Loaded atomic servers:",y)}function R(){const P=y.find(L=>L.location===k);return P==null?void 0:P.atomic_server_secret}function I(){const P=k.replace(/\/$/,"");if(g&&_.trim()){const L=_.trim();return L.startsWith("http://")||L.startsWith("https://")?L:`${P}/${L.replace(/^\//,"")}`}else return m?`${P}/${m}`:P}function N(){return h.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,50)}function E(){const P=k.replace(/\/$/,""),L=N(),H=Date.now();return`${P}/${L}-${H}`}async function O(){if(!k||!h.trim()){t(3,p="Please select an atomic server and provide a title");return}t(2,c=!0),t(3,p=null);try{const P=E(),L=I(),H=R();console.log("🔄 Saving article to atomic server:",{subject:P,parent:L,server:k,hasSecret:!!H});const K={subject:P,title:h.trim(),description:v.trim(),body:u.body,parent:L,shortname:N(),original_id:u.id,original_url:u.url,original_rank:u.rank,tags:u.tags||[]};if(n)await He("save_article_to_atomic",{article:K,serverUrl:k,atomicSecret:H});else{const V=await fetch(`${ct.ServerURL}/atomic/save`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({article:K,server_url:k,atomic_secret:H})});if(!V.ok){const ie=await V.json().catch(()=>({error:V.statusText}));throw new Error(ie.error||`HTTP ${V.status}: ${V.statusText}`)}}t(4,d=!0),console.log("✅ Article saved successfully to atomic server"),setTimeout(()=>{t(0,i=!1)},2e3)}catch(P){console.error("❌ Failed to save article to atomic server:",P),t(3,p=P.message||"Failed to save article to atomic server")}finally{t(2,c=!1)}}function Q(){c||t(0,i=!1)}const Z=[[]];function D(){k=Wt(this),t(11,k),t(10,y)}function A(P){h=P,t(8,h)}function te(){v=this.value,t(9,v)}function ne(){g=this.__value,t(7,g)}function B(){g=this.__value,t(7,g)}function le(){m=Wt(this),t(5,m),t(13,w)}function F(P){_=P,t(6,_)}function U(P){i=P,t(0,i)}return l.$$set=P=>{"active"in P&&t(0,i=P.active),"document"in P&&t(1,u=P.document)},l.$$.update=()=>{l.$$.dirty[0]&3&&i&&u&&($(),C())},[i,u,c,p,d,m,_,g,h,v,y,k,r,w,I,E,O,Q,D,A,te,ne,Z,B,le,F,U]}class oa extends Pt{constructor(e){super(),Ut(this,e,na,la,Ot,{active:0,document:1},null,[-1,-1])}}async function Tl(l){return He("tauri",l)}async function sa(l,e){return Tl({__tauriModule:"Event",message:{cmd:"unlisten",event:l,eventId:e}})}async function ia(l,e,t){return Tl({__tauriModule:"Event",message:{cmd:"listen",event:l,windowLabel:e,handler:nn(t)}}).then(n=>async()=>sa(l,n))}var Qn;(function(l){l.WINDOW_RESIZED="tauri://resize",l.WINDOW_MOVED="tauri://move",l.WINDOW_CLOSE_REQUESTED="tauri://close-requested",l.WINDOW_CREATED="tauri://window-created",l.WINDOW_DESTROYED="tauri://destroyed",l.WINDOW_FOCUS="tauri://focus",l.WINDOW_BLUR="tauri://blur",l.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",l.WINDOW_THEME_CHANGED="tauri://theme-changed",l.WINDOW_FILE_DROP="tauri://file-drop",l.WINDOW_FILE_DROP_HOVER="tauri://file-drop-hover",l.WINDOW_FILE_DROP_CANCELLED="tauri://file-drop-cancelled",l.MENU="tauri://menu",l.CHECK_UPDATE="tauri://update",l.UPDATE_AVAILABLE="tauri://update-available",l.INSTALL_UPDATE="tauri://update-install",l.STATUS_UPDATE="tauri://update-status",l.DOWNLOAD_PROGRESS="tauri://update-download-progress"})(Qn||(Qn={}));async function ra(l,e){return ia(l,null,e)}function Vn(l,e,t){const n=l.slice();n[9]=e[t];const o=typeof n[9].name=="string"?n[9].name:n[9].name.original;return n[10]=o,n}function Yn(l){let e,t=l[10]+"",n,o;return{c(){e=f("option"),n=M(t),e.__value=o=l[10],e.value=e.__value},m(r,i){T(r,e,i),s(e,n)},p(r,i){i&1&&t!==(t=r[10]+"")&&ce(n,t),i&1&&o!==(o=r[10])&&(e.__value=o,e.value=e.__value)},d(r){r&&S(e)}}}function aa(l){let e,t,n,o,r,i,u=l[0],c=[];for(let p=0;p<u.length;p+=1)c[p]=Yn(Vn(l,u,p));return{c(){e=f("div"),t=f("div"),n=f("div"),o=f("select");for(let p=0;p<c.length;p+=1)c[p].c();a(n,"class","select"),a(t,"class","control"),a(e,"class","field is-grouped is-grouped-right")},m(p,d){T(p,e,d),s(e,t),s(t,n),s(n,o);for(let m=0;m<c.length;m+=1)c[m]&&c[m].m(o,null);rt(o,l[1]),r||(i=ee(o,"change",l[2]),r=!0)},p(p,[d]){if(d&1){u=p[0];let m;for(m=0;m<u.length;m+=1){const _=Vn(p,u,m);c[m]?c[m].p(_,d):(c[m]=Yn(_),c[m].c(),c[m].m(o,null))}for(;m<c.length;m+=1)c[m].d(1);c.length=u.length}d&3&&rt(o,p[1])},i:$e,o:$e,d(p){p&&S(e),_t(c,p),r=!1,i()}}}function ca(l,e,t){let n,o,r,i;qe(l,Jt,_=>t(5,n=_)),qe(l,bt,_=>t(6,o=_)),qe(l,$n,_=>t(0,r=_)),qe(l,$t,_=>t(1,i=_));let u="";async function c(){try{bt.set(window.__TAURI__!==void 0),o?(console.log("Loading config from Tauri"),He("get_config").then(_=>{console.log("get_config response",_),_&&_.status==="success"&&p(_.config)}).catch(_=>console.error("Error fetching config in Tauri:",_))):(console.log("Loading config from server"),u=`${ct.ServerURL}/config/`,fetch(u).then(_=>_.json()).then(_=>{console.log("Config received",_),_&&_.status==="success"&&p(_.config)}).catch(_=>console.error("Error fetching config:",_)))}catch(_){console.error("Unhandled error in loadConfig:",_)}}function p(_){var y;console.log("Updating stores from config:",_);const g={default_role:_.selected_role,..._};Jt.set(g);const h=Object.entries(_.roles).map(([k,w])=>({name:k,...w}));$n.set(h),$t.set(_.selected_role);const v=_.roles[_.selected_role];if(console.log("Selected role settings:",v),v){const k=v.theme||"spacelab";console.log("Setting theme to:",k),Ml.set(k),(y=v.kg)!=null&&y.publish?o?He("publish_thesaurus",{roleName:_.selected_role}).then(w=>{console.log("publish_thesaurus response",w),Ol.set(w),xt.set(!0)}).catch(w=>{console.error("Error publishing thesaurus:",w),xt.set(!1)}):(console.log("Fetching thesaurus from HTTP endpoint for role",_.selected_role),fetch(`${ct.ServerURL}/thesaurus/${encodeURIComponent(_.selected_role)}`).then(w=>w.json()).then(w=>{console.log("thesaurus HTTP response",w),w&&w.status==="success"&&w.thesaurus?(Ol.set(w.thesaurus),xt.set(!0)):(console.error("Failed to fetch thesaurus:",w),xt.set(!1))}).catch(w=>{console.error("Error fetching thesaurus:",w),xt.set(!1)})):xt.set(!1)}else console.warn("No role settings found for:",_.selected_role),Ml.set("spacelab")}typeof window<"u"&&window.__TAURI__&&ra("role_changed",_=>{console.log("Role changed event received from backend:",_.payload),p(_.payload)});async function d(){await c()}d(),console.log("Using Terraphim Server URL:",ct.ServerURL);function m(_){var k,w;const h=_.currentTarget.value;console.log("Role change requested:",h),$t.set(h);const v=r.find($=>(typeof $.name=="string"?$.name:$.name.original)===h);if(!v){console.error(`No role settings found for role: ${h}.`);return}const y=v.theme||"spacelab";Ml.set(y),console.log(`Theme changed to ${y}`),Jt.update($=>($.selected_role=typeof $.selected_role=="string"?{original:h,lowercase:h.toLowerCase()}:{original:h,lowercase:h.toLowerCase()},$)),o?(He("select_role",{roleName:h}).catch($=>console.error("Error selecting role:",$)),(k=v.kg)!=null&&k.publish?(console.log("Publishing thesaurus for role",h),He("publish_thesaurus",{roleName:h}).then($=>{Ol.set($),xt.set(!0)})):xt.set(!1)):(fetch(`${ct.ServerURL}/config/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).catch($=>console.error("Error updating config on server:",$)),(w=v.kg)!=null&&w.publish?(console.log("Fetching thesaurus from HTTP endpoint for role",h),fetch(`${ct.ServerURL}/thesaurus/${encodeURIComponent(h)}`).then($=>$.json()).then($=>{console.log("thesaurus HTTP response",$),$&&$.status==="success"&&$.thesaurus?(Ol.set($.thesaurus),xt.set(!0)):(console.error("Failed to fetch thesaurus:",$),xt.set(!1))}).catch($=>{console.error("Error fetching thesaurus:",$),xt.set(!1)})):xt.set(!1))}return[r,i,m,c]}class Ql extends Pt{constructor(e){super(),Ut(this,e,ca,aa,Ot,{loadConfig:3})}get loadConfig(){return this.$$.ctx[3]}}function Zn(l,e,t){const n=l.slice();return n[0]=e[t],n}function Xn(l,e,t){const n=l.slice();return n[45]=e[t],n}function xn(l){let e,t;return e=new cn({props:{$$slots:{default:[fa]},$$scope:{ctx:l}}}),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},p(n,o){const r={};o[0]&129|o[1]&131072&&(r.$$scope={dirty:o,ctx:n}),e.$set(r)},i(n){t||(W(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function ua(l){let e=l[45]+"",t;return{c(){t=M(e)},m(n,o){T(n,t,o)},p(n,o){o[0]&1&&e!==(e=n[45]+"")&&ce(t,e)},d(n){n&&S(t)}}}function eo(l){let e,t,n,o,r,i;t=new ml({props:{rounded:!0,$$slots:{default:[ua]},$$scope:{ctx:l}}});function u(){return l[19](l[45])}return{c(){e=f("button"),be(t.$$.fragment),n=b(),a(e,"class","tag-button svelte-8px6jr"),e.disabled=l[7],a(e,"title","Click to view knowledge graph document")},m(c,p){T(c,e,p),ke(t,e,null),s(e,n),o=!0,r||(i=ee(e,"click",u),r=!0)},p(c,p){l=c;const d={};p[0]&1|p[1]&131072&&(d.$$scope={dirty:p,ctx:l}),t.$set(d),(!o||p[0]&128)&&(e.disabled=l[7])},i(c){o||(W(t.$$.fragment,c),o=!0)},o(c){x(t.$$.fragment,c),o=!1},d(c){c&&S(e),we(t),r=!1,i()}}}function fa(l){let e,t,n=l[0].tags,o=[];for(let i=0;i<n.length;i+=1)o[i]=eo(Xn(l,n,i));const r=i=>x(o[i],1,1,()=>{o[i]=null});return{c(){for(let i=0;i<o.length;i+=1)o[i].c();e=St()},m(i,u){for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(i,u);T(i,e,u),t=!0},p(i,u){if(u[0]&131201){n=i[0].tags;let c;for(c=0;c<n.length;c+=1){const p=Xn(i,n,c);o[c]?(o[c].p(p,u),W(o[c],1)):(o[c]=eo(p),o[c].c(),W(o[c],1),o[c].m(e.parentNode,e))}for(We(),c=n.length;c<o.length;c+=1)r(c);Je()}},i(i){if(!t){for(let u=0;u<n.length;u+=1)W(o[u]);t=!0}},o(i){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)x(o[u]);t=!1},d(i){_t(o,i),i&&S(e)}}}function da(l){let e,t=(l[0].rank||0)+"",n;return{c(){e=M("Rank "),n=M(t)},m(o,r){T(o,e,r),T(o,n,r)},p(o,r){r[0]&1&&t!==(t=(o[0].rank||0)+"")&&ce(n,t)},d(o){o&&S(e),o&&S(n)}}}function pa(l){let e,t;return e=new ml({props:{rounded:!0,$$slots:{default:[da]},$$scope:{ctx:l}}}),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},p(n,o){const r={};o[0]&1|o[1]&131072&&(r.$$scope={dirty:o,ctx:n}),e.$set(r)},i(n){t||(W(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function ma(l){let e;return{c(){e=f("small"),e.textContent="No description available",a(e,"class","no-description svelte-8px6jr")},m(t,n){T(t,e,n)},p:$e,i:$e,o:$e,d(t){t&&S(e)}}}function _a(l){let e,t;return e=new Hl({props:{source:l[0].description}}),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},p(n,o){const r={};o[0]&1&&(r.source=n[0].description),e.$set(r)},i(n){t||(W(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function to(l){let e,t,n,o,r,i;return{c(){e=f("button"),t=f("span"),t.innerHTML='<i class="fas fa-magic" aria-hidden="true"></i>',n=b(),o=f("span"),o.textContent="AI Summary",a(t,"class","icon is-small"),a(e,"class","button is-small is-info is-outlined ai-summary-button svelte-8px6jr"),e.disabled=l[9],a(e,"title","Generate AI-powered summary using OpenRouter")},m(u,c){T(u,e,c),s(e,t),s(e,n),s(e,o),r||(i=ee(e,"click",l[18]),r=!0)},p(u,c){c[0]&512&&(e.disabled=u[9])},d(u){u&&S(e),r=!1,i()}}}function lo(l){let e;return{c(){e=f("div"),e.innerHTML=`<span class="icon"><i class="fas fa-spinner fa-spin" aria-hidden="true"></i></span> 
                <small>Generating AI summary...</small>`,a(e,"class","ai-summary-loading svelte-8px6jr")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function no(l){let e,t,n,o,r,i,u,c,p,d;return{c(){e=f("div"),t=f("span"),t.innerHTML='<i class="fas fa-exclamation-triangle" aria-hidden="true"></i>',n=b(),o=f("small"),r=M("Summary error: "),i=M(l[10]),u=b(),c=f("button"),c.textContent="Retry",a(t,"class","icon has-text-danger"),a(o,"class","has-text-danger"),a(c,"class","button is-small is-text svelte-8px6jr"),a(c,"title","Retry generating summary"),a(e,"class","ai-summary-error svelte-8px6jr")},m(m,_){T(m,e,_),s(e,t),s(e,n),s(e,o),s(o,r),s(o,i),s(e,u),s(e,c),p||(d=ee(c,"click",l[20]),p=!0)},p(m,_){_[0]&1024&&ce(i,m[10])},d(m){m&&S(e),p=!1,d()}}}function oo(l){let e,t,n,o,r,i,u,c,p,d,m,_,g,h,v,y,k,w,$,C;function R(E,O){return E[12]?ha:ga}let I=R(l),N=I(l);return d=new Hl({props:{source:l[8]}}),{c(){e=f("div"),t=f("div"),n=f("small"),o=f("span"),o.innerHTML='<i class="fas fa-robot" aria-hidden="true"></i>',r=M(`
                    AI Summary
                    `),N.c(),i=b(),u=f("button"),u.innerHTML='<span class="icon is-small"><i class="fas fa-times" aria-hidden="true"></i></span>',c=b(),p=f("div"),be(d.$$.fragment),m=b(),_=f("div"),g=f("button"),h=f("span"),h.innerHTML='<i class="fas fa-redo" aria-hidden="true"></i>',v=b(),y=f("span"),y.textContent="Regenerate",a(o,"class","icon is-small"),a(n,"class","ai-summary-label svelte-8px6jr"),a(u,"class","button is-small is-text svelte-8px6jr"),a(u,"title","Hide AI summary"),a(t,"class","ai-summary-header svelte-8px6jr"),a(p,"class","ai-summary-content svelte-8px6jr"),a(h,"class","icon is-small"),a(g,"class","button is-small is-text svelte-8px6jr"),g.disabled=l[9],a(g,"title","Regenerate summary"),a(_,"class","ai-summary-actions svelte-8px6jr"),a(e,"class","ai-summary svelte-8px6jr")},m(E,O){T(E,e,O),s(e,t),s(t,n),s(n,o),s(n,r),N.m(n,null),s(t,i),s(t,u),s(e,c),s(e,p),ke(d,p,null),s(e,m),s(e,_),s(_,g),s(g,h),s(g,v),s(g,y),w=!0,$||(C=[ee(u,"click",l[21]),ee(g,"click",l[22])],$=!0)},p(E,O){I!==(I=R(E))&&(N.d(1),N=I(E),N&&(N.c(),N.m(n,null)));const Q={};O[0]&256&&(Q.source=E[8]),d.$set(Q),(!w||O[0]&512)&&(g.disabled=E[9])},i(E){w||(W(d.$$.fragment,E),It(()=>{w&&(k||(k=Al(e,Dl,{},!0)),k.run(1))}),w=!0)},o(E){x(d.$$.fragment,E),k||(k=Al(e,Dl,{},!1)),k.run(0),w=!1},d(E){E&&S(e),N.d(),we(d),E&&k&&k.end(),$=!1,st(C)}}}function ga(l){let e;return{c(){e=f("span"),e.textContent="fresh",a(e,"class","tag is-small is-success")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function ha(l){let e;return{c(){e=f("span"),e.textContent="cached",a(e,"class","tag is-small is-light")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function so(l){let e;function t(r,i){return r[0].disabled?ka:r[0].isLink?ba:va}let n=t(l),o=n(l);return{c(){o.c(),e=St()},m(r,i){o.m(r,i),T(r,e,i)},p(r,i){n===(n=t(r))&&o?o.p(r,i):(o.d(1),o=n(r),o&&(o.c(),o.m(e.parentNode,e)))},d(r){o.d(r),r&&S(e)}}}function va(l){let e,t,n,o,r,i,u,c,p,d;return{c(){var m,_,g;e=f("button"),t=f("span"),n=f("i"),r=b(),a(n,"class",o=rl(l[0].icon)+" svelte-8px6jr"),a(t,"class","icon is-medium"),vt(t,"has-text-primary",(m=l[0].className)==null?void 0:m.includes("primary")),vt(t,"has-text-success",(_=l[0].className)==null?void 0:_.includes("success")),vt(t,"has-text-danger",(g=l[0].className)==null?void 0:g.includes("danger")),a(e,"type","button"),a(e,"class","level-item button is-ghost svelte-8px6jr"),a(e,"aria-label",i=l[0].title),a(e,"title",u=l[0].title),a(e,"data-testid",c=l[0].testId||"")},m(m,_){T(m,e,_),s(e,t),s(t,n),s(e,r),p||(d=ee(e,"click",function(){jl(l[0].action)&&l[0].action.apply(this,arguments)}),p=!0)},p(m,_){var g,h,v;l=m,_[0]&32768&&o!==(o=rl(l[0].icon)+" svelte-8px6jr")&&a(n,"class",o),_[0]&32768&&vt(t,"has-text-primary",(g=l[0].className)==null?void 0:g.includes("primary")),_[0]&32768&&vt(t,"has-text-success",(h=l[0].className)==null?void 0:h.includes("success")),_[0]&32768&&vt(t,"has-text-danger",(v=l[0].className)==null?void 0:v.includes("danger")),_[0]&32768&&i!==(i=l[0].title)&&a(e,"aria-label",i),_[0]&32768&&u!==(u=l[0].title)&&a(e,"title",u),_[0]&32768&&c!==(c=l[0].testId||"")&&a(e,"data-testid",c)},d(m){m&&S(e),p=!1,d()}}}function ba(l){let e,t,n,o,r,i,u,c;return{c(){e=f("a"),t=f("span"),n=f("i"),r=b(),a(n,"class",o=rl(l[0].icon)+" svelte-8px6jr"),a(t,"class","icon is-medium"),vt(t,"has-text-primary",l[0].className),a(e,"href",i=l[0].href),a(e,"target","_blank"),a(e,"class","level-item"),a(e,"aria-label",u=l[0].title),a(e,"title",c=l[0].title)},m(p,d){T(p,e,d),s(e,t),s(t,n),s(e,r)},p(p,d){d[0]&32768&&o!==(o=rl(p[0].icon)+" svelte-8px6jr")&&a(n,"class",o),d[0]&32768&&vt(t,"has-text-primary",p[0].className),d[0]&32768&&i!==(i=p[0].href)&&a(e,"href",i),d[0]&32768&&u!==(u=p[0].title)&&a(e,"aria-label",u),d[0]&32768&&c!==(c=p[0].title)&&a(e,"title",c)},d(p){p&&S(e)}}}function ka(l){let e,t,n,o,r,i,u;return{c(){e=f("button"),t=f("span"),n=f("i"),r=b(),a(n,"class",o=rl(l[0].icon)+" svelte-8px6jr"),a(t,"class","icon is-medium"),vt(t,"has-text-primary",l[0].className),a(e,"type","button"),a(e,"class","level-item button is-ghost svelte-8px6jr"),a(e,"aria-label",i=l[0].title),a(e,"title",u=l[0].title),e.disabled=!0},m(c,p){T(c,e,p),s(e,t),s(t,n),s(e,r)},p(c,p){p[0]&32768&&o!==(o=rl(c[0].icon)+" svelte-8px6jr")&&a(n,"class",o),p[0]&32768&&vt(t,"has-text-primary",c[0].className),p[0]&32768&&i!==(i=c[0].title)&&a(e,"aria-label",i),p[0]&32768&&u!==(u=c[0].title)&&a(e,"title",u)},d(c){c&&S(e)}}}function io(l){let e,t=l[0].visible&&so(l);return{c(){t&&t.c(),e=St()},m(n,o){t&&t.m(n,o),T(n,e,o)},p(n,o){n[0].visible?t?t.p(n,o):(t=so(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(n){t&&t.d(n),n&&S(e)}}}function ro(l){let e,t,n,o,r,i;return{c(){e=f("div"),t=f("button"),n=b(),o=M(l[13]),a(t,"class","delete svelte-8px6jr"),a(e,"class","notification is-danger is-light mt-2")},m(u,c){T(u,e,c),s(e,t),s(e,n),s(e,o),r||(i=ee(t,"click",l[23]),r=!0)},p(u,c){c[0]&8192&&ce(o,u[13])},d(u){u&&S(e),r=!1,i()}}}function ao(l){let e,t,n;function o(i){l[25](i)}let r={item:l[4],kgTerm:l[5],kgRank:l[6]};return l[2]!==void 0&&(r.active=l[2]),e=new Zl({props:r}),mt.push(()=>kt(e,"active",o)),{c(){be(e.$$.fragment)},m(i,u){ke(e,i,u),n=!0},p(i,u){const c={};u[0]&16&&(c.item=i[4]),u[0]&32&&(c.kgTerm=i[5]),u[0]&64&&(c.kgRank=i[6]),!t&&u[0]&4&&(t=!0,c.active=i[2],wt(()=>t=!1)),e.$set(c)},i(i){n||(W(e.$$.fragment,i),n=!0)},o(i){x(e.$$.fragment,i),n=!1},d(i){we(e,i)}}}function co(l){let e,t,n;function o(i){l[26](i)}let r={document:l[0]};return l[3]!==void 0&&(r.active=l[3]),e=new oa({props:r}),mt.push(()=>kt(e,"active",o)),{c(){be(e.$$.fragment)},m(i,u){ke(e,i,u),n=!0},p(i,u){const c={};u[0]&1&&(c.document=i[0]),!t&&u[0]&8&&(t=!0,c.active=i[3],wt(()=>t=!1)),e.$set(c)},i(i){n||(W(e.$$.fragment,i),n=!0)},o(i){x(e.$$.fragment,i),n=!1},d(i){we(e,i)}}}function wa(l){let e,t,n,o,r,i,u,c,p,d,m,_,g=l[0].title+"",h,v,y,k,w,$,C,R,I,N,E,O,Q,Z,D,A,te,ne,B,le,F,U,P,L,H,K,V,ie,re,ye,Y,oe=l[0].tags&&xn(l);c=new cn({props:{$$slots:{default:[pa]},$$scope:{ctx:l}}});const me=[_a,ma],G=[];function j(he,Ae){return he[0].description?0:1}C=j(l),R=G[C]=me[C](l);let X=!l[11]&&!l[9]&&!l[10]&&to(l),ue=l[9]&&lo(),ge=l[10]&&no(l),ae=l[11]&&l[8]&&oo(l),pe=l[15],_e=[];for(let he=0;he<pe.length;he+=1)_e[he]=io(Zn(l,pe,he));let Re=l[13]&&ro(l);function Ve(he){l[24](he)}let Be={item:l[0]};l[1]!==void 0&&(Be.active=l[1]),L=new Zl({props:Be}),mt.push(()=>kt(L,"active",Ve));let Le=l[4]&&ao(l),Ee=l[14]&&co(l);return{c(){e=f("div"),t=f("article"),n=f("div"),o=f("div"),r=f("div"),oe&&oe.c(),i=b(),u=f("div"),be(c.$$.fragment),p=b(),d=f("div"),m=f("button"),_=f("h2"),h=M(g),v=b(),y=f("div"),k=f("small"),k.textContent="Description:",w=b(),$=f("div"),R.c(),I=b(),N=f("div"),X&&X.c(),E=b(),ue&&ue.c(),O=b(),ge&&ge.c(),Q=b(),ae&&ae.c(),Z=b(),D=f("br"),te=b(),ne=f("div"),B=f("nav"),le=f("div");for(let he=0;he<_e.length;he+=1)_e[he].c();U=b(),Re&&Re.c(),P=b(),be(L.$$.fragment),K=b(),Le&&Le.c(),V=b(),Ee&&Ee.c(),ie=St(),a(r,"class","level-right"),a(u,"class","level-right"),a(_,"class","title svelte-8px6jr"),a(m,"class","svelte-8px6jr"),a(k,"class","description-label svelte-8px6jr"),a($,"class","description-content svelte-8px6jr"),a(y,"class","description svelte-8px6jr"),a(N,"class","ai-summary-section svelte-8px6jr"),a(o,"class","content"),a(le,"class","level-right svelte-8px6jr"),a(B,"class","level is-mobile svelte-8px6jr"),a(ne,"class","level-right"),a(n,"class","media-content"),a(t,"class","media"),a(e,"class","box")},m(he,Ae){T(he,e,Ae),s(e,t),s(t,n),s(n,o),s(o,r),oe&&oe.m(r,null),s(o,i),s(o,u),ke(c,u,null),s(o,p),s(o,d),s(d,m),s(m,_),s(_,h),s(d,v),s(d,y),s(y,k),s(y,w),s(y,$),G[C].m($,null),s(d,I),s(d,N),X&&X.m(N,null),s(N,E),ue&&ue.m(N,null),s(N,O),ge&&ge.m(N,null),s(N,Q),ae&&ae.m(N,null),s(d,Z),s(d,D),s(n,te),s(n,ne),s(ne,B),s(B,le);for(let Ye=0;Ye<_e.length;Ye+=1)_e[Ye]&&_e[Ye].m(le,null);s(e,U),Re&&Re.m(e,null),T(he,P,Ae),ke(L,he,Ae),T(he,K,Ae),Le&&Le.m(he,Ae),T(he,V,Ae),Ee&&Ee.m(he,Ae),T(he,ie,Ae),re=!0,ye||(Y=ee(m,"click",l[16]),ye=!0)},p(he,Ae){he[0].tags?oe?(oe.p(he,Ae),Ae[0]&1&&W(oe,1)):(oe=xn(he),oe.c(),W(oe,1),oe.m(r,null)):oe&&(We(),x(oe,1,1,()=>{oe=null}),Je());const Ye={};Ae[0]&1|Ae[1]&131072&&(Ye.$$scope={dirty:Ae,ctx:he}),c.$set(Ye),(!re||Ae[0]&1)&&g!==(g=he[0].title+"")&&ce(h,g);let Ke=C;if(C=j(he),C===Ke?G[C].p(he,Ae):(We(),x(G[Ke],1,1,()=>{G[Ke]=null}),Je(),R=G[C],R?R.p(he,Ae):(R=G[C]=me[C](he),R.c()),W(R,1),R.m($,null)),!he[11]&&!he[9]&&!he[10]?X?X.p(he,Ae):(X=to(he),X.c(),X.m(N,E)):X&&(X.d(1),X=null),he[9]?ue||(ue=lo(),ue.c(),ue.m(N,O)):ue&&(ue.d(1),ue=null),he[10]?ge?ge.p(he,Ae):(ge=no(he),ge.c(),ge.m(N,Q)):ge&&(ge.d(1),ge=null),he[11]&&he[8]?ae?(ae.p(he,Ae),Ae[0]&2304&&W(ae,1)):(ae=oo(he),ae.c(),W(ae,1),ae.m(N,null)):ae&&(We(),x(ae,1,1,()=>{ae=null}),Je()),Ae[0]&32768){pe=he[15];let Ne;for(Ne=0;Ne<pe.length;Ne+=1){const ze=Zn(he,pe,Ne);_e[Ne]?_e[Ne].p(ze,Ae):(_e[Ne]=io(ze),_e[Ne].c(),_e[Ne].m(le,null))}for(;Ne<_e.length;Ne+=1)_e[Ne].d(1);_e.length=pe.length}he[13]?Re?Re.p(he,Ae):(Re=ro(he),Re.c(),Re.m(e,null)):Re&&(Re.d(1),Re=null);const Ue={};Ae[0]&1&&(Ue.item=he[0]),!H&&Ae[0]&2&&(H=!0,Ue.active=he[1],wt(()=>H=!1)),L.$set(Ue),he[4]?Le?(Le.p(he,Ae),Ae[0]&16&&W(Le,1)):(Le=ao(he),Le.c(),W(Le,1),Le.m(V.parentNode,V)):Le&&(We(),x(Le,1,1,()=>{Le=null}),Je()),he[14]?Ee?(Ee.p(he,Ae),Ae[0]&16384&&W(Ee,1)):(Ee=co(he),Ee.c(),W(Ee,1),Ee.m(ie.parentNode,ie)):Ee&&(We(),x(Ee,1,1,()=>{Ee=null}),Je())},i(he){re||(W(oe),W(c.$$.fragment,he),W(R),W(ae),It(()=>{re&&(A||(A=Al(d,Dl,{},!0)),A.run(1))}),It(()=>{re&&(F||(F=Al(B,Dl,{},!0)),F.run(1))}),W(L.$$.fragment,he),W(Le),W(Ee),re=!0)},o(he){x(oe),x(c.$$.fragment,he),x(R),x(ae),A||(A=Al(d,Dl,{},!1)),A.run(0),F||(F=Al(B,Dl,{},!1)),F.run(0),x(L.$$.fragment,he),x(Le),x(Ee),re=!1},d(he){he&&S(e),oe&&oe.d(),we(c),G[C].d(),X&&X.d(),ue&&ue.d(),ge&&ge.d(),ae&&ae.d(),he&&A&&A.end(),_t(_e,he),he&&F&&F.end(),Re&&Re.d(),he&&S(P),we(L,he),he&&S(K),Le&&Le.d(he),he&&S(V),Ee&&Ee.d(he),he&&S(ie),ye=!1,Y()}}}function ya(l,e,t){let n,o,r,i,u;qe(l,$t,Y=>t(31,r=Y)),qe(l,bt,Y=>t(32,i=Y)),qe(l,Jt,Y=>t(33,u=Y));let{item:c}=e,p=!1,d=!1,m=!1,_=null,g=null,h=null,v=!1,y=null,k=!1,w=null,$=!1,C=!1,R=!1,I=!1,N=null,E=!1,O=!1;function Q(){const Y=[];return Y.push({id:"download-markdown",label:"Download to Markdown",icon:"fas fa-download",action:()=>B(),visible:!0,title:"Download document as markdown file"}),n&&Y.push({id:"save-atomic",label:"Save to Atomic Server",icon:"fas fa-cloud-upload-alt",action:()=>A(),visible:!0,title:"Save article to Atomic Server",className:"has-text-primary"}),c.url&&Y.push({id:"external-url",label:"Open URL",icon:"fas fa-link",action:()=>le(),visible:!0,title:"Open original URL in new tab"}),Y.push({id:"add-context",label:I?"Added to Context ✓":R?"Adding...":"Add to Context",icon:I?"fas fa-check-circle":R?"fas fa-spinner fa-spin":"fas fa-plus-circle",action:()=>F(),visible:!0,title:I?"Document successfully added to chat context. Go to Chat tab to see it.":"Add document to LLM conversation context",disabled:R||I,className:I?"has-text-success":N?"has-text-danger":"",testId:"add-to-context-button"}),Y.push({id:"chat-with-document",label:O?"Opening Chat...":E?"Adding to Chat...":"Chat with Document",icon:O?"fas fa-external-link-alt":E?"fas fa-spinner fa-spin":"fas fa-comment-dots",action:()=>U(),visible:!0,title:O?"Opening chat with this document":"Add document to context and open chat",disabled:E||O||R,className:O?"has-text-info":N?"has-text-danger":"has-text-primary",testId:"chat-with-document-button"}),Y}function Z(){var j;const Y=r,oe=u;if(!(oe!=null&&oe.roles)||!Y)return!1;let me=null;try{for(const[X,ue]of Object.entries(oe.roles)){const ge=ue,ae=typeof ge.name=="object"?ge.name.original:String(ge.name);if(X===Y||ae===Y){me=ge;break}}}catch(X){return console.warn("Error checking role configuration:",X),!1}return me?(((j=me.haystacks)==null?void 0:j.filter(X=>X.service==="Atomic"&&X.location&&!X.read_only))||[]).length>0:!1}const D=()=>{t(1,p=!0)},A=()=>{console.log("🔄 Opening atomic save modal for document:",c.title),t(3,m=!0)};async function te(Y){var oe,me,G,j,X;t(7,v=!0),t(5,g=Y),console.log("🔍 KG Search Debug Info:"),console.log("  Tag clicked:",Y),console.log("  Current role:",r),console.log("  Is Tauri mode:",i);try{if(i){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:r,term:Y});const ue=await He("find_documents_for_kg_term",{roleName:r,term:Y});console.log("  📥 Tauri response received:"),console.log("    Status:",ue.status),console.log("    Results count:",((oe=ue.results)==null?void 0:oe.length)||0),console.log("    Total:",ue.total||0),console.log("    Full response:",JSON.stringify(ue,null,2)),ue.status==="success"&&ue.results&&ue.results.length>0?(t(4,_=ue.results[0]),t(6,h=_.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",_.title),console.log("    Rank:",h),console.log("    Body length:",((me=_.body)==null?void 0:me.length)||0,"characters"),t(2,d=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${Y}" in role: "${r}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const ue=ct.ServerURL,ge=encodeURIComponent(r),ae=encodeURIComponent(Y),pe=`${ue}/roles/${ge}/kg_search?term=${ae}`;console.log("  📤 HTTP Request details:"),console.log("    Base URL:",ue),console.log("    Role (encoded):",ge),console.log("    Term (encoded):",ae),console.log("    Full URL:",pe);const _e=await fetch(pe);if(console.log("  📥 HTTP Response received:"),console.log("    Status code:",_e.status),console.log("    Status text:",_e.statusText),console.log("    Headers:",Object.fromEntries(_e.headers.entries())),!_e.ok)throw new Error(`HTTP error! Status: ${_e.status} - ${_e.statusText}`);const Re=await _e.json();console.log("  📄 Response data:"),console.log("    Status:",Re.status),console.log("    Results count:",((G=Re.results)==null?void 0:G.length)||0),console.log("    Total:",Re.total||0),console.log("    Full response:",JSON.stringify(Re,null,2)),Re.status==="success"&&Re.results&&Re.results.length>0?(t(4,_=Re.results[0]),t(6,h=_.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",_.title),console.log("    Rank:",h),console.log("    Body length:",((j=_.body)==null?void 0:j.length)||0,"characters"),t(2,d=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${Y}" in role: "${r}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",pe))}}catch(ue){console.error("❌ Error fetching KG document:"),console.error("  Error type:",ue.constructor.name),console.error("  Error message:",ue.message||ue),console.error("  Request details:",{tag:Y,role:r,isTauri:i,timestamp:new Date().toISOString()}),!i&&((X=ue.message)!=null&&X.includes("Failed to fetch"))&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{t(7,v=!1)}}async function ne(){var Y;if(!(k||!c.id||!r)){t(9,k=!0),t(10,w=null),console.log("🤖 AI Summary Debug Info:"),console.log("  Document ID:",c.id),console.log("  Current role:",r),console.log("  Is Tauri mode:",i);try{const oe={document_id:c.id,role:r,max_length:250,force_regenerate:!1};console.log("  📤 Summarization request:",oe);let me;if(i){const X=`${ct.ServerURL}/documents/summarize`;me=await fetch(X,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(oe)})}else{const X=`${ct.ServerURL}/documents/summarize`;me=await fetch(X,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(oe)})}if(console.log("  📥 Summary response received:"),console.log("    Status code:",me.status),console.log("    Status text:",me.statusText),!me.ok)throw new Error(`HTTP error! Status: ${me.status} - ${me.statusText}`);const G=await me.json();console.log("  📄 Summary response data:",G),G.status==="success"&&G.summary?(t(8,y=G.summary),t(12,C=G.from_cache||!1),t(11,$=!0),console.log("  ✅ Summary generated successfully"),console.log("    Summary length:",y.length,"characters"),console.log("    From cache:",C),console.log("    Model used:",G.model_used)):(t(10,w=G.error||"Failed to generate summary"),console.error("  ❌ Summary generation failed:",w))}catch(oe){console.error("❌ Error generating summary:"),console.error("  Error type:",oe.constructor.name),console.error("  Error message:",oe.message||oe),console.error("  Request details:",{document_id:c.id,role:r,isTauri:i,timestamp:new Date().toISOString()}),t(10,w=oe.message||"Network error occurred"),(Y=oe.message)!=null&&Y.includes("Failed to fetch")&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Verify OpenRouter is enabled for this role"),console.error("    3. Check OPENROUTER_KEY environment variable"),console.error("    4. Verify server URL in CONFIG.ServerURL"))}finally{t(9,k=!1)}}}async function B(){var me;console.log("📥 Downloading document as markdown:",c.title),console.log("📄 Document data:",{title:c.title,bodyLength:(me=c.body)==null?void 0:me.length,tags:c.tags}),console.log("🖥️ Environment check - is_tauri:",i);let Y=`# ${c.title}

`;Y+=`**Source:** Terraphim Search
`,Y+=`**Rank:** ${c.rank||"N/A"}
`,c.url&&(Y+=`**URL:** ${c.url}
`),c.tags&&c.tags.length>0&&(Y+=`**Tags:** ${c.tags.join(", ")}
`),Y+=`**Downloaded:** ${new Date().toISOString()}

`,c.description&&(Y+=`## Description

${c.description}

`),Y+=`## Content

${c.body}
`;const oe=`${c.title.replace(/[^a-z0-9]/gi,"_").toLowerCase()}_${Date.now()}.md`;try{if(i){const{save:G}=await Pl(()=>Promise.resolve().then(()=>gi),void 0),{writeTextFile:j}=await Pl(()=>import("./fs-60daa36d.js"),["assets/fs-60daa36d.js","assets/vendor-ui-ec1c326c.js","assets/vendor-ui-5061ae11.css","assets/vendor-utils-8620e3e4.js","assets/vendor-editor-5741781d.js","assets/vendor-editor-461b9769.css","assets/vendor-atomic-ec100559.js","assets/novel-editor-ff46bbca.js","assets/novel-editor-62d29ffc.css","assets/vendor-charts-e6a4a6c9.js"]);console.log("💾 Using Tauri save dialog...");const X=await G({filters:[{name:"Markdown",extensions:["md"]}],defaultPath:oe});X?(await j(X,Y),console.log("✅ File saved via Tauri:",X)):console.log("❌ Save dialog cancelled")}else{console.log("🌐 Using browser download fallback...");const G=new Blob([Y],{type:"text/markdown;charset=utf-8"}),j=URL.createObjectURL(G),X=document.createElement("a");X.href=j,X.download=oe,document.body.appendChild(X),X.click(),document.body.removeChild(X),URL.revokeObjectURL(j),console.log("✅ File downloaded via browser:",oe)}}catch(G){console.error("❌ Download failed:",G),console.log("🔄 Falling back to browser download...");const j=new Blob([Y],{type:"text/markdown;charset=utf-8"}),X=URL.createObjectURL(j),ue=document.createElement("a");ue.href=X,ue.download=oe,c.body.appendChild(ue),ue.click(),c.body.removeChild(ue),URL.revokeObjectURL(X),console.log("✅ Fallback download completed:",oe)}}function le(){console.log("🔄 Opening URL in new tab and article modal..."),c.url&&(console.log("🔗 Opening URL in new tab:",c.url),window.open(c.url,"_blank")),setTimeout(()=>{console.log("📖 Opening article modal..."),D()},100)}async function F(){console.log("📝 Adding document to LLM context:",c.title),R=!0,I=!1,t(13,N=null);try{let Y=null;if(i){try{const j=await He("list_conversations");if(console.log("📋 Available conversations:",j),j!=null&&j.conversations&&j.conversations.length>0)Y=j.conversations[0].id,console.log("🎯 Using existing conversation:",Y);else{const X=await He("create_conversation",{title:"Search Context",role:r||"default"});if(X.status==="success"&&X.conversation_id)Y=X.conversation_id,console.log("🆕 Created new conversation:",Y);else throw new Error("Failed to create conversation: "+(X.error||"Unknown error"))}}catch(j){throw console.error("❌ Failed to manage conversations:",j),new Error("Could not create or find conversation: "+j.message)}const me={source_type:"document",document_id:c.id};c.url&&(me.url=c.url),c.tags&&c.tags.length>0&&(me.tags=c.tags.join(", ")),c.rank!==void 0&&(me.rank=c.rank.toString());const G=await He("add_context_to_conversation",{conversationId:Y,contextType:"document",title:c.title,content:c.body,metadata:me});console.log("✅ Document added to context via Tauri:",G)}else{const me=ct.ServerURL;try{const ue=await fetch(`${me}/conversations`);if(ue.ok){const ge=await ue.json();if(ge.conversations&&ge.conversations.length>0)Y=ge.conversations[0].id,console.log("🎯 Using existing conversation:",Y);else{const ae=await fetch(`${me}/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"Search Context",role:r||"default"})});if(ae.ok){const pe=await ae.json();if(pe.status==="success"&&pe.conversation_id)Y=pe.conversation_id,console.log("🆕 Created new conversation:",Y);else throw new Error("Failed to create conversation: "+(pe.error||"Unknown error"))}else throw new Error(`Failed to create conversation: ${ae.status} ${ae.statusText}`)}}else throw new Error(`Failed to list conversations: ${ue.status} ${ue.statusText}`)}catch(ue){throw console.error("❌ Failed to manage conversations:",ue),new Error("Could not create or find conversation: "+ue.message)}const G=`${me}/conversations/${Y}/context`,j=await fetch(G,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context_type:"document",title:c.title,content:c.body,metadata:{source_type:"document",document_id:c.id,url:c.url||"",tags:c.tags?c.tags.join(", "):"",rank:c.rank?c.rank.toString():"0"}})});if(!j.ok)throw new Error(`HTTP error! Status: ${j.status} - ${j.statusText}`);const X=await j.json();console.log("✅ Document added to context via HTTP:",X)}console.log("✅ Successfully added document to LLM context"),I=!0;const oe=window.document.createElement("div");oe.className="notification is-success is-light",oe.innerHTML=`
        <button class="delete" onclick="this.parentElement.remove()"></button>
        <strong>✓ Added to Chat Context</strong><br>
        <small>Document added successfully. <a href="/chat" class="has-text-success has-text-weight-bold">Go to Chat →</a> to see it in the context panel.</small>
      `,oe.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(oe),setTimeout(()=>{oe.remove()},8e3),setTimeout(()=>{I=!1},5e3)}catch(Y){console.error("❌ Error adding document to context:",Y),t(13,N=Y.message||"Failed to add document to context");const oe=window.document.createElement("div");oe.className="notification is-danger is-light",oe.innerHTML=`
        <button class="delete" onclick="this.parentElement.remove()"></button>
        <strong>✗ Failed to Add Context</strong><br>
        <small>${N}</small>
      `,oe.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(oe),setTimeout(()=>{oe.remove()},8e3),setTimeout(()=>{t(13,N=null)},5e3)}finally{R=!1}}async function U(){console.log("💬 Adding document to context and opening chat:",c.title),E=!0,O=!1,t(13,N=null);try{let Y=null;if(i){try{const j=await He("list_conversations");if(console.log("📋 Available conversations:",j),j!=null&&j.conversations&&j.conversations.length>0)Y=j.conversations[0].id,console.log("🎯 Using existing conversation:",Y);else{const X=await He("create_conversation",{title:"Chat with Documents",role:r||"default"});if(X.status==="success"&&X.conversation_id)Y=X.conversation_id,console.log("🆕 Created new conversation:",Y);else throw new Error("Failed to create conversation: "+(X.error||"Unknown error"))}}catch(j){throw console.error("❌ Failed to manage conversations:",j),new Error("Could not create or find conversation: "+j.message)}const me={source_type:"document",document_id:c.id};c.url&&(me.url=c.url),c.tags&&c.tags.length>0&&(me.tags=c.tags.join(", ")),c.rank!==void 0&&(me.rank=c.rank.toString());const G=await He("add_context_to_conversation",{conversationId:Y,contextType:"document",title:c.title,content:c.body,metadata:me});console.log("✅ Document added to context via Tauri:",G)}else{const me=ct.ServerURL;try{const ue=await fetch(`${me}/conversations`);if(ue.ok){const ge=await ue.json();if(ge.conversations&&ge.conversations.length>0)Y=ge.conversations[0].id,console.log("🎯 Using existing conversation:",Y);else{const ae=await fetch(`${me}/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"Chat with Documents",role:r||"default"})});if(ae.ok){const pe=await ae.json();if(pe.status==="success"&&pe.conversation_id)Y=pe.conversation_id,console.log("🆕 Created new conversation:",Y);else throw new Error("Failed to create conversation: "+(pe.error||"Unknown error"))}else throw new Error(`Failed to create conversation: ${ae.status} ${ae.statusText}`)}}else throw new Error(`Failed to list conversations: ${ue.status} ${ue.statusText}`)}catch(ue){throw console.error("❌ Failed to manage conversations:",ue),new Error("Could not create or find conversation: "+ue.message)}const G=`${me}/conversations/${Y}/context`,j=await fetch(G,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context_type:"document",title:c.title,content:c.body,metadata:{source_type:"document",document_id:c.id,url:c.url||"",tags:c.tags?c.tags.join(", "):"",rank:c.rank?c.rank.toString():"0"}})});if(!j.ok)throw new Error(`HTTP error! Status: ${j.status} - ${j.statusText}`);const X=await j.json();console.log("✅ Document added to context via HTTP:",X)}console.log("✅ Successfully added document to chat context, navigating to chat..."),O=!0;const oe=window.document.createElement("div");oe.className="notification is-success is-light",oe.innerHTML=`
        <strong>💬 Opening Chat with Document</strong><br>
        <small>Context added successfully. Redirecting to chat...</small>
      `,oe.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(oe),setTimeout(()=>{oe.remove(),ui.goto("/chat")},1500),setTimeout(()=>{O=!1},2e3)}catch(Y){console.error("❌ Error adding document to context and opening chat:",Y),t(13,N=Y.message||"Failed to add document to context");const oe=window.document.createElement("div");oe.className="notification is-danger is-light",oe.innerHTML=`
        <button class="delete" onclick="this.parentElement.remove()"></button>
        <strong>✗ Failed to Open Chat with Document</strong><br>
        <small>${N}</small>
      `,oe.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(oe),setTimeout(()=>{oe.remove()},8e3),setTimeout(()=>{t(13,N=null)},5e3)}finally{E=!1}}Ql[r]!==void 0&&(console.log("Have attribute",Ql[r]),Ql[r].hasOwnProperty("enableLogseq")?console.log("enable logseq True"):console.log("Didn't make it"));const P=Y=>te(Y),L=()=>{t(10,w=null),ne()},H=()=>t(11,$=!1),K=()=>{ne()},V=()=>t(13,N=null);function ie(Y){p=Y,t(1,p)}function re(Y){d=Y,t(2,d)}function ye(Y){m=Y,t(3,m)}return l.$$set=Y=>{"item"in Y&&t(0,c=Y.item)},t(14,n=Z()),t(15,o=Q()),[c,p,d,m,_,g,h,v,y,k,w,$,C,N,n,o,D,te,ne,P,L,H,K,V,ie,re,ye]}class Ca extends Pt{constructor(e){super(),Ut(this,e,ya,wa,Ot,{item:0},null,[-1,-1])}}const _i="/assets/terraphim_gray.png";function Bl(l){const e=l.trim();if(!e)return{hasOperator:!1,operator:null,terms:[l],originalQuery:l};const t=/\b(AND)\b/,n=/\b(OR)\b/,o=/\b(and)\b/i,r=/\b(or)\b/i,i=t.test(e),u=n.test(e),c=o.test(e)&&!i,p=r.test(e)&&!u;if(i&&!u)return{hasOperator:!0,operator:"AND",terms:e.split(t).filter((m,_)=>_%2===0).map(m=>m.trim()).filter(m=>m.length>0),originalQuery:l};if(u&&!i)return{hasOperator:!0,operator:"OR",terms:e.split(n).filter((m,_)=>_%2===0).map(m=>m.trim()).filter(m=>m.length>0),originalQuery:l};if(i&&u){const d=e.indexOf(" AND "),m=e.indexOf(" OR ");if(d!==-1&&(m===-1||d<m))return{hasOperator:!0,operator:"AND",terms:e.split(/\s+(?:AND|OR)\s+/i).map(g=>g.trim()).filter(g=>g.length>0),originalQuery:l};if(m!==-1)return{hasOperator:!0,operator:"OR",terms:e.split(/\s+(?:AND|OR)\s+/i).map(g=>g.trim()).filter(g=>g.length>0),originalQuery:l}}if(c&&!p)return{hasOperator:!0,operator:"AND",terms:e.split(o).filter((m,_)=>_%2===0).map(m=>m.trim()).filter(m=>m.length>0),originalQuery:l};if(p&&!c)return{hasOperator:!0,operator:"OR",terms:e.split(r).filter((m,_)=>_%2===0).map(m=>m.trim()).filter(m=>m.length>0),originalQuery:l};if(c&&p){const d=e.toLowerCase().indexOf(" and "),m=e.toLowerCase().indexOf(" or ");if(d!==-1&&(m===-1||d<m))return{hasOperator:!0,operator:"AND",terms:e.split(/\s+(?:and|or)\s+/i).map(g=>g.trim()).filter(g=>g.length>0),originalQuery:l};if(m!==-1)return{hasOperator:!0,operator:"OR",terms:e.split(/\s+(?:and|or)\s+/i).map(g=>g.trim()).filter(g=>g.length>0),originalQuery:l}}return{hasOperator:!1,operator:null,terms:[e],originalQuery:l}}function Sa(l,e){var n,o;if(l.hasOperator&&l.terms.length>1){const r=l.terms.filter(i=>i.trim().length>0);if(r.length>1)return{search_term:r[0],search_terms:r,operator:(n=l.operator)==null?void 0:n.toLowerCase(),skip:0,limit:50,role:e||null}}return{search_term:((o=l.terms[0])==null?void 0:o.trim())||"",search_terms:void 0,operator:void 0,skip:0,limit:50,role:e||null}}function uo(l,e,t){const n=l.slice();return n[46]=e[t],n}function fo(l,e,t){const n=l.slice();return n[49]=e[t],n[51]=t,n}function po(l,e,t){const n=l.slice();return n[52]=e[t],n[51]=t,n}function mo(l){let e,t=l[3],n=[];for(let o=0;o<t.length;o+=1)n[o]=_o(po(l,t,o));return{c(){e=f("ul");for(let o=0;o<n.length;o+=1)n[o].c();a(e,"class","suggestions svelte-sfnt4t")},m(o,r){T(o,e,r);for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(e,null)},p(o,r){if(r[0]&4120){t=o[3];let i;for(i=0;i<t.length;i+=1){const u=po(o,t,i);n[i]?n[i].p(u,r):(n[i]=_o(u),n[i].c(),n[i].m(e,null))}for(;i<n.length;i+=1)n[i].d(1);n.length=t.length}},d(o){o&&S(e),_t(n,o)}}}function _o(l){let e,t=l[52]+"",n,o,r,i,u,c;function p(){return l[20](l[52])}function d(...m){return l[21](l[52],...m)}return{c(){e=f("li"),n=M(t),o=b(),a(e,"tabindex","0"),a(e,"role","option"),a(e,"aria-selected",r=l[51]===l[4]),a(e,"aria-label",i=`Apply suggestion: ${l[52]}`),a(e,"class","svelte-sfnt4t"),vt(e,"active",l[51]===l[4])},m(m,_){T(m,e,_),s(e,n),s(e,o),u||(c=[ee(e,"click",p),ee(e,"keydown",d)],u=!0)},p(m,_){l=m,_[0]&8&&t!==(t=l[52]+"")&&ce(n,t),_[0]&16&&r!==(r=l[51]===l[4])&&a(e,"aria-selected",r),_[0]&8&&i!==(i=`Apply suggestion: ${l[52]}`)&&a(e,"aria-label",i),_[0]&16&&vt(e,"active",l[51]===l[4])},d(m){m&&S(e),u=!1,st(c)}}}function go(l){let e,t,n,o,r,i,u;return t=new cn({props:{$$slots:{default:[Ra]},$$scope:{ctx:l}}}),{c(){e=f("div"),be(t.$$.fragment),n=b(),o=f("button"),o.textContent="Clear all",a(o,"type","button"),a(o,"class","clear-terms-btn svelte-sfnt4t"),a(e,"class","selected-terms-section svelte-sfnt4t")},m(c,p){T(c,e,p),ke(t,e,null),s(e,n),s(e,o),r=!0,i||(u=ee(o,"click",l[14]),i=!0)},p(c,p){const d={};p[0]&96|p[1]&8388608&&(d.$$scope={dirty:p,ctx:c}),t.$set(d)},i(c){r||(W(t.$$.fragment,c),r=!0)},o(c){x(t.$$.fragment,c),r=!1},d(c){c&&S(e),we(t),i=!1,u()}}}function Ta(l){let e=l[49].value+"",t,n,o,r,i,u,c;function p(){return l[22](l[49])}return{c(){t=M(e),n=b(),o=f("button"),r=M("×"),a(o,"class","remove-tag-btn svelte-sfnt4t"),a(o,"aria-label",i=`Remove term: ${l[49].value}`)},m(d,m){T(d,t,m),T(d,n,m),T(d,o,m),s(o,r),u||(c=ee(o,"click",Vl(p)),u=!0)},p(d,m){l=d,m[0]&32&&e!==(e=l[49].value+"")&&ce(t,e),m[0]&32&&i!==(i=`Remove term: ${l[49].value}`)&&a(o,"aria-label",i)},d(d){d&&S(t),d&&S(n),d&&S(o),u=!1,c()}}}function ho(l){let e,t,n,o;return t=new ml({props:{class:"operator-tag",rounded:!0,$$slots:{default:[$a]},$$scope:{ctx:l}}}),{c(){e=f("div"),be(t.$$.fragment),n=b(),a(e,"class","operator-tag-wrapper svelte-sfnt4t")},m(r,i){T(r,e,i),ke(t,e,null),s(e,n),o=!0},p(r,i){const u={};i[0]&64|i[1]&8388608&&(u.$$scope={dirty:i,ctx:r}),t.$set(u)},i(r){o||(W(t.$$.fragment,r),o=!0)},o(r){x(t.$$.fragment,r),o=!1},d(r){r&&S(e),we(t)}}}function $a(l){let e=(l[6]||"AND")+"",t;return{c(){t=M(e)},m(n,o){T(n,t,o)},p(n,o){o[0]&64&&e!==(e=(n[6]||"AND")+"")&&ce(t,e)},d(n){n&&S(t)}}}function vo(l){let e,t,n,o,r;function i(){return l[23](l[49])}t=new ml({props:{rounded:!0,title:"Click to remove term",$$slots:{default:[Ta]},$$scope:{ctx:l}}}),t.$on("click",i);let u=l[51]<l[5].length-1&&ho(l);return{c(){e=f("div"),be(t.$$.fragment),n=b(),u&&u.c(),o=St(),a(e,"class","term-tag-wrapper svelte-sfnt4t"),vt(e,"from-kg",l[49].isFromKG)},m(c,p){T(c,e,p),ke(t,e,null),T(c,n,p),u&&u.m(c,p),T(c,o,p),r=!0},p(c,p){l=c;const d={};p[0]&32|p[1]&8388608&&(d.$$scope={dirty:p,ctx:l}),t.$set(d),(!r||p[0]&32)&&vt(e,"from-kg",l[49].isFromKG),l[51]<l[5].length-1?u?(u.p(l,p),p[0]&32&&W(u,1)):(u=ho(l),u.c(),W(u,1),u.m(o.parentNode,o)):u&&(We(),x(u,1,1,()=>{u=null}),Je())},i(c){r||(W(t.$$.fragment,c),W(u),r=!0)},o(c){x(t.$$.fragment,c),x(u),r=!1},d(c){c&&S(e),we(t),c&&S(n),u&&u.d(c),c&&S(o)}}}function Ra(l){let e,t,n=l[5],o=[];for(let i=0;i<n.length;i+=1)o[i]=vo(fo(l,n,i));const r=i=>x(o[i],1,1,()=>{o[i]=null});return{c(){for(let i=0;i<o.length;i+=1)o[i].c();e=St()},m(i,u){for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(i,u);T(i,e,u),t=!0},p(i,u){if(u[0]&8288){n=i[5];let c;for(c=0;c<n.length;c+=1){const p=fo(i,n,c);o[c]?(o[c].p(p,u),W(o[c],1)):(o[c]=vo(p),o[c].c(),W(o[c],1),o[c].m(e.parentNode,e))}for(We(),c=n.length;c<o.length;c+=1)r(c);Je()}},i(i){if(!t){for(let u=0;u<n.length;u+=1)W(o[u]);t=!0}},o(i){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)x(o[u]);t=!1},d(i){_t(o,i),i&&S(e)}}}function bo(l){let e,t,n,o;return{c(){e=f("div"),t=f("button"),t.textContent="Parse Terms",a(t,"type","button"),a(t,"class","button is-small is-info"),a(e,"class","search-hint-container svelte-sfnt4t")},m(r,i){T(r,e,i),s(e,t),n||(o=ee(t,"click",l[24]),n=!0)},p:$e,d(r){r&&S(e),n=!1,o()}}}function La(l){let e,t,n,o,r,i,u,c=l[0]&&(l[0].includes(" AND ")||l[0].includes(" OR "))&&l[5].length===0,p;function d(v){l[19](v)}let m={type:"search",placeholder:l[8]?`Search over Knowledge graph for ${l[7]}`:"Search",icon:"search",expanded:!0,autofocus:!0};l[0]!==void 0&&(m.value=l[0]),n=new bl({props:m}),mt.push(()=>kt(n,"value",d)),n.$on("click",l[15]),n.$on("submit",l[15]),n.$on("keydown",l[11]),n.$on("input",l[10]);let _=l[3].length>0&&mo(l),g=l[5].length>0&&go(l),h=c&&bo(l);return{c(){e=f("div"),t=f("div"),be(n.$$.fragment),r=b(),_&&_.c(),i=b(),g&&g.c(),u=b(),h&&h.c(),a(t,"class","input-wrapper svelte-sfnt4t"),a(e,"class","search-row svelte-sfnt4t")},m(v,y){T(v,e,y),s(e,t),ke(n,t,null),s(t,r),_&&_.m(t,null),s(e,i),g&&g.m(e,null),s(e,u),h&&h.m(e,null),p=!0},p(v,y){const k={};y[0]&384&&(k.placeholder=v[8]?`Search over Knowledge graph for ${v[7]}`:"Search"),!o&&y[0]&1&&(o=!0,k.value=v[0],wt(()=>o=!1)),n.$set(k),v[3].length>0?_?_.p(v,y):(_=mo(v),_.c(),_.m(t,null)):_&&(_.d(1),_=null),v[5].length>0?g?(g.p(v,y),y[0]&32&&W(g,1)):(g=go(v),g.c(),W(g,1),g.m(e,u)):g&&(We(),x(g,1,1,()=>{g=null}),Je()),y[0]&33&&(c=v[0]&&(v[0].includes(" AND ")||v[0].includes(" OR "))&&v[5].length===0),c?h?h.p(v,y):(h=bo(v),h.c(),h.m(e,null)):h&&(h.d(1),h=null)},i(v){p||(W(n.$$.fragment,v),W(g),p=!0)},o(v){x(n.$$.fragment,v),x(g),p=!1},d(v){v&&S(e),we(n),_&&_.d(),g&&g.d(),h&&h.d()}}}function Ea(l){let e,t,n,o,r,i,u,c,p,d;return{c(){e=f("section"),t=f("div"),n=f("img"),r=b(),i=f("p"),i.textContent="I am Terraphim, your personal assistant.",u=b(),c=f("button"),c.innerHTML=`<span class="icon"><i class="fas fa-magic"></i></span> 
        <span>Configuration Wizard</span>`,ii(n.src,o=_i)||a(n,"src",o),a(n,"alt","Terraphim Logo"),a(n,"class","svelte-sfnt4t"),a(c,"class","button is-primary"),a(c,"data-testid","wizard-start"),a(t,"class","content has-text-grey has-text-centered svelte-sfnt4t"),a(e,"class","section")},m(m,_){T(m,e,_),s(e,t),s(t,n),s(t,r),s(t,i),s(t,u),s(t,c),p||(d=ee(c,"click",l[25]),p=!0)},p:$e,i:$e,o:$e,d(m){m&&S(e),p=!1,d()}}}function Aa(l){let e,t,n=l[1],o=[];for(let i=0;i<n.length;i+=1)o[i]=ko(uo(l,n,i));const r=i=>x(o[i],1,1,()=>{o[i]=null});return{c(){for(let i=0;i<o.length;i+=1)o[i].c();e=St()},m(i,u){for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(i,u);T(i,e,u),t=!0},p(i,u){if(u[0]&2){n=i[1];let c;for(c=0;c<n.length;c+=1){const p=uo(i,n,c);o[c]?(o[c].p(p,u),W(o[c],1)):(o[c]=ko(p),o[c].c(),W(o[c],1),o[c].m(e.parentNode,e))}for(We(),c=n.length;c<o.length;c+=1)r(c);Je()}},i(i){if(!t){for(let u=0;u<n.length;u+=1)W(o[u]);t=!0}},o(i){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)x(o[u]);t=!1},d(i){_t(o,i),i&&S(e)}}}function Da(l){let e,t;return{c(){e=f("p"),t=M(l[2]),a(e,"class","error svelte-sfnt4t")},m(n,o){T(n,e,o),s(e,t)},p(n,o){o[0]&4&&ce(t,n[2])},i:$e,o:$e,d(n){n&&S(e)}}}function ko(l){let e,t;return e=new Ca({props:{item:l[46]}}),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},p(n,o){const r={};o[0]&2&&(r.item=n[46]),e.$set(r)},i(n){t||(W(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function Na(l){let e,t,n,o,r,i,u,c,p;t=new dl({props:{$$slots:{default:[La]},$$scope:{ctx:l}}});const d=[Da,Aa,Ea],m=[];function _(g,h){return g[2]?0:g[1].length?1:2}return o=_(l),r=m[o]=d[o](l),{c(){e=f("form"),be(t.$$.fragment),n=b(),r.c(),i=St()},m(g,h){T(g,e,h),ke(t,e,null),T(g,n,h),m[o].m(g,h),T(g,i,h),u=!0,c||(p=ee(e,"submit",Ii(l[15])),c=!0)},p(g,h){const v={};h[0]&505|h[1]&8388608&&(v.$$scope={dirty:h,ctx:g}),t.$set(v);let y=o;o=_(g),o===y?m[o].p(g,h):(We(),x(m[y],1,1,()=>{m[y]=null}),Je(),r=m[o],r?r.p(g,h):(r=m[o]=d[o](g),r.c()),W(r,1),r.m(i.parentNode,i))},i(g){u||(W(t.$$.fragment,g),W(r),u=!0)},o(g){x(t.$$.fragment,g),x(r),u=!1},d(g){g&&S(e),we(t),g&&S(n),m[o].d(g),g&&S(i),c=!1,p()}}}function Ia(l,e,t){let n,o,r,i,u,c,p;qe(l,xi,G=>t(29,o=G)),qe(l,fl,G=>t(0,r=G)),qe(l,bt,G=>t(30,i=G)),qe(l,$t,G=>t(7,u=G)),qe(l,Ol,G=>t(18,c=G)),qe(l,xt,G=>t(8,p=G));let d=[],m=null,_=[],g=-1,h=null,v=[],y=null,k=!1;function w(){return`terraphim:searchState:${u}`}function $(){try{if(typeof window>"u")return;const G=localStorage.getItem(w());if(!G)return;const j=JSON.parse(G);typeof j.input=="string"&&ol(fl,r=j.input,r),Array.isArray(j.results)&&t(1,d=j.results)}catch(G){console.warn("Failed to load search state:",G)}}function C(){try{if(typeof window>"u")return;const G={input:r,results:d};localStorage.setItem(w(),JSON.stringify(G))}catch(G){console.warn("Failed to save search state:",G)}}let R=null;vl(()=>{$()}),rn(()=>{R&&clearTimeout(R),h&&(h.close(),h=null),O()});function I(){if(i){E();return}h&&h.close();const j=`${o.replace("/documents/search","")}/summarization/stream`;try{h=new EventSource(j),h.onopen=()=>{console.log("SSE connection opened for summarization updates")},h.onmessage=X=>{try{const ue=JSON.parse(X.data);console.log("SSE received:",ue),ue.task_id&&ue.status==="completed"&&ue.summary&&Q(ue.task_id,ue.summary)}catch(ue){console.warn("Failed to parse SSE message:",ue)}},h.onerror=X=>{console.warn("SSE connection error:",X),setTimeout(()=>{h&&I()},5e3)}}catch(X){console.error("Failed to create SSE connection:",X)}}let N=null;function E(){console.log("Starting polling for summary updates (Tauri mode)"),N&&clearInterval(N),N=setInterval(async()=>{if(d.length!==0)try{const G=F();if(!G)return;const j=await He("search",{searchQuery:G});if(j.status==="success"){const X=j.results;let ue=!1;for(let ae=0;ae<Math.min(d.length,X.length);ae++)!d[ae].summarization&&X[ae].summarization&&(ue=!0,console.log(`New AI summary found for document: ${X[ae].title}`));ue&&(t(1,d=X),console.log("Updated results with new AI summaries"),C()),d.filter(ae=>!ae.summarization&&ae.body&&ae.body.length>500).length===0&&(console.log("All summaries complete, stopping polling"),O())}}catch(G){console.error("Error during summary polling:",G)}},2e3),setTimeout(()=>{N&&(console.log("Stopping summary polling after timeout"),O())},3e4)}function O(){N&&(clearInterval(N),N=null)}function Q(G,j){t(1,d=d.map(X=>!X.summarization&&X.body&&X.body.length>500?{...X,summarization:j}:X)),console.log(`Updated document summary for task ${G}:`,j),C()}function Z(G){const j=Bl(G);if(j.hasOperator&&j.terms.length>1){const X=j.terms.map(ae=>{const pe=n.some(([_e])=>_e.toLowerCase()===ae.toLowerCase());return{value:ae,isFromKG:pe}}),ue=v.map(ae=>ae.value),ge=X.map(ae=>ae.value);(JSON.stringify(ue)!==JSON.stringify(ge)||y!==j.operator)&&(t(5,v=X),t(6,y=j.operator))}else j.terms.length===1&&v.length>0?(t(5,v=[]),t(6,y=null)):j.terms.length===0&&(t(5,v=[]),t(6,y=null))}async function D(G){try{if(i){const j=await He("get_autocomplete_suggestions",{query:G,roleName:u,limit:8});if(j.status==="success"&&j.suggestions)return j.suggestions.map(X=>X.term)}else{const j=await fetch(`${o.replace("/documents/search","")}/autocomplete/${encodeURIComponent(u)}/${encodeURIComponent(G)}`);if(j.ok){const X=await j.json();if(X.status==="success"&&X.suggestions)return X.suggestions.map(ue=>ue.term)}}return n.filter(([j])=>j.toLowerCase().includes(G.toLowerCase())).map(([j])=>j).slice(0,8)}catch(j){return console.warn("Error fetching term suggestions:",j),[]}}async function A(G){const j=G.trim();if(j.length===0)return[];const ue=Bl(j),ge=j.split(/\s+/),ae=ge[ge.length-1].toLowerCase();if(ue.hasOperator&&ue.terms.length>0){const _e=ue.terms[ue.terms.length-1];return _e&&_e.length>=2?D(_e):[]}if(ge.length>1){const _e=[];if("and".startsWith(ae)&&_e.push("AND"),"or".startsWith(ae)&&_e.push("OR"),_e.length>0)return _e}const pe=j.toLowerCase();if(pe.includes(" and ")||pe.includes(" or ")||pe.includes(" AND ")||pe.includes(" OR ")){const _e=ae;return _e.length<2?[]:D(_e)}try{return(await D(j)).slice(0,7)}catch(_e){return console.warn("Error fetching autocomplete suggestions:",_e),n.filter(([Ve])=>Ve.toLowerCase().includes(j.toLowerCase())).map(([Ve])=>Ve).slice(0,5).slice(0,7)}}async function te(G){const j=G.target;if(!j||j.selectionStart==null)return;const X=j.selectionStart,ge=r.slice(0,X).split(/\s+/),ae=ge[ge.length-1];if(ae.toLowerCase()==="a"||ae.toLowerCase()==="an")t(3,_=["AND"]);else if(ae.toLowerCase()==="o"||ae.toLowerCase()==="or")t(3,_=["OR"]);else if(ae.length>=2)try{const pe=await A(ae);t(3,_=pe)}catch(pe){console.warn("Failed to get suggestions:",pe),t(3,_=[])}else t(3,_=[]);t(4,g=-1)}function ne(G){_.length>0?G.key==="ArrowDown"?(G.preventDefault(),t(4,g=(g+1)%_.length)):G.key==="ArrowUp"?(G.preventDefault(),t(4,g=(g-1+_.length)%_.length)):(G.key==="Enter"||G.key==="Tab")&&g!==-1?(G.preventDefault(),le(_[g])):G.key==="Escape"&&(G.preventDefault(),t(3,_=[]),t(4,g=-1)):G.key==="Enter"&&(G.preventDefault(),B())}function B(){Z(r),K()}function le(G){if(G==="AND"||G==="OR"){t(6,y=G);const j=Bl(r);j.terms.length>0&&!v.some(X=>X.value===j.terms[j.terms.length-1])&&U(j.terms[j.terms.length-1]),ol(fl,r=r+` ${G} `,r)}else{const j=r.trim().split(/\s+/),X=j[j.length-1];G.toLowerCase().startsWith(X.toLowerCase())?(j[j.length-1]=G,ol(fl,r=j.join(" "),r)):U(G,y)}t(3,_=[]),t(4,g=-1)}function F(){const G=r.trim();if(!G)return null;const j=Bl(G);return{...Sa(j,u),skip:0,limit:10}}function U(G,j=null){const X=n.some(([ue])=>ue.toLowerCase()===G.toLowerCase());v.some(ue=>ue.value.toLowerCase()===G.toLowerCase())||(t(5,v=[...v,{value:G,isFromKG:X}]),j&&v.length>1&&t(6,y=j),L(),C())}function P(G){t(5,v=v.filter(j=>j.value!==G)),L(),C()}function L(){if(t(16,k=!0),v.length===0)ol(fl,r="",r),t(6,y=null);else if(v.length===1)ol(fl,r=v[0].value,r),t(6,y=null);else{const G=y||"AND";ol(fl,r=v.map(j=>j.value).join(` ${G} `),r)}setTimeout(()=>{t(16,k=!1)},10)}function H(){t(5,v=[]),t(6,y=null),ol(fl,r="",r),C()}async function K(){if(t(2,m=null),i){if(!r.trim())return;try{const G=F();if(!G)return;const j=await He("search",{searchQuery:G});j.status==="success"?(t(1,d=j.results),console.log("Response results"),console.log(d),C()):(t(2,m=`Search failed: ${j.status}`),console.error("Search failed:",j))}catch(G){t(2,m=`Error in Tauri search: ${G}`),console.error("Error in Tauri search:",G)}}else{if(!r.trim())return;const G=F();if(!G)return;const j=JSON.stringify(G);try{const X=await fetch(o,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:j}),ue=await X.json();if(!X.ok)throw new Error(`HTTP error! Status: ${X.status}`);t(1,d=ue.results),C(),I()}catch(X){console.error("Error fetching data:",X),t(2,m=`Error fetching data: ${X}`)}}}function V(G){r=G,fl.set(r)}const ie=G=>le(G),re=(G,j)=>{(j.key==="Enter"||j.key===" ")&&(j.preventDefault(),le(G))},ye=G=>P(G.value),Y=G=>P(G.value),oe=()=>Z(r),me=()=>window.location.href="/config/wizard";return l.$$.update=()=>{l.$$.dirty[0]&262144&&(n=Object.entries(c)),l.$$.dirty[0]&196609&&r&&!k&&(r.includes(" AND ")||r.includes(" OR ")||r.includes(" and ")||r.includes(" or "))&&(R&&clearTimeout(R),t(17,R=setTimeout(()=>{Z(r),t(17,R=null)},300)))},[r,d,m,_,g,v,y,u,p,Z,te,ne,le,P,H,K,k,R,c,V,ie,re,ye,Y,oe,me]}class Oa extends Pt{constructor(e){super(),Ut(this,e,Ia,Na,Ot,{},null,[-1,-1])}}async function on(l={}){return typeof l=="object"&&Object.freeze(l),Tl({__tauriModule:"Dialog",message:{cmd:"openDialog",options:l}})}async function Ma(l={}){return typeof l=="object"&&Object.freeze(l),Tl({__tauriModule:"Dialog",message:{cmd:"saveDialog",options:l}})}async function Pa(l,e){var t,n;const o=typeof e=="string"?{title:e}:e;return Tl({__tauriModule:"Dialog",message:{cmd:"messageDialog",message:l.toString(),title:(t=o==null?void 0:o.title)===null||t===void 0?void 0:t.toString(),type:o==null?void 0:o.type,buttonLabel:(n=o==null?void 0:o.okLabel)===null||n===void 0?void 0:n.toString()}})}async function Ua(l,e){var t,n,o,r,i;const u=typeof e=="string"?{title:e}:e;return Tl({__tauriModule:"Dialog",message:{cmd:"askDialog",message:l.toString(),title:(t=u==null?void 0:u.title)===null||t===void 0?void 0:t.toString(),type:u==null?void 0:u.type,buttonLabels:[(o=(n=u==null?void 0:u.okLabel)===null||n===void 0?void 0:n.toString())!==null&&o!==void 0?o:"Yes",(i=(r=u==null?void 0:u.cancelLabel)===null||r===void 0?void 0:r.toString())!==null&&i!==void 0?i:"No"]}})}async function ja(l,e){var t,n,o,r,i;const u=typeof e=="string"?{title:e}:e;return Tl({__tauriModule:"Dialog",message:{cmd:"confirmDialog",message:l.toString(),title:(t=u==null?void 0:u.title)===null||t===void 0?void 0:t.toString(),type:u==null?void 0:u.type,buttonLabels:[(o=(n=u==null?void 0:u.okLabel)===null||n===void 0?void 0:n.toString())!==null&&o!==void 0?o:"Ok",(i=(r=u==null?void 0:u.cancelLabel)===null||r===void 0?void 0:r.toString())!==null&&i!==void 0?i:"Cancel"]}})}const gi=Object.freeze(Object.defineProperty({__proto__:null,ask:Ua,confirm:ja,message:Pa,open:on,save:Ma},Symbol.toStringTag,{value:"Module"}));function wo(l,e,t){const n=l.slice();return n[72]=e[t],n[80]=t,n}function yo(l,e,t){const n=l.slice();return n[78]=e[t],n[79]=e,n[80]=t,n}function Co(l,e,t){const n=l.slice();return n[81]=e[t],n}function So(l,e,t){const n=l.slice();return n[81]=e[t],n}function To(l,e,t){const n=l.slice();return n[86]=e[t],n[87]=e,n[88]=t,n}function $o(l,e,t){const n=l.slice();return n[89]=e[t][0],n[90]=e[t][1],n[91]=e,n[92]=t,n}function Ro(l,e,t){const n=l.slice();return n[75]=e[t],n}function Lo(l,e,t){const n=l.slice();return n[72]=e[t],n}function Eo(l,e,t){const n=l.slice();return n[75]=e[t],n}function Ao(l){let e,t,n,o,r;return{c(){e=f("div"),t=f("button"),n=M(`
      Configuration saved successfully!`),a(t,"class","delete"),a(e,"class","notification is-success"),a(e,"data-testid","wizard-success")},m(i,u){T(i,e,u),s(e,t),s(e,n),o||(r=ee(t,"click",l[20]),o=!0)},p:$e,d(i){i&&S(e),o=!1,r()}}}function Do(l){let e,t,n,o,r;return{c(){e=f("div"),t=f("button"),n=M(`
      Failed to save configuration. Please try again.`),a(t,"class","delete"),a(e,"class","notification is-danger"),a(e,"data-testid","wizard-error")},m(i,u){T(i,e,u),s(e,t),s(e,n),o||(r=ee(t,"click",l[21]),o=!0)},p:$e,d(i){i&&S(e),o=!1,r()}}}function Ha(l){let e,t,n,o,r,i,u,c,p,d=l[3].id+"",m,_,g,h,v,y=l[3].global_shortcut+"",k,w,$,C,R,I=l[3].default_theme+"",N,E,O,Q,Z,D=l[3].default_role+"",A,te,ne,B,le,F,U=JSON.stringify(l[3],null,2)+"",P,L=l[3].roles,H=[];for(let K=0;K<L.length;K+=1)H[K]=No(wo(l,L,K));return{c(){e=f("h4"),e.textContent="Review",t=b(),n=f("div"),o=f("h5"),o.textContent="Configuration Summary:",r=b(),i=f("ul"),u=f("li"),c=f("strong"),c.textContent="Configuration ID:",p=b(),m=M(d),_=b(),g=f("li"),h=f("strong"),h.textContent="Global Shortcut:",v=b(),k=M(y),w=b(),$=f("li"),C=f("strong"),C.textContent="Default Theme:",R=b(),N=M(I),E=b(),O=f("li"),Q=f("strong"),Q.textContent="Default Role:",Z=b(),A=M(D),te=b(),ne=f("h5"),ne.textContent="Roles:",B=b();for(let K=0;K<H.length;K+=1)H[K].c();le=b(),F=f("pre"),P=M(U),a(e,"class","title is-5"),a(n,"class","content"),Te(F,"max-height","300px"),Te(F,"overflow","auto")},m(K,V){T(K,e,V),T(K,t,V),T(K,n,V),s(n,o),s(n,r),s(n,i),s(i,u),s(u,c),s(u,p),s(u,m),s(i,_),s(i,g),s(g,h),s(g,v),s(g,k),s(i,w),s(i,$),s($,C),s($,R),s($,N),s(i,E),s(i,O),s(O,Q),s(O,Z),s(O,A),s(n,te),s(n,ne),s(n,B);for(let ie=0;ie<H.length;ie+=1)H[ie]&&H[ie].m(n,null);T(K,le,V),T(K,F,V),s(F,P)},p(K,V){if(V[0]&8&&d!==(d=K[3].id+"")&&ce(m,d),V[0]&8&&y!==(y=K[3].global_shortcut+"")&&ce(k,y),V[0]&8&&I!==(I=K[3].default_theme+"")&&ce(N,I),V[0]&8&&D!==(D=K[3].default_role+"")&&ce(A,D),V[0]&10){L=K[3].roles;let ie;for(ie=0;ie<L.length;ie+=1){const re=wo(K,L,ie);H[ie]?H[ie].p(re,V):(H[ie]=No(re),H[ie].c(),H[ie].m(n,null))}for(;ie<H.length;ie+=1)H[ie].d(1);H.length=L.length}V[0]&8&&U!==(U=JSON.stringify(K[3],null,2)+"")&&ce(P,U)},d(K){K&&S(e),K&&S(t),K&&S(n),_t(H,K),K&&S(le),K&&S(F)}}}function Fa(l){let e,t,n=[],o=new Map,r,i,u,c,p=l[3].roles;const d=m=>m[78].name;for(let m=0;m<p.length;m+=1){let _=yo(l,p,m),g=d(_);o.set(g,n[m]=Bo(g,_))}return{c(){e=f("h4"),e.textContent="Roles",t=b();for(let m=0;m<n.length;m+=1)n[m].c();r=b(),i=f("button"),i.textContent="Add Role",a(e,"class","title is-5"),a(i,"class","button is-link is-light"),a(i,"data-testid","add-role")},m(m,_){T(m,e,_),T(m,t,_);for(let g=0;g<n.length;g+=1)n[g]&&n[g].m(m,_);T(m,r,_),T(m,i,_),u||(c=ee(i,"click",l[12]),u=!0)},p(m,_){_[0]&516985&&(p=m[3].roles,n=ai(n,_,d,1,m,p,o,r.parentNode,ci,Bo,r,yo))},d(m){m&&S(e),m&&S(t);for(let _=0;_<n.length;_+=1)n[_].d(m);m&&S(r),m&&S(i),u=!1,c()}}}function za(l){let e,t,n,o,r,i,u,c,p,d,m,_,g,h,v,y,k,w,$,C,R,I,N,E,O,Q,Z,D,A,te,ne,B=l[8],le=[];for(let P=0;P<B.length;P+=1)le[P]=Qo(Eo(l,B,P));let F=l[3].roles,U=[];for(let P=0;P<F.length;P+=1)U[P]=Vo(Lo(l,F,P));return{c(){e=f("div"),t=f("label"),t.textContent="Configuration ID",n=b(),o=f("div"),r=f("div"),i=f("select"),u=f("option"),u.textContent="Desktop",c=f("option"),c.textContent="Server",p=f("option"),p.textContent="Embedded",d=b(),m=f("div"),_=f("label"),_.textContent="Global shortcut",g=b(),h=f("div"),v=f("input"),y=b(),k=f("div"),w=f("label"),w.textContent="Default theme",$=b(),C=f("div"),R=f("div"),I=f("select");for(let P=0;P<le.length;P+=1)le[P].c();N=b(),E=f("div"),O=f("label"),O.textContent="Default Role",Q=b(),Z=f("div"),D=f("div"),A=f("select");for(let P=0;P<U.length;P+=1)U[P].c();a(t,"class","label"),a(t,"for","config-id"),u.__value="Desktop",u.value=u.__value,c.__value="Server",c.value=c.__value,p.__value="Embedded",p.value=p.__value,a(i,"id","config-id"),l[3].id===void 0&&It(()=>l[22].call(i)),a(r,"class","select"),a(o,"class","control"),a(e,"class","field"),a(_,"class","label"),a(_,"for","global-shortcut"),a(v,"class","input"),a(v,"id","global-shortcut"),a(v,"type","text"),a(h,"class","control"),a(m,"class","field"),a(w,"class","label"),a(w,"for","default-theme"),a(I,"id","default-theme"),l[3].default_theme===void 0&&It(()=>l[24].call(I)),a(R,"class","select is-fullwidth"),a(C,"class","control"),a(k,"class","field"),a(O,"class","label"),a(O,"for","default-role"),a(A,"id","default-role"),l[3].default_role===void 0&&It(()=>l[25].call(A)),a(D,"class","select"),a(Z,"class","control"),a(E,"class","field")},m(P,L){T(P,e,L),s(e,t),s(e,n),s(e,o),s(o,r),s(r,i),s(i,u),s(i,c),s(i,p),rt(i,l[3].id,!0),T(P,d,L),T(P,m,L),s(m,_),s(m,g),s(m,h),s(h,v),Pe(v,l[3].global_shortcut),T(P,y,L),T(P,k,L),s(k,w),s(k,$),s(k,C),s(C,R),s(R,I);for(let H=0;H<le.length;H+=1)le[H]&&le[H].m(I,null);rt(I,l[3].default_theme,!0),T(P,N,L),T(P,E,L),s(E,O),s(E,Q),s(E,Z),s(Z,D),s(D,A);for(let H=0;H<U.length;H+=1)U[H]&&U[H].m(A,null);rt(A,l[3].default_role,!0),te||(ne=[ee(i,"change",l[22]),ee(v,"input",l[23]),ee(I,"change",l[24]),ee(A,"change",l[25])],te=!0)},p(P,L){if(L[0]&264&&rt(i,P[3].id),L[0]&264&&v.value!==P[3].global_shortcut&&Pe(v,P[3].global_shortcut),L[0]&256){B=P[8];let H;for(H=0;H<B.length;H+=1){const K=Eo(P,B,H);le[H]?le[H].p(K,L):(le[H]=Qo(K),le[H].c(),le[H].m(I,null))}for(;H<le.length;H+=1)le[H].d(1);le.length=B.length}if(L[0]&264&&rt(I,P[3].default_theme),L[0]&8){F=P[3].roles;let H;for(H=0;H<F.length;H+=1){const K=Lo(P,F,H);U[H]?U[H].p(K,L):(U[H]=Vo(K),U[H].c(),U[H].m(A,null))}for(;H<U.length;H+=1)U[H].d(1);U.length=F.length}L[0]&264&&rt(A,P[3].default_role)},d(P){P&&S(e),P&&S(d),P&&S(m),P&&S(y),P&&S(k),_t(le,P),P&&S(N),P&&S(E),_t(U,P),te=!1,st(ne)}}}function No(l){let e,t,n=l[72].name+"",o,r,i,u,c,p=l[72].shortname+"",d,m,_,g,h,v=l[72].theme+"",y,k,w,$,C,R=l[72].relevance_function+"",I,N,E,O,Q,Z;return{c(){e=f("div"),t=f("h6"),o=M(n),r=b(),i=f("p"),u=f("strong"),u.textContent="Shortname:",c=b(),d=M(p),m=b(),_=f("p"),g=f("strong"),g.textContent="Theme:",h=b(),y=M(v),k=b(),w=f("p"),$=f("strong"),$.textContent="Relevance Function:",C=b(),I=M(R),N=b(),E=f("button"),E.textContent="Edit Role",O=b(),a(t,"data-testid","review-role-name-"+l[80]),a(E,"class","button is-small"),a(E,"data-testid","edit-role-"+l[80]),a(e,"class","box")},m(D,A){T(D,e,A),s(e,t),s(t,o),s(e,r),s(e,i),s(i,u),s(i,c),s(i,d),s(e,m),s(e,_),s(_,g),s(_,h),s(_,y),s(e,k),s(e,w),s(w,$),s(w,C),s(w,I),s(e,N),s(e,E),s(e,O),Q||(Z=ee(E,"click",l[69]),Q=!0)},p(D,A){A[0]&8&&n!==(n=D[72].name+"")&&ce(o,n),A[0]&8&&p!==(p=D[72].shortname+"")&&ce(d,p),A[0]&8&&v!==(v=D[72].theme+"")&&ce(y,v),A[0]&8&&R!==(R=D[72].relevance_function+"")&&ce(I,R)},d(D){D&&S(e),Q=!1,Z()}}}function Io(l){let e,t=l[75]+"",n;return{c(){e=f("option"),n=M(t),e.__value=l[75],e.value=e.__value},m(o,r){T(o,e,r),s(e,n)},p:$e,d(o){o&&S(e)}}}function Ka(l){let e;return{c(){e=M("Directory Path")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function Ga(l){let e;return{c(){e=M("Server URL")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function Oo(l){let e;return{c(){e=f("p"),e.textContent="Click to select directory",a(e,"class","help")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function Mo(l){let e,t,n,o,r,i,u,c,p,d,m,_;function g(){l[34].call(u,l[80],l[88])}return{c(){e=f("div"),t=f("label"),n=M("Atomic Server Secret"),r=b(),i=f("div"),u=f("input"),p=b(),d=f("p"),d.textContent="Leave empty for anonymous access",a(t,"class","label"),a(t,"for",o=`haystack-secret-${l[80]}-${l[88]}`),a(u,"class","input"),a(u,"id",c=`haystack-secret-${l[80]}-${l[88]}`),a(u,"type","password"),a(u,"placeholder","Base64 encoded secret (optional)"),a(i,"class","control"),a(d,"class","help"),a(e,"class","field")},m(h,v){T(h,e,v),s(e,t),s(t,n),s(e,r),s(e,i),s(i,u),Pe(u,l[3].roles[l[80]].haystacks[l[88]].atomic_server_secret),s(e,p),s(e,d),m||(_=ee(u,"input",g),m=!0)},p(h,v){l=h,v[0]&264&&o!==(o=`haystack-secret-${l[80]}-${l[88]}`)&&a(t,"for",o),v[0]&264&&c!==(c=`haystack-secret-${l[80]}-${l[88]}`)&&a(u,"id",c),v[0]&264&&u.value!==l[3].roles[l[80]].haystacks[l[88]].atomic_server_secret&&Pe(u,l[3].roles[l[80]].haystacks[l[88]].atomic_server_secret)},d(h){h&&S(e),m=!1,_()}}}function Po(l){let e,t,n,o,r,i,u,c,p,d,m,_,g,h,v,y,k,w,$,C,R,I,N,E,O,Q,Z,D,A,te,ne,B,le,F,U,P,L,H,K,V,ie,re,ye;function Y(){l[35].call(d,l[80],l[88])}function oe(...ge){return l[36](l[80],l[88],...ge)}let me=Object.entries(l[3].roles[l[80]].haystacks[l[88]].extra_parameters||{}),G=[];for(let ge=0;ge<me.length;ge+=1)G[ge]=Uo($o(l,me,ge));function j(){return l[40](l[80],l[88])}function X(){return l[41](l[80],l[88])}function ue(){return l[42](l[80],l[88])}return{c(){e=f("div"),t=f("label"),t.textContent="Extra Parameters (for filtering)",n=b(),o=f("div"),r=f("div"),i=f("label"),u=M("Hashtag"),p=b(),d=f("input"),_=b(),g=f("div"),h=f("div"),v=f("label"),y=M("Presets"),w=b(),$=f("div"),C=f("select"),R=f("option"),R.textContent="(choose)",I=f("option"),I.textContent="#rust",N=f("option"),N.textContent="#docs",E=f("option"),E.textContent="#test",O=f("option"),O.textContent="#todo",Z=b(),D=f("p"),D.innerHTML="When set, searches will enforce the hashtag alongside your query (AND), e.g. <code>-e &quot;search&quot; -e &quot;#rust&quot;</code>.",A=b();for(let ge=0;ge<G.length;ge+=1)G[ge].c();te=b(),ne=f("div"),B=f("div"),le=f("button"),le.textContent="+ Tag Filter",F=b(),U=f("div"),P=f("button"),P.textContent="+ Max Results",L=b(),H=f("div"),K=f("button"),K.textContent="+ Custom Parameter",V=b(),ie=f("p"),ie.innerHTML=`Common parameters: <code>tag</code> (e.g., &quot;#rust&quot;), <code>glob</code> (e.g., &quot;*.md&quot;),
                  <code>max_count</code> (e.g., &quot;10&quot;), <code>context</code> (e.g., &quot;5&quot;)`,a(t,"class","label"),a(i,"class","label"),a(i,"for",c=`ripgrep-hashtag-${l[80]}-${l[88]}`),a(d,"class","input"),a(d,"id",m=`ripgrep-hashtag-${l[80]}-${l[88]}`),a(d,"type","text"),a(d,"placeholder","#rust"),a(r,"class","control"),a(o,"class","field is-grouped"),a(v,"class","label"),a(v,"for",k=`ripgrep-hashtag-preset-${l[80]}-${l[88]}`),R.__value="",R.value=R.__value,I.__value="#rust",I.value=I.__value,N.__value="#docs",N.value=N.__value,E.__value="#test",E.value=E.__value,O.__value="#todo",O.value=O.__value,a(C,"id",Q=`ripgrep-hashtag-preset-${l[80]}-${l[88]}`),a($,"class","select is-small"),a(h,"class","control"),a(g,"class","field is-grouped"),Te(g,"margin-bottom",".5rem"),a(D,"class","help"),a(le,"class","button is-small is-link is-light"),a(B,"class","control"),a(P,"class","button is-small is-link is-light"),a(U,"class","control"),a(K,"class","button is-small is-link is-light"),a(H,"class","control"),a(ne,"class","field is-grouped"),a(ie,"class","help"),a(e,"class","field")},m(ge,ae){T(ge,e,ae),s(e,t),s(e,n),s(e,o),s(o,r),s(r,i),s(i,u),s(r,p),s(r,d),Pe(d,l[3].roles[l[80]].haystacks[l[88]].extra_parameters.tag),s(e,_),s(e,g),s(g,h),s(h,v),s(v,y),s(h,w),s(h,$),s($,C),s(C,R),s(C,I),s(C,N),s(C,E),s(C,O),s(e,Z),s(e,D),s(e,A);for(let pe=0;pe<G.length;pe+=1)G[pe]&&G[pe].m(e,null);s(e,te),s(e,ne),s(ne,B),s(B,le),s(ne,F),s(ne,U),s(U,P),s(ne,L),s(ne,H),s(H,K),s(e,V),s(e,ie),re||(ye=[ee(d,"input",Y),ee(C,"change",oe),ee(le,"click",j),ee(P,"click",X),ee(K,"click",ue)],re=!0)},p(ge,ae){if(l=ge,ae[0]&264&&c!==(c=`ripgrep-hashtag-${l[80]}-${l[88]}`)&&a(i,"for",c),ae[0]&264&&m!==(m=`ripgrep-hashtag-${l[80]}-${l[88]}`)&&a(d,"id",m),ae[0]&264&&d.value!==l[3].roles[l[80]].haystacks[l[88]].extra_parameters.tag&&Pe(d,l[3].roles[l[80]].haystacks[l[88]].extra_parameters.tag),ae[0]&264&&k!==(k=`ripgrep-hashtag-preset-${l[80]}-${l[88]}`)&&a(v,"for",k),ae[0]&264&&Q!==(Q=`ripgrep-hashtag-preset-${l[80]}-${l[88]}`)&&a(C,"id",Q),ae[0]&393224){me=Object.entries(l[3].roles[l[80]].haystacks[l[88]].extra_parameters||{});let pe;for(pe=0;pe<me.length;pe+=1){const _e=$o(l,me,pe);G[pe]?G[pe].p(_e,ae):(G[pe]=Uo(_e),G[pe].c(),G[pe].m(e,te))}for(;pe<G.length;pe+=1)G[pe].d(1);G.length=me.length}},d(ge){ge&&S(e),_t(G,ge),re=!1,st(ye)}}}function Uo(l){let e,t,n,o,r,i,u,c,p,d,m,_,g;function h(...k){return l[37](l[80],l[88],l[89],...k)}function v(){l[38].call(u,l[80],l[88],l[89])}function y(){return l[39](l[80],l[88],l[89])}return{c(){e=f("div"),t=f("div"),n=f("input"),r=b(),i=f("div"),u=f("input"),c=b(),p=f("div"),d=f("button"),d.textContent="×",m=b(),a(n,"class","input"),a(n,"type","text"),a(n,"placeholder","Parameter name"),n.value=o=l[89],a(t,"class","control"),a(u,"class","input"),a(u,"type","text"),a(u,"placeholder","Parameter value"),a(i,"class","control is-expanded"),a(d,"class","button is-small is-danger"),a(p,"class","control"),a(e,"class","field is-grouped")},m(k,w){T(k,e,w),s(e,t),s(t,n),s(e,r),s(e,i),s(i,u),Pe(u,l[3].roles[l[80]].haystacks[l[88]].extra_parameters[l[89]]),s(e,c),s(e,p),s(p,d),s(e,m),_||(g=[ee(n,"blur",h),ee(u,"input",v),ee(d,"click",y)],_=!0)},p(k,w){l=k,w[0]&264&&o!==(o=l[89])&&n.value!==o&&(n.value=o),w[0]&264&&u.value!==l[3].roles[l[80]].haystacks[l[88]].extra_parameters[l[89]]&&Pe(u,l[3].roles[l[80]].haystacks[l[88]].extra_parameters[l[89]])},d(k){k&&S(e),_=!1,st(g)}}}function jo(l){let e,t,n,o,r,i,u,c,p,d,m,_,g,h,v,y,k,w,$,C,R,I,N,E,O,Q,Z,D,A,te,ne,B,le,F,U,P,L,H,K,V,ie,re,ye,Y,oe,me,G,j,X,ue;function ge(){l[31].call(p,l[80],l[88])}function ae(Ke,Ue){return Ke[3].roles[Ke[80]].haystacks[Ke[88]].service==="Atomic"?Ga:Ka}let pe=ae(l),_e=pe(l);function Re(){l[32].call($,l[80],l[88])}function Ve(){return l[33](l[80],l[88])}let Be=l[4]&&l[3].roles[l[80]].haystacks[l[88]].service!=="Atomic"&&Oo(),Le=l[3].roles[l[80]].haystacks[l[88]].service==="Atomic"&&Mo(l),Ee=l[3].roles[l[80]].haystacks[l[88]].service==="Ripgrep"&&Po(l);function he(){l[43].call(A,l[80],l[88])}function Ae(){l[44].call(V,l[80],l[88])}function Ye(){return l[45](l[80],l[88])}return{c(){e=f("div"),t=f("div"),n=f("label"),o=M("Service Type"),i=b(),u=f("div"),c=f("div"),p=f("select"),d=f("option"),d.textContent="Ripgrep (File Search)",m=f("option"),m.textContent="Atomic Server",g=b(),h=f("div"),v=f("label"),_e.c(),k=b(),w=f("div"),$=f("input"),N=b(),Be&&Be.c(),E=b(),Le&&Le.c(),O=b(),Ee&&Ee.c(),Q=b(),Z=f("div"),D=f("label"),A=f("input"),ne=M(`
                 Read-only`),le=b(),F=f("div"),U=f("label"),P=M("Ranking Weight"),H=b(),K=f("div"),V=f("input"),re=b(),ye=f("p"),ye.textContent="Weight for ranking results (1.0 = normal, >1.0 = higher priority, <1.0 = lower priority)",Y=b(),oe=f("div"),me=f("button"),G=M("Remove Haystack"),a(n,"class","label"),a(n,"for",r=`haystack-service-${l[80]}-${l[88]}`),d.__value="Ripgrep",d.value=d.__value,m.__value="Atomic",m.value=m.__value,a(p,"id",_=`haystack-service-${l[80]}-${l[88]}`),l[3].roles[l[80]].haystacks[l[88]].service===void 0&&It(ge),a(c,"class","select"),a(u,"class","control"),a(t,"class","field"),a(v,"class","label"),a(v,"for",y=`haystack-path-${l[80]}-${l[88]}`),a($,"class","input"),a($,"id",C=`haystack-path-${l[80]}-${l[88]}`),a($,"type","text"),a($,"placeholder",R=l[3].roles[l[80]].haystacks[l[88]].service==="Atomic"?"https://localhost:9883":"/path/to/documents"),$.readOnly=I=l[4]&&l[3].roles[l[80]].haystacks[l[88]].service!=="Atomic",a(w,"class","control"),a(h,"class","field"),a(A,"id",te=`haystack-readonly-${l[80]}-${l[88]}`),a(A,"type","checkbox"),a(D,"class","checkbox"),a(D,"for",B=`haystack-readonly-${l[80]}-${l[88]}`),a(Z,"class","field"),a(U,"class","label"),a(U,"for",L=`haystack-weight-${l[80]}-${l[88]}`),a(V,"class","input"),a(V,"id",ie=`haystack-weight-${l[80]}-${l[88]}`),a(V,"type","number"),a(V,"min","0"),a(V,"max","10"),a(V,"step","0.1"),a(V,"placeholder","1.0"),a(K,"class","control"),a(ye,"class","help"),a(F,"class","field"),a(me,"class","button is-small is-danger"),a(me,"data-testid",j="remove-haystack-"+l[80]+"-"+l[88]),a(oe,"class","field"),a(e,"class","box is-light")},m(Ke,Ue){T(Ke,e,Ue),s(e,t),s(t,n),s(n,o),s(t,i),s(t,u),s(u,c),s(c,p),s(p,d),s(p,m),rt(p,l[3].roles[l[80]].haystacks[l[88]].service,!0),s(e,g),s(e,h),s(h,v),_e.m(v,null),s(h,k),s(h,w),s(w,$),Pe($,l[3].roles[l[80]].haystacks[l[88]].path),s(w,N),Be&&Be.m(w,null),s(e,E),Le&&Le.m(e,null),s(e,O),Ee&&Ee.m(e,null),s(e,Q),s(e,Z),s(Z,D),s(D,A),A.checked=l[3].roles[l[80]].haystacks[l[88]].read_only,s(D,ne),s(e,le),s(e,F),s(F,U),s(U,P),s(F,H),s(F,K),s(K,V),Pe(V,l[3].roles[l[80]].haystacks[l[88]].weight),s(F,re),s(F,ye),s(e,Y),s(e,oe),s(oe,me),s(me,G),X||(ue=[ee(p,"change",ge),ee($,"input",Re),ee($,"click",function(){jl(l[4]&&l[3].roles[l[80]].haystacks[l[88]].service!=="Atomic"?Ve:void 0)&&(l[4]&&l[3].roles[l[80]].haystacks[l[88]].service!=="Atomic"?Ve:void 0).apply(this,arguments)}),ee(A,"change",he),ee(V,"input",Ae),ee(me,"click",Ye)],X=!0)},p(Ke,Ue){l=Ke,Ue[0]&264&&r!==(r=`haystack-service-${l[80]}-${l[88]}`)&&a(n,"for",r),Ue[0]&264&&_!==(_=`haystack-service-${l[80]}-${l[88]}`)&&a(p,"id",_),Ue[0]&264&&rt(p,l[3].roles[l[80]].haystacks[l[88]].service),pe!==(pe=ae(l))&&(_e.d(1),_e=pe(l),_e&&(_e.c(),_e.m(v,null))),Ue[0]&264&&y!==(y=`haystack-path-${l[80]}-${l[88]}`)&&a(v,"for",y),Ue[0]&264&&C!==(C=`haystack-path-${l[80]}-${l[88]}`)&&a($,"id",C),Ue[0]&264&&R!==(R=l[3].roles[l[80]].haystacks[l[88]].service==="Atomic"?"https://localhost:9883":"/path/to/documents")&&a($,"placeholder",R),Ue[0]&280&&I!==(I=l[4]&&l[3].roles[l[80]].haystacks[l[88]].service!=="Atomic")&&($.readOnly=I),Ue[0]&264&&$.value!==l[3].roles[l[80]].haystacks[l[88]].path&&Pe($,l[3].roles[l[80]].haystacks[l[88]].path),l[4]&&l[3].roles[l[80]].haystacks[l[88]].service!=="Atomic"?Be||(Be=Oo(),Be.c(),Be.m(w,null)):Be&&(Be.d(1),Be=null),l[3].roles[l[80]].haystacks[l[88]].service==="Atomic"?Le?Le.p(l,Ue):(Le=Mo(l),Le.c(),Le.m(e,O)):Le&&(Le.d(1),Le=null),l[3].roles[l[80]].haystacks[l[88]].service==="Ripgrep"?Ee?Ee.p(l,Ue):(Ee=Po(l),Ee.c(),Ee.m(e,Q)):Ee&&(Ee.d(1),Ee=null),Ue[0]&264&&te!==(te=`haystack-readonly-${l[80]}-${l[88]}`)&&a(A,"id",te),Ue[0]&264&&(A.checked=l[3].roles[l[80]].haystacks[l[88]].read_only),Ue[0]&264&&B!==(B=`haystack-readonly-${l[80]}-${l[88]}`)&&a(D,"for",B),Ue[0]&264&&L!==(L=`haystack-weight-${l[80]}-${l[88]}`)&&a(U,"for",L),Ue[0]&264&&ie!==(ie=`haystack-weight-${l[80]}-${l[88]}`)&&a(V,"id",ie),Ue[0]&264&&ri(V.value)!==l[3].roles[l[80]].haystacks[l[88]].weight&&Pe(V,l[3].roles[l[80]].haystacks[l[88]].weight),Ue[0]&264&&j!==(j="remove-haystack-"+l[80]+"-"+l[88])&&a(me,"data-testid",j)},d(Ke){Ke&&S(e),_e.d(),Be&&Be.d(),Le&&Le.d(),Ee&&Ee.d(),X=!1,st(ue)}}}function Ho(l){var U;let e,t,n,o,r,i,u,c,p,d,m,_,g,h,v,y,k,w,$,C,R,I,N,E,O,Q,Z,D,A;function te(){l[48].call(u,l[80])}function ne(){return l[49](l[80])}let B=((U=l[0][l[80]])==null?void 0:U.length)&&Fo(l);function le(){l[51].call($,l[80])}function F(){l[52].call(E,l[80])}return{c(){e=f("div"),t=f("label"),n=M("Model"),r=b(),i=f("div"),u=f("input"),p=b(),d=f("button"),d.textContent="Fetch models",m=b(),B&&B.c(),_=b(),g=f("div"),h=f("label"),v=M("Base URL"),k=b(),w=f("div"),$=f("input"),R=b(),I=f("div"),N=f("label"),E=f("input"),Q=M(`
               Automatically summarize search results`),a(t,"class","label"),a(t,"for",o=`llm-model-${l[80]}`),a(u,"class","input"),a(u,"id",c=`llm-model-${l[80]}`),a(u,"type","text"),a(u,"placeholder","llama3.1"),a(i,"class","control"),a(d,"class","button is-small"),a(e,"class","field"),a(h,"class","label"),a(h,"for",y=`llm-base-url-${l[80]}`),a($,"class","input"),a($,"id",C=`llm-base-url-${l[80]}`),a($,"type","text"),a($,"placeholder","http://127.0.0.1:11434"),a(w,"class","control"),a(g,"class","field"),a(E,"id",O=`llm-auto-summarize-${l[80]}`),a(E,"type","checkbox"),a(N,"class","checkbox"),a(N,"for",Z=`llm-auto-summarize-${l[80]}`),a(I,"class","field")},m(P,L){T(P,e,L),s(e,t),s(t,n),s(e,r),s(e,i),s(i,u),Pe(u,l[3].roles[l[80]].llm_model),s(e,p),s(e,d),s(e,m),B&&B.m(e,null),T(P,_,L),T(P,g,L),s(g,h),s(h,v),s(g,k),s(g,w),s(w,$),Pe($,l[3].roles[l[80]].llm_base_url),T(P,R,L),T(P,I,L),s(I,N),s(N,E),E.checked=l[3].roles[l[80]].llm_auto_summarize,s(N,Q),D||(A=[ee(u,"input",te),ee(d,"click",ne),ee($,"input",le),ee(E,"change",F)],D=!0)},p(P,L){var H;l=P,L[0]&264&&o!==(o=`llm-model-${l[80]}`)&&a(t,"for",o),L[0]&264&&c!==(c=`llm-model-${l[80]}`)&&a(u,"id",c),L[0]&264&&u.value!==l[3].roles[l[80]].llm_model&&Pe(u,l[3].roles[l[80]].llm_model),(H=l[0][l[80]])!=null&&H.length?B?B.p(l,L):(B=Fo(l),B.c(),B.m(e,null)):B&&(B.d(1),B=null),L[0]&264&&y!==(y=`llm-base-url-${l[80]}`)&&a(h,"for",y),L[0]&264&&C!==(C=`llm-base-url-${l[80]}`)&&a($,"id",C),L[0]&264&&$.value!==l[3].roles[l[80]].llm_base_url&&Pe($,l[3].roles[l[80]].llm_base_url),L[0]&264&&O!==(O=`llm-auto-summarize-${l[80]}`)&&a(E,"id",O),L[0]&264&&(E.checked=l[3].roles[l[80]].llm_auto_summarize),L[0]&264&&Z!==(Z=`llm-auto-summarize-${l[80]}`)&&a(N,"for",Z)},d(P){P&&S(e),B&&B.d(),P&&S(_),P&&S(g),P&&S(R),P&&S(I),D=!1,st(A)}}}function Fo(l){let e,t,n,o,r=l[0][l[80]],i=[];for(let c=0;c<r.length;c+=1)i[c]=zo(So(l,r,c));function u(...c){return l[50](l[80],...c)}return{c(){e=f("div"),t=f("select");for(let c=0;c<i.length;c+=1)i[c].c();a(e,"class","select is-fullwidth"),Te(e,"margin-top","0.5rem")},m(c,p){T(c,e,p),s(e,t);for(let d=0;d<i.length;d+=1)i[d]&&i[d].m(t,null);n||(o=ee(t,"change",u),n=!0)},p(c,p){if(l=c,p[0]&9){r=l[0][l[80]];let d;for(d=0;d<r.length;d+=1){const m=So(l,r,d);i[d]?i[d].p(m,p):(i[d]=zo(m),i[d].c(),i[d].m(t,null))}for(;d<i.length;d+=1)i[d].d(1);i.length=r.length}},d(c){c&&S(e),_t(i,c),n=!1,o()}}}function zo(l){let e,t=l[81]+"",n,o;return{c(){e=f("option"),n=M(t),e.__value=o=l[81],e.value=e.__value},m(r,i){T(r,e,i),s(e,n)},p(r,i){i[0]&9&&t!==(t=r[81]+"")&&ce(n,t),i[0]&265&&o!==(o=r[81])&&(e.__value=o,e.value=e.__value)},d(r){r&&S(e)}}}function Ko(l){var ae;let e,t,n,o,r,i,u,c,p,d,m,_,g,h,v,y,k,w,$,C,R,I,N,E,O,Q,Z,D,A,te,ne,B,le,F,U,P,L,H,K,V,ie,re,ye,Y;function oe(){l[54].call(u,l[80])}function me(){l[55].call(w,l[80])}function G(){return l[56](l[80])}let j=((ae=l[0][l[80]])==null?void 0:ae.length)&&Go(l);function X(){l[58].call(D,l[80])}function ue(){l[59].call(L,l[80])}let ge=l[3].roles[l[80]].openrouter_chat_enabled&&Wo(l);return{c(){e=f("div"),t=f("label"),n=M("OpenRouter API Key"),r=b(),i=f("div"),u=f("input"),p=b(),d=f("p"),d.innerHTML='Get your API key from <a href="https://openrouter.ai" target="_blank" rel="noopener">OpenRouter</a>',m=b(),_=f("div"),g=f("label"),h=M("Model"),y=b(),k=f("div"),w=f("input"),C=b(),R=f("button"),R.textContent="Fetch models",I=b(),j&&j.c(),N=b(),E=f("p"),E.textContent="Choose the language model for generating summaries. Different models offer different speed/quality tradeoffs.",O=b(),Q=f("div"),Z=f("label"),D=f("input"),te=M(`
               Automatically summarize search results`),B=b(),le=f("p"),le.textContent="When enabled, summaries will be generated and shown in search results.",F=b(),U=f("div"),P=f("label"),L=f("input"),K=M(`
               Enable Chat interface (OpenRouter)`),ie=b(),ge&&ge.c(),re=St(),a(t,"class","label"),a(t,"for",o=`openrouter-api-key-${l[80]}`),a(u,"class","input"),a(u,"id",c=`openrouter-api-key-${l[80]}`),a(u,"type","password"),a(u,"placeholder","sk-or-v1-..."),a(i,"class","control"),a(d,"class","help"),a(e,"class","field"),a(g,"class","label"),a(g,"for",v=`openrouter-model-${l[80]}`),a(w,"class","input"),a(w,"id",$=`openrouter-model-${l[80]}`),a(w,"type","text"),a(w,"placeholder","openai/gpt-4-turbo"),a(k,"class","control"),a(R,"class","button is-small"),a(E,"class","help"),a(_,"class","field"),a(D,"id",A=`openrouter-auto-summarize-${l[80]}`),a(D,"type","checkbox"),a(Z,"class","checkbox"),a(Z,"for",ne=`openrouter-auto-summarize-${l[80]}`),a(le,"class","help"),a(Q,"class","field"),a(L,"id",H=`openrouter-chat-enabled-${l[80]}`),a(L,"type","checkbox"),a(P,"class","checkbox"),a(P,"for",V=`openrouter-chat-enabled-${l[80]}`),a(U,"class","field")},m(pe,_e){T(pe,e,_e),s(e,t),s(t,n),s(e,r),s(e,i),s(i,u),Pe(u,l[3].roles[l[80]].openrouter_api_key),s(e,p),s(e,d),T(pe,m,_e),T(pe,_,_e),s(_,g),s(g,h),s(_,y),s(_,k),s(k,w),Pe(w,l[3].roles[l[80]].openrouter_model),s(_,C),s(_,R),s(_,I),j&&j.m(_,null),s(_,N),s(_,E),T(pe,O,_e),T(pe,Q,_e),s(Q,Z),s(Z,D),D.checked=l[3].roles[l[80]].openrouter_auto_summarize,s(Z,te),s(Q,B),s(Q,le),T(pe,F,_e),T(pe,U,_e),s(U,P),s(P,L),L.checked=l[3].roles[l[80]].openrouter_chat_enabled,s(P,K),T(pe,ie,_e),ge&&ge.m(pe,_e),T(pe,re,_e),ye||(Y=[ee(u,"input",oe),ee(w,"input",me),ee(R,"click",G),ee(D,"change",X),ee(L,"change",ue)],ye=!0)},p(pe,_e){var Re;l=pe,_e[0]&264&&o!==(o=`openrouter-api-key-${l[80]}`)&&a(t,"for",o),_e[0]&264&&c!==(c=`openrouter-api-key-${l[80]}`)&&a(u,"id",c),_e[0]&264&&u.value!==l[3].roles[l[80]].openrouter_api_key&&Pe(u,l[3].roles[l[80]].openrouter_api_key),_e[0]&264&&v!==(v=`openrouter-model-${l[80]}`)&&a(g,"for",v),_e[0]&264&&$!==($=`openrouter-model-${l[80]}`)&&a(w,"id",$),_e[0]&264&&w.value!==l[3].roles[l[80]].openrouter_model&&Pe(w,l[3].roles[l[80]].openrouter_model),(Re=l[0][l[80]])!=null&&Re.length?j?j.p(l,_e):(j=Go(l),j.c(),j.m(_,N)):j&&(j.d(1),j=null),_e[0]&264&&A!==(A=`openrouter-auto-summarize-${l[80]}`)&&a(D,"id",A),_e[0]&264&&(D.checked=l[3].roles[l[80]].openrouter_auto_summarize),_e[0]&264&&ne!==(ne=`openrouter-auto-summarize-${l[80]}`)&&a(Z,"for",ne),_e[0]&264&&H!==(H=`openrouter-chat-enabled-${l[80]}`)&&a(L,"id",H),_e[0]&264&&(L.checked=l[3].roles[l[80]].openrouter_chat_enabled),_e[0]&264&&V!==(V=`openrouter-chat-enabled-${l[80]}`)&&a(P,"for",V),l[3].roles[l[80]].openrouter_chat_enabled?ge?ge.p(l,_e):(ge=Wo(l),ge.c(),ge.m(re.parentNode,re)):ge&&(ge.d(1),ge=null)},d(pe){pe&&S(e),pe&&S(m),pe&&S(_),j&&j.d(),pe&&S(O),pe&&S(Q),pe&&S(F),pe&&S(U),pe&&S(ie),ge&&ge.d(pe),pe&&S(re),ye=!1,st(Y)}}}function Go(l){let e,t,n,o,r=l[0][l[80]],i=[];for(let c=0;c<r.length;c+=1)i[c]=qo(Co(l,r,c));function u(...c){return l[57](l[80],...c)}return{c(){e=f("div"),t=f("select");for(let c=0;c<i.length;c+=1)i[c].c();a(e,"class","select is-fullwidth"),Te(e,"margin-top","0.5rem")},m(c,p){T(c,e,p),s(e,t);for(let d=0;d<i.length;d+=1)i[d]&&i[d].m(t,null);n||(o=ee(t,"change",u),n=!0)},p(c,p){if(l=c,p[0]&9){r=l[0][l[80]];let d;for(d=0;d<r.length;d+=1){const m=Co(l,r,d);i[d]?i[d].p(m,p):(i[d]=qo(m),i[d].c(),i[d].m(t,null))}for(;d<i.length;d+=1)i[d].d(1);i.length=r.length}},d(c){c&&S(e),_t(i,c),n=!1,o()}}}function qo(l){let e,t=l[81]+"",n,o;return{c(){e=f("option"),n=M(t),e.__value=o=l[81],e.value=e.__value},m(r,i){T(r,e,i),s(e,n)},p(r,i){i[0]&9&&t!==(t=r[81]+"")&&ce(n,t),i[0]&265&&o!==(o=r[81])&&(e.__value=o,e.value=e.__value)},d(r){r&&S(e)}}}function Wo(l){let e,t,n,o,r,i,u,c,p,d,m,_,g,h,v,y,k,w,$,C,R,I,N,E,O;function Q(){l[60].call(c,l[80])}function Z(){l[61].call(I,l[80])}return{c(){e=f("div"),t=f("label"),n=M("Chat Model"),r=b(),i=f("div"),u=f("div"),c=f("select"),p=f("option"),p.textContent="GPT-3.5 Turbo",d=f("option"),d.textContent="GPT-4",m=f("option"),m.textContent="Claude 3 Sonnet",_=f("option"),_.textContent="Claude 3 Haiku",g=f("option"),g.textContent="Mixtral 8x7B",v=b(),y=f("div"),k=f("label"),w=M("System Prompt (optional)"),C=b(),R=f("div"),I=f("textarea"),a(t,"class","label"),a(t,"for",o=`openrouter-chat-model-${l[80]}`),p.__value="openai/gpt-3.5-turbo",p.value=p.__value,d.__value="openai/gpt-4",d.value=d.__value,m.__value="anthropic/claude-3-sonnet",m.value=m.__value,_.__value="anthropic/claude-3-haiku",_.value=_.__value,g.__value="mistralai/mixtral-8x7b-instruct",g.value=g.__value,a(c,"id",h=`openrouter-chat-model-${l[80]}`),l[3].roles[l[80]].openrouter_chat_model===void 0&&It(Q),a(u,"class","select is-fullwidth"),a(i,"class","control"),a(e,"class","field"),a(k,"class","label"),a(k,"for",$=`openrouter-chat-system-${l[80]}`),a(I,"class","textarea"),a(I,"id",N=`openrouter-chat-system-${l[80]}`),a(I,"rows","3"),a(I,"placeholder","You are a helpful Rust engineer assistant..."),a(R,"class","control"),a(y,"class","field")},m(D,A){T(D,e,A),s(e,t),s(t,n),s(e,r),s(e,i),s(i,u),s(u,c),s(c,p),s(c,d),s(c,m),s(c,_),s(c,g),rt(c,l[3].roles[l[80]].openrouter_chat_model,!0),T(D,v,A),T(D,y,A),s(y,k),s(k,w),s(y,C),s(y,R),s(R,I),Pe(I,l[3].roles[l[80]].openrouter_chat_system_prompt),E||(O=[ee(c,"change",Q),ee(I,"input",Z)],E=!0)},p(D,A){l=D,A[0]&264&&o!==(o=`openrouter-chat-model-${l[80]}`)&&a(t,"for",o),A[0]&264&&h!==(h=`openrouter-chat-model-${l[80]}`)&&a(c,"id",h),A[0]&264&&rt(c,l[3].roles[l[80]].openrouter_chat_model),A[0]&264&&$!==($=`openrouter-chat-system-${l[80]}`)&&a(k,"for",$),A[0]&264&&N!==(N=`openrouter-chat-system-${l[80]}`)&&a(I,"id",N),A[0]&264&&Pe(I,l[3].roles[l[80]].openrouter_chat_system_prompt)},d(D){D&&S(e),D&&S(v),D&&S(y),E=!1,st(O)}}}function Jo(l){let e;return{c(){e=f("p"),e.textContent="Click to select directory",a(e,"class","help")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function Bo(l,e){let t,n,o,r,i,u,c,p,d,m,_,g,h,v,y,k,w,$,C,R,I,N,E,O,Q,Z,D,A,te,ne,B,le,F,U,P,L,H,K,V,ie,re,ye,Y,oe,me,G,j,X,ue,ge,ae,pe,_e,Re,Ve,Be,Le,Ee,he,Ae,Ye,Ke,Ue,Ne,ze,tt,dt,Ze,Qe,pt,Fe,nt,Xe,z,J,se,Oe,Ie,Ce,ot,et,lt,yt,at,Rt,Bt,Qt,Tt,Vt,ll,it,q,fe,ve,Se,Ge,Me,ut,Lt,tl,jt,Dt,Et,Nl,Ht,Nt,At,Mt,Fl,kl,_l,al,Ct,de,De,Yt,Ft,nl,gt,wl,fn,$l,gl,cl,zl,dn,Kl,pn,yl,ul,Gl,mn,ql,_n,gn,hn,Cl,vn,Wl,Xl,bn;function vi(){e[26].call(p,e[80])}function bi(){e[27].call(w,e[80])}let Rl=e[8],zt=[];for(let ft=0;ft<Rl.length;ft+=1)zt[ft]=Io(Ro(e,Rl,ft));function kn(){e[28].call(D,e[80])}function wn(){e[29].call(H,e[80])}function ki(){e[30].call(j,e[80])}let Ll=e[78].haystacks,Kt=[];for(let ft=0;ft<Ll.length;ft+=1)Kt[ft]=jo(To(e,Ll,ft));function wi(){return e[46](e[80])}function yn(){e[47].call(Ze,e[80])}let Gt=e[3].roles[e[80]].llm_provider==="ollama"&&Ho(e);function yi(){e[53].call(et,e[80])}let qt=e[3].roles[e[80]].openrouter_enabled&&Ko(e);function Ci(){e[62].call(Me,e[80])}function Si(){e[63].call(Nt,e[80])}function Cn(){return e[64](e[80])}let Zt=e[4]&&Jo();function Sn(){e[65].call(Ft,e[80])}function Ti(){e[66].call(cl,e[80])}function $i(){e[67].call(ul,e[80])}function Ri(){return e[68](e[80])}return{key:l,first:null,c(){t=f("div"),n=f("div"),o=f("label"),r=M("Role name"),u=b(),c=f("div"),p=f("input"),m=b(),_=f("div"),g=f("label"),h=M("Short name"),y=b(),k=f("div"),w=f("input"),C=b(),R=f("div"),I=f("label"),N=M("Theme"),O=b(),Q=f("div"),Z=f("div"),D=f("select");for(let ft=0;ft<zt.length;ft+=1)zt[ft].c();te=b(),ne=f("div"),B=f("label"),le=M("Relevance function"),U=b(),P=f("div"),L=f("div"),H=f("select"),K=f("option"),K.textContent="title-scorer",V=f("option"),V.textContent="terraphim-graph",ie=f("option"),ie.textContent="bm25",re=f("option"),re.textContent="bm25f",ye=f("option"),ye.textContent="bm25plus",oe=b(),me=f("div"),G=f("label"),j=f("input"),ue=M(`
            Enable Terraphim IT features (KG preprocessing, auto-linking)`),ae=b(),pe=f("h5"),pe.textContent="Haystacks",_e=b();for(let ft=0;ft<Kt.length;ft+=1)Kt[ft].c();Re=b(),Ve=f("button"),Be=M("Add Haystack"),Ee=b(),he=f("h5"),he.textContent="AI-Enhanced Summaries (LLM Provider)",Ae=b(),Ye=f("div"),Ke=f("label"),Ue=M("Provider"),ze=b(),tt=f("div"),dt=f("div"),Ze=f("select"),Qe=f("option"),Qe.textContent="(none)",pt=f("option"),pt.textContent="OpenRouter",Fe=f("option"),Fe.textContent="Ollama (local)",Xe=b(),z=f("p"),z.textContent="Choose a provider. OpenRouter uses API key; Ollama runs locally.",J=b(),Gt&&Gt.c(),se=b(),Oe=f("h5"),Oe.textContent="AI-Enhanced Summaries (OpenRouter)",Ie=b(),Ce=f("div"),ot=f("label"),et=f("input"),yt=M(`
             Enable AI-generated article summaries`),Rt=b(),Bt=f("p"),Bt.textContent="Generate intelligent summaries using OpenRouter's language models",Qt=b(),qt&&qt.c(),Tt=b(),Vt=f("h5"),Vt.textContent="Knowledge Graph",ll=b(),it=f("div"),q=f("label"),fe=M("Remote automata URL"),Se=b(),Ge=f("div"),Me=f("input"),Lt=b(),tl=f("div"),jt=f("label"),Dt=M("Local KG path"),Nl=b(),Ht=f("div"),Nt=f("input"),Mt=b(),Zt&&Zt.c(),Fl=b(),kl=f("div"),_l=f("div"),al=f("label"),Ct=M("Local KG type"),De=b(),Yt=f("div"),Ft=f("select"),nl=f("option"),nl.textContent="markdown",gt=f("option"),gt.textContent="json",fn=b(),$l=f("div"),gl=f("label"),cl=f("input"),dn=M(`
             Public`),pn=b(),yl=f("label"),ul=f("input"),mn=M(`
             Publish`),_n=b(),gn=f("hr"),hn=b(),Cl=f("button"),vn=M("Remove Role"),a(o,"class","label"),a(o,"for",i=`role-name-${e[80]}`),a(p,"class","input"),a(p,"id",d=`role-name-${e[80]}`),a(p,"type","text"),a(c,"class","control"),a(n,"class","field"),a(g,"class","label"),a(g,"for",v=`role-shortname-${e[80]}`),a(w,"class","input"),a(w,"id",$=`role-shortname-${e[80]}`),a(w,"type","text"),a(k,"class","control"),a(_,"class","field"),a(I,"class","label"),a(I,"for",E=`role-theme-${e[80]}`),a(D,"id",A=`role-theme-${e[80]}`),e[3].roles[e[80]].theme===void 0&&It(kn),a(Z,"class","select is-fullwidth"),a(Q,"class","control"),a(R,"class","field"),a(B,"class","label"),a(B,"for",F=`role-relevance-${e[80]}`),K.__value="title-scorer",K.value=K.__value,V.__value="terraphim-graph",V.value=V.__value,ie.__value="bm25",ie.value=ie.__value,re.__value="bm25f",re.value=re.__value,ye.__value="bm25plus",ye.value=ye.__value,a(H,"id",Y=`role-relevance-${e[80]}`),e[3].roles[e[80]].relevance_function===void 0&&It(wn),a(L,"class","select is-fullwidth"),a(P,"class","control"),a(ne,"class","field"),a(j,"class","checkbox"),a(j,"id",X=`role-terraphim-it-${e[80]}`),a(j,"type","checkbox"),a(G,"class","label"),a(G,"for",ge=`role-terraphim-it-${e[80]}`),a(me,"class","field"),a(pe,"class","title is-6"),a(Ve,"class","button is-small"),a(Ve,"data-testid",Le="add-haystack-"+e[80]),a(he,"class","title is-6"),a(Ke,"class","label"),a(Ke,"for",Ne=`llm-provider-${e[80]}`),Qe.__value="",Qe.value=Qe.__value,pt.__value="openrouter",pt.value=pt.__value,Fe.__value="ollama",Fe.value=Fe.__value,a(Ze,"id",nt=`llm-provider-${e[80]}`),e[3].roles[e[80]].llm_provider===void 0&&It(yn),a(dt,"class","select"),a(tt,"class","control"),a(z,"class","help"),a(Ye,"class","field"),a(Oe,"class","title is-6"),a(et,"id",lt=`openrouter-enabled-${e[80]}`),a(et,"type","checkbox"),a(ot,"class","checkbox"),a(ot,"for",at=`openrouter-enabled-${e[80]}`),a(Bt,"class","help"),a(Ce,"class","field"),a(Vt,"class","title is-6"),a(q,"class","label"),a(q,"for",ve=`kg-url-${e[80]}`),a(Me,"class","input"),a(Me,"id",ut=`kg-url-${e[80]}`),a(Me,"type","text"),a(Me,"placeholder","https://example.com/thesaurus.json"),a(Ge,"class","control"),a(it,"class","field"),a(jt,"class","label"),a(jt,"for",Et=`kg-local-path-${e[80]}`),a(Nt,"class","input"),a(Nt,"id",At=`kg-local-path-${e[80]}`),a(Nt,"type","text"),a(Nt,"placeholder","/path/to/markdown"),Nt.readOnly=e[4],a(Ht,"class","control"),a(tl,"class","field"),a(al,"class","label"),a(al,"for",de=`kg-local-type-${e[80]}`),nl.__value="markdown",nl.value=nl.__value,gt.__value="json",gt.value=gt.__value,a(Ft,"id",wl=`kg-local-type-${e[80]}`),e[3].roles[e[80]].kg.local_type===void 0&&It(Sn),a(Yt,"class","select"),a(_l,"class","control"),a(kl,"class","field is-grouped"),a(cl,"id",zl=`kg-public-${e[80]}`),a(cl,"type","checkbox"),a(gl,"class","checkbox"),a(gl,"for",Kl=`kg-public-${e[80]}`),Te(gl,"margin-right","1rem"),a(ul,"id",Gl=`kg-publish-${e[80]}`),a(ul,"type","checkbox"),a(yl,"class","checkbox"),a(yl,"for",ql=`kg-publish-${e[80]}`),a($l,"class","field is-grouped"),a(Cl,"class","button is-small is-danger"),a(Cl,"data-testid",Wl="remove-role-"+e[80]),a(t,"class","box"),this.first=t},m(ft,je){T(ft,t,je),s(t,n),s(n,o),s(o,r),s(n,u),s(n,c),s(c,p),Pe(p,e[3].roles[e[80]].name),s(t,m),s(t,_),s(_,g),s(g,h),s(_,y),s(_,k),s(k,w),Pe(w,e[3].roles[e[80]].shortname),s(t,C),s(t,R),s(R,I),s(I,N),s(R,O),s(R,Q),s(Q,Z),s(Z,D);for(let xe=0;xe<zt.length;xe+=1)zt[xe]&&zt[xe].m(D,null);rt(D,e[3].roles[e[80]].theme,!0),s(t,te),s(t,ne),s(ne,B),s(B,le),s(ne,U),s(ne,P),s(P,L),s(L,H),s(H,K),s(H,V),s(H,ie),s(H,re),s(H,ye),rt(H,e[3].roles[e[80]].relevance_function,!0),s(t,oe),s(t,me),s(me,G),s(G,j),j.checked=e[3].roles[e[80]].terraphim_it,s(G,ue),s(t,ae),s(t,pe),s(t,_e);for(let xe=0;xe<Kt.length;xe+=1)Kt[xe]&&Kt[xe].m(t,null);s(t,Re),s(t,Ve),s(Ve,Be),s(t,Ee),s(t,he),s(t,Ae),s(t,Ye),s(Ye,Ke),s(Ke,Ue),s(Ye,ze),s(Ye,tt),s(tt,dt),s(dt,Ze),s(Ze,Qe),s(Ze,pt),s(Ze,Fe),rt(Ze,e[3].roles[e[80]].llm_provider,!0),s(Ye,Xe),s(Ye,z),s(t,J),Gt&&Gt.m(t,null),s(t,se),s(t,Oe),s(t,Ie),s(t,Ce),s(Ce,ot),s(ot,et),et.checked=e[3].roles[e[80]].openrouter_enabled,s(ot,yt),s(Ce,Rt),s(Ce,Bt),s(t,Qt),qt&&qt.m(t,null),s(t,Tt),s(t,Vt),s(t,ll),s(t,it),s(it,q),s(q,fe),s(it,Se),s(it,Ge),s(Ge,Me),Pe(Me,e[3].roles[e[80]].kg.url),s(t,Lt),s(t,tl),s(tl,jt),s(jt,Dt),s(tl,Nl),s(tl,Ht),s(Ht,Nt),Pe(Nt,e[3].roles[e[80]].kg.local_path),s(Ht,Mt),Zt&&Zt.m(Ht,null),s(t,Fl),s(t,kl),s(kl,_l),s(_l,al),s(al,Ct),s(_l,De),s(_l,Yt),s(Yt,Ft),s(Ft,nl),s(Ft,gt),rt(Ft,e[3].roles[e[80]].kg.local_type,!0),s(t,fn),s(t,$l),s($l,gl),s(gl,cl),cl.checked=e[3].roles[e[80]].kg.public,s(gl,dn),s($l,pn),s($l,yl),s(yl,ul),ul.checked=e[3].roles[e[80]].kg.publish,s(yl,mn),s(t,_n),s(t,gn),s(t,hn),s(t,Cl),s(Cl,vn),Xl||(bn=[ee(p,"input",vi),ee(w,"input",bi),ee(D,"change",kn),ee(H,"change",wn),ee(j,"change",ki),ee(Ve,"click",wi),ee(Ze,"change",yn),ee(et,"change",yi),ee(Me,"input",Ci),ee(Nt,"input",Si),ee(Nt,"click",function(){jl(e[4]?Cn:void 0)&&(e[4]?Cn:void 0).apply(this,arguments)}),ee(Ft,"change",Sn),ee(cl,"change",Ti),ee(ul,"change",$i),ee(Cl,"click",Ri)],Xl=!0)},p(ft,je){if(e=ft,je[0]&264&&i!==(i=`role-name-${e[80]}`)&&a(o,"for",i),je[0]&264&&d!==(d=`role-name-${e[80]}`)&&a(p,"id",d),je[0]&264&&p.value!==e[3].roles[e[80]].name&&Pe(p,e[3].roles[e[80]].name),je[0]&264&&v!==(v=`role-shortname-${e[80]}`)&&a(g,"for",v),je[0]&264&&$!==($=`role-shortname-${e[80]}`)&&a(w,"id",$),je[0]&264&&w.value!==e[3].roles[e[80]].shortname&&Pe(w,e[3].roles[e[80]].shortname),je[0]&264&&E!==(E=`role-theme-${e[80]}`)&&a(I,"for",E),je[0]&256){Rl=e[8];let xe;for(xe=0;xe<Rl.length;xe+=1){const Il=Ro(e,Rl,xe);zt[xe]?zt[xe].p(Il,je):(zt[xe]=Io(Il),zt[xe].c(),zt[xe].m(D,null))}for(;xe<zt.length;xe+=1)zt[xe].d(1);zt.length=Rl.length}if(je[0]&264&&A!==(A=`role-theme-${e[80]}`)&&a(D,"id",A),je[0]&264&&rt(D,e[3].roles[e[80]].theme),je[0]&264&&F!==(F=`role-relevance-${e[80]}`)&&a(B,"for",F),je[0]&264&&Y!==(Y=`role-relevance-${e[80]}`)&&a(H,"id",Y),je[0]&264&&rt(H,e[3].roles[e[80]].relevance_function),je[0]&264&&X!==(X=`role-terraphim-it-${e[80]}`)&&a(j,"id",X),je[0]&264&&(j.checked=e[3].roles[e[80]].terraphim_it),je[0]&264&&ge!==(ge=`role-terraphim-it-${e[80]}`)&&a(G,"for",ge),je[0]&491576){Ll=e[78].haystacks;let xe;for(xe=0;xe<Ll.length;xe+=1){const Il=To(e,Ll,xe);Kt[xe]?Kt[xe].p(Il,je):(Kt[xe]=jo(Il),Kt[xe].c(),Kt[xe].m(t,Re))}for(;xe<Kt.length;xe+=1)Kt[xe].d(1);Kt.length=Ll.length}je[0]&264&&Le!==(Le="add-haystack-"+e[80])&&a(Ve,"data-testid",Le),je[0]&264&&Ne!==(Ne=`llm-provider-${e[80]}`)&&a(Ke,"for",Ne),je[0]&264&&nt!==(nt=`llm-provider-${e[80]}`)&&a(Ze,"id",nt),je[0]&264&&rt(Ze,e[3].roles[e[80]].llm_provider),e[3].roles[e[80]].llm_provider==="ollama"?Gt?Gt.p(e,je):(Gt=Ho(e),Gt.c(),Gt.m(t,se)):Gt&&(Gt.d(1),Gt=null),je[0]&264&&lt!==(lt=`openrouter-enabled-${e[80]}`)&&a(et,"id",lt),je[0]&264&&(et.checked=e[3].roles[e[80]].openrouter_enabled),je[0]&264&&at!==(at=`openrouter-enabled-${e[80]}`)&&a(ot,"for",at),e[3].roles[e[80]].openrouter_enabled?qt?qt.p(e,je):(qt=Ko(e),qt.c(),qt.m(t,Tt)):qt&&(qt.d(1),qt=null),je[0]&264&&ve!==(ve=`kg-url-${e[80]}`)&&a(q,"for",ve),je[0]&264&&ut!==(ut=`kg-url-${e[80]}`)&&a(Me,"id",ut),je[0]&264&&Me.value!==e[3].roles[e[80]].kg.url&&Pe(Me,e[3].roles[e[80]].kg.url),je[0]&264&&Et!==(Et=`kg-local-path-${e[80]}`)&&a(jt,"for",Et),je[0]&264&&At!==(At=`kg-local-path-${e[80]}`)&&a(Nt,"id",At),je[0]&16&&(Nt.readOnly=e[4]),je[0]&264&&Nt.value!==e[3].roles[e[80]].kg.local_path&&Pe(Nt,e[3].roles[e[80]].kg.local_path),e[4]?Zt||(Zt=Jo(),Zt.c(),Zt.m(Ht,null)):Zt&&(Zt.d(1),Zt=null),je[0]&264&&de!==(de=`kg-local-type-${e[80]}`)&&a(al,"for",de),je[0]&264&&wl!==(wl=`kg-local-type-${e[80]}`)&&a(Ft,"id",wl),je[0]&264&&rt(Ft,e[3].roles[e[80]].kg.local_type),je[0]&264&&zl!==(zl=`kg-public-${e[80]}`)&&a(cl,"id",zl),je[0]&264&&(cl.checked=e[3].roles[e[80]].kg.public),je[0]&264&&Kl!==(Kl=`kg-public-${e[80]}`)&&a(gl,"for",Kl),je[0]&264&&Gl!==(Gl=`kg-publish-${e[80]}`)&&a(ul,"id",Gl),je[0]&264&&(ul.checked=e[3].roles[e[80]].kg.publish),je[0]&264&&ql!==(ql=`kg-publish-${e[80]}`)&&a(yl,"for",ql),je[0]&264&&Wl!==(Wl="remove-role-"+e[80])&&a(Cl,"data-testid",Wl)},d(ft){ft&&S(t),_t(zt,ft),_t(Kt,ft),Gt&&Gt.d(),qt&&qt.d(),Zt&&Zt.d(),Xl=!1,st(bn)}}}function Qo(l){let e,t=l[75]+"",n;return{c(){e=f("option"),n=M(t),e.__value=l[75],e.value=e.__value},m(o,r){T(o,e,r),s(e,n)},p:$e,d(o){o&&S(e)}}}function Vo(l){let e,t=l[72].name+"",n,o;return{c(){e=f("option"),n=M(t),e.__value=o=l[72].name,e.value=e.__value},m(r,i){T(r,e,i),s(e,n)},p(r,i){i[0]&8&&t!==(t=r[72].name+"")&&ce(n,t),i[0]&264&&o!==(o=r[72].name)&&(e.__value=o,e.value=e.__value)},d(r){r&&S(e)}}}function Yo(l){let e,t,n;return{c(){e=f("button"),e.textContent="Back",a(e,"class","button"),a(e,"data-testid","wizard-back")},m(o,r){T(o,e,r),t||(n=ee(e,"click",l[11]),t=!0)},p:$e,d(o){o&&S(e),t=!1,n()}}}function qa(l){let e,t,n;return{c(){e=f("button"),e.textContent="Save",a(e,"class","button is-success"),a(e,"data-testid","wizard-save")},m(o,r){T(o,e,r),t||(n=ee(e,"click",l[19]),t=!0)},p:$e,d(o){o&&S(e),t=!1,n()}}}function Wa(l){let e,t,n;return{c(){e=f("button"),e.textContent="Next",a(e,"class","button is-primary"),a(e,"data-testid","wizard-next")},m(o,r){T(o,e,r),t||(n=ee(e,"click",l[10]),t=!0)},p:$e,d(o){o&&S(e),t=!1,n()}}}function Ja(l){let e,t,n,o,r,i,u,c,p,d,m,_,g,h,v,y=l[2]==="success"&&Ao(l),k=l[2]==="error"&&Do(l);function w(O,Q){return O[1]===1?za:O[1]===2?Fa:Ha}let $=w(l),C=$(l),R=l[1]>1&&Yo(l);function I(O,Q){return O[1]<hi?Wa:qa}let N=I(l),E=N(l);return{c(){e=f("div"),t=f("div"),n=f("h3"),n.textContent="Configuration Wizard",o=b(),r=f("button"),r.textContent="Close",i=b(),y&&y.c(),u=b(),k&&k.c(),c=b(),C.c(),p=b(),d=f("nav"),m=f("div"),R&&R.c(),_=b(),g=f("div"),E.c(),a(n,"class","title is-4"),Te(n,"margin-bottom","0"),a(r,"class","button is-small is-light"),a(r,"aria-label","Close configuration wizard"),a(t,"class","is-flex is-justify-content-space-between is-align-items-center"),Te(t,"gap",".5rem"),a(m,"class","level-left"),a(g,"class","level-right"),a(d,"class","level"),a(e,"class","box"),a(e,"data-testid","config-wizard")},m(O,Q){T(O,e,Q),s(e,t),s(t,n),s(t,o),s(t,r),s(e,i),y&&y.m(e,null),s(e,u),k&&k.m(e,null),s(e,c),C.m(e,null),s(e,p),s(e,d),s(d,m),R&&R.m(m,null),s(d,_),s(d,g),E.m(g,null),h||(v=ee(r,"click",Ba),h=!0)},p(O,Q){O[2]==="success"?y?y.p(O,Q):(y=Ao(O),y.c(),y.m(e,u)):y&&(y.d(1),y=null),O[2]==="error"?k?k.p(O,Q):(k=Do(O),k.c(),k.m(e,c)):k&&(k.d(1),k=null),$===($=w(O))&&C?C.p(O,Q):(C.d(1),C=$(O),C&&(C.c(),C.m(e,p))),O[1]>1?R?R.p(O,Q):(R=Yo(O),R.c(),R.m(m,null)):R&&(R.d(1),R=null),N===(N=I(O))&&E?E.p(O,Q):(E.d(1),E=N(O),E&&(E.c(),E.m(g,null)))},i:$e,o:$e,d(O){O&&S(e),y&&y.d(),k&&k.d(),C.d(),R&&R.d(),E.d(),h=!1,v()}}}const hi=3;function Ba(){typeof window<"u"&&window.history.back()}function Qa(l,e,t){let n,o;qe(l,bt,z=>t(4,o=z));const r=el(null);async function i(z,J){if(ht(bt))try{const se=await on({directory:!0,multiple:!1});se&&typeof se=="string"&&c.update(Oe=>(Oe.roles[z].haystacks[J].path=se,Oe))}catch(se){console.error("Failed to open folder selector:",se)}}async function u(z){if(ht(bt))try{const J=await on({directory:!0,multiple:!1});J&&typeof J=="string"&&c.update(se=>(se.roles[z].kg.local_path=J,se))}catch(J){console.error("Failed to open folder selector:",J)}}const c=el({id:"Desktop",global_shortcut:"Ctrl+X",default_theme:"spacelab",default_role:"Default",roles:[]});qe(l,c,z=>t(3,n=z));const p=["default","darkly","cerulean","cosmo","cyborg","flatly","journal","litera","lumen","lux","materia","minty","nuclear","pulse","sandstone","simplex","slate","solar","spacelab","superhero","united","yeti"];vl(async()=>{try{let z;ht(bt)?z=await He("get_config_schema"):z=await(await fetch("/config/schema")).json(),r.set(z);const J=ht(Jt);J&&J.id&&c.update(se=>{var Oe;return{...se,id:J.id,global_shortcut:J.global_shortcut,default_theme:((Oe=J.roles[J.default_role])==null?void 0:Oe.theme)??"spacelab",default_role:J.default_role,roles:Object.values(J.roles).map(Ie=>{var lt,yt,at,Rt,Bt,Qt,Tt,Vt,ll,it,q;const Ce=(lt=Ie.kg)==null?void 0:lt.automata_path,ot=(Ce==null?void 0:Ce.Remote)??"",et=((at=(yt=Ie.kg)==null?void 0:yt.knowledge_graph_local)==null?void 0:at.path)??"";return{name:Ie.name,shortname:Ie.shortname,relevance_function:Ie.relevance_function,terraphim_it:Ie.terraphim_it??!1,theme:Ie.theme,haystacks:(Ie.haystacks??[]).map(fe=>({path:fe.location||fe.path||"",read_only:fe.read_only??!1,service:fe.service||"Ripgrep",atomic_server_secret:fe.atomic_server_secret||"",extra_parameters:fe.extra_parameters||{},weight:fe.weight??1})),kg:{url:ot,local_path:et,local_type:((Bt=(Rt=Ie.kg)==null?void 0:Rt.knowledge_graph_local)==null?void 0:Bt.input_type)??"markdown",public:((Qt=Ie.kg)==null?void 0:Qt.public)??!1,publish:((Tt=Ie.kg)==null?void 0:Tt.publish)??!1},openrouter_enabled:Ie.openrouter_enabled??!1,openrouter_api_key:Ie.openrouter_api_key??"",openrouter_model:Ie.openrouter_model??"openai/gpt-3.5-turbo",openrouter_auto_summarize:Ie.openrouter_auto_summarize??!1,openrouter_chat_enabled:Ie.openrouter_chat_enabled??!1,openrouter_chat_model:Ie.openrouter_chat_model??Ie.openrouter_model??"openai/gpt-3.5-turbo",openrouter_chat_system_prompt:Ie.openrouter_chat_system_prompt??"",llm_provider:((Vt=Ie.extra)==null?void 0:Vt.llm_provider)??"",llm_model:((ll=Ie.extra)==null?void 0:ll.llm_model)??"",llm_base_url:((it=Ie.extra)==null?void 0:it.llm_base_url)??"",llm_auto_summarize:((q=Ie.extra)==null?void 0:q.llm_auto_summarize)??!1}})}})}catch(z){console.error("Failed to load schema",z)}}),vl(()=>{const z=J=>{J.key==="Escape"&&typeof window<"u"&&window.history.back()};return window.addEventListener("keydown",z),()=>window.removeEventListener("keydown",z)});let d={};async function m(z){var Ce;const se=ht(c).roles[z],Oe=se.llm_provider||(se.openrouter_enabled?"openrouter":""),Ie=[];try{if(Oe==="ollama"){const ot=(se.llm_base_url||"http://127.0.0.1:11434").replace(/\/$/,""),lt=await(await fetch(`${ot}/api/tags`)).json();if(Array.isArray(lt==null?void 0:lt.models))for(const yt of lt.models)yt!=null&&yt.name&&Ie.push(yt.name)}else if(Oe==="openrouter"){const ot=(Ce=se.openrouter_api_key)==null?void 0:Ce.trim();if(!ot)throw new Error("OpenRouter API key required");const lt=await(await fetch("https://openrouter.ai/api/v1/models",{headers:{Authorization:`Bearer ${ot}`,"HTTP-Referer":"https://terraphim.ai","X-Title":"Terraphim Desktop"}})).json(),yt=Array.isArray(lt==null?void 0:lt.data)?lt.data:[];for(const at of yt)at!=null&&at.id&&Ie.push(at.id)}}catch(ot){console.error("Failed to fetch models",ot)}t(0,d={...d,[z]:Ie})}let _=1,g="";function h(){_<hi&&t(1,_+=1)}function v(){_>1&&t(1,_-=1)}function y(){c.update(z=>({...z,roles:[...z.roles,{name:"New Role",shortname:"new",relevance_function:"title-scorer",terraphim_it:!1,theme:"spacelab",haystacks:[],kg:{url:"",local_path:"",local_type:"markdown",public:!1,publish:!1},openrouter_enabled:!1,openrouter_api_key:"",openrouter_model:"openai/gpt-3.5-turbo",openrouter_auto_summarize:!1,openrouter_chat_enabled:!1,openrouter_chat_model:"openai/gpt-3.5-turbo",openrouter_chat_system_prompt:"",llm_provider:"",llm_model:"",llm_base_url:"",llm_auto_summarize:!1}]}))}function k(z){c.update(J=>({...J,roles:J.roles.filter((se,Oe)=>Oe!==z)}))}function w(z){c.update(J=>(J.roles[z].haystacks.push({path:"",read_only:!1,service:"Ripgrep",atomic_server_secret:"",extra_parameters:{},weight:1}),J))}function $(z,J){c.update(se=>(se.roles[z].haystacks=se.roles[z].haystacks.filter((Oe,Ie)=>Ie!==J),se))}function C(z,J,se="",Oe=""){c.update(Ie=>{Ie.roles[z].haystacks[J].extra_parameters||(Ie.roles[z].haystacks[J].extra_parameters={});const Ce=se||`param_${Date.now()}`;return Ie.roles[z].haystacks[J].extra_parameters[Ce]=Oe,Ie})}function R(z,J,se){c.update(Oe=>(delete Oe.roles[z].haystacks[J].extra_parameters[se],Oe))}function I(z,J,se,Oe){c.update(Ie=>{const Ce=Ie.roles[z].haystacks[J].extra_parameters;return Ce[se]!==void 0&&se!==Oe&&(Ce[Oe]=Ce[se],delete Ce[se]),Ie})}function N(z,J,se,Oe){const Ie=Oe.target.value;I(z,J,se,Ie)}async function E(){var Ie;const z=ht(c),J=ht(Jt);let se={...J};se.id=z.id,se.global_shortcut=z.global_shortcut,se.default_role=z.default_role;const Oe={};z.roles.forEach(Ce=>{var yt,at;const ot=Ce.name,et=ot.replace(/^"|"$/g,"");Oe[et]={extra:((at=(yt=J.roles)==null?void 0:yt[ot])==null?void 0:at.extra)??{},name:Ce.name,shortname:Ce.shortname,theme:Ce.theme,relevance_function:Ce.relevance_function,terraphim_it:Ce.terraphim_it??!1,haystacks:Ce.haystacks.map(Rt=>({location:Rt.path,service:Rt.service,read_only:Rt.read_only,atomic_server_secret:Rt.service==="Atomic"?Rt.atomic_server_secret:void 0,extra_parameters:Rt.extra_parameters||{},weight:Rt.weight??1})),kg:Ce.kg.url||Ce.kg.local_path?{automata_path:Ce.kg.url?{Remote:Ce.kg.url}:null,knowledge_graph_local:Ce.kg.local_path?{input_type:Ce.kg.local_type,path:Ce.kg.local_path}:null,public:Ce.kg.public,publish:Ce.kg.publish}:null,...Ce.openrouter_enabled&&{openrouter_enabled:Ce.openrouter_enabled,openrouter_api_key:Ce.openrouter_api_key,openrouter_model:Ce.openrouter_model,openrouter_auto_summarize:Ce.openrouter_auto_summarize??!1,openrouter_chat_enabled:Ce.openrouter_chat_enabled??!1,openrouter_chat_model:Ce.openrouter_chat_model??Ce.openrouter_model,openrouter_chat_system_prompt:Ce.openrouter_chat_system_prompt??""}};const lt={};Ce.llm_provider&&(lt.llm_provider=Ce.llm_provider),Ce.llm_model&&(lt.llm_model=Ce.llm_model),Ce.llm_base_url&&(lt.llm_base_url=Ce.llm_base_url),typeof Ce.llm_auto_summarize=="boolean"&&(lt.llm_auto_summarize=Ce.llm_auto_summarize),Oe[et].extra={...Oe[et].extra||{},...lt}}),se.roles=Oe,(!se.default_role||!Oe[se.default_role])&&(se.default_role=((Ie=z.roles[0])==null?void 0:Ie.name)??"Default"),se.selected_role=se.default_role;try{if(ht(bt))await He("update_config",{configNew:se});else{const Ce=await fetch("/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(se)});if(!Ce.ok)throw new Error(`HTTP ${Ce.status}: ${Ce.statusText}`)}Jt.set(se),t(2,g="success"),setTimeout(()=>{t(2,g="")},3e3)}catch(Ce){console.error(Ce),t(2,g="error"),setTimeout(()=>{t(2,g="")},3e3)}}const O=()=>t(2,g=""),Q=()=>t(2,g="");function Z(){n.id=Wt(this),c.set(n),t(8,p)}function D(){n.global_shortcut=this.value,c.set(n),t(8,p)}function A(){n.default_theme=Wt(this),c.set(n),t(8,p)}function te(){n.default_role=Wt(this),c.set(n),t(8,p)}function ne(z){n.roles[z].name=this.value,c.set(n),t(8,p)}function B(z){n.roles[z].shortname=this.value,c.set(n),t(8,p)}function le(z){n.roles[z].theme=Wt(this),c.set(n),t(8,p)}function F(z){n.roles[z].relevance_function=Wt(this),c.set(n),t(8,p)}function U(z){n.roles[z].terraphim_it=this.checked,c.set(n),t(8,p)}function P(z,J){n.roles[z].haystacks[J].service=Wt(this),c.set(n),t(8,p)}function L(z,J){n.roles[z].haystacks[J].path=this.value,c.set(n),t(8,p)}const H=(z,J)=>i(z,J);function K(z,J){n.roles[z].haystacks[J].atomic_server_secret=this.value,c.set(n),t(8,p)}function V(z,J){n.roles[z].haystacks[J].extra_parameters.tag=this.value,c.set(n),t(8,p)}const ie=(z,J,se)=>{const Oe=se.currentTarget.value;Oe&&ol(c,n.roles[z].haystacks[J].extra_parameters.tag=Oe,n)},re=(z,J,se,Oe)=>N(z,J,se,Oe);function ye(z,J,se){n.roles[z].haystacks[J].extra_parameters[se]=this.value,c.set(n),t(8,p)}const Y=(z,J,se)=>R(z,J,se),oe=(z,J)=>C(z,J,"tag","#rust"),me=(z,J)=>C(z,J,"max_count","10"),G=(z,J)=>C(z,J,"","");function j(z,J){n.roles[z].haystacks[J].read_only=this.checked,c.set(n),t(8,p)}function X(z,J){n.roles[z].haystacks[J].weight=ri(this.value),c.set(n),t(8,p)}const ue=(z,J)=>$(z,J),ge=z=>w(z);function ae(z){n.roles[z].llm_provider=Wt(this),c.set(n),t(8,p)}function pe(z){n.roles[z].llm_model=this.value,c.set(n),t(8,p)}const _e=z=>m(z),Re=(z,J)=>{ol(c,n.roles[z].llm_model=J.currentTarget.value,n)};function Ve(z){n.roles[z].llm_base_url=this.value,c.set(n),t(8,p)}function Be(z){n.roles[z].llm_auto_summarize=this.checked,c.set(n),t(8,p)}function Le(z){n.roles[z].openrouter_enabled=this.checked,c.set(n),t(8,p)}function Ee(z){n.roles[z].openrouter_api_key=this.value,c.set(n),t(8,p)}function he(z){n.roles[z].openrouter_model=this.value,c.set(n),t(8,p)}const Ae=z=>m(z),Ye=(z,J)=>{ol(c,n.roles[z].openrouter_model=J.currentTarget.value,n)};function Ke(z){n.roles[z].openrouter_auto_summarize=this.checked,c.set(n),t(8,p)}function Ue(z){n.roles[z].openrouter_chat_enabled=this.checked,c.set(n),t(8,p)}function Ne(z){n.roles[z].openrouter_chat_model=Wt(this),c.set(n),t(8,p)}function ze(z){n.roles[z].openrouter_chat_system_prompt=this.value,c.set(n),t(8,p)}function tt(z){n.roles[z].kg.url=this.value,c.set(n),t(8,p)}function dt(z){n.roles[z].kg.local_path=this.value,c.set(n),t(8,p)}const Ze=z=>u(z);function Qe(z){n.roles[z].kg.local_type=Wt(this),c.set(n),t(8,p)}function pt(z){n.roles[z].kg.public=this.checked,c.set(n),t(8,p)}function Fe(z){n.roles[z].kg.publish=this.checked,c.set(n),t(8,p)}return[d,_,g,n,o,i,u,c,p,m,h,v,y,k,w,$,C,R,N,E,O,Q,Z,D,A,te,ne,B,le,F,U,P,L,H,K,V,ie,re,ye,Y,oe,me,G,j,X,ue,ge,ae,pe,_e,Re,Ve,Be,Le,Ee,he,Ae,Ye,Ke,Ue,Ne,ze,tt,dt,Ze,Qe,pt,Fe,z=>k(z),()=>{t(1,_=2)}]}class Va extends Pt{constructor(e){super(),Ut(this,e,Qa,Ja,Ot,{},null,[-1,-1,-1,-1])}}function Ya(l){let e,t,n,o,r,i;return r=new fi({props:{content:l[0],onChange:l[1]}}),{c(){e=f("div"),t=f("p"),t.innerHTML="<i>The best editing experience is to configure Atomic Server, in the meantime use editor below. You will need to refresh page via Command R or Ctrl-R to see changes</i>",n=b(),o=f("div"),be(r.$$.fragment),a(o,"class","editor"),a(e,"class","box")},m(u,c){T(u,e,c),s(e,t),s(e,n),s(e,o),ke(r,o,null),i=!0},p(u,[c]){const p={};c&1&&(p.content=u[0]),r.$set(p)},i(u){i||(W(r.$$.fragment,u),i=!0)},o(u){x(r.$$.fragment,u),i=!1},d(u){u&&S(e),we(r)}}}function Za(l,e,t){let n,o;qe(l,Jt,u=>t(2,n=u)),qe(l,bt,u=>t(3,o=u));let r={json:n};function i(u){if(console.log("contents changed:",u),console.log("is tauri",o),Jt.update(c=>(c=u.json,c)),ht(bt))console.log("Updating config on server"),He("update_config",{configNew:u.json}).then(c=>{console.log(`Message: ${c}`)}).catch(c=>console.error(c));else{let c=`${ct.ServerURL}/config/`;fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u.json)})}t(0,r=u)}return vl(()=>{t(0,r={json:n})}),[r,i]}class Xa extends Pt{constructor(e){super(),Ut(this,e,Za,Ya,Ot,{})}}const{window:sn}=Oi;function xa(l){let e,t,n,o,r,i,u,c,p,d;return{c(){e=f("div"),t=f("div"),n=f("h3"),n.textContent="Error loading graph",o=b(),r=f("p"),i=M(l[3]),u=b(),c=f("button"),c.textContent="Retry",a(c,"class","button is-primary"),a(t,"class","error-content svelte-1ry9pkl"),a(e,"class","error-overlay svelte-1ry9pkl")},m(m,_){T(m,e,_),s(e,t),s(t,n),s(t,o),s(t,r),s(r,i),s(t,u),s(t,c),p||(d=ee(c,"click",l[11]),p=!0)},p(m,_){_&8&&ce(i,m[3])},d(m){m&&S(e),p=!1,d()}}}function ec(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="loading-content svelte-1ry9pkl"><div class="loader svelte-1ry9pkl"></div> 
        <p>Loading knowledge graph...</p></div>`,a(e,"class","loading-overlay svelte-1ry9pkl")},m(t,n){T(t,e,n)},p:$e,d(t){t&&S(e)}}}function Zo(l){let e,t,n;return{c(){e=f("button"),e.innerHTML='<i class="fas fa-times svelte-1ry9pkl"></i>',a(e,"class","close-button svelte-1ry9pkl"),a(e,"title","Close Graph")},m(o,r){T(o,e,r),t||(n=ee(e,"click",l[17]),t=!0)},p:$e,d(o){o&&S(e),t=!1,n()}}}function Xo(l){let e;return{c(){e=f("div"),e.innerHTML="<span><strong>Left-click:</strong> View node • <strong>Right-click:</strong> Edit node • <strong>Drag:</strong> Move • <strong>Scroll:</strong> Zoom</span>",a(e,"class","controls-info svelte-1ry9pkl")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function xo(l){let e,t;return{c(){e=f("div"),t=M(l[8]),a(e,"class","debug-message svelte-1ry9pkl")},m(n,o){T(n,e,o),s(e,t)},p(n,o){o&256&&ce(t,n[8])},d(n){n&&S(e)}}}function es(l){let e=l[5].id,t,n,o=ts(l);return{c(){o.c(),t=St()},m(r,i){o.m(r,i),T(r,t,i),n=!0},p(r,i){i&32&&Ot(e,e=r[5].id)?(We(),x(o,1,1,$e),Je(),o=ts(r),o.c(),W(o,1),o.m(t.parentNode,t)):o.p(r,i)},i(r){n||(W(o),n=!0)},o(r){x(o),n=!1},d(r){r&&S(t),o.d(r)}}}function ts(l){let e,t,n;function o(i){l[18](i)}let r={item:l[5],initialEdit:l[7]};return l[6]!==void 0&&(r.active=l[6]),e=new Zl({props:r}),mt.push(()=>kt(e,"active",o)),e.$on("close",l[12]),e.$on("save",l[13]),{c(){be(e.$$.fragment)},m(i,u){ke(e,i,u),n=!0},p(i,u){const c={};u&32&&(c.item=i[5]),u&128&&(c.initialEdit=i[7]),!t&&u&64&&(t=!0,c.active=i[6],wt(()=>t=!1)),e.$set(c)},i(i){n||(W(e.$$.fragment,i),n=!0)},o(i){x(e.$$.fragment,i),n=!1},d(i){we(e,i)}}}function tc(l){let e,t,n,o,r,i,u,c,p;It(l[15]);function d(k,w){if(k[2])return ec;if(k[3])return xa}let m=d(l),_=m&&m(l),g=l[0]&&Zo(l),h=!l[2]&&!l[3]&&l[4].length>0&&Xo(),v=l[8]&&xo(l),y=l[5]&&es(l);return{c(){e=f("div"),_&&_.c(),t=b(),g&&g.c(),n=b(),h&&h.c(),o=b(),v&&v.c(),r=b(),y&&y.c(),i=St(),a(e,"class","graph-container svelte-1ry9pkl"),Te(e,"width",l[0]?"100vw":"600px"),Te(e,"height",l[0]?"100vh":"400px"),vt(e,"fullscreen",l[0])},m(k,w){T(k,e,w),_&&_.m(e,null),l[16](e),T(k,t,w),g&&g.m(k,w),T(k,n,w),h&&h.m(k,w),T(k,o,w),v&&v.m(k,w),T(k,r,w),y&&y.m(k,w),T(k,i,w),u=!0,c||(p=ee(sn,"resize",l[15]),c=!0)},p(k,[w]){m===(m=d(k))&&_?_.p(k,w):(_&&_.d(1),_=m&&m(k),_&&(_.c(),_.m(e,null))),(!u||w&1)&&Te(e,"width",k[0]?"100vw":"600px"),(!u||w&1)&&Te(e,"height",k[0]?"100vh":"400px"),(!u||w&1)&&vt(e,"fullscreen",k[0]),k[0]?g?g.p(k,w):(g=Zo(k),g.c(),g.m(n.parentNode,n)):g&&(g.d(1),g=null),!k[2]&&!k[3]&&k[4].length>0?h||(h=Xo(),h.c(),h.m(o.parentNode,o)):h&&(h.d(1),h=null),k[8]?v?v.p(k,w):(v=xo(k),v.c(),v.m(r.parentNode,r)):v&&(v.d(1),v=null),k[5]?y?(y.p(k,w),w&32&&W(y,1)):(y=es(k),y.c(),W(y,1),y.m(i.parentNode,i)):y&&(We(),x(y,1,1,()=>{y=null}),Je())},i(k){u||(W(y),u=!0)},o(k){x(y),u=!1},d(k){k&&S(e),_&&_.d(),l[16](null),k&&S(t),g&&g.d(k),k&&S(n),h&&h.d(k),k&&S(o),v&&v.d(k),k&&S(r),y&&y.d(k),k&&S(i),c=!1,p()}}}function ls(l){return{id:`kg-node-${l.id}`,url:`#/graph/node/${l.id}`,title:l.label,body:`# ${l.label}

**Knowledge Graph Node**

ID: ${l.id}
Rank: ${l.rank}

This is a concept node from the knowledge graph. You can edit this content to add more information about "${l.label}".`,description:`Knowledge graph concept: ${l.label}`,tags:["knowledge-graph","concept"],rank:l.rank,stub:`Knowledge graph concept: ${l.label}`}}function lc(l,e,t){let n,o;qe(l,$t,A=>t(20,n=A)),qe(l,bt,A=>t(21,o=A));let{apiUrl:r="/rolegraph"}=e,{fullscreen:i=!0}=e,u,c=!0,p=null,d=[],m=[],_=null,g=!1,h=!1,v="",y=window.innerWidth,k=window.innerHeight;function w(){t(9,y=window.innerWidth),t(10,k=window.innerHeight),!c&&!p&&E()}async function $(){t(2,c=!0),t(3,p=null);try{if(o){console.log("Loading rolegraph from Tauri");const A=await He("get_rolegraph",{role_name:n||void 0});if(A&&A.status==="success")t(4,d=A.nodes),m=A.edges;else throw new Error(`Tauri rolegraph fetch failed: ${(A==null?void 0:A.status)||"unknown error"}`)}else{console.log("Loading rolegraph from server");const A=n?`${r}?role=${encodeURIComponent(n)}`:r,te=await fetch(A);if(!te.ok)throw new Error(`Failed to fetch: ${te.status}`);const ne=await te.json();t(4,d=ne.nodes),m=ne.edges}}catch(A){t(3,p=A.message),console.error("Error fetching rolegraph:",A)}finally{t(2,c=!1)}}function C(A,te){A.stopPropagation(),console.log("Node clicked:",te.label),t(5,_=ls(te)),t(7,h=!1),t(6,g=!0)}function R(A,te){A.preventDefault(),A.stopPropagation(),console.log("Node right-clicked:",te.label),t(8,v=`Right-clicked: ${te.label}`),t(5,_=ls(te)),t(7,h=!0),t(6,g=!0),setTimeout(()=>{t(8,v="")},2e3)}function I(){t(6,g=!1),t(5,_=null),t(7,h=!1)}async function N(){if(_)try{const A=await fetch("/documents",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(_)});A.ok?console.log("Successfully saved KG record:",_.id):console.error("Failed to save KG record:",A.statusText)}catch(A){console.error("Error saving KG record:",A)}finally{t(6,g=!1),t(5,_=null),t(7,h=!1)}}function E(){if(!u)return;t(1,u.innerHTML="",u);const A=tn(u).append("svg").attr("width",y).attr("height",k),te=qi().scaleExtent([.1,10]).on("zoom",K=>{ne.attr("transform",K.transform)});A.call(te);const ne=A.append("g"),B=Wi(d).force("link",Ji(m).id(K=>K.id).distance(100)).force("charge",Bi().strength(-200)).force("center",Qi(y/2,k/2)).force("collision",Vi().radius(20)),le=ne.append("g").attr("class","links").selectAll("line").data(m).enter().append("line").attr("stroke","#666").attr("stroke-opacity",.7).attr("stroke-width",K=>{const V=K.weight||K.rank||1;return Math.max(1,Math.min(8,V*2))}),F=ne.append("g").attr("class","nodes").selectAll("circle").data(d).enter().append("circle").attr("r",K=>{const V=K.rank||1;return Math.max(6,Math.min(20,V*2))}).attr("fill",K=>{const V=K.rank||1,ie=Math.min(V/10,1);return Yi(.2+ie*.6)}).attr("stroke","#fff").attr("stroke-width",2).style("cursor","pointer").on("click",(K,V)=>C(K,V)).on("contextmenu",(K,V)=>R(K,V)).on("mouseover",function(K,V){tn(this).transition().duration(150).attr("stroke-width",3).attr("r",ie=>{const re=ie.rank||1;return Math.max(8,Math.min(24,re*2.5))})}).on("mouseout",function(K,V){tn(this).transition().duration(150).attr("stroke-width",2).attr("r",ie=>{const re=ie.rank||1;return Math.max(6,Math.min(20,re*2))})}).call(Zi().on("start",P).on("drag",L).on("end",H)),U=ne.append("g").attr("class","labels").selectAll("text").data(d).enter().append("text").attr("text-anchor","middle").attr("dy",".35em").attr("font-size","11px").attr("font-family","Arial, sans-serif").attr("fill","#333").attr("pointer-events","none").text(K=>K.label.length>12?K.label.substring(0,12)+"...":K.label);B.on("tick",()=>{le.attr("x1",K=>K.source.x).attr("y1",K=>K.source.y).attr("x2",K=>K.target.x).attr("y2",K=>K.target.y),F.attr("cx",K=>K.x).attr("cy",K=>K.y),U.attr("x",K=>K.x).attr("y",K=>K.y)});function P(K,V){K.active||B.alphaTarget(.3).restart(),V.fx=V.x,V.fy=V.y}function L(K,V){V.fx=K.x,V.fy=K.y}function H(K,V){K.active||B.alphaTarget(0),V.fx=null,V.fy=null}}vl(()=>{$().then(()=>{p||E()});const A=te=>{te.preventDefault()};return u&&u.addEventListener("contextmenu",A),window.addEventListener("resize",w),()=>{u&&u.removeEventListener("contextmenu",A),window.removeEventListener("resize",w)}});function O(){t(9,y=sn.innerWidth),t(10,k=sn.innerHeight)}function Q(A){mt[A?"unshift":"push"](()=>{u=A,t(1,u)})}const Z=()=>history.back();function D(A){g=A,t(6,g)}return l.$$set=A=>{"apiUrl"in A&&t(14,r=A.apiUrl),"fullscreen"in A&&t(0,i=A.fullscreen)},[i,u,c,p,d,_,g,h,v,y,k,$,I,N,r,O,Q,Z,D]}class nc extends Pt{constructor(e){super(),Ut(this,e,lc,tc,Ot,{apiUrl:14,fullscreen:0})}}function ns(l,e,t){const n=l.slice();return n[19]=e[t][0],n[20]=e[t][1],n[21]=e,n[22]=t,n}function os(l,e,t){const n=l.slice();return n[23]=e[t],n}function ss(l){let e,t,n,o,r,i,u,c,p,d,m,_,g,h,v=l[2].title.trim()==="",y,k,w,$,C,R,I,N,E,O,Q,Z,D,A,te,ne=l[2].content.trim()==="",B,le,F,U,P,L,H,K,V,ie,re,ye,Y,oe,me,G,j,X,ue,ge,ae,pe=l[1]==="edit"?"Save Changes":"Add Context",_e,Re,Ve,Be,Le,Ee,he,Ae,Ye,Ke,Ue=l[4],Ne=[];for(let z=0;z<Ue.length;z+=1)Ne[z]=is(os(l,Ue,z));let ze=v&&rs();function tt(z,J){return z[2].summary?sc:oc}let dt=tt(l),Ze=dt(l),Qe=ne&&as();function pt(z,J){return J&4&&(re=null),re==null&&(re=Object.keys(z[2].metadata).length===0),re?rc:ic}let Fe=pt(l,-1),nt=Fe(l),Xe=l[1]==="edit"&&us(l);return{c(){e=f("section"),t=f("div"),n=f("label"),n.textContent="Type",o=b(),r=f("div"),i=f("div"),u=f("select");for(let z=0;z<Ne.length;z+=1)Ne[z].c();c=b(),p=f("div"),d=f("label"),d.textContent="Title *",m=b(),_=f("div"),g=f("input"),h=b(),ze&&ze.c(),y=b(),k=f("div"),w=f("label"),w.textContent="Summary",$=b(),C=f("div"),R=f("textarea"),I=b(),N=f("p"),Ze.c(),E=b(),O=f("div"),Q=f("label"),Q.textContent="Content *",Z=b(),D=f("div"),A=f("textarea"),te=b(),Qe&&Qe.c(),B=b(),le=f("details"),F=f("summary"),F.innerHTML=`<span class="icon-text"><span class="icon"><i class="fas fa-cog"></i></span> 
              <span>Advanced Options</span></span>`,U=b(),P=f("div"),L=f("label"),L.textContent="Metadata",H=b(),K=f("div"),V=f("p"),V.textContent="Additional key-value pairs for this context item",ie=b(),nt.c(),ye=b(),Y=f("button"),Y.innerHTML=`<span class="icon"><i class="fas fa-plus"></i></span> 
                <span>Add Metadata</span>`,oe=b(),me=f("footer"),G=f("div"),j=f("div"),X=f("button"),ue=f("span"),ue.innerHTML='<i class="fas fa-save"></i>',ge=b(),ae=f("span"),_e=M(pe),Ve=b(),Be=f("div"),Le=f("button"),Le.innerHTML="<span>Cancel</span>",Ee=b(),Xe&&Xe.c(),he=b(),Ae=f("div"),Ae.innerHTML=`<strong>Keyboard shortcuts:</strong>
          Ctrl/Cmd + Enter to save, Escape to close`,a(n,"class","label"),a(n,"for","context-type"),a(u,"id","context-type"),a(u,"data-testid","context-type-select"),l[2].context_type===void 0&&It(()=>l[10].call(u)),a(i,"class","select is-fullwidth"),a(r,"class","control"),a(t,"class","field"),a(d,"class","label"),a(d,"for","context-title"),a(g,"id","context-title"),a(g,"class","input"),a(g,"type","text"),a(g,"placeholder","Enter title..."),a(g,"data-testid","context-title-input"),g.required=!0,a(_,"class","control"),a(p,"class","field"),a(w,"class","label"),a(w,"for","context-summary"),a(R,"id","context-summary"),a(R,"class","textarea svelte-1oesbw7"),a(R,"placeholder","Brief summary of the content (optional)..."),a(R,"data-testid","context-summary-textarea"),a(R,"rows","3"),a(R,"maxlength","500"),a(C,"class","control"),a(N,"class","help svelte-1oesbw7"),a(k,"class","field"),a(Q,"class","label"),a(Q,"for","context-content"),a(A,"id","context-content"),a(A,"class","textarea svelte-1oesbw7"),a(A,"placeholder","Enter the full content..."),a(A,"data-testid","context-content-textarea"),a(A,"rows","8"),A.required=!0,a(D,"class","control"),a(O,"class","field"),a(F,"class","summary svelte-1oesbw7"),a(L,"class","label"),a(V,"class","help svelte-1oesbw7"),a(Y,"class","button is-small is-light"),a(K,"class","content"),a(P,"class","field mt-4"),a(le,"class","details svelte-1oesbw7"),a(e,"class","modal-card-body svelte-1oesbw7"),a(ue,"class","icon"),a(X,"class","button is-primary"),X.disabled=Re=!l[3],a(X,"data-testid","save-context-button"),a(j,"class","control"),a(Le,"class","button is-light"),a(Le,"data-testid","cancel-context-button"),a(Be,"class","control"),a(G,"class","field is-grouped"),a(Ae,"class","help svelte-1oesbw7"),a(me,"class","modal-card-foot")},m(z,J){T(z,e,J),s(e,t),s(t,n),s(t,o),s(t,r),s(r,i),s(i,u);for(let se=0;se<Ne.length;se+=1)Ne[se]&&Ne[se].m(u,null);rt(u,l[2].context_type,!0),s(e,c),s(e,p),s(p,d),s(p,m),s(p,_),s(_,g),Pe(g,l[2].title),s(p,h),ze&&ze.m(p,null),s(e,y),s(e,k),s(k,w),s(k,$),s(k,C),s(C,R),Pe(R,l[2].summary),s(k,I),s(k,N),Ze.m(N,null),s(e,E),s(e,O),s(O,Q),s(O,Z),s(O,D),s(D,A),Pe(A,l[2].content),s(O,te),Qe&&Qe.m(O,null),s(e,B),s(e,le),s(le,F),s(le,U),s(le,P),s(P,L),s(P,H),s(P,K),s(K,V),s(K,ie),nt.m(K,null),s(K,ye),s(K,Y),T(z,oe,J),T(z,me,J),s(me,G),s(G,j),s(j,X),s(X,ue),s(X,ge),s(X,ae),s(ae,_e),s(G,Ve),s(G,Be),s(Be,Le),s(G,Ee),Xe&&Xe.m(G,null),s(me,he),s(me,Ae),Ye||(Ke=[ee(u,"change",l[10]),ee(g,"input",l[11]),ee(R,"input",l[12]),ee(A,"input",l[13]),ee(Y,"click",l[17]),ee(X,"click",l[6]),ee(Le,"click",l[5])],Ye=!0)},p(z,J){if(J&16){Ue=z[4];let se;for(se=0;se<Ue.length;se+=1){const Oe=os(z,Ue,se);Ne[se]?Ne[se].p(Oe,J):(Ne[se]=is(Oe),Ne[se].c(),Ne[se].m(u,null))}for(;se<Ne.length;se+=1)Ne[se].d(1);Ne.length=Ue.length}J&20&&rt(u,z[2].context_type),J&20&&g.value!==z[2].title&&Pe(g,z[2].title),J&4&&(v=z[2].title.trim()===""),v?ze||(ze=rs(),ze.c(),ze.m(p,null)):ze&&(ze.d(1),ze=null),J&20&&Pe(R,z[2].summary),dt===(dt=tt(z))&&Ze?Ze.p(z,J):(Ze.d(1),Ze=dt(z),Ze&&(Ze.c(),Ze.m(N,null))),J&20&&Pe(A,z[2].content),J&4&&(ne=z[2].content.trim()===""),ne?Qe||(Qe=as(),Qe.c(),Qe.m(O,null)):Qe&&(Qe.d(1),Qe=null),Fe===(Fe=pt(z,J))&&nt?nt.p(z,J):(nt.d(1),nt=Fe(z),nt&&(nt.c(),nt.m(K,ye))),J&2&&pe!==(pe=z[1]==="edit"?"Save Changes":"Add Context")&&ce(_e,pe),J&8&&Re!==(Re=!z[3])&&(X.disabled=Re),z[1]==="edit"?Xe?Xe.p(z,J):(Xe=us(z),Xe.c(),Xe.m(G,null)):Xe&&(Xe.d(1),Xe=null)},d(z){z&&S(e),_t(Ne,z),ze&&ze.d(),Ze.d(),Qe&&Qe.d(),nt.d(),z&&S(oe),z&&S(me),Xe&&Xe.d(),Ye=!1,st(Ke)}}}function is(l){let e,t=l[23].label+"",n;return{c(){e=f("option"),n=M(t),e.__value=l[23].value,e.value=e.__value},m(o,r){T(o,e,r),s(e,n)},p:$e,d(o){o&&S(e)}}}function rs(l){let e;return{c(){e=f("p"),e.textContent="Title is required",a(e,"class","help is-danger svelte-1oesbw7")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function oc(l){let e;return{c(){e=M("Optional brief summary (up to 500 characters)")},m(t,n){T(t,e,n)},p:$e,d(t){t&&S(e)}}}function sc(l){let e=l[2].summary.length+"",t,n;return{c(){t=M(e),n=M("/500 characters")},m(o,r){T(o,t,r),T(o,n,r)},p(o,r){r&4&&e!==(e=o[2].summary.length+"")&&ce(t,e)},d(o){o&&S(t),o&&S(n)}}}function as(l){let e;return{c(){e=f("p"),e.textContent="Content is required",a(e,"class","help is-danger svelte-1oesbw7")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function ic(l){let e,t=Object.entries(l[2].metadata),n=[];for(let o=0;o<t.length;o+=1)n[o]=cs(ns(l,t,o));return{c(){for(let o=0;o<n.length;o+=1)n[o].c();e=St()},m(o,r){for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(o,r);T(o,e,r)},p(o,r){if(r&4){t=Object.entries(o[2].metadata);let i;for(i=0;i<t.length;i+=1){const u=ns(o,t,i);n[i]?n[i].p(u,r):(n[i]=cs(u),n[i].c(),n[i].m(e.parentNode,e))}for(;i<n.length;i+=1)n[i].d(1);n.length=t.length}},d(o){_t(n,o),o&&S(e)}}}function rc(l){let e;return{c(){e=f("p"),e.textContent="No metadata defined",a(e,"class","has-text-grey-light")},m(t,n){T(t,e,n)},p:$e,d(t){t&&S(e)}}}function cs(l){let e,t,n,o,r,i,u,c,p,d,m,_,g;function h(...k){return l[14](l[19],l[20],...k)}function v(){l[15].call(u,l[19])}function y(){return l[16](l[19])}return{c(){e=f("div"),t=f("div"),n=f("input"),r=b(),i=f("div"),u=f("input"),c=b(),p=f("div"),d=f("button"),d.innerHTML='<span class="icon"><i class="fas fa-times"></i></span>',m=b(),a(n,"class","input is-small"),a(n,"type","text"),a(n,"placeholder","Key"),n.value=o=l[19],a(t,"class","control is-expanded"),a(u,"class","input is-small"),a(u,"type","text"),a(u,"placeholder","Value"),a(i,"class","control is-expanded"),a(d,"class","button is-small is-danger is-outlined"),a(p,"class","control"),a(e,"class","field is-grouped")},m(k,w){T(k,e,w),s(e,t),s(t,n),s(e,r),s(e,i),s(i,u),Pe(u,l[2].metadata[l[19]]),s(e,c),s(e,p),s(p,d),s(e,m),_||(g=[ee(n,"input",h),ee(u,"input",v),ee(d,"click",y)],_=!0)},p(k,w){l=k,w&20&&o!==(o=l[19])&&n.value!==o&&(n.value=o),w&20&&u.value!==l[2].metadata[l[19]]&&Pe(u,l[2].metadata[l[19]])},d(k){k&&S(e),_=!1,st(g)}}}function us(l){let e,t,n,o,r,i;return{c(){e=f("div"),t=b(),n=f("div"),o=f("button"),o.innerHTML=`<span class="icon"><i class="fas fa-trash"></i></span> 
                <span>Delete</span>`,a(e,"class","control is-expanded"),a(o,"class","button is-danger is-outlined"),a(o,"data-testid","delete-context-button"),a(n,"class","control")},m(u,c){T(u,e,c),T(u,t,c),T(u,n,c),s(n,o),r||(i=ee(o,"click",l[7]),r=!0)},p:$e,d(u){u&&S(e),u&&S(t),u&&S(n),r=!1,i()}}}function ac(l){let e,t,n,o=l[1]==="edit"?"Edit Context Item":"Add Context Item",r,i,u,c,p,d,m=l[2]&&ss(l);return{c(){e=f("div"),t=f("header"),n=f("p"),r=M(o),i=b(),u=f("button"),c=b(),m&&m.c(),a(n,"class","modal-card-title"),a(u,"class","delete"),a(u,"aria-label","close"),a(t,"class","modal-card-head"),a(e,"class","modal-card")},m(_,g){T(_,e,g),s(e,t),s(t,n),s(n,r),s(t,i),s(t,u),s(e,c),m&&m.m(e,null),p||(d=ee(u,"click",l[5]),p=!0)},p(_,g){g&2&&o!==(o=_[1]==="edit"?"Edit Context Item":"Add Context Item")&&ce(r,o),_[2]?m?m.p(_,g):(m=ss(_),m.c(),m.m(e,null)):m&&(m.d(1),m=null)},d(_){_&&S(e),m&&m.d(),p=!1,d()}}}function cc(l){let e,t,n,o;return e=new Ul({props:{active:l[0],$$slots:{default:[ac]},$$scope:{ctx:l}}}),e.$on("close",l[5]),{c(){be(e.$$.fragment)},m(r,i){ke(e,r,i),t=!0,n||(o=ee(window,"keydown",l[8]),n=!0)},p(r,[i]){const u={};i&1&&(u.active=r[0]),i&67108878&&(u.$$scope={dirty:i,ctx:r}),e.$set(u)},i(r){t||(W(e.$$.fragment,r),t=!0)},o(r){x(e.$$.fragment,r),t=!1},d(r){we(e,r),n=!1,o()}}}function uc(l,e,t){let n,{active:o=!1}=e,{context:r=null}=e,{mode:i="edit"}=e;const u=un();let c=null,p=[{value:"Document",label:"Document"},{value:"SearchResult",label:"Search Result"},{value:"UserInput",label:"User Input"},{value:"System",label:"System"},{value:"External",label:"External"}];function d(){t(0,o=!1),t(2,c=null),u("close")}function m(){!n||!c||(u(i==="edit"?"update":"create",c),d())}function _(){i==="edit"&&r&&(u("delete",r.id),d())}function g(I){I.key==="Escape"?d():I.key==="Enter"&&(I.ctrlKey||I.metaKey)&&m()}function h(){c.context_type=Wt(this),t(2,c),t(0,o),t(9,r),t(1,i),t(4,p)}function v(){c.title=this.value,t(2,c),t(0,o),t(9,r),t(1,i),t(4,p)}function y(){c.summary=this.value,t(2,c),t(0,o),t(9,r),t(1,i),t(4,p)}function k(){c.content=this.value,t(2,c),t(0,o),t(9,r),t(1,i),t(4,p)}const w=(I,N,E)=>{const O={...c.metadata};delete O[I],O[E.target.value]=N,t(2,c.metadata=O,c)};function $(I){c.metadata[I]=this.value,t(2,c),t(0,o),t(9,r),t(1,i),t(4,p)}const C=I=>{const N={...c.metadata};delete N[I],t(2,c.metadata=N,c)},R=()=>{t(2,c.metadata={...c.metadata,[`key_${Date.now()}`]:""},c)};return l.$$set=I=>{"active"in I&&t(0,o=I.active),"context"in I&&t(9,r=I.context),"mode"in I&&t(1,i=I.mode)},l.$$.update=()=>{l.$$.dirty&515&&(o&&r?t(2,c={...r,metadata:{...r.metadata}}):o&&i==="create"&&t(2,c={id:"",context_type:"UserInput",title:"",summary:"",content:"",metadata:{},created_at:new Date().toISOString(),relevance_score:null})),l.$$.dirty&4&&t(3,n=c&&c.title.trim()!==""&&c.content.trim()!=="")},[o,i,c,n,p,d,m,_,g,r,h,v,y,k,w,$,C,R]}class fc extends Pt{constructor(e){super(),Ut(this,e,uc,cc,Ot,{active:0,context:9,mode:1})}}function fs(l,e,t){const n=l.slice();return n[34]=e[t],n}function ds(l,e,t){const n=l.slice();return n[34]=e[t],n[38]=t,n}function ps(l){let e,t=l[7],n=[];for(let o=0;o<t.length;o+=1)n[o]=ms(ds(l,t,o));return{c(){e=f("ul");for(let o=0;o<n.length;o+=1)n[o].c();a(e,"class","suggestions svelte-k0eopx"),a(e,"data-testid","kg-autocomplete-list")},m(o,r){T(o,e,r);for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(e,null)},p(o,r){if(r[0]&1408){t=o[7];let i;for(i=0;i<t.length;i+=1){const u=ds(o,t,i);n[i]?n[i].p(u,r):(n[i]=ms(u),n[i].c(),n[i].m(e,null))}for(;i<n.length;i+=1)n[i].d(1);n.length=t.length}},d(o){o&&S(e),_t(n,o)}}}function ms(l){let e,t=l[34]+"",n,o,r,i,u,c;function p(){return l[22](l[34])}function d(...m){return l[23](l[34],...m)}return{c(){e=f("li"),n=M(t),o=b(),a(e,"tabindex","0"),a(e,"role","option"),a(e,"aria-selected",r=l[38]===l[8]),a(e,"aria-label",i=`Apply suggestion: ${l[34]}`),a(e,"data-testid","kg-autocomplete-item"),a(e,"class","svelte-k0eopx"),vt(e,"active",l[38]===l[8])},m(m,_){T(m,e,_),s(e,n),s(e,o),u||(c=[ee(e,"click",p),ee(e,"keydown",d)],u=!0)},p(m,_){l=m,_[0]&128&&t!==(t=l[34]+"")&&ce(n,t),_[0]&256&&r!==(r=l[38]===l[8])&&a(e,"aria-selected",r),_[0]&128&&i!==(i=`Apply suggestion: ${l[34]}`)&&a(e,"aria-label",i),_[0]&256&&vt(e,"active",l[38]===l[8])},d(m){m&&S(e),u=!1,st(c)}}}function dc(l){let e,t,n,o,r,i;function u(m){l[20](m)}function c(m){l[21](m)}let p={placeholder:"Search knowledge graph terms...",type:"search",disabled:l[4],icon:"search",expanded:!0,autofocus:!0,"data-testid":"kg-search-input"};l[2]!==void 0&&(p.element=l[2]),l[1]!==void 0&&(p.value=l[1]),t=new bl({props:p}),mt.push(()=>kt(t,"element",u)),mt.push(()=>kt(t,"value",c)),t.$on("input",l[11]),t.$on("keydown",l[12]);let d=l[7].length>0&&ps(l);return{c(){e=f("div"),be(t.$$.fragment),r=b(),d&&d.c(),a(e,"class","input-wrapper svelte-k0eopx")},m(m,_){T(m,e,_),ke(t,e,null),s(e,r),d&&d.m(e,null),i=!0},p(m,_){const g={};_[0]&16&&(g.disabled=m[4]),!n&&_[0]&4&&(n=!0,g.element=m[2],wt(()=>n=!1)),!o&&_[0]&2&&(o=!0,g.value=m[1],wt(()=>o=!1)),t.$set(g),m[7].length>0?d?d.p(m,_):(d=ps(m),d.c(),d.m(e,null)):d&&(d.d(1),d=null)},i(m){i||(W(t.$$.fragment,m),i=!0)},o(m){x(t.$$.fragment,m),i=!1},d(m){m&&S(e),we(t),d&&d.d()}}}function _s(l){let e,t;return e=new an({props:{type:"is-danger","data-testid":"kg-search-error",$$slots:{default:[pc]},$$scope:{ctx:l}}}),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},p(n,o){const r={};o[0]&32|o[1]&256&&(r.$$scope={dirty:o,ctx:n}),e.$set(r)},i(n){t||(W(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function pc(l){let e;return{c(){e=M(l[5])},m(t,n){T(t,e,n)},p(t,n){n[0]&32&&ce(e,t[5])},d(t){t&&S(e)}}}function mc(l){let e,t,n,o,r,i,u;return{c(){e=f("div"),t=f("p"),t.textContent="Enter at least 2 characters to search the knowledge graph",n=b(),o=f("p"),r=M('This will search terms from the knowledge graph for role "'),i=M(l[9]),u=M('"'),a(t,"class","has-text-centered"),a(o,"class","has-text-centered is-size-7 mt-2"),a(e,"class","notification is-info is-light")},m(c,p){T(c,e,p),s(e,t),s(e,n),s(e,o),s(o,r),s(o,i),s(o,u)},p(c,p){p[0]&512&&ce(i,c[9])},d(c){c&&S(e)}}}function _c(l){let e,t,n,o,r,i,u,c,p,d,m;return{c(){e=f("div"),t=f("p"),n=M('No knowledge graph terms found for "'),o=f("strong"),r=M(l[1]),i=M('"'),u=b(),c=f("p"),p=M('Try different keywords or check if the role "'),d=M(l[9]),m=M('" has a knowledge graph enabled.'),a(t,"class","has-text-centered"),a(c,"class","has-text-centered is-size-7 has-text-grey mt-2"),a(e,"class","notification is-light"),a(e,"data-testid","kg-search-empty")},m(_,g){T(_,e,g),s(e,t),s(t,n),s(t,o),s(o,r),s(t,i),s(e,u),s(e,c),s(c,p),s(c,d),s(c,m)},p(_,g){g[0]&2&&ce(r,_[1]),g[0]&512&&ce(d,_[9])},d(_){_&&S(e)}}}function gc(l){let e,t=l[3],n=[];for(let o=0;o<t.length;o+=1)n[o]=bs(fs(l,t,o));return{c(){e=f("div");for(let o=0;o<n.length;o+=1)n[o].c();a(e,"class","suggestions-container svelte-k0eopx"),a(e,"data-testid","kg-suggestions-list")},m(o,r){T(o,e,r);for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(e,null)},p(o,r){if(r[0]&8264){t=o[3];let i;for(i=0;i<t.length;i+=1){const u=fs(o,t,i);n[i]?n[i].p(u,r):(n[i]=bs(u),n[i].c(),n[i].m(e,null))}for(;i<n.length;i+=1)n[i].d(1);n.length=t.length}},d(o){o&&S(e),_t(n,o)}}}function hc(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="progress-container svelte-k0eopx"><div class="progress-bar svelte-k0eopx"><div class="progress-fill svelte-k0eopx"></div></div></div> 
          <p>Searching knowledge graph...</p>`,a(e,"class","empty-state svelte-k0eopx"),a(e,"data-testid","kg-search-loading")},m(t,n){T(t,e,n)},p:$e,d(t){t&&S(e)}}}function gs(l){let e,t,n=l[34].normalized_term+"",o;return{c(){e=f("span"),t=M("→ "),o=M(n),a(e,"class","has-text-grey")},m(r,i){T(r,e,i),s(e,t),s(e,o)},p(r,i){i[0]&8&&n!==(n=r[34].normalized_term+"")&&ce(o,n)},d(r){r&&S(e)}}}function hs(l){let e,t=l[34].suggestion_type+"",n;return{c(){e=f("span"),n=M(t),a(e,"class","tag is-small is-light")},m(o,r){T(o,e,r),s(e,n)},p(o,r){r[0]&8&&t!==(t=o[34].suggestion_type+"")&&ce(n,t)},d(o){o&&S(e)}}}function vs(l){let e,t=l[34].url+"",n;return{c(){e=f("div"),n=M(t),a(e,"class","suggestion-url svelte-k0eopx")},m(o,r){T(o,e,r),s(e,n)},p(o,r){r[0]&8&&t!==(t=o[34].url+"")&&ce(n,t)},d(o){o&&S(e)}}}function bs(l){let e,t,n=l[34].term+"",o,r,i,u,c=(l[34].score*100).toFixed(0)+"",p,d,m,_,g,h,v,y,k,w=l[34].normalized_term&&l[34].normalized_term!==l[34].term&&gs(l),$=l[34].suggestion_type&&hs(l),C=l[34].url&&vs(l);function R(){return l[24](l[34])}function I(...N){return l[25](l[34],...N)}return{c(){var N;e=f("button"),t=f("div"),o=M(n),r=b(),i=f("div"),u=f("span"),p=M(c),d=M("%"),m=b(),w&&w.c(),_=b(),$&&$.c(),g=b(),C&&C.c(),h=b(),a(t,"class","suggestion-term svelte-k0eopx"),a(u,"class","tag is-info is-small"),a(i,"class","suggestion-meta svelte-k0eopx"),a(e,"class",v="suggestion-item "+(((N=l[6])==null?void 0:N.term)===l[34].term?"is-active":"")+" svelte-k0eopx"),a(e,"type","button"),a(e,"data-testid","kg-suggestion-item")},m(N,E){T(N,e,E),s(e,t),s(t,o),s(e,r),s(e,i),s(i,u),s(u,p),s(u,d),s(i,m),w&&w.m(i,null),s(i,_),$&&$.m(i,null),s(e,g),C&&C.m(e,null),s(e,h),y||(k=[ee(e,"click",R),ee(e,"keydown",I)],y=!0)},p(N,E){var O;l=N,E[0]&8&&n!==(n=l[34].term+"")&&ce(o,n),E[0]&8&&c!==(c=(l[34].score*100).toFixed(0)+"")&&ce(p,c),l[34].normalized_term&&l[34].normalized_term!==l[34].term?w?w.p(l,E):(w=gs(l),w.c(),w.m(i,_)):w&&(w.d(1),w=null),l[34].suggestion_type?$?$.p(l,E):($=hs(l),$.c(),$.m(i,null)):$&&($.d(1),$=null),l[34].url?C?C.p(l,E):(C=vs(l),C.c(),C.m(e,h)):C&&(C.d(1),C=null),E[0]&72&&v!==(v="suggestion-item "+(((O=l[6])==null?void 0:O.term)===l[34].term?"is-active":"")+" svelte-k0eopx")&&a(e,"class",v)},d(N){N&&S(e),w&&w.d(),$&&$.d(),C&&C.d(),y=!1,st(k)}}}function vc(l){let e;return{c(){e=M("Cancel")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function ks(l){let e,t;return e=new pl({props:{type:"is-primary",disabled:!l[6],"data-testid":"kg-add-term-button",$$slots:{default:[bc]},$$scope:{ctx:l}}}),e.$on("click",l[14]),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},p(n,o){const r={};o[0]&64&&(r.disabled=!n[6]),o[0]&64|o[1]&256&&(r.$$scope={dirty:o,ctx:n}),e.$set(r)},i(n){t||(W(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function bc(l){let e,t=l[6].term+"",n,o;return{c(){e=M('Add "'),n=M(t),o=M('" to Context')},m(r,i){T(r,e,i),T(r,n,i),T(r,o,i)},p(r,i){i[0]&64&&t!==(t=r[6].term+"")&&ce(n,t)},d(r){r&&S(e),r&&S(n),r&&S(o)}}}function kc(l){let e;return{c(){e=M("Add Complete Thesaurus to Context")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function wc(l){let e,t,n,o,r,i,u,c,p,d,m,_,g,h,v,y,k,w,$,C,R,I,N,E,O,Q,Z,D,A;c=new dl({props:{$$slots:{default:[dc]},$$scope:{ctx:l}}});let te=l[5]&&_s(l);function ne(U,P){return P[0]&2&&(m=null),U[4]?hc:U[3].length>0?gc:(m==null&&(m=U[1].trim().length>=2),m?_c:mc)}let B=ne(l,[-1,-1]),le=B(l);v=new pl({props:{$$slots:{default:[vc]},$$scope:{ctx:l}}}),v.$on("click",l[16]);let F=l[6]&&ks(l);return Q=new pl({props:{type:"is-link",size:"is-small",style:"width: 100%;","data-testid":"kg-add-index-button",$$slots:{default:[kc]},$$scope:{ctx:l}}}),Q.$on("click",l[15]),{c(){e=f("div"),t=f("div"),n=f("button"),o=b(),r=f("div"),r.innerHTML=`<div class="modal-title svelte-k0eopx"><h3 class="svelte-k0eopx">Knowledge Graph Search</h3> 
          <p class="svelte-k0eopx">Search and add terms from the knowledge graph to your context</p></div>`,i=b(),u=f("div"),be(c.$$.fragment),p=b(),te&&te.c(),d=b(),le.c(),_=b(),g=f("div"),h=f("div"),be(v.$$.fragment),y=b(),F&&F.c(),k=b(),w=f("div"),$=f("div"),C=f("p"),R=f("strong"),R.textContent="Alternative:",I=M(' Add the complete thesaurus for role "'),N=M(l[9]),E=M('". This includes all domain-specific terms and their normalized mappings in JSON format for comprehensive vocabulary context.'),O=b(),be(Q.$$.fragment),a(n,"class","delete is-large modal-close-btn svelte-k0eopx"),a(n,"aria-label","close"),a(r,"class","modal-header svelte-k0eopx"),a(u,"class","search-section svelte-k0eopx"),a(h,"class","action-buttons svelte-k0eopx"),a(g,"class","modal-actions svelte-k0eopx"),a(C,"class","svelte-k0eopx"),a($,"class","alternative-content svelte-k0eopx"),a(w,"class","alternative-section svelte-k0eopx"),a(t,"class","kg-search-container svelte-k0eopx"),a(e,"class","box wrapper svelte-k0eopx"),a(e,"data-testid","kg-search-modal")},m(U,P){T(U,e,P),s(e,t),s(t,n),s(t,o),s(t,r),s(t,i),s(t,u),ke(c,u,null),s(t,p),te&&te.m(t,null),s(t,d),le.m(t,null),s(t,_),s(t,g),s(g,h),ke(v,h,null),s(h,y),F&&F.m(h,null),s(t,k),s(t,w),s(w,$),s($,C),s(C,R),s(C,I),s(C,N),s(C,E),s(w,O),ke(Q,w,null),Z=!0,D||(A=[ee(n,"click",l[16]),ee(t,"keydown",l[12])],D=!0)},p(U,P){const L={};P[0]&406|P[1]&256&&(L.$$scope={dirty:P,ctx:U}),c.$set(L),U[5]?te?(te.p(U,P),P[0]&32&&W(te,1)):(te=_s(U),te.c(),W(te,1),te.m(t,d)):te&&(We(),x(te,1,1,()=>{te=null}),Je()),B===(B=ne(U,P))&&le?le.p(U,P):(le.d(1),le=B(U),le&&(le.c(),le.m(t,_)));const H={};P[1]&256&&(H.$$scope={dirty:P,ctx:U}),v.$set(H),U[6]?F?(F.p(U,P),P[0]&64&&W(F,1)):(F=ks(U),F.c(),W(F,1),F.m(h,null)):F&&(We(),x(F,1,1,()=>{F=null}),Je()),(!Z||P[0]&512)&&ce(N,U[9]);const K={};P[1]&256&&(K.$$scope={dirty:P,ctx:U}),Q.$set(K)},i(U){Z||(W(c.$$.fragment,U),W(te),W(v.$$.fragment,U),W(F),W(Q.$$.fragment,U),Z=!0)},o(U){x(c.$$.fragment,U),x(te),x(v.$$.fragment,U),x(F),x(Q.$$.fragment,U),Z=!1},d(U){U&&S(e),we(c),te&&te.d(),le.d(),we(v),F&&F.d(),we(Q),D=!1,st(A)}}}function yc(l){let e,t,n;function o(i){l[26](i)}let r={$$slots:{default:[wc]},$$scope:{ctx:l}};return l[0]!==void 0&&(r.active=l[0]),e=new Ul({props:r}),mt.push(()=>kt(e,"active",o)),e.$on("close",l[16]),{c(){be(e.$$.fragment)},m(i,u){ke(e,i,u),n=!0},p(i,u){const c={};u[0]&1022|u[1]&256&&(c.$$scope={dirty:u,ctx:i}),!t&&u[0]&1&&(t=!0,c.active=i[0],wt(()=>t=!1)),e.$set(c)},i(i){n||(W(e.$$.fragment,i),n=!0)},o(i){x(e.$$.fragment,i),n=!1},d(i){we(e,i)}}}function Cc(l,e,t){let n,o;qe(l,$t,L=>t(9,n=L)),qe(l,bt,L=>t(28,o=L));let{active:r=!1}=e,{initialQuery:i=""}=e,{conversationId:u=null}=e;const c=un();let p="",d=[],m=!1,_=null,g=null,h=null,v=[],y=-1,k,w=!1;function $(){h&&clearTimeout(h),h=setTimeout(()=>{p.trim().length>=2?O():(t(3,d=[]),t(6,g=null))},300)}async function C(L){const H=L.trim();if(!H||H.length<2)return[];try{if(o){const K=await He("get_autocomplete_suggestions",{query:H,roleName:n,limit:8});if((K==null?void 0:K.status)==="success"&&Array.isArray(K.suggestions))return K.suggestions.map(V=>V.term)}else{const K=await fetch(`${ct.ServerURL}/autocomplete/${encodeURIComponent(n)}/${encodeURIComponent(H)}`);if(K.ok){const V=await K.json();if((V==null?void 0:V.status)==="success"&&Array.isArray(V.suggestions))return V.suggestions.map(ie=>ie.term)}}}catch(K){console.warn("KG autocomplete failed",K)}return[]}async function R(){const L=p.trim();if(L.length<2){t(7,v=[]),t(8,y=-1);return}try{const H=await C(L);t(7,v=H),t(8,y=-1)}catch(H){console.warn("Failed to get autocomplete suggestions:",H),t(7,v=[]),t(8,y=-1)}}function I(L){t(1,p=L),t(7,v=[]),t(8,y=-1),p.trim().length>=2&&O()}async function N(L){$(),await R()}function E(L){v.length>0?L.key==="ArrowDown"?(L.preventDefault(),t(8,y=(y+1)%v.length)):L.key==="ArrowUp"?(L.preventDefault(),t(8,y=(y-1+v.length)%v.length)):(L.key==="Enter"||L.key==="Tab")&&y!==-1?(L.preventDefault(),I(v[y])):L.key==="Escape"&&(L.preventDefault(),t(7,v=[]),t(8,y=-1)):L.key==="Enter"?(L.preventDefault(),g&&Z()):L.key==="Escape"&&A()}async function O(){if(!p.trim()||p.trim().length<2){t(3,d=[]);return}t(4,m=!0),t(5,_=null);try{if(o){const L=await He("search_kg_terms",{request:{query:p.trim(),role_name:n,limit:20,min_similarity:.6}});L.status==="success"?(t(3,d=L.suggestions||[]),d.length>0&&!g&&t(6,g=d[0])):(t(5,_=L.error||"Search failed"),t(3,d=[]))}else{if(!u){t(5,_="No active conversation. Please start a conversation first."),t(3,d=[]);return}const L=await fetch(`${ct.ServerURL}/conversations/${u}/context/kg/search?query=${encodeURIComponent(p.trim())}&role=${encodeURIComponent(n)}`);if(L.ok){const H=await L.json();H.status==="success"?(t(3,d=H.suggestions||[]),d.length>0&&!g&&t(6,g=d[0])):(t(5,_=H.error||"Search failed"),t(3,d=[]))}else t(5,_=`HTTP ${L.status}: ${L.statusText}`),t(3,d=[])}}catch(L){console.error("KG search error:",L),t(5,_=`Search failed: ${L}`),t(3,d=[])}finally{t(4,m=!1)}}function Q(L){t(6,g=L)}async function Z(){if(g){if(!u){t(5,_="No active conversation. Please start a conversation first.");return}try{if(o)await He("add_kg_term_context",{request:{conversation_id:u,term:g.term,role_name:n}}),c("termAdded",{term:g.term,suggestion:g}),A();else{const L=await fetch(`${ct.ServerURL}/conversations/${u}/context/kg/term`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({term:g.term,role:n})});if(L.ok){const H=await L.json();H.status==="success"?(c("termAdded",{term:g.term,suggestion:g}),A()):t(5,_=H.error||"Failed to add term to context")}else t(5,_=`HTTP ${L.status}: ${L.statusText}`)}}catch(L){console.error("Error adding term to context:",L),t(5,_=`Failed to add term to context: ${L}`)}}}async function D(){if(!u){t(5,_="No active conversation. Please start a conversation first.");return}try{if(o)await He("add_kg_index_context",{request:{conversation_id:u,role_name:n}}),c("kgIndexAdded",{role:n}),A();else{const L=await fetch(`${ct.ServerURL}/conversations/${u}/context/kg/index`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({role:n})});if(L.ok){const H=await L.json();H.status==="success"?(c("kgIndexAdded",{role:n}),A()):t(5,_=H.error||"Failed to add KG index to context")}else t(5,_=`HTTP ${L.status}: ${L.statusText}`)}}catch(L){console.error("Error adding KG index to context:",L),t(5,_=`Failed to add KG index to context: ${L}`)}}function A(){t(0,r=!1),t(1,p=""),t(3,d=[]),t(6,g=null),t(5,_=null),t(4,m=!1),t(7,v=[]),t(8,y=-1),h&&(clearTimeout(h),h=null)}rn(()=>{h&&clearTimeout(h)});function te(L){k=L,t(2,k)}function ne(L){p=L,t(1,p),t(0,r),t(19,w),t(17,i)}const B=L=>I(L),le=(L,H)=>{(H.key==="Enter"||H.key===" ")&&(H.preventDefault(),I(L))},F=L=>Q(L),U=(L,H)=>H.key==="Enter"&&Q(L);function P(L){r=L,t(0,r)}return l.$$set=L=>{"active"in L&&t(0,r=L.active),"initialQuery"in L&&t(17,i=L.initialQuery),"conversationId"in L&&t(18,u=L.conversationId)},l.$$.update=()=>{l.$$.dirty[0]&655363&&r&&!w&&(t(1,p=i),t(19,w=!0),p.trim()&&O()),l.$$.dirty[0]&1&&(r||t(19,w=!1)),l.$$.dirty[0]&5&&r&&k&&setTimeout(()=>{k==null||k.focus(),t(5,_=null)},100)},[r,p,k,d,m,_,g,v,y,n,I,N,E,Q,Z,D,A,i,u,w,te,ne,B,le,F,U,P]}class Sc extends Pt{constructor(e){super(),Ut(this,e,Cc,yc,Ot,{active:0,initialQuery:17,conversationId:18},null,[-1,-1])}}function Tc(l){const e=l.slice(),t=e[0].kg_index_info;return e[9]=t,e}function $c(l){const e=l.slice(),t=e[0].kg_term_definition;return e[8]=t,e}function Rc(l){let e=l[0].context_type==="KGTermDefinition"?"KG Term":"KG Index",t;return{c(){t=M(e)},m(n,o){T(n,t,o)},p(n,o){o&1&&e!==(e=n[0].context_type==="KGTermDefinition"?"KG Term":"KG Index")&&ce(t,e)},d(n){n&&S(t)}}}function Lc(l){let e;return{c(){e=M("👁️")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function ws(l){let e,t;return e=new pl({props:{type:"is-ghost",title:"Remove from context",$$slots:{default:[Ec]},$$scope:{ctx:l}}}),e.$on("click",l[5]),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},p(n,o){const r={};o&1024&&(r.$$scope={dirty:o,ctx:n}),e.$set(r)},i(n){t||(W(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function Ec(l){let e;return{c(){e=M("❌")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function Ac(l){let e,t,n,o=El(l[9].total_terms)+"",r,i,u,c,p,d,m,_=El(l[9].total_nodes)+"",g,h,v,y,k,w,$,C=El(l[9].total_edges)+"",R,I,N,E,O,Q,Z,D=(l[9].version||"N/A")+"",A,te,ne,B,le,F,U,P=!l[2]&&ys();return{c(){e=f("div"),t=f("div"),n=f("div"),r=M(o),u=b(),c=f("div"),c.textContent="Terms",p=b(),d=f("div"),m=f("div"),g=M(_),v=b(),y=f("div"),y.textContent="Nodes",k=b(),w=f("div"),$=f("div"),R=M(C),N=b(),E=f("div"),E.textContent="Edges",O=b(),Q=f("div"),Z=f("div"),A=M(D),ne=b(),B=f("div"),B.textContent="Version",F=b(),P&&P.c(),U=St(),a(n,"class",i="stat-value "+(l[2]?"compact":"")+" svelte-tet355"),a(c,"class","stat-label svelte-tet355"),a(t,"class","stat-item svelte-tet355"),a(m,"class",h="stat-value "+(l[2]?"compact":"")+" svelte-tet355"),a(y,"class","stat-label svelte-tet355"),a(d,"class","stat-item svelte-tet355"),a($,"class",I="stat-value "+(l[2]?"compact":"")+" svelte-tet355"),a(E,"class","stat-label svelte-tet355"),a(w,"class","stat-item svelte-tet355"),a(Z,"class",te="stat-value "+(l[2]?"compact":"")+" svelte-tet355"),a(B,"class","stat-label svelte-tet355"),a(Q,"class","stat-item svelte-tet355"),a(e,"class",le="kg-index-stats "+(l[2]?"compact":"")+" svelte-tet355")},m(L,H){T(L,e,H),s(e,t),s(t,n),s(n,r),s(t,u),s(t,c),s(e,p),s(e,d),s(d,m),s(m,g),s(d,v),s(d,y),s(e,k),s(e,w),s(w,$),s($,R),s(w,N),s(w,E),s(e,O),s(e,Q),s(Q,Z),s(Z,A),s(Q,ne),s(Q,B),T(L,F,H),P&&P.m(L,H),T(L,U,H)},p(L,H){H&1&&o!==(o=El(L[9].total_terms)+"")&&ce(r,o),H&4&&i!==(i="stat-value "+(L[2]?"compact":"")+" svelte-tet355")&&a(n,"class",i),H&1&&_!==(_=El(L[9].total_nodes)+"")&&ce(g,_),H&4&&h!==(h="stat-value "+(L[2]?"compact":"")+" svelte-tet355")&&a(m,"class",h),H&1&&C!==(C=El(L[9].total_edges)+"")&&ce(R,C),H&4&&I!==(I="stat-value "+(L[2]?"compact":"")+" svelte-tet355")&&a($,"class",I),H&1&&D!==(D=(L[9].version||"N/A")+"")&&ce(A,D),H&4&&te!==(te="stat-value "+(L[2]?"compact":"")+" svelte-tet355")&&a(Z,"class",te),H&4&&le!==(le="kg-index-stats "+(L[2]?"compact":"")+" svelte-tet355")&&a(e,"class",le),L[2]?P&&(P.d(1),P=null):P||(P=ys(),P.c(),P.m(U.parentNode,U))},i:$e,o:$e,d(L){L&&S(e),L&&S(F),P&&P.d(L),L&&S(U)}}}function Dc(l){let e,t,n,o,r,i,u,c,p,d=l[8].definition&&Cs(l),m=l[8].synonyms&&l[8].synonyms.length>0&&Ss(l),_=l[8].related_terms&&l[8].related_terms.length>0&&Ts(l),g=l[8].usage_examples&&l[8].usage_examples.length>0&&$s(l),h=l[8].url&&Rs(l);return{c(){e=f("div"),d&&d.c(),t=b(),n=f("div"),m&&m.c(),o=b(),_&&_.c(),r=b(),g&&g.c(),i=b(),h&&h.c(),a(n,"class",u="term-metadata "+(l[2]?"compact":"")+" svelte-tet355"),a(e,"class",c="term-definition "+(l[2]?"compact":"")+" svelte-tet355")},m(v,y){T(v,e,y),d&&d.m(e,null),s(e,t),s(e,n),m&&m.m(n,null),s(n,o),_&&_.m(n,null),s(n,r),g&&g.m(n,null),s(n,i),h&&h.m(n,null),p=!0},p(v,y){v[8].definition?d?d.p(v,y):(d=Cs(v),d.c(),d.m(e,t)):d&&(d.d(1),d=null),v[8].synonyms&&v[8].synonyms.length>0?m?(m.p(v,y),y&1&&W(m,1)):(m=Ss(v),m.c(),W(m,1),m.m(n,o)):m&&(We(),x(m,1,1,()=>{m=null}),Je()),v[8].related_terms&&v[8].related_terms.length>0?_?(_.p(v,y),y&1&&W(_,1)):(_=Ts(v),_.c(),W(_,1),_.m(n,r)):_&&(We(),x(_,1,1,()=>{_=null}),Je()),v[8].usage_examples&&v[8].usage_examples.length>0?g?(g.p(v,y),y&1&&W(g,1)):(g=$s(v),g.c(),W(g,1),g.m(n,i)):g&&(We(),x(g,1,1,()=>{g=null}),Je()),v[8].url?h?y&1&&W(h,1):(h=Rs(v),h.c(),W(h,1),h.m(n,null)):h&&(We(),x(h,1,1,()=>{h=null}),Je()),(!p||y&4&&u!==(u="term-metadata "+(v[2]?"compact":"")+" svelte-tet355"))&&a(n,"class",u),(!p||y&4&&c!==(c="term-definition "+(v[2]?"compact":"")+" svelte-tet355"))&&a(e,"class",c)},i(v){p||(W(m),W(_),W(g),W(h),p=!0)},o(v){x(m),x(_),x(g),x(h),p=!1},d(v){v&&S(e),d&&d.d(),m&&m.d(),_&&_.d(),g&&g.d(),h&&h.d()}}}function ys(l){let e;return{c(){e=f("div"),e.innerHTML='<p class="is-size-7"><strong>Thesaurus Data:</strong> This context item contains the complete thesaurus as JSON, providing all domain-specific vocabulary and term mappings for comprehensive AI understanding.</p>',a(e,"class","notification is-success is-light mt-3")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function Cs(l){let e,t=l[8].definition+"",n,o;return{c(){e=f("div"),n=M(t),a(e,"class",o="definition-text "+(l[2]?"compact":"")+" svelte-tet355")},m(r,i){T(r,e,i),s(e,n)},p(r,i){i&1&&t!==(t=r[8].definition+"")&&ce(n,t),i&4&&o!==(o="definition-text "+(r[2]?"compact":"")+" svelte-tet355")&&a(e,"class",o)},d(r){r&&S(e)}}}function Ss(l){let e,t;return e=new ml({props:{type:"is-light",rounded:!0,title:"Synonyms",$$slots:{default:[Nc]},$$scope:{ctx:l}}}),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},p(n,o){const r={};o&1025&&(r.$$scope={dirty:o,ctx:n}),e.$set(r)},i(n){t||(W(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function Nc(l){let e,t=l[8].synonyms.length+"",n,o,r=l[8].synonyms.length!==1?"s":"",i;return{c(){e=M("≈ "),n=M(t),o=M(" synonym"),i=M(r)},m(u,c){T(u,e,c),T(u,n,c),T(u,o,c),T(u,i,c)},p(u,c){c&1&&t!==(t=u[8].synonyms.length+"")&&ce(n,t),c&1&&r!==(r=u[8].synonyms.length!==1?"s":"")&&ce(i,r)},d(u){u&&S(e),u&&S(n),u&&S(o),u&&S(i)}}}function Ts(l){let e,t;return e=new ml({props:{type:"is-light",rounded:!0,title:"Related Terms",$$slots:{default:[Ic]},$$scope:{ctx:l}}}),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},p(n,o){const r={};o&1025&&(r.$$scope={dirty:o,ctx:n}),e.$set(r)},i(n){t||(W(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function Ic(l){let e,t=l[8].related_terms.length+"",n,o;return{c(){e=M("🔗 "),n=M(t),o=M(" related")},m(r,i){T(r,e,i),T(r,n,i),T(r,o,i)},p(r,i){i&1&&t!==(t=r[8].related_terms.length+"")&&ce(n,t)},d(r){r&&S(e),r&&S(n),r&&S(o)}}}function $s(l){let e,t;return e=new ml({props:{type:"is-light",rounded:!0,title:"Usage Examples",$$slots:{default:[Oc]},$$scope:{ctx:l}}}),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},p(n,o){const r={};o&1025&&(r.$$scope={dirty:o,ctx:n}),e.$set(r)},i(n){t||(W(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function Oc(l){let e,t=l[8].usage_examples.length+"",n,o,r=l[8].usage_examples.length!==1?"s":"",i;return{c(){e=M("💬 "),n=M(t),o=M(" example"),i=M(r)},m(u,c){T(u,e,c),T(u,n,c),T(u,o,c),T(u,i,c)},p(u,c){c&1&&t!==(t=u[8].usage_examples.length+"")&&ce(n,t),c&1&&r!==(r=u[8].usage_examples.length!==1?"s":"")&&ce(i,r)},d(u){u&&S(e),u&&S(n),u&&S(o),u&&S(i)}}}function Rs(l){let e,t;return e=new ml({props:{type:"is-link",rounded:!0,$$slots:{default:[Mc]},$$scope:{ctx:l}}}),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},i(n){t||(W(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function Mc(l){let e;return{c(){e=M("🔗 Source")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function Ls(l){let e,t=l[0].summary+"",n;return{c(){e=f("div"),n=M(t),a(e,"class","context-summary svelte-tet355")},m(o,r){T(o,e,r),s(e,n)},p(o,r){r&1&&t!==(t=o[0].summary+"")&&ce(n,t)},d(o){o&&S(e)}}}function Es(l){let e,t,n=(l[0].relevance_score*100).toFixed(0)+"",o,r;return{c(){e=f("span"),t=M("Relevance: "),o=M(n),r=M("%"),a(e,"class","relevance-score svelte-tet355")},m(i,u){T(i,e,u),s(e,t),s(e,o),s(e,r)},p(i,u){u&1&&n!==(n=(i[0].relevance_score*100).toFixed(0)+"")&&ce(o,n)},d(i){i&&S(e)}}}function As(l){let e,t,n=(l[0].metadata.document_title||l[0].metadata.source_document)+"",o;return{c(){e=f("span"),t=M("📄 "),o=M(n),a(e,"title","Source Document")},m(r,i){T(r,e,i),s(e,t),s(e,o)},p(r,i){i&1&&n!==(n=(r[0].metadata.document_title||r[0].metadata.source_document)+"")&&ce(o,n)},d(r){r&&S(e)}}}function Pc(l){var ye;let e,t,n,o,r,i,u,c=l[0].title+"",p,d,m,_,g,h,v,y,k,w,$,C,R,I,N,E,O,Q,Z,D=Ds(l[0].created_at)+"",A,te,ne,B,le,F;_=new ml({props:{type:l[3],rounded:!0,$$slots:{default:[Rc]},$$scope:{ctx:l}}}),v=new pl({props:{type:"is-ghost",title:"View details",$$slots:{default:[Lc]},$$scope:{ctx:l}}}),v.$on("click",l[6]);let U=l[1]&&ws(l);const P=[Dc,Ac],L=[];function H(Y,oe){return Y[0].context_type==="KGTermDefinition"&&Y[0].kg_term_definition?0:Y[0].context_type==="KGIndex"&&Y[0].kg_index_info?1:-1}function K(Y,oe){if(oe===0)return $c(Y);if(oe===1)return Tc(Y)}~(C=H(l))&&(R=L[C]=P[C](K(l,C)));let V=l[0].summary&&!l[2]&&Ls(l),ie=l[0].relevance_score&&Es(l),re=((ye=l[0].metadata)==null?void 0:ye.source_document)&&As(l);return{c(){e=f("div"),t=f("div"),n=f("div"),o=f("span"),r=M(l[4]),i=b(),u=f("span"),p=M(c),m=b(),be(_.$$.fragment),g=b(),h=f("div"),be(v.$$.fragment),y=b(),U&&U.c(),w=b(),$=f("div"),R&&R.c(),I=b(),V&&V.c(),E=b(),O=f("div"),Q=f("span"),Z=M("Added "),A=M(D),te=b(),ie&&ie.c(),ne=b(),re&&re.c(),a(o,"class","context-icon svelte-tet355"),a(u,"class",d="context-title-text "+(l[2]?"compact":"")+" svelte-tet355"),a(n,"class","context-title svelte-tet355"),a(h,"class","context-actions svelte-tet355"),a(t,"class",k="context-header "+(l[2]?"compact":"")+" svelte-tet355"),a($,"class",N="context-content "+(l[2]?"compact":"")+" svelte-tet355"),a(O,"class",B="context-meta "+(l[2]?"compact":"")+" svelte-tet355"),a(e,"class",le="kg-context-item "+(l[2]?"compact":"")+" svelte-tet355")},m(Y,oe){T(Y,e,oe),s(e,t),s(t,n),s(n,o),s(o,r),s(n,i),s(n,u),s(u,p),s(n,m),ke(_,n,null),s(t,g),s(t,h),ke(v,h,null),s(h,y),U&&U.m(h,null),s(e,w),s(e,$),~C&&L[C].m($,null),s($,I),V&&V.m($,null),s(e,E),s(e,O),s(O,Q),s(Q,Z),s(Q,A),s(O,te),ie&&ie.m(O,null),s(O,ne),re&&re.m(O,null),F=!0},p(Y,[oe]){var X;(!F||oe&16)&&ce(r,Y[4]),(!F||oe&1)&&c!==(c=Y[0].title+"")&&ce(p,c),(!F||oe&4&&d!==(d="context-title-text "+(Y[2]?"compact":"")+" svelte-tet355"))&&a(u,"class",d);const me={};oe&8&&(me.type=Y[3]),oe&1025&&(me.$$scope={dirty:oe,ctx:Y}),_.$set(me);const G={};oe&1024&&(G.$$scope={dirty:oe,ctx:Y}),v.$set(G),Y[1]?U?(U.p(Y,oe),oe&2&&W(U,1)):(U=ws(Y),U.c(),W(U,1),U.m(h,null)):U&&(We(),x(U,1,1,()=>{U=null}),Je()),(!F||oe&4&&k!==(k="context-header "+(Y[2]?"compact":"")+" svelte-tet355"))&&a(t,"class",k);let j=C;C=H(Y),C===j?~C&&L[C].p(K(Y,C),oe):(R&&(We(),x(L[j],1,1,()=>{L[j]=null}),Je()),~C?(R=L[C],R?R.p(K(Y,C),oe):(R=L[C]=P[C](K(Y,C)),R.c()),W(R,1),R.m($,I)):R=null),Y[0].summary&&!Y[2]?V?V.p(Y,oe):(V=Ls(Y),V.c(),V.m($,null)):V&&(V.d(1),V=null),(!F||oe&4&&N!==(N="context-content "+(Y[2]?"compact":"")+" svelte-tet355"))&&a($,"class",N),(!F||oe&1)&&D!==(D=Ds(Y[0].created_at)+"")&&ce(A,D),Y[0].relevance_score?ie?ie.p(Y,oe):(ie=Es(Y),ie.c(),ie.m(O,ne)):ie&&(ie.d(1),ie=null),(X=Y[0].metadata)!=null&&X.source_document?re?re.p(Y,oe):(re=As(Y),re.c(),re.m(O,null)):re&&(re.d(1),re=null),(!F||oe&4&&B!==(B="context-meta "+(Y[2]?"compact":"")+" svelte-tet355"))&&a(O,"class",B),(!F||oe&4&&le!==(le="kg-context-item "+(Y[2]?"compact":"")+" svelte-tet355"))&&a(e,"class",le)},i(Y){F||(W(_.$$.fragment,Y),W(v.$$.fragment,Y),W(U),W(R),F=!0)},o(Y){x(_.$$.fragment,Y),x(v.$$.fragment,Y),x(U),x(R),F=!1},d(Y){Y&&S(e),we(_),we(v),U&&U.d(),~C&&L[C].d(),V&&V.d(),ie&&ie.d(),re&&re.d()}}}function El(l){return new Intl.NumberFormat().format(l)}function Ds(l){try{return new Date(l).toLocaleDateString()}catch{return l}}function Uc(l,e,t){let n,o,{contextItem:r}=e,{removable:i=!0}=e,{compact:u=!1}=e;const c=un();function p(){c("remove",{contextId:r.id})}function d(){var _;let m=null;(_=r.kg_term_definition)!=null&&_.term&&(m=r.kg_term_definition.term),c("viewDetails",{contextItem:r,term:m})}return l.$$set=m=>{"contextItem"in m&&t(0,r=m.contextItem),"removable"in m&&t(1,i=m.removable),"compact"in m&&t(2,u=m.compact)},l.$$.update=()=>{l.$$.dirty&1&&t(4,n=r.context_type==="KGTermDefinition"?"🏷️":"🗺️"),l.$$.dirty&1&&t(3,o=r.context_type==="KGTermDefinition"?"is-info":"is-primary")},[r,i,u,o,n,p,d]}class jc extends Pt{constructor(e){super(),Ut(this,e,Uc,Pc,Ot,{contextItem:0,removable:1,compact:2})}}function Ns(l,e,t){const n=l.slice();return n[25]=e[t],n}function Is(l){let e,t,n,o,r,i;return{c(){e=f("div"),t=M(l[6]),n=b(),o=f("button"),a(o,"type","button"),a(o,"class","btn-close btn-close-sm svelte-esvdw6"),a(e,"class","alert alert-danger alert-sm svelte-esvdw6"),a(e,"role","alert")},m(u,c){T(u,e,c),s(e,t),s(e,n),s(e,o),r||(i=ee(o,"click",l[18]),r=!0)},p(u,c){c&64&&ce(t,u[6])},d(u){u&&S(e),r=!1,i()}}}function Os(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="spinner-border spinner-border-sm" role="status"><span class="visually-hidden">Loading...</span></div> 
      <span>Loading conversations...</span>`,a(e,"class","loading-state svelte-esvdw6")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function Hc(l){let e=[],t=new Map,n,o=l[9];const r=i=>i[25].id;for(let i=0;i<o.length;i+=1){let u=Ns(l,o,i),c=r(u);t.set(c,e[i]=Ps(c,u))}return{c(){for(let i=0;i<e.length;i+=1)e[i].c();n=St()},m(i,u){for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(i,u);T(i,n,u)},p(i,u){u&4995&&(o=i[9],e=ai(e,u,r,1,i,o,t,n.parentNode,ci,Ps,n,Ns))},d(i){for(let u=0;u<e.length;u+=1)e[u].d(i);i&&S(n)}}}function Fc(l){let e,t,n,o,r,i,u,c;return{c(){e=f("div"),t=f("i"),n=b(),o=f("p"),o.textContent="No conversations yet",r=b(),i=f("button"),i.textContent="Start your first chat",a(t,"class","bi bi-chat-dots svelte-esvdw6"),a(o,"class","svelte-esvdw6"),a(i,"class","btn btn-sm btn-outline-primary"),a(e,"class","empty-state svelte-esvdw6")},m(p,d){T(p,e,d),s(e,t),s(e,n),s(e,o),s(e,r),s(e,i),u||(c=ee(i,"click",function(){jl(l[2])&&l[2].apply(this,arguments)}),u=!0)},p(p,d){l=p},d(p){p&&S(e),u=!1,c()}}}function zc(l){let e,t,n;function o(){return l[21](l[25])}return{c(){e=f("button"),e.innerHTML='<i class="bi bi-trash"></i>',a(e,"class","btn btn-sm btn-ghost svelte-esvdw6"),a(e,"title","Delete conversation")},m(r,i){T(r,e,i),t||(n=ee(e,"click",Vl(o)),t=!0)},p(r,i){l=r},d(r){r&&S(e),t=!1,n()}}}function Kc(l){let e,t,n,o,r,i,u;function c(){return l[19](l[25])}return{c(){e=f("button"),t=f("i"),n=b(),o=f("button"),r=f("i"),a(t,"class","bi bi-check-lg"),a(e,"class","btn btn-sm btn-danger"),e.disabled=l[8],a(e,"title","Confirm delete"),a(r,"class","bi bi-x-lg"),a(o,"class","btn btn-sm btn-secondary"),o.disabled=l[8],a(o,"title","Cancel")},m(p,d){T(p,e,d),s(e,t),T(p,n,d),T(p,o,d),s(o,r),i||(u=[ee(e,"click",Vl(c)),ee(o,"click",Vl(l[20]))],i=!0)},p(p,d){l=p,d&256&&(e.disabled=l[8]),d&256&&(o.disabled=l[8])},d(p){p&&S(e),p&&S(n),p&&S(o),i=!1,st(u)}}}function Ms(l){let e,t=l[25].preview+"",n;return{c(){e=f("p"),n=M(t),a(e,"class","conversation-preview svelte-esvdw6")},m(o,r){T(o,e,r),s(e,n)},p(o,r){r&512&&t!==(t=o[25].preview+"")&&ce(n,t)},d(o){o&&S(e)}}}function Ps(l,e){let t,n,o,r=e[25].title+"",i,u,c,p,d,m,_=e[25].role+"",g,h,v,y,k,w=e[25].message_count+"",$,C,R,I=Us(e[25].updated_at)+"",N,E,O,Q,Z;function D(F,U){return F[7]===F[25].id?Kc:zc}let A=D(e),te=A(e),ne=e[25].preview&&Ms(e);function B(){return e[22](e[25])}function le(...F){return e[23](e[25],...F)}return{key:l,first:null,c(){t=f("div"),n=f("div"),o=f("h4"),i=M(r),u=b(),c=f("div"),te.c(),p=b(),d=f("div"),m=f("span"),g=M(_),h=b(),v=f("span"),y=f("i"),k=b(),$=M(w),C=b(),R=f("span"),N=M(I),E=b(),ne&&ne.c(),O=b(),a(o,"class","conversation-title svelte-esvdw6"),a(c,"class","conversation-actions svelte-esvdw6"),a(n,"class","conversation-header svelte-esvdw6"),a(m,"class","badge bg-secondary"),a(y,"class","bi bi-chat-left-text"),a(v,"class","message-count svelte-esvdw6"),a(R,"class","timestamp svelte-esvdw6"),a(d,"class","conversation-meta svelte-esvdw6"),a(t,"class","conversation-item svelte-esvdw6"),a(t,"role","button"),a(t,"tabindex","0"),vt(t,"active",e[0]===e[25].id),this.first=t},m(F,U){T(F,t,U),s(t,n),s(n,o),s(o,i),s(n,u),s(n,c),te.m(c,null),s(t,p),s(t,d),s(d,m),s(m,g),s(d,h),s(d,v),s(v,y),s(v,k),s(v,$),s(d,C),s(d,R),s(R,N),s(t,E),ne&&ne.m(t,null),s(t,O),Q||(Z=[ee(t,"click",B),ee(t,"keydown",le)],Q=!0)},p(F,U){e=F,U&512&&r!==(r=e[25].title+"")&&ce(i,r),A===(A=D(e))&&te?te.p(e,U):(te.d(1),te=A(e),te&&(te.c(),te.m(c,null))),U&512&&_!==(_=e[25].role+"")&&ce(g,_),U&512&&w!==(w=e[25].message_count+"")&&ce($,w),U&512&&I!==(I=Us(e[25].updated_at)+"")&&ce(N,I),e[25].preview?ne?ne.p(e,U):(ne=Ms(e),ne.c(),ne.m(t,O)):ne&&(ne.d(1),ne=null),U&513&&vt(t,"active",e[0]===e[25].id)},d(F){F&&S(t),te.d(),ne&&ne.d(),Q=!1,st(Z)}}}function Gc(l){let e,t,n,o,r,i,u,c,p,d,m,_,g,h,v,y,k,w,$,C,R,I,N,E,O=l[9].length+"",Q,Z,D=l[9].length!==1?"s":"",A,te,ne,B,le,F=l[6]&&Is(l),U=l[5]&&Os();function P(K,V){return!K[5]&&K[9].length===0?Fc:Hc}let L=P(l),H=L(l);return{c(){e=f("div"),t=f("div"),n=f("h3"),n.textContent="Chat History",o=b(),r=f("button"),r.innerHTML='<i class="bi bi-plus-lg"></i> New Chat',i=b(),u=f("div"),c=f("div"),p=f("input"),d=b(),m=f("i"),_=b(),g=f("div"),h=f("select"),v=f("option"),v.textContent="All Roles",y=f("option"),k=M(l[10]),w=b(),F&&F.c(),$=b(),U&&U.c(),C=b(),R=f("div"),H.c(),I=b(),N=f("div"),E=f("small"),Q=M(O),Z=M(" conversation"),A=M(D),te=b(),ne=f("button"),ne.innerHTML='<i class="bi bi-arrow-clockwise"></i>',a(n,"class","svelte-esvdw6"),a(r,"class","btn btn-sm btn-primary new-chat-btn svelte-esvdw6"),a(r,"title","Start new conversation"),a(t,"class","session-list-header svelte-esvdw6"),a(p,"type","text"),a(p,"class","form-control form-control-sm svelte-esvdw6"),a(p,"placeholder","Search conversations..."),a(m,"class","bi bi-search search-icon svelte-esvdw6"),a(c,"class","search-box svelte-esvdw6"),v.__value=null,v.value=v.__value,y.__value=l[10],y.value=y.__value,a(h,"class","form-select form-select-sm"),l[4]===void 0&&It(()=>l[17].call(h)),a(g,"class","filter-box"),a(u,"class","session-list-controls svelte-esvdw6"),a(R,"class","conversation-list svelte-esvdw6"),a(E,"class","text-muted"),a(ne,"class","btn btn-sm btn-ghost svelte-esvdw6"),a(ne,"title","Refresh"),a(N,"class","session-list-footer svelte-esvdw6"),a(e,"class","session-list svelte-esvdw6")},m(K,V){T(K,e,V),s(e,t),s(t,n),s(t,o),s(t,r),s(e,i),s(e,u),s(u,c),s(c,p),Pe(p,l[3]),s(c,d),s(c,m),s(u,_),s(u,g),s(g,h),s(h,v),s(h,y),s(y,k),rt(h,l[4],!0),s(e,w),F&&F.m(e,null),s(e,$),U&&U.m(e,null),s(e,C),s(e,R),H.m(R,null),s(e,I),s(e,N),s(N,E),s(E,Q),s(E,Z),s(E,A),s(N,te),s(N,ne),B||(le=[ee(r,"click",function(){jl(l[2])&&l[2].apply(this,arguments)}),ee(p,"input",l[16]),ee(p,"input",l[13]),ee(h,"change",l[17]),ee(h,"change",l[14]),ee(ne,"click",l[11])],B=!0)},p(K,[V]){l=K,V&8&&p.value!==l[3]&&Pe(p,l[3]),V&1024&&ce(k,l[10]),V&1024&&(y.__value=l[10],y.value=y.__value),V&1040&&rt(h,l[4]),l[6]?F?F.p(l,V):(F=Is(l),F.c(),F.m(e,$)):F&&(F.d(1),F=null),l[5]?U||(U=Os(),U.c(),U.m(e,C)):U&&(U.d(1),U=null),L===(L=P(l))&&H?H.p(l,V):(H.d(1),H=L(l),H&&(H.c(),H.m(R,null))),V&512&&O!==(O=l[9].length+"")&&ce(Q,O),V&512&&D!==(D=l[9].length!==1?"s":"")&&ce(A,D)},i:$e,o:$e,d(K){K&&S(e),F&&F.d(),U&&U.d(),H.d(),B=!1,st(le)}}}function Us(l){const e=new Date(l),n=new Date().getTime()-e.getTime(),o=Math.floor(n/6e4),r=Math.floor(n/36e5),i=Math.floor(n/864e5);return o<1?"Just now":o<60?`${o}m ago`:r<24?`${r}h ago`:i<7?`${i}d ago`:e.toLocaleDateString()}function qc(l,e,t){let n,o;qe(l,$t,D=>t(10,o=D));let{currentConversationId:r=null}=e,{onSelectConversation:i=()=>{}}=e,{onNewConversation:u=()=>{}}=e,c=[],p=!1,d=null,m="",_=null,g=null,h=!1;vl(()=>{v()});async function v(){t(5,p=!0),t(6,d=null);try{const D=await He("list_persistent_conversations",{role:_,limit:100});D.status==="success"?t(15,c=D.conversations):t(6,d=D.error||"Failed to load conversations")}catch(D){console.error("Failed to load conversations:",D),t(6,d=String(D))}finally{t(5,p=!1)}}async function y(){if(!m.trim()){await v();return}t(5,p=!0),t(6,d=null);try{const D=await He("search_persistent_conversations",{query:m});D.status==="success"?t(15,c=D.conversations):t(6,d=D.error||"Search failed")}catch(D){console.error("Search failed:",D),t(6,d=String(D))}finally{t(5,p=!1)}}async function k(D){t(8,h=!0),t(6,d=null);try{const A=await He("delete_persistent_conversation",{conversationId:D});A.status==="success"?(t(15,c=c.filter(te=>te.id!==D)),t(7,g=null),r===D&&u()):t(6,d=A.error||"Failed to delete conversation")}catch(A){console.error("Failed to delete conversation:",A),t(6,d=String(A))}finally{t(8,h=!1)}}function w(){m.trim()?y():v()}function $(){v()}function C(){m=this.value,t(3,m)}function R(){_=Wt(this),t(4,_)}const I=()=>t(6,d=null),N=D=>k(D.id),E=()=>t(7,g=null),O=D=>t(7,g=D.id),Q=D=>i(D.id),Z=(D,A)=>A.key==="Enter"&&i(D.id);return l.$$set=D=>{"currentConversationId"in D&&t(0,r=D.currentConversationId),"onSelectConversation"in D&&t(1,i=D.onSelectConversation),"onNewConversation"in D&&t(2,u=D.onNewConversation)},l.$$.update=()=>{l.$$.dirty&32792&&t(9,n=c.filter(D=>{const A=!m||D.title.toLowerCase().includes(m.toLowerCase())||D.preview&&D.preview.toLowerCase().includes(m.toLowerCase()),te=!_||D.role===_;return A&&te}))},[r,i,u,m,_,p,d,g,h,n,o,v,k,w,$,c,C,R,I,N,E,O,Q,Z]}class Wc extends Pt{constructor(e){super(),Ut(this,e,qc,Gc,Ot,{currentConversationId:0,onSelectConversation:1,onNewConversation:2})}}function js(l,e,t){const n=l.slice();return n[90]=e[t],n[92]=t,n}function Hs(l,e,t){const n=l.slice();return n[93]=e[t],n[95]=t,n}function Fs(l){let e,t,n;return t=new Wc({props:{currentConversationId:l[27],onSelectConversation:l[44],onNewConversation:l[45]}}),{c(){e=f("div"),be(t.$$.fragment),a(e,"class","session-list-column svelte-1e04wo7")},m(o,r){T(o,e,r),ke(t,e,null),n=!0},p(o,r){const i={};r[0]&134217728&&(i.currentConversationId=o[27]),t.$set(i)},i(o){n||(W(t.$$.fragment,o),n=!0)},o(o){x(t.$$.fragment,o),n=!1},d(o){o&&S(e),we(t)}}}function zs(l){let e,t,n;return{c(){e=f("p"),t=M("Conversation ID: "),n=M(l[11]),a(e,"class","is-size-7 has-text-grey")},m(o,r){T(o,e,r),s(e,t),s(e,n)},p(o,r){r[0]&2048&&ce(n,o[11])},d(o){o&&S(e)}}}function Ks(l){let e,t,n;return{c(){e=f("button"),e.innerHTML=`<span class="icon is-small"><i class="fas fa-save"></i></span> 
                <span>Save</span>`,a(e,"class","button is-small is-success svelte-1e04wo7"),a(e,"title","Save this conversation")},m(o,r){T(o,e,r),t||(n=ee(e,"click",l[43]),t=!0)},p:$e,d(o){o&&S(e),t=!1,n()}}}function Jc(l){let e,t=l[93].content+"",n;return{c(){e=f("pre"),n=M(t),a(e,"class","svelte-1e04wo7")},m(o,r){T(o,e,r),s(e,n)},p(o,r){r[0]&1&&t!==(t=o[93].content+"")&&ce(n,t)},i:$e,o:$e,d(o){o&&S(e)}}}function Bc(l){let e,t,n,o,r,i,u,c,p,d,m;const _=[Vc,Qc],g=[];function h(w,$){return w[5]?0:1}e=h(l),t=g[e]=_[e](l);function v(){return l[50](l[93])}function y(){return l[51](l[93])}let k=l[6]&&l[95]===l[0].length-1&&Gs(l);return{c(){t.c(),n=b(),o=f("div"),r=f("button"),r.innerHTML='<span class="icon is-small"><i class="fas fa-copy"></i></span>',i=b(),u=f("button"),u.innerHTML='<span class="icon is-small"><i class="fas fa-save"></i></span>',c=b(),k&&k.c(),a(r,"class","button is-small is-light svelte-1e04wo7"),a(r,"title","Copy as markdown"),a(u,"class","button is-small is-light svelte-1e04wo7"),a(u,"title","Save as markdown"),a(o,"class","msg-actions svelte-1e04wo7")},m(w,$){g[e].m(w,$),T(w,n,$),T(w,o,$),s(o,r),s(o,i),s(o,u),s(o,c),k&&k.m(o,null),p=!0,d||(m=[ee(r,"click",v),ee(u,"click",y)],d=!0)},p(w,$){l=w;let C=e;e=h(l),e===C?g[e].p(l,$):(We(),x(g[C],1,1,()=>{g[C]=null}),Je(),t=g[e],t?t.p(l,$):(t=g[e]=_[e](l),t.c()),W(t,1),t.m(n.parentNode,n)),l[6]&&l[95]===l[0].length-1?k?k.p(l,$):(k=Gs(l),k.c(),k.m(o,null)):k&&(k.d(1),k=null)},i(w){p||(W(t),p=!0)},o(w){x(t),p=!1},d(w){g[e].d(w),w&&S(n),w&&S(o),k&&k.d(),d=!1,st(m)}}}function Qc(l){let e,t=l[93].content+"",n;return{c(){e=f("pre"),n=M(t),a(e,"class","svelte-1e04wo7")},m(o,r){T(o,e,r),s(e,n)},p(o,r){r[0]&1&&t!==(t=o[93].content+"")&&ce(n,t)},i:$e,o:$e,d(o){o&&S(e)}}}function Vc(l){let e,t,n;return t=new Hl({props:{source:l[93].content}}),{c(){e=f("div"),be(t.$$.fragment),a(e,"class","markdown-body svelte-1e04wo7")},m(o,r){T(o,e,r),ke(t,e,null),n=!0},p(o,r){const i={};r[0]&1&&(i.source=o[93].content),t.$set(i)},i(o){n||(W(t.$$.fragment,o),n=!0)},o(o){x(t.$$.fragment,o),n=!1},d(o){o&&S(e),we(t)}}}function Gs(l){let e,t,n,o,r,i,u,c,p,d,m,_,g;return{c(){e=f("button"),t=f("span"),t.innerHTML='<i class="fas fa-bug"></i>',n=b(),o=f("span"),o.textContent="REQ",i=b(),u=f("button"),c=f("span"),c.innerHTML='<i class="fas fa-code"></i>',p=b(),d=f("span"),d.textContent="RES",a(t,"class","icon is-small"),a(o,"class","is-size-7"),a(e,"class","button is-small is-warning svelte-1e04wo7"),a(e,"title","Show debug request (sent to LLM)"),e.disabled=r=!l[7],a(c,"class","icon is-small"),a(d,"class","is-size-7"),a(u,"class","button is-small is-info svelte-1e04wo7"),a(u,"title","Show debug response (from LLM)"),u.disabled=m=!l[8]},m(h,v){T(h,e,v),s(e,t),s(e,n),s(e,o),T(h,i,v),T(h,u,v),s(u,c),s(u,p),s(u,d),_||(g=[ee(e,"click",l[52]),ee(u,"click",l[53])],_=!0)},p(h,v){v[0]&128&&r!==(r=!h[7])&&(e.disabled=r),v[0]&256&&m!==(m=!h[8])&&(u.disabled=m)},d(h){h&&S(e),h&&S(i),h&&S(u),_=!1,st(g)}}}function qs(l){let e,t,n,o,r,i;const u=[Bc,Jc],c=[];function p(d,m){return d[93].role==="assistant"?0:1}return n=p(l),o=c[n]=u[n](l),{c(){e=f("div"),t=f("div"),o.c(),a(t,"class","bubble svelte-1e04wo7"),a(e,"class",r=rl(`msg ${l[93].role}`)+" svelte-1e04wo7")},m(d,m){T(d,e,m),s(e,t),c[n].m(t,null),i=!0},p(d,m){let _=n;n=p(d),n===_?c[n].p(d,m):(We(),x(c[_],1,1,()=>{c[_]=null}),Je(),o=c[n],o?o.p(d,m):(o=c[n]=u[n](d),o.c()),W(o,1),o.m(t,null)),(!i||m[0]&1&&r!==(r=rl(`msg ${d[93].role}`)+" svelte-1e04wo7"))&&a(e,"class",r)},i(d){i||(W(o),i=!0)},o(d){x(o),i=!1},d(d){d&&S(e),c[n].d()}}}function Ws(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="bubble loading svelte-1e04wo7"><span class="icon is-small"><i class="fas fa-spinner fa-spin"></i></span> 
            <span>Thinking...</span></div>`,a(e,"class","msg assistant svelte-1e04wo7")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function Js(l){let e,t;return{c(){e=f("p"),t=M(l[4]),a(e,"class","is-size-7 has-text-grey")},m(n,o){T(n,e,o),s(e,t)},p(n,o){o[0]&16&&ce(t,n[4])},d(n){n&&S(e)}}}function Bs(l){let e,t;return{c(){e=f("p"),t=M(l[3]),a(e,"class","has-text-danger is-size-7")},m(n,o){T(n,e,o),s(e,t)},p(n,o){o[0]&8&&ce(t,n[3])},d(n){n&&S(e)}}}function Yc(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-refresh"></i>',a(e,"class","icon is-small")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function Zc(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-spinner fa-spin"></i>',a(e,"class","icon is-small")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function Qs(l){let e,t,n,o,r,i,u,c,p,d,m,_,g,h,v,y,k,w,$,C,R,I,N,E,O,Q,Z,D,A,te,ne,B,le,F,U,P,L,H;function K(re,ye){return re[18]?xc:Xc}let V=K(l),ie=V(l);return{c(){e=f("div"),t=f("div"),n=f("label"),n.textContent="Context Type",o=b(),r=f("div"),i=f("div"),u=f("select"),c=f("option"),c.textContent="Document",p=f("option"),p.textContent="Search Result",d=f("option"),d.textContent="User Input",m=f("option"),m.textContent="Note",_=b(),g=f("div"),h=f("label"),h.textContent="Title",v=b(),y=f("div"),k=f("input"),w=b(),$=f("div"),C=f("label"),C.textContent="Content",R=b(),I=f("div"),N=f("textarea"),E=b(),O=f("div"),Q=f("div"),Z=f("button"),ie.c(),D=b(),A=f("span"),A.textContent="Save Context",ne=b(),B=f("div"),le=f("button"),F=f("span"),F.innerHTML='<i class="fas fa-times"></i>',U=b(),P=f("span"),P.textContent="Cancel",a(n,"class","label is-small"),c.__value="document",c.value=c.__value,p.__value="search_result",p.value=p.__value,d.__value="user_input",d.value=d.__value,m.__value="note",m.value=m.__value,a(u,"data-testid","context-type-select"),l[17]===void 0&&It(()=>l[55].call(u)),a(i,"class","select is-small is-fullwidth"),a(r,"class","control"),a(t,"class","field"),a(h,"class","label is-small"),a(k,"class","input is-small"),a(k,"type","text"),a(k,"placeholder","Enter context title"),a(k,"data-testid","context-title-input"),a(y,"class","control"),a(g,"class","field"),a(C,"class","label is-small"),a(N,"class","textarea is-small"),a(N,"rows","4"),a(N,"placeholder","Enter context content"),a(N,"data-testid","context-content-textarea"),a(I,"class","control"),a($,"class","field"),a(Z,"class","button is-primary is-small"),Z.disabled=te=l[18]||!l[15].trim()||!l[16].trim(),a(Z,"data-testid","add-context-submit-button"),a(Q,"class","control"),a(F,"class","icon is-small"),a(le,"class","button is-light is-small"),le.disabled=l[18],a(B,"class","control"),a(O,"class","field is-grouped"),a(e,"class","box has-background-light mb-4"),a(e,"data-testid","add-context-form")},m(re,ye){T(re,e,ye),s(e,t),s(t,n),s(t,o),s(t,r),s(r,i),s(i,u),s(u,c),s(u,p),s(u,d),s(u,m),rt(u,l[17],!0),s(e,_),s(e,g),s(g,h),s(g,v),s(g,y),s(y,k),Pe(k,l[15]),s(e,w),s(e,$),s($,C),s($,R),s($,I),s(I,N),Pe(N,l[16]),s(e,E),s(e,O),s(O,Q),s(Q,Z),ie.m(Z,null),s(Z,D),s(Z,A),s(O,ne),s(O,B),s(B,le),s(le,F),s(le,U),s(le,P),L||(H=[ee(u,"change",l[55]),ee(k,"input",l[56]),ee(N,"input",l[57]),ee(Z,"click",l[32]),ee(le,"click",l[31])],L=!0)},p(re,ye){ye[0]&131072&&rt(u,re[17]),ye[0]&32768&&k.value!==re[15]&&Pe(k,re[15]),ye[0]&65536&&Pe(N,re[16]),V!==(V=K(re))&&(ie.d(1),ie=V(re),ie&&(ie.c(),ie.m(Z,D))),ye[0]&360448&&te!==(te=re[18]||!re[15].trim()||!re[16].trim())&&(Z.disabled=te),ye[0]&262144&&(le.disabled=re[18])},d(re){re&&S(e),ie.d(),L=!1,st(H)}}}function Xc(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-save"></i>',a(e,"class","icon is-small")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function xc(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-spinner fa-spin"></i>',a(e,"class","icon is-small")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function eu(l){let e,t,n=l[12],o=[];for(let i=0;i<n.length;i+=1)o[i]=Zs(js(l,n,i));const r=i=>x(o[i],1,1,()=>{o[i]=null});return{c(){e=f("div");for(let i=0;i<o.length;i+=1)o[i].c();a(e,"class","context-items svelte-1e04wo7"),a(e,"data-testid","conversation-context")},m(i,u){T(i,e,u);for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(e,null);t=!0},p(i,u){if(u[0]&4096|u[1]&28){n=i[12];let c;for(c=0;c<n.length;c+=1){const p=js(i,n,c);o[c]?(o[c].p(p,u),W(o[c],1)):(o[c]=Zs(p),o[c].c(),W(o[c],1),o[c].m(e,null))}for(We(),c=n.length;c<o.length;c+=1)r(c);Je()}},i(i){if(!t){for(let u=0;u<n.length;u+=1)W(o[u]);t=!0}},o(i){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)x(o[u]);t=!1},d(i){i&&S(e),_t(o,i)}}}function tu(l){let e;return{c(){e=f("div"),e.innerHTML=`<span class="icon is-large"><i class="fas fa-inbox fa-2x"></i></span> 
              <p class="is-size-6">No context items yet</p> 
              <p class="is-size-7">Add documents from search results to provide context for your chat.</p>`,a(e,"class","has-text-centered has-text-grey-light"),a(e,"data-testid","empty-context-message")},m(t,n){T(t,e,n)},p:$e,i:$e,o:$e,d(t){t&&S(e)}}}function lu(l){let e,t,n,o,r,i=l[90].context_type.replace(/([A-Z])/g," $1").trim()+"",u,c,p,d,m,_,g,h,v,y,k,w,$,C,R,I=l[90].title+"",N,E,O,Q,Z,D,A=new Date(l[90].created_at).toLocaleString()+"",te,ne,B,le,F,U=l[90].relevance_score&&Vs(l);function P(){return l[60](l[90])}function L(){return l[61](l[90])}function H(ie,re){return ie[90].summary?su:ou}let K=H(l),V=K(l);return{c(){e=f("div"),t=f("div"),n=f("div"),o=f("div"),r=f("span"),u=M(i),p=b(),d=f("div"),m=f("div"),U&&U.c(),_=b(),g=f("div"),h=f("div"),v=f("div"),y=f("button"),y.innerHTML='<span class="icon is-small"><i class="fas fa-edit"></i></span>',k=b(),w=f("div"),$=f("button"),$.innerHTML='<span class="icon is-small"><i class="fas fa-trash"></i></span>',C=b(),R=f("h6"),N=M(I),E=b(),O=f("div"),V.c(),Q=b(),Z=f("div"),D=M("Added: "),te=M(A),a(r,"class",c="tag is-small "+(l[90].context_type==="Document"?"is-info":l[90].context_type==="SearchResult"?"is-primary":l[90].context_type==="UserInput"?"is-warning":"is-light")),a(r,"data-testid",`context-type-${l[92]}`),a(o,"class","level-item"),a(n,"class","level-left"),a(m,"class","level-item"),a(y,"class","button is-small is-light"),a(y,"data-testid",`edit-context-${l[92]}`),a(y,"title","Edit context"),a(v,"class","control"),a($,"class","button is-small is-light is-danger"),a($,"data-testid",`delete-context-${l[92]}`),a($,"title","Delete context"),a(w,"class","control"),a(h,"class","field is-grouped"),a(g,"class","level-item context-actions svelte-1e04wo7"),a(d,"class","level-right"),a(t,"class","level is-mobile"),a(R,"class","title is-6 has-text-dark"),a(R,"data-testid",`context-title-${l[92]}`),a(O,"class","content is-small"),a(Z,"class","is-size-7 has-text-grey"),a(e,"class","context-item svelte-1e04wo7"),a(e,"data-context-id",ne=l[90].id),a(e,"data-testid",`context-item-${l[92]}`),a(e,"data-context-type",B=l[90].context_type)},m(ie,re){T(ie,e,re),s(e,t),s(t,n),s(n,o),s(o,r),s(r,u),s(t,p),s(t,d),s(d,m),U&&U.m(m,null),s(d,_),s(d,g),s(g,h),s(h,v),s(v,y),s(h,k),s(h,w),s(w,$),s(e,C),s(e,R),s(R,N),s(e,E),s(e,O),V.m(O,null),s(e,Q),s(e,Z),s(Z,D),s(Z,te),le||(F=[ee(y,"click",P),ee($,"click",L)],le=!0)},p(ie,re){l=ie,re[0]&4096&&i!==(i=l[90].context_type.replace(/([A-Z])/g," $1").trim()+"")&&ce(u,i),re[0]&4096&&c!==(c="tag is-small "+(l[90].context_type==="Document"?"is-info":l[90].context_type==="SearchResult"?"is-primary":l[90].context_type==="UserInput"?"is-warning":"is-light"))&&a(r,"class",c),l[90].relevance_score?U?U.p(l,re):(U=Vs(l),U.c(),U.m(m,null)):U&&(U.d(1),U=null),re[0]&4096&&I!==(I=l[90].title+"")&&ce(N,I),K===(K=H(l))&&V?V.p(l,re):(V.d(1),V=K(l),V&&(V.c(),V.m(O,null))),re[0]&4096&&A!==(A=new Date(l[90].created_at).toLocaleString()+"")&&ce(te,A),re[0]&4096&&ne!==(ne=l[90].id)&&a(e,"data-context-id",ne),re[0]&4096&&B!==(B=l[90].context_type)&&a(e,"data-context-type",B)},i:$e,o:$e,d(ie){ie&&S(e),U&&U.d(),V.d(),le=!1,st(F)}}}function nu(l){let e,t;return e=new jc({props:{contextItem:l[90],compact:!0}}),e.$on("remove",l[58]),e.$on("viewDetails",l[59]),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},p(n,o){const r={};o[0]&4096&&(r.contextItem=n[90]),e.$set(r)},i(n){t||(W(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function Vs(l){let e,t=l[90].relevance_score.toFixed(1)+"",n;return{c(){e=f("span"),n=M(t),a(e,"class","tag is-light is-small")},m(o,r){T(o,e,r),s(e,n)},p(o,r){r[0]&4096&&t!==(t=o[90].relevance_score.toFixed(1)+"")&&ce(n,t)},d(o){o&&S(e)}}}function ou(l){let e,t=l[90].content.substring(0,150)+"",n,o=l[90].content.length>150?"...":"",r;return{c(){e=f("p"),n=M(t),r=M(o),a(e,"class","context-preview svelte-1e04wo7"),a(e,"data-testid",`context-content-${l[92]}`)},m(i,u){T(i,e,u),s(e,n),s(e,r)},p(i,u){u[0]&4096&&t!==(t=i[90].content.substring(0,150)+"")&&ce(n,t),u[0]&4096&&o!==(o=i[90].content.length>150?"...":"")&&ce(r,o)},d(i){i&&S(e)}}}function su(l){let e,t=l[90].summary+"",n;return{c(){e=f("p"),n=M(t),a(e,"class","context-summary svelte-1e04wo7"),a(e,"data-testid",`context-summary-${l[92]}`)},m(o,r){T(o,e,r),s(e,n)},p(o,r){r[0]&4096&&t!==(t=o[90].summary+"")&&ce(n,t)},d(o){o&&S(e)}}}function Ys(l){let e;return{c(){e=f("hr"),a(e,"class","context-divider svelte-1e04wo7")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function Zs(l){let e,t,n,o,r;const i=[nu,lu],u=[];function c(d,m){return d[90].context_type==="KGTermDefinition"||d[90].context_type==="KGIndex"?0:1}e=c(l),t=u[e]=i[e](l);let p=l[92]<l[12].length-1&&Ys();return{c(){t.c(),n=b(),p&&p.c(),o=St()},m(d,m){u[e].m(d,m),T(d,n,m),p&&p.m(d,m),T(d,o,m),r=!0},p(d,m){let _=e;e=c(d),e===_?u[e].p(d,m):(We(),x(u[_],1,1,()=>{u[_]=null}),Je(),t=u[e],t?t.p(d,m):(t=u[e]=i[e](d),t.c()),W(t,1),t.m(n.parentNode,n)),d[92]<d[12].length-1?p||(p=Ys(),p.c(),p.m(o.parentNode,o)):p&&(p.d(1),p=null)},i(d){r||(W(t),r=!0)},o(d){x(t),r=!1},d(d){u[e].d(d),d&&S(n),p&&p.d(d),d&&S(o)}}}function Xs(l){let e,t,n,o,r,i,u,c,p,d,m,_,g,h,v,y;function k(R,I){return R[7]?ru:iu}let w=k(l),$=w(l),C=l[7]&&xs(l);return{c(){e=f("div"),t=f("div"),n=b(),o=f("div"),r=f("header"),i=f("p"),i.innerHTML=`<span class="icon"><i class="fas fa-bug"></i></span>
          Debug Request (Sent to LLM)`,u=b(),c=f("button"),p=b(),d=f("section"),$.c(),m=b(),_=f("footer"),g=f("button"),g.textContent="Close",h=b(),C&&C.c(),a(t,"class","modal-background"),a(i,"class","modal-card-title"),a(c,"class","delete"),a(c,"aria-label","close"),a(r,"class","modal-card-head"),a(d,"class","modal-card-body"),a(g,"class","button"),a(_,"class","modal-card-foot"),a(o,"class","modal-card"),a(e,"class","modal is-active")},m(R,I){T(R,e,I),s(e,t),s(e,n),s(e,o),s(o,r),s(r,i),s(r,u),s(r,c),s(o,p),s(o,d),$.m(d,null),s(o,m),s(o,_),s(_,g),s(_,h),C&&C.m(_,null),v||(y=[ee(t,"click",l[62]),ee(c,"click",l[63]),ee(g,"click",l[64])],v=!0)},p(R,I){w===(w=k(R))&&$?$.p(R,I):($.d(1),$=w(R),$&&($.c(),$.m(d,null))),R[7]?C?C.p(R,I):(C=xs(R),C.c(),C.m(_,null)):C&&(C.d(1),C=null)},d(R){R&&S(e),$.d(),C&&C.d(),v=!1,st(y)}}}function iu(l){let e;return{c(){e=f("p"),e.textContent="No request data available",a(e,"class","has-text-grey")},m(t,n){T(t,e,n)},p:$e,d(t){t&&S(e)}}}function ru(l){let e,t,n,o,r,i,u=l[7].method+"",c,p,d,m,_=new Date(l[7].timestamp).toLocaleTimeString()+"",g,h,v,y,k=l[7].context_items_count+"",w,$,C,R,I,N,E=JSON.stringify(l[7],null,2)+"",O;return{c(){e=f("div"),t=f("p"),t.textContent="Request Details:",n=b(),o=f("div"),r=f("span"),i=M("Method: "),c=M(u),p=b(),d=f("span"),m=M("Time: "),g=M(_),h=b(),v=f("span"),y=M("Context Items: "),w=M(k),$=b(),C=f("p"),C.textContent="Full Request JSON:",R=b(),I=f("pre"),N=f("code"),O=M(E),a(t,"class","has-text-weight-semibold"),a(r,"class","tag is-info"),a(d,"class","tag is-primary"),a(v,"class","tag is-success"),a(o,"class","tags are-medium"),a(C,"class","has-text-weight-semibold mt-4"),a(N,"class","svelte-1e04wo7"),a(I,"class","debug-json svelte-1e04wo7"),a(e,"class","content")},m(Q,Z){T(Q,e,Z),s(e,t),s(e,n),s(e,o),s(o,r),s(r,i),s(r,c),s(o,p),s(o,d),s(d,m),s(d,g),s(o,h),s(o,v),s(v,y),s(v,w),s(e,$),s(e,C),s(e,R),s(e,I),s(I,N),s(N,O)},p(Q,Z){Z[0]&128&&u!==(u=Q[7].method+"")&&ce(c,u),Z[0]&128&&_!==(_=new Date(Q[7].timestamp).toLocaleTimeString()+"")&&ce(g,_),Z[0]&128&&k!==(k=Q[7].context_items_count+"")&&ce(w,k),Z[0]&128&&E!==(E=JSON.stringify(Q[7],null,2)+"")&&ce(O,E)},d(Q){Q&&S(e)}}}function xs(l){let e,t,n;return{c(){e=f("button"),e.innerHTML=`<span class="icon"><i class="fas fa-copy"></i></span> 
            <span>Copy JSON</span>`,a(e,"class","button is-primary")},m(o,r){T(o,e,r),t||(n=ee(e,"click",l[65]),t=!0)},p:$e,d(o){o&&S(e),t=!1,n()}}}function ei(l){let e,t,n,o,r,i,u,c,p,d,m,_,g,h,v,y;function k(R,I){return R[8]?cu:au}let w=k(l),$=w(l),C=l[8]&&ni(l);return{c(){e=f("div"),t=f("div"),n=b(),o=f("div"),r=f("header"),i=f("p"),i.innerHTML=`<span class="icon"><i class="fas fa-code"></i></span>
          Debug Response (From LLM)`,u=b(),c=f("button"),p=b(),d=f("section"),$.c(),m=b(),_=f("footer"),g=f("button"),g.textContent="Close",h=b(),C&&C.c(),a(t,"class","modal-background"),a(i,"class","modal-card-title"),a(c,"class","delete"),a(c,"aria-label","close"),a(r,"class","modal-card-head"),a(d,"class","modal-card-body"),a(g,"class","button"),a(_,"class","modal-card-foot"),a(o,"class","modal-card"),a(e,"class","modal is-active")},m(R,I){T(R,e,I),s(e,t),s(e,n),s(e,o),s(o,r),s(r,i),s(r,u),s(r,c),s(o,p),s(o,d),$.m(d,null),s(o,m),s(o,_),s(_,g),s(_,h),C&&C.m(_,null),v||(y=[ee(t,"click",l[66]),ee(c,"click",l[67]),ee(g,"click",l[68])],v=!0)},p(R,I){w===(w=k(R))&&$?$.p(R,I):($.d(1),$=w(R),$&&($.c(),$.m(d,null))),R[8]?C?C.p(R,I):(C=ni(R),C.c(),C.m(_,null)):C&&(C.d(1),C=null)},d(R){R&&S(e),$.d(),C&&C.d(),v=!1,st(y)}}}function au(l){let e;return{c(){e=f("p"),e.textContent="No response data available",a(e,"class","has-text-grey")},m(t,n){T(t,e,n)},p:$e,d(t){t&&S(e)}}}function cu(l){let e,t,n,o,r,i,u=l[8].status+"",c,p,d,m,_=new Date(l[8].timestamp).toLocaleTimeString()+"",g,h,v,y,k,w,$,C,R=JSON.stringify(l[8],null,2)+"",I,N=l[8].model_used&&ti(l),E=l[8].message_length&&li(l);return{c(){e=f("div"),t=f("p"),t.textContent="Response Details:",n=b(),o=f("div"),r=f("span"),i=M("Status: "),c=M(u),p=b(),d=f("span"),m=M("Time: "),g=M(_),h=b(),N&&N.c(),v=b(),E&&E.c(),y=b(),k=f("p"),k.textContent="Full Response JSON:",w=b(),$=f("pre"),C=f("code"),I=M(R),a(t,"class","has-text-weight-semibold"),a(r,"class","tag is-info"),a(d,"class","tag is-primary"),a(o,"class","tags are-medium"),a(k,"class","has-text-weight-semibold mt-4"),a(C,"class","svelte-1e04wo7"),a($,"class","debug-json svelte-1e04wo7"),a(e,"class","content")},m(O,Q){T(O,e,Q),s(e,t),s(e,n),s(e,o),s(o,r),s(r,i),s(r,c),s(o,p),s(o,d),s(d,m),s(d,g),s(o,h),N&&N.m(o,null),s(o,v),E&&E.m(o,null),s(e,y),s(e,k),s(e,w),s(e,$),s($,C),s(C,I)},p(O,Q){Q[0]&256&&u!==(u=O[8].status+"")&&ce(c,u),Q[0]&256&&_!==(_=new Date(O[8].timestamp).toLocaleTimeString()+"")&&ce(g,_),O[8].model_used?N?N.p(O,Q):(N=ti(O),N.c(),N.m(o,v)):N&&(N.d(1),N=null),O[8].message_length?E?E.p(O,Q):(E=li(O),E.c(),E.m(o,null)):E&&(E.d(1),E=null),Q[0]&256&&R!==(R=JSON.stringify(O[8],null,2)+"")&&ce(I,R)},d(O){O&&S(e),N&&N.d(),E&&E.d()}}}function ti(l){let e,t,n=l[8].model_used+"",o;return{c(){e=f("span"),t=M("Model: "),o=M(n),a(e,"class","tag is-success")},m(r,i){T(r,e,i),s(e,t),s(e,o)},p(r,i){i[0]&256&&n!==(n=r[8].model_used+"")&&ce(o,n)},d(r){r&&S(e)}}}function li(l){let e,t,n=l[8].message_length+"",o,r;return{c(){e=f("span"),t=M("Length: "),o=M(n),r=M(" chars"),a(e,"class","tag is-warning")},m(i,u){T(i,e,u),s(e,t),s(e,o),s(e,r)},p(i,u){u[0]&256&&n!==(n=i[8].message_length+"")&&ce(o,n)},d(i){i&&S(e)}}}function ni(l){let e,t,n;return{c(){e=f("button"),e.innerHTML=`<span class="icon"><i class="fas fa-copy"></i></span> 
            <span>Copy JSON</span>`,a(e,"class","button is-primary")},m(o,r){T(o,e,r),t||(n=ee(e,"click",l[69]),t=!0)},p:$e,d(o){o&&S(e),t=!1,n()}}}function oi(l){let e,t,n;function o(i){l[75](i)}let r={item:l[24],kgTerm:l[25],kgRank:l[26]};return l[23]!==void 0&&(r.active=l[23]),e=new Zl({props:r}),mt.push(()=>kt(e,"active",o)),{c(){be(e.$$.fragment)},m(i,u){ke(e,i,u),n=!0},p(i,u){const c={};u[0]&16777216&&(c.item=i[24]),u[0]&33554432&&(c.kgTerm=i[25]),u[0]&67108864&&(c.kgRank=i[26]),!t&&u[0]&8388608&&(t=!0,c.active=i[23],wt(()=>t=!1)),e.$set(c)},i(i){n||(W(e.$$.fragment,i),n=!0)},o(i){x(e.$$.fragment,i),n=!1},d(i){we(e,i)}}}function uu(l){let e,t,n,o,r,i,u,c,p,d,m,_,g,h,v,y,k,w,$,C=l[28]?"Hide":"History",R,I,N,E,O,Q,Z,D,A,te,ne,B,le,F,U,P,L,H,K,V,ie,re,ye,Y,oe,me,G,j,X,ue,ge,ae,pe,_e,Re,Ve,Be,Le,Ee,he,Ae,Ye,Ke,Ue,Ne,ze,tt,dt,Ze,Qe,pt,Fe,nt,Xe=l[12].length+"",z,J,se,Oe,Ie,Ce,ot,et,lt,yt,at,Rt,Bt,Qt,Tt,Vt,ll,it=l[28]&&Fs(l),q=l[11]&&zs(l),fe=l[11]&&!l[27]&&Ks(l),ve=l[0],Se=[];for(let de=0;de<ve.length;de+=1)Se[de]=qs(Hs(l,ve,de));const Ge=de=>x(Se[de],1,1,()=>{Se[de]=null});let Me=l[2]&&Ws(),ut=l[4]&&Js(l),Lt=l[3]&&Bs(l);function tl(de,De){return de[13]?Zc:Yc}let jt=tl(l),Dt=jt(l),Et=l[14]&&Qs(l);const Nl=[tu,eu],Ht=[];function Nt(de,De){return de[12].length===0?0:1}ze=Nt(l),tt=Ht[ze]=Nl[ze](l);let At=l[9]&&Xs(l),Mt=l[10]&&ei(l);function Fl(de){l[70](de)}let kl={context:l[20],mode:l[21]};l[19]!==void 0&&(kl.active=l[19]),et=new fc({props:kl}),mt.push(()=>kt(et,"active",Fl)),et.$on("update",l[71]),et.$on("delete",l[72]),et.$on("close",l[73]);function _l(de){l[74](de)}let al={conversationId:l[11]};l[22]!==void 0&&(al.active=l[22]),at=new Sc({props:al}),mt.push(()=>kt(at,"active",_l)),at.$on("termAdded",l[40]),at.$on("kgIndexAdded",l[41]);let Ct=l[24]&&oi(l);return{c(){e=f("section"),t=f("div"),n=f("div"),it&&it.c(),o=b(),r=f("div"),i=f("div"),u=f("div"),c=f("h2"),c.textContent="Chat",p=b(),d=f("p"),d.textContent=`Role: ${typeof ht($t)=="object"?ht($t).original:ht($t)}`,m=b(),q&&q.c(),_=b(),g=f("div"),h=f("button"),v=f("span"),y=f("i"),w=b(),$=f("span"),R=M(C),N=b(),fe&&fe.c(),E=b(),O=f("div"),Q=f("div"),Z=f("div"),D=f("div"),A=f("label"),te=f("input"),ne=M(`
              Render markdown`),B=b(),le=f("div"),F=f("label"),U=f("input"),P=M(`
              Debug mode`),L=b();for(let de=0;de<Se.length;de+=1)Se[de].c();H=b(),Me&&Me.c(),K=b(),ut&&ut.c(),V=b(),Lt&&Lt.c(),ie=b(),re=f("div"),ye=f("div"),Y=f("textarea"),oe=b(),me=f("div"),G=f("button"),j=f("span"),j.innerHTML='<i class="fas fa-paper-plane"></i>',ue=b(),ge=f("div"),ae=f("div"),pe=f("h4"),pe.textContent="Context",_e=b(),Re=f("div"),Ve=f("div"),Be=f("div"),Le=f("div"),Ee=f("button"),Ee.innerHTML=`<span class="icon is-small"><i class="fas fa-sitemap"></i></span> 
                    <span>KG Search</span>`,he=b(),Ae=f("div"),Ye=f("div"),Ke=f("button"),Dt.c(),Ue=b(),Et&&Et.c(),Ne=b(),tt.c(),dt=b(),Ze=f("div"),Qe=f("div"),pt=f("div"),Fe=f("div"),nt=f("span"),z=M(Xe),J=M(" context items"),se=b(),Oe=f("div"),Oe.innerHTML='<div class="level-item"><span class="is-size-7 has-text-grey">Context is automatically included in your chat</span></div>',Ie=b(),At&&At.c(),Ce=b(),Mt&&Mt.c(),ot=b(),be(et.$$.fragment),yt=b(),be(at.$$.fragment),Bt=b(),Ct&&Ct.c(),Qt=St(),a(c,"class","title is-4"),a(d,"class","subtitle is-6"),a(y,"class",k="fas fa-"+(l[28]?"angle-left":"bars")),a(v,"class","icon is-small"),a(h,"class","button is-small svelte-1e04wo7"),a(h,"title",I=l[28]?"Hide session list":"Show session list"),a(g,"class","chat-header-actions svelte-1e04wo7"),a(i,"class","chat-header svelte-1e04wo7"),a(te,"type","checkbox"),a(A,"class","checkbox is-size-7"),a(D,"class","control"),a(U,"type","checkbox"),a(F,"class","checkbox is-size-7"),a(le,"class","control"),a(Z,"class","field is-grouped"),a(Q,"class","chat-toolbar svelte-1e04wo7"),a(O,"class","chat-window svelte-1e04wo7"),a(O,"data-testid","chat-messages"),a(Y,"class","textarea svelte-1e04wo7"),a(Y,"rows","3"),a(Y,"placeholder","Type your message and press Enter..."),a(Y,"data-testid","chat-input"),a(ye,"class","control is-expanded svelte-1e04wo7"),a(j,"class","icon"),a(G,"class","button is-primary"),G.disabled=X=l[2]||!l[1].trim(),a(G,"data-testid","send-message-button"),a(me,"class","control svelte-1e04wo7"),a(re,"class","field has-addons chat-input svelte-1e04wo7"),a(r,"class","main-chat-area svelte-1e04wo7"),a(pe,"class","title is-5 mb-3"),a(Ee,"class","button is-small is-info"),a(Ee,"data-testid","kg-search-button"),a(Le,"class","buttons has-addons"),a(Be,"class","level-item"),a(Ve,"class","level-left"),a(Ke,"class","button is-small is-light"),Ke.disabled=l[13],a(Ke,"data-testid","refresh-context-button"),a(Ye,"class","level-item"),a(Ae,"class","level-right"),a(Re,"class","level is-mobile"),a(nt,"class","tag is-light is-small"),a(nt,"data-testid","context-summary"),a(Fe,"class","level-item"),a(pt,"class","level-left"),a(Oe,"class","level-right"),a(Qe,"class","level is-mobile"),a(Ze,"class","mt-4"),a(ae,"class","box context-panel svelte-1e04wo7"),a(ae,"data-testid","context-panel"),a(ge,"class","context-panel-column svelte-1e04wo7"),a(n,"class","chat-layout-grid svelte-1e04wo7"),vt(n,"sidebar-hidden",!l[28]),a(t,"class","container"),a(e,"class","section"),a(e,"data-testid","chat-interface")},m(de,De){T(de,e,De),s(e,t),s(t,n),it&&it.m(n,null),s(n,o),s(n,r),s(r,i),s(i,u),s(u,c),s(u,p),s(u,d),s(u,m),q&&q.m(u,null),s(i,_),s(i,g),s(g,h),s(h,v),s(v,y),s(h,w),s(h,$),s($,R),s(g,N),fe&&fe.m(g,null),s(r,E),s(r,O),s(O,Q),s(Q,Z),s(Z,D),s(D,A),s(A,te),te.checked=l[5],s(A,ne),s(Z,B),s(Z,le),s(le,F),s(F,U),U.checked=l[6],s(F,P),s(O,L);for(let Yt=0;Yt<Se.length;Yt+=1)Se[Yt]&&Se[Yt].m(O,null);s(O,H),Me&&Me.m(O,null),s(r,K),ut&&ut.m(r,null),s(r,V),Lt&&Lt.m(r,null),s(r,ie),s(r,re),s(re,ye),s(ye,Y),Pe(Y,l[1]),s(re,oe),s(re,me),s(me,G),s(G,j),s(n,ue),s(n,ge),s(ge,ae),s(ae,pe),s(ae,_e),s(ae,Re),s(Re,Ve),s(Ve,Be),s(Be,Le),s(Le,Ee),s(Re,he),s(Re,Ae),s(Ae,Ye),s(Ye,Ke),Dt.m(Ke,null),s(ae,Ue),Et&&Et.m(ae,null),s(ae,Ne),Ht[ze].m(ae,null),s(ae,dt),s(ae,Ze),s(Ze,Qe),s(Qe,pt),s(pt,Fe),s(Fe,nt),s(nt,z),s(nt,J),s(Qe,se),s(Qe,Oe),T(de,Ie,De),At&&At.m(de,De),T(de,Ce,De),Mt&&Mt.m(de,De),T(de,ot,De),ke(et,de,De),T(de,yt,De),ke(at,de,De),T(de,Bt,De),Ct&&Ct.m(de,De),T(de,Qt,De),Tt=!0,Vt||(ll=[ee(h,"click",l[46]),ee(te,"change",l[48]),ee(te,"change",l[29]),ee(U,"change",l[49]),ee(Y,"input",l[54]),ee(Y,"keydown",l[38]),ee(G,"click",l[37]),ee(Ee,"click",l[39]),ee(Ke,"click",l[30])],Vt=!0)},p(de,De){if(de[28]?it?(it.p(de,De),De[0]&268435456&&W(it,1)):(it=Fs(de),it.c(),W(it,1),it.m(n,o)):it&&(We(),x(it,1,1,()=>{it=null}),Je()),de[11]?q?q.p(de,De):(q=zs(de),q.c(),q.m(u,null)):q&&(q.d(1),q=null),(!Tt||De[0]&268435456&&k!==(k="fas fa-"+(de[28]?"angle-left":"bars")))&&a(y,"class",k),(!Tt||De[0]&268435456)&&C!==(C=de[28]?"Hide":"History")&&ce(R,C),(!Tt||De[0]&268435456&&I!==(I=de[28]?"Hide session list":"Show session list"))&&a(h,"title",I),de[11]&&!de[27]?fe?fe.p(de,De):(fe=Ks(de),fe.c(),fe.m(g,null)):fe&&(fe.d(1),fe=null),De[0]&32&&(te.checked=de[5]),De[0]&64&&(U.checked=de[6]),De[0]&2017|De[1]&2048){ve=de[0];let gt;for(gt=0;gt<ve.length;gt+=1){const wl=Hs(de,ve,gt);Se[gt]?(Se[gt].p(wl,De),W(Se[gt],1)):(Se[gt]=qs(wl),Se[gt].c(),W(Se[gt],1),Se[gt].m(O,H))}for(We(),gt=ve.length;gt<Se.length;gt+=1)Ge(gt);Je()}de[2]?Me||(Me=Ws(),Me.c(),Me.m(O,null)):Me&&(Me.d(1),Me=null),de[4]?ut?ut.p(de,De):(ut=Js(de),ut.c(),ut.m(r,V)):ut&&(ut.d(1),ut=null),de[3]?Lt?Lt.p(de,De):(Lt=Bs(de),Lt.c(),Lt.m(r,ie)):Lt&&(Lt.d(1),Lt=null),De[0]&2&&Pe(Y,de[1]),(!Tt||De[0]&6&&X!==(X=de[2]||!de[1].trim()))&&(G.disabled=X),jt!==(jt=tl(de))&&(Dt.d(1),Dt=jt(de),Dt&&(Dt.c(),Dt.m(Ke,null))),(!Tt||De[0]&8192)&&(Ke.disabled=de[13]),de[14]?Et?Et.p(de,De):(Et=Qs(de),Et.c(),Et.m(ae,Ne)):Et&&(Et.d(1),Et=null);let Yt=ze;ze=Nt(de),ze===Yt?Ht[ze].p(de,De):(We(),x(Ht[Yt],1,1,()=>{Ht[Yt]=null}),Je(),tt=Ht[ze],tt?tt.p(de,De):(tt=Ht[ze]=Nl[ze](de),tt.c()),W(tt,1),tt.m(ae,dt)),(!Tt||De[0]&4096)&&Xe!==(Xe=de[12].length+"")&&ce(z,Xe),(!Tt||De[0]&268435456)&&vt(n,"sidebar-hidden",!de[28]),de[9]?At?At.p(de,De):(At=Xs(de),At.c(),At.m(Ce.parentNode,Ce)):At&&(At.d(1),At=null),de[10]?Mt?Mt.p(de,De):(Mt=ei(de),Mt.c(),Mt.m(ot.parentNode,ot)):Mt&&(Mt.d(1),Mt=null);const Ft={};De[0]&1048576&&(Ft.context=de[20]),De[0]&2097152&&(Ft.mode=de[21]),!lt&&De[0]&524288&&(lt=!0,Ft.active=de[19],wt(()=>lt=!1)),et.$set(Ft);const nl={};De[0]&2048&&(nl.conversationId=de[11]),!Rt&&De[0]&4194304&&(Rt=!0,nl.active=de[22],wt(()=>Rt=!1)),at.$set(nl),de[24]?Ct?(Ct.p(de,De),De[0]&16777216&&W(Ct,1)):(Ct=oi(de),Ct.c(),W(Ct,1),Ct.m(Qt.parentNode,Qt)):Ct&&(We(),x(Ct,1,1,()=>{Ct=null}),Je())},i(de){if(!Tt){W(it);for(let De=0;De<ve.length;De+=1)W(Se[De]);W(tt),W(et.$$.fragment,de),W(at.$$.fragment,de),W(Ct),Tt=!0}},o(de){x(it),Se=Se.filter(Boolean);for(let De=0;De<Se.length;De+=1)x(Se[De]);x(tt),x(et.$$.fragment,de),x(at.$$.fragment,de),x(Ct),Tt=!1},d(de){de&&S(e),it&&it.d(),q&&q.d(),fe&&fe.d(),_t(Se,de),Me&&Me.d(),ut&&ut.d(),Lt&&Lt.d(),Dt.d(),Et&&Et.d(),Ht[ze].d(),de&&S(Ie),At&&At.d(de),de&&S(Ce),Mt&&Mt.d(de),de&&S(ot),we(et,de),de&&S(yt),we(at,de),de&&S(Bt),Ct&&Ct.d(de),de&&S(Qt),Vt=!1,st(ll)}}}function si(){return"terraphim:chatMarkdown"}async function ln(l){try{await navigator.clipboard.writeText(l)}catch(e){console.warn("Clipboard write failed",e)}}function fu(l,e,t){let n,o,r,i;qe(l,bt,q=>t(79,n=q)),qe(l,$t,q=>t(80,o=q)),qe(l,Jl,q=>t(27,r=q)),qe(l,Rn,q=>t(28,i=q));let u=null,c=null,p=[],d="",m=!1,_=null,g=null,h="",v=!1,y=!1,k=null,w=null,$=!1,C=!1,R=null,I=[],N=!1,E=!1,O="",Q="",Z="document",D=!1,A=!1,te=null,ne="edit",B=null,le=!1,F=!1,U=null,P=null,L=null;function H(){return`terraphim:chatState:${ht($t)}`}function K(){try{if(typeof window>"u")return;const q=localStorage.getItem(H());if(!q)return;const fe=JSON.parse(q);Array.isArray(fe.messages)&&t(0,p=fe.messages),typeof fe.conversationId=="string"&&t(11,R=fe.conversationId)}catch(q){console.warn("Failed to load chat state:",q)}}function V(){try{if(typeof window>"u")return;const q={messages:p,conversationId:R};localStorage.setItem(H(),JSON.stringify(q))}catch(q){console.warn("Failed to save chat state:",q)}}function ie(){try{const q=localStorage.getItem(si());q!=null&&t(5,v=q==="true")}catch{}}function re(){try{localStorage.setItem(si(),v?"true":"false")}catch{}}function ye(q){t(0,p=[...p,{role:"user",content:q}]),V()}async function Y(){try{if(n){const q=await He("list_conversations");q!=null&&q.conversations&&q.conversations.length>0?(t(11,R=q.conversations[0].id),console.log("🎯 Using existing conversation:",R),await me()):await oe()}else{const q=await fetch(`${ct.ServerURL}/conversations`);if(q.ok){const fe=await q.json();fe.conversations&&fe.conversations.length>0?(t(11,R=fe.conversations[0].id),console.log("🎯 Using existing conversation:",R),await me()):await oe()}else await oe()}}catch(q){console.error("❌ Error initializing conversation:",q)}}async function oe(){try{const q=ht($t);if(n){const fe=await He("create_conversation",{title:"Chat Conversation",role:q});fe.status==="success"&&fe.conversation_id&&(t(11,R=fe.conversation_id),console.log("🆕 Created new conversation:",R),V())}else{const fe=await fetch(`${ct.ServerURL}/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"Chat Conversation",role:q})});if(fe.ok){const ve=await fe.json();ve.status==="Success"&&ve.conversation_id&&(t(11,R=ve.conversation_id),console.log("🆕 Created new conversation:",R),V())}}}catch(q){console.error("❌ Error creating conversation:",q)}}async function me(){if(!R){console.warn("⚠️ Cannot load context: no conversation ID available");return}t(13,N=!0),console.log("🔄 Loading conversation context for:",R);try{if(n){console.log("📱 Loading context via Tauri...");const q=r===R,fe=q?"get_persistent_conversation":"get_conversation";console.log(`Using ${fe} for ${q?"persistent":"in-memory"} conversation`);const ve=await He(fe,{conversationId:R});if(console.log("📥 Tauri response:",ve),ve.status==="success"&&ve.conversation){const Se=ve.conversation.global_context||[];t(12,I=Se),console.log(`✅ Loaded ${Se.length} context items via Tauri (${q?"persistent":"in-memory"})`)}else console.error(`❌ Failed to get conversation via Tauri (${fe}):`,ve.error||"Unknown error"),t(12,I=[])}else{console.log("🌐 Loading context via HTTP...");const q=await fetch(`${ct.ServerURL}/conversations/${R}`);if(console.log("📥 HTTP response status:",q.status,q.statusText),q.ok){const fe=await q.json();if(console.log("📄 HTTP response data:",fe),fe.status==="success"&&fe.conversation){const ve=fe.conversation.global_context||[];t(12,I=ve),console.log(`✅ Loaded ${ve.length} context items via HTTP`)}else console.error("❌ Failed to get conversation via HTTP:",fe.error||"Unknown error"),t(12,I=[])}else console.error("❌ HTTP request failed:",q.status,q.statusText),t(12,I=[])}}catch(q){console.error("❌ Error loading conversation context:",{error:q.message||q,conversationId:R,isTauri:n,timestamp:new Date().toISOString()}),t(12,I=[])}finally{t(13,N=!1),console.log("🏁 Context loading completed. Items count:",I.length)}}function G(){t(14,E=!E),E||(t(15,O=""),t(16,Q=""),t(17,Z="document"))}async function j(){if(!(!R||!O.trim()||!Q.trim())){t(18,D=!0);try{const q={title:O.trim(),summary:null,content:Q.trim(),context_type:Z};if(n){const fe=await He("add_context_to_conversation",{conversationId:R,contextData:q});fe.status==="success"?(await me(),G(),console.log("✅ Context added successfully via Tauri")):console.error("❌ Failed to add context via Tauri:",fe.error)}else{const fe=await fetch(`${ct.ServerURL}/conversations/${R}/context`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(q)});if(fe.ok){const ve=await fe.json();ve.status==="success"?(await me(),G(),console.log("✅ Context added successfully via HTTP")):console.error("❌ Failed to add context via HTTP:",ve.error)}else console.error("❌ HTTP request failed:",fe.status,fe.statusText)}}catch(q){console.error("❌ Error adding manual context:",q)}finally{t(18,D=!1)}}}async function X(q,fe){var ve,Se;if(q.context_type==="KGTermDefinition"){let Ge=fe||null;(ve=q.kg_term_definition)!=null&&ve.term?Ge=q.kg_term_definition.term:q.title.startsWith("KG Term: ")?Ge=q.title.replace("KG Term: ",""):(Se=q.metadata)!=null&&Se.normalized_term&&(Ge=q.metadata.normalized_term),Ge?await ue(Ge):(console.warn("Could not extract term from KG context item:",q),t(20,te=q),t(21,ne="edit"),t(19,A=!0))}else t(20,te=q),t(21,ne="edit"),t(19,A=!0)}async function ue(q){var fe,ve,Se,Ge;console.log(`🔍 Finding KG documents for term: "${q}" in role: "${o}"`);try{if(n){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:o,term:q});const Me=await He("find_documents_for_kg_term",{roleName:o,term:q});console.log("  📥 Tauri response received:"),console.log("    Status:",Me.status),console.log("    Results count:",((fe=Me.results)==null?void 0:fe.length)||0),console.log("    Total:",Me.total||0),Me.status==="success"&&Me.results&&Me.results.length>0?(t(24,U=Me.results[0]),t(26,L=U.rank||0),t(25,P=q),console.log("  ✅ Found KG document:",U.title),console.log("  📄 Document content preview:",((ve=U.body)==null?void 0:ve.substring(0,200))+"..."),t(23,F=!0)):console.warn(`  ⚠️  No KG documents found for term: "${q}" in role: "${o}"`)}else{console.log("  Making HTTP fetch call...");const Me=ct.ServerURL,ut=encodeURIComponent(o),Lt=encodeURIComponent(q),tl=`${Me}/roles/${ut}/kg_search?term=${Lt}`,jt=await fetch(tl);if(!jt.ok)throw new Error(`HTTP error! Status: ${jt.status} - ${jt.statusText}`);const Dt=await jt.json();console.log("  📄 Response data:",Dt.status,"Results:",((Se=Dt.results)==null?void 0:Se.length)||0),Dt.status==="success"&&Dt.results&&Dt.results.length>0?(t(24,U=Dt.results[0]),t(26,L=U.rank||0),t(25,P=q),console.log("  ✅ Found KG document:",U.title),console.log("  📄 Document content preview:",((Ge=U.body)==null?void 0:Ge.substring(0,200))+"..."),t(23,F=!0)):console.warn(`  ⚠️  No KG documents found for term: "${q}" in role: "${o}"`)}}catch(Me){console.error("❌ Error fetching KG document:",Me)}}function ge(q){confirm(`Are you sure you want to delete "${q.title}"?`)&&ae(q.id)}async function ae(q){if(!(!R||B)){B=q,console.log("🗑️ Deleting context:",q);try{if(n){const fe=await He("delete_context",{conversationId:R,contextId:q});(fe==null?void 0:fe.status)==="success"?(console.log("✅ Context deleted successfully via Tauri"),await me()):console.error("❌ Failed to delete context via Tauri:",fe==null?void 0:fe.error)}else{const fe=await fetch(`${ct.ServerURL}/conversations/${R}/context/${q}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(fe.ok){const ve=await fe.json();ve.status==="success"?(console.log("✅ Context deleted successfully via HTTP"),await me()):console.error("❌ Failed to delete context via HTTP:",ve.error)}else console.error("❌ HTTP delete request failed:",fe.status)}}catch(fe){console.error("❌ Error deleting context:",fe)}finally{B=null}}}async function pe(q){if(R){console.log("📝 Updating context:",q.id);try{const fe={context_type:q.context_type,title:q.title,summary:q.summary,content:q.content,metadata:q.metadata};if(n){const ve=await He("update_context",{conversationId:R,contextId:q.id,request:fe});(ve==null?void 0:ve.status)==="success"?(console.log("✅ Context updated successfully via Tauri"),await me()):console.error("❌ Failed to update context via Tauri:",ve==null?void 0:ve.error)}else{const ve=await fetch(`${ct.ServerURL}/conversations/${R}/context/${q.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(fe)});if(ve.ok){const Se=await ve.json();Se.status==="success"?(console.log("✅ Context updated successfully via HTTP"),await me()):console.error("❌ Failed to update context via HTTP:",Se.error)}else console.error("❌ HTTP update request failed:",ve.status)}}catch(fe){console.error("❌ Error updating context:",fe)}}}async function _e(){var ve,Se;if(!d.trim()||m)return;t(3,_=null);const q=ht($t),fe=d.trim();t(1,d=""),R||await Y(),ye(fe),t(2,m=!0);try{const Ge={role:q,messages:p};R&&(Ge.conversation_id=R),t(7,k={timestamp:new Date().toISOString(),method:n?"TAURI_INVOKE":"HTTP_POST",endpoint:n?"chat":`${ct.ServerURL}/chat`,body:JSON.parse(JSON.stringify(Ge)),context_items_count:I.length,conversation_id:R});let Me;if(n)Me=await He("chat",{request:Ge});else{const ut=await fetch(`${ct.ServerURL}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Ge)});if(!ut.ok)throw new Error(`HTTP ${ut.status}`);Me=await ut.json()}t(8,w={timestamp:new Date().toISOString(),status:Me.status,model_used:Me.model_used,message_length:((ve=Me.message)==null?void 0:ve.length)||0,full_response:JSON.parse(JSON.stringify(Me)),error:Me.error||null}),t(47,g=Me.model_used??null),((Se=Me.status)==null?void 0:Se.toLowerCase())==="success"&&Me.message?(t(0,p=[...p,{role:"assistant",content:Me.message}]),V()):t(3,_=Me.error||"Chat failed")}catch(Ge){t(3,_=(Ge==null?void 0:Ge.message)||String(Ge)),t(8,w={timestamp:new Date().toISOString(),status:"error",error:(Ge==null?void 0:Ge.message)||String(Ge),full_response:null})}finally{t(2,m=!1)}}function Re(q){(q.key==="Enter"||q.key==="Return")&&!q.shiftKey&&(q.preventDefault(),_e())}function Ve(){t(22,le=!0)}function Be(q){console.log("✅ KG term added to context:",q.detail.term),me()}function Le(q){console.log("✅ KG index added to context for role:",q.detail.role),me()}vl(()=>{if(ie(),K(),p.length===0&&(t(0,p=[{role:"assistant",content:"Hi! How can I help you? Ask me anything about your search results or documents."}]),V()),ht(bt)&&(Pl(()=>Promise.resolve().then(()=>gi),void 0).then(q=>u=q).catch(()=>{}),Pl(()=>import("./fs-60daa36d.js"),["assets/fs-60daa36d.js","assets/vendor-ui-ec1c326c.js","assets/vendor-ui-5061ae11.css","assets/vendor-utils-8620e3e4.js","assets/vendor-editor-5741781d.js","assets/vendor-editor-461b9769.css","assets/vendor-atomic-ec100559.js","assets/novel-editor-ff46bbca.js","assets/novel-editor-62d29ffc.css","assets/vendor-charts-e6a4a6c9.js"]).then(q=>c=q).catch(()=>{})),Y(),typeof window<"u"){const q=()=>{R&&me()};return window.addEventListener("focus",q),()=>{window.removeEventListener("focus",q)}}});async function Ee(q){try{if(ht(bt)&&u&&c){const fe=await u.save({filters:[{name:"Markdown",extensions:["md"]}]});fe&&await c.writeTextFile(fe,q)}else{const fe=new Blob([q],{type:"text/markdown;charset=utf-8"}),ve=URL.createObjectURL(fe),Se=document.createElement("a");Se.href=ve,Se.download="chat.md",document.body.appendChild(Se),Se.click(),document.body.removeChild(Se),URL.revokeObjectURL(ve)}}catch(fe){console.warn("Save markdown failed",fe)}}async function he(q){try{if(n){const fe=await He("get_persistent_conversation",{conversationId:q});if(fe.status==="success"&&fe.conversation){const ve=fe.conversation;t(11,R=ve.id),Jl.set(ve.id),t(0,p=ve.messages||[]),t(12,I=ve.global_context||[]),t(3,_=null),console.log("✅ Loaded persistent conversation:",ve.title),V()}else t(3,_=fe.error||"Failed to load conversation"),console.error("❌ Failed to load persistent conversation:",_)}}catch(fe){console.error("❌ Error loading persistent conversation:",fe),t(3,_=String(fe))}}async function Ae(){if(!R){console.warn("⚠️ No conversation ID to save");return}try{if(n){const q=await He("get_conversation",{conversationId:R});if(q.status==="success"&&q.conversation){const fe=q.conversation,ve=await He("create_persistent_conversation",{title:fe.title||"Chat Conversation",role:fe.role});if(ve.status==="success"&&ve.conversation){const Se=ve.conversation;(await He("update_persistent_conversation",{conversation:{...Se,messages:fe.messages,global_context:fe.global_context}})).status==="success"&&(Jl.set(Se.id),console.log("✅ Saved persistent conversation:",Se.id))}}}}catch(q){console.error("❌ Error saving persistent conversation:",q)}}function Ye(q){he(q)}function Ke(){t(0,p=[]),t(12,I=[]),t(11,R=null),Jl.set(null),t(3,_=null),oe(),console.log("🆕 Started new conversation")}function Ue(){Rn.update(q=>!q)}function Ne(){v=this.checked,t(5,v)}function ze(){y=this.checked,t(6,y)}const tt=q=>ln(q.content),dt=q=>Ee(q.content),Ze=()=>t(9,$=!0),Qe=()=>t(10,C=!0);function pt(){d=this.value,t(1,d)}function Fe(){Z=Wt(this),t(17,Z)}function nt(){O=this.value,t(15,O)}function Xe(){Q=this.value,t(16,Q)}const z=q=>ae(q.detail.contextId),J=q=>X(q.detail.contextItem,q.detail.term),se=q=>X(q),Oe=q=>ge(q),Ie=()=>t(9,$=!1),Ce=()=>t(9,$=!1),ot=()=>t(9,$=!1),et=()=>ln(JSON.stringify(k,null,2)),lt=()=>t(10,C=!1),yt=()=>t(10,C=!1),at=()=>t(10,C=!1),Rt=()=>ln(JSON.stringify(w,null,2));function Bt(q){A=q,t(19,A)}const Qt=q=>pe(q.detail),Tt=q=>ae(q.detail),Vt=()=>{t(19,A=!1),t(20,te=null)};function ll(q){le=q,t(22,le)}function it(q){F=q,t(23,F)}return l.$$.update=()=>{if(l.$$.dirty[1]&65536)try{if(g)if(["ollama","openrouter","anthropic","openai","groq"].includes(g.toLowerCase())){const fe=ht(Jt),ve=ht($t),Se=fe!=null&&fe.roles?fe.roles[ve]:null;let Ge="";g.toLowerCase()==="ollama"?Ge=(Se==null?void 0:Se.ollama_model)||(Se==null?void 0:Se.llm_chat_model)||"":g.toLowerCase()==="openrouter"&&(Ge=(Se==null?void 0:Se.openrouter_chat_model)||(Se==null?void 0:Se.openrouter_model)||""),t(4,h=`Provider: ${g}${Ge?` model: ${Ge}`:""}`)}else t(4,h=`Model: ${g}`);else{const q=ht(Jt),fe=ht($t),ve=q!=null&&q.roles?q.roles[fe]:null;let Se="",Ge="";ve!=null&&ve.openrouter_enabled||ve!=null&&ve.openrouter_chat_model||ve!=null&&ve.openrouter_model?(Se="openrouter",Ge=(ve==null?void 0:ve.openrouter_chat_model)||(ve==null?void 0:ve.openrouter_model)||""):ve!=null&&ve.ollama_model||(ve==null?void 0:ve.llm_provider)==="ollama"?(Se="ollama",Ge=(ve==null?void 0:ve.ollama_model)||(ve==null?void 0:ve.llm_chat_model)||""):ve!=null&&ve.llm_provider?(Se=ve.llm_provider,Ge=(ve==null?void 0:ve.llm_chat_model)||""):q!=null&&q.default_model_provider&&(Se=q.default_model_provider,Ge=(q==null?void 0:q.default_chat_model)||""),Se?t(4,h=`Provider: ${Se}${Ge?` model: ${Ge}`:""}`):t(4,h="")}}catch{t(4,h=g?`Model: ${g}`:"")}},[p,d,m,_,h,v,y,k,w,$,C,R,I,N,E,O,Q,Z,D,A,te,ne,le,F,U,P,L,r,i,re,me,G,j,X,ge,ae,pe,_e,Re,Ve,Be,Le,Ee,Ae,Ye,Ke,Ue,g,Ne,ze,tt,dt,Ze,Qe,pt,Fe,nt,Xe,z,J,se,Oe,Ie,Ce,ot,et,lt,yt,at,Rt,Bt,Qt,Tt,Vt,ll,it]}class du extends Pt{constructor(e){super(),Ut(this,e,fu,uu,Ot,{},null,[-1,-1,-1,-1])}}function pu(l){let e,t;return e=new Oa({}),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},i(n){t||(W(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function mu(l){let e,t;return e=new du({}),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},i(n){t||(W(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function _u(l){let e,t;return e=new nc({}),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},i(n){t||(W(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function gu(l){let e,t;return e=new wr({}),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},i(n){t||(W(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function hu(l){let e,t;return e=new Va({}),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},i(n){t||(W(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function vu(l){let e,t;return e=new Xa({}),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},i(n){t||(W(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function bu(l){let e;return{c(){e=f("nav"),e.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
            <a class="navbar-item" href="/config/wizard">Wizard</a> 
            <a class="navbar-item" href="/config/json">JSON Editor</a> 
            <a class="navbar-item" href="/graph">Graph</a> 
            <a class="navbar-item" href="/chat">Chat</a></div>`,a(e,"class","navbar")},m(t,n){T(t,e,n)},p:$e,d(t){t&&S(e)}}}function ku(l){let e,t,n,o,r,i,u,c,p,d,m,_,g,h,v,y,k,w,$,C,R,I,N,E,O,Q,Z,D,A,te,ne,B,le,F,U,P,L,H,K,V,ie,re,ye,Y,oe,me,G;return E=new Ql({}),Z=new sl({props:{path:"/",$$slots:{default:[pu]},$$scope:{ctx:l}}}),A=new sl({props:{path:"/chat",$$slots:{default:[mu]},$$scope:{ctx:l}}}),ne=new sl({props:{path:"/graph",$$slots:{default:[_u]},$$scope:{ctx:l}}}),U=new sl({props:{path:"/fetch/*",$$slots:{default:[gu]},$$scope:{ctx:l}}}),L=new sl({props:{path:"/config/wizard",$$slots:{default:[hu]},$$scope:{ctx:l}}}),K=new sl({props:{path:"/config/json",$$slots:{default:[vu]},$$scope:{ctx:l}}}),ye=new sl({props:{path:"/",$$slots:{default:[bu]},$$scope:{ctx:l}}}),{c(){e=f("meta"),t=b(),n=f("div"),o=f("main"),r=f("div"),i=f("div"),u=f("div"),c=f("button"),p=f("img"),m=b(),_=f("div"),g=f("ul"),h=f("li"),v=f("a"),v.innerHTML=`<span class="icon is-small"><i class="fas fa-search"></i></span> 
                  <span>Search</span>`,y=b(),k=f("li"),w=f("a"),w.innerHTML=`<span class="icon is-small"><i class="fas fa-comments"></i></span> 
                  <span>Chat</span>`,$=b(),C=f("li"),R=f("a"),R.innerHTML=`<span class="icon is-small"><i class="fas fa-project-diagram"></i></span> 
                  <span>Graph</span>`,I=b(),N=f("div"),be(E.$$.fragment),O=b(),Q=f("div"),be(Z.$$.fragment),D=b(),be(A.$$.fragment),te=b(),be(ne.$$.fragment),B=b(),le=f("br"),F=b(),be(U.$$.fragment),P=b(),be(L.$$.fragment),H=b(),be(K.$$.fragment),V=b(),ie=f("footer"),re=f("div"),be(ye.$$.fragment),a(e,"name","color-scheme"),a(e,"content",l[1]),document.title="Terraphim",ii(p.src,d=_i)||a(p,"src",d),a(p,"alt","Terraphim"),a(p,"class","logo-image svelte-16j63mf"),a(c,"class","logo-back-button svelte-16j63mf"),a(c,"title","Go back"),a(c,"aria-label","Go back"),a(v,"href","/"),a(v,"data-exact",""),a(v,"data-testid","search-tab"),a(h,"class","svelte-16j63mf"),a(w,"href","/chat"),a(w,"data-testid","chat-tab"),a(k,"class","svelte-16j63mf"),a(R,"href","/graph"),a(R,"data-testid","graph-tab"),a(C,"class","svelte-16j63mf"),a(_,"class","tabs is-boxed svelte-16j63mf"),a(u,"class","navigation-row svelte-16j63mf"),a(i,"class","main-navigation svelte-16j63mf"),a(N,"class","role-selector svelte-16j63mf"),a(r,"class","top-controls svelte-16j63mf"),a(Q,"class","main-area svelte-16j63mf"),a(o,"class","main-content svelte-16j63mf"),a(re,"class",Y=rl(l[0])+" svelte-16j63mf"),a(ie,"class","svelte-16j63mf"),a(n,"class","is-full-height svelte-16j63mf")},m(j,X){s(document.head,e),T(j,t,X),T(j,n,X),s(n,o),s(o,r),s(r,i),s(i,u),s(u,c),s(c,p),s(u,m),s(u,_),s(_,g),s(g,h),s(h,v),s(g,y),s(g,k),s(k,w),s(g,$),s(g,C),s(C,R),s(r,I),s(r,N),ke(E,N,null),s(o,O),s(o,Q),ke(Z,Q,null),s(Q,D),ke(A,Q,null),s(Q,te),ke(ne,Q,null),s(o,B),s(o,le),s(o,F),ke(U,o,null),s(o,P),ke(L,o,null),s(o,H),ke(K,o,null),s(n,V),s(n,ie),s(ie,re),ke(ye,re,null),oe=!0,me||(G=[ee(c,"click",l[3]),ee(c,"keydown",l[4]),xl(en.call(null,v)),xl(en.call(null,w)),xl(en.call(null,R)),ee(ie,"mouseover",l[2]),ee(ie,"focus",l[2])],me=!0)},p(j,[X]){(!oe||X&2)&&a(e,"content",j[1]);const ue={};X&64&&(ue.$$scope={dirty:X,ctx:j}),Z.$set(ue);const ge={};X&64&&(ge.$$scope={dirty:X,ctx:j}),A.$set(ge);const ae={};X&64&&(ae.$$scope={dirty:X,ctx:j}),ne.$set(ae);const pe={};X&64&&(pe.$$scope={dirty:X,ctx:j}),U.$set(pe);const _e={};X&64&&(_e.$$scope={dirty:X,ctx:j}),L.$set(_e);const Re={};X&64&&(Re.$$scope={dirty:X,ctx:j}),K.$set(Re);const Ve={};X&64&&(Ve.$$scope={dirty:X,ctx:j}),ye.$set(Ve),(!oe||X&1&&Y!==(Y=rl(j[0])+" svelte-16j63mf"))&&a(re,"class",Y)},i(j){oe||(W(E.$$.fragment,j),W(Z.$$.fragment,j),W(A.$$.fragment,j),W(ne.$$.fragment,j),W(U.$$.fragment,j),W(L.$$.fragment,j),W(K.$$.fragment,j),W(ye.$$.fragment,j),oe=!0)},o(j){x(E.$$.fragment,j),x(Z.$$.fragment,j),x(A.$$.fragment,j),x(ne.$$.fragment,j),x(U.$$.fragment,j),x(L.$$.fragment,j),x(K.$$.fragment,j),x(ye.$$.fragment,j),oe=!1},d(j){S(e),j&&S(t),j&&S(n),we(E),we(Z),we(A),we(ne),we(U),we(L),we(K),we(ye),me=!1,st(G)}}}function wu(l,e,t){let n;qe(l,Ml,c=>t(1,n=c));let o="is-hidden";function r(){t(0,o="")}function i(){window.history.length>1?window.history.back():ui.goto("/")}return[o,n,r,i,c=>{(c.key==="Enter"||c.key===" ")&&(c.preventDefault(),i())}]}class yu extends Pt{constructor(e){super(),Ut(this,e,wu,ku,Ot,{})}}new yu({target:document.getElementById("app")});export{Tl as i};
