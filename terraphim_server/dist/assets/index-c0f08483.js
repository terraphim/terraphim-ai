import{aa as Ee,S as De,i as Ue,s as Re,q as p,Y as te,b as T,y as u,Z as ke,I as fe,j as R,ak as ue,au as ze,r as q,a as C,v as c,z,t as N,d as D,B,av as Zl,aw as dt,H as ye,U as Ne,V as Oe,ax as Ol,ay as Ql,F as xe,g as Te,e as Le,O as Be,az as Xl,l as V,E as Ie,aA as Pe,aB as Dl,C as Xe,D as yt,G as St,aC as Ul,a2 as xl,aD as en,x as Tt,ac as tn,m as Mt,af as rt,aE as Ct,W as Ze,a7 as ln,a9 as nn,a1 as de,n as on,w as Zt}from"./vendor-ui-9d42ca49.js";import{R as Ke,S as Al}from"./vendor-utils-9430c5aa.js";import{J as Ml,_ as sn,o as rn}from"./vendor-editor-1278af61.js";import{P as Pl,T as Lt,u as jl,y as an,A as cn,S as un,q as fn}from"./vendor-atomic-756de3e6.js";import{E as dn}from"./novel-editor-7c40b83e.js";import{s as Nt,z as pn,a as _n,l as mn,m as hn,c as gn,b as vn,B as bn,d as kn}from"./vendor-charts-e6a4a6c9.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function t(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(o){if(o.ep)return;o.ep=!0;const r=t(o);fetch(o.href,r)}})();const Qe={ServerURL:location.protocol+"//"+window.location.host||"/"},Dt=Ee([]),$n={id:"Desktop",global_shortcut:"",roles:{},default_role:{original:"",lowercase:""},selected_role:{original:"",lowercase:""}},ft=Ee("spacelab"),at=Ee("selected"),Ce=Ee(!1),wn=Ee(`${Qe.ServerURL}/documents/search`),je=Ee($n),Qt=Ee([]);let Ot=Ee("");const ut=Ee(!1);let Ye=null;function yn(l){if(typeof document>"u")return;const e=`/assets/bulmaswatch/${l}/bulmaswatch.min.css`;if(Ye!=null&&Ye.href.endsWith(e))return;const t=document.createElement("link");t.rel="stylesheet",t.href=e,t.id="bulma-theme",t.onload=()=>{Ye&&Ye!==t&&Ye.remove(),Ye=t},document.head.appendChild(t);const n=document.head.querySelector('meta[name="color-scheme"]');n&&n.setAttribute("content",l)}ft.subscribe(yn);function Sn(l){let e,t;return{c(){e=p("option"),t=te(l[1]),e.__value=l[0],e.value=e.__value},m(n,o){T(n,e,o),u(e,t)},p(n,[o]){o&2&&ke(t,n[1]),o&1&&(e.__value=n[0],e.value=e.__value)},i:fe,o:fe,d(n){n&&R(e)}}}function Cn(l,e,t){let n,{subject:o}=e;const r=Pl(o),s=Lt(r,jl.properties.name);return ue(l,s,a=>t(1,n=a)),Lt(r,"http://localhost:9883/property/theme"),l.$$set=a=>{"subject"in a&&t(0,o=a.subject)},[o,n,s]}class Rn extends De{constructor(e){super(),Ue(this,e,Cn,Sn,Re,{subject:0})}}function Tn(){return window.crypto.getRandomValues(new Uint32Array(1))[0]}function Ut(l,e=!1){const t=Tn(),n=`_${t}`;return Object.defineProperty(window,n,{value:o=>(e&&Reflect.deleteProperty(window,n),l==null?void 0:l(o)),writable:!1,configurable:!0}),t}async function be(l,e={}){return new Promise((t,n)=>{const o=Ut(s=>{t(s),Reflect.deleteProperty(window,`_${r}`)},!0),r=Ut(s=>{n(s),Reflect.deleteProperty(window,`_${o}`)},!0);window.__TAURI_IPC__({cmd:l,callback:o,error:r,...e})})}function Xt(l,e,t){const n=l.slice();return n[25]=e[t],n}function Ln(l){let e,t,n;function o(s){l[13](s)}let r={};return l[5]!==void 0&&(r.value=l[5]),e=new dt({props:r}),ye.push(()=>Ne(e,"value",o)),{c(){q(e.$$.fragment)},m(s,a){z(e,s,a),n=!0},p(s,a){const i={};!t&&a&32&&(t=!0,i.value=s[5],Oe(()=>t=!1)),e.$set(i)},i(s){n||(N(e.$$.fragment,s),n=!0)},o(s){D(e.$$.fragment,s),n=!1},d(s){B(e,s)}}}function En(l){let e,t,n;function o(s){l[14](s)}let r={type:"password",placeholder:"secret",icon:"fas fa-lock",expanded:!0};return l[6]!==void 0&&(r.value=l[6]),e=new dt({props:r}),ye.push(()=>Ne(e,"value",o)),{c(){q(e.$$.fragment)},m(s,a){z(e,s,a),n=!0},p(s,a){const i={};!t&&a&64&&(t=!0,i.value=s[6],Oe(()=>t=!1)),e.$set(i)},i(s){n||(N(e.$$.fragment,s),n=!0)},o(s){D(e.$$.fragment,s),n=!1},d(s){B(e,s)}}}function Nn(l){let e;return{c(){e=te("Save")},m(t,n){T(t,e,n)},d(t){t&&R(e)}}}function On(l){let e,t;return e=new Ol({props:{type:"is-success",class:"is-right",iconPack:"fa",iconLeft:"check",$$slots:{default:[Nn]},$$scope:{ctx:l}}}),e.$on("click",l[8]),e.$on("submit",l[8]),{c(){q(e.$$.fragment)},m(n,o){z(e,n,o),t=!0},p(n,o){const r={};o&268435456&&(r.$$scope={dirty:o,ctx:n}),e.$set(r)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){B(e,n)}}}function Dn(l){let e,t,n,o,r,s;return e=new ze({props:{$$slots:{default:[Ln]},$$scope:{ctx:l}}}),n=new ze({props:{grouped:!0,$$slots:{default:[En]},$$scope:{ctx:l}}}),r=new ze({props:{grouped:!0,$$slots:{default:[On]},$$scope:{ctx:l}}}),{c(){q(e.$$.fragment),t=C(),q(n.$$.fragment),o=C(),q(r.$$.fragment)},m(a,i){z(e,a,i),T(a,t,i),z(n,a,i),T(a,o,i),z(r,a,i),s=!0},p(a,i){const _={};i&268435488&&(_.$$scope={dirty:i,ctx:a}),e.$set(_);const h={};i&268435520&&(h.$$scope={dirty:i,ctx:a}),n.$set(h);const d={};i&268435456&&(d.$$scope={dirty:i,ctx:a}),r.$set(d)},i(a){s||(N(e.$$.fragment,a),N(n.$$.fragment,a),N(r.$$.fragment,a),s=!0)},o(a){D(e.$$.fragment,a),D(n.$$.fragment,a),D(r.$$.fragment,a),s=!1},d(a){B(e,a),a&&R(t),B(n,a),a&&R(o),B(r,a)}}}function Un(l){let e,t,n;function o(s){l[15](s)}let r={type:"search",placeholder:"Fetch JSON",icon:"search"};return l[3]!==void 0&&(r.value=l[3]),e=new dt({props:r}),ye.push(()=>Ne(e,"value",o)),{c(){q(e.$$.fragment)},m(s,a){z(e,s,a),n=!0},p(s,a){const i={};!t&&a&8&&(t=!0,i.value=s[3],Oe(()=>t=!1)),e.$set(i)},i(s){n||(N(e.$$.fragment,s),n=!0)},o(s){D(e.$$.fragment,s),n=!1},d(s){B(e,s)}}}function An(l){let e;return{c(){e=te("WikiPage")},m(t,n){T(t,e,n)},d(t){t&&R(e)}}}function Mn(l){let e,t,n,o,r,s;function a(d){l[16](d)}let i={type:"search",placeholder:"Post JSON",icon:"search"};l[4]!==void 0&&(i.value=l[4]),e=new dt({props:i}),ye.push(()=>Ne(e,"value",a));function _(d){l[17](d)}let h={$$slots:{default:[An]},$$scope:{ctx:l}};return l[2]!==void 0&&(h.checked=l[2]),o=new Ql({props:h}),ye.push(()=>Ne(o,"checked",_)),{c(){q(e.$$.fragment),n=C(),q(o.$$.fragment)},m(d,f){z(e,d,f),T(d,n,f),z(o,d,f),s=!0},p(d,f){const g={};!t&&f&16&&(t=!0,g.value=d[4],Oe(()=>t=!1)),e.$set(g);const m={};f&268435456&&(m.$$scope={dirty:f,ctx:d}),!r&&f&4&&(r=!0,m.checked=d[2],Oe(()=>r=!1)),o.$set(m)},i(d){s||(N(e.$$.fragment,d),N(o.$$.fragment,d),s=!0)},o(d){D(e.$$.fragment,d),D(o.$$.fragment,d),s=!1},d(d){B(e,d),d&&R(n),B(o,d)}}}function Pn(l){let e;return{c(){e=te("Fetch")},m(t,n){T(t,e,n)},d(t){t&&R(e)}}}function jn(l){let e,t;return e=new Ol({props:{type:"is-primary",$$slots:{default:[Pn]},$$scope:{ctx:l}}}),e.$on("click",l[9]),e.$on("submit",l[9]),{c(){q(e.$$.fragment)},m(n,o){z(e,n,o),t=!0},p(n,o){const r={};o&268435456&&(r.$$scope={dirty:o,ctx:n}),e.$set(r)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){B(e,n)}}}function In(l){let e,t,n,o,r,s;return e=new ze({props:{grouped:!0,$$slots:{default:[Un]},$$scope:{ctx:l}}}),n=new ze({props:{grouped:!0,$$slots:{default:[Mn]},$$scope:{ctx:l}}}),r=new ze({props:{grouped:!0,$$slots:{default:[jn]},$$scope:{ctx:l}}}),{c(){q(e.$$.fragment),t=C(),q(n.$$.fragment),o=C(),q(r.$$.fragment)},m(a,i){z(e,a,i),T(a,t,i),z(n,a,i),T(a,o,i),z(r,a,i),s=!0},p(a,i){const _={};i&268435464&&(_.$$scope={dirty:i,ctx:a}),e.$set(_);const h={};i&268435476&&(h.$$scope={dirty:i,ctx:a}),n.$set(h);const d={};i&268435456&&(d.$$scope={dirty:i,ctx:a}),r.$set(d)},i(a){s||(N(e.$$.fragment,a),N(n.$$.fragment,a),N(r.$$.fragment,a),s=!0)},o(a){D(e.$$.fragment,a),D(n.$$.fragment,a),D(r.$$.fragment,a),s=!1},d(a){B(e,a),a&&R(t),B(n,a),a&&R(o),B(r,a)}}}function Wn(l){let e,t,n,o,r;return o=new Ml({props:{content:l[1],onChange:l[7]}}),{c(){e=p("p"),e.innerHTML=`<i>The best editing experience is to configure Atomic Server, in the
        meantime use editor below. You will need to refresh page via Command R
        or Ctrl-R to see changes</i>`,t=C(),n=p("div"),q(o.$$.fragment),c(n,"class","editor")},m(s,a){T(s,e,a),T(s,t,a),T(s,n,a),z(o,n,null),r=!0},p(s,a){const i={};a&2&&(i.content=s[1]),o.$set(i)},i(s){r||(N(o.$$.fragment,s),r=!0)},o(s){D(o.$$.fragment,s),r=!1},d(s){s&&R(e),s&&R(t),s&&R(n),B(o)}}}function xt(l){let e,t;return e=new Rn({props:{subject:l[25]}}),{c(){q(e.$$.fragment)},m(n,o){z(e,n,o),t=!0},p(n,o){const r={};o&1&&(r.subject=n[25]),e.$set(r)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){B(e,n)}}}function Hn(l){let e,t,n=l[0]??[],o=[];for(let s=0;s<n.length;s+=1)o[s]=xt(Xt(l,n,s));const r=s=>D(o[s],1,1,()=>{o[s]=null});return{c(){for(let s=0;s<o.length;s+=1)o[s].c();e=xe()},m(s,a){for(let i=0;i<o.length;i+=1)o[i]&&o[i].m(s,a);T(s,e,a),t=!0},p(s,a){if(a&1){n=s[0]??[];let i;for(i=0;i<n.length;i+=1){const _=Xt(s,n,i);o[i]?(o[i].p(_,a),N(o[i],1)):(o[i]=xt(_),o[i].c(),N(o[i],1),o[i].m(e.parentNode,e))}for(Te(),i=n.length;i<o.length;i+=1)r(i);Le()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)N(o[a]);t=!0}},o(s){o=o.filter(Boolean);for(let a=0;a<o.length;a+=1)D(o[a]);t=!1},d(s){Be(o,s),s&&R(e)}}}function Fn(l){let e,t;return e=new Zl({props:{$$slots:{default:[Hn]},$$scope:{ctx:l}}}),{c(){q(e.$$.fragment)},m(n,o){z(e,n,o),t=!0},p(n,o){const r={};o&268435457&&(r.$$scope={dirty:o,ctx:n}),e.$set(r)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){B(e,n)}}}function Kn(l){let e,t,n,o,r,s,a,i,_,h,d,f,g;return t=new Ke({props:{path:"/atomic",$$slots:{default:[Dn]},$$scope:{ctx:l}}}),o=new Ke({props:{path:"/json",$$slots:{default:[In]},$$scope:{ctx:l}}}),s=new Ke({props:{path:"/editor",$$slots:{default:[Wn]},$$scope:{ctx:l}}}),h=new ze({props:{grouped:!0,position:"is-right",$$slots:{default:[Fn]},$$scope:{ctx:l}}}),{c(){e=p("div"),q(t.$$.fragment),n=C(),q(o.$$.fragment),r=C(),q(s.$$.fragment),a=C(),i=p("hr"),_=C(),q(h.$$.fragment),d=C(),f=p("nav"),f.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
    <a class="navbar-item" href="/fetch/json">Fetch JSON Data</a> 
    <a class="navbar-item" href="/fetch/atomic">Set Atomic Server</a> 
    <a class="navbar-item" href="/fetch/editor">Edit JSON config</a></div>`,c(e,"class","box"),c(f,"class","navbar")},m(m,$){T(m,e,$),z(t,e,null),u(e,n),z(o,e,null),u(e,r),z(s,e,null),T(m,a,$),T(m,i,$),T(m,_,$),z(h,m,$),T(m,d,$),T(m,f,$),g=!0},p(m,[$]){const w={};$&268435552&&(w.$$scope={dirty:$,ctx:m}),t.$set(w);const v={};$&268435484&&(v.$$scope={dirty:$,ctx:m}),o.$set(v);const k={};$&268435458&&(k.$$scope={dirty:$,ctx:m}),s.$set(k);const O={};$&268435457&&(O.$$scope={dirty:$,ctx:m}),h.$set(O)},i(m){g||(N(t.$$.fragment,m),N(o.$$.fragment,m),N(s.$$.fragment,m),N(h.$$.fragment,m),g=!0)},o(m){D(t.$$.fragment,m),D(o.$$.fragment,m),D(s.$$.fragment,m),D(h.$$.fragment,m),g=!1},d(m){m&&R(e),B(t),B(o),B(s),m&&R(a),m&&R(i),m&&R(_),B(h,m),m&&R(d),m&&R(f)}}}function Gn(l,e,t){let n,o,r,s,a;ue(l,an,E=>t(19,r=E)),ue(l,Ce,E=>t(20,s=E)),ue(l,je,E=>t(21,a=E));let i={json:a};function _(E){if(console.log("contents changed:",E),console.log("is tauri",s),je.update(S=>(S=E.json,S)),Ce)console.log("Updating config on server"),be("update_config",{configNew:E.json}).then(S=>{console.log(`Message: ${S}`)}).catch(S=>console.error(S));else{let S=`${Qe.ServerURL}/config/`;fetch(S,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(E.json)})}t(1,i=E)}let h=!1,d="https://raw.githubusercontent.com/terraphim/terraphim-cloud-fastapi/main/data/ref_arch.json",f="http://localhost:8000/documents/",g="http://localhost:9883/",m;const $=async()=>{console.log("Updating atomic server configuration");const E=cn.fromSecret(m);r.setServerUrl(g),console.log("Server set.Setting agent"),r.setAgent(E)},w=async()=>{O()},v=({data:{msg:E,data:S}})=>{console.log(E,S)};let k;const O=async()=>{const E=await sn(()=>import("./fetcher.worker-7e58969a.js"),[]);k=new E.default,k.onmessage=v;const S={msg:"fetcher",data:{url:d,postUrl:f,isWiki:h}};k.postMessage(S)},F=Pl("http://localhost:9883/config/y3zx5wtm0bq"),K=Lt(F,jl.properties.name);ue(l,K,E=>t(12,o=E));const b=Lt(F,"http://localhost:9883/property/role");ue(l,b,E=>t(0,n=E));function L(E){g=E,t(5,g)}function H(E){m=E,t(6,m)}function G(E){d=E,t(3,d)}function J(E){f=E,t(4,f)}function j(E){h=E,t(2,h)}return l.$$.update=()=>{l.$$.dirty&4096&&console.log("Print name",o),l.$$.dirty&1&&console.log("Print roles",n)},[n,i,h,d,f,g,m,_,$,w,K,b,o,L,H,G,J,j]}class qn extends De{constructor(e){super(),Ue(this,e,Gn,Kn,Re,{})}}function zn(l){let e,t;return e=new dn({props:{defaultValue:l[0],isEditable:!l[1],disableLocalStorage:!0,onUpdate:l[2],extensions:[rn]}}),{c(){q(e.$$.fragment)},m(n,o){z(e,n,o),t=!0},p(n,[o]){const r={};o&1&&(r.defaultValue=n[0]),o&2&&(r.isEditable=!n[1]),e.$set(r)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){B(e,n)}}}function Bn(l,e,t){let{html:n=""}=e,{readOnly:o=!1}=e,{outputFormat:r="html"}=e;const s=a=>{r==="markdown"?t(0,n=a.storage.markdown.getMarkdown()):t(0,n=a.getHTML())};return l.$$set=a=>{"html"in a&&t(0,n=a.html),"readOnly"in a&&t(1,o=a.readOnly),"outputFormat"in a&&t(3,r=a.outputFormat)},[n,o,s,r]}class Jn extends De{constructor(e){super(),Ue(this,e,Bn,zn,Re,{html:0,readOnly:1,outputFormat:3})}}function el(l){let e,t,n,o,r,s,a,i,_,h,d;return{c(){e=p("div"),t=p("h3"),n=p("span"),n.textContent="Knowledge Graph",o=te(`
          Term: `),r=p("strong"),s=te(l[2]),a=te(" | Rank: "),i=p("strong"),_=te(l[3]),h=C(),d=p("hr"),c(n,"class","tag is-info"),c(t,"class","subtitle is-6"),c(e,"class","kg-context")},m(f,g){T(f,e,g),u(e,t),u(t,n),u(t,o),u(t,r),u(r,s),u(t,a),u(t,i),u(i,_),u(e,h),u(e,d)},p(f,g){g&4&&ke(s,f[2]),g&8&&ke(_,f[3])},d(f){f&&R(e)}}}function Vn(l){let e,t,n,o,r,s,a,i;const _=[Qn,Zn],h=[];function d(f,g){return f[5]?0:1}return t=d(l),n=h[t]=_[t](l),{c(){e=p("div"),n.c(),o=C(),r=p("div"),r.innerHTML='<span class="hint-text svelte-17ne3xd">Double-click to edit • Ctrl+E to edit • Ctrl+S to save</span>',c(r,"class","edit-hint svelte-17ne3xd"),c(e,"class","content-viewer svelte-17ne3xd"),c(e,"tabindex","0"),c(e,"role","button"),c(e,"aria-label","Double-click to edit article content")},m(f,g){T(f,e,g),h[t].m(e,null),u(e,o),u(e,r),l[15](e),s=!0,a||(i=[V(e,"dblclick",l[9]),V(e,"keydown",l[10])],a=!0)},p(f,g){let m=t;t=d(f),t===m?h[t].p(f,g):(Te(),D(h[m],1,1,()=>{h[m]=null}),Le(),n=h[t],n?n.p(f,g):(n=h[t]=_[t](f),n.c()),N(n,1),n.m(e,o))},i(f){s||(N(n),s=!0)},o(f){D(n),s=!1},d(f){f&&R(e),h[t].d(),l[15](null),a=!1,Ie(i)}}}function Yn(l){let e,t,n,o,r,s,a,i,_,h;function d(g){l[13](g)}let f={outputFormat:l[7]};return l[1].body!==void 0&&(f.html=l[1].body),e=new Jn({props:f}),ye.push(()=>Ne(e,"html",d)),{c(){q(e.$$.fragment),n=C(),o=p("div"),r=p("button"),r.textContent="Save",s=C(),a=p("button"),a.textContent="Cancel",c(r,"class","button is-primary"),c(a,"class","button is-light"),c(o,"class","edit-controls svelte-17ne3xd")},m(g,m){z(e,g,m),T(g,n,m),T(g,o,m),u(o,r),u(o,s),u(o,a),i=!0,_||(h=[V(r,"click",l[8]),V(a,"click",l[14])],_=!0)},p(g,m){const $={};m&128&&($.outputFormat=g[7]),!t&&m&2&&(t=!0,$.html=g[1].body,Oe(()=>t=!1)),e.$set($)},i(g){i||(N(e.$$.fragment,g),i=!0)},o(g){D(e.$$.fragment,g),i=!1},d(g){B(e,g),g&&R(n),g&&R(o),_=!1,Ie(h)}}}function Zn(l){let e,t,n;return t=new Al({props:{source:l[1].body}}),{c(){e=p("div"),q(t.$$.fragment),c(e,"class","markdown-content svelte-17ne3xd")},m(o,r){T(o,e,r),z(t,e,null),n=!0},p(o,r){const s={};r&2&&(s.source=o[1].body),t.$set(s)},i(o){n||(N(t.$$.fragment,o),n=!0)},o(o){D(t.$$.fragment,o),n=!1},d(o){o&&R(e),B(t)}}}function Qn(l){let e,t=l[1].body+"";return{c(){e=p("div"),c(e,"class","prose")},m(n,o){T(n,e,o),e.innerHTML=t},p(n,o){o&2&&t!==(t=n[1].body+"")&&(e.innerHTML=t)},i:fe,o:fe,d(n){n&&R(e)}}}function Xn(l){let e,t,n,o,r,s=l[1].title+"",a,i,_,h,d,f,g,m=l[2]&&l[3]!==null&&el(l);const $=[Yn,Vn],w=[];function v(k,O){return k[4]?0:1}return _=v(l),h=w[_]=$[_](l),{c(){e=p("div"),t=p("button"),n=C(),m&&m.c(),o=C(),r=p("h2"),a=te(s),i=C(),h.c(),c(t,"class","delete is-large modal-close-btn svelte-17ne3xd"),c(t,"aria-label","close"),c(r,"class","svelte-17ne3xd"),c(e,"class","box wrapper svelte-17ne3xd")},m(k,O){T(k,e,O),u(e,t),u(e,n),m&&m.m(e,null),u(e,o),u(e,r),u(r,a),u(e,i),w[_].m(e,null),d=!0,f||(g=V(t,"click",l[12]),f=!0)},p(k,O){k[2]&&k[3]!==null?m?m.p(k,O):(m=el(k),m.c(),m.m(e,o)):m&&(m.d(1),m=null),(!d||O&2)&&s!==(s=k[1].title+"")&&ke(a,s);let F=_;_=v(k),_===F?w[_].p(k,O):(Te(),D(w[F],1,1,()=>{w[F]=null}),Le(),h=w[_],h?h.p(k,O):(h=w[_]=$[_](k),h.c()),N(h,1),h.m(e,null))},i(k){d||(N(h),d=!0)},o(k){D(h),d=!1},d(k){k&&R(e),m&&m.d(),w[_].d(),f=!1,g()}}}function xn(l){let e,t,n;function o(s){l[16](s)}let r={$$slots:{default:[Xn]},$$scope:{ctx:l}};return l[0]!==void 0&&(r.active=l[0]),e=new Xl({props:r}),ye.push(()=>Ne(e,"active",o)),{c(){q(e.$$.fragment)},m(s,a){z(e,s,a),n=!0},p(s,[a]){const i={};a&524543&&(i.$$scope={dirty:a,ctx:s}),!t&&a&1&&(t=!0,i.active=s[0],Oe(()=>t=!1)),e.$set(i)},i(s){n||(N(e.$$.fragment,s),n=!0)},o(s){D(e.$$.fragment,s),n=!1},d(s){B(e,s)}}}function eo(l,e,t){let n,o,r;ue(l,Ce,b=>t(17,r=b));let{active:s=!1}=e,{item:a}=e,{initialEdit:i=!1}=e,{kgTerm:_=null}=e,{kgRank:h=null}=e,d=!1,f;async function g(){if(r)try{const b=await be("get_document",{document_id:a.id});b!=null&&b.document&&t(1,a=b.document)}catch(b){console.error("Failed to load document",b)}}async function m(){if(!r){t(4,d=!1);return}try{await be("create_document",{document:a}),t(4,d=!1)}catch(b){console.error("Failed to save document",b)}}function $(){t(4,d=!0)}function w(b){b.type!=="dblclick"&&((b.ctrlKey||b.metaKey)&&b.key==="e"&&(b.preventDefault(),t(4,d=!0)),d&&(b.ctrlKey||b.metaKey)&&b.key==="s"&&(b.preventDefault(),m()),b.key==="Escape"&&(b.preventDefault(),d?t(4,d=!1):t(0,s=!1)))}const v=()=>t(0,s=!1);function k(b){l.$$.not_equal(a.body,b)&&(a.body=b,t(1,a))}const O=()=>t(4,d=!1);function F(b){ye[b?"unshift":"push"](()=>{f=b,t(6,f)})}function K(b){s=b,t(0,s)}return l.$$set=b=>{"active"in b&&t(0,s=b.active),"item"in b&&t(1,a=b.item),"initialEdit"in b&&t(11,i=b.initialEdit),"kgTerm"in b&&t(2,_=b.kgTerm),"kgRank"in b&&t(3,h=b.kgRank)},l.$$.update=()=>{l.$$.dirty&2049&&s&&i&&t(4,d=!0),l.$$.dirty&19&&s&&a&&!d&&g(),l.$$.dirty&2&&t(5,n=a!=null&&a.body?/<html/i.test(a.body)||/<body/i.test(a.body)||/<head/i.test(a.body)||/^\s*<(!DOCTYPE|html|head|body|div|p|span)/i.test(a.body.trim()):!1),l.$$.dirty&32&&t(7,o=n?"html":"markdown")},[s,a,_,h,d,n,f,o,m,$,w,i,v,k,O,F,K]}class Pt extends De{constructor(e){super(),Ue(this,e,eo,xn,Re,{active:0,item:1,initialEdit:11,kgTerm:2,kgRank:3})}}async function Il(l){return be("tauri",l)}async function to(l,e){return Il({__tauriModule:"Event",message:{cmd:"unlisten",event:l,eventId:e}})}async function lo(l,e,t){return Il({__tauriModule:"Event",message:{cmd:"listen",event:l,windowLabel:e,handler:Ut(t)}}).then(n=>async()=>to(l,n))}var tl;(function(l){l.WINDOW_RESIZED="tauri://resize",l.WINDOW_MOVED="tauri://move",l.WINDOW_CLOSE_REQUESTED="tauri://close-requested",l.WINDOW_CREATED="tauri://window-created",l.WINDOW_DESTROYED="tauri://destroyed",l.WINDOW_FOCUS="tauri://focus",l.WINDOW_BLUR="tauri://blur",l.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",l.WINDOW_THEME_CHANGED="tauri://theme-changed",l.WINDOW_FILE_DROP="tauri://file-drop",l.WINDOW_FILE_DROP_HOVER="tauri://file-drop-hover",l.WINDOW_FILE_DROP_CANCELLED="tauri://file-drop-cancelled",l.MENU="tauri://menu",l.CHECK_UPDATE="tauri://update",l.UPDATE_AVAILABLE="tauri://update-available",l.INSTALL_UPDATE="tauri://update-install",l.STATUS_UPDATE="tauri://update-status",l.DOWNLOAD_PROGRESS="tauri://update-download-progress"})(tl||(tl={}));async function no(l,e){return lo(l,null,e)}function ll(l,e,t){const n=l.slice();return n[9]=e[t],n}function nl(l){let e,t=l[9].name+"",n,o;return{c(){e=p("option"),n=te(t),e.__value=o=l[9].name,e.value=e.__value},m(r,s){T(r,e,s),u(e,n)},p(r,s){s&1&&t!==(t=r[9].name+"")&&ke(n,t),s&1&&o!==(o=r[9].name)&&(e.__value=o,e.value=e.__value)},d(r){r&&R(e)}}}function oo(l){let e,t,n,o,r,s,a=l[0],i=[];for(let _=0;_<a.length;_+=1)i[_]=nl(ll(l,a,_));return{c(){e=p("div"),t=p("div"),n=p("div"),o=p("select");for(let _=0;_<i.length;_+=1)i[_].c();c(n,"class","select"),c(t,"class","control"),c(e,"class","field is-grouped is-grouped-right")},m(_,h){T(_,e,h),u(e,t),u(t,n),u(n,o);for(let d=0;d<i.length;d+=1)i[d]&&i[d].m(o,null);Pe(o,l[1]),r||(s=V(o,"change",l[2]),r=!0)},p(_,[h]){if(h&1){a=_[0];let d;for(d=0;d<a.length;d+=1){const f=ll(_,a,d);i[d]?i[d].p(f,h):(i[d]=nl(f),i[d].c(),i[d].m(o,null))}for(;d<i.length;d+=1)i[d].d(1);i.length=a.length}h&3&&Pe(o,_[1])},i:fe,o:fe,d(_){_&&R(e),Be(i,_),r=!1,s()}}}function so(l,e,t){let n,o,r,s;ue(l,je,f=>t(5,n=f)),ue(l,Ce,f=>t(6,o=f)),ue(l,Qt,f=>t(0,r=f)),ue(l,at,f=>t(1,s=f));let a="";async function i(){try{Ce.set(window.__TAURI__!==void 0),o?(console.log("Loading config from Tauri"),be("get_config").then(f=>{console.log("get_config response",f),f&&f.status==="success"&&_(f.config)}).catch(f=>console.error("Error fetching config in Tauri:",f))):(console.log("Loading config from server"),a=`${Qe.ServerURL}/config/`,fetch(a).then(f=>f.json()).then(f=>{console.log("Config received",f),f&&f.status==="success"&&_(f.config)}).catch(f=>console.error("Error fetching config:",f)))}catch(f){console.error("Unhandled error in loadConfig:",f)}}function _(f){var w;console.log("Updating stores from config:",f);const g={default_role:f.selected_role,...f};je.set(g);const m=Object.entries(f.roles).map(([v,k])=>({name:v,...k}));Qt.set(m),at.set(f.selected_role);const $=f.roles[f.selected_role];if(console.log("Selected role settings:",$),$){const v=$.theme||"spacelab";console.log("Setting theme to:",v),ft.set(v),(w=$.kg)!=null&&w.publish?o&&be("publish_thesaurus",{roleName:f.selected_role}).then(k=>{console.log("publish_thesaurus response",k),Dt.set(k),ut.set(!0)}):ut.set(!1)}else console.warn("No role settings found for:",f.selected_role),ft.set("spacelab")}typeof window<"u"&&window.__TAURI__&&no("role_changed",f=>{console.log("Role changed event received from backend:",f.payload),_(f.payload)});async function h(){await i()}h(),console.log("Using Terraphim Server URL:",Qe.ServerURL);function d(f){var v;const m=f.target.value;console.log("Role change requested:",m),at.set(m);const $=r.find(k=>k.name===m);if(!$){console.error(`No role settings found for role: ${m}.`);return}const w=$.theme||"spacelab";ft.set(w),console.log(`Theme changed to ${w}`),je.update(k=>(k.selected_role=m,k)),o?(be("select_role",{roleName:m}).catch(k=>console.error("Error selecting role:",k)),(v=$.kg)!=null&&v.publish?(console.log("Publishing thesaurus for role",m),be("publish_thesaurus",{roleName:m}).then(k=>{Dt.set(k),ut.set(!0)})):ut.set(!1)):fetch(`${Qe.ServerURL}/config/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).catch(k=>console.error("Error updating config on server:",k))}return[r,s,d,i]}class Rt extends De{constructor(e){super(),Ue(this,e,so,oo,Re,{loadConfig:3})}get loadConfig(){return this.$$.ctx[3]}}function ol(l,e,t){const n=l.slice();return n[14]=e[t],n}function sl(l){let e,t;return e=new Dl({props:{$$slots:{default:[ao]},$$scope:{ctx:l}}}),{c(){q(e.$$.fragment)},m(n,o){z(e,n,o),t=!0},p(n,o){const r={};o&131137&&(r.$$scope={dirty:o,ctx:n}),e.$set(r)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){B(e,n)}}}function ro(l){let e=l[14]+"",t;return{c(){t=te(e)},m(n,o){T(n,t,o)},p(n,o){o&1&&e!==(e=n[14]+"")&&ke(t,e)},d(n){n&&R(t)}}}function rl(l){let e,t,n,o,r,s;t=new Ul({props:{rounded:!0,$$slots:{default:[ro]},$$scope:{ctx:l}}});function a(){return l[9](l[14])}return{c(){e=p("button"),q(t.$$.fragment),n=C(),c(e,"class","tag-button svelte-1m2cvhr"),e.disabled=l[6],c(e,"title","Click to view knowledge graph document")},m(i,_){T(i,e,_),z(t,e,null),u(e,n),o=!0,r||(s=V(e,"click",a),r=!0)},p(i,_){l=i;const h={};_&131073&&(h.$$scope={dirty:_,ctx:l}),t.$set(h),(!o||_&64)&&(e.disabled=l[6])},i(i){o||(N(t.$$.fragment,i),o=!0)},o(i){D(t.$$.fragment,i),o=!1},d(i){i&&R(e),B(t),r=!1,s()}}}function ao(l){let e,t,n=l[0].tags,o=[];for(let s=0;s<n.length;s+=1)o[s]=rl(ol(l,n,s));const r=s=>D(o[s],1,1,()=>{o[s]=null});return{c(){for(let s=0;s<o.length;s+=1)o[s].c();e=xe()},m(s,a){for(let i=0;i<o.length;i+=1)o[i]&&o[i].m(s,a);T(s,e,a),t=!0},p(s,a){if(a&321){n=s[0].tags;let i;for(i=0;i<n.length;i+=1){const _=ol(s,n,i);o[i]?(o[i].p(_,a),N(o[i],1)):(o[i]=rl(_),o[i].c(),N(o[i],1),o[i].m(e.parentNode,e))}for(Te(),i=n.length;i<o.length;i+=1)r(i);Le()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)N(o[a]);t=!0}},o(s){o=o.filter(Boolean);for(let a=0;a<o.length;a+=1)D(o[a]);t=!1},d(s){Be(o,s),s&&R(e)}}}function io(l){let e,t=l[0].rank+"",n;return{c(){e=te("Rank "),n=te(t)},m(o,r){T(o,e,r),T(o,n,r)},p(o,r){r&1&&t!==(t=o[0].rank+"")&&ke(n,t)},d(o){o&&R(e),o&&R(n)}}}function co(l){let e,t;return e=new Ul({props:{rounded:!0,$$slots:{default:[io]},$$scope:{ctx:l}}}),{c(){q(e.$$.fragment)},m(n,o){z(e,n,o),t=!0},p(n,o){const r={};o&131073&&(r.$$scope={dirty:o,ctx:n}),e.$set(r)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){B(e,n)}}}function uo(l){let e;return{c(){e=p("small"),e.textContent="No description available",c(e,"class","no-description svelte-1m2cvhr")},m(t,n){T(t,e,n)},p:fe,i:fe,o:fe,d(t){t&&R(e)}}}function fo(l){let e,t;return e=new Al({props:{source:l[0].description}}),{c(){q(e.$$.fragment)},m(n,o){z(e,n,o),t=!0},p(n,o){const r={};o&1&&(r.source=n[0].description),e.$set(r)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){B(e,n)}}}function al(l){let e,t,n;return{c(){e=p("a"),t=p("span"),t.innerHTML='<i class="fas fa-link"></i>',c(t,"class","icon is-medium"),c(e,"href",n=l[0].url),c(e,"target","_blank"),c(e,"class","level-item"),c(e,"aria-label","URL")},m(o,r){T(o,e,r),u(e,t)},p(o,r){r&1&&n!==(n=o[0].url)&&c(e,"href",n)},d(o){o&&R(e)}}}function il(l){let e,t,n;function o(s){l[11](s)}let r={item:l[3],kgTerm:l[4],kgRank:l[5]};return l[2]!==void 0&&(r.active=l[2]),e=new Pt({props:r}),ye.push(()=>Ne(e,"active",o)),{c(){q(e.$$.fragment)},m(s,a){z(e,s,a),n=!0},p(s,a){const i={};a&8&&(i.item=s[3]),a&16&&(i.kgTerm=s[4]),a&32&&(i.kgRank=s[5]),!t&&a&4&&(t=!0,i.active=s[2],Oe(()=>t=!1)),e.$set(i)},i(s){n||(N(e.$$.fragment,s),n=!0)},o(s){D(e.$$.fragment,s),n=!1},d(s){B(e,s)}}}function po(l){let e,t,n,o,r,s,a,i,_,h,d,f,g=l[0].title+"",m,$,w,v,k,O,F,K,b,L,H,G,J,j,E,S,I,ne,Q,W,le,Z,ie,pe,me,P,X,x,ae,Ge,y=l[0].tags&&sl(l);i=new Dl({props:{$$slots:{default:[co]},$$scope:{ctx:l}}});const A=[fo,uo],U=[];function se(M,oe){return M[0].description?0:1}F=se(l),K=U[F]=A[F](l);let Y="url"in l[0]&&al(l);function ee(M){l[10](M)}let Ae={item:l[0]};l[1]!==void 0&&(Ae.active=l[1]),pe=new Pt({props:Ae}),ye.push(()=>Ne(pe,"active",ee));let ce=l[3]&&il(l);return{c(){e=p("div"),t=p("article"),n=p("div"),o=p("div"),r=p("div"),y&&y.c(),s=C(),a=p("div"),q(i.$$.fragment),_=C(),h=p("div"),d=p("button"),f=p("h2"),m=te(g),$=C(),w=p("div"),v=p("small"),v.textContent="Description:",k=C(),O=p("div"),K.c(),b=C(),L=p("br"),G=C(),J=p("div"),j=p("nav"),E=p("div"),Y&&Y.c(),S=C(),I=p("button"),I.innerHTML='<span class="icon is-medium"><i class="fas fa-plus" aria-hidden="true"></i></span>',ne=C(),Q=p("a"),W=p("span"),W.innerHTML='<i class="fas fa-code" aria-hidden="true"></i>',ie=C(),q(pe.$$.fragment),P=C(),ce&&ce.c(),X=xe(),c(r,"class","level-right"),c(a,"class","level-right"),c(f,"class","title svelte-1m2cvhr"),c(d,"class","svelte-1m2cvhr"),c(v,"class","description-label svelte-1m2cvhr"),c(O,"class","description-content svelte-1m2cvhr"),c(w,"class","description svelte-1m2cvhr"),c(o,"class","content"),c(I,"type","button"),c(I,"class","level-item button is-ghost svelte-1m2cvhr"),c(I,"aria-label","Add to favorites"),c(W,"class","icon is-medium"),c(Q,"href",le=`vscode://${encodeURIComponent(l[0].title)}.md?${encodeURIComponent(l[0].body)}`),c(Q,"class","level-item"),c(Q,"aria-label","Open in VSCode"),c(E,"class","level-right"),c(j,"class","level is-mobile"),c(J,"class","level-right"),c(n,"class","media-content"),c(t,"class","media"),c(e,"class","box")},m(M,oe){T(M,e,oe),u(e,t),u(t,n),u(n,o),u(o,r),y&&y.m(r,null),u(o,s),u(o,a),z(i,a,null),u(o,_),u(o,h),u(h,d),u(d,f),u(f,m),u(h,$),u(h,w),u(w,v),u(w,k),u(w,O),U[F].m(O,null),u(h,b),u(h,L),u(n,G),u(n,J),u(J,j),u(j,E),Y&&Y.m(E,null),u(E,S),u(E,I),u(E,ne),u(E,Q),u(Q,W),T(M,ie,oe),z(pe,M,oe),T(M,P,oe),ce&&ce.m(M,oe),T(M,X,oe),x=!0,ae||(Ge=[V(d,"click",l[7]),V(I,"click",_o)],ae=!0)},p(M,[oe]){M[0].tags?y?(y.p(M,oe),oe&1&&N(y,1)):(y=sl(M),y.c(),N(y,1),y.m(r,null)):y&&(Te(),D(y,1,1,()=>{y=null}),Le());const he={};oe&131073&&(he.$$scope={dirty:oe,ctx:M}),i.$set(he),(!x||oe&1)&&g!==(g=M[0].title+"")&&ke(m,g);let $e=F;F=se(M),F===$e?U[F].p(M,oe):(Te(),D(U[$e],1,1,()=>{U[$e]=null}),Le(),K=U[F],K?K.p(M,oe):(K=U[F]=A[F](M),K.c()),N(K,1),K.m(O,null)),"url"in M[0]?Y?Y.p(M,oe):(Y=al(M),Y.c(),Y.m(E,S)):Y&&(Y.d(1),Y=null),(!x||oe&1&&le!==(le=`vscode://${encodeURIComponent(M[0].title)}.md?${encodeURIComponent(M[0].body)}`))&&c(Q,"href",le);const we={};oe&1&&(we.item=M[0]),!me&&oe&2&&(me=!0,we.active=M[1],Oe(()=>me=!1)),pe.$set(we),M[3]?ce?(ce.p(M,oe),oe&8&&N(ce,1)):(ce=il(M),ce.c(),N(ce,1),ce.m(X.parentNode,X)):ce&&(Te(),D(ce,1,1,()=>{ce=null}),Le())},i(M){x||(N(y),N(i.$$.fragment,M),N(K),Xe(()=>{x&&(H||(H=yt(h,St,{},!0)),H.run(1))}),Xe(()=>{x&&(Z||(Z=yt(j,St,{},!0)),Z.run(1))}),N(pe.$$.fragment,M),N(ce),x=!0)},o(M){D(y),D(i.$$.fragment,M),D(K),H||(H=yt(h,St,{},!1)),H.run(0),Z||(Z=yt(j,St,{},!1)),Z.run(0),D(pe.$$.fragment,M),D(ce),x=!1},d(M){M&&R(e),y&&y.d(),B(i),U[F].d(),M&&H&&H.end(),Y&&Y.d(),M&&Z&&Z.end(),M&&R(ie),B(pe,M),M&&R(P),ce&&ce.d(M),M&&R(X),ae=!1,Ie(Ge)}}}const _o=()=>{};function mo(l,e,t){let n,o;ue(l,at,v=>t(12,n=v)),ue(l,Ce,v=>t(13,o=v));let{document:r}=e,s=!1,a=!1,i=null,_=null,h=null,d=!1;const f=()=>{t(1,s=!0)};async function g(v){var k,O,F,K,b;t(6,d=!0),t(4,_=v),console.log("🔍 KG Search Debug Info:"),console.log("  Tag clicked:",v),console.log("  Current role:",n),console.log("  Is Tauri mode:",o);try{if(o){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:n,term:v});const L=await be("find_documents_for_kg_term",{roleName:n,term:v});console.log("  📥 Tauri response received:"),console.log("    Status:",L.status),console.log("    Results count:",((k=L.results)==null?void 0:k.length)||0),console.log("    Total:",L.total||0),console.log("    Full response:",JSON.stringify(L,null,2)),L.status==="success"&&L.results&&L.results.length>0?(t(3,i=L.results[0]),t(5,h=i.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",i.title),console.log("    Rank:",h),console.log("    Body length:",((O=i.body)==null?void 0:O.length)||0,"characters"),t(2,a=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${v}" in role: "${n}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const L=Qe.ServerURL,H=encodeURIComponent(n),G=encodeURIComponent(v),J=`${L}/roles/${H}/kg_search?term=${G}`;console.log("  📤 HTTP Request details:"),console.log("    Base URL:",L),console.log("    Role (encoded):",H),console.log("    Term (encoded):",G),console.log("    Full URL:",J);const j=await fetch(J);if(console.log("  📥 HTTP Response received:"),console.log("    Status code:",j.status),console.log("    Status text:",j.statusText),console.log("    Headers:",Object.fromEntries(j.headers.entries())),!j.ok)throw new Error(`HTTP error! Status: ${j.status} - ${j.statusText}`);const E=await j.json();console.log("  📄 Response data:"),console.log("    Status:",E.status),console.log("    Results count:",((F=E.results)==null?void 0:F.length)||0),console.log("    Total:",E.total||0),console.log("    Full response:",JSON.stringify(E,null,2)),E.status==="success"&&E.results&&E.results.length>0?(t(3,i=E.results[0]),t(5,h=i.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",i.title),console.log("    Rank:",h),console.log("    Body length:",((K=i.body)==null?void 0:K.length)||0,"characters"),t(2,a=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${v}" in role: "${n}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",J))}}catch(L){console.error("❌ Error fetching KG document:"),console.error("  Error type:",L.constructor.name),console.error("  Error message:",L.message||L),console.error("  Request details:",{tag:v,role:n,isTauri:o,timestamp:new Date().toISOString()}),!o&&((b=L.message)!=null&&b.includes("Failed to fetch"))&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{t(6,d=!1)}}Rt[n]!==void 0&&(console.log("Have attribute",Rt[n]),Rt[n].hasOwnProperty("enableLogseq")?console.log("enable logseq True"):console.log("Didn't make it"));const m=v=>g(v);function $(v){s=v,t(1,s)}function w(v){a=v,t(2,a)}return l.$$set=v=>{"document"in v&&t(0,r=v.document)},[r,s,a,i,_,h,d,f,g,m,$,w]}class ho extends De{constructor(e){super(),Ue(this,e,mo,po,Re,{document:0})}}const go="/assets/terraphim_gray.png";function cl(l,e,t){const n=l.slice();return n[19]=e[t],n}function ul(l,e,t){const n=l.slice();return n[22]=e[t],n[24]=t,n}function fl(l){let e,t=l[2],n=[];for(let o=0;o<t.length;o+=1)n[o]=dl(ul(l,t,o));return{c(){e=p("ul");for(let o=0;o<n.length;o+=1)n[o].c();c(e,"class","suggestions svelte-13t09eu")},m(o,r){T(o,e,r);for(let s=0;s<n.length;s+=1)n[s]&&n[s].m(e,null)},p(o,r){if(r&524){t=o[2];let s;for(s=0;s<t.length;s+=1){const a=ul(o,t,s);n[s]?n[s].p(a,r):(n[s]=dl(a),n[s].c(),n[s].m(e,null))}for(;s<n.length;s+=1)n[s].d(1);n.length=t.length}},d(o){o&&R(e),Be(n,o)}}}function dl(l){let e,t=l[22]+"",n,o,r,s,a,i;function _(){return l[13](l[22])}function h(...d){return l[14](l[22],...d)}return{c(){e=p("li"),n=te(t),o=C(),c(e,"tabindex","0"),c(e,"role","option"),c(e,"aria-selected",r=l[24]===l[3]),c(e,"aria-label",s=`Apply suggestion: ${l[22]}`),c(e,"class","svelte-13t09eu"),Tt(e,"active",l[24]===l[3])},m(d,f){T(d,e,f),u(e,n),u(e,o),a||(i=[V(e,"click",_),V(e,"keydown",h)],a=!0)},p(d,f){l=d,f&4&&t!==(t=l[22]+"")&&ke(n,t),f&8&&r!==(r=l[24]===l[3])&&c(e,"aria-selected",r),f&4&&s!==(s=`Apply suggestion: ${l[22]}`)&&c(e,"aria-label",s),f&8&&Tt(e,"active",l[24]===l[3])},d(d){d&&R(e),a=!1,Ie(i)}}}function vo(l){let e,t,n,o,r;function s(_){l[12](_)}let a={type:"search",placeholder:l[6]?`Search over Knowledge graph for ${l[4]}`:"Search",icon:"search",expanded:!0,autofocus:!0};l[5]!==void 0&&(a.value=l[5]),t=new dt({props:a}),ye.push(()=>Ne(t,"value",s)),t.$on("click",l[10]),t.$on("submit",l[10]),t.$on("keydown",l[8]),t.$on("input",l[7]);let i=l[2].length>0&&fl(l);return{c(){e=p("div"),q(t.$$.fragment),o=C(),i&&i.c(),c(e,"class","input-wrapper svelte-13t09eu")},m(_,h){T(_,e,h),z(t,e,null),u(e,o),i&&i.m(e,null),r=!0},p(_,h){const d={};h&80&&(d.placeholder=_[6]?`Search over Knowledge graph for ${_[4]}`:"Search"),!n&&h&32&&(n=!0,d.value=_[5],Oe(()=>n=!1)),t.$set(d),_[2].length>0?i?i.p(_,h):(i=fl(_),i.c(),i.m(e,null)):i&&(i.d(1),i=null)},i(_){r||(N(t.$$.fragment,_),r=!0)},o(_){D(t.$$.fragment,_),r=!1},d(_){_&&R(e),B(t),i&&i.d()}}}function bo(l){let e,t,n,o,r,s;return{c(){e=p("section"),t=p("div"),n=p("img"),r=C(),s=p("p"),s.textContent="I am Terraphim, your personal assistant.",tn(n.src,o=go)||c(n,"src",o),c(n,"alt","Terraphim Logo"),c(n,"class","svelte-13t09eu"),c(t,"class","content has-text-grey has-text-centered svelte-13t09eu"),c(e,"class","section")},m(a,i){T(a,e,i),u(e,t),u(t,n),u(t,r),u(t,s)},p:fe,i:fe,o:fe,d(a){a&&R(e)}}}function ko(l){let e,t,n=l[0],o=[];for(let s=0;s<n.length;s+=1)o[s]=pl(cl(l,n,s));const r=s=>D(o[s],1,1,()=>{o[s]=null});return{c(){for(let s=0;s<o.length;s+=1)o[s].c();e=xe()},m(s,a){for(let i=0;i<o.length;i+=1)o[i]&&o[i].m(s,a);T(s,e,a),t=!0},p(s,a){if(a&1){n=s[0];let i;for(i=0;i<n.length;i+=1){const _=cl(s,n,i);o[i]?(o[i].p(_,a),N(o[i],1)):(o[i]=pl(_),o[i].c(),N(o[i],1),o[i].m(e.parentNode,e))}for(Te(),i=n.length;i<o.length;i+=1)r(i);Le()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)N(o[a]);t=!0}},o(s){o=o.filter(Boolean);for(let a=0;a<o.length;a+=1)D(o[a]);t=!1},d(s){Be(o,s),s&&R(e)}}}function $o(l){let e,t;return{c(){e=p("p"),t=te(l[1]),c(e,"class","error svelte-13t09eu")},m(n,o){T(n,e,o),u(e,t)},p(n,o){o&2&&ke(t,n[1])},i:fe,o:fe,d(n){n&&R(e)}}}function pl(l){let e,t;return e=new ho({props:{document:l[19]}}),{c(){q(e.$$.fragment)},m(n,o){z(e,n,o),t=!0},p(n,o){const r={};o&1&&(r.document=n[19]),e.$set(r)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){B(e,n)}}}function wo(l){let e,t,n,o,r,s,a,i,_;t=new ze({props:{$$slots:{default:[vo]},$$scope:{ctx:l}}});const h=[$o,ko,bo],d=[];function f(g,m){return g[1]?0:g[0].length?1:2}return o=f(l),r=d[o]=h[o](l),{c(){e=p("form"),q(t.$$.fragment),n=C(),r.c(),s=xe()},m(g,m){T(g,e,m),z(t,e,null),T(g,n,m),d[o].m(g,m),T(g,s,m),a=!0,i||(_=V(e,"submit",xl(l[10])),i=!0)},p(g,[m]){const $={};m&33554556&&($.$$scope={dirty:m,ctx:g}),t.$set($);let w=o;o=f(g),o===w?d[o].p(g,m):(Te(),D(d[w],1,1,()=>{d[w]=null}),Le(),r=d[o],r?r.p(g,m):(r=d[o]=h[o](g),r.c()),N(r,1),r.m(s.parentNode,s))},i(g){a||(N(t.$$.fragment,g),N(r),a=!0)},o(g){D(t.$$.fragment,g),D(r),a=!1},d(g){g&&R(e),B(t),g&&R(n),d[o].d(g),g&&R(s),i=!1,_()}}}function yo(l,e,t){let n,o,r,s,a,i,_;ue(l,wn,b=>t(16,o=b)),ue(l,at,b=>t(4,r=b)),ue(l,Ot,b=>t(5,s=b)),ue(l,Ce,b=>t(17,a=b)),ue(l,Dt,b=>t(11,i=b)),ue(l,ut,b=>t(6,_=b));let h=[],d=null,f=[],g=-1;function m(b){const L=b.trim().toLowerCase();return L.length===0?[]:n.filter(([G])=>G.toLowerCase().includes(L)).map(([G])=>G).slice(0,5)}function $(b){const L=b.target;if(!L||L.selectionStart==null)return;const H=L.selectionStart,J=s.slice(0,H).split(/\s+/),j=J[J.length-1];t(2,f=m(j)),t(3,g=-1)}function w(b){f.length!==0&&(b.key==="ArrowDown"?(b.preventDefault(),t(3,g=(g+1)%f.length)):b.key==="ArrowUp"?(b.preventDefault(),t(3,g=(g-1+f.length)%f.length)):(b.key==="Enter"||b.key==="Tab")&&g!==-1&&(b.preventDefault(),v(f[g])))}function v(b){var E;const L=document.querySelector('input[type="search"]'),H=(L==null?void 0:L.selectionStart)??0,G=s.slice(0,H),J=s.slice(H),j=G.split(/\s+/);j[j.length-1]=b,en(Ot,s=[...j,J].join(" "),s),(E=L==null?void 0:L.setSelectionRange)==null||E.call(L,H+b.length,H+b.length),t(2,f=[]),t(3,g=-1)}async function k(){if(t(1,d=null),a)try{const b=await be("search",{searchQuery:{search_term:s,skip:0,limit:10,role:r}});b.status==="success"?(t(0,h=b.results),console.log("Response results"),console.log(h)):(t(1,d=`Search failed: ${b.status}`),console.error("Search failed:",b))}catch(b){t(1,d=`Error in Tauri search: ${b}`),console.error("Error in Tauri search:",b)}else{if(!s.trim())return;const b=JSON.stringify({search_term:s,skip:0,limit:10,role:r});try{const L=await fetch(o,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:b}),H=await L.json();if(!L.ok)throw new Error(`HTTP error! Status: ${L.status}`);t(0,h=H.results)}catch(L){console.error("Error fetching data:",L),t(1,d=`Error fetching data: ${L}`)}}}function O(b){s=b,Ot.set(s)}const F=b=>v(b),K=(b,L)=>{(L.key==="Enter"||L.key===" ")&&(L.preventDefault(),v(b))};return l.$$.update=()=>{l.$$.dirty&2048&&(n=Object.entries(i))},[h,d,f,g,r,s,_,$,w,v,k,i,O,F,K]}class So extends De{constructor(e){super(),Ue(this,e,yo,wo,Re,{})}}function _l(l,e,t){const n=l.slice();return n[44]=e[t],n[45]=e,n[46]=t,n}function ml(l,e,t){const n=l.slice();return n[47]=e[t],n[48]=e,n[49]=t,n}function hl(l,e,t){const n=l.slice();return n[50]=e[t][0],n[51]=e[t][1],n[52]=e,n[53]=t,n}function gl(l,e,t){const n=l.slice();return n[41]=e[t],n}function Co(l){let e,t,n,o=JSON.stringify(l[1],null,2)+"",r;return{c(){e=p("h4"),e.textContent="Review",t=C(),n=p("pre"),r=te(o),c(e,"class","title is-5"),Ze(n,"max-height","300px"),Ze(n,"overflow","auto")},m(s,a){T(s,e,a),T(s,t,a),T(s,n,a),u(n,r)},p(s,a){a[0]&2&&o!==(o=JSON.stringify(s[1],null,2)+"")&&ke(r,o)},d(s){s&&R(e),s&&R(t),s&&R(n)}}}function Ro(l){let e,t,n=[],o=new Map,r,s,a,i,_=l[1].roles;const h=d=>d[44].name;for(let d=0;d<_.length;d+=1){let f=_l(l,_,d),g=h(f);o.set(g,n[d]=wl(g,f))}return{c(){e=p("h4"),e.textContent="Roles",t=C();for(let d=0;d<n.length;d+=1)n[d].c();r=C(),s=p("button"),s.textContent="Add Role",c(e,"class","title is-5"),c(s,"class","button is-link is-light")},m(d,f){T(d,e,f),T(d,t,f);for(let g=0;g<n.length;g+=1)n[g]&&n[g].m(d,f);T(d,r,f),T(d,s,f),a||(i=V(s,"click",l[5]),a=!0)},p(d,f){f[0]&4034&&(_=d[1].roles,n=ln(n,f,h,1,d,_,o,r.parentNode,nn,wl,r,_l))},d(d){d&&R(e),d&&R(t);for(let f=0;f<n.length;f+=1)n[f].d(d);d&&R(r),d&&R(s),a=!1,i()}}}function To(l){let e,t,n,o,r,s,a,i,_,h,d,f,g,m,$,w,v,k,O,F,K,b,L,H,G,J,j,E,S,I,ne=l[1].roles,Q=[];for(let W=0;W<ne.length;W+=1)Q[W]=yl(gl(l,ne,W));return{c(){e=p("div"),t=p("label"),t.textContent="Configuration ID",n=C(),o=p("div"),r=p("div"),s=p("select"),a=p("option"),a.textContent="Desktop",i=p("option"),i.textContent="Server",_=p("option"),_.textContent="Embedded",h=C(),d=p("div"),f=p("label"),f.textContent="Global shortcut",g=C(),m=p("div"),$=p("input"),w=C(),v=p("div"),k=p("label"),k.textContent="Default theme",O=C(),F=p("div"),K=p("input"),b=C(),L=p("div"),H=p("label"),H.textContent="Default Role",G=C(),J=p("div"),j=p("div"),E=p("select");for(let W=0;W<Q.length;W+=1)Q[W].c();c(t,"class","label"),c(t,"for","config-id"),a.__value="Desktop",a.value=a.__value,i.__value="Server",i.value=i.__value,_.__value="Embedded",_.value=_.__value,c(s,"id","config-id"),l[1].id===void 0&&Xe(()=>l[13].call(s)),c(r,"class","select"),c(o,"class","control"),c(e,"class","field"),c(f,"class","label"),c(f,"for","global-shortcut"),c($,"class","input"),c($,"id","global-shortcut"),c($,"type","text"),c(m,"class","control"),c(d,"class","field"),c(k,"class","label"),c(k,"for","default-theme"),c(K,"class","input"),c(K,"id","default-theme"),c(K,"type","text"),c(F,"class","control"),c(v,"class","field"),c(H,"class","label"),c(H,"for","default-role"),c(E,"id","default-role"),l[1].default_role===void 0&&Xe(()=>l[16].call(E)),c(j,"class","select"),c(J,"class","control"),c(L,"class","field")},m(W,le){T(W,e,le),u(e,t),u(e,n),u(e,o),u(o,r),u(r,s),u(s,a),u(s,i),u(s,_),Pe(s,l[1].id,!0),T(W,h,le),T(W,d,le),u(d,f),u(d,g),u(d,m),u(m,$),de($,l[1].global_shortcut),T(W,w,le),T(W,v,le),u(v,k),u(v,O),u(v,F),u(F,K),de(K,l[1].default_theme),T(W,b,le),T(W,L,le),u(L,H),u(L,G),u(L,J),u(J,j),u(j,E);for(let Z=0;Z<Q.length;Z+=1)Q[Z]&&Q[Z].m(E,null);Pe(E,l[1].default_role,!0),S||(I=[V(s,"change",l[13]),V($,"input",l[14]),V(K,"input",l[15]),V(E,"change",l[16])],S=!0)},p(W,le){if(le[0]&2&&Pe(s,W[1].id),le[0]&2&&$.value!==W[1].global_shortcut&&de($,W[1].global_shortcut),le[0]&2&&K.value!==W[1].default_theme&&de(K,W[1].default_theme),le[0]&2){ne=W[1].roles;let Z;for(Z=0;Z<ne.length;Z+=1){const ie=gl(W,ne,Z);Q[Z]?Q[Z].p(ie,le):(Q[Z]=yl(ie),Q[Z].c(),Q[Z].m(E,null))}for(;Z<Q.length;Z+=1)Q[Z].d(1);Q.length=ne.length}le[0]&2&&Pe(E,W[1].default_role)},d(W){W&&R(e),W&&R(h),W&&R(d),W&&R(w),W&&R(v),W&&R(b),W&&R(L),Be(Q,W),S=!1,Ie(I)}}}function Lo(l){let e;return{c(){e=te("Directory Path")},m(t,n){T(t,e,n)},d(t){t&&R(e)}}}function Eo(l){let e;return{c(){e=te("Server URL")},m(t,n){T(t,e,n)},d(t){t&&R(e)}}}function vl(l){let e,t,n,o,r,s,a,i,_,h,d,f;function g(){l[23].call(a,l[46],l[49])}return{c(){e=p("div"),t=p("label"),n=te("Atomic Server Secret"),r=C(),s=p("div"),a=p("input"),_=C(),h=p("p"),h.textContent="Leave empty for anonymous access",c(t,"class","label"),c(t,"for",o=`haystack-secret-${l[46]}-${l[49]}`),c(a,"class","input"),c(a,"id",i=`haystack-secret-${l[46]}-${l[49]}`),c(a,"type","password"),c(a,"placeholder","Base64 encoded secret (optional)"),c(s,"class","control"),c(h,"class","help"),c(e,"class","field")},m(m,$){T(m,e,$),u(e,t),u(t,n),u(e,r),u(e,s),u(s,a),de(a,l[1].roles[l[46]].haystacks[l[49]].atomic_server_secret),u(e,_),u(e,h),d||(f=V(a,"input",g),d=!0)},p(m,$){l=m,$[0]&2&&o!==(o=`haystack-secret-${l[46]}-${l[49]}`)&&c(t,"for",o),$[0]&2&&i!==(i=`haystack-secret-${l[46]}-${l[49]}`)&&c(a,"id",i),$[0]&2&&a.value!==l[1].roles[l[46]].haystacks[l[49]].atomic_server_secret&&de(a,l[1].roles[l[46]].haystacks[l[49]].atomic_server_secret)},d(m){m&&R(e),d=!1,f()}}}function bl(l){let e,t,n,o,r,s,a,i,_,h,d,f,g,m,$,w,v,k=Object.entries(l[1].roles[l[46]].haystacks[l[49]].extra_parameters||{}),O=[];for(let L=0;L<k.length;L+=1)O[L]=kl(hl(l,k,L));function F(){return l[27](l[46],l[49])}function K(){return l[28](l[46],l[49])}function b(){return l[29](l[46],l[49])}return{c(){e=p("div"),t=p("label"),t.textContent="Extra Parameters (for filtering)",n=C();for(let L=0;L<O.length;L+=1)O[L].c();o=C(),r=p("div"),s=p("div"),a=p("button"),a.textContent="+ Tag Filter",i=C(),_=p("div"),h=p("button"),h.textContent="+ Max Results",d=C(),f=p("div"),g=p("button"),g.textContent="+ Custom Parameter",m=C(),$=p("p"),$.innerHTML=`Common parameters: <code>tag</code> (e.g., &quot;#rust&quot;), <code>glob</code> (e.g., &quot;*.md&quot;), 
                  <code>max_count</code> (e.g., &quot;10&quot;), <code>context</code> (e.g., &quot;5&quot;)`,c(t,"class","label"),c(a,"class","button is-small is-link is-light"),c(s,"class","control"),c(h,"class","button is-small is-link is-light"),c(_,"class","control"),c(g,"class","button is-small is-link is-light"),c(f,"class","control"),c(r,"class","field is-grouped"),c($,"class","help"),c(e,"class","field")},m(L,H){T(L,e,H),u(e,t),u(e,n);for(let G=0;G<O.length;G+=1)O[G]&&O[G].m(e,null);u(e,o),u(e,r),u(r,s),u(s,a),u(r,i),u(r,_),u(_,h),u(r,d),u(r,f),u(f,g),u(e,m),u(e,$),w||(v=[V(a,"click",F),V(h,"click",K),V(g,"click",b)],w=!0)},p(L,H){if(l=L,H[0]&3074){k=Object.entries(l[1].roles[l[46]].haystacks[l[49]].extra_parameters||{});let G;for(G=0;G<k.length;G+=1){const J=hl(l,k,G);O[G]?O[G].p(J,H):(O[G]=kl(J),O[G].c(),O[G].m(e,o))}for(;G<O.length;G+=1)O[G].d(1);O.length=k.length}},d(L){L&&R(e),Be(O,L),w=!1,Ie(v)}}}function kl(l){let e,t,n,o,r,s,a,i,_,h,d,f,g;function m(...v){return l[24](l[46],l[49],l[50],...v)}function $(){l[25].call(a,l[46],l[49],l[50])}function w(){return l[26](l[46],l[49],l[50])}return{c(){e=p("div"),t=p("div"),n=p("input"),r=C(),s=p("div"),a=p("input"),i=C(),_=p("div"),h=p("button"),h.textContent="×",d=C(),c(n,"class","input"),c(n,"type","text"),c(n,"placeholder","Parameter name"),n.value=o=l[50],c(t,"class","control"),c(a,"class","input"),c(a,"type","text"),c(a,"placeholder","Parameter value"),c(s,"class","control is-expanded"),c(h,"class","button is-small is-danger"),c(_,"class","control"),c(e,"class","field is-grouped")},m(v,k){T(v,e,k),u(e,t),u(t,n),u(e,r),u(e,s),u(s,a),de(a,l[1].roles[l[46]].haystacks[l[49]].extra_parameters[l[50]]),u(e,i),u(e,_),u(_,h),u(e,d),f||(g=[V(n,"blur",m),V(a,"input",$),V(h,"click",w)],f=!0)},p(v,k){l=v,k[0]&2&&o!==(o=l[50])&&n.value!==o&&(n.value=o),k[0]&2&&a.value!==l[1].roles[l[46]].haystacks[l[49]].extra_parameters[l[50]]&&de(a,l[1].roles[l[46]].haystacks[l[49]].extra_parameters[l[50]])},d(v){v&&R(e),f=!1,Ie(g)}}}function $l(l){let e,t,n,o,r,s,a,i,_,h,d,f,g,m,$,w,v,k,O,F,K,b,L,H,G,J,j,E,S,I,ne,Q,W,le,Z;function ie(){l[21].call(_,l[46],l[49])}function pe(A,U){return A[1].roles[A[46]].haystacks[A[49]].service==="Atomic"?Eo:Lo}let me=pe(l),P=me(l);function X(){l[22].call(O,l[46],l[49])}let x=l[1].roles[l[46]].haystacks[l[49]].service==="Atomic"&&vl(l),ae=l[1].roles[l[46]].haystacks[l[49]].service==="Ripgrep"&&bl(l);function Ge(){l[30].call(j,l[46],l[49])}function y(){return l[31](l[46],l[49])}return{c(){e=p("div"),t=p("div"),n=p("label"),o=te("Service Type"),s=C(),a=p("div"),i=p("div"),_=p("select"),h=p("option"),h.textContent="Ripgrep (File Search)",d=p("option"),d.textContent="Atomic Server",g=C(),m=p("div"),$=p("label"),P.c(),v=C(),k=p("div"),O=p("input"),b=C(),x&&x.c(),L=C(),ae&&ae.c(),H=C(),G=p("div"),J=p("label"),j=p("input"),S=te(`
                 Read-only`),ne=C(),Q=p("div"),W=p("button"),W.textContent="Remove Haystack",c(n,"class","label"),c(n,"for",r=`haystack-service-${l[46]}-${l[49]}`),h.__value="Ripgrep",h.value=h.__value,d.__value="Atomic",d.value=d.__value,c(_,"id",f=`haystack-service-${l[46]}-${l[49]}`),l[1].roles[l[46]].haystacks[l[49]].service===void 0&&Xe(ie),c(i,"class","select"),c(a,"class","control"),c(t,"class","field"),c($,"class","label"),c($,"for",w=`haystack-path-${l[46]}-${l[49]}`),c(O,"class","input"),c(O,"id",F=`haystack-path-${l[46]}-${l[49]}`),c(O,"type","text"),c(O,"placeholder",K=l[1].roles[l[46]].haystacks[l[49]].service==="Atomic"?"https://localhost:9883":"/path/to/documents"),c(k,"class","control"),c(m,"class","field"),c(j,"id",E=`haystack-readonly-${l[46]}-${l[49]}`),c(j,"type","checkbox"),c(J,"class","checkbox"),c(J,"for",I=`haystack-readonly-${l[46]}-${l[49]}`),c(G,"class","field"),c(W,"class","button is-small is-danger"),c(Q,"class","field"),c(e,"class","box is-light")},m(A,U){T(A,e,U),u(e,t),u(t,n),u(n,o),u(t,s),u(t,a),u(a,i),u(i,_),u(_,h),u(_,d),Pe(_,l[1].roles[l[46]].haystacks[l[49]].service,!0),u(e,g),u(e,m),u(m,$),P.m($,null),u(m,v),u(m,k),u(k,O),de(O,l[1].roles[l[46]].haystacks[l[49]].path),u(e,b),x&&x.m(e,null),u(e,L),ae&&ae.m(e,null),u(e,H),u(e,G),u(G,J),u(J,j),j.checked=l[1].roles[l[46]].haystacks[l[49]].read_only,u(J,S),u(e,ne),u(e,Q),u(Q,W),le||(Z=[V(_,"change",ie),V(O,"input",X),V(j,"change",Ge),V(W,"click",y)],le=!0)},p(A,U){l=A,U[0]&2&&r!==(r=`haystack-service-${l[46]}-${l[49]}`)&&c(n,"for",r),U[0]&2&&f!==(f=`haystack-service-${l[46]}-${l[49]}`)&&c(_,"id",f),U[0]&2&&Pe(_,l[1].roles[l[46]].haystacks[l[49]].service),me!==(me=pe(l))&&(P.d(1),P=me(l),P&&(P.c(),P.m($,null))),U[0]&2&&w!==(w=`haystack-path-${l[46]}-${l[49]}`)&&c($,"for",w),U[0]&2&&F!==(F=`haystack-path-${l[46]}-${l[49]}`)&&c(O,"id",F),U[0]&2&&K!==(K=l[1].roles[l[46]].haystacks[l[49]].service==="Atomic"?"https://localhost:9883":"/path/to/documents")&&c(O,"placeholder",K),U[0]&2&&O.value!==l[1].roles[l[46]].haystacks[l[49]].path&&de(O,l[1].roles[l[46]].haystacks[l[49]].path),l[1].roles[l[46]].haystacks[l[49]].service==="Atomic"?x?x.p(l,U):(x=vl(l),x.c(),x.m(e,L)):x&&(x.d(1),x=null),l[1].roles[l[46]].haystacks[l[49]].service==="Ripgrep"?ae?ae.p(l,U):(ae=bl(l),ae.c(),ae.m(e,H)):ae&&(ae.d(1),ae=null),U[0]&2&&E!==(E=`haystack-readonly-${l[46]}-${l[49]}`)&&c(j,"id",E),U[0]&2&&(j.checked=l[1].roles[l[46]].haystacks[l[49]].read_only),U[0]&2&&I!==(I=`haystack-readonly-${l[46]}-${l[49]}`)&&c(J,"for",I)},d(A){A&&R(e),P.d(),x&&x.d(),ae&&ae.d(),le=!1,Ie(Z)}}}function wl(l,e){let t,n,o,r,s,a,i,_,h,d,f,g,m,$,w,v,k,O,F,K,b,L,H,G,J,j,E,S,I,ne,Q,W,le,Z,ie,pe,me,P,X,x,ae,Ge,y,A,U,se,Y,ee,Ae,ce,M,oe,he,$e,we,it,Je,We,pt,Se,_t,jt,mt,et,tt,It,ht,Wt,gt,Me,lt,nt,vt,Ht,ot,qe,He,bt,Ft,kt,Kt,Ve,Fe,$t,Gt,wt,qt,zt,Bt,ct,Et,Jt;function Hl(){e[17].call(_,e[46])}function Fl(){e[18].call(k,e[46])}function Kl(){e[19].call(j,e[46])}function Gl(){e[20].call(ie,e[46])}let st=e[44].haystacks,ge=[];for(let ve=0;ve<st.length;ve+=1)ge[ve]=$l(ml(e,st,ve));function ql(){return e[32](e[46])}function zl(){e[33].call(M,e[46])}function Bl(){e[34].call(Se,e[46])}function Vt(){e[35].call(Me,e[46])}function Jl(){e[36].call(He,e[46])}function Vl(){e[37].call(Fe,e[46])}function Yl(){return e[38](e[46])}return{key:l,first:null,c(){t=p("div"),n=p("div"),o=p("label"),r=te("Role name"),a=C(),i=p("div"),_=p("input"),d=C(),f=p("div"),g=p("label"),m=te("Short name"),w=C(),v=p("div"),k=p("input"),F=C(),K=p("div"),b=p("label"),L=te("Theme"),G=C(),J=p("div"),j=p("input"),S=C(),I=p("div"),ne=p("label"),Q=te("Relevance function"),le=C(),Z=p("div"),ie=p("input"),me=C(),P=p("h5"),P.textContent="Haystacks",X=C();for(let ve=0;ve<ge.length;ve+=1)ge[ve].c();x=C(),ae=p("button"),ae.textContent="Add Haystack",Ge=C(),y=p("h5"),y.textContent="Knowledge Graph",A=C(),U=p("div"),se=p("label"),Y=te("Remote automata URL"),Ae=C(),ce=p("div"),M=p("input"),he=C(),$e=p("div"),we=p("label"),it=te("Local KG path"),We=C(),pt=p("div"),Se=p("input"),jt=C(),mt=p("div"),et=p("div"),tt=p("label"),It=te("Local KG type"),Wt=C(),gt=p("div"),Me=p("select"),lt=p("option"),lt.textContent="markdown",nt=p("option"),nt.textContent="json",Ht=C(),ot=p("div"),qe=p("label"),He=p("input"),Ft=te(`
             Public`),Kt=C(),Ve=p("label"),Fe=p("input"),Gt=te(`
             Publish`),qt=C(),zt=p("hr"),Bt=C(),ct=p("button"),ct.textContent="Remove Role",c(o,"class","label"),c(o,"for",s=`role-name-${e[46]}`),c(_,"class","input"),c(_,"id",h=`role-name-${e[46]}`),c(_,"type","text"),c(i,"class","control"),c(n,"class","field"),c(g,"class","label"),c(g,"for",$=`role-shortname-${e[46]}`),c(k,"class","input"),c(k,"id",O=`role-shortname-${e[46]}`),c(k,"type","text"),c(v,"class","control"),c(f,"class","field"),c(b,"class","label"),c(b,"for",H=`role-theme-${e[46]}`),c(j,"class","input"),c(j,"id",E=`role-theme-${e[46]}`),c(j,"type","text"),c(J,"class","control"),c(K,"class","field"),c(ne,"class","label"),c(ne,"for",W=`role-relevance-${e[46]}`),c(ie,"class","input"),c(ie,"id",pe=`role-relevance-${e[46]}`),c(ie,"type","text"),c(Z,"class","control"),c(I,"class","field"),c(P,"class","title is-6"),c(ae,"class","button is-small"),c(y,"class","title is-6"),c(se,"class","label"),c(se,"for",ee=`kg-url-${e[46]}`),c(M,"class","input"),c(M,"id",oe=`kg-url-${e[46]}`),c(M,"type","text"),c(M,"placeholder","https://example.com/thesaurus.json"),c(ce,"class","control"),c(U,"class","field"),c(we,"class","label"),c(we,"for",Je=`kg-local-path-${e[46]}`),c(Se,"class","input"),c(Se,"id",_t=`kg-local-path-${e[46]}`),c(Se,"type","text"),c(Se,"placeholder","/path/to/markdown"),c(pt,"class","control"),c($e,"class","field"),c(tt,"class","label"),c(tt,"for",ht=`kg-local-type-${e[46]}`),lt.__value="markdown",lt.value=lt.__value,nt.__value="json",nt.value=nt.__value,c(Me,"id",vt=`kg-local-type-${e[46]}`),e[1].roles[e[46]].kg.local_type===void 0&&Xe(Vt),c(gt,"class","select"),c(et,"class","control"),c(mt,"class","field is-grouped"),c(He,"id",bt=`kg-public-${e[46]}`),c(He,"type","checkbox"),c(qe,"class","checkbox"),c(qe,"for",kt=`kg-public-${e[46]}`),Ze(qe,"margin-right","1rem"),c(Fe,"id",$t=`kg-publish-${e[46]}`),c(Fe,"type","checkbox"),c(Ve,"class","checkbox"),c(Ve,"for",wt=`kg-publish-${e[46]}`),c(ot,"class","field is-grouped"),c(ct,"class","button is-small is-danger"),c(t,"class","box"),this.first=t},m(ve,re){T(ve,t,re),u(t,n),u(n,o),u(o,r),u(n,a),u(n,i),u(i,_),de(_,e[1].roles[e[46]].name),u(t,d),u(t,f),u(f,g),u(g,m),u(f,w),u(f,v),u(v,k),de(k,e[1].roles[e[46]].shortname),u(t,F),u(t,K),u(K,b),u(b,L),u(K,G),u(K,J),u(J,j),de(j,e[1].roles[e[46]].theme),u(t,S),u(t,I),u(I,ne),u(ne,Q),u(I,le),u(I,Z),u(Z,ie),de(ie,e[1].roles[e[46]].relevance_function),u(t,me),u(t,P),u(t,X);for(let _e=0;_e<ge.length;_e+=1)ge[_e]&&ge[_e].m(t,null);u(t,x),u(t,ae),u(t,Ge),u(t,y),u(t,A),u(t,U),u(U,se),u(se,Y),u(U,Ae),u(U,ce),u(ce,M),de(M,e[1].roles[e[46]].kg.url),u(t,he),u(t,$e),u($e,we),u(we,it),u($e,We),u($e,pt),u(pt,Se),de(Se,e[1].roles[e[46]].kg.local_path),u(t,jt),u(t,mt),u(mt,et),u(et,tt),u(tt,It),u(et,Wt),u(et,gt),u(gt,Me),u(Me,lt),u(Me,nt),Pe(Me,e[1].roles[e[46]].kg.local_type,!0),u(t,Ht),u(t,ot),u(ot,qe),u(qe,He),He.checked=e[1].roles[e[46]].kg.public,u(qe,Ft),u(ot,Kt),u(ot,Ve),u(Ve,Fe),Fe.checked=e[1].roles[e[46]].kg.publish,u(Ve,Gt),u(t,qt),u(t,zt),u(t,Bt),u(t,ct),Et||(Jt=[V(_,"input",Hl),V(k,"input",Fl),V(j,"input",Kl),V(ie,"input",Gl),V(ae,"click",ql),V(M,"input",zl),V(Se,"input",Bl),V(Me,"change",Vt),V(He,"change",Jl),V(Fe,"change",Vl),V(ct,"click",Yl)],Et=!0)},p(ve,re){if(e=ve,re[0]&2&&s!==(s=`role-name-${e[46]}`)&&c(o,"for",s),re[0]&2&&h!==(h=`role-name-${e[46]}`)&&c(_,"id",h),re[0]&2&&_.value!==e[1].roles[e[46]].name&&de(_,e[1].roles[e[46]].name),re[0]&2&&$!==($=`role-shortname-${e[46]}`)&&c(g,"for",$),re[0]&2&&O!==(O=`role-shortname-${e[46]}`)&&c(k,"id",O),re[0]&2&&k.value!==e[1].roles[e[46]].shortname&&de(k,e[1].roles[e[46]].shortname),re[0]&2&&H!==(H=`role-theme-${e[46]}`)&&c(b,"for",H),re[0]&2&&E!==(E=`role-theme-${e[46]}`)&&c(j,"id",E),re[0]&2&&j.value!==e[1].roles[e[46]].theme&&de(j,e[1].roles[e[46]].theme),re[0]&2&&W!==(W=`role-relevance-${e[46]}`)&&c(ne,"for",W),re[0]&2&&pe!==(pe=`role-relevance-${e[46]}`)&&c(ie,"id",pe),re[0]&2&&ie.value!==e[1].roles[e[46]].relevance_function&&de(ie,e[1].roles[e[46]].relevance_function),re[0]&3842){st=e[44].haystacks;let _e;for(_e=0;_e<st.length;_e+=1){const Yt=ml(e,st,_e);ge[_e]?ge[_e].p(Yt,re):(ge[_e]=$l(Yt),ge[_e].c(),ge[_e].m(t,x))}for(;_e<ge.length;_e+=1)ge[_e].d(1);ge.length=st.length}re[0]&2&&ee!==(ee=`kg-url-${e[46]}`)&&c(se,"for",ee),re[0]&2&&oe!==(oe=`kg-url-${e[46]}`)&&c(M,"id",oe),re[0]&2&&M.value!==e[1].roles[e[46]].kg.url&&de(M,e[1].roles[e[46]].kg.url),re[0]&2&&Je!==(Je=`kg-local-path-${e[46]}`)&&c(we,"for",Je),re[0]&2&&_t!==(_t=`kg-local-path-${e[46]}`)&&c(Se,"id",_t),re[0]&2&&Se.value!==e[1].roles[e[46]].kg.local_path&&de(Se,e[1].roles[e[46]].kg.local_path),re[0]&2&&ht!==(ht=`kg-local-type-${e[46]}`)&&c(tt,"for",ht),re[0]&2&&vt!==(vt=`kg-local-type-${e[46]}`)&&c(Me,"id",vt),re[0]&2&&Pe(Me,e[1].roles[e[46]].kg.local_type),re[0]&2&&bt!==(bt=`kg-public-${e[46]}`)&&c(He,"id",bt),re[0]&2&&(He.checked=e[1].roles[e[46]].kg.public),re[0]&2&&kt!==(kt=`kg-public-${e[46]}`)&&c(qe,"for",kt),re[0]&2&&$t!==($t=`kg-publish-${e[46]}`)&&c(Fe,"id",$t),re[0]&2&&(Fe.checked=e[1].roles[e[46]].kg.publish),re[0]&2&&wt!==(wt=`kg-publish-${e[46]}`)&&c(Ve,"for",wt)},d(ve){ve&&R(t),Be(ge,ve),Et=!1,Ie(Jt)}}}function yl(l){let e,t=l[41].name+"",n,o;return{c(){e=p("option"),n=te(t),e.__value=o=l[41].name,e.value=e.__value},m(r,s){T(r,e,s),u(e,n)},p(r,s){s[0]&2&&t!==(t=r[41].name+"")&&ke(n,t),s[0]&2&&o!==(o=r[41].name)&&(e.__value=o,e.value=e.__value)},d(r){r&&R(e)}}}function Sl(l){let e,t,n;return{c(){e=p("button"),e.textContent="Back",c(e,"class","button")},m(o,r){T(o,e,r),t||(n=V(e,"click",l[4]),t=!0)},p:fe,d(o){o&&R(e),t=!1,n()}}}function No(l){let e,t,n;return{c(){e=p("button"),e.textContent="Save",c(e,"class","button is-success")},m(o,r){T(o,e,r),t||(n=V(e,"click",l[12]),t=!0)},p:fe,d(o){o&&R(e),t=!1,n()}}}function Oo(l){let e,t,n;return{c(){e=p("button"),e.textContent="Next",c(e,"class","button is-primary")},m(o,r){T(o,e,r),t||(n=V(e,"click",l[3]),t=!0)},p:fe,d(o){o&&R(e),t=!1,n()}}}function Do(l){let e,t,n,o,r,s,a,i;function _(w,v){return w[0]===1?To:w[0]===2?Ro:Co}let h=_(l),d=h(l),f=l[0]>1&&Sl(l);function g(w,v){return w[0]<Wl?Oo:No}let m=g(l),$=m(l);return{c(){e=p("div"),t=p("h3"),t.textContent="Configuration Wizard",n=C(),d.c(),o=C(),r=p("nav"),s=p("div"),f&&f.c(),a=C(),i=p("div"),$.c(),c(t,"class","title is-4"),c(s,"class","level-left"),c(i,"class","level-right"),c(r,"class","level"),c(e,"class","box")},m(w,v){T(w,e,v),u(e,t),u(e,n),d.m(e,null),u(e,o),u(e,r),u(r,s),f&&f.m(s,null),u(r,a),u(r,i),$.m(i,null)},p(w,v){h===(h=_(w))&&d?d.p(w,v):(d.d(1),d=h(w),d&&(d.c(),d.m(e,o))),w[0]>1?f?f.p(w,v):(f=Sl(w),f.c(),f.m(s,null)):f&&(f.d(1),f=null),m===(m=g(w))&&$?$.p(w,v):($.d(1),$=m(w),$&&($.c(),$.m(i,null)))},i:fe,o:fe,d(w){w&&R(e),d.d(),f&&f.d(),$.d()}}}const Wl=3;function Uo(l,e,t){let n;const o=Ee(null),r=Ee({id:"Desktop",global_shortcut:"Ctrl+X",default_theme:"spacelab",default_role:"Default",roles:[]});ue(l,r,y=>t(1,n=y)),Mt(async()=>{try{let y;rt(Ce)?y=await be("get_config_schema"):y=await(await fetch("/config/schema")).json(),o.set(y);const A=rt(je);A&&A.id&&r.update(U=>{var se;return{...U,id:A.id,global_shortcut:A.global_shortcut,default_theme:((se=A.roles[A.default_role])==null?void 0:se.theme)??"spacelab",default_role:A.default_role,roles:Object.values(A.roles).map(Y=>{var M,oe,he,$e,we,it,Je;const ee=(M=Y.kg)==null?void 0:M.automata_path,Ae=(ee==null?void 0:ee.Remote)??"",ce=((he=(oe=Y.kg)==null?void 0:oe.knowledge_graph_local)==null?void 0:he.path)??"";return{name:Y.name,shortname:Y.shortname,relevance_function:Y.relevance_function,theme:Y.theme,haystacks:(Y.haystacks??[]).map(We=>({path:We.location||We.path||"",read_only:We.read_only??!1,service:We.service||"Ripgrep",atomic_server_secret:We.atomic_server_secret||"",extra_parameters:We.extra_parameters||{}})),kg:{url:Ae,local_path:ce,local_type:((we=($e=Y.kg)==null?void 0:$e.knowledge_graph_local)==null?void 0:we.input_type)??"markdown",public:((it=Y.kg)==null?void 0:it.public)??!1,publish:((Je=Y.kg)==null?void 0:Je.publish)??!1}}})}})}catch(y){console.error("Failed to load schema",y)}});let s=1;function a(){s<Wl&&t(0,s+=1)}function i(){s>1&&t(0,s-=1)}function _(){r.update(y=>({...y,roles:[...y.roles,{name:"New Role",shortname:"new",relevance_function:"title-scorer",theme:"spacelab",haystacks:[],kg:{url:"",local_path:"",local_type:"markdown",public:!1,publish:!1}}]}))}function h(y){r.update(A=>({...A,roles:A.roles.filter((U,se)=>se!==y)}))}function d(y){r.update(A=>(A.roles[y].haystacks.push({path:"",read_only:!1,service:"Ripgrep",atomic_server_secret:"",extra_parameters:{}}),A))}function f(y,A){r.update(U=>(U.roles[y].haystacks=U.roles[y].haystacks.filter((se,Y)=>Y!==A),U))}function g(y,A,U="",se=""){r.update(Y=>{Y.roles[y].haystacks[A].extra_parameters||(Y.roles[y].haystacks[A].extra_parameters={});const ee=U||`param_${Date.now()}`;return Y.roles[y].haystacks[A].extra_parameters[ee]=se,Y})}function m(y,A,U){r.update(se=>(delete se.roles[y].haystacks[A].extra_parameters[U],se))}function $(y,A,U,se){r.update(Y=>{const ee=Y.roles[y].haystacks[A].extra_parameters;return ee[U]!==void 0&&U!==se&&(ee[se]=ee[U],delete ee[U]),Y})}function w(y,A,U,se){const Y=se.target.value;$(y,A,U,Y)}async function v(){var Y;const y=rt(r),A=rt(je);let U={...A};U.id=y.id,U.global_shortcut=y.global_shortcut,U.default_role=y.default_role;const se={};y.roles.forEach(ee=>{var M,oe;const Ae=ee.name,ce=Ae.replace(/^"|"$/g,"");se[ce]={extra:((oe=(M=A.roles)==null?void 0:M[Ae])==null?void 0:oe.extra)??{},name:ee.name,shortname:ee.shortname,theme:ee.theme,relevance_function:ee.relevance_function,haystacks:ee.haystacks.map(he=>({location:he.path,service:he.service,read_only:he.read_only,atomic_server_secret:he.service==="Atomic"?he.atomic_server_secret:void 0,extra_parameters:he.extra_parameters||{}})),kg:ee.kg.url||ee.kg.local_path?{automata_path:ee.kg.url?{Remote:ee.kg.url}:null,knowledge_graph_local:ee.kg.local_path?{input_type:ee.kg.local_type,path:ee.kg.local_path}:null,public:ee.kg.public,publish:ee.kg.publish}:null}}),U.roles=se,(!U.default_role||!se[U.default_role])&&(U.default_role=((Y=y.roles[0])==null?void 0:Y.name)??"Default"),U.selected_role=U.default_role;try{rt(Ce)?await be("update_config",{configNew:U}):await fetch("/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(U)}),je.set(U),alert("Configuration saved")}catch(ee){console.error(ee),alert("Failed to save config")}}function k(){n.id=Ct(this),r.set(n)}function O(){n.global_shortcut=this.value,r.set(n)}function F(){n.default_theme=this.value,r.set(n)}function K(){n.default_role=Ct(this),r.set(n)}function b(y){n.roles[y].name=this.value,r.set(n)}function L(y){n.roles[y].shortname=this.value,r.set(n)}function H(y){n.roles[y].theme=this.value,r.set(n)}function G(y){n.roles[y].relevance_function=this.value,r.set(n)}function J(y,A){n.roles[y].haystacks[A].service=Ct(this),r.set(n)}function j(y,A){n.roles[y].haystacks[A].path=this.value,r.set(n)}function E(y,A){n.roles[y].haystacks[A].atomic_server_secret=this.value,r.set(n)}const S=(y,A,U,se)=>w(y,A,U,se);function I(y,A,U){n.roles[y].haystacks[A].extra_parameters[U]=this.value,r.set(n)}const ne=(y,A,U)=>m(y,A,U),Q=(y,A)=>g(y,A,"tag","#rust"),W=(y,A)=>g(y,A,"max_count","10"),le=(y,A)=>g(y,A,"","");function Z(y,A){n.roles[y].haystacks[A].read_only=this.checked,r.set(n)}const ie=(y,A)=>f(y,A),pe=y=>d(y);function me(y){n.roles[y].kg.url=this.value,r.set(n)}function P(y){n.roles[y].kg.local_path=this.value,r.set(n)}function X(y){n.roles[y].kg.local_type=Ct(this),r.set(n)}function x(y){n.roles[y].kg.public=this.checked,r.set(n)}function ae(y){n.roles[y].kg.publish=this.checked,r.set(n)}return[s,n,r,a,i,_,h,d,f,g,m,w,v,k,O,F,K,b,L,H,G,J,j,E,S,I,ne,Q,W,le,Z,ie,pe,me,P,X,x,ae,y=>h(y)]}class Ao extends De{constructor(e){super(),Ue(this,e,Uo,Do,Re,{},null,[-1,-1])}}function Mo(l){let e,t,n,o,r,s;return r=new Ml({props:{content:l[0],onChange:l[1]}}),{c(){e=p("div"),t=p("p"),t.innerHTML="<i>The best editing experience is to configure Atomic Server, in the meantime use editor below. You will need to refresh page via Command R or Ctrl-R to see changes</i>",n=C(),o=p("div"),q(r.$$.fragment),c(o,"class","editor"),c(e,"class","box")},m(a,i){T(a,e,i),u(e,t),u(e,n),u(e,o),z(r,o,null),s=!0},p(a,[i]){const _={};i&1&&(_.content=a[0]),r.$set(_)},i(a){s||(N(r.$$.fragment,a),s=!0)},o(a){D(r.$$.fragment,a),s=!1},d(a){a&&R(e),B(r)}}}function Po(l,e,t){let n,o;ue(l,je,a=>t(2,n=a)),ue(l,Ce,a=>t(3,o=a));let r={json:n};function s(a){if(console.log("contents changed:",a),console.log("is tauri",o),je.update(i=>(i=a.json,i)),rt(Ce))console.log("Updating config on server"),be("update_config",{configNew:a.json}).then(i=>{console.log(`Message: ${i}`)}).catch(i=>console.error(i));else{let i=`${Qe.ServerURL}/config/`;fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a.json)})}t(0,r=a)}return Mt(()=>{t(0,r={json:n})}),[r,s]}class jo extends De{constructor(e){super(),Ue(this,e,Po,Mo,Re,{})}}const{window:At}=on;function Io(l){let e,t,n,o,r,s,a,i,_,h;return{c(){e=p("div"),t=p("div"),n=p("h3"),n.textContent="Error loading graph",o=C(),r=p("p"),s=te(l[3]),a=C(),i=p("button"),i.textContent="Retry",c(i,"class","button is-primary"),c(t,"class","error-content svelte-1ry9pkl"),c(e,"class","error-overlay svelte-1ry9pkl")},m(d,f){T(d,e,f),u(e,t),u(t,n),u(t,o),u(t,r),u(r,s),u(t,a),u(t,i),_||(h=V(i,"click",l[11]),_=!0)},p(d,f){f&8&&ke(s,d[3])},d(d){d&&R(e),_=!1,h()}}}function Wo(l){let e;return{c(){e=p("div"),e.innerHTML=`<div class="loading-content svelte-1ry9pkl"><div class="loader svelte-1ry9pkl"></div> 
        <p>Loading knowledge graph...</p></div>`,c(e,"class","loading-overlay svelte-1ry9pkl")},m(t,n){T(t,e,n)},p:fe,d(t){t&&R(e)}}}function Cl(l){let e,t,n;return{c(){e=p("button"),e.innerHTML='<i class="fas fa-times svelte-1ry9pkl"></i>',c(e,"class","close-button svelte-1ry9pkl"),c(e,"title","Close Graph")},m(o,r){T(o,e,r),t||(n=V(e,"click",l[17]),t=!0)},p:fe,d(o){o&&R(e),t=!1,n()}}}function Rl(l){let e;return{c(){e=p("div"),e.innerHTML="<span><strong>Left-click:</strong> View node • <strong>Right-click:</strong> Edit node • <strong>Drag:</strong> Move • <strong>Scroll:</strong> Zoom</span>",c(e,"class","controls-info svelte-1ry9pkl")},m(t,n){T(t,e,n)},d(t){t&&R(e)}}}function Tl(l){let e,t;return{c(){e=p("div"),t=te(l[8]),c(e,"class","debug-message svelte-1ry9pkl")},m(n,o){T(n,e,o),u(e,t)},p(n,o){o&256&&ke(t,n[8])},d(n){n&&R(e)}}}function Ll(l){let e=l[5].id,t,n,o=El(l);return{c(){o.c(),t=xe()},m(r,s){o.m(r,s),T(r,t,s),n=!0},p(r,s){s&32&&Re(e,e=r[5].id)?(Te(),D(o,1,1,fe),Le(),o=El(r),o.c(),N(o,1),o.m(t.parentNode,t)):o.p(r,s)},i(r){n||(N(o),n=!0)},o(r){D(o),n=!1},d(r){r&&R(t),o.d(r)}}}function El(l){let e,t,n;function o(s){l[18](s)}let r={item:l[5],initialEdit:l[7]};return l[6]!==void 0&&(r.active=l[6]),e=new Pt({props:r}),ye.push(()=>Ne(e,"active",o)),e.$on("close",l[12]),e.$on("save",l[13]),{c(){q(e.$$.fragment)},m(s,a){z(e,s,a),n=!0},p(s,a){const i={};a&32&&(i.item=s[5]),a&128&&(i.initialEdit=s[7]),!t&&a&64&&(t=!0,i.active=s[6],Oe(()=>t=!1)),e.$set(i)},i(s){n||(N(e.$$.fragment,s),n=!0)},o(s){D(e.$$.fragment,s),n=!1},d(s){B(e,s)}}}function Ho(l){let e,t,n,o,r,s,a,i,_;Xe(l[15]);function h(v,k){if(v[2])return Wo;if(v[3])return Io}let d=h(l),f=d&&d(l),g=l[0]&&Cl(l),m=!l[2]&&!l[3]&&l[4].length>0&&Rl(),$=l[8]&&Tl(l),w=l[5]&&Ll(l);return{c(){e=p("div"),f&&f.c(),t=C(),g&&g.c(),n=C(),m&&m.c(),o=C(),$&&$.c(),r=C(),w&&w.c(),s=xe(),c(e,"class","graph-container svelte-1ry9pkl"),Ze(e,"width",l[0]?"100vw":"600px"),Ze(e,"height",l[0]?"100vh":"400px"),Tt(e,"fullscreen",l[0])},m(v,k){T(v,e,k),f&&f.m(e,null),l[16](e),T(v,t,k),g&&g.m(v,k),T(v,n,k),m&&m.m(v,k),T(v,o,k),$&&$.m(v,k),T(v,r,k),w&&w.m(v,k),T(v,s,k),a=!0,i||(_=V(At,"resize",l[15]),i=!0)},p(v,[k]){d===(d=h(v))&&f?f.p(v,k):(f&&f.d(1),f=d&&d(v),f&&(f.c(),f.m(e,null))),(!a||k&1)&&Ze(e,"width",v[0]?"100vw":"600px"),(!a||k&1)&&Ze(e,"height",v[0]?"100vh":"400px"),(!a||k&1)&&Tt(e,"fullscreen",v[0]),v[0]?g?g.p(v,k):(g=Cl(v),g.c(),g.m(n.parentNode,n)):g&&(g.d(1),g=null),!v[2]&&!v[3]&&v[4].length>0?m||(m=Rl(),m.c(),m.m(o.parentNode,o)):m&&(m.d(1),m=null),v[8]?$?$.p(v,k):($=Tl(v),$.c(),$.m(r.parentNode,r)):$&&($.d(1),$=null),v[5]?w?(w.p(v,k),k&32&&N(w,1)):(w=Ll(v),w.c(),N(w,1),w.m(s.parentNode,s)):w&&(Te(),D(w,1,1,()=>{w=null}),Le())},i(v){a||(N(w),a=!0)},o(v){D(w),a=!1},d(v){v&&R(e),f&&f.d(),l[16](null),v&&R(t),g&&g.d(v),v&&R(n),m&&m.d(v),v&&R(o),$&&$.d(v),v&&R(r),w&&w.d(v),v&&R(s),i=!1,_()}}}function Nl(l){return{id:`kg-node-${l.id}`,url:`#/graph/node/${l.id}`,title:l.label,body:`# ${l.label}

**Knowledge Graph Node**

ID: ${l.id}
Rank: ${l.rank}

This is a concept node from the knowledge graph. You can edit this content to add more information about "${l.label}".`,description:`Knowledge graph concept: ${l.label}`,tags:["knowledge-graph","concept"],rank:l.rank,stub:`Knowledge graph concept: ${l.label}`}}function Fo(l,e,t){let n,o;ue(l,at,S=>t(20,n=S)),ue(l,Ce,S=>t(21,o=S));let{apiUrl:r="/rolegraph"}=e,{fullscreen:s=!0}=e,a,i=!0,_=null,h=[],d=[],f=null,g=!1,m=!1,$="",w=window.innerWidth,v=window.innerHeight;function k(){t(9,w=window.innerWidth),t(10,v=window.innerHeight),!i&&!_&&H()}async function O(){t(2,i=!0),t(3,_=null);try{if(o){console.log("Loading rolegraph from Tauri");const S=await be("get_rolegraph",{roleName:n||void 0});if(S&&S.status==="success")t(4,h=S.nodes),d=S.edges;else throw new Error(`Tauri rolegraph fetch failed: ${(S==null?void 0:S.status)||"unknown error"}`)}else{console.log("Loading rolegraph from server");const S=n?`${r}?role=${encodeURIComponent(n)}`:r,I=await fetch(S);if(!I.ok)throw new Error(`Failed to fetch: ${I.status}`);const ne=await I.json();t(4,h=ne.nodes),d=ne.edges}}catch(S){t(3,_=S.message),console.error("Error fetching rolegraph:",S)}finally{t(2,i=!1)}}function F(S,I){S.stopPropagation(),console.log("Node clicked:",I.label),t(5,f=Nl(I)),t(7,m=!1),t(6,g=!0)}function K(S,I){S.preventDefault(),S.stopPropagation(),console.log("Node right-clicked:",I.label),t(8,$=`Right-clicked: ${I.label}`),t(5,f=Nl(I)),t(7,m=!0),t(6,g=!0),setTimeout(()=>{t(8,$="")},2e3)}function b(){t(6,g=!1),t(5,f=null),t(7,m=!1)}async function L(){if(f)try{const S=await fetch("/documents",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)});S.ok?console.log("Successfully saved KG record:",f.id):console.error("Failed to save KG record:",S.statusText)}catch(S){console.error("Error saving KG record:",S)}finally{t(6,g=!1),t(5,f=null),t(7,m=!1)}}function H(){if(!a)return;t(1,a.innerHTML="",a);const S=Nt(a).append("svg").attr("width",w).attr("height",v),I=pn().scaleExtent([.1,10]).on("zoom",P=>{ne.attr("transform",P.transform)});S.call(I);const ne=S.append("g"),Q=_n(h).force("link",mn(d).id(P=>P.id).distance(100)).force("charge",hn().strength(-200)).force("center",gn(w/2,v/2)).force("collision",vn().radius(20)),W=ne.append("g").attr("class","links").selectAll("line").data(d).enter().append("line").attr("stroke","#666").attr("stroke-opacity",.7).attr("stroke-width",P=>{const X=P.weight||P.rank||1;return Math.max(1,Math.min(8,X*2))}),le=ne.append("g").attr("class","nodes").selectAll("circle").data(h).enter().append("circle").attr("r",P=>{const X=P.rank||1;return Math.max(6,Math.min(20,X*2))}).attr("fill",P=>{const X=P.rank||1,x=Math.min(X/10,1);return bn(.2+x*.6)}).attr("stroke","#fff").attr("stroke-width",2).style("cursor","pointer").on("click",(P,X)=>F(P,X)).on("contextmenu",(P,X)=>K(P,X)).on("mouseover",function(P,X){Nt(this).transition().duration(150).attr("stroke-width",3).attr("r",x=>{const ae=x.rank||1;return Math.max(8,Math.min(24,ae*2.5))})}).on("mouseout",function(P,X){Nt(this).transition().duration(150).attr("stroke-width",2).attr("r",x=>{const ae=x.rank||1;return Math.max(6,Math.min(20,ae*2))})}).call(kn().on("start",ie).on("drag",pe).on("end",me)),Z=ne.append("g").attr("class","labels").selectAll("text").data(h).enter().append("text").attr("text-anchor","middle").attr("dy",".35em").attr("font-size","11px").attr("font-family","Arial, sans-serif").attr("fill","#333").attr("pointer-events","none").text(P=>P.label.length>12?P.label.substring(0,12)+"...":P.label);Q.on("tick",()=>{W.attr("x1",P=>P.source.x).attr("y1",P=>P.source.y).attr("x2",P=>P.target.x).attr("y2",P=>P.target.y),le.attr("cx",P=>P.x).attr("cy",P=>P.y),Z.attr("x",P=>P.x).attr("y",P=>P.y)});function ie(P,X){P.active||Q.alphaTarget(.3).restart(),X.fx=X.x,X.fy=X.y}function pe(P,X){X.fx=P.x,X.fy=P.y}function me(P,X){P.active||Q.alphaTarget(0),X.fx=null,X.fy=null}}Mt(()=>{O().then(()=>{_||H()});const S=I=>{I.preventDefault()};return a&&a.addEventListener("contextmenu",S),window.addEventListener("resize",k),()=>{a&&a.removeEventListener("contextmenu",S),window.removeEventListener("resize",k)}});function G(){t(9,w=At.innerWidth),t(10,v=At.innerHeight)}function J(S){ye[S?"unshift":"push"](()=>{a=S,t(1,a)})}const j=()=>history.back();function E(S){g=S,t(6,g)}return l.$$set=S=>{"apiUrl"in S&&t(14,r=S.apiUrl),"fullscreen"in S&&t(0,s=S.fullscreen)},[s,a,i,_,h,f,g,m,$,w,v,O,b,L,r,G,J,j,E]}class Ko extends De{constructor(e){super(),Ue(this,e,Fo,Ho,Re,{apiUrl:14,fullscreen:0})}}function Go(l){let e,t;return e=new So({}),{c(){q(e.$$.fragment)},m(n,o){z(e,n,o),t=!0},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){B(e,n)}}}function qo(l){let e,t;return e=new qn({}),{c(){q(e.$$.fragment)},m(n,o){z(e,n,o),t=!0},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){B(e,n)}}}function zo(l){let e,t;return e=new Ao({}),{c(){q(e.$$.fragment)},m(n,o){z(e,n,o),t=!0},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){B(e,n)}}}function Bo(l){let e,t;return e=new jo({}),{c(){q(e.$$.fragment)},m(n,o){z(e,n,o),t=!0},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){B(e,n)}}}function Jo(l){let e,t;return e=new Ko({}),{c(){q(e.$$.fragment)},m(n,o){z(e,n,o),t=!0},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){B(e,n)}}}function Vo(l){let e;return{c(){e=p("nav"),e.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
            <a class="navbar-item" href="/config/wizard">Wizard</a> 
            <a class="navbar-item" href="/config/json">JSON Editor</a> 
            <a class="navbar-item" href="/graph">Graph</a></div>`,c(e,"class","navbar")},m(t,n){T(t,e,n)},p:fe,d(t){t&&R(e)}}}function Yo(l){let e,t,n,o,r,s,a,i,_,h,d,f,g,m,$,w,v,k,O,F,K,b,L,H,G,J,j,E;return a=new Rt({}),h=new Ke({props:{path:"/",$$slots:{default:[Go]},$$scope:{ctx:l}}}),m=new Ke({props:{path:"/fetch/*",$$slots:{default:[qo]},$$scope:{ctx:l}}}),w=new Ke({props:{path:"/config/wizard",$$slots:{default:[zo]},$$scope:{ctx:l}}}),k=new Ke({props:{path:"/config/json",$$slots:{default:[Bo]},$$scope:{ctx:l}}}),F=new Ke({props:{path:"/graph",$$slots:{default:[Jo]},$$scope:{ctx:l}}}),H=new Ke({props:{path:"/",$$slots:{default:[Vo]},$$scope:{ctx:l}}}),{c(){e=p("meta"),t=C(),n=p("div"),o=p("main"),r=p("div"),s=p("div"),q(a.$$.fragment),i=C(),_=p("div"),q(h.$$.fragment),d=C(),f=p("br"),g=C(),q(m.$$.fragment),$=C(),q(w.$$.fragment),v=C(),q(k.$$.fragment),O=C(),q(F.$$.fragment),K=C(),b=p("footer"),L=p("div"),q(H.$$.fragment),c(e,"name","color-scheme"),c(e,"content",l[1]),document.title="Terraphim",c(s,"class","role-selector svelte-1bfpta4"),c(r,"class","top-controls svelte-1bfpta4"),c(_,"class","search-area svelte-1bfpta4"),c(o,"class","main-content svelte-1bfpta4"),c(L,"class",G=Zt(l[0])+" svelte-1bfpta4"),c(b,"class","svelte-1bfpta4"),c(n,"class","is-full-height svelte-1bfpta4")},m(S,I){u(document.head,e),T(S,t,I),T(S,n,I),u(n,o),u(o,r),u(r,s),z(a,s,null),u(o,i),u(o,_),z(h,_,null),u(o,d),u(o,f),u(o,g),z(m,o,null),u(o,$),z(w,o,null),u(o,v),z(k,o,null),u(o,O),z(F,o,null),u(n,K),u(n,b),u(b,L),z(H,L,null),J=!0,j||(E=[V(b,"mouseover",l[2]),V(b,"focus",l[2])],j=!0)},p(S,[I]){(!J||I&2)&&c(e,"content",S[1]);const ne={};I&8&&(ne.$$scope={dirty:I,ctx:S}),h.$set(ne);const Q={};I&8&&(Q.$$scope={dirty:I,ctx:S}),m.$set(Q);const W={};I&8&&(W.$$scope={dirty:I,ctx:S}),w.$set(W);const le={};I&8&&(le.$$scope={dirty:I,ctx:S}),k.$set(le);const Z={};I&8&&(Z.$$scope={dirty:I,ctx:S}),F.$set(Z);const ie={};I&8&&(ie.$$scope={dirty:I,ctx:S}),H.$set(ie),(!J||I&1&&G!==(G=Zt(S[0])+" svelte-1bfpta4"))&&c(L,"class",G)},i(S){J||(N(a.$$.fragment,S),N(h.$$.fragment,S),N(m.$$.fragment,S),N(w.$$.fragment,S),N(k.$$.fragment,S),N(F.$$.fragment,S),N(H.$$.fragment,S),J=!0)},o(S){D(a.$$.fragment,S),D(h.$$.fragment,S),D(m.$$.fragment,S),D(w.$$.fragment,S),D(k.$$.fragment,S),D(F.$$.fragment,S),D(H.$$.fragment,S),J=!1},d(S){R(e),S&&R(t),S&&R(n),B(a),B(h),B(m),B(w),B(k),B(F),B(H),j=!1,Ie(E)}}}function Zo(l,e,t){let n;ue(l,ft,s=>t(1,n=s));let o="is-hidden";function r(){t(0,o="")}return[o,n,r]}class Qo extends De{constructor(e){super(),Ue(this,e,Zo,Yo,Re,{})}}const Xo=new un;fn(Xo);new Qo({target:document.getElementById("app")});
