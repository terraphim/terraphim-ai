const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/fs-CRJ3ZtCH.js","assets/vendor-ui-CSKub_21.js","assets/vendor-ui-sXVIrMQW.css","assets/vendor-utils-CKg6JIBy.js","assets/vendor-editor-BfD-S608.js","assets/vendor-editor-j87ROi5W.css","assets/vendor-charts-DjHOzTAq.js","assets/vendor-atomic-CmRQlhXN.js","assets/vendor-atomic-DmgjdUkF.css"])))=>i.map(i=>d[i]);
var Qi=Object.defineProperty;var Yi=(n,e,t)=>e in n?Qi(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var nn=(n,e,t)=>Yi(n,typeof e!="symbol"?e+"":e,t);import{ac as sn,ad as bt,S as Ht,i as Ft,s as jt,d as $,v as Ce,t as Z,a as q,A as Te,h as S,z as $e,k as b,I as Nt,ah as lt,q as Dn,p as Xl,w as ft,Z as ve,E as i,l as ee,G as f,_ as I,X as Ie,J as Fe,ai as Al,H as yt,V as Et,W as At,g as rt,b as it,C as c,aj as Xt,O as Ge,P as Ct,ak as Xi,a2 as ke,al as pt,y as Pt,am as Zl,x as qn,o as Vn,an as Ll,B as yn,D as Lt,F as ul,ao as On,a3 as Zi,ap as Zn,af as xi,aq as vn,a6 as Sl,a8 as fi,aa as di,m as xl,ar as rl,as as ea,j as ta,at as na,au as Co,av as la,aw as pi,$ as Pl}from"./vendor-ui-CSKub_21.js";import{S as fl,f as mi,R as bn,Y as jl}from"./vendor-utils-CKg6JIBy.js";import{P as _i,a as oa,D as sa,b as ra,e as ia,E as aa,_ as il,J as hi}from"./vendor-editor-BfD-S608.js";import{s as Ul,z as ca,a as ua,l as fa,m as da,c as pa,b as ma,B as _a,d as ha}from"./vendor-charts-DjHOzTAq.js";import{g as gi,a as Ol,b as vi,s as ga,A as va}from"./vendor-atomic-CmRQlhXN.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&l(r)}).observe(document,{childList:!0,subtree:!0});function t(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function l(o){if(o.ep)return;o.ep=!0;const s=t(o);fetch(o.href,s)}})();const mt={ServerURL:`${location.protocol}//${window.location.host}`||"/"},tl=sn([]),ba={id:"Desktop",global_shortcut:"",roles:{},default_role:{original:"",lowercase:""},selected_role:{original:"",lowercase:""}},nl=sn("spacelab"),Dt=sn("selected"),It=sn(!1),ka=sn(`${mt.ServerURL}/documents/search`),on=sn(ba),To=sn([]),Sn=sn(""),ln=sn(!1),kl=sn(null),$o=sn(!1);let jn=null;function wa(n){if(typeof document>"u")return;const e=`/assets/bulmaswatch/${n}/bulmaswatch.min.css`;if(jn!=null&&jn.href.endsWith(e))return;const t=document.createElement("link");t.rel="stylesheet",t.href=e,t.id="bulma-theme",t.onload=()=>{jn&&jn!==t&&jn.remove(),jn=t},document.head.appendChild(t);const l=document.head.querySelector('meta[name="color-scheme"]');l&&l.setAttribute("content",n)}nl.subscribe(wa);function ya(){return window.crypto.getRandomValues(new Uint32Array(1))[0]}function Wl(n,e=!1){const t=ya(),l=`_${t}`;return Object.defineProperty(window,l,{value:o=>(e&&Reflect.deleteProperty(window,l),n==null?void 0:n(o)),writable:!1,configurable:!0}),t}async function Ze(n,e={}){return new Promise((t,l)=>{const o=Wl(r=>{t(r),Reflect.deleteProperty(window,`_${s}`)},!0),s=Wl(r=>{l(r),Reflect.deleteProperty(window,`_${o}`)},!0);window.__TAURI_IPC__({cmd:n,callback:o,error:s,...e})})}function An(){return bt(It)||typeof window<"u"&&window.__TAURI__!==void 0}class Ca{constructor(){nn(this,"baseUrl");nn(this,"autocompleteIndexBuilt",!1);nn(this,"sessionId");nn(this,"currentRole","Default");nn(this,"connectionRetries",0);nn(this,"maxRetries",3);nn(this,"retryDelay",1e3);nn(this,"isConnecting",!1);this.baseUrl=typeof window<"u"?(window.location.protocol==="https:"?"https://":"http://")+window.location.hostname+":8001":"http://localhost:8001",this.sessionId=`novel-${Date.now()}`,typeof window<"u"&&!An()&&this.shouldPerformHealthCheck()?this.detectServerPort():typeof window<"u"&&An()}setRole(e){this.currentRole=e,this.autocompleteIndexBuilt=!1}async detectServerPort(){if(An()||!this.shouldPerformHealthCheck())return;const t=[8001,3e3];for(const l of t)try{const o=typeof window<"u"?(window.location.protocol==="https:"?"https://":"http://")+window.location.hostname+":"+l:`http://localhost:${l}`,s=await fetch(`${o}/message?sessionId=health-check`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:0,method:"ping",params:{}}),signal:AbortSignal.timeout(1e3)});if(s.ok||s.status===404){this.baseUrl=o;return}}catch{}}shouldPerformHealthCheck(){return!(typeof window<"u"&&(!window.location.pathname.startsWith("/chat")||!(document.querySelector('[contenteditable="true"]')||document.querySelector("textarea")||document.querySelector('input[type="text"]'))))}async buildAutocompleteIndex(){if(this.isConnecting)return await new Promise(e=>setTimeout(e,1e3)),this.autocompleteIndexBuilt;this.isConnecting=!0;try{return An()?(this.autocompleteIndexBuilt=!0,this.connectionRetries=0,!0):await this.buildMCPIndex()}catch{return!1}finally{this.isConnecting=!1}}async buildMCPIndex(){for(let e=0;e<=this.maxRetries;e++)try{const t=await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:Date.now(),method:"tools/call",params:{name:"build_autocomplete_index",arguments:{}}}),signal:AbortSignal.timeout(1e4)});if(t.ok){const l=await t.json();if(l.result&&!l.result.is_error)return this.autocompleteIndexBuilt=!0,this.connectionRetries=0,!0}else t.status>=500&&e<this.maxRetries&&await new Promise(l=>setTimeout(l,this.retryDelay*(e+1)))}catch(t){t instanceof Error&&t.name,e<this.maxRetries&&await new Promise(l=>setTimeout(l,this.retryDelay*(e+1)))}return!1}async getCompletion(e){if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return{text:""};try{const t=this.extractLastWord(e.prompt);if(!t||t.length<1)return{text:""};const l=await this.getSuggestionsWithSnippets(t,5);if(l.length===0)return{text:""};let s=l[0].text;s.toLowerCase().startsWith(t.toLowerCase())&&(s=s.substring(t.length));const r=e.prompt.length/4,u=s.length/4;return{text:s,usage:{promptTokens:Math.round(r),completionTokens:Math.round(u),totalTokens:Math.round(r+u)}}}catch{return{text:""}}}async getSuggestions(e,t=10){if(!e||e.trim().length===0)return[];if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return[];try{return An()?await this.getTauriSuggestions(e,t):await this.getMCPSuggestions(e,t,"autocomplete_terms")}catch{return[]}}async getTauriSuggestions(e,t){const l=await Ze("get_autocomplete_suggestions",{query:e.trim(),role_name:this.currentRole,limit:t});return l&&l.status==="success"&&l.suggestions?l.suggestions.map(o=>({text:o.term||o.text||"",snippet:o.url||o.snippet||"",score:o.score||1})).filter(o=>o.text.length>0):(l!=null&&l.error,[])}async getMCPSuggestions(e,t,l){const o=Date.now(),s=await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:o,method:"tools/call",params:{name:l,arguments:{query:e.trim(),limit:t,role:this.currentRole}}}),signal:AbortSignal.timeout(5e3)});if(!s.ok)return[];const r=await s.json();return r.result&&!r.result.is_error&&r.result.content?l==="autocomplete_with_snippets"?this.parseAutocompleteWithSnippetsContent(r.result.content):this.parseAutocompleteContent(r.result.content):(r.error,[])}async getSuggestionsWithSnippets(e,t=10){if(!e||e.trim().length===0)return[];if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return[];try{return An()?await this.getTauriSuggestions(e,t):await this.getMCPSuggestions(e,t,"autocomplete_with_snippets")}catch{return[]}}extractLastWord(e){const t=e.trim().split(/\s+/);return t[t.length-1]||""}parseAutocompleteContent(e){const t=[];for(const l of e)if(l.type==="text"&&l.text){if(!l.text.startsWith("Found")&&!l.text.startsWith("•"))t.push({text:l.text.trim()});else if(l.text.startsWith("•")){const o=l.text.replace("•","").trim();o&&t.push({text:o})}}return t}parseAutocompleteWithSnippetsContent(e){const t=[];for(const l of e)if(l.type==="text"&&l.text){if(!l.text.startsWith("Found")&&!l.text.startsWith("•")){const o=l.text.split(" — ");o.length===2?t.push({text:o[0].trim(),snippet:o[1].trim()}):t.push({text:l.text.trim()})}else if(l.text.startsWith("•")){const o=l.text.replace("•","").trim();o&&t.push({text:o})}}return t}isReady(){return this.autocompleteIndexBuilt}getStatus(){return{ready:this.autocompleteIndexBuilt,baseUrl:this.baseUrl,sessionId:this.sessionId,usingTauri:An(),currentRole:this.currentRole,connectionRetries:this.connectionRetries,isConnecting:this.isConnecting}}async refreshIndex(){return this.autocompleteIndexBuilt=!1,this.connectionRetries=0,await this.buildAutocompleteIndex()}async testConnection(){try{if(An()){const e=await Ze("get_autocomplete_suggestions",{query:"test",role_name:this.currentRole,limit:1});return e&&(e.status==="success"||e.status==="error")}else return(await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:Date.now(),method:"tools/list",params:{}}),signal:AbortSignal.timeout(3e3)})).ok}catch{return!1}}}const Ln=new Ca;function Ta(n){var e;const{char:t,allowSpaces:l,allowToIncludeChar:o,allowedPrefixes:s,startOfLine:r,$position:u}=n,a=l&&!o,p=ia(t),d=new RegExp(`\\s${p}$`),m=r?"^":"",_=o?"":p,h=a?new RegExp(`${m}${p}.*?(?=\\s${_}|$)`,"gm"):new RegExp(`${m}(?:^)?${p}[^\\s${_}]*`,"gm"),g=((e=u.nodeBefore)===null||e===void 0?void 0:e.isText)&&u.nodeBefore.text;if(!g)return null;const w=u.pos-g.length,C=Array.from(g.matchAll(h)).pop();if(!C||C.input===void 0||C.index===void 0)return null;const y=C.input.slice(Math.max(0,C.index-1),C.index),T=new RegExp(`^[${s==null?void 0:s.join("")}\0]?$`).test(y);if(s!==null&&!T)return null;const k=w+C.index;let v=k+C[0].length;return a&&d.test(g.slice(v-1,v+1))&&(C[0]+=" ",v+=1),k<u.pos&&v>=u.pos?{range:{from:k,to:v},query:C[0].slice(t.length),text:C[0]}:null}const $a=new _i("suggestion");function Sa({pluginKey:n=$a,editor:e,char:t="@",allowSpaces:l=!1,allowToIncludeChar:o=!1,allowedPrefixes:s=[" "],startOfLine:r=!1,decorationTag:u="span",decorationClass:a="suggestion",decorationContent:p="",decorationEmptyClass:d="is-empty",command:m=()=>null,items:_=()=>[],render:h=()=>({}),allow:g=()=>!0,findSuggestionMatch:w=Ta}){let C;const y=h==null?void 0:h(),T=new oa({key:n,view(){return{update:async(k,v)=>{var L,R,A,N,D,B,V;const O=(L=this.key)===null||L===void 0?void 0:L.getState(v),E=(R=this.key)===null||R===void 0?void 0:R.getState(k.state),te=O.active&&E.active&&O.range.from!==E.range.from,M=!O.active&&E.active,X=O.active&&!E.active,J=!M&&!X&&O.query!==E.query,F=M||te&&J,H=J||te,z=X||te&&J;if(!F&&!H&&!z)return;const P=z&&!F?O:E,U=k.dom.querySelector(`[data-decoration-id="${P.decorationId}"]`);C={editor:e,range:P.range,query:P.query,text:P.text,items:[],command:K=>m({editor:e,range:P.range,props:K}),decorationNode:U,clientRect:U?()=>{var K;const{decorationId:Y}=(K=this.key)===null||K===void 0?void 0:K.getState(e.state),re=k.dom.querySelector(`[data-decoration-id="${Y}"]`);return(re==null?void 0:re.getBoundingClientRect())||null}:null},F&&((A=y==null?void 0:y.onBeforeStart)===null||A===void 0||A.call(y,C)),H&&((N=y==null?void 0:y.onBeforeUpdate)===null||N===void 0||N.call(y,C)),(H||F)&&(C.items=await _({editor:e,query:P.query})),z&&((D=y==null?void 0:y.onExit)===null||D===void 0||D.call(y,C)),H&&((B=y==null?void 0:y.onUpdate)===null||B===void 0||B.call(y,C)),F&&((V=y==null?void 0:y.onStart)===null||V===void 0||V.call(y,C))},destroy:()=>{var k;C&&((k=y==null?void 0:y.onExit)===null||k===void 0||k.call(y,C))}}},state:{init(){return{active:!1,range:{from:0,to:0},query:null,text:null,composing:!1}},apply(k,v,L,R){const{isEditable:A}=e,{composing:N}=e.view,{selection:D}=k,{empty:B,from:V}=D,O={...v};if(O.composing=N,A&&(B||e.view.composing)){(V<v.range.from||V>v.range.to)&&!N&&!v.composing&&(O.active=!1);const E=w({char:t,allowSpaces:l,allowToIncludeChar:o,allowedPrefixes:s,startOfLine:r,$position:D.$from}),te=`id_${Math.floor(Math.random()*4294967295)}`;E&&g({editor:e,state:R,range:E.range,isActive:v.active})?(O.active=!0,O.decorationId=v.decorationId?v.decorationId:te,O.range=E.range,O.query=E.query,O.text=E.text):O.active=!1}else O.active=!1;return O.active||(O.decorationId=null,O.range={from:0,to:0},O.query=null,O.text=null),O}},props:{handleKeyDown(k,v){var L;const{active:R,range:A}=T.getState(k.state);return R&&((L=y==null?void 0:y.onKeyDown)===null||L===void 0?void 0:L.call(y,{view:k,event:v,range:A}))||!1},decorations(k){const{active:v,range:L,decorationId:R,query:A}=T.getState(k);if(!v)return null;const N=!(A!=null&&A.length),D=[a];return N&&D.push(d),sa.create(k.doc,[ra.inline(L.from,L.to,{nodeName:u,class:D.join(" "),"data-decoration-id":R,"data-decoration-content":p})])}}});return T}var Zt="top",fn="bottom",dn="right",xt="left",eo="auto",dl=[Zt,fn,dn,xt],Jn="start",al="end",Oa="clippingParents",bi="viewport",el="popper",Ra="reference",So=dl.reduce(function(n,e){return n.concat([e+"-"+Jn,e+"-"+al])},[]),ki=[].concat(dl,[eo]).reduce(function(n,e){return n.concat([e,e+"-"+Jn,e+"-"+al])},[]),Ea="beforeRead",Aa="read",La="afterRead",Da="beforeMain",Na="main",Ia="afterMain",Ma="beforeWrite",Pa="write",ja="afterWrite",Ua=[Ea,Aa,La,Da,Na,Ia,Ma,Pa,ja];function Cn(n){return n?(n.nodeName||"").toLowerCase():null}function rn(n){if(n==null)return window;if(n.toString()!=="[object Window]"){var e=n.ownerDocument;return e&&e.defaultView||window}return n}function Fn(n){var e=rn(n).Element;return n instanceof e||n instanceof Element}function un(n){var e=rn(n).HTMLElement;return n instanceof e||n instanceof HTMLElement}function to(n){if(typeof ShadowRoot>"u")return!1;var e=rn(n).ShadowRoot;return n instanceof e||n instanceof ShadowRoot}function Ha(n){var e=n.state;Object.keys(e.elements).forEach(function(t){var l=e.styles[t]||{},o=e.attributes[t]||{},s=e.elements[t];!un(s)||!Cn(s)||(Object.assign(s.style,l),Object.keys(o).forEach(function(r){var u=o[r];u===!1?s.removeAttribute(r):s.setAttribute(r,u===!0?"":u)}))})}function Fa(n){var e=n.state,t={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,t.popper),e.styles=t,e.elements.arrow&&Object.assign(e.elements.arrow.style,t.arrow),function(){Object.keys(e.elements).forEach(function(l){var o=e.elements[l],s=e.attributes[l]||{},r=Object.keys(e.styles.hasOwnProperty(l)?e.styles[l]:t[l]),u=r.reduce(function(a,p){return a[p]="",a},{});!un(o)||!Cn(o)||(Object.assign(o.style,u),Object.keys(s).forEach(function(a){o.removeAttribute(a)}))})}}const wi={name:"applyStyles",enabled:!0,phase:"write",fn:Ha,effect:Fa,requires:["computeStyles"]};function wn(n){return n.split("-")[0]}var Hn=Math.max,Rl=Math.min,Qn=Math.round;function Gl(){var n=navigator.userAgentData;return n!=null&&n.brands&&Array.isArray(n.brands)?n.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function yi(){return!/^((?!chrome|android).)*safari/i.test(Gl())}function Yn(n,e,t){e===void 0&&(e=!1),t===void 0&&(t=!1);var l=n.getBoundingClientRect(),o=1,s=1;e&&un(n)&&(o=n.offsetWidth>0&&Qn(l.width)/n.offsetWidth||1,s=n.offsetHeight>0&&Qn(l.height)/n.offsetHeight||1);var r=Fn(n)?rn(n):window,u=r.visualViewport,a=!yi()&&t,p=(l.left+(a&&u?u.offsetLeft:0))/o,d=(l.top+(a&&u?u.offsetTop:0))/s,m=l.width/o,_=l.height/s;return{width:m,height:_,top:d,right:p+m,bottom:d+_,left:p,x:p,y:d}}function no(n){var e=Yn(n),t=n.offsetWidth,l=n.offsetHeight;return Math.abs(e.width-t)<=1&&(t=e.width),Math.abs(e.height-l)<=1&&(l=e.height),{x:n.offsetLeft,y:n.offsetTop,width:t,height:l}}function Ci(n,e){var t=e.getRootNode&&e.getRootNode();if(n.contains(e))return!0;if(t&&to(t)){var l=e;do{if(l&&n.isSameNode(l))return!0;l=l.parentNode||l.host}while(l)}return!1}function Rn(n){return rn(n).getComputedStyle(n)}function za(n){return["table","td","th"].indexOf(Cn(n))>=0}function Nn(n){return((Fn(n)?n.ownerDocument:n.document)||window.document).documentElement}function Dl(n){return Cn(n)==="html"?n:n.assignedSlot||n.parentNode||(to(n)?n.host:null)||Nn(n)}function Oo(n){return!un(n)||Rn(n).position==="fixed"?null:n.offsetParent}function Ka(n){var e=/firefox/i.test(Gl()),t=/Trident/i.test(Gl());if(t&&un(n)){var l=Rn(n);if(l.position==="fixed")return null}var o=Dl(n);for(to(o)&&(o=o.host);un(o)&&["html","body"].indexOf(Cn(o))<0;){var s=Rn(o);if(s.transform!=="none"||s.perspective!=="none"||s.contain==="paint"||["transform","perspective"].indexOf(s.willChange)!==-1||e&&s.willChange==="filter"||e&&s.filter&&s.filter!=="none")return o;o=o.parentNode}return null}function pl(n){for(var e=rn(n),t=Oo(n);t&&za(t)&&Rn(t).position==="static";)t=Oo(t);return t&&(Cn(t)==="html"||Cn(t)==="body"&&Rn(t).position==="static")?e:t||Ka(n)||e}function lo(n){return["top","bottom"].indexOf(n)>=0?"x":"y"}function ll(n,e,t){return Hn(n,Rl(e,t))}function Ba(n,e,t){var l=ll(n,e,t);return l>t?t:l}function Ti(){return{top:0,right:0,bottom:0,left:0}}function $i(n){return Object.assign({},Ti(),n)}function Si(n,e){return e.reduce(function(t,l){return t[l]=n,t},{})}var Wa=function(e,t){return e=typeof e=="function"?e(Object.assign({},t.rects,{placement:t.placement})):e,$i(typeof e!="number"?e:Si(e,dl))};function Ga(n){var e,t=n.state,l=n.name,o=n.options,s=t.elements.arrow,r=t.modifiersData.popperOffsets,u=wn(t.placement),a=lo(u),p=[xt,dn].indexOf(u)>=0,d=p?"height":"width";if(!(!s||!r)){var m=Wa(o.padding,t),_=no(s),h=a==="y"?Zt:xt,g=a==="y"?fn:dn,w=t.rects.reference[d]+t.rects.reference[a]-r[a]-t.rects.popper[d],C=r[a]-t.rects.reference[a],y=pl(s),T=y?a==="y"?y.clientHeight||0:y.clientWidth||0:0,k=w/2-C/2,v=m[h],L=T-_[d]-m[g],R=T/2-_[d]/2+k,A=ll(v,R,L),N=a;t.modifiersData[l]=(e={},e[N]=A,e.centerOffset=A-R,e)}}function qa(n){var e=n.state,t=n.options,l=t.element,o=l===void 0?"[data-popper-arrow]":l;o!=null&&(typeof o=="string"&&(o=e.elements.popper.querySelector(o),!o)||Ci(e.elements.popper,o)&&(e.elements.arrow=o))}const Va={name:"arrow",enabled:!0,phase:"main",fn:Ga,effect:qa,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Xn(n){return n.split("-")[1]}var Ja={top:"auto",right:"auto",bottom:"auto",left:"auto"};function Qa(n,e){var t=n.x,l=n.y,o=e.devicePixelRatio||1;return{x:Qn(t*o)/o||0,y:Qn(l*o)/o||0}}function Ro(n){var e,t=n.popper,l=n.popperRect,o=n.placement,s=n.variation,r=n.offsets,u=n.position,a=n.gpuAcceleration,p=n.adaptive,d=n.roundOffsets,m=n.isFixed,_=r.x,h=_===void 0?0:_,g=r.y,w=g===void 0?0:g,C=typeof d=="function"?d({x:h,y:w}):{x:h,y:w};h=C.x,w=C.y;var y=r.hasOwnProperty("x"),T=r.hasOwnProperty("y"),k=xt,v=Zt,L=window;if(p){var R=pl(t),A="clientHeight",N="clientWidth";if(R===rn(t)&&(R=Nn(t),Rn(R).position!=="static"&&u==="absolute"&&(A="scrollHeight",N="scrollWidth")),R=R,o===Zt||(o===xt||o===dn)&&s===al){v=fn;var D=m&&R===L&&L.visualViewport?L.visualViewport.height:R[A];w-=D-l.height,w*=a?1:-1}if(o===xt||(o===Zt||o===fn)&&s===al){k=dn;var B=m&&R===L&&L.visualViewport?L.visualViewport.width:R[N];h-=B-l.width,h*=a?1:-1}}var V=Object.assign({position:u},p&&Ja),O=d===!0?Qa({x:h,y:w},rn(t)):{x:h,y:w};if(h=O.x,w=O.y,a){var E;return Object.assign({},V,(E={},E[v]=T?"0":"",E[k]=y?"0":"",E.transform=(L.devicePixelRatio||1)<=1?"translate("+h+"px, "+w+"px)":"translate3d("+h+"px, "+w+"px, 0)",E))}return Object.assign({},V,(e={},e[v]=T?w+"px":"",e[k]=y?h+"px":"",e.transform="",e))}function Ya(n){var e=n.state,t=n.options,l=t.gpuAcceleration,o=l===void 0?!0:l,s=t.adaptive,r=s===void 0?!0:s,u=t.roundOffsets,a=u===void 0?!0:u,p={placement:wn(e.placement),variation:Xn(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:o,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,Ro(Object.assign({},p,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:r,roundOffsets:a})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,Ro(Object.assign({},p,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:a})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const Xa={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:Ya,data:{}};var wl={passive:!0};function Za(n){var e=n.state,t=n.instance,l=n.options,o=l.scroll,s=o===void 0?!0:o,r=l.resize,u=r===void 0?!0:r,a=rn(e.elements.popper),p=[].concat(e.scrollParents.reference,e.scrollParents.popper);return s&&p.forEach(function(d){d.addEventListener("scroll",t.update,wl)}),u&&a.addEventListener("resize",t.update,wl),function(){s&&p.forEach(function(d){d.removeEventListener("scroll",t.update,wl)}),u&&a.removeEventListener("resize",t.update,wl)}}const xa={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:Za,data:{}};var ec={left:"right",right:"left",bottom:"top",top:"bottom"};function Tl(n){return n.replace(/left|right|bottom|top/g,function(e){return ec[e]})}var tc={start:"end",end:"start"};function Eo(n){return n.replace(/start|end/g,function(e){return tc[e]})}function oo(n){var e=rn(n),t=e.pageXOffset,l=e.pageYOffset;return{scrollLeft:t,scrollTop:l}}function so(n){return Yn(Nn(n)).left+oo(n).scrollLeft}function nc(n,e){var t=rn(n),l=Nn(n),o=t.visualViewport,s=l.clientWidth,r=l.clientHeight,u=0,a=0;if(o){s=o.width,r=o.height;var p=yi();(p||!p&&e==="fixed")&&(u=o.offsetLeft,a=o.offsetTop)}return{width:s,height:r,x:u+so(n),y:a}}function lc(n){var e,t=Nn(n),l=oo(n),o=(e=n.ownerDocument)==null?void 0:e.body,s=Hn(t.scrollWidth,t.clientWidth,o?o.scrollWidth:0,o?o.clientWidth:0),r=Hn(t.scrollHeight,t.clientHeight,o?o.scrollHeight:0,o?o.clientHeight:0),u=-l.scrollLeft+so(n),a=-l.scrollTop;return Rn(o||t).direction==="rtl"&&(u+=Hn(t.clientWidth,o?o.clientWidth:0)-s),{width:s,height:r,x:u,y:a}}function ro(n){var e=Rn(n),t=e.overflow,l=e.overflowX,o=e.overflowY;return/auto|scroll|overlay|hidden/.test(t+o+l)}function Oi(n){return["html","body","#document"].indexOf(Cn(n))>=0?n.ownerDocument.body:un(n)&&ro(n)?n:Oi(Dl(n))}function ol(n,e){var t;e===void 0&&(e=[]);var l=Oi(n),o=l===((t=n.ownerDocument)==null?void 0:t.body),s=rn(l),r=o?[s].concat(s.visualViewport||[],ro(l)?l:[]):l,u=e.concat(r);return o?u:u.concat(ol(Dl(r)))}function ql(n){return Object.assign({},n,{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height})}function oc(n,e){var t=Yn(n,!1,e==="fixed");return t.top=t.top+n.clientTop,t.left=t.left+n.clientLeft,t.bottom=t.top+n.clientHeight,t.right=t.left+n.clientWidth,t.width=n.clientWidth,t.height=n.clientHeight,t.x=t.left,t.y=t.top,t}function Ao(n,e,t){return e===bi?ql(nc(n,t)):Fn(e)?oc(e,t):ql(lc(Nn(n)))}function sc(n){var e=ol(Dl(n)),t=["absolute","fixed"].indexOf(Rn(n).position)>=0,l=t&&un(n)?pl(n):n;return Fn(l)?e.filter(function(o){return Fn(o)&&Ci(o,l)&&Cn(o)!=="body"}):[]}function rc(n,e,t,l){var o=e==="clippingParents"?sc(n):[].concat(e),s=[].concat(o,[t]),r=s[0],u=s.reduce(function(a,p){var d=Ao(n,p,l);return a.top=Hn(d.top,a.top),a.right=Rl(d.right,a.right),a.bottom=Rl(d.bottom,a.bottom),a.left=Hn(d.left,a.left),a},Ao(n,r,l));return u.width=u.right-u.left,u.height=u.bottom-u.top,u.x=u.left,u.y=u.top,u}function Ri(n){var e=n.reference,t=n.element,l=n.placement,o=l?wn(l):null,s=l?Xn(l):null,r=e.x+e.width/2-t.width/2,u=e.y+e.height/2-t.height/2,a;switch(o){case Zt:a={x:r,y:e.y-t.height};break;case fn:a={x:r,y:e.y+e.height};break;case dn:a={x:e.x+e.width,y:u};break;case xt:a={x:e.x-t.width,y:u};break;default:a={x:e.x,y:e.y}}var p=o?lo(o):null;if(p!=null){var d=p==="y"?"height":"width";switch(s){case Jn:a[p]=a[p]-(e[d]/2-t[d]/2);break;case al:a[p]=a[p]+(e[d]/2-t[d]/2);break}}return a}function cl(n,e){e===void 0&&(e={});var t=e,l=t.placement,o=l===void 0?n.placement:l,s=t.strategy,r=s===void 0?n.strategy:s,u=t.boundary,a=u===void 0?Oa:u,p=t.rootBoundary,d=p===void 0?bi:p,m=t.elementContext,_=m===void 0?el:m,h=t.altBoundary,g=h===void 0?!1:h,w=t.padding,C=w===void 0?0:w,y=$i(typeof C!="number"?C:Si(C,dl)),T=_===el?Ra:el,k=n.rects.popper,v=n.elements[g?T:_],L=rc(Fn(v)?v:v.contextElement||Nn(n.elements.popper),a,d,r),R=Yn(n.elements.reference),A=Ri({reference:R,element:k,placement:o}),N=ql(Object.assign({},k,A)),D=_===el?N:R,B={top:L.top-D.top+y.top,bottom:D.bottom-L.bottom+y.bottom,left:L.left-D.left+y.left,right:D.right-L.right+y.right},V=n.modifiersData.offset;if(_===el&&V){var O=V[o];Object.keys(B).forEach(function(E){var te=[dn,fn].indexOf(E)>=0?1:-1,M=[Zt,fn].indexOf(E)>=0?"y":"x";B[E]+=O[M]*te})}return B}function ic(n,e){e===void 0&&(e={});var t=e,l=t.placement,o=t.boundary,s=t.rootBoundary,r=t.padding,u=t.flipVariations,a=t.allowedAutoPlacements,p=a===void 0?ki:a,d=Xn(l),m=d?u?So:So.filter(function(g){return Xn(g)===d}):dl,_=m.filter(function(g){return p.indexOf(g)>=0});_.length===0&&(_=m);var h=_.reduce(function(g,w){return g[w]=cl(n,{placement:w,boundary:o,rootBoundary:s,padding:r})[wn(w)],g},{});return Object.keys(h).sort(function(g,w){return h[g]-h[w]})}function ac(n){if(wn(n)===eo)return[];var e=Tl(n);return[Eo(n),e,Eo(e)]}function cc(n){var e=n.state,t=n.options,l=n.name;if(!e.modifiersData[l]._skip){for(var o=t.mainAxis,s=o===void 0?!0:o,r=t.altAxis,u=r===void 0?!0:r,a=t.fallbackPlacements,p=t.padding,d=t.boundary,m=t.rootBoundary,_=t.altBoundary,h=t.flipVariations,g=h===void 0?!0:h,w=t.allowedAutoPlacements,C=e.options.placement,y=wn(C),T=y===C,k=a||(T||!g?[Tl(C)]:ac(C)),v=[C].concat(k).reduce(function(Y,re){return Y.concat(wn(re)===eo?ic(e,{placement:re,boundary:d,rootBoundary:m,padding:p,flipVariations:g,allowedAutoPlacements:w}):re)},[]),L=e.rects.reference,R=e.rects.popper,A=new Map,N=!0,D=v[0],B=0;B<v.length;B++){var V=v[B],O=wn(V),E=Xn(V)===Jn,te=[Zt,fn].indexOf(O)>=0,M=te?"width":"height",X=cl(e,{placement:V,boundary:d,rootBoundary:m,altBoundary:_,padding:p}),J=te?E?dn:xt:E?fn:Zt;L[M]>R[M]&&(J=Tl(J));var F=Tl(J),H=[];if(s&&H.push(X[O]<=0),u&&H.push(X[J]<=0,X[F]<=0),H.every(function(Y){return Y})){D=V,N=!1;break}A.set(V,H)}if(N)for(var z=g?3:1,P=function(re){var ae=v.find(function(ne){var Q=A.get(ne);if(Q)return Q.slice(0,re).every(function(ue){return ue})});if(ae)return D=ae,"break"},U=z;U>0;U--){var K=P(U);if(K==="break")break}e.placement!==D&&(e.modifiersData[l]._skip=!0,e.placement=D,e.reset=!0)}}const uc={name:"flip",enabled:!0,phase:"main",fn:cc,requiresIfExists:["offset"],data:{_skip:!1}};function Lo(n,e,t){return t===void 0&&(t={x:0,y:0}),{top:n.top-e.height-t.y,right:n.right-e.width+t.x,bottom:n.bottom-e.height+t.y,left:n.left-e.width-t.x}}function Do(n){return[Zt,dn,fn,xt].some(function(e){return n[e]>=0})}function fc(n){var e=n.state,t=n.name,l=e.rects.reference,o=e.rects.popper,s=e.modifiersData.preventOverflow,r=cl(e,{elementContext:"reference"}),u=cl(e,{altBoundary:!0}),a=Lo(r,l),p=Lo(u,o,s),d=Do(a),m=Do(p);e.modifiersData[t]={referenceClippingOffsets:a,popperEscapeOffsets:p,isReferenceHidden:d,hasPopperEscaped:m},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":d,"data-popper-escaped":m})}const dc={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:fc};function pc(n,e,t){var l=wn(n),o=[xt,Zt].indexOf(l)>=0?-1:1,s=typeof t=="function"?t(Object.assign({},e,{placement:n})):t,r=s[0],u=s[1];return r=r||0,u=(u||0)*o,[xt,dn].indexOf(l)>=0?{x:u,y:r}:{x:r,y:u}}function mc(n){var e=n.state,t=n.options,l=n.name,o=t.offset,s=o===void 0?[0,0]:o,r=ki.reduce(function(d,m){return d[m]=pc(m,e.rects,s),d},{}),u=r[e.placement],a=u.x,p=u.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=a,e.modifiersData.popperOffsets.y+=p),e.modifiersData[l]=r}const _c={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:mc};function hc(n){var e=n.state,t=n.name;e.modifiersData[t]=Ri({reference:e.rects.reference,element:e.rects.popper,placement:e.placement})}const gc={name:"popperOffsets",enabled:!0,phase:"read",fn:hc,data:{}};function vc(n){return n==="x"?"y":"x"}function bc(n){var e=n.state,t=n.options,l=n.name,o=t.mainAxis,s=o===void 0?!0:o,r=t.altAxis,u=r===void 0?!1:r,a=t.boundary,p=t.rootBoundary,d=t.altBoundary,m=t.padding,_=t.tether,h=_===void 0?!0:_,g=t.tetherOffset,w=g===void 0?0:g,C=cl(e,{boundary:a,rootBoundary:p,padding:m,altBoundary:d}),y=wn(e.placement),T=Xn(e.placement),k=!T,v=lo(y),L=vc(v),R=e.modifiersData.popperOffsets,A=e.rects.reference,N=e.rects.popper,D=typeof w=="function"?w(Object.assign({},e.rects,{placement:e.placement})):w,B=typeof D=="number"?{mainAxis:D,altAxis:D}:Object.assign({mainAxis:0,altAxis:0},D),V=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,O={x:0,y:0};if(R){if(s){var E,te=v==="y"?Zt:xt,M=v==="y"?fn:dn,X=v==="y"?"height":"width",J=R[v],F=J+C[te],H=J-C[M],z=h?-N[X]/2:0,P=T===Jn?A[X]:N[X],U=T===Jn?-N[X]:-A[X],K=e.elements.arrow,Y=h&&K?no(K):{width:0,height:0},re=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:Ti(),ae=re[te],ne=re[M],Q=ll(0,A[X],Y[X]),ue=k?A[X]/2-z-Q-ae-B.mainAxis:P-Q-ae-B.mainAxis,se=k?-A[X]/2+z+Q+ne+B.mainAxis:U+Q+ne+B.mainAxis,j=e.elements.arrow&&pl(e.elements.arrow),W=j?v==="y"?j.clientTop||0:j.clientLeft||0:0,le=(E=V==null?void 0:V[v])!=null?E:0,ie=J+ue-le-W,_e=J+se-le,ce=ll(h?Rl(F,ie):F,J,h?Hn(H,_e):H);R[v]=ce,O[v]=ce-J}if(u){var fe,de=v==="x"?Zt:xt,ze=v==="x"?fn:dn,Xe=R[L],qe=L==="y"?"height":"width",Me=Xe+C[de],Pe=Xe-C[ze],he=[Zt,xt].indexOf(y)!==-1,Ue=(fe=V==null?void 0:V[L])!=null?fe:0,xe=he?Me:Xe-A[qe]-N[qe]-Ue+B.altAxis,Ve=he?Xe+A[qe]+N[qe]-Ue-B.altAxis:Pe,We=h&&he?Ba(xe,Xe,Ve):ll(h?xe:Me,Xe,h?Ve:Pe);R[L]=We,O[L]=We-Xe}e.modifiersData[l]=O}}const kc={name:"preventOverflow",enabled:!0,phase:"main",fn:bc,requiresIfExists:["offset"]};function wc(n){return{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}}function yc(n){return n===rn(n)||!un(n)?oo(n):wc(n)}function Cc(n){var e=n.getBoundingClientRect(),t=Qn(e.width)/n.offsetWidth||1,l=Qn(e.height)/n.offsetHeight||1;return t!==1||l!==1}function Tc(n,e,t){t===void 0&&(t=!1);var l=un(e),o=un(e)&&Cc(e),s=Nn(e),r=Yn(n,o,t),u={scrollLeft:0,scrollTop:0},a={x:0,y:0};return(l||!l&&!t)&&((Cn(e)!=="body"||ro(s))&&(u=yc(e)),un(e)?(a=Yn(e,!0),a.x+=e.clientLeft,a.y+=e.clientTop):s&&(a.x=so(s))),{x:r.left+u.scrollLeft-a.x,y:r.top+u.scrollTop-a.y,width:r.width,height:r.height}}function $c(n){var e=new Map,t=new Set,l=[];n.forEach(function(s){e.set(s.name,s)});function o(s){t.add(s.name);var r=[].concat(s.requires||[],s.requiresIfExists||[]);r.forEach(function(u){if(!t.has(u)){var a=e.get(u);a&&o(a)}}),l.push(s)}return n.forEach(function(s){t.has(s.name)||o(s)}),l}function Sc(n){var e=$c(n);return Ua.reduce(function(t,l){return t.concat(e.filter(function(o){return o.phase===l}))},[])}function Oc(n){var e;return function(){return e||(e=new Promise(function(t){Promise.resolve().then(function(){e=void 0,t(n())})})),e}}function Rc(n){var e=n.reduce(function(t,l){var o=t[l.name];return t[l.name]=o?Object.assign({},o,l,{options:Object.assign({},o.options,l.options),data:Object.assign({},o.data,l.data)}):l,t},{});return Object.keys(e).map(function(t){return e[t]})}var No={placement:"bottom",modifiers:[],strategy:"absolute"};function Io(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return!e.some(function(l){return!(l&&typeof l.getBoundingClientRect=="function")})}function Ec(n){n===void 0&&(n={});var e=n,t=e.defaultModifiers,l=t===void 0?[]:t,o=e.defaultOptions,s=o===void 0?No:o;return function(u,a,p){p===void 0&&(p=s);var d={placement:"bottom",orderedModifiers:[],options:Object.assign({},No,s),modifiersData:{},elements:{reference:u,popper:a},attributes:{},styles:{}},m=[],_=!1,h={state:d,setOptions:function(y){var T=typeof y=="function"?y(d.options):y;w(),d.options=Object.assign({},s,d.options,T),d.scrollParents={reference:Fn(u)?ol(u):u.contextElement?ol(u.contextElement):[],popper:ol(a)};var k=Sc(Rc([].concat(l,d.options.modifiers)));return d.orderedModifiers=k.filter(function(v){return v.enabled}),g(),h.update()},forceUpdate:function(){if(!_){var y=d.elements,T=y.reference,k=y.popper;if(Io(T,k)){d.rects={reference:Tc(T,pl(k),d.options.strategy==="fixed"),popper:no(k)},d.reset=!1,d.placement=d.options.placement,d.orderedModifiers.forEach(function(B){return d.modifiersData[B.name]=Object.assign({},B.data)});for(var v=0;v<d.orderedModifiers.length;v++){if(d.reset===!0){d.reset=!1,v=-1;continue}var L=d.orderedModifiers[v],R=L.fn,A=L.options,N=A===void 0?{}:A,D=L.name;typeof R=="function"&&(d=R({state:d,options:N,name:D,instance:h})||d)}}}},update:Oc(function(){return new Promise(function(C){h.forceUpdate(),C(d)})}),destroy:function(){w(),_=!0}};if(!Io(u,a))return h;h.setOptions(p).then(function(C){!_&&p.onFirstUpdate&&p.onFirstUpdate(C)});function g(){d.orderedModifiers.forEach(function(C){var y=C.name,T=C.options,k=T===void 0?{}:T,v=C.effect;if(typeof v=="function"){var L=v({state:d,name:y,instance:h,options:k}),R=function(){};m.push(L||R)}})}function w(){m.forEach(function(C){return C()}),m=[]}return h}}var Ac=[xa,gc,Xa,wi,_c,uc,kc,Va,dc],Lc=Ec({defaultModifiers:Ac}),Dc="tippy-box",Ei="tippy-content",Nc="tippy-backdrop",Ai="tippy-arrow",Li="tippy-svg-arrow",Un={passive:!0,capture:!0},Di=function(){return document.body};function Hl(n,e,t){if(Array.isArray(n)){var l=n[e];return l??(Array.isArray(t)?t[e]:t)}return n}function io(n,e){var t={}.toString.call(n);return t.indexOf("[object")===0&&t.indexOf(e+"]")>-1}function Ni(n,e){return typeof n=="function"?n.apply(void 0,e):n}function Mo(n,e){if(e===0)return n;var t;return function(l){clearTimeout(t),t=setTimeout(function(){n(l)},e)}}function Ic(n){return n.split(/\s+/).filter(Boolean)}function Gn(n){return[].concat(n)}function Po(n,e){n.indexOf(e)===-1&&n.push(e)}function Mc(n){return n.filter(function(e,t){return n.indexOf(e)===t})}function Pc(n){return n.split("-")[0]}function El(n){return[].slice.call(n)}function jo(n){return Object.keys(n).reduce(function(e,t){return n[t]!==void 0&&(e[t]=n[t]),e},{})}function sl(){return document.createElement("div")}function Nl(n){return["Element","Fragment"].some(function(e){return io(n,e)})}function jc(n){return io(n,"NodeList")}function Uc(n){return io(n,"MouseEvent")}function Hc(n){return!!(n&&n._tippy&&n._tippy.reference===n)}function Fc(n){return Nl(n)?[n]:jc(n)?El(n):Array.isArray(n)?n:El(document.querySelectorAll(n))}function Fl(n,e){n.forEach(function(t){t&&(t.style.transitionDuration=e+"ms")})}function Uo(n,e){n.forEach(function(t){t&&t.setAttribute("data-state",e)})}function zc(n){var e,t=Gn(n),l=t[0];return l!=null&&(e=l.ownerDocument)!=null&&e.body?l.ownerDocument:document}function Kc(n,e){var t=e.clientX,l=e.clientY;return n.every(function(o){var s=o.popperRect,r=o.popperState,u=o.props,a=u.interactiveBorder,p=Pc(r.placement),d=r.modifiersData.offset;if(!d)return!0;var m=p==="bottom"?d.top.y:0,_=p==="top"?d.bottom.y:0,h=p==="right"?d.left.x:0,g=p==="left"?d.right.x:0,w=s.top-l+m>a,C=l-s.bottom-_>a,y=s.left-t+h>a,T=t-s.right-g>a;return w||C||y||T})}function zl(n,e,t){var l=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(o){n[l](o,t)})}function Ho(n,e){for(var t=e;t;){var l;if(n.contains(t))return!0;t=t.getRootNode==null||(l=t.getRootNode())==null?void 0:l.host}return!1}var kn={isTouch:!1},Fo=0;function Bc(){kn.isTouch||(kn.isTouch=!0,window.performance&&document.addEventListener("mousemove",Ii))}function Ii(){var n=performance.now();n-Fo<20&&(kn.isTouch=!1,document.removeEventListener("mousemove",Ii)),Fo=n}function Wc(){var n=document.activeElement;if(Hc(n)){var e=n._tippy;n.blur&&!e.state.isVisible&&n.blur()}}function Gc(){document.addEventListener("touchstart",Bc,Un),window.addEventListener("blur",Wc)}var qc=typeof window<"u"&&typeof document<"u",Vc=qc?!!window.msCrypto:!1,Jc={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},Qc={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},mn=Object.assign({appendTo:Di,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},Jc,Qc),Yc=Object.keys(mn),Xc=function(e){var t=Object.keys(e);t.forEach(function(l){mn[l]=e[l]})};function Mi(n){var e=n.plugins||[],t=e.reduce(function(l,o){var s=o.name,r=o.defaultValue;if(s){var u;l[s]=n[s]!==void 0?n[s]:(u=mn[s])!=null?u:r}return l},{});return Object.assign({},n,t)}function Zc(n,e){var t=e?Object.keys(Mi(Object.assign({},mn,{plugins:e}))):Yc,l=t.reduce(function(o,s){var r=(n.getAttribute("data-tippy-"+s)||"").trim();if(!r)return o;if(s==="content")o[s]=r;else try{o[s]=JSON.parse(r)}catch{o[s]=r}return o},{});return l}function zo(n,e){var t=Object.assign({},e,{content:Ni(e.content,[n])},e.ignoreAttributes?{}:Zc(n,e.plugins));return t.aria=Object.assign({},mn.aria,t.aria),t.aria={expanded:t.aria.expanded==="auto"?e.interactive:t.aria.expanded,content:t.aria.content==="auto"?e.interactive?null:"describedby":t.aria.content},t}var xc=function(){return"innerHTML"};function Vl(n,e){n[xc()]=e}function Ko(n){var e=sl();return n===!0?e.className=Ai:(e.className=Li,Nl(n)?e.appendChild(n):Vl(e,n)),e}function Bo(n,e){Nl(e.content)?(Vl(n,""),n.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?Vl(n,e.content):n.textContent=e.content)}function Jl(n){var e=n.firstElementChild,t=El(e.children);return{box:e,content:t.find(function(l){return l.classList.contains(Ei)}),arrow:t.find(function(l){return l.classList.contains(Ai)||l.classList.contains(Li)}),backdrop:t.find(function(l){return l.classList.contains(Nc)})}}function Pi(n){var e=sl(),t=sl();t.className=Dc,t.setAttribute("data-state","hidden"),t.setAttribute("tabindex","-1");var l=sl();l.className=Ei,l.setAttribute("data-state","hidden"),Bo(l,n.props),e.appendChild(t),t.appendChild(l),o(n.props,n.props);function o(s,r){var u=Jl(e),a=u.box,p=u.content,d=u.arrow;r.theme?a.setAttribute("data-theme",r.theme):a.removeAttribute("data-theme"),typeof r.animation=="string"?a.setAttribute("data-animation",r.animation):a.removeAttribute("data-animation"),r.inertia?a.setAttribute("data-inertia",""):a.removeAttribute("data-inertia"),a.style.maxWidth=typeof r.maxWidth=="number"?r.maxWidth+"px":r.maxWidth,r.role?a.setAttribute("role",r.role):a.removeAttribute("role"),(s.content!==r.content||s.allowHTML!==r.allowHTML)&&Bo(p,n.props),r.arrow?d?s.arrow!==r.arrow&&(a.removeChild(d),a.appendChild(Ko(r.arrow))):a.appendChild(Ko(r.arrow)):d&&a.removeChild(d)}return{popper:e,onUpdate:o}}Pi.$$tippy=!0;var eu=1,yl=[],Kl=[];function tu(n,e){var t=zo(n,Object.assign({},mn,Mi(jo(e)))),l,o,s,r=!1,u=!1,a=!1,p=!1,d,m,_,h=[],g=Mo(ie,t.interactiveDebounce),w,C=eu++,y=null,T=Mc(t.plugins),k={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},v={id:C,reference:n,popper:sl(),popperInstance:y,props:t,state:k,plugins:T,clearDelayTimeouts:xe,setProps:Ve,setContent:We,show:Ke,hide:Ye,hideWithInteractivity:ct,enable:he,disable:Ue,unmount:ht,destroy:tt};if(!t.render)return v;var L=t.render(v),R=L.popper,A=L.onUpdate;R.setAttribute("data-tippy-root",""),R.id="tippy-"+v.id,v.popper=R,n._tippy=v,R._tippy=v;var N=T.map(function(x){return x.fn(v)}),D=n.hasAttribute("aria-expanded");return j(),z(),J(),F("onCreate",[v]),t.showOnCreate&&Me(),R.addEventListener("mouseenter",function(){v.props.interactive&&v.state.isVisible&&v.clearDelayTimeouts()}),R.addEventListener("mouseleave",function(){v.props.interactive&&v.props.trigger.indexOf("mouseenter")>=0&&te().addEventListener("mousemove",g)}),v;function B(){var x=v.props.touch;return Array.isArray(x)?x:[x,0]}function V(){return B()[0]==="hold"}function O(){var x;return!!((x=v.props.render)!=null&&x.$$tippy)}function E(){return w||n}function te(){var x=E().parentNode;return x?zc(x):document}function M(){return Jl(R)}function X(x){return v.state.isMounted&&!v.state.isVisible||kn.isTouch||d&&d.type==="focus"?0:Hl(v.props.delay,x?0:1,mn.delay)}function J(x){x===void 0&&(x=!1),R.style.pointerEvents=v.props.interactive&&!x?"":"none",R.style.zIndex=""+v.props.zIndex}function F(x,we,Re){if(Re===void 0&&(Re=!0),N.forEach(function(Ee){Ee[x]&&Ee[x].apply(Ee,we)}),Re){var Le;(Le=v.props)[x].apply(Le,we)}}function H(){var x=v.props.aria;if(x.content){var we="aria-"+x.content,Re=R.id,Le=Gn(v.props.triggerTarget||n);Le.forEach(function(Ee){var ye=Ee.getAttribute(we);if(v.state.isVisible)Ee.setAttribute(we,ye?ye+" "+Re:Re);else{var be=ye&&ye.replace(Re,"").trim();be?Ee.setAttribute(we,be):Ee.removeAttribute(we)}})}}function z(){if(!(D||!v.props.aria.expanded)){var x=Gn(v.props.triggerTarget||n);x.forEach(function(we){v.props.interactive?we.setAttribute("aria-expanded",v.state.isVisible&&we===E()?"true":"false"):we.removeAttribute("aria-expanded")})}}function P(){te().removeEventListener("mousemove",g),yl=yl.filter(function(x){return x!==g})}function U(x){if(!(kn.isTouch&&(a||x.type==="mousedown"))){var we=x.composedPath&&x.composedPath()[0]||x.target;if(!(v.props.interactive&&Ho(R,we))){if(Gn(v.props.triggerTarget||n).some(function(Re){return Ho(Re,we)})){if(kn.isTouch||v.state.isVisible&&v.props.trigger.indexOf("click")>=0)return}else F("onClickOutside",[v,x]);v.props.hideOnClick===!0&&(v.clearDelayTimeouts(),v.hide(),u=!0,setTimeout(function(){u=!1}),v.state.isMounted||ae())}}}function K(){a=!0}function Y(){a=!1}function re(){var x=te();x.addEventListener("mousedown",U,!0),x.addEventListener("touchend",U,Un),x.addEventListener("touchstart",Y,Un),x.addEventListener("touchmove",K,Un)}function ae(){var x=te();x.removeEventListener("mousedown",U,!0),x.removeEventListener("touchend",U,Un),x.removeEventListener("touchstart",Y,Un),x.removeEventListener("touchmove",K,Un)}function ne(x,we){ue(x,function(){!v.state.isVisible&&R.parentNode&&R.parentNode.contains(R)&&we()})}function Q(x,we){ue(x,we)}function ue(x,we){var Re=M().box;function Le(Ee){Ee.target===Re&&(zl(Re,"remove",Le),we())}if(x===0)return we();zl(Re,"remove",m),zl(Re,"add",Le),m=Le}function se(x,we,Re){Re===void 0&&(Re=!1);var Le=Gn(v.props.triggerTarget||n);Le.forEach(function(Ee){Ee.addEventListener(x,we,Re),h.push({node:Ee,eventType:x,handler:we,options:Re})})}function j(){V()&&(se("touchstart",le,{passive:!0}),se("touchend",_e,{passive:!0})),Ic(v.props.trigger).forEach(function(x){if(x!=="manual")switch(se(x,le),x){case"mouseenter":se("mouseleave",_e);break;case"focus":se(Vc?"focusout":"blur",ce);break;case"focusin":se("focusout",ce);break}})}function W(){h.forEach(function(x){var we=x.node,Re=x.eventType,Le=x.handler,Ee=x.options;we.removeEventListener(Re,Le,Ee)}),h=[]}function le(x){var we,Re=!1;if(!(!v.state.isEnabled||fe(x)||u)){var Le=((we=d)==null?void 0:we.type)==="focus";d=x,w=x.currentTarget,z(),!v.state.isVisible&&Uc(x)&&yl.forEach(function(Ee){return Ee(x)}),x.type==="click"&&(v.props.trigger.indexOf("mouseenter")<0||r)&&v.props.hideOnClick!==!1&&v.state.isVisible?Re=!0:Me(x),x.type==="click"&&(r=!Re),Re&&!Le&&Pe(x)}}function ie(x){var we=x.target,Re=E().contains(we)||R.contains(we);if(!(x.type==="mousemove"&&Re)){var Le=qe().concat(R).map(function(Ee){var ye,be=Ee._tippy,De=(ye=be.popperInstance)==null?void 0:ye.state;return De?{popperRect:Ee.getBoundingClientRect(),popperState:De,props:t}:null}).filter(Boolean);Kc(Le,x)&&(P(),Pe(x))}}function _e(x){var we=fe(x)||v.props.trigger.indexOf("click")>=0&&r;if(!we){if(v.props.interactive){v.hideWithInteractivity(x);return}Pe(x)}}function ce(x){v.props.trigger.indexOf("focusin")<0&&x.target!==E()||v.props.interactive&&x.relatedTarget&&R.contains(x.relatedTarget)||Pe(x)}function fe(x){return kn.isTouch?V()!==x.type.indexOf("touch")>=0:!1}function de(){ze();var x=v.props,we=x.popperOptions,Re=x.placement,Le=x.offset,Ee=x.getReferenceClientRect,ye=x.moveTransition,be=O()?Jl(R).arrow:null,De=Ee?{getBoundingClientRect:Ee,contextElement:Ee.contextElement||E()}:n,Tt={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(_t){var ot=_t.state;if(O()){var Ut=M(),Vt=Ut.box;["placement","reference-hidden","escaped"].forEach(function(kt){kt==="placement"?Vt.setAttribute("data-placement",ot.placement):ot.attributes.popper["data-popper-"+kt]?Vt.setAttribute("data-"+kt,""):Vt.removeAttribute("data-"+kt)}),ot.attributes.popper={}}}},St=[{name:"offset",options:{offset:Le}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!ye}},Tt];O()&&be&&St.push({name:"arrow",options:{element:be,padding:3}}),St.push.apply(St,(we==null?void 0:we.modifiers)||[]),v.popperInstance=Lc(De,R,Object.assign({},we,{placement:Re,onFirstUpdate:_,modifiers:St}))}function ze(){v.popperInstance&&(v.popperInstance.destroy(),v.popperInstance=null)}function Xe(){var x=v.props.appendTo,we,Re=E();v.props.interactive&&x===Di||x==="parent"?we=Re.parentNode:we=Ni(x,[Re]),we.contains(R)||we.appendChild(R),v.state.isMounted=!0,de()}function qe(){return El(R.querySelectorAll("[data-tippy-root]"))}function Me(x){v.clearDelayTimeouts(),x&&F("onTrigger",[v,x]),re();var we=X(!0),Re=B(),Le=Re[0],Ee=Re[1];kn.isTouch&&Le==="hold"&&Ee&&(we=Ee),we?l=setTimeout(function(){v.show()},we):v.show()}function Pe(x){if(v.clearDelayTimeouts(),F("onUntrigger",[v,x]),!v.state.isVisible){ae();return}if(!(v.props.trigger.indexOf("mouseenter")>=0&&v.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(x.type)>=0&&r)){var we=X(!1);we?o=setTimeout(function(){v.state.isVisible&&v.hide()},we):s=requestAnimationFrame(function(){v.hide()})}}function he(){v.state.isEnabled=!0}function Ue(){v.hide(),v.state.isEnabled=!1}function xe(){clearTimeout(l),clearTimeout(o),cancelAnimationFrame(s)}function Ve(x){if(!v.state.isDestroyed){F("onBeforeUpdate",[v,x]),W();var we=v.props,Re=zo(n,Object.assign({},we,jo(x),{ignoreAttributes:!0}));v.props=Re,j(),we.interactiveDebounce!==Re.interactiveDebounce&&(P(),g=Mo(ie,Re.interactiveDebounce)),we.triggerTarget&&!Re.triggerTarget?Gn(we.triggerTarget).forEach(function(Le){Le.removeAttribute("aria-expanded")}):Re.triggerTarget&&n.removeAttribute("aria-expanded"),z(),J(),A&&A(we,Re),v.popperInstance&&(de(),qe().forEach(function(Le){requestAnimationFrame(Le._tippy.popperInstance.forceUpdate)})),F("onAfterUpdate",[v,x])}}function We(x){v.setProps({content:x})}function Ke(){var x=v.state.isVisible,we=v.state.isDestroyed,Re=!v.state.isEnabled,Le=kn.isTouch&&!v.props.touch,Ee=Hl(v.props.duration,0,mn.duration);if(!(x||we||Re||Le)&&!E().hasAttribute("disabled")&&(F("onShow",[v],!1),v.props.onShow(v)!==!1)){if(v.state.isVisible=!0,O()&&(R.style.visibility="visible"),J(),re(),v.state.isMounted||(R.style.transition="none"),O()){var ye=M(),be=ye.box,De=ye.content;Fl([be,De],0)}_=function(){var St;if(!(!v.state.isVisible||p)){if(p=!0,R.offsetHeight,R.style.transition=v.props.moveTransition,O()&&v.props.animation){var gt=M(),_t=gt.box,ot=gt.content;Fl([_t,ot],Ee),Uo([_t,ot],"visible")}H(),z(),Po(Kl,v),(St=v.popperInstance)==null||St.forceUpdate(),F("onMount",[v]),v.props.animation&&O()&&Q(Ee,function(){v.state.isShown=!0,F("onShown",[v])})}},Xe()}}function Ye(){var x=!v.state.isVisible,we=v.state.isDestroyed,Re=!v.state.isEnabled,Le=Hl(v.props.duration,1,mn.duration);if(!(x||we||Re)&&(F("onHide",[v],!1),v.props.onHide(v)!==!1)){if(v.state.isVisible=!1,v.state.isShown=!1,p=!1,r=!1,O()&&(R.style.visibility="hidden"),P(),ae(),J(!0),O()){var Ee=M(),ye=Ee.box,be=Ee.content;v.props.animation&&(Fl([ye,be],Le),Uo([ye,be],"hidden"))}H(),z(),v.props.animation?O()&&ne(Le,v.unmount):v.unmount()}}function ct(x){te().addEventListener("mousemove",g),Po(yl,g),g(x)}function ht(){v.state.isVisible&&v.hide(),v.state.isMounted&&(ze(),qe().forEach(function(x){x._tippy.unmount()}),R.parentNode&&R.parentNode.removeChild(R),Kl=Kl.filter(function(x){return x!==v}),v.state.isMounted=!1,F("onHidden",[v]))}function tt(){v.state.isDestroyed||(v.clearDelayTimeouts(),v.unmount(),W(),delete n._tippy,v.state.isDestroyed=!0,F("onDestroy",[v]))}}function ml(n,e){e===void 0&&(e={});var t=mn.plugins.concat(e.plugins||[]);Gc();var l=Object.assign({},e,{plugins:t}),o=Fc(n),s=o.reduce(function(r,u){var a=u&&tu(u,l);return a&&r.push(a),r},[]);return Nl(n)?s[0]:s}ml.defaultProps=mn;ml.setDefaultProps=Xc;ml.currentInput=kn;Object.assign({},wi,{effect:function(e){var t=e.state,l={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(t.elements.popper.style,l.popper),t.styles=l,t.elements.arrow&&Object.assign(t.elements.arrow.style,l.arrow)}});ml.setDefaultProps({render:Pi});aa.create({name:"terraphimSuggestion",addOptions(){return{trigger:"++",pluginKey:new _i("terraphimSuggestion"),allowSpaces:!1,limit:8,minLength:1,debounce:300}},addCommands(){return{insertSuggestion:n=>({commands:e,chain:t})=>t().insertContent(n.text).run()}},addProseMirrorPlugins(){const n={editor:this.editor,char:this.options.trigger,pluginKey:this.options.pluginKey,allowSpaces:this.options.allowSpaces,startOfLine:!1,command:({editor:e,range:t,props:l})=>{const o=l;e.chain().focus().insertContentAt(t,`${o.text} `).run()},items:async({query:e,editor:t})=>new Promise(l=>{setTimeout(async()=>{if(e.length<this.options.minLength){l([]);return}try{const o=await Ln.getSuggestionsWithSnippets(e,this.options.limit);l(o)}catch{l([])}},this.options.debounce)}),render:()=>{let e,t;return{onStart:l=>{e=new nu({items:l.items,command:l.command}),l.clientRect&&(t=ml("body",{getReferenceClientRect:l.clientRect,appendTo:()=>document.body,content:e.element,showOnCreate:!0,interactive:!0,trigger:"manual",placement:"bottom-start",theme:"terraphim-suggestion",maxWidth:"none"})[0])},onUpdate(l){e==null||e.updateItems(l.items),l.clientRect&&(t==null||t.setProps({getReferenceClientRect:l.clientRect}))},onKeyDown(l){return l.event.key==="Escape"?(t==null||t.hide(),!0):(e==null?void 0:e.onKeyDown(l))??!1},onExit(){t==null||t.destroy(),e==null||e.destroy()}}}};return[Sa(n)]}});class nu{constructor(e){nn(this,"element");nn(this,"items",[]);nn(this,"selectedIndex",0);nn(this,"command");this.items=e.items,this.command=e.command,this.element=document.createElement("div"),this.element.className="terraphim-suggestion-dropdown",this.render()}updateItems(e){this.items=e,this.selectedIndex=0,this.render()}onKeyDown({event:e}){return e.key==="ArrowUp"?(this.selectPrevious(),!0):e.key==="ArrowDown"?(this.selectNext(),!0):e.key==="Enter"||e.key==="Tab"?(this.selectItem(this.selectedIndex),!0):!1}selectPrevious(){this.selectedIndex=Math.max(0,this.selectedIndex-1),this.render()}selectNext(){this.selectedIndex=Math.min(this.items.length-1,this.selectedIndex+1),this.render()}selectItem(e){const t=this.items[e];t&&this.command({id:t.text,...t})}render(){if(this.element.innerHTML="",this.items.length===0){this.element.innerHTML=`
        <div class="terraphim-suggestion-item terraphim-suggestion-empty">
          <div class="terraphim-suggestion-text">No suggestions found</div>
          <div class="terraphim-suggestion-hint">Try a different search term</div>
        </div>
      `;return}const e=document.createElement("div");e.className="terraphim-suggestion-header",e.innerHTML=`
      <div class="terraphim-suggestion-count">${this.items.length} suggestions</div>
      <div class="terraphim-suggestion-hint">↑↓ Navigate • Tab/Enter Select • Esc Cancel</div>
    `,this.element.appendChild(e),this.items.forEach((t,l)=>{const o=document.createElement("div");o.className=`terraphim-suggestion-item ${l===this.selectedIndex?"terraphim-suggestion-selected":""}`,o.innerHTML=`
        <div class="terraphim-suggestion-main">
          <div class="terraphim-suggestion-text">${this.escapeHtml(t.text)}</div>
          ${t.snippet?`<div class="terraphim-suggestion-snippet">${this.escapeHtml(t.snippet)}</div>`:""}
        </div>
        ${t.score?`<div class="terraphim-suggestion-score">${Math.round(t.score*100)}%</div>`:""}
      `,o.addEventListener("click",()=>this.selectItem(l)),o.addEventListener("mouseenter",()=>{this.selectedIndex=l,this.render()}),this.element.appendChild(o)})}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}destroy(){this.element.remove()}}const lu=`
.terraphim-suggestion-dropdown {
  background: white;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  box-shadow: 0 10px 38px -10px rgba(22, 23, 24, 0.35), 0 10px 20px -15px rgba(22, 23, 24, 0.2);
  max-height: 300px;
  min-width: 300px;
  overflow-y: auto;
  z-index: 1000;
}

.terraphim-suggestion-header {
  padding: 8px 12px;
  border-bottom: 1px solid #f1f5f9;
  background: #f8fafc;
  font-size: 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.terraphim-suggestion-count {
  font-weight: 600;
  color: #475569;
}

.terraphim-suggestion-hint {
  color: #64748b;
}

.terraphim-suggestion-item {
  padding: 8px 12px;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  border-bottom: 1px solid #f1f5f9;
}

.terraphim-suggestion-item:hover {
  background: #f8fafc;
}

.terraphim-suggestion-selected {
  background: #eff6ff !important;
  border-left: 3px solid #3b82f6;
}

.terraphim-suggestion-empty {
  color: #64748b;
  font-style: italic;
  text-align: center;
  cursor: default;
}

.terraphim-suggestion-main {
  flex: 1;
}

.terraphim-suggestion-text {
  font-weight: 500;
  color: #1e293b;
  margin-bottom: 2px;
}

.terraphim-suggestion-snippet {
  font-size: 12px;
  color: #64748b;
  line-height: 1.3;
}

.terraphim-suggestion-score {
  font-size: 11px;
  color: #10b981;
  font-weight: 600;
  background: #ecfdf5;
  padding: 2px 6px;
  border-radius: 4px;
  margin-left: 8px;
}

/* Dark theme support */
@media (prefers-color-scheme: dark) {
  .terraphim-suggestion-dropdown {
    background: #1e293b;
    border-color: #334155;
  }

  .terraphim-suggestion-header {
    background: #0f172a;
    border-color: #334155;
  }

  .terraphim-suggestion-item:hover {
    background: #334155;
  }

  .terraphim-suggestion-selected {
    background: #1e40af !important;
  }

  .terraphim-suggestion-text {
    color: #f1f5f9;
  }

  .terraphim-suggestion-snippet {
    color: #94a3b8;
  }
}

/* Tippy.js theme */
.tippy-box[data-theme~='terraphim-suggestion'] {
  background: transparent;
  box-shadow: none;
}

.tippy-box[data-theme~='terraphim-suggestion'] > .tippy-backdrop {
  background: transparent;
}

.tippy-box[data-theme~='terraphim-suggestion'] > .tippy-arrow {
  display: none;
}
`;function ou(n){let e,t,l,o,s,r,u,a,p,d,m,_,h,g,w,C,y,T,k,v,L,R,A,N,D,B=n[11]?"Tauri (native)":`MCP Server (${Ln.getStatus().baseUrl})`,V,O,E,te,M,X,J,F,H,z,P,U,K,Y,re,ae,ne,Q,ue,se,j=n[6]!==1?"s":"",W,le,ie,_e,ce,fe,de,ze,Xe,qe,Me,Pe,he,Ue,xe,Ve,We,Ke,Ye=n[3]?"Enabled":"Disabled",ct,ht,tt,x,we=n[10]&&!n[8]&&Wo(n);function Re(ye,be){if(ye[8])return au;if(ye[10])return iu}let Le=Re(n),Ee=Le&&Le(n);return{c(){e=f("div"),t=f("div"),l=f("strong"),l.textContent="Local Autocomplete Status:",o=b(),s=f("div"),r=f("button"),u=I("Test"),p=b(),d=f("button"),d.textContent="Rebuild Index",m=b(),_=f("button"),h=I("Demo"),w=b(),C=f("div"),C.textContent=`${autocompleteStatus}`,y=b(),we&&we.c(),T=b(),k=f("div"),v=f("strong"),v.textContent="Configuration:",L=b(),R=f("br"),A=I("• "),N=f("strong"),N.textContent="Backend:",D=b(),V=I(B),O=b(),E=f("br"),te=I("• "),M=f("strong"),M.textContent="Role:",X=b(),J=I(n[9]),F=b(),H=f("br"),z=I("• "),P=f("strong"),P.textContent="Trigger:",U=I(' "'),K=I(n[4]),Y=I(`" + text
      `),re=f("br"),ae=I("• "),ne=f("strong"),ne.textContent="Min Length:",Q=b(),ue=I(n[6]),se=I(" character"),W=I(j),le=b(),ie=f("br"),_e=I("• "),ce=f("strong"),ce.textContent="Max Results:",fe=b(),de=I(n[5]),ze=b(),Xe=f("br"),qe=I("• "),Me=f("strong"),Me.textContent="Debounce:",Pe=b(),he=I(n[7]),Ue=I(`ms
      `),xe=f("br"),Ve=I("• "),We=f("strong"),We.textContent="Snippets:",Ke=b(),ct=I(Ye),ht=b(),Ee&&Ee.c(),Ie(l,"color","#495057"),Ie(r,"padding","4px 8px"),Ie(r,"background","#007bff"),Ie(r,"color","white"),Ie(r,"border","none"),Ie(r,"border-radius","4px"),Ie(r,"cursor","pointer"),Ie(r,"font-size","12px"),r.disabled=a=!n[8],Ie(d,"padding","4px 8px"),Ie(d,"background","#28a745"),Ie(d,"color","white"),Ie(d,"border","none"),Ie(d,"border-radius","4px"),Ie(d,"cursor","pointer"),Ie(d,"font-size","12px"),Ie(_,"padding","4px 8px"),Ie(_,"background","#ffc107"),Ie(_,"color","#212529"),Ie(_,"border","none"),Ie(_,"border-radius","4px"),Ie(_,"cursor","pointer"),Ie(_,"font-size","12px"),_.disabled=g=!n[8],Ie(s,"display","flex"),Ie(s,"gap","8px"),Ie(t,"display","flex"),Ie(t,"justify-content","space-between"),Ie(t,"align-items","center"),Ie(t,"margin-bottom","8px"),Ie(C,"font-size","13px"),Ie(C,"color","#6c757d"),Ie(C,"margin-bottom","8px"),Ie(C,"font-family","monospace"),Ie(k,"font-size","12px"),Ie(k,"color","#6c757d"),Ie(e,"margin-top","10px"),Ie(e,"padding","12px"),Ie(e,"background","#f8f9fa"),Ie(e,"border-radius","6px"),Ie(e,"border","1px solid #e9ecef")},m(ye,be){S(ye,e,be),i(e,t),i(t,l),i(t,o),i(t,s),i(s,r),i(r,u),i(s,p),i(s,d),i(s,m),i(s,_),i(_,h),i(e,w),i(e,C),i(e,y),we&&we.m(e,null),i(e,T),i(e,k),i(k,v),i(k,L),i(k,R),i(k,A),i(k,N),i(k,D),i(k,V),i(k,O),i(k,E),i(k,te),i(k,M),i(k,X),i(k,J),i(k,F),i(k,H),i(k,z),i(k,P),i(k,U),i(k,K),i(k,Y),i(k,re),i(k,ae),i(k,ne),i(k,Q),i(k,ue),i(k,se),i(k,W),i(k,le),i(k,ie),i(k,_e),i(k,ce),i(k,fe),i(k,de),i(k,ze),i(k,Xe),i(k,qe),i(k,Me),i(k,Pe),i(k,he),i(k,Ue),i(k,xe),i(k,Ve),i(k,We),i(k,Ke),i(k,ct),i(e,ht),Ee&&Ee.m(e,null),tt||(x=[ee(r,"click",testAutocomplete),ee(d,"click",rebuildIndex),ee(_,"click",demonstrateAutocomplete)],tt=!0)},p(ye,be){be&256&&a!==(a=!ye[8])&&(r.disabled=a),be&256&&g!==(g=!ye[8])&&(_.disabled=g),ye[10]&&!ye[8]?we?we.p(ye,be):(we=Wo(ye),we.c(),we.m(e,T)):we&&(we.d(1),we=null),be&2048&&B!==(B=ye[11]?"Tauri (native)":`MCP Server (${Ln.getStatus().baseUrl})`)&&ve(V,B),be&512&&ve(J,ye[9]),Le===(Le=Re(ye))&&Ee?Ee.p(ye,be):(Ee&&Ee.d(1),Ee=Le&&Le(ye),Ee&&(Ee.c(),Ee.m(e,null)))},d(ye){ye&&$(e),we&&we.d(),Ee&&Ee.d(),tt=!1,ft(x)}}}function Wo(n){let e,t,l,o;function s(a,p){return a[11]?ru:su}let r=s(n),u=r(n);return{c(){e=f("div"),t=f("strong"),t.textContent="⚠️ Autocomplete Not Available",l=f("br"),o=b(),u.c(),Ie(e,"font-size","12px"),Ie(e,"color","#dc3545"),Ie(e,"margin-bottom","8px"),Ie(e,"padding","6px"),Ie(e,"background","#f8d7da"),Ie(e,"border-radius","4px")},m(a,p){S(a,e,p),i(e,t),i(e,l),i(e,o),u.m(e,null)},p(a,p){r!==(r=s(a))&&(u.d(1),u=r(a),u&&(u.c(),u.m(e,null)))},d(a){a&&$(e),u.d()}}}function su(n){let e,t=Ln.getStatus().baseUrl+"",l;return{c(){e=I("MCP server not responding. Ensure the server is running on "),l=I(t)},m(o,s){S(o,e,s),S(o,l,s)},d(o){o&&($(e),$(l))}}}function ru(n){let e;return{c(){e=I("Tauri backend connection failed. Ensure the application has proper permissions.")},m(t,l){S(t,e,l)},d(t){t&&$(e)}}}function iu(n){let e;return{c(){e=f("div"),e.innerHTML='<strong>❌ Autocomplete Unavailable</strong> <div style="font-size: 11px; margin-top: 4px; color: #721c24;">Click &quot;Rebuild Index&quot; to retry or check server/backend status.</div>',Ie(e,"margin-top","8px"),Ie(e,"padding","8px"),Ie(e,"background","#f8d7da"),Ie(e,"border","1px solid #f5c6cb"),Ie(e,"border-radius","4px")},m(t,l){S(t,e,l)},p:Fe,d(t){t&&$(e)}}}function au(n){let e,t,l,o,s,r,u,a,p,d,m,_;return{c(){e=f("div"),t=f("strong"),t.textContent="🎯 Autocomplete Active",l=b(),o=f("div"),s=I("Type "),r=f("code"),r.textContent=`${n[4]}`,u=I(" in the editor above to trigger suggestions."),a=f("br"),p=I(`
          Example: `),d=f("code"),d.textContent=`${n[4]}terraphim`,m=I(" or "),_=f("code"),_.textContent=`${n[4]}graph`,Ie(o,"font-size","11px"),Ie(o,"margin-top","4px"),Ie(o,"color","#0056b3"),Ie(e,"margin-top","8px"),Ie(e,"padding","8px"),Ie(e,"background","#d1edff"),Ie(e,"border","1px solid #b3d9ff"),Ie(e,"border-radius","4px")},m(h,g){S(h,e,g),i(e,t),i(e,l),i(e,o),i(o,s),i(o,r),i(o,u),i(o,a),i(o,p),i(o,d),i(o,m),i(o,_)},p:Fe,d(h){h&&$(e)}}}function cu(n){let e,t,l,o;e=new NovelEditor({props:{defaultValue:n[0],isEditable:!n[1],disableLocalStorage:!0,onUpdate:handleUpdate,extensions:[Markdown,...n[2]?[TerraphimSuggestion.configure({trigger:n[4],allowSpaces:!1,limit:n[5],minLength:n[6],debounce:n[7]})]:[]]}});let s=n[2]&&ou(n);return{c(){$e(e.$$.fragment),t=b(),s&&s.c(),l=Nt()},m(r,u){Te(e,r,u),S(r,t,u),s&&s.m(r,u),S(r,l,u),o=!0},p(r,[u]){const a={};u&1&&(a.defaultValue=r[0]),e.$set(a),r[2]&&s.p(r,u)},i(r){o||(q(e.$$.fragment,r),o=!0)},o(r){Z(e.$$.fragment,r),o=!1},d(r){r&&($(t),$(l)),Ce(e,r),s&&s.d(r)}}}function uu(n,e,t){let l,o;lt(n,role,k=>t(9,l=k)),lt(n,is_tauri,k=>t(11,o=k));let{html:s=""}=e;const r=!1,u="html",a=!0,p=!0,d="++",m=8,_=1,h=300;let g="⏳ Initializing...",w=!1,C=!1,y=null;Dn(async()=>{await T(),typeof document<"u"&&(y=document.createElement("style"),y.textContent=lu,document.head.appendChild(y))}),Xl(()=>{y!=null&&y.parentNode&&y.parentNode.removeChild(y)});async function T(){g="⏳ Initializing autocomplete...",t(8,w=!1),t(10,C=!1);try{Ln.setRole(l),g="🔗 Testing connection...";const k=await Ln.testConnection();t(10,C=!0),k?(g="🔨 Building autocomplete index...",await Ln.buildAutocompleteIndex()?(o?g="✅ Ready - Using Tauri backend":g="✅ Ready - Using MCP server backend",t(8,w=!0)):g="❌ Failed to build autocomplete index"):o?g="❌ Tauri backend not available":g="❌ MCP server not responding"}catch(k){console.error("Error initializing autocomplete:",k),g="❌ Autocomplete initialization error"}}return n.$$set=k=>{"html"in k&&t(0,s=k.html)},n.$$.update=()=>{n.$$.dirty&768&&l&&a&&w&&(Ln.setRole(l),T())},[s,r,a,p,d,m,_,h,w,l,C,o,u]}class fu extends Ht{constructor(e){super(),Ft(this,e,uu,cu,jt,{html:0,readOnly:1,outputFormat:12,enableAutocomplete:2,showSnippets:3,suggestionTrigger:4,maxSuggestions:5,minQueryLength:6,debounceDelay:7})}get readOnly(){return this.$$.ctx[1]}get outputFormat(){return this.$$.ctx[12]}get enableAutocomplete(){return this.$$.ctx[2]}get showSnippets(){return this.$$.ctx[3]}get suggestionTrigger(){return this.$$.ctx[4]}get maxSuggestions(){return this.$$.ctx[5]}get minQueryLength(){return this.$$.ctx[6]}get debounceDelay(){return this.$$.ctx[7]}}function Go(n){let e,t,l,o,s,r,u,a,p,d,m;return{c(){e=f("div"),t=f("h3"),l=f("span"),l.textContent="Knowledge Graph",o=I(`
          Term: `),s=f("strong"),r=I(n[2]),u=I(" | Rank: "),a=f("strong"),p=I(n[3]),d=b(),m=f("hr"),c(l,"class","tag is-info svelte-329px1"),c(t,"class","subtitle is-6 svelte-329px1"),c(m,"class","svelte-329px1"),c(e,"class","kg-context svelte-329px1")},m(_,h){S(_,e,h),i(e,t),i(t,l),i(t,o),i(t,s),i(s,r),i(t,u),i(t,a),i(a,p),i(e,d),i(e,m)},p(_,h){h&4&&ve(r,_[2]),h&8&&ve(p,_[3])},d(_){_&&$(e)}}}function du(n){let e,t,l,o,s,r,u,a;const p=[_u,mu],d=[];function m(_,h){return _[5]?0:1}return t=m(n),l=d[t]=p[t](n),{c(){e=f("div"),l.c(),o=b(),s=f("div"),s.innerHTML='<span class="hint-text svelte-329px1">Double-click to edit • Ctrl+E to edit • Ctrl+S to save • Click KG links to explore</span>',c(s,"class","edit-hint svelte-329px1"),c(e,"class","content-viewer svelte-329px1"),c(e,"tabindex","0"),c(e,"role","button"),c(e,"aria-label","Double-click to edit article content")},m(_,h){S(_,e,h),d[t].m(e,null),i(e,o),i(e,s),n[20](e),r=!0,u||(a=[ee(e,"dblclick",n[14]),ee(e,"keydown",n[15]),ee(e,"click",n[13])],u=!0)},p(_,h){let g=t;t=m(_),t===g?d[t].p(_,h):(rt(),Z(d[g],1,1,()=>{d[g]=null}),it(),l=d[t],l?l.p(_,h):(l=d[t]=p[t](_),l.c()),q(l,1),l.m(e,o))},i(_){r||(q(l),r=!0)},o(_){Z(l),r=!1},d(_){_&&$(e),d[t].d(),n[20](null),u=!1,ft(a)}}}function pu(n){let e,t,l,o,s,r,u,a,p,d;function m(h){n[18](h)}let _={outputFormat:n[11]};return n[1].body!==void 0&&(_.html=n[1].body),e=new fu({props:_}),yt.push(()=>Et(e,"html",m)),{c(){$e(e.$$.fragment),l=b(),o=f("div"),s=f("button"),s.textContent="Save",r=b(),u=f("button"),u.textContent="Cancel",c(s,"class","button is-primary"),c(u,"class","button is-light"),c(o,"class","edit-controls svelte-329px1")},m(h,g){Te(e,h,g),S(h,l,g),S(h,o,g),i(o,s),i(o,r),i(o,u),a=!0,p||(d=[ee(s,"click",n[12]),ee(u,"click",n[19])],p=!0)},p(h,g){const w={};g&2048&&(w.outputFormat=h[11]),!t&&g&2&&(t=!0,w.html=h[1].body,At(()=>t=!1)),e.$set(w)},i(h){a||(q(e.$$.fragment,h),a=!0)},o(h){Z(e.$$.fragment,h),a=!1},d(h){h&&($(l),$(o)),Ce(e,h),p=!1,ft(d)}}}function mu(n){let e,t,l;return t=new fl({props:{source:n[1].body}}),{c(){e=f("div"),$e(t.$$.fragment),c(e,"class","markdown-content svelte-329px1")},m(o,s){S(o,e,s),Te(t,e,null),l=!0},p(o,s){const r={};s&2&&(r.source=o[1].body),t.$set(r)},i(o){l||(q(t.$$.fragment,o),l=!0)},o(o){Z(t.$$.fragment,o),l=!1},d(o){o&&$(e),Ce(t)}}}function _u(n){let e,t=n[1].body+"";return{c(){e=f("div"),c(e,"class","prose svelte-329px1")},m(l,o){S(l,e,o),e.innerHTML=t},p(l,o){o&2&&t!==(t=l[1].body+"")&&(e.innerHTML=t)},i:Fe,o:Fe,d(l){l&&$(e)}}}function hu(n){let e,t,l,o,s,r=n[1].title+"",u,a,p,d,m,_,h,g=n[2]&&n[3]!==null&&Go(n);const w=[pu,du],C=[];function y(T,k){return T[4]?0:1}return p=y(n),d=C[p]=w[p](n),{c(){e=f("div"),t=f("button"),l=b(),g&&g.c(),o=b(),s=f("h2"),u=I(r),a=b(),d.c(),c(t,"class","delete is-large modal-close-btn svelte-329px1"),c(t,"aria-label","close"),c(s,"class","svelte-329px1"),c(e,"class","box wrapper svelte-329px1")},m(T,k){S(T,e,k),i(e,t),i(e,l),g&&g.m(e,null),i(e,o),i(e,s),i(s,u),i(e,a),C[p].m(e,null),m=!0,_||(h=ee(t,"click",n[17]),_=!0)},p(T,k){T[2]&&T[3]!==null?g?g.p(T,k):(g=Go(T),g.c(),g.m(e,o)):g&&(g.d(1),g=null),(!m||k&2)&&r!==(r=T[1].title+"")&&ve(u,r);let v=p;p=y(T),p===v?C[p].p(T,k):(rt(),Z(C[v],1,1,()=>{C[v]=null}),it(),d=C[p],d?d.p(T,k):(d=C[p]=w[p](T),d.c()),q(d,1),d.m(e,null))},i(T){m||(q(d),m=!0)},o(T){Z(d),m=!1},d(T){T&&$(e),g&&g.d(),C[p].d(),_=!1,h()}}}function qo(n){let e,t,l;function o(r){n[23](r)}let s={$$slots:{default:[bu]},$$scope:{ctx:n}};return n[7]!==void 0&&(s.active=n[7]),e=new Al({props:s}),yt.push(()=>Et(e,"active",o)),{c(){$e(e.$$.fragment)},m(r,u){Te(e,r,u),l=!0},p(r,u){const a={};u&536872832&&(a.$$scope={dirty:u,ctx:r}),!t&&u&128&&(t=!0,a.active=r[7],At(()=>t=!1)),e.$set(a)},i(r){l||(q(e.$$.fragment,r),l=!0)},o(r){Z(e.$$.fragment,r),l=!1},d(r){Ce(e,r)}}}function Vo(n){let e,t,l,o,s,r,u,a,p,d,m;return{c(){e=f("div"),t=f("h3"),l=f("span"),l.textContent="Knowledge Graph",o=I(`
            Term: `),s=f("strong"),r=I(n[9]),u=I(" | Rank: "),a=f("strong"),p=I(n[10]),d=b(),m=f("hr"),c(l,"class","tag is-info svelte-329px1"),c(t,"class","subtitle is-6 svelte-329px1"),c(m,"class","svelte-329px1"),c(e,"class","kg-context svelte-329px1")},m(_,h){S(_,e,h),i(e,t),i(t,l),i(t,o),i(t,s),i(s,r),i(t,u),i(t,a),i(a,p),i(e,d),i(e,m)},p(_,h){h&512&&ve(r,_[9]),h&1024&&ve(p,_[10])},d(_){_&&$(e)}}}function gu(n){let e,t,l;return t=new fl({props:{source:n[8].body}}),{c(){e=f("div"),$e(t.$$.fragment),c(e,"class","markdown-content svelte-329px1")},m(o,s){S(o,e,s),Te(t,e,null),l=!0},p(o,s){const r={};s&256&&(r.source=o[8].body),t.$set(r)},i(o){l||(q(t.$$.fragment,o),l=!0)},o(o){Z(t.$$.fragment,o),l=!1},d(o){o&&$(e),Ce(t)}}}function vu(n){let e,t=n[8].body+"";return{c(){e=f("div"),c(e,"class","prose svelte-329px1")},m(l,o){S(l,e,o),e.innerHTML=t},p(l,o){o&256&&t!==(t=l[8].body+"")&&(e.innerHTML=t)},i:Fe,o:Fe,d(l){l&&$(e)}}}function bu(n){let e,t,l,o,s,r=n[8].title+"",u,a,p,d,m,_,h,g,w,C,y,T=n[9]&&n[10]!==null&&Vo(n);const k=[vu,gu],v=[];function L(R,A){return A&256&&(d=null),d==null&&(d=!!(R[8].body&&(/<html/i.test(R[8].body)||/<body/i.test(R[8].body)||/<head/i.test(R[8].body)))),d?0:1}return m=L(n,-1),_=v[m]=k[m](n),{c(){e=f("div"),t=f("button"),l=b(),T&&T.c(),o=b(),s=f("h2"),u=I(r),a=b(),p=f("div"),_.c(),h=b(),g=f("div"),g.innerHTML='<span class="hint-text svelte-329px1">Knowledge Graph document • Click KG links to explore further</span>',c(t,"class","delete is-large modal-close-btn svelte-329px1"),c(t,"aria-label","close"),c(s,"class","svelte-329px1"),c(g,"class","edit-hint svelte-329px1"),c(p,"class","content-viewer svelte-329px1"),c(p,"tabindex","0"),c(p,"role","button"),c(p,"aria-label","KG document content - click KG links to explore further"),c(e,"class","box wrapper svelte-329px1")},m(R,A){S(R,e,A),i(e,t),i(e,l),T&&T.m(e,null),i(e,o),i(e,s),i(s,u),i(e,a),i(e,p),v[m].m(p,null),i(p,h),i(p,g),w=!0,C||(y=[ee(t,"click",n[22]),ee(p,"click",n[13])],C=!0)},p(R,A){R[9]&&R[10]!==null?T?T.p(R,A):(T=Vo(R),T.c(),T.m(e,o)):T&&(T.d(1),T=null),(!w||A&256)&&r!==(r=R[8].title+"")&&ve(u,r);let N=m;m=L(R,A),m===N?v[m].p(R,A):(rt(),Z(v[N],1,1,()=>{v[N]=null}),it(),_=v[m],_?_.p(R,A):(_=v[m]=k[m](R),_.c()),q(_,1),_.m(p,h))},i(R){w||(q(_),w=!0)},o(R){Z(_),w=!1},d(R){R&&$(e),T&&T.d(),v[m].d(),C=!1,ft(y)}}}function ku(n){let e,t,l,o,s;function r(p){n[21](p)}let u={$$slots:{default:[hu]},$$scope:{ctx:n}};n[0]!==void 0&&(u.active=n[0]),e=new Al({props:u}),yt.push(()=>Et(e,"active",r));let a=n[8]&&qo(n);return{c(){$e(e.$$.fragment),l=b(),a&&a.c(),o=Nt()},m(p,d){Te(e,p,d),S(p,l,d),a&&a.m(p,d),S(p,o,d),s=!0},p(p,[d]){const m={};d&536873087&&(m.$$scope={dirty:d,ctx:p}),!t&&d&1&&(t=!0,m.active=p[0],At(()=>t=!1)),e.$set(m),p[8]?a?(a.p(p,d),d&256&&q(a,1)):(a=qo(p),a.c(),q(a,1),a.m(o.parentNode,o)):a&&(rt(),Z(a,1,1,()=>{a=null}),it())},i(p){s||(q(e.$$.fragment,p),q(a),s=!0)},o(p){Z(e.$$.fragment,p),Z(a),s=!1},d(p){p&&($(l),$(o)),Ce(e,p),a&&a.d(p)}}}function wu(n,e,t){let l,o,s,r;lt(n,It,M=>t(25,s=M)),lt(n,Dt,M=>t(26,r=M));let{active:u=!1}=e,{item:a}=e,{initialEdit:p=!1}=e,{kgTerm:d=null}=e,{kgRank:m=null}=e,_=!1,h,g=!1,w=null,C=null,y=null;async function T(){if(s)try{const M=await Ze("get_document",{documentId:a.id});M!=null&&M.document&&t(1,a=M.document)}catch(M){console.error("Failed to load document",M)}}async function k(){if(!s){t(4,_=!1);return}try{await Ze("create_document",{document:a}),t(4,_=!1)}catch(M){console.error("Failed to save document",M)}}async function v(M){var X,J,F,H,z;t(9,C=M),console.log("🔍 KG Link Click Debug Info:"),console.log("  Term clicked:",M),console.log("  Current role:",r),console.log("  Is Tauri mode:",s);try{if(s){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:r,term:M});const P=await Ze("find_documents_for_kg_term",{roleName:r,term:M});console.log("  📥 Tauri response received:"),console.log("    Status:",P.status),console.log("    Results count:",((X=P.results)==null?void 0:X.length)||0),console.log("    Total:",P.total||0),console.log("    Full response:",JSON.stringify(P,null,2)),P.status==="success"&&P.results&&P.results.length>0?(t(8,w=P.results[0]),t(10,y=w.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",w.title),console.log("    Rank:",y),console.log("    Body length:",((J=w.body)==null?void 0:J.length)||0,"characters"),t(7,g=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${M}" in role: "${r}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const P=mt.ServerURL,U=encodeURIComponent(r),K=encodeURIComponent(M),Y=`${P}/roles/${U}/kg_search?term=${K}`;console.log("  📤 HTTP Request details:"),console.log("    Base URL:",P),console.log("    Role (encoded):",U),console.log("    Term (encoded):",K),console.log("    Full URL:",Y);const re=await fetch(Y);if(console.log("  📥 HTTP Response received:"),console.log("    Status code:",re.status),console.log("    Status text:",re.statusText),console.log("    Headers:",Object.fromEntries(re.headers.entries())),!re.ok)throw new Error(`HTTP error! Status: ${re.status} - ${re.statusText}`);const ae=await re.json();console.log("  📄 Response data:"),console.log("    Status:",ae.status),console.log("    Results count:",((F=ae.results)==null?void 0:F.length)||0),console.log("    Total:",ae.total||0),console.log("    Full response:",JSON.stringify(ae,null,2)),ae.status==="success"&&ae.results&&ae.results.length>0?(t(8,w=ae.results[0]),t(10,y=w.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",w.title),console.log("    Rank:",y),console.log("    Body length:",((H=w.body)==null?void 0:H.length)||0,"characters"),t(7,g=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${M}" in role: "${r}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",Y))}}catch(P){console.error("❌ Error fetching KG document:"),console.error("  Error type:",P.constructor.name),console.error("  Error message:",P.message||P),console.error("  Request details:",{term:M,role:r,isTauri:s,timestamp:new Date().toISOString()}),!s&&((z=P.message)!=null&&z.includes("Failed to fetch"))&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{}}function L(M){const X=M.target;if(X.tagName==="A"){const J=X.getAttribute("href");if(J&&J.startsWith("kg:")){M.preventDefault();const F=J.substring(3);v(F)}}}function R(){t(4,_=!0)}function A(M){M.type!=="dblclick"&&((M.ctrlKey||M.metaKey)&&M.key==="e"&&(M.preventDefault(),t(4,_=!0)),_&&(M.ctrlKey||M.metaKey)&&M.key==="s"&&(M.preventDefault(),k()),M.key==="Escape"&&(M.preventDefault(),_?t(4,_=!1):t(0,u=!1)))}const N=()=>t(0,u=!1);function D(M){n.$$.not_equal(a.body,M)&&(a.body=M,t(1,a))}const B=()=>t(4,_=!1);function V(M){yt[M?"unshift":"push"](()=>{h=M,t(6,h)})}function O(M){u=M,t(0,u)}const E=()=>t(7,g=!1);function te(M){g=M,t(7,g)}return n.$$set=M=>{"active"in M&&t(0,u=M.active),"item"in M&&t(1,a=M.item),"initialEdit"in M&&t(16,p=M.initialEdit),"kgTerm"in M&&t(2,d=M.kgTerm),"kgRank"in M&&t(3,m=M.kgRank)},n.$$.update=()=>{n.$$.dirty&65537&&u&&p&&t(4,_=!0),n.$$.dirty&19&&u&&a&&!_&&T(),n.$$.dirty&2&&t(5,l=a!=null&&a.body?/<html/i.test(a.body)||/<body/i.test(a.body)||/<head/i.test(a.body)||/^\s*<(!DOCTYPE|html|head|body|div|p|span)/i.test(a.body.trim()):!1),n.$$.dirty&32&&t(11,o=l?"html":"markdown")},[u,a,d,m,_,l,h,g,w,C,y,o,k,L,R,A,p,N,D,B,V,O,E,te]}class Il extends Ht{constructor(e){super(),Ft(this,e,wu,ku,jt,{active:0,item:1,initialEdit:16,kgTerm:2,kgRank:3})}}function Jo(n,e,t){const l=n.slice();return l[33]=e[t],l}function Qo(n,e,t){const l=n.slice();return l[36]=e[t],l}function Yo(n,e,t){const l=n.slice();return l[39]=e[t],l}function yu(n){let e,t;return e=new Message({props:{type:"is-success",$$slots:{default:[Cu]},$$scope:{ctx:n}}}),{c(){$e(e.$$.fragment)},m(l,o){Te(e,l,o),t=!0},i(l){t||(q(e.$$.fragment,l),t=!0)},o(l){Z(e.$$.fragment,l),t=!1},d(l){Ce(e,l)}}}function Cu(n){let e,t,l;return{c(){e=f("p"),e.innerHTML="<strong>Success!</strong> Article saved to atomic server successfully.",t=b(),l=f("p"),l.textContent="The modal will close automatically..."},m(o,s){S(o,e,s),S(o,t,s),S(o,l,s)},p:Fe,d(o){o&&($(e),$(t),$(l))}}}function Tu(n){let e,t;return e=new Message({props:{type:"is-danger",$$slots:{default:[$u]},$$scope:{ctx:n}}}),{c(){$e(e.$$.fragment)},m(l,o){Te(e,l,o),t=!0},p(l,o){const s={};o[1]&2048&&(s.$$scope={dirty:o,ctx:l}),e.$set(s)},i(l){t||(q(e.$$.fragment,l),t=!0)},o(l){Z(e.$$.fragment,l),t=!1},d(l){Ce(e,l)}}}function $u(n){let e,t,l,o;return{c(){e=f("p"),t=f("strong"),t.textContent="Error:",l=b(),o=I(error)},m(s,r){S(s,e,r),i(e,t),i(e,l),i(e,o)},p:Fe,d(s){s&&$(e)}}}function Su(n){var te,M,X,J;let e,t,l,o,s,r=(((te=n[1])==null?void 0:te.title)||"Untitled")+"",u,a,p,d,m,_,h=(((M=n[1])==null?void 0:M.rank)||0)+"",g,w,C,y,T,k,v,L,R,A,N=((X=n[1])==null?void 0:X.description)&&Xo(n),D=((J=n[1])==null?void 0:J.tags)&&Zo(n);function B(F,H){return F[8].length>0?Ru:Ou}let V=B(n),O=V(n),E=n[8].length>0&&ts(n);return{c(){e=f("div"),t=f("div"),t.textContent="Document to Save",l=b(),o=f("div"),s=f("h5"),u=I(r),a=b(),N&&N.c(),p=b(),d=f("div"),m=f("span"),_=I("Rank: "),g=I(h),w=b(),D&&D.c(),C=b(),y=f("div"),T=f("label"),T.textContent="Atomic Server",k=b(),v=f("div"),O.c(),L=b(),E&&E.c(),R=Nt(),c(t,"class","label"),c(s,"class","title is-6"),c(m,"class","tag is-info svelte-48g63o"),c(d,"class","tags svelte-48g63o"),c(o,"class","box document-preview svelte-48g63o"),c(e,"class","field"),c(T,"class","label"),c(T,"for","atomic-server-select"),c(v,"class","control"),c(y,"class","field")},m(F,H){S(F,e,H),i(e,t),i(e,l),i(e,o),i(o,s),i(s,u),i(o,a),N&&N.m(o,null),i(o,p),i(o,d),i(d,m),i(m,_),i(m,g),i(d,w),D&&D.m(d,null),S(F,C,H),S(F,y,H),i(y,T),i(y,k),i(y,v),O.m(v,null),S(F,L,H),E&&E.m(F,H),S(F,R,H),A=!0},p(F,H){var z,P,U,K;(!A||H[0]&2)&&r!==(r=(((z=F[1])==null?void 0:z.title)||"Untitled")+"")&&ve(u,r),(P=F[1])!=null&&P.description?N?N.p(F,H):(N=Xo(F),N.c(),N.m(o,p)):N&&(N.d(1),N=null),(!A||H[0]&2)&&h!==(h=(((U=F[1])==null?void 0:U.rank)||0)+"")&&ve(g,h),(K=F[1])!=null&&K.tags?D?D.p(F,H):(D=Zo(F),D.c(),D.m(d,null)):D&&(D.d(1),D=null),V===(V=B(F))&&O?O.p(F,H):(O.d(1),O=V(F),O&&(O.c(),O.m(v,null))),F[8].length>0?E?(E.p(F,H),H[0]&256&&q(E,1)):(E=ts(F),E.c(),q(E,1),E.m(R.parentNode,R)):E&&(rt(),Z(E,1,1,()=>{E=null}),it())},i(F){A||(q(E),A=!0)},o(F){Z(E),A=!1},d(F){F&&($(e),$(C),$(y),$(L),$(R)),N&&N.d(),D&&D.d(),O.d(),E&&E.d(F)}}}function Xo(n){let e,t=n[1].description+"",l;return{c(){e=f("p"),l=I(t),c(e,"class","content")},m(o,s){S(o,e,s),i(e,l)},p(o,s){s[0]&2&&t!==(t=o[1].description+"")&&ve(l,t)},d(o){o&&$(e)}}}function Zo(n){let e,t=Ge(n[1].tags),l=[];for(let o=0;o<t.length;o+=1)l[o]=xo(Yo(n,t,o));return{c(){for(let o=0;o<l.length;o+=1)l[o].c();e=Nt()},m(o,s){for(let r=0;r<l.length;r+=1)l[r]&&l[r].m(o,s);S(o,e,s)},p(o,s){if(s[0]&2){t=Ge(o[1].tags);let r;for(r=0;r<t.length;r+=1){const u=Yo(o,t,r);l[r]?l[r].p(u,s):(l[r]=xo(u),l[r].c(),l[r].m(e.parentNode,e))}for(;r<l.length;r+=1)l[r].d(1);l.length=t.length}},d(o){o&&$(e),Ct(l,o)}}}function xo(n){let e,t=n[39]+"",l;return{c(){e=f("span"),l=I(t),c(e,"class","tag svelte-48g63o")},m(o,s){S(o,e,s),i(e,l)},p(o,s){s[0]&2&&t!==(t=o[39]+"")&&ve(l,t)},d(o){o&&$(e)}}}function Ou(n){let e,t,l,o,s,r,u,a,p;return{c(){e=f("div"),t=f("p"),t.innerHTML="<strong>No atomic servers available</strong>",l=b(),o=f("p"),s=I('Your current role "'),r=I(n[10]),u=I(`" doesn't have any writable atomic server configurations.`),a=b(),p=f("p"),p.textContent="Please configure an atomic server haystack in your role settings.",c(e,"class","notification is-warning")},m(d,m){S(d,e,m),i(e,t),i(e,l),i(e,o),i(o,s),i(o,r),i(o,u),i(e,a),i(e,p)},p(d,m){m[0]&1024&&ve(r,d[10])},d(d){d&&$(e)}}}function Ru(n){let e,t,l,o,s,r,u=Ge(n[8]),a=[];for(let p=0;p<u.length;p+=1)a[p]=es(Qo(n,u,p));return{c(){e=f("div"),t=f("select");for(let p=0;p<a.length;p+=1)a[p].c();l=b(),o=f("p"),o.textContent=`Select the atomic server from your current role configuration.
              🔐 = Authenticated, ⚠️ = Anonymous access`,c(t,"id","atomic-server-select"),t.disabled=n[2],n[9]===void 0&&Pt(()=>n[13].call(t)),c(e,"class","select is-fullwidth"),c(o,"class","help svelte-48g63o")},m(p,d){S(p,e,d),i(e,t);for(let m=0;m<a.length;m+=1)a[m]&&a[m].m(t,null);pt(t,n[9],!0),S(p,l,d),S(p,o,d),s||(r=ee(t,"change",n[13]),s=!0)},p(p,d){if(d[0]&256){u=Ge(p[8]);let m;for(m=0;m<u.length;m+=1){const _=Qo(p,u,m);a[m]?a[m].p(_,d):(a[m]=es(_),a[m].c(),a[m].m(t,null))}for(;m<a.length;m+=1)a[m].d(1);a.length=u.length}d[0]&4&&(t.disabled=p[2]),d[0]&768&&pt(t,p[9])},d(p){p&&($(e),$(l),$(o)),Ct(a,p),s=!1,r()}}}function Eu(n){let e;return{c(){e=f("span"),e.textContent="⚠️ No Auth",c(e,"class","has-text-warning")},m(t,l){S(t,e,l)},d(t){t&&$(e)}}}function Au(n){let e;return{c(){e=f("span"),e.textContent="🔐",c(e,"class","has-text-success")},m(t,l){S(t,e,l)},d(t){t&&$(e)}}}function es(n){let e,t=n[36].location+"",l,o,s,r;function u(d,m){return d[36].atomic_server_secret?Au:Eu}let a=u(n),p=a(n);return{c(){e=f("option"),l=I(t),o=b(),p.c(),s=b(),e.__value=r=n[36].location,ke(e,e.__value)},m(d,m){S(d,e,m),i(e,l),i(e,o),p.m(e,null),i(e,s)},p(d,m){m[0]&256&&t!==(t=d[36].location+"")&&ve(l,t),a!==(a=u(d))&&(p.d(1),p=a(d),p&&(p.c(),p.m(e,s))),m[0]&256&&r!==(r=d[36].location)&&(e.__value=r,ke(e,e.__value))},d(d){d&&$(e),p.d()}}}function ts(n){var Ee,ye;let e,t,l,o,s,r,u,a,p,d,m,_,h,g,w,C,y,T,k,v,L,R,A,N,D,B,V,O,E,te,M,X,J,F,H,z,P,U,K,Y,re,ae,ne,Q=(n[6]||"Untitled")+"",ue,se,j,W,le,ie=(((ye=(Ee=n[1])==null?void 0:Ee.body)==null?void 0:ye.length)||0)+"",_e,ce,fe,de,ze,Xe,qe=n[11]()+"",Me,Pe,he,Ue,xe,Ve=n[12]()+"",We,Ke,Ye,ct,ht;function tt(be){n[14](be)}let x={id:"article-title",placeholder:"Enter article title",disabled:n[2],required:!0};n[6]!==void 0&&(x.value=n[6]),s=new Input({props:x}),yt.push(()=>Et(s,"value",tt));const we=[Du,Lu],Re=[];function Le(be,De){return be[5]?1:0}return B=Le(n),V=Re[B]=we[B](n),M=new Button({props:{type:"is-primary",loading:n[2],disabled:n[2]||!n[6].trim()||!n[9],$$slots:{default:[Nu]},$$scope:{ctx:n}}}),M.$on("click",saveToAtomic),F=new Button({props:{type:"is-light",disabled:n[2],$$slots:{default:[Iu]},$$scope:{ctx:n}}}),F.$on("click",handleClose),Ye=Xi(n[17][0]),{c(){e=f("div"),t=f("label"),t.textContent="Article Title",l=b(),o=f("div"),$e(s.$$.fragment),u=b(),a=f("div"),p=f("label"),p.textContent="Description",d=b(),m=f("div"),_=f("textarea"),h=b(),g=f("div"),w=f("div"),w.textContent="Parent Collection",C=b(),y=f("div"),T=f("label"),k=f("input"),v=I(`
              Use predefined collection`),L=b(),R=f("label"),A=f("input"),N=I(`
              Custom parent URL/path`),D=b(),V.c(),O=b(),E=f("div"),te=f("div"),$e(M.$$.fragment),X=b(),J=f("div"),$e(F.$$.fragment),H=b(),z=f("div"),P=f("div"),U=f("p"),U.innerHTML="<strong>What will be saved:</strong>",K=b(),Y=f("ul"),re=f("li"),ae=f("strong"),ae.textContent="Title:",ne=b(),ue=I(Q),se=b(),j=f("li"),W=f("strong"),W.textContent="Body:",le=I(" Original document content ("),_e=I(ie),ce=I(" characters)"),fe=b(),de=f("li"),ze=f("strong"),ze.textContent="Parent:",Xe=b(),Me=I(qe),Pe=b(),he=f("li"),Ue=f("strong"),Ue.textContent="Subject URL:",xe=b(),We=I(Ve),c(t,"class","label"),c(t,"for","article-title"),c(o,"class","control"),c(e,"class","field"),c(p,"class","label"),c(p,"for","article-description"),c(_,"id","article-description"),c(_,"class","textarea"),c(_,"placeholder","Brief description of the article"),_.disabled=n[2],c(_,"rows","3"),c(m,"class","control"),c(a,"class","field"),c(w,"class","label"),c(k,"type","radio"),k.__value=!1,ke(k,k.__value),k.disabled=n[2],c(T,"class","radio svelte-48g63o"),c(A,"type","radio"),A.__value=!0,ke(A,A.__value),A.disabled=n[2],c(R,"class","radio svelte-48g63o"),c(y,"class","control"),c(g,"class","field"),c(te,"class","control"),c(J,"class","control"),c(E,"class","field is-grouped"),c(re,"class","svelte-48g63o"),c(j,"class","svelte-48g63o"),c(de,"class","svelte-48g63o"),c(he,"class","svelte-48g63o"),c(Y,"class","svelte-48g63o"),c(P,"class","notification is-info is-light svelte-48g63o"),c(z,"class","field"),Ye.p(k,A)},m(be,De){S(be,e,De),i(e,t),i(e,l),i(e,o),Te(s,o,null),S(be,u,De),S(be,a,De),i(a,p),i(a,d),i(a,m),i(m,_),ke(_,n[7]),S(be,h,De),S(be,g,De),i(g,w),i(g,C),i(g,y),i(y,T),i(T,k),k.checked=k.__value===n[5],i(T,v),i(y,L),i(y,R),i(R,A),A.checked=A.__value===n[5],i(R,N),S(be,D,De),Re[B].m(be,De),S(be,O,De),S(be,E,De),i(E,te),Te(M,te,null),i(E,X),i(E,J),Te(F,J,null),S(be,H,De),S(be,z,De),i(z,P),i(P,U),i(P,K),i(P,Y),i(Y,re),i(re,ae),i(re,ne),i(re,ue),i(Y,se),i(Y,j),i(j,W),i(j,le),i(j,_e),i(j,ce),i(Y,fe),i(Y,de),i(de,ze),i(de,Xe),i(de,Me),i(Y,Pe),i(Y,he),i(he,Ue),i(he,xe),i(he,We),Ke=!0,ct||(ht=[ee(_,"input",n[15]),ee(k,"change",n[16]),ee(A,"change",n[18])],ct=!0)},p(be,De){var ot,Ut;const Tt={};De[0]&4&&(Tt.disabled=be[2]),!r&&De[0]&64&&(r=!0,Tt.value=be[6],At(()=>r=!1)),s.$set(Tt),(!Ke||De[0]&4)&&(_.disabled=be[2]),De[0]&128&&ke(_,be[7]),(!Ke||De[0]&4)&&(k.disabled=be[2]),De[0]&32&&(k.checked=k.__value===be[5]),(!Ke||De[0]&4)&&(A.disabled=be[2]),De[0]&32&&(A.checked=A.__value===be[5]);let St=B;B=Le(be),B===St?Re[B].p(be,De):(rt(),Z(Re[St],1,1,()=>{Re[St]=null}),it(),V=Re[B],V?V.p(be,De):(V=Re[B]=we[B](be),V.c()),q(V,1),V.m(O.parentNode,O));const gt={};De[0]&4&&(gt.loading=be[2]),De[0]&580&&(gt.disabled=be[2]||!be[6].trim()||!be[9]),De[1]&2048&&(gt.$$scope={dirty:De,ctx:be}),M.$set(gt);const _t={};De[0]&4&&(_t.disabled=be[2]),De[1]&2048&&(_t.$$scope={dirty:De,ctx:be}),F.$set(_t),(!Ke||De[0]&64)&&Q!==(Q=(be[6]||"Untitled")+"")&&ve(ue,Q),(!Ke||De[0]&2)&&ie!==(ie=(((Ut=(ot=be[1])==null?void 0:ot.body)==null?void 0:Ut.length)||0)+"")&&ve(_e,ie)},i(be){Ke||(q(s.$$.fragment,be),q(V),q(M.$$.fragment,be),q(F.$$.fragment,be),Ke=!0)},o(be){Z(s.$$.fragment,be),Z(V),Z(M.$$.fragment,be),Z(F.$$.fragment,be),Ke=!1},d(be){be&&($(e),$(u),$(a),$(h),$(g),$(D),$(O),$(E),$(H),$(z)),Ce(s),Re[B].d(be),Ce(M),Ce(F),Ye.r(),ct=!1,ft(ht)}}}function Lu(n){let e,t,l,o,s,r,u;function a(d){n[20](d)}let p={placeholder:"e.g., my-collection or http://server/custom-parent",disabled:n[2]};return n[4]!==void 0&&(p.value=n[4]),l=new Input({props:p}),yt.push(()=>Et(l,"value",a)),{c(){e=f("div"),t=f("div"),$e(l.$$.fragment),s=b(),r=f("p"),r.textContent=`Enter a collection name (e.g., "my-articles") or full URL.
              If the collection doesn't exist, it will be created.`,c(t,"class","control"),c(r,"class","help svelte-48g63o"),c(e,"class","field")},m(d,m){S(d,e,m),i(e,t),Te(l,t,null),i(e,s),i(e,r),u=!0},p(d,m){const _={};m[0]&4&&(_.disabled=d[2]),!o&&m[0]&16&&(o=!0,_.value=d[4],At(()=>o=!1)),l.$set(_)},i(d){u||(q(l.$$.fragment,d),u=!0)},o(d){Z(l.$$.fragment,d),u=!1},d(d){d&&$(e),Ce(l)}}}function Du(n){let e,t,l,o,s,r,u=Ge(predefinedParents),a=[];for(let p=0;p<u.length;p+=1)a[p]=ns(Jo(n,u,p));return{c(){e=f("div"),t=f("div"),l=f("div"),o=f("select");for(let p=0;p<a.length;p+=1)a[p].c();o.disabled=n[2],n[3]===void 0&&Pt(()=>n[19].call(o)),c(l,"class","select is-fullwidth"),c(t,"class","control"),c(e,"class","field")},m(p,d){S(p,e,d),i(e,t),i(t,l),i(l,o);for(let m=0;m<a.length;m+=1)a[m]&&a[m].m(o,null);pt(o,n[3],!0),s||(r=ee(o,"change",n[19]),s=!0)},p(p,d){if(d&0){u=Ge(predefinedParents);let m;for(m=0;m<u.length;m+=1){const _=Jo(p,u,m);a[m]?a[m].p(_,d):(a[m]=ns(_),a[m].c(),a[m].m(o,null))}for(;m<a.length;m+=1)a[m].d(1);a.length=u.length}d[0]&4&&(o.disabled=p[2]),d[0]&8&&pt(o,p[3])},i:Fe,o:Fe,d(p){p&&$(e),Ct(a,p),s=!1,r()}}}function ns(n){let e,t=n[33].label+"",l;return{c(){e=f("option"),l=I(t),e.__value=n[33].value,ke(e,e.__value)},m(o,s){S(o,e,s),i(e,l)},p:Fe,d(o){o&&$(e)}}}function Nu(n){let e,t,l;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-cloud-upload-alt"></i>',t=b(),l=f("span"),l.textContent="Save to Atomic Server",c(e,"class","icon")},m(o,s){S(o,e,s),S(o,t,s),S(o,l,s)},p:Fe,d(o){o&&($(e),$(t),$(l))}}}function Iu(n){let e;return{c(){e=I("Cancel")},m(t,l){S(t,e,l)},d(t){t&&$(e)}}}function Mu(n){let e,t,l,o,s,r,u,a,p,d,m,_,h,g=success&&yu(n),w=error&&Tu(n),C=!success&&Su(n);return{c(){e=f("div"),t=f("div"),l=f("div"),l.innerHTML=`<div class="level-item"><h3 class="title is-4"><span class="icon"><i class="fas fa-save"></i></span>
            Save to Atomic Server</h3></div>`,o=b(),s=f("div"),r=f("div"),u=f("button"),a=b(),g&&g.c(),p=b(),w&&w.c(),d=b(),C&&C.c(),c(l,"class","level-left"),c(u,"class","delete is-large"),u.disabled=n[2],c(u,"aria-label","close"),c(r,"class","level-item"),c(s,"class","level-right"),c(t,"class","level svelte-48g63o"),c(e,"class","box")},m(y,T){S(y,e,T),i(e,t),i(t,l),i(t,o),i(t,s),i(s,r),i(r,u),i(e,a),g&&g.m(e,null),i(e,p),w&&w.m(e,null),i(e,d),C&&C.m(e,null),m=!0,_||(h=ee(u,"click",handleClose),_=!0)},p(y,T){(!m||T[0]&4)&&(u.disabled=y[2]),error&&w.p(y,T),success||C.p(y,T)},i(y){m||(q(g),q(w),q(C),m=!0)},o(y){Z(g),Z(w),Z(C),m=!1},d(y){y&&$(e),g&&g.d(),w&&w.d(),C&&C.d(),_=!1,h()}}}function Pu(n){let e,t,l;function o(r){n[21](r)}let s={$$slots:{default:[Mu]},$$scope:{ctx:n}};return n[0]!==void 0&&(s.active=n[0]),e=new Modal({props:s}),yt.push(()=>Et(e,"active",o)),e.$on("close",handleClose),{c(){$e(e.$$.fragment)},m(r,u){Te(e,r,u),l=!0},p(r,u){const a={};u[0]&2046|u[1]&2048&&(a.$$scope={dirty:u,ctx:r}),!t&&u[0]&1&&(t=!0,a.active=r[0],At(()=>t=!1)),e.$set(a)},i(r){l||(q(e.$$.fragment,r),l=!0)},o(r){Z(e.$$.fragment,r),l=!1},d(r){Ce(e,r)}}}function ju(n,e,t){let l,o;lt(n,is_tauri,E=>t(24,E)),lt(n,configStore,E=>t(25,l=E)),lt(n,role,E=>t(10,o=E));let{active:s=!1}=e,{document:r}=e,u=!1,a="",p="",d=!1,m="",_="",h=[],g="";function w(){t(2,u=!1),t(3,a=""),t(4,p=""),t(5,d=!1),t(6,m=(r==null?void 0:r.title)||""),t(7,_=(r==null?void 0:r.description)||`Article saved from Terraphim search: ${r==null?void 0:r.title}`),t(8,h=[]),t(9,g="")}function C(){var X;const E=o,te=l;if(!(te!=null&&te.roles)||!E){console.warn("No role configuration found");return}let M=null;try{for(const[J,F]of Object.entries(te.roles)){const H=F,z=typeof H.name=="object"?H.name.original:String(H.name);if(J===E||z===E){M=H;break}}}catch(J){console.warn("Error checking role configuration:",J);return}if(!M){console.warn(`Role "${E}" not found in configuration`);return}t(8,h=((X=M.haystacks)==null?void 0:X.filter(J=>J.service==="Atomic"&&J.location&&!J.read_only))||[]),h.length>0&&t(9,g=h[0].location),console.log("Loaded atomic servers:",h)}function y(){const E=g.replace(/\/$/,"");if(d&&p.trim()){const te=p.trim();return te.startsWith("http://")||te.startsWith("https://")?te:`${E}/${te.replace(/^\//,"")}`}else return a?`${E}/${a}`:E}function T(){return m.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,50)}function k(){const E=g.replace(/\/$/,""),te=T(),M=Date.now();return`${E}/${te}-${M}`}const v=[[]];function L(){g=Xt(this),t(9,g),t(8,h)}function R(E){m=E,t(6,m)}function A(){_=this.value,t(7,_)}function N(){d=this.__value,t(5,d)}function D(){d=this.__value,t(5,d)}function B(){a=Xt(this),t(3,a)}function V(E){p=E,t(4,p)}function O(E){s=E,t(0,s)}return n.$$set=E=>{"active"in E&&t(0,s=E.active),"document"in E&&t(1,r=E.document)},n.$$.update=()=>{n.$$.dirty[0]&3&&s&&r&&(w(),C())},[s,r,u,a,p,d,m,_,h,g,o,y,k,L,R,A,N,v,D,B,V,O]}class Uu extends Ht{constructor(e){super(),Ft(this,e,ju,Pu,jt,{active:0,document:1},null,[-1,-1])}}async function zn(n){return Ze("tauri",n)}async function Hu(n,e){return zn({__tauriModule:"Event",message:{cmd:"unlisten",event:n,eventId:e}})}async function Fu(n,e,t){return zn({__tauriModule:"Event",message:{cmd:"listen",event:n,windowLabel:e,handler:Wl(t)}}).then(l=>async()=>Hu(n,l))}var ls;(function(n){n.WINDOW_RESIZED="tauri://resize",n.WINDOW_MOVED="tauri://move",n.WINDOW_CLOSE_REQUESTED="tauri://close-requested",n.WINDOW_CREATED="tauri://window-created",n.WINDOW_DESTROYED="tauri://destroyed",n.WINDOW_FOCUS="tauri://focus",n.WINDOW_BLUR="tauri://blur",n.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",n.WINDOW_THEME_CHANGED="tauri://theme-changed",n.WINDOW_FILE_DROP="tauri://file-drop",n.WINDOW_FILE_DROP_HOVER="tauri://file-drop-hover",n.WINDOW_FILE_DROP_CANCELLED="tauri://file-drop-cancelled",n.MENU="tauri://menu",n.CHECK_UPDATE="tauri://update",n.UPDATE_AVAILABLE="tauri://update-available",n.INSTALL_UPDATE="tauri://update-install",n.STATUS_UPDATE="tauri://update-status",n.DOWNLOAD_PROGRESS="tauri://update-download-progress"})(ls||(ls={}));async function zu(n,e){return Fu(n,null,e)}function os(n,e,t){const l=n.slice();l[9]=e[t];const o=typeof l[9].name=="string"?l[9].name:l[9].name.original;return l[10]=o,l}function ss(n){let e,t=n[10]+"",l,o;return{c(){e=f("option"),l=I(t),e.__value=o=n[10],ke(e,e.__value)},m(s,r){S(s,e,r),i(e,l)},p(s,r){r&1&&t!==(t=s[10]+"")&&ve(l,t),r&1&&o!==(o=s[10])&&(e.__value=o,ke(e,e.__value))},d(s){s&&$(e)}}}function Ku(n){let e,t,l,o,s,r,u=Ge(n[0]),a=[];for(let p=0;p<u.length;p+=1)a[p]=ss(os(n,u,p));return{c(){e=f("div"),t=f("div"),l=f("div"),o=f("select");for(let p=0;p<a.length;p+=1)a[p].c();c(l,"class","select"),c(t,"class","control"),c(e,"class","field is-grouped is-grouped-right")},m(p,d){S(p,e,d),i(e,t),i(t,l),i(l,o);for(let m=0;m<a.length;m+=1)a[m]&&a[m].m(o,null);pt(o,n[1]),s||(r=ee(o,"change",n[2]),s=!0)},p(p,[d]){if(d&1){u=Ge(p[0]);let m;for(m=0;m<u.length;m+=1){const _=os(p,u,m);a[m]?a[m].p(_,d):(a[m]=ss(_),a[m].c(),a[m].m(o,null))}for(;m<a.length;m+=1)a[m].d(1);a.length=u.length}d&3&&pt(o,p[1])},i:Fe,o:Fe,d(p){p&&$(e),Ct(a,p),s=!1,r()}}}function Bu(n,e,t){let l,o,s,r;lt(n,on,_=>t(5,l=_)),lt(n,It,_=>t(6,o=_)),lt(n,To,_=>t(0,s=_)),lt(n,Dt,_=>t(1,r=_));let u="";async function a(){try{It.set(window.__TAURI__!==void 0),o?(console.log("Loading config from Tauri"),Ze("get_config").then(_=>{console.log("get_config response",_),_&&_.status==="success"&&p(_.config)}).catch(_=>console.error("Error fetching config in Tauri:",_))):(console.log("Loading config from server"),u=`${mt.ServerURL}/config/`,fetch(u).then(_=>_.json()).then(_=>{console.log("Config received",_),_&&_.status==="success"&&p(_.config)}).catch(_=>console.error("Error fetching config:",_)))}catch(_){console.error("Unhandled error in loadConfig:",_)}}function p(_){var C;console.log("Updating stores from config:",_);const h={default_role:_.selected_role,..._};on.set(h);const g=Object.entries(_.roles).map(([y,T])=>({name:y,...T}));To.set(g),Dt.set(_.selected_role);const w=_.roles[_.selected_role];if(console.log("Selected role settings:",w),w){const y=w.theme||"spacelab";console.log("Setting theme to:",y),nl.set(y),(C=w.kg)!=null&&C.publish?o?Ze("publish_thesaurus",{roleName:_.selected_role}).then(T=>{console.log("publish_thesaurus response",T),tl.set(T),ln.set(!0)}).catch(T=>{console.error("Error publishing thesaurus:",T),ln.set(!1)}):(console.log("Fetching thesaurus from HTTP endpoint for role",_.selected_role),fetch(`${mt.ServerURL}/thesaurus/${encodeURIComponent(_.selected_role)}`).then(T=>T.json()).then(T=>{console.log("thesaurus HTTP response",T),T&&T.status==="success"&&T.thesaurus?(tl.set(T.thesaurus),ln.set(!0)):(console.error("Failed to fetch thesaurus:",T),ln.set(!1))}).catch(T=>{console.error("Error fetching thesaurus:",T),ln.set(!1)})):ln.set(!1)}else console.warn("No role settings found for:",_.selected_role),nl.set("spacelab")}typeof window<"u"&&window.__TAURI__&&zu("role_changed",_=>{console.log("Role changed event received from backend:",_.payload),p(_.payload)});async function d(){await a()}d(),console.log("Using Terraphim Server URL:",mt.ServerURL);function m(_){var y,T;const g=_.currentTarget.value;console.log("Role change requested:",g),Dt.set(g);const w=s.find(k=>(typeof k.name=="string"?k.name:k.name.original)===g);if(!w){console.error(`No role settings found for role: ${g}.`);return}const C=w.theme||"spacelab";nl.set(C),console.log(`Theme changed to ${C}`),on.update(k=>(k.selected_role=typeof k.selected_role=="string"?{original:g,lowercase:g.toLowerCase()}:{original:g,lowercase:g.toLowerCase()},k)),o?(Ze("select_role",{roleName:g}).catch(k=>console.error("Error selecting role:",k)),(y=w.kg)!=null&&y.publish?(console.log("Publishing thesaurus for role",g),Ze("publish_thesaurus",{roleName:g}).then(k=>{tl.set(k),ln.set(!0)})):ln.set(!1)):(fetch(`${mt.ServerURL}/config/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}).catch(k=>console.error("Error updating config on server:",k)),(T=w.kg)!=null&&T.publish?(console.log("Fetching thesaurus from HTTP endpoint for role",g),fetch(`${mt.ServerURL}/thesaurus/${encodeURIComponent(g)}`).then(k=>k.json()).then(k=>{console.log("thesaurus HTTP response",k),k&&k.status==="success"&&k.thesaurus?(tl.set(k.thesaurus),ln.set(!0)):(console.error("Failed to fetch thesaurus:",k),ln.set(!1))}).catch(k=>{console.error("Error fetching thesaurus:",k),ln.set(!1)})):ln.set(!1))}return[s,r,m,a]}class $l extends Ht{constructor(e){super(),Ft(this,e,Bu,Ku,jt,{loadConfig:3})}get loadConfig(){return this.$$.ctx[3]}}function rs(n,e,t){const l=n.slice();return l[43]=e[t],l}function is(n,e,t){const l=n.slice();return l[46]=e[t],l}function as(n){let e,t;return e=new Zl({props:{$$slots:{default:[Gu]},$$scope:{ctx:n}}}),{c(){$e(e.$$.fragment)},m(l,o){Te(e,l,o),t=!0},p(l,o){const s={};o[0]&129|o[1]&262144&&(s.$$scope={dirty:o,ctx:l}),e.$set(s)},i(l){t||(q(e.$$.fragment,l),t=!0)},o(l){Z(e.$$.fragment,l),t=!1},d(l){Ce(e,l)}}}function Wu(n){let e=n[46]+"",t;return{c(){t=I(e)},m(l,o){S(l,t,o)},p(l,o){o[0]&1&&e!==(e=l[46]+"")&&ve(t,e)},d(l){l&&$(t)}}}function cs(n){let e,t,l,o,s,r;t=new Ll({props:{rounded:!0,$$slots:{default:[Wu]},$$scope:{ctx:n}}});function u(){return n[19](n[46])}return{c(){e=f("button"),$e(t.$$.fragment),l=b(),c(e,"class","tag-button svelte-8px6jr"),e.disabled=n[7],c(e,"title","Click to view knowledge graph document")},m(a,p){S(a,e,p),Te(t,e,null),i(e,l),o=!0,s||(r=ee(e,"click",u),s=!0)},p(a,p){n=a;const d={};p[0]&1|p[1]&262144&&(d.$$scope={dirty:p,ctx:n}),t.$set(d),(!o||p[0]&128)&&(e.disabled=n[7])},i(a){o||(q(t.$$.fragment,a),o=!0)},o(a){Z(t.$$.fragment,a),o=!1},d(a){a&&$(e),Ce(t),s=!1,r()}}}function Gu(n){let e,t,l=Ge(n[0].tags),o=[];for(let r=0;r<l.length;r+=1)o[r]=cs(is(n,l,r));const s=r=>Z(o[r],1,1,()=>{o[r]=null});return{c(){for(let r=0;r<o.length;r+=1)o[r].c();e=Nt()},m(r,u){for(let a=0;a<o.length;a+=1)o[a]&&o[a].m(r,u);S(r,e,u),t=!0},p(r,u){if(u[0]&131201){l=Ge(r[0].tags);let a;for(a=0;a<l.length;a+=1){const p=is(r,l,a);o[a]?(o[a].p(p,u),q(o[a],1)):(o[a]=cs(p),o[a].c(),q(o[a],1),o[a].m(e.parentNode,e))}for(rt(),a=l.length;a<o.length;a+=1)s(a);it()}},i(r){if(!t){for(let u=0;u<l.length;u+=1)q(o[u]);t=!0}},o(r){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)Z(o[u]);t=!1},d(r){r&&$(e),Ct(o,r)}}}function qu(n){let e,t=(n[0].rank||0)+"",l;return{c(){e=I("Rank "),l=I(t)},m(o,s){S(o,e,s),S(o,l,s)},p(o,s){s[0]&1&&t!==(t=(o[0].rank||0)+"")&&ve(l,t)},d(o){o&&($(e),$(l))}}}function Vu(n){let e,t;return e=new Ll({props:{rounded:!0,$$slots:{default:[qu]},$$scope:{ctx:n}}}),{c(){$e(e.$$.fragment)},m(l,o){Te(e,l,o),t=!0},p(l,o){const s={};o[0]&1|o[1]&262144&&(s.$$scope={dirty:o,ctx:l}),e.$set(s)},i(l){t||(q(e.$$.fragment,l),t=!0)},o(l){Z(e.$$.fragment,l),t=!1},d(l){Ce(e,l)}}}function Ju(n){let e;return{c(){e=f("small"),e.textContent="No description available",c(e,"class","no-description svelte-8px6jr")},m(t,l){S(t,e,l)},p:Fe,i:Fe,o:Fe,d(t){t&&$(e)}}}function Qu(n){let e,t;return e=new fl({props:{source:n[0].description}}),{c(){$e(e.$$.fragment)},m(l,o){Te(e,l,o),t=!0},p(l,o){const s={};o[0]&1&&(s.source=l[0].description),e.$set(s)},i(l){t||(q(e.$$.fragment,l),t=!0)},o(l){Z(e.$$.fragment,l),t=!1},d(l){Ce(e,l)}}}function us(n){let e,t,l,o,s,r;return{c(){e=f("button"),t=f("span"),t.innerHTML='<i class="fas fa-magic" aria-hidden="true"></i>',l=b(),o=f("span"),o.textContent="AI Summary",c(t,"class","icon is-small"),c(e,"class","button is-small is-info is-outlined ai-summary-button svelte-8px6jr"),e.disabled=n[9],c(e,"title","Generate AI-powered summary using OpenRouter")},m(u,a){S(u,e,a),i(e,t),i(e,l),i(e,o),s||(r=ee(e,"click",n[18]),s=!0)},p(u,a){a[0]&512&&(e.disabled=u[9])},d(u){u&&$(e),s=!1,r()}}}function fs(n){let e;return{c(){e=f("div"),e.innerHTML='<span class="icon"><i class="fas fa-spinner fa-spin" aria-hidden="true"></i></span> <small>Generating AI summary...</small>',c(e,"class","ai-summary-loading svelte-8px6jr")},m(t,l){S(t,e,l)},d(t){t&&$(e)}}}function ds(n){let e,t,l,o,s,r,u,a,p,d;return{c(){e=f("div"),t=f("span"),t.innerHTML='<i class="fas fa-exclamation-triangle" aria-hidden="true"></i>',l=b(),o=f("small"),s=I("Summary error: "),r=I(n[10]),u=b(),a=f("button"),a.textContent="Retry",c(t,"class","icon has-text-danger"),c(o,"class","has-text-danger"),c(a,"class","button is-small is-text svelte-8px6jr"),c(a,"title","Retry generating summary"),c(e,"class","ai-summary-error svelte-8px6jr")},m(m,_){S(m,e,_),i(e,t),i(e,l),i(e,o),i(o,s),i(o,r),i(e,u),i(e,a),p||(d=ee(a,"click",n[20]),p=!0)},p(m,_){_[0]&1024&&ve(r,m[10])},d(m){m&&$(e),p=!1,d()}}}function ps(n){let e,t,l,o,s,r,u,a,p,d,m,_,h,g,w,C,y,T,k,v;function L(N,D){return N[12]?Xu:Yu}let R=L(n),A=R(n);return d=new fl({props:{source:n[8]}}),{c(){e=f("div"),t=f("div"),l=f("small"),o=f("span"),o.innerHTML='<i class="fas fa-robot" aria-hidden="true"></i>',s=I(`
                    AI Summary
                    `),A.c(),r=b(),u=f("button"),u.innerHTML='<span class="icon is-small"><i class="fas fa-times" aria-hidden="true"></i></span>',a=b(),p=f("div"),$e(d.$$.fragment),m=b(),_=f("div"),h=f("button"),g=f("span"),g.innerHTML='<i class="fas fa-redo" aria-hidden="true"></i>',w=b(),C=f("span"),C.textContent="Regenerate",c(o,"class","icon is-small"),c(l,"class","ai-summary-label svelte-8px6jr"),c(u,"class","button is-small is-text svelte-8px6jr"),c(u,"title","Hide AI summary"),c(t,"class","ai-summary-header svelte-8px6jr"),c(p,"class","ai-summary-content svelte-8px6jr"),c(g,"class","icon is-small"),c(h,"class","button is-small is-text svelte-8px6jr"),h.disabled=n[9],c(h,"title","Regenerate summary"),c(_,"class","ai-summary-actions svelte-8px6jr"),c(e,"class","ai-summary svelte-8px6jr")},m(N,D){S(N,e,D),i(e,t),i(t,l),i(l,o),i(l,s),A.m(l,null),i(t,r),i(t,u),i(e,a),i(e,p),Te(d,p,null),i(e,m),i(e,_),i(_,h),i(h,g),i(h,w),i(h,C),T=!0,k||(v=[ee(u,"click",n[21]),ee(h,"click",n[22])],k=!0)},p(N,D){R!==(R=L(N))&&(A.d(1),A=R(N),A&&(A.c(),A.m(l,null)));const B={};D[0]&256&&(B.source=N[8]),d.$set(B),(!T||D[0]&512)&&(h.disabled=N[9])},i(N){T||(q(d.$$.fragment,N),N&&Pt(()=>{T&&(y||(y=qn(e,Vn,{},!0)),y.run(1))}),T=!0)},o(N){Z(d.$$.fragment,N),N&&(y||(y=qn(e,Vn,{},!1)),y.run(0)),T=!1},d(N){N&&$(e),A.d(),Ce(d),N&&y&&y.end(),k=!1,ft(v)}}}function Yu(n){let e;return{c(){e=f("span"),e.textContent="fresh",c(e,"class","tag is-small is-success")},m(t,l){S(t,e,l)},d(t){t&&$(e)}}}function Xu(n){let e;return{c(){e=f("span"),e.textContent="cached",c(e,"class","tag is-small is-light")},m(t,l){S(t,e,l)},d(t){t&&$(e)}}}function ms(n){let e;function t(s,r){return s[43].disabled?ef:s[43].isLink?xu:Zu}let l=t(n),o=l(n);return{c(){o.c(),e=Nt()},m(s,r){o.m(s,r),S(s,e,r)},p(s,r){l===(l=t(s))&&o?o.p(s,r):(o.d(1),o=l(s),o&&(o.c(),o.m(e.parentNode,e)))},d(s){s&&$(e),o.d(s)}}}function Zu(n){let e,t,l,o,s,r,u,a,p,d;return{c(){var m,_,h;e=f("button"),t=f("span"),l=f("i"),s=b(),c(l,"class",o=yn(n[43].icon)+" svelte-8px6jr"),c(t,"class","icon is-medium"),Lt(t,"has-text-primary",(m=n[43].className)==null?void 0:m.includes("primary")),Lt(t,"has-text-success",(_=n[43].className)==null?void 0:_.includes("success")),Lt(t,"has-text-danger",(h=n[43].className)==null?void 0:h.includes("danger")),c(e,"type","button"),c(e,"class","level-item button is-ghost svelte-8px6jr"),c(e,"aria-label",r=n[43].title),c(e,"title",u=n[43].title),c(e,"data-testid",a=n[43].testId||"")},m(m,_){S(m,e,_),i(e,t),i(t,l),i(e,s),p||(d=ee(e,"click",function(){ul(n[43].action)&&n[43].action.apply(this,arguments)}),p=!0)},p(m,_){var h,g,w;n=m,_[0]&32768&&o!==(o=yn(n[43].icon)+" svelte-8px6jr")&&c(l,"class",o),_[0]&32768&&Lt(t,"has-text-primary",(h=n[43].className)==null?void 0:h.includes("primary")),_[0]&32768&&Lt(t,"has-text-success",(g=n[43].className)==null?void 0:g.includes("success")),_[0]&32768&&Lt(t,"has-text-danger",(w=n[43].className)==null?void 0:w.includes("danger")),_[0]&32768&&r!==(r=n[43].title)&&c(e,"aria-label",r),_[0]&32768&&u!==(u=n[43].title)&&c(e,"title",u),_[0]&32768&&a!==(a=n[43].testId||"")&&c(e,"data-testid",a)},d(m){m&&$(e),p=!1,d()}}}function xu(n){let e,t,l,o,s,r,u,a;return{c(){e=f("a"),t=f("span"),l=f("i"),s=b(),c(l,"class",o=yn(n[43].icon)+" svelte-8px6jr"),c(t,"class","icon is-medium"),Lt(t,"has-text-primary",n[43].className),c(e,"href",r=n[43].href),c(e,"target","_blank"),c(e,"class","level-item"),c(e,"aria-label",u=n[43].title),c(e,"title",a=n[43].title)},m(p,d){S(p,e,d),i(e,t),i(t,l),i(e,s)},p(p,d){d[0]&32768&&o!==(o=yn(p[43].icon)+" svelte-8px6jr")&&c(l,"class",o),d[0]&32768&&Lt(t,"has-text-primary",p[43].className),d[0]&32768&&r!==(r=p[43].href)&&c(e,"href",r),d[0]&32768&&u!==(u=p[43].title)&&c(e,"aria-label",u),d[0]&32768&&a!==(a=p[43].title)&&c(e,"title",a)},d(p){p&&$(e)}}}function ef(n){let e,t,l,o,s,r,u;return{c(){e=f("button"),t=f("span"),l=f("i"),s=b(),c(l,"class",o=yn(n[43].icon)+" svelte-8px6jr"),c(t,"class","icon is-medium"),Lt(t,"has-text-primary",n[43].className),c(e,"type","button"),c(e,"class","level-item button is-ghost svelte-8px6jr"),c(e,"aria-label",r=n[43].title),c(e,"title",u=n[43].title),e.disabled=!0},m(a,p){S(a,e,p),i(e,t),i(t,l),i(e,s)},p(a,p){p[0]&32768&&o!==(o=yn(a[43].icon)+" svelte-8px6jr")&&c(l,"class",o),p[0]&32768&&Lt(t,"has-text-primary",a[43].className),p[0]&32768&&r!==(r=a[43].title)&&c(e,"aria-label",r),p[0]&32768&&u!==(u=a[43].title)&&c(e,"title",u)},d(a){a&&$(e)}}}function _s(n){let e,t=n[43].visible&&ms(n);return{c(){t&&t.c(),e=Nt()},m(l,o){t&&t.m(l,o),S(l,e,o)},p(l,o){l[43].visible?t?t.p(l,o):(t=ms(l),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(l){l&&$(e),t&&t.d(l)}}}function hs(n){let e,t,l,o,s,r;return{c(){e=f("div"),t=f("button"),l=b(),o=I(n[13]),c(t,"class","delete svelte-8px6jr"),c(e,"class","notification is-danger is-light mt-2")},m(u,a){S(u,e,a),i(e,t),i(e,l),i(e,o),s||(r=ee(t,"click",n[23]),s=!0)},p(u,a){a[0]&8192&&ve(o,u[13])},d(u){u&&$(e),s=!1,r()}}}function gs(n){let e,t,l;function o(r){n[25](r)}let s={item:n[4],kgTerm:n[5],kgRank:n[6]};return n[2]!==void 0&&(s.active=n[2]),e=new Il({props:s}),yt.push(()=>Et(e,"active",o)),{c(){$e(e.$$.fragment)},m(r,u){Te(e,r,u),l=!0},p(r,u){const a={};u[0]&16&&(a.item=r[4]),u[0]&32&&(a.kgTerm=r[5]),u[0]&64&&(a.kgRank=r[6]),!t&&u[0]&4&&(t=!0,a.active=r[2],At(()=>t=!1)),e.$set(a)},i(r){l||(q(e.$$.fragment,r),l=!0)},o(r){Z(e.$$.fragment,r),l=!1},d(r){Ce(e,r)}}}function vs(n){let e,t,l;function o(r){n[26](r)}let s={document:n[0]};return n[3]!==void 0&&(s.active=n[3]),e=new Uu({props:s}),yt.push(()=>Et(e,"active",o)),{c(){$e(e.$$.fragment)},m(r,u){Te(e,r,u),l=!0},p(r,u){const a={};u[0]&1&&(a.document=r[0]),!t&&u[0]&8&&(t=!0,a.active=r[3],At(()=>t=!1)),e.$set(a)},i(r){l||(q(e.$$.fragment,r),l=!0)},o(r){Z(e.$$.fragment,r),l=!1},d(r){Ce(e,r)}}}function tf(n){let e,t,l,o,s,r,u,a,p,d,m,_,h=n[0].title+"",g,w,C,y,T,k,v,L,R,A,N,D,B,V,O,E,te,M,X,J,F,H,z,P,U,K,Y,re,ae,ne,Q,ue=n[0].tags&&as(n);a=new Zl({props:{$$slots:{default:[Vu]},$$scope:{ctx:n}}});const se=[Qu,Ju],j=[];function W(he,Ue){return he[0].description?0:1}v=W(n),L=j[v]=se[v](n);let le=!n[11]&&!n[9]&&!n[10]&&us(n),ie=n[9]&&fs(),_e=n[10]&&ds(n),ce=n[11]&&n[8]&&ps(n),fe=Ge(n[15]),de=[];for(let he=0;he<fe.length;he+=1)de[he]=_s(rs(n,fe,he));let ze=n[13]&&hs(n);function Xe(he){n[24](he)}let qe={item:n[0]};n[1]!==void 0&&(qe.active=n[1]),P=new Il({props:qe}),yt.push(()=>Et(P,"active",Xe));let Me=n[4]&&gs(n),Pe=n[14]&&vs(n);return{c(){e=f("div"),t=f("article"),l=f("div"),o=f("div"),s=f("div"),ue&&ue.c(),r=b(),u=f("div"),$e(a.$$.fragment),p=b(),d=f("div"),m=f("button"),_=f("h2"),g=I(h),w=b(),C=f("div"),y=f("small"),y.textContent="Description:",T=b(),k=f("div"),L.c(),R=b(),A=f("div"),le&&le.c(),N=b(),ie&&ie.c(),D=b(),_e&&_e.c(),B=b(),ce&&ce.c(),V=b(),O=f("br"),te=b(),M=f("div"),X=f("nav"),J=f("div");for(let he=0;he<de.length;he+=1)de[he].c();H=b(),ze&&ze.c(),z=b(),$e(P.$$.fragment),K=b(),Me&&Me.c(),Y=b(),Pe&&Pe.c(),re=Nt(),c(s,"class","level-right"),c(u,"class","level-right"),c(_,"class","title svelte-8px6jr"),c(m,"class","svelte-8px6jr"),c(y,"class","description-label svelte-8px6jr"),c(k,"class","description-content svelte-8px6jr"),c(C,"class","description svelte-8px6jr"),c(A,"class","ai-summary-section svelte-8px6jr"),c(o,"class","content"),c(J,"class","level-right svelte-8px6jr"),c(X,"class","level is-mobile svelte-8px6jr"),c(M,"class","level-right"),c(l,"class","media-content"),c(t,"class","media"),c(e,"class","box")},m(he,Ue){S(he,e,Ue),i(e,t),i(t,l),i(l,o),i(o,s),ue&&ue.m(s,null),i(o,r),i(o,u),Te(a,u,null),i(o,p),i(o,d),i(d,m),i(m,_),i(_,g),i(d,w),i(d,C),i(C,y),i(C,T),i(C,k),j[v].m(k,null),i(d,R),i(d,A),le&&le.m(A,null),i(A,N),ie&&ie.m(A,null),i(A,D),_e&&_e.m(A,null),i(A,B),ce&&ce.m(A,null),i(d,V),i(d,O),i(l,te),i(l,M),i(M,X),i(X,J);for(let xe=0;xe<de.length;xe+=1)de[xe]&&de[xe].m(J,null);i(e,H),ze&&ze.m(e,null),S(he,z,Ue),Te(P,he,Ue),S(he,K,Ue),Me&&Me.m(he,Ue),S(he,Y,Ue),Pe&&Pe.m(he,Ue),S(he,re,Ue),ae=!0,ne||(Q=ee(m,"click",n[16]),ne=!0)},p(he,Ue){he[0].tags?ue?(ue.p(he,Ue),Ue[0]&1&&q(ue,1)):(ue=as(he),ue.c(),q(ue,1),ue.m(s,null)):ue&&(rt(),Z(ue,1,1,()=>{ue=null}),it());const xe={};Ue[0]&1|Ue[1]&262144&&(xe.$$scope={dirty:Ue,ctx:he}),a.$set(xe),(!ae||Ue[0]&1)&&h!==(h=he[0].title+"")&&ve(g,h);let Ve=v;if(v=W(he),v===Ve?j[v].p(he,Ue):(rt(),Z(j[Ve],1,1,()=>{j[Ve]=null}),it(),L=j[v],L?L.p(he,Ue):(L=j[v]=se[v](he),L.c()),q(L,1),L.m(k,null)),!he[11]&&!he[9]&&!he[10]?le?le.p(he,Ue):(le=us(he),le.c(),le.m(A,N)):le&&(le.d(1),le=null),he[9]?ie||(ie=fs(),ie.c(),ie.m(A,D)):ie&&(ie.d(1),ie=null),he[10]?_e?_e.p(he,Ue):(_e=ds(he),_e.c(),_e.m(A,B)):_e&&(_e.d(1),_e=null),he[11]&&he[8]?ce?(ce.p(he,Ue),Ue[0]&2304&&q(ce,1)):(ce=ps(he),ce.c(),q(ce,1),ce.m(A,null)):ce&&(rt(),Z(ce,1,1,()=>{ce=null}),it()),Ue[0]&32768){fe=Ge(he[15]);let Ke;for(Ke=0;Ke<fe.length;Ke+=1){const Ye=rs(he,fe,Ke);de[Ke]?de[Ke].p(Ye,Ue):(de[Ke]=_s(Ye),de[Ke].c(),de[Ke].m(J,null))}for(;Ke<de.length;Ke+=1)de[Ke].d(1);de.length=fe.length}he[13]?ze?ze.p(he,Ue):(ze=hs(he),ze.c(),ze.m(e,null)):ze&&(ze.d(1),ze=null);const We={};Ue[0]&1&&(We.item=he[0]),!U&&Ue[0]&2&&(U=!0,We.active=he[1],At(()=>U=!1)),P.$set(We),he[4]?Me?(Me.p(he,Ue),Ue[0]&16&&q(Me,1)):(Me=gs(he),Me.c(),q(Me,1),Me.m(Y.parentNode,Y)):Me&&(rt(),Z(Me,1,1,()=>{Me=null}),it()),he[14]?Pe?(Pe.p(he,Ue),Ue[0]&16384&&q(Pe,1)):(Pe=vs(he),Pe.c(),q(Pe,1),Pe.m(re.parentNode,re)):Pe&&(rt(),Z(Pe,1,1,()=>{Pe=null}),it())},i(he){ae||(q(ue),q(a.$$.fragment,he),q(L),q(ce),he&&Pt(()=>{ae&&(E||(E=qn(d,Vn,{},!0)),E.run(1))}),he&&Pt(()=>{ae&&(F||(F=qn(X,Vn,{},!0)),F.run(1))}),q(P.$$.fragment,he),q(Me),q(Pe),ae=!0)},o(he){Z(ue),Z(a.$$.fragment,he),Z(L),Z(ce),he&&(E||(E=qn(d,Vn,{},!1)),E.run(0)),he&&(F||(F=qn(X,Vn,{},!1)),F.run(0)),Z(P.$$.fragment,he),Z(Me),Z(Pe),ae=!1},d(he){he&&($(e),$(z),$(K),$(Y),$(re)),ue&&ue.d(),Ce(a),j[v].d(),le&&le.d(),ie&&ie.d(),_e&&_e.d(),ce&&ce.d(),he&&E&&E.end(),Ct(de,he),he&&F&&F.end(),ze&&ze.d(),Ce(P,he),Me&&Me.d(he),Pe&&Pe.d(he),ne=!1,Q()}}}function nf(n,e,t){let l,o,s,r,u;lt(n,Dt,Q=>t(31,s=Q)),lt(n,It,Q=>t(32,r=Q)),lt(n,on,Q=>t(33,u=Q));let{document:a}=e,p=!1,d=!1,m=!1,_=null,h=null,g=null,w=!1,C=null,y=!1,T=null,k=!1,v=!1,L=!1,R=!1,A=null,N=!1,D=!1;function B(){const Q=[];return Q.push({id:"download-markdown",label:"Download to Markdown",icon:"fas fa-download",action:()=>X(),visible:!0,title:"Download document as markdown file"}),l&&Q.push({id:"save-atomic",label:"Save to Atomic Server",icon:"fas fa-cloud-upload-alt",action:()=>E(),visible:!0,title:"Save article to Atomic Server",className:"has-text-primary"}),a.url&&Q.push({id:"external-url",label:"Open URL",icon:"fas fa-link",action:()=>J(),visible:!0,title:"Open original URL in new tab"}),Q.push({id:"add-context",label:R?"Added to Context ✓":L?"Adding...":"Add to Context",icon:R?"fas fa-check-circle":L?"fas fa-spinner fa-spin":"fas fa-plus-circle",action:()=>F(),visible:!0,title:R?"Document successfully added to chat context. Go to Chat tab to see it.":"Add document to LLM conversation context",disabled:L||R,className:R?"has-text-success":A?"has-text-danger":"",testId:"add-to-context-button"}),Q.push({id:"chat-with-document",label:D?"Opening Chat...":N?"Adding to Chat...":"Chat with Document",icon:D?"fas fa-external-link-alt":N?"fas fa-spinner fa-spin":"fas fa-comment-dots",action:()=>H(),visible:!0,title:D?"Opening chat with this document":"Add document to context and open chat",disabled:N||D||L,className:D?"has-text-info":A?"has-text-danger":"has-text-primary",testId:"chat-with-document-button"}),Q}function V(){var W;const Q=s,ue=u;if(!(ue!=null&&ue.roles)||!Q)return!1;let se=null;try{for(const[le,ie]of Object.entries(ue.roles)){const _e=ie,ce=typeof _e.name=="object"?_e.name.original:String(_e.name);if(le===Q||ce===Q){se=_e;break}}}catch(le){return console.warn("Error checking role configuration:",le),!1}return se?(((W=se.haystacks)==null?void 0:W.filter(le=>le.service==="Atomic"&&le.location&&!le.read_only))||[]).length>0:!1}const O=()=>{t(1,p=!0)},E=()=>{console.log("🔄 Opening atomic save modal for document:",a.title),t(3,m=!0)};async function te(Q){var ue,se,j,W,le;t(7,w=!0),t(5,h=Q),console.log("🔍 KG Search Debug Info:"),console.log("  Tag clicked:",Q),console.log("  Current role:",s),console.log("  Is Tauri mode:",r);try{if(r){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:s,term:Q});const ie=await Ze("find_documents_for_kg_term",{roleName:s,term:Q});console.log("  📥 Tauri response received:"),console.log("    Status:",ie.status),console.log("    Results count:",((ue=ie.results)==null?void 0:ue.length)||0),console.log("    Total:",ie.total||0),console.log("    Full response:",JSON.stringify(ie,null,2)),ie.status==="success"&&ie.results&&ie.results.length>0?(t(4,_=ie.results[0]),t(6,g=_.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",_.title),console.log("    Rank:",g),console.log("    Body length:",((se=_.body)==null?void 0:se.length)||0,"characters"),t(2,d=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${Q}" in role: "${s}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const ie=mt.ServerURL,_e=encodeURIComponent(s),ce=encodeURIComponent(Q),fe=`${ie}/roles/${_e}/kg_search?term=${ce}`;console.log("  📤 HTTP Request details:"),console.log("    Base URL:",ie),console.log("    Role (encoded):",_e),console.log("    Term (encoded):",ce),console.log("    Full URL:",fe);const de=await fetch(fe);if(console.log("  📥 HTTP Response received:"),console.log("    Status code:",de.status),console.log("    Status text:",de.statusText),console.log("    Headers:",Object.fromEntries(de.headers.entries())),!de.ok)throw new Error(`HTTP error! Status: ${de.status} - ${de.statusText}`);const ze=await de.json();console.log("  📄 Response data:"),console.log("    Status:",ze.status),console.log("    Results count:",((j=ze.results)==null?void 0:j.length)||0),console.log("    Total:",ze.total||0),console.log("    Full response:",JSON.stringify(ze,null,2)),ze.status==="success"&&ze.results&&ze.results.length>0?(t(4,_=ze.results[0]),t(6,g=_.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",_.title),console.log("    Rank:",g),console.log("    Body length:",((W=_.body)==null?void 0:W.length)||0,"characters"),t(2,d=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${Q}" in role: "${s}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",fe))}}catch(ie){console.error("❌ Error fetching KG document:"),console.error("  Error type:",ie.constructor.name),console.error("  Error message:",ie.message||ie),console.error("  Request details:",{tag:Q,role:s,isTauri:r,timestamp:new Date().toISOString()}),!r&&((le=ie.message)!=null&&le.includes("Failed to fetch"))&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{t(7,w=!1)}}async function M(){var Q;if(!(y||!a.id||!s)){t(9,y=!0),t(10,T=null),console.log("🤖 AI Summary Debug Info:"),console.log("  Document ID:",a.id),console.log("  Current role:",s),console.log("  Is Tauri mode:",r);try{const ue={document_id:a.id,role:s,max_length:250,force_regenerate:!1};console.log("  📤 Summarization request:",ue);let se;if(r){const le=`${mt.ServerURL}/documents/summarize`;se=await fetch(le,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ue)})}else{const le=`${mt.ServerURL}/documents/summarize`;se=await fetch(le,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ue)})}if(console.log("  📥 Summary response received:"),console.log("    Status code:",se.status),console.log("    Status text:",se.statusText),!se.ok)throw new Error(`HTTP error! Status: ${se.status} - ${se.statusText}`);const j=await se.json();console.log("  📄 Summary response data:",j),j.status==="success"&&j.summary?(t(8,C=j.summary),t(12,v=j.from_cache||!1),t(11,k=!0),console.log("  ✅ Summary generated successfully"),console.log("    Summary length:",C.length,"characters"),console.log("    From cache:",v),console.log("    Model used:",j.model_used)):(t(10,T=j.error||"Failed to generate summary"),console.error("  ❌ Summary generation failed:",T))}catch(ue){console.error("❌ Error generating summary:"),console.error("  Error type:",ue.constructor.name),console.error("  Error message:",ue.message||ue),console.error("  Request details:",{document_id:a.id,role:s,isTauri:r,timestamp:new Date().toISOString()}),t(10,T=ue.message||"Network error occurred"),(Q=ue.message)!=null&&Q.includes("Failed to fetch")&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Verify OpenRouter is enabled for this role"),console.error("    3. Check OPENROUTER_KEY environment variable"),console.error("    4. Verify server URL in CONFIG.ServerURL"))}finally{t(9,y=!1)}}}async function X(){var se;console.log("📥 Downloading document as markdown:",a.title),console.log("📄 Document data:",{title:a.title,bodyLength:(se=a.body)==null?void 0:se.length,tags:a.tags}),console.log("🖥️ Environment check - is_tauri:",r);let Q=`# ${a.title}

`;Q+=`**Source:** Terraphim Search
`,Q+=`**Rank:** ${a.rank||"N/A"}
`,a.url&&(Q+=`**URL:** ${a.url}
`),a.tags&&a.tags.length>0&&(Q+=`**Tags:** ${a.tags.join(", ")}
`),Q+=`**Downloaded:** ${new Date().toISOString()}

`,a.description&&(Q+=`## Description

${a.description}

`),Q+=`## Content

${a.body}
`;const ue=`${a.title.replace(/[^a-z0-9]/gi,"_").toLowerCase()}_${Date.now()}.md`;try{if(r){const{save:j}=await il(async()=>{const{save:ie}=await Promise.resolve().then(()=>ji);return{save:ie}},void 0),{writeTextFile:W}=await il(async()=>{const{writeTextFile:ie}=await import("./fs-CRJ3ZtCH.js");return{writeTextFile:ie}},__vite__mapDeps([0,1,2,3,4,5,6,7,8]));console.log("💾 Using Tauri save dialog...");const le=await j({filters:[{name:"Markdown",extensions:["md"]}],defaultPath:ue});le?(await W(le,Q),console.log("✅ File saved via Tauri:",le)):console.log("❌ Save dialog cancelled")}else{console.log("🌐 Using browser download fallback...");const j=new Blob([Q],{type:"text/markdown;charset=utf-8"}),W=URL.createObjectURL(j),le=a.createElement("a");le.href=W,le.download=ue,a.body.appendChild(le),le.click(),a.body.removeChild(le),URL.revokeObjectURL(W),console.log("✅ File downloaded via browser:",ue)}}catch(j){console.error("❌ Download failed:",j),console.log("🔄 Falling back to browser download...");const W=new Blob([Q],{type:"text/markdown;charset=utf-8"}),le=URL.createObjectURL(W),ie=a.createElement("a");ie.href=le,ie.download=ue,a.body.appendChild(ie),ie.click(),a.body.removeChild(ie),URL.revokeObjectURL(le),console.log("✅ Fallback download completed:",ue)}}function J(){console.log("🔄 Opening URL in new tab and article modal..."),a.url&&(console.log("🔗 Opening URL in new tab:",a.url),window.open(a.url,"_blank")),setTimeout(()=>{console.log("📖 Opening article modal..."),O()},100)}async function F(){console.log("📝 Adding document to LLM context:",a.title),L=!0,R=!1,t(13,A=null);try{let Q=null;if(r){try{const W=await Ze("list_conversations");if(console.log("📋 Available conversations:",W),W!=null&&W.conversations&&W.conversations.length>0)Q=W.conversations[0].id,console.log("🎯 Using existing conversation:",Q);else{const le=await Ze("create_conversation",{title:"Search Context",role:s||"default"});if(le.status==="success"&&le.conversation_id)Q=le.conversation_id,console.log("🆕 Created new conversation:",Q);else throw new Error("Failed to create conversation: "+(le.error||"Unknown error"))}}catch(W){throw console.error("❌ Failed to manage conversations:",W),new Error("Could not create or find conversation: "+W.message)}const se={source_type:"document",document_id:a.id};a.url&&(se.url=a.url),a.tags&&a.tags.length>0&&(se.tags=a.tags.join(", ")),a.rank!==void 0&&(se.rank=a.rank.toString());const j=await Ze("add_context_to_conversation",{conversationId:Q,contextType:"document",title:a.title,content:a.body,metadata:se});console.log("✅ Document added to context via Tauri:",j)}else{const se=mt.ServerURL;try{const ie=await fetch(`${se}/conversations`);if(ie.ok){const _e=await ie.json();if(_e.conversations&&_e.conversations.length>0)Q=_e.conversations[0].id,console.log("🎯 Using existing conversation:",Q);else{const ce=await fetch(`${se}/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"Search Context",role:s||"default"})});if(ce.ok){const fe=await ce.json();if(fe.status==="success"&&fe.conversation_id)Q=fe.conversation_id,console.log("🆕 Created new conversation:",Q);else throw new Error("Failed to create conversation: "+(fe.error||"Unknown error"))}else throw new Error(`Failed to create conversation: ${ce.status} ${ce.statusText}`)}}else throw new Error(`Failed to list conversations: ${ie.status} ${ie.statusText}`)}catch(ie){throw console.error("❌ Failed to manage conversations:",ie),new Error("Could not create or find conversation: "+ie.message)}const j=`${se}/conversations/${Q}/context`,W=await fetch(j,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context_type:"document",title:a.title,content:a.body,metadata:{source_type:"document",document_id:a.id,url:a.url||"",tags:a.tags?a.tags.join(", "):"",rank:a.rank?a.rank.toString():"0"}})});if(!W.ok)throw new Error(`HTTP error! Status: ${W.status} - ${W.statusText}`);const le=await W.json();console.log("✅ Document added to context via HTTP:",le)}console.log("✅ Successfully added document to LLM context"),R=!0;const ue=window.document.createElement("div");ue.className="notification is-success is-light",ue.innerHTML=`
        <button class="delete" onclick="this.parentElement.remove()"></button>
        <strong>✓ Added to Chat Context</strong><br>
        <small>Document added successfully. <a href="/chat" class="has-text-success has-text-weight-bold">Go to Chat →</a> to see it in the context panel.</small>
      `,ue.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(ue),setTimeout(()=>{ue.remove()},8e3),setTimeout(()=>{R=!1},5e3)}catch(Q){console.error("❌ Error adding document to context:",Q),t(13,A=Q.message||"Failed to add document to context");const ue=window.document.createElement("div");ue.className="notification is-danger is-light",ue.innerHTML=`
        <button class="delete" onclick="this.parentElement.remove()"></button>
        <strong>✗ Failed to Add Context</strong><br>
        <small>${A}</small>
      `,ue.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(ue),setTimeout(()=>{ue.remove()},8e3),setTimeout(()=>{t(13,A=null)},5e3)}finally{L=!1}}async function H(){console.log("💬 Adding document to context and opening chat:",a.title),N=!0,D=!1,t(13,A=null);try{let Q=null;if(r){try{const W=await Ze("list_conversations");if(console.log("📋 Available conversations:",W),W!=null&&W.conversations&&W.conversations.length>0)Q=W.conversations[0].id,console.log("🎯 Using existing conversation:",Q);else{const le=await Ze("create_conversation",{title:"Chat with Documents",role:s||"default"});if(le.status==="success"&&le.conversation_id)Q=le.conversation_id,console.log("🆕 Created new conversation:",Q);else throw new Error("Failed to create conversation: "+(le.error||"Unknown error"))}}catch(W){throw console.error("❌ Failed to manage conversations:",W),new Error("Could not create or find conversation: "+W.message)}const se={source_type:"document",document_id:a.id};a.url&&(se.url=a.url),a.tags&&a.tags.length>0&&(se.tags=a.tags.join(", ")),a.rank!==void 0&&(se.rank=a.rank.toString());const j=await Ze("add_context_to_conversation",{conversationId:Q,contextType:"document",title:a.title,content:a.body,metadata:se});console.log("✅ Document added to context via Tauri:",j)}else{const se=mt.ServerURL;try{const ie=await fetch(`${se}/conversations`);if(ie.ok){const _e=await ie.json();if(_e.conversations&&_e.conversations.length>0)Q=_e.conversations[0].id,console.log("🎯 Using existing conversation:",Q);else{const ce=await fetch(`${se}/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"Chat with Documents",role:s||"default"})});if(ce.ok){const fe=await ce.json();if(fe.status==="success"&&fe.conversation_id)Q=fe.conversation_id,console.log("🆕 Created new conversation:",Q);else throw new Error("Failed to create conversation: "+(fe.error||"Unknown error"))}else throw new Error(`Failed to create conversation: ${ce.status} ${ce.statusText}`)}}else throw new Error(`Failed to list conversations: ${ie.status} ${ie.statusText}`)}catch(ie){throw console.error("❌ Failed to manage conversations:",ie),new Error("Could not create or find conversation: "+ie.message)}const j=`${se}/conversations/${Q}/context`,W=await fetch(j,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context_type:"document",title:a.title,content:a.body,metadata:{source_type:"document",document_id:a.id,url:a.url||"",tags:a.tags?a.tags.join(", "):"",rank:a.rank?a.rank.toString():"0"}})});if(!W.ok)throw new Error(`HTTP error! Status: ${W.status} - ${W.statusText}`);const le=await W.json();console.log("✅ Document added to context via HTTP:",le)}console.log("✅ Successfully added document to chat context, navigating to chat..."),D=!0;const ue=window.document.createElement("div");ue.className="notification is-success is-light",ue.innerHTML=`
        <strong>💬 Opening Chat with Document</strong><br>
        <small>Context added successfully. Redirecting to chat...</small>
      `,ue.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(ue),setTimeout(()=>{ue.remove(),mi.goto("/chat")},1500),setTimeout(()=>{D=!1},2e3)}catch(Q){console.error("❌ Error adding document to context and opening chat:",Q),t(13,A=Q.message||"Failed to add document to context");const ue=window.document.createElement("div");ue.className="notification is-danger is-light",ue.innerHTML=`
        <button class="delete" onclick="this.parentElement.remove()"></button>
        <strong>✗ Failed to Open Chat with Document</strong><br>
        <small>${A}</small>
      `,ue.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(ue),setTimeout(()=>{ue.remove()},8e3),setTimeout(()=>{t(13,A=null)},5e3)}finally{N=!1}}$l[s]!==void 0&&(console.log("Have attribute",$l[s]),$l[s].hasOwnProperty("enableLogseq")?console.log("enable logseq True"):console.log("Didn't make it"));const z=Q=>te(Q),P=()=>{t(10,T=null),M()},U=()=>t(11,k=!1),K=()=>{M()},Y=()=>t(13,A=null);function re(Q){p=Q,t(1,p)}function ae(Q){d=Q,t(2,d)}function ne(Q){m=Q,t(3,m)}return n.$$set=Q=>{"document"in Q&&t(0,a=Q.document)},t(14,l=V()),t(15,o=B()),[a,p,d,m,_,h,g,w,C,y,T,k,v,A,l,o,O,te,M,z,P,U,K,Y,re,ae,ne]}class lf extends Ht{constructor(e){super(),Ft(this,e,nf,tf,jt,{document:0},null,[-1,-1])}}const of="/assets/terraphim_gray.png";function Cl(n){const e=n.trim();if(!e)return{hasOperator:!1,operator:null,terms:[n],originalQuery:n};const t=/\b(AND)\b/,l=/\b(OR)\b/,o=/\b(and)\b/i,s=/\b(or)\b/i,r=t.test(e),u=l.test(e),a=o.test(e)&&!r,p=s.test(e)&&!u;if(r&&!u)return{hasOperator:!0,operator:"AND",terms:e.split(t).filter((m,_)=>_%2===0).map(m=>m.trim()).filter(m=>m.length>0),originalQuery:n};if(u&&!r)return{hasOperator:!0,operator:"OR",terms:e.split(l).filter((m,_)=>_%2===0).map(m=>m.trim()).filter(m=>m.length>0),originalQuery:n};if(r&&u){const d=e.indexOf(" AND "),m=e.indexOf(" OR ");if(d!==-1&&(m===-1||d<m))return{hasOperator:!0,operator:"AND",terms:e.split(/\s+(?:AND|OR)\s+/i).map(h=>h.trim()).filter(h=>h.length>0),originalQuery:n};if(m!==-1)return{hasOperator:!0,operator:"OR",terms:e.split(/\s+(?:AND|OR)\s+/i).map(h=>h.trim()).filter(h=>h.length>0),originalQuery:n}}if(a&&!p)return{hasOperator:!0,operator:"AND",terms:e.split(o).filter((m,_)=>_%2===0).map(m=>m.trim()).filter(m=>m.length>0),originalQuery:n};if(p&&!a)return{hasOperator:!0,operator:"OR",terms:e.split(s).filter((m,_)=>_%2===0).map(m=>m.trim()).filter(m=>m.length>0),originalQuery:n};if(a&&p){const d=e.toLowerCase().indexOf(" and "),m=e.toLowerCase().indexOf(" or ");if(d!==-1&&(m===-1||d<m))return{hasOperator:!0,operator:"AND",terms:e.split(/\s+(?:and|or)\s+/i).map(h=>h.trim()).filter(h=>h.length>0),originalQuery:n};if(m!==-1)return{hasOperator:!0,operator:"OR",terms:e.split(/\s+(?:and|or)\s+/i).map(h=>h.trim()).filter(h=>h.length>0),originalQuery:n}}return{hasOperator:!1,operator:null,terms:[e],originalQuery:n}}function sf(n,e){var l,o;if(n.hasOperator&&n.terms.length>1){const s=n.terms.filter(r=>r.trim().length>0);if(s.length>1)return{search_term:s[0],search_terms:s,operator:(l=n.operator)==null?void 0:l.toLowerCase(),skip:0,limit:50,role:e||null}}return{search_term:((o=n.terms[0])==null?void 0:o.trim())||"",search_terms:void 0,operator:void 0,skip:0,limit:50,role:e||null}}function bs(n,e,t){const l=n.slice();return l[46]=e[t],l}function ks(n,e,t){const l=n.slice();return l[49]=e[t],l[51]=t,l}function ws(n,e,t){const l=n.slice();return l[52]=e[t],l[51]=t,l}function ys(n){let e,t=Ge(n[3]),l=[];for(let o=0;o<t.length;o+=1)l[o]=Cs(ws(n,t,o));return{c(){e=f("ul");for(let o=0;o<l.length;o+=1)l[o].c();c(e,"class","suggestions svelte-sfnt4t")},m(o,s){S(o,e,s);for(let r=0;r<l.length;r+=1)l[r]&&l[r].m(e,null)},p(o,s){if(s[0]&4120){t=Ge(o[3]);let r;for(r=0;r<t.length;r+=1){const u=ws(o,t,r);l[r]?l[r].p(u,s):(l[r]=Cs(u),l[r].c(),l[r].m(e,null))}for(;r<l.length;r+=1)l[r].d(1);l.length=t.length}},d(o){o&&$(e),Ct(l,o)}}}function Cs(n){let e,t=n[52]+"",l,o,s,r,u,a;function p(){return n[20](n[52])}function d(...m){return n[21](n[52],...m)}return{c(){e=f("li"),l=I(t),o=b(),c(e,"tabindex","0"),c(e,"role","option"),c(e,"aria-selected",s=n[51]===n[4]),c(e,"aria-label",r=`Apply suggestion: ${n[52]}`),c(e,"class","svelte-sfnt4t"),Lt(e,"active",n[51]===n[4])},m(m,_){S(m,e,_),i(e,l),i(e,o),u||(a=[ee(e,"click",p),ee(e,"keydown",d)],u=!0)},p(m,_){n=m,_[0]&8&&t!==(t=n[52]+"")&&ve(l,t),_[0]&16&&s!==(s=n[51]===n[4])&&c(e,"aria-selected",s),_[0]&8&&r!==(r=`Apply suggestion: ${n[52]}`)&&c(e,"aria-label",r),_[0]&16&&Lt(e,"active",n[51]===n[4])},d(m){m&&$(e),u=!1,ft(a)}}}function Ts(n){let e,t,l,o,s,r,u;return t=new Zl({props:{$$slots:{default:[cf]},$$scope:{ctx:n}}}),{c(){e=f("div"),$e(t.$$.fragment),l=b(),o=f("button"),o.textContent="Clear all",c(o,"type","button"),c(o,"class","clear-terms-btn svelte-sfnt4t"),c(e,"class","selected-terms-section svelte-sfnt4t")},m(a,p){S(a,e,p),Te(t,e,null),i(e,l),i(e,o),s=!0,r||(u=ee(o,"click",n[14]),r=!0)},p(a,p){const d={};p[0]&96|p[1]&8388608&&(d.$$scope={dirty:p,ctx:a}),t.$set(d)},i(a){s||(q(t.$$.fragment,a),s=!0)},o(a){Z(t.$$.fragment,a),s=!1},d(a){a&&$(e),Ce(t),r=!1,u()}}}function rf(n){let e=n[49].value+"",t,l,o,s,r,u,a;function p(){return n[22](n[49])}return{c(){t=I(e),l=b(),o=f("button"),s=I("×"),c(o,"class","remove-tag-btn svelte-sfnt4t"),c(o,"aria-label",r=`Remove term: ${n[49].value}`)},m(d,m){S(d,t,m),S(d,l,m),S(d,o,m),i(o,s),u||(a=ee(o,"click",Sl(p)),u=!0)},p(d,m){n=d,m[0]&32&&e!==(e=n[49].value+"")&&ve(t,e),m[0]&32&&r!==(r=`Remove term: ${n[49].value}`)&&c(o,"aria-label",r)},d(d){d&&($(t),$(l),$(o)),u=!1,a()}}}function $s(n){let e,t,l,o;return t=new Ll({props:{class:"operator-tag",rounded:!0,$$slots:{default:[af]},$$scope:{ctx:n}}}),{c(){e=f("div"),$e(t.$$.fragment),l=b(),c(e,"class","operator-tag-wrapper svelte-sfnt4t")},m(s,r){S(s,e,r),Te(t,e,null),i(e,l),o=!0},p(s,r){const u={};r[0]&64|r[1]&8388608&&(u.$$scope={dirty:r,ctx:s}),t.$set(u)},i(s){o||(q(t.$$.fragment,s),o=!0)},o(s){Z(t.$$.fragment,s),o=!1},d(s){s&&$(e),Ce(t)}}}function af(n){let e=(n[6]||"AND")+"",t;return{c(){t=I(e)},m(l,o){S(l,t,o)},p(l,o){o[0]&64&&e!==(e=(l[6]||"AND")+"")&&ve(t,e)},d(l){l&&$(t)}}}function Ss(n){let e,t,l,o,s;function r(){return n[23](n[49])}t=new Ll({props:{rounded:!0,title:"Click to remove term",$$slots:{default:[rf]},$$scope:{ctx:n}}}),t.$on("click",r);let u=n[51]<n[5].length-1&&$s(n);return{c(){e=f("div"),$e(t.$$.fragment),l=b(),u&&u.c(),o=Nt(),c(e,"class","term-tag-wrapper svelte-sfnt4t"),Lt(e,"from-kg",n[49].isFromKG)},m(a,p){S(a,e,p),Te(t,e,null),S(a,l,p),u&&u.m(a,p),S(a,o,p),s=!0},p(a,p){n=a;const d={};p[0]&32|p[1]&8388608&&(d.$$scope={dirty:p,ctx:n}),t.$set(d),(!s||p[0]&32)&&Lt(e,"from-kg",n[49].isFromKG),n[51]<n[5].length-1?u?(u.p(n,p),p[0]&32&&q(u,1)):(u=$s(n),u.c(),q(u,1),u.m(o.parentNode,o)):u&&(rt(),Z(u,1,1,()=>{u=null}),it())},i(a){s||(q(t.$$.fragment,a),q(u),s=!0)},o(a){Z(t.$$.fragment,a),Z(u),s=!1},d(a){a&&($(e),$(l),$(o)),Ce(t),u&&u.d(a)}}}function cf(n){let e,t,l=Ge(n[5]),o=[];for(let r=0;r<l.length;r+=1)o[r]=Ss(ks(n,l,r));const s=r=>Z(o[r],1,1,()=>{o[r]=null});return{c(){for(let r=0;r<o.length;r+=1)o[r].c();e=Nt()},m(r,u){for(let a=0;a<o.length;a+=1)o[a]&&o[a].m(r,u);S(r,e,u),t=!0},p(r,u){if(u[0]&8288){l=Ge(r[5]);let a;for(a=0;a<l.length;a+=1){const p=ks(r,l,a);o[a]?(o[a].p(p,u),q(o[a],1)):(o[a]=Ss(p),o[a].c(),q(o[a],1),o[a].m(e.parentNode,e))}for(rt(),a=l.length;a<o.length;a+=1)s(a);it()}},i(r){if(!t){for(let u=0;u<l.length;u+=1)q(o[u]);t=!0}},o(r){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)Z(o[u]);t=!1},d(r){r&&$(e),Ct(o,r)}}}function Os(n){let e,t,l,o;return{c(){e=f("div"),t=f("button"),t.textContent="Parse Terms",c(t,"type","button"),c(t,"class","button is-small is-info"),c(e,"class","search-hint-container svelte-sfnt4t")},m(s,r){S(s,e,r),i(e,t),l||(o=ee(t,"click",n[24]),l=!0)},p:Fe,d(s){s&&$(e),l=!1,o()}}}function uf(n){let e,t,l,o,s,r,u,a=n[0]&&(n[0].includes(" AND ")||n[0].includes(" OR "))&&n[5].length===0,p;function d(w){n[19](w)}let m={type:"search",placeholder:n[8]?`Search over Knowledge graph for ${n[7]}`:"Search",icon:"search",expanded:!0,autofocus:!0};n[0]!==void 0&&(m.value=n[0]),l=new Zn({props:m}),yt.push(()=>Et(l,"value",d)),l.$on("click",n[15]),l.$on("submit",n[15]),l.$on("keydown",n[11]),l.$on("input",n[10]);let _=n[3].length>0&&ys(n),h=n[5].length>0&&Ts(n),g=a&&Os(n);return{c(){e=f("div"),t=f("div"),$e(l.$$.fragment),s=b(),_&&_.c(),r=b(),h&&h.c(),u=b(),g&&g.c(),c(t,"class","input-wrapper svelte-sfnt4t"),c(e,"class","search-row svelte-sfnt4t")},m(w,C){S(w,e,C),i(e,t),Te(l,t,null),i(t,s),_&&_.m(t,null),i(e,r),h&&h.m(e,null),i(e,u),g&&g.m(e,null),p=!0},p(w,C){const y={};C[0]&384&&(y.placeholder=w[8]?`Search over Knowledge graph for ${w[7]}`:"Search"),!o&&C[0]&1&&(o=!0,y.value=w[0],At(()=>o=!1)),l.$set(y),w[3].length>0?_?_.p(w,C):(_=ys(w),_.c(),_.m(t,null)):_&&(_.d(1),_=null),w[5].length>0?h?(h.p(w,C),C[0]&32&&q(h,1)):(h=Ts(w),h.c(),q(h,1),h.m(e,u)):h&&(rt(),Z(h,1,1,()=>{h=null}),it()),C[0]&33&&(a=w[0]&&(w[0].includes(" AND ")||w[0].includes(" OR "))&&w[5].length===0),a?g?g.p(w,C):(g=Os(w),g.c(),g.m(e,null)):g&&(g.d(1),g=null)},i(w){p||(q(l.$$.fragment,w),q(h),p=!0)},o(w){Z(l.$$.fragment,w),Z(h),p=!1},d(w){w&&$(e),Ce(l),_&&_.d(),h&&h.d(),g&&g.d()}}}function ff(n){let e,t,l,o,s,r,u,a,p,d;return{c(){e=f("section"),t=f("div"),l=f("img"),s=b(),r=f("p"),r.textContent="I am Terraphim, your personal assistant.",u=b(),a=f("button"),a.innerHTML='<span class="icon"><i class="fas fa-magic"></i></span> <span>Configuration Wizard</span>',xi(l.src,o=of)||c(l,"src",o),c(l,"alt","Terraphim Logo"),c(l,"class","svelte-sfnt4t"),c(a,"class","button is-primary"),c(a,"data-testid","wizard-start"),c(t,"class","content has-text-grey has-text-centered svelte-sfnt4t"),c(e,"class","section")},m(m,_){S(m,e,_),i(e,t),i(t,l),i(t,s),i(t,r),i(t,u),i(t,a),p||(d=ee(a,"click",n[25]),p=!0)},p:Fe,i:Fe,o:Fe,d(m){m&&$(e),p=!1,d()}}}function df(n){let e,t,l=Ge(n[1]),o=[];for(let r=0;r<l.length;r+=1)o[r]=Rs(bs(n,l,r));const s=r=>Z(o[r],1,1,()=>{o[r]=null});return{c(){for(let r=0;r<o.length;r+=1)o[r].c();e=Nt()},m(r,u){for(let a=0;a<o.length;a+=1)o[a]&&o[a].m(r,u);S(r,e,u),t=!0},p(r,u){if(u[0]&2){l=Ge(r[1]);let a;for(a=0;a<l.length;a+=1){const p=bs(r,l,a);o[a]?(o[a].p(p,u),q(o[a],1)):(o[a]=Rs(p),o[a].c(),q(o[a],1),o[a].m(e.parentNode,e))}for(rt(),a=l.length;a<o.length;a+=1)s(a);it()}},i(r){if(!t){for(let u=0;u<l.length;u+=1)q(o[u]);t=!0}},o(r){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)Z(o[u]);t=!1},d(r){r&&$(e),Ct(o,r)}}}function pf(n){let e,t;return{c(){e=f("p"),t=I(n[2]),c(e,"class","error svelte-sfnt4t")},m(l,o){S(l,e,o),i(e,t)},p(l,o){o[0]&4&&ve(t,l[2])},i:Fe,o:Fe,d(l){l&&$(e)}}}function Rs(n){let e,t;return e=new lf({props:{document:n[46]}}),{c(){$e(e.$$.fragment)},m(l,o){Te(e,l,o),t=!0},p(l,o){const s={};o[0]&2&&(s.document=l[46]),e.$set(s)},i(l){t||(q(e.$$.fragment,l),t=!0)},o(l){Z(e.$$.fragment,l),t=!1},d(l){Ce(e,l)}}}function mf(n){let e,t,l,o,s,r,u,a,p;t=new On({props:{$$slots:{default:[uf]},$$scope:{ctx:n}}});const d=[pf,df,ff],m=[];function _(h,g){return h[2]?0:h[1].length?1:2}return o=_(n),s=m[o]=d[o](n),{c(){e=f("form"),$e(t.$$.fragment),l=b(),s.c(),r=Nt()},m(h,g){S(h,e,g),Te(t,e,null),S(h,l,g),m[o].m(h,g),S(h,r,g),u=!0,a||(p=ee(e,"submit",Zi(n[15])),a=!0)},p(h,g){const w={};g[0]&505|g[1]&8388608&&(w.$$scope={dirty:g,ctx:h}),t.$set(w);let C=o;o=_(h),o===C?m[o].p(h,g):(rt(),Z(m[C],1,1,()=>{m[C]=null}),it(),s=m[o],s?s.p(h,g):(s=m[o]=d[o](h),s.c()),q(s,1),s.m(r.parentNode,r))},i(h){u||(q(t.$$.fragment,h),q(s),u=!0)},o(h){Z(t.$$.fragment,h),Z(s),u=!1},d(h){h&&($(e),$(l),$(r)),Ce(t),m[o].d(h),a=!1,p()}}}function _f(n,e,t){let l,o,s,r,u,a,p;lt(n,ka,j=>t(29,o=j)),lt(n,Sn,j=>t(0,s=j)),lt(n,It,j=>t(30,r=j)),lt(n,Dt,j=>t(7,u=j)),lt(n,tl,j=>t(18,a=j)),lt(n,ln,j=>t(8,p=j));let d=[],m=null,_=[],h=-1,g=null,w=[],C=null,y=!1;function T(){return`terraphim:searchState:${u}`}function k(){try{if(typeof window>"u")return;const j=localStorage.getItem(T());if(!j)return;const W=JSON.parse(j);typeof W.input=="string"&&vn(Sn,s=W.input,s),Array.isArray(W.results)&&t(1,d=W.results)}catch(j){console.warn("Failed to load search state:",j)}}function v(){try{if(typeof window>"u")return;const j={input:s,results:d};localStorage.setItem(T(),JSON.stringify(j))}catch(j){console.warn("Failed to save search state:",j)}}let L=null;Dn(()=>{k()}),Xl(()=>{L&&clearTimeout(L),g&&(g.close(),g=null),D()});function R(){if(r){N();return}g&&g.close();const W=`${o.replace("/documents/search","")}/summarization/stream`;try{g=new EventSource(W),g.onopen=()=>{console.log("SSE connection opened for summarization updates")},g.onmessage=le=>{try{const ie=JSON.parse(le.data);console.log("SSE received:",ie),ie.task_id&&ie.status==="completed"&&ie.summary&&B(ie.task_id,ie.summary)}catch(ie){console.warn("Failed to parse SSE message:",ie)}},g.onerror=le=>{console.warn("SSE connection error:",le),setTimeout(()=>{g&&R()},5e3)}}catch(le){console.error("Failed to create SSE connection:",le)}}let A=null;function N(){console.log("Starting polling for summary updates (Tauri mode)"),A&&clearInterval(A),A=setInterval(async()=>{if(d.length!==0)try{const j=F();if(!j)return;const W=await Ze("search",{searchQuery:j});if(W.status==="success"){const le=W.results;let ie=!1;for(let ce=0;ce<Math.min(d.length,le.length);ce++)!d[ce].summarization&&le[ce].summarization&&(ie=!0,console.log(`New AI summary found for document: ${le[ce].title}`));ie&&(t(1,d=le),console.log("Updated results with new AI summaries"),v()),d.filter(ce=>!ce.summarization&&ce.body&&ce.body.length>500).length===0&&(console.log("All summaries complete, stopping polling"),D())}}catch(j){console.error("Error during summary polling:",j)}},2e3),setTimeout(()=>{A&&(console.log("Stopping summary polling after timeout"),D())},3e4)}function D(){A&&(clearInterval(A),A=null)}function B(j,W){t(1,d=d.map(le=>!le.summarization&&le.body&&le.body.length>500?{...le,summarization:W}:le)),console.log(`Updated document summary for task ${j}:`,W),v()}function V(j){const W=Cl(j);if(W.hasOperator&&W.terms.length>1){const le=W.terms.map(ce=>{const fe=l.some(([de])=>de.toLowerCase()===ce.toLowerCase());return{value:ce,isFromKG:fe}}),ie=w.map(ce=>ce.value),_e=le.map(ce=>ce.value);(JSON.stringify(ie)!==JSON.stringify(_e)||C!==W.operator)&&(t(5,w=le),t(6,C=W.operator))}else W.terms.length===1&&w.length>0?(t(5,w=[]),t(6,C=null)):W.terms.length===0&&(t(5,w=[]),t(6,C=null))}async function O(j){try{if(r){const W=await Ze("get_autocomplete_suggestions",{query:j,roleName:u,limit:8});if(W.status==="success"&&W.suggestions)return W.suggestions.map(le=>le.term)}else{const W=await fetch(`${o.replace("/documents/search","")}/autocomplete/${encodeURIComponent(u)}/${encodeURIComponent(j)}`);if(W.ok){const le=await W.json();if(le.status==="success"&&le.suggestions)return le.suggestions.map(ie=>ie.term)}}return l.filter(([W])=>W.toLowerCase().includes(j.toLowerCase())).map(([W])=>W).slice(0,8)}catch(W){return console.warn("Error fetching term suggestions:",W),[]}}async function E(j){const W=j.trim();if(W.length===0)return[];const ie=Cl(W),_e=W.split(/\s+/),ce=_e[_e.length-1].toLowerCase();if(ie.hasOperator&&ie.terms.length>0){const de=ie.terms[ie.terms.length-1];return de&&de.length>=2?O(de):[]}if(_e.length>1){const de=[];if("and".startsWith(ce)&&de.push("AND"),"or".startsWith(ce)&&de.push("OR"),de.length>0)return de}const fe=W.toLowerCase();if(fe.includes(" and ")||fe.includes(" or ")||fe.includes(" AND ")||fe.includes(" OR ")){const de=ce;return de.length<2?[]:O(de)}try{return(await O(W)).slice(0,7)}catch(de){return console.warn("Error fetching autocomplete suggestions:",de),l.filter(([Xe])=>Xe.toLowerCase().includes(W.toLowerCase())).map(([Xe])=>Xe).slice(0,5).slice(0,7)}}async function te(j){const W=j.target;if(!W||W.selectionStart==null)return;const le=W.selectionStart,_e=s.slice(0,le).split(/\s+/),ce=_e[_e.length-1];if(ce.toLowerCase()==="a"||ce.toLowerCase()==="an")t(3,_=["AND"]);else if(ce.toLowerCase()==="o"||ce.toLowerCase()==="or")t(3,_=["OR"]);else if(ce.length>=2)try{const fe=await E(ce);t(3,_=fe)}catch(fe){console.warn("Failed to get suggestions:",fe),t(3,_=[])}else t(3,_=[]);t(4,h=-1)}function M(j){_.length>0?j.key==="ArrowDown"?(j.preventDefault(),t(4,h=(h+1)%_.length)):j.key==="ArrowUp"?(j.preventDefault(),t(4,h=(h-1+_.length)%_.length)):(j.key==="Enter"||j.key==="Tab")&&h!==-1?(j.preventDefault(),J(_[h])):j.key==="Escape"&&(j.preventDefault(),t(3,_=[]),t(4,h=-1)):j.key==="Enter"&&(j.preventDefault(),X())}function X(){V(s),K()}function J(j){if(j==="AND"||j==="OR"){t(6,C=j);const W=Cl(s);W.terms.length>0&&!w.some(le=>le.value===W.terms[W.terms.length-1])&&H(W.terms[W.terms.length-1]),vn(Sn,s=s+` ${j} `,s)}else{const W=s.trim().split(/\s+/),le=W[W.length-1];j.toLowerCase().startsWith(le.toLowerCase())?(W[W.length-1]=j,vn(Sn,s=W.join(" "),s)):H(j,C)}t(3,_=[]),t(4,h=-1)}function F(){const j=s.trim();if(!j)return null;const W=Cl(j);return{...sf(W,u),skip:0,limit:10}}function H(j,W=null){const le=l.some(([ie])=>ie.toLowerCase()===j.toLowerCase());w.some(ie=>ie.value.toLowerCase()===j.toLowerCase())||(t(5,w=[...w,{value:j,isFromKG:le}]),W&&w.length>1&&t(6,C=W),P(),v())}function z(j){t(5,w=w.filter(W=>W.value!==j)),P(),v()}function P(){if(t(16,y=!0),w.length===0)vn(Sn,s="",s),t(6,C=null);else if(w.length===1)vn(Sn,s=w[0].value,s),t(6,C=null);else{const j=C||"AND";vn(Sn,s=w.map(W=>W.value).join(` ${j} `),s)}setTimeout(()=>{t(16,y=!1)},10)}function U(){t(5,w=[]),t(6,C=null),vn(Sn,s="",s),v()}async function K(){if(t(2,m=null),r){if(!s.trim())return;try{const j=F();if(!j)return;const W=await Ze("search",{searchQuery:j});W.status==="success"?(t(1,d=W.results),console.log("Response results"),console.log(d),v()):(t(2,m=`Search failed: ${W.status}`),console.error("Search failed:",W))}catch(j){t(2,m=`Error in Tauri search: ${j}`),console.error("Error in Tauri search:",j)}}else{if(!s.trim())return;const j=F();if(!j)return;const W=JSON.stringify(j);try{const le=await fetch(o,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:W}),ie=await le.json();if(!le.ok)throw new Error(`HTTP error! Status: ${le.status}`);t(1,d=ie.results),v(),R()}catch(le){console.error("Error fetching data:",le),t(2,m=`Error fetching data: ${le}`)}}}function Y(j){s=j,Sn.set(s)}const re=j=>J(j),ae=(j,W)=>{(W.key==="Enter"||W.key===" ")&&(W.preventDefault(),J(j))},ne=j=>z(j.value),Q=j=>z(j.value),ue=()=>V(s),se=()=>window.location.href="/config/wizard";return n.$$.update=()=>{n.$$.dirty[0]&262144&&(l=Object.entries(a)),n.$$.dirty[0]&196609&&s&&!y&&(s.includes(" AND ")||s.includes(" OR ")||s.includes(" and ")||s.includes(" or "))&&(L&&clearTimeout(L),t(17,L=setTimeout(()=>{V(s),t(17,L=null)},300)))},[s,d,m,_,h,w,C,u,p,V,te,M,J,z,U,K,y,L,a,Y,re,ae,ne,Q,ue,se]}class hf extends Ht{constructor(e){super(),Ft(this,e,_f,mf,jt,{},null,[-1,-1])}}function Es(n,e,t){const l=n.slice();return l[25]=e[t],l}function As(n){let e,t,l,o,s,r;return{c(){e=f("div"),t=I(n[6]),l=b(),o=f("button"),c(o,"type","button"),c(o,"class","btn-close btn-close-sm svelte-esvdw6"),c(e,"class","alert alert-danger alert-sm svelte-esvdw6"),c(e,"role","alert")},m(u,a){S(u,e,a),i(e,t),i(e,l),i(e,o),s||(r=ee(o,"click",n[18]),s=!0)},p(u,a){a&64&&ve(t,u[6])},d(u){u&&$(e),s=!1,r()}}}function Ls(n){let e;return{c(){e=f("div"),e.innerHTML='<div class="spinner-border spinner-border-sm" role="status"><span class="visually-hidden">Loading...</span></div> <span>Loading conversations...</span>',c(e,"class","loading-state svelte-esvdw6")},m(t,l){S(t,e,l)},d(t){t&&$(e)}}}function gf(n){let e=[],t=new Map,l,o=Ge(n[9]);const s=r=>r[25].id;for(let r=0;r<o.length;r+=1){let u=Es(n,o,r),a=s(u);t.set(a,e[r]=Ns(a,u))}return{c(){for(let r=0;r<e.length;r+=1)e[r].c();l=Nt()},m(r,u){for(let a=0;a<e.length;a+=1)e[a]&&e[a].m(r,u);S(r,l,u)},p(r,u){u&4995&&(o=Ge(r[9]),e=fi(e,u,s,1,r,o,t,l.parentNode,di,Ns,l,Es))},d(r){r&&$(l);for(let u=0;u<e.length;u+=1)e[u].d(r)}}}function vf(n){let e,t,l,o,s,r,u,a;return{c(){e=f("div"),t=f("i"),l=b(),o=f("p"),o.textContent="No conversations yet",s=b(),r=f("button"),r.textContent="Start your first chat",c(t,"class","bi bi-chat-dots svelte-esvdw6"),c(o,"class","svelte-esvdw6"),c(r,"class","btn btn-sm btn-outline-primary"),c(e,"class","empty-state svelte-esvdw6")},m(p,d){S(p,e,d),i(e,t),i(e,l),i(e,o),i(e,s),i(e,r),u||(a=ee(r,"click",function(){ul(n[2])&&n[2].apply(this,arguments)}),u=!0)},p(p,d){n=p},d(p){p&&$(e),u=!1,a()}}}function bf(n){let e,t,l;function o(){return n[21](n[25])}return{c(){e=f("button"),e.innerHTML='<i class="bi bi-trash"></i>',c(e,"class","btn btn-sm btn-ghost svelte-esvdw6"),c(e,"title","Delete conversation")},m(s,r){S(s,e,r),t||(l=ee(e,"click",Sl(o)),t=!0)},p(s,r){n=s},d(s){s&&$(e),t=!1,l()}}}function kf(n){let e,t,l,o,s,r,u;function a(){return n[19](n[25])}return{c(){e=f("button"),t=f("i"),l=b(),o=f("button"),s=f("i"),c(t,"class","bi bi-check-lg"),c(e,"class","btn btn-sm btn-danger"),e.disabled=n[8],c(e,"title","Confirm delete"),c(s,"class","bi bi-x-lg"),c(o,"class","btn btn-sm btn-secondary"),o.disabled=n[8],c(o,"title","Cancel")},m(p,d){S(p,e,d),i(e,t),S(p,l,d),S(p,o,d),i(o,s),r||(u=[ee(e,"click",Sl(a)),ee(o,"click",Sl(n[20]))],r=!0)},p(p,d){n=p,d&256&&(e.disabled=n[8]),d&256&&(o.disabled=n[8])},d(p){p&&($(e),$(l),$(o)),r=!1,ft(u)}}}function Ds(n){let e,t=n[25].preview+"",l;return{c(){e=f("p"),l=I(t),c(e,"class","conversation-preview svelte-esvdw6")},m(o,s){S(o,e,s),i(e,l)},p(o,s){s&512&&t!==(t=o[25].preview+"")&&ve(l,t)},d(o){o&&$(e)}}}function Ns(n,e){let t,l,o,s=e[25].title+"",r,u,a,p,d,m,_=e[25].role+"",h,g,w,C,y,T=e[25].message_count+"",k,v,L,R=Is(e[25].updated_at)+"",A,N,D,B,V;function O(F,H){return F[7]===F[25].id?kf:bf}let E=O(e),te=E(e),M=e[25].preview&&Ds(e);function X(){return e[22](e[25])}function J(...F){return e[23](e[25],...F)}return{key:n,first:null,c(){t=f("div"),l=f("div"),o=f("h4"),r=I(s),u=b(),a=f("div"),te.c(),p=b(),d=f("div"),m=f("span"),h=I(_),g=b(),w=f("span"),C=f("i"),y=b(),k=I(T),v=b(),L=f("span"),A=I(R),N=b(),M&&M.c(),D=b(),c(o,"class","conversation-title svelte-esvdw6"),c(a,"class","conversation-actions svelte-esvdw6"),c(l,"class","conversation-header svelte-esvdw6"),c(m,"class","badge bg-secondary"),c(C,"class","bi bi-chat-left-text"),c(w,"class","message-count svelte-esvdw6"),c(L,"class","timestamp svelte-esvdw6"),c(d,"class","conversation-meta svelte-esvdw6"),c(t,"class","conversation-item svelte-esvdw6"),c(t,"role","button"),c(t,"tabindex","0"),Lt(t,"active",e[0]===e[25].id),this.first=t},m(F,H){S(F,t,H),i(t,l),i(l,o),i(o,r),i(l,u),i(l,a),te.m(a,null),i(t,p),i(t,d),i(d,m),i(m,h),i(d,g),i(d,w),i(w,C),i(w,y),i(w,k),i(d,v),i(d,L),i(L,A),i(t,N),M&&M.m(t,null),i(t,D),B||(V=[ee(t,"click",X),ee(t,"keydown",J)],B=!0)},p(F,H){e=F,H&512&&s!==(s=e[25].title+"")&&ve(r,s),E===(E=O(e))&&te?te.p(e,H):(te.d(1),te=E(e),te&&(te.c(),te.m(a,null))),H&512&&_!==(_=e[25].role+"")&&ve(h,_),H&512&&T!==(T=e[25].message_count+"")&&ve(k,T),H&512&&R!==(R=Is(e[25].updated_at)+"")&&ve(A,R),e[25].preview?M?M.p(e,H):(M=Ds(e),M.c(),M.m(t,D)):M&&(M.d(1),M=null),H&513&&Lt(t,"active",e[0]===e[25].id)},d(F){F&&$(t),te.d(),M&&M.d(),B=!1,ft(V)}}}function wf(n){let e,t,l,o,s,r,u,a,p,d,m,_,h,g,w,C,y,T,k,v,L,R,A,N,D=n[9].length+"",B,V,O=n[9].length!==1?"s":"",E,te,M,X,J,F=n[6]&&As(n),H=n[5]&&Ls();function z(K,Y){return!K[5]&&K[9].length===0?vf:gf}let P=z(n),U=P(n);return{c(){e=f("div"),t=f("div"),l=f("h3"),l.textContent="Chat History",o=b(),s=f("button"),s.innerHTML='<i class="bi bi-plus-lg"></i> New Chat',r=b(),u=f("div"),a=f("div"),p=f("input"),d=b(),m=f("i"),_=b(),h=f("div"),g=f("select"),w=f("option"),w.textContent="All Roles",C=f("option"),y=I(n[10]),T=b(),F&&F.c(),k=b(),H&&H.c(),v=b(),L=f("div"),U.c(),R=b(),A=f("div"),N=f("small"),B=I(D),V=I(" conversation"),E=I(O),te=b(),M=f("button"),M.innerHTML='<i class="bi bi-arrow-clockwise"></i>',c(l,"class","svelte-esvdw6"),c(s,"class","btn btn-sm btn-primary new-chat-btn svelte-esvdw6"),c(s,"title","Start new conversation"),c(t,"class","session-list-header svelte-esvdw6"),c(p,"type","text"),c(p,"class","form-control form-control-sm svelte-esvdw6"),c(p,"placeholder","Search conversations..."),c(m,"class","bi bi-search search-icon svelte-esvdw6"),c(a,"class","search-box svelte-esvdw6"),w.__value=null,ke(w,w.__value),C.__value=n[10],ke(C,C.__value),c(g,"class","form-select form-select-sm"),n[4]===void 0&&Pt(()=>n[17].call(g)),c(h,"class","filter-box"),c(u,"class","session-list-controls svelte-esvdw6"),c(L,"class","conversation-list svelte-esvdw6"),c(N,"class","text-muted"),c(M,"class","btn btn-sm btn-ghost svelte-esvdw6"),c(M,"title","Refresh"),c(A,"class","session-list-footer svelte-esvdw6"),c(e,"class","session-list svelte-esvdw6")},m(K,Y){S(K,e,Y),i(e,t),i(t,l),i(t,o),i(t,s),i(e,r),i(e,u),i(u,a),i(a,p),ke(p,n[3]),i(a,d),i(a,m),i(u,_),i(u,h),i(h,g),i(g,w),i(g,C),i(C,y),pt(g,n[4],!0),i(e,T),F&&F.m(e,null),i(e,k),H&&H.m(e,null),i(e,v),i(e,L),U.m(L,null),i(e,R),i(e,A),i(A,N),i(N,B),i(N,V),i(N,E),i(A,te),i(A,M),X||(J=[ee(s,"click",function(){ul(n[2])&&n[2].apply(this,arguments)}),ee(p,"input",n[16]),ee(p,"input",n[13]),ee(g,"change",n[17]),ee(g,"change",n[14]),ee(M,"click",n[11])],X=!0)},p(K,[Y]){n=K,Y&8&&p.value!==n[3]&&ke(p,n[3]),Y&1024&&ve(y,n[10]),Y&1024&&(C.__value=n[10],ke(C,C.__value)),Y&1040&&pt(g,n[4]),n[6]?F?F.p(n,Y):(F=As(n),F.c(),F.m(e,k)):F&&(F.d(1),F=null),n[5]?H||(H=Ls(),H.c(),H.m(e,v)):H&&(H.d(1),H=null),P===(P=z(n))&&U?U.p(n,Y):(U.d(1),U=P(n),U&&(U.c(),U.m(L,null))),Y&512&&D!==(D=n[9].length+"")&&ve(B,D),Y&512&&O!==(O=n[9].length!==1?"s":"")&&ve(E,O)},i:Fe,o:Fe,d(K){K&&$(e),F&&F.d(),H&&H.d(),U.d(),X=!1,ft(J)}}}function Is(n){const e=new Date(n),l=new Date().getTime()-e.getTime(),o=Math.floor(l/6e4),s=Math.floor(l/36e5),r=Math.floor(l/864e5);return o<1?"Just now":o<60?`${o}m ago`:s<24?`${s}h ago`:r<7?`${r}d ago`:e.toLocaleDateString()}function yf(n,e,t){let l,o;lt(n,Dt,O=>t(10,o=O));let{currentConversationId:s=null}=e,{onSelectConversation:r=()=>{}}=e,{onNewConversation:u=()=>{}}=e,a=[],p=!1,d=null,m="",_=null,h=null,g=!1;Dn(()=>{w()});async function w(){t(5,p=!0),t(6,d=null);try{const O=await Ze("list_persistent_conversations",{role:_,limit:100});O.status==="success"?t(15,a=O.conversations):t(6,d=O.error||"Failed to load conversations")}catch(O){console.error("Failed to load conversations:",O),t(6,d=String(O))}finally{t(5,p=!1)}}async function C(){if(!m.trim()){await w();return}t(5,p=!0),t(6,d=null);try{const O=await Ze("search_persistent_conversations",{query:m});O.status==="success"?t(15,a=O.conversations):t(6,d=O.error||"Search failed")}catch(O){console.error("Search failed:",O),t(6,d=String(O))}finally{t(5,p=!1)}}async function y(O){t(8,g=!0),t(6,d=null);try{const E=await Ze("delete_persistent_conversation",{conversationId:O});E.status==="success"?(t(15,a=a.filter(te=>te.id!==O)),t(7,h=null),s===O&&u()):t(6,d=E.error||"Failed to delete conversation")}catch(E){console.error("Failed to delete conversation:",E),t(6,d=String(E))}finally{t(8,g=!1)}}async function T(){if(t(3,m=m.trim()),!m){await w();return}await C()}async function k(){t(4,_=_||null),await w()}function v(){m=this.value,t(3,m)}function L(){_=Xt(this),t(4,_)}const R=()=>t(6,d=null),A=O=>y(O.id),N=()=>t(7,h=null),D=O=>t(7,h=O.id),B=O=>r(O.id),V=(O,E)=>E.key==="Enter"&&r(O.id);return n.$$set=O=>{"currentConversationId"in O&&t(0,s=O.currentConversationId),"onSelectConversation"in O&&t(1,r=O.onSelectConversation),"onNewConversation"in O&&t(2,u=O.onNewConversation)},n.$$.update=()=>{n.$$.dirty&16&&bt(Dt)&&_!==bt(Dt)&&(t(4,_=bt(Dt)),w()),n.$$.dirty&32792&&t(9,l=a.filter(O=>{const E=!m||O.title.toLowerCase().includes(m.toLowerCase())||O.preview&&O.preview.toLowerCase().includes(m.toLowerCase()),te=!_||O.role===_;return E&&te}))},[s,r,u,m,_,p,d,h,g,l,o,w,y,T,k,a,v,L,R,A,N,D,B,V]}class Cf extends Ht{constructor(e){super(),Ft(this,e,yf,wf,jt,{currentConversationId:0,onSelectConversation:1,onNewConversation:2})}}function Ms(n,e,t){const l=n.slice();return l[19]=e[t][0],l[20]=e[t][1],l[21]=e,l[22]=t,l}function Ps(n,e,t){const l=n.slice();return l[23]=e[t],l}function js(n){let e,t,l,o,s,r,u,a,p,d,m,_,h,g,w=n[2].title.trim()==="",C,y,T,k,v,L,R,A,N,D,B,V,O,E,te,M=n[2].content.trim()==="",X,J,F,H,z,P,U,K,Y,re,ae,ne,Q,ue,se,j,W,le,ie,_e,ce,fe=n[1]==="edit"?"Save Changes":"Add Context",de,ze,Xe,qe,Me,Pe,he,Ue,xe,Ve,We=Ge(n[4]),Ke=[];for(let ye=0;ye<We.length;ye+=1)Ke[ye]=Us(Ps(n,We,ye));let Ye=w&&Hs();function ct(ye,be){return ye[2].summary?$f:Tf}let ht=ct(n),tt=ht(n),x=M&&Fs();function we(ye,be){return be&4&&(ae=null),ae==null&&(ae=Object.keys(ye[2].metadata).length===0),ae?Of:Sf}let Re=we(n,-1),Le=Re(n),Ee=n[1]==="edit"&&Ks(n);return{c(){e=f("section"),t=f("div"),l=f("label"),l.textContent="Type",o=b(),s=f("div"),r=f("div"),u=f("select");for(let ye=0;ye<Ke.length;ye+=1)Ke[ye].c();a=b(),p=f("div"),d=f("label"),d.textContent="Title *",m=b(),_=f("div"),h=f("input"),g=b(),Ye&&Ye.c(),C=b(),y=f("div"),T=f("label"),T.textContent="Summary",k=b(),v=f("div"),L=f("textarea"),R=b(),A=f("p"),tt.c(),N=b(),D=f("div"),B=f("label"),B.textContent="Content *",V=b(),O=f("div"),E=f("textarea"),te=b(),x&&x.c(),X=b(),J=f("details"),F=f("summary"),F.innerHTML='<span class="icon-text"><span class="icon"><i class="fas fa-cog"></i></span> <span>Advanced Options</span></span>',H=b(),z=f("div"),P=f("label"),P.textContent="Metadata",U=b(),K=f("div"),Y=f("p"),Y.textContent="Additional key-value pairs for this context item",re=b(),Le.c(),ne=b(),Q=f("button"),Q.innerHTML='<span class="icon"><i class="fas fa-plus"></i></span> <span>Add Metadata</span>',ue=b(),se=f("footer"),j=f("div"),W=f("div"),le=f("button"),ie=f("span"),ie.innerHTML='<i class="fas fa-save"></i>',_e=b(),ce=f("span"),de=I(fe),Xe=b(),qe=f("div"),Me=f("button"),Me.innerHTML="<span>Cancel</span>",Pe=b(),Ee&&Ee.c(),he=b(),Ue=f("div"),Ue.innerHTML=`<strong>Keyboard shortcuts:</strong>
          Ctrl/Cmd + Enter to save, Escape to close`,c(l,"class","label"),c(l,"for","context-type"),c(u,"id","context-type"),c(u,"data-testid","context-type-select"),n[2].context_type===void 0&&Pt(()=>n[10].call(u)),c(r,"class","select is-fullwidth"),c(s,"class","control"),c(t,"class","field"),c(d,"class","label"),c(d,"for","context-title"),c(h,"id","context-title"),c(h,"class","input"),c(h,"type","text"),c(h,"placeholder","Enter title..."),c(h,"data-testid","context-title-input"),h.required=!0,c(_,"class","control"),c(p,"class","field"),c(T,"class","label"),c(T,"for","context-summary"),c(L,"id","context-summary"),c(L,"class","textarea svelte-1oesbw7"),c(L,"placeholder","Brief summary of the content (optional)..."),c(L,"data-testid","context-summary-textarea"),c(L,"rows","3"),c(L,"maxlength","500"),c(v,"class","control"),c(A,"class","help svelte-1oesbw7"),c(y,"class","field"),c(B,"class","label"),c(B,"for","context-content"),c(E,"id","context-content"),c(E,"class","textarea svelte-1oesbw7"),c(E,"placeholder","Enter the full content..."),c(E,"data-testid","context-content-textarea"),c(E,"rows","8"),E.required=!0,c(O,"class","control"),c(D,"class","field"),c(F,"class","summary svelte-1oesbw7"),c(P,"class","label"),c(Y,"class","help svelte-1oesbw7"),c(Q,"class","button is-small is-light"),c(K,"class","content"),c(z,"class","field mt-4"),c(J,"class","details svelte-1oesbw7"),c(e,"class","modal-card-body svelte-1oesbw7"),c(ie,"class","icon"),c(le,"class","button is-primary"),le.disabled=ze=!n[3],c(le,"data-testid","save-context-button"),c(W,"class","control"),c(Me,"class","button is-light"),c(Me,"data-testid","cancel-context-button"),c(qe,"class","control"),c(j,"class","field is-grouped"),c(Ue,"class","help svelte-1oesbw7"),c(se,"class","modal-card-foot")},m(ye,be){S(ye,e,be),i(e,t),i(t,l),i(t,o),i(t,s),i(s,r),i(r,u);for(let De=0;De<Ke.length;De+=1)Ke[De]&&Ke[De].m(u,null);pt(u,n[2].context_type,!0),i(e,a),i(e,p),i(p,d),i(p,m),i(p,_),i(_,h),ke(h,n[2].title),i(p,g),Ye&&Ye.m(p,null),i(e,C),i(e,y),i(y,T),i(y,k),i(y,v),i(v,L),ke(L,n[2].summary),i(y,R),i(y,A),tt.m(A,null),i(e,N),i(e,D),i(D,B),i(D,V),i(D,O),i(O,E),ke(E,n[2].content),i(D,te),x&&x.m(D,null),i(e,X),i(e,J),i(J,F),i(J,H),i(J,z),i(z,P),i(z,U),i(z,K),i(K,Y),i(K,re),Le.m(K,null),i(K,ne),i(K,Q),S(ye,ue,be),S(ye,se,be),i(se,j),i(j,W),i(W,le),i(le,ie),i(le,_e),i(le,ce),i(ce,de),i(j,Xe),i(j,qe),i(qe,Me),i(j,Pe),Ee&&Ee.m(j,null),i(se,he),i(se,Ue),xe||(Ve=[ee(u,"change",n[10]),ee(h,"input",n[11]),ee(L,"input",n[12]),ee(E,"input",n[13]),ee(Q,"click",n[17]),ee(le,"click",n[6]),ee(Me,"click",n[5])],xe=!0)},p(ye,be){if(be&16){We=Ge(ye[4]);let De;for(De=0;De<We.length;De+=1){const Tt=Ps(ye,We,De);Ke[De]?Ke[De].p(Tt,be):(Ke[De]=Us(Tt),Ke[De].c(),Ke[De].m(u,null))}for(;De<Ke.length;De+=1)Ke[De].d(1);Ke.length=We.length}be&20&&pt(u,ye[2].context_type),be&20&&h.value!==ye[2].title&&ke(h,ye[2].title),be&4&&(w=ye[2].title.trim()===""),w?Ye||(Ye=Hs(),Ye.c(),Ye.m(p,null)):Ye&&(Ye.d(1),Ye=null),be&20&&ke(L,ye[2].summary),ht===(ht=ct(ye))&&tt?tt.p(ye,be):(tt.d(1),tt=ht(ye),tt&&(tt.c(),tt.m(A,null))),be&20&&ke(E,ye[2].content),be&4&&(M=ye[2].content.trim()===""),M?x||(x=Fs(),x.c(),x.m(D,null)):x&&(x.d(1),x=null),Re===(Re=we(ye,be))&&Le?Le.p(ye,be):(Le.d(1),Le=Re(ye),Le&&(Le.c(),Le.m(K,ne))),be&2&&fe!==(fe=ye[1]==="edit"?"Save Changes":"Add Context")&&ve(de,fe),be&8&&ze!==(ze=!ye[3])&&(le.disabled=ze),ye[1]==="edit"?Ee?Ee.p(ye,be):(Ee=Ks(ye),Ee.c(),Ee.m(j,null)):Ee&&(Ee.d(1),Ee=null)},d(ye){ye&&($(e),$(ue),$(se)),Ct(Ke,ye),Ye&&Ye.d(),tt.d(),x&&x.d(),Le.d(),Ee&&Ee.d(),xe=!1,ft(Ve)}}}function Us(n){let e,t=n[23].label+"",l;return{c(){e=f("option"),l=I(t),e.__value=n[23].value,ke(e,e.__value)},m(o,s){S(o,e,s),i(e,l)},p:Fe,d(o){o&&$(e)}}}function Hs(n){let e;return{c(){e=f("p"),e.textContent="Title is required",c(e,"class","help is-danger svelte-1oesbw7")},m(t,l){S(t,e,l)},d(t){t&&$(e)}}}function Tf(n){let e;return{c(){e=I("Optional brief summary (up to 500 characters)")},m(t,l){S(t,e,l)},p:Fe,d(t){t&&$(e)}}}function $f(n){let e=n[2].summary.length+"",t,l;return{c(){t=I(e),l=I("/500 characters")},m(o,s){S(o,t,s),S(o,l,s)},p(o,s){s&4&&e!==(e=o[2].summary.length+"")&&ve(t,e)},d(o){o&&($(t),$(l))}}}function Fs(n){let e;return{c(){e=f("p"),e.textContent="Content is required",c(e,"class","help is-danger svelte-1oesbw7")},m(t,l){S(t,e,l)},d(t){t&&$(e)}}}function Sf(n){let e,t=Ge(Object.entries(n[2].metadata)),l=[];for(let o=0;o<t.length;o+=1)l[o]=zs(Ms(n,t,o));return{c(){for(let o=0;o<l.length;o+=1)l[o].c();e=Nt()},m(o,s){for(let r=0;r<l.length;r+=1)l[r]&&l[r].m(o,s);S(o,e,s)},p(o,s){if(s&4){t=Ge(Object.entries(o[2].metadata));let r;for(r=0;r<t.length;r+=1){const u=Ms(o,t,r);l[r]?l[r].p(u,s):(l[r]=zs(u),l[r].c(),l[r].m(e.parentNode,e))}for(;r<l.length;r+=1)l[r].d(1);l.length=t.length}},d(o){o&&$(e),Ct(l,o)}}}function Of(n){let e;return{c(){e=f("p"),e.textContent="No metadata defined",c(e,"class","has-text-grey-light")},m(t,l){S(t,e,l)},p:Fe,d(t){t&&$(e)}}}function zs(n){let e,t,l,o,s,r,u,a,p,d,m,_,h;function g(...y){return n[14](n[19],n[20],...y)}function w(){n[15].call(u,n[19])}function C(){return n[16](n[19])}return{c(){e=f("div"),t=f("div"),l=f("input"),s=b(),r=f("div"),u=f("input"),a=b(),p=f("div"),d=f("button"),d.innerHTML='<span class="icon"><i class="fas fa-times"></i></span>',m=b(),c(l,"class","input is-small"),c(l,"type","text"),c(l,"placeholder","Key"),l.value=o=n[19],c(t,"class","control is-expanded"),c(u,"class","input is-small"),c(u,"type","text"),c(u,"placeholder","Value"),c(r,"class","control is-expanded"),c(d,"class","button is-small is-danger is-outlined"),c(p,"class","control"),c(e,"class","field is-grouped")},m(y,T){S(y,e,T),i(e,t),i(t,l),i(e,s),i(e,r),i(r,u),ke(u,n[2].metadata[n[19]]),i(e,a),i(e,p),i(p,d),i(e,m),_||(h=[ee(l,"input",g),ee(u,"input",w),ee(d,"click",C)],_=!0)},p(y,T){n=y,T&20&&o!==(o=n[19])&&l.value!==o&&(l.value=o),T&20&&u.value!==n[2].metadata[n[19]]&&ke(u,n[2].metadata[n[19]])},d(y){y&&$(e),_=!1,ft(h)}}}function Ks(n){let e,t,l,o,s,r;return{c(){e=f("div"),t=b(),l=f("div"),o=f("button"),o.innerHTML='<span class="icon"><i class="fas fa-trash"></i></span> <span>Delete</span>',c(e,"class","control is-expanded"),c(o,"class","button is-danger is-outlined"),c(o,"data-testid","delete-context-button"),c(l,"class","control")},m(u,a){S(u,e,a),S(u,t,a),S(u,l,a),i(l,o),s||(r=ee(o,"click",n[7]),s=!0)},p:Fe,d(u){u&&($(e),$(t),$(l)),s=!1,r()}}}function Rf(n){let e,t,l,o=n[1]==="edit"?"Edit Context Item":"Add Context Item",s,r,u,a,p,d,m=n[2]&&js(n);return{c(){e=f("div"),t=f("header"),l=f("p"),s=I(o),r=b(),u=f("button"),a=b(),m&&m.c(),c(l,"class","modal-card-title"),c(u,"class","delete"),c(u,"aria-label","close"),c(t,"class","modal-card-head"),c(e,"class","modal-card")},m(_,h){S(_,e,h),i(e,t),i(t,l),i(l,s),i(t,r),i(t,u),i(e,a),m&&m.m(e,null),p||(d=ee(u,"click",n[5]),p=!0)},p(_,h){h&2&&o!==(o=_[1]==="edit"?"Edit Context Item":"Add Context Item")&&ve(s,o),_[2]?m?m.p(_,h):(m=js(_),m.c(),m.m(e,null)):m&&(m.d(1),m=null)},d(_){_&&$(e),m&&m.d(),p=!1,d()}}}function Ef(n){let e,t,l,o;return e=new Al({props:{active:n[0],$$slots:{default:[Rf]},$$scope:{ctx:n}}}),e.$on("close",n[5]),{c(){$e(e.$$.fragment)},m(s,r){Te(e,s,r),t=!0,l||(o=ee(window,"keydown",n[8]),l=!0)},p(s,[r]){const u={};r&1&&(u.active=s[0]),r&67108878&&(u.$$scope={dirty:r,ctx:s}),e.$set(u)},i(s){t||(q(e.$$.fragment,s),t=!0)},o(s){Z(e.$$.fragment,s),t=!1},d(s){Ce(e,s),l=!1,o()}}}function Af(n,e,t){let l,{active:o=!1}=e,{context:s=null}=e,{mode:r="edit"}=e;const u=xl();let a=null,p=[{value:"Document",label:"Document"},{value:"SearchResult",label:"Search Result"},{value:"UserInput",label:"User Input"},{value:"System",label:"System"},{value:"External",label:"External"}];function d(){t(0,o=!1),t(2,a=null),u("close")}function m(){!l||!a||(u(r==="edit"?"update":"create",a),d())}function _(){r==="edit"&&s&&(u("delete",s.id),d())}function h(R){R.key==="Escape"?d():R.key==="Enter"&&(R.ctrlKey||R.metaKey)&&m()}function g(){a.context_type=Xt(this),t(2,a),t(0,o),t(9,s),t(1,r),t(4,p)}function w(){a.title=this.value,t(2,a),t(0,o),t(9,s),t(1,r),t(4,p)}function C(){a.summary=this.value,t(2,a),t(0,o),t(9,s),t(1,r),t(4,p)}function y(){a.content=this.value,t(2,a),t(0,o),t(9,s),t(1,r),t(4,p)}const T=(R,A,N)=>{const D={...a.metadata};delete D[R],D[N.target.value]=A,t(2,a.metadata=D,a)};function k(R){a.metadata[R]=this.value,t(2,a),t(0,o),t(9,s),t(1,r),t(4,p)}const v=R=>{const A={...a.metadata};delete A[R],t(2,a.metadata=A,a)},L=()=>{t(2,a.metadata={...a.metadata,[`key_${Date.now()}`]:""},a)};return n.$$set=R=>{"active"in R&&t(0,o=R.active),"context"in R&&t(9,s=R.context),"mode"in R&&t(1,r=R.mode)},n.$$.update=()=>{n.$$.dirty&515&&(o&&s?t(2,a={...s,metadata:{...s.metadata}}):o&&r==="create"&&t(2,a={id:"",context_type:"UserInput",title:"",summary:"",content:"",metadata:{},created_at:new Date().toISOString(),relevance_score:null})),n.$$.dirty&4&&t(3,l=a&&a.title.trim()!==""&&a.content.trim()!=="")},[o,r,a,l,p,d,m,_,h,s,g,w,C,y,T,k,v,L]}class Lf extends Ht{constructor(e){super(),Ft(this,e,Af,Ef,jt,{active:0,context:9,mode:1})}}function Bs(n,e,t){const l=n.slice();return l[40]=e[t],l}function Ws(n,e,t){const l=n.slice();return l[40]=e[t],l[44]=t,l}function Gs(n){let e,t=Ge(n[5]),l=[];for(let o=0;o<t.length;o+=1)l[o]=qs(Ws(n,t,o));return{c(){e=f("ul");for(let o=0;o<l.length;o+=1)l[o].c();c(e,"class","suggestions svelte-k0eopx"),c(e,"data-testid","kg-autocomplete-list")},m(o,s){S(o,e,s);for(let r=0;r<l.length;r+=1)l[r]&&l[r].m(e,null)},p(o,s){if(s[0]&1120){t=Ge(o[5]);let r;for(r=0;r<t.length;r+=1){const u=Ws(o,t,r);l[r]?l[r].p(u,s):(l[r]=qs(u),l[r].c(),l[r].m(e,null))}for(;r<l.length;r+=1)l[r].d(1);l.length=t.length}},d(o){o&&$(e),Ct(l,o)}}}function qs(n){let e,t=n[40]+"",l,o,s,r,u,a;function p(){return n[24](n[40])}function d(...m){return n[25](n[40],...m)}return{c(){e=f("li"),l=I(t),o=b(),c(e,"tabindex","0"),c(e,"role","option"),c(e,"aria-selected",s=n[44]===n[6]),c(e,"aria-label",r=`Apply suggestion: ${n[40]}`),c(e,"data-testid","kg-autocomplete-item"),c(e,"class","svelte-k0eopx"),Lt(e,"active",n[44]===n[6])},m(m,_){S(m,e,_),i(e,l),i(e,o),u||(a=[ee(e,"click",p),ee(e,"keydown",d)],u=!0)},p(m,_){n=m,_[0]&32&&t!==(t=n[40]+"")&&ve(l,t),_[0]&64&&s!==(s=n[44]===n[6])&&c(e,"aria-selected",s),_[0]&32&&r!==(r=`Apply suggestion: ${n[40]}`)&&c(e,"aria-label",r),_[0]&64&&Lt(e,"active",n[44]===n[6])},d(m){m&&$(e),u=!1,ft(a)}}}function Df(n){let e,t,l,o,s,r;function u(m){n[22](m)}function a(m){n[23](m)}let p={placeholder:"Search knowledge graph terms...",type:"search",disabled:n[7],icon:"search",expanded:!0,autofocus:!0,"data-testid":"kg-search-input"};n[2]!==void 0&&(p.element=n[2]),n[1]!==void 0&&(p.value=n[1]),t=new Zn({props:p}),yt.push(()=>Et(t,"element",u)),yt.push(()=>Et(t,"value",a)),t.$on("input",n[13]),t.$on("keydown",n[14]);let d=n[5].length>0&&Gs(n);return{c(){e=f("div"),$e(t.$$.fragment),s=b(),d&&d.c(),c(e,"class","input-wrapper svelte-k0eopx")},m(m,_){S(m,e,_),Te(t,e,null),i(e,s),d&&d.m(e,null),r=!0},p(m,_){const h={};_[0]&128&&(h.disabled=m[7]),!l&&_[0]&4&&(l=!0,h.element=m[2],At(()=>l=!1)),!o&&_[0]&2&&(o=!0,h.value=m[1],At(()=>o=!1)),t.$set(h),m[5].length>0?d?d.p(m,_):(d=Gs(m),d.c(),d.m(e,null)):d&&(d.d(1),d=null)},i(m){r||(q(t.$$.fragment,m),r=!0)},o(m){Z(t.$$.fragment,m),r=!1},d(m){m&&$(e),Ce(t),d&&d.d()}}}function Vs(n){let e,t;return e=new ea({props:{type:"is-danger","data-testid":"kg-search-error",$$slots:{default:[Nf]},$$scope:{ctx:n}}}),{c(){$e(e.$$.fragment)},m(l,o){Te(e,l,o),t=!0},p(l,o){const s={};o[0]&256|o[1]&16384&&(s.$$scope={dirty:o,ctx:l}),e.$set(s)},i(l){t||(q(e.$$.fragment,l),t=!0)},o(l){Z(e.$$.fragment,l),t=!1},d(l){Ce(e,l)}}}function Nf(n){let e;return{c(){e=I(n[8])},m(t,l){S(t,e,l)},p(t,l){l[0]&256&&ve(e,t[8])},d(t){t&&$(e)}}}function If(n){let e,t,l,o,s,r,u,a;return{c(){e=f("div"),t=f("p"),t.textContent="Enter at least 2 characters to search the knowledge graph",l=b(),o=f("p"),s=I('This will search terms from the knowledge graph for role "'),r=f("strong"),u=I(n[9]),a=I('"'),c(t,"class","has-text-centered"),c(o,"class","has-text-centered is-size-7 mt-2"),c(e,"class","notification is-info is-light")},m(p,d){S(p,e,d),i(e,t),i(e,l),i(e,o),i(o,s),i(o,r),i(r,u),i(o,a)},p(p,d){d[0]&512&&ve(u,p[9])},d(p){p&&$(e)}}}function Mf(n){let e,t,l,o,s,r,u,a,p,d,m,_;return{c(){e=f("div"),t=f("p"),l=I('No knowledge graph terms found for "'),o=f("strong"),s=I(n[1]),r=I('"'),u=b(),a=f("p"),p=I('Try different keywords or check if the role "'),d=f("strong"),m=I(n[9]),_=I('" has a knowledge graph enabled.'),c(t,"class","has-text-centered"),c(a,"class","has-text-centered is-size-7 has-text-grey mt-2"),c(e,"class","notification is-light"),c(e,"data-testid","kg-search-empty")},m(h,g){S(h,e,g),i(e,t),i(t,l),i(t,o),i(o,s),i(t,r),i(e,u),i(e,a),i(a,p),i(a,d),i(d,m),i(a,_)},p(h,g){g[0]&2&&ve(s,h[1]),g[0]&512&&ve(m,h[9])},d(h){h&&$(e)}}}function Pf(n){let e,t=Ge(n[3]),l=[];for(let o=0;o<t.length;o+=1)l[o]=Xs(Bs(n,t,o));return{c(){e=f("div");for(let o=0;o<l.length;o+=1)l[o].c();c(e,"class","suggestions-container svelte-k0eopx"),c(e,"data-testid","kg-suggestions-list")},m(o,s){S(o,e,s);for(let r=0;r<l.length;r+=1)l[r]&&l[r].m(e,null)},p(o,s){if(s[0]&32792){t=Ge(o[3]);let r;for(r=0;r<t.length;r+=1){const u=Bs(o,t,r);l[r]?l[r].p(u,s):(l[r]=Xs(u),l[r].c(),l[r].m(e,null))}for(;r<l.length;r+=1)l[r].d(1);l.length=t.length}},d(o){o&&$(e),Ct(l,o)}}}function jf(n){let e;return{c(){e=f("div"),e.innerHTML='<div class="progress-container svelte-k0eopx"><div class="progress-bar svelte-k0eopx"><div class="progress-fill svelte-k0eopx"></div></div></div> <p>Searching knowledge graph...</p>',c(e,"class","empty-state svelte-k0eopx"),c(e,"data-testid","kg-search-loading")},m(t,l){S(t,e,l)},p:Fe,d(t){t&&$(e)}}}function Js(n){let e,t,l=n[40].normalized_term+"",o;return{c(){e=f("span"),t=I("→ "),o=I(l),c(e,"class","has-text-grey")},m(s,r){S(s,e,r),i(e,t),i(e,o)},p(s,r){r[0]&8&&l!==(l=s[40].normalized_term+"")&&ve(o,l)},d(s){s&&$(e)}}}function Qs(n){let e,t=n[40].suggestion_type+"",l;return{c(){e=f("span"),l=I(t),c(e,"class","tag is-small is-light")},m(o,s){S(o,e,s),i(e,l)},p(o,s){s[0]&8&&t!==(t=o[40].suggestion_type+"")&&ve(l,t)},d(o){o&&$(e)}}}function Ys(n){let e,t=n[40].url+"",l;return{c(){e=f("div"),l=I(t),c(e,"class","suggestion-url svelte-k0eopx")},m(o,s){S(o,e,s),i(e,l)},p(o,s){s[0]&8&&t!==(t=o[40].url+"")&&ve(l,t)},d(o){o&&$(e)}}}function Xs(n){let e,t,l=n[40].term+"",o,s,r,u,a=(n[40].score*100).toFixed(0)+"",p,d,m,_,h,g,w,C,y,T=n[40].normalized_term&&n[40].normalized_term!==n[40].term&&Js(n),k=n[40].suggestion_type&&Qs(n),v=n[40].url&&Ys(n);function L(){return n[26](n[40])}function R(...A){return n[27](n[40],...A)}return{c(){var A;e=f("button"),t=f("div"),o=I(l),s=b(),r=f("div"),u=f("span"),p=I(a),d=I("%"),m=b(),T&&T.c(),_=b(),k&&k.c(),h=b(),v&&v.c(),g=b(),c(t,"class","suggestion-term svelte-k0eopx"),c(u,"class","tag is-info is-small"),c(r,"class","suggestion-meta svelte-k0eopx"),c(e,"class",w="suggestion-item "+(((A=n[4])==null?void 0:A.term)===n[40].term?"is-active":"")+" svelte-k0eopx"),c(e,"type","button"),c(e,"data-testid","kg-suggestion-item")},m(A,N){S(A,e,N),i(e,t),i(t,o),i(e,s),i(e,r),i(r,u),i(u,p),i(u,d),i(r,m),T&&T.m(r,null),i(r,_),k&&k.m(r,null),i(e,h),v&&v.m(e,null),i(e,g),C||(y=[ee(e,"click",L),ee(e,"keydown",R)],C=!0)},p(A,N){var D;n=A,N[0]&8&&l!==(l=n[40].term+"")&&ve(o,l),N[0]&8&&a!==(a=(n[40].score*100).toFixed(0)+"")&&ve(p,a),n[40].normalized_term&&n[40].normalized_term!==n[40].term?T?T.p(n,N):(T=Js(n),T.c(),T.m(r,_)):T&&(T.d(1),T=null),n[40].suggestion_type?k?k.p(n,N):(k=Qs(n),k.c(),k.m(r,null)):k&&(k.d(1),k=null),n[40].url?v?v.p(n,N):(v=Ys(n),v.c(),v.m(e,g)):v&&(v.d(1),v=null),N[0]&24&&w!==(w="suggestion-item "+(((D=n[4])==null?void 0:D.term)===n[40].term?"is-active":"")+" svelte-k0eopx")&&c(e,"class",w)},d(A){A&&$(e),T&&T.d(),k&&k.d(),v&&v.d(),C=!1,ft(y)}}}function Uf(n){let e;return{c(){e=I("Cancel")},m(t,l){S(t,e,l)},d(t){t&&$(e)}}}function Zs(n){let e,t;return e=new rl({props:{type:"is-primary",disabled:!n[4],"data-testid":"kg-add-term-button",$$slots:{default:[Hf]},$$scope:{ctx:n}}}),e.$on("click",n[11]),{c(){$e(e.$$.fragment)},m(l,o){Te(e,l,o),t=!0},p(l,o){const s={};o[0]&16&&(s.disabled=!l[4]),o[0]&16|o[1]&16384&&(s.$$scope={dirty:o,ctx:l}),e.$set(s)},i(l){t||(q(e.$$.fragment,l),t=!0)},o(l){Z(e.$$.fragment,l),t=!1},d(l){Ce(e,l)}}}function Hf(n){let e,t=n[4].term+"",l,o;return{c(){e=I('Add "'),l=I(t),o=I('" to Context')},m(s,r){S(s,e,r),S(s,l,r),S(s,o,r)},p(s,r){r[0]&16&&t!==(t=s[4].term+"")&&ve(l,t)},d(s){s&&($(e),$(l),$(o))}}}function Ff(n){let e;return{c(){e=I("Add Complete Thesaurus to Context")},m(t,l){S(t,e,l)},d(t){t&&$(e)}}}function zf(n){let e,t,l,o,s,r,u,a,p,d,m,_,h,g,w,C,y,T,k,v,L,R,A,N,D,B,V,O,E,te;a=new On({props:{$$slots:{default:[Df]},$$scope:{ctx:n}}});let M=n[8]&&Vs(n);function X(z,P){return P[0]&2&&(m=null),z[7]?jf:z[3].length>0?Pf:(m==null&&(m=z[1].trim().length>=2),m?Mf:If)}let J=X(n,[-1,-1]),F=J(n);w=new rl({props:{$$slots:{default:[Uf]},$$scope:{ctx:n}}}),w.$on("click",n[12]);let H=n[4]&&Zs(n);return V=new rl({props:{type:"is-link",size:"is-small",style:"width: 100%;","data-testid":"kg-add-index-button",$$slots:{default:[Ff]},$$scope:{ctx:n}}}),V.$on("click",n[16]),{c(){e=f("div"),t=f("div"),l=f("button"),o=b(),s=f("div"),s.innerHTML='<div class="modal-title svelte-k0eopx"><h3 class="svelte-k0eopx">Knowledge Graph Search</h3> <p class="svelte-k0eopx">Search and add terms from the knowledge graph to your context</p></div>',r=b(),u=f("div"),$e(a.$$.fragment),p=b(),M&&M.c(),d=b(),F.c(),_=b(),h=f("div"),g=f("div"),$e(w.$$.fragment),C=b(),H&&H.c(),y=b(),T=f("div"),k=f("div"),v=f("p"),L=f("strong"),L.textContent="Alternative:",R=I(' Add the complete thesaurus for role "'),A=f("strong"),N=I(n[9]),D=I(`".
            This includes all domain-specific terms and their normalized mappings in JSON format for comprehensive vocabulary context.`),B=b(),$e(V.$$.fragment),c(l,"class","delete is-large modal-close-btn svelte-k0eopx"),c(l,"aria-label","close"),c(s,"class","modal-header svelte-k0eopx"),c(u,"class","search-section svelte-k0eopx"),c(g,"class","action-buttons svelte-k0eopx"),c(h,"class","modal-actions svelte-k0eopx"),c(v,"class","svelte-k0eopx"),c(k,"class","alternative-content svelte-k0eopx"),c(T,"class","alternative-section svelte-k0eopx"),c(t,"class","kg-search-container svelte-k0eopx"),c(e,"class","box wrapper svelte-k0eopx"),c(e,"data-testid","kg-search-modal")},m(z,P){S(z,e,P),i(e,t),i(t,l),i(t,o),i(t,s),i(t,r),i(t,u),Te(a,u,null),i(t,p),M&&M.m(t,null),i(t,d),F.m(t,null),i(t,_),i(t,h),i(h,g),Te(w,g,null),i(g,C),H&&H.m(g,null),i(t,y),i(t,T),i(T,k),i(k,v),i(v,L),i(v,R),i(v,A),i(A,N),i(v,D),i(T,B),Te(V,T,null),O=!0,E||(te=[ee(l,"click",n[12]),ee(t,"keydown",n[14])],E=!0)},p(z,P){const U={};P[0]&230|P[1]&16384&&(U.$$scope={dirty:P,ctx:z}),a.$set(U),z[8]?M?(M.p(z,P),P[0]&256&&q(M,1)):(M=Vs(z),M.c(),q(M,1),M.m(t,d)):M&&(rt(),Z(M,1,1,()=>{M=null}),it()),J===(J=X(z,P))&&F?F.p(z,P):(F.d(1),F=J(z),F&&(F.c(),F.m(t,_)));const K={};P[1]&16384&&(K.$$scope={dirty:P,ctx:z}),w.$set(K),z[4]?H?(H.p(z,P),P[0]&16&&q(H,1)):(H=Zs(z),H.c(),q(H,1),H.m(g,null)):H&&(rt(),Z(H,1,1,()=>{H=null}),it()),(!O||P[0]&512)&&ve(N,z[9]);const Y={};P[1]&16384&&(Y.$$scope={dirty:P,ctx:z}),V.$set(Y)},i(z){O||(q(a.$$.fragment,z),q(M),q(w.$$.fragment,z),q(H),q(V.$$.fragment,z),O=!0)},o(z){Z(a.$$.fragment,z),Z(M),Z(w.$$.fragment,z),Z(H),Z(V.$$.fragment,z),O=!1},d(z){z&&$(e),Ce(a),M&&M.d(),F.d(),Ce(w),H&&H.d(),Ce(V),E=!1,ft(te)}}}function Kf(n){let e,t,l;function o(r){n[28](r)}let s={$$slots:{default:[zf]},$$scope:{ctx:n}};return n[0]!==void 0&&(s.active=n[0]),e=new Al({props:s}),yt.push(()=>Et(e,"active",o)),e.$on("close",n[12]),{c(){$e(e.$$.fragment)},m(r,u){Te(e,r,u),l=!0},p(r,u){const a={};u[0]&1022|u[1]&16384&&(a.$$scope={dirty:u,ctx:r}),!t&&u[0]&1&&(t=!0,a.active=r[0],At(()=>t=!1)),e.$set(a)},i(r){l||(q(e.$$.fragment,r),l=!0)},o(r){Z(e.$$.fragment,r),l=!1},d(r){Ce(e,r)}}}function Bf(n,e,t){let l,o,s,r;lt(n,Dt,ne=>t(9,s=ne)),lt(n,It,ne=>t(30,r=ne));let{active:u=!1}=e,{initialQuery:a=""}=e,{conversationId:p=null}=e;const d=xl();let m="",_=[],h=!1,g=null,w=null,C=null,y=[],T=-1,k,v=!1;function L(){C&&clearTimeout(C),C=setTimeout(()=>{m.trim().length>=2?V():(t(3,_=[]),t(4,w=null))},300)}async function R(ne){const Q=ne.trim();if(!Q||Q.length<2)return[];try{if(r){const ue=await Ze("get_autocomplete_suggestions",{query:Q,roleName:s,limit:8});if((ue==null?void 0:ue.status)==="success"&&Array.isArray(ue.suggestions))return ue.suggestions.map(se=>se.term)}else{const ue=await fetch(`${mt.ServerURL}/autocomplete/${encodeURIComponent(s)}/${encodeURIComponent(Q)}`);if(ue.ok){const se=await ue.json();if((se==null?void 0:se.status)==="success"&&Array.isArray(se.suggestions))return se.suggestions.map(j=>j.term)}}}catch(ue){console.warn("KG autocomplete failed",ue)}return[]}async function A(){const ne=m.trim();if(ne.length<2){t(5,y=[]),t(6,T=-1);return}try{const Q=await R(ne);t(5,y=Q),t(6,T=-1)}catch(Q){console.warn("Failed to get autocomplete suggestions:",Q),t(5,y=[]),t(6,T=-1)}}function N(ne){t(1,m=ne),t(5,y=[]),t(6,T=-1),m.trim().length>=2&&V()}async function D(ne){L(),await A()}function B(ne){y.length>0?ne.key==="ArrowDown"?(ne.preventDefault(),t(6,T=(T+1)%y.length)):ne.key==="ArrowUp"?(ne.preventDefault(),t(6,T=(T-1+y.length)%y.length)):(ne.key==="Enter"||ne.key==="Tab")&&T!==-1?(ne.preventDefault(),N(y[T])):ne.key==="Escape"&&(ne.preventDefault(),t(5,y=[]),t(6,T=-1)):ne.key==="Enter"?(ne.preventDefault(),w&&E()):ne.key==="Escape"&&M()}async function V(){if(!m.trim()||m.trim().length<2){t(3,_=[]);return}t(19,h=!0),t(20,g=null);try{if(r){const ne=await Ze("search_kg_terms",{request:{query:m.trim(),role_name:s,limit:20,min_similarity:.6}});ne.status==="success"?(t(3,_=ne.suggestions||[]),_.length>0&&!w&&t(4,w=_[0])):(t(20,g=ne.error||"Search failed"),t(3,_=[]))}else{if(!p){t(20,g="No active conversation. Please start a conversation first."),t(3,_=[]);return}const ne=await fetch(`${mt.ServerURL}/conversations/${p}/context/kg/search?query=${encodeURIComponent(m.trim())}&role=${encodeURIComponent(s)}`);if(ne.ok){const Q=await ne.json();Q.status==="success"?(t(3,_=Q.suggestions||[]),_.length>0&&!w&&t(4,w=_[0])):(t(20,g=Q.error||"Search failed"),t(3,_=[]))}else t(20,g=`HTTP ${ne.status}: ${ne.statusText}`),t(3,_=[])}}catch(ne){console.error("KG search error:",ne),t(20,g=`Search failed: ${ne}`),t(3,_=[])}finally{t(19,h=!1)}}function O(ne){t(4,w=ne)}async function E(){if(w){if(!p){t(20,g="No active conversation. Please start a conversation first.");return}try{if(r)await Ze("add_kg_term_context",{request:{conversation_id:p,term:w.term,role_name:s}}),d("termAdded",{term:w.term,suggestion:w}),M();else{const ne=await fetch(`${mt.ServerURL}/conversations/${p}/context/kg/term`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({term:w.term,role:s})});if(ne.ok){const Q=await ne.json();Q.status==="success"?(d("termAdded",{term:w.term,suggestion:w}),M()):t(20,g=Q.error||"Failed to add term to context")}else t(20,g=`HTTP ${ne.status}: ${ne.statusText}`)}}catch(ne){console.error("Error adding term to context:",ne),t(20,g=`Failed to add term to context: ${ne}`)}}}async function te(){if(!p){t(20,g="No active conversation. Please start a conversation first.");return}try{if(r)await Ze("add_kg_index_context",{request:{conversation_id:p,role_name:s}}),d("kgIndexAdded",{role:s}),M();else{const ne=await fetch(`${mt.ServerURL}/conversations/${p}/context/kg/index`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({role:s})});if(ne.ok){const Q=await ne.json();Q.status==="success"?(d("kgIndexAdded",{role:s}),M()):t(20,g=Q.error||"Failed to add KG index to context")}else t(20,g=`HTTP ${ne.status}: ${ne.statusText}`)}}catch(ne){console.error("Error adding KG index to context:",ne),t(20,g=`Failed to add KG index to context: ${ne}`)}}function M(){t(0,u=!1),t(1,m=""),t(3,_=[]),t(4,w=null),t(20,g=null),t(19,h=!1),t(5,y=[]),t(6,T=-1),C&&(clearTimeout(C),C=null)}Xl(()=>{C&&clearTimeout(C)});const X=D,J=B,F=O,H=te;function z(ne){k=ne,t(2,k)}function P(ne){m=ne,t(1,m),t(0,u),t(21,v),t(17,a)}const U=ne=>N(ne),K=(ne,Q)=>{(Q.key==="Enter"||Q.key===" ")&&(Q.preventDefault(),N(ne))},Y=ne=>F(ne),re=(ne,Q)=>Q.key==="Enter"&&F(ne);function ae(ne){u=ne,t(0,u)}return n.$$set=ne=>{"active"in ne&&t(0,u=ne.active),"initialQuery"in ne&&t(17,a=ne.initialQuery),"conversationId"in ne&&t(18,p=ne.conversationId)},n.$$.update=()=>{n.$$.dirty[0]&2228227&&u&&!v&&(t(1,m=a),t(21,v=!0),m.trim()&&V()),n.$$.dirty[0]&1&&(u||t(21,v=!1)),n.$$.dirty[0]&5&&u&&k&&setTimeout(()=>{k==null||k.focus(),t(20,g=null)},100),n.$$.dirty[0]&1048576&&t(8,l=g),n.$$.dirty[0]&524288&&t(7,o=h)},[u,m,k,_,w,y,T,o,l,s,N,E,M,X,J,F,H,a,p,h,g,v,z,P,U,K,Y,re,ae]}class Wf extends Ht{constructor(e){super(),Ft(this,e,Bf,Kf,jt,{active:0,initialQuery:17,conversationId:18},null,[-1,-1])}}function Gf(n){const e=n.slice(),t=e[0].kg_index_info;return e[9]=t,e}function qf(n){const e=n.slice(),t=e[0].kg_term_definition;return e[8]=t,e}function Vf(n){let e=n[0].context_type==="KGTermDefinition"?"KG Term":"KG Index",t;return{c(){t=I(e)},m(l,o){S(l,t,o)},p(l,o){o&1&&e!==(e=l[0].context_type==="KGTermDefinition"?"KG Term":"KG Index")&&ve(t,e)},d(l){l&&$(t)}}}function Jf(n){let e;return{c(){e=I("👁️")},m(t,l){S(t,e,l)},d(t){t&&$(e)}}}function Qf(n){let e,t;return e=new Button({props:{type:"is-ghost",title:"Remove from context",$$slots:{default:[Yf]},$$scope:{ctx:n}}}),e.$on("click",handleRemove),{c(){$e(e.$$.fragment)},m(l,o){Te(e,l,o),t=!0},p(l,o){const s={};o&1024&&(s.$$scope={dirty:o,ctx:l}),e.$set(s)},i(l){t||(q(e.$$.fragment,l),t=!0)},o(l){Z(e.$$.fragment,l),t=!1},d(l){Ce(e,l)}}}function Yf(n){let e;return{c(){e=I("❌")},m(t,l){S(t,e,l)},d(t){t&&$(e)}}}function Xf(n){let e,t,l,o=formatNumber(n[9].total_terms)+"",s,r,u,a,p,d,m=formatNumber(n[9].total_nodes)+"",_,h,g,w,C,y,T=formatNumber(n[9].total_edges)+"",k,v,L,R,A,N,D=(n[9].version||"N/A")+"",B,V,O,E,te,M=!n[2]&&xf();return{c(){e=f("div"),t=f("div"),l=f("div"),s=I(o),r=b(),u=f("div"),u.textContent="Terms",a=b(),p=f("div"),d=f("div"),_=I(m),h=b(),g=f("div"),g.textContent="Nodes",w=b(),C=f("div"),y=f("div"),k=I(T),v=b(),L=f("div"),L.textContent="Edges",R=b(),A=f("div"),N=f("div"),B=I(D),V=b(),O=f("div"),O.textContent="Version",E=b(),M&&M.c(),te=Nt(),c(l,"class","stat-value "+(n[2]?"compact":"")+" svelte-tet355"),c(u,"class","stat-label svelte-tet355"),c(t,"class","stat-item svelte-tet355"),c(d,"class","stat-value "+(n[2]?"compact":"")+" svelte-tet355"),c(g,"class","stat-label svelte-tet355"),c(p,"class","stat-item svelte-tet355"),c(y,"class","stat-value "+(n[2]?"compact":"")+" svelte-tet355"),c(L,"class","stat-label svelte-tet355"),c(C,"class","stat-item svelte-tet355"),c(N,"class","stat-value "+(n[2]?"compact":"")+" svelte-tet355"),c(O,"class","stat-label svelte-tet355"),c(A,"class","stat-item svelte-tet355"),c(e,"class","kg-index-stats "+(n[2]?"compact":"")+" svelte-tet355")},m(X,J){S(X,e,J),i(e,t),i(t,l),i(l,s),i(t,r),i(t,u),i(e,a),i(e,p),i(p,d),i(d,_),i(p,h),i(p,g),i(e,w),i(e,C),i(C,y),i(y,k),i(C,v),i(C,L),i(e,R),i(e,A),i(A,N),i(N,B),i(A,V),i(A,O),S(X,E,J),M&&M.m(X,J),S(X,te,J)},p(X,J){J&1&&o!==(o=formatNumber(X[9].total_terms)+"")&&ve(s,o),J&1&&m!==(m=formatNumber(X[9].total_nodes)+"")&&ve(_,m),J&1&&T!==(T=formatNumber(X[9].total_edges)+"")&&ve(k,T),J&1&&D!==(D=(X[9].version||"N/A")+"")&&ve(B,D)},i:Fe,o:Fe,d(X){X&&($(e),$(E),$(te)),M&&M.d(X)}}}function Zf(n){let e,t,l,o,s,r,u,a=n[8].definition&&xs(n),p=n[8].synonyms&&n[8].synonyms.length>0&&er(n),d=n[8].related_terms&&n[8].related_terms.length>0&&tr(n),m=n[8].usage_examples&&n[8].usage_examples.length>0&&nr(n),_=n[8].url&&lr(n);return{c(){e=f("div"),a&&a.c(),t=b(),l=f("div"),p&&p.c(),o=b(),d&&d.c(),s=b(),m&&m.c(),r=b(),_&&_.c(),c(l,"class","term-metadata "+(n[2]?"compact":"")+" svelte-tet355"),c(e,"class","term-definition "+(n[2]?"compact":"")+" svelte-tet355")},m(h,g){S(h,e,g),a&&a.m(e,null),i(e,t),i(e,l),p&&p.m(l,null),i(l,o),d&&d.m(l,null),i(l,s),m&&m.m(l,null),i(l,r),_&&_.m(l,null),u=!0},p(h,g){h[8].definition?a?a.p(h,g):(a=xs(h),a.c(),a.m(e,t)):a&&(a.d(1),a=null),h[8].synonyms&&h[8].synonyms.length>0?p?(p.p(h,g),g&1&&q(p,1)):(p=er(h),p.c(),q(p,1),p.m(l,o)):p&&(rt(),Z(p,1,1,()=>{p=null}),it()),h[8].related_terms&&h[8].related_terms.length>0?d?(d.p(h,g),g&1&&q(d,1)):(d=tr(h),d.c(),q(d,1),d.m(l,s)):d&&(rt(),Z(d,1,1,()=>{d=null}),it()),h[8].usage_examples&&h[8].usage_examples.length>0?m?(m.p(h,g),g&1&&q(m,1)):(m=nr(h),m.c(),q(m,1),m.m(l,r)):m&&(rt(),Z(m,1,1,()=>{m=null}),it()),h[8].url?_?g&1&&q(_,1):(_=lr(h),_.c(),q(_,1),_.m(l,null)):_&&(rt(),Z(_,1,1,()=>{_=null}),it())},i(h){u||(q(p),q(d),q(m),q(_),u=!0)},o(h){Z(p),Z(d),Z(m),Z(_),u=!1},d(h){h&&$(e),a&&a.d(),p&&p.d(),d&&d.d(),m&&m.d(),_&&_.d()}}}function xf(n){let e;return{c(){e=f("div"),e.innerHTML='<p class="is-size-7"><strong>Thesaurus Data:</strong> This context item contains the complete thesaurus as JSON, providing all domain-specific vocabulary and term mappings for comprehensive AI understanding.</p>',c(e,"class","notification is-success is-light mt-3")},m(t,l){S(t,e,l)},d(t){t&&$(e)}}}function xs(n){let e,t=n[8].definition+"",l;return{c(){e=f("div"),l=I(t),c(e,"class","definition-text "+(n[2]?"compact":"")+" svelte-tet355")},m(o,s){S(o,e,s),i(e,l)},p(o,s){s&1&&t!==(t=o[8].definition+"")&&ve(l,t)},d(o){o&&$(e)}}}function er(n){let e,t;return e=new Tag({props:{type:"is-light",rounded:!0,title:"Synonyms",$$slots:{default:[ed]},$$scope:{ctx:n}}}),{c(){$e(e.$$.fragment)},m(l,o){Te(e,l,o),t=!0},p(l,o){const s={};o&1025&&(s.$$scope={dirty:o,ctx:l}),e.$set(s)},i(l){t||(q(e.$$.fragment,l),t=!0)},o(l){Z(e.$$.fragment,l),t=!1},d(l){Ce(e,l)}}}function ed(n){let e,t=n[8].synonyms.length+"",l,o,s=n[8].synonyms.length!==1?"s":"",r;return{c(){e=I("≈ "),l=I(t),o=I(" synonym"),r=I(s)},m(u,a){S(u,e,a),S(u,l,a),S(u,o,a),S(u,r,a)},p(u,a){a&1&&t!==(t=u[8].synonyms.length+"")&&ve(l,t),a&1&&s!==(s=u[8].synonyms.length!==1?"s":"")&&ve(r,s)},d(u){u&&($(e),$(l),$(o),$(r))}}}function tr(n){let e,t;return e=new Tag({props:{type:"is-light",rounded:!0,title:"Related Terms",$$slots:{default:[td]},$$scope:{ctx:n}}}),{c(){$e(e.$$.fragment)},m(l,o){Te(e,l,o),t=!0},p(l,o){const s={};o&1025&&(s.$$scope={dirty:o,ctx:l}),e.$set(s)},i(l){t||(q(e.$$.fragment,l),t=!0)},o(l){Z(e.$$.fragment,l),t=!1},d(l){Ce(e,l)}}}function td(n){let e,t=n[8].related_terms.length+"",l,o;return{c(){e=I("🔗 "),l=I(t),o=I(" related")},m(s,r){S(s,e,r),S(s,l,r),S(s,o,r)},p(s,r){r&1&&t!==(t=s[8].related_terms.length+"")&&ve(l,t)},d(s){s&&($(e),$(l),$(o))}}}function nr(n){let e,t;return e=new Tag({props:{type:"is-light",rounded:!0,title:"Usage Examples",$$slots:{default:[nd]},$$scope:{ctx:n}}}),{c(){$e(e.$$.fragment)},m(l,o){Te(e,l,o),t=!0},p(l,o){const s={};o&1025&&(s.$$scope={dirty:o,ctx:l}),e.$set(s)},i(l){t||(q(e.$$.fragment,l),t=!0)},o(l){Z(e.$$.fragment,l),t=!1},d(l){Ce(e,l)}}}function nd(n){let e,t=n[8].usage_examples.length+"",l,o,s=n[8].usage_examples.length!==1?"s":"",r;return{c(){e=I("💬 "),l=I(t),o=I(" example"),r=I(s)},m(u,a){S(u,e,a),S(u,l,a),S(u,o,a),S(u,r,a)},p(u,a){a&1&&t!==(t=u[8].usage_examples.length+"")&&ve(l,t),a&1&&s!==(s=u[8].usage_examples.length!==1?"s":"")&&ve(r,s)},d(u){u&&($(e),$(l),$(o),$(r))}}}function lr(n){let e,t;return e=new Tag({props:{type:"is-link",rounded:!0,$$slots:{default:[ld]},$$scope:{ctx:n}}}),{c(){$e(e.$$.fragment)},m(l,o){Te(e,l,o),t=!0},i(l){t||(q(e.$$.fragment,l),t=!0)},o(l){Z(e.$$.fragment,l),t=!1},d(l){Ce(e,l)}}}function ld(n){let e;return{c(){e=I("🔗 Source")},m(t,l){S(t,e,l)},d(t){t&&$(e)}}}function or(n){let e,t=n[0].summary+"",l;return{c(){e=f("div"),l=I(t),c(e,"class","context-summary svelte-tet355")},m(o,s){S(o,e,s),i(e,l)},p(o,s){s&1&&t!==(t=o[0].summary+"")&&ve(l,t)},d(o){o&&$(e)}}}function sr(n){let e,t,l=(n[0].relevance_score*100).toFixed(0)+"",o,s;return{c(){e=f("span"),t=I("Relevance: "),o=I(l),s=I("%"),c(e,"class","relevance-score svelte-tet355")},m(r,u){S(r,e,u),i(e,t),i(e,o),i(e,s)},p(r,u){u&1&&l!==(l=(r[0].relevance_score*100).toFixed(0)+"")&&ve(o,l)},d(r){r&&$(e)}}}function rr(n){let e,t,l=(n[0].metadata.document_title||n[0].metadata.source_document)+"",o;return{c(){e=f("span"),t=I("📄 "),o=I(l),c(e,"title","Source Document")},m(s,r){S(s,e,r),i(e,t),i(e,o)},p(s,r){r&1&&l!==(l=(s[0].metadata.document_title||s[0].metadata.source_document)+"")&&ve(o,l)},d(s){s&&$(e)}}}function od(n){var U;let e,t,l,o,s,r,u,a=n[0].title+"",p,d,m,_,h,g,w,C,y,T,k,v,L,R,A,N,D=formatDate(n[0].created_at)+"",B,V,O,E;m=new Tag({props:{type:n[3],rounded:!0,$$slots:{default:[Vf]},$$scope:{ctx:n}}}),g=new Button({props:{type:"is-ghost",title:"View details",$$slots:{default:[Jf]},$$scope:{ctx:n}}}),g.$on("click",handleViewDetails);let te=n[1]&&Qf(n);const M=[Zf,Xf],X=[];function J(K,Y){return K[0].context_type==="KGTermDefinition"&&K[0].kg_term_definition?0:K[0].context_type==="KGIndex"&&K[0].kg_index_info?1:-1}function F(K,Y){if(Y===0)return qf(K);if(Y===1)return Gf(K)}~(T=J(n))&&(k=X[T]=M[T](F(n,T)));let H=n[0].summary&&!n[2]&&or(n),z=n[0].relevance_score&&sr(n),P=((U=n[0].metadata)==null?void 0:U.source_document)&&rr(n);return{c(){e=f("div"),t=f("div"),l=f("div"),o=f("span"),s=I(n[4]),r=b(),u=f("span"),p=I(a),d=b(),$e(m.$$.fragment),_=b(),h=f("div"),$e(g.$$.fragment),w=b(),te&&te.c(),C=b(),y=f("div"),k&&k.c(),v=b(),H&&H.c(),L=b(),R=f("div"),A=f("span"),N=I("Added "),B=I(D),V=b(),z&&z.c(),O=b(),P&&P.c(),c(o,"class","context-icon svelte-tet355"),c(u,"class","context-title-text "+(n[2]?"compact":"")+" svelte-tet355"),c(l,"class","context-title svelte-tet355"),c(h,"class","context-actions svelte-tet355"),c(t,"class","context-header "+(n[2]?"compact":"")+" svelte-tet355"),c(y,"class","context-content "+(n[2]?"compact":"")+" svelte-tet355"),c(R,"class","context-meta "+(n[2]?"compact":"")+" svelte-tet355"),c(e,"class","kg-context-item "+(n[2]?"compact":"")+" svelte-tet355")},m(K,Y){S(K,e,Y),i(e,t),i(t,l),i(l,o),i(o,s),i(l,r),i(l,u),i(u,p),i(l,d),Te(m,l,null),i(t,_),i(t,h),Te(g,h,null),i(h,w),te&&te.m(h,null),i(e,C),i(e,y),~T&&X[T].m(y,null),i(y,v),H&&H.m(y,null),i(e,L),i(e,R),i(R,A),i(A,N),i(A,B),i(R,V),z&&z.m(R,null),i(R,O),P&&P.m(R,null),E=!0},p(K,[Y]){var Q;(!E||Y&16)&&ve(s,K[4]),(!E||Y&1)&&a!==(a=K[0].title+"")&&ve(p,a);const re={};Y&8&&(re.type=K[3]),Y&1025&&(re.$$scope={dirty:Y,ctx:K}),m.$set(re);const ae={};Y&1024&&(ae.$$scope={dirty:Y,ctx:K}),g.$set(ae),K[1]&&te.p(K,Y);let ne=T;T=J(K),T===ne?~T&&X[T].p(F(K,T),Y):(k&&(rt(),Z(X[ne],1,1,()=>{X[ne]=null}),it()),~T?(k=X[T],k?k.p(F(K,T),Y):(k=X[T]=M[T](F(K,T)),k.c()),q(k,1),k.m(y,v)):k=null),K[0].summary&&!K[2]?H?H.p(K,Y):(H=or(K),H.c(),H.m(y,null)):H&&(H.d(1),H=null),(!E||Y&1)&&D!==(D=formatDate(K[0].created_at)+"")&&ve(B,D),K[0].relevance_score?z?z.p(K,Y):(z=sr(K),z.c(),z.m(R,O)):z&&(z.d(1),z=null),(Q=K[0].metadata)!=null&&Q.source_document?P?P.p(K,Y):(P=rr(K),P.c(),P.m(R,null)):P&&(P.d(1),P=null)},i(K){E||(q(m.$$.fragment,K),q(g.$$.fragment,K),q(te),q(k),E=!0)},o(K){Z(m.$$.fragment,K),Z(g.$$.fragment,K),Z(te),Z(k),E=!1},d(K){K&&$(e),Ce(m),Ce(g),te&&te.d(),~T&&X[T].d(),H&&H.d(),z&&z.d(),P&&P.d()}}}function sd(n,e,t){let l,o,{contextItem:s}=e;const r=!0,u=!1;return xl(),n.$$set=a=>{"contextItem"in a&&t(0,s=a.contextItem)},n.$$.update=()=>{n.$$.dirty&1&&t(4,l=s.context_type==="KGTermDefinition"?"🏷️":"🗺️"),n.$$.dirty&1&&t(3,o=s.context_type==="KGTermDefinition"?"is-info":"is-primary")},[s,r,u,o,l]}class rd extends Ht{constructor(e){super(),Ft(this,e,sd,od,jt,{contextItem:0,removable:1,compact:2})}get removable(){return this.$$.ctx[1]}get compact(){return this.$$.ctx[2]}}function ir(n,e,t){const l=n.slice();return l[103]=e[t],l[105]=t,l}function ar(n,e,t){const l=n.slice();return l[106]=e[t],l[108]=t,l}function cr(n){let e,t,l;return t=new Cf({props:{currentConversationId:n[29],onSelectConversation:n[40],onNewConversation:n[41]}}),{c(){e=f("div"),$e(t.$$.fragment),c(e,"class","session-list-column svelte-1e04wo7")},m(o,s){S(o,e,s),Te(t,e,null),l=!0},p(o,s){const r={};s[0]&536870912&&(r.currentConversationId=o[29]),t.$set(r)},i(o){l||(q(t.$$.fragment,o),l=!0)},o(o){Z(t.$$.fragment,o),l=!1},d(o){o&&$(e),Ce(t)}}}function ur(n){let e,t,l;return{c(){e=f("p"),t=I("Conversation ID: "),l=I(n[11]),c(e,"class","is-size-7 has-text-grey")},m(o,s){S(o,e,s),i(e,t),i(e,l)},p(o,s){s[0]&2048&&ve(l,o[11])},d(o){o&&$(e)}}}function fr(n){let e,t,l;return{c(){e=f("button"),e.innerHTML='<span class="icon is-small"><i class="fas fa-save"></i></span> <span>Save</span>',c(e,"class","button is-small is-success svelte-1e04wo7"),c(e,"title","Save this conversation")},m(o,s){S(o,e,s),t||(l=ee(e,"click",n[39]),t=!0)},p:Fe,d(o){o&&$(e),t=!1,l()}}}function id(n){let e,t=n[106].content+"",l;return{c(){e=f("pre"),l=I(t),c(e,"class","svelte-1e04wo7")},m(o,s){S(o,e,s),i(e,l)},p(o,s){s[0]&4&&t!==(t=o[106].content+"")&&ve(l,t)},i:Fe,o:Fe,d(o){o&&$(e)}}}function ad(n){let e,t,l,o,s,r,u,a,p,d,m;const _=[ud,cd],h=[];function g(T,k){return T[7]?0:1}e=g(n),t=h[e]=_[e](n);function w(){return n[57](n[106])}function C(){return n[58](n[106])}let y=n[8]&&n[108]===n[2].length-1&&dr(n);return{c(){t.c(),l=b(),o=f("div"),s=f("button"),s.innerHTML='<span class="icon is-small"><i class="fas fa-copy"></i></span>',r=b(),u=f("button"),u.innerHTML='<span class="icon is-small"><i class="fas fa-save"></i></span>',a=b(),y&&y.c(),c(s,"class","button is-small is-light svelte-1e04wo7"),c(s,"title","Copy as markdown"),c(u,"class","button is-small is-light svelte-1e04wo7"),c(u,"title","Save as markdown"),c(o,"class","msg-actions svelte-1e04wo7")},m(T,k){h[e].m(T,k),S(T,l,k),S(T,o,k),i(o,s),i(o,r),i(o,u),i(o,a),y&&y.m(o,null),p=!0,d||(m=[ee(s,"click",w),ee(u,"click",C)],d=!0)},p(T,k){n=T;let v=e;e=g(n),e===v?h[e].p(n,k):(rt(),Z(h[v],1,1,()=>{h[v]=null}),it(),t=h[e],t?t.p(n,k):(t=h[e]=_[e](n),t.c()),q(t,1),t.m(l.parentNode,l)),n[8]&&n[108]===n[2].length-1?y?y.p(n,k):(y=dr(n),y.c(),y.m(o,null)):y&&(y.d(1),y=null)},i(T){p||(q(t),p=!0)},o(T){Z(t),p=!1},d(T){T&&($(l),$(o)),h[e].d(T),y&&y.d(),d=!1,ft(m)}}}function cd(n){let e,t=n[106].content+"",l;return{c(){e=f("pre"),l=I(t),c(e,"class","svelte-1e04wo7")},m(o,s){S(o,e,s),i(e,l)},p(o,s){s[0]&4&&t!==(t=o[106].content+"")&&ve(l,t)},i:Fe,o:Fe,d(o){o&&$(e)}}}function ud(n){let e,t,l;return t=new fl({props:{source:n[106].content}}),{c(){e=f("div"),$e(t.$$.fragment),c(e,"class","markdown-body svelte-1e04wo7")},m(o,s){S(o,e,s),Te(t,e,null),l=!0},p(o,s){const r={};s[0]&4&&(r.source=o[106].content),t.$set(r)},i(o){l||(q(t.$$.fragment,o),l=!0)},o(o){Z(t.$$.fragment,o),l=!1},d(o){o&&$(e),Ce(t)}}}function dr(n){let e,t,l,o,s,r,u,a,p,d,m,_,h;return{c(){e=f("button"),t=f("span"),t.innerHTML='<i class="fas fa-bug"></i>',l=b(),o=f("span"),o.textContent="REQ",r=b(),u=f("button"),a=f("span"),a.innerHTML='<i class="fas fa-code"></i>',p=b(),d=f("span"),d.textContent="RES",c(t,"class","icon is-small"),c(o,"class","is-size-7"),c(e,"class","button is-small is-warning svelte-1e04wo7"),c(e,"title","Show debug request (sent to LLM)"),e.disabled=s=!n[9],c(a,"class","icon is-small"),c(d,"class","is-size-7"),c(u,"class","button is-small is-info svelte-1e04wo7"),c(u,"title","Show debug response (from LLM)"),u.disabled=m=!n[10]},m(g,w){S(g,e,w),i(e,t),i(e,l),i(e,o),S(g,r,w),S(g,u,w),i(u,a),i(u,p),i(u,d),_||(h=[ee(e,"click",n[59]),ee(u,"click",n[60])],_=!0)},p(g,w){w[0]&512&&s!==(s=!g[9])&&(e.disabled=s),w[0]&1024&&m!==(m=!g[10])&&(u.disabled=m)},d(g){g&&($(e),$(r),$(u)),_=!1,ft(h)}}}function pr(n){let e,t,l,o,s,r;const u=[ad,id],a=[];function p(d,m){return d[106].role==="assistant"?0:1}return l=p(n),o=a[l]=u[l](n),{c(){e=f("div"),t=f("div"),o.c(),c(t,"class","bubble svelte-1e04wo7"),c(e,"class",s=yn(`msg ${n[106].role}`)+" svelte-1e04wo7")},m(d,m){S(d,e,m),i(e,t),a[l].m(t,null),r=!0},p(d,m){let _=l;l=p(d),l===_?a[l].p(d,m):(rt(),Z(a[_],1,1,()=>{a[_]=null}),it(),o=a[l],o?o.p(d,m):(o=a[l]=u[l](d),o.c()),q(o,1),o.m(t,null)),(!r||m[0]&4&&s!==(s=yn(`msg ${d[106].role}`)+" svelte-1e04wo7"))&&c(e,"class",s)},i(d){r||(q(o),r=!0)},o(d){Z(o),r=!1},d(d){d&&$(e),a[l].d()}}}function mr(n){let e;return{c(){e=f("div"),e.innerHTML='<div class="bubble loading svelte-1e04wo7"><span class="icon is-small"><i class="fas fa-spinner fa-spin"></i></span> <span>Thinking...</span></div>',c(e,"class","msg assistant svelte-1e04wo7")},m(t,l){S(t,e,l)},d(t){t&&$(e)}}}function _r(n){let e,t;return{c(){e=f("p"),t=I(n[6]),c(e,"class","is-size-7 has-text-grey")},m(l,o){S(l,e,o),i(e,t)},p(l,o){o[0]&64&&ve(t,l[6])},d(l){l&&$(e)}}}function hr(n){let e,t;return{c(){e=f("p"),t=I(n[5]),c(e,"class","has-text-danger is-size-7")},m(l,o){S(l,e,o),i(e,t)},p(l,o){o[0]&32&&ve(t,l[5])},d(l){l&&$(e)}}}function fd(n){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-refresh"></i>',c(e,"class","icon is-small")},m(t,l){S(t,e,l)},d(t){t&&$(e)}}}function dd(n){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-spinner fa-spin"></i>',c(e,"class","icon is-small")},m(t,l){S(t,e,l)},d(t){t&&$(e)}}}function gr(n){let e,t,l,o,s,r,u,a,p,d,m,_,h,g,w,C,y,T,k,v,L,R,A,N,D,B,V,O,E,te,M,X,J,F,H,z,P,U;function K(ae,ne){return ae[28]?md:pd}let Y=K(n),re=Y(n);return{c(){e=f("div"),t=f("div"),l=f("label"),l.textContent="Context Type",o=b(),s=f("div"),r=f("div"),u=f("select"),a=f("option"),a.textContent="Document",p=f("option"),p.textContent="Search Result",d=f("option"),d.textContent="User Input",m=f("option"),m.textContent="Note",_=b(),h=f("div"),g=f("label"),g.textContent="Title",w=b(),C=f("div"),y=f("input"),T=b(),k=f("div"),v=f("label"),v.textContent="Content",L=b(),R=f("div"),A=f("textarea"),N=b(),D=f("div"),B=f("div"),V=f("button"),re.c(),O=b(),E=f("span"),E.textContent="Save Context",M=b(),X=f("div"),J=f("button"),F=f("span"),F.innerHTML='<i class="fas fa-times"></i>',H=b(),z=f("span"),z.textContent="Cancel",c(l,"class","label is-small"),a.__value="document",ke(a,a.__value),p.__value="search_result",ke(p,p.__value),d.__value="user_input",ke(d,d.__value),m.__value="note",ke(m,m.__value),c(u,"data-testid","context-type-select"),n[17]===void 0&&Pt(()=>n[62].call(u)),c(r,"class","select is-small is-fullwidth"),c(s,"class","control"),c(t,"class","field"),c(g,"class","label is-small"),c(y,"class","input is-small"),c(y,"type","text"),c(y,"placeholder","Enter context title"),c(y,"data-testid","context-title-input"),c(C,"class","control"),c(h,"class","field"),c(v,"class","label is-small"),c(A,"class","textarea is-small"),c(A,"rows","4"),c(A,"placeholder","Enter context content"),c(A,"data-testid","context-content-textarea"),c(R,"class","control"),c(k,"class","field"),c(V,"class","button is-primary is-small"),V.disabled=te=n[28]||!n[15].trim()||!n[16].trim(),c(V,"data-testid","add-context-submit-button"),c(B,"class","control"),c(F,"class","icon is-small"),c(J,"class","button is-light is-small"),J.disabled=n[28],c(X,"class","control"),c(D,"class","field is-grouped"),c(e,"class","box has-background-light mb-4"),c(e,"data-testid","add-context-form")},m(ae,ne){S(ae,e,ne),i(e,t),i(t,l),i(t,o),i(t,s),i(s,r),i(r,u),i(u,a),i(u,p),i(u,d),i(u,m),pt(u,n[17],!0),i(e,_),i(e,h),i(h,g),i(h,w),i(h,C),i(C,y),ke(y,n[15]),i(e,T),i(e,k),i(k,v),i(k,L),i(k,R),i(R,A),ke(A,n[16]),i(e,N),i(e,D),i(D,B),i(B,V),re.m(V,null),i(V,O),i(V,E),i(D,M),i(D,X),i(X,J),i(J,F),i(J,H),i(J,z),P||(U=[ee(u,"change",n[62]),ee(y,"input",n[63]),ee(A,"input",n[64]),ee(V,"click",n[43]),ee(J,"click",n[33])],P=!0)},p(ae,ne){ne[0]&131072&&pt(u,ae[17]),ne[0]&32768&&y.value!==ae[15]&&ke(y,ae[15]),ne[0]&65536&&ke(A,ae[16]),Y!==(Y=K(ae))&&(re.d(1),re=Y(ae),re&&(re.c(),re.m(V,O))),ne[0]&268533760&&te!==(te=ae[28]||!ae[15].trim()||!ae[16].trim())&&(V.disabled=te),ne[0]&268435456&&(J.disabled=ae[28])},d(ae){ae&&$(e),re.d(),P=!1,ft(U)}}}function pd(n){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-save"></i>',c(e,"class","icon is-small")},m(t,l){S(t,e,l)},d(t){t&&$(e)}}}function md(n){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-spinner fa-spin"></i>',c(e,"class","icon is-small")},m(t,l){S(t,e,l)},d(t){t&&$(e)}}}function _d(n){let e,t,l=Ge(n[12]),o=[];for(let r=0;r<l.length;r+=1)o[r]=kr(ir(n,l,r));const s=r=>Z(o[r],1,1,()=>{o[r]=null});return{c(){e=f("div");for(let r=0;r<o.length;r+=1)o[r].c();c(e,"class","context-items svelte-1e04wo7"),c(e,"data-testid","conversation-context")},m(r,u){S(r,e,u);for(let a=0;a<o.length;a+=1)o[a]&&o[a].m(e,null);t=!0},p(r,u){if(u[0]&4096|u[1]&24584){l=Ge(r[12]);let a;for(a=0;a<l.length;a+=1){const p=ir(r,l,a);o[a]?(o[a].p(p,u),q(o[a],1)):(o[a]=kr(p),o[a].c(),q(o[a],1),o[a].m(e,null))}for(rt(),a=l.length;a<o.length;a+=1)s(a);it()}},i(r){if(!t){for(let u=0;u<l.length;u+=1)q(o[u]);t=!0}},o(r){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)Z(o[u]);t=!1},d(r){r&&$(e),Ct(o,r)}}}function hd(n){let e;return{c(){e=f("div"),e.innerHTML='<span class="icon is-large"><i class="fas fa-inbox fa-2x"></i></span> <p class="is-size-6">No context items yet</p> <p class="is-size-7">Add documents from search results to provide context for your chat.</p>',c(e,"class","has-text-centered has-text-grey-light"),c(e,"data-testid","empty-context-message")},m(t,l){S(t,e,l)},p:Fe,i:Fe,o:Fe,d(t){t&&$(e)}}}function gd(n){let e,t,l,o,s,r=n[103].context_type.replace(/([A-Z])/g," $1").trim()+"",u,a,p,d,m,_,h,g,w,C,y,T,k,v,L,R=n[103].title+"",A,N,D,B,V,O,E=new Date(n[103].created_at).toLocaleString()+"",te,M,X,J,F,H=n[103].relevance_score&&vr(n);function z(){return n[67](n[103])}function P(){return n[68](n[103])}function U(re,ae){return re[103].summary?kd:bd}let K=U(n),Y=K(n);return{c(){e=f("div"),t=f("div"),l=f("div"),o=f("div"),s=f("span"),u=I(r),p=b(),d=f("div"),m=f("div"),H&&H.c(),_=b(),h=f("div"),g=f("div"),w=f("div"),C=f("button"),C.innerHTML='<span class="icon is-small"><i class="fas fa-edit"></i></span>',y=b(),T=f("div"),k=f("button"),k.innerHTML='<span class="icon is-small"><i class="fas fa-trash"></i></span>',v=b(),L=f("h6"),A=I(R),N=b(),D=f("div"),Y.c(),B=b(),V=f("div"),O=I("Added: "),te=I(E),c(s,"class",a="tag is-small "+(n[103].context_type==="Document"?"is-info":n[103].context_type==="SearchResult"?"is-primary":n[103].context_type==="UserInput"?"is-warning":"is-light")),c(s,"data-testid",`context-type-${n[105]}`),c(o,"class","level-item"),c(l,"class","level-left"),c(m,"class","level-item"),c(C,"class","button is-small is-light"),c(C,"data-testid",`edit-context-${n[105]}`),c(C,"title","Edit context"),c(w,"class","control"),c(k,"class","button is-small is-light is-danger"),c(k,"data-testid",`delete-context-${n[105]}`),c(k,"title","Delete context"),c(T,"class","control"),c(g,"class","field is-grouped"),c(h,"class","level-item context-actions svelte-1e04wo7"),c(d,"class","level-right"),c(t,"class","level is-mobile"),c(L,"class","title is-6 has-text-dark"),c(L,"data-testid",`context-title-${n[105]}`),c(D,"class","content is-small"),c(V,"class","is-size-7 has-text-grey"),c(e,"class","context-item svelte-1e04wo7"),c(e,"data-context-id",M=n[103].id),c(e,"data-testid",`context-item-${n[105]}`),c(e,"data-context-type",X=n[103].context_type)},m(re,ae){S(re,e,ae),i(e,t),i(t,l),i(l,o),i(o,s),i(s,u),i(t,p),i(t,d),i(d,m),H&&H.m(m,null),i(d,_),i(d,h),i(h,g),i(g,w),i(w,C),i(g,y),i(g,T),i(T,k),i(e,v),i(e,L),i(L,A),i(e,N),i(e,D),Y.m(D,null),i(e,B),i(e,V),i(V,O),i(V,te),J||(F=[ee(C,"click",z),ee(k,"click",P)],J=!0)},p(re,ae){n=re,ae[0]&4096&&r!==(r=n[103].context_type.replace(/([A-Z])/g," $1").trim()+"")&&ve(u,r),ae[0]&4096&&a!==(a="tag is-small "+(n[103].context_type==="Document"?"is-info":n[103].context_type==="SearchResult"?"is-primary":n[103].context_type==="UserInput"?"is-warning":"is-light"))&&c(s,"class",a),n[103].relevance_score?H?H.p(n,ae):(H=vr(n),H.c(),H.m(m,null)):H&&(H.d(1),H=null),ae[0]&4096&&R!==(R=n[103].title+"")&&ve(A,R),K===(K=U(n))&&Y?Y.p(n,ae):(Y.d(1),Y=K(n),Y&&(Y.c(),Y.m(D,null))),ae[0]&4096&&E!==(E=new Date(n[103].created_at).toLocaleString()+"")&&ve(te,E),ae[0]&4096&&M!==(M=n[103].id)&&c(e,"data-context-id",M),ae[0]&4096&&X!==(X=n[103].context_type)&&c(e,"data-context-type",X)},i:Fe,o:Fe,d(re){re&&$(e),H&&H.d(),Y.d(),J=!1,ft(F)}}}function vd(n){let e,t;return e=new rd({props:{contextItem:n[103],compact:!0}}),e.$on("remove",n[65]),e.$on("viewDetails",n[66]),{c(){$e(e.$$.fragment)},m(l,o){Te(e,l,o),t=!0},p(l,o){const s={};o[0]&4096&&(s.contextItem=l[103]),e.$set(s)},i(l){t||(q(e.$$.fragment,l),t=!0)},o(l){Z(e.$$.fragment,l),t=!1},d(l){Ce(e,l)}}}function vr(n){let e,t=n[103].relevance_score.toFixed(1)+"",l;return{c(){e=f("span"),l=I(t),c(e,"class","tag is-light is-small")},m(o,s){S(o,e,s),i(e,l)},p(o,s){s[0]&4096&&t!==(t=o[103].relevance_score.toFixed(1)+"")&&ve(l,t)},d(o){o&&$(e)}}}function bd(n){let e,t=n[103].content.substring(0,150)+"",l,o=n[103].content.length>150?"...":"",s;return{c(){e=f("p"),l=I(t),s=I(o),c(e,"class","context-preview svelte-1e04wo7"),c(e,"data-testid",`context-content-${n[105]}`)},m(r,u){S(r,e,u),i(e,l),i(e,s)},p(r,u){u[0]&4096&&t!==(t=r[103].content.substring(0,150)+"")&&ve(l,t),u[0]&4096&&o!==(o=r[103].content.length>150?"...":"")&&ve(s,o)},d(r){r&&$(e)}}}function kd(n){let e,t=n[103].summary+"",l;return{c(){e=f("p"),l=I(t),c(e,"class","context-summary svelte-1e04wo7"),c(e,"data-testid",`context-summary-${n[105]}`)},m(o,s){S(o,e,s),i(e,l)},p(o,s){s[0]&4096&&t!==(t=o[103].summary+"")&&ve(l,t)},d(o){o&&$(e)}}}function br(n){let e;return{c(){e=f("hr"),c(e,"class","context-divider svelte-1e04wo7")},m(t,l){S(t,e,l)},d(t){t&&$(e)}}}function kr(n){let e,t,l,o,s;const r=[vd,gd],u=[];function a(d,m){return d[103].context_type==="KGTermDefinition"||d[103].context_type==="KGIndex"?0:1}e=a(n),t=u[e]=r[e](n);let p=n[105]<n[12].length-1&&br();return{c(){t.c(),l=b(),p&&p.c(),o=Nt()},m(d,m){u[e].m(d,m),S(d,l,m),p&&p.m(d,m),S(d,o,m),s=!0},p(d,m){let _=e;e=a(d),e===_?u[e].p(d,m):(rt(),Z(u[_],1,1,()=>{u[_]=null}),it(),t=u[e],t?t.p(d,m):(t=u[e]=r[e](d),t.c()),q(t,1),t.m(l.parentNode,l)),d[105]<d[12].length-1?p||(p=br(),p.c(),p.m(o.parentNode,o)):p&&(p.d(1),p=null)},i(d){s||(q(t),s=!0)},o(d){Z(t),s=!1},d(d){d&&($(l),$(o)),u[e].d(d),p&&p.d(d)}}}function wr(n){let e,t,l,o,s,r,u,a,p,d,m,_,h,g,w,C;function y(L,R){return L[9]?yd:wd}let T=y(n),k=T(n),v=n[9]&&yr(n);return{c(){e=f("div"),t=f("div"),l=b(),o=f("div"),s=f("header"),r=f("p"),r.innerHTML=`<span class="icon"><i class="fas fa-bug"></i></span>
          Debug Request (Sent to LLM)`,u=b(),a=f("button"),p=b(),d=f("section"),k.c(),m=b(),_=f("footer"),h=f("button"),h.textContent="Close",g=b(),v&&v.c(),c(t,"class","modal-background"),c(r,"class","modal-card-title"),c(a,"class","delete"),c(a,"aria-label","close"),c(s,"class","modal-card-head"),c(d,"class","modal-card-body"),c(h,"class","button"),c(_,"class","modal-card-foot"),c(o,"class","modal-card"),c(e,"class","modal is-active")},m(L,R){S(L,e,R),i(e,t),i(e,l),i(e,o),i(o,s),i(s,r),i(s,u),i(s,a),i(o,p),i(o,d),k.m(d,null),i(o,m),i(o,_),i(_,h),i(_,g),v&&v.m(_,null),w||(C=[ee(t,"click",n[69]),ee(a,"click",n[70]),ee(h,"click",n[71])],w=!0)},p(L,R){T===(T=y(L))&&k?k.p(L,R):(k.d(1),k=T(L),k&&(k.c(),k.m(d,null))),L[9]?v?v.p(L,R):(v=yr(L),v.c(),v.m(_,null)):v&&(v.d(1),v=null)},d(L){L&&$(e),k.d(),v&&v.d(),w=!1,ft(C)}}}function wd(n){let e;return{c(){e=f("p"),e.textContent="No request data available",c(e,"class","has-text-grey")},m(t,l){S(t,e,l)},p:Fe,d(t){t&&$(e)}}}function yd(n){let e,t,l,o,s,r,u=n[9].method+"",a,p,d,m,_=new Date(n[9].timestamp).toLocaleTimeString()+"",h,g,w,C,y=n[9].context_items_count+"",T,k,v,L,R,A,N=JSON.stringify(n[9],null,2)+"",D;return{c(){e=f("div"),t=f("p"),t.textContent="Request Details:",l=b(),o=f("div"),s=f("span"),r=I("Method: "),a=I(u),p=b(),d=f("span"),m=I("Time: "),h=I(_),g=b(),w=f("span"),C=I("Context Items: "),T=I(y),k=b(),v=f("p"),v.textContent="Full Request JSON:",L=b(),R=f("pre"),A=f("code"),D=I(N),c(t,"class","has-text-weight-semibold"),c(s,"class","tag is-info"),c(d,"class","tag is-primary"),c(w,"class","tag is-success"),c(o,"class","tags are-medium"),c(v,"class","has-text-weight-semibold mt-4"),c(A,"class","svelte-1e04wo7"),c(R,"class","debug-json svelte-1e04wo7"),c(e,"class","content")},m(B,V){S(B,e,V),i(e,t),i(e,l),i(e,o),i(o,s),i(s,r),i(s,a),i(o,p),i(o,d),i(d,m),i(d,h),i(o,g),i(o,w),i(w,C),i(w,T),i(e,k),i(e,v),i(e,L),i(e,R),i(R,A),i(A,D)},p(B,V){V[0]&512&&u!==(u=B[9].method+"")&&ve(a,u),V[0]&512&&_!==(_=new Date(B[9].timestamp).toLocaleTimeString()+"")&&ve(h,_),V[0]&512&&y!==(y=B[9].context_items_count+"")&&ve(T,y),V[0]&512&&N!==(N=JSON.stringify(B[9],null,2)+"")&&ve(D,N)},d(B){B&&$(e)}}}function yr(n){let e,t,l;return{c(){e=f("button"),e.innerHTML='<span class="icon"><i class="fas fa-copy"></i></span> <span>Copy JSON</span>',c(e,"class","button is-primary")},m(o,s){S(o,e,s),t||(l=ee(e,"click",n[72]),t=!0)},p:Fe,d(o){o&&$(e),t=!1,l()}}}function Cr(n){let e,t,l,o,s,r,u,a,p,d,m,_,h,g,w,C;function y(L,R){return L[10]?Td:Cd}let T=y(n),k=T(n),v=n[10]&&Sr(n);return{c(){e=f("div"),t=f("div"),l=b(),o=f("div"),s=f("header"),r=f("p"),r.innerHTML=`<span class="icon"><i class="fas fa-code"></i></span>
          Debug Response (From LLM)`,u=b(),a=f("button"),p=b(),d=f("section"),k.c(),m=b(),_=f("footer"),h=f("button"),h.textContent="Close",g=b(),v&&v.c(),c(t,"class","modal-background"),c(r,"class","modal-card-title"),c(a,"class","delete"),c(a,"aria-label","close"),c(s,"class","modal-card-head"),c(d,"class","modal-card-body"),c(h,"class","button"),c(_,"class","modal-card-foot"),c(o,"class","modal-card"),c(e,"class","modal is-active")},m(L,R){S(L,e,R),i(e,t),i(e,l),i(e,o),i(o,s),i(s,r),i(s,u),i(s,a),i(o,p),i(o,d),k.m(d,null),i(o,m),i(o,_),i(_,h),i(_,g),v&&v.m(_,null),w||(C=[ee(t,"click",n[73]),ee(a,"click",n[74]),ee(h,"click",n[75])],w=!0)},p(L,R){T===(T=y(L))&&k?k.p(L,R):(k.d(1),k=T(L),k&&(k.c(),k.m(d,null))),L[10]?v?v.p(L,R):(v=Sr(L),v.c(),v.m(_,null)):v&&(v.d(1),v=null)},d(L){L&&$(e),k.d(),v&&v.d(),w=!1,ft(C)}}}function Cd(n){let e;return{c(){e=f("p"),e.textContent="No response data available",c(e,"class","has-text-grey")},m(t,l){S(t,e,l)},p:Fe,d(t){t&&$(e)}}}function Td(n){let e,t,l,o,s,r,u=n[10].status+"",a,p,d,m,_=new Date(n[10].timestamp).toLocaleTimeString()+"",h,g,w,C,y,T,k,v,L=JSON.stringify(n[10],null,2)+"",R,A=n[10].model_used&&Tr(n),N=n[10].message_length&&$r(n);return{c(){e=f("div"),t=f("p"),t.textContent="Response Details:",l=b(),o=f("div"),s=f("span"),r=I("Status: "),a=I(u),p=b(),d=f("span"),m=I("Time: "),h=I(_),g=b(),A&&A.c(),w=b(),N&&N.c(),C=b(),y=f("p"),y.textContent="Full Response JSON:",T=b(),k=f("pre"),v=f("code"),R=I(L),c(t,"class","has-text-weight-semibold"),c(s,"class","tag is-info"),c(d,"class","tag is-primary"),c(o,"class","tags are-medium"),c(y,"class","has-text-weight-semibold mt-4"),c(v,"class","svelte-1e04wo7"),c(k,"class","debug-json svelte-1e04wo7"),c(e,"class","content")},m(D,B){S(D,e,B),i(e,t),i(e,l),i(e,o),i(o,s),i(s,r),i(s,a),i(o,p),i(o,d),i(d,m),i(d,h),i(o,g),A&&A.m(o,null),i(o,w),N&&N.m(o,null),i(e,C),i(e,y),i(e,T),i(e,k),i(k,v),i(v,R)},p(D,B){B[0]&1024&&u!==(u=D[10].status+"")&&ve(a,u),B[0]&1024&&_!==(_=new Date(D[10].timestamp).toLocaleTimeString()+"")&&ve(h,_),D[10].model_used?A?A.p(D,B):(A=Tr(D),A.c(),A.m(o,w)):A&&(A.d(1),A=null),D[10].message_length?N?N.p(D,B):(N=$r(D),N.c(),N.m(o,null)):N&&(N.d(1),N=null),B[0]&1024&&L!==(L=JSON.stringify(D[10],null,2)+"")&&ve(R,L)},d(D){D&&$(e),A&&A.d(),N&&N.d()}}}function Tr(n){let e,t,l=n[10].model_used+"",o;return{c(){e=f("span"),t=I("Model: "),o=I(l),c(e,"class","tag is-success")},m(s,r){S(s,e,r),i(e,t),i(e,o)},p(s,r){r[0]&1024&&l!==(l=s[10].model_used+"")&&ve(o,l)},d(s){s&&$(e)}}}function $r(n){let e,t,l=n[10].message_length+"",o,s;return{c(){e=f("span"),t=I("Length: "),o=I(l),s=I(" chars"),c(e,"class","tag is-warning")},m(r,u){S(r,e,u),i(e,t),i(e,o),i(e,s)},p(r,u){u[0]&1024&&l!==(l=r[10].message_length+"")&&ve(o,l)},d(r){r&&$(e)}}}function Sr(n){let e,t,l;return{c(){e=f("button"),e.innerHTML='<span class="icon"><i class="fas fa-copy"></i></span> <span>Copy JSON</span>',c(e,"class","button is-primary")},m(o,s){S(o,e,s),t||(l=ee(e,"click",n[76]),t=!0)},p:Fe,d(o){o&&$(e),t=!1,l()}}}function Or(n){let e,t,l;function o(r){n[82](r)}let s={item:n[21],kgTerm:n[25],kgRank:n[24]};return n[20]!==void 0&&(s.active=n[20]),e=new Il({props:s}),yt.push(()=>Et(e,"active",o)),{c(){$e(e.$$.fragment)},m(r,u){Te(e,r,u),l=!0},p(r,u){const a={};u[0]&2097152&&(a.item=r[21]),u[0]&33554432&&(a.kgTerm=r[25]),u[0]&16777216&&(a.kgRank=r[24]),!t&&u[0]&1048576&&(t=!0,a.active=r[20],At(()=>t=!1)),e.$set(a)},i(r){l||(q(e.$$.fragment,r),l=!0)},o(r){Z(e.$$.fragment,r),l=!1},d(r){Ce(e,r)}}}function $d(n){let e,t,l,o,s,r,u,a,p,d,m,_,h,g,w,C,y,T,k,v=n[30]?"Hide":"History",L,R,A,N,D,B,V,O,E,te,M,X,J,F,H,z,P,U,K,Y,re,ae,ne,Q,ue,se,j,W,le,ie,_e,ce,fe,de,ze,Xe,qe,Me,Pe,he,Ue,xe,Ve,We,Ke,Ye,ct,ht,tt,x,we,Re,Le,Ee=n[12].length+"",ye,be,De,Tt,St,gt,_t,ot,Ut,Vt,kt,_n,an,cn,Mt,oe,Se,Oe=n[30]&&cr(n),Be=n[11]&&ur(n),He=n[11]&&!n[29]&&fr(n),Ne=Ge(n[2]),nt=[];for(let me=0;me<Ne.length;me+=1)nt[me]=pr(ar(n,Ne,me));const zt=me=>Z(nt[me],1,1,()=>{nt[me]=null});let Je=n[4]&&mr(),at=n[6]&&_r(n),dt=n[5]&&hr(n);function Ot(me,je){return me[13]?dd:fd}let Kt=Ot(n),Bt=Kt(n),wt=n[14]&&gr(n);const hn=[hd,_d],G=[];function ge(me,je){return me[12].length===0?0:1}Ye=ge(n),ct=G[Ye]=hn[Ye](n);let pe=n[23]&&wr(n),Ae=n[22]&&Cr(n);function et(me){n[77](me)}let ut={context:n[27],mode:n[26]};n[18]!==void 0&&(ut.active=n[18]),ot=new Lf({props:ut}),yt.push(()=>Et(ot,"active",et)),ot.$on("update",n[78]),ot.$on("delete",n[79]),ot.$on("close",n[80]);function Jt(me){n[81](me)}let pn={conversationId:n[11]};n[19]!==void 0&&(pn.active=n[19]),kt=new Wf({props:pn}),yt.push(()=>Et(kt,"active",Jt)),kt.$on("termAdded",n[47]),kt.$on("kgIndexAdded",n[48]);let $t=n[21]&&Or(n);return{c(){e=f("section"),t=f("div"),l=f("div"),Oe&&Oe.c(),o=b(),s=f("div"),r=f("div"),u=f("div"),a=f("h2"),a.textContent="Chat",p=b(),d=f("p"),d.textContent=`Role: ${typeof bt(Dt)=="object"?bt(Dt).original:bt(Dt)}`,m=b(),Be&&Be.c(),_=b(),h=f("div"),g=f("button"),w=f("span"),C=f("i"),T=b(),k=f("span"),L=I(v),A=b(),He&&He.c(),N=b(),D=f("div"),B=f("div"),V=f("div"),O=f("div"),E=f("label"),te=f("input"),M=I(`
              Render markdown`),X=b(),J=f("div"),F=f("label"),H=f("input"),z=I(`
              Debug mode`),P=b();for(let me=0;me<nt.length;me+=1)nt[me].c();U=b(),Je&&Je.c(),K=b(),at&&at.c(),Y=b(),dt&&dt.c(),re=b(),ae=f("div"),ne=f("div"),Q=f("textarea"),ue=b(),se=f("div"),j=f("button"),W=f("span"),W.innerHTML='<i class="fas fa-paper-plane"></i>',ie=b(),_e=f("div"),ce=f("div"),fe=f("h4"),fe.textContent="Context",de=b(),ze=f("div"),Xe=f("div"),qe=f("div"),Me=f("div"),Pe=f("button"),Pe.innerHTML='<span class="icon is-small"><i class="fas fa-sitemap"></i></span> <span>KG Search</span>',he=b(),Ue=f("div"),xe=f("div"),Ve=f("button"),Bt.c(),We=b(),wt&&wt.c(),Ke=b(),ct.c(),ht=b(),tt=f("div"),x=f("div"),we=f("div"),Re=f("div"),Le=f("span"),ye=I(Ee),be=I(" context items"),De=b(),Tt=f("div"),Tt.innerHTML='<div class="level-item"><span class="is-size-7 has-text-grey">Context is automatically included in your chat</span></div>',St=b(),pe&&pe.c(),gt=b(),Ae&&Ae.c(),_t=b(),$e(ot.$$.fragment),Vt=b(),$e(kt.$$.fragment),an=b(),$t&&$t.c(),cn=Nt(),c(a,"class","title is-4"),c(d,"class","subtitle is-6"),c(C,"class",y="fas fa-"+(n[30]?"angle-left":"bars")),c(w,"class","icon is-small"),c(g,"class","button is-small svelte-1e04wo7"),c(g,"title",R=n[30]?"Hide session list":"Show session list"),c(h,"class","chat-header-actions svelte-1e04wo7"),c(r,"class","chat-header svelte-1e04wo7"),c(te,"type","checkbox"),c(E,"class","checkbox is-size-7"),c(O,"class","control"),c(H,"type","checkbox"),c(F,"class","checkbox is-size-7"),c(J,"class","control"),c(V,"class","field is-grouped"),c(B,"class","chat-toolbar svelte-1e04wo7"),c(D,"class","chat-window svelte-1e04wo7"),c(D,"data-testid","chat-messages"),c(Q,"class","textarea svelte-1e04wo7"),c(Q,"rows","3"),c(Q,"placeholder","Type your message and press Enter..."),c(Q,"data-testid","chat-input"),c(ne,"class","control is-expanded svelte-1e04wo7"),c(W,"class","icon"),c(j,"class","button is-primary"),j.disabled=le=n[4]||!n[3].trim(),c(j,"data-testid","send-message-button"),c(se,"class","control svelte-1e04wo7"),c(ae,"class","field has-addons chat-input svelte-1e04wo7"),c(s,"class","main-chat-area svelte-1e04wo7"),c(fe,"class","title is-5 mb-3"),c(Pe,"class","button is-small is-info"),c(Pe,"data-testid","kg-search-button"),c(Me,"class","buttons has-addons"),c(qe,"class","level-item"),c(Xe,"class","level-left"),c(Ve,"class","button is-small is-light"),Ve.disabled=n[13],c(Ve,"data-testid","refresh-context-button"),c(xe,"class","level-item"),c(Ue,"class","level-right"),c(ze,"class","level is-mobile"),c(Le,"class","tag is-light is-small"),c(Le,"data-testid","context-summary"),c(Re,"class","level-item"),c(we,"class","level-left"),c(Tt,"class","level-right"),c(x,"class","level is-mobile"),c(tt,"class","mt-4"),c(ce,"class","box context-panel svelte-1e04wo7"),c(ce,"data-testid","context-panel"),c(_e,"class","context-panel-column svelte-1e04wo7"),c(l,"class","chat-layout-grid svelte-1e04wo7"),Lt(l,"sidebar-hidden",!n[30]),c(t,"class","container"),c(e,"class","section"),c(e,"data-testid","chat-interface")},m(me,je){S(me,e,je),i(e,t),i(t,l),Oe&&Oe.m(l,null),i(l,o),i(l,s),i(s,r),i(r,u),i(u,a),i(u,p),i(u,d),i(u,m),Be&&Be.m(u,null),i(r,_),i(r,h),i(h,g),i(g,w),i(w,C),i(g,T),i(g,k),i(k,L),i(h,A),He&&He.m(h,null),i(s,N),i(s,D),i(D,B),i(B,V),i(V,O),i(O,E),i(E,te),te.checked=n[7],i(E,M),i(V,X),i(V,J),i(J,F),i(F,H),H.checked=n[8],i(F,z),i(D,P);for(let en=0;en<nt.length;en+=1)nt[en]&&nt[en].m(D,null);i(D,U),Je&&Je.m(D,null),i(s,K),at&&at.m(s,null),i(s,Y),dt&&dt.m(s,null),i(s,re),i(s,ae),i(ae,ne),i(ne,Q),ke(Q,n[3]),i(ae,ue),i(ae,se),i(se,j),i(j,W),i(l,ie),i(l,_e),i(_e,ce),i(ce,fe),i(ce,de),i(ce,ze),i(ze,Xe),i(Xe,qe),i(qe,Me),i(Me,Pe),i(ze,he),i(ze,Ue),i(Ue,xe),i(xe,Ve),Bt.m(Ve,null),i(ce,We),wt&&wt.m(ce,null),i(ce,Ke),G[Ye].m(ce,null),i(ce,ht),i(ce,tt),i(tt,x),i(x,we),i(we,Re),i(Re,Le),i(Le,ye),i(Le,be),i(x,De),i(x,Tt),S(me,St,je),pe&&pe.m(me,je),S(me,gt,je),Ae&&Ae.m(me,je),S(me,_t,je),Te(ot,me,je),S(me,Vt,je),Te(kt,me,je),S(me,an,je),$t&&$t.m(me,je),S(me,cn,je),Mt=!0,oe||(Se=[ee(g,"click",n[42]),ee(te,"change",n[55]),ee(te,"change",n[31]),ee(H,"change",n[56]),ee(Q,"input",n[61]),ee(Q,"keydown",n[36]),ee(j,"click",n[35]),ee(Pe,"click",n[37]),ee(Ve,"click",n[32])],oe=!0)},p(me,je){if(me[30]?Oe?(Oe.p(me,je),je[0]&1073741824&&q(Oe,1)):(Oe=cr(me),Oe.c(),q(Oe,1),Oe.m(l,o)):Oe&&(rt(),Z(Oe,1,1,()=>{Oe=null}),it()),me[11]?Be?Be.p(me,je):(Be=ur(me),Be.c(),Be.m(u,null)):Be&&(Be.d(1),Be=null),(!Mt||je[0]&1073741824&&y!==(y="fas fa-"+(me[30]?"angle-left":"bars")))&&c(C,"class",y),(!Mt||je[0]&1073741824)&&v!==(v=me[30]?"Hide":"History")&&ve(L,v),(!Mt||je[0]&1073741824&&R!==(R=me[30]?"Hide session list":"Show session list"))&&c(g,"title",R),me[11]&&!me[29]?He?He.p(me,je):(He=fr(me),He.c(),He.m(h,null)):He&&(He.d(1),He=null),je[0]&128&&(te.checked=me[7]),je[0]&256&&(H.checked=me[8]),je[0]&1927|je[1]&128){Ne=Ge(me[2]);let Rt;for(Rt=0;Rt<Ne.length;Rt+=1){const In=ar(me,Ne,Rt);nt[Rt]?(nt[Rt].p(In,je),q(nt[Rt],1)):(nt[Rt]=pr(In),nt[Rt].c(),q(nt[Rt],1),nt[Rt].m(D,U))}for(rt(),Rt=Ne.length;Rt<nt.length;Rt+=1)zt(Rt);it()}me[4]?Je||(Je=mr(),Je.c(),Je.m(D,null)):Je&&(Je.d(1),Je=null),me[6]?at?at.p(me,je):(at=_r(me),at.c(),at.m(s,Y)):at&&(at.d(1),at=null),me[5]?dt?dt.p(me,je):(dt=hr(me),dt.c(),dt.m(s,re)):dt&&(dt.d(1),dt=null),je[0]&8&&ke(Q,me[3]),(!Mt||je[0]&24&&le!==(le=me[4]||!me[3].trim()))&&(j.disabled=le),Kt!==(Kt=Ot(me))&&(Bt.d(1),Bt=Kt(me),Bt&&(Bt.c(),Bt.m(Ve,null))),(!Mt||je[0]&8192)&&(Ve.disabled=me[13]),me[14]?wt?wt.p(me,je):(wt=gr(me),wt.c(),wt.m(ce,Ke)):wt&&(wt.d(1),wt=null);let en=Ye;Ye=ge(me),Ye===en?G[Ye].p(me,je):(rt(),Z(G[en],1,1,()=>{G[en]=null}),it(),ct=G[Ye],ct?ct.p(me,je):(ct=G[Ye]=hn[Ye](me),ct.c()),q(ct,1),ct.m(ce,ht)),(!Mt||je[0]&4096)&&Ee!==(Ee=me[12].length+"")&&ve(ye,Ee),(!Mt||je[0]&1073741824)&&Lt(l,"sidebar-hidden",!me[30]),me[23]?pe?pe.p(me,je):(pe=wr(me),pe.c(),pe.m(gt.parentNode,gt)):pe&&(pe.d(1),pe=null),me[22]?Ae?Ae.p(me,je):(Ae=Cr(me),Ae.c(),Ae.m(_t.parentNode,_t)):Ae&&(Ae.d(1),Ae=null);const Wt={};je[0]&134217728&&(Wt.context=me[27]),je[0]&67108864&&(Wt.mode=me[26]),!Ut&&je[0]&262144&&(Ut=!0,Wt.active=me[18],At(()=>Ut=!1)),ot.$set(Wt);const gn={};je[0]&2048&&(gn.conversationId=me[11]),!_n&&je[0]&524288&&(_n=!0,gn.active=me[19],At(()=>_n=!1)),kt.$set(gn),me[21]?$t?($t.p(me,je),je[0]&2097152&&q($t,1)):($t=Or(me),$t.c(),q($t,1),$t.m(cn.parentNode,cn)):$t&&(rt(),Z($t,1,1,()=>{$t=null}),it())},i(me){if(!Mt){q(Oe);for(let je=0;je<Ne.length;je+=1)q(nt[je]);q(ct),q(ot.$$.fragment,me),q(kt.$$.fragment,me),q($t),Mt=!0}},o(me){Z(Oe),nt=nt.filter(Boolean);for(let je=0;je<nt.length;je+=1)Z(nt[je]);Z(ct),Z(ot.$$.fragment,me),Z(kt.$$.fragment,me),Z($t),Mt=!1},d(me){me&&($(e),$(St),$(gt),$(_t),$(Vt),$(an),$(cn)),Oe&&Oe.d(),Be&&Be.d(),He&&He.d(),Ct(nt,me),Je&&Je.d(),at&&at.d(),dt&&dt.d(),Bt.d(),wt&&wt.d(),G[Ye].d(),pe&&pe.d(me),Ae&&Ae.d(me),Ce(ot,me),Ce(kt,me),$t&&$t.d(me),oe=!1,ft(Se)}}}function Rr(){return"terraphim:chatMarkdown"}async function Bl(n){try{await navigator.clipboard.writeText(n)}catch(e){console.warn("Clipboard write failed",e)}}function Sd(n,e,t){let l,o,s,r,u,a,p,d,m,_,h;lt(n,It,G=>t(86,d=G)),lt(n,Dt,G=>t(87,m=G)),lt(n,kl,G=>t(29,_=G)),lt(n,$o,G=>t(30,h=G));let g=null,w=null,C=[],y="",T=!1,k=null,v=null,L="",R=!1,A=!1,N=null,D=null,B=!1,V=!1,O=null,E=[],te=!1,M=!1,X="",J="",F="document",H=!1,z=!1,P=null,U="edit",K=null,Y=!1,re=!1,ae=null,ne=null,Q=null;function ue(){return`terraphim:chatState:${bt(Dt)}`}function se(){try{if(typeof window>"u")return;const G=localStorage.getItem(ue());if(!G)return;const ge=JSON.parse(G);Array.isArray(ge.messages)&&t(2,C=ge.messages),typeof ge.conversationId=="string"&&t(11,O=ge.conversationId)}catch(G){console.warn("Failed to load chat state:",G)}}function j(){try{if(typeof window>"u")return;const G={messages:C,conversationId:O};localStorage.setItem(ue(),JSON.stringify(G))}catch(G){console.warn("Failed to save chat state:",G)}}function W(){try{const G=localStorage.getItem(Rr());G!=null&&t(7,R=G==="true")}catch{}}function le(){try{localStorage.setItem(Rr(),R?"true":"false")}catch{}}function ie(G){t(2,C=[...C,{role:"user",content:G}]),j()}async function _e(){try{if(d){const G=await Ze("list_conversations");G!=null&&G.conversations&&G.conversations.length>0?(t(11,O=G.conversations[0].id),console.log("🎯 Using existing conversation:",O),await fe()):await ce()}else{const G=await fetch(`${mt.ServerURL}/conversations`);if(G.ok){const ge=await G.json();ge.conversations&&ge.conversations.length>0?(t(11,O=ge.conversations[0].id),console.log("🎯 Using existing conversation:",O),await fe()):await ce()}else await ce()}}catch(G){console.error("❌ Error initializing conversation:",G)}}async function ce(){try{const G=bt(Dt);if(d){const ge=await Ze("create_conversation",{title:"Chat Conversation",role:G});ge.status==="success"&&ge.conversation_id&&(t(11,O=ge.conversation_id),console.log("🆕 Created new conversation:",O),j())}else{const ge=await fetch(`${mt.ServerURL}/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"Chat Conversation",role:G})});if(ge.ok){const pe=await ge.json();pe.status==="Success"&&pe.conversation_id&&(t(11,O=pe.conversation_id),console.log("🆕 Created new conversation:",O),j())}}}catch(G){console.error("❌ Error creating conversation:",G)}}async function fe(){if(!O){console.warn("⚠️ Cannot load context: no conversation ID available");return}t(13,te=!0),console.log("🔄 Loading conversation context for:",O);try{if(d){console.log("📱 Loading context via Tauri...");const G=_===O,ge=G?"get_persistent_conversation":"get_conversation";console.log(`Using ${ge} for ${G?"persistent":"in-memory"} conversation`);const pe=await Ze(ge,{conversationId:O});if(console.log("📥 Tauri response:",pe),pe.status==="success"&&pe.conversation){const Ae=pe.conversation.global_context||[];t(12,E=Ae),console.log(`✅ Loaded ${Ae.length} context items via Tauri (${G?"persistent":"in-memory"})`)}else console.error(`❌ Failed to get conversation via Tauri (${ge}):`,pe.error||"Unknown error"),t(12,E=[])}else{console.log("🌐 Loading context via HTTP...");const G=await fetch(`${mt.ServerURL}/conversations/${O}`);if(console.log("📥 HTTP response status:",G.status,G.statusText),G.ok){const ge=await G.json();if(console.log("📄 HTTP response data:",ge),ge.status==="success"&&ge.conversation){const pe=ge.conversation.global_context||[];t(12,E=pe),console.log(`✅ Loaded ${pe.length} context items via HTTP`)}else console.error("❌ Failed to get conversation via HTTP:",ge.error||"Unknown error"),t(12,E=[])}else console.error("❌ HTTP request failed:",G.status,G.statusText),t(12,E=[])}}catch(G){console.error("❌ Error loading conversation context:",{error:G.message||G,conversationId:O,isTauri:d,timestamp:new Date().toISOString()}),t(12,E=[])}finally{t(13,te=!1),console.log("🏁 Context loading completed. Items count:",E.length)}}function de(){t(14,M=!M),M||(t(15,X=""),t(16,J=""),t(17,F="document"))}async function ze(){if(!(!O||!X.trim()||!J.trim())){t(50,H=!0);try{const G={title:X.trim(),summary:null,content:J.trim(),context_type:F};if(d){const ge=await Ze("add_context_to_conversation",{conversationId:O,contextData:G});ge.status==="success"?(await fe(),de(),console.log("✅ Context added successfully via Tauri")):console.error("❌ Failed to add context via Tauri:",ge.error)}else{const ge=await fetch(`${mt.ServerURL}/conversations/${O}/context`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(G)});if(ge.ok){const pe=await ge.json();pe.status==="success"?(await fe(),de(),console.log("✅ Context added successfully via HTTP")):console.error("❌ Failed to add context via HTTP:",pe.error)}else console.error("❌ HTTP request failed:",ge.status,ge.statusText)}}catch(G){console.error("❌ Error adding manual context:",G)}finally{t(50,H=!1)}}}async function Xe(G,ge){var pe,Ae;if(G.context_type==="KGTermDefinition"){let et=ge||null;(pe=G.kg_term_definition)!=null&&pe.term?et=G.kg_term_definition.term:G.title.startsWith("KG Term: ")?et=G.title.replace("KG Term: ",""):(Ae=G.metadata)!=null&&Ae.normalized_term&&(et=G.metadata.normalized_term),et?await qe(et):(console.warn("Could not extract term from KG context item:",G),t(51,P=G),t(52,U="edit"),t(18,z=!0))}else t(51,P=G),t(52,U="edit"),t(18,z=!0)}async function qe(G){var ge,pe,Ae,et;console.log(`🔍 Finding KG documents for term: "${G}" in role: "${m}"`);try{if(d){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:m,term:G});const ut=await Ze("find_documents_for_kg_term",{roleName:m,term:G});console.log("  📥 Tauri response received:"),console.log("    Status:",ut.status),console.log("    Results count:",((ge=ut.results)==null?void 0:ge.length)||0),console.log("    Total:",ut.total||0),ut.status==="success"&&ut.results&&ut.results.length>0?(t(21,ae=ut.results[0]),t(54,Q=ae.rank||0),t(53,ne=G),console.log("  ✅ Found KG document:",ae.title),console.log("  📄 Document content preview:",`${(pe=ae.body)==null?void 0:pe.substring(0,200)}...`),t(20,re=!0)):console.warn(`  ⚠️  No KG documents found for term: "${G}" in role: "${m}"`)}else{console.log("  Making HTTP fetch call...");const ut=mt.ServerURL,Jt=encodeURIComponent(m),pn=encodeURIComponent(G),$t=`${ut}/roles/${Jt}/kg_search?term=${pn}`,me=await fetch($t);if(!me.ok)throw new Error(`HTTP error! Status: ${me.status} - ${me.statusText}`);const je=await me.json();console.log("  📄 Response data:",je.status,"Results:",((Ae=je.results)==null?void 0:Ae.length)||0),je.status==="success"&&je.results&&je.results.length>0?(t(21,ae=je.results[0]),t(54,Q=ae.rank||0),t(53,ne=G),console.log("  ✅ Found KG document:",ae.title),console.log("  📄 Document content preview:",`${(et=ae.body)==null?void 0:et.substring(0,200)}...`),t(20,re=!0)):console.warn(`  ⚠️  No KG documents found for term: "${G}" in role: "${m}"`)}}catch(ut){console.error("❌ Error fetching KG document:",ut)}}function Me(G){confirm(`Are you sure you want to delete "${G.title}"?`)&&Pe(G.id)}async function Pe(G){if(!(!O||K)){K=G,console.log("🗑️ Deleting context:",G);try{if(d){const ge=await Ze("delete_context",{conversationId:O,contextId:G});(ge==null?void 0:ge.status)==="success"?(console.log("✅ Context deleted successfully via Tauri"),await fe()):console.error("❌ Failed to delete context via Tauri:",ge==null?void 0:ge.error)}else{const ge=await fetch(`${mt.ServerURL}/conversations/${O}/context/${G}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(ge.ok){const pe=await ge.json();pe.status==="success"?(console.log("✅ Context deleted successfully via HTTP"),await fe()):console.error("❌ Failed to delete context via HTTP:",pe.error)}else console.error("❌ HTTP delete request failed:",ge.status)}}catch(ge){console.error("❌ Error deleting context:",ge)}finally{K=null}}}async function he(G){if(O){console.log("📝 Updating context:",G.id);try{const ge={context_type:G.context_type,title:G.title,summary:G.summary,content:G.content,metadata:G.metadata};if(d){const pe=await Ze("update_context",{conversationId:O,contextId:G.id,request:ge});(pe==null?void 0:pe.status)==="success"?(console.log("✅ Context updated successfully via Tauri"),await fe()):console.error("❌ Failed to update context via Tauri:",pe==null?void 0:pe.error)}else{const pe=await fetch(`${mt.ServerURL}/conversations/${O}/context/${G.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(ge)});if(pe.ok){const Ae=await pe.json();Ae.status==="success"?(console.log("✅ Context updated successfully via HTTP"),await fe()):console.error("❌ Failed to update context via HTTP:",Ae.error)}else console.error("❌ HTTP update request failed:",pe.status)}}catch(ge){console.error("❌ Error updating context:",ge)}}}async function Ue(){var pe,Ae;if(!y.trim()||T)return;t(5,k=null);const G=bt(Dt),ge=y.trim();t(3,y=""),O||await _e(),ie(ge),t(4,T=!0);try{const et={role:G,messages:C};O&&(et.conversation_id=O),t(9,N={timestamp:new Date().toISOString(),method:d?"TAURI_INVOKE":"HTTP_POST",endpoint:d?"chat":`${mt.ServerURL}/chat`,body:JSON.parse(JSON.stringify(et)),context_items_count:E.length,conversation_id:O});let ut;if(d)ut=await Ze("chat",{request:et});else{const Jt=await fetch(`${mt.ServerURL}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(et)});if(!Jt.ok)throw new Error(`HTTP ${Jt.status}`);ut=await Jt.json()}t(10,D={timestamp:new Date().toISOString(),status:ut.status,model_used:ut.model_used,message_length:((pe=ut.message)==null?void 0:pe.length)||0,full_response:JSON.parse(JSON.stringify(ut)),error:ut.error||null}),t(49,v=ut.model_used??null),((Ae=ut.status)==null?void 0:Ae.toLowerCase())==="success"&&ut.message?(t(2,C=[...C,{role:"assistant",content:ut.message}]),j()):t(5,k=ut.error||"Chat failed")}catch(et){t(5,k=(et==null?void 0:et.message)||String(et)),t(10,D={timestamp:new Date().toISOString(),status:"error",error:(et==null?void 0:et.message)||String(et),full_response:null})}finally{t(4,T=!1)}}function xe(G){(G.key==="Enter"||G.key==="Return")&&!G.shiftKey&&(G.preventDefault(),Ue())}function Ve(){t(19,Y=!0)}function We(G){console.log("✅ KG term added to context:",G.detail.term),fe()}function Ke(G){console.log("✅ KG index added to context for role:",G.detail.role),fe()}Dn(()=>{if(W(),se(),C.length===0&&(t(2,C=[{role:"assistant",content:"Hi! How can I help you? Ask me anything about your search results or documents."}]),j()),bt(It)&&(il(()=>Promise.resolve().then(()=>ji),void 0).then(G=>g=G).catch(()=>{}),il(()=>import("./fs-CRJ3ZtCH.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])).then(G=>w=G).catch(()=>{})),_e(),typeof window<"u"){const G=()=>{O&&fe()};return window.addEventListener("focus",G),()=>{window.removeEventListener("focus",G)}}});async function Ye(G){try{if(bt(It)&&g&&w){const ge=await g.save({filters:[{name:"Markdown",extensions:["md"]}]});ge&&await w.writeTextFile(ge,G)}else{const ge=new Blob([G],{type:"text/markdown;charset=utf-8"}),pe=URL.createObjectURL(ge),Ae=document.createElement("a");Ae.href=pe,Ae.download="chat.md",document.body.appendChild(Ae),Ae.click(),document.body.removeChild(Ae),URL.revokeObjectURL(pe)}}catch(ge){console.warn("Save markdown failed",ge)}}async function ct(G){try{if(d){const ge=await Ze("get_persistent_conversation",{conversationId:G});if(ge.status==="success"&&ge.conversation){const pe=ge.conversation;t(11,O=pe.id),kl.set(pe.id),t(2,C=pe.messages||[]),t(12,E=pe.global_context||[]),t(5,k=null),console.log("✅ Loaded persistent conversation:",pe.title),j()}else t(5,k=ge.error||"Failed to load conversation"),console.error("❌ Failed to load persistent conversation:",k)}}catch(ge){console.error("❌ Error loading persistent conversation:",ge),t(5,k=String(ge))}}async function ht(){if(!O){console.warn("⚠️ No conversation ID to save");return}try{if(d){const G=await Ze("get_conversation",{conversationId:O});if(G.status==="success"&&G.conversation){const ge=G.conversation,pe=await Ze("create_persistent_conversation",{title:ge.title||"Chat Conversation",role:ge.role});if(pe.status==="success"&&pe.conversation){const Ae=pe.conversation;(await Ze("update_persistent_conversation",{conversation:{...Ae,messages:ge.messages,global_context:ge.global_context}})).status==="success"&&(kl.set(Ae.id),console.log("✅ Saved persistent conversation:",Ae.id))}}}}catch(G){console.error("❌ Error saving persistent conversation:",G)}}function tt(G){ct(G)}function x(){t(2,C=[]),t(12,E=[]),t(11,O=null),kl.set(null),t(5,k=null),ce(),console.log("🆕 Started new conversation")}function we(){$o.update(G=>!G)}const Re=ze,Le=Xe,Ee=Me,ye=he,be=We,De=Ke;function Tt(){R=this.checked,t(7,R)}function St(){A=this.checked,t(8,A)}const gt=G=>Bl(G.content),_t=G=>Ye(G.content),ot=()=>t(0,B=!0),Ut=()=>t(1,V=!0);function Vt(){y=this.value,t(3,y)}function kt(){F=Xt(this),t(17,F)}function _n(){X=this.value,t(15,X)}function an(){J=this.value,t(16,J)}const cn=G=>Pe(G.detail.contextId),Mt=G=>Le(G.detail.contextItem,G.detail.term),oe=G=>Le(G),Se=G=>Ee(G),Oe=()=>t(23,a=!1),Be=()=>t(23,a=!1),He=()=>t(23,a=!1),Ne=()=>Bl(JSON.stringify(N,null,2)),nt=()=>t(22,p=!1),zt=()=>t(22,p=!1),Je=()=>t(22,p=!1),at=()=>Bl(JSON.stringify(D,null,2));function dt(G){z=G,t(18,z)}const Ot=G=>ye(G.detail),Kt=G=>Pe(G.detail),Bt=()=>{t(18,z=!1),t(27,o=null)};function wt(G){Y=G,t(19,Y)}function hn(G){re=G,t(20,re)}return n.$$.update=()=>{if(n.$$.dirty[1]&524288&&t(28,l=H),n.$$.dirty[1]&1048576&&t(27,o=P),n.$$.dirty[1]&2097152&&t(26,s=U),n.$$.dirty[1]&4194304&&t(25,r=ne),n.$$.dirty[1]&8388608&&t(24,u=Q),n.$$.dirty[0]&1&&t(23,a=B),n.$$.dirty[0]&2&&t(22,p=V),n.$$.dirty[1]&262144)try{if(v)if(["ollama","openrouter","anthropic","openai","groq"].includes(v.toLowerCase())){const ge=bt(on),pe=bt(Dt),Ae=ge!=null&&ge.roles?ge.roles[pe]:null;let et="";v.toLowerCase()==="ollama"?et=(Ae==null?void 0:Ae.ollama_model)||(Ae==null?void 0:Ae.llm_chat_model)||"":v.toLowerCase()==="openrouter"&&(et=(Ae==null?void 0:Ae.openrouter_chat_model)||(Ae==null?void 0:Ae.openrouter_model)||""),t(6,L=`Provider: ${v}${et?` model: ${et}`:""}`)}else t(6,L=`Model: ${v}`);else{const G=bt(on),ge=bt(Dt),pe=G!=null&&G.roles?G.roles[ge]:null;let Ae="",et="";pe!=null&&pe.openrouter_enabled||pe!=null&&pe.openrouter_chat_model||pe!=null&&pe.openrouter_model?(Ae="openrouter",et=(pe==null?void 0:pe.openrouter_chat_model)||(pe==null?void 0:pe.openrouter_model)||""):pe!=null&&pe.ollama_model||(pe==null?void 0:pe.llm_provider)==="ollama"?(Ae="ollama",et=(pe==null?void 0:pe.ollama_model)||(pe==null?void 0:pe.llm_chat_model)||""):pe!=null&&pe.llm_provider?(Ae=pe.llm_provider,et=(pe==null?void 0:pe.llm_chat_model)||""):G!=null&&G.default_model_provider&&(Ae=G.default_model_provider,et=(G==null?void 0:G.default_chat_model)||""),Ae?t(6,L=`Provider: ${Ae}${et?` model: ${et}`:""}`):t(6,L="")}}catch{t(6,L=v?`Model: ${v}`:"")}},[B,V,C,y,T,k,L,R,A,N,D,O,E,te,M,X,J,F,z,Y,re,ae,p,a,u,r,s,o,l,_,h,le,fe,de,Pe,Ue,xe,Ve,Ye,ht,tt,x,we,Re,Le,Ee,ye,be,De,v,H,P,U,ne,Q,Tt,St,gt,_t,ot,Ut,Vt,kt,_n,an,cn,Mt,oe,Se,Oe,Be,He,Ne,nt,zt,Je,at,dt,Ot,Kt,Bt,wt,hn]}class Od extends Ht{constructor(e){super(),Ft(this,e,Sd,$d,jt,{},null,[-1,-1,-1,-1])}}const{window:Ql}=ta;function Rd(n){let e,t,l,o,s,r,u,a,p,d;return{c(){e=f("div"),t=f("div"),l=f("h3"),l.textContent="Error loading graph",o=b(),s=f("p"),r=I(n[3]),u=b(),a=f("button"),a.textContent="Retry",c(a,"class","button is-primary"),c(t,"class","error-content svelte-1ry9pkl"),c(e,"class","error-overlay svelte-1ry9pkl")},m(m,_){S(m,e,_),i(e,t),i(t,l),i(t,o),i(t,s),i(s,r),i(t,u),i(t,a),p||(d=ee(a,"click",n[10]),p=!0)},p(m,_){_&8&&ve(r,m[3])},d(m){m&&$(e),p=!1,d()}}}function Ed(n){let e;return{c(){e=f("div"),e.innerHTML='<div class="loading-content svelte-1ry9pkl"><div class="loader svelte-1ry9pkl"></div> <p>Loading knowledge graph...</p></div>',c(e,"class","loading-overlay svelte-1ry9pkl")},m(t,l){S(t,e,l)},p:Fe,d(t){t&&$(e)}}}function Ad(n){let e,t,l;return{c(){e=f("button"),e.innerHTML='<i class="fas fa-times svelte-1ry9pkl"></i>',c(e,"class","close-button svelte-1ry9pkl"),c(e,"title","Close Graph")},m(o,s){S(o,e,s),t||(l=ee(e,"click",n[16]),t=!0)},p:Fe,d(o){o&&$(e),t=!1,l()}}}function Er(n){let e;return{c(){e=f("div"),e.innerHTML="<span><strong>Left-click:</strong> View node • <strong>Right-click:</strong> Edit node • <strong>Drag:</strong> Move • <strong>Scroll:</strong> Zoom</span>",c(e,"class","controls-info svelte-1ry9pkl")},m(t,l){S(t,e,l)},d(t){t&&$(e)}}}function Ar(n){let e=n[5].id,t,l,o=Lr(n);return{c(){o.c(),t=Nt()},m(s,r){o.m(s,r),S(s,t,r),l=!0},p(s,r){r&32&&jt(e,e=s[5].id)?(rt(),Z(o,1,1,Fe),it(),o=Lr(s),o.c(),q(o,1),o.m(t.parentNode,t)):o.p(s,r)},i(s){l||(q(o),l=!0)},o(s){Z(o),l=!1},d(s){s&&$(t),o.d(s)}}}function Lr(n){let e,t,l;function o(r){n[17](r)}let s={item:n[5],initialEdit:n[7]};return n[6]!==void 0&&(s.active=n[6]),e=new Il({props:s}),yt.push(()=>Et(e,"active",o)),e.$on("close",n[11]),e.$on("save",n[12]),{c(){$e(e.$$.fragment)},m(r,u){Te(e,r,u),l=!0},p(r,u){const a={};u&32&&(a.item=r[5]),u&128&&(a.initialEdit=r[7]),!t&&u&64&&(t=!0,a.active=r[6],At(()=>t=!1)),e.$set(a)},i(r){l||(q(e.$$.fragment,r),l=!0)},o(r){Z(e.$$.fragment,r),l=!1},d(r){Ce(e,r)}}}function Ld(n){let e,t,l,o,s,r,u,a,p;Pt(n[14]);function d(C,y){if(C[2])return Ed;if(C[3])return Rd}let m=d(n),_=m&&m(n),h=n[0]&&Ad(n),g=!n[2]&&!n[3]&&n[4].length>0&&Er(),w=n[5]&&Ar(n);return{c(){e=f("div"),_&&_.c(),t=b(),h&&h.c(),l=b(),g&&g.c(),o=b(),s=b(),w&&w.c(),r=Nt(),c(e,"class","graph-container svelte-1ry9pkl"),Ie(e,"width",n[0]?"100vw":"600px"),Ie(e,"height",n[0]?"100vh":"400px"),Lt(e,"fullscreen",n[0])},m(C,y){S(C,e,y),_&&_.m(e,null),n[15](e),S(C,t,y),h&&h.m(C,y),S(C,l,y),g&&g.m(C,y),S(C,o,y),S(C,s,y),w&&w.m(C,y),S(C,r,y),u=!0,a||(p=ee(Ql,"resize",n[14]),a=!0)},p(C,[y]){m===(m=d(C))&&_?_.p(C,y):(_&&_.d(1),_=m&&m(C),_&&(_.c(),_.m(e,null))),C[0]&&h.p(C,y),!C[2]&&!C[3]&&C[4].length>0?g||(g=Er(),g.c(),g.m(o.parentNode,o)):g&&(g.d(1),g=null),C[5]?w?(w.p(C,y),y&32&&q(w,1)):(w=Ar(C),w.c(),q(w,1),w.m(r.parentNode,r)):w&&(rt(),Z(w,1,1,()=>{w=null}),it())},i(C){u||(q(w),u=!0)},o(C){Z(w),u=!1},d(C){C&&($(e),$(t),$(l),$(o),$(s),$(r)),_&&_.d(),n[15](null),h&&h.d(C),g&&g.d(C),w&&w.d(C),a=!1,p()}}}function Dr(n){return{id:`kg-node-${n.id}`,url:`#/graph/node/${n.id}`,title:n.label,body:`# ${n.label}

**Knowledge Graph Node**

ID: ${n.id}
Rank: ${n.rank}

This is a concept node from the knowledge graph. You can edit this content to add more information about "${n.label}".`,description:`Knowledge graph concept: ${n.label}`,tags:["knowledge-graph","concept"],rank:n.rank,stub:`Knowledge graph concept: ${n.label}`}}function Dd(n,e,t){let l,o;lt(n,Dt,O=>t(19,l=O)),lt(n,It,O=>t(20,o=O));const s="/rolegraph",r=!0;let u,a=!0,p=null,d=[],m=[],_=null,h=!1,g=!1,w=window.innerWidth,C=window.innerHeight;function y(){t(8,w=window.innerWidth),t(9,C=window.innerHeight),!a&&!p&&A()}async function T(){t(2,a=!0),t(3,p=null);try{if(o){console.log("Loading rolegraph from Tauri");const O=await Ze("get_rolegraph",{role_name:l||void 0});if(O&&O.status==="success")t(4,d=O.nodes),m=O.edges;else throw new Error(`Tauri rolegraph fetch failed: ${(O==null?void 0:O.status)||"unknown error"}`)}else{console.log("Loading rolegraph from server");const O=l?`${s}?role=${encodeURIComponent(l)}`:s,E=await fetch(O);if(!E.ok)throw new Error(`Failed to fetch: ${E.status}`);const te=await E.json();t(4,d=te.nodes),m=te.edges}}catch(O){t(3,p=O.message),console.error("Error fetching rolegraph:",O)}finally{t(2,a=!1)}}function k(O,E){O.stopPropagation(),console.log("Node clicked:",E.label),t(5,_=Dr(E)),t(7,g=!1),t(6,h=!0)}function v(O,E){O.preventDefault(),O.stopPropagation(),console.log("Node right-clicked:",E.label),_debugMessage=`Right-clicked: ${E.label}`,t(5,_=Dr(E)),t(7,g=!0),t(6,h=!0),setTimeout(()=>{_debugMessage=""},2e3)}function L(){t(6,h=!1),t(5,_=null),t(7,g=!1)}async function R(){if(_)try{const O=await fetch("/documents",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(_)});O.ok?console.log("Successfully saved KG record:",_.id):console.error("Failed to save KG record:",O.statusText)}catch(O){console.error("Error saving KG record:",O)}finally{t(6,h=!1),t(5,_=null),t(7,g=!1)}}function A(){if(!u)return;t(1,u.innerHTML="",u);const O=Ul(u).append("svg").attr("width",w).attr("height",C),E=ca().scaleExtent([.1,10]).on("zoom",U=>{te.attr("transform",U.transform)});O.call(E);const te=O.append("g"),M=ua(d).force("link",fa(m).id(U=>U.id).distance(100)).force("charge",da().strength(-200)).force("center",pa(w/2,C/2)).force("collision",ma().radius(20)),X=te.append("g").attr("class","links").selectAll("line").data(m).enter().append("line").attr("stroke","#666").attr("stroke-opacity",.7).attr("stroke-width",U=>{const K=U.weight||U.rank||1;return Math.max(1,Math.min(8,K*2))}),J=te.append("g").attr("class","nodes").selectAll("circle").data(d).enter().append("circle").attr("r",U=>{const K=U.rank||1;return Math.max(6,Math.min(20,K*2))}).attr("fill",U=>{const K=U.rank||1,Y=Math.min(K/10,1);return _a(.2+Y*.6)}).attr("stroke","#fff").attr("stroke-width",2).style("cursor","pointer").on("click",(U,K)=>k(U,K)).on("contextmenu",(U,K)=>v(U,K)).on("mouseover",function(U,K){Ul(this).transition().duration(150).attr("stroke-width",3).attr("r",Y=>{const re=Y.rank||1;return Math.max(8,Math.min(24,re*2.5))})}).on("mouseout",function(U,K){Ul(this).transition().duration(150).attr("stroke-width",2).attr("r",Y=>{const re=Y.rank||1;return Math.max(6,Math.min(20,re*2))})}).call(ha().on("start",H).on("drag",z).on("end",P)),F=te.append("g").attr("class","labels").selectAll("text").data(d).enter().append("text").attr("text-anchor","middle").attr("dy",".35em").attr("font-size","11px").attr("font-family","Arial, sans-serif").attr("fill","#333").attr("pointer-events","none").text(U=>U.label.length>12?`${U.label.substring(0,12)}...`:U.label);M.on("tick",()=>{X.attr("x1",U=>U.source.x).attr("y1",U=>U.source.y).attr("x2",U=>U.target.x).attr("y2",U=>U.target.y),J.attr("cx",U=>U.x).attr("cy",U=>U.y),F.attr("x",U=>U.x).attr("y",U=>U.y)});function H(U,K){U.active||M.alphaTarget(.3).restart(),K.fx=K.x,K.fy=K.y}function z(U,K){K.fx=U.x,K.fy=U.y}function P(U,K){U.active||M.alphaTarget(0),K.fx=null,K.fy=null}}Dn(()=>{T().then(()=>{p||A()});const O=E=>{E.preventDefault()};return u&&u.addEventListener("contextmenu",O),window.addEventListener("resize",y),()=>{u&&u.removeEventListener("contextmenu",O),window.removeEventListener("resize",y)}});function N(){t(8,w=Ql.innerWidth),t(9,C=Ql.innerHeight)}function D(O){yt[O?"unshift":"push"](()=>{u=O,t(1,u)})}const B=()=>history.back();function V(O){h=O,t(6,h)}return[r,u,a,p,d,_,h,g,w,C,T,L,R,s,N,D,B,V]}class Nd extends Ht{constructor(e){super(),Ft(this,e,Dd,Ld,jt,{apiUrl:13,fullscreen:0})}get apiUrl(){return this.$$.ctx[13]}get fullscreen(){return this.$$.ctx[0]}}function Id(n){let e,t;return{c(){e=f("option"),t=I(n[1]),e.__value=n[0],ke(e,e.__value)},m(l,o){S(l,e,o),i(e,t)},p(l,[o]){o&2&&ve(t,l[1]),o&1&&(e.__value=l[0],ke(e,e.__value))},i:Fe,o:Fe,d(l){l&&$(e)}}}function Md(n,e,t){let l;lt(n,name,r=>t(1,l=r));let{subject:o}=e;const s=gi(o);return Ol(s,vi.properties.name),Ol(s,"http://localhost:9883/property/theme"),n.$$set=r=>{"subject"in r&&t(0,o=r.subject)},[o,l]}class Pd extends Ht{constructor(e){super(),Ft(this,e,Md,Id,jt,{subject:0})}}function Nr(n,e,t){const l=n.slice();return l[30]=e[t],l}function jd(n){let e,t,l;function o(r){n[13](r)}let s={};return n[4]!==void 0&&(s.value=n[4]),e=new Zn({props:s}),yt.push(()=>Et(e,"value",o)),{c(){$e(e.$$.fragment)},m(r,u){Te(e,r,u),l=!0},p(r,u){const a={};!t&&u[0]&16&&(t=!0,a.value=r[4],At(()=>t=!1)),e.$set(a)},i(r){l||(q(e.$$.fragment,r),l=!0)},o(r){Z(e.$$.fragment,r),l=!1},d(r){Ce(e,r)}}}function Ud(n){let e,t,l;function o(r){n[14](r)}let s={type:"password",placeholder:"secret",icon:"fas fa-lock",expanded:!0};return n[5]!==void 0&&(s.value=n[5]),e=new Zn({props:s}),yt.push(()=>Et(e,"value",o)),{c(){$e(e.$$.fragment)},m(r,u){Te(e,r,u),l=!0},p(r,u){const a={};!t&&u[0]&32&&(t=!0,a.value=r[5],At(()=>t=!1)),e.$set(a)},i(r){l||(q(e.$$.fragment,r),l=!0)},o(r){Z(e.$$.fragment,r),l=!1},d(r){Ce(e,r)}}}function Hd(n){let e;return{c(){e=I("Save")},m(t,l){S(t,e,l)},d(t){t&&$(e)}}}function Fd(n){let e,t;return e=new rl({props:{type:"is-success",class:"is-right",iconPack:"fa",iconLeft:"check",$$slots:{default:[Hd]},$$scope:{ctx:n}}}),e.$on("click",n[8]),e.$on("submit",n[8]),{c(){$e(e.$$.fragment)},m(l,o){Te(e,l,o),t=!0},p(l,o){const s={};o[1]&4&&(s.$$scope={dirty:o,ctx:l}),e.$set(s)},i(l){t||(q(e.$$.fragment,l),t=!0)},o(l){Z(e.$$.fragment,l),t=!1},d(l){Ce(e,l)}}}function zd(n){let e,t,l,o,s,r;return e=new On({props:{$$slots:{default:[jd]},$$scope:{ctx:n}}}),l=new On({props:{grouped:!0,$$slots:{default:[Ud]},$$scope:{ctx:n}}}),s=new On({props:{grouped:!0,$$slots:{default:[Fd]},$$scope:{ctx:n}}}),{c(){$e(e.$$.fragment),t=b(),$e(l.$$.fragment),o=b(),$e(s.$$.fragment)},m(u,a){Te(e,u,a),S(u,t,a),Te(l,u,a),S(u,o,a),Te(s,u,a),r=!0},p(u,a){const p={};a[0]&16|a[1]&4&&(p.$$scope={dirty:a,ctx:u}),e.$set(p);const d={};a[0]&32|a[1]&4&&(d.$$scope={dirty:a,ctx:u}),l.$set(d);const m={};a[1]&4&&(m.$$scope={dirty:a,ctx:u}),s.$set(m)},i(u){r||(q(e.$$.fragment,u),q(l.$$.fragment,u),q(s.$$.fragment,u),r=!0)},o(u){Z(e.$$.fragment,u),Z(l.$$.fragment,u),Z(s.$$.fragment,u),r=!1},d(u){u&&($(t),$(o)),Ce(e,u),Ce(l,u),Ce(s,u)}}}function Kd(n){let e,t,l;function o(r){n[15](r)}let s={type:"search",placeholder:"Fetch JSON",icon:"search"};return n[2]!==void 0&&(s.value=n[2]),e=new Zn({props:s}),yt.push(()=>Et(e,"value",o)),{c(){$e(e.$$.fragment)},m(r,u){Te(e,r,u),l=!0},p(r,u){const a={};!t&&u[0]&4&&(t=!0,a.value=r[2],At(()=>t=!1)),e.$set(a)},i(r){l||(q(e.$$.fragment,r),l=!0)},o(r){Z(e.$$.fragment,r),l=!1},d(r){Ce(e,r)}}}function Bd(n){let e;return{c(){e=I("WikiPage")},m(t,l){S(t,e,l)},d(t){t&&$(e)}}}function Wd(n){let e,t,l,o,s,r;function u(m){n[16](m)}let a={type:"search",placeholder:"Post JSON",icon:"search"};n[3]!==void 0&&(a.value=n[3]),e=new Zn({props:a}),yt.push(()=>Et(e,"value",u));function p(m){n[17](m)}let d={$$slots:{default:[Bd]},$$scope:{ctx:n}};return n[1]!==void 0&&(d.checked=n[1]),o=new la({props:d}),yt.push(()=>Et(o,"checked",p)),{c(){$e(e.$$.fragment),l=b(),$e(o.$$.fragment)},m(m,_){Te(e,m,_),S(m,l,_),Te(o,m,_),r=!0},p(m,_){const h={};!t&&_[0]&8&&(t=!0,h.value=m[3],At(()=>t=!1)),e.$set(h);const g={};_[1]&4&&(g.$$scope={dirty:_,ctx:m}),!s&&_[0]&2&&(s=!0,g.checked=m[1],At(()=>s=!1)),o.$set(g)},i(m){r||(q(e.$$.fragment,m),q(o.$$.fragment,m),r=!0)},o(m){Z(e.$$.fragment,m),Z(o.$$.fragment,m),r=!1},d(m){m&&$(l),Ce(e,m),Ce(o,m)}}}function Gd(n){let e;return{c(){e=I("Fetch")},m(t,l){S(t,e,l)},d(t){t&&$(e)}}}function qd(n){let e,t;return e=new rl({props:{type:"is-primary",$$slots:{default:[Gd]},$$scope:{ctx:n}}}),e.$on("click",n[9]),e.$on("submit",n[9]),{c(){$e(e.$$.fragment)},m(l,o){Te(e,l,o),t=!0},p(l,o){const s={};o[1]&4&&(s.$$scope={dirty:o,ctx:l}),e.$set(s)},i(l){t||(q(e.$$.fragment,l),t=!0)},o(l){Z(e.$$.fragment,l),t=!1},d(l){Ce(e,l)}}}function Vd(n){let e,t,l,o,s,r;return e=new On({props:{grouped:!0,$$slots:{default:[Kd]},$$scope:{ctx:n}}}),l=new On({props:{grouped:!0,$$slots:{default:[Wd]},$$scope:{ctx:n}}}),s=new On({props:{grouped:!0,$$slots:{default:[qd]},$$scope:{ctx:n}}}),{c(){$e(e.$$.fragment),t=b(),$e(l.$$.fragment),o=b(),$e(s.$$.fragment)},m(u,a){Te(e,u,a),S(u,t,a),Te(l,u,a),S(u,o,a),Te(s,u,a),r=!0},p(u,a){const p={};a[0]&4|a[1]&4&&(p.$$scope={dirty:a,ctx:u}),e.$set(p);const d={};a[0]&10|a[1]&4&&(d.$$scope={dirty:a,ctx:u}),l.$set(d);const m={};a[1]&4&&(m.$$scope={dirty:a,ctx:u}),s.$set(m)},i(u){r||(q(e.$$.fragment,u),q(l.$$.fragment,u),q(s.$$.fragment,u),r=!0)},o(u){Z(e.$$.fragment,u),Z(l.$$.fragment,u),Z(s.$$.fragment,u),r=!1},d(u){u&&($(t),$(o)),Ce(e,u),Ce(l,u),Ce(s,u)}}}function Jd(n){let e,t,l,o,s;return o=new hi({props:{content:n[11],onChange:n[10]}}),{c(){e=f("p"),e.innerHTML=`<i>The best editing experience is to configure Atomic Server, in the
        meantime use editor below. You will need to refresh page via Command R
        or Ctrl-R to see changes</i>`,t=b(),l=f("div"),$e(o.$$.fragment),c(l,"class","editor")},m(r,u){S(r,e,u),S(r,t,u),S(r,l,u),Te(o,l,null),s=!0},p:Fe,i(r){s||(q(o.$$.fragment,r),s=!0)},o(r){Z(o.$$.fragment,r),s=!1},d(r){r&&($(e),$(t),$(l)),Ce(o)}}}function Ir(n){let e,t;return e=new Pd({props:{subject:n[30]}}),{c(){$e(e.$$.fragment)},m(l,o){Te(e,l,o),t=!0},p(l,o){const s={};o[0]&1&&(s.subject=l[30]),e.$set(s)},i(l){t||(q(e.$$.fragment,l),t=!0)},o(l){Z(e.$$.fragment,l),t=!1},d(l){Ce(e,l)}}}function Qd(n){let e,t,l=Ge(n[0]??[]),o=[];for(let r=0;r<l.length;r+=1)o[r]=Ir(Nr(n,l,r));const s=r=>Z(o[r],1,1,()=>{o[r]=null});return{c(){for(let r=0;r<o.length;r+=1)o[r].c();e=Nt()},m(r,u){for(let a=0;a<o.length;a+=1)o[a]&&o[a].m(r,u);S(r,e,u),t=!0},p(r,u){if(u[0]&1){l=Ge(r[0]??[]);let a;for(a=0;a<l.length;a+=1){const p=Nr(r,l,a);o[a]?(o[a].p(p,u),q(o[a],1)):(o[a]=Ir(p),o[a].c(),q(o[a],1),o[a].m(e.parentNode,e))}for(rt(),a=l.length;a<o.length;a+=1)s(a);it()}},i(r){if(!t){for(let u=0;u<l.length;u+=1)q(o[u]);t=!0}},o(r){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)Z(o[u]);t=!1},d(r){r&&$(e),Ct(o,r)}}}function Yd(n){let e,t;return e=new na({props:{$$slots:{default:[Qd]},$$scope:{ctx:n}}}),{c(){$e(e.$$.fragment)},m(l,o){Te(e,l,o),t=!0},p(l,o){const s={};o[0]&1|o[1]&4&&(s.$$scope={dirty:o,ctx:l}),e.$set(s)},i(l){t||(q(e.$$.fragment,l),t=!0)},o(l){Z(e.$$.fragment,l),t=!1},d(l){Ce(e,l)}}}function Xd(n){let e,t,l,o,s,r,u,a,p,d,m,_,h;return t=new bn({props:{path:"/atomic",$$slots:{default:[zd]},$$scope:{ctx:n}}}),o=new bn({props:{path:"/json",$$slots:{default:[Vd]},$$scope:{ctx:n}}}),r=new bn({props:{path:"/editor",$$slots:{default:[Jd]},$$scope:{ctx:n}}}),d=new On({props:{grouped:!0,position:"is-right",$$slots:{default:[Yd]},$$scope:{ctx:n}}}),{c(){e=f("div"),$e(t.$$.fragment),l=b(),$e(o.$$.fragment),s=b(),$e(r.$$.fragment),u=b(),a=f("hr"),p=b(),$e(d.$$.fragment),m=b(),_=f("nav"),_.innerHTML='<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> <a class="navbar-item" href="/fetch/json">Fetch JSON Data</a> <a class="navbar-item" href="/fetch/atomic">Set Atomic Server</a> <a class="navbar-item" href="/fetch/editor">Edit JSON config</a></div>',c(e,"class","box"),c(_,"class","navbar")},m(g,w){S(g,e,w),Te(t,e,null),i(e,l),Te(o,e,null),i(e,s),Te(r,e,null),S(g,u,w),S(g,a,w),S(g,p,w),Te(d,g,w),S(g,m,w),S(g,_,w),h=!0},p(g,w){const C={};w[0]&48|w[1]&4&&(C.$$scope={dirty:w,ctx:g}),t.$set(C);const y={};w[0]&14|w[1]&4&&(y.$$scope={dirty:w,ctx:g}),o.$set(y);const T={};w[1]&4&&(T.$$scope={dirty:w,ctx:g}),r.$set(T);const k={};w[0]&1|w[1]&4&&(k.$$scope={dirty:w,ctx:g}),d.$set(k)},i(g){h||(q(t.$$.fragment,g),q(o.$$.fragment,g),q(r.$$.fragment,g),q(d.$$.fragment,g),h=!0)},o(g){Z(t.$$.fragment,g),Z(o.$$.fragment,g),Z(r.$$.fragment,g),Z(d.$$.fragment,g),h=!1},d(g){g&&($(e),$(u),$(a),$(p),$(m),$(_)),Ce(t),Ce(o),Ce(r),Ce(d,g)}}}function Zd(n,e,t){let l,o,s,r=Fe,u=()=>(r(),r=Co(o,P=>t(0,s=P)),o),a,p=Fe,d=()=>(p(),p=Co(l,P=>t(12,a=P)),l),m,_,h;lt(n,ga,P=>t(20,m=P)),lt(n,It,P=>t(21,_=P)),lt(n,on,P=>t(22,h=P)),n.$$.on_destroy.push(()=>r()),n.$$.on_destroy.push(()=>p());let g={json:h};function w(P){if(console.log("contents changed:",P),console.log("is tauri",_),on.update(U=>(U=P.json,U)),It)console.log("Updating config on server"),Ze("update_config",{configNew:P.json}).then(U=>{console.log(`Message: ${U}`)}).catch(U=>console.error(U));else{const U=`${mt.ServerURL}/config/`;fetch(U,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(P.json)})}g=P}let C=!1,y="https://raw.githubusercontent.com/terraphim/terraphim-cloud-fastapi/main/data/ref_arch.json",T="http://localhost:8000/documents/",k="http://localhost:9883/",v;const L=async()=>{console.log("Updating atomic server configuration");const P=va.fromSecret(v);m.setServerUrl(k),console.log("Server set.Setting agent"),m.setAgent(P)},R=async()=>{D()},A=({data:{msg:P,data:U}})=>{console.log(P,U)};let N;const D=async()=>{const P=await il(()=>import("./fetcher.worker-CGgzh86u.js"),[]);N=new P.default,N.onmessage=A;const U={msg:"fetcher",data:{url:y,postUrl:T,isWiki:C}};N.postMessage(U)},B=gi("http://localhost:9883/config/y3zx5wtm0bq"),V=Ol(B,vi.properties.name),O=Ol(B,"http://localhost:9883/property/role"),E=R,te=w,M=g;function X(P){k=P,t(4,k)}function J(P){v=P,t(5,v)}function F(P){y=P,t(2,y)}function H(P){T=P,t(3,T)}function z(P){C=P,t(1,C)}return n.$$.update=()=>{n.$$.dirty[0]&4096&&console.log("Print name",a),n.$$.dirty[0]&1&&console.log("Print roles",s)},d(t(7,l=V)),u(t(6,o=O)),[s,C,y,T,k,v,o,l,L,E,te,M,a,X,J,F,H,z]}class xd extends Ht{constructor(e){super(),Ft(this,e,Zd,Xd,jt,{},null,[-1,-1])}}async function Yl(n={}){return typeof n=="object"&&Object.freeze(n),zn({__tauriModule:"Dialog",message:{cmd:"openDialog",options:n}})}async function ep(n={}){return typeof n=="object"&&Object.freeze(n),zn({__tauriModule:"Dialog",message:{cmd:"saveDialog",options:n}})}async function tp(n,e){var t,l;const o=typeof e=="string"?{title:e}:e;return zn({__tauriModule:"Dialog",message:{cmd:"messageDialog",message:n.toString(),title:(t=o==null?void 0:o.title)===null||t===void 0?void 0:t.toString(),type:o==null?void 0:o.type,buttonLabel:(l=o==null?void 0:o.okLabel)===null||l===void 0?void 0:l.toString()}})}async function np(n,e){var t,l,o,s,r;const u=typeof e=="string"?{title:e}:e;return zn({__tauriModule:"Dialog",message:{cmd:"askDialog",message:n.toString(),title:(t=u==null?void 0:u.title)===null||t===void 0?void 0:t.toString(),type:u==null?void 0:u.type,buttonLabels:[(o=(l=u==null?void 0:u.okLabel)===null||l===void 0?void 0:l.toString())!==null&&o!==void 0?o:"Yes",(r=(s=u==null?void 0:u.cancelLabel)===null||s===void 0?void 0:s.toString())!==null&&r!==void 0?r:"No"]}})}async function lp(n,e){var t,l,o,s,r;const u=typeof e=="string"?{title:e}:e;return zn({__tauriModule:"Dialog",message:{cmd:"confirmDialog",message:n.toString(),title:(t=u==null?void 0:u.title)===null||t===void 0?void 0:t.toString(),type:u==null?void 0:u.type,buttonLabels:[(o=(l=u==null?void 0:u.okLabel)===null||l===void 0?void 0:l.toString())!==null&&o!==void 0?o:"Ok",(r=(s=u==null?void 0:u.cancelLabel)===null||s===void 0?void 0:s.toString())!==null&&r!==void 0?r:"Cancel"]}})}const ji=Object.freeze(Object.defineProperty({__proto__:null,ask:np,confirm:lp,message:tp,open:Yl,save:ep},Symbol.toStringTag,{value:"Module"}));function Mr(n,e,t){const l=n.slice();return l[88]=e[t],l[96]=t,l}function Pr(n,e,t){const l=n.slice();return l[94]=e[t],l[95]=e,l[96]=t,l}function jr(n,e,t){const l=n.slice();return l[97]=e[t],l}function Ur(n,e,t){const l=n.slice();return l[97]=e[t],l}function Hr(n,e,t){const l=n.slice();return l[102]=e[t],l[103]=e,l[104]=t,l}function Fr(n,e,t){const l=n.slice();return l[105]=e[t][0],l[106]=e[t][1],l[107]=e,l[108]=t,l}function zr(n,e,t){const l=n.slice();return l[91]=e[t],l}function Kr(n,e,t){const l=n.slice();return l[88]=e[t],l}function Br(n,e,t){const l=n.slice();return l[91]=e[t],l}function Wr(n){let e,t,l,o,s;return{c(){e=f("div"),t=f("button"),l=I(`
      Configuration saved successfully!`),c(t,"class","delete"),c(e,"class","notification is-success"),c(e,"data-testid","wizard-success")},m(r,u){S(r,e,u),i(e,t),i(e,l),o||(s=ee(t,"click",n[22]),o=!0)},p:Fe,d(r){r&&$(e),o=!1,s()}}}function Gr(n){let e,t,l,o,s;return{c(){e=f("div"),t=f("button"),l=I(`
      Failed to save configuration. Please try again.`),c(t,"class","delete"),c(e,"class","notification is-danger"),c(e,"data-testid","wizard-error")},m(r,u){S(r,e,u),i(e,t),i(e,l),o||(s=ee(t,"click",n[23]),o=!0)},p:Fe,d(r){r&&$(e),o=!1,s()}}}function op(n){let e,t,l,o,s,r,u,a,p,d=n[5].id+"",m,_,h,g,w,C=n[5].global_shortcut+"",y,T,k,v,L,R=n[5].default_theme+"",A,N,D,B,V,O=n[5].default_role+"",E,te,M,X,J,F,H=JSON.stringify(n[5],null,2)+"",z,P=Ge(n[5].roles),U=[];for(let K=0;K<P.length;K+=1)U[K]=qr(Mr(n,P,K));return{c(){e=f("h4"),e.textContent="Review",t=b(),l=f("div"),o=f("h5"),o.textContent="Configuration Summary:",s=b(),r=f("ul"),u=f("li"),a=f("strong"),a.textContent="Configuration ID:",p=b(),m=I(d),_=b(),h=f("li"),g=f("strong"),g.textContent="Global Shortcut:",w=b(),y=I(C),T=b(),k=f("li"),v=f("strong"),v.textContent="Default Theme:",L=b(),A=I(R),N=b(),D=f("li"),B=f("strong"),B.textContent="Default Role:",V=b(),E=I(O),te=b(),M=f("h5"),M.textContent="Roles:",X=b();for(let K=0;K<U.length;K+=1)U[K].c();J=b(),F=f("pre"),z=I(H),c(e,"class","title is-5"),c(l,"class","content"),Ie(F,"max-height","300px"),Ie(F,"overflow","auto")},m(K,Y){S(K,e,Y),S(K,t,Y),S(K,l,Y),i(l,o),i(l,s),i(l,r),i(r,u),i(u,a),i(u,p),i(u,m),i(r,_),i(r,h),i(h,g),i(h,w),i(h,y),i(r,T),i(r,k),i(k,v),i(k,L),i(k,A),i(r,N),i(r,D),i(D,B),i(D,V),i(D,E),i(l,te),i(l,M),i(l,X);for(let re=0;re<U.length;re+=1)U[re]&&U[re].m(l,null);S(K,J,Y),S(K,F,Y),i(F,z)},p(K,Y){if(Y[0]&32&&d!==(d=K[5].id+"")&&ve(m,d),Y[0]&32&&C!==(C=K[5].global_shortcut+"")&&ve(y,C),Y[0]&32&&R!==(R=K[5].default_theme+"")&&ve(A,R),Y[0]&32&&O!==(O=K[5].default_role+"")&&ve(E,O),Y[0]&36){P=Ge(K[5].roles);let re;for(re=0;re<P.length;re+=1){const ae=Mr(K,P,re);U[re]?U[re].p(ae,Y):(U[re]=qr(ae),U[re].c(),U[re].m(l,null))}for(;re<U.length;re+=1)U[re].d(1);U.length=P.length}Y[0]&32&&H!==(H=JSON.stringify(K[5],null,2)+"")&&ve(z,H)},d(K){K&&($(e),$(t),$(l),$(J),$(F)),Ct(U,K)}}}function sp(n){let e,t,l=[],o=new Map,s,r,u,a,p=Ge(n[5].roles);const d=m=>m[94].name;for(let m=0;m<p.length;m+=1){let _=Pr(n,p,m),h=d(_);o.set(h,l[m]=ii(h,_))}return{c(){e=f("h4"),e.textContent="Roles",t=b();for(let m=0;m<l.length;m+=1)l[m].c();s=b(),r=f("button"),r.textContent="Add Role",c(e,"class","title is-5"),c(r,"class","button is-link is-light"),c(r,"data-testid","add-role")},m(m,_){S(m,e,_),S(m,t,_);for(let h=0;h<l.length;h+=1)l[h]&&l[h].m(m,_);S(m,s,_),S(m,r,_),u||(a=ee(r,"click",n[19]),u=!0)},p(m,_){_[0]&1113962&&(p=Ge(m[5].roles),l=fi(l,_,d,1,m,p,o,s.parentNode,di,ii,s,Pr))},d(m){m&&($(e),$(t),$(s),$(r));for(let _=0;_<l.length;_+=1)l[_].d(m);u=!1,a()}}}function rp(n){let e,t,l,o,s,r,u,a,p,d,m,_,h,g,w,C,y,T,k,v,L,R,A,N,D,B,V,O,E,te,M,X=Ge(n[3]),J=[];for(let z=0;z<X.length;z+=1)J[z]=ai(Br(n,X,z));let F=Ge(n[5].roles),H=[];for(let z=0;z<F.length;z+=1)H[z]=ci(Kr(n,F,z));return{c(){e=f("div"),t=f("label"),t.textContent="Configuration ID",l=b(),o=f("div"),s=f("div"),r=f("select"),u=f("option"),u.textContent="Desktop",a=f("option"),a.textContent="Server",p=f("option"),p.textContent="Embedded",d=b(),m=f("div"),_=f("label"),_.textContent="Global shortcut",h=b(),g=f("div"),w=f("input"),C=b(),y=f("div"),T=f("label"),T.textContent="Default theme",k=b(),v=f("div"),L=f("div"),R=f("select");for(let z=0;z<J.length;z+=1)J[z].c();A=b(),N=f("div"),D=f("label"),D.textContent="Default Role",B=b(),V=f("div"),O=f("div"),E=f("select");for(let z=0;z<H.length;z+=1)H[z].c();c(t,"class","label"),c(t,"for","config-id"),u.__value="Desktop",ke(u,u.__value),a.__value="Server",ke(a,a.__value),p.__value="Embedded",ke(p,p.__value),c(r,"id","config-id"),n[5].id===void 0&&Pt(()=>n[24].call(r)),c(s,"class","select"),c(o,"class","control"),c(e,"class","field"),c(_,"class","label"),c(_,"for","global-shortcut"),c(w,"class","input"),c(w,"id","global-shortcut"),c(w,"type","text"),c(g,"class","control"),c(m,"class","field"),c(T,"class","label"),c(T,"for","default-theme"),c(R,"id","default-theme"),n[5].default_theme===void 0&&Pt(()=>n[26].call(R)),c(L,"class","select is-fullwidth"),c(v,"class","control"),c(y,"class","field"),c(D,"class","label"),c(D,"for","default-role"),c(E,"id","default-role"),n[5].default_role===void 0&&Pt(()=>n[27].call(E)),c(O,"class","select"),c(V,"class","control"),c(N,"class","field")},m(z,P){S(z,e,P),i(e,t),i(e,l),i(e,o),i(o,s),i(s,r),i(r,u),i(r,a),i(r,p),pt(r,n[5].id,!0),S(z,d,P),S(z,m,P),i(m,_),i(m,h),i(m,g),i(g,w),ke(w,n[5].global_shortcut),S(z,C,P),S(z,y,P),i(y,T),i(y,k),i(y,v),i(v,L),i(L,R);for(let U=0;U<J.length;U+=1)J[U]&&J[U].m(R,null);pt(R,n[5].default_theme,!0),S(z,A,P),S(z,N,P),i(N,D),i(N,B),i(N,V),i(V,O),i(O,E);for(let U=0;U<H.length;U+=1)H[U]&&H[U].m(E,null);pt(E,n[5].default_role,!0),te||(M=[ee(r,"change",n[24]),ee(w,"input",n[25]),ee(R,"change",n[26]),ee(E,"change",n[27])],te=!0)},p(z,P){if(P[0]&40&&pt(r,z[5].id),P[0]&40&&w.value!==z[5].global_shortcut&&ke(w,z[5].global_shortcut),P[0]&8){X=Ge(z[3]);let U;for(U=0;U<X.length;U+=1){const K=Br(z,X,U);J[U]?J[U].p(K,P):(J[U]=ai(K),J[U].c(),J[U].m(R,null))}for(;U<J.length;U+=1)J[U].d(1);J.length=X.length}if(P[0]&40&&pt(R,z[5].default_theme),P[0]&32){F=Ge(z[5].roles);let U;for(U=0;U<F.length;U+=1){const K=Kr(z,F,U);H[U]?H[U].p(K,P):(H[U]=ci(K),H[U].c(),H[U].m(E,null))}for(;U<H.length;U+=1)H[U].d(1);H.length=F.length}P[0]&40&&pt(E,z[5].default_role)},d(z){z&&($(e),$(d),$(m),$(C),$(y),$(A),$(N)),Ct(J,z),Ct(H,z),te=!1,ft(M)}}}function qr(n){let e,t,l=n[88].name+"",o,s,r,u,a,p=n[88].shortname+"",d,m,_,h,g,w=n[88].theme+"",C,y,T,k,v,L=n[88].relevance_function+"",R,A,N,D,B,V;return{c(){e=f("div"),t=f("h6"),o=I(l),s=b(),r=f("p"),u=f("strong"),u.textContent="Shortname:",a=b(),d=I(p),m=b(),_=f("p"),h=f("strong"),h.textContent="Theme:",g=b(),C=I(w),y=b(),T=f("p"),k=f("strong"),k.textContent="Relevance Function:",v=b(),R=I(L),A=b(),N=f("button"),N.textContent="Edit Role",D=b(),c(t,"data-testid","review-role-name-"+n[96]),c(N,"class","button is-small"),c(N,"data-testid","edit-role-"+n[96]),c(e,"class","box")},m(O,E){S(O,e,E),i(e,t),i(t,o),i(e,s),i(e,r),i(r,u),i(r,a),i(r,d),i(e,m),i(e,_),i(_,h),i(_,g),i(_,C),i(e,y),i(e,T),i(T,k),i(T,v),i(T,R),i(e,A),i(e,N),i(e,D),B||(V=ee(N,"click",n[71]),B=!0)},p(O,E){E[0]&32&&l!==(l=O[88].name+"")&&ve(o,l),E[0]&32&&p!==(p=O[88].shortname+"")&&ve(d,p),E[0]&32&&w!==(w=O[88].theme+"")&&ve(C,w),E[0]&32&&L!==(L=O[88].relevance_function+"")&&ve(R,L)},d(O){O&&$(e),B=!1,V()}}}function Vr(n){let e,t=n[91]+"",l,o;return{c(){e=f("option"),l=I(t),e.__value=o=n[91],ke(e,e.__value)},m(s,r){S(s,e,r),i(e,l)},p(s,r){r[0]&8&&t!==(t=s[91]+"")&&ve(l,t),r[0]&8&&o!==(o=s[91])&&(e.__value=o,ke(e,e.__value))},d(s){s&&$(e)}}}function ip(n){let e;return{c(){e=I("Directory Path")},m(t,l){S(t,e,l)},d(t){t&&$(e)}}}function ap(n){let e;return{c(){e=I("Server URL")},m(t,l){S(t,e,l)},d(t){t&&$(e)}}}function Jr(n){let e;return{c(){e=f("p"),e.textContent="Click to select directory",c(e,"class","help")},m(t,l){S(t,e,l)},d(t){t&&$(e)}}}function Qr(n){let e,t,l,o,s,r,u,a,p,d,m,_;function h(){n[36].call(u,n[96],n[104])}return{c(){e=f("div"),t=f("label"),l=I("Atomic Server Secret"),s=b(),r=f("div"),u=f("input"),p=b(),d=f("p"),d.textContent="Leave empty for anonymous access",c(t,"class","label"),c(t,"for",o=`haystack-secret-${n[96]}-${n[104]}`),c(u,"class","input"),c(u,"id",a=`haystack-secret-${n[96]}-${n[104]}`),c(u,"type","password"),c(u,"placeholder","Base64 encoded secret (optional)"),c(r,"class","control"),c(d,"class","help"),c(e,"class","field")},m(g,w){S(g,e,w),i(e,t),i(t,l),i(e,s),i(e,r),i(r,u),ke(u,n[5].roles[n[96]].haystacks[n[104]].atomic_server_secret),i(e,p),i(e,d),m||(_=ee(u,"input",h),m=!0)},p(g,w){n=g,w[0]&40&&o!==(o=`haystack-secret-${n[96]}-${n[104]}`)&&c(t,"for",o),w[0]&40&&a!==(a=`haystack-secret-${n[96]}-${n[104]}`)&&c(u,"id",a),w[0]&40&&u.value!==n[5].roles[n[96]].haystacks[n[104]].atomic_server_secret&&ke(u,n[5].roles[n[96]].haystacks[n[104]].atomic_server_secret)},d(g){g&&$(e),m=!1,_()}}}function Yr(n){let e,t,l,o,s,r,u,a,p,d,m,_,h,g,w,C,y,T,k,v,L,R,A,N,D,B,V,O,E,te,M,X,J,F,H,z,P,U,K,Y,re,ae,ne;function Q(){n[37].call(d,n[96],n[104])}function ue(..._e){return n[38](n[96],n[104],..._e)}let se=Ge(Object.entries(n[5].roles[n[96]].haystacks[n[104]].extra_parameters||{})),j=[];for(let _e=0;_e<se.length;_e+=1)j[_e]=Xr(Fr(n,se,_e));function W(){return n[42](n[96],n[104])}function le(){return n[43](n[96],n[104])}function ie(){return n[44](n[96],n[104])}return{c(){e=f("div"),t=f("label"),t.textContent="Extra Parameters (for filtering)",l=b(),o=f("div"),s=f("div"),r=f("label"),u=I("Hashtag"),p=b(),d=f("input"),_=b(),h=f("div"),g=f("div"),w=f("label"),C=I("Presets"),T=b(),k=f("div"),v=f("select"),L=f("option"),L.textContent="(choose)",R=f("option"),R.textContent="#rust",A=f("option"),A.textContent="#docs",N=f("option"),N.textContent="#test",D=f("option"),D.textContent="#todo",V=b(),O=f("p"),O.innerHTML="When set, searches will enforce the hashtag alongside your query (AND), e.g. <code>-e &quot;search&quot; -e &quot;#rust&quot;</code>.",E=b();for(let _e=0;_e<j.length;_e+=1)j[_e].c();te=b(),M=f("div"),X=f("div"),J=f("button"),J.textContent="+ Tag Filter",F=b(),H=f("div"),z=f("button"),z.textContent="+ Max Results",P=b(),U=f("div"),K=f("button"),K.textContent="+ Custom Parameter",Y=b(),re=f("p"),re.innerHTML=`Common parameters: <code>tag</code> (e.g., &quot;#rust&quot;), <code>glob</code> (e.g., &quot;*.md&quot;),
                  <code>max_count</code> (e.g., &quot;10&quot;), <code>context</code> (e.g., &quot;5&quot;)`,c(t,"class","label"),c(r,"class","label"),c(r,"for",a=`ripgrep-hashtag-${n[96]}-${n[104]}`),c(d,"class","input"),c(d,"id",m=`ripgrep-hashtag-${n[96]}-${n[104]}`),c(d,"type","text"),c(d,"placeholder","#rust"),c(s,"class","control"),c(o,"class","field is-grouped"),c(w,"class","label"),c(w,"for",y=`ripgrep-hashtag-preset-${n[96]}-${n[104]}`),L.__value="",ke(L,L.__value),R.__value="#rust",ke(R,R.__value),A.__value="#docs",ke(A,A.__value),N.__value="#test",ke(N,N.__value),D.__value="#todo",ke(D,D.__value),c(v,"id",B=`ripgrep-hashtag-preset-${n[96]}-${n[104]}`),c(k,"class","select is-small"),c(g,"class","control"),c(h,"class","field is-grouped"),Ie(h,"margin-bottom",".5rem"),c(O,"class","help"),c(J,"class","button is-small is-link is-light"),c(X,"class","control"),c(z,"class","button is-small is-link is-light"),c(H,"class","control"),c(K,"class","button is-small is-link is-light"),c(U,"class","control"),c(M,"class","field is-grouped"),c(re,"class","help"),c(e,"class","field")},m(_e,ce){S(_e,e,ce),i(e,t),i(e,l),i(e,o),i(o,s),i(s,r),i(r,u),i(s,p),i(s,d),ke(d,n[5].roles[n[96]].haystacks[n[104]].extra_parameters.tag),i(e,_),i(e,h),i(h,g),i(g,w),i(w,C),i(g,T),i(g,k),i(k,v),i(v,L),i(v,R),i(v,A),i(v,N),i(v,D),i(e,V),i(e,O),i(e,E);for(let fe=0;fe<j.length;fe+=1)j[fe]&&j[fe].m(e,null);i(e,te),i(e,M),i(M,X),i(X,J),i(M,F),i(M,H),i(H,z),i(M,P),i(M,U),i(U,K),i(e,Y),i(e,re),ae||(ne=[ee(d,"input",Q),ee(v,"change",ue),ee(J,"click",W),ee(z,"click",le),ee(K,"click",ie)],ae=!0)},p(_e,ce){if(n=_e,ce[0]&40&&a!==(a=`ripgrep-hashtag-${n[96]}-${n[104]}`)&&c(r,"for",a),ce[0]&40&&m!==(m=`ripgrep-hashtag-${n[96]}-${n[104]}`)&&c(d,"id",m),ce[0]&40&&d.value!==n[5].roles[n[96]].haystacks[n[104]].extra_parameters.tag&&ke(d,n[5].roles[n[96]].haystacks[n[104]].extra_parameters.tag),ce[0]&40&&y!==(y=`ripgrep-hashtag-preset-${n[96]}-${n[104]}`)&&c(w,"for",y),ce[0]&40&&B!==(B=`ripgrep-hashtag-preset-${n[96]}-${n[104]}`)&&c(v,"id",B),ce[0]&49184){se=Ge(Object.entries(n[5].roles[n[96]].haystacks[n[104]].extra_parameters||{}));let fe;for(fe=0;fe<se.length;fe+=1){const de=Fr(n,se,fe);j[fe]?j[fe].p(de,ce):(j[fe]=Xr(de),j[fe].c(),j[fe].m(e,te))}for(;fe<j.length;fe+=1)j[fe].d(1);j.length=se.length}},d(_e){_e&&$(e),Ct(j,_e),ae=!1,ft(ne)}}}function Xr(n){let e,t,l,o,s,r,u,a,p,d,m,_,h;function g(...y){return n[39](n[96],n[104],n[105],...y)}function w(){n[40].call(u,n[96],n[104],n[105])}function C(){return n[41](n[96],n[104],n[105])}return{c(){e=f("div"),t=f("div"),l=f("input"),s=b(),r=f("div"),u=f("input"),a=b(),p=f("div"),d=f("button"),d.textContent="×",m=b(),c(l,"class","input"),c(l,"type","text"),c(l,"placeholder","Parameter name"),l.value=o=n[105],c(t,"class","control"),c(u,"class","input"),c(u,"type","text"),c(u,"placeholder","Parameter value"),c(r,"class","control is-expanded"),c(d,"class","button is-small is-danger"),c(p,"class","control"),c(e,"class","field is-grouped")},m(y,T){S(y,e,T),i(e,t),i(t,l),i(e,s),i(e,r),i(r,u),ke(u,n[5].roles[n[96]].haystacks[n[104]].extra_parameters[n[105]]),i(e,a),i(e,p),i(p,d),i(e,m),_||(h=[ee(l,"blur",g),ee(u,"input",w),ee(d,"click",C)],_=!0)},p(y,T){n=y,T[0]&40&&o!==(o=n[105])&&l.value!==o&&(l.value=o),T[0]&40&&u.value!==n[5].roles[n[96]].haystacks[n[104]].extra_parameters[n[105]]&&ke(u,n[5].roles[n[96]].haystacks[n[104]].extra_parameters[n[105]])},d(y){y&&$(e),_=!1,ft(h)}}}function Zr(n){let e,t,l,o,s,r,u,a,p,d,m,_,h,g,w,C,y,T,k,v,L,R,A,N,D,B,V,O,E,te,M,X,J,F,H,z,P,U,K,Y,re,ae,ne,Q,ue,se,j,W,le,ie;function _e(){n[33].call(p,n[96],n[104])}function ce(Ve,We){return Ve[5].roles[Ve[96]].haystacks[Ve[104]].service==="Atomic"?ap:ip}let fe=ce(n),de=fe(n);function ze(){n[34].call(k,n[96],n[104])}function Xe(){return n[35](n[96],n[104])}let qe=n[6]&&n[5].roles[n[96]].haystacks[n[104]].service!=="Atomic"&&Jr(),Me=n[5].roles[n[96]].haystacks[n[104]].service==="Atomic"&&Qr(n),Pe=n[5].roles[n[96]].haystacks[n[104]].service==="Ripgrep"&&Yr(n);function he(){n[45].call(E,n[96],n[104])}function Ue(){n[46].call(Y,n[96],n[104])}function xe(){return n[47](n[96],n[104])}return{c(){e=f("div"),t=f("div"),l=f("label"),o=I("Service Type"),r=b(),u=f("div"),a=f("div"),p=f("select"),d=f("option"),d.textContent="Ripgrep (File Search)",m=f("option"),m.textContent="Atomic Server",h=b(),g=f("div"),w=f("label"),de.c(),y=b(),T=f("div"),k=f("input"),A=b(),qe&&qe.c(),N=b(),Me&&Me.c(),D=b(),Pe&&Pe.c(),B=b(),V=f("div"),O=f("label"),E=f("input"),M=I(`
                 Read-only`),J=b(),F=f("div"),H=f("label"),z=I("Ranking Weight"),U=b(),K=f("div"),Y=f("input"),ae=b(),ne=f("p"),ne.textContent="Weight for ranking results (1.0 = normal, >1.0 = higher priority, <1.0 = lower priority)",Q=b(),ue=f("div"),se=f("button"),j=I("Remove Haystack"),c(l,"class","label"),c(l,"for",s=`haystack-service-${n[96]}-${n[104]}`),d.__value="Ripgrep",ke(d,d.__value),m.__value="Atomic",ke(m,m.__value),c(p,"id",_=`haystack-service-${n[96]}-${n[104]}`),n[5].roles[n[96]].haystacks[n[104]].service===void 0&&Pt(_e),c(a,"class","select"),c(u,"class","control"),c(t,"class","field"),c(w,"class","label"),c(w,"for",C=`haystack-path-${n[96]}-${n[104]}`),c(k,"class","input"),c(k,"id",v=`haystack-path-${n[96]}-${n[104]}`),c(k,"type","text"),c(k,"placeholder",L=n[5].roles[n[96]].haystacks[n[104]].service==="Atomic"?"https://localhost:9883":"/path/to/documents"),k.readOnly=R=n[6]&&n[5].roles[n[96]].haystacks[n[104]].service!=="Atomic",c(T,"class","control"),c(g,"class","field"),c(E,"id",te=`haystack-readonly-${n[96]}-${n[104]}`),c(E,"type","checkbox"),c(O,"class","checkbox"),c(O,"for",X=`haystack-readonly-${n[96]}-${n[104]}`),c(V,"class","field"),c(H,"class","label"),c(H,"for",P=`haystack-weight-${n[96]}-${n[104]}`),c(Y,"class","input"),c(Y,"id",re=`haystack-weight-${n[96]}-${n[104]}`),c(Y,"type","number"),c(Y,"min","0"),c(Y,"max","10"),c(Y,"step","0.1"),c(Y,"placeholder","1.0"),c(K,"class","control"),c(ne,"class","help"),c(F,"class","field"),c(se,"class","button is-small is-danger"),c(se,"data-testid",W="remove-haystack-"+n[96]+"-"+n[104]),c(ue,"class","field"),c(e,"class","box is-light")},m(Ve,We){S(Ve,e,We),i(e,t),i(t,l),i(l,o),i(t,r),i(t,u),i(u,a),i(a,p),i(p,d),i(p,m),pt(p,n[5].roles[n[96]].haystacks[n[104]].service,!0),i(e,h),i(e,g),i(g,w),de.m(w,null),i(g,y),i(g,T),i(T,k),ke(k,n[5].roles[n[96]].haystacks[n[104]].path),i(T,A),qe&&qe.m(T,null),i(e,N),Me&&Me.m(e,null),i(e,D),Pe&&Pe.m(e,null),i(e,B),i(e,V),i(V,O),i(O,E),E.checked=n[5].roles[n[96]].haystacks[n[104]].read_only,i(O,M),i(e,J),i(e,F),i(F,H),i(H,z),i(F,U),i(F,K),i(K,Y),ke(Y,n[5].roles[n[96]].haystacks[n[104]].weight),i(F,ae),i(F,ne),i(e,Q),i(e,ue),i(ue,se),i(se,j),le||(ie=[ee(p,"change",_e),ee(k,"input",ze),ee(k,"click",function(){ul(n[6]&&n[5].roles[n[96]].haystacks[n[104]].service!=="Atomic"?Xe:void 0)&&(n[6]&&n[5].roles[n[96]].haystacks[n[104]].service!=="Atomic"?Xe:void 0).apply(this,arguments)}),ee(E,"change",he),ee(Y,"input",Ue),ee(se,"click",xe)],le=!0)},p(Ve,We){n=Ve,We[0]&40&&s!==(s=`haystack-service-${n[96]}-${n[104]}`)&&c(l,"for",s),We[0]&40&&_!==(_=`haystack-service-${n[96]}-${n[104]}`)&&c(p,"id",_),We[0]&40&&pt(p,n[5].roles[n[96]].haystacks[n[104]].service),fe!==(fe=ce(n))&&(de.d(1),de=fe(n),de&&(de.c(),de.m(w,null))),We[0]&40&&C!==(C=`haystack-path-${n[96]}-${n[104]}`)&&c(w,"for",C),We[0]&40&&v!==(v=`haystack-path-${n[96]}-${n[104]}`)&&c(k,"id",v),We[0]&40&&L!==(L=n[5].roles[n[96]].haystacks[n[104]].service==="Atomic"?"https://localhost:9883":"/path/to/documents")&&c(k,"placeholder",L),We[0]&104&&R!==(R=n[6]&&n[5].roles[n[96]].haystacks[n[104]].service!=="Atomic")&&(k.readOnly=R),We[0]&40&&k.value!==n[5].roles[n[96]].haystacks[n[104]].path&&ke(k,n[5].roles[n[96]].haystacks[n[104]].path),n[6]&&n[5].roles[n[96]].haystacks[n[104]].service!=="Atomic"?qe||(qe=Jr(),qe.c(),qe.m(T,null)):qe&&(qe.d(1),qe=null),n[5].roles[n[96]].haystacks[n[104]].service==="Atomic"?Me?Me.p(n,We):(Me=Qr(n),Me.c(),Me.m(e,D)):Me&&(Me.d(1),Me=null),n[5].roles[n[96]].haystacks[n[104]].service==="Ripgrep"?Pe?Pe.p(n,We):(Pe=Yr(n),Pe.c(),Pe.m(e,B)):Pe&&(Pe.d(1),Pe=null),We[0]&40&&te!==(te=`haystack-readonly-${n[96]}-${n[104]}`)&&c(E,"id",te),We[0]&40&&(E.checked=n[5].roles[n[96]].haystacks[n[104]].read_only),We[0]&40&&X!==(X=`haystack-readonly-${n[96]}-${n[104]}`)&&c(O,"for",X),We[0]&40&&P!==(P=`haystack-weight-${n[96]}-${n[104]}`)&&c(H,"for",P),We[0]&40&&re!==(re=`haystack-weight-${n[96]}-${n[104]}`)&&c(Y,"id",re),We[0]&40&&pi(Y.value)!==n[5].roles[n[96]].haystacks[n[104]].weight&&ke(Y,n[5].roles[n[96]].haystacks[n[104]].weight),We[0]&40&&W!==(W="remove-haystack-"+n[96]+"-"+n[104])&&c(se,"data-testid",W)},d(Ve){Ve&&$(e),de.d(),qe&&qe.d(),Me&&Me.d(),Pe&&Pe.d(),le=!1,ft(ie)}}}function xr(n){var H;let e,t,l,o,s,r,u,a,p,d,m,_,h,g,w,C,y,T,k,v,L,R,A,N,D,B,V,O,E;function te(){n[50].call(u,n[96])}function M(){return n[51](n[96])}let X=((H=n[1][n[96]])==null?void 0:H.length)&&ei(n);function J(){n[53].call(k,n[96])}function F(){n[54].call(N,n[96])}return{c(){e=f("div"),t=f("label"),l=I("Model"),s=b(),r=f("div"),u=f("input"),p=b(),d=f("button"),d.textContent="Fetch models",m=b(),X&&X.c(),_=b(),h=f("div"),g=f("label"),w=I("Base URL"),y=b(),T=f("div"),k=f("input"),L=b(),R=f("div"),A=f("label"),N=f("input"),B=I(`
               Automatically summarize search results`),c(t,"class","label"),c(t,"for",o=`llm-model-${n[96]}`),c(u,"class","input"),c(u,"id",a=`llm-model-${n[96]}`),c(u,"type","text"),c(u,"placeholder","llama3.1"),c(r,"class","control"),c(d,"class","button is-small"),c(e,"class","field"),c(g,"class","label"),c(g,"for",C=`llm-base-url-${n[96]}`),c(k,"class","input"),c(k,"id",v=`llm-base-url-${n[96]}`),c(k,"type","text"),c(k,"placeholder","http://127.0.0.1:11434"),c(T,"class","control"),c(h,"class","field"),c(N,"id",D=`llm-auto-summarize-${n[96]}`),c(N,"type","checkbox"),c(A,"class","checkbox"),c(A,"for",V=`llm-auto-summarize-${n[96]}`),c(R,"class","field")},m(z,P){S(z,e,P),i(e,t),i(t,l),i(e,s),i(e,r),i(r,u),ke(u,n[5].roles[n[96]].llm_model),i(e,p),i(e,d),i(e,m),X&&X.m(e,null),S(z,_,P),S(z,h,P),i(h,g),i(g,w),i(h,y),i(h,T),i(T,k),ke(k,n[5].roles[n[96]].llm_base_url),S(z,L,P),S(z,R,P),i(R,A),i(A,N),N.checked=n[5].roles[n[96]].llm_auto_summarize,i(A,B),O||(E=[ee(u,"input",te),ee(d,"click",M),ee(k,"input",J),ee(N,"change",F)],O=!0)},p(z,P){var U;n=z,P[0]&40&&o!==(o=`llm-model-${n[96]}`)&&c(t,"for",o),P[0]&40&&a!==(a=`llm-model-${n[96]}`)&&c(u,"id",a),P[0]&40&&u.value!==n[5].roles[n[96]].llm_model&&ke(u,n[5].roles[n[96]].llm_model),(U=n[1][n[96]])!=null&&U.length?X?X.p(n,P):(X=ei(n),X.c(),X.m(e,null)):X&&(X.d(1),X=null),P[0]&40&&C!==(C=`llm-base-url-${n[96]}`)&&c(g,"for",C),P[0]&40&&v!==(v=`llm-base-url-${n[96]}`)&&c(k,"id",v),P[0]&40&&k.value!==n[5].roles[n[96]].llm_base_url&&ke(k,n[5].roles[n[96]].llm_base_url),P[0]&40&&D!==(D=`llm-auto-summarize-${n[96]}`)&&c(N,"id",D),P[0]&40&&(N.checked=n[5].roles[n[96]].llm_auto_summarize),P[0]&40&&V!==(V=`llm-auto-summarize-${n[96]}`)&&c(A,"for",V)},d(z){z&&($(e),$(_),$(h),$(L),$(R)),X&&X.d(),O=!1,ft(E)}}}function ei(n){let e,t,l,o,s=Ge(n[1][n[96]]),r=[];for(let a=0;a<s.length;a+=1)r[a]=ti(Ur(n,s,a));function u(...a){return n[52](n[96],...a)}return{c(){e=f("div"),t=f("select");for(let a=0;a<r.length;a+=1)r[a].c();c(e,"class","select is-fullwidth"),Ie(e,"margin-top","0.5rem")},m(a,p){S(a,e,p),i(e,t);for(let d=0;d<r.length;d+=1)r[d]&&r[d].m(t,null);l||(o=ee(t,"change",u),l=!0)},p(a,p){if(n=a,p[0]&34){s=Ge(n[1][n[96]]);let d;for(d=0;d<s.length;d+=1){const m=Ur(n,s,d);r[d]?r[d].p(m,p):(r[d]=ti(m),r[d].c(),r[d].m(t,null))}for(;d<r.length;d+=1)r[d].d(1);r.length=s.length}},d(a){a&&$(e),Ct(r,a),l=!1,o()}}}function ti(n){let e,t=n[97]+"",l,o;return{c(){e=f("option"),l=I(t),e.__value=o=n[97],ke(e,e.__value)},m(s,r){S(s,e,r),i(e,l)},p(s,r){r[0]&34&&t!==(t=s[97]+"")&&ve(l,t),r[0]&42&&o!==(o=s[97])&&(e.__value=o,ke(e,e.__value))},d(s){s&&$(e)}}}function ni(n){var ce;let e,t,l,o,s,r,u,a,p,d,m,_,h,g,w,C,y,T,k,v,L,R,A,N,D,B,V,O,E,te,M,X,J,F,H,z,P,U,K,Y,re,ae,ne,Q;function ue(){n[56].call(u,n[96])}function se(){n[57].call(T,n[96])}function j(){return n[58](n[96])}let W=((ce=n[1][n[96]])==null?void 0:ce.length)&&li(n);function le(){n[60].call(O,n[96])}function ie(){n[61].call(P,n[96])}let _e=n[5].roles[n[96]].openrouter_chat_enabled&&si(n);return{c(){e=f("div"),t=f("label"),l=I("OpenRouter API Key"),s=b(),r=f("div"),u=f("input"),p=b(),d=f("p"),d.innerHTML='Get your API key from <a href="https://openrouter.ai" target="_blank" rel="noopener">OpenRouter</a>',m=b(),_=f("div"),h=f("label"),g=I("Model"),C=b(),y=f("div"),T=f("input"),v=b(),L=f("button"),L.textContent="Fetch models",R=b(),W&&W.c(),A=b(),N=f("p"),N.textContent="Choose the language model for generating summaries. Different models offer different speed/quality tradeoffs.",D=b(),B=f("div"),V=f("label"),O=f("input"),te=I(`
               Automatically summarize search results`),X=b(),J=f("p"),J.textContent="When enabled, summaries will be generated and shown in search results.",F=b(),H=f("div"),z=f("label"),P=f("input"),K=I(`
               Enable Chat interface (OpenRouter)`),re=b(),_e&&_e.c(),ae=Nt(),c(t,"class","label"),c(t,"for",o=`openrouter-api-key-${n[96]}`),c(u,"class","input"),c(u,"id",a=`openrouter-api-key-${n[96]}`),c(u,"type","password"),c(u,"placeholder","sk-or-v1-..."),c(r,"class","control"),c(d,"class","help"),c(e,"class","field"),c(h,"class","label"),c(h,"for",w=`openrouter-model-${n[96]}`),c(T,"class","input"),c(T,"id",k=`openrouter-model-${n[96]}`),c(T,"type","text"),c(T,"placeholder","openai/gpt-4-turbo"),c(y,"class","control"),c(L,"class","button is-small"),c(N,"class","help"),c(_,"class","field"),c(O,"id",E=`openrouter-auto-summarize-${n[96]}`),c(O,"type","checkbox"),c(V,"class","checkbox"),c(V,"for",M=`openrouter-auto-summarize-${n[96]}`),c(J,"class","help"),c(B,"class","field"),c(P,"id",U=`openrouter-chat-enabled-${n[96]}`),c(P,"type","checkbox"),c(z,"class","checkbox"),c(z,"for",Y=`openrouter-chat-enabled-${n[96]}`),c(H,"class","field")},m(fe,de){S(fe,e,de),i(e,t),i(t,l),i(e,s),i(e,r),i(r,u),ke(u,n[5].roles[n[96]].openrouter_api_key),i(e,p),i(e,d),S(fe,m,de),S(fe,_,de),i(_,h),i(h,g),i(_,C),i(_,y),i(y,T),ke(T,n[5].roles[n[96]].openrouter_model),i(_,v),i(_,L),i(_,R),W&&W.m(_,null),i(_,A),i(_,N),S(fe,D,de),S(fe,B,de),i(B,V),i(V,O),O.checked=n[5].roles[n[96]].openrouter_auto_summarize,i(V,te),i(B,X),i(B,J),S(fe,F,de),S(fe,H,de),i(H,z),i(z,P),P.checked=n[5].roles[n[96]].openrouter_chat_enabled,i(z,K),S(fe,re,de),_e&&_e.m(fe,de),S(fe,ae,de),ne||(Q=[ee(u,"input",ue),ee(T,"input",se),ee(L,"click",j),ee(O,"change",le),ee(P,"change",ie)],ne=!0)},p(fe,de){var ze;n=fe,de[0]&40&&o!==(o=`openrouter-api-key-${n[96]}`)&&c(t,"for",o),de[0]&40&&a!==(a=`openrouter-api-key-${n[96]}`)&&c(u,"id",a),de[0]&40&&u.value!==n[5].roles[n[96]].openrouter_api_key&&ke(u,n[5].roles[n[96]].openrouter_api_key),de[0]&40&&w!==(w=`openrouter-model-${n[96]}`)&&c(h,"for",w),de[0]&40&&k!==(k=`openrouter-model-${n[96]}`)&&c(T,"id",k),de[0]&40&&T.value!==n[5].roles[n[96]].openrouter_model&&ke(T,n[5].roles[n[96]].openrouter_model),(ze=n[1][n[96]])!=null&&ze.length?W?W.p(n,de):(W=li(n),W.c(),W.m(_,A)):W&&(W.d(1),W=null),de[0]&40&&E!==(E=`openrouter-auto-summarize-${n[96]}`)&&c(O,"id",E),de[0]&40&&(O.checked=n[5].roles[n[96]].openrouter_auto_summarize),de[0]&40&&M!==(M=`openrouter-auto-summarize-${n[96]}`)&&c(V,"for",M),de[0]&40&&U!==(U=`openrouter-chat-enabled-${n[96]}`)&&c(P,"id",U),de[0]&40&&(P.checked=n[5].roles[n[96]].openrouter_chat_enabled),de[0]&40&&Y!==(Y=`openrouter-chat-enabled-${n[96]}`)&&c(z,"for",Y),n[5].roles[n[96]].openrouter_chat_enabled?_e?_e.p(n,de):(_e=si(n),_e.c(),_e.m(ae.parentNode,ae)):_e&&(_e.d(1),_e=null)},d(fe){fe&&($(e),$(m),$(_),$(D),$(B),$(F),$(H),$(re),$(ae)),W&&W.d(),_e&&_e.d(fe),ne=!1,ft(Q)}}}function li(n){let e,t,l,o,s=Ge(n[1][n[96]]),r=[];for(let a=0;a<s.length;a+=1)r[a]=oi(jr(n,s,a));function u(...a){return n[59](n[96],...a)}return{c(){e=f("div"),t=f("select");for(let a=0;a<r.length;a+=1)r[a].c();c(e,"class","select is-fullwidth"),Ie(e,"margin-top","0.5rem")},m(a,p){S(a,e,p),i(e,t);for(let d=0;d<r.length;d+=1)r[d]&&r[d].m(t,null);l||(o=ee(t,"change",u),l=!0)},p(a,p){if(n=a,p[0]&34){s=Ge(n[1][n[96]]);let d;for(d=0;d<s.length;d+=1){const m=jr(n,s,d);r[d]?r[d].p(m,p):(r[d]=oi(m),r[d].c(),r[d].m(t,null))}for(;d<r.length;d+=1)r[d].d(1);r.length=s.length}},d(a){a&&$(e),Ct(r,a),l=!1,o()}}}function oi(n){let e,t=n[97]+"",l,o;return{c(){e=f("option"),l=I(t),e.__value=o=n[97],ke(e,e.__value)},m(s,r){S(s,e,r),i(e,l)},p(s,r){r[0]&34&&t!==(t=s[97]+"")&&ve(l,t),r[0]&42&&o!==(o=s[97])&&(e.__value=o,ke(e,e.__value))},d(s){s&&$(e)}}}function si(n){let e,t,l,o,s,r,u,a,p,d,m,_,h,g,w,C,y,T,k,v,L,R,A,N,D;function B(){n[62].call(a,n[96])}function V(){n[63].call(R,n[96])}return{c(){e=f("div"),t=f("label"),l=I("Chat Model"),s=b(),r=f("div"),u=f("div"),a=f("select"),p=f("option"),p.textContent="GPT-3.5 Turbo",d=f("option"),d.textContent="GPT-4",m=f("option"),m.textContent="Claude 3 Sonnet",_=f("option"),_.textContent="Claude 3 Haiku",h=f("option"),h.textContent="Mixtral 8x7B",w=b(),C=f("div"),y=f("label"),T=I("System Prompt (optional)"),v=b(),L=f("div"),R=f("textarea"),c(t,"class","label"),c(t,"for",o=`openrouter-chat-model-${n[96]}`),p.__value="openai/gpt-3.5-turbo",ke(p,p.__value),d.__value="openai/gpt-4",ke(d,d.__value),m.__value="anthropic/claude-3-sonnet",ke(m,m.__value),_.__value="anthropic/claude-3-haiku",ke(_,_.__value),h.__value="mistralai/mixtral-8x7b-instruct",ke(h,h.__value),c(a,"id",g=`openrouter-chat-model-${n[96]}`),n[5].roles[n[96]].openrouter_chat_model===void 0&&Pt(B),c(u,"class","select is-fullwidth"),c(r,"class","control"),c(e,"class","field"),c(y,"class","label"),c(y,"for",k=`openrouter-chat-system-${n[96]}`),c(R,"class","textarea"),c(R,"id",A=`openrouter-chat-system-${n[96]}`),c(R,"rows","3"),c(R,"placeholder","You are a helpful Rust engineer assistant..."),c(L,"class","control"),c(C,"class","field")},m(O,E){S(O,e,E),i(e,t),i(t,l),i(e,s),i(e,r),i(r,u),i(u,a),i(a,p),i(a,d),i(a,m),i(a,_),i(a,h),pt(a,n[5].roles[n[96]].openrouter_chat_model,!0),S(O,w,E),S(O,C,E),i(C,y),i(y,T),i(C,v),i(C,L),i(L,R),ke(R,n[5].roles[n[96]].openrouter_chat_system_prompt),N||(D=[ee(a,"change",B),ee(R,"input",V)],N=!0)},p(O,E){n=O,E[0]&40&&o!==(o=`openrouter-chat-model-${n[96]}`)&&c(t,"for",o),E[0]&40&&g!==(g=`openrouter-chat-model-${n[96]}`)&&c(a,"id",g),E[0]&40&&pt(a,n[5].roles[n[96]].openrouter_chat_model),E[0]&40&&k!==(k=`openrouter-chat-system-${n[96]}`)&&c(y,"for",k),E[0]&40&&A!==(A=`openrouter-chat-system-${n[96]}`)&&c(R,"id",A),E[0]&40&&ke(R,n[5].roles[n[96]].openrouter_chat_system_prompt)},d(O){O&&($(e),$(w),$(C)),N=!1,ft(D)}}}function ri(n){let e;return{c(){e=f("p"),e.textContent="Click to select directory",c(e,"class","help")},m(t,l){S(t,e,l)},d(t){t&&$(e)}}}function ii(n,e){let t,l,o,s,r,u,a,p,d,m,_,h,g,w,C,y,T,k,v,L,R,A,N,D,B,V,O,E,te,M,X,J,F,H,z,P,U,K,Y,re,ae,ne,Q,ue,se,j,W,le,ie,_e,ce,fe,de,ze,Xe,qe,Me,Pe,he,Ue,xe,Ve,We,Ke,Ye,ct,ht,tt,x,we,Re,Le,Ee,ye,be,De,Tt,St,gt,_t,ot,Ut,Vt,kt,_n,an,cn,Mt,oe,Se,Oe,Be,He,Ne,nt,zt,Je,at,dt,Ot,Kt,Bt,wt,hn,G,ge,pe,Ae,et,ut,Jt,pn,$t,me,je,en,Wt,gn,Rt,In,ao,Kn,En,Tn,_l,co,hl,uo,Mn,$n,gl,fo,vl,po,mo,_o,Pn,ho,bl,Ml,go;function Hi(){e[28].call(p,e[96])}function Fi(){e[29].call(T,e[96])}let Bn=Ge(e[3]),Gt=[];for(let vt=0;vt<Bn.length;vt+=1)Gt[vt]=Vr(zr(e,Bn,vt));function vo(){e[30].call(O,e[96])}function bo(){e[31].call(U,e[96])}function zi(){e[32].call(W,e[96])}let Wn=Ge(e[94].haystacks),qt=[];for(let vt=0;vt<Wn.length;vt+=1)qt[vt]=Zr(Hr(e,Wn,vt));function Ki(){return e[48](e[96])}function ko(){e[49].call(tt,e[96])}let Qt=e[5].roles[e[96]].llm_provider==="ollama"&&xr(e);function Bi(){e[55].call(ot,e[96])}let Yt=e[5].roles[e[96]].openrouter_enabled&&ni(e);function Wi(){e[64].call(Je,e[96])}function Gi(){e[65].call(ge,e[96])}function wo(){return e[66](e[96])}let tn=e[6]&&ri();function yo(){e[67].call(Wt,e[96])}function qi(){e[68].call(Tn,e[96])}function Vi(){e[69].call($n,e[96])}function Ji(){return e[70](e[96])}return{key:n,first:null,c(){t=f("div"),l=f("div"),o=f("label"),s=I("Role name"),u=b(),a=f("div"),p=f("input"),m=b(),_=f("div"),h=f("label"),g=I("Short name"),C=b(),y=f("div"),T=f("input"),v=b(),L=f("div"),R=f("label"),A=I("Theme"),D=b(),B=f("div"),V=f("div"),O=f("select");for(let vt=0;vt<Gt.length;vt+=1)Gt[vt].c();te=b(),M=f("div"),X=f("label"),J=I("Relevance function"),H=b(),z=f("div"),P=f("div"),U=f("select"),K=f("option"),K.textContent="title-scorer",Y=f("option"),Y.textContent="terraphim-graph",re=f("option"),re.textContent="bm25",ae=f("option"),ae.textContent="bm25f",ne=f("option"),ne.textContent="bm25plus",ue=b(),se=f("div"),j=f("label"),W=f("input"),ie=I(`
            Enable Terraphim IT features (KG preprocessing, auto-linking)`),ce=b(),fe=f("h5"),fe.textContent="Haystacks",de=b();for(let vt=0;vt<qt.length;vt+=1)qt[vt].c();ze=b(),Xe=f("button"),qe=I("Add Haystack"),Pe=b(),he=f("h5"),he.textContent="AI-Enhanced Summaries (LLM Provider)",Ue=b(),xe=f("div"),Ve=f("label"),We=I("Provider"),Ye=b(),ct=f("div"),ht=f("div"),tt=f("select"),x=f("option"),x.textContent="(none)",we=f("option"),we.textContent="OpenRouter",Re=f("option"),Re.textContent="Ollama (local)",Ee=b(),ye=f("p"),ye.textContent="Choose a provider. OpenRouter uses API key; Ollama runs locally.",be=b(),Qt&&Qt.c(),De=b(),Tt=f("h5"),Tt.textContent="AI-Enhanced Summaries (OpenRouter)",St=b(),gt=f("div"),_t=f("label"),ot=f("input"),Vt=I(`
             Enable AI-generated article summaries`),_n=b(),an=f("p"),an.textContent="Generate intelligent summaries using OpenRouter's language models",cn=b(),Yt&&Yt.c(),Mt=b(),oe=f("h5"),oe.textContent="Knowledge Graph",Se=b(),Oe=f("div"),Be=f("label"),He=I("Remote automata URL"),nt=b(),zt=f("div"),Je=f("input"),dt=b(),Ot=f("div"),Kt=f("label"),Bt=I("Local KG path"),hn=b(),G=f("div"),ge=f("input"),Ae=b(),tn&&tn.c(),et=b(),ut=f("div"),Jt=f("div"),pn=f("label"),$t=I("Local KG type"),je=b(),en=f("div"),Wt=f("select"),gn=f("option"),gn.textContent="markdown",Rt=f("option"),Rt.textContent="json",ao=b(),Kn=f("div"),En=f("label"),Tn=f("input"),co=I(`
             Public`),uo=b(),Mn=f("label"),$n=f("input"),fo=I(`
             Publish`),po=b(),mo=f("hr"),_o=b(),Pn=f("button"),ho=I("Remove Role"),c(o,"class","label"),c(o,"for",r=`role-name-${e[96]}`),c(p,"class","input"),c(p,"id",d=`role-name-${e[96]}`),c(p,"type","text"),c(a,"class","control"),c(l,"class","field"),c(h,"class","label"),c(h,"for",w=`role-shortname-${e[96]}`),c(T,"class","input"),c(T,"id",k=`role-shortname-${e[96]}`),c(T,"type","text"),c(y,"class","control"),c(_,"class","field"),c(R,"class","label"),c(R,"for",N=`role-theme-${e[96]}`),c(O,"id",E=`role-theme-${e[96]}`),e[5].roles[e[96]].theme===void 0&&Pt(vo),c(V,"class","select is-fullwidth"),c(B,"class","control"),c(L,"class","field"),c(X,"class","label"),c(X,"for",F=`role-relevance-${e[96]}`),K.__value="title-scorer",ke(K,K.__value),Y.__value="terraphim-graph",ke(Y,Y.__value),re.__value="bm25",ke(re,re.__value),ae.__value="bm25f",ke(ae,ae.__value),ne.__value="bm25plus",ke(ne,ne.__value),c(U,"id",Q=`role-relevance-${e[96]}`),e[5].roles[e[96]].relevance_function===void 0&&Pt(bo),c(P,"class","select is-fullwidth"),c(z,"class","control"),c(M,"class","field"),c(W,"class","checkbox"),c(W,"id",le=`role-terraphim-it-${e[96]}`),c(W,"type","checkbox"),c(j,"class","label"),c(j,"for",_e=`role-terraphim-it-${e[96]}`),c(se,"class","field"),c(fe,"class","title is-6"),c(Xe,"class","button is-small"),c(Xe,"data-testid",Me="add-haystack-"+e[96]),c(he,"class","title is-6"),c(Ve,"class","label"),c(Ve,"for",Ke=`llm-provider-${e[96]}`),x.__value="",ke(x,x.__value),we.__value="openrouter",ke(we,we.__value),Re.__value="ollama",ke(Re,Re.__value),c(tt,"id",Le=`llm-provider-${e[96]}`),e[5].roles[e[96]].llm_provider===void 0&&Pt(ko),c(ht,"class","select"),c(ct,"class","control"),c(ye,"class","help"),c(xe,"class","field"),c(Tt,"class","title is-6"),c(ot,"id",Ut=`openrouter-enabled-${e[96]}`),c(ot,"type","checkbox"),c(_t,"class","checkbox"),c(_t,"for",kt=`openrouter-enabled-${e[96]}`),c(an,"class","help"),c(gt,"class","field"),c(oe,"class","title is-6"),c(Be,"class","label"),c(Be,"for",Ne=`kg-url-${e[96]}`),c(Je,"class","input"),c(Je,"id",at=`kg-url-${e[96]}`),c(Je,"type","text"),c(Je,"placeholder","https://example.com/thesaurus.json"),c(zt,"class","control"),c(Oe,"class","field"),c(Kt,"class","label"),c(Kt,"for",wt=`kg-local-path-${e[96]}`),c(ge,"class","input"),c(ge,"id",pe=`kg-local-path-${e[96]}`),c(ge,"type","text"),c(ge,"placeholder","/path/to/markdown"),ge.readOnly=e[6],c(G,"class","control"),c(Ot,"class","field"),c(pn,"class","label"),c(pn,"for",me=`kg-local-type-${e[96]}`),gn.__value="markdown",ke(gn,gn.__value),Rt.__value="json",ke(Rt,Rt.__value),c(Wt,"id",In=`kg-local-type-${e[96]}`),e[5].roles[e[96]].kg.local_type===void 0&&Pt(yo),c(en,"class","select"),c(Jt,"class","control"),c(ut,"class","field is-grouped"),c(Tn,"id",_l=`kg-public-${e[96]}`),c(Tn,"type","checkbox"),c(En,"class","checkbox"),c(En,"for",hl=`kg-public-${e[96]}`),Ie(En,"margin-right","1rem"),c($n,"id",gl=`kg-publish-${e[96]}`),c($n,"type","checkbox"),c(Mn,"class","checkbox"),c(Mn,"for",vl=`kg-publish-${e[96]}`),c(Kn,"class","field is-grouped"),c(Pn,"class","button is-small is-danger"),c(Pn,"data-testid",bl="remove-role-"+e[96]),c(t,"class","box"),this.first=t},m(vt,Qe){S(vt,t,Qe),i(t,l),i(l,o),i(o,s),i(l,u),i(l,a),i(a,p),ke(p,e[5].roles[e[96]].name),i(t,m),i(t,_),i(_,h),i(h,g),i(_,C),i(_,y),i(y,T),ke(T,e[5].roles[e[96]].shortname),i(t,v),i(t,L),i(L,R),i(R,A),i(L,D),i(L,B),i(B,V),i(V,O);for(let st=0;st<Gt.length;st+=1)Gt[st]&&Gt[st].m(O,null);pt(O,e[5].roles[e[96]].theme,!0),i(t,te),i(t,M),i(M,X),i(X,J),i(M,H),i(M,z),i(z,P),i(P,U),i(U,K),i(U,Y),i(U,re),i(U,ae),i(U,ne),pt(U,e[5].roles[e[96]].relevance_function,!0),i(t,ue),i(t,se),i(se,j),i(j,W),W.checked=e[5].roles[e[96]].terraphim_it,i(j,ie),i(t,ce),i(t,fe),i(t,de);for(let st=0;st<qt.length;st+=1)qt[st]&&qt[st].m(t,null);i(t,ze),i(t,Xe),i(Xe,qe),i(t,Pe),i(t,he),i(t,Ue),i(t,xe),i(xe,Ve),i(Ve,We),i(xe,Ye),i(xe,ct),i(ct,ht),i(ht,tt),i(tt,x),i(tt,we),i(tt,Re),pt(tt,e[5].roles[e[96]].llm_provider,!0),i(xe,Ee),i(xe,ye),i(t,be),Qt&&Qt.m(t,null),i(t,De),i(t,Tt),i(t,St),i(t,gt),i(gt,_t),i(_t,ot),ot.checked=e[5].roles[e[96]].openrouter_enabled,i(_t,Vt),i(gt,_n),i(gt,an),i(t,cn),Yt&&Yt.m(t,null),i(t,Mt),i(t,oe),i(t,Se),i(t,Oe),i(Oe,Be),i(Be,He),i(Oe,nt),i(Oe,zt),i(zt,Je),ke(Je,e[5].roles[e[96]].kg.url),i(t,dt),i(t,Ot),i(Ot,Kt),i(Kt,Bt),i(Ot,hn),i(Ot,G),i(G,ge),ke(ge,e[5].roles[e[96]].kg.local_path),i(G,Ae),tn&&tn.m(G,null),i(t,et),i(t,ut),i(ut,Jt),i(Jt,pn),i(pn,$t),i(Jt,je),i(Jt,en),i(en,Wt),i(Wt,gn),i(Wt,Rt),pt(Wt,e[5].roles[e[96]].kg.local_type,!0),i(t,ao),i(t,Kn),i(Kn,En),i(En,Tn),Tn.checked=e[5].roles[e[96]].kg.public,i(En,co),i(Kn,uo),i(Kn,Mn),i(Mn,$n),$n.checked=e[5].roles[e[96]].kg.publish,i(Mn,fo),i(t,po),i(t,mo),i(t,_o),i(t,Pn),i(Pn,ho),Ml||(go=[ee(p,"input",Hi),ee(T,"input",Fi),ee(O,"change",vo),ee(U,"change",bo),ee(W,"change",zi),ee(Xe,"click",Ki),ee(tt,"change",ko),ee(ot,"change",Bi),ee(Je,"input",Wi),ee(ge,"input",Gi),ee(ge,"click",function(){ul(e[6]?wo:void 0)&&(e[6]?wo:void 0).apply(this,arguments)}),ee(Wt,"change",yo),ee(Tn,"change",qi),ee($n,"change",Vi),ee(Pn,"click",Ji)],Ml=!0)},p(vt,Qe){if(e=vt,Qe[0]&40&&r!==(r=`role-name-${e[96]}`)&&c(o,"for",r),Qe[0]&40&&d!==(d=`role-name-${e[96]}`)&&c(p,"id",d),Qe[0]&40&&p.value!==e[5].roles[e[96]].name&&ke(p,e[5].roles[e[96]].name),Qe[0]&40&&w!==(w=`role-shortname-${e[96]}`)&&c(h,"for",w),Qe[0]&40&&k!==(k=`role-shortname-${e[96]}`)&&c(T,"id",k),Qe[0]&40&&T.value!==e[5].roles[e[96]].shortname&&ke(T,e[5].roles[e[96]].shortname),Qe[0]&40&&N!==(N=`role-theme-${e[96]}`)&&c(R,"for",N),Qe[0]&8){Bn=Ge(e[3]);let st;for(st=0;st<Bn.length;st+=1){const xn=zr(e,Bn,st);Gt[st]?Gt[st].p(xn,Qe):(Gt[st]=Vr(xn),Gt[st].c(),Gt[st].m(O,null))}for(;st<Gt.length;st+=1)Gt[st].d(1);Gt.length=Bn.length}if(Qe[0]&40&&E!==(E=`role-theme-${e[96]}`)&&c(O,"id",E),Qe[0]&40&&pt(O,e[5].roles[e[96]].theme),Qe[0]&40&&F!==(F=`role-relevance-${e[96]}`)&&c(X,"for",F),Qe[0]&40&&Q!==(Q=`role-relevance-${e[96]}`)&&c(U,"id",Q),Qe[0]&40&&pt(U,e[5].roles[e[96]].relevance_function),Qe[0]&40&&le!==(le=`role-terraphim-it-${e[96]}`)&&c(W,"id",le),Qe[0]&40&&(W.checked=e[5].roles[e[96]].terraphim_it),Qe[0]&40&&_e!==(_e=`role-terraphim-it-${e[96]}`)&&c(j,"for",_e),Qe[0]&62048){Wn=Ge(e[94].haystacks);let st;for(st=0;st<Wn.length;st+=1){const xn=Hr(e,Wn,st);qt[st]?qt[st].p(xn,Qe):(qt[st]=Zr(xn),qt[st].c(),qt[st].m(t,ze))}for(;st<qt.length;st+=1)qt[st].d(1);qt.length=Wn.length}Qe[0]&40&&Me!==(Me="add-haystack-"+e[96])&&c(Xe,"data-testid",Me),Qe[0]&40&&Ke!==(Ke=`llm-provider-${e[96]}`)&&c(Ve,"for",Ke),Qe[0]&40&&Le!==(Le=`llm-provider-${e[96]}`)&&c(tt,"id",Le),Qe[0]&40&&pt(tt,e[5].roles[e[96]].llm_provider),e[5].roles[e[96]].llm_provider==="ollama"?Qt?Qt.p(e,Qe):(Qt=xr(e),Qt.c(),Qt.m(t,De)):Qt&&(Qt.d(1),Qt=null),Qe[0]&40&&Ut!==(Ut=`openrouter-enabled-${e[96]}`)&&c(ot,"id",Ut),Qe[0]&40&&(ot.checked=e[5].roles[e[96]].openrouter_enabled),Qe[0]&40&&kt!==(kt=`openrouter-enabled-${e[96]}`)&&c(_t,"for",kt),e[5].roles[e[96]].openrouter_enabled?Yt?Yt.p(e,Qe):(Yt=ni(e),Yt.c(),Yt.m(t,Mt)):Yt&&(Yt.d(1),Yt=null),Qe[0]&40&&Ne!==(Ne=`kg-url-${e[96]}`)&&c(Be,"for",Ne),Qe[0]&40&&at!==(at=`kg-url-${e[96]}`)&&c(Je,"id",at),Qe[0]&40&&Je.value!==e[5].roles[e[96]].kg.url&&ke(Je,e[5].roles[e[96]].kg.url),Qe[0]&40&&wt!==(wt=`kg-local-path-${e[96]}`)&&c(Kt,"for",wt),Qe[0]&40&&pe!==(pe=`kg-local-path-${e[96]}`)&&c(ge,"id",pe),Qe[0]&64&&(ge.readOnly=e[6]),Qe[0]&40&&ge.value!==e[5].roles[e[96]].kg.local_path&&ke(ge,e[5].roles[e[96]].kg.local_path),e[6]?tn||(tn=ri(),tn.c(),tn.m(G,null)):tn&&(tn.d(1),tn=null),Qe[0]&40&&me!==(me=`kg-local-type-${e[96]}`)&&c(pn,"for",me),Qe[0]&40&&In!==(In=`kg-local-type-${e[96]}`)&&c(Wt,"id",In),Qe[0]&40&&pt(Wt,e[5].roles[e[96]].kg.local_type),Qe[0]&40&&_l!==(_l=`kg-public-${e[96]}`)&&c(Tn,"id",_l),Qe[0]&40&&(Tn.checked=e[5].roles[e[96]].kg.public),Qe[0]&40&&hl!==(hl=`kg-public-${e[96]}`)&&c(En,"for",hl),Qe[0]&40&&gl!==(gl=`kg-publish-${e[96]}`)&&c($n,"id",gl),Qe[0]&40&&($n.checked=e[5].roles[e[96]].kg.publish),Qe[0]&40&&vl!==(vl=`kg-publish-${e[96]}`)&&c(Mn,"for",vl),Qe[0]&40&&bl!==(bl="remove-role-"+e[96])&&c(Pn,"data-testid",bl)},d(vt){vt&&$(t),Ct(Gt,vt),Ct(qt,vt),Qt&&Qt.d(),Yt&&Yt.d(),tn&&tn.d(),Ml=!1,ft(go)}}}function ai(n){let e,t=n[91]+"",l,o;return{c(){e=f("option"),l=I(t),e.__value=o=n[91],ke(e,e.__value)},m(s,r){S(s,e,r),i(e,l)},p(s,r){r[0]&8&&t!==(t=s[91]+"")&&ve(l,t),r[0]&8&&o!==(o=s[91])&&(e.__value=o,ke(e,e.__value))},d(s){s&&$(e)}}}function ci(n){let e,t=n[88].name+"",l,o;return{c(){e=f("option"),l=I(t),e.__value=o=n[88].name,ke(e,e.__value)},m(s,r){S(s,e,r),i(e,l)},p(s,r){r[0]&32&&t!==(t=s[88].name+"")&&ve(l,t),r[0]&40&&o!==(o=s[88].name)&&(e.__value=o,ke(e,e.__value))},d(s){s&&$(e)}}}function ui(n){let e,t,l;return{c(){e=f("button"),e.textContent="Back",c(e,"class","button"),c(e,"data-testid","wizard-back")},m(o,s){S(o,e,s),t||(l=ee(e,"click",n[18]),t=!0)},p:Fe,d(o){o&&$(e),t=!1,l()}}}function cp(n){let e,t,l;return{c(){e=f("button"),e.textContent="Save",c(e,"class","button is-success"),c(e,"data-testid","wizard-save")},m(o,s){S(o,e,s),t||(l=ee(e,"click",n[16]),t=!0)},p:Fe,d(o){o&&$(e),t=!1,l()}}}function up(n){let e,t,l;return{c(){e=f("button"),e.textContent="Next",c(e,"class","button is-primary"),c(e,"data-testid","wizard-next")},m(o,s){S(o,e,s),t||(l=ee(e,"click",n[17]),t=!0)},p:Fe,d(o){o&&$(e),t=!1,l()}}}function fp(n){let e,t,l,o,s,r,u,a,p,d,m,_,h,g,w,C=n[4]==="success"&&Wr(n),y=n[4]==="error"&&Gr(n);function T(D,B){return D[2]===1?rp:D[2]===2?sp:op}let k=T(n),v=k(n),L=n[2]>1&&ui(n);function R(D,B){return D[2]<Ui?up:cp}let A=R(n),N=A(n);return{c(){e=f("div"),t=f("div"),l=f("h3"),l.textContent="Configuration Wizard",o=b(),s=f("button"),s.textContent="Close",r=b(),C&&C.c(),u=b(),y&&y.c(),a=b(),v.c(),p=b(),d=f("nav"),m=f("div"),L&&L.c(),_=b(),h=f("div"),N.c(),c(l,"class","title is-4"),Ie(l,"margin-bottom","0"),c(s,"class","button is-small is-light"),c(s,"aria-label","Close configuration wizard"),c(t,"class","is-flex is-justify-content-space-between is-align-items-center"),Ie(t,"gap",".5rem"),c(m,"class","level-left"),c(h,"class","level-right"),c(d,"class","level"),c(e,"class","box"),c(e,"data-testid","config-wizard")},m(D,B){S(D,e,B),i(e,t),i(t,l),i(t,o),i(t,s),i(e,r),C&&C.m(e,null),i(e,u),y&&y.m(e,null),i(e,a),v.m(e,null),i(e,p),i(e,d),i(d,m),L&&L.m(m,null),i(d,_),i(d,h),N.m(h,null),g||(w=ee(s,"click",n[21]),g=!0)},p(D,B){D[4]==="success"?C?C.p(D,B):(C=Wr(D),C.c(),C.m(e,u)):C&&(C.d(1),C=null),D[4]==="error"?y?y.p(D,B):(y=Gr(D),y.c(),y.m(e,a)):y&&(y.d(1),y=null),k===(k=T(D))&&v?v.p(D,B):(v.d(1),v=k(D),v&&(v.c(),v.m(e,p))),D[2]>1?L?L.p(D,B):(L=ui(D),L.c(),L.m(m,null)):L&&(L.d(1),L=null),A===(A=R(D))&&N?N.p(D,B):(N.d(1),N=A(D),N&&(N.c(),N.m(h,null)))},i:Fe,o:Fe,d(D){D&&$(e),C&&C.d(),y&&y.d(),v.d(),L&&L.d(),N.d(),g=!1,w()}}}const Ui=3;function dp(){typeof window<"u"&&window.history.back()}function pp(n,e,t){let l,o,s,r;lt(n,It,oe=>t(6,r=oe));const u=sn(null);async function a(oe,Se){if(bt(It))try{const Oe=await Yl({directory:!0,multiple:!1});Oe&&typeof Oe=="string"&&d.update(Be=>(Be.roles[oe].haystacks[Se].path=Oe,Be))}catch(Oe){console.error("Failed to open folder selector:",Oe)}}async function p(oe){if(bt(It))try{const Se=await Yl({directory:!0,multiple:!1});Se&&typeof Se=="string"&&d.update(Oe=>(Oe.roles[oe].kg.local_path=Se,Oe))}catch(Se){console.error("Failed to open folder selector:",Se)}}const d=sn({id:"Desktop",global_shortcut:"Ctrl+X",default_theme:"spacelab",default_role:"Default",roles:[]});lt(n,d,oe=>t(5,s=oe));const m=["default","darkly","cerulean","cosmo","cyborg","flatly","journal","litera","lumen","lux","materia","minty","nuclear","pulse","sandstone","simplex","slate","solar","spacelab","superhero","united","yeti"];Dn(async()=>{try{let oe;bt(It)?oe=await Ze("get_config_schema"):oe=await(await fetch("/config/schema")).json(),u.set(oe);const Se=bt(on);Se!=null&&Se.id&&d.update(Oe=>{var Be;return{...Oe,id:Se.id,global_shortcut:Se.global_shortcut,default_theme:((Be=Se.roles[Se.default_role])==null?void 0:Be.theme)??"spacelab",default_role:Se.default_role,roles:Object.values(Se.roles).map(He=>{var Je,at,dt,Ot,Kt,Bt,wt,hn,G,ge,pe;const Ne=(Je=He.kg)==null?void 0:Je.automata_path,nt=(Ne==null?void 0:Ne.Remote)??"",zt=((dt=(at=He.kg)==null?void 0:at.knowledge_graph_local)==null?void 0:dt.path)??"";return{name:He.name,shortname:He.shortname,relevance_function:He.relevance_function,terraphim_it:He.terraphim_it??!1,theme:He.theme,haystacks:(He.haystacks??[]).map(Ae=>({path:Ae.location||Ae.path||"",read_only:Ae.read_only??!1,service:Ae.service||"Ripgrep",atomic_server_secret:Ae.atomic_server_secret||"",extra_parameters:Ae.extra_parameters||{},weight:Ae.weight??1})),kg:{url:nt,local_path:zt,local_type:((Kt=(Ot=He.kg)==null?void 0:Ot.knowledge_graph_local)==null?void 0:Kt.input_type)??"markdown",public:((Bt=He.kg)==null?void 0:Bt.public)??!1,publish:((wt=He.kg)==null?void 0:wt.publish)??!1},openrouter_enabled:He.openrouter_enabled??!1,openrouter_api_key:He.openrouter_api_key??"",openrouter_model:He.openrouter_model??"openai/gpt-3.5-turbo",openrouter_auto_summarize:He.openrouter_auto_summarize??!1,openrouter_chat_enabled:He.openrouter_chat_enabled??!1,openrouter_chat_model:He.openrouter_chat_model??He.openrouter_model??"openai/gpt-3.5-turbo",openrouter_chat_system_prompt:He.openrouter_chat_system_prompt??"",llm_provider:((hn=He.extra)==null?void 0:hn.llm_provider)??"",llm_model:((G=He.extra)==null?void 0:G.llm_model)??"",llm_base_url:((ge=He.extra)==null?void 0:ge.llm_base_url)??"",llm_auto_summarize:((pe=He.extra)==null?void 0:pe.llm_auto_summarize)??!1}})}})}catch(oe){console.error("Failed to load schema",oe)}}),Dn(()=>{const oe=Se=>{Se.key==="Escape"&&typeof window<"u"&&window.history.back()};return window.addEventListener("keydown",oe),()=>window.removeEventListener("keydown",oe)});let _={};async function h(oe){var Ne;const Oe=bt(d).roles[oe],Be=Oe.llm_provider||(Oe.openrouter_enabled?"openrouter":""),He=[];try{if(Be==="ollama"){const nt=(Oe.llm_base_url||"http://127.0.0.1:11434").replace(/\/$/,""),Je=await(await fetch(`${nt}/api/tags`)).json();if(Array.isArray(Je==null?void 0:Je.models))for(const at of Je.models)at!=null&&at.name&&He.push(at.name)}else if(Be==="openrouter"){const nt=(Ne=Oe.openrouter_api_key)==null?void 0:Ne.trim();if(!nt)throw new Error("OpenRouter API key required");const Je=await(await fetch("https://openrouter.ai/api/v1/models",{headers:{Authorization:`Bearer ${nt}`,"HTTP-Referer":"https://terraphim.ai","X-Title":"Terraphim Desktop"}})).json(),at=Array.isArray(Je==null?void 0:Je.data)?Je.data:[];for(const dt of at)dt!=null&&dt.id&&He.push(dt.id)}}catch(nt){console.error("Failed to fetch models",nt)}t(1,_={..._,[oe]:He})}let g=1,w="";function C(){g<Ui&&t(2,g+=1)}function y(){g>1&&t(2,g-=1)}function T(){d.update(oe=>({...oe,roles:[...oe.roles,{name:"New Role",shortname:"new",relevance_function:"title-scorer",terraphim_it:!1,theme:"spacelab",haystacks:[],kg:{url:"",local_path:"",local_type:"markdown",public:!1,publish:!1},openrouter_enabled:!1,openrouter_api_key:"",openrouter_model:"openai/gpt-3.5-turbo",openrouter_auto_summarize:!1,openrouter_chat_enabled:!1,openrouter_chat_model:"openai/gpt-3.5-turbo",openrouter_chat_system_prompt:"",llm_provider:"",llm_model:"",llm_base_url:"",llm_auto_summarize:!1}]}))}function k(oe){d.update(Se=>({...Se,roles:Se.roles.filter((Oe,Be)=>Be!==oe)}))}function v(oe){d.update(Se=>(Se.roles[oe].haystacks.push({path:"",read_only:!1,service:"Ripgrep",atomic_server_secret:"",extra_parameters:{},weight:1}),Se))}function L(oe,Se){d.update(Oe=>(Oe.roles[oe].haystacks=Oe.roles[oe].haystacks.filter((Be,He)=>He!==Se),Oe))}function R(oe,Se,Oe="",Be=""){d.update(He=>{He.roles[oe].haystacks[Se].extra_parameters||(He.roles[oe].haystacks[Se].extra_parameters={});const Ne=Oe||`param_${Date.now()}`;return He.roles[oe].haystacks[Se].extra_parameters[Ne]=Be,He})}function A(oe,Se,Oe){d.update(Be=>(delete Be.roles[oe].haystacks[Se].extra_parameters[Oe],Be))}function N(oe,Se,Oe,Be){d.update(He=>{const Ne=He.roles[oe].haystacks[Se].extra_parameters;return Ne[Oe]!==void 0&&Oe!==Be&&(Ne[Be]=Ne[Oe],delete Ne[Oe]),He})}function D(oe,Se,Oe,Be){const He=Be.target.value;N(oe,Se,Oe,He)}async function B(){var He;const oe=bt(d),Se=bt(on),Oe={...Se};Oe.id=oe.id,Oe.global_shortcut=oe.global_shortcut,Oe.default_role=oe.default_role;const Be={};oe.roles.forEach(Ne=>{var at,dt;const nt=Ne.name,zt=nt.replace(/^"|"$/g,"");Be[zt]={extra:((dt=(at=Se.roles)==null?void 0:at[nt])==null?void 0:dt.extra)??{},name:Ne.name,shortname:Ne.shortname,theme:Ne.theme,relevance_function:Ne.relevance_function,terraphim_it:Ne.terraphim_it??!1,haystacks:Ne.haystacks.map(Ot=>({location:Ot.path,service:Ot.service,read_only:Ot.read_only,atomic_server_secret:Ot.service==="Atomic"?Ot.atomic_server_secret:void 0,extra_parameters:Ot.extra_parameters||{},weight:Ot.weight??1})),kg:Ne.kg.url||Ne.kg.local_path?{automata_path:Ne.kg.url?{Remote:Ne.kg.url}:null,knowledge_graph_local:Ne.kg.local_path?{input_type:Ne.kg.local_type,path:Ne.kg.local_path}:null,public:Ne.kg.public,publish:Ne.kg.publish}:null,...Ne.openrouter_enabled&&{openrouter_enabled:Ne.openrouter_enabled,openrouter_api_key:Ne.openrouter_api_key,openrouter_model:Ne.openrouter_model,openrouter_auto_summarize:Ne.openrouter_auto_summarize??!1,openrouter_chat_enabled:Ne.openrouter_chat_enabled??!1,openrouter_chat_model:Ne.openrouter_chat_model??Ne.openrouter_model,openrouter_chat_system_prompt:Ne.openrouter_chat_system_prompt??""}};const Je={};Ne.llm_provider&&(Je.llm_provider=Ne.llm_provider),Ne.llm_model&&(Je.llm_model=Ne.llm_model),Ne.llm_base_url&&(Je.llm_base_url=Ne.llm_base_url),typeof Ne.llm_auto_summarize=="boolean"&&(Je.llm_auto_summarize=Ne.llm_auto_summarize),Be[zt].extra={...Be[zt].extra||{},...Je}}),Oe.roles=Be,(!Oe.default_role||!Be[Oe.default_role])&&(Oe.default_role=((He=oe.roles[0])==null?void 0:He.name)??"Default"),Oe.selected_role=Oe.default_role;try{if(bt(It))await Ze("update_config",{configNew:Oe});else{const Ne=await fetch("/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Oe)});if(!Ne.ok)throw new Error(`HTTP ${Ne.status}: ${Ne.statusText}`)}on.set(Oe),t(0,w="success"),setTimeout(()=>{t(0,w="")},3e3)}catch(Ne){console.error(Ne),t(0,w="error"),setTimeout(()=>{t(0,w="")},3e3)}}const V=a,O=p,E=v,te=L,M=R,X=A,J=D,F=B,H=C,z=y,P=T,U=k,K=dp,Y=()=>t(0,w=""),re=()=>t(0,w="");function ae(){s.id=Xt(this),d.set(s),t(3,o)}function ne(){s.global_shortcut=this.value,d.set(s),t(3,o)}function Q(){s.default_theme=Xt(this),d.set(s),t(3,o)}function ue(){s.default_role=Xt(this),d.set(s),t(3,o)}function se(oe){s.roles[oe].name=this.value,d.set(s),t(3,o)}function j(oe){s.roles[oe].shortname=this.value,d.set(s),t(3,o)}function W(oe){s.roles[oe].theme=Xt(this),d.set(s),t(3,o)}function le(oe){s.roles[oe].relevance_function=Xt(this),d.set(s),t(3,o)}function ie(oe){s.roles[oe].terraphim_it=this.checked,d.set(s),t(3,o)}function _e(oe,Se){s.roles[oe].haystacks[Se].service=Xt(this),d.set(s),t(3,o)}function ce(oe,Se){s.roles[oe].haystacks[Se].path=this.value,d.set(s),t(3,o)}const fe=(oe,Se)=>V(oe,Se);function de(oe,Se){s.roles[oe].haystacks[Se].atomic_server_secret=this.value,d.set(s),t(3,o)}function ze(oe,Se){s.roles[oe].haystacks[Se].extra_parameters.tag=this.value,d.set(s),t(3,o)}const Xe=(oe,Se,Oe)=>{const Be=Oe.currentTarget.value;Be&&vn(d,s.roles[oe].haystacks[Se].extra_parameters.tag=Be,s)},qe=(oe,Se,Oe,Be)=>J(oe,Se,Oe,Be);function Me(oe,Se,Oe){s.roles[oe].haystacks[Se].extra_parameters[Oe]=this.value,d.set(s),t(3,o)}const Pe=(oe,Se,Oe)=>X(oe,Se,Oe),he=(oe,Se)=>M(oe,Se,"tag","#rust"),Ue=(oe,Se)=>M(oe,Se,"max_count","10"),xe=(oe,Se)=>M(oe,Se,"","");function Ve(oe,Se){s.roles[oe].haystacks[Se].read_only=this.checked,d.set(s),t(3,o)}function We(oe,Se){s.roles[oe].haystacks[Se].weight=pi(this.value),d.set(s),t(3,o)}const Ke=(oe,Se)=>te(oe,Se),Ye=oe=>E(oe);function ct(oe){s.roles[oe].llm_provider=Xt(this),d.set(s),t(3,o)}function ht(oe){s.roles[oe].llm_model=this.value,d.set(s),t(3,o)}const tt=oe=>h(oe),x=(oe,Se)=>{vn(d,s.roles[oe].llm_model=Se.currentTarget.value,s)};function we(oe){s.roles[oe].llm_base_url=this.value,d.set(s),t(3,o)}function Re(oe){s.roles[oe].llm_auto_summarize=this.checked,d.set(s),t(3,o)}function Le(oe){s.roles[oe].openrouter_enabled=this.checked,d.set(s),t(3,o)}function Ee(oe){s.roles[oe].openrouter_api_key=this.value,d.set(s),t(3,o)}function ye(oe){s.roles[oe].openrouter_model=this.value,d.set(s),t(3,o)}const be=oe=>h(oe),De=(oe,Se)=>{vn(d,s.roles[oe].openrouter_model=Se.currentTarget.value,s)};function Tt(oe){s.roles[oe].openrouter_auto_summarize=this.checked,d.set(s),t(3,o)}function St(oe){s.roles[oe].openrouter_chat_enabled=this.checked,d.set(s),t(3,o)}function gt(oe){s.roles[oe].openrouter_chat_model=Xt(this),d.set(s),t(3,o)}function _t(oe){s.roles[oe].openrouter_chat_system_prompt=this.value,d.set(s),t(3,o)}function ot(oe){s.roles[oe].kg.url=this.value,d.set(s),t(3,o)}function Ut(oe){s.roles[oe].kg.local_path=this.value,d.set(s),t(3,o)}const Vt=oe=>O(oe);function kt(oe){s.roles[oe].kg.local_type=Xt(this),d.set(s),t(3,o)}function _n(oe){s.roles[oe].kg.public=this.checked,d.set(s),t(3,o)}function an(oe){s.roles[oe].kg.publish=this.checked,d.set(s),t(3,o)}const cn=oe=>U(oe),Mt=()=>{t(2,g=2)};return n.$$.update=()=>{n.$$.dirty[0]&1&&t(4,l=w)},t(3,o=m),[w,_,g,o,l,s,r,d,h,V,O,E,te,M,X,J,F,H,z,P,U,K,Y,re,ae,ne,Q,ue,se,j,W,le,ie,_e,ce,fe,de,ze,Xe,qe,Me,Pe,he,Ue,xe,Ve,We,Ke,Ye,ct,ht,tt,x,we,Re,Le,Ee,ye,be,De,Tt,St,gt,_t,ot,Ut,Vt,kt,_n,an,cn,Mt]}class mp extends Ht{constructor(e){super(),Ft(this,e,pp,fp,jt,{},null,[-1,-1,-1,-1])}}function _p(n){let e,t,l,o,s,r;return s=new hi({props:{content:n[0],onChange:n[1]}}),{c(){e=f("div"),t=f("p"),t.innerHTML="<i>The best editing experience is to configure Atomic Server, in the meantime use editor below. You will need to refresh page via Command R or Ctrl-R to see changes</i>",l=b(),o=f("div"),$e(s.$$.fragment),c(o,"class","editor"),c(e,"class","box")},m(u,a){S(u,e,a),i(e,t),i(e,l),i(e,o),Te(s,o,null),r=!0},p(u,[a]){const p={};a&1&&(p.content=u[0]),s.$set(p)},i(u){r||(q(s.$$.fragment,u),r=!0)},o(u){Z(s.$$.fragment,u),r=!1},d(u){u&&$(e),Ce(s)}}}function hp(n,e,t){let l,o;lt(n,on,u=>t(2,l=u)),lt(n,It,u=>t(3,o=u));let s={json:l};function r(u){if(console.log("contents changed:",u),console.log("is tauri",o),on.update(a=>(a=u.json,a)),bt(It))console.log("Updating config on server"),Ze("update_config",{configNew:u.json}).then(a=>{console.log(`Message: ${a}`)}).catch(a=>console.error(a));else{const a=`${mt.ServerURL}/config/`;fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u.json)})}t(0,s=u)}return Dn(()=>{t(0,s={json:l})}),[s,r]}class gp extends Ht{constructor(e){super(),Ft(this,e,hp,_p,jt,{})}}const vp="/assets/terraphim.png";function bp(n){let e,t;return e=new hf({}),{c(){$e(e.$$.fragment)},m(l,o){Te(e,l,o),t=!0},i(l){t||(q(e.$$.fragment,l),t=!0)},o(l){Z(e.$$.fragment,l),t=!1},d(l){Ce(e,l)}}}function kp(n){let e,t;return e=new Od({}),{c(){$e(e.$$.fragment)},m(l,o){Te(e,l,o),t=!0},i(l){t||(q(e.$$.fragment,l),t=!0)},o(l){Z(e.$$.fragment,l),t=!1},d(l){Ce(e,l)}}}function wp(n){let e,t;return e=new Nd({}),{c(){$e(e.$$.fragment)},m(l,o){Te(e,l,o),t=!0},i(l){t||(q(e.$$.fragment,l),t=!0)},o(l){Z(e.$$.fragment,l),t=!1},d(l){Ce(e,l)}}}function yp(n){let e,t;return e=new xd({}),{c(){$e(e.$$.fragment)},m(l,o){Te(e,l,o),t=!0},i(l){t||(q(e.$$.fragment,l),t=!0)},o(l){Z(e.$$.fragment,l),t=!1},d(l){Ce(e,l)}}}function Cp(n){let e,t;return e=new mp({}),{c(){$e(e.$$.fragment)},m(l,o){Te(e,l,o),t=!0},i(l){t||(q(e.$$.fragment,l),t=!0)},o(l){Z(e.$$.fragment,l),t=!1},d(l){Ce(e,l)}}}function Tp(n){let e,t;return e=new gp({}),{c(){$e(e.$$.fragment)},m(l,o){Te(e,l,o),t=!0},i(l){t||(q(e.$$.fragment,l),t=!0)},o(l){Z(e.$$.fragment,l),t=!1},d(l){Ce(e,l)}}}function $p(n){let e;return{c(){e=f("nav"),e.innerHTML='<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> <a class="navbar-item" href="/config/wizard">Wizard</a> <a class="navbar-item" href="/config/json">JSON Editor</a> <a class="navbar-item" href="/graph">Graph</a> <a class="navbar-item" href="/chat">Chat</a></div>',c(e,"class","navbar")},m(t,l){S(t,e,l)},p:Fe,d(t){t&&$(e)}}}function Sp(n){let e,t,l,o,s,r,u,a,p,d,m,_,h,g,w,C,y,T,k,v,L,R,A,N,D,B,V,O,E,te,M,X,J,F,H,z,P,U,K,Y,re,ae,ne,Q,ue;return R=new $l({}),D=new bn({props:{path:"/",$$slots:{default:[bp]},$$scope:{ctx:n}}}),V=new bn({props:{path:"/chat",$$slots:{default:[kp]},$$scope:{ctx:n}}}),E=new bn({props:{path:"/graph",$$slots:{default:[wp]},$$scope:{ctx:n}}}),J=new bn({props:{path:"/fetch/*",$$slots:{default:[yp]},$$scope:{ctx:n}}}),H=new bn({props:{path:"/config/wizard",$$slots:{default:[Cp]},$$scope:{ctx:n}}}),P=new bn({props:{path:"/config/json",$$slots:{default:[Tp]},$$scope:{ctx:n}}}),re=new bn({props:{path:"/",$$slots:{default:[$p]},$$scope:{ctx:n}}}),{c(){e=f("meta"),t=b(),l=f("div"),o=f("main"),s=f("div"),r=f("div"),u=f("div"),a=f("button"),a.innerHTML=`<img src="${vp}" alt="Terraphim" class="logo-image svelte-16j63mf"/>`,p=b(),d=f("div"),m=f("ul"),_=f("li"),h=f("a"),h.innerHTML='<span class="icon is-small"><i class="fas fa-search"></i></span> <span>Search</span>',g=b(),w=f("li"),C=f("a"),C.innerHTML='<span class="icon is-small"><i class="fas fa-comments"></i></span> <span>Chat</span>',y=b(),T=f("li"),k=f("a"),k.innerHTML='<span class="icon is-small"><i class="fas fa-project-diagram"></i></span> <span>Graph</span>',v=b(),L=f("div"),$e(R.$$.fragment),A=b(),N=f("div"),$e(D.$$.fragment),B=b(),$e(V.$$.fragment),O=b(),$e(E.$$.fragment),te=b(),M=f("br"),X=b(),$e(J.$$.fragment),F=b(),$e(H.$$.fragment),z=b(),$e(P.$$.fragment),U=b(),K=f("footer"),Y=f("div"),$e(re.$$.fragment),c(e,"name","color-scheme"),c(e,"content",n[1]),document.title="Terraphim",c(a,"class","logo-back-button svelte-16j63mf"),c(a,"title","Go back"),c(a,"aria-label","Go back"),c(h,"href","/"),c(h,"data-exact",""),c(h,"data-testid","search-tab"),c(_,"class","svelte-16j63mf"),c(C,"href","/chat"),c(C,"data-testid","chat-tab"),c(w,"class","svelte-16j63mf"),c(k,"href","/graph"),c(k,"data-testid","graph-tab"),c(T,"class","svelte-16j63mf"),c(d,"class","tabs is-boxed svelte-16j63mf"),c(u,"class","navigation-row svelte-16j63mf"),c(r,"class","main-navigation svelte-16j63mf"),c(L,"class","role-selector svelte-16j63mf"),c(s,"class","top-controls svelte-16j63mf"),c(N,"class","main-area svelte-16j63mf"),c(o,"class","main-content svelte-16j63mf"),c(Y,"class",ae=yn(n[0])+" svelte-16j63mf"),c(K,"class","svelte-16j63mf"),c(l,"class","is-full-height svelte-16j63mf")},m(se,j){i(document.head,e),S(se,t,j),S(se,l,j),i(l,o),i(o,s),i(s,r),i(r,u),i(u,a),i(u,p),i(u,d),i(d,m),i(m,_),i(_,h),i(m,g),i(m,w),i(w,C),i(m,y),i(m,T),i(T,k),i(s,v),i(s,L),Te(R,L,null),i(o,A),i(o,N),Te(D,N,null),i(N,B),Te(V,N,null),i(N,O),Te(E,N,null),i(o,te),i(o,M),i(o,X),Te(J,o,null),i(o,F),Te(H,o,null),i(o,z),Te(P,o,null),i(l,U),i(l,K),i(K,Y),Te(re,Y,null),ne=!0,Q||(ue=[ee(a,"click",n[3]),ee(a,"keydown",n[4]),Pl(jl.call(null,h)),Pl(jl.call(null,C)),Pl(jl.call(null,k)),ee(K,"mouseover",n[2]),ee(K,"focus",n[2])],Q=!0)},p(se,[j]){(!ne||j&2)&&c(e,"content",se[1]);const W={};j&64&&(W.$$scope={dirty:j,ctx:se}),D.$set(W);const le={};j&64&&(le.$$scope={dirty:j,ctx:se}),V.$set(le);const ie={};j&64&&(ie.$$scope={dirty:j,ctx:se}),E.$set(ie);const _e={};j&64&&(_e.$$scope={dirty:j,ctx:se}),J.$set(_e);const ce={};j&64&&(ce.$$scope={dirty:j,ctx:se}),H.$set(ce);const fe={};j&64&&(fe.$$scope={dirty:j,ctx:se}),P.$set(fe);const de={};j&64&&(de.$$scope={dirty:j,ctx:se}),re.$set(de),(!ne||j&1&&ae!==(ae=yn(se[0])+" svelte-16j63mf"))&&c(Y,"class",ae)},i(se){ne||(q(R.$$.fragment,se),q(D.$$.fragment,se),q(V.$$.fragment,se),q(E.$$.fragment,se),q(J.$$.fragment,se),q(H.$$.fragment,se),q(P.$$.fragment,se),q(re.$$.fragment,se),ne=!0)},o(se){Z(R.$$.fragment,se),Z(D.$$.fragment,se),Z(V.$$.fragment,se),Z(E.$$.fragment,se),Z(J.$$.fragment,se),Z(H.$$.fragment,se),Z(P.$$.fragment,se),Z(re.$$.fragment,se),ne=!1},d(se){se&&($(t),$(l)),$(e),Ce(R),Ce(D),Ce(V),Ce(E),Ce(J),Ce(H),Ce(P),Ce(re),Q=!1,ft(ue)}}}function Op(n,e,t){let l;lt(n,nl,a=>t(1,l=a));let o="is-hidden";function s(){t(0,o="")}function r(){window.history.length>1?window.history.back():mi.goto("/")}return[o,l,s,r,a=>{(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),r())}]}class Rp extends Ht{constructor(e){super(),Ft(this,e,Op,Sp,jt,{})}}new Rp({target:document.getElementById("app")});export{zn as i};
