var Es=Object.defineProperty;var Ls=(l,e,t)=>e in l?Es(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var Ct=(l,e,t)=>(Ls(l,typeof e!="symbol"?e+"":e,t),t);import{aa as At,S as mt,i as _t,s as ut,q as f,Y as W,b as S,y as s,Z as we,I as Ne,j as T,ak as Ue,F as ct,m as Jt,a as h,v as i,l as te,E as Qe,au as zt,r as ve,z as be,t as x,d as oe,B as ke,av as As,aw as Vt,H as st,U as it,V as at,ax as Pl,ay as Ps,g as tt,e as lt,O as Xe,af as St,o as Os,W as ge,az as Ml,aA as Tt,aB as cs,aC as us,a1 as Pe,C as rt,aD as qe,aE as fs,D as sl,G as rl,aF as ds,w as Nt,x as bt,A as Fl,a2 as Ms,aG as pl,ac as Ns,a7 as Ds,a9 as Is,n as Us,k as js,_ as Il}from"./vendor-ui-cd3d2b6a.js";import{R as Ot,S as Nl,f as Hs,Y as Ul}from"./vendor-utils-740e9743.js";import{J as ps,_ as zs,d as ms,P as Fs,k as qs,D as Ks,l as Ws,E as Gs,o as mn}from"./vendor-editor-992829d3.js";import{P as _s,T as Ol,u as hs,y as Bs,A as Js,S as Vs,q as Qs}from"./vendor-atomic-1ea13e29.js";import{t as Ys,E as Zs}from"./novel-editor-becefd2f.js";import{s as jl,z as Xs,a as xs,l as er,m as tr,c as lr,b as nr,B as or,d as sr}from"./vendor-charts-e6a4a6c9.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const r of c.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function t(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(o){if(o.ep)return;o.ep=!0;const c=t(o);fetch(o.href,c)}})();const Ye={ServerURL:location.protocol+"//"+window.location.host||"/"},dl=At([]),rr={id:"Desktop",global_shortcut:"",roles:{},default_role:{original:"",lowercase:""},selected_role:{original:"",lowercase:""}},ml=At("spacelab"),Et=At("selected"),ot=At(!1),ir=At(`${Ye.ServerURL}/documents/search`),Lt=At(rr),_n=At([]);let Ll=At("");const $t=At(!1);let Bt=null;function ar(l){if(typeof document>"u")return;const e=`/assets/bulmaswatch/${l}/bulmaswatch.min.css`;if(Bt!=null&&Bt.href.endsWith(e))return;const t=document.createElement("link");t.rel="stylesheet",t.href=e,t.id="bulma-theme",t.onload=()=>{Bt&&Bt!==t&&Bt.remove(),Bt=t},document.head.appendChild(t);const n=document.head.querySelector('meta[name="color-scheme"]');n&&n.setAttribute("content",l)}ml.subscribe(ar);function cr(l){let e,t;return{c(){e=f("option"),t=W(l[1]),e.__value=l[0],e.value=e.__value},m(n,o){S(n,e,o),s(e,t)},p(n,[o]){o&2&&we(t,n[1]),o&1&&(e.__value=n[0],e.value=e.__value)},i:Ne,o:Ne,d(n){n&&T(e)}}}function ur(l,e,t){let n,{subject:o}=e;const c=_s(o),r=Ol(c,hs.properties.name);return Ue(l,r,u=>t(1,n=u)),Ol(c,"http://localhost:9883/property/theme"),l.$$set=u=>{"subject"in u&&t(0,o=u.subject)},[o,n,r]}class fr extends mt{constructor(e){super(),_t(this,e,ur,cr,ut,{subject:0})}}function hn(l){let e,t,n,o,c,r,u=l[0]&&gn();return{c(){e=f("button"),t=f("span"),t.innerHTML='<i class="fas fa-arrow-left"></i>',n=h(),u&&u.c(),i(t,"class","icon svelte-rnsqpo"),i(e,"class",o="button is-light back-button "+l[1]+" svelte-rnsqpo"),i(e,"title","Go back"),i(e,"aria-label","Go back")},m(a,d){S(a,e,d),s(e,t),s(e,n),u&&u.m(e,null),c||(r=[te(e,"click",l[3]),te(e,"keydown",l[6])],c=!0)},p(a,d){a[0]?u||(u=gn(),u.c(),u.m(e,null)):u&&(u.d(1),u=null),d&2&&o!==(o="button is-light back-button "+a[1]+" svelte-rnsqpo")&&i(e,"class",o)},d(a){a&&T(e),u&&u.d(),c=!1,Qe(r)}}}function gn(l){let e;return{c(){e=f("span"),e.textContent="Back",i(e,"class","back-text svelte-rnsqpo")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function dr(l){let e,t=l[2]&&hn(l);return{c(){t&&t.c(),e=ct()},m(n,o){t&&t.m(n,o),S(n,e,o)},p(n,[o]){n[2]?t?t.p(n,o):(t=hn(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Ne,o:Ne,d(n){t&&t.d(n),n&&T(e)}}}function pr(l,e,t){let{fallbackPath:n="/"}=e,{showText:o=!0}=e,{customClass:c=""}=e,{hideOnPaths:r=["/"]}=e,u=!0;function a(){var m;try{const _=((m=window.location)==null?void 0:m.pathname)||"/";t(2,u=!r.includes(_))}catch{t(2,u=!0)}}function d(){window.history.length>1?window.history.back():window.location.href=n}Jt(()=>(a(),window.addEventListener("popstate",a),window.addEventListener("hashchange",a),()=>{window.removeEventListener("popstate",a),window.removeEventListener("hashchange",a)}));const p=m=>{(m.key==="Enter"||m.key===" ")&&(m.preventDefault(),d())};return l.$$set=m=>{"fallbackPath"in m&&t(4,n=m.fallbackPath),"showText"in m&&t(0,o=m.showText),"customClass"in m&&t(1,c=m.customClass),"hideOnPaths"in m&&t(5,r=m.hideOnPaths)},[o,c,u,d,n,r,p]}class il extends mt{constructor(e){super(),_t(this,e,pr,dr,ut,{fallbackPath:4,showText:0,customClass:1,hideOnPaths:5})}}function mr(){return window.crypto.getRandomValues(new Uint32Array(1))[0]}function Hl(l,e=!1){const t=mr(),n=`_${t}`;return Object.defineProperty(window,n,{value:o=>(e&&Reflect.deleteProperty(window,n),l==null?void 0:l(o)),writable:!1,configurable:!0}),t}async function Fe(l,e={}){return new Promise((t,n)=>{const o=Hl(r=>{t(r),Reflect.deleteProperty(window,`_${c}`)},!0),c=Hl(r=>{n(r),Reflect.deleteProperty(window,`_${o}`)},!0);window.__TAURI_IPC__({cmd:l,callback:o,error:c,...e})})}function vn(l,e,t){const n=l.slice();return n[25]=e[t],n}function _r(l){let e,t,n;function o(r){l[13](r)}let c={};return l[5]!==void 0&&(c.value=l[5]),e=new Vt({props:c}),st.push(()=>it(e,"value",o)),{c(){ve(e.$$.fragment)},m(r,u){be(e,r,u),n=!0},p(r,u){const a={};!t&&u&32&&(t=!0,a.value=r[5],at(()=>t=!1)),e.$set(a)},i(r){n||(x(e.$$.fragment,r),n=!0)},o(r){oe(e.$$.fragment,r),n=!1},d(r){ke(e,r)}}}function hr(l){let e,t,n;function o(r){l[14](r)}let c={type:"password",placeholder:"secret",icon:"fas fa-lock",expanded:!0};return l[6]!==void 0&&(c.value=l[6]),e=new Vt({props:c}),st.push(()=>it(e,"value",o)),{c(){ve(e.$$.fragment)},m(r,u){be(e,r,u),n=!0},p(r,u){const a={};!t&&u&64&&(t=!0,a.value=r[6],at(()=>t=!1)),e.$set(a)},i(r){n||(x(e.$$.fragment,r),n=!0)},o(r){oe(e.$$.fragment,r),n=!1},d(r){ke(e,r)}}}function gr(l){let e;return{c(){e=W("Save")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function vr(l){let e,t;return e=new Pl({props:{type:"is-success",class:"is-right",iconPack:"fa",iconLeft:"check",$$slots:{default:[gr]},$$scope:{ctx:l}}}),e.$on("click",l[8]),e.$on("submit",l[8]),{c(){ve(e.$$.fragment)},m(n,o){be(e,n,o),t=!0},p(n,o){const c={};o&268435456&&(c.$$scope={dirty:o,ctx:n}),e.$set(c)},i(n){t||(x(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){ke(e,n)}}}function br(l){let e,t,n,o,c,r;return e=new zt({props:{$$slots:{default:[_r]},$$scope:{ctx:l}}}),n=new zt({props:{grouped:!0,$$slots:{default:[hr]},$$scope:{ctx:l}}}),c=new zt({props:{grouped:!0,$$slots:{default:[vr]},$$scope:{ctx:l}}}),{c(){ve(e.$$.fragment),t=h(),ve(n.$$.fragment),o=h(),ve(c.$$.fragment)},m(u,a){be(e,u,a),S(u,t,a),be(n,u,a),S(u,o,a),be(c,u,a),r=!0},p(u,a){const d={};a&268435488&&(d.$$scope={dirty:a,ctx:u}),e.$set(d);const p={};a&268435520&&(p.$$scope={dirty:a,ctx:u}),n.$set(p);const m={};a&268435456&&(m.$$scope={dirty:a,ctx:u}),c.$set(m)},i(u){r||(x(e.$$.fragment,u),x(n.$$.fragment,u),x(c.$$.fragment,u),r=!0)},o(u){oe(e.$$.fragment,u),oe(n.$$.fragment,u),oe(c.$$.fragment,u),r=!1},d(u){ke(e,u),u&&T(t),ke(n,u),u&&T(o),ke(c,u)}}}function kr(l){let e,t,n;function o(r){l[15](r)}let c={type:"search",placeholder:"Fetch JSON",icon:"search"};return l[3]!==void 0&&(c.value=l[3]),e=new Vt({props:c}),st.push(()=>it(e,"value",o)),{c(){ve(e.$$.fragment)},m(r,u){be(e,r,u),n=!0},p(r,u){const a={};!t&&u&8&&(t=!0,a.value=r[3],at(()=>t=!1)),e.$set(a)},i(r){n||(x(e.$$.fragment,r),n=!0)},o(r){oe(e.$$.fragment,r),n=!1},d(r){ke(e,r)}}}function wr(l){let e;return{c(){e=W("WikiPage")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function yr(l){let e,t,n,o,c,r;function u(m){l[16](m)}let a={type:"search",placeholder:"Post JSON",icon:"search"};l[4]!==void 0&&(a.value=l[4]),e=new Vt({props:a}),st.push(()=>it(e,"value",u));function d(m){l[17](m)}let p={$$slots:{default:[wr]},$$scope:{ctx:l}};return l[2]!==void 0&&(p.checked=l[2]),o=new Ps({props:p}),st.push(()=>it(o,"checked",d)),{c(){ve(e.$$.fragment),n=h(),ve(o.$$.fragment)},m(m,_){be(e,m,_),S(m,n,_),be(o,m,_),r=!0},p(m,_){const v={};!t&&_&16&&(t=!0,v.value=m[4],at(()=>t=!1)),e.$set(v);const k={};_&268435456&&(k.$$scope={dirty:_,ctx:m}),!c&&_&4&&(c=!0,k.checked=m[2],at(()=>c=!1)),o.$set(k)},i(m){r||(x(e.$$.fragment,m),x(o.$$.fragment,m),r=!0)},o(m){oe(e.$$.fragment,m),oe(o.$$.fragment,m),r=!1},d(m){ke(e,m),m&&T(n),ke(o,m)}}}function Cr(l){let e;return{c(){e=W("Fetch")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function $r(l){let e,t;return e=new Pl({props:{type:"is-primary",$$slots:{default:[Cr]},$$scope:{ctx:l}}}),e.$on("click",l[9]),e.$on("submit",l[9]),{c(){ve(e.$$.fragment)},m(n,o){be(e,n,o),t=!0},p(n,o){const c={};o&268435456&&(c.$$scope={dirty:o,ctx:n}),e.$set(c)},i(n){t||(x(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){ke(e,n)}}}function Tr(l){let e,t,n,o,c,r;return e=new zt({props:{grouped:!0,$$slots:{default:[kr]},$$scope:{ctx:l}}}),n=new zt({props:{grouped:!0,$$slots:{default:[yr]},$$scope:{ctx:l}}}),c=new zt({props:{grouped:!0,$$slots:{default:[$r]},$$scope:{ctx:l}}}),{c(){ve(e.$$.fragment),t=h(),ve(n.$$.fragment),o=h(),ve(c.$$.fragment)},m(u,a){be(e,u,a),S(u,t,a),be(n,u,a),S(u,o,a),be(c,u,a),r=!0},p(u,a){const d={};a&268435464&&(d.$$scope={dirty:a,ctx:u}),e.$set(d);const p={};a&268435476&&(p.$$scope={dirty:a,ctx:u}),n.$set(p);const m={};a&268435456&&(m.$$scope={dirty:a,ctx:u}),c.$set(m)},i(u){r||(x(e.$$.fragment,u),x(n.$$.fragment,u),x(c.$$.fragment,u),r=!0)},o(u){oe(e.$$.fragment,u),oe(n.$$.fragment,u),oe(c.$$.fragment,u),r=!1},d(u){ke(e,u),u&&T(t),ke(n,u),u&&T(o),ke(c,u)}}}function Sr(l){let e,t,n,o,c;return o=new ps({props:{content:l[1],onChange:l[7]}}),{c(){e=f("p"),e.innerHTML=`<i>The best editing experience is to configure Atomic Server, in the
        meantime use editor below. You will need to refresh page via Command R
        or Ctrl-R to see changes</i>`,t=h(),n=f("div"),ve(o.$$.fragment),i(n,"class","editor")},m(r,u){S(r,e,u),S(r,t,u),S(r,n,u),be(o,n,null),c=!0},p(r,u){const a={};u&2&&(a.content=r[1]),o.$set(a)},i(r){c||(x(o.$$.fragment,r),c=!0)},o(r){oe(o.$$.fragment,r),c=!1},d(r){r&&T(e),r&&T(t),r&&T(n),ke(o)}}}function bn(l){let e,t;return e=new fr({props:{subject:l[25]}}),{c(){ve(e.$$.fragment)},m(n,o){be(e,n,o),t=!0},p(n,o){const c={};o&1&&(c.subject=n[25]),e.$set(c)},i(n){t||(x(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){ke(e,n)}}}function Rr(l){let e,t,n=l[0]??[],o=[];for(let r=0;r<n.length;r+=1)o[r]=bn(vn(l,n,r));const c=r=>oe(o[r],1,1,()=>{o[r]=null});return{c(){for(let r=0;r<o.length;r+=1)o[r].c();e=ct()},m(r,u){for(let a=0;a<o.length;a+=1)o[a]&&o[a].m(r,u);S(r,e,u),t=!0},p(r,u){if(u&1){n=r[0]??[];let a;for(a=0;a<n.length;a+=1){const d=vn(r,n,a);o[a]?(o[a].p(d,u),x(o[a],1)):(o[a]=bn(d),o[a].c(),x(o[a],1),o[a].m(e.parentNode,e))}for(tt(),a=n.length;a<o.length;a+=1)c(a);lt()}},i(r){if(!t){for(let u=0;u<n.length;u+=1)x(o[u]);t=!0}},o(r){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)oe(o[u]);t=!1},d(r){Xe(o,r),r&&T(e)}}}function Er(l){let e,t;return e=new As({props:{$$slots:{default:[Rr]},$$scope:{ctx:l}}}),{c(){ve(e.$$.fragment)},m(n,o){be(e,n,o),t=!0},p(n,o){const c={};o&268435457&&(c.$$scope={dirty:o,ctx:n}),e.$set(c)},i(n){t||(x(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){ke(e,n)}}}function Lr(l){let e,t,n,o,c,r,u,a,d,p,m,_,v,k,C;return e=new il({props:{fallbackPath:"/"}}),o=new Ot({props:{path:"/atomic",$$slots:{default:[br]},$$scope:{ctx:l}}}),r=new Ot({props:{path:"/json",$$slots:{default:[Tr]},$$scope:{ctx:l}}}),a=new Ot({props:{path:"/editor",$$slots:{default:[Sr]},$$scope:{ctx:l}}}),_=new zt({props:{grouped:!0,position:"is-right",$$slots:{default:[Er]},$$scope:{ctx:l}}}),{c(){ve(e.$$.fragment),t=h(),n=f("div"),ve(o.$$.fragment),c=h(),ve(r.$$.fragment),u=h(),ve(a.$$.fragment),d=h(),p=f("hr"),m=h(),ve(_.$$.fragment),v=h(),k=f("nav"),k.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a>
    <a class="navbar-item" href="/fetch/json">Fetch JSON Data</a>
    <a class="navbar-item" href="/fetch/atomic">Set Atomic Server</a>
    <a class="navbar-item" href="/fetch/editor">Edit JSON config</a></div>`,i(n,"class","box"),i(k,"class","navbar")},m(w,b){be(e,w,b),S(w,t,b),S(w,n,b),be(o,n,null),s(n,c),be(r,n,null),s(n,u),be(a,n,null),S(w,d,b),S(w,p,b),S(w,m,b),be(_,w,b),S(w,v,b),S(w,k,b),C=!0},p(w,[b]){const y={};b&268435552&&(y.$$scope={dirty:b,ctx:w}),o.$set(y);const g={};b&268435484&&(g.$$scope={dirty:b,ctx:w}),r.$set(g);const $={};b&268435458&&($.$$scope={dirty:b,ctx:w}),a.$set($);const z={};b&268435457&&(z.$$scope={dirty:b,ctx:w}),_.$set(z)},i(w){C||(x(e.$$.fragment,w),x(o.$$.fragment,w),x(r.$$.fragment,w),x(a.$$.fragment,w),x(_.$$.fragment,w),C=!0)},o(w){oe(e.$$.fragment,w),oe(o.$$.fragment,w),oe(r.$$.fragment,w),oe(a.$$.fragment,w),oe(_.$$.fragment,w),C=!1},d(w){ke(e,w),w&&T(t),w&&T(n),ke(o),ke(r),ke(a),w&&T(d),w&&T(p),w&&T(m),ke(_,w),w&&T(v),w&&T(k)}}}function Ar(l,e,t){let n,o,c,r,u;Ue(l,Bs,R=>t(19,c=R)),Ue(l,ot,R=>t(20,r=R)),Ue(l,Lt,R=>t(21,u=R));let a={json:u};function d(R){if(console.log("contents changed:",R),console.log("is tauri",r),Lt.update(E=>(E=R.json,E)),ot)console.log("Updating config on server"),Fe("update_config",{configNew:R.json}).then(E=>{console.log(`Message: ${E}`)}).catch(E=>console.error(E));else{let E=`${Ye.ServerURL}/config/`;fetch(E,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(R.json)})}t(1,a=R)}let p=!1,m="https://raw.githubusercontent.com/terraphim/terraphim-cloud-fastapi/main/data/ref_arch.json",_="http://localhost:8000/documents/",v="http://localhost:9883/",k;const C=async()=>{console.log("Updating atomic server configuration");const R=Js.fromSecret(k);c.setServerUrl(v),console.log("Server set.Setting agent"),c.setAgent(R)},w=async()=>{g()},b=({data:{msg:R,data:E}})=>{console.log(R,E)};let y;const g=async()=>{const R=await zs(()=>import("./fetcher.worker-7e58969a.js"),[]);y=new R.default,y.onmessage=b;const E={msg:"fetcher",data:{url:m,postUrl:_,isWiki:p}};y.postMessage(E)},$=_s("http://localhost:9883/config/y3zx5wtm0bq"),z=Ol($,hs.properties.name);Ue(l,z,R=>t(12,o=R));const M=Ol($,"http://localhost:9883/property/role");Ue(l,M,R=>t(0,n=R));function N(R){v=R,t(5,v)}function L(R){k=R,t(6,k)}function q(R){m=R,t(3,m)}function Q(R){_=R,t(4,_)}function H(R){p=R,t(2,p)}return l.$$.update=()=>{l.$$.dirty&4096&&console.log("Print name",o),l.$$.dirty&1&&console.log("Print roles",n)},[n,a,p,m,_,v,k,d,C,w,z,M,o,N,L,q,Q,H]}class Pr extends mt{constructor(e){super(),_t(this,e,Ar,Lr,ut,{})}}function Ht(){return St(ot)||typeof window<"u"&&window.__TAURI__!==void 0}class Or{constructor(){Ct(this,"baseUrl");Ct(this,"autocompleteIndexBuilt",!1);Ct(this,"sessionId");Ct(this,"currentRole","Default");Ct(this,"connectionRetries",0);Ct(this,"maxRetries",3);Ct(this,"retryDelay",1e3);Ct(this,"isConnecting",!1);this.baseUrl=typeof window<"u"?(window.location.protocol==="https:"?"https://":"http://")+window.location.hostname+":8001":"http://localhost:8001",this.sessionId=`novel-${Date.now()}`,typeof window<"u"&&!Ht()&&this.shouldPerformHealthCheck()?this.detectServerPort():typeof window<"u"&&!Ht()&&console.log("NovelAutocompleteService: Skipping server detection - not needed for current page")}setRole(e){this.currentRole=e,this.autocompleteIndexBuilt=!1}async detectServerPort(){if(Ht())return;if(!this.shouldPerformHealthCheck()){console.log("NovelAutocompleteService: Skipping health check - service not needed");return}const t=[8001,3e3];for(const n of t)try{const o=typeof window<"u"?(window.location.protocol==="https:"?"https://":"http://")+window.location.hostname+":"+n:"http://localhost:"+n,c=await fetch(`${o}/message?sessionId=health-check`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:0,method:"ping",params:{}}),signal:AbortSignal.timeout(1e3)});if(c.ok||c.status===404){this.baseUrl=o,console.log(`NovelAutocompleteService: Detected server at ${o}`);return}}catch{continue}console.warn("NovelAutocompleteService: Could not detect running server, using default:",this.baseUrl)}shouldPerformHealthCheck(){return!(typeof window<"u"&&(!window.location.pathname.startsWith("/chat")||!(document.querySelector('[contenteditable="true"]')||document.querySelector("textarea")||document.querySelector('input[type="text"]'))))}async buildAutocompleteIndex(){if(this.isConnecting)return await new Promise(e=>setTimeout(e,1e3)),this.autocompleteIndexBuilt;this.isConnecting=!0;try{return Ht()?(console.log("Using Tauri backend - no index building required"),this.autocompleteIndexBuilt=!0,this.connectionRetries=0,console.log("Tauri autocomplete ready"),!0):await this.buildMCPIndex()}catch(e){return console.error("Error building Novel autocomplete index:",e),!1}finally{this.isConnecting=!1}}async buildMCPIndex(){for(let e=0;e<=this.maxRetries;e++)try{const t=await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:Date.now(),method:"tools/call",params:{name:"build_autocomplete_index",arguments:{}}}),signal:AbortSignal.timeout(1e4)});if(t.ok){const n=await t.json();if(console.log(`MCP build index response (attempt ${e+1}):`,n),n.result&&!n.result.is_error)return this.autocompleteIndexBuilt=!0,this.connectionRetries=0,console.log("MCP autocomplete index built successfully"),!0}else if(t.status>=500&&e<this.maxRetries){console.warn(`MCP server error ${t.status}, retrying in ${this.retryDelay}ms...`),await new Promise(n=>setTimeout(n,this.retryDelay*(e+1)));continue}console.warn(`MCP build index failed (attempt ${e+1}):`,t.status,t.statusText)}catch(t){t instanceof Error&&t.name==="AbortError"?console.warn(`MCP request timeout (attempt ${e+1})`):console.warn(`MCP connection error (attempt ${e+1}):`,t),e<this.maxRetries&&await new Promise(n=>setTimeout(n,this.retryDelay*(e+1)))}return console.error("Failed to build MCP autocomplete index after all retries"),!1}async getCompletion(e){if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return{text:""};try{const t=this.extractLastWord(e.prompt);if(!t||t.length<1)return{text:""};const n=await this.getSuggestionsWithSnippets(t,5);if(n.length===0)return{text:""};let c=n[0].text;c.toLowerCase().startsWith(t.toLowerCase())&&(c=c.substring(t.length));const r=e.prompt.length/4,u=c.length/4;return{text:c,usage:{promptTokens:Math.round(r),completionTokens:Math.round(u),totalTokens:Math.round(r+u)}}}catch(t){return console.error("Error getting Novel autocomplete completion:",t),{text:""}}}async getSuggestions(e,t=10){if(!e||e.trim().length===0)return[];if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return console.warn("Autocomplete index not built, returning empty suggestions"),[];try{return Ht()?await this.getTauriSuggestions(e,t):await this.getMCPSuggestions(e,t,"autocomplete_terms")}catch(n){return console.error("Error getting autocomplete suggestions:",n),[]}}async getTauriSuggestions(e,t){const n=await Fe("get_autocomplete_suggestions",{query:e.trim(),role_name:this.currentRole,limit:t});return console.log("Tauri autocomplete response:",n),n&&n.status==="success"&&n.suggestions?n.suggestions.map(o=>({text:o.term||o.text||"",snippet:o.url||o.snippet||"",score:o.score||1})).filter(o=>o.text.length>0):(n&&n.error&&console.error("Tauri autocomplete error:",n.error),[])}async getMCPSuggestions(e,t,n){const o=Date.now(),c=await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:o,method:"tools/call",params:{name:n,arguments:{query:e.trim(),limit:t,role:this.currentRole}}}),signal:AbortSignal.timeout(5e3)});if(!c.ok)return console.error(`MCP ${n} request failed:`,c.status,c.statusText),[];const r=await c.json();return console.log(`MCP ${n} response:`,r),r.result&&!r.result.is_error&&r.result.content?n==="autocomplete_with_snippets"?this.parseAutocompleteWithSnippetsContent(r.result.content):this.parseAutocompleteContent(r.result.content):(r.error&&console.error(`MCP ${n} error:`,r.error),[])}async getSuggestionsWithSnippets(e,t=10){if(!e||e.trim().length===0)return[];if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return console.warn("Autocomplete index not built, returning empty suggestions with snippets"),[];try{return Ht()?await this.getTauriSuggestions(e,t):await this.getMCPSuggestions(e,t,"autocomplete_with_snippets")}catch(n){return console.error("Error getting autocomplete suggestions with snippets:",n),[]}}extractLastWord(e){const t=e.trim().split(/\s+/);return t[t.length-1]||""}parseAutocompleteContent(e){const t=[];for(const n of e)if(n.type==="text"&&n.text){if(!n.text.startsWith("Found")&&!n.text.startsWith("•"))t.push({text:n.text.trim()});else if(n.text.startsWith("•")){const o=n.text.replace("•","").trim();o&&t.push({text:o})}}return t}parseAutocompleteWithSnippetsContent(e){const t=[];for(const n of e)if(n.type==="text"&&n.text){if(!n.text.startsWith("Found")&&!n.text.startsWith("•")){const o=n.text.split(" — ");o.length===2?t.push({text:o[0].trim(),snippet:o[1].trim()}):t.push({text:n.text.trim()})}else if(n.text.startsWith("•")){const o=n.text.replace("•","").trim();o&&t.push({text:o})}}return t}isReady(){return this.autocompleteIndexBuilt}getStatus(){return{ready:this.autocompleteIndexBuilt,baseUrl:this.baseUrl,sessionId:this.sessionId,usingTauri:Ht(),currentRole:this.currentRole,connectionRetries:this.connectionRetries,isConnecting:this.isConnecting}}async refreshIndex(){return this.autocompleteIndexBuilt=!1,this.connectionRetries=0,await this.buildAutocompleteIndex()}async testConnection(){try{if(Ht()){const e=await Fe("get_autocomplete_suggestions",{query:"test",role_name:this.currentRole,limit:1});return e&&(e.status==="success"||e.status==="error")}else return(await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:Date.now(),method:"tools/list",params:{}}),signal:AbortSignal.timeout(3e3)})).ok}catch(e){return console.warn("Connection test failed:",e),!1}}}const Mt=new Or;function Mr(l){var e;const{char:t,allowSpaces:n,allowToIncludeChar:o,allowedPrefixes:c,startOfLine:r,$position:u}=l,a=n&&!o,d=Ws(t),p=new RegExp(`\\s${d}$`),m=r?"^":"",_=o?"":d,v=a?new RegExp(`${m}${d}.*?(?=\\s${_}|$)`,"gm"):new RegExp(`${m}(?:^)?${d}[^\\s${_}]*`,"gm"),k=((e=u.nodeBefore)===null||e===void 0?void 0:e.isText)&&u.nodeBefore.text;if(!k)return null;const C=u.pos-k.length,w=Array.from(k.matchAll(v)).pop();if(!w||w.input===void 0||w.index===void 0)return null;const b=w.input.slice(Math.max(0,w.index-1),w.index),y=new RegExp(`^[${c==null?void 0:c.join("")}\0]?$`).test(b);if(c!==null&&!y)return null;const g=C+w.index;let $=g+w[0].length;return a&&p.test(k.slice($-1,$+1))&&(w[0]+=" ",$+=1),g<u.pos&&$>=u.pos?{range:{from:g,to:$},query:w[0].slice(t.length),text:w[0]}:null}const Nr=new ms("suggestion");function Dr({pluginKey:l=Nr,editor:e,char:t="@",allowSpaces:n=!1,allowToIncludeChar:o=!1,allowedPrefixes:c=[" "],startOfLine:r=!1,decorationTag:u="span",decorationClass:a="suggestion",decorationContent:d="",decorationEmptyClass:p="is-empty",command:m=()=>null,items:_=()=>[],render:v=()=>({}),allow:k=()=>!0,findSuggestionMatch:C=Mr}){let w;const b=v==null?void 0:v(),y=new Fs({key:l,view(){return{update:async(g,$)=>{var z,M,N,L,q,Q,H;const R=(z=this.key)===null||z===void 0?void 0:z.getState($),E=(M=this.key)===null||M===void 0?void 0:M.getState(g.state),K=R.active&&E.active&&R.range.from!==E.range.from,A=!R.active&&E.active,Y=R.active&&!E.active,Z=!A&&!Y&&R.query!==E.query,J=A||K&&Z,ee=Z||K,P=Y||K&&Z;if(!J&&!ee&&!P)return;const I=P&&!J?R:E,B=g.dom.querySelector(`[data-decoration-id="${I.decorationId}"]`);w={editor:e,range:I.range,query:I.query,text:I.text,items:[],command:F=>m({editor:e,range:I.range,props:F}),decorationNode:B,clientRect:B?()=>{var F;const{decorationId:X}=(F=this.key)===null||F===void 0?void 0:F.getState(e.state),re=g.dom.querySelector(`[data-decoration-id="${X}"]`);return(re==null?void 0:re.getBoundingClientRect())||null}:null},J&&((N=b==null?void 0:b.onBeforeStart)===null||N===void 0||N.call(b,w)),ee&&((L=b==null?void 0:b.onBeforeUpdate)===null||L===void 0||L.call(b,w)),(ee||J)&&(w.items=await _({editor:e,query:I.query})),P&&((q=b==null?void 0:b.onExit)===null||q===void 0||q.call(b,w)),ee&&((Q=b==null?void 0:b.onUpdate)===null||Q===void 0||Q.call(b,w)),J&&((H=b==null?void 0:b.onStart)===null||H===void 0||H.call(b,w))},destroy:()=>{var g;w&&((g=b==null?void 0:b.onExit)===null||g===void 0||g.call(b,w))}}},state:{init(){return{active:!1,range:{from:0,to:0},query:null,text:null,composing:!1}},apply(g,$,z,M){const{isEditable:N}=e,{composing:L}=e.view,{selection:q}=g,{empty:Q,from:H}=q,R={...$};if(R.composing=L,N&&(Q||e.view.composing)){(H<$.range.from||H>$.range.to)&&!L&&!$.composing&&(R.active=!1);const E=C({char:t,allowSpaces:n,allowToIncludeChar:o,allowedPrefixes:c,startOfLine:r,$position:q.$from}),K=`id_${Math.floor(Math.random()*4294967295)}`;E&&k({editor:e,state:M,range:E.range,isActive:$.active})?(R.active=!0,R.decorationId=$.decorationId?$.decorationId:K,R.range=E.range,R.query=E.query,R.text=E.text):R.active=!1}else R.active=!1;return R.active||(R.decorationId=null,R.range={from:0,to:0},R.query=null,R.text=null),R}},props:{handleKeyDown(g,$){var z;const{active:M,range:N}=y.getState(g.state);return M&&((z=b==null?void 0:b.onKeyDown)===null||z===void 0?void 0:z.call(b,{view:g,event:$,range:N}))||!1},decorations(g){const{active:$,range:z,decorationId:M,query:N}=y.getState(g);if(!$)return null;const L=!(N!=null&&N.length),q=[a];return L&&q.push(p),qs.create(g.doc,[Ks.inline(z.from,z.to,{nodeName:u,class:q.join(" "),"data-decoration-id":M,"data-decoration-content":d})])}}});return y}const kn=Gs.create({name:"terraphimSuggestion",addOptions(){return{trigger:"++",pluginKey:new ms("terraphimSuggestion"),allowSpaces:!1,limit:8,minLength:1,debounce:300}},addCommands(){return{insertSuggestion:l=>({commands:e,chain:t})=>t().insertContent(l.text).run()}},addProseMirrorPlugins(){const l={editor:this.editor,char:this.options.trigger,pluginKey:this.options.pluginKey,allowSpaces:this.options.allowSpaces,startOfLine:!1,command:({editor:e,range:t,props:n})=>{const o=n;e.chain().focus().insertContentAt(t,o.text+" ").run()},items:async({query:e,editor:t})=>new Promise(n=>{setTimeout(async()=>{if(e.length<this.options.minLength){n([]);return}try{const o=await Mt.getSuggestionsWithSnippets(e,this.options.limit);console.log(`TerraphimSuggestion: Found ${o.length} suggestions for "${e}"`),n(o)}catch(o){console.error("TerraphimSuggestion: Error getting suggestions:",o),n([])}},this.options.debounce)}),render:()=>{let e,t;return{onStart:n=>{e=new Ir({items:n.items,command:n.command}),n.clientRect&&(t=Ys("body",{getReferenceClientRect:n.clientRect,appendTo:()=>document.body,content:e.element,showOnCreate:!0,interactive:!0,trigger:"manual",placement:"bottom-start",theme:"terraphim-suggestion",maxWidth:"none"})[0])},onUpdate(n){e==null||e.updateItems(n.items),n.clientRect&&(t==null||t.setProps({getReferenceClientRect:n.clientRect}))},onKeyDown(n){return n.event.key==="Escape"?(t==null||t.hide(),!0):(e==null?void 0:e.onKeyDown(n))??!1},onExit(){t==null||t.destroy(),e==null||e.destroy()}}}};return[Dr(l)]}});class Ir{constructor(e){Ct(this,"element");Ct(this,"items",[]);Ct(this,"selectedIndex",0);Ct(this,"command");this.items=e.items,this.command=e.command,this.element=document.createElement("div"),this.element.className="terraphim-suggestion-dropdown",this.render()}updateItems(e){this.items=e,this.selectedIndex=0,this.render()}onKeyDown({event:e}){return e.key==="ArrowUp"?(this.selectPrevious(),!0):e.key==="ArrowDown"?(this.selectNext(),!0):e.key==="Enter"||e.key==="Tab"?(this.selectItem(this.selectedIndex),!0):!1}selectPrevious(){this.selectedIndex=Math.max(0,this.selectedIndex-1),this.render()}selectNext(){this.selectedIndex=Math.min(this.items.length-1,this.selectedIndex+1),this.render()}selectItem(e){const t=this.items[e];t&&this.command({id:t.text,...t})}render(){if(this.element.innerHTML="",this.items.length===0){this.element.innerHTML=`
        <div class="terraphim-suggestion-item terraphim-suggestion-empty">
          <div class="terraphim-suggestion-text">No suggestions found</div>
          <div class="terraphim-suggestion-hint">Try a different search term</div>
        </div>
      `;return}const e=document.createElement("div");e.className="terraphim-suggestion-header",e.innerHTML=`
      <div class="terraphim-suggestion-count">${this.items.length} suggestions</div>
      <div class="terraphim-suggestion-hint">↑↓ Navigate • Tab/Enter Select • Esc Cancel</div>
    `,this.element.appendChild(e),this.items.forEach((t,n)=>{const o=document.createElement("div");o.className=`terraphim-suggestion-item ${n===this.selectedIndex?"terraphim-suggestion-selected":""}`,o.innerHTML=`
        <div class="terraphim-suggestion-main">
          <div class="terraphim-suggestion-text">${this.escapeHtml(t.text)}</div>
          ${t.snippet?`<div class="terraphim-suggestion-snippet">${this.escapeHtml(t.snippet)}</div>`:""}
        </div>
        ${t.score?`<div class="terraphim-suggestion-score">${Math.round(t.score*100)}%</div>`:""}
      `,o.addEventListener("click",()=>this.selectItem(n)),o.addEventListener("mouseenter",()=>{this.selectedIndex=n,this.render()}),this.element.appendChild(o)})}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}destroy(){this.element.remove()}}const Ur=`
.terraphim-suggestion-dropdown {
  background: white;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  box-shadow: 0 10px 38px -10px rgba(22, 23, 24, 0.35), 0 10px 20px -15px rgba(22, 23, 24, 0.2);
  max-height: 300px;
  min-width: 300px;
  overflow-y: auto;
  z-index: 1000;
}

.terraphim-suggestion-header {
  padding: 8px 12px;
  border-bottom: 1px solid #f1f5f9;
  background: #f8fafc;
  font-size: 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.terraphim-suggestion-count {
  font-weight: 600;
  color: #475569;
}

.terraphim-suggestion-hint {
  color: #64748b;
}

.terraphim-suggestion-item {
  padding: 8px 12px;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  border-bottom: 1px solid #f1f5f9;
}

.terraphim-suggestion-item:hover {
  background: #f8fafc;
}

.terraphim-suggestion-selected {
  background: #eff6ff !important;
  border-left: 3px solid #3b82f6;
}

.terraphim-suggestion-empty {
  color: #64748b;
  font-style: italic;
  text-align: center;
  cursor: default;
}

.terraphim-suggestion-main {
  flex: 1;
}

.terraphim-suggestion-text {
  font-weight: 500;
  color: #1e293b;
  margin-bottom: 2px;
}

.terraphim-suggestion-snippet {
  font-size: 12px;
  color: #64748b;
  line-height: 1.3;
}

.terraphim-suggestion-score {
  font-size: 11px;
  color: #10b981;
  font-weight: 600;
  background: #ecfdf5;
  padding: 2px 6px;
  border-radius: 4px;
  margin-left: 8px;
}

/* Dark theme support */
@media (prefers-color-scheme: dark) {
  .terraphim-suggestion-dropdown {
    background: #1e293b;
    border-color: #334155;
  }

  .terraphim-suggestion-header {
    background: #0f172a;
    border-color: #334155;
  }

  .terraphim-suggestion-item:hover {
    background: #334155;
  }

  .terraphim-suggestion-selected {
    background: #1e40af !important;
  }

  .terraphim-suggestion-text {
    color: #f1f5f9;
  }

  .terraphim-suggestion-snippet {
    color: #94a3b8;
  }
}

/* Tippy.js theme */
.tippy-box[data-theme~='terraphim-suggestion'] {
  background: transparent;
  box-shadow: none;
}

.tippy-box[data-theme~='terraphim-suggestion'] > .tippy-backdrop {
  background: transparent;
}

.tippy-box[data-theme~='terraphim-suggestion'] > .tippy-arrow {
  display: none;
}
`;function wn(l){let e,t,n,o,c,r,u,a,d,p,m,_,v,k,C,w,b,y,g,$,z,M,N,L,q,Q,H=l[12]?"Tauri (native)":`MCP Server (${Mt.getStatus().baseUrl})`,R,E,K,A,Y,Z,J,ee,P,I,B,F,X,re,ie,D,O,V,ce,se,le=l[6]!==1?"s":"",me,_e,fe,de,pe,he,Se,Ge,je,Le,Re,ne,ye,Oe,Be,Ke,$e,Me,Ze=l[3]?"Enabled":"Disabled",Je,De,He,xe,ue=l[11]&&!l[8]&&yn(l);function Ae(j,ae){if(j[8])return Fr;if(j[11])return zr}let U=Ae(l),G=U&&U(l);return{c(){e=f("div"),t=f("div"),n=f("strong"),n.textContent="Local Autocomplete Status:",o=h(),c=f("div"),r=f("button"),u=W("Test"),d=h(),p=f("button"),p.textContent="Rebuild Index",m=h(),_=f("button"),v=W("Demo"),C=h(),w=f("div"),b=W(l[10]),y=h(),ue&&ue.c(),g=h(),$=f("div"),z=f("strong"),z.textContent="Configuration:",M=h(),N=f("br"),L=W("• "),q=f("strong"),q.textContent="Backend:",Q=h(),R=W(H),E=h(),K=f("br"),A=W("• "),Y=f("strong"),Y.textContent="Role:",Z=h(),J=W(l[9]),ee=h(),P=f("br"),I=W("• "),B=f("strong"),B.textContent="Trigger:",F=W(' "'),X=W(l[4]),re=W(`" + text
      `),ie=f("br"),D=W("• "),O=f("strong"),O.textContent="Min Length:",V=h(),ce=W(l[6]),se=W(" character"),me=W(le),_e=h(),fe=f("br"),de=W("• "),pe=f("strong"),pe.textContent="Max Results:",he=h(),Se=W(l[5]),Ge=h(),je=f("br"),Le=W("• "),Re=f("strong"),Re.textContent="Debounce:",ne=h(),ye=W(l[7]),Oe=W(`ms
      `),Be=f("br"),Ke=W("• "),$e=f("strong"),$e.textContent="Snippets:",Me=h(),Je=W(Ze),De=h(),G&&G.c(),ge(n,"color","#495057"),ge(r,"padding","4px 8px"),ge(r,"background","#007bff"),ge(r,"color","white"),ge(r,"border","none"),ge(r,"border-radius","4px"),ge(r,"cursor","pointer"),ge(r,"font-size","12px"),r.disabled=a=!l[8],ge(p,"padding","4px 8px"),ge(p,"background","#28a745"),ge(p,"color","white"),ge(p,"border","none"),ge(p,"border-radius","4px"),ge(p,"cursor","pointer"),ge(p,"font-size","12px"),ge(_,"padding","4px 8px"),ge(_,"background","#ffc107"),ge(_,"color","#212529"),ge(_,"border","none"),ge(_,"border-radius","4px"),ge(_,"cursor","pointer"),ge(_,"font-size","12px"),_.disabled=k=!l[8],ge(c,"display","flex"),ge(c,"gap","8px"),ge(t,"display","flex"),ge(t,"justify-content","space-between"),ge(t,"align-items","center"),ge(t,"margin-bottom","8px"),ge(w,"font-size","13px"),ge(w,"color","#6c757d"),ge(w,"margin-bottom","8px"),ge(w,"font-family","monospace"),ge($,"font-size","12px"),ge($,"color","#6c757d"),ge(e,"margin-top","10px"),ge(e,"padding","12px"),ge(e,"background","#f8f9fa"),ge(e,"border-radius","6px"),ge(e,"border","1px solid #e9ecef")},m(j,ae){S(j,e,ae),s(e,t),s(t,n),s(t,o),s(t,c),s(c,r),s(r,u),s(c,d),s(c,p),s(c,m),s(c,_),s(_,v),s(e,C),s(e,w),s(w,b),s(e,y),ue&&ue.m(e,null),s(e,g),s(e,$),s($,z),s($,M),s($,N),s($,L),s($,q),s($,Q),s($,R),s($,E),s($,K),s($,A),s($,Y),s($,Z),s($,J),s($,ee),s($,P),s($,I),s($,B),s($,F),s($,X),s($,re),s($,ie),s($,D),s($,O),s($,V),s($,ce),s($,se),s($,me),s($,_e),s($,fe),s($,de),s($,pe),s($,he),s($,Se),s($,Ge),s($,je),s($,Le),s($,Re),s($,ne),s($,ye),s($,Oe),s($,Be),s($,Ke),s($,$e),s($,Me),s($,Je),s(e,De),G&&G.m(e,null),He||(xe=[te(r,"click",l[14]),te(p,"click",l[15]),te(_,"click",l[16])],He=!0)},p(j,ae){ae&256&&a!==(a=!j[8])&&(r.disabled=a),ae&256&&k!==(k=!j[8])&&(_.disabled=k),ae&1024&&we(b,j[10]),j[11]&&!j[8]?ue?ue.p(j,ae):(ue=yn(j),ue.c(),ue.m(e,g)):ue&&(ue.d(1),ue=null),ae&4096&&H!==(H=j[12]?"Tauri (native)":`MCP Server (${Mt.getStatus().baseUrl})`)&&we(R,H),ae&512&&we(J,j[9]),ae&16&&we(X,j[4]),ae&64&&we(ce,j[6]),ae&64&&le!==(le=j[6]!==1?"s":"")&&we(me,le),ae&32&&we(Se,j[5]),ae&128&&we(ye,j[7]),ae&8&&Ze!==(Ze=j[3]?"Enabled":"Disabled")&&we(Je,Ze),U===(U=Ae(j))&&G?G.p(j,ae):(G&&G.d(1),G=U&&U(j),G&&(G.c(),G.m(e,null)))},d(j){j&&T(e),ue&&ue.d(),G&&G.d(),He=!1,Qe(xe)}}}function yn(l){let e,t,n,o;function c(a,d){return a[12]?Hr:jr}let r=c(l),u=r(l);return{c(){e=f("div"),t=f("strong"),t.textContent="⚠️ Autocomplete Not Available",n=f("br"),o=h(),u.c(),ge(e,"font-size","12px"),ge(e,"color","#dc3545"),ge(e,"margin-bottom","8px"),ge(e,"padding","6px"),ge(e,"background","#f8d7da"),ge(e,"border-radius","4px")},m(a,d){S(a,e,d),s(e,t),s(e,n),s(e,o),u.m(e,null)},p(a,d){r===(r=c(a))&&u?u.p(a,d):(u.d(1),u=r(a),u&&(u.c(),u.m(e,null)))},d(a){a&&T(e),u.d()}}}function jr(l){let e,t=Mt.getStatus().baseUrl+"",n;return{c(){e=W("MCP server not responding. Ensure the server is running on "),n=W(t)},m(o,c){S(o,e,c),S(o,n,c)},p:Ne,d(o){o&&T(e),o&&T(n)}}}function Hr(l){let e;return{c(){e=W("Tauri backend connection failed. Ensure the application has proper permissions.")},m(t,n){S(t,e,n)},p:Ne,d(t){t&&T(e)}}}function zr(l){let e;return{c(){e=f("div"),e.innerHTML=`<strong>❌ Autocomplete Unavailable</strong>
        <div style="font-size: 11px; margin-top: 4px; color: #721c24;">Click &quot;Rebuild Index&quot; to retry or check server/backend status.</div>`,ge(e,"margin-top","8px"),ge(e,"padding","8px"),ge(e,"background","#f8d7da"),ge(e,"border","1px solid #f5c6cb"),ge(e,"border-radius","4px")},m(t,n){S(t,e,n)},p:Ne,d(t){t&&T(e)}}}function Fr(l){let e,t,n,o,c,r,u,a,d,p,m,_,v,k,C,w,b;return{c(){e=f("div"),t=f("strong"),t.textContent="🎯 Autocomplete Active",n=h(),o=f("div"),c=W("Type "),r=f("code"),u=W(l[4]),a=W(" in the editor above to trigger suggestions."),d=f("br"),p=W(`
          Example: `),m=f("code"),_=W(l[4]),v=W("terraphim"),k=W(" or "),C=f("code"),w=W(l[4]),b=W("graph"),ge(o,"font-size","11px"),ge(o,"margin-top","4px"),ge(o,"color","#0056b3"),ge(e,"margin-top","8px"),ge(e,"padding","8px"),ge(e,"background","#d1edff"),ge(e,"border","1px solid #b3d9ff"),ge(e,"border-radius","4px")},m(y,g){S(y,e,g),s(e,t),s(e,n),s(e,o),s(o,c),s(o,r),s(r,u),s(o,a),s(o,d),s(o,p),s(o,m),s(m,_),s(m,v),s(o,k),s(o,C),s(C,w),s(C,b)},p(y,g){g&16&&we(u,y[4]),g&16&&we(_,y[4]),g&16&&we(w,y[4])},d(y){y&&T(e)}}}function qr(l){let e,t,n,o;e=new Zs({props:{defaultValue:l[0],isEditable:!l[1],disableLocalStorage:!0,onUpdate:l[13],extensions:[mn,...l[2]?[kn.configure({trigger:l[4],allowSpaces:!1,limit:l[5],minLength:l[6],debounce:l[7]})]:[]]}});let c=l[2]&&wn(l);return{c(){ve(e.$$.fragment),t=h(),c&&c.c(),n=ct()},m(r,u){be(e,r,u),S(r,t,u),c&&c.m(r,u),S(r,n,u),o=!0},p(r,[u]){const a={};u&1&&(a.defaultValue=r[0]),u&2&&(a.isEditable=!r[1]),u&244&&(a.extensions=[mn,...r[2]?[kn.configure({trigger:r[4],allowSpaces:!1,limit:r[5],minLength:r[6],debounce:r[7]})]:[]]),e.$set(a),r[2]?c?c.p(r,u):(c=wn(r),c.c(),c.m(n.parentNode,n)):c&&(c.d(1),c=null)},i(r){o||(x(e.$$.fragment,r),o=!0)},o(r){oe(e.$$.fragment,r),o=!1},d(r){ke(e,r),r&&T(t),c&&c.d(r),r&&T(n)}}}function Kr(l,e,t){let n,o;Ue(l,Et,L=>t(9,n=L)),Ue(l,ot,L=>t(12,o=L));let{html:c=""}=e,{readOnly:r=!1}=e,{outputFormat:u="html"}=e,{enableAutocomplete:a=!0}=e,{showSnippets:d=!0}=e,{suggestionTrigger:p="++"}=e,{maxSuggestions:m=8}=e,{minQueryLength:_=1}=e,{debounceDelay:v=300}=e,k=null,C="⏳ Initializing...",w=!1,b=!1,y=null;Jt(async()=>{a&&await g(),typeof document<"u"&&(y=document.createElement("style"),y.textContent=Ur,document.head.appendChild(y))}),Os(()=>{y&&y.parentNode&&y.parentNode.removeChild(y)});async function g(){t(10,C="⏳ Initializing autocomplete..."),t(8,w=!1),t(11,b=!1);try{Mt.setRole(n),t(10,C="🔗 Testing connection...");const L=await Mt.testConnection();t(11,b=!0),L?(t(10,C="🔨 Building autocomplete index..."),await Mt.buildAutocompleteIndex()?(o?t(10,C="✅ Ready - Using Tauri backend"):t(10,C="✅ Ready - Using MCP server backend"),t(8,w=!0)):t(10,C="❌ Failed to build autocomplete index")):o?t(10,C="❌ Tauri backend not available"):t(10,C="❌ MCP server not responding")}catch(L){console.error("Error initializing autocomplete:",L),t(10,C="❌ Autocomplete initialization error")}}const $=L=>{k=L,u==="markdown"?t(0,c=L.storage.markdown.getMarkdown()):t(0,c=L.getHTML())},z=async()=>{if(!b){alert("Please wait for connection test to complete");return}if(!w){alert("Autocomplete service not ready. Check the status above.");return}try{t(10,C="🧪 Testing autocomplete...");const L="terraphim",q=await Mt.getSuggestions(L,5);if(console.log("Autocomplete test results:",q),q.length>0){const Q=q.map((H,R)=>`${R+1}. ${H.text}${H.snippet?` (${H.snippet})`:""}`).join(`
`);alert(`✅ Found ${q.length} suggestions for '${L}':

${Q}`),o?t(10,C="✅ Ready - Using Tauri backend"):t(10,C="✅ Ready - Using MCP server backend")}else alert(`⚠️ No suggestions found for '${L}'. This might be normal if the term isn't in your knowledge graph.`)}catch(L){console.error("Autocomplete test failed:",L),alert(`❌ Autocomplete test failed: ${L.message}`),t(10,C="❌ Test failed - check console for details")}},M=async()=>{t(10,C="⏳ Rebuilding index..."),t(8,w=!1);try{await Mt.refreshIndex()?(o?t(10,C="✅ Ready - Tauri index rebuilt successfully"):t(10,C="✅ Ready - MCP server index rebuilt successfully"),t(8,w=!0)):t(10,C="❌ Failed to rebuild index")}catch(L){console.error("Error rebuilding index:",L),t(10,C="❌ Index rebuild failed - check console for details")}},N=()=>{if(!k){alert("Editor not ready yet");return}const L=`# Terraphim Autocomplete Demo

This is a demonstration of the integrated Terraphim autocomplete system.

## How to Use:
1. Type "${p}" to trigger autocomplete
2. Start typing any term (e.g., "${p}terraphim", "${p}graph")
3. Use ↑↓ arrows to navigate suggestions
4. Press Tab or Enter to select
5. Press Esc to cancel

## Try these queries:
- ${p}terraphim
- ${p}graph
- ${p}service
- ${p}automata
- ${p}role

The autocomplete system uses your local knowledge graph to provide intelligent suggestions based on your selected role: **${n}**.

---

Start typing below:`;k.commands.setContent(L),setTimeout(()=>{k.commands.focus("end")},100),alert(`Demo content inserted!

Type "${p}" followed by any term to see autocomplete suggestions.

Example: "${p}terraphim"`)};return l.$$set=L=>{"html"in L&&t(0,c=L.html),"readOnly"in L&&t(1,r=L.readOnly),"outputFormat"in L&&t(17,u=L.outputFormat),"enableAutocomplete"in L&&t(2,a=L.enableAutocomplete),"showSnippets"in L&&t(3,d=L.showSnippets),"suggestionTrigger"in L&&t(4,p=L.suggestionTrigger),"maxSuggestions"in L&&t(5,m=L.maxSuggestions),"minQueryLength"in L&&t(6,_=L.minQueryLength),"debounceDelay"in L&&t(7,v=L.debounceDelay)},l.$$.update=()=>{l.$$.dirty&772&&n&&a&&w&&(Mt.setRole(n),g())},[c,r,a,d,p,m,_,v,w,n,C,b,o,$,z,M,N,u]}class Wr extends mt{constructor(e){super(),_t(this,e,Kr,qr,ut,{html:0,readOnly:1,outputFormat:17,enableAutocomplete:2,showSnippets:3,suggestionTrigger:4,maxSuggestions:5,minQueryLength:6,debounceDelay:7})}}function Cn(l){let e,t,n,o,c,r,u,a,d,p,m;return{c(){e=f("div"),t=f("h3"),n=f("span"),n.textContent="Knowledge Graph",o=W(`
          Term: `),c=f("strong"),r=W(l[2]),u=W(" | Rank: "),a=f("strong"),d=W(l[3]),p=h(),m=f("hr"),i(n,"class","tag is-info svelte-329px1"),i(t,"class","subtitle is-6 svelte-329px1"),i(m,"class","svelte-329px1"),i(e,"class","kg-context svelte-329px1")},m(_,v){S(_,e,v),s(e,t),s(t,n),s(t,o),s(t,c),s(c,r),s(t,u),s(t,a),s(a,d),s(e,p),s(e,m)},p(_,v){v&4&&we(r,_[2]),v&8&&we(d,_[3])},d(_){_&&T(e)}}}function Gr(l){let e,t,n,o,c,r,u,a;const d=[Vr,Jr],p=[];function m(_,v){return _[5]?0:1}return t=m(l),n=p[t]=d[t](l),{c(){e=f("div"),n.c(),o=h(),c=f("div"),c.innerHTML='<span class="hint-text svelte-329px1">Double-click to edit • Ctrl+E to edit • Ctrl+S to save • Click KG links to explore</span>',i(c,"class","edit-hint svelte-329px1"),i(e,"class","content-viewer svelte-329px1"),i(e,"tabindex","0"),i(e,"role","button"),i(e,"aria-label","Double-click to edit article content")},m(_,v){S(_,e,v),p[t].m(e,null),s(e,o),s(e,c),l[20](e),r=!0,u||(a=[te(e,"dblclick",l[14]),te(e,"keydown",l[15]),te(e,"click",l[13])],u=!0)},p(_,v){let k=t;t=m(_),t===k?p[t].p(_,v):(tt(),oe(p[k],1,1,()=>{p[k]=null}),lt(),n=p[t],n?n.p(_,v):(n=p[t]=d[t](_),n.c()),x(n,1),n.m(e,o))},i(_){r||(x(n),r=!0)},o(_){oe(n),r=!1},d(_){_&&T(e),p[t].d(),l[20](null),u=!1,Qe(a)}}}function Br(l){let e,t,n,o,c,r,u,a,d,p;function m(v){l[18](v)}let _={outputFormat:l[11]};return l[1].body!==void 0&&(_.html=l[1].body),e=new Wr({props:_}),st.push(()=>it(e,"html",m)),{c(){ve(e.$$.fragment),n=h(),o=f("div"),c=f("button"),c.textContent="Save",r=h(),u=f("button"),u.textContent="Cancel",i(c,"class","button is-primary"),i(u,"class","button is-light"),i(o,"class","edit-controls svelte-329px1")},m(v,k){be(e,v,k),S(v,n,k),S(v,o,k),s(o,c),s(o,r),s(o,u),a=!0,d||(p=[te(c,"click",l[12]),te(u,"click",l[19])],d=!0)},p(v,k){const C={};k&2048&&(C.outputFormat=v[11]),!t&&k&2&&(t=!0,C.html=v[1].body,at(()=>t=!1)),e.$set(C)},i(v){a||(x(e.$$.fragment,v),a=!0)},o(v){oe(e.$$.fragment,v),a=!1},d(v){ke(e,v),v&&T(n),v&&T(o),d=!1,Qe(p)}}}function Jr(l){let e,t,n;return t=new Nl({props:{source:l[1].body}}),{c(){e=f("div"),ve(t.$$.fragment),i(e,"class","markdown-content svelte-329px1")},m(o,c){S(o,e,c),be(t,e,null),n=!0},p(o,c){const r={};c&2&&(r.source=o[1].body),t.$set(r)},i(o){n||(x(t.$$.fragment,o),n=!0)},o(o){oe(t.$$.fragment,o),n=!1},d(o){o&&T(e),ke(t)}}}function Vr(l){let e,t=l[1].body+"";return{c(){e=f("div"),i(e,"class","prose svelte-329px1")},m(n,o){S(n,e,o),e.innerHTML=t},p(n,o){o&2&&t!==(t=n[1].body+"")&&(e.innerHTML=t)},i:Ne,o:Ne,d(n){n&&T(e)}}}function Qr(l){let e,t,n,o,c,r=l[1].title+"",u,a,d,p,m,_,v,k=l[2]&&l[3]!==null&&Cn(l);const C=[Br,Gr],w=[];function b(y,g){return y[4]?0:1}return d=b(l),p=w[d]=C[d](l),{c(){e=f("div"),t=f("button"),n=h(),k&&k.c(),o=h(),c=f("h2"),u=W(r),a=h(),p.c(),i(t,"class","delete is-large modal-close-btn svelte-329px1"),i(t,"aria-label","close"),i(c,"class","svelte-329px1"),i(e,"class","box wrapper svelte-329px1")},m(y,g){S(y,e,g),s(e,t),s(e,n),k&&k.m(e,null),s(e,o),s(e,c),s(c,u),s(e,a),w[d].m(e,null),m=!0,_||(v=te(t,"click",l[17]),_=!0)},p(y,g){y[2]&&y[3]!==null?k?k.p(y,g):(k=Cn(y),k.c(),k.m(e,o)):k&&(k.d(1),k=null),(!m||g&2)&&r!==(r=y[1].title+"")&&we(u,r);let $=d;d=b(y),d===$?w[d].p(y,g):(tt(),oe(w[$],1,1,()=>{w[$]=null}),lt(),p=w[d],p?p.p(y,g):(p=w[d]=C[d](y),p.c()),x(p,1),p.m(e,null))},i(y){m||(x(p),m=!0)},o(y){oe(p),m=!1},d(y){y&&T(e),k&&k.d(),w[d].d(),_=!1,v()}}}function $n(l){let e,t,n;function o(r){l[23](r)}let c={$$slots:{default:[Xr]},$$scope:{ctx:l}};return l[7]!==void 0&&(c.active=l[7]),e=new Ml({props:c}),st.push(()=>it(e,"active",o)),{c(){ve(e.$$.fragment)},m(r,u){be(e,r,u),n=!0},p(r,u){const a={};u&536872832&&(a.$$scope={dirty:u,ctx:r}),!t&&u&128&&(t=!0,a.active=r[7],at(()=>t=!1)),e.$set(a)},i(r){n||(x(e.$$.fragment,r),n=!0)},o(r){oe(e.$$.fragment,r),n=!1},d(r){ke(e,r)}}}function Tn(l){let e,t,n,o,c,r,u,a,d,p,m;return{c(){e=f("div"),t=f("h3"),n=f("span"),n.textContent="Knowledge Graph",o=W(`
            Term: `),c=f("strong"),r=W(l[9]),u=W(" | Rank: "),a=f("strong"),d=W(l[10]),p=h(),m=f("hr"),i(n,"class","tag is-info svelte-329px1"),i(t,"class","subtitle is-6 svelte-329px1"),i(m,"class","svelte-329px1"),i(e,"class","kg-context svelte-329px1")},m(_,v){S(_,e,v),s(e,t),s(t,n),s(t,o),s(t,c),s(c,r),s(t,u),s(t,a),s(a,d),s(e,p),s(e,m)},p(_,v){v&512&&we(r,_[9]),v&1024&&we(d,_[10])},d(_){_&&T(e)}}}function Yr(l){let e,t,n;return t=new Nl({props:{source:l[8].body}}),{c(){e=f("div"),ve(t.$$.fragment),i(e,"class","markdown-content svelte-329px1")},m(o,c){S(o,e,c),be(t,e,null),n=!0},p(o,c){const r={};c&256&&(r.source=o[8].body),t.$set(r)},i(o){n||(x(t.$$.fragment,o),n=!0)},o(o){oe(t.$$.fragment,o),n=!1},d(o){o&&T(e),ke(t)}}}function Zr(l){let e,t=l[8].body+"";return{c(){e=f("div"),i(e,"class","prose svelte-329px1")},m(n,o){S(n,e,o),e.innerHTML=t},p(n,o){o&256&&t!==(t=n[8].body+"")&&(e.innerHTML=t)},i:Ne,o:Ne,d(n){n&&T(e)}}}function Xr(l){let e,t,n,o,c,r=l[8].title+"",u,a,d,p,m,_,v,k,C,w,b,y=l[9]&&l[10]!==null&&Tn(l);const g=[Zr,Yr],$=[];function z(M,N){return N&256&&(p=null),p==null&&(p=!!(M[8].body&&(/<html/i.test(M[8].body)||/<body/i.test(M[8].body)||/<head/i.test(M[8].body)))),p?0:1}return m=z(l,-1),_=$[m]=g[m](l),{c(){e=f("div"),t=f("button"),n=h(),y&&y.c(),o=h(),c=f("h2"),u=W(r),a=h(),d=f("div"),_.c(),v=h(),k=f("div"),k.innerHTML='<span class="hint-text svelte-329px1">Knowledge Graph document • Click KG links to explore further</span>',i(t,"class","delete is-large modal-close-btn svelte-329px1"),i(t,"aria-label","close"),i(c,"class","svelte-329px1"),i(k,"class","edit-hint svelte-329px1"),i(d,"class","content-viewer svelte-329px1"),i(d,"tabindex","0"),i(d,"role","button"),i(d,"aria-label","KG document content - click KG links to explore further"),i(e,"class","box wrapper svelte-329px1")},m(M,N){S(M,e,N),s(e,t),s(e,n),y&&y.m(e,null),s(e,o),s(e,c),s(c,u),s(e,a),s(e,d),$[m].m(d,null),s(d,v),s(d,k),C=!0,w||(b=[te(t,"click",l[22]),te(d,"click",l[13])],w=!0)},p(M,N){M[9]&&M[10]!==null?y?y.p(M,N):(y=Tn(M),y.c(),y.m(e,o)):y&&(y.d(1),y=null),(!C||N&256)&&r!==(r=M[8].title+"")&&we(u,r);let L=m;m=z(M,N),m===L?$[m].p(M,N):(tt(),oe($[L],1,1,()=>{$[L]=null}),lt(),_=$[m],_?_.p(M,N):(_=$[m]=g[m](M),_.c()),x(_,1),_.m(d,v))},i(M){C||(x(_),C=!0)},o(M){oe(_),C=!1},d(M){M&&T(e),y&&y.d(),$[m].d(),w=!1,Qe(b)}}}function xr(l){let e,t,n,o,c;function r(d){l[21](d)}let u={$$slots:{default:[Qr]},$$scope:{ctx:l}};l[0]!==void 0&&(u.active=l[0]),e=new Ml({props:u}),st.push(()=>it(e,"active",r));let a=l[8]&&$n(l);return{c(){ve(e.$$.fragment),n=h(),a&&a.c(),o=ct()},m(d,p){be(e,d,p),S(d,n,p),a&&a.m(d,p),S(d,o,p),c=!0},p(d,[p]){const m={};p&536873087&&(m.$$scope={dirty:p,ctx:d}),!t&&p&1&&(t=!0,m.active=d[0],at(()=>t=!1)),e.$set(m),d[8]?a?(a.p(d,p),p&256&&x(a,1)):(a=$n(d),a.c(),x(a,1),a.m(o.parentNode,o)):a&&(tt(),oe(a,1,1,()=>{a=null}),lt())},i(d){c||(x(e.$$.fragment,d),x(a),c=!0)},o(d){oe(e.$$.fragment,d),oe(a),c=!1},d(d){ke(e,d),d&&T(n),a&&a.d(d),d&&T(o)}}}function ei(l,e,t){let n,o,c,r;Ue(l,ot,A=>t(25,c=A)),Ue(l,Et,A=>t(26,r=A));let{active:u=!1}=e,{item:a}=e,{initialEdit:d=!1}=e,{kgTerm:p=null}=e,{kgRank:m=null}=e,_=!1,v,k=!1,C=null,w=null,b=null;async function y(){if(c)try{const A=await Fe("get_document",{documentId:a.id});A!=null&&A.document&&t(1,a=A.document)}catch(A){console.error("Failed to load document",A)}}async function g(){if(!c){t(4,_=!1);return}try{await Fe("create_document",{document:a}),t(4,_=!1)}catch(A){console.error("Failed to save document",A)}}async function $(A){var Y,Z,J,ee,P;t(9,w=A),console.log("🔍 KG Link Click Debug Info:"),console.log("  Term clicked:",A),console.log("  Current role:",r),console.log("  Is Tauri mode:",c);try{if(c){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:r,term:A});const I=await Fe("find_documents_for_kg_term",{roleName:r,term:A});console.log("  📥 Tauri response received:"),console.log("    Status:",I.status),console.log("    Results count:",((Y=I.results)==null?void 0:Y.length)||0),console.log("    Total:",I.total||0),console.log("    Full response:",JSON.stringify(I,null,2)),I.status==="success"&&I.results&&I.results.length>0?(t(8,C=I.results[0]),t(10,b=C.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",C.title),console.log("    Rank:",b),console.log("    Body length:",((Z=C.body)==null?void 0:Z.length)||0,"characters"),t(7,k=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${A}" in role: "${r}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const I=Ye.ServerURL,B=encodeURIComponent(r),F=encodeURIComponent(A),X=`${I}/roles/${B}/kg_search?term=${F}`;console.log("  📤 HTTP Request details:"),console.log("    Base URL:",I),console.log("    Role (encoded):",B),console.log("    Term (encoded):",F),console.log("    Full URL:",X);const re=await fetch(X);if(console.log("  📥 HTTP Response received:"),console.log("    Status code:",re.status),console.log("    Status text:",re.statusText),console.log("    Headers:",Object.fromEntries(re.headers.entries())),!re.ok)throw new Error(`HTTP error! Status: ${re.status} - ${re.statusText}`);const ie=await re.json();console.log("  📄 Response data:"),console.log("    Status:",ie.status),console.log("    Results count:",((J=ie.results)==null?void 0:J.length)||0),console.log("    Total:",ie.total||0),console.log("    Full response:",JSON.stringify(ie,null,2)),ie.status==="success"&&ie.results&&ie.results.length>0?(t(8,C=ie.results[0]),t(10,b=C.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",C.title),console.log("    Rank:",b),console.log("    Body length:",((ee=C.body)==null?void 0:ee.length)||0,"characters"),t(7,k=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${A}" in role: "${r}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",X))}}catch(I){console.error("❌ Error fetching KG document:"),console.error("  Error type:",I.constructor.name),console.error("  Error message:",I.message||I),console.error("  Request details:",{term:A,role:r,isTauri:c,timestamp:new Date().toISOString()}),!c&&((P=I.message)!=null&&P.includes("Failed to fetch"))&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{}}function z(A){const Y=A.target;if(Y.tagName==="A"){const Z=Y.getAttribute("href");if(Z&&Z.startsWith("kg:")){A.preventDefault();const J=Z.substring(3);$(J)}}}function M(){t(4,_=!0)}function N(A){A.type!=="dblclick"&&((A.ctrlKey||A.metaKey)&&A.key==="e"&&(A.preventDefault(),t(4,_=!0)),_&&(A.ctrlKey||A.metaKey)&&A.key==="s"&&(A.preventDefault(),g()),A.key==="Escape"&&(A.preventDefault(),_?t(4,_=!1):t(0,u=!1)))}const L=()=>t(0,u=!1);function q(A){l.$$.not_equal(a.body,A)&&(a.body=A,t(1,a))}const Q=()=>t(4,_=!1);function H(A){st[A?"unshift":"push"](()=>{v=A,t(6,v)})}function R(A){u=A,t(0,u)}const E=()=>t(7,k=!1);function K(A){k=A,t(7,k)}return l.$$set=A=>{"active"in A&&t(0,u=A.active),"item"in A&&t(1,a=A.item),"initialEdit"in A&&t(16,d=A.initialEdit),"kgTerm"in A&&t(2,p=A.kgTerm),"kgRank"in A&&t(3,m=A.kgRank)},l.$$.update=()=>{l.$$.dirty&65537&&u&&d&&t(4,_=!0),l.$$.dirty&19&&u&&a&&!_&&y(),l.$$.dirty&2&&t(5,n=a!=null&&a.body?/<html/i.test(a.body)||/<body/i.test(a.body)||/<head/i.test(a.body)||/^\s*<(!DOCTYPE|html|head|body|div|p|span)/i.test(a.body.trim()):!1),l.$$.dirty&32&&t(11,o=n?"html":"markdown")},[u,a,p,m,_,n,v,k,C,w,b,o,g,z,M,N,d,L,q,Q,H,R,E,K]}class ql extends mt{constructor(e){super(),_t(this,e,ei,xr,ut,{active:0,item:1,initialEdit:16,kgTerm:2,kgRank:3})}}function Sn(l,e,t){const n=l.slice();return n[33]=e[t],n}function Rn(l,e,t){const n=l.slice();return n[36]=e[t],n}function En(l,e,t){const n=l.slice();return n[39]=e[t],n}function Ln(l){let e,t;return e=new cs({props:{type:"is-success",$$slots:{default:[ti]},$$scope:{ctx:l}}}),{c(){ve(e.$$.fragment)},m(n,o){be(e,n,o),t=!0},i(n){t||(x(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){ke(e,n)}}}function ti(l){let e,t,n;return{c(){e=f("p"),e.innerHTML="<strong>Success!</strong> Article saved to atomic server successfully.",t=h(),n=f("p"),n.textContent="The modal will close automatically..."},m(o,c){S(o,e,c),S(o,t,c),S(o,n,c)},p:Ne,d(o){o&&T(e),o&&T(t),o&&T(n)}}}function An(l){let e,t;return e=new cs({props:{type:"is-danger",$$slots:{default:[li]},$$scope:{ctx:l}}}),{c(){ve(e.$$.fragment)},m(n,o){be(e,n,o),t=!0},p(n,o){const c={};o[0]&8|o[1]&2048&&(c.$$scope={dirty:o,ctx:n}),e.$set(c)},i(n){t||(x(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){ke(e,n)}}}function li(l){let e,t,n,o;return{c(){e=f("p"),t=f("strong"),t.textContent="Error:",n=h(),o=W(l[3])},m(c,r){S(c,e,r),s(e,t),s(e,n),s(e,o)},p(c,r){r[0]&8&&we(o,c[3])},d(c){c&&T(e)}}}function Pn(l){var K,A,Y,Z;let e,t,n,o,c,r=(((K=l[1])==null?void 0:K.title)||"Untitled")+"",u,a,d,p,m,_,v=(((A=l[1])==null?void 0:A.rank)||0)+"",k,C,w,b,y,g,$,z,M,N,L=((Y=l[1])==null?void 0:Y.description)&&On(l),q=((Z=l[1])==null?void 0:Z.tags)&&Mn(l);function Q(J,ee){return J[10].length>0?oi:ni}let H=Q(l),R=H(l),E=l[10].length>0&&In(l);return{c(){e=f("div"),t=f("label"),t.textContent="Document to Save",n=h(),o=f("div"),c=f("h5"),u=W(r),a=h(),L&&L.c(),d=h(),p=f("div"),m=f("span"),_=W("Rank: "),k=W(v),C=h(),q&&q.c(),w=h(),b=f("div"),y=f("label"),y.textContent="Atomic Server",g=h(),$=f("div"),R.c(),z=h(),E&&E.c(),M=ct(),i(t,"class","label"),i(c,"class","title is-6"),i(m,"class","tag is-info svelte-48g63o"),i(p,"class","tags svelte-48g63o"),i(o,"class","box document-preview svelte-48g63o"),i(e,"class","field"),i(y,"class","label"),i(y,"for","atomic-server-select"),i($,"class","control"),i(b,"class","field")},m(J,ee){S(J,e,ee),s(e,t),s(e,n),s(e,o),s(o,c),s(c,u),s(o,a),L&&L.m(o,null),s(o,d),s(o,p),s(p,m),s(m,_),s(m,k),s(p,C),q&&q.m(p,null),S(J,w,ee),S(J,b,ee),s(b,y),s(b,g),s(b,$),R.m($,null),S(J,z,ee),E&&E.m(J,ee),S(J,M,ee),N=!0},p(J,ee){var P,I,B,F;(!N||ee[0]&2)&&r!==(r=(((P=J[1])==null?void 0:P.title)||"Untitled")+"")&&we(u,r),(I=J[1])!=null&&I.description?L?L.p(J,ee):(L=On(J),L.c(),L.m(o,d)):L&&(L.d(1),L=null),(!N||ee[0]&2)&&v!==(v=(((B=J[1])==null?void 0:B.rank)||0)+"")&&we(k,v),(F=J[1])!=null&&F.tags?q?q.p(J,ee):(q=Mn(J),q.c(),q.m(p,null)):q&&(q.d(1),q=null),H===(H=Q(J))&&R?R.p(J,ee):(R.d(1),R=H(J),R&&(R.c(),R.m($,null))),J[10].length>0?E?(E.p(J,ee),ee[0]&1024&&x(E,1)):(E=In(J),E.c(),x(E,1),E.m(M.parentNode,M)):E&&(tt(),oe(E,1,1,()=>{E=null}),lt())},i(J){N||(x(E),N=!0)},o(J){oe(E),N=!1},d(J){J&&T(e),L&&L.d(),q&&q.d(),J&&T(w),J&&T(b),R.d(),J&&T(z),E&&E.d(J),J&&T(M)}}}function On(l){let e,t=l[1].description+"",n;return{c(){e=f("p"),n=W(t),i(e,"class","content")},m(o,c){S(o,e,c),s(e,n)},p(o,c){c[0]&2&&t!==(t=o[1].description+"")&&we(n,t)},d(o){o&&T(e)}}}function Mn(l){let e,t=l[1].tags,n=[];for(let o=0;o<t.length;o+=1)n[o]=Nn(En(l,t,o));return{c(){for(let o=0;o<n.length;o+=1)n[o].c();e=ct()},m(o,c){for(let r=0;r<n.length;r+=1)n[r]&&n[r].m(o,c);S(o,e,c)},p(o,c){if(c[0]&2){t=o[1].tags;let r;for(r=0;r<t.length;r+=1){const u=En(o,t,r);n[r]?n[r].p(u,c):(n[r]=Nn(u),n[r].c(),n[r].m(e.parentNode,e))}for(;r<n.length;r+=1)n[r].d(1);n.length=t.length}},d(o){Xe(n,o),o&&T(e)}}}function Nn(l){let e,t=l[39]+"",n;return{c(){e=f("span"),n=W(t),i(e,"class","tag svelte-48g63o")},m(o,c){S(o,e,c),s(e,n)},p(o,c){c[0]&2&&t!==(t=o[39]+"")&&we(n,t)},d(o){o&&T(e)}}}function ni(l){let e,t,n,o,c,r,u,a,d;return{c(){e=f("div"),t=f("p"),t.innerHTML="<strong>No atomic servers available</strong>",n=h(),o=f("p"),c=W('Your current role "'),r=W(l[12]),u=W(`" doesn't have any writable atomic server configurations.`),a=h(),d=f("p"),d.textContent="Please configure an atomic server haystack in your role settings.",i(e,"class","notification is-warning")},m(p,m){S(p,e,m),s(e,t),s(e,n),s(e,o),s(o,c),s(o,r),s(o,u),s(e,a),s(e,d)},p(p,m){m[0]&4096&&we(r,p[12])},d(p){p&&T(e)}}}function oi(l){let e,t,n,o,c,r,u=l[10],a=[];for(let d=0;d<u.length;d+=1)a[d]=Dn(Rn(l,u,d));return{c(){e=f("div"),t=f("select");for(let d=0;d<a.length;d+=1)a[d].c();n=h(),o=f("p"),o.textContent=`Select the atomic server from your current role configuration.
              🔐 = Authenticated, ⚠️ = Anonymous access`,i(t,"id","atomic-server-select"),t.disabled=l[2],l[11]===void 0&&rt(()=>l[18].call(t)),i(e,"class","select is-fullwidth"),i(o,"class","help svelte-48g63o")},m(d,p){S(d,e,p),s(e,t);for(let m=0;m<a.length;m+=1)a[m]&&a[m].m(t,null);qe(t,l[11],!0),S(d,n,p),S(d,o,p),c||(r=te(t,"change",l[18]),c=!0)},p(d,p){if(p[0]&1024){u=d[10];let m;for(m=0;m<u.length;m+=1){const _=Rn(d,u,m);a[m]?a[m].p(_,p):(a[m]=Dn(_),a[m].c(),a[m].m(t,null))}for(;m<a.length;m+=1)a[m].d(1);a.length=u.length}p[0]&4&&(t.disabled=d[2]),p[0]&3072&&qe(t,d[11])},d(d){d&&T(e),Xe(a,d),d&&T(n),d&&T(o),c=!1,r()}}}function si(l){let e;return{c(){e=f("span"),e.textContent="⚠️ No Auth",i(e,"class","has-text-warning")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function ri(l){let e;return{c(){e=f("span"),e.textContent="🔐",i(e,"class","has-text-success")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function Dn(l){let e,t=l[36].location+"",n,o,c,r;function u(p,m){return p[36].atomic_server_secret?ri:si}let a=u(l),d=a(l);return{c(){e=f("option"),n=W(t),o=h(),d.c(),c=h(),e.__value=r=l[36].location,e.value=e.__value},m(p,m){S(p,e,m),s(e,n),s(e,o),d.m(e,null),s(e,c)},p(p,m){m[0]&1024&&t!==(t=p[36].location+"")&&we(n,t),a!==(a=u(p))&&(d.d(1),d=a(p),d&&(d.c(),d.m(e,c))),m[0]&1024&&r!==(r=p[36].location)&&(e.__value=r,e.value=e.__value)},d(p){p&&T(e),d.d()}}}function In(l){var U,G;let e,t,n,o,c,r,u,a,d,p,m,_,v,k,C,w,b,y,g,$,z,M,N,L,q,Q,H,R,E,K,A,Y,Z,J,ee,P,I,B,F,X,re,ie,D,O=(l[8]||"Untitled")+"",V,ce,se,le,me,_e=(((G=(U=l[1])==null?void 0:U.body)==null?void 0:G.length)||0)+"",fe,de,pe,he,Se,Ge,je=l[14]()+"",Le,Re,ne,ye,Oe,Be=l[15]()+"",Ke,$e,Me,Ze,Je;function De(j){l[19](j)}let He={id:"article-title",placeholder:"Enter article title",disabled:l[2],required:!0};l[8]!==void 0&&(He.value=l[8]),c=new Vt({props:He}),st.push(()=>it(c,"value",De));const xe=[ai,ii],ue=[];function Ae(j,ae){return j[7]?1:0}return Q=Ae(l),H=ue[Q]=xe[Q](l),A=new Pl({props:{type:"is-primary",loading:l[2],disabled:l[2]||!l[8].trim()||!l[11],$$slots:{default:[ci]},$$scope:{ctx:l}}}),A.$on("click",l[16]),J=new Pl({props:{type:"is-light",disabled:l[2],$$slots:{default:[ui]},$$scope:{ctx:l}}}),J.$on("click",l[17]),Me=us(l[22][0]),{c(){e=f("div"),t=f("label"),t.textContent="Article Title",n=h(),o=f("div"),ve(c.$$.fragment),u=h(),a=f("div"),d=f("label"),d.textContent="Description",p=h(),m=f("div"),_=f("textarea"),v=h(),k=f("div"),C=f("label"),C.textContent="Parent Collection",w=h(),b=f("div"),y=f("label"),g=f("input"),$=W(`
              Use predefined collection`),z=h(),M=f("label"),N=f("input"),L=W(`
              Custom parent URL/path`),q=h(),H.c(),R=h(),E=f("div"),K=f("div"),ve(A.$$.fragment),Y=h(),Z=f("div"),ve(J.$$.fragment),ee=h(),P=f("div"),I=f("div"),B=f("p"),B.innerHTML="<strong>What will be saved:</strong>",F=h(),X=f("ul"),re=f("li"),ie=f("strong"),ie.textContent="Title:",D=h(),V=W(O),ce=h(),se=f("li"),le=f("strong"),le.textContent="Body:",me=W(" Original document content ("),fe=W(_e),de=W(" characters)"),pe=h(),he=f("li"),Se=f("strong"),Se.textContent="Parent:",Ge=h(),Le=W(je),Re=h(),ne=f("li"),ye=f("strong"),ye.textContent="Subject URL:",Oe=h(),Ke=W(Be),i(t,"class","label"),i(t,"for","article-title"),i(o,"class","control"),i(e,"class","field"),i(d,"class","label"),i(d,"for","article-description"),i(_,"id","article-description"),i(_,"class","textarea"),i(_,"placeholder","Brief description of the article"),_.disabled=l[2],i(_,"rows","3"),i(m,"class","control"),i(a,"class","field"),i(C,"class","label"),i(g,"type","radio"),g.__value=!1,g.value=g.__value,g.disabled=l[2],i(y,"class","radio svelte-48g63o"),i(N,"type","radio"),N.__value=!0,N.value=N.__value,N.disabled=l[2],i(M,"class","radio svelte-48g63o"),i(b,"class","control"),i(k,"class","field"),i(K,"class","control"),i(Z,"class","control"),i(E,"class","field is-grouped"),i(re,"class","svelte-48g63o"),i(se,"class","svelte-48g63o"),i(he,"class","svelte-48g63o"),i(ne,"class","svelte-48g63o"),i(X,"class","svelte-48g63o"),i(I,"class","notification is-info is-light svelte-48g63o"),i(P,"class","field"),Me.p(g,N)},m(j,ae){S(j,e,ae),s(e,t),s(e,n),s(e,o),be(c,o,null),S(j,u,ae),S(j,a,ae),s(a,d),s(a,p),s(a,m),s(m,_),Pe(_,l[9]),S(j,v,ae),S(j,k,ae),s(k,C),s(k,w),s(k,b),s(b,y),s(y,g),g.checked=g.__value===l[7],s(y,$),s(b,z),s(b,M),s(M,N),N.checked=N.__value===l[7],s(M,L),S(j,q,ae),ue[Q].m(j,ae),S(j,R,ae),S(j,E,ae),s(E,K),be(A,K,null),s(E,Y),s(E,Z),be(J,Z,null),S(j,ee,ae),S(j,P,ae),s(P,I),s(I,B),s(I,F),s(I,X),s(X,re),s(re,ie),s(re,D),s(re,V),s(X,ce),s(X,se),s(se,le),s(se,me),s(se,fe),s(se,de),s(X,pe),s(X,he),s(he,Se),s(he,Ge),s(he,Le),s(X,Re),s(X,ne),s(ne,ye),s(ne,Oe),s(ne,Ke),$e=!0,Ze||(Je=[te(_,"input",l[20]),te(g,"change",l[21]),te(N,"change",l[23])],Ze=!0)},p(j,ae){var ze,et;const Te={};ae[0]&4&&(Te.disabled=j[2]),!r&&ae[0]&256&&(r=!0,Te.value=j[8],at(()=>r=!1)),c.$set(Te),(!$e||ae[0]&4)&&(_.disabled=j[2]),ae[0]&512&&Pe(_,j[9]),(!$e||ae[0]&4)&&(g.disabled=j[2]),ae[0]&128&&(g.checked=g.__value===j[7]),(!$e||ae[0]&4)&&(N.disabled=j[2]),ae[0]&128&&(N.checked=N.__value===j[7]);let Ce=Q;Q=Ae(j),Q===Ce?ue[Q].p(j,ae):(tt(),oe(ue[Ce],1,1,()=>{ue[Ce]=null}),lt(),H=ue[Q],H?H.p(j,ae):(H=ue[Q]=xe[Q](j),H.c()),x(H,1),H.m(R.parentNode,R));const Ve={};ae[0]&4&&(Ve.loading=j[2]),ae[0]&2308&&(Ve.disabled=j[2]||!j[8].trim()||!j[11]),ae[1]&2048&&(Ve.$$scope={dirty:ae,ctx:j}),A.$set(Ve);const nt={};ae[0]&4&&(nt.disabled=j[2]),ae[1]&2048&&(nt.$$scope={dirty:ae,ctx:j}),J.$set(nt),(!$e||ae[0]&256)&&O!==(O=(j[8]||"Untitled")+"")&&we(V,O),(!$e||ae[0]&2)&&_e!==(_e=(((et=(ze=j[1])==null?void 0:ze.body)==null?void 0:et.length)||0)+"")&&we(fe,_e)},i(j){$e||(x(c.$$.fragment,j),x(H),x(A.$$.fragment,j),x(J.$$.fragment,j),$e=!0)},o(j){oe(c.$$.fragment,j),oe(H),oe(A.$$.fragment,j),oe(J.$$.fragment,j),$e=!1},d(j){j&&T(e),ke(c),j&&T(u),j&&T(a),j&&T(v),j&&T(k),j&&T(q),ue[Q].d(j),j&&T(R),j&&T(E),ke(A),ke(J),j&&T(ee),j&&T(P),Me.r(),Ze=!1,Qe(Je)}}}function ii(l){let e,t,n,o,c,r,u;function a(p){l[25](p)}let d={placeholder:"e.g., my-collection or http://server/custom-parent",disabled:l[2]};return l[6]!==void 0&&(d.value=l[6]),n=new Vt({props:d}),st.push(()=>it(n,"value",a)),{c(){e=f("div"),t=f("div"),ve(n.$$.fragment),c=h(),r=f("p"),r.textContent=`Enter a collection name (e.g., "my-articles") or full URL.
              If the collection doesn't exist, it will be created.`,i(t,"class","control"),i(r,"class","help svelte-48g63o"),i(e,"class","field")},m(p,m){S(p,e,m),s(e,t),be(n,t,null),s(e,c),s(e,r),u=!0},p(p,m){const _={};m[0]&4&&(_.disabled=p[2]),!o&&m[0]&64&&(o=!0,_.value=p[6],at(()=>o=!1)),n.$set(_)},i(p){u||(x(n.$$.fragment,p),u=!0)},o(p){oe(n.$$.fragment,p),u=!1},d(p){p&&T(e),ke(n)}}}function ai(l){let e,t,n,o,c,r,u=l[13],a=[];for(let d=0;d<u.length;d+=1)a[d]=Un(Sn(l,u,d));return{c(){e=f("div"),t=f("div"),n=f("div"),o=f("select");for(let d=0;d<a.length;d+=1)a[d].c();o.disabled=l[2],l[5]===void 0&&rt(()=>l[24].call(o)),i(n,"class","select is-fullwidth"),i(t,"class","control"),i(e,"class","field")},m(d,p){S(d,e,p),s(e,t),s(t,n),s(n,o);for(let m=0;m<a.length;m+=1)a[m]&&a[m].m(o,null);qe(o,l[5],!0),c||(r=te(o,"change",l[24]),c=!0)},p(d,p){if(p[0]&8192){u=d[13];let m;for(m=0;m<u.length;m+=1){const _=Sn(d,u,m);a[m]?a[m].p(_,p):(a[m]=Un(_),a[m].c(),a[m].m(o,null))}for(;m<a.length;m+=1)a[m].d(1);a.length=u.length}p[0]&4&&(o.disabled=d[2]),p[0]&8224&&qe(o,d[5])},i:Ne,o:Ne,d(d){d&&T(e),Xe(a,d),c=!1,r()}}}function Un(l){let e,t=l[33].label+"",n;return{c(){e=f("option"),n=W(t),e.__value=l[33].value,e.value=e.__value},m(o,c){S(o,e,c),s(e,n)},p:Ne,d(o){o&&T(e)}}}function ci(l){let e,t,n;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-cloud-upload-alt"></i>',t=h(),n=f("span"),n.textContent="Save to Atomic Server",i(e,"class","icon")},m(o,c){S(o,e,c),S(o,t,c),S(o,n,c)},p:Ne,d(o){o&&T(e),o&&T(t),o&&T(n)}}}function ui(l){let e;return{c(){e=W("Cancel")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function fi(l){let e,t,n,o,c,r,u,a,d,p,m,_,v,k=l[4]&&Ln(l),C=l[3]&&An(l),w=!l[4]&&Pn(l);return{c(){e=f("div"),t=f("div"),n=f("div"),n.innerHTML=`<div class="level-item"><h3 class="title is-4"><span class="icon"><i class="fas fa-save"></i></span>
            Save to Atomic Server</h3></div>`,o=h(),c=f("div"),r=f("div"),u=f("button"),a=h(),k&&k.c(),d=h(),C&&C.c(),p=h(),w&&w.c(),i(n,"class","level-left"),i(u,"class","delete is-large"),u.disabled=l[2],i(u,"aria-label","close"),i(r,"class","level-item"),i(c,"class","level-right"),i(t,"class","level svelte-48g63o"),i(e,"class","box")},m(b,y){S(b,e,y),s(e,t),s(t,n),s(t,o),s(t,c),s(c,r),s(r,u),s(e,a),k&&k.m(e,null),s(e,d),C&&C.m(e,null),s(e,p),w&&w.m(e,null),m=!0,_||(v=te(u,"click",l[17]),_=!0)},p(b,y){(!m||y[0]&4)&&(u.disabled=b[2]),b[4]?k?y[0]&16&&x(k,1):(k=Ln(b),k.c(),x(k,1),k.m(e,d)):k&&(tt(),oe(k,1,1,()=>{k=null}),lt()),b[3]?C?(C.p(b,y),y[0]&8&&x(C,1)):(C=An(b),C.c(),x(C,1),C.m(e,p)):C&&(tt(),oe(C,1,1,()=>{C=null}),lt()),b[4]?w&&(tt(),oe(w,1,1,()=>{w=null}),lt()):w?(w.p(b,y),y[0]&16&&x(w,1)):(w=Pn(b),w.c(),x(w,1),w.m(e,null))},i(b){m||(x(k),x(C),x(w),m=!0)},o(b){oe(k),oe(C),oe(w),m=!1},d(b){b&&T(e),k&&k.d(),C&&C.d(),w&&w.d(),_=!1,v()}}}function di(l){let e,t,n;function o(r){l[26](r)}let c={$$slots:{default:[fi]},$$scope:{ctx:l}};return l[0]!==void 0&&(c.active=l[0]),e=new Ml({props:c}),st.push(()=>it(e,"active",o)),e.$on("close",l[17]),{c(){ve(e.$$.fragment)},m(r,u){be(e,r,u),n=!0},p(r,u){const a={};u[0]&8190|u[1]&2048&&(a.$$scope={dirty:u,ctx:r}),!t&&u[0]&1&&(t=!0,a.active=r[0],at(()=>t=!1)),e.$set(a)},i(r){n||(x(e.$$.fragment,r),n=!0)},o(r){oe(e.$$.fragment,r),n=!1},d(r){ke(e,r)}}}function pi(l,e,t){let n,o,c;Ue(l,ot,P=>t(27,n=P)),Ue(l,Lt,P=>t(28,o=P)),Ue(l,Et,P=>t(12,c=P));let{active:r=!1}=e,{document:u}=e,a=!1,d=null,p=!1,m="",_="",v=!1,k="",C="",w=[],b="";const y=[{label:"Root (Server Root)",value:""},{label:"Articles Collection",value:"articles"},{label:"Documents Collection",value:"documents"},{label:"Knowledge Base",value:"knowledge-base"},{label:"Research",value:"research"},{label:"Projects",value:"projects"}];function g(){t(2,a=!1),t(3,d=null),t(4,p=!1),t(5,m=""),t(6,_=""),t(7,v=!1),t(8,k=(u==null?void 0:u.title)||""),t(9,C=(u==null?void 0:u.description)||`Article saved from Terraphim search: ${u==null?void 0:u.title}`),t(10,w=[]),t(11,b="")}function $(){var F;const P=c,I=o;if(!(I!=null&&I.roles)||!P){console.warn("No role configuration found");return}let B=null;try{for(const[X,re]of Object.entries(I.roles)){const ie=re,D=typeof ie.name=="object"?ie.name.original:String(ie.name);if(X===P||D===P){B=ie;break}}}catch(X){console.warn("Error checking role configuration:",X);return}if(!B){console.warn(`Role "${P}" not found in configuration`);return}t(10,w=((F=B.haystacks)==null?void 0:F.filter(X=>X.service==="Atomic"&&X.location&&!X.read_only))||[]),w.length>0&&t(11,b=w[0].location),console.log("Loaded atomic servers:",w)}function z(){const P=w.find(I=>I.location===b);return P==null?void 0:P.atomic_server_secret}function M(){const P=b.replace(/\/$/,"");if(v&&_.trim()){const I=_.trim();return I.startsWith("http://")||I.startsWith("https://")?I:`${P}/${I.replace(/^\//,"")}`}else return m?`${P}/${m}`:P}function N(){return k.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,50)}function L(){const P=b.replace(/\/$/,""),I=N(),B=Date.now();return`${P}/${I}-${B}`}async function q(){if(!b||!k.trim()){t(3,d="Please select an atomic server and provide a title");return}t(2,a=!0),t(3,d=null);try{const P=L(),I=M(),B=z();console.log("🔄 Saving article to atomic server:",{subject:P,parent:I,server:b,hasSecret:!!B});const F={subject:P,title:k.trim(),description:C.trim(),body:u.body,parent:I,shortname:N(),original_id:u.id,original_url:u.url,original_rank:u.rank,tags:u.tags||[]};if(n)await Fe("save_article_to_atomic",{article:F,serverUrl:b,atomicSecret:B});else{const X=await fetch(`${Ye.ServerURL}/atomic/save`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({article:F,server_url:b,atomic_secret:B})});if(!X.ok){const re=await X.json().catch(()=>({error:X.statusText}));throw new Error(re.error||`HTTP ${X.status}: ${X.statusText}`)}}t(4,p=!0),console.log("✅ Article saved successfully to atomic server"),setTimeout(()=>{t(0,r=!1)},2e3)}catch(P){console.error("❌ Failed to save article to atomic server:",P),t(3,d=P.message||"Failed to save article to atomic server")}finally{t(2,a=!1)}}function Q(){a||t(0,r=!1)}const H=[[]];function R(){b=Tt(this),t(11,b),t(10,w)}function E(P){k=P,t(8,k)}function K(){C=this.value,t(9,C)}function A(){v=this.__value,t(7,v)}function Y(){v=this.__value,t(7,v)}function Z(){m=Tt(this),t(5,m),t(13,y)}function J(P){_=P,t(6,_)}function ee(P){r=P,t(0,r)}return l.$$set=P=>{"active"in P&&t(0,r=P.active),"document"in P&&t(1,u=P.document)},l.$$.update=()=>{l.$$.dirty[0]&3&&r&&u&&(g(),$())},[r,u,a,d,p,m,_,v,k,C,w,b,c,y,M,L,q,Q,R,E,K,A,H,Y,Z,J,ee]}class mi extends mt{constructor(e){super(),_t(this,e,pi,di,ut,{active:0,document:1},null,[-1,-1])}}async function Kl(l){return Fe("tauri",l)}async function _i(l,e){return Kl({__tauriModule:"Event",message:{cmd:"unlisten",event:l,eventId:e}})}async function hi(l,e,t){return Kl({__tauriModule:"Event",message:{cmd:"listen",event:l,windowLabel:e,handler:Hl(t)}}).then(n=>async()=>_i(l,n))}var jn;(function(l){l.WINDOW_RESIZED="tauri://resize",l.WINDOW_MOVED="tauri://move",l.WINDOW_CLOSE_REQUESTED="tauri://close-requested",l.WINDOW_CREATED="tauri://window-created",l.WINDOW_DESTROYED="tauri://destroyed",l.WINDOW_FOCUS="tauri://focus",l.WINDOW_BLUR="tauri://blur",l.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",l.WINDOW_THEME_CHANGED="tauri://theme-changed",l.WINDOW_FILE_DROP="tauri://file-drop",l.WINDOW_FILE_DROP_HOVER="tauri://file-drop-hover",l.WINDOW_FILE_DROP_CANCELLED="tauri://file-drop-cancelled",l.MENU="tauri://menu",l.CHECK_UPDATE="tauri://update",l.UPDATE_AVAILABLE="tauri://update-available",l.INSTALL_UPDATE="tauri://update-install",l.STATUS_UPDATE="tauri://update-status",l.DOWNLOAD_PROGRESS="tauri://update-download-progress"})(jn||(jn={}));async function gi(l,e){return hi(l,null,e)}function Hn(l,e,t){const n=l.slice();return n[9]=e[t],n}function zn(l){let e,t=l[9].name+"",n,o;return{c(){e=f("option"),n=W(t),e.__value=o=l[9].name,e.value=e.__value},m(c,r){S(c,e,r),s(e,n)},p(c,r){r&1&&t!==(t=c[9].name+"")&&we(n,t),r&1&&o!==(o=c[9].name)&&(e.__value=o,e.value=e.__value)},d(c){c&&T(e)}}}function vi(l){let e,t,n,o,c,r,u=l[0],a=[];for(let d=0;d<u.length;d+=1)a[d]=zn(Hn(l,u,d));return{c(){e=f("div"),t=f("div"),n=f("div"),o=f("select");for(let d=0;d<a.length;d+=1)a[d].c();i(n,"class","select"),i(t,"class","control"),i(e,"class","field is-grouped is-grouped-right")},m(d,p){S(d,e,p),s(e,t),s(t,n),s(n,o);for(let m=0;m<a.length;m+=1)a[m]&&a[m].m(o,null);qe(o,l[1]),c||(r=te(o,"change",l[2]),c=!0)},p(d,[p]){if(p&1){u=d[0];let m;for(m=0;m<u.length;m+=1){const _=Hn(d,u,m);a[m]?a[m].p(_,p):(a[m]=zn(_),a[m].c(),a[m].m(o,null))}for(;m<a.length;m+=1)a[m].d(1);a.length=u.length}p&3&&qe(o,d[1])},i:Ne,o:Ne,d(d){d&&T(e),Xe(a,d),c=!1,r()}}}function bi(l,e,t){let n,o,c,r;Ue(l,Lt,_=>t(5,n=_)),Ue(l,ot,_=>t(6,o=_)),Ue(l,_n,_=>t(0,c=_)),Ue(l,Et,_=>t(1,r=_));let u="";async function a(){try{ot.set(window.__TAURI__!==void 0),o?(console.log("Loading config from Tauri"),Fe("get_config").then(_=>{console.log("get_config response",_),_&&_.status==="success"&&d(_.config)}).catch(_=>console.error("Error fetching config in Tauri:",_))):(console.log("Loading config from server"),u=`${Ye.ServerURL}/config/`,fetch(u).then(_=>_.json()).then(_=>{console.log("Config received",_),_&&_.status==="success"&&d(_.config)}).catch(_=>console.error("Error fetching config:",_)))}catch(_){console.error("Unhandled error in loadConfig:",_)}}function d(_){var w;console.log("Updating stores from config:",_);const v={default_role:_.selected_role,..._};Lt.set(v);const k=Object.entries(_.roles).map(([b,y])=>({name:b,...y}));_n.set(k),Et.set(_.selected_role);const C=_.roles[_.selected_role];if(console.log("Selected role settings:",C),C){const b=C.theme||"spacelab";console.log("Setting theme to:",b),ml.set(b),(w=C.kg)!=null&&w.publish?o?Fe("publish_thesaurus",{roleName:_.selected_role}).then(y=>{console.log("publish_thesaurus response",y),dl.set(y),$t.set(!0)}).catch(y=>{console.error("Error publishing thesaurus:",y),$t.set(!1)}):(console.log("Fetching thesaurus from HTTP endpoint for role",_.selected_role),fetch(`${Ye.ServerURL}/thesaurus/${encodeURIComponent(_.selected_role)}`).then(y=>y.json()).then(y=>{console.log("thesaurus HTTP response",y),y&&y.status==="success"&&y.thesaurus?(dl.set(y.thesaurus),$t.set(!0)):(console.error("Failed to fetch thesaurus:",y),$t.set(!1))}).catch(y=>{console.error("Error fetching thesaurus:",y),$t.set(!1)})):$t.set(!1)}else console.warn("No role settings found for:",_.selected_role),ml.set("spacelab")}typeof window<"u"&&window.__TAURI__&&gi("role_changed",_=>{console.log("Role changed event received from backend:",_.payload),d(_.payload)});async function p(){await a()}p(),console.log("Using Terraphim Server URL:",Ye.ServerURL);function m(_){var b,y;const k=_.currentTarget.value;console.log("Role change requested:",k),Et.set(k);const C=c.find(g=>g.name===k);if(!C){console.error(`No role settings found for role: ${k}.`);return}const w=C.theme||"spacelab";ml.set(w),console.log(`Theme changed to ${w}`),Lt.update(g=>(g.selected_role=k,g)),o?(Fe("select_role",{roleName:k}).catch(g=>console.error("Error selecting role:",g)),(b=C.kg)!=null&&b.publish?(console.log("Publishing thesaurus for role",k),Fe("publish_thesaurus",{roleName:k}).then(g=>{dl.set(g),$t.set(!0)})):$t.set(!1)):(fetch(`${Ye.ServerURL}/config/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).catch(g=>console.error("Error updating config on server:",g)),(y=C.kg)!=null&&y.publish?(console.log("Fetching thesaurus from HTTP endpoint for role",k),fetch(`${Ye.ServerURL}/thesaurus/${encodeURIComponent(k)}`).then(g=>g.json()).then(g=>{console.log("thesaurus HTTP response",g),g&&g.status==="success"&&g.thesaurus?(dl.set(g.thesaurus),$t.set(!0)):(console.error("Failed to fetch thesaurus:",g),$t.set(!1))}).catch(g=>{console.error("Error fetching thesaurus:",g),$t.set(!1)})):$t.set(!1))}return[c,r,m,a]}class Al extends mt{constructor(e){super(),_t(this,e,bi,vi,ut,{loadConfig:3})}get loadConfig(){return this.$$.ctx[3]}}function Fn(l,e,t){const n=l.slice();return n[41]=e[t],n}function qn(l,e,t){const n=l.slice();return n[44]=e[t],n}function Kn(l){let e,t;return e=new fs({props:{$$slots:{default:[wi]},$$scope:{ctx:l}}}),{c(){ve(e.$$.fragment)},m(n,o){be(e,n,o),t=!0},p(n,o){const c={};o[0]&129|o[1]&65536&&(c.$$scope={dirty:o,ctx:n}),e.$set(c)},i(n){t||(x(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){ke(e,n)}}}function ki(l){let e=l[44]+"",t;return{c(){t=W(e)},m(n,o){S(n,t,o)},p(n,o){o[0]&1&&e!==(e=n[44]+"")&&we(t,e)},d(n){n&&T(t)}}}function Wn(l){let e,t,n,o,c,r;t=new ds({props:{rounded:!0,$$slots:{default:[ki]},$$scope:{ctx:l}}});function u(){return l[19](l[44])}return{c(){e=f("button"),ve(t.$$.fragment),n=h(),i(e,"class","tag-button svelte-2smypa"),e.disabled=l[7],i(e,"title","Click to view knowledge graph document")},m(a,d){S(a,e,d),be(t,e,null),s(e,n),o=!0,c||(r=te(e,"click",u),c=!0)},p(a,d){l=a;const p={};d[0]&1|d[1]&65536&&(p.$$scope={dirty:d,ctx:l}),t.$set(p),(!o||d[0]&128)&&(e.disabled=l[7])},i(a){o||(x(t.$$.fragment,a),o=!0)},o(a){oe(t.$$.fragment,a),o=!1},d(a){a&&T(e),ke(t),c=!1,r()}}}function wi(l){let e,t,n=l[0].tags,o=[];for(let r=0;r<n.length;r+=1)o[r]=Wn(qn(l,n,r));const c=r=>oe(o[r],1,1,()=>{o[r]=null});return{c(){for(let r=0;r<o.length;r+=1)o[r].c();e=ct()},m(r,u){for(let a=0;a<o.length;a+=1)o[a]&&o[a].m(r,u);S(r,e,u),t=!0},p(r,u){if(u[0]&131201){n=r[0].tags;let a;for(a=0;a<n.length;a+=1){const d=qn(r,n,a);o[a]?(o[a].p(d,u),x(o[a],1)):(o[a]=Wn(d),o[a].c(),x(o[a],1),o[a].m(e.parentNode,e))}for(tt(),a=n.length;a<o.length;a+=1)c(a);lt()}},i(r){if(!t){for(let u=0;u<n.length;u+=1)x(o[u]);t=!0}},o(r){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)oe(o[u]);t=!1},d(r){Xe(o,r),r&&T(e)}}}function yi(l){let e,t=(l[0].rank||0)+"",n;return{c(){e=W("Rank "),n=W(t)},m(o,c){S(o,e,c),S(o,n,c)},p(o,c){c[0]&1&&t!==(t=(o[0].rank||0)+"")&&we(n,t)},d(o){o&&T(e),o&&T(n)}}}function Ci(l){let e,t;return e=new ds({props:{rounded:!0,$$slots:{default:[yi]},$$scope:{ctx:l}}}),{c(){ve(e.$$.fragment)},m(n,o){be(e,n,o),t=!0},p(n,o){const c={};o[0]&1|o[1]&65536&&(c.$$scope={dirty:o,ctx:n}),e.$set(c)},i(n){t||(x(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){ke(e,n)}}}function $i(l){let e;return{c(){e=f("small"),e.textContent="No description available",i(e,"class","no-description svelte-2smypa")},m(t,n){S(t,e,n)},p:Ne,i:Ne,o:Ne,d(t){t&&T(e)}}}function Ti(l){let e,t;return e=new Nl({props:{source:l[0].description}}),{c(){ve(e.$$.fragment)},m(n,o){be(e,n,o),t=!0},p(n,o){const c={};o[0]&1&&(c.source=n[0].description),e.$set(c)},i(n){t||(x(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){ke(e,n)}}}function Gn(l){let e,t,n,o,c,r;return{c(){e=f("button"),t=f("span"),t.innerHTML='<i class="fas fa-magic" aria-hidden="true"></i>',n=h(),o=f("span"),o.textContent="AI Summary",i(t,"class","icon is-small"),i(e,"class","button is-small is-info is-outlined ai-summary-button svelte-2smypa"),e.disabled=l[9],i(e,"title","Generate AI-powered summary using OpenRouter")},m(u,a){S(u,e,a),s(e,t),s(e,n),s(e,o),c||(r=te(e,"click",l[18]),c=!0)},p(u,a){a[0]&512&&(e.disabled=u[9])},d(u){u&&T(e),c=!1,r()}}}function Bn(l){let e;return{c(){e=f("div"),e.innerHTML=`<span class="icon"><i class="fas fa-spinner fa-spin" aria-hidden="true"></i></span>
                <small>Generating AI summary...</small>`,i(e,"class","ai-summary-loading svelte-2smypa")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function Jn(l){let e,t,n,o,c,r,u,a,d,p;return{c(){e=f("div"),t=f("span"),t.innerHTML='<i class="fas fa-exclamation-triangle" aria-hidden="true"></i>',n=h(),o=f("small"),c=W("Summary error: "),r=W(l[10]),u=h(),a=f("button"),a.textContent="Retry",i(t,"class","icon has-text-danger"),i(o,"class","has-text-danger"),i(a,"class","button is-small is-text svelte-2smypa"),i(a,"title","Retry generating summary"),i(e,"class","ai-summary-error svelte-2smypa")},m(m,_){S(m,e,_),s(e,t),s(e,n),s(e,o),s(o,c),s(o,r),s(e,u),s(e,a),d||(p=te(a,"click",l[20]),d=!0)},p(m,_){_[0]&1024&&we(r,m[10])},d(m){m&&T(e),d=!1,p()}}}function Vn(l){let e,t,n,o,c,r,u,a,d,p,m,_,v,k,C,w,b,y,g,$;function z(L,q){return L[12]?Ri:Si}let M=z(l),N=M(l);return p=new Nl({props:{source:l[8]}}),{c(){e=f("div"),t=f("div"),n=f("small"),o=f("span"),o.innerHTML='<i class="fas fa-robot" aria-hidden="true"></i>',c=W(`
                    AI Summary
                    `),N.c(),r=h(),u=f("button"),u.innerHTML='<span class="icon is-small"><i class="fas fa-times" aria-hidden="true"></i></span>',a=h(),d=f("div"),ve(p.$$.fragment),m=h(),_=f("div"),v=f("button"),k=f("span"),k.innerHTML='<i class="fas fa-redo" aria-hidden="true"></i>',C=h(),w=f("span"),w.textContent="Regenerate",i(o,"class","icon is-small"),i(n,"class","ai-summary-label svelte-2smypa"),i(u,"class","button is-small is-text svelte-2smypa"),i(u,"title","Hide AI summary"),i(t,"class","ai-summary-header svelte-2smypa"),i(d,"class","ai-summary-content svelte-2smypa"),i(k,"class","icon is-small"),i(v,"class","button is-small is-text svelte-2smypa"),v.disabled=l[9],i(v,"title","Regenerate summary"),i(_,"class","ai-summary-actions svelte-2smypa"),i(e,"class","ai-summary svelte-2smypa")},m(L,q){S(L,e,q),s(e,t),s(t,n),s(n,o),s(n,c),N.m(n,null),s(t,r),s(t,u),s(e,a),s(e,d),be(p,d,null),s(e,m),s(e,_),s(_,v),s(v,k),s(v,C),s(v,w),y=!0,g||($=[te(u,"click",l[21]),te(v,"click",l[22])],g=!0)},p(L,q){M!==(M=z(L))&&(N.d(1),N=M(L),N&&(N.c(),N.m(n,null)));const Q={};q[0]&256&&(Q.source=L[8]),p.$set(Q),(!y||q[0]&512)&&(v.disabled=L[9])},i(L){y||(x(p.$$.fragment,L),rt(()=>{y&&(b||(b=sl(e,rl,{},!0)),b.run(1))}),y=!0)},o(L){oe(p.$$.fragment,L),b||(b=sl(e,rl,{},!1)),b.run(0),y=!1},d(L){L&&T(e),N.d(),ke(p),L&&b&&b.end(),g=!1,Qe($)}}}function Si(l){let e;return{c(){e=f("span"),e.textContent="fresh",i(e,"class","tag is-small is-success")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function Ri(l){let e;return{c(){e=f("span"),e.textContent="cached",i(e,"class","tag is-small is-light")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function Qn(l){let e;function t(c,r){return c[41].disabled?Ai:c[41].isLink?Li:Ei}let n=t(l),o=n(l);return{c(){o.c(),e=ct()},m(c,r){o.m(c,r),S(c,e,r)},p(c,r){n===(n=t(c))&&o?o.p(c,r):(o.d(1),o=n(c),o&&(o.c(),o.m(e.parentNode,e)))},d(c){o.d(c),c&&T(e)}}}function Ei(l){let e,t,n,o,c,r,u,a,d,p;return{c(){var m,_,v;e=f("button"),t=f("span"),n=f("i"),c=h(),i(n,"class",o=Nt(l[41].icon)+" svelte-2smypa"),i(t,"class","icon is-medium"),bt(t,"has-text-primary",(m=l[41].className)==null?void 0:m.includes("primary")),bt(t,"has-text-success",(_=l[41].className)==null?void 0:_.includes("success")),bt(t,"has-text-danger",(v=l[41].className)==null?void 0:v.includes("danger")),i(e,"type","button"),i(e,"class","level-item button is-ghost svelte-2smypa"),i(e,"aria-label",r=l[41].title),i(e,"title",u=l[41].title),i(e,"data-testid",a=l[41].testId||"")},m(m,_){S(m,e,_),s(e,t),s(t,n),s(e,c),d||(p=te(e,"click",function(){Fl(l[41].action)&&l[41].action.apply(this,arguments)}),d=!0)},p(m,_){var v,k,C;l=m,_[0]&32768&&o!==(o=Nt(l[41].icon)+" svelte-2smypa")&&i(n,"class",o),_[0]&32768&&bt(t,"has-text-primary",(v=l[41].className)==null?void 0:v.includes("primary")),_[0]&32768&&bt(t,"has-text-success",(k=l[41].className)==null?void 0:k.includes("success")),_[0]&32768&&bt(t,"has-text-danger",(C=l[41].className)==null?void 0:C.includes("danger")),_[0]&32768&&r!==(r=l[41].title)&&i(e,"aria-label",r),_[0]&32768&&u!==(u=l[41].title)&&i(e,"title",u),_[0]&32768&&a!==(a=l[41].testId||"")&&i(e,"data-testid",a)},d(m){m&&T(e),d=!1,p()}}}function Li(l){let e,t,n,o,c,r,u,a;return{c(){e=f("a"),t=f("span"),n=f("i"),c=h(),i(n,"class",o=Nt(l[41].icon)+" svelte-2smypa"),i(t,"class","icon is-medium"),bt(t,"has-text-primary",l[41].className),i(e,"href",r=l[41].href),i(e,"target","_blank"),i(e,"class","level-item"),i(e,"aria-label",u=l[41].title),i(e,"title",a=l[41].title)},m(d,p){S(d,e,p),s(e,t),s(t,n),s(e,c)},p(d,p){p[0]&32768&&o!==(o=Nt(d[41].icon)+" svelte-2smypa")&&i(n,"class",o),p[0]&32768&&bt(t,"has-text-primary",d[41].className),p[0]&32768&&r!==(r=d[41].href)&&i(e,"href",r),p[0]&32768&&u!==(u=d[41].title)&&i(e,"aria-label",u),p[0]&32768&&a!==(a=d[41].title)&&i(e,"title",a)},d(d){d&&T(e)}}}function Ai(l){let e,t,n,o,c,r,u;return{c(){e=f("button"),t=f("span"),n=f("i"),c=h(),i(n,"class",o=Nt(l[41].icon)+" svelte-2smypa"),i(t,"class","icon is-medium"),bt(t,"has-text-primary",l[41].className),i(e,"type","button"),i(e,"class","level-item button is-ghost svelte-2smypa"),i(e,"aria-label",r=l[41].title),i(e,"title",u=l[41].title),e.disabled=!0},m(a,d){S(a,e,d),s(e,t),s(t,n),s(e,c)},p(a,d){d[0]&32768&&o!==(o=Nt(a[41].icon)+" svelte-2smypa")&&i(n,"class",o),d[0]&32768&&bt(t,"has-text-primary",a[41].className),d[0]&32768&&r!==(r=a[41].title)&&i(e,"aria-label",r),d[0]&32768&&u!==(u=a[41].title)&&i(e,"title",u)},d(a){a&&T(e)}}}function Yn(l){let e,t=l[41].visible&&Qn(l);return{c(){t&&t.c(),e=ct()},m(n,o){t&&t.m(n,o),S(n,e,o)},p(n,o){n[41].visible?t?t.p(n,o):(t=Qn(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(n){t&&t.d(n),n&&T(e)}}}function Zn(l){let e,t,n,o,c,r;return{c(){e=f("div"),t=f("button"),n=h(),o=W(l[13]),i(t,"class","delete svelte-2smypa"),i(e,"class","notification is-danger is-light mt-2")},m(u,a){S(u,e,a),s(e,t),s(e,n),s(e,o),c||(r=te(t,"click",l[23]),c=!0)},p(u,a){a[0]&8192&&we(o,u[13])},d(u){u&&T(e),c=!1,r()}}}function Xn(l){let e,t,n;function o(r){l[25](r)}let c={item:l[4],kgTerm:l[5],kgRank:l[6]};return l[2]!==void 0&&(c.active=l[2]),e=new ql({props:c}),st.push(()=>it(e,"active",o)),{c(){ve(e.$$.fragment)},m(r,u){be(e,r,u),n=!0},p(r,u){const a={};u[0]&16&&(a.item=r[4]),u[0]&32&&(a.kgTerm=r[5]),u[0]&64&&(a.kgRank=r[6]),!t&&u[0]&4&&(t=!0,a.active=r[2],at(()=>t=!1)),e.$set(a)},i(r){n||(x(e.$$.fragment,r),n=!0)},o(r){oe(e.$$.fragment,r),n=!1},d(r){ke(e,r)}}}function xn(l){let e,t,n;function o(r){l[26](r)}let c={document:l[0]};return l[3]!==void 0&&(c.active=l[3]),e=new mi({props:c}),st.push(()=>it(e,"active",o)),{c(){ve(e.$$.fragment)},m(r,u){be(e,r,u),n=!0},p(r,u){const a={};u[0]&1&&(a.document=r[0]),!t&&u[0]&8&&(t=!0,a.active=r[3],at(()=>t=!1)),e.$set(a)},i(r){n||(x(e.$$.fragment,r),n=!0)},o(r){oe(e.$$.fragment,r),n=!1},d(r){ke(e,r)}}}function Pi(l){let e,t,n,o,c,r,u,a,d,p,m,_,v=l[0].title+"",k,C,w,b,y,g,$,z,M,N,L,q,Q,H,R,E,K,A,Y,Z,J,ee,P,I,B,F,X,re,ie,D,O,V=l[0].tags&&Kn(l);a=new fs({props:{$$slots:{default:[Ci]},$$scope:{ctx:l}}});const ce=[Ti,$i],se=[];function le(ne,ye){return ne[0].description?0:1}$=le(l),z=se[$]=ce[$](l);let me=!l[11]&&!l[9]&&!l[10]&&Gn(l),_e=l[9]&&Bn(),fe=l[10]&&Jn(l),de=l[11]&&l[8]&&Vn(l),pe=l[15],he=[];for(let ne=0;ne<pe.length;ne+=1)he[ne]=Yn(Fn(l,pe,ne));let Se=l[13]&&Zn(l);function Ge(ne){l[24](ne)}let je={item:l[0]};l[1]!==void 0&&(je.active=l[1]),I=new ql({props:je}),st.push(()=>it(I,"active",Ge));let Le=l[4]&&Xn(l),Re=l[14]&&xn(l);return{c(){e=f("div"),t=f("article"),n=f("div"),o=f("div"),c=f("div"),V&&V.c(),r=h(),u=f("div"),ve(a.$$.fragment),d=h(),p=f("div"),m=f("button"),_=f("h2"),k=W(v),C=h(),w=f("div"),b=f("small"),b.textContent="Description:",y=h(),g=f("div"),z.c(),M=h(),N=f("div"),me&&me.c(),L=h(),_e&&_e.c(),q=h(),fe&&fe.c(),Q=h(),de&&de.c(),H=h(),R=f("br"),K=h(),A=f("div"),Y=f("nav"),Z=f("div");for(let ne=0;ne<he.length;ne+=1)he[ne].c();ee=h(),Se&&Se.c(),P=h(),ve(I.$$.fragment),F=h(),Le&&Le.c(),X=h(),Re&&Re.c(),re=ct(),i(c,"class","level-right"),i(u,"class","level-right"),i(_,"class","title svelte-2smypa"),i(m,"class","svelte-2smypa"),i(b,"class","description-label svelte-2smypa"),i(g,"class","description-content svelte-2smypa"),i(w,"class","description svelte-2smypa"),i(N,"class","ai-summary-section svelte-2smypa"),i(o,"class","content"),i(Z,"class","level-right"),i(Y,"class","level is-mobile"),i(A,"class","level-right"),i(n,"class","media-content"),i(t,"class","media"),i(e,"class","box")},m(ne,ye){S(ne,e,ye),s(e,t),s(t,n),s(n,o),s(o,c),V&&V.m(c,null),s(o,r),s(o,u),be(a,u,null),s(o,d),s(o,p),s(p,m),s(m,_),s(_,k),s(p,C),s(p,w),s(w,b),s(w,y),s(w,g),se[$].m(g,null),s(p,M),s(p,N),me&&me.m(N,null),s(N,L),_e&&_e.m(N,null),s(N,q),fe&&fe.m(N,null),s(N,Q),de&&de.m(N,null),s(p,H),s(p,R),s(n,K),s(n,A),s(A,Y),s(Y,Z);for(let Oe=0;Oe<he.length;Oe+=1)he[Oe]&&he[Oe].m(Z,null);s(e,ee),Se&&Se.m(e,null),S(ne,P,ye),be(I,ne,ye),S(ne,F,ye),Le&&Le.m(ne,ye),S(ne,X,ye),Re&&Re.m(ne,ye),S(ne,re,ye),ie=!0,D||(O=te(m,"click",l[16]),D=!0)},p(ne,ye){ne[0].tags?V?(V.p(ne,ye),ye[0]&1&&x(V,1)):(V=Kn(ne),V.c(),x(V,1),V.m(c,null)):V&&(tt(),oe(V,1,1,()=>{V=null}),lt());const Oe={};ye[0]&1|ye[1]&65536&&(Oe.$$scope={dirty:ye,ctx:ne}),a.$set(Oe),(!ie||ye[0]&1)&&v!==(v=ne[0].title+"")&&we(k,v);let Be=$;if($=le(ne),$===Be?se[$].p(ne,ye):(tt(),oe(se[Be],1,1,()=>{se[Be]=null}),lt(),z=se[$],z?z.p(ne,ye):(z=se[$]=ce[$](ne),z.c()),x(z,1),z.m(g,null)),!ne[11]&&!ne[9]&&!ne[10]?me?me.p(ne,ye):(me=Gn(ne),me.c(),me.m(N,L)):me&&(me.d(1),me=null),ne[9]?_e||(_e=Bn(),_e.c(),_e.m(N,q)):_e&&(_e.d(1),_e=null),ne[10]?fe?fe.p(ne,ye):(fe=Jn(ne),fe.c(),fe.m(N,Q)):fe&&(fe.d(1),fe=null),ne[11]&&ne[8]?de?(de.p(ne,ye),ye[0]&2304&&x(de,1)):(de=Vn(ne),de.c(),x(de,1),de.m(N,null)):de&&(tt(),oe(de,1,1,()=>{de=null}),lt()),ye[0]&32768){pe=ne[15];let $e;for($e=0;$e<pe.length;$e+=1){const Me=Fn(ne,pe,$e);he[$e]?he[$e].p(Me,ye):(he[$e]=Yn(Me),he[$e].c(),he[$e].m(Z,null))}for(;$e<he.length;$e+=1)he[$e].d(1);he.length=pe.length}ne[13]?Se?Se.p(ne,ye):(Se=Zn(ne),Se.c(),Se.m(e,null)):Se&&(Se.d(1),Se=null);const Ke={};ye[0]&1&&(Ke.item=ne[0]),!B&&ye[0]&2&&(B=!0,Ke.active=ne[1],at(()=>B=!1)),I.$set(Ke),ne[4]?Le?(Le.p(ne,ye),ye[0]&16&&x(Le,1)):(Le=Xn(ne),Le.c(),x(Le,1),Le.m(X.parentNode,X)):Le&&(tt(),oe(Le,1,1,()=>{Le=null}),lt()),ne[14]?Re?(Re.p(ne,ye),ye[0]&16384&&x(Re,1)):(Re=xn(ne),Re.c(),x(Re,1),Re.m(re.parentNode,re)):Re&&(tt(),oe(Re,1,1,()=>{Re=null}),lt())},i(ne){ie||(x(V),x(a.$$.fragment,ne),x(z),x(de),rt(()=>{ie&&(E||(E=sl(p,rl,{},!0)),E.run(1))}),rt(()=>{ie&&(J||(J=sl(Y,rl,{},!0)),J.run(1))}),x(I.$$.fragment,ne),x(Le),x(Re),ie=!0)},o(ne){oe(V),oe(a.$$.fragment,ne),oe(z),oe(de),E||(E=sl(p,rl,{},!1)),E.run(0),J||(J=sl(Y,rl,{},!1)),J.run(0),oe(I.$$.fragment,ne),oe(Le),oe(Re),ie=!1},d(ne){ne&&T(e),V&&V.d(),ke(a),se[$].d(),me&&me.d(),_e&&_e.d(),fe&&fe.d(),de&&de.d(),ne&&E&&E.end(),Xe(he,ne),ne&&J&&J.end(),Se&&Se.d(),ne&&T(P),ke(I,ne),ne&&T(F),Le&&Le.d(ne),ne&&T(X),Re&&Re.d(ne),ne&&T(re),D=!1,O()}}}function Oi(l,e,t){let n,o,c,r,u;Ue(l,Et,O=>t(31,c=O)),Ue(l,ot,O=>t(32,r=O)),Ue(l,Lt,O=>t(33,u=O));let{document:a}=e,d=!1,p=!1,m=!1,_=null,v=null,k=null,C=!1,w=null,b=!1,y=null,g=!1,$=!1,z=!1,M=!1,N=null,L=!1,q=!1;function Q(){const O=[];return O.push({id:"download-markdown",label:"Download to Markdown",icon:"fas fa-download",action:()=>Y(),visible:!0,title:"Download document as markdown file"}),n&&O.push({id:"save-atomic",label:"Save to Atomic Server",icon:"fas fa-cloud-upload-alt",action:()=>E(),visible:!0,title:"Save article to Atomic Server",className:"has-text-primary"}),a.url&&O.push({id:"external-url",label:"Open URL",icon:"fas fa-link",action:()=>window.open(a.url,"_blank"),visible:!0,title:"Open original URL in new tab",isLink:!0,href:a.url}),O.push({id:"open-vscode",label:"Open in VSCode",icon:"fas fa-code",action:()=>Z(),visible:!0,title:"Open document in VSCode",isLink:!0,href:`vscode://${encodeURIComponent(a.title)}.md?${encodeURIComponent(a.body)}`}),O.push({id:"add-context",label:M?"Added to Context ✓":z?"Adding...":"Add to Context",icon:M?"fas fa-check-circle":z?"fas fa-spinner fa-spin":"fas fa-plus-circle",action:()=>J(),visible:!0,title:M?"Document successfully added to chat context. Go to Chat tab to see it.":"Add document to LLM conversation context",disabled:z||M,className:M?"has-text-success":N?"has-text-danger":"",testId:"add-to-context-button"}),O.push({id:"chat-with-document",label:q?"Opening Chat...":L?"Adding to Chat...":"Chat with Document",icon:q?"fas fa-external-link-alt":L?"fas fa-spinner fa-spin":"fas fa-comment-dots",action:()=>ee(),visible:!0,title:q?"Opening chat with this document":"Add document to context and open chat",disabled:L||q||z,className:q?"has-text-info":N?"has-text-danger":"has-text-primary",testId:"chat-with-document-button"}),O}function H(){var le;const O=c,V=u;if(!(V!=null&&V.roles)||!O)return!1;let ce=null;try{for(const[me,_e]of Object.entries(V.roles)){const fe=_e,de=typeof fe.name=="object"?fe.name.original:String(fe.name);if(me===O||de===O){ce=fe;break}}}catch(me){return console.warn("Error checking role configuration:",me),!1}return ce?(((le=ce.haystacks)==null?void 0:le.filter(me=>me.service==="Atomic"&&me.location&&!me.read_only))||[]).length>0:!1}const R=()=>{t(1,d=!0)},E=()=>{console.log("🔄 Opening atomic save modal for document:",a.title),t(3,m=!0)};async function K(O){var V,ce,se,le,me;t(7,C=!0),t(5,v=O),console.log("🔍 KG Search Debug Info:"),console.log("  Tag clicked:",O),console.log("  Current role:",c),console.log("  Is Tauri mode:",r);try{if(r){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:c,term:O});const _e=await Fe("find_documents_for_kg_term",{roleName:c,term:O});console.log("  📥 Tauri response received:"),console.log("    Status:",_e.status),console.log("    Results count:",((V=_e.results)==null?void 0:V.length)||0),console.log("    Total:",_e.total||0),console.log("    Full response:",JSON.stringify(_e,null,2)),_e.status==="success"&&_e.results&&_e.results.length>0?(t(4,_=_e.results[0]),t(6,k=_.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",_.title),console.log("    Rank:",k),console.log("    Body length:",((ce=_.body)==null?void 0:ce.length)||0,"characters"),t(2,p=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${O}" in role: "${c}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const _e=Ye.ServerURL,fe=encodeURIComponent(c),de=encodeURIComponent(O),pe=`${_e}/roles/${fe}/kg_search?term=${de}`;console.log("  📤 HTTP Request details:"),console.log("    Base URL:",_e),console.log("    Role (encoded):",fe),console.log("    Term (encoded):",de),console.log("    Full URL:",pe);const he=await fetch(pe);if(console.log("  📥 HTTP Response received:"),console.log("    Status code:",he.status),console.log("    Status text:",he.statusText),console.log("    Headers:",Object.fromEntries(he.headers.entries())),!he.ok)throw new Error(`HTTP error! Status: ${he.status} - ${he.statusText}`);const Se=await he.json();console.log("  📄 Response data:"),console.log("    Status:",Se.status),console.log("    Results count:",((se=Se.results)==null?void 0:se.length)||0),console.log("    Total:",Se.total||0),console.log("    Full response:",JSON.stringify(Se,null,2)),Se.status==="success"&&Se.results&&Se.results.length>0?(t(4,_=Se.results[0]),t(6,k=_.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",_.title),console.log("    Rank:",k),console.log("    Body length:",((le=_.body)==null?void 0:le.length)||0,"characters"),t(2,p=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${O}" in role: "${c}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",pe))}}catch(_e){console.error("❌ Error fetching KG document:"),console.error("  Error type:",_e.constructor.name),console.error("  Error message:",_e.message||_e),console.error("  Request details:",{tag:O,role:c,isTauri:r,timestamp:new Date().toISOString()}),!r&&((me=_e.message)!=null&&me.includes("Failed to fetch"))&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{t(7,C=!1)}}async function A(){var O;if(!(b||!a.id||!c)){t(9,b=!0),t(10,y=null),console.log("🤖 AI Summary Debug Info:"),console.log("  Document ID:",a.id),console.log("  Current role:",c),console.log("  Is Tauri mode:",r);try{const V={document_id:a.id,role:c,max_length:250,force_regenerate:!1};console.log("  📤 Summarization request:",V);let ce;if(r){const me=`${Ye.ServerURL}/documents/summarize`;ce=await fetch(me,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(V)})}else{const me=`${Ye.ServerURL}/documents/summarize`;ce=await fetch(me,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(V)})}if(console.log("  📥 Summary response received:"),console.log("    Status code:",ce.status),console.log("    Status text:",ce.statusText),!ce.ok)throw new Error(`HTTP error! Status: ${ce.status} - ${ce.statusText}`);const se=await ce.json();console.log("  📄 Summary response data:",se),se.status==="success"&&se.summary?(t(8,w=se.summary),t(12,$=se.from_cache||!1),t(11,g=!0),console.log("  ✅ Summary generated successfully"),console.log("    Summary length:",w.length,"characters"),console.log("    From cache:",$),console.log("    Model used:",se.model_used)):(t(10,y=se.error||"Failed to generate summary"),console.error("  ❌ Summary generation failed:",y))}catch(V){console.error("❌ Error generating summary:"),console.error("  Error type:",V.constructor.name),console.error("  Error message:",V.message||V),console.error("  Request details:",{document_id:a.id,role:c,isTauri:r,timestamp:new Date().toISOString()}),t(10,y=V.message||"Network error occurred"),(O=V.message)!=null&&O.includes("Failed to fetch")&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Verify OpenRouter is enabled for this role"),console.error("    3. Check OPENROUTER_KEY environment variable"),console.error("    4. Verify server URL in CONFIG.ServerURL"))}finally{t(9,b=!1)}}}function Y(){console.log("📥 Downloading document as markdown:",a.title);let O=`# ${a.title}

`;O+=`**Source:** Terraphim Search
`,O+=`**Rank:** ${a.rank||"N/A"}
`,a.url&&(O+=`**URL:** ${a.url}
`),a.tags&&a.tags.length>0&&(O+=`**Tags:** ${a.tags.join(", ")}
`),O+=`**Downloaded:** ${new Date().toISOString()}

`,a.description&&(O+=`## Description

${a.description}

`),O+=`## Content

${a.body}
`;const V=`${a.title.replace(/[^a-z0-9]/gi,"_").toLowerCase()}_${Date.now()}.md`,ce=new Blob([O],{type:"text/markdown"}),se=URL.createObjectURL(ce),le=window.document.createElement("a");le.href=se,le.download=V,window.document.body.appendChild(le),le.click(),window.document.body.removeChild(le),URL.revokeObjectURL(se),console.log("✅ Markdown file downloaded:",V)}function Z(){const O=`vscode://${encodeURIComponent(a.title)}.md?${encodeURIComponent(a.body)}`;window.open(O,"_blank")}async function J(){console.log("📝 Adding document to LLM context:",a.title),z=!0,M=!1,t(13,N=null);try{let O=null;if(r){try{const le=await Fe("list_conversations");if(console.log("📋 Available conversations:",le),le!=null&&le.conversations&&le.conversations.length>0)O=le.conversations[0].id,console.log("🎯 Using existing conversation:",O);else{const me=await Fe("create_conversation",{title:"Search Context",role:c||"default"});if(me.status==="success"&&me.conversation_id)O=me.conversation_id,console.log("🆕 Created new conversation:",O);else throw new Error("Failed to create conversation: "+(me.error||"Unknown error"))}}catch(le){throw console.error("❌ Failed to manage conversations:",le),new Error("Could not create or find conversation: "+le.message)}const ce={source_type:"document",document_id:a.id};a.url&&(ce.url=a.url),a.tags&&a.tags.length>0&&(ce.tags=a.tags.join(", ")),a.rank!==void 0&&(ce.rank=a.rank.toString());const se=await Fe("add_context_to_conversation",{conversationId:O,contextType:"document",title:a.title,content:a.body,metadata:ce});console.log("✅ Document added to context via Tauri:",se)}else{const ce=Ye.ServerURL;try{const _e=await fetch(`${ce}/conversations`);if(_e.ok){const fe=await _e.json();if(fe.conversations&&fe.conversations.length>0)O=fe.conversations[0].id,console.log("🎯 Using existing conversation:",O);else{const de=await fetch(`${ce}/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"Search Context",role:c||"default"})});if(de.ok){const pe=await de.json();if(pe.status==="success"&&pe.conversation_id)O=pe.conversation_id,console.log("🆕 Created new conversation:",O);else throw new Error("Failed to create conversation: "+(pe.error||"Unknown error"))}else throw new Error(`Failed to create conversation: ${de.status} ${de.statusText}`)}}else throw new Error(`Failed to list conversations: ${_e.status} ${_e.statusText}`)}catch(_e){throw console.error("❌ Failed to manage conversations:",_e),new Error("Could not create or find conversation: "+_e.message)}const se=`${ce}/conversations/${O}/context`,le=await fetch(se,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context_type:"document",title:a.title,content:a.body,metadata:{source_type:"document",document_id:a.id,url:a.url||"",tags:a.tags?a.tags.join(", "):"",rank:a.rank?a.rank.toString():"0"}})});if(!le.ok)throw new Error(`HTTP error! Status: ${le.status} - ${le.statusText}`);const me=await le.json();console.log("✅ Document added to context via HTTP:",me)}console.log("✅ Successfully added document to LLM context"),M=!0;const V=window.document.createElement("div");V.className="notification is-success is-light",V.innerHTML=`
        <button class="delete" onclick="this.parentElement.remove()"></button>
        <strong>✓ Added to Chat Context</strong><br>
        <small>Document added successfully. <a href="/chat" class="has-text-success has-text-weight-bold">Go to Chat →</a> to see it in the context panel.</small>
      `,V.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(V),setTimeout(()=>{V.remove()},8e3),setTimeout(()=>{M=!1},5e3)}catch(O){console.error("❌ Error adding document to context:",O),t(13,N=O.message||"Failed to add document to context");const V=window.document.createElement("div");V.className="notification is-danger is-light",V.innerHTML=`
        <button class="delete" onclick="this.parentElement.remove()"></button>
        <strong>✗ Failed to Add Context</strong><br>
        <small>${N}</small>
      `,V.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(V),setTimeout(()=>{V.remove()},8e3),setTimeout(()=>{t(13,N=null)},5e3)}finally{z=!1}}async function ee(){console.log("💬 Adding document to context and opening chat:",a.title),L=!0,q=!1,t(13,N=null);try{let O=null;if(r){try{const le=await Fe("list_conversations");if(console.log("📋 Available conversations:",le),le!=null&&le.conversations&&le.conversations.length>0)O=le.conversations[0].id,console.log("🎯 Using existing conversation:",O);else{const me=await Fe("create_conversation",{title:"Chat with Documents",role:c||"default"});if(me.status==="success"&&me.conversation_id)O=me.conversation_id,console.log("🆕 Created new conversation:",O);else throw new Error("Failed to create conversation: "+(me.error||"Unknown error"))}}catch(le){throw console.error("❌ Failed to manage conversations:",le),new Error("Could not create or find conversation: "+le.message)}const ce={source_type:"document",document_id:a.id};a.url&&(ce.url=a.url),a.tags&&a.tags.length>0&&(ce.tags=a.tags.join(", ")),a.rank!==void 0&&(ce.rank=a.rank.toString());const se=await Fe("add_context_to_conversation",{conversationId:O,contextType:"document",title:a.title,content:a.body,metadata:ce});console.log("✅ Document added to context via Tauri:",se)}else{const ce=Ye.ServerURL;try{const _e=await fetch(`${ce}/conversations`);if(_e.ok){const fe=await _e.json();if(fe.conversations&&fe.conversations.length>0)O=fe.conversations[0].id,console.log("🎯 Using existing conversation:",O);else{const de=await fetch(`${ce}/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"Chat with Documents",role:c||"default"})});if(de.ok){const pe=await de.json();if(pe.status==="success"&&pe.conversation_id)O=pe.conversation_id,console.log("🆕 Created new conversation:",O);else throw new Error("Failed to create conversation: "+(pe.error||"Unknown error"))}else throw new Error(`Failed to create conversation: ${de.status} ${de.statusText}`)}}else throw new Error(`Failed to list conversations: ${_e.status} ${_e.statusText}`)}catch(_e){throw console.error("❌ Failed to manage conversations:",_e),new Error("Could not create or find conversation: "+_e.message)}const se=`${ce}/conversations/${O}/context`,le=await fetch(se,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context_type:"document",title:a.title,content:a.body,metadata:{source_type:"document",document_id:a.id,url:a.url||"",tags:a.tags?a.tags.join(", "):"",rank:a.rank?a.rank.toString():"0"}})});if(!le.ok)throw new Error(`HTTP error! Status: ${le.status} - ${le.statusText}`);const me=await le.json();console.log("✅ Document added to context via HTTP:",me)}console.log("✅ Successfully added document to chat context, navigating to chat..."),q=!0;const V=window.document.createElement("div");V.className="notification is-success is-light",V.innerHTML=`
        <strong>💬 Opening Chat with Document</strong><br>
        <small>Context added successfully. Redirecting to chat...</small>
      `,V.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(V),setTimeout(()=>{V.remove(),Hs.goto("/chat")},1500),setTimeout(()=>{q=!1},2e3)}catch(O){console.error("❌ Error adding document to context and opening chat:",O),t(13,N=O.message||"Failed to add document to context");const V=window.document.createElement("div");V.className="notification is-danger is-light",V.innerHTML=`
        <button class="delete" onclick="this.parentElement.remove()"></button>
        <strong>✗ Failed to Open Chat with Document</strong><br>
        <small>${N}</small>
      `,V.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(V),setTimeout(()=>{V.remove()},8e3),setTimeout(()=>{t(13,N=null)},5e3)}finally{L=!1}}Al[c]!==void 0&&(console.log("Have attribute",Al[c]),Al[c].hasOwnProperty("enableLogseq")?console.log("enable logseq True"):console.log("Didn't make it"));const P=O=>K(O),I=()=>{t(10,y=null),A()},B=()=>t(11,g=!1),F=()=>{A()},X=()=>t(13,N=null);function re(O){d=O,t(1,d)}function ie(O){p=O,t(2,p)}function D(O){m=O,t(3,m)}return l.$$set=O=>{"document"in O&&t(0,a=O.document)},t(14,n=H()),t(15,o=Q()),[a,d,p,m,_,v,k,C,w,b,y,g,$,N,n,o,R,K,A,P,I,B,F,X,re,ie,D]}class Mi extends mt{constructor(e){super(),_t(this,e,Oi,Pi,ut,{document:0},null,[-1,-1])}}const Ni="/assets/terraphim_gray.png";function Di(l){const e=l.trim();if(!e)return{hasOperator:!1,operator:null,terms:[l],originalQuery:l};const t=/\b(and)\b/i,n=/\b(or)\b/i,o=t.test(e),c=n.test(e);if(o&&!c)return{hasOperator:!0,operator:"AND",terms:e.split(t).filter((u,a)=>a%2===0).map(u=>u.trim()).filter(u=>u.length>0),originalQuery:l};if(c&&!o)return{hasOperator:!0,operator:"OR",terms:e.split(n).filter((u,a)=>a%2===0).map(u=>u.trim()).filter(u=>u.length>0),originalQuery:l};if(o&&c){const r=e.toLowerCase().indexOf(" and "),u=e.toLowerCase().indexOf(" or ");if(r!==-1&&(u===-1||r<u))return{hasOperator:!0,operator:"AND",terms:e.split(t).filter((d,p)=>p%2===0).map(d=>d.trim()).filter(d=>d.length>0),originalQuery:l};if(u!==-1)return{hasOperator:!0,operator:"OR",terms:e.split(n).filter((d,p)=>p%2===0).map(d=>d.trim()).filter(d=>d.length>0),originalQuery:l}}return{hasOperator:!1,operator:null,terms:[e],originalQuery:l}}function eo(l,e){var n,o;if(l.hasOperator&&l.terms.length>1){const c=l.terms.filter(r=>r.trim().length>0);if(c.length>1)return{search_term:c[0],search_terms:c,operator:(n=l.operator)==null?void 0:n.toLowerCase(),skip:0,limit:50,role:e||null}}return{search_term:((o=l.terms[0])==null?void 0:o.trim())||"",search_terms:void 0,operator:void 0,skip:0,limit:50,role:e||null}}function to(l,e,t){const n=l.slice();return n[27]=e[t],n}function lo(l,e,t){const n=l.slice();return n[30]=e[t],n[32]=t,n}function no(l){let e,t=l[2],n=[];for(let o=0;o<t.length;o+=1)n[o]=oo(lo(l,t,o));return{c(){e=f("ul");for(let o=0;o<n.length;o+=1)n[o].c();i(e,"class","suggestions svelte-e76e8j")},m(o,c){S(o,e,c);for(let r=0;r<n.length;r+=1)n[r]&&n[r].m(e,null)},p(o,c){if(c[0]&1036){t=o[2];let r;for(r=0;r<t.length;r+=1){const u=lo(o,t,r);n[r]?n[r].p(u,c):(n[r]=oo(u),n[r].c(),n[r].m(e,null))}for(;r<n.length;r+=1)n[r].d(1);n.length=t.length}},d(o){o&&T(e),Xe(n,o)}}}function oo(l){let e,t=l[30]+"",n,o,c,r,u,a;function d(){return l[14](l[30])}function p(...m){return l[15](l[30],...m)}return{c(){e=f("li"),n=W(t),o=h(),i(e,"tabindex","0"),i(e,"role","option"),i(e,"aria-selected",c=l[32]===l[3]),i(e,"aria-label",r=`Apply suggestion: ${l[30]}`),i(e,"class","svelte-e76e8j"),bt(e,"active",l[32]===l[3])},m(m,_){S(m,e,_),s(e,n),s(e,o),u||(a=[te(e,"click",d),te(e,"keydown",p)],u=!0)},p(m,_){l=m,_[0]&4&&t!==(t=l[30]+"")&&we(n,t),_[0]&8&&c!==(c=l[32]===l[3])&&i(e,"aria-selected",c),_[0]&4&&r!==(r=`Apply suggestion: ${l[30]}`)&&i(e,"aria-label",r),_[0]&8&&bt(e,"active",l[32]===l[3])},d(m){m&&T(e),u=!1,Qe(a)}}}function Ii(l){let e,t,n,o,c,r,u,a,d,p,m,_,v,k,C,w,b,y,g,$,z,M,N;function L(H){l[13](H)}let q={type:"search",placeholder:l[7]?`Search over Knowledge graph for ${l[6]}`:"Search",icon:"search",expanded:!0,autofocus:!0};l[5]!==void 0&&(q.value=l[5]),n=new Vt({props:q}),st.push(()=>it(n,"value",L)),n.$on("click",l[11]),n.$on("submit",l[11]),n.$on("keydown",l[9]),n.$on("input",l[8]);let Q=l[2].length>0&&no(l);return z=us(l[17][0]),{c(){e=f("div"),t=f("div"),ve(n.$$.fragment),c=h(),Q&&Q.c(),r=h(),u=f("div"),a=f("div"),d=f("label"),p=f("input"),m=W(`
            Exact`),_=h(),v=f("label"),k=f("input"),C=W(`
            All (AND)`),w=h(),b=f("label"),y=f("input"),g=W(`
            Any (OR)`),i(t,"class","input-wrapper svelte-e76e8j"),i(p,"type","radio"),p.__value="none",p.value=p.__value,i(p,"class","svelte-e76e8j"),i(d,"class","radio svelte-e76e8j"),i(k,"type","radio"),k.__value="and",k.value=k.__value,i(k,"class","svelte-e76e8j"),i(v,"class","radio svelte-e76e8j"),i(y,"type","radio"),y.__value="or",y.value=y.__value,i(y,"class","svelte-e76e8j"),i(b,"class","radio svelte-e76e8j"),i(a,"class","control svelte-e76e8j"),i(u,"class","operator-controls svelte-e76e8j"),i(e,"class","search-row svelte-e76e8j"),z.p(p,k,y)},m(H,R){S(H,e,R),s(e,t),be(n,t,null),s(t,c),Q&&Q.m(t,null),s(e,r),s(e,u),s(u,a),s(a,d),s(d,p),p.checked=p.__value===l[4],s(d,m),s(a,_),s(a,v),s(v,k),k.checked=k.__value===l[4],s(v,C),s(a,w),s(a,b),s(b,y),y.checked=y.__value===l[4],s(b,g),$=!0,M||(N=[te(p,"change",l[16]),te(k,"change",l[18]),te(y,"change",l[19])],M=!0)},p(H,R){const E={};R[0]&192&&(E.placeholder=H[7]?`Search over Knowledge graph for ${H[6]}`:"Search"),!o&&R[0]&32&&(o=!0,E.value=H[5],at(()=>o=!1)),n.$set(E),H[2].length>0?Q?Q.p(H,R):(Q=no(H),Q.c(),Q.m(t,null)):Q&&(Q.d(1),Q=null),R[0]&16&&(p.checked=p.__value===H[4]),R[0]&16&&(k.checked=k.__value===H[4]),R[0]&16&&(y.checked=y.__value===H[4])},i(H){$||(x(n.$$.fragment,H),$=!0)},o(H){oe(n.$$.fragment,H),$=!1},d(H){H&&T(e),ke(n),Q&&Q.d(),z.r(),M=!1,Qe(N)}}}function Ui(l){let e,t,n,o,c,r,u,a,d,p;return{c(){e=f("section"),t=f("div"),n=f("img"),c=h(),r=f("p"),r.textContent="I am Terraphim, your personal assistant.",u=h(),a=f("button"),a.innerHTML=`<span class="icon"><i class="fas fa-magic"></i></span>
        <span>Configuration Wizard</span>`,Ns(n.src,o=Ni)||i(n,"src",o),i(n,"alt","Terraphim Logo"),i(n,"class","svelte-e76e8j"),i(a,"class","button is-primary"),i(a,"data-testid","wizard-start"),i(t,"class","content has-text-grey has-text-centered svelte-e76e8j"),i(e,"class","section")},m(m,_){S(m,e,_),s(e,t),s(t,n),s(t,c),s(t,r),s(t,u),s(t,a),d||(p=te(a,"click",l[20]),d=!0)},p:Ne,i:Ne,o:Ne,d(m){m&&T(e),d=!1,p()}}}function ji(l){let e,t,n=l[0],o=[];for(let r=0;r<n.length;r+=1)o[r]=so(to(l,n,r));const c=r=>oe(o[r],1,1,()=>{o[r]=null});return{c(){for(let r=0;r<o.length;r+=1)o[r].c();e=ct()},m(r,u){for(let a=0;a<o.length;a+=1)o[a]&&o[a].m(r,u);S(r,e,u),t=!0},p(r,u){if(u[0]&1){n=r[0];let a;for(a=0;a<n.length;a+=1){const d=to(r,n,a);o[a]?(o[a].p(d,u),x(o[a],1)):(o[a]=so(d),o[a].c(),x(o[a],1),o[a].m(e.parentNode,e))}for(tt(),a=n.length;a<o.length;a+=1)c(a);lt()}},i(r){if(!t){for(let u=0;u<n.length;u+=1)x(o[u]);t=!0}},o(r){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)oe(o[u]);t=!1},d(r){Xe(o,r),r&&T(e)}}}function Hi(l){let e,t;return{c(){e=f("p"),t=W(l[1]),i(e,"class","error svelte-e76e8j")},m(n,o){S(n,e,o),s(e,t)},p(n,o){o[0]&2&&we(t,n[1])},i:Ne,o:Ne,d(n){n&&T(e)}}}function so(l){let e,t;return e=new Mi({props:{document:l[27]}}),{c(){ve(e.$$.fragment)},m(n,o){be(e,n,o),t=!0},p(n,o){const c={};o[0]&1&&(c.document=n[27]),e.$set(c)},i(n){t||(x(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){ke(e,n)}}}function zi(l){let e,t,n,o,c,r,u,a,d,p,m;e=new il({props:{fallbackPath:"/"}}),o=new zt({props:{$$slots:{default:[Ii]},$$scope:{ctx:l}}});const _=[Hi,ji,Ui],v=[];function k(C,w){return C[1]?0:C[0].length?1:2}return r=k(l),u=v[r]=_[r](l),{c(){ve(e.$$.fragment),t=h(),n=f("form"),ve(o.$$.fragment),c=h(),u.c(),a=ct()},m(C,w){be(e,C,w),S(C,t,w),S(C,n,w),be(o,n,null),S(C,c,w),v[r].m(C,w),S(C,a,w),d=!0,p||(m=te(n,"submit",Ms(l[11])),p=!0)},p(C,w){const b={};w[0]&252|w[1]&4&&(b.$$scope={dirty:w,ctx:C}),o.$set(b);let y=r;r=k(C),r===y?v[r].p(C,w):(tt(),oe(v[y],1,1,()=>{v[y]=null}),lt(),u=v[r],u?u.p(C,w):(u=v[r]=_[r](C),u.c()),x(u,1),u.m(a.parentNode,a))},i(C){d||(x(e.$$.fragment,C),x(o.$$.fragment,C),x(u),d=!0)},o(C){oe(e.$$.fragment,C),oe(o.$$.fragment,C),oe(u),d=!1},d(C){ke(e,C),C&&T(t),C&&T(n),ke(o),C&&T(c),v[r].d(C),C&&T(a),p=!1,m()}}}function Fi(l,e,t){let n,o,c,r,u,a,d;Ue(l,ir,K=>t(22,o=K)),Ue(l,Ll,K=>t(5,c=K)),Ue(l,ot,K=>t(23,r=K)),Ue(l,Et,K=>t(6,u=K)),Ue(l,dl,K=>t(12,a=K)),Ue(l,$t,K=>t(7,d=K));let p=[],m=null,_=[],v=-1,k="none";async function C(K){try{if(r){const A=await Fe("get_autocomplete_suggestions",{query:K,roleName:u,limit:8});if(A.status==="success"&&A.suggestions)return A.suggestions.map(Y=>Y.term)}else{const A=await fetch(`${o.replace("/documents/search","")}/autocomplete/${encodeURIComponent(u)}/${encodeURIComponent(K)}`);if(A.ok){const Y=await A.json();if(Y.status==="success"&&Y.suggestions)return Y.suggestions.map(Z=>Z.term)}}return n.filter(([A])=>A.toLowerCase().includes(K.toLowerCase())).map(([A])=>A).slice(0,8)}catch(A){return console.warn("Error fetching term suggestions:",A),[]}}async function w(K){const A=K.trim();if(A.length===0)return[];if(k!=="none"){const P=A.split(/\s+/),I=P[P.length-1].toLowerCase();return I.length<2?[]:C(I)}const Z=A.split(/\s+/),J=Z[Z.length-1].toLowerCase();if(Z.length>1&&k==="none"){const P=[];if("and".startsWith(J)&&P.push("AND"),"or".startsWith(J)&&P.push("OR"),P.length>0)return P}const ee=A.toLowerCase();if(ee.includes(" and ")||ee.includes(" or ")){const P=J;return P.length<2?[]:C(P)}try{const P=await C(A);return Z.length===1&&Z[0].length>2&&k==="none"?[...P.slice(0,6),"AND","OR"]:P}catch(P){console.warn("Error fetching autocomplete suggestions:",P);const I=n.filter(([B])=>B.toLowerCase().includes(A.toLowerCase())).map(([B])=>B).slice(0,6);return Z.length===1&&Z[0].length>2&&k==="none"?[...I,"AND","OR"]:I}}async function b(K){const A=K.target;if(!A||A.selectionStart==null)return;const Y=A.selectionStart,J=c.slice(0,Y).split(/\s+/),ee=J[J.length-1];if(ee.length>=2)try{t(2,_=await w(ee))}catch(P){console.warn("Failed to get suggestions:",P),t(2,_=[])}else t(2,_=[]);t(3,v=-1)}function y(K){_.length!==0&&(K.key==="ArrowDown"?(K.preventDefault(),t(3,v=(v+1)%_.length)):K.key==="ArrowUp"?(K.preventDefault(),t(3,v=(v-1+_.length)%_.length)):(K.key==="Enter"||K.key==="Tab")&&v!==-1&&(K.preventDefault(),g(_[v])))}function g(K){var P,I;const A=document.querySelector('input[type="search"]'),Y=(A==null?void 0:A.selectionStart)??0,Z=c.slice(0,Y),J=c.slice(Y),ee=Z.split(/\s+/);if(K==="AND"||K==="OR"){ee[ee.length-1]=K,pl(Ll,c=[...ee,"",J].join(" "),c);const B=Y+K.length+1;(P=A==null?void 0:A.setSelectionRange)==null||P.call(A,B,B)}else{ee[ee.length-1]=K,pl(Ll,c=[...ee,J].join(" "),c);const B=Y+K.length;(I=A==null?void 0:A.setSelectionRange)==null||I.call(A,B,B)}t(2,_=[]),t(3,v=-1)}function $(){const K=c.trim();if(!K)return null;if(k!=="none"){const Z=K.split(/\s+/).filter(J=>J.length>0);return Z.length>1?{...eo({hasOperator:!0,operator:k==="and"?"AND":"OR",terms:Z,originalQuery:K},u),skip:0,limit:10}:{search_term:K,skip:0,limit:10,role:u}}const A=Di(K);return{...eo(A,u),skip:0,limit:10}}async function z(){if(t(1,m=null),r){if(!c.trim())return;try{const K=$();if(!K)return;const A=await Fe("search",{searchQuery:K});A.status==="success"?(t(0,p=A.results),console.log("Response results"),console.log(p)):(t(1,m=`Search failed: ${A.status}`),console.error("Search failed:",A))}catch(K){t(1,m=`Error in Tauri search: ${K}`),console.error("Error in Tauri search:",K)}}else{if(!c.trim())return;const K=$();if(!K)return;const A=JSON.stringify(K);try{const Y=await fetch(o,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:A}),Z=await Y.json();if(!Y.ok)throw new Error(`HTTP error! Status: ${Y.status}`);t(0,p=Z.results)}catch(Y){console.error("Error fetching data:",Y),t(1,m=`Error fetching data: ${Y}`)}}}const M=[[]];function N(K){c=K,Ll.set(c)}const L=K=>g(K),q=(K,A)=>{(A.key==="Enter"||A.key===" ")&&(A.preventDefault(),g(K))};function Q(){k=this.__value,t(4,k)}function H(){k=this.__value,t(4,k)}function R(){k=this.__value,t(4,k)}const E=()=>window.location.href="/config/wizard";return l.$$.update=()=>{l.$$.dirty[0]&4096&&(n=Object.entries(a))},[p,m,_,v,k,c,u,d,b,y,g,z,a,N,L,q,Q,M,H,R,E]}class qi extends mt{constructor(e){super(),_t(this,e,Fi,zi,ut,{},null,[-1,-1])}}async function ro(l={}){return typeof l=="object"&&Object.freeze(l),Kl({__tauriModule:"Dialog",message:{cmd:"openDialog",options:l}})}function io(l,e,t){const n=l.slice();return n[71]=e[t],n[79]=t,n}function ao(l,e,t){const n=l.slice();return n[77]=e[t],n[78]=e,n[79]=t,n}function co(l,e,t){const n=l.slice();return n[80]=e[t],n}function uo(l,e,t){const n=l.slice();return n[80]=e[t],n}function fo(l,e,t){const n=l.slice();return n[85]=e[t],n[86]=e,n[87]=t,n}function po(l,e,t){const n=l.slice();return n[88]=e[t][0],n[89]=e[t][1],n[90]=e,n[91]=t,n}function mo(l,e,t){const n=l.slice();return n[74]=e[t],n}function _o(l,e,t){const n=l.slice();return n[71]=e[t],n}function ho(l,e,t){const n=l.slice();return n[74]=e[t],n}function go(l){let e,t,n,o,c;return{c(){e=f("div"),t=f("button"),n=W(`
      Configuration saved successfully!`),i(t,"class","delete"),i(e,"class","notification is-success"),i(e,"data-testid","wizard-success")},m(r,u){S(r,e,u),s(e,t),s(e,n),o||(c=te(t,"click",l[20]),o=!0)},p:Ne,d(r){r&&T(e),o=!1,c()}}}function vo(l){let e,t,n,o,c;return{c(){e=f("div"),t=f("button"),n=W(`
      Failed to save configuration. Please try again.`),i(t,"class","delete"),i(e,"class","notification is-danger"),i(e,"data-testid","wizard-error")},m(r,u){S(r,e,u),s(e,t),s(e,n),o||(c=te(t,"click",l[21]),o=!0)},p:Ne,d(r){r&&T(e),o=!1,c()}}}function Ki(l){let e,t,n,o,c,r,u,a,d,p=l[3].id+"",m,_,v,k,C,w=l[3].global_shortcut+"",b,y,g,$,z,M=l[3].default_theme+"",N,L,q,Q,H,R=l[3].default_role+"",E,K,A,Y,Z,J,ee=JSON.stringify(l[3],null,2)+"",P,I=l[3].roles,B=[];for(let F=0;F<I.length;F+=1)B[F]=bo(io(l,I,F));return{c(){e=f("h4"),e.textContent="Review",t=h(),n=f("div"),o=f("h5"),o.textContent="Configuration Summary:",c=h(),r=f("ul"),u=f("li"),a=f("strong"),a.textContent="Configuration ID:",d=h(),m=W(p),_=h(),v=f("li"),k=f("strong"),k.textContent="Global Shortcut:",C=h(),b=W(w),y=h(),g=f("li"),$=f("strong"),$.textContent="Default Theme:",z=h(),N=W(M),L=h(),q=f("li"),Q=f("strong"),Q.textContent="Default Role:",H=h(),E=W(R),K=h(),A=f("h5"),A.textContent="Roles:",Y=h();for(let F=0;F<B.length;F+=1)B[F].c();Z=h(),J=f("pre"),P=W(ee),i(e,"class","title is-5"),i(n,"class","content"),ge(J,"max-height","300px"),ge(J,"overflow","auto")},m(F,X){S(F,e,X),S(F,t,X),S(F,n,X),s(n,o),s(n,c),s(n,r),s(r,u),s(u,a),s(u,d),s(u,m),s(r,_),s(r,v),s(v,k),s(v,C),s(v,b),s(r,y),s(r,g),s(g,$),s(g,z),s(g,N),s(r,L),s(r,q),s(q,Q),s(q,H),s(q,E),s(n,K),s(n,A),s(n,Y);for(let re=0;re<B.length;re+=1)B[re]&&B[re].m(n,null);S(F,Z,X),S(F,J,X),s(J,P)},p(F,X){if(X[0]&8&&p!==(p=F[3].id+"")&&we(m,p),X[0]&8&&w!==(w=F[3].global_shortcut+"")&&we(b,w),X[0]&8&&M!==(M=F[3].default_theme+"")&&we(N,M),X[0]&8&&R!==(R=F[3].default_role+"")&&we(E,R),X[0]&10){I=F[3].roles;let re;for(re=0;re<I.length;re+=1){const ie=io(F,I,re);B[re]?B[re].p(ie,X):(B[re]=bo(ie),B[re].c(),B[re].m(n,null))}for(;re<B.length;re+=1)B[re].d(1);B.length=I.length}X[0]&8&&ee!==(ee=JSON.stringify(F[3],null,2)+"")&&we(P,ee)},d(F){F&&T(e),F&&T(t),F&&T(n),Xe(B,F),F&&T(Z),F&&T(J)}}}function Wi(l){let e,t,n=[],o=new Map,c,r,u,a,d=l[3].roles;const p=m=>m[77].name;for(let m=0;m<d.length;m+=1){let _=ao(l,d,m),v=p(_);o.set(v,n[m]=No(v,_))}return{c(){e=f("h4"),e.textContent="Roles",t=h();for(let m=0;m<n.length;m+=1)n[m].c();c=h(),r=f("button"),r.textContent="Add Role",i(e,"class","title is-5"),i(r,"class","button is-link is-light"),i(r,"data-testid","add-role")},m(m,_){S(m,e,_),S(m,t,_);for(let v=0;v<n.length;v+=1)n[v]&&n[v].m(m,_);S(m,c,_),S(m,r,_),u||(a=te(r,"click",l[12]),u=!0)},p(m,_){_[0]&516985&&(d=m[3].roles,n=Ds(n,_,p,1,m,d,o,c.parentNode,Is,No,c,ao))},d(m){m&&T(e),m&&T(t);for(let _=0;_<n.length;_+=1)n[_].d(m);m&&T(c),m&&T(r),u=!1,a()}}}function Gi(l){let e,t,n,o,c,r,u,a,d,p,m,_,v,k,C,w,b,y,g,$,z,M,N,L,q,Q,H,R,E,K,A,Y=l[8],Z=[];for(let P=0;P<Y.length;P+=1)Z[P]=Do(ho(l,Y,P));let J=l[3].roles,ee=[];for(let P=0;P<J.length;P+=1)ee[P]=Io(_o(l,J,P));return{c(){e=f("div"),t=f("label"),t.textContent="Configuration ID",n=h(),o=f("div"),c=f("div"),r=f("select"),u=f("option"),u.textContent="Desktop",a=f("option"),a.textContent="Server",d=f("option"),d.textContent="Embedded",p=h(),m=f("div"),_=f("label"),_.textContent="Global shortcut",v=h(),k=f("div"),C=f("input"),w=h(),b=f("div"),y=f("label"),y.textContent="Default theme",g=h(),$=f("div"),z=f("div"),M=f("select");for(let P=0;P<Z.length;P+=1)Z[P].c();N=h(),L=f("div"),q=f("label"),q.textContent="Default Role",Q=h(),H=f("div"),R=f("div"),E=f("select");for(let P=0;P<ee.length;P+=1)ee[P].c();i(t,"class","label"),i(t,"for","config-id"),u.__value="Desktop",u.value=u.__value,a.__value="Server",a.value=a.__value,d.__value="Embedded",d.value=d.__value,i(r,"id","config-id"),l[3].id===void 0&&rt(()=>l[22].call(r)),i(c,"class","select"),i(o,"class","control"),i(e,"class","field"),i(_,"class","label"),i(_,"for","global-shortcut"),i(C,"class","input"),i(C,"id","global-shortcut"),i(C,"type","text"),i(k,"class","control"),i(m,"class","field"),i(y,"class","label"),i(y,"for","default-theme"),i(M,"id","default-theme"),l[3].default_theme===void 0&&rt(()=>l[24].call(M)),i(z,"class","select is-fullwidth"),i($,"class","control"),i(b,"class","field"),i(q,"class","label"),i(q,"for","default-role"),i(E,"id","default-role"),l[3].default_role===void 0&&rt(()=>l[25].call(E)),i(R,"class","select"),i(H,"class","control"),i(L,"class","field")},m(P,I){S(P,e,I),s(e,t),s(e,n),s(e,o),s(o,c),s(c,r),s(r,u),s(r,a),s(r,d),qe(r,l[3].id,!0),S(P,p,I),S(P,m,I),s(m,_),s(m,v),s(m,k),s(k,C),Pe(C,l[3].global_shortcut),S(P,w,I),S(P,b,I),s(b,y),s(b,g),s(b,$),s($,z),s(z,M);for(let B=0;B<Z.length;B+=1)Z[B]&&Z[B].m(M,null);qe(M,l[3].default_theme,!0),S(P,N,I),S(P,L,I),s(L,q),s(L,Q),s(L,H),s(H,R),s(R,E);for(let B=0;B<ee.length;B+=1)ee[B]&&ee[B].m(E,null);qe(E,l[3].default_role,!0),K||(A=[te(r,"change",l[22]),te(C,"input",l[23]),te(M,"change",l[24]),te(E,"change",l[25])],K=!0)},p(P,I){if(I[0]&264&&qe(r,P[3].id),I[0]&264&&C.value!==P[3].global_shortcut&&Pe(C,P[3].global_shortcut),I[0]&256){Y=P[8];let B;for(B=0;B<Y.length;B+=1){const F=ho(P,Y,B);Z[B]?Z[B].p(F,I):(Z[B]=Do(F),Z[B].c(),Z[B].m(M,null))}for(;B<Z.length;B+=1)Z[B].d(1);Z.length=Y.length}if(I[0]&264&&qe(M,P[3].default_theme),I[0]&8){J=P[3].roles;let B;for(B=0;B<J.length;B+=1){const F=_o(P,J,B);ee[B]?ee[B].p(F,I):(ee[B]=Io(F),ee[B].c(),ee[B].m(E,null))}for(;B<ee.length;B+=1)ee[B].d(1);ee.length=J.length}I[0]&264&&qe(E,P[3].default_role)},d(P){P&&T(e),P&&T(p),P&&T(m),P&&T(w),P&&T(b),Xe(Z,P),P&&T(N),P&&T(L),Xe(ee,P),K=!1,Qe(A)}}}function bo(l){let e,t,n=l[71].name+"",o,c,r,u,a,d=l[71].shortname+"",p,m,_,v,k,C=l[71].theme+"",w,b,y,g,$,z=l[71].relevance_function+"",M,N,L,q,Q,H;return{c(){e=f("div"),t=f("h6"),o=W(n),c=h(),r=f("p"),u=f("strong"),u.textContent="Shortname:",a=h(),p=W(d),m=h(),_=f("p"),v=f("strong"),v.textContent="Theme:",k=h(),w=W(C),b=h(),y=f("p"),g=f("strong"),g.textContent="Relevance Function:",$=h(),M=W(z),N=h(),L=f("button"),L.textContent="Edit Role",q=h(),i(t,"data-testid","review-role-name-"+l[79]),i(L,"class","button is-small"),i(L,"data-testid","edit-role-"+l[79]),i(e,"class","box")},m(R,E){S(R,e,E),s(e,t),s(t,o),s(e,c),s(e,r),s(r,u),s(r,a),s(r,p),s(e,m),s(e,_),s(_,v),s(_,k),s(_,w),s(e,b),s(e,y),s(y,g),s(y,$),s(y,M),s(e,N),s(e,L),s(e,q),Q||(H=te(L,"click",l[68]),Q=!0)},p(R,E){E[0]&8&&n!==(n=R[71].name+"")&&we(o,n),E[0]&8&&d!==(d=R[71].shortname+"")&&we(p,d),E[0]&8&&C!==(C=R[71].theme+"")&&we(w,C),E[0]&8&&z!==(z=R[71].relevance_function+"")&&we(M,z)},d(R){R&&T(e),Q=!1,H()}}}function ko(l){let e,t=l[74]+"",n;return{c(){e=f("option"),n=W(t),e.__value=l[74],e.value=e.__value},m(o,c){S(o,e,c),s(e,n)},p:Ne,d(o){o&&T(e)}}}function Bi(l){let e;return{c(){e=W("Directory Path")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function Ji(l){let e;return{c(){e=W("Server URL")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function wo(l){let e;return{c(){e=f("p"),e.textContent="Click to select directory",i(e,"class","help")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function yo(l){let e,t,n,o,c,r,u,a,d,p,m,_;function v(){l[34].call(u,l[79],l[87])}return{c(){e=f("div"),t=f("label"),n=W("Atomic Server Secret"),c=h(),r=f("div"),u=f("input"),d=h(),p=f("p"),p.textContent="Leave empty for anonymous access",i(t,"class","label"),i(t,"for",o=`haystack-secret-${l[79]}-${l[87]}`),i(u,"class","input"),i(u,"id",a=`haystack-secret-${l[79]}-${l[87]}`),i(u,"type","password"),i(u,"placeholder","Base64 encoded secret (optional)"),i(r,"class","control"),i(p,"class","help"),i(e,"class","field")},m(k,C){S(k,e,C),s(e,t),s(t,n),s(e,c),s(e,r),s(r,u),Pe(u,l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret),s(e,d),s(e,p),m||(_=te(u,"input",v),m=!0)},p(k,C){l=k,C[0]&264&&o!==(o=`haystack-secret-${l[79]}-${l[87]}`)&&i(t,"for",o),C[0]&264&&a!==(a=`haystack-secret-${l[79]}-${l[87]}`)&&i(u,"id",a),C[0]&264&&u.value!==l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret&&Pe(u,l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret)},d(k){k&&T(e),m=!1,_()}}}function Co(l){let e,t,n,o,c,r,u,a,d,p,m,_,v,k,C,w,b,y,g,$,z,M,N,L,q,Q,H,R,E,K,A,Y,Z,J,ee,P,I,B,F,X,re,ie,D;function O(){l[35].call(p,l[79],l[87])}function V(...fe){return l[36](l[79],l[87],...fe)}let ce=Object.entries(l[3].roles[l[79]].haystacks[l[87]].extra_parameters||{}),se=[];for(let fe=0;fe<ce.length;fe+=1)se[fe]=$o(po(l,ce,fe));function le(){return l[40](l[79],l[87])}function me(){return l[41](l[79],l[87])}function _e(){return l[42](l[79],l[87])}return{c(){e=f("div"),t=f("label"),t.textContent="Extra Parameters (for filtering)",n=h(),o=f("div"),c=f("div"),r=f("label"),u=W("Hashtag"),d=h(),p=f("input"),_=h(),v=f("div"),k=f("div"),C=f("label"),w=W("Presets"),y=h(),g=f("div"),$=f("select"),z=f("option"),z.textContent="(choose)",M=f("option"),M.textContent="#rust",N=f("option"),N.textContent="#docs",L=f("option"),L.textContent="#test",q=f("option"),q.textContent="#todo",H=h(),R=f("p"),R.innerHTML="When set, searches will enforce the hashtag alongside your query (AND), e.g. <code>-e &quot;search&quot; -e &quot;#rust&quot;</code>.",E=h();for(let fe=0;fe<se.length;fe+=1)se[fe].c();K=h(),A=f("div"),Y=f("div"),Z=f("button"),Z.textContent="+ Tag Filter",J=h(),ee=f("div"),P=f("button"),P.textContent="+ Max Results",I=h(),B=f("div"),F=f("button"),F.textContent="+ Custom Parameter",X=h(),re=f("p"),re.innerHTML=`Common parameters: <code>tag</code> (e.g., &quot;#rust&quot;), <code>glob</code> (e.g., &quot;*.md&quot;),
                  <code>max_count</code> (e.g., &quot;10&quot;), <code>context</code> (e.g., &quot;5&quot;)`,i(t,"class","label"),i(r,"class","label"),i(r,"for",a=`ripgrep-hashtag-${l[79]}-${l[87]}`),i(p,"class","input"),i(p,"id",m=`ripgrep-hashtag-${l[79]}-${l[87]}`),i(p,"type","text"),i(p,"placeholder","#rust"),i(c,"class","control"),i(o,"class","field is-grouped"),i(C,"class","label"),i(C,"for",b=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`),z.__value="",z.value=z.__value,M.__value="#rust",M.value=M.__value,N.__value="#docs",N.value=N.__value,L.__value="#test",L.value=L.__value,q.__value="#todo",q.value=q.__value,i($,"id",Q=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`),i(g,"class","select is-small"),i(k,"class","control"),i(v,"class","field is-grouped"),ge(v,"margin-bottom",".5rem"),i(R,"class","help"),i(Z,"class","button is-small is-link is-light"),i(Y,"class","control"),i(P,"class","button is-small is-link is-light"),i(ee,"class","control"),i(F,"class","button is-small is-link is-light"),i(B,"class","control"),i(A,"class","field is-grouped"),i(re,"class","help"),i(e,"class","field")},m(fe,de){S(fe,e,de),s(e,t),s(e,n),s(e,o),s(o,c),s(c,r),s(r,u),s(c,d),s(c,p),Pe(p,l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag),s(e,_),s(e,v),s(v,k),s(k,C),s(C,w),s(k,y),s(k,g),s(g,$),s($,z),s($,M),s($,N),s($,L),s($,q),s(e,H),s(e,R),s(e,E);for(let pe=0;pe<se.length;pe+=1)se[pe]&&se[pe].m(e,null);s(e,K),s(e,A),s(A,Y),s(Y,Z),s(A,J),s(A,ee),s(ee,P),s(A,I),s(A,B),s(B,F),s(e,X),s(e,re),ie||(D=[te(p,"input",O),te($,"change",V),te(Z,"click",le),te(P,"click",me),te(F,"click",_e)],ie=!0)},p(fe,de){if(l=fe,de[0]&264&&a!==(a=`ripgrep-hashtag-${l[79]}-${l[87]}`)&&i(r,"for",a),de[0]&264&&m!==(m=`ripgrep-hashtag-${l[79]}-${l[87]}`)&&i(p,"id",m),de[0]&264&&p.value!==l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag&&Pe(p,l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag),de[0]&264&&b!==(b=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`)&&i(C,"for",b),de[0]&264&&Q!==(Q=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`)&&i($,"id",Q),de[0]&393224){ce=Object.entries(l[3].roles[l[79]].haystacks[l[87]].extra_parameters||{});let pe;for(pe=0;pe<ce.length;pe+=1){const he=po(l,ce,pe);se[pe]?se[pe].p(he,de):(se[pe]=$o(he),se[pe].c(),se[pe].m(e,K))}for(;pe<se.length;pe+=1)se[pe].d(1);se.length=ce.length}},d(fe){fe&&T(e),Xe(se,fe),ie=!1,Qe(D)}}}function $o(l){let e,t,n,o,c,r,u,a,d,p,m,_,v;function k(...b){return l[37](l[79],l[87],l[88],...b)}function C(){l[38].call(u,l[79],l[87],l[88])}function w(){return l[39](l[79],l[87],l[88])}return{c(){e=f("div"),t=f("div"),n=f("input"),c=h(),r=f("div"),u=f("input"),a=h(),d=f("div"),p=f("button"),p.textContent="×",m=h(),i(n,"class","input"),i(n,"type","text"),i(n,"placeholder","Parameter name"),n.value=o=l[88],i(t,"class","control"),i(u,"class","input"),i(u,"type","text"),i(u,"placeholder","Parameter value"),i(r,"class","control is-expanded"),i(p,"class","button is-small is-danger"),i(d,"class","control"),i(e,"class","field is-grouped")},m(b,y){S(b,e,y),s(e,t),s(t,n),s(e,c),s(e,r),s(r,u),Pe(u,l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]]),s(e,a),s(e,d),s(d,p),s(e,m),_||(v=[te(n,"blur",k),te(u,"input",C),te(p,"click",w)],_=!0)},p(b,y){l=b,y[0]&264&&o!==(o=l[88])&&n.value!==o&&(n.value=o),y[0]&264&&u.value!==l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]]&&Pe(u,l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]])},d(b){b&&T(e),_=!1,Qe(v)}}}function To(l){let e,t,n,o,c,r,u,a,d,p,m,_,v,k,C,w,b,y,g,$,z,M,N,L,q,Q,H,R,E,K,A,Y,Z,J,ee,P,I,B,F;function X(){l[31].call(d,l[79],l[87])}function re(fe,de){return fe[3].roles[fe[79]].haystacks[fe[87]].service==="Atomic"?Ji:Bi}let ie=re(l),D=ie(l);function O(){l[32].call(g,l[79],l[87])}function V(){return l[33](l[79],l[87])}let ce=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"&&wo(),se=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"&&yo(l),le=l[3].roles[l[79]].haystacks[l[87]].service==="Ripgrep"&&Co(l);function me(){l[43].call(E,l[79],l[87])}function _e(){return l[44](l[79],l[87])}return{c(){e=f("div"),t=f("div"),n=f("label"),o=W("Service Type"),r=h(),u=f("div"),a=f("div"),d=f("select"),p=f("option"),p.textContent="Ripgrep (File Search)",m=f("option"),m.textContent="Atomic Server",v=h(),k=f("div"),C=f("label"),D.c(),b=h(),y=f("div"),g=f("input"),N=h(),ce&&ce.c(),L=h(),se&&se.c(),q=h(),le&&le.c(),Q=h(),H=f("div"),R=f("label"),E=f("input"),A=W(`
                 Read-only`),Z=h(),J=f("div"),ee=f("button"),P=W("Remove Haystack"),i(n,"class","label"),i(n,"for",c=`haystack-service-${l[79]}-${l[87]}`),p.__value="Ripgrep",p.value=p.__value,m.__value="Atomic",m.value=m.__value,i(d,"id",_=`haystack-service-${l[79]}-${l[87]}`),l[3].roles[l[79]].haystacks[l[87]].service===void 0&&rt(X),i(a,"class","select"),i(u,"class","control"),i(t,"class","field"),i(C,"class","label"),i(C,"for",w=`haystack-path-${l[79]}-${l[87]}`),i(g,"class","input"),i(g,"id",$=`haystack-path-${l[79]}-${l[87]}`),i(g,"type","text"),i(g,"placeholder",z=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?"https://localhost:9883":"/path/to/documents"),g.readOnly=M=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic",i(y,"class","control"),i(k,"class","field"),i(E,"id",K=`haystack-readonly-${l[79]}-${l[87]}`),i(E,"type","checkbox"),i(R,"class","checkbox"),i(R,"for",Y=`haystack-readonly-${l[79]}-${l[87]}`),i(H,"class","field"),i(ee,"class","button is-small is-danger"),i(ee,"data-testid",I="remove-haystack-"+l[79]+"-"+l[87]),i(J,"class","field"),i(e,"class","box is-light")},m(fe,de){S(fe,e,de),s(e,t),s(t,n),s(n,o),s(t,r),s(t,u),s(u,a),s(a,d),s(d,p),s(d,m),qe(d,l[3].roles[l[79]].haystacks[l[87]].service,!0),s(e,v),s(e,k),s(k,C),D.m(C,null),s(k,b),s(k,y),s(y,g),Pe(g,l[3].roles[l[79]].haystacks[l[87]].path),s(y,N),ce&&ce.m(y,null),s(e,L),se&&se.m(e,null),s(e,q),le&&le.m(e,null),s(e,Q),s(e,H),s(H,R),s(R,E),E.checked=l[3].roles[l[79]].haystacks[l[87]].read_only,s(R,A),s(e,Z),s(e,J),s(J,ee),s(ee,P),B||(F=[te(d,"change",X),te(g,"input",O),te(g,"click",function(){Fl(l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?V:void 0)&&(l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?V:void 0).apply(this,arguments)}),te(E,"change",me),te(ee,"click",_e)],B=!0)},p(fe,de){l=fe,de[0]&264&&c!==(c=`haystack-service-${l[79]}-${l[87]}`)&&i(n,"for",c),de[0]&264&&_!==(_=`haystack-service-${l[79]}-${l[87]}`)&&i(d,"id",_),de[0]&264&&qe(d,l[3].roles[l[79]].haystacks[l[87]].service),ie!==(ie=re(l))&&(D.d(1),D=ie(l),D&&(D.c(),D.m(C,null))),de[0]&264&&w!==(w=`haystack-path-${l[79]}-${l[87]}`)&&i(C,"for",w),de[0]&264&&$!==($=`haystack-path-${l[79]}-${l[87]}`)&&i(g,"id",$),de[0]&264&&z!==(z=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?"https://localhost:9883":"/path/to/documents")&&i(g,"placeholder",z),de[0]&280&&M!==(M=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic")&&(g.readOnly=M),de[0]&264&&g.value!==l[3].roles[l[79]].haystacks[l[87]].path&&Pe(g,l[3].roles[l[79]].haystacks[l[87]].path),l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?ce||(ce=wo(),ce.c(),ce.m(y,null)):ce&&(ce.d(1),ce=null),l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?se?se.p(l,de):(se=yo(l),se.c(),se.m(e,q)):se&&(se.d(1),se=null),l[3].roles[l[79]].haystacks[l[87]].service==="Ripgrep"?le?le.p(l,de):(le=Co(l),le.c(),le.m(e,Q)):le&&(le.d(1),le=null),de[0]&264&&K!==(K=`haystack-readonly-${l[79]}-${l[87]}`)&&i(E,"id",K),de[0]&264&&(E.checked=l[3].roles[l[79]].haystacks[l[87]].read_only),de[0]&264&&Y!==(Y=`haystack-readonly-${l[79]}-${l[87]}`)&&i(R,"for",Y),de[0]&264&&I!==(I="remove-haystack-"+l[79]+"-"+l[87])&&i(ee,"data-testid",I)},d(fe){fe&&T(e),D.d(),ce&&ce.d(),se&&se.d(),le&&le.d(),B=!1,Qe(F)}}}function So(l){var ee;let e,t,n,o,c,r,u,a,d,p,m,_,v,k,C,w,b,y,g,$,z,M,N,L,q,Q,H,R,E;function K(){l[47].call(u,l[79])}function A(){return l[48](l[79])}let Y=((ee=l[0][l[79]])==null?void 0:ee.length)&&Ro(l);function Z(){l[50].call(g,l[79])}function J(){l[51].call(L,l[79])}return{c(){e=f("div"),t=f("label"),n=W("Model"),c=h(),r=f("div"),u=f("input"),d=h(),p=f("button"),p.textContent="Fetch models",m=h(),Y&&Y.c(),_=h(),v=f("div"),k=f("label"),C=W("Base URL"),b=h(),y=f("div"),g=f("input"),z=h(),M=f("div"),N=f("label"),L=f("input"),Q=W(`
               Automatically summarize search results`),i(t,"class","label"),i(t,"for",o=`llm-model-${l[79]}`),i(u,"class","input"),i(u,"id",a=`llm-model-${l[79]}`),i(u,"type","text"),i(u,"placeholder","llama3.1"),i(r,"class","control"),i(p,"class","button is-small"),i(e,"class","field"),i(k,"class","label"),i(k,"for",w=`llm-base-url-${l[79]}`),i(g,"class","input"),i(g,"id",$=`llm-base-url-${l[79]}`),i(g,"type","text"),i(g,"placeholder","http://127.0.0.1:11434"),i(y,"class","control"),i(v,"class","field"),i(L,"id",q=`llm-auto-summarize-${l[79]}`),i(L,"type","checkbox"),i(N,"class","checkbox"),i(N,"for",H=`llm-auto-summarize-${l[79]}`),i(M,"class","field")},m(P,I){S(P,e,I),s(e,t),s(t,n),s(e,c),s(e,r),s(r,u),Pe(u,l[3].roles[l[79]].llm_model),s(e,d),s(e,p),s(e,m),Y&&Y.m(e,null),S(P,_,I),S(P,v,I),s(v,k),s(k,C),s(v,b),s(v,y),s(y,g),Pe(g,l[3].roles[l[79]].llm_base_url),S(P,z,I),S(P,M,I),s(M,N),s(N,L),L.checked=l[3].roles[l[79]].llm_auto_summarize,s(N,Q),R||(E=[te(u,"input",K),te(p,"click",A),te(g,"input",Z),te(L,"change",J)],R=!0)},p(P,I){var B;l=P,I[0]&264&&o!==(o=`llm-model-${l[79]}`)&&i(t,"for",o),I[0]&264&&a!==(a=`llm-model-${l[79]}`)&&i(u,"id",a),I[0]&264&&u.value!==l[3].roles[l[79]].llm_model&&Pe(u,l[3].roles[l[79]].llm_model),(B=l[0][l[79]])!=null&&B.length?Y?Y.p(l,I):(Y=Ro(l),Y.c(),Y.m(e,null)):Y&&(Y.d(1),Y=null),I[0]&264&&w!==(w=`llm-base-url-${l[79]}`)&&i(k,"for",w),I[0]&264&&$!==($=`llm-base-url-${l[79]}`)&&i(g,"id",$),I[0]&264&&g.value!==l[3].roles[l[79]].llm_base_url&&Pe(g,l[3].roles[l[79]].llm_base_url),I[0]&264&&q!==(q=`llm-auto-summarize-${l[79]}`)&&i(L,"id",q),I[0]&264&&(L.checked=l[3].roles[l[79]].llm_auto_summarize),I[0]&264&&H!==(H=`llm-auto-summarize-${l[79]}`)&&i(N,"for",H)},d(P){P&&T(e),Y&&Y.d(),P&&T(_),P&&T(v),P&&T(z),P&&T(M),R=!1,Qe(E)}}}function Ro(l){let e,t,n,o,c=l[0][l[79]],r=[];for(let a=0;a<c.length;a+=1)r[a]=Eo(uo(l,c,a));function u(...a){return l[49](l[79],...a)}return{c(){e=f("div"),t=f("select");for(let a=0;a<r.length;a+=1)r[a].c();i(e,"class","select is-fullwidth"),ge(e,"margin-top","0.5rem")},m(a,d){S(a,e,d),s(e,t);for(let p=0;p<r.length;p+=1)r[p]&&r[p].m(t,null);n||(o=te(t,"change",u),n=!0)},p(a,d){if(l=a,d[0]&9){c=l[0][l[79]];let p;for(p=0;p<c.length;p+=1){const m=uo(l,c,p);r[p]?r[p].p(m,d):(r[p]=Eo(m),r[p].c(),r[p].m(t,null))}for(;p<r.length;p+=1)r[p].d(1);r.length=c.length}},d(a){a&&T(e),Xe(r,a),n=!1,o()}}}function Eo(l){let e,t=l[80]+"",n,o;return{c(){e=f("option"),n=W(t),e.__value=o=l[80],e.value=e.__value},m(c,r){S(c,e,r),s(e,n)},p(c,r){r[0]&9&&t!==(t=c[80]+"")&&we(n,t),r[0]&265&&o!==(o=c[80])&&(e.__value=o,e.value=e.__value)},d(c){c&&T(e)}}}function Lo(l){var de;let e,t,n,o,c,r,u,a,d,p,m,_,v,k,C,w,b,y,g,$,z,M,N,L,q,Q,H,R,E,K,A,Y,Z,J,ee,P,I,B,F,X,re,ie,D,O;function V(){l[53].call(u,l[79])}function ce(){l[54].call(y,l[79])}function se(){return l[55](l[79])}let le=((de=l[0][l[79]])==null?void 0:de.length)&&Ao(l);function me(){l[57].call(R,l[79])}function _e(){l[58].call(I,l[79])}let fe=l[3].roles[l[79]].openrouter_chat_enabled&&Oo(l);return{c(){e=f("div"),t=f("label"),n=W("OpenRouter API Key"),c=h(),r=f("div"),u=f("input"),d=h(),p=f("p"),p.innerHTML='Get your API key from <a href="https://openrouter.ai" target="_blank" rel="noopener">OpenRouter</a>',m=h(),_=f("div"),v=f("label"),k=W("Model"),w=h(),b=f("div"),y=f("input"),$=h(),z=f("button"),z.textContent="Fetch models",M=h(),le&&le.c(),N=h(),L=f("p"),L.textContent="Choose the language model for generating summaries. Different models offer different speed/quality tradeoffs.",q=h(),Q=f("div"),H=f("label"),R=f("input"),K=W(`
               Automatically summarize search results`),Y=h(),Z=f("p"),Z.textContent="When enabled, summaries will be generated and shown in search results.",J=h(),ee=f("div"),P=f("label"),I=f("input"),F=W(`
               Enable Chat interface (OpenRouter)`),re=h(),fe&&fe.c(),ie=ct(),i(t,"class","label"),i(t,"for",o=`openrouter-api-key-${l[79]}`),i(u,"class","input"),i(u,"id",a=`openrouter-api-key-${l[79]}`),i(u,"type","password"),i(u,"placeholder","sk-or-v1-..."),i(r,"class","control"),i(p,"class","help"),i(e,"class","field"),i(v,"class","label"),i(v,"for",C=`openrouter-model-${l[79]}`),i(y,"class","input"),i(y,"id",g=`openrouter-model-${l[79]}`),i(y,"type","text"),i(y,"placeholder","openai/gpt-4-turbo"),i(b,"class","control"),i(z,"class","button is-small"),i(L,"class","help"),i(_,"class","field"),i(R,"id",E=`openrouter-auto-summarize-${l[79]}`),i(R,"type","checkbox"),i(H,"class","checkbox"),i(H,"for",A=`openrouter-auto-summarize-${l[79]}`),i(Z,"class","help"),i(Q,"class","field"),i(I,"id",B=`openrouter-chat-enabled-${l[79]}`),i(I,"type","checkbox"),i(P,"class","checkbox"),i(P,"for",X=`openrouter-chat-enabled-${l[79]}`),i(ee,"class","field")},m(pe,he){S(pe,e,he),s(e,t),s(t,n),s(e,c),s(e,r),s(r,u),Pe(u,l[3].roles[l[79]].openrouter_api_key),s(e,d),s(e,p),S(pe,m,he),S(pe,_,he),s(_,v),s(v,k),s(_,w),s(_,b),s(b,y),Pe(y,l[3].roles[l[79]].openrouter_model),s(_,$),s(_,z),s(_,M),le&&le.m(_,null),s(_,N),s(_,L),S(pe,q,he),S(pe,Q,he),s(Q,H),s(H,R),R.checked=l[3].roles[l[79]].openrouter_auto_summarize,s(H,K),s(Q,Y),s(Q,Z),S(pe,J,he),S(pe,ee,he),s(ee,P),s(P,I),I.checked=l[3].roles[l[79]].openrouter_chat_enabled,s(P,F),S(pe,re,he),fe&&fe.m(pe,he),S(pe,ie,he),D||(O=[te(u,"input",V),te(y,"input",ce),te(z,"click",se),te(R,"change",me),te(I,"change",_e)],D=!0)},p(pe,he){var Se;l=pe,he[0]&264&&o!==(o=`openrouter-api-key-${l[79]}`)&&i(t,"for",o),he[0]&264&&a!==(a=`openrouter-api-key-${l[79]}`)&&i(u,"id",a),he[0]&264&&u.value!==l[3].roles[l[79]].openrouter_api_key&&Pe(u,l[3].roles[l[79]].openrouter_api_key),he[0]&264&&C!==(C=`openrouter-model-${l[79]}`)&&i(v,"for",C),he[0]&264&&g!==(g=`openrouter-model-${l[79]}`)&&i(y,"id",g),he[0]&264&&y.value!==l[3].roles[l[79]].openrouter_model&&Pe(y,l[3].roles[l[79]].openrouter_model),(Se=l[0][l[79]])!=null&&Se.length?le?le.p(l,he):(le=Ao(l),le.c(),le.m(_,N)):le&&(le.d(1),le=null),he[0]&264&&E!==(E=`openrouter-auto-summarize-${l[79]}`)&&i(R,"id",E),he[0]&264&&(R.checked=l[3].roles[l[79]].openrouter_auto_summarize),he[0]&264&&A!==(A=`openrouter-auto-summarize-${l[79]}`)&&i(H,"for",A),he[0]&264&&B!==(B=`openrouter-chat-enabled-${l[79]}`)&&i(I,"id",B),he[0]&264&&(I.checked=l[3].roles[l[79]].openrouter_chat_enabled),he[0]&264&&X!==(X=`openrouter-chat-enabled-${l[79]}`)&&i(P,"for",X),l[3].roles[l[79]].openrouter_chat_enabled?fe?fe.p(l,he):(fe=Oo(l),fe.c(),fe.m(ie.parentNode,ie)):fe&&(fe.d(1),fe=null)},d(pe){pe&&T(e),pe&&T(m),pe&&T(_),le&&le.d(),pe&&T(q),pe&&T(Q),pe&&T(J),pe&&T(ee),pe&&T(re),fe&&fe.d(pe),pe&&T(ie),D=!1,Qe(O)}}}function Ao(l){let e,t,n,o,c=l[0][l[79]],r=[];for(let a=0;a<c.length;a+=1)r[a]=Po(co(l,c,a));function u(...a){return l[56](l[79],...a)}return{c(){e=f("div"),t=f("select");for(let a=0;a<r.length;a+=1)r[a].c();i(e,"class","select is-fullwidth"),ge(e,"margin-top","0.5rem")},m(a,d){S(a,e,d),s(e,t);for(let p=0;p<r.length;p+=1)r[p]&&r[p].m(t,null);n||(o=te(t,"change",u),n=!0)},p(a,d){if(l=a,d[0]&9){c=l[0][l[79]];let p;for(p=0;p<c.length;p+=1){const m=co(l,c,p);r[p]?r[p].p(m,d):(r[p]=Po(m),r[p].c(),r[p].m(t,null))}for(;p<r.length;p+=1)r[p].d(1);r.length=c.length}},d(a){a&&T(e),Xe(r,a),n=!1,o()}}}function Po(l){let e,t=l[80]+"",n,o;return{c(){e=f("option"),n=W(t),e.__value=o=l[80],e.value=e.__value},m(c,r){S(c,e,r),s(e,n)},p(c,r){r[0]&9&&t!==(t=c[80]+"")&&we(n,t),r[0]&265&&o!==(o=c[80])&&(e.__value=o,e.value=e.__value)},d(c){c&&T(e)}}}function Oo(l){let e,t,n,o,c,r,u,a,d,p,m,_,v,k,C,w,b,y,g,$,z,M,N,L,q;function Q(){l[59].call(a,l[79])}function H(){l[60].call(M,l[79])}return{c(){e=f("div"),t=f("label"),n=W("Chat Model"),c=h(),r=f("div"),u=f("div"),a=f("select"),d=f("option"),d.textContent="GPT-3.5 Turbo",p=f("option"),p.textContent="GPT-4",m=f("option"),m.textContent="Claude 3 Sonnet",_=f("option"),_.textContent="Claude 3 Haiku",v=f("option"),v.textContent="Mixtral 8x7B",C=h(),w=f("div"),b=f("label"),y=W("System Prompt (optional)"),$=h(),z=f("div"),M=f("textarea"),i(t,"class","label"),i(t,"for",o=`openrouter-chat-model-${l[79]}`),d.__value="openai/gpt-3.5-turbo",d.value=d.__value,p.__value="openai/gpt-4",p.value=p.__value,m.__value="anthropic/claude-3-sonnet",m.value=m.__value,_.__value="anthropic/claude-3-haiku",_.value=_.__value,v.__value="mistralai/mixtral-8x7b-instruct",v.value=v.__value,i(a,"id",k=`openrouter-chat-model-${l[79]}`),l[3].roles[l[79]].openrouter_chat_model===void 0&&rt(Q),i(u,"class","select is-fullwidth"),i(r,"class","control"),i(e,"class","field"),i(b,"class","label"),i(b,"for",g=`openrouter-chat-system-${l[79]}`),i(M,"class","textarea"),i(M,"id",N=`openrouter-chat-system-${l[79]}`),i(M,"rows","3"),i(M,"placeholder","You are a helpful Rust engineer assistant..."),i(z,"class","control"),i(w,"class","field")},m(R,E){S(R,e,E),s(e,t),s(t,n),s(e,c),s(e,r),s(r,u),s(u,a),s(a,d),s(a,p),s(a,m),s(a,_),s(a,v),qe(a,l[3].roles[l[79]].openrouter_chat_model,!0),S(R,C,E),S(R,w,E),s(w,b),s(b,y),s(w,$),s(w,z),s(z,M),Pe(M,l[3].roles[l[79]].openrouter_chat_system_prompt),L||(q=[te(a,"change",Q),te(M,"input",H)],L=!0)},p(R,E){l=R,E[0]&264&&o!==(o=`openrouter-chat-model-${l[79]}`)&&i(t,"for",o),E[0]&264&&k!==(k=`openrouter-chat-model-${l[79]}`)&&i(a,"id",k),E[0]&264&&qe(a,l[3].roles[l[79]].openrouter_chat_model),E[0]&264&&g!==(g=`openrouter-chat-system-${l[79]}`)&&i(b,"for",g),E[0]&264&&N!==(N=`openrouter-chat-system-${l[79]}`)&&i(M,"id",N),E[0]&264&&Pe(M,l[3].roles[l[79]].openrouter_chat_system_prompt)},d(R){R&&T(e),R&&T(C),R&&T(w),L=!1,Qe(q)}}}function Mo(l){let e;return{c(){e=f("p"),e.textContent="Click to select directory",i(e,"class","help")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function No(l,e){let t,n,o,c,r,u,a,d,p,m,_,v,k,C,w,b,y,g,$,z,M,N,L,q,Q,H,R,E,K,A,Y,Z,J,ee,P,I,B,F,X,re,ie,D,O,V,ce,se,le,me,_e,fe,de,pe,he,Se,Ge,je,Le,Re,ne,ye,Oe,Be,Ke,$e,Me,Ze,Je,De,He,xe,ue,Ae,U,G,j,ae,Te,Ce,Ve,nt,ze,et,kt,ht,al,Ft,cl,Qt,qt,ul,Dt,wt,Wl,_l,Gl,hl,Rt,gl,Bl,Yt,Zt,Jl,vl,Vl,Kt,ft,bl,Ql,Yl,kl,Xt,xt,Zl,wl,Xl,yl,Pt,el,tl,Cl,xl,ll,jt,It,$l,en,Tl,tn,Wt,Ut,Sl,ln,Rl,nn,on,sn,Gt,rn,El,Dl,an;function vs(){e[26].call(d,e[79])}function bs(){e[27].call(y,e[79])}let nl=e[8],dt=[];for(let We=0;We<nl.length;We+=1)dt[We]=ko(mo(e,nl,We));function cn(){e[28].call(R,e[79])}function un(){e[29].call(B,e[79])}function ks(){e[30].call(le,e[79])}let ol=e[77].haystacks,pt=[];for(let We=0;We<ol.length;We+=1)pt[We]=To(fo(e,ol,We));function ws(){return e[45](e[79])}function fn(){e[46].call(De,e[79])}let gt=e[3].roles[e[79]].llm_provider==="ollama"&&So(e);function ys(){e[52].call(ze,e[79])}let vt=e[3].roles[e[79]].openrouter_enabled&&Lo(e);function Cs(){e[61].call(Rt,e[79])}function $s(){e[62].call(ft,e[79])}function dn(){return e[63](e[79])}let yt=e[4]&&Mo();function pn(){e[64].call(Pt,e[79])}function Ts(){e[65].call(It,e[79])}function Ss(){e[66].call(Ut,e[79])}function Rs(){return e[67](e[79])}return{key:l,first:null,c(){t=f("div"),n=f("div"),o=f("label"),c=W("Role name"),u=h(),a=f("div"),d=f("input"),m=h(),_=f("div"),v=f("label"),k=W("Short name"),w=h(),b=f("div"),y=f("input"),$=h(),z=f("div"),M=f("label"),N=W("Theme"),q=h(),Q=f("div"),H=f("div"),R=f("select");for(let We=0;We<dt.length;We+=1)dt[We].c();K=h(),A=f("div"),Y=f("label"),Z=W("Relevance function"),ee=h(),P=f("div"),I=f("div"),B=f("select"),F=f("option"),F.textContent="title-scorer",X=f("option"),X.textContent="terraphim-graph",re=f("option"),re.textContent="bm25",ie=f("option"),ie.textContent="bm25f",D=f("option"),D.textContent="bm25plus",V=h(),ce=f("div"),se=f("label"),le=f("input"),_e=W(`
            Enable Terraphim IT features (KG preprocessing, auto-linking)`),de=h(),pe=f("h5"),pe.textContent="Haystacks",he=h();for(let We=0;We<pt.length;We+=1)pt[We].c();Se=h(),Ge=f("button"),je=W("Add Haystack"),Re=h(),ne=f("h5"),ne.textContent="AI-Enhanced Summaries (LLM Provider)",ye=h(),Oe=f("div"),Be=f("label"),Ke=W("Provider"),Me=h(),Ze=f("div"),Je=f("div"),De=f("select"),He=f("option"),He.textContent="(none)",xe=f("option"),xe.textContent="OpenRouter",ue=f("option"),ue.textContent="Ollama (local)",U=h(),G=f("p"),G.textContent="Choose a provider. OpenRouter uses API key; Ollama runs locally.",j=h(),gt&&gt.c(),ae=h(),Te=f("h5"),Te.textContent="AI-Enhanced Summaries (OpenRouter)",Ce=h(),Ve=f("div"),nt=f("label"),ze=f("input"),kt=W(`
             Enable AI-generated article summaries`),al=h(),Ft=f("p"),Ft.textContent="Generate intelligent summaries using OpenRouter's language models",cl=h(),vt&&vt.c(),Qt=h(),qt=f("h5"),qt.textContent="Knowledge Graph",ul=h(),Dt=f("div"),wt=f("label"),Wl=W("Remote automata URL"),Gl=h(),hl=f("div"),Rt=f("input"),Bl=h(),Yt=f("div"),Zt=f("label"),Jl=W("Local KG path"),Vl=h(),Kt=f("div"),ft=f("input"),Ql=h(),yt&&yt.c(),Yl=h(),kl=f("div"),Xt=f("div"),xt=f("label"),Zl=W("Local KG type"),Xl=h(),yl=f("div"),Pt=f("select"),el=f("option"),el.textContent="markdown",tl=f("option"),tl.textContent="json",xl=h(),ll=f("div"),jt=f("label"),It=f("input"),en=W(`
             Public`),tn=h(),Wt=f("label"),Ut=f("input"),ln=W(`
             Publish`),nn=h(),on=f("hr"),sn=h(),Gt=f("button"),rn=W("Remove Role"),i(o,"class","label"),i(o,"for",r=`role-name-${e[79]}`),i(d,"class","input"),i(d,"id",p=`role-name-${e[79]}`),i(d,"type","text"),i(a,"class","control"),i(n,"class","field"),i(v,"class","label"),i(v,"for",C=`role-shortname-${e[79]}`),i(y,"class","input"),i(y,"id",g=`role-shortname-${e[79]}`),i(y,"type","text"),i(b,"class","control"),i(_,"class","field"),i(M,"class","label"),i(M,"for",L=`role-theme-${e[79]}`),i(R,"id",E=`role-theme-${e[79]}`),e[3].roles[e[79]].theme===void 0&&rt(cn),i(H,"class","select is-fullwidth"),i(Q,"class","control"),i(z,"class","field"),i(Y,"class","label"),i(Y,"for",J=`role-relevance-${e[79]}`),F.__value="title-scorer",F.value=F.__value,X.__value="terraphim-graph",X.value=X.__value,re.__value="bm25",re.value=re.__value,ie.__value="bm25f",ie.value=ie.__value,D.__value="bm25plus",D.value=D.__value,i(B,"id",O=`role-relevance-${e[79]}`),e[3].roles[e[79]].relevance_function===void 0&&rt(un),i(I,"class","select is-fullwidth"),i(P,"class","control"),i(A,"class","field"),i(le,"class","checkbox"),i(le,"id",me=`role-terraphim-it-${e[79]}`),i(le,"type","checkbox"),i(se,"class","label"),i(se,"for",fe=`role-terraphim-it-${e[79]}`),i(ce,"class","field"),i(pe,"class","title is-6"),i(Ge,"class","button is-small"),i(Ge,"data-testid",Le="add-haystack-"+e[79]),i(ne,"class","title is-6"),i(Be,"class","label"),i(Be,"for",$e=`llm-provider-${e[79]}`),He.__value="",He.value=He.__value,xe.__value="openrouter",xe.value=xe.__value,ue.__value="ollama",ue.value=ue.__value,i(De,"id",Ae=`llm-provider-${e[79]}`),e[3].roles[e[79]].llm_provider===void 0&&rt(fn),i(Je,"class","select"),i(Ze,"class","control"),i(G,"class","help"),i(Oe,"class","field"),i(Te,"class","title is-6"),i(ze,"id",et=`openrouter-enabled-${e[79]}`),i(ze,"type","checkbox"),i(nt,"class","checkbox"),i(nt,"for",ht=`openrouter-enabled-${e[79]}`),i(Ft,"class","help"),i(Ve,"class","field"),i(qt,"class","title is-6"),i(wt,"class","label"),i(wt,"for",_l=`kg-url-${e[79]}`),i(Rt,"class","input"),i(Rt,"id",gl=`kg-url-${e[79]}`),i(Rt,"type","text"),i(Rt,"placeholder","https://example.com/thesaurus.json"),i(hl,"class","control"),i(Dt,"class","field"),i(Zt,"class","label"),i(Zt,"for",vl=`kg-local-path-${e[79]}`),i(ft,"class","input"),i(ft,"id",bl=`kg-local-path-${e[79]}`),i(ft,"type","text"),i(ft,"placeholder","/path/to/markdown"),ft.readOnly=e[4],i(Kt,"class","control"),i(Yt,"class","field"),i(xt,"class","label"),i(xt,"for",wl=`kg-local-type-${e[79]}`),el.__value="markdown",el.value=el.__value,tl.__value="json",tl.value=tl.__value,i(Pt,"id",Cl=`kg-local-type-${e[79]}`),e[3].roles[e[79]].kg.local_type===void 0&&rt(pn),i(yl,"class","select"),i(Xt,"class","control"),i(kl,"class","field is-grouped"),i(It,"id",$l=`kg-public-${e[79]}`),i(It,"type","checkbox"),i(jt,"class","checkbox"),i(jt,"for",Tl=`kg-public-${e[79]}`),ge(jt,"margin-right","1rem"),i(Ut,"id",Sl=`kg-publish-${e[79]}`),i(Ut,"type","checkbox"),i(Wt,"class","checkbox"),i(Wt,"for",Rl=`kg-publish-${e[79]}`),i(ll,"class","field is-grouped"),i(Gt,"class","button is-small is-danger"),i(Gt,"data-testid",El="remove-role-"+e[79]),i(t,"class","box"),this.first=t},m(We,Ee){S(We,t,Ee),s(t,n),s(n,o),s(o,c),s(n,u),s(n,a),s(a,d),Pe(d,e[3].roles[e[79]].name),s(t,m),s(t,_),s(_,v),s(v,k),s(_,w),s(_,b),s(b,y),Pe(y,e[3].roles[e[79]].shortname),s(t,$),s(t,z),s(z,M),s(M,N),s(z,q),s(z,Q),s(Q,H),s(H,R);for(let Ie=0;Ie<dt.length;Ie+=1)dt[Ie]&&dt[Ie].m(R,null);qe(R,e[3].roles[e[79]].theme,!0),s(t,K),s(t,A),s(A,Y),s(Y,Z),s(A,ee),s(A,P),s(P,I),s(I,B),s(B,F),s(B,X),s(B,re),s(B,ie),s(B,D),qe(B,e[3].roles[e[79]].relevance_function,!0),s(t,V),s(t,ce),s(ce,se),s(se,le),le.checked=e[3].roles[e[79]].terraphim_it,s(se,_e),s(t,de),s(t,pe),s(t,he);for(let Ie=0;Ie<pt.length;Ie+=1)pt[Ie]&&pt[Ie].m(t,null);s(t,Se),s(t,Ge),s(Ge,je),s(t,Re),s(t,ne),s(t,ye),s(t,Oe),s(Oe,Be),s(Be,Ke),s(Oe,Me),s(Oe,Ze),s(Ze,Je),s(Je,De),s(De,He),s(De,xe),s(De,ue),qe(De,e[3].roles[e[79]].llm_provider,!0),s(Oe,U),s(Oe,G),s(t,j),gt&&gt.m(t,null),s(t,ae),s(t,Te),s(t,Ce),s(t,Ve),s(Ve,nt),s(nt,ze),ze.checked=e[3].roles[e[79]].openrouter_enabled,s(nt,kt),s(Ve,al),s(Ve,Ft),s(t,cl),vt&&vt.m(t,null),s(t,Qt),s(t,qt),s(t,ul),s(t,Dt),s(Dt,wt),s(wt,Wl),s(Dt,Gl),s(Dt,hl),s(hl,Rt),Pe(Rt,e[3].roles[e[79]].kg.url),s(t,Bl),s(t,Yt),s(Yt,Zt),s(Zt,Jl),s(Yt,Vl),s(Yt,Kt),s(Kt,ft),Pe(ft,e[3].roles[e[79]].kg.local_path),s(Kt,Ql),yt&&yt.m(Kt,null),s(t,Yl),s(t,kl),s(kl,Xt),s(Xt,xt),s(xt,Zl),s(Xt,Xl),s(Xt,yl),s(yl,Pt),s(Pt,el),s(Pt,tl),qe(Pt,e[3].roles[e[79]].kg.local_type,!0),s(t,xl),s(t,ll),s(ll,jt),s(jt,It),It.checked=e[3].roles[e[79]].kg.public,s(jt,en),s(ll,tn),s(ll,Wt),s(Wt,Ut),Ut.checked=e[3].roles[e[79]].kg.publish,s(Wt,ln),s(t,nn),s(t,on),s(t,sn),s(t,Gt),s(Gt,rn),Dl||(an=[te(d,"input",vs),te(y,"input",bs),te(R,"change",cn),te(B,"change",un),te(le,"change",ks),te(Ge,"click",ws),te(De,"change",fn),te(ze,"change",ys),te(Rt,"input",Cs),te(ft,"input",$s),te(ft,"click",function(){Fl(e[4]?dn:void 0)&&(e[4]?dn:void 0).apply(this,arguments)}),te(Pt,"change",pn),te(It,"change",Ts),te(Ut,"change",Ss),te(Gt,"click",Rs)],Dl=!0)},p(We,Ee){if(e=We,Ee[0]&264&&r!==(r=`role-name-${e[79]}`)&&i(o,"for",r),Ee[0]&264&&p!==(p=`role-name-${e[79]}`)&&i(d,"id",p),Ee[0]&264&&d.value!==e[3].roles[e[79]].name&&Pe(d,e[3].roles[e[79]].name),Ee[0]&264&&C!==(C=`role-shortname-${e[79]}`)&&i(v,"for",C),Ee[0]&264&&g!==(g=`role-shortname-${e[79]}`)&&i(y,"id",g),Ee[0]&264&&y.value!==e[3].roles[e[79]].shortname&&Pe(y,e[3].roles[e[79]].shortname),Ee[0]&264&&L!==(L=`role-theme-${e[79]}`)&&i(M,"for",L),Ee[0]&256){nl=e[8];let Ie;for(Ie=0;Ie<nl.length;Ie+=1){const fl=mo(e,nl,Ie);dt[Ie]?dt[Ie].p(fl,Ee):(dt[Ie]=ko(fl),dt[Ie].c(),dt[Ie].m(R,null))}for(;Ie<dt.length;Ie+=1)dt[Ie].d(1);dt.length=nl.length}if(Ee[0]&264&&E!==(E=`role-theme-${e[79]}`)&&i(R,"id",E),Ee[0]&264&&qe(R,e[3].roles[e[79]].theme),Ee[0]&264&&J!==(J=`role-relevance-${e[79]}`)&&i(Y,"for",J),Ee[0]&264&&O!==(O=`role-relevance-${e[79]}`)&&i(B,"id",O),Ee[0]&264&&qe(B,e[3].roles[e[79]].relevance_function),Ee[0]&264&&me!==(me=`role-terraphim-it-${e[79]}`)&&i(le,"id",me),Ee[0]&264&&(le.checked=e[3].roles[e[79]].terraphim_it),Ee[0]&264&&fe!==(fe=`role-terraphim-it-${e[79]}`)&&i(se,"for",fe),Ee[0]&491576){ol=e[77].haystacks;let Ie;for(Ie=0;Ie<ol.length;Ie+=1){const fl=fo(e,ol,Ie);pt[Ie]?pt[Ie].p(fl,Ee):(pt[Ie]=To(fl),pt[Ie].c(),pt[Ie].m(t,Se))}for(;Ie<pt.length;Ie+=1)pt[Ie].d(1);pt.length=ol.length}Ee[0]&264&&Le!==(Le="add-haystack-"+e[79])&&i(Ge,"data-testid",Le),Ee[0]&264&&$e!==($e=`llm-provider-${e[79]}`)&&i(Be,"for",$e),Ee[0]&264&&Ae!==(Ae=`llm-provider-${e[79]}`)&&i(De,"id",Ae),Ee[0]&264&&qe(De,e[3].roles[e[79]].llm_provider),e[3].roles[e[79]].llm_provider==="ollama"?gt?gt.p(e,Ee):(gt=So(e),gt.c(),gt.m(t,ae)):gt&&(gt.d(1),gt=null),Ee[0]&264&&et!==(et=`openrouter-enabled-${e[79]}`)&&i(ze,"id",et),Ee[0]&264&&(ze.checked=e[3].roles[e[79]].openrouter_enabled),Ee[0]&264&&ht!==(ht=`openrouter-enabled-${e[79]}`)&&i(nt,"for",ht),e[3].roles[e[79]].openrouter_enabled?vt?vt.p(e,Ee):(vt=Lo(e),vt.c(),vt.m(t,Qt)):vt&&(vt.d(1),vt=null),Ee[0]&264&&_l!==(_l=`kg-url-${e[79]}`)&&i(wt,"for",_l),Ee[0]&264&&gl!==(gl=`kg-url-${e[79]}`)&&i(Rt,"id",gl),Ee[0]&264&&Rt.value!==e[3].roles[e[79]].kg.url&&Pe(Rt,e[3].roles[e[79]].kg.url),Ee[0]&264&&vl!==(vl=`kg-local-path-${e[79]}`)&&i(Zt,"for",vl),Ee[0]&264&&bl!==(bl=`kg-local-path-${e[79]}`)&&i(ft,"id",bl),Ee[0]&16&&(ft.readOnly=e[4]),Ee[0]&264&&ft.value!==e[3].roles[e[79]].kg.local_path&&Pe(ft,e[3].roles[e[79]].kg.local_path),e[4]?yt||(yt=Mo(),yt.c(),yt.m(Kt,null)):yt&&(yt.d(1),yt=null),Ee[0]&264&&wl!==(wl=`kg-local-type-${e[79]}`)&&i(xt,"for",wl),Ee[0]&264&&Cl!==(Cl=`kg-local-type-${e[79]}`)&&i(Pt,"id",Cl),Ee[0]&264&&qe(Pt,e[3].roles[e[79]].kg.local_type),Ee[0]&264&&$l!==($l=`kg-public-${e[79]}`)&&i(It,"id",$l),Ee[0]&264&&(It.checked=e[3].roles[e[79]].kg.public),Ee[0]&264&&Tl!==(Tl=`kg-public-${e[79]}`)&&i(jt,"for",Tl),Ee[0]&264&&Sl!==(Sl=`kg-publish-${e[79]}`)&&i(Ut,"id",Sl),Ee[0]&264&&(Ut.checked=e[3].roles[e[79]].kg.publish),Ee[0]&264&&Rl!==(Rl=`kg-publish-${e[79]}`)&&i(Wt,"for",Rl),Ee[0]&264&&El!==(El="remove-role-"+e[79])&&i(Gt,"data-testid",El)},d(We){We&&T(t),Xe(dt,We),Xe(pt,We),gt&&gt.d(),vt&&vt.d(),yt&&yt.d(),Dl=!1,Qe(an)}}}function Do(l){let e,t=l[74]+"",n;return{c(){e=f("option"),n=W(t),e.__value=l[74],e.value=e.__value},m(o,c){S(o,e,c),s(e,n)},p:Ne,d(o){o&&T(e)}}}function Io(l){let e,t=l[71].name+"",n,o;return{c(){e=f("option"),n=W(t),e.__value=o=l[71].name,e.value=e.__value},m(c,r){S(c,e,r),s(e,n)},p(c,r){r[0]&8&&t!==(t=c[71].name+"")&&we(n,t),r[0]&264&&o!==(o=c[71].name)&&(e.__value=o,e.value=e.__value)},d(c){c&&T(e)}}}function Uo(l){let e,t,n;return{c(){e=f("button"),e.textContent="Back",i(e,"class","button"),i(e,"data-testid","wizard-back")},m(o,c){S(o,e,c),t||(n=te(e,"click",l[11]),t=!0)},p:Ne,d(o){o&&T(e),t=!1,n()}}}function Vi(l){let e,t,n;return{c(){e=f("button"),e.textContent="Save",i(e,"class","button is-success"),i(e,"data-testid","wizard-save")},m(o,c){S(o,e,c),t||(n=te(e,"click",l[19]),t=!0)},p:Ne,d(o){o&&T(e),t=!1,n()}}}function Qi(l){let e,t,n;return{c(){e=f("button"),e.textContent="Next",i(e,"class","button is-primary"),i(e,"data-testid","wizard-next")},m(o,c){S(o,e,c),t||(n=te(e,"click",l[10]),t=!0)},p:Ne,d(o){o&&T(e),t=!1,n()}}}function Yi(l){let e,t,n,o,c,r,u,a,d,p,m,_,v,k,C,w,b,y;e=new il({props:{fallbackPath:"/"}});let g=l[2]==="success"&&go(l),$=l[2]==="error"&&vo(l);function z(R,E){return R[1]===1?Gi:R[1]===2?Wi:Ki}let M=z(l),N=M(l),L=l[1]>1&&Uo(l);function q(R,E){return R[1]<gs?Qi:Vi}let Q=q(l),H=Q(l);return{c(){ve(e.$$.fragment),t=h(),n=f("div"),o=f("div"),c=f("h3"),c.textContent="Configuration Wizard",r=h(),u=f("button"),u.textContent="Close",a=h(),g&&g.c(),d=h(),$&&$.c(),p=h(),N.c(),m=h(),_=f("nav"),v=f("div"),L&&L.c(),k=h(),C=f("div"),H.c(),i(c,"class","title is-4"),ge(c,"margin-bottom","0"),i(u,"class","button is-small is-light"),i(u,"aria-label","Close configuration wizard"),i(o,"class","is-flex is-justify-content-space-between is-align-items-center"),ge(o,"gap",".5rem"),i(v,"class","level-left"),i(C,"class","level-right"),i(_,"class","level"),i(n,"class","box")},m(R,E){be(e,R,E),S(R,t,E),S(R,n,E),s(n,o),s(o,c),s(o,r),s(o,u),s(n,a),g&&g.m(n,null),s(n,d),$&&$.m(n,null),s(n,p),N.m(n,null),s(n,m),s(n,_),s(_,v),L&&L.m(v,null),s(_,k),s(_,C),H.m(C,null),w=!0,b||(y=te(u,"click",Zi),b=!0)},p(R,E){R[2]==="success"?g?g.p(R,E):(g=go(R),g.c(),g.m(n,d)):g&&(g.d(1),g=null),R[2]==="error"?$?$.p(R,E):($=vo(R),$.c(),$.m(n,p)):$&&($.d(1),$=null),M===(M=z(R))&&N?N.p(R,E):(N.d(1),N=M(R),N&&(N.c(),N.m(n,m))),R[1]>1?L?L.p(R,E):(L=Uo(R),L.c(),L.m(v,null)):L&&(L.d(1),L=null),Q===(Q=q(R))&&H?H.p(R,E):(H.d(1),H=Q(R),H&&(H.c(),H.m(C,null)))},i(R){w||(x(e.$$.fragment,R),w=!0)},o(R){oe(e.$$.fragment,R),w=!1},d(R){ke(e,R),R&&T(t),R&&T(n),g&&g.d(),$&&$.d(),N.d(),L&&L.d(),H.d(),b=!1,y()}}}const gs=3;function Zi(){typeof window<"u"&&window.history.back()}function Xi(l,e,t){let n,o;Ue(l,ot,U=>t(4,o=U));const c=At(null);async function r(U,G){if(St(ot))try{const j=await ro({directory:!0,multiple:!1});j&&typeof j=="string"&&a.update(ae=>(ae.roles[U].haystacks[G].path=j,ae))}catch(j){console.error("Failed to open folder selector:",j)}}async function u(U){if(St(ot))try{const G=await ro({directory:!0,multiple:!1});G&&typeof G=="string"&&a.update(j=>(j.roles[U].kg.local_path=G,j))}catch(G){console.error("Failed to open folder selector:",G)}}const a=At({id:"Desktop",global_shortcut:"Ctrl+X",default_theme:"spacelab",default_role:"Default",roles:[]});Ue(l,a,U=>t(3,n=U));const d=["default","darkly","cerulean","cosmo","cyborg","flatly","journal","litera","lumen","lux","materia","minty","nuclear","pulse","sandstone","simplex","slate","solar","spacelab","superhero","united","yeti"];Jt(async()=>{try{let U;St(ot)?U=await Fe("get_config_schema"):U=await(await fetch("/config/schema")).json(),c.set(U);const G=St(Lt);G&&G.id&&a.update(j=>{var ae;return{...j,id:G.id,global_shortcut:G.global_shortcut,default_theme:((ae=G.roles[G.default_role])==null?void 0:ae.theme)??"spacelab",default_role:G.default_role,roles:Object.values(G.roles).map(Te=>{var ze,et,kt,ht,al,Ft,cl,Qt,qt,ul,Dt;const Ce=(ze=Te.kg)==null?void 0:ze.automata_path,Ve=(Ce==null?void 0:Ce.Remote)??"",nt=((kt=(et=Te.kg)==null?void 0:et.knowledge_graph_local)==null?void 0:kt.path)??"";return{name:Te.name,shortname:Te.shortname,relevance_function:Te.relevance_function,terraphim_it:Te.terraphim_it??!1,theme:Te.theme,haystacks:(Te.haystacks??[]).map(wt=>({path:wt.location||wt.path||"",read_only:wt.read_only??!1,service:wt.service||"Ripgrep",atomic_server_secret:wt.atomic_server_secret||"",extra_parameters:wt.extra_parameters||{}})),kg:{url:Ve,local_path:nt,local_type:((al=(ht=Te.kg)==null?void 0:ht.knowledge_graph_local)==null?void 0:al.input_type)??"markdown",public:((Ft=Te.kg)==null?void 0:Ft.public)??!1,publish:((cl=Te.kg)==null?void 0:cl.publish)??!1},openrouter_enabled:Te.openrouter_enabled??!1,openrouter_api_key:Te.openrouter_api_key??"",openrouter_model:Te.openrouter_model??"openai/gpt-3.5-turbo",openrouter_auto_summarize:Te.openrouter_auto_summarize??!1,openrouter_chat_enabled:Te.openrouter_chat_enabled??!1,openrouter_chat_model:Te.openrouter_chat_model??Te.openrouter_model??"openai/gpt-3.5-turbo",openrouter_chat_system_prompt:Te.openrouter_chat_system_prompt??"",llm_provider:((Qt=Te.extra)==null?void 0:Qt.llm_provider)??"",llm_model:((qt=Te.extra)==null?void 0:qt.llm_model)??"",llm_base_url:((ul=Te.extra)==null?void 0:ul.llm_base_url)??"",llm_auto_summarize:((Dt=Te.extra)==null?void 0:Dt.llm_auto_summarize)??!1}})}})}catch(U){console.error("Failed to load schema",U)}}),Jt(()=>{const U=G=>{G.key==="Escape"&&typeof window<"u"&&window.history.back()};return window.addEventListener("keydown",U),()=>window.removeEventListener("keydown",U)});let p={};async function m(U){var Ce;const j=St(a).roles[U],ae=j.llm_provider||(j.openrouter_enabled?"openrouter":""),Te=[];try{if(ae==="ollama"){const Ve=(j.llm_base_url||"http://127.0.0.1:11434").replace(/\/$/,""),ze=await(await fetch(`${Ve}/api/tags`)).json();if(Array.isArray(ze==null?void 0:ze.models))for(const et of ze.models)et!=null&&et.name&&Te.push(et.name)}else if(ae==="openrouter"){const Ve=(Ce=j.openrouter_api_key)==null?void 0:Ce.trim();if(!Ve)throw new Error("OpenRouter API key required");const ze=await(await fetch("https://openrouter.ai/api/v1/models",{headers:{Authorization:`Bearer ${Ve}`,"HTTP-Referer":"https://terraphim.ai","X-Title":"Terraphim Desktop"}})).json(),et=Array.isArray(ze==null?void 0:ze.data)?ze.data:[];for(const kt of et)kt!=null&&kt.id&&Te.push(kt.id)}}catch(Ve){console.error("Failed to fetch models",Ve)}t(0,p={...p,[U]:Te})}let _=1,v="";function k(){_<gs&&t(1,_+=1)}function C(){_>1&&t(1,_-=1)}function w(){a.update(U=>({...U,roles:[...U.roles,{name:"New Role",shortname:"new",relevance_function:"title-scorer",terraphim_it:!1,theme:"spacelab",haystacks:[],kg:{url:"",local_path:"",local_type:"markdown",public:!1,publish:!1},openrouter_enabled:!1,openrouter_api_key:"",openrouter_model:"openai/gpt-3.5-turbo",openrouter_auto_summarize:!1,openrouter_chat_enabled:!1,openrouter_chat_model:"openai/gpt-3.5-turbo",openrouter_chat_system_prompt:"",llm_provider:"",llm_model:"",llm_base_url:"",llm_auto_summarize:!1}]}))}function b(U){a.update(G=>({...G,roles:G.roles.filter((j,ae)=>ae!==U)}))}function y(U){a.update(G=>(G.roles[U].haystacks.push({path:"",read_only:!1,service:"Ripgrep",atomic_server_secret:"",extra_parameters:{}}),G))}function g(U,G){a.update(j=>(j.roles[U].haystacks=j.roles[U].haystacks.filter((ae,Te)=>Te!==G),j))}function $(U,G,j="",ae=""){a.update(Te=>{Te.roles[U].haystacks[G].extra_parameters||(Te.roles[U].haystacks[G].extra_parameters={});const Ce=j||`param_${Date.now()}`;return Te.roles[U].haystacks[G].extra_parameters[Ce]=ae,Te})}function z(U,G,j){a.update(ae=>(delete ae.roles[U].haystacks[G].extra_parameters[j],ae))}function M(U,G,j,ae){a.update(Te=>{const Ce=Te.roles[U].haystacks[G].extra_parameters;return Ce[j]!==void 0&&j!==ae&&(Ce[ae]=Ce[j],delete Ce[j]),Te})}function N(U,G,j,ae){const Te=ae.target.value;M(U,G,j,Te)}async function L(){var Te;const U=St(a),G=St(Lt);let j={...G};j.id=U.id,j.global_shortcut=U.global_shortcut,j.default_role=U.default_role;const ae={};U.roles.forEach(Ce=>{var et,kt;const Ve=Ce.name,nt=Ve.replace(/^"|"$/g,"");ae[nt]={extra:((kt=(et=G.roles)==null?void 0:et[Ve])==null?void 0:kt.extra)??{},name:Ce.name,shortname:Ce.shortname,theme:Ce.theme,relevance_function:Ce.relevance_function,terraphim_it:Ce.terraphim_it??!1,haystacks:Ce.haystacks.map(ht=>({location:ht.path,service:ht.service,read_only:ht.read_only,atomic_server_secret:ht.service==="Atomic"?ht.atomic_server_secret:void 0,extra_parameters:ht.extra_parameters||{}})),kg:Ce.kg.url||Ce.kg.local_path?{automata_path:Ce.kg.url?{Remote:Ce.kg.url}:null,knowledge_graph_local:Ce.kg.local_path?{input_type:Ce.kg.local_type,path:Ce.kg.local_path}:null,public:Ce.kg.public,publish:Ce.kg.publish}:null,...Ce.openrouter_enabled&&{openrouter_enabled:Ce.openrouter_enabled,openrouter_api_key:Ce.openrouter_api_key,openrouter_model:Ce.openrouter_model,openrouter_auto_summarize:Ce.openrouter_auto_summarize??!1,openrouter_chat_enabled:Ce.openrouter_chat_enabled??!1,openrouter_chat_model:Ce.openrouter_chat_model??Ce.openrouter_model,openrouter_chat_system_prompt:Ce.openrouter_chat_system_prompt??""}};const ze={};Ce.llm_provider&&(ze.llm_provider=Ce.llm_provider),Ce.llm_model&&(ze.llm_model=Ce.llm_model),Ce.llm_base_url&&(ze.llm_base_url=Ce.llm_base_url),typeof Ce.llm_auto_summarize=="boolean"&&(ze.llm_auto_summarize=Ce.llm_auto_summarize),ae[nt].extra={...ae[nt].extra||{},...ze}}),j.roles=ae,(!j.default_role||!ae[j.default_role])&&(j.default_role=((Te=U.roles[0])==null?void 0:Te.name)??"Default"),j.selected_role=j.default_role;try{if(St(ot))await Fe("update_config",{configNew:j});else{const Ce=await fetch("/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(j)});if(!Ce.ok)throw new Error(`HTTP ${Ce.status}: ${Ce.statusText}`)}Lt.set(j),t(2,v="success"),setTimeout(()=>{t(2,v="")},3e3)}catch(Ce){console.error(Ce),t(2,v="error"),setTimeout(()=>{t(2,v="")},3e3)}}const q=()=>t(2,v=""),Q=()=>t(2,v="");function H(){n.id=Tt(this),a.set(n),t(8,d)}function R(){n.global_shortcut=this.value,a.set(n),t(8,d)}function E(){n.default_theme=Tt(this),a.set(n),t(8,d)}function K(){n.default_role=Tt(this),a.set(n),t(8,d)}function A(U){n.roles[U].name=this.value,a.set(n),t(8,d)}function Y(U){n.roles[U].shortname=this.value,a.set(n),t(8,d)}function Z(U){n.roles[U].theme=Tt(this),a.set(n),t(8,d)}function J(U){n.roles[U].relevance_function=Tt(this),a.set(n),t(8,d)}function ee(U){n.roles[U].terraphim_it=this.checked,a.set(n),t(8,d)}function P(U,G){n.roles[U].haystacks[G].service=Tt(this),a.set(n),t(8,d)}function I(U,G){n.roles[U].haystacks[G].path=this.value,a.set(n),t(8,d)}const B=(U,G)=>r(U,G);function F(U,G){n.roles[U].haystacks[G].atomic_server_secret=this.value,a.set(n),t(8,d)}function X(U,G){n.roles[U].haystacks[G].extra_parameters.tag=this.value,a.set(n),t(8,d)}const re=(U,G,j)=>{const ae=j.currentTarget.value;ae&&pl(a,n.roles[U].haystacks[G].extra_parameters.tag=ae,n)},ie=(U,G,j,ae)=>N(U,G,j,ae);function D(U,G,j){n.roles[U].haystacks[G].extra_parameters[j]=this.value,a.set(n),t(8,d)}const O=(U,G,j)=>z(U,G,j),V=(U,G)=>$(U,G,"tag","#rust"),ce=(U,G)=>$(U,G,"max_count","10"),se=(U,G)=>$(U,G,"","");function le(U,G){n.roles[U].haystacks[G].read_only=this.checked,a.set(n),t(8,d)}const me=(U,G)=>g(U,G),_e=U=>y(U);function fe(U){n.roles[U].llm_provider=Tt(this),a.set(n),t(8,d)}function de(U){n.roles[U].llm_model=this.value,a.set(n),t(8,d)}const pe=U=>m(U),he=(U,G)=>{pl(a,n.roles[U].llm_model=G.currentTarget.value,n)};function Se(U){n.roles[U].llm_base_url=this.value,a.set(n),t(8,d)}function Ge(U){n.roles[U].llm_auto_summarize=this.checked,a.set(n),t(8,d)}function je(U){n.roles[U].openrouter_enabled=this.checked,a.set(n),t(8,d)}function Le(U){n.roles[U].openrouter_api_key=this.value,a.set(n),t(8,d)}function Re(U){n.roles[U].openrouter_model=this.value,a.set(n),t(8,d)}const ne=U=>m(U),ye=(U,G)=>{pl(a,n.roles[U].openrouter_model=G.currentTarget.value,n)};function Oe(U){n.roles[U].openrouter_auto_summarize=this.checked,a.set(n),t(8,d)}function Be(U){n.roles[U].openrouter_chat_enabled=this.checked,a.set(n),t(8,d)}function Ke(U){n.roles[U].openrouter_chat_model=Tt(this),a.set(n),t(8,d)}function $e(U){n.roles[U].openrouter_chat_system_prompt=this.value,a.set(n),t(8,d)}function Me(U){n.roles[U].kg.url=this.value,a.set(n),t(8,d)}function Ze(U){n.roles[U].kg.local_path=this.value,a.set(n),t(8,d)}const Je=U=>u(U);function De(U){n.roles[U].kg.local_type=Tt(this),a.set(n),t(8,d)}function He(U){n.roles[U].kg.public=this.checked,a.set(n),t(8,d)}function xe(U){n.roles[U].kg.publish=this.checked,a.set(n),t(8,d)}return[p,_,v,n,o,r,u,a,d,m,k,C,w,b,y,g,$,z,N,L,q,Q,H,R,E,K,A,Y,Z,J,ee,P,I,B,F,X,re,ie,D,O,V,ce,se,le,me,_e,fe,de,pe,he,Se,Ge,je,Le,Re,ne,ye,Oe,Be,Ke,$e,Me,Ze,Je,De,He,xe,U=>b(U),()=>{t(1,_=2)}]}class xi extends mt{constructor(e){super(),_t(this,e,Xi,Yi,ut,{},null,[-1,-1,-1,-1])}}function ea(l){let e,t,n,o,c,r,u,a;return e=new il({props:{fallbackPath:"/"}}),u=new ps({props:{content:l[0],onChange:l[1]}}),{c(){ve(e.$$.fragment),t=h(),n=f("div"),o=f("p"),o.innerHTML="<i>The best editing experience is to configure Atomic Server, in the meantime use editor below. You will need to refresh page via Command R or Ctrl-R to see changes</i>",c=h(),r=f("div"),ve(u.$$.fragment),i(r,"class","editor"),i(n,"class","box")},m(d,p){be(e,d,p),S(d,t,p),S(d,n,p),s(n,o),s(n,c),s(n,r),be(u,r,null),a=!0},p(d,[p]){const m={};p&1&&(m.content=d[0]),u.$set(m)},i(d){a||(x(e.$$.fragment,d),x(u.$$.fragment,d),a=!0)},o(d){oe(e.$$.fragment,d),oe(u.$$.fragment,d),a=!1},d(d){ke(e,d),d&&T(t),d&&T(n),ke(u)}}}function ta(l,e,t){let n,o;Ue(l,Lt,u=>t(2,n=u)),Ue(l,ot,u=>t(3,o=u));let c={json:n};function r(u){if(console.log("contents changed:",u),console.log("is tauri",o),Lt.update(a=>(a=u.json,a)),St(ot))console.log("Updating config on server"),Fe("update_config",{configNew:u.json}).then(a=>{console.log(`Message: ${a}`)}).catch(a=>console.error(a));else{let a=`${Ye.ServerURL}/config/`;fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u.json)})}t(0,c=u)}return Jt(()=>{t(0,c={json:n})}),[c,r]}class la extends mt{constructor(e){super(),_t(this,e,ta,ea,ut,{})}}const{window:zl}=Us;function na(l){let e,t,n,o,c,r,u,a,d,p;return{c(){e=f("div"),t=f("div"),n=f("h3"),n.textContent="Error loading graph",o=h(),c=f("p"),r=W(l[3]),u=h(),a=f("button"),a.textContent="Retry",i(a,"class","button is-primary"),i(t,"class","error-content svelte-1ry9pkl"),i(e,"class","error-overlay svelte-1ry9pkl")},m(m,_){S(m,e,_),s(e,t),s(t,n),s(t,o),s(t,c),s(c,r),s(t,u),s(t,a),d||(p=te(a,"click",l[11]),d=!0)},p(m,_){_&8&&we(r,m[3])},d(m){m&&T(e),d=!1,p()}}}function oa(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="loading-content svelte-1ry9pkl"><div class="loader svelte-1ry9pkl"></div>
        <p>Loading knowledge graph...</p></div>`,i(e,"class","loading-overlay svelte-1ry9pkl")},m(t,n){S(t,e,n)},p:Ne,d(t){t&&T(e)}}}function jo(l){let e,t,n;return{c(){e=f("button"),e.innerHTML='<i class="fas fa-times svelte-1ry9pkl"></i>',i(e,"class","close-button svelte-1ry9pkl"),i(e,"title","Close Graph")},m(o,c){S(o,e,c),t||(n=te(e,"click",l[17]),t=!0)},p:Ne,d(o){o&&T(e),t=!1,n()}}}function Ho(l){let e;return{c(){e=f("div"),e.innerHTML="<span><strong>Left-click:</strong> View node • <strong>Right-click:</strong> Edit node • <strong>Drag:</strong> Move • <strong>Scroll:</strong> Zoom</span>",i(e,"class","controls-info svelte-1ry9pkl")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function zo(l){let e,t;return{c(){e=f("div"),t=W(l[8]),i(e,"class","debug-message svelte-1ry9pkl")},m(n,o){S(n,e,o),s(e,t)},p(n,o){o&256&&we(t,n[8])},d(n){n&&T(e)}}}function Fo(l){let e=l[5].id,t,n,o=qo(l);return{c(){o.c(),t=ct()},m(c,r){o.m(c,r),S(c,t,r),n=!0},p(c,r){r&32&&ut(e,e=c[5].id)?(tt(),oe(o,1,1,Ne),lt(),o=qo(c),o.c(),x(o,1),o.m(t.parentNode,t)):o.p(c,r)},i(c){n||(x(o),n=!0)},o(c){oe(o),n=!1},d(c){c&&T(t),o.d(c)}}}function qo(l){let e,t,n;function o(r){l[18](r)}let c={item:l[5],initialEdit:l[7]};return l[6]!==void 0&&(c.active=l[6]),e=new ql({props:c}),st.push(()=>it(e,"active",o)),e.$on("close",l[12]),e.$on("save",l[13]),{c(){ve(e.$$.fragment)},m(r,u){be(e,r,u),n=!0},p(r,u){const a={};u&32&&(a.item=r[5]),u&128&&(a.initialEdit=r[7]),!t&&u&64&&(t=!0,a.active=r[6],at(()=>t=!1)),e.$set(a)},i(r){n||(x(e.$$.fragment,r),n=!0)},o(r){oe(e.$$.fragment,r),n=!1},d(r){ke(e,r)}}}function sa(l){let e,t,n,o,c,r,u,a,d,p,m;rt(l[15]),e=new il({props:{fallbackPath:"/"}});function _(g,$){if(g[2])return oa;if(g[3])return na}let v=_(l),k=v&&v(l),C=l[0]&&jo(l),w=!l[2]&&!l[3]&&l[4].length>0&&Ho(),b=l[8]&&zo(l),y=l[5]&&Fo(l);return{c(){ve(e.$$.fragment),t=h(),n=f("div"),k&&k.c(),o=h(),C&&C.c(),c=h(),w&&w.c(),r=h(),b&&b.c(),u=h(),y&&y.c(),a=ct(),i(n,"class","graph-container svelte-1ry9pkl"),ge(n,"width",l[0]?"100vw":"600px"),ge(n,"height",l[0]?"100vh":"400px"),bt(n,"fullscreen",l[0])},m(g,$){be(e,g,$),S(g,t,$),S(g,n,$),k&&k.m(n,null),l[16](n),S(g,o,$),C&&C.m(g,$),S(g,c,$),w&&w.m(g,$),S(g,r,$),b&&b.m(g,$),S(g,u,$),y&&y.m(g,$),S(g,a,$),d=!0,p||(m=te(zl,"resize",l[15]),p=!0)},p(g,[$]){v===(v=_(g))&&k?k.p(g,$):(k&&k.d(1),k=v&&v(g),k&&(k.c(),k.m(n,null))),(!d||$&1)&&ge(n,"width",g[0]?"100vw":"600px"),(!d||$&1)&&ge(n,"height",g[0]?"100vh":"400px"),(!d||$&1)&&bt(n,"fullscreen",g[0]),g[0]?C?C.p(g,$):(C=jo(g),C.c(),C.m(c.parentNode,c)):C&&(C.d(1),C=null),!g[2]&&!g[3]&&g[4].length>0?w||(w=Ho(),w.c(),w.m(r.parentNode,r)):w&&(w.d(1),w=null),g[8]?b?b.p(g,$):(b=zo(g),b.c(),b.m(u.parentNode,u)):b&&(b.d(1),b=null),g[5]?y?(y.p(g,$),$&32&&x(y,1)):(y=Fo(g),y.c(),x(y,1),y.m(a.parentNode,a)):y&&(tt(),oe(y,1,1,()=>{y=null}),lt())},i(g){d||(x(e.$$.fragment,g),x(y),d=!0)},o(g){oe(e.$$.fragment,g),oe(y),d=!1},d(g){ke(e,g),g&&T(t),g&&T(n),k&&k.d(),l[16](null),g&&T(o),C&&C.d(g),g&&T(c),w&&w.d(g),g&&T(r),b&&b.d(g),g&&T(u),y&&y.d(g),g&&T(a),p=!1,m()}}}function Ko(l){return{id:`kg-node-${l.id}`,url:`#/graph/node/${l.id}`,title:l.label,body:`# ${l.label}

**Knowledge Graph Node**

ID: ${l.id}
Rank: ${l.rank}

This is a concept node from the knowledge graph. You can edit this content to add more information about "${l.label}".`,description:`Knowledge graph concept: ${l.label}`,tags:["knowledge-graph","concept"],rank:l.rank,stub:`Knowledge graph concept: ${l.label}`}}function ra(l,e,t){let n,o;Ue(l,Et,E=>t(20,n=E)),Ue(l,ot,E=>t(21,o=E));let{apiUrl:c="/rolegraph"}=e,{fullscreen:r=!0}=e,u,a=!0,d=null,p=[],m=[],_=null,v=!1,k=!1,C="",w=window.innerWidth,b=window.innerHeight;function y(){t(9,w=window.innerWidth),t(10,b=window.innerHeight),!a&&!d&&L()}async function g(){t(2,a=!0),t(3,d=null);try{if(o){console.log("Loading rolegraph from Tauri");const E=await Fe("get_rolegraph",{role_name:n||void 0});if(E&&E.status==="success")t(4,p=E.nodes),m=E.edges;else throw new Error(`Tauri rolegraph fetch failed: ${(E==null?void 0:E.status)||"unknown error"}`)}else{console.log("Loading rolegraph from server");const E=n?`${c}?role=${encodeURIComponent(n)}`:c,K=await fetch(E);if(!K.ok)throw new Error(`Failed to fetch: ${K.status}`);const A=await K.json();t(4,p=A.nodes),m=A.edges}}catch(E){t(3,d=E.message),console.error("Error fetching rolegraph:",E)}finally{t(2,a=!1)}}function $(E,K){E.stopPropagation(),console.log("Node clicked:",K.label),t(5,_=Ko(K)),t(7,k=!1),t(6,v=!0)}function z(E,K){E.preventDefault(),E.stopPropagation(),console.log("Node right-clicked:",K.label),t(8,C=`Right-clicked: ${K.label}`),t(5,_=Ko(K)),t(7,k=!0),t(6,v=!0),setTimeout(()=>{t(8,C="")},2e3)}function M(){t(6,v=!1),t(5,_=null),t(7,k=!1)}async function N(){if(_)try{const E=await fetch("/documents",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(_)});E.ok?console.log("Successfully saved KG record:",_.id):console.error("Failed to save KG record:",E.statusText)}catch(E){console.error("Error saving KG record:",E)}finally{t(6,v=!1),t(5,_=null),t(7,k=!1)}}function L(){if(!u)return;t(1,u.innerHTML="",u);const E=jl(u).append("svg").attr("width",w).attr("height",b),K=Xs().scaleExtent([.1,10]).on("zoom",F=>{A.attr("transform",F.transform)});E.call(K);const A=E.append("g"),Y=xs(p).force("link",er(m).id(F=>F.id).distance(100)).force("charge",tr().strength(-200)).force("center",lr(w/2,b/2)).force("collision",nr().radius(20)),Z=A.append("g").attr("class","links").selectAll("line").data(m).enter().append("line").attr("stroke","#666").attr("stroke-opacity",.7).attr("stroke-width",F=>{const X=F.weight||F.rank||1;return Math.max(1,Math.min(8,X*2))}),J=A.append("g").attr("class","nodes").selectAll("circle").data(p).enter().append("circle").attr("r",F=>{const X=F.rank||1;return Math.max(6,Math.min(20,X*2))}).attr("fill",F=>{const X=F.rank||1,re=Math.min(X/10,1);return or(.2+re*.6)}).attr("stroke","#fff").attr("stroke-width",2).style("cursor","pointer").on("click",(F,X)=>$(F,X)).on("contextmenu",(F,X)=>z(F,X)).on("mouseover",function(F,X){jl(this).transition().duration(150).attr("stroke-width",3).attr("r",re=>{const ie=re.rank||1;return Math.max(8,Math.min(24,ie*2.5))})}).on("mouseout",function(F,X){jl(this).transition().duration(150).attr("stroke-width",2).attr("r",re=>{const ie=re.rank||1;return Math.max(6,Math.min(20,ie*2))})}).call(sr().on("start",P).on("drag",I).on("end",B)),ee=A.append("g").attr("class","labels").selectAll("text").data(p).enter().append("text").attr("text-anchor","middle").attr("dy",".35em").attr("font-size","11px").attr("font-family","Arial, sans-serif").attr("fill","#333").attr("pointer-events","none").text(F=>F.label.length>12?F.label.substring(0,12)+"...":F.label);Y.on("tick",()=>{Z.attr("x1",F=>F.source.x).attr("y1",F=>F.source.y).attr("x2",F=>F.target.x).attr("y2",F=>F.target.y),J.attr("cx",F=>F.x).attr("cy",F=>F.y),ee.attr("x",F=>F.x).attr("y",F=>F.y)});function P(F,X){F.active||Y.alphaTarget(.3).restart(),X.fx=X.x,X.fy=X.y}function I(F,X){X.fx=F.x,X.fy=F.y}function B(F,X){F.active||Y.alphaTarget(0),X.fx=null,X.fy=null}}Jt(()=>{g().then(()=>{d||L()});const E=K=>{K.preventDefault()};return u&&u.addEventListener("contextmenu",E),window.addEventListener("resize",y),()=>{u&&u.removeEventListener("contextmenu",E),window.removeEventListener("resize",y)}});function q(){t(9,w=zl.innerWidth),t(10,b=zl.innerHeight)}function Q(E){st[E?"unshift":"push"](()=>{u=E,t(1,u)})}const H=()=>history.back();function R(E){v=E,t(6,v)}return l.$$set=E=>{"apiUrl"in E&&t(14,c=E.apiUrl),"fullscreen"in E&&t(0,r=E.fullscreen)},[r,u,a,d,p,_,v,k,C,w,b,g,M,N,c,q,Q,H,R]}class ia extends mt{constructor(e){super(),_t(this,e,ra,sa,ut,{apiUrl:14,fullscreen:0})}}function Wo(l,e,t){const n=l.slice();return n[19]=e[t][0],n[20]=e[t][1],n[21]=e,n[22]=t,n}function Go(l,e,t){const n=l.slice();return n[23]=e[t],n}function Bo(l){let e,t,n,o,c,r,u,a,d,p,m,_,v,k,C=l[2].title.trim()==="",w,b,y,g,$,z,M,N,L,q,Q,H,R,E,K,A=l[2].content.trim()==="",Y,Z,J,ee,P,I,B,F,X,re,ie,D,O,V,ce,se,le,me,_e,fe,de,pe=l[1]==="edit"?"Save Changes":"Add Context",he,Se,Ge,je,Le,Re,ne,ye,Oe,Be,Ke=l[4],$e=[];for(let G=0;G<Ke.length;G+=1)$e[G]=Jo(Go(l,Ke,G));let Me=C&&Vo();function Ze(G,j){return G[2].summary?ca:aa}let Je=Ze(l),De=Je(l),He=A&&Qo();function xe(G,j){return j&4&&(ie=null),ie==null&&(ie=Object.keys(G[2].metadata).length===0),ie?fa:ua}let ue=xe(l,-1),Ae=ue(l),U=l[1]==="edit"&&Zo(l);return{c(){e=f("section"),t=f("div"),n=f("label"),n.textContent="Type",o=h(),c=f("div"),r=f("div"),u=f("select");for(let G=0;G<$e.length;G+=1)$e[G].c();a=h(),d=f("div"),p=f("label"),p.textContent="Title *",m=h(),_=f("div"),v=f("input"),k=h(),Me&&Me.c(),w=h(),b=f("div"),y=f("label"),y.textContent="Summary",g=h(),$=f("div"),z=f("textarea"),M=h(),N=f("p"),De.c(),L=h(),q=f("div"),Q=f("label"),Q.textContent="Content *",H=h(),R=f("div"),E=f("textarea"),K=h(),He&&He.c(),Y=h(),Z=f("details"),J=f("summary"),J.innerHTML=`<span class="icon-text"><span class="icon"><i class="fas fa-cog"></i></span>
              <span>Advanced Options</span></span>`,ee=h(),P=f("div"),I=f("label"),I.textContent="Metadata",B=h(),F=f("div"),X=f("p"),X.textContent="Additional key-value pairs for this context item",re=h(),Ae.c(),D=h(),O=f("button"),O.innerHTML=`<span class="icon"><i class="fas fa-plus"></i></span>
                <span>Add Metadata</span>`,V=h(),ce=f("footer"),se=f("div"),le=f("div"),me=f("button"),_e=f("span"),_e.innerHTML='<i class="fas fa-save"></i>',fe=h(),de=f("span"),he=W(pe),Ge=h(),je=f("div"),Le=f("button"),Le.innerHTML="<span>Cancel</span>",Re=h(),U&&U.c(),ne=h(),ye=f("div"),ye.innerHTML=`<strong>Keyboard shortcuts:</strong>
          Ctrl/Cmd + Enter to save, Escape to close`,i(n,"class","label"),i(n,"for","context-type"),i(u,"id","context-type"),i(u,"data-testid","context-type-select"),l[2].context_type===void 0&&rt(()=>l[10].call(u)),i(r,"class","select is-fullwidth"),i(c,"class","control"),i(t,"class","field"),i(p,"class","label"),i(p,"for","context-title"),i(v,"id","context-title"),i(v,"class","input"),i(v,"type","text"),i(v,"placeholder","Enter title..."),i(v,"data-testid","context-title-input"),v.required=!0,i(_,"class","control"),i(d,"class","field"),i(y,"class","label"),i(y,"for","context-summary"),i(z,"id","context-summary"),i(z,"class","textarea svelte-1oesbw7"),i(z,"placeholder","Brief summary of the content (optional)..."),i(z,"data-testid","context-summary-textarea"),i(z,"rows","3"),i(z,"maxlength","500"),i($,"class","control"),i(N,"class","help svelte-1oesbw7"),i(b,"class","field"),i(Q,"class","label"),i(Q,"for","context-content"),i(E,"id","context-content"),i(E,"class","textarea svelte-1oesbw7"),i(E,"placeholder","Enter the full content..."),i(E,"data-testid","context-content-textarea"),i(E,"rows","8"),E.required=!0,i(R,"class","control"),i(q,"class","field"),i(J,"class","summary svelte-1oesbw7"),i(I,"class","label"),i(X,"class","help svelte-1oesbw7"),i(O,"class","button is-small is-light"),i(F,"class","content"),i(P,"class","field mt-4"),i(Z,"class","details svelte-1oesbw7"),i(e,"class","modal-card-body svelte-1oesbw7"),i(_e,"class","icon"),i(me,"class","button is-primary"),me.disabled=Se=!l[3],i(me,"data-testid","save-context-button"),i(le,"class","control"),i(Le,"class","button is-light"),i(Le,"data-testid","cancel-context-button"),i(je,"class","control"),i(se,"class","field is-grouped"),i(ye,"class","help svelte-1oesbw7"),i(ce,"class","modal-card-foot")},m(G,j){S(G,e,j),s(e,t),s(t,n),s(t,o),s(t,c),s(c,r),s(r,u);for(let ae=0;ae<$e.length;ae+=1)$e[ae]&&$e[ae].m(u,null);qe(u,l[2].context_type,!0),s(e,a),s(e,d),s(d,p),s(d,m),s(d,_),s(_,v),Pe(v,l[2].title),s(d,k),Me&&Me.m(d,null),s(e,w),s(e,b),s(b,y),s(b,g),s(b,$),s($,z),Pe(z,l[2].summary),s(b,M),s(b,N),De.m(N,null),s(e,L),s(e,q),s(q,Q),s(q,H),s(q,R),s(R,E),Pe(E,l[2].content),s(q,K),He&&He.m(q,null),s(e,Y),s(e,Z),s(Z,J),s(Z,ee),s(Z,P),s(P,I),s(P,B),s(P,F),s(F,X),s(F,re),Ae.m(F,null),s(F,D),s(F,O),S(G,V,j),S(G,ce,j),s(ce,se),s(se,le),s(le,me),s(me,_e),s(me,fe),s(me,de),s(de,he),s(se,Ge),s(se,je),s(je,Le),s(se,Re),U&&U.m(se,null),s(ce,ne),s(ce,ye),Oe||(Be=[te(u,"change",l[10]),te(v,"input",l[11]),te(z,"input",l[12]),te(E,"input",l[13]),te(O,"click",l[17]),te(me,"click",l[6]),te(Le,"click",l[5])],Oe=!0)},p(G,j){if(j&16){Ke=G[4];let ae;for(ae=0;ae<Ke.length;ae+=1){const Te=Go(G,Ke,ae);$e[ae]?$e[ae].p(Te,j):($e[ae]=Jo(Te),$e[ae].c(),$e[ae].m(u,null))}for(;ae<$e.length;ae+=1)$e[ae].d(1);$e.length=Ke.length}j&20&&qe(u,G[2].context_type),j&20&&v.value!==G[2].title&&Pe(v,G[2].title),j&4&&(C=G[2].title.trim()===""),C?Me||(Me=Vo(),Me.c(),Me.m(d,null)):Me&&(Me.d(1),Me=null),j&20&&Pe(z,G[2].summary),Je===(Je=Ze(G))&&De?De.p(G,j):(De.d(1),De=Je(G),De&&(De.c(),De.m(N,null))),j&20&&Pe(E,G[2].content),j&4&&(A=G[2].content.trim()===""),A?He||(He=Qo(),He.c(),He.m(q,null)):He&&(He.d(1),He=null),ue===(ue=xe(G,j))&&Ae?Ae.p(G,j):(Ae.d(1),Ae=ue(G),Ae&&(Ae.c(),Ae.m(F,D))),j&2&&pe!==(pe=G[1]==="edit"?"Save Changes":"Add Context")&&we(he,pe),j&8&&Se!==(Se=!G[3])&&(me.disabled=Se),G[1]==="edit"?U?U.p(G,j):(U=Zo(G),U.c(),U.m(se,null)):U&&(U.d(1),U=null)},d(G){G&&T(e),Xe($e,G),Me&&Me.d(),De.d(),He&&He.d(),Ae.d(),G&&T(V),G&&T(ce),U&&U.d(),Oe=!1,Qe(Be)}}}function Jo(l){let e,t=l[23].label+"",n;return{c(){e=f("option"),n=W(t),e.__value=l[23].value,e.value=e.__value},m(o,c){S(o,e,c),s(e,n)},p:Ne,d(o){o&&T(e)}}}function Vo(l){let e;return{c(){e=f("p"),e.textContent="Title is required",i(e,"class","help is-danger svelte-1oesbw7")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function aa(l){let e;return{c(){e=W("Optional brief summary (up to 500 characters)")},m(t,n){S(t,e,n)},p:Ne,d(t){t&&T(e)}}}function ca(l){let e=l[2].summary.length+"",t,n;return{c(){t=W(e),n=W("/500 characters")},m(o,c){S(o,t,c),S(o,n,c)},p(o,c){c&4&&e!==(e=o[2].summary.length+"")&&we(t,e)},d(o){o&&T(t),o&&T(n)}}}function Qo(l){let e;return{c(){e=f("p"),e.textContent="Content is required",i(e,"class","help is-danger svelte-1oesbw7")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function ua(l){let e,t=Object.entries(l[2].metadata),n=[];for(let o=0;o<t.length;o+=1)n[o]=Yo(Wo(l,t,o));return{c(){for(let o=0;o<n.length;o+=1)n[o].c();e=ct()},m(o,c){for(let r=0;r<n.length;r+=1)n[r]&&n[r].m(o,c);S(o,e,c)},p(o,c){if(c&4){t=Object.entries(o[2].metadata);let r;for(r=0;r<t.length;r+=1){const u=Wo(o,t,r);n[r]?n[r].p(u,c):(n[r]=Yo(u),n[r].c(),n[r].m(e.parentNode,e))}for(;r<n.length;r+=1)n[r].d(1);n.length=t.length}},d(o){Xe(n,o),o&&T(e)}}}function fa(l){let e;return{c(){e=f("p"),e.textContent="No metadata defined",i(e,"class","has-text-grey-light")},m(t,n){S(t,e,n)},p:Ne,d(t){t&&T(e)}}}function Yo(l){let e,t,n,o,c,r,u,a,d,p,m,_,v;function k(...b){return l[14](l[19],l[20],...b)}function C(){l[15].call(u,l[19])}function w(){return l[16](l[19])}return{c(){e=f("div"),t=f("div"),n=f("input"),c=h(),r=f("div"),u=f("input"),a=h(),d=f("div"),p=f("button"),p.innerHTML='<span class="icon"><i class="fas fa-times"></i></span>',m=h(),i(n,"class","input is-small"),i(n,"type","text"),i(n,"placeholder","Key"),n.value=o=l[19],i(t,"class","control is-expanded"),i(u,"class","input is-small"),i(u,"type","text"),i(u,"placeholder","Value"),i(r,"class","control is-expanded"),i(p,"class","button is-small is-danger is-outlined"),i(d,"class","control"),i(e,"class","field is-grouped")},m(b,y){S(b,e,y),s(e,t),s(t,n),s(e,c),s(e,r),s(r,u),Pe(u,l[2].metadata[l[19]]),s(e,a),s(e,d),s(d,p),s(e,m),_||(v=[te(n,"input",k),te(u,"input",C),te(p,"click",w)],_=!0)},p(b,y){l=b,y&20&&o!==(o=l[19])&&n.value!==o&&(n.value=o),y&20&&u.value!==l[2].metadata[l[19]]&&Pe(u,l[2].metadata[l[19]])},d(b){b&&T(e),_=!1,Qe(v)}}}function Zo(l){let e,t,n,o,c,r;return{c(){e=f("div"),t=h(),n=f("div"),o=f("button"),o.innerHTML=`<span class="icon"><i class="fas fa-trash"></i></span>
                <span>Delete</span>`,i(e,"class","control is-expanded"),i(o,"class","button is-danger is-outlined"),i(o,"data-testid","delete-context-button"),i(n,"class","control")},m(u,a){S(u,e,a),S(u,t,a),S(u,n,a),s(n,o),c||(r=te(o,"click",l[7]),c=!0)},p:Ne,d(u){u&&T(e),u&&T(t),u&&T(n),c=!1,r()}}}function da(l){let e,t,n,o=l[1]==="edit"?"Edit Context Item":"Add Context Item",c,r,u,a,d,p,m=l[2]&&Bo(l);return{c(){e=f("div"),t=f("header"),n=f("p"),c=W(o),r=h(),u=f("button"),a=h(),m&&m.c(),i(n,"class","modal-card-title"),i(u,"class","delete"),i(u,"aria-label","close"),i(t,"class","modal-card-head"),i(e,"class","modal-card")},m(_,v){S(_,e,v),s(e,t),s(t,n),s(n,c),s(t,r),s(t,u),s(e,a),m&&m.m(e,null),d||(p=te(u,"click",l[5]),d=!0)},p(_,v){v&2&&o!==(o=_[1]==="edit"?"Edit Context Item":"Add Context Item")&&we(c,o),_[2]?m?m.p(_,v):(m=Bo(_),m.c(),m.m(e,null)):m&&(m.d(1),m=null)},d(_){_&&T(e),m&&m.d(),d=!1,p()}}}function pa(l){let e,t,n,o;return e=new Ml({props:{active:l[0],$$slots:{default:[da]},$$scope:{ctx:l}}}),e.$on("close",l[5]),{c(){ve(e.$$.fragment)},m(c,r){be(e,c,r),t=!0,n||(o=te(window,"keydown",l[8]),n=!0)},p(c,[r]){const u={};r&1&&(u.active=c[0]),r&67108878&&(u.$$scope={dirty:r,ctx:c}),e.$set(u)},i(c){t||(x(e.$$.fragment,c),t=!0)},o(c){oe(e.$$.fragment,c),t=!1},d(c){ke(e,c),n=!1,o()}}}function ma(l,e,t){let n,{active:o=!1}=e,{context:c=null}=e,{mode:r="edit"}=e;const u=js();let a=null,d=[{value:"Document",label:"Document"},{value:"SearchResult",label:"Search Result"},{value:"UserInput",label:"User Input"},{value:"System",label:"System"},{value:"External",label:"External"}];function p(){t(0,o=!1),t(2,a=null),u("close")}function m(){!n||!a||(u(r==="edit"?"update":"create",a),p())}function _(){r==="edit"&&c&&(u("delete",c.id),p())}function v(M){M.key==="Escape"?p():M.key==="Enter"&&(M.ctrlKey||M.metaKey)&&m()}function k(){a.context_type=Tt(this),t(2,a),t(0,o),t(9,c),t(1,r),t(4,d)}function C(){a.title=this.value,t(2,a),t(0,o),t(9,c),t(1,r),t(4,d)}function w(){a.summary=this.value,t(2,a),t(0,o),t(9,c),t(1,r),t(4,d)}function b(){a.content=this.value,t(2,a),t(0,o),t(9,c),t(1,r),t(4,d)}const y=(M,N,L)=>{const q={...a.metadata};delete q[M],q[L.target.value]=N,t(2,a.metadata=q,a)};function g(M){a.metadata[M]=this.value,t(2,a),t(0,o),t(9,c),t(1,r),t(4,d)}const $=M=>{const N={...a.metadata};delete N[M],t(2,a.metadata=N,a)},z=()=>{t(2,a.metadata={...a.metadata,[`key_${Date.now()}`]:""},a)};return l.$$set=M=>{"active"in M&&t(0,o=M.active),"context"in M&&t(9,c=M.context),"mode"in M&&t(1,r=M.mode)},l.$$.update=()=>{l.$$.dirty&515&&(o&&c?t(2,a={...c,metadata:{...c.metadata}}):o&&r==="create"&&t(2,a={id:"",context_type:"UserInput",title:"",summary:"",content:"",metadata:{},created_at:new Date().toISOString(),relevance_score:null})),l.$$.dirty&4&&t(3,n=a&&a.title.trim()!==""&&a.content.trim()!=="")},[o,r,a,n,d,p,m,_,v,c,k,C,w,b,y,g,$,z]}class _a extends mt{constructor(e){super(),_t(this,e,ma,pa,ut,{active:0,context:9,mode:1})}}function Xo(l,e,t){const n=l.slice();return n[40]=e[t],n[42]=t,n}function xo(l,e,t){const n=l.slice();return n[43]=e[t],n[45]=t,n}function es(l){let e,t,n;return{c(){e=f("p"),t=W("Conversation ID: "),n=W(l[5]),i(e,"class","is-size-7 has-text-grey")},m(o,c){S(o,e,c),s(e,t),s(e,n)},p(o,c){c[0]&32&&we(n,o[5])},d(o){o&&T(e)}}}function ts(l){let e,t,n,o=l[43].content+"",c,r;return{c(){e=f("div"),t=f("div"),n=f("pre"),c=W(o),i(n,"class","svelte-rbq0zi"),i(t,"class","bubble svelte-rbq0zi"),i(e,"class",r=Nt(`msg ${l[43].role}`)+" svelte-rbq0zi")},m(u,a){S(u,e,a),s(e,t),s(t,n),s(n,c)},p(u,a){a[0]&1&&o!==(o=u[43].content+"")&&we(c,o),a[0]&1&&r!==(r=Nt(`msg ${u[43].role}`)+" svelte-rbq0zi")&&i(e,"class",r)},d(u){u&&T(e)}}}function ls(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="bubble loading svelte-rbq0zi"><span class="icon is-small"><i class="fas fa-spinner fa-spin"></i></span>
            <span>Thinking...</span></div>`,i(e,"class","msg assistant svelte-rbq0zi")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function ns(l){let e,t,n;return{c(){e=f("p"),t=W("Model: "),n=W(l[4]),i(e,"class","is-size-7 has-text-grey")},m(o,c){S(o,e,c),s(e,t),s(e,n)},p(o,c){c[0]&16&&we(n,o[4])},d(o){o&&T(e)}}}function os(l){let e,t;return{c(){e=f("p"),t=W(l[3]),i(e,"class","has-text-danger is-size-7")},m(n,o){S(n,e,o),s(e,t)},p(n,o){o[0]&8&&we(t,n[3])},d(n){n&&T(e)}}}function ha(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-refresh"></i>',i(e,"class","icon is-small")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function ga(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-spinner fa-spin"></i>',i(e,"class","icon is-small")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function ss(l){let e,t,n,o,c,r,u,a,d,p,m,_,v,k,C,w,b,y,g,$,z,M,N,L,q,Q,H,R,E,K,A,Y,Z,J,ee,P,I,B;function F(ie,D){return ie[12]?ba:va}let X=F(l),re=X(l);return{c(){e=f("div"),t=f("div"),n=f("label"),n.textContent="Context Type",o=h(),c=f("div"),r=f("div"),u=f("select"),a=f("option"),a.textContent="Document",d=f("option"),d.textContent="Search Result",p=f("option"),p.textContent="User Input",m=f("option"),m.textContent="Note",_=h(),v=f("div"),k=f("label"),k.textContent="Title",C=h(),w=f("div"),b=f("input"),y=h(),g=f("div"),$=f("label"),$.textContent="Content",z=h(),M=f("div"),N=f("textarea"),L=h(),q=f("div"),Q=f("div"),H=f("button"),re.c(),R=h(),E=f("span"),E.textContent="Save Context",A=h(),Y=f("div"),Z=f("button"),J=f("span"),J.innerHTML='<i class="fas fa-times"></i>',ee=h(),P=f("span"),P.textContent="Cancel",i(n,"class","label is-small"),a.__value="document",a.value=a.__value,d.__value="search_result",d.value=d.__value,p.__value="user_input",p.value=p.__value,m.__value="note",m.value=m.__value,i(u,"data-testid","context-type-select"),l[11]===void 0&&rt(()=>l[26].call(u)),i(r,"class","select is-small is-fullwidth"),i(c,"class","control"),i(t,"class","field"),i(k,"class","label is-small"),i(b,"class","input is-small"),i(b,"type","text"),i(b,"placeholder","Enter context title"),i(b,"data-testid","context-title-input"),i(w,"class","control"),i(v,"class","field"),i($,"class","label is-small"),i(N,"class","textarea is-small"),i(N,"rows","4"),i(N,"placeholder","Enter context content"),i(N,"data-testid","context-content-textarea"),i(M,"class","control"),i(g,"class","field"),i(H,"class","button is-primary is-small"),H.disabled=K=l[12]||!l[9].trim()||!l[10].trim(),i(H,"data-testid","add-context-submit-button"),i(Q,"class","control"),i(J,"class","icon is-small"),i(Z,"class","button is-light is-small"),Z.disabled=l[12],i(Y,"class","control"),i(q,"class","field is-grouped"),i(e,"class","box has-background-light mb-4"),i(e,"data-testid","add-context-form")},m(ie,D){S(ie,e,D),s(e,t),s(t,n),s(t,o),s(t,c),s(c,r),s(r,u),s(u,a),s(u,d),s(u,p),s(u,m),qe(u,l[11],!0),s(e,_),s(e,v),s(v,k),s(v,C),s(v,w),s(w,b),Pe(b,l[9]),s(e,y),s(e,g),s(g,$),s(g,z),s(g,M),s(M,N),Pe(N,l[10]),s(e,L),s(e,q),s(q,Q),s(Q,H),re.m(H,null),s(H,R),s(H,E),s(q,A),s(q,Y),s(Y,Z),s(Z,J),s(Z,ee),s(Z,P),I||(B=[te(u,"change",l[26]),te(b,"input",l[27]),te(N,"input",l[28]),te(H,"click",l[18]),te(Z,"click",l[17])],I=!0)},p(ie,D){D[0]&2048&&qe(u,ie[11]),D[0]&512&&b.value!==ie[9]&&Pe(b,ie[9]),D[0]&1024&&Pe(N,ie[10]),X!==(X=F(ie))&&(re.d(1),re=X(ie),re&&(re.c(),re.m(H,R))),D[0]&5632&&K!==(K=ie[12]||!ie[9].trim()||!ie[10].trim())&&(H.disabled=K),D[0]&4096&&(Z.disabled=ie[12])},d(ie){ie&&T(e),re.d(),I=!1,Qe(B)}}}function va(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-save"></i>',i(e,"class","icon is-small")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function ba(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-spinner fa-spin"></i>',i(e,"class","icon is-small")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function ka(l){let e,t=l[6],n=[];for(let o=0;o<t.length;o+=1)n[o]=as(Xo(l,t,o));return{c(){e=f("div");for(let o=0;o<n.length;o+=1)n[o].c();i(e,"class","context-items svelte-rbq0zi"),i(e,"data-testid","conversation-context")},m(o,c){S(o,e,c);for(let r=0;r<n.length;r+=1)n[r]&&n[r].m(e,null)},p(o,c){if(c[0]&1572928){t=o[6];let r;for(r=0;r<t.length;r+=1){const u=Xo(o,t,r);n[r]?n[r].p(u,c):(n[r]=as(u),n[r].c(),n[r].m(e,null))}for(;r<n.length;r+=1)n[r].d(1);n.length=t.length}},d(o){o&&T(e),Xe(n,o)}}}function wa(l){let e;return{c(){e=f("div"),e.innerHTML=`<span class="icon is-large"><i class="fas fa-inbox fa-2x"></i></span>
              <p class="is-size-6">No context items yet</p>
              <p class="is-size-7">Add documents from search results to provide context for your chat.</p>`,i(e,"class","has-text-centered has-text-grey-light"),i(e,"data-testid","empty-context-message")},m(t,n){S(t,e,n)},p:Ne,d(t){t&&T(e)}}}function rs(l){let e,t=l[40].relevance_score.toFixed(1)+"",n;return{c(){e=f("span"),n=W(t),i(e,"class","tag is-light is-small")},m(o,c){S(o,e,c),s(e,n)},p(o,c){c[0]&64&&t!==(t=o[40].relevance_score.toFixed(1)+"")&&we(n,t)},d(o){o&&T(e)}}}function ya(l){let e,t=l[40].content.substring(0,150)+"",n,o=l[40].content.length>150?"...":"",c;return{c(){e=f("p"),n=W(t),c=W(o),i(e,"class","context-preview svelte-rbq0zi"),i(e,"data-testid",`context-content-${l[42]}`)},m(r,u){S(r,e,u),s(e,n),s(e,c)},p(r,u){u[0]&64&&t!==(t=r[40].content.substring(0,150)+"")&&we(n,t),u[0]&64&&o!==(o=r[40].content.length>150?"...":"")&&we(c,o)},d(r){r&&T(e)}}}function Ca(l){let e,t=l[40].summary+"",n;return{c(){e=f("p"),n=W(t),i(e,"class","context-summary svelte-rbq0zi"),i(e,"data-testid",`context-summary-${l[42]}`)},m(o,c){S(o,e,c),s(e,n)},p(o,c){c[0]&64&&t!==(t=o[40].summary+"")&&we(n,t)},d(o){o&&T(e)}}}function is(l){let e;return{c(){e=f("hr"),i(e,"class","context-divider svelte-rbq0zi")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function as(l){let e,t,n,o,c,r=l[40].context_type.replace(/([A-Z])/g," $1").trim()+"",u,a,d,p,m,_,v,k,C,w,b,y,g,$,z,M=l[40].title+"",N,L,q,Q,H,R,E=new Date(l[40].created_at).toLocaleString()+"",K,A,Y,Z,J,ee,P,I=l[40].relevance_score&&rs(l);function B(){return l[29](l[40])}function F(){return l[30](l[40])}function X(O,V){return O[40].summary?Ca:ya}let re=X(l),ie=re(l),D=l[42]<l[6].length-1&&is();return{c(){e=f("div"),t=f("div"),n=f("div"),o=f("div"),c=f("span"),u=W(r),d=h(),p=f("div"),m=f("div"),I&&I.c(),_=h(),v=f("div"),k=f("div"),C=f("div"),w=f("button"),w.innerHTML='<span class="icon is-small"><i class="fas fa-edit"></i></span>',b=h(),y=f("div"),g=f("button"),g.innerHTML='<span class="icon is-small"><i class="fas fa-trash"></i></span>',$=h(),z=f("h6"),N=W(M),L=h(),q=f("div"),ie.c(),Q=h(),H=f("div"),R=W("Added: "),K=W(E),Z=h(),D&&D.c(),J=ct(),i(c,"class",a="tag is-small "+(l[40].context_type==="Document"?"is-info":l[40].context_type==="SearchResult"?"is-primary":l[40].context_type==="UserInput"?"is-warning":"is-light")),i(c,"data-testid",`context-type-${l[42]}`),i(o,"class","level-item"),i(n,"class","level-left"),i(m,"class","level-item"),i(w,"class","button is-small is-light"),i(w,"data-testid",`edit-context-${l[42]}`),i(w,"title","Edit context"),i(C,"class","control"),i(g,"class","button is-small is-light is-danger"),i(g,"data-testid",`delete-context-${l[42]}`),i(g,"title","Delete context"),i(y,"class","control"),i(k,"class","field is-grouped"),i(v,"class","level-item context-actions svelte-rbq0zi"),i(p,"class","level-right"),i(t,"class","level is-mobile"),i(z,"class","title is-6 has-text-dark"),i(z,"data-testid",`context-title-${l[42]}`),i(q,"class","content is-small"),i(H,"class","is-size-7 has-text-grey"),i(e,"class","context-item svelte-rbq0zi"),i(e,"data-context-id",A=l[40].id),i(e,"data-testid",`context-item-${l[42]}`),i(e,"data-context-type",Y=l[40].context_type)},m(O,V){S(O,e,V),s(e,t),s(t,n),s(n,o),s(o,c),s(c,u),s(t,d),s(t,p),s(p,m),I&&I.m(m,null),s(p,_),s(p,v),s(v,k),s(k,C),s(C,w),s(k,b),s(k,y),s(y,g),s(e,$),s(e,z),s(z,N),s(e,L),s(e,q),ie.m(q,null),s(e,Q),s(e,H),s(H,R),s(H,K),S(O,Z,V),D&&D.m(O,V),S(O,J,V),ee||(P=[te(w,"click",B),te(g,"click",F)],ee=!0)},p(O,V){l=O,V[0]&64&&r!==(r=l[40].context_type.replace(/([A-Z])/g," $1").trim()+"")&&we(u,r),V[0]&64&&a!==(a="tag is-small "+(l[40].context_type==="Document"?"is-info":l[40].context_type==="SearchResult"?"is-primary":l[40].context_type==="UserInput"?"is-warning":"is-light"))&&i(c,"class",a),l[40].relevance_score?I?I.p(l,V):(I=rs(l),I.c(),I.m(m,null)):I&&(I.d(1),I=null),V[0]&64&&M!==(M=l[40].title+"")&&we(N,M),re===(re=X(l))&&ie?ie.p(l,V):(ie.d(1),ie=re(l),ie&&(ie.c(),ie.m(q,null))),V[0]&64&&E!==(E=new Date(l[40].created_at).toLocaleString()+"")&&we(K,E),V[0]&64&&A!==(A=l[40].id)&&i(e,"data-context-id",A),V[0]&64&&Y!==(Y=l[40].context_type)&&i(e,"data-context-type",Y),l[42]<l[6].length-1?D||(D=is(),D.c(),D.m(J.parentNode,J)):D&&(D.d(1),D=null)},d(O){O&&T(e),I&&I.d(),ie.d(),O&&T(Z),D&&D.d(O),O&&T(J),ee=!1,Qe(P)}}}function $a(l){let e,t,n,o,c,r,u,a,d,p,m,_,v,k,C,w,b,y,g,$,z,M,N,L,q,Q,H,R,E,K,A,Y,Z,J,ee,P,I,B,F,X,re,ie,D,O,V,ce=l[6].length+"",se,le,me,_e,fe,de,pe,he,Se,Ge;e=new il({props:{fallbackPath:"/"}});let je=l[5]&&es(l),Le=l[0],Re=[];for(let ue=0;ue<Le.length;ue+=1)Re[ue]=ts(xo(l,Le,ue));let ne=l[2]&&ls(),ye=l[4]&&ns(l),Oe=l[3]&&os(l);function Be(ue,Ae){return ue[7]?ga:ha}let Ke=Be(l),$e=Ke(l),Me=l[8]&&ss(l);function Ze(ue,Ae){return ue[6].length===0?wa:ka}let Je=Ze(l),De=Je(l);function He(ue){l[31](ue)}let xe={context:l[14],mode:l[15]};return l[13]!==void 0&&(xe.active=l[13]),de=new _a({props:xe}),st.push(()=>it(de,"active",He)),de.$on("update",l[32]),de.$on("delete",l[33]),de.$on("close",l[34]),{c(){ve(e.$$.fragment),t=h(),n=f("section"),o=f("div"),c=f("div"),r=f("div"),u=f("h2"),u.textContent="Chat",a=h(),d=f("p"),d.textContent=`Role: ${St(Et)}`,p=h(),je&&je.c(),m=h(),_=f("div");for(let ue=0;ue<Re.length;ue+=1)Re[ue].c();v=h(),ne&&ne.c(),k=h(),ye&&ye.c(),C=h(),Oe&&Oe.c(),w=h(),b=f("div"),y=f("div"),g=f("textarea"),$=h(),z=f("div"),M=f("button"),N=f("span"),N.innerHTML='<i class="fas fa-paper-plane"></i>',q=h(),Q=f("div"),H=f("div"),R=f("div"),E=f("div"),K=f("div"),A=f("h4"),A.textContent="Context",Y=h(),Z=f("button"),Z.innerHTML=`<span class="icon is-small"><i class="fas fa-plus"></i></span>
                  <span>Add Context</span>`,J=h(),ee=f("div"),P=f("div"),I=f("button"),$e.c(),B=h(),Me&&Me.c(),F=h(),De.c(),X=h(),re=f("div"),ie=f("div"),D=f("div"),O=f("div"),V=f("span"),se=W(ce),le=W(" context items"),me=h(),_e=f("div"),_e.innerHTML='<div class="level-item"><span class="is-size-7 has-text-grey">Context is automatically included in your chat</span></div>',fe=h(),ve(de.$$.fragment),i(u,"class","title is-4"),i(d,"class","subtitle is-6"),i(_,"class","chat-window svelte-rbq0zi"),i(_,"data-testid","chat-messages"),i(g,"class","textarea"),i(g,"rows","3"),i(g,"placeholder","Type your message and press Enter..."),i(g,"data-testid","chat-input"),i(y,"class","control is-expanded"),i(N,"class","icon"),i(M,"class","button is-primary"),M.disabled=L=l[2]||!l[1].trim(),i(M,"data-testid","send-message-button"),i(z,"class","control"),i(b,"class","field has-addons chat-input svelte-rbq0zi"),i(r,"class","column is-8"),i(A,"class","title is-5"),i(Z,"class","button is-small is-primary"),i(Z,"data-testid","show-add-context-button"),i(K,"class","level-item"),i(E,"class","level-left"),i(I,"class","button is-small is-light"),I.disabled=l[7],i(I,"data-testid","refresh-context-button"),i(P,"class","level-item"),i(ee,"class","level-right"),i(R,"class","level is-mobile"),i(V,"class","tag is-light is-small"),i(V,"data-testid","context-summary"),i(O,"class","level-item"),i(D,"class","level-left"),i(_e,"class","level-right"),i(ie,"class","level is-mobile"),i(re,"class","mt-4"),i(H,"class","box context-panel svelte-rbq0zi"),i(H,"data-testid","context-panel"),i(Q,"class","column is-4"),i(c,"class","columns svelte-rbq0zi"),i(o,"class","container"),i(n,"class","section"),i(n,"data-testid","chat-interface")},m(ue,Ae){be(e,ue,Ae),S(ue,t,Ae),S(ue,n,Ae),s(n,o),s(o,c),s(c,r),s(r,u),s(r,a),s(r,d),s(r,p),je&&je.m(r,null),s(r,m),s(r,_);for(let U=0;U<Re.length;U+=1)Re[U]&&Re[U].m(_,null);s(_,v),ne&&ne.m(_,null),s(r,k),ye&&ye.m(r,null),s(r,C),Oe&&Oe.m(r,null),s(r,w),s(r,b),s(b,y),s(y,g),Pe(g,l[1]),s(b,$),s(b,z),s(z,M),s(M,N),s(c,q),s(c,Q),s(Q,H),s(H,R),s(R,E),s(E,K),s(K,A),s(K,Y),s(K,Z),s(R,J),s(R,ee),s(ee,P),s(P,I),$e.m(I,null),s(H,B),Me&&Me.m(H,null),s(H,F),De.m(H,null),s(H,X),s(H,re),s(re,ie),s(ie,D),s(D,O),s(O,V),s(V,se),s(V,le),s(ie,me),s(ie,_e),S(ue,fe,Ae),be(de,ue,Ae),he=!0,Se||(Ge=[te(g,"input",l[25]),te(g,"keydown",l[24]),te(M,"click",l[23]),te(Z,"click",l[17]),te(I,"click",l[16])],Se=!0)},p(ue,Ae){if(ue[5]?je?je.p(ue,Ae):(je=es(ue),je.c(),je.m(r,m)):je&&(je.d(1),je=null),Ae[0]&1){Le=ue[0];let G;for(G=0;G<Le.length;G+=1){const j=xo(ue,Le,G);Re[G]?Re[G].p(j,Ae):(Re[G]=ts(j),Re[G].c(),Re[G].m(_,v))}for(;G<Re.length;G+=1)Re[G].d(1);Re.length=Le.length}ue[2]?ne||(ne=ls(),ne.c(),ne.m(_,null)):ne&&(ne.d(1),ne=null),ue[4]?ye?ye.p(ue,Ae):(ye=ns(ue),ye.c(),ye.m(r,C)):ye&&(ye.d(1),ye=null),ue[3]?Oe?Oe.p(ue,Ae):(Oe=os(ue),Oe.c(),Oe.m(r,w)):Oe&&(Oe.d(1),Oe=null),Ae[0]&2&&Pe(g,ue[1]),(!he||Ae[0]&6&&L!==(L=ue[2]||!ue[1].trim()))&&(M.disabled=L),Ke!==(Ke=Be(ue))&&($e.d(1),$e=Ke(ue),$e&&($e.c(),$e.m(I,null))),(!he||Ae[0]&128)&&(I.disabled=ue[7]),ue[8]?Me?Me.p(ue,Ae):(Me=ss(ue),Me.c(),Me.m(H,F)):Me&&(Me.d(1),Me=null),Je===(Je=Ze(ue))&&De?De.p(ue,Ae):(De.d(1),De=Je(ue),De&&(De.c(),De.m(H,X))),(!he||Ae[0]&64)&&ce!==(ce=ue[6].length+"")&&we(se,ce);const U={};Ae[0]&16384&&(U.context=ue[14]),Ae[0]&32768&&(U.mode=ue[15]),!pe&&Ae[0]&8192&&(pe=!0,U.active=ue[13],at(()=>pe=!1)),de.$set(U)},i(ue){he||(x(e.$$.fragment,ue),x(de.$$.fragment,ue),he=!0)},o(ue){oe(e.$$.fragment,ue),oe(de.$$.fragment,ue),he=!1},d(ue){ke(e,ue),ue&&T(t),ue&&T(n),je&&je.d(),Xe(Re,ue),ne&&ne.d(),ye&&ye.d(),Oe&&Oe.d(),$e.d(),Me&&Me.d(),De.d(),ue&&T(fe),ke(de,ue),Se=!1,Qe(Ge)}}}function Ta(l,e,t){let n;Ue(l,ot,D=>t(36,n=D));let o=[],c="",r=!1,u=null,a=null,d=null,p=[],m=!1,_=!1,v="",k="",C="document",w=!1,b=!1,y=null,g="edit",$=null;function z(D){t(0,o=[...o,{role:"user",content:D}])}async function M(){try{if(n){const D=await Fe("list_conversations");D!=null&&D.conversations&&D.conversations.length>0?(t(5,d=D.conversations[0].id),console.log("🎯 Using existing conversation:",d),await L()):await N()}else{const D=await fetch(`${Ye.ServerURL}/conversations`);if(D.ok){const O=await D.json();O.conversations&&O.conversations.length>0?(t(5,d=O.conversations[0].id),console.log("🎯 Using existing conversation:",d),await L()):await N()}else await N()}}catch(D){console.error("❌ Error initializing conversation:",D)}}async function N(){try{const D=St(Et);if(n){const O=await Fe("create_conversation",{title:"Chat Conversation",role:D});O.status==="success"&&O.conversation_id&&(t(5,d=O.conversation_id),console.log("🆕 Created new conversation:",d))}else{const O=await fetch(`${Ye.ServerURL}/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"Chat Conversation",role:D})});if(O.ok){const V=await O.json();V.status==="Success"&&V.conversation_id&&(t(5,d=V.conversation_id),console.log("🆕 Created new conversation:",d))}}}catch(D){console.error("❌ Error creating conversation:",D)}}async function L(){if(!d){console.warn("⚠️ Cannot load context: no conversation ID available");return}t(7,m=!0),console.log("🔄 Loading conversation context for:",d);try{if(n){console.log("📱 Loading context via Tauri...");const D=await Fe("get_conversation",{conversationId:d});if(console.log("📥 Tauri response:",D),D.status==="success"&&D.conversation){const O=D.conversation.global_context||[];t(6,p=O),console.log(`✅ Loaded ${O.length} context items via Tauri`)}else console.error("❌ Failed to get conversation via Tauri:",D.error||"Unknown error"),t(6,p=[])}else{console.log("🌐 Loading context via HTTP...");const D=await fetch(`${Ye.ServerURL}/conversations/${d}`);if(console.log("📥 HTTP response status:",D.status,D.statusText),D.ok){const O=await D.json();if(console.log("📄 HTTP response data:",O),O.status==="success"&&O.conversation){const V=O.conversation.global_context||[];t(6,p=V),console.log(`✅ Loaded ${V.length} context items via HTTP`)}else console.error("❌ Failed to get conversation via HTTP:",O.error||"Unknown error"),t(6,p=[])}else console.error("❌ HTTP request failed:",D.status,D.statusText),t(6,p=[])}}catch(D){console.error("❌ Error loading conversation context:",{error:D.message||D,conversationId:d,isTauri:n,timestamp:new Date().toISOString()}),t(6,p=[])}finally{t(7,m=!1),console.log("🏁 Context loading completed. Items count:",p.length)}}function q(){t(8,_=!_),_||(t(9,v=""),t(10,k=""),t(11,C="document"))}async function Q(){if(!(!d||!v.trim()||!k.trim())){t(12,w=!0);try{const D={title:v.trim(),summary:null,content:k.trim(),context_type:C};if(n){const O=await Fe("add_context_to_conversation",{conversationId:d,contextData:D});O.status==="success"?(await L(),q(),console.log("✅ Context added successfully via Tauri")):console.error("❌ Failed to add context via Tauri:",O.error)}else{const O=await fetch(`${Ye.ServerURL}/conversations/${d}/context`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(D)});if(O.ok){const V=await O.json();V.status==="success"?(await L(),q(),console.log("✅ Context added successfully via HTTP")):console.error("❌ Failed to add context via HTTP:",V.error)}else console.error("❌ HTTP request failed:",O.status,O.statusText)}}catch(D){console.error("❌ Error adding manual context:",D)}finally{t(12,w=!1)}}}function H(D){t(14,y=D),t(15,g="edit"),t(13,b=!0)}function R(D){confirm(`Are you sure you want to delete "${D.title}"?`)&&E(D.id)}async function E(D){if(!(!d||$)){$=D,console.log("🗑️ Deleting context:",D);try{if(n){const O=await Fe("delete_context",{conversationId:d,contextId:D});(O==null?void 0:O.status)==="success"?(console.log("✅ Context deleted successfully via Tauri"),await L()):console.error("❌ Failed to delete context via Tauri:",O==null?void 0:O.error)}else{const O=await fetch(`${Ye.ServerURL}/conversations/${d}/context/${D}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(O.ok){const V=await O.json();V.status==="Success"?(console.log("✅ Context deleted successfully via HTTP"),await L()):console.error("❌ Failed to delete context via HTTP:",V.error)}else console.error("❌ HTTP delete request failed:",O.status)}}catch(O){console.error("❌ Error deleting context:",O)}finally{$=null}}}async function K(D){if(d){console.log("📝 Updating context:",D.id);try{const O={context_type:D.context_type,title:D.title,summary:D.summary,content:D.content,metadata:D.metadata};if(n){const V=await Fe("update_context",{conversationId:d,contextId:D.id,request:O});(V==null?void 0:V.status)==="success"?(console.log("✅ Context updated successfully via Tauri"),await L()):console.error("❌ Failed to update context via Tauri:",V==null?void 0:V.error)}else{const V=await fetch(`${Ye.ServerURL}/conversations/${d}/context/${D.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(O)});if(V.ok){const ce=await V.json();ce.status==="Success"?(console.log("✅ Context updated successfully via HTTP"),await L()):console.error("❌ Failed to update context via HTTP:",ce.error)}else console.error("❌ HTTP update request failed:",V.status)}}catch(O){console.error("❌ Error updating context:",O)}}}async function A(){var V;if(!c.trim()||r)return;t(3,u=null);const D=St(Et),O=c.trim();t(1,c=""),d||await M(),z(O),t(2,r=!0);try{const ce={role:D,messages:o};d&&(ce.conversation_id=d);const se=await fetch(`${Ye.ServerURL}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ce)});if(!se.ok)throw new Error(`HTTP ${se.status}`);const le=await se.json();t(4,a=le.model_used??null),((V=le.status)==null?void 0:V.toLowerCase())==="success"&&le.message?t(0,o=[...o,{role:"assistant",content:le.message}]):t(3,u=le.error||"Chat failed")}catch(ce){t(3,u=(ce==null?void 0:ce.message)||String(ce))}finally{t(2,r=!1)}}function Y(D){(D.key==="Enter"||D.key==="Return")&&!D.shiftKey&&(D.preventDefault(),A())}Jt(()=>{if(t(0,o=[{role:"assistant",content:"Hi! How can I help you? Ask me anything about your search results or documents."}]),M(),typeof window<"u"){const D=()=>{d&&L()};return window.addEventListener("focus",D),()=>{window.removeEventListener("focus",D)}}});function Z(){c=this.value,t(1,c)}function J(){C=Tt(this),t(11,C)}function ee(){v=this.value,t(9,v)}function P(){k=this.value,t(10,k)}const I=D=>H(D),B=D=>R(D);function F(D){b=D,t(13,b)}return[o,c,r,u,a,d,p,m,_,v,k,C,w,b,y,g,L,q,Q,H,R,E,K,A,Y,Z,J,ee,P,I,B,F,D=>K(D.detail),D=>E(D.detail),()=>{t(13,b=!1),t(14,y=null)}]}class Sa extends mt{constructor(e){super(),_t(this,e,Ta,$a,ut,{},null,[-1,-1])}}function Ra(l){let e,t;return e=new qi({}),{c(){ve(e.$$.fragment)},m(n,o){be(e,n,o),t=!0},i(n){t||(x(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){ke(e,n)}}}function Ea(l){let e,t;return e=new Sa({}),{c(){ve(e.$$.fragment)},m(n,o){be(e,n,o),t=!0},i(n){t||(x(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){ke(e,n)}}}function La(l){let e,t;return e=new ia({}),{c(){ve(e.$$.fragment)},m(n,o){be(e,n,o),t=!0},i(n){t||(x(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){ke(e,n)}}}function Aa(l){let e,t;return e=new Pr({}),{c(){ve(e.$$.fragment)},m(n,o){be(e,n,o),t=!0},i(n){t||(x(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){ke(e,n)}}}function Pa(l){let e,t;return e=new xi({}),{c(){ve(e.$$.fragment)},m(n,o){be(e,n,o),t=!0},i(n){t||(x(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){ke(e,n)}}}function Oa(l){let e,t;return e=new la({}),{c(){ve(e.$$.fragment)},m(n,o){be(e,n,o),t=!0},i(n){t||(x(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){ke(e,n)}}}function Ma(l){let e;return{c(){e=f("nav"),e.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a>
            <a class="navbar-item" href="/config/wizard">Wizard</a>
            <a class="navbar-item" href="/config/json">JSON Editor</a>
            <a class="navbar-item" href="/graph">Graph</a>
            <a class="navbar-item" href="/chat">Chat</a></div>`,i(e,"class","navbar")},m(t,n){S(t,e,n)},p:Ne,d(t){t&&T(e)}}}function Na(l){let e,t,n,o,c,r,u,a,d,p,m,_,v,k,C,w,b,y,g,$,z,M,N,L,q,Q,H,R,E,K,A,Y,Z,J,ee,P,I,B,F,X,re,ie;return g=new Al({}),M=new Ot({props:{path:"/",$$slots:{default:[Ra]},$$scope:{ctx:l}}}),L=new Ot({props:{path:"/chat",$$slots:{default:[Ea]},$$scope:{ctx:l}}}),Q=new Ot({props:{path:"/graph",$$slots:{default:[La]},$$scope:{ctx:l}}}),K=new Ot({props:{path:"/fetch/*",$$slots:{default:[Aa]},$$scope:{ctx:l}}}),Y=new Ot({props:{path:"/config/wizard",$$slots:{default:[Pa]},$$scope:{ctx:l}}}),J=new Ot({props:{path:"/config/json",$$slots:{default:[Oa]},$$scope:{ctx:l}}}),B=new Ot({props:{path:"/",$$slots:{default:[Ma]},$$scope:{ctx:l}}}),{c(){e=f("meta"),t=h(),n=f("div"),o=f("main"),c=f("div"),r=f("div"),u=f("div"),a=f("ul"),d=f("li"),p=f("a"),p.innerHTML=`<span class="icon is-small"><i class="fas fa-search"></i></span>
                <span>Search</span>`,m=h(),_=f("li"),v=f("a"),v.innerHTML=`<span class="icon is-small"><i class="fas fa-comments"></i></span>
                <span>Chat</span>`,k=h(),C=f("li"),w=f("a"),w.innerHTML=`<span class="icon is-small"><i class="fas fa-project-diagram"></i></span>
                <span>Graph</span>`,b=h(),y=f("div"),ve(g.$$.fragment),$=h(),z=f("div"),ve(M.$$.fragment),N=h(),ve(L.$$.fragment),q=h(),ve(Q.$$.fragment),H=h(),R=f("br"),E=h(),ve(K.$$.fragment),A=h(),ve(Y.$$.fragment),Z=h(),ve(J.$$.fragment),ee=h(),P=f("footer"),I=f("div"),ve(B.$$.fragment),i(e,"name","color-scheme"),i(e,"content",l[1]),document.title="Terraphim",i(p,"href","/"),i(p,"data-exact",""),i(p,"data-testid","search-tab"),i(d,"class","svelte-1nmgbjk"),i(v,"href","/chat"),i(v,"data-testid","chat-tab"),i(_,"class","svelte-1nmgbjk"),i(w,"href","/graph"),i(w,"data-testid","graph-tab"),i(C,"class","svelte-1nmgbjk"),i(u,"class","tabs is-boxed svelte-1nmgbjk"),i(r,"class","main-navigation svelte-1nmgbjk"),i(y,"class","role-selector svelte-1nmgbjk"),i(c,"class","top-controls svelte-1nmgbjk"),i(z,"class","main-area svelte-1nmgbjk"),i(o,"class","main-content svelte-1nmgbjk"),i(I,"class",F=Nt(l[0])+" svelte-1nmgbjk"),i(P,"class","svelte-1nmgbjk"),i(n,"class","is-full-height svelte-1nmgbjk")},m(D,O){s(document.head,e),S(D,t,O),S(D,n,O),s(n,o),s(o,c),s(c,r),s(r,u),s(u,a),s(a,d),s(d,p),s(a,m),s(a,_),s(_,v),s(a,k),s(a,C),s(C,w),s(c,b),s(c,y),be(g,y,null),s(o,$),s(o,z),be(M,z,null),s(z,N),be(L,z,null),s(z,q),be(Q,z,null),s(o,H),s(o,R),s(o,E),be(K,o,null),s(o,A),be(Y,o,null),s(o,Z),be(J,o,null),s(n,ee),s(n,P),s(P,I),be(B,I,null),X=!0,re||(ie=[Il(Ul.call(null,p)),Il(Ul.call(null,v)),Il(Ul.call(null,w)),te(P,"mouseover",l[2]),te(P,"focus",l[2])],re=!0)},p(D,[O]){(!X||O&2)&&i(e,"content",D[1]);const V={};O&16&&(V.$$scope={dirty:O,ctx:D}),M.$set(V);const ce={};O&16&&(ce.$$scope={dirty:O,ctx:D}),L.$set(ce);const se={};O&16&&(se.$$scope={dirty:O,ctx:D}),Q.$set(se);const le={};O&16&&(le.$$scope={dirty:O,ctx:D}),K.$set(le);const me={};O&16&&(me.$$scope={dirty:O,ctx:D}),Y.$set(me);const _e={};O&16&&(_e.$$scope={dirty:O,ctx:D}),J.$set(_e);const fe={};O&16&&(fe.$$scope={dirty:O,ctx:D}),B.$set(fe),(!X||O&1&&F!==(F=Nt(D[0])+" svelte-1nmgbjk"))&&i(I,"class",F)},i(D){X||(x(g.$$.fragment,D),x(M.$$.fragment,D),x(L.$$.fragment,D),x(Q.$$.fragment,D),x(K.$$.fragment,D),x(Y.$$.fragment,D),x(J.$$.fragment,D),x(B.$$.fragment,D),X=!0)},o(D){oe(g.$$.fragment,D),oe(M.$$.fragment,D),oe(L.$$.fragment,D),oe(Q.$$.fragment,D),oe(K.$$.fragment,D),oe(Y.$$.fragment,D),oe(J.$$.fragment,D),oe(B.$$.fragment,D),X=!1},d(D){T(e),D&&T(t),D&&T(n),ke(g),ke(M),ke(L),ke(Q),ke(K),ke(Y),ke(J),ke(B),re=!1,Qe(ie)}}}function Da(l,e,t){let n;Ue(l,ml,r=>t(1,n=r));let o="is-hidden";function c(){t(0,o="")}return[o,n,c]}class Ia extends mt{constructor(e){super(),_t(this,e,Da,Na,ut,{})}}const Ua=new Vs;Qs(Ua);new Ia({target:document.getElementById("app")});
