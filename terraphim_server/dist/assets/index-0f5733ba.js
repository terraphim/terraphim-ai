var us=Object.defineProperty;var cs=(l,e,t)=>e in l?us(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var wt=(l,e,t)=>(cs(l,typeof e!="symbol"?e+"":e,t),t);import{aa as Lt,S as mt,i as _t,s as it,q as f,Y as F,b as P,y as s,Z as me,I as ye,j as A,ak as Re,F as at,m as qt,a as g,v as a,l as Z,E as Je,au as Ht,r as ae,z as ue,t as G,d as Q,B as ce,av as fs,aw as Jt,H as Qe,U as xe,V as et,ax as Pl,ay as ds,g as We,e as Ke,O as Ye,af as Ze,o as ps,W as re,az as Dl,aA as Rt,aB as Bn,aC as qn,a1 as Ae,C as rt,aD as Me,aE as Jn,D as nl,G as sl,aF as Vn,w as Nt,x as Ut,A as jl,a2 as ms,aG as dl,ac as _s,a7 as hs,a9 as gs,n as bs}from"./vendor-ui-cd3d2b6a.js";import{R as Ot,S as El}from"./vendor-utils-1b347ea1.js";import{J as Qn,_ as vs,E as ks,d as ws,o as co}from"./vendor-editor-992829d3.js";import{P as Yn,T as Ol,u as Zn,y as ys,A as $s,S as Cs,q as Ss}from"./vendor-atomic-1ea13e29.js";import{t as Ts,S as Rs,E as As}from"./novel-editor-c665f5c2.js";import{s as Ul,z as Ls,a as Ps,l as Os,m as Es,c as Ns,b as Us,B as Is,d as Ms}from"./vendor-charts-e6a4a6c9.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const u of n)if(u.type==="childList")for(const r of u.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function t(n){const u={};return n.integrity&&(u.integrity=n.integrity),n.referrerPolicy&&(u.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?u.credentials="include":n.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function o(n){if(n.ep)return;n.ep=!0;const u=t(n);fetch(n.href,u)}})();const pt={ServerURL:location.protocol+"//"+window.location.host||"/"},fl=Lt([]),Ds={id:"Desktop",global_shortcut:"",roles:{},default_role:{original:"",lowercase:""},selected_role:{original:"",lowercase:""}},pl=Lt("spacelab"),At=Lt("selected"),je=Lt(!1),js=Lt(`${pt.ServerURL}/documents/search`),Ct=Lt(Ds),fo=Lt([]);let Al=Lt("");const $t=Lt(!1);let Bt=null;function Hs(l){if(typeof document>"u")return;const e=`/assets/bulmaswatch/${l}/bulmaswatch.min.css`;if(Bt!=null&&Bt.href.endsWith(e))return;const t=document.createElement("link");t.rel="stylesheet",t.href=e,t.id="bulma-theme",t.onload=()=>{Bt&&Bt!==t&&Bt.remove(),Bt=t},document.head.appendChild(t);const o=document.head.querySelector('meta[name="color-scheme"]');o&&o.setAttribute("content",l)}pl.subscribe(Hs);function zs(l){let e,t;return{c(){e=f("option"),t=F(l[1]),e.__value=l[0],e.value=e.__value},m(o,n){P(o,e,n),s(e,t)},p(o,[n]){n&2&&me(t,o[1]),n&1&&(e.__value=o[0],e.value=e.__value)},i:ye,o:ye,d(o){o&&A(e)}}}function Fs(l,e,t){let o,{subject:n}=e;const u=Yn(n),r=Ol(u,Zn.properties.name);return Re(l,r,c=>t(1,o=c)),Ol(u,"http://localhost:9883/property/theme"),l.$$set=c=>{"subject"in c&&t(0,n=c.subject)},[n,o,r]}class Ws extends mt{constructor(e){super(),_t(this,e,Fs,zs,it,{subject:0})}}function po(l){let e,t,o,n,u,r,c=l[0]&&mo();return{c(){e=f("button"),t=f("span"),t.innerHTML='<i class="fas fa-arrow-left"></i>',o=g(),c&&c.c(),a(t,"class","icon svelte-rnsqpo"),a(e,"class",n="button is-light back-button "+l[1]+" svelte-rnsqpo"),a(e,"title","Go back"),a(e,"aria-label","Go back")},m(i,d){P(i,e,d),s(e,t),s(e,o),c&&c.m(e,null),u||(r=[Z(e,"click",l[3]),Z(e,"keydown",l[6])],u=!0)},p(i,d){i[0]?c||(c=mo(),c.c(),c.m(e,null)):c&&(c.d(1),c=null),d&2&&n!==(n="button is-light back-button "+i[1]+" svelte-rnsqpo")&&a(e,"class",n)},d(i){i&&A(e),c&&c.d(),u=!1,Je(r)}}}function mo(l){let e;return{c(){e=f("span"),e.textContent="Back",a(e,"class","back-text svelte-rnsqpo")},m(t,o){P(t,e,o)},d(t){t&&A(e)}}}function Ks(l){let e,t=l[2]&&po(l);return{c(){t&&t.c(),e=at()},m(o,n){t&&t.m(o,n),P(o,e,n)},p(o,[n]){o[2]?t?t.p(o,n):(t=po(o),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:ye,o:ye,d(o){t&&t.d(o),o&&A(e)}}}function Gs(l,e,t){let{fallbackPath:o="/"}=e,{showText:n=!0}=e,{customClass:u=""}=e,{hideOnPaths:r=["/"]}=e,c=!0;function i(){var m;try{const _=((m=window.location)==null?void 0:m.pathname)||"/";t(2,c=!r.includes(_))}catch{t(2,c=!0)}}function d(){window.history.length>1?window.history.back():window.location.href=o}qt(()=>(i(),window.addEventListener("popstate",i),window.addEventListener("hashchange",i),()=>{window.removeEventListener("popstate",i),window.removeEventListener("hashchange",i)}));const p=m=>{(m.key==="Enter"||m.key===" ")&&(m.preventDefault(),d())};return l.$$set=m=>{"fallbackPath"in m&&t(4,o=m.fallbackPath),"showText"in m&&t(0,n=m.showText),"customClass"in m&&t(1,u=m.customClass),"hideOnPaths"in m&&t(5,r=m.hideOnPaths)},[n,u,c,d,o,r,p]}class rl extends mt{constructor(e){super(),_t(this,e,Gs,Ks,it,{fallbackPath:4,showText:0,customClass:1,hideOnPaths:5})}}function Bs(){return window.crypto.getRandomValues(new Uint32Array(1))[0]}function Il(l,e=!1){const t=Bs(),o=`_${t}`;return Object.defineProperty(window,o,{value:n=>(e&&Reflect.deleteProperty(window,o),l==null?void 0:l(n)),writable:!1,configurable:!0}),t}async function Ge(l,e={}){return new Promise((t,o)=>{const n=Il(r=>{t(r),Reflect.deleteProperty(window,`_${u}`)},!0),u=Il(r=>{o(r),Reflect.deleteProperty(window,`_${n}`)},!0);window.__TAURI_IPC__({cmd:l,callback:n,error:u,...e})})}function _o(l,e,t){const o=l.slice();return o[25]=e[t],o}function qs(l){let e,t,o;function n(r){l[13](r)}let u={};return l[5]!==void 0&&(u.value=l[5]),e=new Jt({props:u}),Qe.push(()=>xe(e,"value",n)),{c(){ae(e.$$.fragment)},m(r,c){ue(e,r,c),o=!0},p(r,c){const i={};!t&&c&32&&(t=!0,i.value=r[5],et(()=>t=!1)),e.$set(i)},i(r){o||(G(e.$$.fragment,r),o=!0)},o(r){Q(e.$$.fragment,r),o=!1},d(r){ce(e,r)}}}function Js(l){let e,t,o;function n(r){l[14](r)}let u={type:"password",placeholder:"secret",icon:"fas fa-lock",expanded:!0};return l[6]!==void 0&&(u.value=l[6]),e=new Jt({props:u}),Qe.push(()=>xe(e,"value",n)),{c(){ae(e.$$.fragment)},m(r,c){ue(e,r,c),o=!0},p(r,c){const i={};!t&&c&64&&(t=!0,i.value=r[6],et(()=>t=!1)),e.$set(i)},i(r){o||(G(e.$$.fragment,r),o=!0)},o(r){Q(e.$$.fragment,r),o=!1},d(r){ce(e,r)}}}function Vs(l){let e;return{c(){e=F("Save")},m(t,o){P(t,e,o)},d(t){t&&A(e)}}}function Qs(l){let e,t;return e=new Pl({props:{type:"is-success",class:"is-right",iconPack:"fa",iconLeft:"check",$$slots:{default:[Vs]},$$scope:{ctx:l}}}),e.$on("click",l[8]),e.$on("submit",l[8]),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},p(o,n){const u={};n&268435456&&(u.$$scope={dirty:n,ctx:o}),e.$set(u)},i(o){t||(G(e.$$.fragment,o),t=!0)},o(o){Q(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function Ys(l){let e,t,o,n,u,r;return e=new Ht({props:{$$slots:{default:[qs]},$$scope:{ctx:l}}}),o=new Ht({props:{grouped:!0,$$slots:{default:[Js]},$$scope:{ctx:l}}}),u=new Ht({props:{grouped:!0,$$slots:{default:[Qs]},$$scope:{ctx:l}}}),{c(){ae(e.$$.fragment),t=g(),ae(o.$$.fragment),n=g(),ae(u.$$.fragment)},m(c,i){ue(e,c,i),P(c,t,i),ue(o,c,i),P(c,n,i),ue(u,c,i),r=!0},p(c,i){const d={};i&268435488&&(d.$$scope={dirty:i,ctx:c}),e.$set(d);const p={};i&268435520&&(p.$$scope={dirty:i,ctx:c}),o.$set(p);const m={};i&268435456&&(m.$$scope={dirty:i,ctx:c}),u.$set(m)},i(c){r||(G(e.$$.fragment,c),G(o.$$.fragment,c),G(u.$$.fragment,c),r=!0)},o(c){Q(e.$$.fragment,c),Q(o.$$.fragment,c),Q(u.$$.fragment,c),r=!1},d(c){ce(e,c),c&&A(t),ce(o,c),c&&A(n),ce(u,c)}}}function Zs(l){let e,t,o;function n(r){l[15](r)}let u={type:"search",placeholder:"Fetch JSON",icon:"search"};return l[3]!==void 0&&(u.value=l[3]),e=new Jt({props:u}),Qe.push(()=>xe(e,"value",n)),{c(){ae(e.$$.fragment)},m(r,c){ue(e,r,c),o=!0},p(r,c){const i={};!t&&c&8&&(t=!0,i.value=r[3],et(()=>t=!1)),e.$set(i)},i(r){o||(G(e.$$.fragment,r),o=!0)},o(r){Q(e.$$.fragment,r),o=!1},d(r){ce(e,r)}}}function Xs(l){let e;return{c(){e=F("WikiPage")},m(t,o){P(t,e,o)},d(t){t&&A(e)}}}function xs(l){let e,t,o,n,u,r;function c(m){l[16](m)}let i={type:"search",placeholder:"Post JSON",icon:"search"};l[4]!==void 0&&(i.value=l[4]),e=new Jt({props:i}),Qe.push(()=>xe(e,"value",c));function d(m){l[17](m)}let p={$$slots:{default:[Xs]},$$scope:{ctx:l}};return l[2]!==void 0&&(p.checked=l[2]),n=new ds({props:p}),Qe.push(()=>xe(n,"checked",d)),{c(){ae(e.$$.fragment),o=g(),ae(n.$$.fragment)},m(m,_){ue(e,m,_),P(m,o,_),ue(n,m,_),r=!0},p(m,_){const y={};!t&&_&16&&(t=!0,y.value=m[4],et(()=>t=!1)),e.$set(y);const h={};_&268435456&&(h.$$scope={dirty:_,ctx:m}),!u&&_&4&&(u=!0,h.checked=m[2],et(()=>u=!1)),n.$set(h)},i(m){r||(G(e.$$.fragment,m),G(n.$$.fragment,m),r=!0)},o(m){Q(e.$$.fragment,m),Q(n.$$.fragment,m),r=!1},d(m){ce(e,m),m&&A(o),ce(n,m)}}}function er(l){let e;return{c(){e=F("Fetch")},m(t,o){P(t,e,o)},d(t){t&&A(e)}}}function tr(l){let e,t;return e=new Pl({props:{type:"is-primary",$$slots:{default:[er]},$$scope:{ctx:l}}}),e.$on("click",l[9]),e.$on("submit",l[9]),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},p(o,n){const u={};n&268435456&&(u.$$scope={dirty:n,ctx:o}),e.$set(u)},i(o){t||(G(e.$$.fragment,o),t=!0)},o(o){Q(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function lr(l){let e,t,o,n,u,r;return e=new Ht({props:{grouped:!0,$$slots:{default:[Zs]},$$scope:{ctx:l}}}),o=new Ht({props:{grouped:!0,$$slots:{default:[xs]},$$scope:{ctx:l}}}),u=new Ht({props:{grouped:!0,$$slots:{default:[tr]},$$scope:{ctx:l}}}),{c(){ae(e.$$.fragment),t=g(),ae(o.$$.fragment),n=g(),ae(u.$$.fragment)},m(c,i){ue(e,c,i),P(c,t,i),ue(o,c,i),P(c,n,i),ue(u,c,i),r=!0},p(c,i){const d={};i&268435464&&(d.$$scope={dirty:i,ctx:c}),e.$set(d);const p={};i&268435476&&(p.$$scope={dirty:i,ctx:c}),o.$set(p);const m={};i&268435456&&(m.$$scope={dirty:i,ctx:c}),u.$set(m)},i(c){r||(G(e.$$.fragment,c),G(o.$$.fragment,c),G(u.$$.fragment,c),r=!0)},o(c){Q(e.$$.fragment,c),Q(o.$$.fragment,c),Q(u.$$.fragment,c),r=!1},d(c){ce(e,c),c&&A(t),ce(o,c),c&&A(n),ce(u,c)}}}function or(l){let e,t,o,n,u;return n=new Qn({props:{content:l[1],onChange:l[7]}}),{c(){e=f("p"),e.innerHTML=`<i>The best editing experience is to configure Atomic Server, in the
        meantime use editor below. You will need to refresh page via Command R
        or Ctrl-R to see changes</i>`,t=g(),o=f("div"),ae(n.$$.fragment),a(o,"class","editor")},m(r,c){P(r,e,c),P(r,t,c),P(r,o,c),ue(n,o,null),u=!0},p(r,c){const i={};c&2&&(i.content=r[1]),n.$set(i)},i(r){u||(G(n.$$.fragment,r),u=!0)},o(r){Q(n.$$.fragment,r),u=!1},d(r){r&&A(e),r&&A(t),r&&A(o),ce(n)}}}function ho(l){let e,t;return e=new Ws({props:{subject:l[25]}}),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},p(o,n){const u={};n&1&&(u.subject=o[25]),e.$set(u)},i(o){t||(G(e.$$.fragment,o),t=!0)},o(o){Q(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function nr(l){let e,t,o=l[0]??[],n=[];for(let r=0;r<o.length;r+=1)n[r]=ho(_o(l,o,r));const u=r=>Q(n[r],1,1,()=>{n[r]=null});return{c(){for(let r=0;r<n.length;r+=1)n[r].c();e=at()},m(r,c){for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(r,c);P(r,e,c),t=!0},p(r,c){if(c&1){o=r[0]??[];let i;for(i=0;i<o.length;i+=1){const d=_o(r,o,i);n[i]?(n[i].p(d,c),G(n[i],1)):(n[i]=ho(d),n[i].c(),G(n[i],1),n[i].m(e.parentNode,e))}for(We(),i=o.length;i<n.length;i+=1)u(i);Ke()}},i(r){if(!t){for(let c=0;c<o.length;c+=1)G(n[c]);t=!0}},o(r){n=n.filter(Boolean);for(let c=0;c<n.length;c+=1)Q(n[c]);t=!1},d(r){Ye(n,r),r&&A(e)}}}function sr(l){let e,t;return e=new fs({props:{$$slots:{default:[nr]},$$scope:{ctx:l}}}),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},p(o,n){const u={};n&268435457&&(u.$$scope={dirty:n,ctx:o}),e.$set(u)},i(o){t||(G(e.$$.fragment,o),t=!0)},o(o){Q(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function rr(l){let e,t,o,n,u,r,c,i,d,p,m,_,y,h,b;return e=new rl({props:{fallbackPath:"/"}}),n=new Ot({props:{path:"/atomic",$$slots:{default:[Ys]},$$scope:{ctx:l}}}),r=new Ot({props:{path:"/json",$$slots:{default:[lr]},$$scope:{ctx:l}}}),i=new Ot({props:{path:"/editor",$$slots:{default:[or]},$$scope:{ctx:l}}}),_=new Ht({props:{grouped:!0,position:"is-right",$$slots:{default:[sr]},$$scope:{ctx:l}}}),{c(){ae(e.$$.fragment),t=g(),o=f("div"),ae(n.$$.fragment),u=g(),ae(r.$$.fragment),c=g(),ae(i.$$.fragment),d=g(),p=f("hr"),m=g(),ae(_.$$.fragment),y=g(),h=f("nav"),h.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
    <a class="navbar-item" href="/fetch/json">Fetch JSON Data</a> 
    <a class="navbar-item" href="/fetch/atomic">Set Atomic Server</a> 
    <a class="navbar-item" href="/fetch/editor">Edit JSON config</a></div>`,a(o,"class","box"),a(h,"class","navbar")},m(k,S){ue(e,k,S),P(k,t,S),P(k,o,S),ue(n,o,null),s(o,u),ue(r,o,null),s(o,c),ue(i,o,null),P(k,d,S),P(k,p,S),P(k,m,S),ue(_,k,S),P(k,y,S),P(k,h,S),b=!0},p(k,[S]){const v={};S&268435552&&(v.$$scope={dirty:S,ctx:k}),n.$set(v);const w={};S&268435484&&(w.$$scope={dirty:S,ctx:k}),r.$set(w);const T={};S&268435458&&(T.$$scope={dirty:S,ctx:k}),i.$set(T);const J={};S&268435457&&(J.$$scope={dirty:S,ctx:k}),_.$set(J)},i(k){b||(G(e.$$.fragment,k),G(n.$$.fragment,k),G(r.$$.fragment,k),G(i.$$.fragment,k),G(_.$$.fragment,k),b=!0)},o(k){Q(e.$$.fragment,k),Q(n.$$.fragment,k),Q(r.$$.fragment,k),Q(i.$$.fragment,k),Q(_.$$.fragment,k),b=!1},d(k){ce(e,k),k&&A(t),k&&A(o),ce(n),ce(r),ce(i),k&&A(d),k&&A(p),k&&A(m),ce(_,k),k&&A(y),k&&A(h)}}}function ir(l,e,t){let o,n,u,r,c;Re(l,ys,R=>t(19,u=R)),Re(l,je,R=>t(20,r=R)),Re(l,Ct,R=>t(21,c=R));let i={json:c};function d(R){if(console.log("contents changed:",R),console.log("is tauri",r),Ct.update(L=>(L=R.json,L)),je)console.log("Updating config on server"),Ge("update_config",{configNew:R.json}).then(L=>{console.log(`Message: ${L}`)}).catch(L=>console.error(L));else{let L=`${pt.ServerURL}/config/`;fetch(L,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(R.json)})}t(1,i=R)}let p=!1,m="https://raw.githubusercontent.com/terraphim/terraphim-cloud-fastapi/main/data/ref_arch.json",_="http://localhost:8000/documents/",y="http://localhost:9883/",h;const b=async()=>{console.log("Updating atomic server configuration");const R=$s.fromSecret(h);u.setServerUrl(y),console.log("Server set.Setting agent"),u.setAgent(R)},k=async()=>{w()},S=({data:{msg:R,data:L}})=>{console.log(R,L)};let v;const w=async()=>{const R=await vs(()=>import("./fetcher.worker-7e58969a.js"),[]);v=new R.default,v.onmessage=S;const L={msg:"fetcher",data:{url:m,postUrl:_,isWiki:p}};v.postMessage(L)},T=Yn("http://localhost:9883/config/y3zx5wtm0bq"),J=Ol(T,Zn.properties.name);Re(l,J,R=>t(12,n=R));const I=Ol(T,"http://localhost:9883/property/role");Re(l,I,R=>t(0,o=R));function H(R){y=R,t(5,y)}function O(R){h=R,t(6,h)}function q(R){m=R,t(3,m)}function K(R){_=R,t(4,_)}function W(R){p=R,t(2,p)}return l.$$.update=()=>{l.$$.dirty&4096&&console.log("Print name",n),l.$$.dirty&1&&console.log("Print roles",o)},[o,i,p,m,_,y,h,d,b,k,J,I,n,H,O,q,K,W]}class ar extends mt{constructor(e){super(),_t(this,e,ir,rr,it,{})}}class ur{constructor(){wt(this,"baseUrl");wt(this,"autocompleteIndexBuilt",!1);wt(this,"sessionId");wt(this,"currentRole","Default");wt(this,"connectionRetries",0);wt(this,"maxRetries",3);wt(this,"retryDelay",1e3);wt(this,"isConnecting",!1);this.baseUrl=typeof window<"u"?(window.location.protocol==="https:"?"https://":"http://")+window.location.hostname+":8001":"http://localhost:8001",this.sessionId=`novel-${Date.now()}`,this.detectServerPort()}setRole(e){this.currentRole=e,this.autocompleteIndexBuilt=!1}async detectServerPort(){if(Ze(je))return;const e=[8001,3e3,8e3,8080];for(const t of e)try{const o=typeof window<"u"?(window.location.protocol==="https:"?"https://":"http://")+window.location.hostname+":"+t:"http://localhost:"+t,n=await fetch(`${o}/message?sessionId=health-check`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:0,method:"ping",params:{}}),signal:AbortSignal.timeout(2e3)});if(n.ok||n.status===404){this.baseUrl=o,console.log(`NovelAutocompleteService: Detected server at ${o}`);return}}catch{continue}console.warn("NovelAutocompleteService: Could not detect running server, using default:",this.baseUrl)}async buildAutocompleteIndex(){if(this.isConnecting)return await new Promise(e=>setTimeout(e,1e3)),this.autocompleteIndexBuilt;this.isConnecting=!0;try{if(Ze(je)){console.log("Using Tauri autocomplete - testing connection");const e=await Ge("get_autocomplete_suggestions",{query:"test",roleName:this.currentRole,limit:1});return e&&e.status==="success"?(this.autocompleteIndexBuilt=!0,this.connectionRetries=0,console.log("Tauri autocomplete connection verified"),!0):(console.warn("Tauri autocomplete test failed:",e),!1)}else return await this.buildMCPIndex()}catch(e){return console.error("Error building Novel autocomplete index:",e),!1}finally{this.isConnecting=!1}}async buildMCPIndex(){for(let e=0;e<=this.maxRetries;e++)try{const t=await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:Date.now(),method:"tools/call",params:{name:"build_autocomplete_index",arguments:{}}}),signal:AbortSignal.timeout(1e4)});if(t.ok){const o=await t.json();if(console.log(`MCP build index response (attempt ${e+1}):`,o),o.result&&!o.result.is_error)return this.autocompleteIndexBuilt=!0,this.connectionRetries=0,console.log("MCP autocomplete index built successfully"),!0}else if(t.status>=500&&e<this.maxRetries){console.warn(`MCP server error ${t.status}, retrying in ${this.retryDelay}ms...`),await new Promise(o=>setTimeout(o,this.retryDelay*(e+1)));continue}console.warn(`MCP build index failed (attempt ${e+1}):`,t.status,t.statusText)}catch(t){t instanceof Error&&t.name==="AbortError"?console.warn(`MCP request timeout (attempt ${e+1})`):console.warn(`MCP connection error (attempt ${e+1}):`,t),e<this.maxRetries&&await new Promise(o=>setTimeout(o,this.retryDelay*(e+1)))}return console.error("Failed to build MCP autocomplete index after all retries"),!1}async getCompletion(e){if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return{text:""};try{const t=this.extractLastWord(e.prompt);if(!t||t.length<1)return{text:""};const o=await this.getSuggestionsWithSnippets(t,5);if(o.length===0)return{text:""};let u=o[0].text;u.toLowerCase().startsWith(t.toLowerCase())&&(u=u.substring(t.length));const r=e.prompt.length/4,c=u.length/4;return{text:u,usage:{promptTokens:Math.round(r),completionTokens:Math.round(c),totalTokens:Math.round(r+c)}}}catch(t){return console.error("Error getting Novel autocomplete completion:",t),{text:""}}}async getSuggestions(e,t=10){if(!e||e.trim().length===0)return[];if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return console.warn("Autocomplete index not built, returning empty suggestions"),[];try{return Ze(je)?await this.getTauriSuggestions(e,t):await this.getMCPSuggestions(e,t,"autocomplete_terms")}catch(o){return console.error("Error getting autocomplete suggestions:",o),[]}}async getTauriSuggestions(e,t){const o=await Ge("get_autocomplete_suggestions",{query:e.trim(),roleName:this.currentRole,limit:t});return console.log("Tauri autocomplete response:",o),o&&o.status==="success"&&o.suggestions?o.suggestions.map(n=>({text:n.term||n.text||"",snippet:n.url||n.snippet||"",score:n.score||1})).filter(n=>n.text.length>0):(o&&o.error&&console.error("Tauri autocomplete error:",o.error),[])}async getMCPSuggestions(e,t,o){const n=Date.now(),u=await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:n,method:"tools/call",params:{name:o,arguments:{query:e.trim(),limit:t,role:this.currentRole}}}),signal:AbortSignal.timeout(5e3)});if(!u.ok)return console.error(`MCP ${o} request failed:`,u.status,u.statusText),[];const r=await u.json();return console.log(`MCP ${o} response:`,r),r.result&&!r.result.is_error&&r.result.content?o==="autocomplete_with_snippets"?this.parseAutocompleteWithSnippetsContent(r.result.content):this.parseAutocompleteContent(r.result.content):(r.error&&console.error(`MCP ${o} error:`,r.error),[])}async getSuggestionsWithSnippets(e,t=10){if(!e||e.trim().length===0)return[];if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return console.warn("Autocomplete index not built, returning empty suggestions with snippets"),[];try{return Ze(je)?await this.getTauriSuggestions(e,t):await this.getMCPSuggestions(e,t,"autocomplete_with_snippets")}catch(o){return console.error("Error getting autocomplete suggestions with snippets:",o),[]}}extractLastWord(e){const t=e.trim().split(/\s+/);return t[t.length-1]||""}parseAutocompleteContent(e){const t=[];for(const o of e)if(o.type==="text"&&o.text){if(!o.text.startsWith("Found")&&!o.text.startsWith("•"))t.push({text:o.text.trim()});else if(o.text.startsWith("•")){const n=o.text.replace("•","").trim();n&&t.push({text:n})}}return t}parseAutocompleteWithSnippetsContent(e){const t=[];for(const o of e)if(o.type==="text"&&o.text){if(!o.text.startsWith("Found")&&!o.text.startsWith("•")){const n=o.text.split(" — ");n.length===2?t.push({text:n[0].trim(),snippet:n[1].trim()}):t.push({text:o.text.trim()})}else if(o.text.startsWith("•")){const n=o.text.replace("•","").trim();n&&t.push({text:n})}}return t}isReady(){return this.autocompleteIndexBuilt}getStatus(){return{ready:this.autocompleteIndexBuilt,baseUrl:this.baseUrl,sessionId:this.sessionId,usingTauri:Ze(je),currentRole:this.currentRole,connectionRetries:this.connectionRetries,isConnecting:this.isConnecting}}async refreshIndex(){return this.autocompleteIndexBuilt=!1,this.connectionRetries=0,await this.buildAutocompleteIndex()}async testConnection(){try{if(Ze(je)){const e=await Ge("get_config");return e&&e.status==="success"}else return(await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:Date.now(),method:"tools/list",params:{}}),signal:AbortSignal.timeout(3e3)})).ok}catch(e){return console.warn("Connection test failed:",e),!1}}}const Et=new ur,go=ks.create({name:"terraphimSuggestion",addOptions(){return{trigger:"/",pluginKey:new ws("terraphimSuggestion"),allowSpaces:!1,limit:8,minLength:1,debounce:300}},addCommands(){return{insertSuggestion:l=>({commands:e,chain:t})=>t().insertContent(l.text).run()}},addProseMirrorPlugins(){const l={editor:this.editor,char:this.options.trigger,pluginKey:this.options.pluginKey,allowSpaces:this.options.allowSpaces,startOfLine:!1,command:({editor:e,range:t,props:o})=>{const n=o;e.chain().focus().insertContentAt(t,n.text+" ").run()},items:async({query:e,editor:t})=>new Promise(o=>{setTimeout(async()=>{if(e.length<this.options.minLength){o([]);return}try{const n=await Et.getSuggestionsWithSnippets(e,this.options.limit);console.log(`TerraphimSuggestion: Found ${n.length} suggestions for "${e}"`),o(n)}catch(n){console.error("TerraphimSuggestion: Error getting suggestions:",n),o([])}},this.options.debounce)}),render:()=>{let e,t;return{onStart:o=>{e=new cr({items:o.items,command:o.command}),o.clientRect&&(t=Ts("body",{getReferenceClientRect:o.clientRect,appendTo:()=>document.body,content:e.element,showOnCreate:!0,interactive:!0,trigger:"manual",placement:"bottom-start",theme:"terraphim-suggestion",maxWidth:"none"})[0])},onUpdate(o){e==null||e.updateItems(o.items),o.clientRect&&(t==null||t.setProps({getReferenceClientRect:o.clientRect}))},onKeyDown(o){return o.event.key==="Escape"?(t==null||t.hide(),!0):(e==null?void 0:e.onKeyDown(o))??!1},onExit(){t==null||t.destroy(),e==null||e.destroy()}}}};return[Rs(l)]}});class cr{constructor(e){wt(this,"element");wt(this,"items",[]);wt(this,"selectedIndex",0);wt(this,"command");this.items=e.items,this.command=e.command,this.element=document.createElement("div"),this.element.className="terraphim-suggestion-dropdown",this.render()}updateItems(e){this.items=e,this.selectedIndex=0,this.render()}onKeyDown({event:e}){return e.key==="ArrowUp"?(this.selectPrevious(),!0):e.key==="ArrowDown"?(this.selectNext(),!0):e.key==="Enter"||e.key==="Tab"?(this.selectItem(this.selectedIndex),!0):!1}selectPrevious(){this.selectedIndex=Math.max(0,this.selectedIndex-1),this.render()}selectNext(){this.selectedIndex=Math.min(this.items.length-1,this.selectedIndex+1),this.render()}selectItem(e){const t=this.items[e];t&&this.command(t)}render(){if(this.element.innerHTML="",this.items.length===0){this.element.innerHTML=`
        <div class="terraphim-suggestion-item terraphim-suggestion-empty">
          <div class="terraphim-suggestion-text">No suggestions found</div>
          <div class="terraphim-suggestion-hint">Try a different search term</div>
        </div>
      `;return}const e=document.createElement("div");e.className="terraphim-suggestion-header",e.innerHTML=`
      <div class="terraphim-suggestion-count">${this.items.length} suggestions</div>
      <div class="terraphim-suggestion-hint">↑↓ Navigate • Tab/Enter Select • Esc Cancel</div>
    `,this.element.appendChild(e),this.items.forEach((t,o)=>{const n=document.createElement("div");n.className=`terraphim-suggestion-item ${o===this.selectedIndex?"terraphim-suggestion-selected":""}`,n.innerHTML=`
        <div class="terraphim-suggestion-main">
          <div class="terraphim-suggestion-text">${this.escapeHtml(t.text)}</div>
          ${t.snippet?`<div class="terraphim-suggestion-snippet">${this.escapeHtml(t.snippet)}</div>`:""}
        </div>
        ${t.score?`<div class="terraphim-suggestion-score">${Math.round(t.score*100)}%</div>`:""}
      `,n.addEventListener("click",()=>this.selectItem(o)),n.addEventListener("mouseenter",()=>{this.selectedIndex=o,this.render()}),this.element.appendChild(n)})}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}destroy(){this.element.remove()}}const fr=`
.terraphim-suggestion-dropdown {
  background: white;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  box-shadow: 0 10px 38px -10px rgba(22, 23, 24, 0.35), 0 10px 20px -15px rgba(22, 23, 24, 0.2);
  max-height: 300px;
  min-width: 300px;
  overflow-y: auto;
  z-index: 1000;
}

.terraphim-suggestion-header {
  padding: 8px 12px;
  border-bottom: 1px solid #f1f5f9;
  background: #f8fafc;
  font-size: 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.terraphim-suggestion-count {
  font-weight: 600;
  color: #475569;
}

.terraphim-suggestion-hint {
  color: #64748b;
}

.terraphim-suggestion-item {
  padding: 8px 12px;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  border-bottom: 1px solid #f1f5f9;
}

.terraphim-suggestion-item:hover {
  background: #f8fafc;
}

.terraphim-suggestion-selected {
  background: #eff6ff !important;
  border-left: 3px solid #3b82f6;
}

.terraphim-suggestion-empty {
  color: #64748b;
  font-style: italic;
  text-align: center;
  cursor: default;
}

.terraphim-suggestion-main {
  flex: 1;
}

.terraphim-suggestion-text {
  font-weight: 500;
  color: #1e293b;
  margin-bottom: 2px;
}

.terraphim-suggestion-snippet {
  font-size: 12px;
  color: #64748b;
  line-height: 1.3;
}

.terraphim-suggestion-score {
  font-size: 11px;
  color: #10b981;
  font-weight: 600;
  background: #ecfdf5;
  padding: 2px 6px;
  border-radius: 4px;
  margin-left: 8px;
}

/* Dark theme support */
@media (prefers-color-scheme: dark) {
  .terraphim-suggestion-dropdown {
    background: #1e293b;
    border-color: #334155;
  }

  .terraphim-suggestion-header {
    background: #0f172a;
    border-color: #334155;
  }

  .terraphim-suggestion-item:hover {
    background: #334155;
  }

  .terraphim-suggestion-selected {
    background: #1e40af !important;
  }

  .terraphim-suggestion-text {
    color: #f1f5f9;
  }

  .terraphim-suggestion-snippet {
    color: #94a3b8;
  }
}

/* Tippy.js theme */
.tippy-box[data-theme~='terraphim-suggestion'] {
  background: transparent;
  box-shadow: none;
}

.tippy-box[data-theme~='terraphim-suggestion'] > .tippy-backdrop {
  background: transparent;
}

.tippy-box[data-theme~='terraphim-suggestion'] > .tippy-arrow {
  display: none;
}
`;function bo(l){let e,t,o,n,u,r,c,i,d,p,m,_,y,h,b,k,S,v,w,T,J,I,H,O,q,K,W=l[12]?"Tauri (native)":`MCP Server (${Et.getStatus().baseUrl})`,R,L,E,C,z,x,B,Y,$,N,U,M,V,ee,ne,ke,be,Ne,pe,fe,ie=l[6]!==1?"s":"",Se,Te,oe,he,se,ve,Be,Ce,Oe,le,we,Ie,Xe,He,Ee,ht,ze,St,tt=l[3]?"Enabled":"Disabled",gt,Ve,lt,ut,Le=l[11]&&!l[8]&&vo(l);function Tt(j,te){if(j[8])return _r;if(j[11])return mr}let D=Tt(l),X=D&&D(l);return{c(){e=f("div"),t=f("div"),o=f("strong"),o.textContent="Local Autocomplete Status:",n=g(),u=f("div"),r=f("button"),c=F("Test"),d=g(),p=f("button"),p.textContent="Rebuild Index",m=g(),_=f("button"),y=F("Demo"),b=g(),k=f("div"),S=F(l[10]),v=g(),Le&&Le.c(),w=g(),T=f("div"),J=f("strong"),J.textContent="Configuration:",I=g(),H=f("br"),O=F("• "),q=f("strong"),q.textContent="Backend:",K=g(),R=F(W),L=g(),E=f("br"),C=F("• "),z=f("strong"),z.textContent="Role:",x=g(),B=F(l[9]),Y=g(),$=f("br"),N=F("• "),U=f("strong"),U.textContent="Trigger:",M=F(' "'),V=F(l[4]),ee=F(`" + text
      `),ne=f("br"),ke=F("• "),be=f("strong"),be.textContent="Min Length:",Ne=g(),pe=F(l[6]),fe=F(" character"),Se=F(ie),Te=g(),oe=f("br"),he=F("• "),se=f("strong"),se.textContent="Max Results:",ve=g(),Be=F(l[5]),Ce=g(),Oe=f("br"),le=F("• "),we=f("strong"),we.textContent="Debounce:",Ie=g(),Xe=F(l[7]),He=F(`ms
      `),Ee=f("br"),ht=F("• "),ze=f("strong"),ze.textContent="Snippets:",St=g(),gt=F(tt),Ve=g(),X&&X.c(),re(o,"color","#495057"),re(r,"padding","4px 8px"),re(r,"background","#007bff"),re(r,"color","white"),re(r,"border","none"),re(r,"border-radius","4px"),re(r,"cursor","pointer"),re(r,"font-size","12px"),r.disabled=i=!l[8],re(p,"padding","4px 8px"),re(p,"background","#28a745"),re(p,"color","white"),re(p,"border","none"),re(p,"border-radius","4px"),re(p,"cursor","pointer"),re(p,"font-size","12px"),re(_,"padding","4px 8px"),re(_,"background","#ffc107"),re(_,"color","#212529"),re(_,"border","none"),re(_,"border-radius","4px"),re(_,"cursor","pointer"),re(_,"font-size","12px"),_.disabled=h=!l[8],re(u,"display","flex"),re(u,"gap","8px"),re(t,"display","flex"),re(t,"justify-content","space-between"),re(t,"align-items","center"),re(t,"margin-bottom","8px"),re(k,"font-size","13px"),re(k,"color","#6c757d"),re(k,"margin-bottom","8px"),re(k,"font-family","monospace"),re(T,"font-size","12px"),re(T,"color","#6c757d"),re(e,"margin-top","10px"),re(e,"padding","12px"),re(e,"background","#f8f9fa"),re(e,"border-radius","6px"),re(e,"border","1px solid #e9ecef")},m(j,te){P(j,e,te),s(e,t),s(t,o),s(t,n),s(t,u),s(u,r),s(r,c),s(u,d),s(u,p),s(u,m),s(u,_),s(_,y),s(e,b),s(e,k),s(k,S),s(e,v),Le&&Le.m(e,null),s(e,w),s(e,T),s(T,J),s(T,I),s(T,H),s(T,O),s(T,q),s(T,K),s(T,R),s(T,L),s(T,E),s(T,C),s(T,z),s(T,x),s(T,B),s(T,Y),s(T,$),s(T,N),s(T,U),s(T,M),s(T,V),s(T,ee),s(T,ne),s(T,ke),s(T,be),s(T,Ne),s(T,pe),s(T,fe),s(T,Se),s(T,Te),s(T,oe),s(T,he),s(T,se),s(T,ve),s(T,Be),s(T,Ce),s(T,Oe),s(T,le),s(T,we),s(T,Ie),s(T,Xe),s(T,He),s(T,Ee),s(T,ht),s(T,ze),s(T,St),s(T,gt),s(e,Ve),X&&X.m(e,null),lt||(ut=[Z(r,"click",l[14]),Z(p,"click",l[15]),Z(_,"click",l[16])],lt=!0)},p(j,te){te&256&&i!==(i=!j[8])&&(r.disabled=i),te&256&&h!==(h=!j[8])&&(_.disabled=h),te&1024&&me(S,j[10]),j[11]&&!j[8]?Le?Le.p(j,te):(Le=vo(j),Le.c(),Le.m(e,w)):Le&&(Le.d(1),Le=null),te&4096&&W!==(W=j[12]?"Tauri (native)":`MCP Server (${Et.getStatus().baseUrl})`)&&me(R,W),te&512&&me(B,j[9]),te&16&&me(V,j[4]),te&64&&me(pe,j[6]),te&64&&ie!==(ie=j[6]!==1?"s":"")&&me(Se,ie),te&32&&me(Be,j[5]),te&128&&me(Xe,j[7]),te&8&&tt!==(tt=j[3]?"Enabled":"Disabled")&&me(gt,tt),D===(D=Tt(j))&&X?X.p(j,te):(X&&X.d(1),X=D&&D(j),X&&(X.c(),X.m(e,null)))},d(j){j&&A(e),Le&&Le.d(),X&&X.d(),lt=!1,Je(ut)}}}function vo(l){let e,t,o,n;function u(i,d){return i[12]?pr:dr}let r=u(l),c=r(l);return{c(){e=f("div"),t=f("strong"),t.textContent="⚠️ Autocomplete Not Available",o=f("br"),n=g(),c.c(),re(e,"font-size","12px"),re(e,"color","#dc3545"),re(e,"margin-bottom","8px"),re(e,"padding","6px"),re(e,"background","#f8d7da"),re(e,"border-radius","4px")},m(i,d){P(i,e,d),s(e,t),s(e,o),s(e,n),c.m(e,null)},p(i,d){r===(r=u(i))&&c?c.p(i,d):(c.d(1),c=r(i),c&&(c.c(),c.m(e,null)))},d(i){i&&A(e),c.d()}}}function dr(l){let e,t=Et.getStatus().baseUrl+"",o;return{c(){e=F("MCP server not responding. Ensure the server is running on "),o=F(t)},m(n,u){P(n,e,u),P(n,o,u)},p:ye,d(n){n&&A(e),n&&A(o)}}}function pr(l){let e;return{c(){e=F("Tauri backend connection failed. Ensure the application has proper permissions.")},m(t,o){P(t,e,o)},p:ye,d(t){t&&A(e)}}}function mr(l){let e;return{c(){e=f("div"),e.innerHTML=`<strong>❌ Autocomplete Unavailable</strong> 
        <div style="font-size: 11px; margin-top: 4px; color: #721c24;">Click &quot;Rebuild Index&quot; to retry or check server/backend status.</div>`,re(e,"margin-top","8px"),re(e,"padding","8px"),re(e,"background","#f8d7da"),re(e,"border","1px solid #f5c6cb"),re(e,"border-radius","4px")},m(t,o){P(t,e,o)},p:ye,d(t){t&&A(e)}}}function _r(l){let e,t,o,n,u,r,c,i,d,p,m,_,y,h,b,k,S;return{c(){e=f("div"),t=f("strong"),t.textContent="🎯 Autocomplete Active",o=g(),n=f("div"),u=F("Type "),r=f("code"),c=F(l[4]),i=F(" in the editor above to trigger suggestions."),d=f("br"),p=F(`
          Example: `),m=f("code"),_=F(l[4]),y=F("terraphim"),h=F(" or "),b=f("code"),k=F(l[4]),S=F("graph"),re(n,"font-size","11px"),re(n,"margin-top","4px"),re(n,"color","#0056b3"),re(e,"margin-top","8px"),re(e,"padding","8px"),re(e,"background","#d1edff"),re(e,"border","1px solid #b3d9ff"),re(e,"border-radius","4px")},m(v,w){P(v,e,w),s(e,t),s(e,o),s(e,n),s(n,u),s(n,r),s(r,c),s(n,i),s(n,d),s(n,p),s(n,m),s(m,_),s(m,y),s(n,h),s(n,b),s(b,k),s(b,S)},p(v,w){w&16&&me(c,v[4]),w&16&&me(_,v[4]),w&16&&me(k,v[4])},d(v){v&&A(e)}}}function hr(l){let e,t,o,n;e=new As({props:{defaultValue:l[0],isEditable:!l[1],disableLocalStorage:!0,onUpdate:l[13],extensions:[co,...l[2]?[go.configure({trigger:l[4],allowSpaces:!1,limit:l[5],minLength:l[6],debounce:l[7]})]:[]]}});let u=l[2]&&bo(l);return{c(){ae(e.$$.fragment),t=g(),u&&u.c(),o=at()},m(r,c){ue(e,r,c),P(r,t,c),u&&u.m(r,c),P(r,o,c),n=!0},p(r,[c]){const i={};c&1&&(i.defaultValue=r[0]),c&2&&(i.isEditable=!r[1]),c&244&&(i.extensions=[co,...r[2]?[go.configure({trigger:r[4],allowSpaces:!1,limit:r[5],minLength:r[6],debounce:r[7]})]:[]]),e.$set(i),r[2]?u?u.p(r,c):(u=bo(r),u.c(),u.m(o.parentNode,o)):u&&(u.d(1),u=null)},i(r){n||(G(e.$$.fragment,r),n=!0)},o(r){Q(e.$$.fragment,r),n=!1},d(r){ce(e,r),r&&A(t),u&&u.d(r),r&&A(o)}}}function gr(l,e,t){let o,n;Re(l,At,O=>t(9,o=O)),Re(l,je,O=>t(12,n=O));let{html:u=""}=e,{readOnly:r=!1}=e,{outputFormat:c="html"}=e,{enableAutocomplete:i=!0}=e,{showSnippets:d=!0}=e,{suggestionTrigger:p="/"}=e,{maxSuggestions:m=8}=e,{minQueryLength:_=1}=e,{debounceDelay:y=300}=e,h=null,b="⏳ Initializing...",k=!1,S=!1,v=null;qt(async()=>{i&&await w(),typeof document<"u"&&(v=document.createElement("style"),v.textContent=fr,document.head.appendChild(v))}),ps(()=>{v&&v.parentNode&&v.parentNode.removeChild(v)});async function w(){t(10,b="⏳ Initializing autocomplete..."),t(8,k=!1),t(11,S=!1);try{Et.setRole(o),t(10,b="🔗 Testing connection...");const O=await Et.testConnection();t(11,S=!0),O?(t(10,b="🔨 Building autocomplete index..."),await Et.buildAutocompleteIndex()?(n?t(10,b="✅ Ready - Using Tauri backend"):t(10,b="✅ Ready - Using MCP server backend"),t(8,k=!0)):t(10,b="❌ Failed to build autocomplete index")):n?t(10,b="❌ Tauri backend not available"):t(10,b="❌ MCP server not responding")}catch(O){console.error("Error initializing autocomplete:",O),t(10,b="❌ Autocomplete initialization error")}}const T=O=>{h=O,c==="markdown"?t(0,u=O.storage.markdown.getMarkdown()):t(0,u=O.getHTML())},J=async()=>{if(!S){alert("Please wait for connection test to complete");return}if(!k){alert("Autocomplete service not ready. Check the status above.");return}try{t(10,b="🧪 Testing autocomplete...");const O="terraphim",q=await Et.getSuggestions(O,5);if(console.log("Autocomplete test results:",q),q.length>0){const K=q.map((W,R)=>`${R+1}. ${W.text}${W.snippet?` (${W.snippet})`:""}`).join(`
`);alert(`✅ Found ${q.length} suggestions for '${O}':

${K}`),n?t(10,b="✅ Ready - Using Tauri backend"):t(10,b="✅ Ready - Using MCP server backend")}else alert(`⚠️ No suggestions found for '${O}'. This might be normal if the term isn't in your knowledge graph.`)}catch(O){console.error("Autocomplete test failed:",O),alert(`❌ Autocomplete test failed: ${O.message}`),t(10,b="❌ Test failed - check console for details")}},I=async()=>{t(10,b="⏳ Rebuilding index..."),t(8,k=!1);try{await Et.refreshIndex()?(n?t(10,b="✅ Ready - Tauri index rebuilt successfully"):t(10,b="✅ Ready - MCP server index rebuilt successfully"),t(8,k=!0)):t(10,b="❌ Failed to rebuild index")}catch(O){console.error("Error rebuilding index:",O),t(10,b="❌ Index rebuild failed - check console for details")}},H=()=>{if(!h){alert("Editor not ready yet");return}const O=`# Terraphim Autocomplete Demo

This is a demonstration of the integrated Terraphim autocomplete system.

## How to Use:
1. Type "${p}" to trigger autocomplete
2. Start typing any term (e.g., "${p}terraphim", "${p}graph")
3. Use ↑↓ arrows to navigate suggestions
4. Press Tab or Enter to select
5. Press Esc to cancel

## Try these queries:
- ${p}terraphim
- ${p}graph
- ${p}service
- ${p}automata
- ${p}role

The autocomplete system uses your local knowledge graph to provide intelligent suggestions based on your selected role: **${o}**.

---

Start typing below:`;h.commands.setContent(O),setTimeout(()=>{h.commands.focus("end")},100),alert(`Demo content inserted!

Type "${p}" followed by any term to see autocomplete suggestions.

Example: "${p}terraphim"`)};return l.$$set=O=>{"html"in O&&t(0,u=O.html),"readOnly"in O&&t(1,r=O.readOnly),"outputFormat"in O&&t(17,c=O.outputFormat),"enableAutocomplete"in O&&t(2,i=O.enableAutocomplete),"showSnippets"in O&&t(3,d=O.showSnippets),"suggestionTrigger"in O&&t(4,p=O.suggestionTrigger),"maxSuggestions"in O&&t(5,m=O.maxSuggestions),"minQueryLength"in O&&t(6,_=O.minQueryLength),"debounceDelay"in O&&t(7,y=O.debounceDelay)},l.$$.update=()=>{l.$$.dirty&772&&o&&i&&k&&(Et.setRole(o),w())},[u,r,i,d,p,m,_,y,k,o,b,S,n,T,J,I,H,c]}class br extends mt{constructor(e){super(),_t(this,e,gr,hr,it,{html:0,readOnly:1,outputFormat:17,enableAutocomplete:2,showSnippets:3,suggestionTrigger:4,maxSuggestions:5,minQueryLength:6,debounceDelay:7})}}function ko(l){let e,t,o,n,u,r,c,i,d,p,m;return{c(){e=f("div"),t=f("h3"),o=f("span"),o.textContent="Knowledge Graph",n=F(`
          Term: `),u=f("strong"),r=F(l[2]),c=F(" | Rank: "),i=f("strong"),d=F(l[3]),p=g(),m=f("hr"),a(o,"class","tag is-info svelte-329px1"),a(t,"class","subtitle is-6 svelte-329px1"),a(m,"class","svelte-329px1"),a(e,"class","kg-context svelte-329px1")},m(_,y){P(_,e,y),s(e,t),s(t,o),s(t,n),s(t,u),s(u,r),s(t,c),s(t,i),s(i,d),s(e,p),s(e,m)},p(_,y){y&4&&me(r,_[2]),y&8&&me(d,_[3])},d(_){_&&A(e)}}}function vr(l){let e,t,o,n,u,r,c,i;const d=[yr,wr],p=[];function m(_,y){return _[5]?0:1}return t=m(l),o=p[t]=d[t](l),{c(){e=f("div"),o.c(),n=g(),u=f("div"),u.innerHTML='<span class="hint-text svelte-329px1">Double-click to edit • Ctrl+E to edit • Ctrl+S to save • Click KG links to explore</span>',a(u,"class","edit-hint svelte-329px1"),a(e,"class","content-viewer svelte-329px1"),a(e,"tabindex","0"),a(e,"role","button"),a(e,"aria-label","Double-click to edit article content")},m(_,y){P(_,e,y),p[t].m(e,null),s(e,n),s(e,u),l[20](e),r=!0,c||(i=[Z(e,"dblclick",l[14]),Z(e,"keydown",l[15]),Z(e,"click",l[13])],c=!0)},p(_,y){let h=t;t=m(_),t===h?p[t].p(_,y):(We(),Q(p[h],1,1,()=>{p[h]=null}),Ke(),o=p[t],o?o.p(_,y):(o=p[t]=d[t](_),o.c()),G(o,1),o.m(e,n))},i(_){r||(G(o),r=!0)},o(_){Q(o),r=!1},d(_){_&&A(e),p[t].d(),l[20](null),c=!1,Je(i)}}}function kr(l){let e,t,o,n,u,r,c,i,d,p;function m(y){l[18](y)}let _={outputFormat:l[11]};return l[1].body!==void 0&&(_.html=l[1].body),e=new br({props:_}),Qe.push(()=>xe(e,"html",m)),{c(){ae(e.$$.fragment),o=g(),n=f("div"),u=f("button"),u.textContent="Save",r=g(),c=f("button"),c.textContent="Cancel",a(u,"class","button is-primary"),a(c,"class","button is-light"),a(n,"class","edit-controls svelte-329px1")},m(y,h){ue(e,y,h),P(y,o,h),P(y,n,h),s(n,u),s(n,r),s(n,c),i=!0,d||(p=[Z(u,"click",l[12]),Z(c,"click",l[19])],d=!0)},p(y,h){const b={};h&2048&&(b.outputFormat=y[11]),!t&&h&2&&(t=!0,b.html=y[1].body,et(()=>t=!1)),e.$set(b)},i(y){i||(G(e.$$.fragment,y),i=!0)},o(y){Q(e.$$.fragment,y),i=!1},d(y){ce(e,y),y&&A(o),y&&A(n),d=!1,Je(p)}}}function wr(l){let e,t,o;return t=new El({props:{source:l[1].body}}),{c(){e=f("div"),ae(t.$$.fragment),a(e,"class","markdown-content svelte-329px1")},m(n,u){P(n,e,u),ue(t,e,null),o=!0},p(n,u){const r={};u&2&&(r.source=n[1].body),t.$set(r)},i(n){o||(G(t.$$.fragment,n),o=!0)},o(n){Q(t.$$.fragment,n),o=!1},d(n){n&&A(e),ce(t)}}}function yr(l){let e,t=l[1].body+"";return{c(){e=f("div"),a(e,"class","prose svelte-329px1")},m(o,n){P(o,e,n),e.innerHTML=t},p(o,n){n&2&&t!==(t=o[1].body+"")&&(e.innerHTML=t)},i:ye,o:ye,d(o){o&&A(e)}}}function $r(l){let e,t,o,n,u,r=l[1].title+"",c,i,d,p,m,_,y,h=l[2]&&l[3]!==null&&ko(l);const b=[kr,vr],k=[];function S(v,w){return v[4]?0:1}return d=S(l),p=k[d]=b[d](l),{c(){e=f("div"),t=f("button"),o=g(),h&&h.c(),n=g(),u=f("h2"),c=F(r),i=g(),p.c(),a(t,"class","delete is-large modal-close-btn svelte-329px1"),a(t,"aria-label","close"),a(u,"class","svelte-329px1"),a(e,"class","box wrapper svelte-329px1")},m(v,w){P(v,e,w),s(e,t),s(e,o),h&&h.m(e,null),s(e,n),s(e,u),s(u,c),s(e,i),k[d].m(e,null),m=!0,_||(y=Z(t,"click",l[17]),_=!0)},p(v,w){v[2]&&v[3]!==null?h?h.p(v,w):(h=ko(v),h.c(),h.m(e,n)):h&&(h.d(1),h=null),(!m||w&2)&&r!==(r=v[1].title+"")&&me(c,r);let T=d;d=S(v),d===T?k[d].p(v,w):(We(),Q(k[T],1,1,()=>{k[T]=null}),Ke(),p=k[d],p?p.p(v,w):(p=k[d]=b[d](v),p.c()),G(p,1),p.m(e,null))},i(v){m||(G(p),m=!0)},o(v){Q(p),m=!1},d(v){v&&A(e),h&&h.d(),k[d].d(),_=!1,y()}}}function wo(l){let e,t,o;function n(r){l[23](r)}let u={$$slots:{default:[Tr]},$$scope:{ctx:l}};return l[7]!==void 0&&(u.active=l[7]),e=new Dl({props:u}),Qe.push(()=>xe(e,"active",n)),{c(){ae(e.$$.fragment)},m(r,c){ue(e,r,c),o=!0},p(r,c){const i={};c&536872832&&(i.$$scope={dirty:c,ctx:r}),!t&&c&128&&(t=!0,i.active=r[7],et(()=>t=!1)),e.$set(i)},i(r){o||(G(e.$$.fragment,r),o=!0)},o(r){Q(e.$$.fragment,r),o=!1},d(r){ce(e,r)}}}function yo(l){let e,t,o,n,u,r,c,i,d,p,m;return{c(){e=f("div"),t=f("h3"),o=f("span"),o.textContent="Knowledge Graph",n=F(`
            Term: `),u=f("strong"),r=F(l[9]),c=F(" | Rank: "),i=f("strong"),d=F(l[10]),p=g(),m=f("hr"),a(o,"class","tag is-info svelte-329px1"),a(t,"class","subtitle is-6 svelte-329px1"),a(m,"class","svelte-329px1"),a(e,"class","kg-context svelte-329px1")},m(_,y){P(_,e,y),s(e,t),s(t,o),s(t,n),s(t,u),s(u,r),s(t,c),s(t,i),s(i,d),s(e,p),s(e,m)},p(_,y){y&512&&me(r,_[9]),y&1024&&me(d,_[10])},d(_){_&&A(e)}}}function Cr(l){let e,t,o;return t=new El({props:{source:l[8].body}}),{c(){e=f("div"),ae(t.$$.fragment),a(e,"class","markdown-content svelte-329px1")},m(n,u){P(n,e,u),ue(t,e,null),o=!0},p(n,u){const r={};u&256&&(r.source=n[8].body),t.$set(r)},i(n){o||(G(t.$$.fragment,n),o=!0)},o(n){Q(t.$$.fragment,n),o=!1},d(n){n&&A(e),ce(t)}}}function Sr(l){let e,t=l[8].body+"";return{c(){e=f("div"),a(e,"class","prose svelte-329px1")},m(o,n){P(o,e,n),e.innerHTML=t},p(o,n){n&256&&t!==(t=o[8].body+"")&&(e.innerHTML=t)},i:ye,o:ye,d(o){o&&A(e)}}}function Tr(l){let e,t,o,n,u,r=l[8].title+"",c,i,d,p,m,_,y,h,b,k,S,v=l[9]&&l[10]!==null&&yo(l);const w=[Sr,Cr],T=[];function J(I,H){return H&256&&(p=null),p==null&&(p=!!(I[8].body&&(/<html/i.test(I[8].body)||/<body/i.test(I[8].body)||/<head/i.test(I[8].body)))),p?0:1}return m=J(l,-1),_=T[m]=w[m](l),{c(){e=f("div"),t=f("button"),o=g(),v&&v.c(),n=g(),u=f("h2"),c=F(r),i=g(),d=f("div"),_.c(),y=g(),h=f("div"),h.innerHTML='<span class="hint-text svelte-329px1">Knowledge Graph document • Click KG links to explore further</span>',a(t,"class","delete is-large modal-close-btn svelte-329px1"),a(t,"aria-label","close"),a(u,"class","svelte-329px1"),a(h,"class","edit-hint svelte-329px1"),a(d,"class","content-viewer svelte-329px1"),a(d,"tabindex","0"),a(d,"role","button"),a(d,"aria-label","KG document content - click KG links to explore further"),a(e,"class","box wrapper svelte-329px1")},m(I,H){P(I,e,H),s(e,t),s(e,o),v&&v.m(e,null),s(e,n),s(e,u),s(u,c),s(e,i),s(e,d),T[m].m(d,null),s(d,y),s(d,h),b=!0,k||(S=[Z(t,"click",l[22]),Z(d,"click",l[13])],k=!0)},p(I,H){I[9]&&I[10]!==null?v?v.p(I,H):(v=yo(I),v.c(),v.m(e,n)):v&&(v.d(1),v=null),(!b||H&256)&&r!==(r=I[8].title+"")&&me(c,r);let O=m;m=J(I,H),m===O?T[m].p(I,H):(We(),Q(T[O],1,1,()=>{T[O]=null}),Ke(),_=T[m],_?_.p(I,H):(_=T[m]=w[m](I),_.c()),G(_,1),_.m(d,y))},i(I){b||(G(_),b=!0)},o(I){Q(_),b=!1},d(I){I&&A(e),v&&v.d(),T[m].d(),k=!1,Je(S)}}}function Rr(l){let e,t,o,n,u;function r(d){l[21](d)}let c={$$slots:{default:[$r]},$$scope:{ctx:l}};l[0]!==void 0&&(c.active=l[0]),e=new Dl({props:c}),Qe.push(()=>xe(e,"active",r));let i=l[8]&&wo(l);return{c(){ae(e.$$.fragment),o=g(),i&&i.c(),n=at()},m(d,p){ue(e,d,p),P(d,o,p),i&&i.m(d,p),P(d,n,p),u=!0},p(d,[p]){const m={};p&536873087&&(m.$$scope={dirty:p,ctx:d}),!t&&p&1&&(t=!0,m.active=d[0],et(()=>t=!1)),e.$set(m),d[8]?i?(i.p(d,p),p&256&&G(i,1)):(i=wo(d),i.c(),G(i,1),i.m(n.parentNode,n)):i&&(We(),Q(i,1,1,()=>{i=null}),Ke())},i(d){u||(G(e.$$.fragment,d),G(i),u=!0)},o(d){Q(e.$$.fragment,d),Q(i),u=!1},d(d){ce(e,d),d&&A(o),i&&i.d(d),d&&A(n)}}}function Ar(l,e,t){let o,n,u,r;Re(l,je,C=>t(25,u=C)),Re(l,At,C=>t(26,r=C));let{active:c=!1}=e,{item:i}=e,{initialEdit:d=!1}=e,{kgTerm:p=null}=e,{kgRank:m=null}=e,_=!1,y,h=!1,b=null,k=null,S=null;async function v(){if(u)try{const C=await Ge("get_document",{documentId:i.id});C!=null&&C.document&&t(1,i=C.document)}catch(C){console.error("Failed to load document",C)}}async function w(){if(!u){t(4,_=!1);return}try{await Ge("create_document",{document:i}),t(4,_=!1)}catch(C){console.error("Failed to save document",C)}}async function T(C){var z,x,B,Y,$;t(9,k=C),console.log("🔍 KG Link Click Debug Info:"),console.log("  Term clicked:",C),console.log("  Current role:",r),console.log("  Is Tauri mode:",u);try{if(u){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:r,term:C});const N=await Ge("find_documents_for_kg_term",{roleName:r,term:C});console.log("  📥 Tauri response received:"),console.log("    Status:",N.status),console.log("    Results count:",((z=N.results)==null?void 0:z.length)||0),console.log("    Total:",N.total||0),console.log("    Full response:",JSON.stringify(N,null,2)),N.status==="success"&&N.results&&N.results.length>0?(t(8,b=N.results[0]),t(10,S=b.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",b.title),console.log("    Rank:",S),console.log("    Body length:",((x=b.body)==null?void 0:x.length)||0,"characters"),t(7,h=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${C}" in role: "${r}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const N=pt.ServerURL,U=encodeURIComponent(r),M=encodeURIComponent(C),V=`${N}/roles/${U}/kg_search?term=${M}`;console.log("  📤 HTTP Request details:"),console.log("    Base URL:",N),console.log("    Role (encoded):",U),console.log("    Term (encoded):",M),console.log("    Full URL:",V);const ee=await fetch(V);if(console.log("  📥 HTTP Response received:"),console.log("    Status code:",ee.status),console.log("    Status text:",ee.statusText),console.log("    Headers:",Object.fromEntries(ee.headers.entries())),!ee.ok)throw new Error(`HTTP error! Status: ${ee.status} - ${ee.statusText}`);const ne=await ee.json();console.log("  📄 Response data:"),console.log("    Status:",ne.status),console.log("    Results count:",((B=ne.results)==null?void 0:B.length)||0),console.log("    Total:",ne.total||0),console.log("    Full response:",JSON.stringify(ne,null,2)),ne.status==="success"&&ne.results&&ne.results.length>0?(t(8,b=ne.results[0]),t(10,S=b.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",b.title),console.log("    Rank:",S),console.log("    Body length:",((Y=b.body)==null?void 0:Y.length)||0,"characters"),t(7,h=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${C}" in role: "${r}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",V))}}catch(N){console.error("❌ Error fetching KG document:"),console.error("  Error type:",N.constructor.name),console.error("  Error message:",N.message||N),console.error("  Request details:",{term:C,role:r,isTauri:u,timestamp:new Date().toISOString()}),!u&&(($=N.message)!=null&&$.includes("Failed to fetch"))&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{}}function J(C){const z=C.target;if(z.tagName==="A"){const x=z.getAttribute("href");if(x&&x.startsWith("kg:")){C.preventDefault();const B=x.substring(3);T(B)}}}function I(){t(4,_=!0)}function H(C){C.type!=="dblclick"&&((C.ctrlKey||C.metaKey)&&C.key==="e"&&(C.preventDefault(),t(4,_=!0)),_&&(C.ctrlKey||C.metaKey)&&C.key==="s"&&(C.preventDefault(),w()),C.key==="Escape"&&(C.preventDefault(),_?t(4,_=!1):t(0,c=!1)))}const O=()=>t(0,c=!1);function q(C){l.$$.not_equal(i.body,C)&&(i.body=C,t(1,i))}const K=()=>t(4,_=!1);function W(C){Qe[C?"unshift":"push"](()=>{y=C,t(6,y)})}function R(C){c=C,t(0,c)}const L=()=>t(7,h=!1);function E(C){h=C,t(7,h)}return l.$$set=C=>{"active"in C&&t(0,c=C.active),"item"in C&&t(1,i=C.item),"initialEdit"in C&&t(16,d=C.initialEdit),"kgTerm"in C&&t(2,p=C.kgTerm),"kgRank"in C&&t(3,m=C.kgRank)},l.$$.update=()=>{l.$$.dirty&65537&&c&&d&&t(4,_=!0),l.$$.dirty&19&&c&&i&&!_&&v(),l.$$.dirty&2&&t(5,o=i!=null&&i.body?/<html/i.test(i.body)||/<body/i.test(i.body)||/<head/i.test(i.body)||/^\s*<(!DOCTYPE|html|head|body|div|p|span)/i.test(i.body.trim()):!1),l.$$.dirty&32&&t(11,n=o?"html":"markdown")},[c,i,p,m,_,o,y,h,b,k,S,n,w,J,I,H,d,O,q,K,W,R,L,E]}class Hl extends mt{constructor(e){super(),_t(this,e,Ar,Rr,it,{active:0,item:1,initialEdit:16,kgTerm:2,kgRank:3})}}function $o(l,e,t){const o=l.slice();return o[33]=e[t],o}function Co(l,e,t){const o=l.slice();return o[36]=e[t],o}function So(l,e,t){const o=l.slice();return o[39]=e[t],o}function To(l){let e,t;return e=new Bn({props:{type:"is-success",$$slots:{default:[Lr]},$$scope:{ctx:l}}}),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},i(o){t||(G(e.$$.fragment,o),t=!0)},o(o){Q(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function Lr(l){let e,t,o;return{c(){e=f("p"),e.innerHTML="<strong>Success!</strong> Article saved to atomic server successfully.",t=g(),o=f("p"),o.textContent="The modal will close automatically..."},m(n,u){P(n,e,u),P(n,t,u),P(n,o,u)},p:ye,d(n){n&&A(e),n&&A(t),n&&A(o)}}}function Ro(l){let e,t;return e=new Bn({props:{type:"is-danger",$$slots:{default:[Pr]},$$scope:{ctx:l}}}),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},p(o,n){const u={};n[0]&8|n[1]&2048&&(u.$$scope={dirty:n,ctx:o}),e.$set(u)},i(o){t||(G(e.$$.fragment,o),t=!0)},o(o){Q(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function Pr(l){let e,t,o,n;return{c(){e=f("p"),t=f("strong"),t.textContent="Error:",o=g(),n=F(l[3])},m(u,r){P(u,e,r),s(e,t),s(e,o),s(e,n)},p(u,r){r[0]&8&&me(n,u[3])},d(u){u&&A(e)}}}function Ao(l){var E,C,z,x;let e,t,o,n,u,r=(((E=l[1])==null?void 0:E.title)||"Untitled")+"",c,i,d,p,m,_,y=(((C=l[1])==null?void 0:C.rank)||0)+"",h,b,k,S,v,w,T,J,I,H,O=((z=l[1])==null?void 0:z.description)&&Lo(l),q=((x=l[1])==null?void 0:x.tags)&&Po(l);function K(B,Y){return B[10].length>0?Er:Or}let W=K(l),R=W(l),L=l[10].length>0&&No(l);return{c(){e=f("div"),t=f("label"),t.textContent="Document to Save",o=g(),n=f("div"),u=f("h5"),c=F(r),i=g(),O&&O.c(),d=g(),p=f("div"),m=f("span"),_=F("Rank: "),h=F(y),b=g(),q&&q.c(),k=g(),S=f("div"),v=f("label"),v.textContent="Atomic Server",w=g(),T=f("div"),R.c(),J=g(),L&&L.c(),I=at(),a(t,"class","label"),a(u,"class","title is-6"),a(m,"class","tag is-info svelte-48g63o"),a(p,"class","tags svelte-48g63o"),a(n,"class","box document-preview svelte-48g63o"),a(e,"class","field"),a(v,"class","label"),a(v,"for","atomic-server-select"),a(T,"class","control"),a(S,"class","field")},m(B,Y){P(B,e,Y),s(e,t),s(e,o),s(e,n),s(n,u),s(u,c),s(n,i),O&&O.m(n,null),s(n,d),s(n,p),s(p,m),s(m,_),s(m,h),s(p,b),q&&q.m(p,null),P(B,k,Y),P(B,S,Y),s(S,v),s(S,w),s(S,T),R.m(T,null),P(B,J,Y),L&&L.m(B,Y),P(B,I,Y),H=!0},p(B,Y){var $,N,U,M;(!H||Y[0]&2)&&r!==(r=((($=B[1])==null?void 0:$.title)||"Untitled")+"")&&me(c,r),(N=B[1])!=null&&N.description?O?O.p(B,Y):(O=Lo(B),O.c(),O.m(n,d)):O&&(O.d(1),O=null),(!H||Y[0]&2)&&y!==(y=(((U=B[1])==null?void 0:U.rank)||0)+"")&&me(h,y),(M=B[1])!=null&&M.tags?q?q.p(B,Y):(q=Po(B),q.c(),q.m(p,null)):q&&(q.d(1),q=null),W===(W=K(B))&&R?R.p(B,Y):(R.d(1),R=W(B),R&&(R.c(),R.m(T,null))),B[10].length>0?L?(L.p(B,Y),Y[0]&1024&&G(L,1)):(L=No(B),L.c(),G(L,1),L.m(I.parentNode,I)):L&&(We(),Q(L,1,1,()=>{L=null}),Ke())},i(B){H||(G(L),H=!0)},o(B){Q(L),H=!1},d(B){B&&A(e),O&&O.d(),q&&q.d(),B&&A(k),B&&A(S),R.d(),B&&A(J),L&&L.d(B),B&&A(I)}}}function Lo(l){let e,t=l[1].description+"",o;return{c(){e=f("p"),o=F(t),a(e,"class","content")},m(n,u){P(n,e,u),s(e,o)},p(n,u){u[0]&2&&t!==(t=n[1].description+"")&&me(o,t)},d(n){n&&A(e)}}}function Po(l){let e,t=l[1].tags,o=[];for(let n=0;n<t.length;n+=1)o[n]=Oo(So(l,t,n));return{c(){for(let n=0;n<o.length;n+=1)o[n].c();e=at()},m(n,u){for(let r=0;r<o.length;r+=1)o[r]&&o[r].m(n,u);P(n,e,u)},p(n,u){if(u[0]&2){t=n[1].tags;let r;for(r=0;r<t.length;r+=1){const c=So(n,t,r);o[r]?o[r].p(c,u):(o[r]=Oo(c),o[r].c(),o[r].m(e.parentNode,e))}for(;r<o.length;r+=1)o[r].d(1);o.length=t.length}},d(n){Ye(o,n),n&&A(e)}}}function Oo(l){let e,t=l[39]+"",o;return{c(){e=f("span"),o=F(t),a(e,"class","tag svelte-48g63o")},m(n,u){P(n,e,u),s(e,o)},p(n,u){u[0]&2&&t!==(t=n[39]+"")&&me(o,t)},d(n){n&&A(e)}}}function Or(l){let e,t,o,n,u,r,c,i,d;return{c(){e=f("div"),t=f("p"),t.innerHTML="<strong>No atomic servers available</strong>",o=g(),n=f("p"),u=F('Your current role "'),r=F(l[12]),c=F(`" doesn't have any writable atomic server configurations.`),i=g(),d=f("p"),d.textContent="Please configure an atomic server haystack in your role settings.",a(e,"class","notification is-warning")},m(p,m){P(p,e,m),s(e,t),s(e,o),s(e,n),s(n,u),s(n,r),s(n,c),s(e,i),s(e,d)},p(p,m){m[0]&4096&&me(r,p[12])},d(p){p&&A(e)}}}function Er(l){let e,t,o,n,u,r,c=l[10],i=[];for(let d=0;d<c.length;d+=1)i[d]=Eo(Co(l,c,d));return{c(){e=f("div"),t=f("select");for(let d=0;d<i.length;d+=1)i[d].c();o=g(),n=f("p"),n.textContent=`Select the atomic server from your current role configuration.
              🔐 = Authenticated, ⚠️ = Anonymous access`,a(t,"id","atomic-server-select"),t.disabled=l[2],l[11]===void 0&&rt(()=>l[18].call(t)),a(e,"class","select is-fullwidth"),a(n,"class","help svelte-48g63o")},m(d,p){P(d,e,p),s(e,t);for(let m=0;m<i.length;m+=1)i[m]&&i[m].m(t,null);Me(t,l[11],!0),P(d,o,p),P(d,n,p),u||(r=Z(t,"change",l[18]),u=!0)},p(d,p){if(p[0]&1024){c=d[10];let m;for(m=0;m<c.length;m+=1){const _=Co(d,c,m);i[m]?i[m].p(_,p):(i[m]=Eo(_),i[m].c(),i[m].m(t,null))}for(;m<i.length;m+=1)i[m].d(1);i.length=c.length}p[0]&4&&(t.disabled=d[2]),p[0]&3072&&Me(t,d[11])},d(d){d&&A(e),Ye(i,d),d&&A(o),d&&A(n),u=!1,r()}}}function Nr(l){let e;return{c(){e=f("span"),e.textContent="⚠️ No Auth",a(e,"class","has-text-warning")},m(t,o){P(t,e,o)},d(t){t&&A(e)}}}function Ur(l){let e;return{c(){e=f("span"),e.textContent="🔐",a(e,"class","has-text-success")},m(t,o){P(t,e,o)},d(t){t&&A(e)}}}function Eo(l){let e,t=l[36].location+"",o,n,u,r;function c(p,m){return p[36].atomic_server_secret?Ur:Nr}let i=c(l),d=i(l);return{c(){e=f("option"),o=F(t),n=g(),d.c(),u=g(),e.__value=r=l[36].location,e.value=e.__value},m(p,m){P(p,e,m),s(e,o),s(e,n),d.m(e,null),s(e,u)},p(p,m){m[0]&1024&&t!==(t=p[36].location+"")&&me(o,t),i!==(i=c(p))&&(d.d(1),d=i(p),d&&(d.c(),d.m(e,u))),m[0]&1024&&r!==(r=p[36].location)&&(e.__value=r,e.value=e.__value)},d(p){p&&A(e),d.d()}}}function No(l){var D,X;let e,t,o,n,u,r,c,i,d,p,m,_,y,h,b,k,S,v,w,T,J,I,H,O,q,K,W,R,L,E,C,z,x,B,Y,$,N,U,M,V,ee,ne,ke,be=(l[8]||"Untitled")+"",Ne,pe,fe,ie,Se,Te=(((X=(D=l[1])==null?void 0:D.body)==null?void 0:X.length)||0)+"",oe,he,se,ve,Be,Ce,Oe=l[14]()+"",le,we,Ie,Xe,He,Ee=l[15]()+"",ht,ze,St,tt,gt;function Ve(j){l[19](j)}let lt={id:"article-title",placeholder:"Enter article title",disabled:l[2],required:!0};l[8]!==void 0&&(lt.value=l[8]),u=new Jt({props:lt}),Qe.push(()=>xe(u,"value",Ve));const ut=[Mr,Ir],Le=[];function Tt(j,te){return j[7]?1:0}return K=Tt(l),W=Le[K]=ut[K](l),C=new Pl({props:{type:"is-primary",loading:l[2],disabled:l[2]||!l[8].trim()||!l[11],$$slots:{default:[Dr]},$$scope:{ctx:l}}}),C.$on("click",l[16]),B=new Pl({props:{type:"is-light",disabled:l[2],$$slots:{default:[jr]},$$scope:{ctx:l}}}),B.$on("click",l[17]),St=qn(l[22][0]),{c(){e=f("div"),t=f("label"),t.textContent="Article Title",o=g(),n=f("div"),ae(u.$$.fragment),c=g(),i=f("div"),d=f("label"),d.textContent="Description",p=g(),m=f("div"),_=f("textarea"),y=g(),h=f("div"),b=f("label"),b.textContent="Parent Collection",k=g(),S=f("div"),v=f("label"),w=f("input"),T=F(`
              Use predefined collection`),J=g(),I=f("label"),H=f("input"),O=F(`
              Custom parent URL/path`),q=g(),W.c(),R=g(),L=f("div"),E=f("div"),ae(C.$$.fragment),z=g(),x=f("div"),ae(B.$$.fragment),Y=g(),$=f("div"),N=f("div"),U=f("p"),U.innerHTML="<strong>What will be saved:</strong>",M=g(),V=f("ul"),ee=f("li"),ne=f("strong"),ne.textContent="Title:",ke=g(),Ne=F(be),pe=g(),fe=f("li"),ie=f("strong"),ie.textContent="Body:",Se=F(" Original document content ("),oe=F(Te),he=F(" characters)"),se=g(),ve=f("li"),Be=f("strong"),Be.textContent="Parent:",Ce=g(),le=F(Oe),we=g(),Ie=f("li"),Xe=f("strong"),Xe.textContent="Subject URL:",He=g(),ht=F(Ee),a(t,"class","label"),a(t,"for","article-title"),a(n,"class","control"),a(e,"class","field"),a(d,"class","label"),a(d,"for","article-description"),a(_,"id","article-description"),a(_,"class","textarea"),a(_,"placeholder","Brief description of the article"),_.disabled=l[2],a(_,"rows","3"),a(m,"class","control"),a(i,"class","field"),a(b,"class","label"),a(w,"type","radio"),w.__value=!1,w.value=w.__value,w.disabled=l[2],a(v,"class","radio svelte-48g63o"),a(H,"type","radio"),H.__value=!0,H.value=H.__value,H.disabled=l[2],a(I,"class","radio svelte-48g63o"),a(S,"class","control"),a(h,"class","field"),a(E,"class","control"),a(x,"class","control"),a(L,"class","field is-grouped"),a(ee,"class","svelte-48g63o"),a(fe,"class","svelte-48g63o"),a(ve,"class","svelte-48g63o"),a(Ie,"class","svelte-48g63o"),a(V,"class","svelte-48g63o"),a(N,"class","notification is-info is-light svelte-48g63o"),a($,"class","field"),St.p(w,H)},m(j,te){P(j,e,te),s(e,t),s(e,o),s(e,n),ue(u,n,null),P(j,c,te),P(j,i,te),s(i,d),s(i,p),s(i,m),s(m,_),Ae(_,l[9]),P(j,y,te),P(j,h,te),s(h,b),s(h,k),s(h,S),s(S,v),s(v,w),w.checked=w.__value===l[7],s(v,T),s(S,J),s(S,I),s(I,H),H.checked=H.__value===l[7],s(I,O),P(j,q,te),Le[K].m(j,te),P(j,R,te),P(j,L,te),s(L,E),ue(C,E,null),s(L,z),s(L,x),ue(B,x,null),P(j,Y,te),P(j,$,te),s($,N),s(N,U),s(N,M),s(N,V),s(V,ee),s(ee,ne),s(ee,ke),s(ee,Ne),s(V,pe),s(V,fe),s(fe,ie),s(fe,Se),s(fe,oe),s(fe,he),s(V,se),s(V,ve),s(ve,Be),s(ve,Ce),s(ve,le),s(V,we),s(V,Ie),s(Ie,Xe),s(Ie,He),s(Ie,ht),ze=!0,tt||(gt=[Z(_,"input",l[20]),Z(w,"change",l[21]),Z(H,"change",l[23])],tt=!0)},p(j,te){var Pe,Fe;const _e={};te[0]&4&&(_e.disabled=j[2]),!r&&te[0]&256&&(r=!0,_e.value=j[8],et(()=>r=!1)),u.$set(_e),(!ze||te[0]&4)&&(_.disabled=j[2]),te[0]&512&&Ae(_,j[9]),(!ze||te[0]&4)&&(w.disabled=j[2]),te[0]&128&&(w.checked=w.__value===j[7]),(!ze||te[0]&4)&&(H.disabled=j[2]),te[0]&128&&(H.checked=H.__value===j[7]);let de=K;K=Tt(j),K===de?Le[K].p(j,te):(We(),Q(Le[de],1,1,()=>{Le[de]=null}),Ke(),W=Le[K],W?W.p(j,te):(W=Le[K]=ut[K](j),W.c()),G(W,1),W.m(R.parentNode,R));const De={};te[0]&4&&(De.loading=j[2]),te[0]&2308&&(De.disabled=j[2]||!j[8].trim()||!j[11]),te[1]&2048&&(De.$$scope={dirty:te,ctx:j}),C.$set(De);const qe={};te[0]&4&&(qe.disabled=j[2]),te[1]&2048&&(qe.$$scope={dirty:te,ctx:j}),B.$set(qe),(!ze||te[0]&256)&&be!==(be=(j[8]||"Untitled")+"")&&me(Ne,be),(!ze||te[0]&2)&&Te!==(Te=(((Fe=(Pe=j[1])==null?void 0:Pe.body)==null?void 0:Fe.length)||0)+"")&&me(oe,Te)},i(j){ze||(G(u.$$.fragment,j),G(W),G(C.$$.fragment,j),G(B.$$.fragment,j),ze=!0)},o(j){Q(u.$$.fragment,j),Q(W),Q(C.$$.fragment,j),Q(B.$$.fragment,j),ze=!1},d(j){j&&A(e),ce(u),j&&A(c),j&&A(i),j&&A(y),j&&A(h),j&&A(q),Le[K].d(j),j&&A(R),j&&A(L),ce(C),ce(B),j&&A(Y),j&&A($),St.r(),tt=!1,Je(gt)}}}function Ir(l){let e,t,o,n,u,r,c;function i(p){l[25](p)}let d={placeholder:"e.g., my-collection or http://server/custom-parent",disabled:l[2]};return l[6]!==void 0&&(d.value=l[6]),o=new Jt({props:d}),Qe.push(()=>xe(o,"value",i)),{c(){e=f("div"),t=f("div"),ae(o.$$.fragment),u=g(),r=f("p"),r.textContent=`Enter a collection name (e.g., "my-articles") or full URL.
              If the collection doesn't exist, it will be created.`,a(t,"class","control"),a(r,"class","help svelte-48g63o"),a(e,"class","field")},m(p,m){P(p,e,m),s(e,t),ue(o,t,null),s(e,u),s(e,r),c=!0},p(p,m){const _={};m[0]&4&&(_.disabled=p[2]),!n&&m[0]&64&&(n=!0,_.value=p[6],et(()=>n=!1)),o.$set(_)},i(p){c||(G(o.$$.fragment,p),c=!0)},o(p){Q(o.$$.fragment,p),c=!1},d(p){p&&A(e),ce(o)}}}function Mr(l){let e,t,o,n,u,r,c=l[13],i=[];for(let d=0;d<c.length;d+=1)i[d]=Uo($o(l,c,d));return{c(){e=f("div"),t=f("div"),o=f("div"),n=f("select");for(let d=0;d<i.length;d+=1)i[d].c();n.disabled=l[2],l[5]===void 0&&rt(()=>l[24].call(n)),a(o,"class","select is-fullwidth"),a(t,"class","control"),a(e,"class","field")},m(d,p){P(d,e,p),s(e,t),s(t,o),s(o,n);for(let m=0;m<i.length;m+=1)i[m]&&i[m].m(n,null);Me(n,l[5],!0),u||(r=Z(n,"change",l[24]),u=!0)},p(d,p){if(p[0]&8192){c=d[13];let m;for(m=0;m<c.length;m+=1){const _=$o(d,c,m);i[m]?i[m].p(_,p):(i[m]=Uo(_),i[m].c(),i[m].m(n,null))}for(;m<i.length;m+=1)i[m].d(1);i.length=c.length}p[0]&4&&(n.disabled=d[2]),p[0]&8224&&Me(n,d[5])},i:ye,o:ye,d(d){d&&A(e),Ye(i,d),u=!1,r()}}}function Uo(l){let e,t=l[33].label+"",o;return{c(){e=f("option"),o=F(t),e.__value=l[33].value,e.value=e.__value},m(n,u){P(n,e,u),s(e,o)},p:ye,d(n){n&&A(e)}}}function Dr(l){let e,t,o;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-cloud-upload-alt"></i>',t=g(),o=f("span"),o.textContent="Save to Atomic Server",a(e,"class","icon")},m(n,u){P(n,e,u),P(n,t,u),P(n,o,u)},p:ye,d(n){n&&A(e),n&&A(t),n&&A(o)}}}function jr(l){let e;return{c(){e=F("Cancel")},m(t,o){P(t,e,o)},d(t){t&&A(e)}}}function Hr(l){let e,t,o,n,u,r,c,i,d,p,m,_,y,h=l[4]&&To(l),b=l[3]&&Ro(l),k=!l[4]&&Ao(l);return{c(){e=f("div"),t=f("div"),o=f("div"),o.innerHTML=`<div class="level-item"><h3 class="title is-4"><span class="icon"><i class="fas fa-save"></i></span>
            Save to Atomic Server</h3></div>`,n=g(),u=f("div"),r=f("div"),c=f("button"),i=g(),h&&h.c(),d=g(),b&&b.c(),p=g(),k&&k.c(),a(o,"class","level-left"),a(c,"class","delete is-large"),c.disabled=l[2],a(c,"aria-label","close"),a(r,"class","level-item"),a(u,"class","level-right"),a(t,"class","level svelte-48g63o"),a(e,"class","box")},m(S,v){P(S,e,v),s(e,t),s(t,o),s(t,n),s(t,u),s(u,r),s(r,c),s(e,i),h&&h.m(e,null),s(e,d),b&&b.m(e,null),s(e,p),k&&k.m(e,null),m=!0,_||(y=Z(c,"click",l[17]),_=!0)},p(S,v){(!m||v[0]&4)&&(c.disabled=S[2]),S[4]?h?v[0]&16&&G(h,1):(h=To(S),h.c(),G(h,1),h.m(e,d)):h&&(We(),Q(h,1,1,()=>{h=null}),Ke()),S[3]?b?(b.p(S,v),v[0]&8&&G(b,1)):(b=Ro(S),b.c(),G(b,1),b.m(e,p)):b&&(We(),Q(b,1,1,()=>{b=null}),Ke()),S[4]?k&&(We(),Q(k,1,1,()=>{k=null}),Ke()):k?(k.p(S,v),v[0]&16&&G(k,1)):(k=Ao(S),k.c(),G(k,1),k.m(e,null))},i(S){m||(G(h),G(b),G(k),m=!0)},o(S){Q(h),Q(b),Q(k),m=!1},d(S){S&&A(e),h&&h.d(),b&&b.d(),k&&k.d(),_=!1,y()}}}function zr(l){let e,t,o;function n(r){l[26](r)}let u={$$slots:{default:[Hr]},$$scope:{ctx:l}};return l[0]!==void 0&&(u.active=l[0]),e=new Dl({props:u}),Qe.push(()=>xe(e,"active",n)),e.$on("close",l[17]),{c(){ae(e.$$.fragment)},m(r,c){ue(e,r,c),o=!0},p(r,c){const i={};c[0]&8190|c[1]&2048&&(i.$$scope={dirty:c,ctx:r}),!t&&c[0]&1&&(t=!0,i.active=r[0],et(()=>t=!1)),e.$set(i)},i(r){o||(G(e.$$.fragment,r),o=!0)},o(r){Q(e.$$.fragment,r),o=!1},d(r){ce(e,r)}}}function Fr(l,e,t){let o,n,u;Re(l,je,$=>t(27,o=$)),Re(l,Ct,$=>t(28,n=$)),Re(l,At,$=>t(12,u=$));let{active:r=!1}=e,{document:c}=e,i=!1,d=null,p=!1,m="",_="",y=!1,h="",b="",k=[],S="";const v=[{label:"Root (Server Root)",value:""},{label:"Articles Collection",value:"articles"},{label:"Documents Collection",value:"documents"},{label:"Knowledge Base",value:"knowledge-base"},{label:"Research",value:"research"},{label:"Projects",value:"projects"}];function w(){t(2,i=!1),t(3,d=null),t(4,p=!1),t(5,m=""),t(6,_=""),t(7,y=!1),t(8,h=(c==null?void 0:c.title)||""),t(9,b=(c==null?void 0:c.description)||`Article saved from Terraphim search: ${c==null?void 0:c.title}`),t(10,k=[]),t(11,S="")}function T(){var M;const $=u,N=n;if(!(N!=null&&N.roles)||!$){console.warn("No role configuration found");return}let U=null;try{for(const[V,ee]of Object.entries(N.roles)){const ne=ee,ke=typeof ne.name=="object"?ne.name.original:String(ne.name);if(V===$||ke===$){U=ne;break}}}catch(V){console.warn("Error checking role configuration:",V);return}if(!U){console.warn(`Role "${$}" not found in configuration`);return}t(10,k=((M=U.haystacks)==null?void 0:M.filter(V=>V.service==="Atomic"&&V.location&&!V.read_only))||[]),k.length>0&&t(11,S=k[0].location),console.log("Loaded atomic servers:",k)}function J(){const $=k.find(N=>N.location===S);return $==null?void 0:$.atomic_server_secret}function I(){const $=S.replace(/\/$/,"");if(y&&_.trim()){const N=_.trim();return N.startsWith("http://")||N.startsWith("https://")?N:`${$}/${N.replace(/^\//,"")}`}else return m?`${$}/${m}`:$}function H(){return h.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,50)}function O(){const $=S.replace(/\/$/,""),N=H(),U=Date.now();return`${$}/${N}-${U}`}async function q(){if(!S||!h.trim()){t(3,d="Please select an atomic server and provide a title");return}t(2,i=!0),t(3,d=null);try{const $=O(),N=I(),U=J();console.log("🔄 Saving article to atomic server:",{subject:$,parent:N,server:S,hasSecret:!!U});const M={subject:$,title:h.trim(),description:b.trim(),body:c.body,parent:N,shortname:H(),original_id:c.id,original_url:c.url,original_rank:c.rank,tags:c.tags||[]};if(o)await Ge("save_article_to_atomic",{article:M,serverUrl:S,atomicSecret:U});else{const V=await fetch(`${pt.ServerURL}/atomic/save`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({article:M,server_url:S,atomic_secret:U})});if(!V.ok){const ee=await V.json().catch(()=>({error:V.statusText}));throw new Error(ee.error||`HTTP ${V.status}: ${V.statusText}`)}}t(4,p=!0),console.log("✅ Article saved successfully to atomic server"),setTimeout(()=>{t(0,r=!1)},2e3)}catch($){console.error("❌ Failed to save article to atomic server:",$),t(3,d=$.message||"Failed to save article to atomic server")}finally{t(2,i=!1)}}function K(){i||t(0,r=!1)}const W=[[]];function R(){S=Rt(this),t(11,S),t(10,k)}function L($){h=$,t(8,h)}function E(){b=this.value,t(9,b)}function C(){y=this.__value,t(7,y)}function z(){y=this.__value,t(7,y)}function x(){m=Rt(this),t(5,m),t(13,v)}function B($){_=$,t(6,_)}function Y($){r=$,t(0,r)}return l.$$set=$=>{"active"in $&&t(0,r=$.active),"document"in $&&t(1,c=$.document)},l.$$.update=()=>{l.$$.dirty[0]&3&&r&&c&&(w(),T())},[r,c,i,d,p,m,_,y,h,b,k,S,u,v,I,O,q,K,R,L,E,C,W,z,x,B,Y]}class Wr extends mt{constructor(e){super(),_t(this,e,Fr,zr,it,{active:0,document:1},null,[-1,-1])}}async function zl(l){return Ge("tauri",l)}async function Kr(l,e){return zl({__tauriModule:"Event",message:{cmd:"unlisten",event:l,eventId:e}})}async function Gr(l,e,t){return zl({__tauriModule:"Event",message:{cmd:"listen",event:l,windowLabel:e,handler:Il(t)}}).then(o=>async()=>Kr(l,o))}var Io;(function(l){l.WINDOW_RESIZED="tauri://resize",l.WINDOW_MOVED="tauri://move",l.WINDOW_CLOSE_REQUESTED="tauri://close-requested",l.WINDOW_CREATED="tauri://window-created",l.WINDOW_DESTROYED="tauri://destroyed",l.WINDOW_FOCUS="tauri://focus",l.WINDOW_BLUR="tauri://blur",l.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",l.WINDOW_THEME_CHANGED="tauri://theme-changed",l.WINDOW_FILE_DROP="tauri://file-drop",l.WINDOW_FILE_DROP_HOVER="tauri://file-drop-hover",l.WINDOW_FILE_DROP_CANCELLED="tauri://file-drop-cancelled",l.MENU="tauri://menu",l.CHECK_UPDATE="tauri://update",l.UPDATE_AVAILABLE="tauri://update-available",l.INSTALL_UPDATE="tauri://update-install",l.STATUS_UPDATE="tauri://update-status",l.DOWNLOAD_PROGRESS="tauri://update-download-progress"})(Io||(Io={}));async function Br(l,e){return Gr(l,null,e)}function Mo(l,e,t){const o=l.slice();return o[9]=e[t],o}function Do(l){let e,t=l[9].name+"",o,n;return{c(){e=f("option"),o=F(t),e.__value=n=l[9].name,e.value=e.__value},m(u,r){P(u,e,r),s(e,o)},p(u,r){r&1&&t!==(t=u[9].name+"")&&me(o,t),r&1&&n!==(n=u[9].name)&&(e.__value=n,e.value=e.__value)},d(u){u&&A(e)}}}function qr(l){let e,t,o,n,u,r,c=l[0],i=[];for(let d=0;d<c.length;d+=1)i[d]=Do(Mo(l,c,d));return{c(){e=f("div"),t=f("div"),o=f("div"),n=f("select");for(let d=0;d<i.length;d+=1)i[d].c();a(o,"class","select"),a(t,"class","control"),a(e,"class","field is-grouped is-grouped-right")},m(d,p){P(d,e,p),s(e,t),s(t,o),s(o,n);for(let m=0;m<i.length;m+=1)i[m]&&i[m].m(n,null);Me(n,l[1]),u||(r=Z(n,"change",l[2]),u=!0)},p(d,[p]){if(p&1){c=d[0];let m;for(m=0;m<c.length;m+=1){const _=Mo(d,c,m);i[m]?i[m].p(_,p):(i[m]=Do(_),i[m].c(),i[m].m(n,null))}for(;m<i.length;m+=1)i[m].d(1);i.length=c.length}p&3&&Me(n,d[1])},i:ye,o:ye,d(d){d&&A(e),Ye(i,d),u=!1,r()}}}function Jr(l,e,t){let o,n,u,r;Re(l,Ct,_=>t(5,o=_)),Re(l,je,_=>t(6,n=_)),Re(l,fo,_=>t(0,u=_)),Re(l,At,_=>t(1,r=_));let c="";async function i(){try{je.set(window.__TAURI__!==void 0),n?(console.log("Loading config from Tauri"),Ge("get_config").then(_=>{console.log("get_config response",_),_&&_.status==="success"&&d(_.config)}).catch(_=>console.error("Error fetching config in Tauri:",_))):(console.log("Loading config from server"),c=`${pt.ServerURL}/config/`,fetch(c).then(_=>_.json()).then(_=>{console.log("Config received",_),_&&_.status==="success"&&d(_.config)}).catch(_=>console.error("Error fetching config:",_)))}catch(_){console.error("Unhandled error in loadConfig:",_)}}function d(_){var k;console.log("Updating stores from config:",_);const y={default_role:_.selected_role,..._};Ct.set(y);const h=Object.entries(_.roles).map(([S,v])=>({name:S,...v}));fo.set(h),At.set(_.selected_role);const b=_.roles[_.selected_role];if(console.log("Selected role settings:",b),b){const S=b.theme||"spacelab";console.log("Setting theme to:",S),pl.set(S),(k=b.kg)!=null&&k.publish?n?Ge("publish_thesaurus",{roleName:_.selected_role}).then(v=>{console.log("publish_thesaurus response",v),fl.set(v),$t.set(!0)}):(console.log("Fetching thesaurus from HTTP endpoint for role",_.selected_role),fetch(`${pt.ServerURL}/thesaurus/${encodeURIComponent(_.selected_role)}`).then(v=>v.json()).then(v=>{console.log("thesaurus HTTP response",v),v&&v.status==="success"&&v.thesaurus?(fl.set(v.thesaurus),$t.set(!0)):(console.error("Failed to fetch thesaurus:",v),$t.set(!1))}).catch(v=>{console.error("Error fetching thesaurus:",v),$t.set(!1)})):$t.set(!1)}else console.warn("No role settings found for:",_.selected_role),pl.set("spacelab")}typeof window<"u"&&window.__TAURI__&&Br("role_changed",_=>{console.log("Role changed event received from backend:",_.payload),d(_.payload)});async function p(){await i()}p(),console.log("Using Terraphim Server URL:",pt.ServerURL);function m(_){var S,v;const h=_.currentTarget.value;console.log("Role change requested:",h),At.set(h);const b=u.find(w=>w.name===h);if(!b){console.error(`No role settings found for role: ${h}.`);return}const k=b.theme||"spacelab";pl.set(k),console.log(`Theme changed to ${k}`),Ct.update(w=>(w.selected_role=h,w)),n?(Ge("select_role",{roleName:h}).catch(w=>console.error("Error selecting role:",w)),(S=b.kg)!=null&&S.publish?(console.log("Publishing thesaurus for role",h),Ge("publish_thesaurus",{roleName:h}).then(w=>{fl.set(w),$t.set(!0)})):$t.set(!1)):(fetch(`${pt.ServerURL}/config/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).catch(w=>console.error("Error updating config on server:",w)),(v=b.kg)!=null&&v.publish?(console.log("Fetching thesaurus from HTTP endpoint for role",h),fetch(`${pt.ServerURL}/thesaurus/${encodeURIComponent(h)}`).then(w=>w.json()).then(w=>{console.log("thesaurus HTTP response",w),w&&w.status==="success"&&w.thesaurus?(fl.set(w.thesaurus),$t.set(!0)):(console.error("Failed to fetch thesaurus:",w),$t.set(!1))}).catch(w=>{console.error("Error fetching thesaurus:",w),$t.set(!1)})):$t.set(!1))}return[u,r,m,i]}class Ll extends mt{constructor(e){super(),_t(this,e,Jr,qr,it,{loadConfig:3})}get loadConfig(){return this.$$.ctx[3]}}function jo(l,e,t){const o=l.slice();return o[33]=e[t],o}function Ho(l,e,t){const o=l.slice();return o[36]=e[t],o}function zo(l){let e,t;return e=new Jn({props:{$$slots:{default:[Qr]},$$scope:{ctx:l}}}),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},p(o,n){const u={};n[0]&129|n[1]&256&&(u.$$scope={dirty:n,ctx:o}),e.$set(u)},i(o){t||(G(e.$$.fragment,o),t=!0)},o(o){Q(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function Vr(l){let e=l[36]+"",t;return{c(){t=F(e)},m(o,n){P(o,t,n)},p(o,n){n[0]&1&&e!==(e=o[36]+"")&&me(t,e)},d(o){o&&A(t)}}}function Fo(l){let e,t,o,n,u,r;t=new Vn({props:{rounded:!0,$$slots:{default:[Vr]},$$scope:{ctx:l}}});function c(){return l[18](l[36])}return{c(){e=f("button"),ae(t.$$.fragment),o=g(),a(e,"class","tag-button svelte-2smypa"),e.disabled=l[7],a(e,"title","Click to view knowledge graph document")},m(i,d){P(i,e,d),ue(t,e,null),s(e,o),n=!0,u||(r=Z(e,"click",c),u=!0)},p(i,d){l=i;const p={};d[0]&1|d[1]&256&&(p.$$scope={dirty:d,ctx:l}),t.$set(p),(!n||d[0]&128)&&(e.disabled=l[7])},i(i){n||(G(t.$$.fragment,i),n=!0)},o(i){Q(t.$$.fragment,i),n=!1},d(i){i&&A(e),ce(t),u=!1,r()}}}function Qr(l){let e,t,o=l[0].tags,n=[];for(let r=0;r<o.length;r+=1)n[r]=Fo(Ho(l,o,r));const u=r=>Q(n[r],1,1,()=>{n[r]=null});return{c(){for(let r=0;r<n.length;r+=1)n[r].c();e=at()},m(r,c){for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(r,c);P(r,e,c),t=!0},p(r,c){if(c[0]&65665){o=r[0].tags;let i;for(i=0;i<o.length;i+=1){const d=Ho(r,o,i);n[i]?(n[i].p(d,c),G(n[i],1)):(n[i]=Fo(d),n[i].c(),G(n[i],1),n[i].m(e.parentNode,e))}for(We(),i=o.length;i<n.length;i+=1)u(i);Ke()}},i(r){if(!t){for(let c=0;c<o.length;c+=1)G(n[c]);t=!0}},o(r){n=n.filter(Boolean);for(let c=0;c<n.length;c+=1)Q(n[c]);t=!1},d(r){Ye(n,r),r&&A(e)}}}function Yr(l){let e,t=(l[0].rank||0)+"",o;return{c(){e=F("Rank "),o=F(t)},m(n,u){P(n,e,u),P(n,o,u)},p(n,u){u[0]&1&&t!==(t=(n[0].rank||0)+"")&&me(o,t)},d(n){n&&A(e),n&&A(o)}}}function Zr(l){let e,t;return e=new Vn({props:{rounded:!0,$$slots:{default:[Yr]},$$scope:{ctx:l}}}),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},p(o,n){const u={};n[0]&1|n[1]&256&&(u.$$scope={dirty:n,ctx:o}),e.$set(u)},i(o){t||(G(e.$$.fragment,o),t=!0)},o(o){Q(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function Xr(l){let e;return{c(){e=f("small"),e.textContent="No description available",a(e,"class","no-description svelte-2smypa")},m(t,o){P(t,e,o)},p:ye,i:ye,o:ye,d(t){t&&A(e)}}}function xr(l){let e,t;return e=new El({props:{source:l[0].description}}),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},p(o,n){const u={};n[0]&1&&(u.source=o[0].description),e.$set(u)},i(o){t||(G(e.$$.fragment,o),t=!0)},o(o){Q(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function Wo(l){let e,t,o,n,u,r;return{c(){e=f("button"),t=f("span"),t.innerHTML='<i class="fas fa-magic" aria-hidden="true"></i>',o=g(),n=f("span"),n.textContent="AI Summary",a(t,"class","icon is-small"),a(e,"class","button is-small is-info is-outlined ai-summary-button svelte-2smypa"),e.disabled=l[9],a(e,"title","Generate AI-powered summary using OpenRouter")},m(c,i){P(c,e,i),s(e,t),s(e,o),s(e,n),u||(r=Z(e,"click",l[17]),u=!0)},p(c,i){i[0]&512&&(e.disabled=c[9])},d(c){c&&A(e),u=!1,r()}}}function Ko(l){let e;return{c(){e=f("div"),e.innerHTML=`<span class="icon"><i class="fas fa-spinner fa-spin" aria-hidden="true"></i></span> 
                <small>Generating AI summary...</small>`,a(e,"class","ai-summary-loading svelte-2smypa")},m(t,o){P(t,e,o)},d(t){t&&A(e)}}}function Go(l){let e,t,o,n,u,r,c,i,d,p;return{c(){e=f("div"),t=f("span"),t.innerHTML='<i class="fas fa-exclamation-triangle" aria-hidden="true"></i>',o=g(),n=f("small"),u=F("Summary error: "),r=F(l[10]),c=g(),i=f("button"),i.textContent="Retry",a(t,"class","icon has-text-danger"),a(n,"class","has-text-danger"),a(i,"class","button is-small is-text svelte-2smypa"),a(i,"title","Retry generating summary"),a(e,"class","ai-summary-error svelte-2smypa")},m(m,_){P(m,e,_),s(e,t),s(e,o),s(e,n),s(n,u),s(n,r),s(e,c),s(e,i),d||(p=Z(i,"click",l[19]),d=!0)},p(m,_){_[0]&1024&&me(r,m[10])},d(m){m&&A(e),d=!1,p()}}}function Bo(l){let e,t,o,n,u,r,c,i,d,p,m,_,y,h,b,k,S,v,w,T;function J(O,q){return O[12]?ti:ei}let I=J(l),H=I(l);return p=new El({props:{source:l[8]}}),{c(){e=f("div"),t=f("div"),o=f("small"),n=f("span"),n.innerHTML='<i class="fas fa-robot" aria-hidden="true"></i>',u=F(`
                    AI Summary
                    `),H.c(),r=g(),c=f("button"),c.innerHTML='<span class="icon is-small"><i class="fas fa-times" aria-hidden="true"></i></span>',i=g(),d=f("div"),ae(p.$$.fragment),m=g(),_=f("div"),y=f("button"),h=f("span"),h.innerHTML='<i class="fas fa-redo" aria-hidden="true"></i>',b=g(),k=f("span"),k.textContent="Regenerate",a(n,"class","icon is-small"),a(o,"class","ai-summary-label svelte-2smypa"),a(c,"class","button is-small is-text svelte-2smypa"),a(c,"title","Hide AI summary"),a(t,"class","ai-summary-header svelte-2smypa"),a(d,"class","ai-summary-content svelte-2smypa"),a(h,"class","icon is-small"),a(y,"class","button is-small is-text svelte-2smypa"),y.disabled=l[9],a(y,"title","Regenerate summary"),a(_,"class","ai-summary-actions svelte-2smypa"),a(e,"class","ai-summary svelte-2smypa")},m(O,q){P(O,e,q),s(e,t),s(t,o),s(o,n),s(o,u),H.m(o,null),s(t,r),s(t,c),s(e,i),s(e,d),ue(p,d,null),s(e,m),s(e,_),s(_,y),s(y,h),s(y,b),s(y,k),v=!0,w||(T=[Z(c,"click",l[20]),Z(y,"click",l[21])],w=!0)},p(O,q){I!==(I=J(O))&&(H.d(1),H=I(O),H&&(H.c(),H.m(o,null)));const K={};q[0]&256&&(K.source=O[8]),p.$set(K),(!v||q[0]&512)&&(y.disabled=O[9])},i(O){v||(G(p.$$.fragment,O),rt(()=>{v&&(S||(S=nl(e,sl,{},!0)),S.run(1))}),v=!0)},o(O){Q(p.$$.fragment,O),S||(S=nl(e,sl,{},!1)),S.run(0),v=!1},d(O){O&&A(e),H.d(),ce(p),O&&S&&S.end(),w=!1,Je(T)}}}function ei(l){let e;return{c(){e=f("span"),e.textContent="fresh",a(e,"class","tag is-small is-success")},m(t,o){P(t,e,o)},d(t){t&&A(e)}}}function ti(l){let e;return{c(){e=f("span"),e.textContent="cached",a(e,"class","tag is-small is-light")},m(t,o){P(t,e,o)},d(t){t&&A(e)}}}function qo(l){let e;function t(u,r){return u[33].disabled?ni:u[33].isLink?oi:li}let o=t(l),n=o(l);return{c(){n.c(),e=at()},m(u,r){n.m(u,r),P(u,e,r)},p(u,r){o===(o=t(u))&&n?n.p(u,r):(n.d(1),n=o(u),n&&(n.c(),n.m(e.parentNode,e)))},d(u){n.d(u),u&&A(e)}}}function li(l){let e,t,o,n,u,r,c,i,d;return{c(){e=f("button"),t=f("span"),o=f("i"),u=g(),a(o,"class",n=Nt(l[33].icon)+" svelte-2smypa"),a(t,"class","icon is-medium"),Ut(t,"has-text-primary",l[33].className),a(e,"type","button"),a(e,"class","level-item button is-ghost svelte-2smypa"),a(e,"aria-label",r=l[33].title),a(e,"title",c=l[33].title)},m(p,m){P(p,e,m),s(e,t),s(t,o),s(e,u),i||(d=Z(e,"click",function(){jl(l[33].action)&&l[33].action.apply(this,arguments)}),i=!0)},p(p,m){l=p,m[0]&16384&&n!==(n=Nt(l[33].icon)+" svelte-2smypa")&&a(o,"class",n),m[0]&16384&&Ut(t,"has-text-primary",l[33].className),m[0]&16384&&r!==(r=l[33].title)&&a(e,"aria-label",r),m[0]&16384&&c!==(c=l[33].title)&&a(e,"title",c)},d(p){p&&A(e),i=!1,d()}}}function oi(l){let e,t,o,n,u,r,c,i;return{c(){e=f("a"),t=f("span"),o=f("i"),u=g(),a(o,"class",n=Nt(l[33].icon)+" svelte-2smypa"),a(t,"class","icon is-medium"),Ut(t,"has-text-primary",l[33].className),a(e,"href",r=l[33].href),a(e,"target","_blank"),a(e,"class","level-item"),a(e,"aria-label",c=l[33].title),a(e,"title",i=l[33].title)},m(d,p){P(d,e,p),s(e,t),s(t,o),s(e,u)},p(d,p){p[0]&16384&&n!==(n=Nt(d[33].icon)+" svelte-2smypa")&&a(o,"class",n),p[0]&16384&&Ut(t,"has-text-primary",d[33].className),p[0]&16384&&r!==(r=d[33].href)&&a(e,"href",r),p[0]&16384&&c!==(c=d[33].title)&&a(e,"aria-label",c),p[0]&16384&&i!==(i=d[33].title)&&a(e,"title",i)},d(d){d&&A(e)}}}function ni(l){let e,t,o,n,u,r,c;return{c(){e=f("button"),t=f("span"),o=f("i"),u=g(),a(o,"class",n=Nt(l[33].icon)+" svelte-2smypa"),a(t,"class","icon is-medium"),Ut(t,"has-text-primary",l[33].className),a(e,"type","button"),a(e,"class","level-item button is-ghost svelte-2smypa"),a(e,"aria-label",r=l[33].title),a(e,"title",c=l[33].title),e.disabled=!0},m(i,d){P(i,e,d),s(e,t),s(t,o),s(e,u)},p(i,d){d[0]&16384&&n!==(n=Nt(i[33].icon)+" svelte-2smypa")&&a(o,"class",n),d[0]&16384&&Ut(t,"has-text-primary",i[33].className),d[0]&16384&&r!==(r=i[33].title)&&a(e,"aria-label",r),d[0]&16384&&c!==(c=i[33].title)&&a(e,"title",c)},d(i){i&&A(e)}}}function Jo(l){let e,t=l[33].visible&&qo(l);return{c(){t&&t.c(),e=at()},m(o,n){t&&t.m(o,n),P(o,e,n)},p(o,n){o[33].visible?t?t.p(o,n):(t=qo(o),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(o){t&&t.d(o),o&&A(e)}}}function Vo(l){let e,t,o;function n(r){l[23](r)}let u={item:l[4],kgTerm:l[5],kgRank:l[6]};return l[2]!==void 0&&(u.active=l[2]),e=new Hl({props:u}),Qe.push(()=>xe(e,"active",n)),{c(){ae(e.$$.fragment)},m(r,c){ue(e,r,c),o=!0},p(r,c){const i={};c[0]&16&&(i.item=r[4]),c[0]&32&&(i.kgTerm=r[5]),c[0]&64&&(i.kgRank=r[6]),!t&&c[0]&4&&(t=!0,i.active=r[2],et(()=>t=!1)),e.$set(i)},i(r){o||(G(e.$$.fragment,r),o=!0)},o(r){Q(e.$$.fragment,r),o=!1},d(r){ce(e,r)}}}function Qo(l){let e,t,o;function n(r){l[24](r)}let u={document:l[0]};return l[3]!==void 0&&(u.active=l[3]),e=new Wr({props:u}),Qe.push(()=>xe(e,"active",n)),{c(){ae(e.$$.fragment)},m(r,c){ue(e,r,c),o=!0},p(r,c){const i={};c[0]&1&&(i.document=r[0]),!t&&c[0]&8&&(t=!0,i.active=r[3],et(()=>t=!1)),e.$set(i)},i(r){o||(G(e.$$.fragment,r),o=!0)},o(r){Q(e.$$.fragment,r),o=!1},d(r){ce(e,r)}}}function si(l){let e,t,o,n,u,r,c,i,d,p,m,_,y=l[0].title+"",h,b,k,S,v,w,T,J,I,H,O,q,K,W,R,L,E,C,z,x,B,Y,$,N,U,M,V,ee,ne,ke,be=l[0].tags&&zo(l);i=new Jn({props:{$$slots:{default:[Zr]},$$scope:{ctx:l}}});const Ne=[xr,Xr],pe=[];function fe(le,we){return le[0].description?0:1}T=fe(l),J=pe[T]=Ne[T](l);let ie=!l[11]&&!l[9]&&!l[10]&&Wo(l),Se=l[9]&&Ko(),Te=l[10]&&Go(l),oe=l[11]&&l[8]&&Bo(l),he=l[14],se=[];for(let le=0;le<he.length;le+=1)se[le]=Jo(jo(l,he,le));function ve(le){l[22](le)}let Be={item:l[0]};l[1]!==void 0&&(Be.active=l[1]),$=new Hl({props:Be}),Qe.push(()=>xe($,"active",ve));let Ce=l[4]&&Vo(l),Oe=l[13]&&Qo(l);return{c(){e=f("div"),t=f("article"),o=f("div"),n=f("div"),u=f("div"),be&&be.c(),r=g(),c=f("div"),ae(i.$$.fragment),d=g(),p=f("div"),m=f("button"),_=f("h2"),h=F(y),b=g(),k=f("div"),S=f("small"),S.textContent="Description:",v=g(),w=f("div"),J.c(),I=g(),H=f("div"),ie&&ie.c(),O=g(),Se&&Se.c(),q=g(),Te&&Te.c(),K=g(),oe&&oe.c(),W=g(),R=f("br"),E=g(),C=f("div"),z=f("nav"),x=f("div");for(let le=0;le<se.length;le+=1)se[le].c();Y=g(),ae($.$$.fragment),U=g(),Ce&&Ce.c(),M=g(),Oe&&Oe.c(),V=at(),a(u,"class","level-right"),a(c,"class","level-right"),a(_,"class","title svelte-2smypa"),a(m,"class","svelte-2smypa"),a(S,"class","description-label svelte-2smypa"),a(w,"class","description-content svelte-2smypa"),a(k,"class","description svelte-2smypa"),a(H,"class","ai-summary-section svelte-2smypa"),a(n,"class","content"),a(x,"class","level-right"),a(z,"class","level is-mobile"),a(C,"class","level-right"),a(o,"class","media-content"),a(t,"class","media"),a(e,"class","box")},m(le,we){P(le,e,we),s(e,t),s(t,o),s(o,n),s(n,u),be&&be.m(u,null),s(n,r),s(n,c),ue(i,c,null),s(n,d),s(n,p),s(p,m),s(m,_),s(_,h),s(p,b),s(p,k),s(k,S),s(k,v),s(k,w),pe[T].m(w,null),s(p,I),s(p,H),ie&&ie.m(H,null),s(H,O),Se&&Se.m(H,null),s(H,q),Te&&Te.m(H,null),s(H,K),oe&&oe.m(H,null),s(p,W),s(p,R),s(o,E),s(o,C),s(C,z),s(z,x);for(let Ie=0;Ie<se.length;Ie+=1)se[Ie]&&se[Ie].m(x,null);P(le,Y,we),ue($,le,we),P(le,U,we),Ce&&Ce.m(le,we),P(le,M,we),Oe&&Oe.m(le,we),P(le,V,we),ee=!0,ne||(ke=Z(m,"click",l[15]),ne=!0)},p(le,we){le[0].tags?be?(be.p(le,we),we[0]&1&&G(be,1)):(be=zo(le),be.c(),G(be,1),be.m(u,null)):be&&(We(),Q(be,1,1,()=>{be=null}),Ke());const Ie={};we[0]&1|we[1]&256&&(Ie.$$scope={dirty:we,ctx:le}),i.$set(Ie),(!ee||we[0]&1)&&y!==(y=le[0].title+"")&&me(h,y);let Xe=T;if(T=fe(le),T===Xe?pe[T].p(le,we):(We(),Q(pe[Xe],1,1,()=>{pe[Xe]=null}),Ke(),J=pe[T],J?J.p(le,we):(J=pe[T]=Ne[T](le),J.c()),G(J,1),J.m(w,null)),!le[11]&&!le[9]&&!le[10]?ie?ie.p(le,we):(ie=Wo(le),ie.c(),ie.m(H,O)):ie&&(ie.d(1),ie=null),le[9]?Se||(Se=Ko(),Se.c(),Se.m(H,q)):Se&&(Se.d(1),Se=null),le[10]?Te?Te.p(le,we):(Te=Go(le),Te.c(),Te.m(H,K)):Te&&(Te.d(1),Te=null),le[11]&&le[8]?oe?(oe.p(le,we),we[0]&2304&&G(oe,1)):(oe=Bo(le),oe.c(),G(oe,1),oe.m(H,null)):oe&&(We(),Q(oe,1,1,()=>{oe=null}),Ke()),we[0]&16384){he=le[14];let Ee;for(Ee=0;Ee<he.length;Ee+=1){const ht=jo(le,he,Ee);se[Ee]?se[Ee].p(ht,we):(se[Ee]=Jo(ht),se[Ee].c(),se[Ee].m(x,null))}for(;Ee<se.length;Ee+=1)se[Ee].d(1);se.length=he.length}const He={};we[0]&1&&(He.item=le[0]),!N&&we[0]&2&&(N=!0,He.active=le[1],et(()=>N=!1)),$.$set(He),le[4]?Ce?(Ce.p(le,we),we[0]&16&&G(Ce,1)):(Ce=Vo(le),Ce.c(),G(Ce,1),Ce.m(M.parentNode,M)):Ce&&(We(),Q(Ce,1,1,()=>{Ce=null}),Ke()),le[13]?Oe?(Oe.p(le,we),we[0]&8192&&G(Oe,1)):(Oe=Qo(le),Oe.c(),G(Oe,1),Oe.m(V.parentNode,V)):Oe&&(We(),Q(Oe,1,1,()=>{Oe=null}),Ke())},i(le){ee||(G(be),G(i.$$.fragment,le),G(J),G(oe),rt(()=>{ee&&(L||(L=nl(p,sl,{},!0)),L.run(1))}),rt(()=>{ee&&(B||(B=nl(z,sl,{},!0)),B.run(1))}),G($.$$.fragment,le),G(Ce),G(Oe),ee=!0)},o(le){Q(be),Q(i.$$.fragment,le),Q(J),Q(oe),L||(L=nl(p,sl,{},!1)),L.run(0),B||(B=nl(z,sl,{},!1)),B.run(0),Q($.$$.fragment,le),Q(Ce),Q(Oe),ee=!1},d(le){le&&A(e),be&&be.d(),ce(i),pe[T].d(),ie&&ie.d(),Se&&Se.d(),Te&&Te.d(),oe&&oe.d(),le&&L&&L.end(),Ye(se,le),le&&B&&B.end(),le&&A(Y),ce($,le),le&&A(U),Ce&&Ce.d(le),le&&A(M),Oe&&Oe.d(le),le&&A(V),ne=!1,ke()}}}function ri(l,e,t){let o,n,u,r,c;Re(l,At,$=>t(25,u=$)),Re(l,je,$=>t(26,r=$)),Re(l,Ct,$=>t(27,c=$));let{document:i}=e,d=!1,p=!1,m=!1,_=null,y=null,h=null,b=!1,k=null,S=!1,v=null,w=!1,T=!1;function J(){const $=[];return $.push({id:"download-markdown",label:"Download to Markdown",icon:"fas fa-download",action:()=>W(),visible:!0,title:"Download document as markdown file"}),o&&$.push({id:"save-atomic",label:"Save to Atomic Server",icon:"fas fa-cloud-upload-alt",action:()=>O(),visible:!0,title:"Save article to Atomic Server",className:"has-text-primary"}),i.url&&$.push({id:"external-url",label:"Open URL",icon:"fas fa-link",action:()=>window.open(i.url,"_blank"),visible:!0,title:"Open original URL in new tab",isLink:!0,href:i.url}),$.push({id:"open-vscode",label:"Open in VSCode",icon:"fas fa-code",action:()=>R(),visible:!0,title:"Open document in VSCode",isLink:!0,href:`vscode://${encodeURIComponent(i.title)}.md?${encodeURIComponent(i.body)}`}),$.push({id:"add-favorites",label:"Add to Favorites",icon:"fas fa-plus",action:()=>{},visible:!0,title:"Add to favorites (coming soon)",disabled:!0}),$}function I(){var V;const $=u,N=c;if(!(N!=null&&N.roles)||!$)return!1;let U=null;try{for(const[ee,ne]of Object.entries(N.roles)){const ke=ne,be=typeof ke.name=="object"?ke.name.original:String(ke.name);if(ee===$||be===$){U=ke;break}}}catch(ee){return console.warn("Error checking role configuration:",ee),!1}return U?(((V=U.haystacks)==null?void 0:V.filter(ee=>ee.service==="Atomic"&&ee.location&&!ee.read_only))||[]).length>0:!1}const H=()=>{t(1,d=!0)},O=()=>{console.log("🔄 Opening atomic save modal for document:",i.title),t(3,m=!0)};async function q($){var N,U,M,V,ee;t(7,b=!0),t(5,y=$),console.log("🔍 KG Search Debug Info:"),console.log("  Tag clicked:",$),console.log("  Current role:",u),console.log("  Is Tauri mode:",r);try{if(r){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:u,term:$});const ne=await Ge("find_documents_for_kg_term",{roleName:u,term:$});console.log("  📥 Tauri response received:"),console.log("    Status:",ne.status),console.log("    Results count:",((N=ne.results)==null?void 0:N.length)||0),console.log("    Total:",ne.total||0),console.log("    Full response:",JSON.stringify(ne,null,2)),ne.status==="success"&&ne.results&&ne.results.length>0?(t(4,_=ne.results[0]),t(6,h=_.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",_.title),console.log("    Rank:",h),console.log("    Body length:",((U=_.body)==null?void 0:U.length)||0,"characters"),t(2,p=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${$}" in role: "${u}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const ne=pt.ServerURL,ke=encodeURIComponent(u),be=encodeURIComponent($),Ne=`${ne}/roles/${ke}/kg_search?term=${be}`;console.log("  📤 HTTP Request details:"),console.log("    Base URL:",ne),console.log("    Role (encoded):",ke),console.log("    Term (encoded):",be),console.log("    Full URL:",Ne);const pe=await fetch(Ne);if(console.log("  📥 HTTP Response received:"),console.log("    Status code:",pe.status),console.log("    Status text:",pe.statusText),console.log("    Headers:",Object.fromEntries(pe.headers.entries())),!pe.ok)throw new Error(`HTTP error! Status: ${pe.status} - ${pe.statusText}`);const fe=await pe.json();console.log("  📄 Response data:"),console.log("    Status:",fe.status),console.log("    Results count:",((M=fe.results)==null?void 0:M.length)||0),console.log("    Total:",fe.total||0),console.log("    Full response:",JSON.stringify(fe,null,2)),fe.status==="success"&&fe.results&&fe.results.length>0?(t(4,_=fe.results[0]),t(6,h=_.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",_.title),console.log("    Rank:",h),console.log("    Body length:",((V=_.body)==null?void 0:V.length)||0,"characters"),t(2,p=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${$}" in role: "${u}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",Ne))}}catch(ne){console.error("❌ Error fetching KG document:"),console.error("  Error type:",ne.constructor.name),console.error("  Error message:",ne.message||ne),console.error("  Request details:",{tag:$,role:u,isTauri:r,timestamp:new Date().toISOString()}),!r&&((ee=ne.message)!=null&&ee.includes("Failed to fetch"))&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{t(7,b=!1)}}async function K(){var $;if(!(S||!i.id||!u)){t(9,S=!0),t(10,v=null),console.log("🤖 AI Summary Debug Info:"),console.log("  Document ID:",i.id),console.log("  Current role:",u),console.log("  Is Tauri mode:",r);try{const N={document_id:i.id,role:u,max_length:250,force_regenerate:!1};console.log("  📤 Summarization request:",N);let U;if(r){const ee=`${pt.ServerURL}/documents/summarize`;U=await fetch(ee,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(N)})}else{const ee=`${pt.ServerURL}/documents/summarize`;U=await fetch(ee,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(N)})}if(console.log("  📥 Summary response received:"),console.log("    Status code:",U.status),console.log("    Status text:",U.statusText),!U.ok)throw new Error(`HTTP error! Status: ${U.status} - ${U.statusText}`);const M=await U.json();console.log("  📄 Summary response data:",M),M.status==="Success"&&M.summary?(t(8,k=M.summary),t(12,T=M.from_cache||!1),t(11,w=!0),console.log("  ✅ Summary generated successfully"),console.log("    Summary length:",k.length,"characters"),console.log("    From cache:",T),console.log("    Model used:",M.model_used)):(t(10,v=M.error||"Failed to generate summary"),console.error("  ❌ Summary generation failed:",v))}catch(N){console.error("❌ Error generating summary:"),console.error("  Error type:",N.constructor.name),console.error("  Error message:",N.message||N),console.error("  Request details:",{document_id:i.id,role:u,isTauri:r,timestamp:new Date().toISOString()}),t(10,v=N.message||"Network error occurred"),($=N.message)!=null&&$.includes("Failed to fetch")&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Verify OpenRouter is enabled for this role"),console.error("    3. Check OPENROUTER_KEY environment variable"),console.error("    4. Verify server URL in CONFIG.ServerURL"))}finally{t(9,S=!1)}}}function W(){console.log("📥 Downloading document as markdown:",i.title);let $=`# ${i.title}

`;$+=`**Source:** Terraphim Search
`,$+=`**Rank:** ${i.rank||"N/A"}
`,i.url&&($+=`**URL:** ${i.url}
`),i.tags&&i.tags.length>0&&($+=`**Tags:** ${i.tags.join(", ")}
`),$+=`**Downloaded:** ${new Date().toISOString()}

`,i.description&&($+=`## Description

${i.description}

`),$+=`## Content

${i.body}
`;const N=`${i.title.replace(/[^a-z0-9]/gi,"_").toLowerCase()}_${Date.now()}.md`,U=new Blob([$],{type:"text/markdown"}),M=URL.createObjectURL(U),V=window.document.createElement("a");V.href=M,V.download=N,window.document.body.appendChild(V),V.click(),window.document.body.removeChild(V),URL.revokeObjectURL(M),console.log("✅ Markdown file downloaded:",N)}function R(){const $=`vscode://${encodeURIComponent(i.title)}.md?${encodeURIComponent(i.body)}`;window.open($,"_blank")}Ll[u]!==void 0&&(console.log("Have attribute",Ll[u]),Ll[u].hasOwnProperty("enableLogseq")?console.log("enable logseq True"):console.log("Didn't make it"));const L=$=>q($),E=()=>{t(10,v=null),K()},C=()=>t(11,w=!1),z=()=>{K()};function x($){d=$,t(1,d)}function B($){p=$,t(2,p)}function Y($){m=$,t(3,m)}return l.$$set=$=>{"document"in $&&t(0,i=$.document)},t(13,o=I()),t(14,n=J()),[i,d,p,m,_,y,h,b,k,S,v,w,T,o,n,H,q,K,L,E,C,z,x,B,Y]}class ii extends mt{constructor(e){super(),_t(this,e,ri,si,it,{document:0},null,[-1,-1])}}const ai="/assets/terraphim_gray.png";function ui(l){const e=l.trim();if(!e)return{hasOperator:!1,operator:null,terms:[l],originalQuery:l};const t=/\b(and)\b/i,o=/\b(or)\b/i,n=t.test(e),u=o.test(e);if(n&&!u)return{hasOperator:!0,operator:"AND",terms:e.split(t).filter((c,i)=>i%2===0).map(c=>c.trim()).filter(c=>c.length>0),originalQuery:l};if(u&&!n)return{hasOperator:!0,operator:"OR",terms:e.split(o).filter((c,i)=>i%2===0).map(c=>c.trim()).filter(c=>c.length>0),originalQuery:l};if(n&&u){const r=e.toLowerCase().indexOf(" and "),c=e.toLowerCase().indexOf(" or ");if(r!==-1&&(c===-1||r<c))return{hasOperator:!0,operator:"AND",terms:e.split(t).filter((d,p)=>p%2===0).map(d=>d.trim()).filter(d=>d.length>0),originalQuery:l};if(c!==-1)return{hasOperator:!0,operator:"OR",terms:e.split(o).filter((d,p)=>p%2===0).map(d=>d.trim()).filter(d=>d.length>0),originalQuery:l}}return{hasOperator:!1,operator:null,terms:[e],originalQuery:l}}function Yo(l,e){var o,n;if(l.hasOperator&&l.terms.length>1){const u=l.terms.filter(r=>r.trim().length>0);if(u.length>1)return{search_term:u[0],search_terms:u,operator:(o=l.operator)==null?void 0:o.toLowerCase(),skip:0,limit:50,role:e||null}}return{search_term:((n=l.terms[0])==null?void 0:n.trim())||"",search_terms:void 0,operator:void 0,skip:0,limit:50,role:e||null}}function Zo(l,e,t){const o=l.slice();return o[27]=e[t],o}function Xo(l,e,t){const o=l.slice();return o[30]=e[t],o[32]=t,o}function xo(l){let e,t=l[2],o=[];for(let n=0;n<t.length;n+=1)o[n]=en(Xo(l,t,n));return{c(){e=f("ul");for(let n=0;n<o.length;n+=1)o[n].c();a(e,"class","suggestions svelte-e76e8j")},m(n,u){P(n,e,u);for(let r=0;r<o.length;r+=1)o[r]&&o[r].m(e,null)},p(n,u){if(u[0]&1036){t=n[2];let r;for(r=0;r<t.length;r+=1){const c=Xo(n,t,r);o[r]?o[r].p(c,u):(o[r]=en(c),o[r].c(),o[r].m(e,null))}for(;r<o.length;r+=1)o[r].d(1);o.length=t.length}},d(n){n&&A(e),Ye(o,n)}}}function en(l){let e,t=l[30]+"",o,n,u,r,c,i;function d(){return l[14](l[30])}function p(...m){return l[15](l[30],...m)}return{c(){e=f("li"),o=F(t),n=g(),a(e,"tabindex","0"),a(e,"role","option"),a(e,"aria-selected",u=l[32]===l[3]),a(e,"aria-label",r=`Apply suggestion: ${l[30]}`),a(e,"class","svelte-e76e8j"),Ut(e,"active",l[32]===l[3])},m(m,_){P(m,e,_),s(e,o),s(e,n),c||(i=[Z(e,"click",d),Z(e,"keydown",p)],c=!0)},p(m,_){l=m,_[0]&4&&t!==(t=l[30]+"")&&me(o,t),_[0]&8&&u!==(u=l[32]===l[3])&&a(e,"aria-selected",u),_[0]&4&&r!==(r=`Apply suggestion: ${l[30]}`)&&a(e,"aria-label",r),_[0]&8&&Ut(e,"active",l[32]===l[3])},d(m){m&&A(e),c=!1,Je(i)}}}function ci(l){let e,t,o,n,u,r,c,i,d,p,m,_,y,h,b,k,S,v,w,T,J,I,H;function O(W){l[13](W)}let q={type:"search",placeholder:l[7]?`Search over Knowledge graph for ${l[6]}`:"Search",icon:"search",expanded:!0,autofocus:!0};l[5]!==void 0&&(q.value=l[5]),o=new Jt({props:q}),Qe.push(()=>xe(o,"value",O)),o.$on("click",l[11]),o.$on("submit",l[11]),o.$on("keydown",l[9]),o.$on("input",l[8]);let K=l[2].length>0&&xo(l);return J=qn(l[17][0]),{c(){e=f("div"),t=f("div"),ae(o.$$.fragment),u=g(),K&&K.c(),r=g(),c=f("div"),i=f("div"),d=f("label"),p=f("input"),m=F(`
            Exact`),_=g(),y=f("label"),h=f("input"),b=F(`
            All (AND)`),k=g(),S=f("label"),v=f("input"),w=F(`
            Any (OR)`),a(t,"class","input-wrapper svelte-e76e8j"),a(p,"type","radio"),p.__value="none",p.value=p.__value,a(p,"class","svelte-e76e8j"),a(d,"class","radio svelte-e76e8j"),a(h,"type","radio"),h.__value="and",h.value=h.__value,a(h,"class","svelte-e76e8j"),a(y,"class","radio svelte-e76e8j"),a(v,"type","radio"),v.__value="or",v.value=v.__value,a(v,"class","svelte-e76e8j"),a(S,"class","radio svelte-e76e8j"),a(i,"class","control svelte-e76e8j"),a(c,"class","operator-controls svelte-e76e8j"),a(e,"class","search-row svelte-e76e8j"),J.p(p,h,v)},m(W,R){P(W,e,R),s(e,t),ue(o,t,null),s(t,u),K&&K.m(t,null),s(e,r),s(e,c),s(c,i),s(i,d),s(d,p),p.checked=p.__value===l[4],s(d,m),s(i,_),s(i,y),s(y,h),h.checked=h.__value===l[4],s(y,b),s(i,k),s(i,S),s(S,v),v.checked=v.__value===l[4],s(S,w),T=!0,I||(H=[Z(p,"change",l[16]),Z(h,"change",l[18]),Z(v,"change",l[19])],I=!0)},p(W,R){const L={};R[0]&192&&(L.placeholder=W[7]?`Search over Knowledge graph for ${W[6]}`:"Search"),!n&&R[0]&32&&(n=!0,L.value=W[5],et(()=>n=!1)),o.$set(L),W[2].length>0?K?K.p(W,R):(K=xo(W),K.c(),K.m(t,null)):K&&(K.d(1),K=null),R[0]&16&&(p.checked=p.__value===W[4]),R[0]&16&&(h.checked=h.__value===W[4]),R[0]&16&&(v.checked=v.__value===W[4])},i(W){T||(G(o.$$.fragment,W),T=!0)},o(W){Q(o.$$.fragment,W),T=!1},d(W){W&&A(e),ce(o),K&&K.d(),J.r(),I=!1,Je(H)}}}function fi(l){let e,t,o,n,u,r,c,i,d,p;return{c(){e=f("section"),t=f("div"),o=f("img"),u=g(),r=f("p"),r.textContent="I am Terraphim, your personal assistant.",c=g(),i=f("button"),i.innerHTML=`<span class="icon"><i class="fas fa-magic"></i></span> 
        <span>Configuration Wizard</span>`,_s(o.src,n=ai)||a(o,"src",n),a(o,"alt","Terraphim Logo"),a(o,"class","svelte-e76e8j"),a(i,"class","button is-primary"),a(i,"data-testid","wizard-start"),a(t,"class","content has-text-grey has-text-centered svelte-e76e8j"),a(e,"class","section")},m(m,_){P(m,e,_),s(e,t),s(t,o),s(t,u),s(t,r),s(t,c),s(t,i),d||(p=Z(i,"click",l[20]),d=!0)},p:ye,i:ye,o:ye,d(m){m&&A(e),d=!1,p()}}}function di(l){let e,t,o=l[0],n=[];for(let r=0;r<o.length;r+=1)n[r]=tn(Zo(l,o,r));const u=r=>Q(n[r],1,1,()=>{n[r]=null});return{c(){for(let r=0;r<n.length;r+=1)n[r].c();e=at()},m(r,c){for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(r,c);P(r,e,c),t=!0},p(r,c){if(c[0]&1){o=r[0];let i;for(i=0;i<o.length;i+=1){const d=Zo(r,o,i);n[i]?(n[i].p(d,c),G(n[i],1)):(n[i]=tn(d),n[i].c(),G(n[i],1),n[i].m(e.parentNode,e))}for(We(),i=o.length;i<n.length;i+=1)u(i);Ke()}},i(r){if(!t){for(let c=0;c<o.length;c+=1)G(n[c]);t=!0}},o(r){n=n.filter(Boolean);for(let c=0;c<n.length;c+=1)Q(n[c]);t=!1},d(r){Ye(n,r),r&&A(e)}}}function pi(l){let e,t;return{c(){e=f("p"),t=F(l[1]),a(e,"class","error svelte-e76e8j")},m(o,n){P(o,e,n),s(e,t)},p(o,n){n[0]&2&&me(t,o[1])},i:ye,o:ye,d(o){o&&A(e)}}}function tn(l){let e,t;return e=new ii({props:{document:l[27]}}),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},p(o,n){const u={};n[0]&1&&(u.document=o[27]),e.$set(u)},i(o){t||(G(e.$$.fragment,o),t=!0)},o(o){Q(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function mi(l){let e,t,o,n,u,r,c,i,d,p,m;e=new rl({props:{fallbackPath:"/"}}),n=new Ht({props:{$$slots:{default:[ci]},$$scope:{ctx:l}}});const _=[pi,di,fi],y=[];function h(b,k){return b[1]?0:b[0].length?1:2}return r=h(l),c=y[r]=_[r](l),{c(){ae(e.$$.fragment),t=g(),o=f("form"),ae(n.$$.fragment),u=g(),c.c(),i=at()},m(b,k){ue(e,b,k),P(b,t,k),P(b,o,k),ue(n,o,null),P(b,u,k),y[r].m(b,k),P(b,i,k),d=!0,p||(m=Z(o,"submit",ms(l[11])),p=!0)},p(b,k){const S={};k[0]&252|k[1]&4&&(S.$$scope={dirty:k,ctx:b}),n.$set(S);let v=r;r=h(b),r===v?y[r].p(b,k):(We(),Q(y[v],1,1,()=>{y[v]=null}),Ke(),c=y[r],c?c.p(b,k):(c=y[r]=_[r](b),c.c()),G(c,1),c.m(i.parentNode,i))},i(b){d||(G(e.$$.fragment,b),G(n.$$.fragment,b),G(c),d=!0)},o(b){Q(e.$$.fragment,b),Q(n.$$.fragment,b),Q(c),d=!1},d(b){ce(e,b),b&&A(t),b&&A(o),ce(n),b&&A(u),y[r].d(b),b&&A(i),p=!1,m()}}}function _i(l,e,t){let o,n,u,r,c,i,d;Re(l,js,E=>t(22,n=E)),Re(l,Al,E=>t(5,u=E)),Re(l,je,E=>t(23,r=E)),Re(l,At,E=>t(6,c=E)),Re(l,fl,E=>t(12,i=E)),Re(l,$t,E=>t(7,d=E));let p=[],m=null,_=[],y=-1,h="none";async function b(E){try{if(r){const C=await Ge("get_autocomplete_suggestions",{query:E,roleName:c,limit:8});if(C.status==="success"&&C.suggestions)return C.suggestions.map(z=>z.term)}else{const C=await fetch(`${n.replace("/documents/search","")}/autocomplete/${encodeURIComponent(c)}/${encodeURIComponent(E)}`);if(C.ok){const z=await C.json();if(z.status==="success"&&z.suggestions)return z.suggestions.map(x=>x.term)}}return o.filter(([C])=>C.toLowerCase().includes(E.toLowerCase())).map(([C])=>C).slice(0,8)}catch(C){return console.warn("Error fetching term suggestions:",C),[]}}async function k(E){const C=E.trim();if(C.length===0)return[];if(h!=="none"){const $=C.split(/\s+/),N=$[$.length-1].toLowerCase();return N.length<2?[]:b(N)}const x=C.split(/\s+/),B=x[x.length-1].toLowerCase();if(x.length>1&&h==="none"){const $=[];if("and".startsWith(B)&&$.push("AND"),"or".startsWith(B)&&$.push("OR"),$.length>0)return $}const Y=C.toLowerCase();if(Y.includes(" and ")||Y.includes(" or ")){const $=B;return $.length<2?[]:b($)}try{const $=await b(C);return x.length===1&&x[0].length>2&&h==="none"?[...$.slice(0,6),"AND","OR"]:$}catch($){console.warn("Error fetching autocomplete suggestions:",$);const N=o.filter(([U])=>U.toLowerCase().includes(C.toLowerCase())).map(([U])=>U).slice(0,6);return x.length===1&&x[0].length>2&&h==="none"?[...N,"AND","OR"]:N}}async function S(E){const C=E.target;if(!C||C.selectionStart==null)return;const z=C.selectionStart,B=u.slice(0,z).split(/\s+/),Y=B[B.length-1];if(Y.length>=2)try{t(2,_=await k(Y))}catch($){console.warn("Failed to get suggestions:",$),t(2,_=[])}else t(2,_=[]);t(3,y=-1)}function v(E){_.length!==0&&(E.key==="ArrowDown"?(E.preventDefault(),t(3,y=(y+1)%_.length)):E.key==="ArrowUp"?(E.preventDefault(),t(3,y=(y-1+_.length)%_.length)):(E.key==="Enter"||E.key==="Tab")&&y!==-1&&(E.preventDefault(),w(_[y])))}function w(E){var $,N;const C=document.querySelector('input[type="search"]'),z=(C==null?void 0:C.selectionStart)??0,x=u.slice(0,z),B=u.slice(z),Y=x.split(/\s+/);if(E==="AND"||E==="OR"){Y[Y.length-1]=E,dl(Al,u=[...Y,"",B].join(" "),u);const U=z+E.length+1;($=C==null?void 0:C.setSelectionRange)==null||$.call(C,U,U)}else{Y[Y.length-1]=E,dl(Al,u=[...Y,B].join(" "),u);const U=z+E.length;(N=C==null?void 0:C.setSelectionRange)==null||N.call(C,U,U)}t(2,_=[]),t(3,y=-1)}function T(){const E=u.trim();if(!E)return null;if(h!=="none"){const x=E.split(/\s+/).filter(B=>B.length>0);return x.length>1?{...Yo({hasOperator:!0,operator:h==="and"?"AND":"OR",terms:x,originalQuery:E},c),skip:0,limit:10}:{search_term:E,skip:0,limit:10,role:c}}const C=ui(E);return{...Yo(C,c),skip:0,limit:10}}async function J(){if(t(1,m=null),r){if(!u.trim())return;try{const E=T();if(!E)return;const C=await Ge("search",{searchQuery:E});C.status==="success"?(t(0,p=C.results),console.log("Response results"),console.log(p)):(t(1,m=`Search failed: ${C.status}`),console.error("Search failed:",C))}catch(E){t(1,m=`Error in Tauri search: ${E}`),console.error("Error in Tauri search:",E)}}else{if(!u.trim())return;const E=T();if(!E)return;const C=JSON.stringify(E);try{const z=await fetch(n,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:C}),x=await z.json();if(!z.ok)throw new Error(`HTTP error! Status: ${z.status}`);t(0,p=x.results)}catch(z){console.error("Error fetching data:",z),t(1,m=`Error fetching data: ${z}`)}}}const I=[[]];function H(E){u=E,Al.set(u)}const O=E=>w(E),q=(E,C)=>{(C.key==="Enter"||C.key===" ")&&(C.preventDefault(),w(E))};function K(){h=this.__value,t(4,h)}function W(){h=this.__value,t(4,h)}function R(){h=this.__value,t(4,h)}const L=()=>window.location.href="/config/wizard";return l.$$.update=()=>{l.$$.dirty[0]&4096&&(o=Object.entries(i))},[p,m,_,y,h,u,c,d,S,v,w,J,i,H,O,q,K,I,W,R,L]}class hi extends mt{constructor(e){super(),_t(this,e,_i,mi,it,{},null,[-1,-1])}}async function ln(l={}){return typeof l=="object"&&Object.freeze(l),zl({__tauriModule:"Dialog",message:{cmd:"openDialog",options:l}})}function on(l,e,t){const o=l.slice();return o[71]=e[t],o[79]=t,o}function nn(l,e,t){const o=l.slice();return o[77]=e[t],o[78]=e,o[79]=t,o}function sn(l,e,t){const o=l.slice();return o[80]=e[t],o}function rn(l,e,t){const o=l.slice();return o[80]=e[t],o}function an(l,e,t){const o=l.slice();return o[85]=e[t],o[86]=e,o[87]=t,o}function un(l,e,t){const o=l.slice();return o[88]=e[t][0],o[89]=e[t][1],o[90]=e,o[91]=t,o}function cn(l,e,t){const o=l.slice();return o[74]=e[t],o}function fn(l,e,t){const o=l.slice();return o[71]=e[t],o}function dn(l,e,t){const o=l.slice();return o[74]=e[t],o}function pn(l){let e,t,o,n,u;return{c(){e=f("div"),t=f("button"),o=F(`
      Configuration saved successfully!`),a(t,"class","delete"),a(e,"class","notification is-success"),a(e,"data-testid","wizard-success")},m(r,c){P(r,e,c),s(e,t),s(e,o),n||(u=Z(t,"click",l[20]),n=!0)},p:ye,d(r){r&&A(e),n=!1,u()}}}function mn(l){let e,t,o,n,u;return{c(){e=f("div"),t=f("button"),o=F(`
      Failed to save configuration. Please try again.`),a(t,"class","delete"),a(e,"class","notification is-danger"),a(e,"data-testid","wizard-error")},m(r,c){P(r,e,c),s(e,t),s(e,o),n||(u=Z(t,"click",l[21]),n=!0)},p:ye,d(r){r&&A(e),n=!1,u()}}}function gi(l){let e,t,o,n,u,r,c,i,d,p=l[3].id+"",m,_,y,h,b,k=l[3].global_shortcut+"",S,v,w,T,J,I=l[3].default_theme+"",H,O,q,K,W,R=l[3].default_role+"",L,E,C,z,x,B,Y=JSON.stringify(l[3],null,2)+"",$,N=l[3].roles,U=[];for(let M=0;M<N.length;M+=1)U[M]=_n(on(l,N,M));return{c(){e=f("h4"),e.textContent="Review",t=g(),o=f("div"),n=f("h5"),n.textContent="Configuration Summary:",u=g(),r=f("ul"),c=f("li"),i=f("strong"),i.textContent="Configuration ID:",d=g(),m=F(p),_=g(),y=f("li"),h=f("strong"),h.textContent="Global Shortcut:",b=g(),S=F(k),v=g(),w=f("li"),T=f("strong"),T.textContent="Default Theme:",J=g(),H=F(I),O=g(),q=f("li"),K=f("strong"),K.textContent="Default Role:",W=g(),L=F(R),E=g(),C=f("h5"),C.textContent="Roles:",z=g();for(let M=0;M<U.length;M+=1)U[M].c();x=g(),B=f("pre"),$=F(Y),a(e,"class","title is-5"),a(o,"class","content"),re(B,"max-height","300px"),re(B,"overflow","auto")},m(M,V){P(M,e,V),P(M,t,V),P(M,o,V),s(o,n),s(o,u),s(o,r),s(r,c),s(c,i),s(c,d),s(c,m),s(r,_),s(r,y),s(y,h),s(y,b),s(y,S),s(r,v),s(r,w),s(w,T),s(w,J),s(w,H),s(r,O),s(r,q),s(q,K),s(q,W),s(q,L),s(o,E),s(o,C),s(o,z);for(let ee=0;ee<U.length;ee+=1)U[ee]&&U[ee].m(o,null);P(M,x,V),P(M,B,V),s(B,$)},p(M,V){if(V[0]&8&&p!==(p=M[3].id+"")&&me(m,p),V[0]&8&&k!==(k=M[3].global_shortcut+"")&&me(S,k),V[0]&8&&I!==(I=M[3].default_theme+"")&&me(H,I),V[0]&8&&R!==(R=M[3].default_role+"")&&me(L,R),V[0]&10){N=M[3].roles;let ee;for(ee=0;ee<N.length;ee+=1){const ne=on(M,N,ee);U[ee]?U[ee].p(ne,V):(U[ee]=_n(ne),U[ee].c(),U[ee].m(o,null))}for(;ee<U.length;ee+=1)U[ee].d(1);U.length=N.length}V[0]&8&&Y!==(Y=JSON.stringify(M[3],null,2)+"")&&me($,Y)},d(M){M&&A(e),M&&A(t),M&&A(o),Ye(U,M),M&&A(x),M&&A(B)}}}function bi(l){let e,t,o=[],n=new Map,u,r,c,i,d=l[3].roles;const p=m=>m[77].name;for(let m=0;m<d.length;m+=1){let _=nn(l,d,m),y=p(_);n.set(y,o[m]=Pn(y,_))}return{c(){e=f("h4"),e.textContent="Roles",t=g();for(let m=0;m<o.length;m+=1)o[m].c();u=g(),r=f("button"),r.textContent="Add Role",a(e,"class","title is-5"),a(r,"class","button is-link is-light"),a(r,"data-testid","add-role")},m(m,_){P(m,e,_),P(m,t,_);for(let y=0;y<o.length;y+=1)o[y]&&o[y].m(m,_);P(m,u,_),P(m,r,_),c||(i=Z(r,"click",l[12]),c=!0)},p(m,_){_[0]&516985&&(d=m[3].roles,o=hs(o,_,p,1,m,d,n,u.parentNode,gs,Pn,u,nn))},d(m){m&&A(e),m&&A(t);for(let _=0;_<o.length;_+=1)o[_].d(m);m&&A(u),m&&A(r),c=!1,i()}}}function vi(l){let e,t,o,n,u,r,c,i,d,p,m,_,y,h,b,k,S,v,w,T,J,I,H,O,q,K,W,R,L,E,C,z=l[8],x=[];for(let $=0;$<z.length;$+=1)x[$]=On(dn(l,z,$));let B=l[3].roles,Y=[];for(let $=0;$<B.length;$+=1)Y[$]=En(fn(l,B,$));return{c(){e=f("div"),t=f("label"),t.textContent="Configuration ID",o=g(),n=f("div"),u=f("div"),r=f("select"),c=f("option"),c.textContent="Desktop",i=f("option"),i.textContent="Server",d=f("option"),d.textContent="Embedded",p=g(),m=f("div"),_=f("label"),_.textContent="Global shortcut",y=g(),h=f("div"),b=f("input"),k=g(),S=f("div"),v=f("label"),v.textContent="Default theme",w=g(),T=f("div"),J=f("div"),I=f("select");for(let $=0;$<x.length;$+=1)x[$].c();H=g(),O=f("div"),q=f("label"),q.textContent="Default Role",K=g(),W=f("div"),R=f("div"),L=f("select");for(let $=0;$<Y.length;$+=1)Y[$].c();a(t,"class","label"),a(t,"for","config-id"),c.__value="Desktop",c.value=c.__value,i.__value="Server",i.value=i.__value,d.__value="Embedded",d.value=d.__value,a(r,"id","config-id"),l[3].id===void 0&&rt(()=>l[22].call(r)),a(u,"class","select"),a(n,"class","control"),a(e,"class","field"),a(_,"class","label"),a(_,"for","global-shortcut"),a(b,"class","input"),a(b,"id","global-shortcut"),a(b,"type","text"),a(h,"class","control"),a(m,"class","field"),a(v,"class","label"),a(v,"for","default-theme"),a(I,"id","default-theme"),l[3].default_theme===void 0&&rt(()=>l[24].call(I)),a(J,"class","select is-fullwidth"),a(T,"class","control"),a(S,"class","field"),a(q,"class","label"),a(q,"for","default-role"),a(L,"id","default-role"),l[3].default_role===void 0&&rt(()=>l[25].call(L)),a(R,"class","select"),a(W,"class","control"),a(O,"class","field")},m($,N){P($,e,N),s(e,t),s(e,o),s(e,n),s(n,u),s(u,r),s(r,c),s(r,i),s(r,d),Me(r,l[3].id,!0),P($,p,N),P($,m,N),s(m,_),s(m,y),s(m,h),s(h,b),Ae(b,l[3].global_shortcut),P($,k,N),P($,S,N),s(S,v),s(S,w),s(S,T),s(T,J),s(J,I);for(let U=0;U<x.length;U+=1)x[U]&&x[U].m(I,null);Me(I,l[3].default_theme,!0),P($,H,N),P($,O,N),s(O,q),s(O,K),s(O,W),s(W,R),s(R,L);for(let U=0;U<Y.length;U+=1)Y[U]&&Y[U].m(L,null);Me(L,l[3].default_role,!0),E||(C=[Z(r,"change",l[22]),Z(b,"input",l[23]),Z(I,"change",l[24]),Z(L,"change",l[25])],E=!0)},p($,N){if(N[0]&264&&Me(r,$[3].id),N[0]&264&&b.value!==$[3].global_shortcut&&Ae(b,$[3].global_shortcut),N[0]&256){z=$[8];let U;for(U=0;U<z.length;U+=1){const M=dn($,z,U);x[U]?x[U].p(M,N):(x[U]=On(M),x[U].c(),x[U].m(I,null))}for(;U<x.length;U+=1)x[U].d(1);x.length=z.length}if(N[0]&264&&Me(I,$[3].default_theme),N[0]&8){B=$[3].roles;let U;for(U=0;U<B.length;U+=1){const M=fn($,B,U);Y[U]?Y[U].p(M,N):(Y[U]=En(M),Y[U].c(),Y[U].m(L,null))}for(;U<Y.length;U+=1)Y[U].d(1);Y.length=B.length}N[0]&264&&Me(L,$[3].default_role)},d($){$&&A(e),$&&A(p),$&&A(m),$&&A(k),$&&A(S),Ye(x,$),$&&A(H),$&&A(O),Ye(Y,$),E=!1,Je(C)}}}function _n(l){let e,t,o=l[71].name+"",n,u,r,c,i,d=l[71].shortname+"",p,m,_,y,h,b=l[71].theme+"",k,S,v,w,T,J=l[71].relevance_function+"",I,H,O,q,K,W;return{c(){e=f("div"),t=f("h6"),n=F(o),u=g(),r=f("p"),c=f("strong"),c.textContent="Shortname:",i=g(),p=F(d),m=g(),_=f("p"),y=f("strong"),y.textContent="Theme:",h=g(),k=F(b),S=g(),v=f("p"),w=f("strong"),w.textContent="Relevance Function:",T=g(),I=F(J),H=g(),O=f("button"),O.textContent="Edit Role",q=g(),a(t,"data-testid","review-role-name-"+l[79]),a(O,"class","button is-small"),a(O,"data-testid","edit-role-"+l[79]),a(e,"class","box")},m(R,L){P(R,e,L),s(e,t),s(t,n),s(e,u),s(e,r),s(r,c),s(r,i),s(r,p),s(e,m),s(e,_),s(_,y),s(_,h),s(_,k),s(e,S),s(e,v),s(v,w),s(v,T),s(v,I),s(e,H),s(e,O),s(e,q),K||(W=Z(O,"click",l[68]),K=!0)},p(R,L){L[0]&8&&o!==(o=R[71].name+"")&&me(n,o),L[0]&8&&d!==(d=R[71].shortname+"")&&me(p,d),L[0]&8&&b!==(b=R[71].theme+"")&&me(k,b),L[0]&8&&J!==(J=R[71].relevance_function+"")&&me(I,J)},d(R){R&&A(e),K=!1,W()}}}function hn(l){let e,t=l[74]+"",o;return{c(){e=f("option"),o=F(t),e.__value=l[74],e.value=e.__value},m(n,u){P(n,e,u),s(e,o)},p:ye,d(n){n&&A(e)}}}function ki(l){let e;return{c(){e=F("Directory Path")},m(t,o){P(t,e,o)},d(t){t&&A(e)}}}function wi(l){let e;return{c(){e=F("Server URL")},m(t,o){P(t,e,o)},d(t){t&&A(e)}}}function gn(l){let e;return{c(){e=f("p"),e.textContent="Click to select directory",a(e,"class","help")},m(t,o){P(t,e,o)},d(t){t&&A(e)}}}function bn(l){let e,t,o,n,u,r,c,i,d,p,m,_;function y(){l[34].call(c,l[79],l[87])}return{c(){e=f("div"),t=f("label"),o=F("Atomic Server Secret"),u=g(),r=f("div"),c=f("input"),d=g(),p=f("p"),p.textContent="Leave empty for anonymous access",a(t,"class","label"),a(t,"for",n=`haystack-secret-${l[79]}-${l[87]}`),a(c,"class","input"),a(c,"id",i=`haystack-secret-${l[79]}-${l[87]}`),a(c,"type","password"),a(c,"placeholder","Base64 encoded secret (optional)"),a(r,"class","control"),a(p,"class","help"),a(e,"class","field")},m(h,b){P(h,e,b),s(e,t),s(t,o),s(e,u),s(e,r),s(r,c),Ae(c,l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret),s(e,d),s(e,p),m||(_=Z(c,"input",y),m=!0)},p(h,b){l=h,b[0]&264&&n!==(n=`haystack-secret-${l[79]}-${l[87]}`)&&a(t,"for",n),b[0]&264&&i!==(i=`haystack-secret-${l[79]}-${l[87]}`)&&a(c,"id",i),b[0]&264&&c.value!==l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret&&Ae(c,l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret)},d(h){h&&A(e),m=!1,_()}}}function vn(l){let e,t,o,n,u,r,c,i,d,p,m,_,y,h,b,k,S,v,w,T,J,I,H,O,q,K,W,R,L,E,C,z,x,B,Y,$,N,U,M,V,ee,ne,ke;function be(){l[35].call(p,l[79],l[87])}function Ne(...oe){return l[36](l[79],l[87],...oe)}let pe=Object.entries(l[3].roles[l[79]].haystacks[l[87]].extra_parameters||{}),fe=[];for(let oe=0;oe<pe.length;oe+=1)fe[oe]=kn(un(l,pe,oe));function ie(){return l[40](l[79],l[87])}function Se(){return l[41](l[79],l[87])}function Te(){return l[42](l[79],l[87])}return{c(){e=f("div"),t=f("label"),t.textContent="Extra Parameters (for filtering)",o=g(),n=f("div"),u=f("div"),r=f("label"),c=F("Hashtag"),d=g(),p=f("input"),_=g(),y=f("div"),h=f("div"),b=f("label"),k=F("Presets"),v=g(),w=f("div"),T=f("select"),J=f("option"),J.textContent="(choose)",I=f("option"),I.textContent="#rust",H=f("option"),H.textContent="#docs",O=f("option"),O.textContent="#test",q=f("option"),q.textContent="#todo",W=g(),R=f("p"),R.innerHTML="When set, searches will enforce the hashtag alongside your query (AND), e.g. <code>-e &quot;search&quot; -e &quot;#rust&quot;</code>.",L=g();for(let oe=0;oe<fe.length;oe+=1)fe[oe].c();E=g(),C=f("div"),z=f("div"),x=f("button"),x.textContent="+ Tag Filter",B=g(),Y=f("div"),$=f("button"),$.textContent="+ Max Results",N=g(),U=f("div"),M=f("button"),M.textContent="+ Custom Parameter",V=g(),ee=f("p"),ee.innerHTML=`Common parameters: <code>tag</code> (e.g., &quot;#rust&quot;), <code>glob</code> (e.g., &quot;*.md&quot;),
                  <code>max_count</code> (e.g., &quot;10&quot;), <code>context</code> (e.g., &quot;5&quot;)`,a(t,"class","label"),a(r,"class","label"),a(r,"for",i=`ripgrep-hashtag-${l[79]}-${l[87]}`),a(p,"class","input"),a(p,"id",m=`ripgrep-hashtag-${l[79]}-${l[87]}`),a(p,"type","text"),a(p,"placeholder","#rust"),a(u,"class","control"),a(n,"class","field is-grouped"),a(b,"class","label"),a(b,"for",S=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`),J.__value="",J.value=J.__value,I.__value="#rust",I.value=I.__value,H.__value="#docs",H.value=H.__value,O.__value="#test",O.value=O.__value,q.__value="#todo",q.value=q.__value,a(T,"id",K=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`),a(w,"class","select is-small"),a(h,"class","control"),a(y,"class","field is-grouped"),re(y,"margin-bottom",".5rem"),a(R,"class","help"),a(x,"class","button is-small is-link is-light"),a(z,"class","control"),a($,"class","button is-small is-link is-light"),a(Y,"class","control"),a(M,"class","button is-small is-link is-light"),a(U,"class","control"),a(C,"class","field is-grouped"),a(ee,"class","help"),a(e,"class","field")},m(oe,he){P(oe,e,he),s(e,t),s(e,o),s(e,n),s(n,u),s(u,r),s(r,c),s(u,d),s(u,p),Ae(p,l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag),s(e,_),s(e,y),s(y,h),s(h,b),s(b,k),s(h,v),s(h,w),s(w,T),s(T,J),s(T,I),s(T,H),s(T,O),s(T,q),s(e,W),s(e,R),s(e,L);for(let se=0;se<fe.length;se+=1)fe[se]&&fe[se].m(e,null);s(e,E),s(e,C),s(C,z),s(z,x),s(C,B),s(C,Y),s(Y,$),s(C,N),s(C,U),s(U,M),s(e,V),s(e,ee),ne||(ke=[Z(p,"input",be),Z(T,"change",Ne),Z(x,"click",ie),Z($,"click",Se),Z(M,"click",Te)],ne=!0)},p(oe,he){if(l=oe,he[0]&264&&i!==(i=`ripgrep-hashtag-${l[79]}-${l[87]}`)&&a(r,"for",i),he[0]&264&&m!==(m=`ripgrep-hashtag-${l[79]}-${l[87]}`)&&a(p,"id",m),he[0]&264&&p.value!==l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag&&Ae(p,l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag),he[0]&264&&S!==(S=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`)&&a(b,"for",S),he[0]&264&&K!==(K=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`)&&a(T,"id",K),he[0]&393224){pe=Object.entries(l[3].roles[l[79]].haystacks[l[87]].extra_parameters||{});let se;for(se=0;se<pe.length;se+=1){const ve=un(l,pe,se);fe[se]?fe[se].p(ve,he):(fe[se]=kn(ve),fe[se].c(),fe[se].m(e,E))}for(;se<fe.length;se+=1)fe[se].d(1);fe.length=pe.length}},d(oe){oe&&A(e),Ye(fe,oe),ne=!1,Je(ke)}}}function kn(l){let e,t,o,n,u,r,c,i,d,p,m,_,y;function h(...S){return l[37](l[79],l[87],l[88],...S)}function b(){l[38].call(c,l[79],l[87],l[88])}function k(){return l[39](l[79],l[87],l[88])}return{c(){e=f("div"),t=f("div"),o=f("input"),u=g(),r=f("div"),c=f("input"),i=g(),d=f("div"),p=f("button"),p.textContent="×",m=g(),a(o,"class","input"),a(o,"type","text"),a(o,"placeholder","Parameter name"),o.value=n=l[88],a(t,"class","control"),a(c,"class","input"),a(c,"type","text"),a(c,"placeholder","Parameter value"),a(r,"class","control is-expanded"),a(p,"class","button is-small is-danger"),a(d,"class","control"),a(e,"class","field is-grouped")},m(S,v){P(S,e,v),s(e,t),s(t,o),s(e,u),s(e,r),s(r,c),Ae(c,l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]]),s(e,i),s(e,d),s(d,p),s(e,m),_||(y=[Z(o,"blur",h),Z(c,"input",b),Z(p,"click",k)],_=!0)},p(S,v){l=S,v[0]&264&&n!==(n=l[88])&&o.value!==n&&(o.value=n),v[0]&264&&c.value!==l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]]&&Ae(c,l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]])},d(S){S&&A(e),_=!1,Je(y)}}}function wn(l){let e,t,o,n,u,r,c,i,d,p,m,_,y,h,b,k,S,v,w,T,J,I,H,O,q,K,W,R,L,E,C,z,x,B,Y,$,N,U,M;function V(){l[31].call(d,l[79],l[87])}function ee(oe,he){return oe[3].roles[oe[79]].haystacks[oe[87]].service==="Atomic"?wi:ki}let ne=ee(l),ke=ne(l);function be(){l[32].call(w,l[79],l[87])}function Ne(){return l[33](l[79],l[87])}let pe=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"&&gn(),fe=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"&&bn(l),ie=l[3].roles[l[79]].haystacks[l[87]].service==="Ripgrep"&&vn(l);function Se(){l[43].call(L,l[79],l[87])}function Te(){return l[44](l[79],l[87])}return{c(){e=f("div"),t=f("div"),o=f("label"),n=F("Service Type"),r=g(),c=f("div"),i=f("div"),d=f("select"),p=f("option"),p.textContent="Ripgrep (File Search)",m=f("option"),m.textContent="Atomic Server",y=g(),h=f("div"),b=f("label"),ke.c(),S=g(),v=f("div"),w=f("input"),H=g(),pe&&pe.c(),O=g(),fe&&fe.c(),q=g(),ie&&ie.c(),K=g(),W=f("div"),R=f("label"),L=f("input"),C=F(`
                 Read-only`),x=g(),B=f("div"),Y=f("button"),$=F("Remove Haystack"),a(o,"class","label"),a(o,"for",u=`haystack-service-${l[79]}-${l[87]}`),p.__value="Ripgrep",p.value=p.__value,m.__value="Atomic",m.value=m.__value,a(d,"id",_=`haystack-service-${l[79]}-${l[87]}`),l[3].roles[l[79]].haystacks[l[87]].service===void 0&&rt(V),a(i,"class","select"),a(c,"class","control"),a(t,"class","field"),a(b,"class","label"),a(b,"for",k=`haystack-path-${l[79]}-${l[87]}`),a(w,"class","input"),a(w,"id",T=`haystack-path-${l[79]}-${l[87]}`),a(w,"type","text"),a(w,"placeholder",J=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?"https://localhost:9883":"/path/to/documents"),w.readOnly=I=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic",a(v,"class","control"),a(h,"class","field"),a(L,"id",E=`haystack-readonly-${l[79]}-${l[87]}`),a(L,"type","checkbox"),a(R,"class","checkbox"),a(R,"for",z=`haystack-readonly-${l[79]}-${l[87]}`),a(W,"class","field"),a(Y,"class","button is-small is-danger"),a(Y,"data-testid",N="remove-haystack-"+l[79]+"-"+l[87]),a(B,"class","field"),a(e,"class","box is-light")},m(oe,he){P(oe,e,he),s(e,t),s(t,o),s(o,n),s(t,r),s(t,c),s(c,i),s(i,d),s(d,p),s(d,m),Me(d,l[3].roles[l[79]].haystacks[l[87]].service,!0),s(e,y),s(e,h),s(h,b),ke.m(b,null),s(h,S),s(h,v),s(v,w),Ae(w,l[3].roles[l[79]].haystacks[l[87]].path),s(v,H),pe&&pe.m(v,null),s(e,O),fe&&fe.m(e,null),s(e,q),ie&&ie.m(e,null),s(e,K),s(e,W),s(W,R),s(R,L),L.checked=l[3].roles[l[79]].haystacks[l[87]].read_only,s(R,C),s(e,x),s(e,B),s(B,Y),s(Y,$),U||(M=[Z(d,"change",V),Z(w,"input",be),Z(w,"click",function(){jl(l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?Ne:void 0)&&(l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?Ne:void 0).apply(this,arguments)}),Z(L,"change",Se),Z(Y,"click",Te)],U=!0)},p(oe,he){l=oe,he[0]&264&&u!==(u=`haystack-service-${l[79]}-${l[87]}`)&&a(o,"for",u),he[0]&264&&_!==(_=`haystack-service-${l[79]}-${l[87]}`)&&a(d,"id",_),he[0]&264&&Me(d,l[3].roles[l[79]].haystacks[l[87]].service),ne!==(ne=ee(l))&&(ke.d(1),ke=ne(l),ke&&(ke.c(),ke.m(b,null))),he[0]&264&&k!==(k=`haystack-path-${l[79]}-${l[87]}`)&&a(b,"for",k),he[0]&264&&T!==(T=`haystack-path-${l[79]}-${l[87]}`)&&a(w,"id",T),he[0]&264&&J!==(J=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?"https://localhost:9883":"/path/to/documents")&&a(w,"placeholder",J),he[0]&280&&I!==(I=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic")&&(w.readOnly=I),he[0]&264&&w.value!==l[3].roles[l[79]].haystacks[l[87]].path&&Ae(w,l[3].roles[l[79]].haystacks[l[87]].path),l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?pe||(pe=gn(),pe.c(),pe.m(v,null)):pe&&(pe.d(1),pe=null),l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?fe?fe.p(l,he):(fe=bn(l),fe.c(),fe.m(e,q)):fe&&(fe.d(1),fe=null),l[3].roles[l[79]].haystacks[l[87]].service==="Ripgrep"?ie?ie.p(l,he):(ie=vn(l),ie.c(),ie.m(e,K)):ie&&(ie.d(1),ie=null),he[0]&264&&E!==(E=`haystack-readonly-${l[79]}-${l[87]}`)&&a(L,"id",E),he[0]&264&&(L.checked=l[3].roles[l[79]].haystacks[l[87]].read_only),he[0]&264&&z!==(z=`haystack-readonly-${l[79]}-${l[87]}`)&&a(R,"for",z),he[0]&264&&N!==(N="remove-haystack-"+l[79]+"-"+l[87])&&a(Y,"data-testid",N)},d(oe){oe&&A(e),ke.d(),pe&&pe.d(),fe&&fe.d(),ie&&ie.d(),U=!1,Je(M)}}}function yn(l){var Y;let e,t,o,n,u,r,c,i,d,p,m,_,y,h,b,k,S,v,w,T,J,I,H,O,q,K,W,R,L;function E(){l[47].call(c,l[79])}function C(){return l[48](l[79])}let z=((Y=l[0][l[79]])==null?void 0:Y.length)&&$n(l);function x(){l[50].call(w,l[79])}function B(){l[51].call(O,l[79])}return{c(){e=f("div"),t=f("label"),o=F("Model"),u=g(),r=f("div"),c=f("input"),d=g(),p=f("button"),p.textContent="Fetch models",m=g(),z&&z.c(),_=g(),y=f("div"),h=f("label"),b=F("Base URL"),S=g(),v=f("div"),w=f("input"),J=g(),I=f("div"),H=f("label"),O=f("input"),K=F(`
               Automatically summarize search results`),a(t,"class","label"),a(t,"for",n=`llm-model-${l[79]}`),a(c,"class","input"),a(c,"id",i=`llm-model-${l[79]}`),a(c,"type","text"),a(c,"placeholder","llama3.1"),a(r,"class","control"),a(p,"class","button is-small"),a(e,"class","field"),a(h,"class","label"),a(h,"for",k=`llm-base-url-${l[79]}`),a(w,"class","input"),a(w,"id",T=`llm-base-url-${l[79]}`),a(w,"type","text"),a(w,"placeholder","http://127.0.0.1:11434"),a(v,"class","control"),a(y,"class","field"),a(O,"id",q=`llm-auto-summarize-${l[79]}`),a(O,"type","checkbox"),a(H,"class","checkbox"),a(H,"for",W=`llm-auto-summarize-${l[79]}`),a(I,"class","field")},m($,N){P($,e,N),s(e,t),s(t,o),s(e,u),s(e,r),s(r,c),Ae(c,l[3].roles[l[79]].llm_model),s(e,d),s(e,p),s(e,m),z&&z.m(e,null),P($,_,N),P($,y,N),s(y,h),s(h,b),s(y,S),s(y,v),s(v,w),Ae(w,l[3].roles[l[79]].llm_base_url),P($,J,N),P($,I,N),s(I,H),s(H,O),O.checked=l[3].roles[l[79]].llm_auto_summarize,s(H,K),R||(L=[Z(c,"input",E),Z(p,"click",C),Z(w,"input",x),Z(O,"change",B)],R=!0)},p($,N){var U;l=$,N[0]&264&&n!==(n=`llm-model-${l[79]}`)&&a(t,"for",n),N[0]&264&&i!==(i=`llm-model-${l[79]}`)&&a(c,"id",i),N[0]&264&&c.value!==l[3].roles[l[79]].llm_model&&Ae(c,l[3].roles[l[79]].llm_model),(U=l[0][l[79]])!=null&&U.length?z?z.p(l,N):(z=$n(l),z.c(),z.m(e,null)):z&&(z.d(1),z=null),N[0]&264&&k!==(k=`llm-base-url-${l[79]}`)&&a(h,"for",k),N[0]&264&&T!==(T=`llm-base-url-${l[79]}`)&&a(w,"id",T),N[0]&264&&w.value!==l[3].roles[l[79]].llm_base_url&&Ae(w,l[3].roles[l[79]].llm_base_url),N[0]&264&&q!==(q=`llm-auto-summarize-${l[79]}`)&&a(O,"id",q),N[0]&264&&(O.checked=l[3].roles[l[79]].llm_auto_summarize),N[0]&264&&W!==(W=`llm-auto-summarize-${l[79]}`)&&a(H,"for",W)},d($){$&&A(e),z&&z.d(),$&&A(_),$&&A(y),$&&A(J),$&&A(I),R=!1,Je(L)}}}function $n(l){let e,t,o,n,u=l[0][l[79]],r=[];for(let i=0;i<u.length;i+=1)r[i]=Cn(rn(l,u,i));function c(...i){return l[49](l[79],...i)}return{c(){e=f("div"),t=f("select");for(let i=0;i<r.length;i+=1)r[i].c();a(e,"class","select is-fullwidth"),re(e,"margin-top","0.5rem")},m(i,d){P(i,e,d),s(e,t);for(let p=0;p<r.length;p+=1)r[p]&&r[p].m(t,null);o||(n=Z(t,"change",c),o=!0)},p(i,d){if(l=i,d[0]&9){u=l[0][l[79]];let p;for(p=0;p<u.length;p+=1){const m=rn(l,u,p);r[p]?r[p].p(m,d):(r[p]=Cn(m),r[p].c(),r[p].m(t,null))}for(;p<r.length;p+=1)r[p].d(1);r.length=u.length}},d(i){i&&A(e),Ye(r,i),o=!1,n()}}}function Cn(l){let e,t=l[80]+"",o,n;return{c(){e=f("option"),o=F(t),e.__value=n=l[80],e.value=e.__value},m(u,r){P(u,e,r),s(e,o)},p(u,r){r[0]&9&&t!==(t=u[80]+"")&&me(o,t),r[0]&265&&n!==(n=u[80])&&(e.__value=n,e.value=e.__value)},d(u){u&&A(e)}}}function Sn(l){var he;let e,t,o,n,u,r,c,i,d,p,m,_,y,h,b,k,S,v,w,T,J,I,H,O,q,K,W,R,L,E,C,z,x,B,Y,$,N,U,M,V,ee,ne,ke,be;function Ne(){l[53].call(c,l[79])}function pe(){l[54].call(v,l[79])}function fe(){return l[55](l[79])}let ie=((he=l[0][l[79]])==null?void 0:he.length)&&Tn(l);function Se(){l[57].call(R,l[79])}function Te(){l[58].call(N,l[79])}let oe=l[3].roles[l[79]].openrouter_chat_enabled&&An(l);return{c(){e=f("div"),t=f("label"),o=F("OpenRouter API Key"),u=g(),r=f("div"),c=f("input"),d=g(),p=f("p"),p.innerHTML='Get your API key from <a href="https://openrouter.ai" target="_blank" rel="noopener">OpenRouter</a>',m=g(),_=f("div"),y=f("label"),h=F("Model"),k=g(),S=f("div"),v=f("input"),T=g(),J=f("button"),J.textContent="Fetch models",I=g(),ie&&ie.c(),H=g(),O=f("p"),O.textContent="Choose the language model for generating summaries. Different models offer different speed/quality tradeoffs.",q=g(),K=f("div"),W=f("label"),R=f("input"),E=F(`
               Automatically summarize search results`),z=g(),x=f("p"),x.textContent="When enabled, summaries will be generated and shown in search results.",B=g(),Y=f("div"),$=f("label"),N=f("input"),M=F(`
               Enable Chat interface (OpenRouter)`),ee=g(),oe&&oe.c(),ne=at(),a(t,"class","label"),a(t,"for",n=`openrouter-api-key-${l[79]}`),a(c,"class","input"),a(c,"id",i=`openrouter-api-key-${l[79]}`),a(c,"type","password"),a(c,"placeholder","sk-or-v1-..."),a(r,"class","control"),a(p,"class","help"),a(e,"class","field"),a(y,"class","label"),a(y,"for",b=`openrouter-model-${l[79]}`),a(v,"class","input"),a(v,"id",w=`openrouter-model-${l[79]}`),a(v,"type","text"),a(v,"placeholder","openai/gpt-4-turbo"),a(S,"class","control"),a(J,"class","button is-small"),a(O,"class","help"),a(_,"class","field"),a(R,"id",L=`openrouter-auto-summarize-${l[79]}`),a(R,"type","checkbox"),a(W,"class","checkbox"),a(W,"for",C=`openrouter-auto-summarize-${l[79]}`),a(x,"class","help"),a(K,"class","field"),a(N,"id",U=`openrouter-chat-enabled-${l[79]}`),a(N,"type","checkbox"),a($,"class","checkbox"),a($,"for",V=`openrouter-chat-enabled-${l[79]}`),a(Y,"class","field")},m(se,ve){P(se,e,ve),s(e,t),s(t,o),s(e,u),s(e,r),s(r,c),Ae(c,l[3].roles[l[79]].openrouter_api_key),s(e,d),s(e,p),P(se,m,ve),P(se,_,ve),s(_,y),s(y,h),s(_,k),s(_,S),s(S,v),Ae(v,l[3].roles[l[79]].openrouter_model),s(_,T),s(_,J),s(_,I),ie&&ie.m(_,null),s(_,H),s(_,O),P(se,q,ve),P(se,K,ve),s(K,W),s(W,R),R.checked=l[3].roles[l[79]].openrouter_auto_summarize,s(W,E),s(K,z),s(K,x),P(se,B,ve),P(se,Y,ve),s(Y,$),s($,N),N.checked=l[3].roles[l[79]].openrouter_chat_enabled,s($,M),P(se,ee,ve),oe&&oe.m(se,ve),P(se,ne,ve),ke||(be=[Z(c,"input",Ne),Z(v,"input",pe),Z(J,"click",fe),Z(R,"change",Se),Z(N,"change",Te)],ke=!0)},p(se,ve){var Be;l=se,ve[0]&264&&n!==(n=`openrouter-api-key-${l[79]}`)&&a(t,"for",n),ve[0]&264&&i!==(i=`openrouter-api-key-${l[79]}`)&&a(c,"id",i),ve[0]&264&&c.value!==l[3].roles[l[79]].openrouter_api_key&&Ae(c,l[3].roles[l[79]].openrouter_api_key),ve[0]&264&&b!==(b=`openrouter-model-${l[79]}`)&&a(y,"for",b),ve[0]&264&&w!==(w=`openrouter-model-${l[79]}`)&&a(v,"id",w),ve[0]&264&&v.value!==l[3].roles[l[79]].openrouter_model&&Ae(v,l[3].roles[l[79]].openrouter_model),(Be=l[0][l[79]])!=null&&Be.length?ie?ie.p(l,ve):(ie=Tn(l),ie.c(),ie.m(_,H)):ie&&(ie.d(1),ie=null),ve[0]&264&&L!==(L=`openrouter-auto-summarize-${l[79]}`)&&a(R,"id",L),ve[0]&264&&(R.checked=l[3].roles[l[79]].openrouter_auto_summarize),ve[0]&264&&C!==(C=`openrouter-auto-summarize-${l[79]}`)&&a(W,"for",C),ve[0]&264&&U!==(U=`openrouter-chat-enabled-${l[79]}`)&&a(N,"id",U),ve[0]&264&&(N.checked=l[3].roles[l[79]].openrouter_chat_enabled),ve[0]&264&&V!==(V=`openrouter-chat-enabled-${l[79]}`)&&a($,"for",V),l[3].roles[l[79]].openrouter_chat_enabled?oe?oe.p(l,ve):(oe=An(l),oe.c(),oe.m(ne.parentNode,ne)):oe&&(oe.d(1),oe=null)},d(se){se&&A(e),se&&A(m),se&&A(_),ie&&ie.d(),se&&A(q),se&&A(K),se&&A(B),se&&A(Y),se&&A(ee),oe&&oe.d(se),se&&A(ne),ke=!1,Je(be)}}}function Tn(l){let e,t,o,n,u=l[0][l[79]],r=[];for(let i=0;i<u.length;i+=1)r[i]=Rn(sn(l,u,i));function c(...i){return l[56](l[79],...i)}return{c(){e=f("div"),t=f("select");for(let i=0;i<r.length;i+=1)r[i].c();a(e,"class","select is-fullwidth"),re(e,"margin-top","0.5rem")},m(i,d){P(i,e,d),s(e,t);for(let p=0;p<r.length;p+=1)r[p]&&r[p].m(t,null);o||(n=Z(t,"change",c),o=!0)},p(i,d){if(l=i,d[0]&9){u=l[0][l[79]];let p;for(p=0;p<u.length;p+=1){const m=sn(l,u,p);r[p]?r[p].p(m,d):(r[p]=Rn(m),r[p].c(),r[p].m(t,null))}for(;p<r.length;p+=1)r[p].d(1);r.length=u.length}},d(i){i&&A(e),Ye(r,i),o=!1,n()}}}function Rn(l){let e,t=l[80]+"",o,n;return{c(){e=f("option"),o=F(t),e.__value=n=l[80],e.value=e.__value},m(u,r){P(u,e,r),s(e,o)},p(u,r){r[0]&9&&t!==(t=u[80]+"")&&me(o,t),r[0]&265&&n!==(n=u[80])&&(e.__value=n,e.value=e.__value)},d(u){u&&A(e)}}}function An(l){let e,t,o,n,u,r,c,i,d,p,m,_,y,h,b,k,S,v,w,T,J,I,H,O,q;function K(){l[59].call(i,l[79])}function W(){l[60].call(I,l[79])}return{c(){e=f("div"),t=f("label"),o=F("Chat Model"),u=g(),r=f("div"),c=f("div"),i=f("select"),d=f("option"),d.textContent="GPT-3.5 Turbo",p=f("option"),p.textContent="GPT-4",m=f("option"),m.textContent="Claude 3 Sonnet",_=f("option"),_.textContent="Claude 3 Haiku",y=f("option"),y.textContent="Mixtral 8x7B",b=g(),k=f("div"),S=f("label"),v=F("System Prompt (optional)"),T=g(),J=f("div"),I=f("textarea"),a(t,"class","label"),a(t,"for",n=`openrouter-chat-model-${l[79]}`),d.__value="openai/gpt-3.5-turbo",d.value=d.__value,p.__value="openai/gpt-4",p.value=p.__value,m.__value="anthropic/claude-3-sonnet",m.value=m.__value,_.__value="anthropic/claude-3-haiku",_.value=_.__value,y.__value="mistralai/mixtral-8x7b-instruct",y.value=y.__value,a(i,"id",h=`openrouter-chat-model-${l[79]}`),l[3].roles[l[79]].openrouter_chat_model===void 0&&rt(K),a(c,"class","select is-fullwidth"),a(r,"class","control"),a(e,"class","field"),a(S,"class","label"),a(S,"for",w=`openrouter-chat-system-${l[79]}`),a(I,"class","textarea"),a(I,"id",H=`openrouter-chat-system-${l[79]}`),a(I,"rows","3"),a(I,"placeholder","You are a helpful Rust engineer assistant..."),a(J,"class","control"),a(k,"class","field")},m(R,L){P(R,e,L),s(e,t),s(t,o),s(e,u),s(e,r),s(r,c),s(c,i),s(i,d),s(i,p),s(i,m),s(i,_),s(i,y),Me(i,l[3].roles[l[79]].openrouter_chat_model,!0),P(R,b,L),P(R,k,L),s(k,S),s(S,v),s(k,T),s(k,J),s(J,I),Ae(I,l[3].roles[l[79]].openrouter_chat_system_prompt),O||(q=[Z(i,"change",K),Z(I,"input",W)],O=!0)},p(R,L){l=R,L[0]&264&&n!==(n=`openrouter-chat-model-${l[79]}`)&&a(t,"for",n),L[0]&264&&h!==(h=`openrouter-chat-model-${l[79]}`)&&a(i,"id",h),L[0]&264&&Me(i,l[3].roles[l[79]].openrouter_chat_model),L[0]&264&&w!==(w=`openrouter-chat-system-${l[79]}`)&&a(S,"for",w),L[0]&264&&H!==(H=`openrouter-chat-system-${l[79]}`)&&a(I,"id",H),L[0]&264&&Ae(I,l[3].roles[l[79]].openrouter_chat_system_prompt)},d(R){R&&A(e),R&&A(b),R&&A(k),O=!1,Je(q)}}}function Ln(l){let e;return{c(){e=f("p"),e.textContent="Click to select directory",a(e,"class","help")},m(t,o){P(t,e,o)},d(t){t&&A(e)}}}function Pn(l,e){let t,o,n,u,r,c,i,d,p,m,_,y,h,b,k,S,v,w,T,J,I,H,O,q,K,W,R,L,E,C,z,x,B,Y,$,N,U,M,V,ee,ne,ke,be,Ne,pe,fe,ie,Se,Te,oe,he,se,ve,Be,Ce,Oe,le,we,Ie,Xe,He,Ee,ht,ze,St,tt,gt,Ve,lt,ut,Le,Tt,D,X,j,te,_e,de,De,qe,Pe,Fe,bt,ct,il,zt,al,Vt,Ft,ul,It,vt,Fl,ml,Wl,_l,yt,hl,Kl,Qt,Yt,Gl,gl,Bl,Wt,ot,bl,ql,Jl,vl,Zt,Xt,Vl,kl,Ql,wl,Pt,xt,el,yl,Yl,tl,jt,Mt,$l,Zl,Cl,Xl,Kt,Dt,Sl,xl,Tl,eo,to,lo,Gt,oo,Rl,Nl,no;function xn(){e[26].call(d,e[79])}function es(){e[27].call(v,e[79])}let ll=e[8],nt=[];for(let Ue=0;Ue<ll.length;Ue+=1)nt[Ue]=hn(cn(e,ll,Ue));function so(){e[28].call(R,e[79])}function ro(){e[29].call(U,e[79])}function ts(){e[30].call(ie,e[79])}let ol=e[77].haystacks,st=[];for(let Ue=0;Ue<ol.length;Ue+=1)st[Ue]=wn(an(e,ol,Ue));function ls(){return e[45](e[79])}function io(){e[46].call(Ve,e[79])}let ft=e[3].roles[e[79]].llm_provider==="ollama"&&yn(e);function os(){e[52].call(Pe,e[79])}let dt=e[3].roles[e[79]].openrouter_enabled&&Sn(e);function ns(){e[61].call(yt,e[79])}function ss(){e[62].call(ot,e[79])}function ao(){return e[63](e[79])}let kt=e[4]&&Ln();function uo(){e[64].call(Pt,e[79])}function rs(){e[65].call(Mt,e[79])}function is(){e[66].call(Dt,e[79])}function as(){return e[67](e[79])}return{key:l,first:null,c(){t=f("div"),o=f("div"),n=f("label"),u=F("Role name"),c=g(),i=f("div"),d=f("input"),m=g(),_=f("div"),y=f("label"),h=F("Short name"),k=g(),S=f("div"),v=f("input"),T=g(),J=f("div"),I=f("label"),H=F("Theme"),q=g(),K=f("div"),W=f("div"),R=f("select");for(let Ue=0;Ue<nt.length;Ue+=1)nt[Ue].c();E=g(),C=f("div"),z=f("label"),x=F("Relevance function"),Y=g(),$=f("div"),N=f("div"),U=f("select"),M=f("option"),M.textContent="title-scorer",V=f("option"),V.textContent="terraphim-graph",ee=f("option"),ee.textContent="bm25",ne=f("option"),ne.textContent="bm25f",ke=f("option"),ke.textContent="bm25plus",Ne=g(),pe=f("div"),fe=f("label"),ie=f("input"),Te=F(`
            Enable Terraphim IT features (KG preprocessing, auto-linking)`),he=g(),se=f("h5"),se.textContent="Haystacks",ve=g();for(let Ue=0;Ue<st.length;Ue+=1)st[Ue].c();Be=g(),Ce=f("button"),Oe=F("Add Haystack"),we=g(),Ie=f("h5"),Ie.textContent="AI-Enhanced Summaries (LLM Provider)",Xe=g(),He=f("div"),Ee=f("label"),ht=F("Provider"),St=g(),tt=f("div"),gt=f("div"),Ve=f("select"),lt=f("option"),lt.textContent="(none)",ut=f("option"),ut.textContent="OpenRouter",Le=f("option"),Le.textContent="Ollama (local)",D=g(),X=f("p"),X.textContent="Choose a provider. OpenRouter uses API key; Ollama runs locally.",j=g(),ft&&ft.c(),te=g(),_e=f("h5"),_e.textContent="AI-Enhanced Summaries (OpenRouter)",de=g(),De=f("div"),qe=f("label"),Pe=f("input"),bt=F(`
             Enable AI-generated article summaries`),il=g(),zt=f("p"),zt.textContent="Generate intelligent summaries using OpenRouter's language models",al=g(),dt&&dt.c(),Vt=g(),Ft=f("h5"),Ft.textContent="Knowledge Graph",ul=g(),It=f("div"),vt=f("label"),Fl=F("Remote automata URL"),Wl=g(),_l=f("div"),yt=f("input"),Kl=g(),Qt=f("div"),Yt=f("label"),Gl=F("Local KG path"),Bl=g(),Wt=f("div"),ot=f("input"),ql=g(),kt&&kt.c(),Jl=g(),vl=f("div"),Zt=f("div"),Xt=f("label"),Vl=F("Local KG type"),Ql=g(),wl=f("div"),Pt=f("select"),xt=f("option"),xt.textContent="markdown",el=f("option"),el.textContent="json",Yl=g(),tl=f("div"),jt=f("label"),Mt=f("input"),Zl=F(`
             Public`),Xl=g(),Kt=f("label"),Dt=f("input"),xl=F(`
             Publish`),eo=g(),to=f("hr"),lo=g(),Gt=f("button"),oo=F("Remove Role"),a(n,"class","label"),a(n,"for",r=`role-name-${e[79]}`),a(d,"class","input"),a(d,"id",p=`role-name-${e[79]}`),a(d,"type","text"),a(i,"class","control"),a(o,"class","field"),a(y,"class","label"),a(y,"for",b=`role-shortname-${e[79]}`),a(v,"class","input"),a(v,"id",w=`role-shortname-${e[79]}`),a(v,"type","text"),a(S,"class","control"),a(_,"class","field"),a(I,"class","label"),a(I,"for",O=`role-theme-${e[79]}`),a(R,"id",L=`role-theme-${e[79]}`),e[3].roles[e[79]].theme===void 0&&rt(so),a(W,"class","select is-fullwidth"),a(K,"class","control"),a(J,"class","field"),a(z,"class","label"),a(z,"for",B=`role-relevance-${e[79]}`),M.__value="title-scorer",M.value=M.__value,V.__value="terraphim-graph",V.value=V.__value,ee.__value="bm25",ee.value=ee.__value,ne.__value="bm25f",ne.value=ne.__value,ke.__value="bm25plus",ke.value=ke.__value,a(U,"id",be=`role-relevance-${e[79]}`),e[3].roles[e[79]].relevance_function===void 0&&rt(ro),a(N,"class","select is-fullwidth"),a($,"class","control"),a(C,"class","field"),a(ie,"class","checkbox"),a(ie,"id",Se=`role-terraphim-it-${e[79]}`),a(ie,"type","checkbox"),a(fe,"class","label"),a(fe,"for",oe=`role-terraphim-it-${e[79]}`),a(pe,"class","field"),a(se,"class","title is-6"),a(Ce,"class","button is-small"),a(Ce,"data-testid",le="add-haystack-"+e[79]),a(Ie,"class","title is-6"),a(Ee,"class","label"),a(Ee,"for",ze=`llm-provider-${e[79]}`),lt.__value="",lt.value=lt.__value,ut.__value="openrouter",ut.value=ut.__value,Le.__value="ollama",Le.value=Le.__value,a(Ve,"id",Tt=`llm-provider-${e[79]}`),e[3].roles[e[79]].llm_provider===void 0&&rt(io),a(gt,"class","select"),a(tt,"class","control"),a(X,"class","help"),a(He,"class","field"),a(_e,"class","title is-6"),a(Pe,"id",Fe=`openrouter-enabled-${e[79]}`),a(Pe,"type","checkbox"),a(qe,"class","checkbox"),a(qe,"for",ct=`openrouter-enabled-${e[79]}`),a(zt,"class","help"),a(De,"class","field"),a(Ft,"class","title is-6"),a(vt,"class","label"),a(vt,"for",ml=`kg-url-${e[79]}`),a(yt,"class","input"),a(yt,"id",hl=`kg-url-${e[79]}`),a(yt,"type","text"),a(yt,"placeholder","https://example.com/thesaurus.json"),a(_l,"class","control"),a(It,"class","field"),a(Yt,"class","label"),a(Yt,"for",gl=`kg-local-path-${e[79]}`),a(ot,"class","input"),a(ot,"id",bl=`kg-local-path-${e[79]}`),a(ot,"type","text"),a(ot,"placeholder","/path/to/markdown"),ot.readOnly=e[4],a(Wt,"class","control"),a(Qt,"class","field"),a(Xt,"class","label"),a(Xt,"for",kl=`kg-local-type-${e[79]}`),xt.__value="markdown",xt.value=xt.__value,el.__value="json",el.value=el.__value,a(Pt,"id",yl=`kg-local-type-${e[79]}`),e[3].roles[e[79]].kg.local_type===void 0&&rt(uo),a(wl,"class","select"),a(Zt,"class","control"),a(vl,"class","field is-grouped"),a(Mt,"id",$l=`kg-public-${e[79]}`),a(Mt,"type","checkbox"),a(jt,"class","checkbox"),a(jt,"for",Cl=`kg-public-${e[79]}`),re(jt,"margin-right","1rem"),a(Dt,"id",Sl=`kg-publish-${e[79]}`),a(Dt,"type","checkbox"),a(Kt,"class","checkbox"),a(Kt,"for",Tl=`kg-publish-${e[79]}`),a(tl,"class","field is-grouped"),a(Gt,"class","button is-small is-danger"),a(Gt,"data-testid",Rl="remove-role-"+e[79]),a(t,"class","box"),this.first=t},m(Ue,ge){P(Ue,t,ge),s(t,o),s(o,n),s(n,u),s(o,c),s(o,i),s(i,d),Ae(d,e[3].roles[e[79]].name),s(t,m),s(t,_),s(_,y),s(y,h),s(_,k),s(_,S),s(S,v),Ae(v,e[3].roles[e[79]].shortname),s(t,T),s(t,J),s(J,I),s(I,H),s(J,q),s(J,K),s(K,W),s(W,R);for(let $e=0;$e<nt.length;$e+=1)nt[$e]&&nt[$e].m(R,null);Me(R,e[3].roles[e[79]].theme,!0),s(t,E),s(t,C),s(C,z),s(z,x),s(C,Y),s(C,$),s($,N),s(N,U),s(U,M),s(U,V),s(U,ee),s(U,ne),s(U,ke),Me(U,e[3].roles[e[79]].relevance_function,!0),s(t,Ne),s(t,pe),s(pe,fe),s(fe,ie),ie.checked=e[3].roles[e[79]].terraphim_it,s(fe,Te),s(t,he),s(t,se),s(t,ve);for(let $e=0;$e<st.length;$e+=1)st[$e]&&st[$e].m(t,null);s(t,Be),s(t,Ce),s(Ce,Oe),s(t,we),s(t,Ie),s(t,Xe),s(t,He),s(He,Ee),s(Ee,ht),s(He,St),s(He,tt),s(tt,gt),s(gt,Ve),s(Ve,lt),s(Ve,ut),s(Ve,Le),Me(Ve,e[3].roles[e[79]].llm_provider,!0),s(He,D),s(He,X),s(t,j),ft&&ft.m(t,null),s(t,te),s(t,_e),s(t,de),s(t,De),s(De,qe),s(qe,Pe),Pe.checked=e[3].roles[e[79]].openrouter_enabled,s(qe,bt),s(De,il),s(De,zt),s(t,al),dt&&dt.m(t,null),s(t,Vt),s(t,Ft),s(t,ul),s(t,It),s(It,vt),s(vt,Fl),s(It,Wl),s(It,_l),s(_l,yt),Ae(yt,e[3].roles[e[79]].kg.url),s(t,Kl),s(t,Qt),s(Qt,Yt),s(Yt,Gl),s(Qt,Bl),s(Qt,Wt),s(Wt,ot),Ae(ot,e[3].roles[e[79]].kg.local_path),s(Wt,ql),kt&&kt.m(Wt,null),s(t,Jl),s(t,vl),s(vl,Zt),s(Zt,Xt),s(Xt,Vl),s(Zt,Ql),s(Zt,wl),s(wl,Pt),s(Pt,xt),s(Pt,el),Me(Pt,e[3].roles[e[79]].kg.local_type,!0),s(t,Yl),s(t,tl),s(tl,jt),s(jt,Mt),Mt.checked=e[3].roles[e[79]].kg.public,s(jt,Zl),s(tl,Xl),s(tl,Kt),s(Kt,Dt),Dt.checked=e[3].roles[e[79]].kg.publish,s(Kt,xl),s(t,eo),s(t,to),s(t,lo),s(t,Gt),s(Gt,oo),Nl||(no=[Z(d,"input",xn),Z(v,"input",es),Z(R,"change",so),Z(U,"change",ro),Z(ie,"change",ts),Z(Ce,"click",ls),Z(Ve,"change",io),Z(Pe,"change",os),Z(yt,"input",ns),Z(ot,"input",ss),Z(ot,"click",function(){jl(e[4]?ao:void 0)&&(e[4]?ao:void 0).apply(this,arguments)}),Z(Pt,"change",uo),Z(Mt,"change",rs),Z(Dt,"change",is),Z(Gt,"click",as)],Nl=!0)},p(Ue,ge){if(e=Ue,ge[0]&264&&r!==(r=`role-name-${e[79]}`)&&a(n,"for",r),ge[0]&264&&p!==(p=`role-name-${e[79]}`)&&a(d,"id",p),ge[0]&264&&d.value!==e[3].roles[e[79]].name&&Ae(d,e[3].roles[e[79]].name),ge[0]&264&&b!==(b=`role-shortname-${e[79]}`)&&a(y,"for",b),ge[0]&264&&w!==(w=`role-shortname-${e[79]}`)&&a(v,"id",w),ge[0]&264&&v.value!==e[3].roles[e[79]].shortname&&Ae(v,e[3].roles[e[79]].shortname),ge[0]&264&&O!==(O=`role-theme-${e[79]}`)&&a(I,"for",O),ge[0]&256){ll=e[8];let $e;for($e=0;$e<ll.length;$e+=1){const cl=cn(e,ll,$e);nt[$e]?nt[$e].p(cl,ge):(nt[$e]=hn(cl),nt[$e].c(),nt[$e].m(R,null))}for(;$e<nt.length;$e+=1)nt[$e].d(1);nt.length=ll.length}if(ge[0]&264&&L!==(L=`role-theme-${e[79]}`)&&a(R,"id",L),ge[0]&264&&Me(R,e[3].roles[e[79]].theme),ge[0]&264&&B!==(B=`role-relevance-${e[79]}`)&&a(z,"for",B),ge[0]&264&&be!==(be=`role-relevance-${e[79]}`)&&a(U,"id",be),ge[0]&264&&Me(U,e[3].roles[e[79]].relevance_function),ge[0]&264&&Se!==(Se=`role-terraphim-it-${e[79]}`)&&a(ie,"id",Se),ge[0]&264&&(ie.checked=e[3].roles[e[79]].terraphim_it),ge[0]&264&&oe!==(oe=`role-terraphim-it-${e[79]}`)&&a(fe,"for",oe),ge[0]&491576){ol=e[77].haystacks;let $e;for($e=0;$e<ol.length;$e+=1){const cl=an(e,ol,$e);st[$e]?st[$e].p(cl,ge):(st[$e]=wn(cl),st[$e].c(),st[$e].m(t,Be))}for(;$e<st.length;$e+=1)st[$e].d(1);st.length=ol.length}ge[0]&264&&le!==(le="add-haystack-"+e[79])&&a(Ce,"data-testid",le),ge[0]&264&&ze!==(ze=`llm-provider-${e[79]}`)&&a(Ee,"for",ze),ge[0]&264&&Tt!==(Tt=`llm-provider-${e[79]}`)&&a(Ve,"id",Tt),ge[0]&264&&Me(Ve,e[3].roles[e[79]].llm_provider),e[3].roles[e[79]].llm_provider==="ollama"?ft?ft.p(e,ge):(ft=yn(e),ft.c(),ft.m(t,te)):ft&&(ft.d(1),ft=null),ge[0]&264&&Fe!==(Fe=`openrouter-enabled-${e[79]}`)&&a(Pe,"id",Fe),ge[0]&264&&(Pe.checked=e[3].roles[e[79]].openrouter_enabled),ge[0]&264&&ct!==(ct=`openrouter-enabled-${e[79]}`)&&a(qe,"for",ct),e[3].roles[e[79]].openrouter_enabled?dt?dt.p(e,ge):(dt=Sn(e),dt.c(),dt.m(t,Vt)):dt&&(dt.d(1),dt=null),ge[0]&264&&ml!==(ml=`kg-url-${e[79]}`)&&a(vt,"for",ml),ge[0]&264&&hl!==(hl=`kg-url-${e[79]}`)&&a(yt,"id",hl),ge[0]&264&&yt.value!==e[3].roles[e[79]].kg.url&&Ae(yt,e[3].roles[e[79]].kg.url),ge[0]&264&&gl!==(gl=`kg-local-path-${e[79]}`)&&a(Yt,"for",gl),ge[0]&264&&bl!==(bl=`kg-local-path-${e[79]}`)&&a(ot,"id",bl),ge[0]&16&&(ot.readOnly=e[4]),ge[0]&264&&ot.value!==e[3].roles[e[79]].kg.local_path&&Ae(ot,e[3].roles[e[79]].kg.local_path),e[4]?kt||(kt=Ln(),kt.c(),kt.m(Wt,null)):kt&&(kt.d(1),kt=null),ge[0]&264&&kl!==(kl=`kg-local-type-${e[79]}`)&&a(Xt,"for",kl),ge[0]&264&&yl!==(yl=`kg-local-type-${e[79]}`)&&a(Pt,"id",yl),ge[0]&264&&Me(Pt,e[3].roles[e[79]].kg.local_type),ge[0]&264&&$l!==($l=`kg-public-${e[79]}`)&&a(Mt,"id",$l),ge[0]&264&&(Mt.checked=e[3].roles[e[79]].kg.public),ge[0]&264&&Cl!==(Cl=`kg-public-${e[79]}`)&&a(jt,"for",Cl),ge[0]&264&&Sl!==(Sl=`kg-publish-${e[79]}`)&&a(Dt,"id",Sl),ge[0]&264&&(Dt.checked=e[3].roles[e[79]].kg.publish),ge[0]&264&&Tl!==(Tl=`kg-publish-${e[79]}`)&&a(Kt,"for",Tl),ge[0]&264&&Rl!==(Rl="remove-role-"+e[79])&&a(Gt,"data-testid",Rl)},d(Ue){Ue&&A(t),Ye(nt,Ue),Ye(st,Ue),ft&&ft.d(),dt&&dt.d(),kt&&kt.d(),Nl=!1,Je(no)}}}function On(l){let e,t=l[74]+"",o;return{c(){e=f("option"),o=F(t),e.__value=l[74],e.value=e.__value},m(n,u){P(n,e,u),s(e,o)},p:ye,d(n){n&&A(e)}}}function En(l){let e,t=l[71].name+"",o,n;return{c(){e=f("option"),o=F(t),e.__value=n=l[71].name,e.value=e.__value},m(u,r){P(u,e,r),s(e,o)},p(u,r){r[0]&8&&t!==(t=u[71].name+"")&&me(o,t),r[0]&264&&n!==(n=u[71].name)&&(e.__value=n,e.value=e.__value)},d(u){u&&A(e)}}}function Nn(l){let e,t,o;return{c(){e=f("button"),e.textContent="Back",a(e,"class","button"),a(e,"data-testid","wizard-back")},m(n,u){P(n,e,u),t||(o=Z(e,"click",l[11]),t=!0)},p:ye,d(n){n&&A(e),t=!1,o()}}}function yi(l){let e,t,o;return{c(){e=f("button"),e.textContent="Save",a(e,"class","button is-success"),a(e,"data-testid","wizard-save")},m(n,u){P(n,e,u),t||(o=Z(e,"click",l[19]),t=!0)},p:ye,d(n){n&&A(e),t=!1,o()}}}function $i(l){let e,t,o;return{c(){e=f("button"),e.textContent="Next",a(e,"class","button is-primary"),a(e,"data-testid","wizard-next")},m(n,u){P(n,e,u),t||(o=Z(e,"click",l[10]),t=!0)},p:ye,d(n){n&&A(e),t=!1,o()}}}function Ci(l){let e,t,o,n,u,r,c,i,d,p,m,_,y,h,b,k,S,v;e=new rl({props:{fallbackPath:"/"}});let w=l[2]==="success"&&pn(l),T=l[2]==="error"&&mn(l);function J(R,L){return R[1]===1?vi:R[1]===2?bi:gi}let I=J(l),H=I(l),O=l[1]>1&&Nn(l);function q(R,L){return R[1]<Xn?$i:yi}let K=q(l),W=K(l);return{c(){ae(e.$$.fragment),t=g(),o=f("div"),n=f("div"),u=f("h3"),u.textContent="Configuration Wizard",r=g(),c=f("button"),c.textContent="Close",i=g(),w&&w.c(),d=g(),T&&T.c(),p=g(),H.c(),m=g(),_=f("nav"),y=f("div"),O&&O.c(),h=g(),b=f("div"),W.c(),a(u,"class","title is-4"),re(u,"margin-bottom","0"),a(c,"class","button is-small is-light"),a(c,"aria-label","Close configuration wizard"),a(n,"class","is-flex is-justify-content-space-between is-align-items-center"),re(n,"gap",".5rem"),a(y,"class","level-left"),a(b,"class","level-right"),a(_,"class","level"),a(o,"class","box")},m(R,L){ue(e,R,L),P(R,t,L),P(R,o,L),s(o,n),s(n,u),s(n,r),s(n,c),s(o,i),w&&w.m(o,null),s(o,d),T&&T.m(o,null),s(o,p),H.m(o,null),s(o,m),s(o,_),s(_,y),O&&O.m(y,null),s(_,h),s(_,b),W.m(b,null),k=!0,S||(v=Z(c,"click",Si),S=!0)},p(R,L){R[2]==="success"?w?w.p(R,L):(w=pn(R),w.c(),w.m(o,d)):w&&(w.d(1),w=null),R[2]==="error"?T?T.p(R,L):(T=mn(R),T.c(),T.m(o,p)):T&&(T.d(1),T=null),I===(I=J(R))&&H?H.p(R,L):(H.d(1),H=I(R),H&&(H.c(),H.m(o,m))),R[1]>1?O?O.p(R,L):(O=Nn(R),O.c(),O.m(y,null)):O&&(O.d(1),O=null),K===(K=q(R))&&W?W.p(R,L):(W.d(1),W=K(R),W&&(W.c(),W.m(b,null)))},i(R){k||(G(e.$$.fragment,R),k=!0)},o(R){Q(e.$$.fragment,R),k=!1},d(R){ce(e,R),R&&A(t),R&&A(o),w&&w.d(),T&&T.d(),H.d(),O&&O.d(),W.d(),S=!1,v()}}}const Xn=3;function Si(){typeof window<"u"&&window.history.back()}function Ti(l,e,t){let o,n;Re(l,je,D=>t(4,n=D));const u=Lt(null);async function r(D,X){if(Ze(je))try{const j=await ln({directory:!0,multiple:!1});j&&typeof j=="string"&&i.update(te=>(te.roles[D].haystacks[X].path=j,te))}catch(j){console.error("Failed to open folder selector:",j)}}async function c(D){if(Ze(je))try{const X=await ln({directory:!0,multiple:!1});X&&typeof X=="string"&&i.update(j=>(j.roles[D].kg.local_path=X,j))}catch(X){console.error("Failed to open folder selector:",X)}}const i=Lt({id:"Desktop",global_shortcut:"Ctrl+X",default_theme:"spacelab",default_role:"Default",roles:[]});Re(l,i,D=>t(3,o=D));const d=["default","darkly","cerulean","cosmo","cyborg","flatly","journal","litera","lumen","lux","materia","minty","nuclear","pulse","sandstone","simplex","slate","solar","spacelab","superhero","united","yeti"];qt(async()=>{try{let D;Ze(je)?D=await Ge("get_config_schema"):D=await(await fetch("/config/schema")).json(),u.set(D);const X=Ze(Ct);X&&X.id&&i.update(j=>{var te;return{...j,id:X.id,global_shortcut:X.global_shortcut,default_theme:((te=X.roles[X.default_role])==null?void 0:te.theme)??"spacelab",default_role:X.default_role,roles:Object.values(X.roles).map(_e=>{var Pe,Fe,bt,ct,il,zt,al,Vt,Ft,ul,It;const de=(Pe=_e.kg)==null?void 0:Pe.automata_path,De=(de==null?void 0:de.Remote)??"",qe=((bt=(Fe=_e.kg)==null?void 0:Fe.knowledge_graph_local)==null?void 0:bt.path)??"";return{name:_e.name,shortname:_e.shortname,relevance_function:_e.relevance_function,terraphim_it:_e.terraphim_it??!1,theme:_e.theme,haystacks:(_e.haystacks??[]).map(vt=>({path:vt.location||vt.path||"",read_only:vt.read_only??!1,service:vt.service||"Ripgrep",atomic_server_secret:vt.atomic_server_secret||"",extra_parameters:vt.extra_parameters||{}})),kg:{url:De,local_path:qe,local_type:((il=(ct=_e.kg)==null?void 0:ct.knowledge_graph_local)==null?void 0:il.input_type)??"markdown",public:((zt=_e.kg)==null?void 0:zt.public)??!1,publish:((al=_e.kg)==null?void 0:al.publish)??!1},openrouter_enabled:_e.openrouter_enabled??!1,openrouter_api_key:_e.openrouter_api_key??"",openrouter_model:_e.openrouter_model??"openai/gpt-3.5-turbo",openrouter_auto_summarize:_e.openrouter_auto_summarize??!1,openrouter_chat_enabled:_e.openrouter_chat_enabled??!1,openrouter_chat_model:_e.openrouter_chat_model??_e.openrouter_model??"openai/gpt-3.5-turbo",openrouter_chat_system_prompt:_e.openrouter_chat_system_prompt??"",llm_provider:((Vt=_e.extra)==null?void 0:Vt.llm_provider)??"",llm_model:((Ft=_e.extra)==null?void 0:Ft.llm_model)??"",llm_base_url:((ul=_e.extra)==null?void 0:ul.llm_base_url)??"",llm_auto_summarize:((It=_e.extra)==null?void 0:It.llm_auto_summarize)??!1}})}})}catch(D){console.error("Failed to load schema",D)}}),qt(()=>{const D=X=>{X.key==="Escape"&&typeof window<"u"&&window.history.back()};return window.addEventListener("keydown",D),()=>window.removeEventListener("keydown",D)});let p={};async function m(D){var de;const j=Ze(i).roles[D],te=j.llm_provider||(j.openrouter_enabled?"openrouter":""),_e=[];try{if(te==="ollama"){const De=(j.llm_base_url||"http://127.0.0.1:11434").replace(/\/$/,""),Pe=await(await fetch(`${De}/api/tags`)).json();if(Array.isArray(Pe==null?void 0:Pe.models))for(const Fe of Pe.models)Fe!=null&&Fe.name&&_e.push(Fe.name)}else if(te==="openrouter"){const De=(de=j.openrouter_api_key)==null?void 0:de.trim();if(!De)throw new Error("OpenRouter API key required");const Pe=await(await fetch("https://openrouter.ai/api/v1/models",{headers:{Authorization:`Bearer ${De}`,"HTTP-Referer":"https://terraphim.ai","X-Title":"Terraphim Desktop"}})).json(),Fe=Array.isArray(Pe==null?void 0:Pe.data)?Pe.data:[];for(const bt of Fe)bt!=null&&bt.id&&_e.push(bt.id)}}catch(De){console.error("Failed to fetch models",De)}t(0,p={...p,[D]:_e})}let _=1,y="";function h(){_<Xn&&t(1,_+=1)}function b(){_>1&&t(1,_-=1)}function k(){i.update(D=>({...D,roles:[...D.roles,{name:"New Role",shortname:"new",relevance_function:"title-scorer",terraphim_it:!1,theme:"spacelab",haystacks:[],kg:{url:"",local_path:"",local_type:"markdown",public:!1,publish:!1},openrouter_enabled:!1,openrouter_api_key:"",openrouter_model:"openai/gpt-3.5-turbo",openrouter_auto_summarize:!1,openrouter_chat_enabled:!1,openrouter_chat_model:"openai/gpt-3.5-turbo",openrouter_chat_system_prompt:"",llm_provider:"",llm_model:"",llm_base_url:"",llm_auto_summarize:!1}]}))}function S(D){i.update(X=>({...X,roles:X.roles.filter((j,te)=>te!==D)}))}function v(D){i.update(X=>(X.roles[D].haystacks.push({path:"",read_only:!1,service:"Ripgrep",atomic_server_secret:"",extra_parameters:{}}),X))}function w(D,X){i.update(j=>(j.roles[D].haystacks=j.roles[D].haystacks.filter((te,_e)=>_e!==X),j))}function T(D,X,j="",te=""){i.update(_e=>{_e.roles[D].haystacks[X].extra_parameters||(_e.roles[D].haystacks[X].extra_parameters={});const de=j||`param_${Date.now()}`;return _e.roles[D].haystacks[X].extra_parameters[de]=te,_e})}function J(D,X,j){i.update(te=>(delete te.roles[D].haystacks[X].extra_parameters[j],te))}function I(D,X,j,te){i.update(_e=>{const de=_e.roles[D].haystacks[X].extra_parameters;return de[j]!==void 0&&j!==te&&(de[te]=de[j],delete de[j]),_e})}function H(D,X,j,te){const _e=te.target.value;I(D,X,j,_e)}async function O(){var _e;const D=Ze(i),X=Ze(Ct);let j={...X};j.id=D.id,j.global_shortcut=D.global_shortcut,j.default_role=D.default_role;const te={};D.roles.forEach(de=>{var Fe,bt;const De=de.name,qe=De.replace(/^"|"$/g,"");te[qe]={extra:((bt=(Fe=X.roles)==null?void 0:Fe[De])==null?void 0:bt.extra)??{},name:de.name,shortname:de.shortname,theme:de.theme,relevance_function:de.relevance_function,terraphim_it:de.terraphim_it??!1,haystacks:de.haystacks.map(ct=>({location:ct.path,service:ct.service,read_only:ct.read_only,atomic_server_secret:ct.service==="Atomic"?ct.atomic_server_secret:void 0,extra_parameters:ct.extra_parameters||{}})),kg:de.kg.url||de.kg.local_path?{automata_path:de.kg.url?{Remote:de.kg.url}:null,knowledge_graph_local:de.kg.local_path?{input_type:de.kg.local_type,path:de.kg.local_path}:null,public:de.kg.public,publish:de.kg.publish}:null,...de.openrouter_enabled&&{openrouter_enabled:de.openrouter_enabled,openrouter_api_key:de.openrouter_api_key,openrouter_model:de.openrouter_model,openrouter_auto_summarize:de.openrouter_auto_summarize??!1,openrouter_chat_enabled:de.openrouter_chat_enabled??!1,openrouter_chat_model:de.openrouter_chat_model??de.openrouter_model,openrouter_chat_system_prompt:de.openrouter_chat_system_prompt??""}};const Pe={};de.llm_provider&&(Pe.llm_provider=de.llm_provider),de.llm_model&&(Pe.llm_model=de.llm_model),de.llm_base_url&&(Pe.llm_base_url=de.llm_base_url),typeof de.llm_auto_summarize=="boolean"&&(Pe.llm_auto_summarize=de.llm_auto_summarize),te[qe].extra={...te[qe].extra||{},...Pe}}),j.roles=te,(!j.default_role||!te[j.default_role])&&(j.default_role=((_e=D.roles[0])==null?void 0:_e.name)??"Default"),j.selected_role=j.default_role;try{if(Ze(je))await Ge("update_config",{configNew:j});else{const de=await fetch("/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(j)});if(!de.ok)throw new Error(`HTTP ${de.status}: ${de.statusText}`)}Ct.set(j),t(2,y="success"),setTimeout(()=>{t(2,y="")},3e3)}catch(de){console.error(de),t(2,y="error"),setTimeout(()=>{t(2,y="")},3e3)}}const q=()=>t(2,y=""),K=()=>t(2,y="");function W(){o.id=Rt(this),i.set(o),t(8,d)}function R(){o.global_shortcut=this.value,i.set(o),t(8,d)}function L(){o.default_theme=Rt(this),i.set(o),t(8,d)}function E(){o.default_role=Rt(this),i.set(o),t(8,d)}function C(D){o.roles[D].name=this.value,i.set(o),t(8,d)}function z(D){o.roles[D].shortname=this.value,i.set(o),t(8,d)}function x(D){o.roles[D].theme=Rt(this),i.set(o),t(8,d)}function B(D){o.roles[D].relevance_function=Rt(this),i.set(o),t(8,d)}function Y(D){o.roles[D].terraphim_it=this.checked,i.set(o),t(8,d)}function $(D,X){o.roles[D].haystacks[X].service=Rt(this),i.set(o),t(8,d)}function N(D,X){o.roles[D].haystacks[X].path=this.value,i.set(o),t(8,d)}const U=(D,X)=>r(D,X);function M(D,X){o.roles[D].haystacks[X].atomic_server_secret=this.value,i.set(o),t(8,d)}function V(D,X){o.roles[D].haystacks[X].extra_parameters.tag=this.value,i.set(o),t(8,d)}const ee=(D,X,j)=>{const te=j.currentTarget.value;te&&dl(i,o.roles[D].haystacks[X].extra_parameters.tag=te,o)},ne=(D,X,j,te)=>H(D,X,j,te);function ke(D,X,j){o.roles[D].haystacks[X].extra_parameters[j]=this.value,i.set(o),t(8,d)}const be=(D,X,j)=>J(D,X,j),Ne=(D,X)=>T(D,X,"tag","#rust"),pe=(D,X)=>T(D,X,"max_count","10"),fe=(D,X)=>T(D,X,"","");function ie(D,X){o.roles[D].haystacks[X].read_only=this.checked,i.set(o),t(8,d)}const Se=(D,X)=>w(D,X),Te=D=>v(D);function oe(D){o.roles[D].llm_provider=Rt(this),i.set(o),t(8,d)}function he(D){o.roles[D].llm_model=this.value,i.set(o),t(8,d)}const se=D=>m(D),ve=(D,X)=>{dl(i,o.roles[D].llm_model=X.currentTarget.value,o)};function Be(D){o.roles[D].llm_base_url=this.value,i.set(o),t(8,d)}function Ce(D){o.roles[D].llm_auto_summarize=this.checked,i.set(o),t(8,d)}function Oe(D){o.roles[D].openrouter_enabled=this.checked,i.set(o),t(8,d)}function le(D){o.roles[D].openrouter_api_key=this.value,i.set(o),t(8,d)}function we(D){o.roles[D].openrouter_model=this.value,i.set(o),t(8,d)}const Ie=D=>m(D),Xe=(D,X)=>{dl(i,o.roles[D].openrouter_model=X.currentTarget.value,o)};function He(D){o.roles[D].openrouter_auto_summarize=this.checked,i.set(o),t(8,d)}function Ee(D){o.roles[D].openrouter_chat_enabled=this.checked,i.set(o),t(8,d)}function ht(D){o.roles[D].openrouter_chat_model=Rt(this),i.set(o),t(8,d)}function ze(D){o.roles[D].openrouter_chat_system_prompt=this.value,i.set(o),t(8,d)}function St(D){o.roles[D].kg.url=this.value,i.set(o),t(8,d)}function tt(D){o.roles[D].kg.local_path=this.value,i.set(o),t(8,d)}const gt=D=>c(D);function Ve(D){o.roles[D].kg.local_type=Rt(this),i.set(o),t(8,d)}function lt(D){o.roles[D].kg.public=this.checked,i.set(o),t(8,d)}function ut(D){o.roles[D].kg.publish=this.checked,i.set(o),t(8,d)}return[p,_,y,o,n,r,c,i,d,m,h,b,k,S,v,w,T,J,H,O,q,K,W,R,L,E,C,z,x,B,Y,$,N,U,M,V,ee,ne,ke,be,Ne,pe,fe,ie,Se,Te,oe,he,se,ve,Be,Ce,Oe,le,we,Ie,Xe,He,Ee,ht,ze,St,tt,gt,Ve,lt,ut,D=>S(D),()=>{t(1,_=2)}]}class Ri extends mt{constructor(e){super(),_t(this,e,Ti,Ci,it,{},null,[-1,-1,-1,-1])}}function Ai(l){let e,t,o,n,u,r,c,i;return e=new rl({props:{fallbackPath:"/"}}),c=new Qn({props:{content:l[0],onChange:l[1]}}),{c(){ae(e.$$.fragment),t=g(),o=f("div"),n=f("p"),n.innerHTML="<i>The best editing experience is to configure Atomic Server, in the meantime use editor below. You will need to refresh page via Command R or Ctrl-R to see changes</i>",u=g(),r=f("div"),ae(c.$$.fragment),a(r,"class","editor"),a(o,"class","box")},m(d,p){ue(e,d,p),P(d,t,p),P(d,o,p),s(o,n),s(o,u),s(o,r),ue(c,r,null),i=!0},p(d,[p]){const m={};p&1&&(m.content=d[0]),c.$set(m)},i(d){i||(G(e.$$.fragment,d),G(c.$$.fragment,d),i=!0)},o(d){Q(e.$$.fragment,d),Q(c.$$.fragment,d),i=!1},d(d){ce(e,d),d&&A(t),d&&A(o),ce(c)}}}function Li(l,e,t){let o,n;Re(l,Ct,c=>t(2,o=c)),Re(l,je,c=>t(3,n=c));let u={json:o};function r(c){if(console.log("contents changed:",c),console.log("is tauri",n),Ct.update(i=>(i=c.json,i)),Ze(je))console.log("Updating config on server"),Ge("update_config",{configNew:c.json}).then(i=>{console.log(`Message: ${i}`)}).catch(i=>console.error(i));else{let i=`${pt.ServerURL}/config/`;fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c.json)})}t(0,u=c)}return qt(()=>{t(0,u={json:o})}),[u,r]}class Pi extends mt{constructor(e){super(),_t(this,e,Li,Ai,it,{})}}const{window:Ml}=bs;function Oi(l){let e,t,o,n,u,r,c,i,d,p;return{c(){e=f("div"),t=f("div"),o=f("h3"),o.textContent="Error loading graph",n=g(),u=f("p"),r=F(l[3]),c=g(),i=f("button"),i.textContent="Retry",a(i,"class","button is-primary"),a(t,"class","error-content svelte-1ry9pkl"),a(e,"class","error-overlay svelte-1ry9pkl")},m(m,_){P(m,e,_),s(e,t),s(t,o),s(t,n),s(t,u),s(u,r),s(t,c),s(t,i),d||(p=Z(i,"click",l[11]),d=!0)},p(m,_){_&8&&me(r,m[3])},d(m){m&&A(e),d=!1,p()}}}function Ei(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="loading-content svelte-1ry9pkl"><div class="loader svelte-1ry9pkl"></div> 
        <p>Loading knowledge graph...</p></div>`,a(e,"class","loading-overlay svelte-1ry9pkl")},m(t,o){P(t,e,o)},p:ye,d(t){t&&A(e)}}}function Un(l){let e,t,o;return{c(){e=f("button"),e.innerHTML='<i class="fas fa-times svelte-1ry9pkl"></i>',a(e,"class","close-button svelte-1ry9pkl"),a(e,"title","Close Graph")},m(n,u){P(n,e,u),t||(o=Z(e,"click",l[17]),t=!0)},p:ye,d(n){n&&A(e),t=!1,o()}}}function In(l){let e;return{c(){e=f("div"),e.innerHTML="<span><strong>Left-click:</strong> View node • <strong>Right-click:</strong> Edit node • <strong>Drag:</strong> Move • <strong>Scroll:</strong> Zoom</span>",a(e,"class","controls-info svelte-1ry9pkl")},m(t,o){P(t,e,o)},d(t){t&&A(e)}}}function Mn(l){let e,t;return{c(){e=f("div"),t=F(l[8]),a(e,"class","debug-message svelte-1ry9pkl")},m(o,n){P(o,e,n),s(e,t)},p(o,n){n&256&&me(t,o[8])},d(o){o&&A(e)}}}function Dn(l){let e=l[5].id,t,o,n=jn(l);return{c(){n.c(),t=at()},m(u,r){n.m(u,r),P(u,t,r),o=!0},p(u,r){r&32&&it(e,e=u[5].id)?(We(),Q(n,1,1,ye),Ke(),n=jn(u),n.c(),G(n,1),n.m(t.parentNode,t)):n.p(u,r)},i(u){o||(G(n),o=!0)},o(u){Q(n),o=!1},d(u){u&&A(t),n.d(u)}}}function jn(l){let e,t,o;function n(r){l[18](r)}let u={item:l[5],initialEdit:l[7]};return l[6]!==void 0&&(u.active=l[6]),e=new Hl({props:u}),Qe.push(()=>xe(e,"active",n)),e.$on("close",l[12]),e.$on("save",l[13]),{c(){ae(e.$$.fragment)},m(r,c){ue(e,r,c),o=!0},p(r,c){const i={};c&32&&(i.item=r[5]),c&128&&(i.initialEdit=r[7]),!t&&c&64&&(t=!0,i.active=r[6],et(()=>t=!1)),e.$set(i)},i(r){o||(G(e.$$.fragment,r),o=!0)},o(r){Q(e.$$.fragment,r),o=!1},d(r){ce(e,r)}}}function Ni(l){let e,t,o,n,u,r,c,i,d,p,m;rt(l[15]),e=new rl({props:{fallbackPath:"/"}});function _(w,T){if(w[2])return Ei;if(w[3])return Oi}let y=_(l),h=y&&y(l),b=l[0]&&Un(l),k=!l[2]&&!l[3]&&l[4].length>0&&In(),S=l[8]&&Mn(l),v=l[5]&&Dn(l);return{c(){ae(e.$$.fragment),t=g(),o=f("div"),h&&h.c(),n=g(),b&&b.c(),u=g(),k&&k.c(),r=g(),S&&S.c(),c=g(),v&&v.c(),i=at(),a(o,"class","graph-container svelte-1ry9pkl"),re(o,"width",l[0]?"100vw":"600px"),re(o,"height",l[0]?"100vh":"400px"),Ut(o,"fullscreen",l[0])},m(w,T){ue(e,w,T),P(w,t,T),P(w,o,T),h&&h.m(o,null),l[16](o),P(w,n,T),b&&b.m(w,T),P(w,u,T),k&&k.m(w,T),P(w,r,T),S&&S.m(w,T),P(w,c,T),v&&v.m(w,T),P(w,i,T),d=!0,p||(m=Z(Ml,"resize",l[15]),p=!0)},p(w,[T]){y===(y=_(w))&&h?h.p(w,T):(h&&h.d(1),h=y&&y(w),h&&(h.c(),h.m(o,null))),(!d||T&1)&&re(o,"width",w[0]?"100vw":"600px"),(!d||T&1)&&re(o,"height",w[0]?"100vh":"400px"),(!d||T&1)&&Ut(o,"fullscreen",w[0]),w[0]?b?b.p(w,T):(b=Un(w),b.c(),b.m(u.parentNode,u)):b&&(b.d(1),b=null),!w[2]&&!w[3]&&w[4].length>0?k||(k=In(),k.c(),k.m(r.parentNode,r)):k&&(k.d(1),k=null),w[8]?S?S.p(w,T):(S=Mn(w),S.c(),S.m(c.parentNode,c)):S&&(S.d(1),S=null),w[5]?v?(v.p(w,T),T&32&&G(v,1)):(v=Dn(w),v.c(),G(v,1),v.m(i.parentNode,i)):v&&(We(),Q(v,1,1,()=>{v=null}),Ke())},i(w){d||(G(e.$$.fragment,w),G(v),d=!0)},o(w){Q(e.$$.fragment,w),Q(v),d=!1},d(w){ce(e,w),w&&A(t),w&&A(o),h&&h.d(),l[16](null),w&&A(n),b&&b.d(w),w&&A(u),k&&k.d(w),w&&A(r),S&&S.d(w),w&&A(c),v&&v.d(w),w&&A(i),p=!1,m()}}}function Hn(l){return{id:`kg-node-${l.id}`,url:`#/graph/node/${l.id}`,title:l.label,body:`# ${l.label}

**Knowledge Graph Node**

ID: ${l.id}
Rank: ${l.rank}

This is a concept node from the knowledge graph. You can edit this content to add more information about "${l.label}".`,description:`Knowledge graph concept: ${l.label}`,tags:["knowledge-graph","concept"],rank:l.rank,stub:`Knowledge graph concept: ${l.label}`}}function Ui(l,e,t){let o,n;Re(l,At,L=>t(20,o=L)),Re(l,je,L=>t(21,n=L));let{apiUrl:u="/rolegraph"}=e,{fullscreen:r=!0}=e,c,i=!0,d=null,p=[],m=[],_=null,y=!1,h=!1,b="",k=window.innerWidth,S=window.innerHeight;function v(){t(9,k=window.innerWidth),t(10,S=window.innerHeight),!i&&!d&&O()}async function w(){t(2,i=!0),t(3,d=null);try{if(n){console.log("Loading rolegraph from Tauri");const L=await Ge("get_rolegraph",{role_name:o||void 0});if(L&&L.status==="success")t(4,p=L.nodes),m=L.edges;else throw new Error(`Tauri rolegraph fetch failed: ${(L==null?void 0:L.status)||"unknown error"}`)}else{console.log("Loading rolegraph from server");const L=o?`${u}?role=${encodeURIComponent(o)}`:u,E=await fetch(L);if(!E.ok)throw new Error(`Failed to fetch: ${E.status}`);const C=await E.json();t(4,p=C.nodes),m=C.edges}}catch(L){t(3,d=L.message),console.error("Error fetching rolegraph:",L)}finally{t(2,i=!1)}}function T(L,E){L.stopPropagation(),console.log("Node clicked:",E.label),t(5,_=Hn(E)),t(7,h=!1),t(6,y=!0)}function J(L,E){L.preventDefault(),L.stopPropagation(),console.log("Node right-clicked:",E.label),t(8,b=`Right-clicked: ${E.label}`),t(5,_=Hn(E)),t(7,h=!0),t(6,y=!0),setTimeout(()=>{t(8,b="")},2e3)}function I(){t(6,y=!1),t(5,_=null),t(7,h=!1)}async function H(){if(_)try{const L=await fetch("/documents",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(_)});L.ok?console.log("Successfully saved KG record:",_.id):console.error("Failed to save KG record:",L.statusText)}catch(L){console.error("Error saving KG record:",L)}finally{t(6,y=!1),t(5,_=null),t(7,h=!1)}}function O(){if(!c)return;t(1,c.innerHTML="",c);const L=Ul(c).append("svg").attr("width",k).attr("height",S),E=Ls().scaleExtent([.1,10]).on("zoom",M=>{C.attr("transform",M.transform)});L.call(E);const C=L.append("g"),z=Ps(p).force("link",Os(m).id(M=>M.id).distance(100)).force("charge",Es().strength(-200)).force("center",Ns(k/2,S/2)).force("collision",Us().radius(20)),x=C.append("g").attr("class","links").selectAll("line").data(m).enter().append("line").attr("stroke","#666").attr("stroke-opacity",.7).attr("stroke-width",M=>{const V=M.weight||M.rank||1;return Math.max(1,Math.min(8,V*2))}),B=C.append("g").attr("class","nodes").selectAll("circle").data(p).enter().append("circle").attr("r",M=>{const V=M.rank||1;return Math.max(6,Math.min(20,V*2))}).attr("fill",M=>{const V=M.rank||1,ee=Math.min(V/10,1);return Is(.2+ee*.6)}).attr("stroke","#fff").attr("stroke-width",2).style("cursor","pointer").on("click",(M,V)=>T(M,V)).on("contextmenu",(M,V)=>J(M,V)).on("mouseover",function(M,V){Ul(this).transition().duration(150).attr("stroke-width",3).attr("r",ee=>{const ne=ee.rank||1;return Math.max(8,Math.min(24,ne*2.5))})}).on("mouseout",function(M,V){Ul(this).transition().duration(150).attr("stroke-width",2).attr("r",ee=>{const ne=ee.rank||1;return Math.max(6,Math.min(20,ne*2))})}).call(Ms().on("start",$).on("drag",N).on("end",U)),Y=C.append("g").attr("class","labels").selectAll("text").data(p).enter().append("text").attr("text-anchor","middle").attr("dy",".35em").attr("font-size","11px").attr("font-family","Arial, sans-serif").attr("fill","#333").attr("pointer-events","none").text(M=>M.label.length>12?M.label.substring(0,12)+"...":M.label);z.on("tick",()=>{x.attr("x1",M=>M.source.x).attr("y1",M=>M.source.y).attr("x2",M=>M.target.x).attr("y2",M=>M.target.y),B.attr("cx",M=>M.x).attr("cy",M=>M.y),Y.attr("x",M=>M.x).attr("y",M=>M.y)});function $(M,V){M.active||z.alphaTarget(.3).restart(),V.fx=V.x,V.fy=V.y}function N(M,V){V.fx=M.x,V.fy=M.y}function U(M,V){M.active||z.alphaTarget(0),V.fx=null,V.fy=null}}qt(()=>{w().then(()=>{d||O()});const L=E=>{E.preventDefault()};return c&&c.addEventListener("contextmenu",L),window.addEventListener("resize",v),()=>{c&&c.removeEventListener("contextmenu",L),window.removeEventListener("resize",v)}});function q(){t(9,k=Ml.innerWidth),t(10,S=Ml.innerHeight)}function K(L){Qe[L?"unshift":"push"](()=>{c=L,t(1,c)})}const W=()=>history.back();function R(L){y=L,t(6,y)}return l.$$set=L=>{"apiUrl"in L&&t(14,u=L.apiUrl),"fullscreen"in L&&t(0,r=L.fullscreen)},[r,c,i,d,p,_,y,h,b,k,S,w,I,H,u,q,K,W,R]}class Ii extends mt{constructor(e){super(),_t(this,e,Ui,Ni,it,{apiUrl:14,fullscreen:0})}}function zn(l,e,t){const o=l.slice();return o[9]=e[t],o[11]=t,o}function Fn(l){let e,t,o,n=l[9].content+"",u,r;return{c(){e=f("div"),t=f("div"),o=f("pre"),u=F(n),a(o,"class","svelte-tu8ic4"),a(t,"class","bubble svelte-tu8ic4"),a(e,"class",r=Nt(`msg ${l[9].role}`)+" svelte-tu8ic4")},m(c,i){P(c,e,i),s(e,t),s(t,o),s(o,u)},p(c,i){i&1&&n!==(n=c[9].content+"")&&me(u,n),i&1&&r!==(r=Nt(`msg ${c[9].role}`)+" svelte-tu8ic4")&&a(e,"class",r)},d(c){c&&A(e)}}}function Wn(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="bubble loading svelte-tu8ic4"><span class="icon is-small"><i class="fas fa-spinner fa-spin"></i></span> 
            <span>Thinking...</span></div>`,a(e,"class","msg assistant svelte-tu8ic4")},m(t,o){P(t,e,o)},d(t){t&&A(e)}}}function Kn(l){let e,t,o;return{c(){e=f("p"),t=F("Model: "),o=F(l[4]),a(e,"class","is-size-7 has-text-grey")},m(n,u){P(n,e,u),s(e,t),s(e,o)},p(n,u){u&16&&me(o,n[4])},d(n){n&&A(e)}}}function Gn(l){let e,t;return{c(){e=f("p"),t=F(l[3]),a(e,"class","has-text-danger is-size-7")},m(o,n){P(o,e,n),s(e,t)},p(o,n){n&8&&me(t,o[3])},d(o){o&&A(e)}}}function Mi(l){let e,t,o,n,u,r,c,i,d,p,m,_,y,h,b,k,S,v,w,T,J,I,H,O;e=new rl({props:{fallbackPath:"/"}});let q=l[0],K=[];for(let E=0;E<q.length;E+=1)K[E]=Fn(zn(l,q,E));let W=l[2]&&Wn(),R=l[4]&&Kn(l),L=l[3]&&Gn(l);return{c(){ae(e.$$.fragment),t=g(),o=f("section"),n=f("div"),u=f("h2"),u.textContent="Chat",r=g(),c=f("p"),c.textContent=`Role: ${Ze(At)}`,i=g(),d=f("div");for(let E=0;E<K.length;E+=1)K[E].c();p=g(),W&&W.c(),m=g(),R&&R.c(),_=g(),L&&L.c(),y=g(),h=f("div"),b=f("div"),k=f("textarea"),S=g(),v=f("div"),w=f("button"),T=f("span"),T.innerHTML='<i class="fas fa-paper-plane"></i>',a(u,"class","title is-4"),a(c,"class","subtitle is-6"),a(d,"class","chat-window svelte-tu8ic4"),a(k,"class","textarea"),a(k,"rows","3"),a(k,"placeholder","Type your message and press Enter..."),a(b,"class","control is-expanded"),a(T,"class","icon"),a(w,"class","button is-primary"),w.disabled=J=l[2]||!l[1].trim(),a(v,"class","control"),a(h,"class","field has-addons chat-input svelte-tu8ic4"),a(n,"class","container"),a(o,"class","section")},m(E,C){ue(e,E,C),P(E,t,C),P(E,o,C),s(o,n),s(n,u),s(n,r),s(n,c),s(n,i),s(n,d);for(let z=0;z<K.length;z+=1)K[z]&&K[z].m(d,null);s(d,p),W&&W.m(d,null),s(n,m),R&&R.m(n,null),s(n,_),L&&L.m(n,null),s(n,y),s(n,h),s(h,b),s(b,k),Ae(k,l[1]),s(h,S),s(h,v),s(v,w),s(w,T),I=!0,H||(O=[Z(k,"input",l[7]),Z(k,"keydown",l[6]),Z(w,"click",l[5])],H=!0)},p(E,[C]){if(C&1){q=E[0];let z;for(z=0;z<q.length;z+=1){const x=zn(E,q,z);K[z]?K[z].p(x,C):(K[z]=Fn(x),K[z].c(),K[z].m(d,p))}for(;z<K.length;z+=1)K[z].d(1);K.length=q.length}E[2]?W||(W=Wn(),W.c(),W.m(d,null)):W&&(W.d(1),W=null),E[4]?R?R.p(E,C):(R=Kn(E),R.c(),R.m(n,_)):R&&(R.d(1),R=null),E[3]?L?L.p(E,C):(L=Gn(E),L.c(),L.m(n,y)):L&&(L.d(1),L=null),C&2&&Ae(k,E[1]),(!I||C&6&&J!==(J=E[2]||!E[1].trim()))&&(w.disabled=J)},i(E){I||(G(e.$$.fragment,E),I=!0)},o(E){Q(e.$$.fragment,E),I=!1},d(E){ce(e,E),E&&A(t),E&&A(o),Ye(K,E),W&&W.d(),R&&R.d(),L&&L.d(),H=!1,Je(O)}}}function Di(l,e,t){let o=[],n="",u=!1,r=null,c=null;function i(_){t(0,o=[...o,{role:"user",content:_}])}async function d(){var h;if(!n.trim()||u)return;t(3,r=null);const _=Ze(At),y=n.trim();t(1,n=""),i(y),t(2,u=!0);try{const b=await fetch(`${pt.ServerURL}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({role:_,messages:o})});if(!b.ok)throw new Error(`HTTP ${b.status}`);const k=await b.json();t(4,c=k.model_used??null),((h=k.status)==null?void 0:h.toLowerCase())==="success"&&k.message?t(0,o=[...o,{role:"assistant",content:k.message}]):t(3,r=k.error||"Chat failed")}catch(b){t(3,r=(b==null?void 0:b.message)||String(b))}finally{t(2,u=!1)}}function p(_){(_.key==="Enter"||_.key==="Return")&&!_.shiftKey&&(_.preventDefault(),d())}qt(()=>{t(0,o=[{role:"assistant",content:"Hi! How can I help you? Ask me anything about your search results or documents."}])});function m(){n=this.value,t(1,n)}return[o,n,u,r,c,d,p,m]}class ji extends mt{constructor(e){super(),_t(this,e,Di,Mi,it,{})}}function Hi(l){let e,t;return e=new hi({}),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},i(o){t||(G(e.$$.fragment,o),t=!0)},o(o){Q(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function zi(l){let e,t;return e=new ar({}),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},i(o){t||(G(e.$$.fragment,o),t=!0)},o(o){Q(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function Fi(l){let e,t;return e=new Ri({}),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},i(o){t||(G(e.$$.fragment,o),t=!0)},o(o){Q(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function Wi(l){let e,t;return e=new Pi({}),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},i(o){t||(G(e.$$.fragment,o),t=!0)},o(o){Q(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function Ki(l){let e,t;return e=new Ii({}),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},i(o){t||(G(e.$$.fragment,o),t=!0)},o(o){Q(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function Gi(l){let e,t;return e=new ji({}),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},i(o){t||(G(e.$$.fragment,o),t=!0)},o(o){Q(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function Bi(l){let e;return{c(){e=f("nav"),e.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
            <a class="navbar-item" href="/config/wizard">Wizard</a> 
            <a class="navbar-item" href="/config/json">JSON Editor</a> 
            <a class="navbar-item" href="/graph">Graph</a> 
            <a class="navbar-item" href="/chat">Chat</a></div>`,a(e,"class","navbar")},m(t,o){P(t,e,o)},p:ye,d(t){t&&A(e)}}}function qi(l){let e,t,o,n,u,r,c,i,d,p,m,_,y,h,b,k,S,v,w,T,J,I,H,O,q,K,W,R,L,E;return c=new Ll({}),p=new Ot({props:{path:"/",$$slots:{default:[Hi]},$$scope:{ctx:l}}}),h=new Ot({props:{path:"/fetch/*",$$slots:{default:[zi]},$$scope:{ctx:l}}}),k=new Ot({props:{path:"/config/wizard",$$slots:{default:[Fi]},$$scope:{ctx:l}}}),v=new Ot({props:{path:"/config/json",$$slots:{default:[Wi]},$$scope:{ctx:l}}}),T=new Ot({props:{path:"/graph",$$slots:{default:[Ki]},$$scope:{ctx:l}}}),I=new Ot({props:{path:"/chat",$$slots:{default:[Gi]},$$scope:{ctx:l}}}),K=new Ot({props:{path:"/",$$slots:{default:[Bi]},$$scope:{ctx:l}}}),{c(){e=f("meta"),t=g(),o=f("div"),n=f("main"),u=f("div"),r=f("div"),ae(c.$$.fragment),i=g(),d=f("div"),ae(p.$$.fragment),m=g(),_=f("br"),y=g(),ae(h.$$.fragment),b=g(),ae(k.$$.fragment),S=g(),ae(v.$$.fragment),w=g(),ae(T.$$.fragment),J=g(),ae(I.$$.fragment),H=g(),O=f("footer"),q=f("div"),ae(K.$$.fragment),a(e,"name","color-scheme"),a(e,"content",l[1]),document.title="Terraphim",a(r,"class","role-selector svelte-1bfpta4"),a(u,"class","top-controls svelte-1bfpta4"),a(d,"class","search-area svelte-1bfpta4"),a(n,"class","main-content svelte-1bfpta4"),a(q,"class",W=Nt(l[0])+" svelte-1bfpta4"),a(O,"class","svelte-1bfpta4"),a(o,"class","is-full-height svelte-1bfpta4")},m(C,z){s(document.head,e),P(C,t,z),P(C,o,z),s(o,n),s(n,u),s(u,r),ue(c,r,null),s(n,i),s(n,d),ue(p,d,null),s(n,m),s(n,_),s(n,y),ue(h,n,null),s(n,b),ue(k,n,null),s(n,S),ue(v,n,null),s(n,w),ue(T,n,null),s(n,J),ue(I,n,null),s(o,H),s(o,O),s(O,q),ue(K,q,null),R=!0,L||(E=[Z(O,"mouseover",l[2]),Z(O,"focus",l[2])],L=!0)},p(C,[z]){(!R||z&2)&&a(e,"content",C[1]);const x={};z&8&&(x.$$scope={dirty:z,ctx:C}),p.$set(x);const B={};z&8&&(B.$$scope={dirty:z,ctx:C}),h.$set(B);const Y={};z&8&&(Y.$$scope={dirty:z,ctx:C}),k.$set(Y);const $={};z&8&&($.$$scope={dirty:z,ctx:C}),v.$set($);const N={};z&8&&(N.$$scope={dirty:z,ctx:C}),T.$set(N);const U={};z&8&&(U.$$scope={dirty:z,ctx:C}),I.$set(U);const M={};z&8&&(M.$$scope={dirty:z,ctx:C}),K.$set(M),(!R||z&1&&W!==(W=Nt(C[0])+" svelte-1bfpta4"))&&a(q,"class",W)},i(C){R||(G(c.$$.fragment,C),G(p.$$.fragment,C),G(h.$$.fragment,C),G(k.$$.fragment,C),G(v.$$.fragment,C),G(T.$$.fragment,C),G(I.$$.fragment,C),G(K.$$.fragment,C),R=!0)},o(C){Q(c.$$.fragment,C),Q(p.$$.fragment,C),Q(h.$$.fragment,C),Q(k.$$.fragment,C),Q(v.$$.fragment,C),Q(T.$$.fragment,C),Q(I.$$.fragment,C),Q(K.$$.fragment,C),R=!1},d(C){A(e),C&&A(t),C&&A(o),ce(c),ce(p),ce(h),ce(k),ce(v),ce(T),ce(I),ce(K),L=!1,Je(E)}}}function Ji(l,e,t){let o;Re(l,pl,r=>t(1,o=r));let n="is-hidden";function u(){t(0,n="")}return[n,o,u]}class Vi extends mt{constructor(e){super(),_t(this,e,Ji,qi,it,{})}}const Qi=new Cs;Ss(Qi);new Vi({target:document.getElementById("app")});
