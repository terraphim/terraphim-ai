import{g as Ge,c as vr}from"./vendor-editor-992829d3.js";function Dt(){}function br(n,e){return n!=n?e==e:n!==e||n&&typeof n=="object"||typeof n=="function"}function gr(n,...e){if(n==null)return Dt;const t=n.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function Lt(n){let e;return gr(n,t=>e=t)(),e}Promise.resolve();const lt=[];function Ve(n,e){return{subscribe:qe(n,e).subscribe}}function qe(n,e=Dt){let t;const i=new Set;function s(c){if(br(n,c)&&(n=c,t)){const l=!lt.length;for(const a of i)a[1](),lt.push(a,n);if(l){for(let a=0;a<lt.length;a+=2)lt[a][0](lt[a+1]);lt.length=0}}}function r(c){s(c(n))}function o(c,l=Dt){const a=[c,l];return i.add(a),i.size===1&&(t=e(s)||Dt),c(n),()=>{i.delete(a),i.size===0&&(t(),t=null)}}return{set:s,update:r,subscribe:o}}const Je=qe(void 0),Ke=Ve(void 0,n=>{Je.subscribe(e=>{n(e)})}),Ae=(n,e,t,i)=>{t(n.getResourceLoading(e,i));const s=r=>{t(r)};return n.subscribe(e,s),()=>{n.unsubscribe(e,s)}},zn=(n,e)=>{const t=Lt(Ke),i=typeof n=="string"?n:Lt(n);return Ve(t.getResourceLoading(i,e),s=>{if(typeof n!="string"){let r;const o=n.subscribe(c=>{r==null||r(),s(t.getResourceLoading(c,e)),r=Ae(t,c,s,e)});return()=>{o(),r==null||r()}}else return Ae(t,n,s,e)})},Wn=(n,e,t=!1)=>{const i=Lt(Ke);let s=Lt(n);n.subscribe(f=>s=f);let r=s.get(e);const o=new Set;let c=!1;const l=f=>{r=f.get(e),a()},a=()=>{for(const f of o)f(r)},u=async f=>{r=f,f===void 0?s.removePropVal(e):s.set(e,f,i,!1),t&&await s.save(i),await i.notify(s)};return{set(f){u(f),a()},subscribe(f){return c||(i.subscribe(s.getSubject(),l),c=!0),o.add(f),f(r),()=>{o.delete(f),o.size===0&&(i.unsubscribe(s.getSubject(),l),c=!1)}},update(f){u(f(r)).then(()=>{a()})}}},Gn=n=>{Je.set(n)};var Zt=globalThis&&globalThis.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},_e=globalThis&&globalThis.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var i=t.call(n),s,r=[],o;try{for(;(e===void 0||e-- >0)&&!(s=i.next()).done;)r.push(s.value)}catch(c){o={error:c}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return r},ce=new Map;function wr(){for(var n,e,t,i,s,r,o=[],c=0;c<arguments.length;c++)o[c]=arguments[c];try{for(var l=Zt(o),a=l.next();!a.done;a=l.next()){var u=a.value;try{for(var f=(t=void 0,Zt(Object.entries(u.classes))),p=f.next();!p.done;p=f.next()){var b=_e(p.value,2),d=b[0],m=b[1];ce.set(m,d)}}catch(S){t={error:S}}finally{try{p&&!p.done&&(i=f.return)&&i.call(f)}finally{if(t)throw t.error}}try{for(var g=(s=void 0,Zt(Object.entries(u.properties))),x=g.next();!x.done;x=g.next()){var C=_e(x.value,2),d=C[0],m=C[1];ce.set(m,d)}}catch(S){s={error:S}}finally{try{x&&!x.done&&(r=g.return)&&r.call(g)}finally{if(s)throw s.error}}}}catch(S){n={error:S}}finally{try{a&&!a.done&&(e=l.return)&&e.call(l)}finally{if(n)throw n.error}}}function Sr(n){return ce.get(n)}var pe={classes:{class:"https://atomicdata.dev/classes/Class",property:"https://atomicdata.dev/classes/Property",agent:"https://atomicdata.dev/classes/Agent",datatype:"https://atomicdata.dev/classes/Datatype",ontology:"https://atomicdata.dev/class/ontology"},properties:{allowsOnly:"https://atomicdata.dev/properties/allowsOnly",classtype:"https://atomicdata.dev/properties/classtype",datatype:"https://atomicdata.dev/properties/datatype",description:"https://atomicdata.dev/properties/description",incomplete:"https://atomicdata.dev/properties/incomplete",isA:"https://atomicdata.dev/properties/isA",isDynamic:"https://atomicdata.dev/properties/isDynamic",name:"https://atomicdata.dev/properties/name",parent:"https://atomicdata.dev/properties/parent",read:"https://atomicdata.dev/properties/read",recommends:"https://atomicdata.dev/properties/recommends",requires:"https://atomicdata.dev/properties/requires",shortname:"https://atomicdata.dev/properties/shortname",write:"https://atomicdata.dev/properties/write",publicKey:"https://atomicdata.dev/properties/publicKey",instances:"https://atomicdata.dev/properties/instances",properties:"https://atomicdata.dev/properties/properties",classes:"https://atomicdata.dev/properties/classes",isLocked:"https://atomicdata.dev/properties/isLocked"}},ue={classes:{commit:"https://atomicdata.dev/classes/Commit"},properties:{subject:"https://atomicdata.dev/properties/subject",createdAt:"https://atomicdata.dev/properties/createdAt",lastCommit:"https://atomicdata.dev/properties/lastCommit",previousCommit:"https://atomicdata.dev/properties/previousCommit",signer:"https://atomicdata.dev/properties/signer",set:"https://atomicdata.dev/properties/set",push:"https://atomicdata.dev/properties/push",remove:"https://atomicdata.dev/properties/remove",destroy:"https://atomicdata.dev/properties/destroy",signature:"https://atomicdata.dev/properties/signature"}},$e={classes:{collection:"https://atomicdata.dev/classes/Collection"},properties:{members:"https://atomicdata.dev/properties/collection/members",currentPage:"https://atomicdata.dev/properties/collection/currentPage",pageSize:"https://atomicdata.dev/properties/collection/pageSize",property:"https://atomicdata.dev/properties/collection/property",totalMembers:"https://atomicdata.dev/properties/collection/totalMembers",totalPages:"https://atomicdata.dev/properties/collection/totalPages",value:"https://atomicdata.dev/properties/collection/value",sortBy:"https://atomicdata.dev/properties/collection/sortBy",sortDesc:"https://atomicdata.dev/properties/collection/sortDesc",includeExternal:"https://atomicdata.dev/properties/collection/includeExternal"}},xr={classes:{chatroom:"https://atomicdata.dev/classes/ChatRoom",document:"https://atomicdata.dev/classes/Document",bookmark:"https://atomicdata.dev/class/Bookmark",paragraph:"https://atomicdata.dev/classes/elements/Paragraph",message:"https://atomicdata.dev/classes/Message",importer:"https://atomicdata.dev/classes/Importer",folder:"https://atomicdata.dev/classes/Folder",article:"https://atomicdata.dev/classes/Article",displayStyle:"https://atomicdata.dev/class/DisplayStyle",dateFormat:"https://atomicdata.dev/classes/DateFormat",numberFormat:"https://atomicdata.dev/classes/NumberFormat",rangeProperty:"https://atomicdata.dev/classes/RangeProperty",floatRangeProperty:"https://atomicdata.dev/classes/FloatRangeProperty",formattedNumber:"https://atomicdata.dev/classes/FormattedNumber",selectProperty:"https://atomicdata.dev/classes/SelectProperty",formattedDate:"https://atomicdata.dev/classes/FormattedDate",table:"https://atomicdata.dev/classes/Table",tag:"https://atomicdata.dev/classes/Tag"},properties:{subResources:"https://atomicdata.dev/properties/subresources",displayStyle:"https://atomicdata.dev/property/display-style",publishedAt:"https://atomicdata.dev/properties/published-at",elements:"https://atomicdata.dev/properties/documents/elements",messages:"https://atomicdata.dev/properties/messages",nextPage:"https://atomicdata.dev/properties/nextPage",replyTo:"https://atomicdata.dev/properties/replyTo",url:"https://atomicdata.dev/property/url",preview:"https://atomicdata.dev/property/preview",imageUrl:"https://atomicdata.dev/properties/imageUrl",max:"https://atomicdata.dev/properties/max",min:"https://atomicdata.dev/properties/min",maxFloat:"https://atomicdata.dev/properties/maxFloat",minFloat:"https://atomicdata.dev/properties/minFloat",numberFormatting:"https://atomicdata.dev/properties/numberFormatting",decimalPlaces:"https://atomicdata.dev/properties/decimalPlaces",dateFormat:"https://atomicdata.dev/properties/dateFormat",tableColumnWidths:"https://atomicdata.dev/properties/tableColumnWidths",customNodePositioning:"https://atomicdata.dev/properties/custom-node-positioning",color:"https://atomicdata.dev/properties/color",emoji:"https://atomicdata.dev/properties/emoji",tags:"https://atomicdata.dev/properties/tags"}},Ar={classes:{error:"https://atomicdata.dev/classes/Error",endpoint:"https://atomicdata.dev/classes/Endpoint",drive:"https://atomicdata.dev/classes/Drive",redirect:"https://atomicdata.dev/classes/Redirect",file:"https://atomicdata.dev/classes/File",invite:"https://atomicdata.dev/classes/Invite",endpointResponse:"https://atomicdata.dev/ontology/server/class/endpoint-response"},properties:{drives:"https://atomicdata.dev/properties/drives",results:"https://atomicdata.dev/properties/endpoint/results",property:"https://atomicdata.dev/properties/search/property",redirectAgent:"https://atomicdata.dev/properties/invite/redirectAgent",agent:"https://atomicdata.dev/properties/invite/agent",publicKey:"https://atomicdata.dev/properties/invite/publicKey",target:"https://atomicdata.dev/properties/invite/target",usagesLeft:"https://atomicdata.dev/properties/invite/usagesLeft",users:"https://atomicdata.dev/properties/invite/users",write:"https://atomicdata.dev/properties/invite/write",filename:"https://atomicdata.dev/properties/filename",filesize:"https://atomicdata.dev/properties/filesize",downloadUrl:"https://atomicdata.dev/properties/downloadURL",mimetype:"https://atomicdata.dev/properties/mimetype",attachments:"https://atomicdata.dev/properties/attachments",createdBy:"https://atomicdata.dev/properties/createdBy",checksum:"https://atomicdata.dev/properties/checksum",internalId:"https://atomicdata.dev/properties/internalId",children:"https://atomicdata.dev/properties/children",parameters:"https://atomicdata.dev/properties/endpoint/parameters",destination:"https://atomicdata.dev/properties/destination",status:"https://atomicdata.dev/ontology/server/property/status",responseMessage:"https://atomicdata.dev/ontology/server/property/response-message"}};function _r(){wr(pe,ue,$e,xr,Ar)}var Re=globalThis&&globalThis.__awaiter||function(n,e,t,i){function s(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function c(u){try{a(i.next(u))}catch(f){o(f)}}function l(u){try{a(i.throw(u))}catch(f){o(f)}}function a(u){u.done?r(u.value):s(u.value).then(c,l)}a((i=i.apply(n,e||[])).next())})},Ee=globalThis&&globalThis.__generator||function(n,e){var t={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},i,s,r,o;return o={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function c(a){return function(u){return l([a,u])}}function l(a){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(t=0)),t;)try{if(i=1,s&&(r=a[0]&2?s.return:a[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,a[1])).done)return r;switch(s=0,r&&(a=[a[0]&2,r.value]),a[0]){case 0:case 1:r=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,s=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(r=t.trys,!(r=r.length>0&&r[r.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!r||a[1]>r[0]&&a[1]<r[3])){t.label=a[1];break}if(a[0]===6&&t.label<r[1]){t.label=r[1],r=a;break}if(r&&t.label<r[2]){t.label=r[2],t.ops.push(a);break}r[2]&&t.ops.pop(),t.trys.pop();continue}a=e.call(n,t)}catch(u){a=[6,u],s=0}finally{i=r=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},Vn=function(){function n(e,t){if(t&&X.tryValidSubject(t),!e)throw new W("Agent requires a private key");this.client=new X,this.subject=t,this.privateKey=e}return n.fromSecret=function(e){var t=atob(e),i=JSON.parse(t),s=i.privateKey,r=i.subject,o=new n(s,r);return o},n.prototype.getPublicKey=function(){return Re(this,void 0,void 0,function(){var e;return Ee(this,function(t){switch(t.label){case 0:return this.publicKey?[3,2]:[4,yn(this.privateKey)];case 1:e=t.sent(),this.publicKey=e,t.label=2;case 2:return[2,this.publicKey]}})})},n.prototype.buildSecret=function(){var e=JSON.stringify(this);return btoa(e)},n.prototype.verifyPublicKeyWithServer=function(){var e;return Re(this,void 0,void 0,function(){var t,i,s;return Ee(this,function(r){switch(r.label){case 0:if(!this.subject)throw new W("Agent has no subject");return[4,this.client.fetchResourceHTTP(this.subject)];case 1:if(t=r.sent().resource,t.error)throw new Error("Could not fetch agent, and could therefore not check validity of public key. ".concat(t.error));return i=(e=t.get(U.agent.publicKey))===null||e===void 0?void 0:e.toString(),s=i,[4,this.getPublicKey()];case 2:if(s!==r.sent())throw new Error("Fetched publickey does not match current one - is the private key correct?");return[2]}})})},n}(),ye=globalThis&&globalThis.__awaiter||function(n,e,t,i){function s(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function c(u){try{a(i.next(u))}catch(f){o(f)}}function l(u){try{a(i.throw(u))}catch(f){o(f)}}function a(u){u.done?r(u.value):s(u.value).then(c,l)}a((i=i.apply(n,e||[])).next())})},me=globalThis&&globalThis.__generator||function(n,e){var t={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},i,s,r,o;return o={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function c(a){return function(u){return l([a,u])}}function l(a){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(t=0)),t;)try{if(i=1,s&&(r=a[0]&2?s.return:a[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,a[1])).done)return r;switch(s=0,r&&(a=[a[0]&2,r.value]),a[0]){case 0:case 1:r=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,s=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(r=t.trys,!(r=r.length>0&&r[r.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!r||a[1]>r[0]&&a[1]<r[3])){t.label=a[1];break}if(a[0]===6&&t.label<r[1]){t.label=r[1],r=a;break}if(r&&t.label<r[2]){t.label=r[2],t.ops.push(a);break}r[2]&&t.ops.pop(),t.trys.pop();continue}a=e.call(n,t)}catch(u){a=[6,u],s=0}finally{i=r=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};function Ze(n,e){return ye(this,void 0,void 0,function(){var t,i,s,r,o;return me(this,function(c){switch(c.label){case 0:if(t=Se(),!e.subject)throw new Error("Agent has no subject, cannot authenticate");return o={"https://atomicdata.dev/properties/auth/agent":e.subject,"https://atomicdata.dev/properties/auth/requestedSubject":n},s="https://atomicdata.dev/properties/auth/publicKey",[4,e.getPublicKey()];case 1:return o[s]=c.sent(),o["https://atomicdata.dev/properties/auth/timestamp"]=t,r="https://atomicdata.dev/properties/auth/signature",[4,Ye(n,e,t)];case 2:return i=(o[r]=c.sent(),o),[2,i]}})})}function Ye(n,e,t){return ye(this,void 0,void 0,function(){var i;return me(this,function(s){switch(s.label){case 0:return i="".concat(n," ").concat(t),[4,cr(i,e.privateKey)];case 1:return[2,s.sent()]}})})}function Rr(n,e){var t;return!n.startsWith("http://localhost")&&((t=e==null?void 0:e.subject)===null||t===void 0?void 0:t.startsWith("http://localhost"))}function Te(n,e,t){return ye(this,void 0,void 0,function(){var i,s,r,o,c;return me(this,function(l){switch(l.label){case 0:return i=Se(),e!=null&&e.subject&&!Rr(n,e)?(s=t,r="x-atomic-public-key",[4,e.getPublicKey()]):[3,3];case 1:return s[r]=l.sent(),o=t,c="x-atomic-signature",[4,Ye(n,e,i)];case 2:o[c]=l.sent(),t["x-atomic-timestamp"]=i,t["x-atomic-agent"]=e==null?void 0:e.subject,l.label=3;case 3:return[2,t]}})})}var Er=24*60*60*1e3,Tr=function(n,e,t,i){i===void 0&&(i=Er);var s=new Date(Date.now()+i).toUTCString(),r=encodeURIComponent(e),o=new URL(t).hostname,c="".concat(n,"=").concat(r,";Expires=").concat(s,";Domain=").concat(o,";SameSite=Lax;path=/");document.cookie=c},Xe="atomic_session",Qe=function(n,e){Ze(n,e).then(function(t){Tr(Xe,btoa(JSON.stringify(t)),n)})},Cr=function(){var n=document.cookie.match(/^(.*;)?\s*atomic_session\s*=\s*[^;]+(.*)?$/);return n?n.length>0:!1},Br=function(){document.cookie="".concat(Xe,"=;Max-Age=-99999999")};globalThis&&globalThis.__awaiter;globalThis&&globalThis.__generator;function Mt(){return globalThis===globalThis.window}var le={exports:{}};(function(n,e){var t=typeof self<"u"?self:vr,i=function(){function r(){this.fetch=!1,this.DOMException=t.DOMException}return r.prototype=t,new r}();(function(r){(function(o){var c={searchParams:"URLSearchParams"in r,iterable:"Symbol"in r&&"iterator"in Symbol,blob:"FileReader"in r&&"Blob"in r&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in r,arrayBuffer:"ArrayBuffer"in r};function l(h){return h&&DataView.prototype.isPrototypeOf(h)}if(c.arrayBuffer)var a=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],u=ArrayBuffer.isView||function(h){return h&&a.indexOf(Object.prototype.toString.call(h))>-1};function f(h){if(typeof h!="string"&&(h=String(h)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(h))throw new TypeError("Invalid character in header field name");return h.toLowerCase()}function p(h){return typeof h!="string"&&(h=String(h)),h}function b(h){var v={next:function(){var A=h.shift();return{done:A===void 0,value:A}}};return c.iterable&&(v[Symbol.iterator]=function(){return v}),v}function d(h){this.map={},h instanceof d?h.forEach(function(v,A){this.append(A,v)},this):Array.isArray(h)?h.forEach(function(v){this.append(v[0],v[1])},this):h&&Object.getOwnPropertyNames(h).forEach(function(v){this.append(v,h[v])},this)}d.prototype.append=function(h,v){h=f(h),v=p(v);var A=this.map[h];this.map[h]=A?A+", "+v:v},d.prototype.delete=function(h){delete this.map[f(h)]},d.prototype.get=function(h){return h=f(h),this.has(h)?this.map[h]:null},d.prototype.has=function(h){return this.map.hasOwnProperty(f(h))},d.prototype.set=function(h,v){this.map[f(h)]=p(v)},d.prototype.forEach=function(h,v){for(var A in this.map)this.map.hasOwnProperty(A)&&h.call(v,this.map[A],A,this)},d.prototype.keys=function(){var h=[];return this.forEach(function(v,A){h.push(A)}),b(h)},d.prototype.values=function(){var h=[];return this.forEach(function(v){h.push(v)}),b(h)},d.prototype.entries=function(){var h=[];return this.forEach(function(v,A){h.push([A,v])}),b(h)},c.iterable&&(d.prototype[Symbol.iterator]=d.prototype.entries);function m(h){if(h.bodyUsed)return Promise.reject(new TypeError("Already read"));h.bodyUsed=!0}function g(h){return new Promise(function(v,A){h.onload=function(){v(h.result)},h.onerror=function(){A(h.error)}})}function x(h){var v=new FileReader,A=g(v);return v.readAsArrayBuffer(h),A}function C(h){var v=new FileReader,A=g(v);return v.readAsText(h),A}function S(h){for(var v=new Uint8Array(h),A=new Array(v.length),M=0;M<v.length;M++)A[M]=String.fromCharCode(v[M]);return A.join("")}function R(h){if(h.slice)return h.slice(0);var v=new Uint8Array(h.byteLength);return v.set(new Uint8Array(h)),v.buffer}function P(){return this.bodyUsed=!1,this._initBody=function(h){this._bodyInit=h,h?typeof h=="string"?this._bodyText=h:c.blob&&Blob.prototype.isPrototypeOf(h)?this._bodyBlob=h:c.formData&&FormData.prototype.isPrototypeOf(h)?this._bodyFormData=h:c.searchParams&&URLSearchParams.prototype.isPrototypeOf(h)?this._bodyText=h.toString():c.arrayBuffer&&c.blob&&l(h)?(this._bodyArrayBuffer=R(h.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):c.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(h)||u(h))?this._bodyArrayBuffer=R(h):this._bodyText=h=Object.prototype.toString.call(h):this._bodyText="",this.headers.get("content-type")||(typeof h=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):c.searchParams&&URLSearchParams.prototype.isPrototypeOf(h)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},c.blob&&(this.blob=function(){var h=m(this);if(h)return h;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?m(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(x)}),this.text=function(){var h=m(this);if(h)return h;if(this._bodyBlob)return C(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(S(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},c.formData&&(this.formData=function(){return this.text().then(V)}),this.json=function(){return this.text().then(JSON.parse)},this}var $=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function St(h){var v=h.toUpperCase();return $.indexOf(v)>-1?v:h}function N(h,v){v=v||{};var A=v.body;if(h instanceof N){if(h.bodyUsed)throw new TypeError("Already read");this.url=h.url,this.credentials=h.credentials,v.headers||(this.headers=new d(h.headers)),this.method=h.method,this.mode=h.mode,this.signal=h.signal,!A&&h._bodyInit!=null&&(A=h._bodyInit,h.bodyUsed=!0)}else this.url=String(h);if(this.credentials=v.credentials||this.credentials||"same-origin",(v.headers||!this.headers)&&(this.headers=new d(v.headers)),this.method=St(v.method||this.method||"GET"),this.mode=v.mode||this.mode||null,this.signal=v.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&A)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(A)}N.prototype.clone=function(){return new N(this,{body:this._bodyInit})};function V(h){var v=new FormData;return h.trim().split("&").forEach(function(A){if(A){var M=A.split("="),I=M.shift().replace(/\+/g," "),B=M.join("=").replace(/\+/g," ");v.append(decodeURIComponent(I),decodeURIComponent(B))}}),v}function ct(h){var v=new d,A=h.replace(/\r?\n[\t ]+/g," ");return A.split(/\r?\n/).forEach(function(M){var I=M.split(":"),B=I.shift().trim();if(B){var Ot=I.join(":").trim();v.append(B,Ot)}}),v}P.call(N.prototype);function H(h,v){v||(v={}),this.type="default",this.status=v.status===void 0?200:v.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in v?v.statusText:"OK",this.headers=new d(v.headers),this.url=v.url||"",this._initBody(h)}P.call(H.prototype),H.prototype.clone=function(){return new H(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},H.error=function(){var h=new H(null,{status:0,statusText:""});return h.type="error",h};var ut=[301,302,303,307,308];H.redirect=function(h,v){if(ut.indexOf(v)===-1)throw new RangeError("Invalid status code");return new H(null,{status:v,headers:{location:h}})},o.DOMException=r.DOMException;try{new o.DOMException}catch{o.DOMException=function(v,A){this.message=v,this.name=A;var M=Error(v);this.stack=M.stack},o.DOMException.prototype=Object.create(Error.prototype),o.DOMException.prototype.constructor=o.DOMException}function it(h,v){return new Promise(function(A,M){var I=new N(h,v);if(I.signal&&I.signal.aborted)return M(new o.DOMException("Aborted","AbortError"));var B=new XMLHttpRequest;function Ot(){B.abort()}B.onload=function(){var xt={status:B.status,statusText:B.statusText,headers:ct(B.getAllResponseHeaders()||"")};xt.url="responseURL"in B?B.responseURL:xt.headers.get("X-Request-URL");var $t="response"in B?B.response:B.responseText;A(new H($t,xt))},B.onerror=function(){M(new TypeError("Network request failed"))},B.ontimeout=function(){M(new TypeError("Network request failed"))},B.onabort=function(){M(new o.DOMException("Aborted","AbortError"))},B.open(I.method,I.url,!0),I.credentials==="include"?B.withCredentials=!0:I.credentials==="omit"&&(B.withCredentials=!1),"responseType"in B&&c.blob&&(B.responseType="blob"),I.headers.forEach(function(xt,$t){B.setRequestHeader($t,xt)}),I.signal&&(I.signal.addEventListener("abort",Ot),B.onreadystatechange=function(){B.readyState===4&&I.signal.removeEventListener("abort",Ot)}),B.send(typeof I._bodyInit>"u"?null:I._bodyInit)})}return it.polyfill=!0,r.fetch||(r.fetch=it,r.Headers=d,r.Request=N,r.Response=H),o.Headers=d,o.Request=N,o.Response=H,o.fetch=it,Object.defineProperty(o,"__esModule",{value:!0}),o})({})})(i),i.fetch.ponyfill=!0,delete i.fetch.polyfill;var s=i;e=s.fetch,e.default=s.fetch,e.fetch=s.fetch,e.Headers=s.Headers,e.Request=s.Request,e.Response=s.Response,n.exports=e})(le,le.exports);var Or=le.exports;const Ur=Ge(Or);var fe=globalThis&&globalThis.__assign||function(){return fe=Object.assign||function(n){for(var e,t=1,i=arguments.length;t<i;t++){e=arguments[t];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(n[s]=e[s])}return n},fe.apply(this,arguments)},Yt=globalThis&&globalThis.__awaiter||function(n,e,t,i){function s(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function c(u){try{a(i.next(u))}catch(f){o(f)}}function l(u){try{a(i.throw(u))}catch(f){o(f)}}function a(u){u.done?r(u.value):s(u.value).then(c,l)}a((i=i.apply(n,e||[])).next())})},Xt=globalThis&&globalThis.__generator||function(n,e){var t={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},i,s,r,o;return o={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function c(a){return function(u){return l([a,u])}}function l(a){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(t=0)),t;)try{if(i=1,s&&(r=a[0]&2?s.return:a[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,a[1])).done)return r;switch(s=0,r&&(a=[a[0]&2,r.value]),a[0]){case 0:case 1:r=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,s=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(r=t.trys,!(r=r.length>0&&r[r.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!r||a[1]>r[0]&&a[1]<r[3])){t.label=a[1];break}if(a[0]===6&&t.label<r[1]){t.label=r[1],r=a;break}if(r&&t.label<r[2]){t.label=r[2],t.ops.push(a);break}r[2]&&t.ops.pop(),t.trys.pop();continue}a=e.call(n,t)}catch(u){a=[6,u],s=0}finally{i=r=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},Qt=globalThis&&globalThis.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var i=t.call(n),s,r=[],o;try{for(;(e===void 0||e-- >0)&&!(s=i.next()).done;)r.push(s.value)}catch(c){o={error:c}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return r},Pr=globalThis&&globalThis.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var i=0,s=e.length,r;i<s;i++)(r||!(i in e))&&(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return n.concat(r||Array.prototype.slice.call(e))},kr=function(n){return"blob"in n&&"name"in n},jr="application/ad+json",X=function(){function n(e){this.__fetchOverride=e}return Object.defineProperty(n.prototype,"fetch",{get:function(){var e,t=(e=this.__fetchOverride)!==null&&e!==void 0?e:Ur;if(typeof t>"u")throw new W("No fetch available, If the current environment doesn't have a fetch implementation you can pass one yourself.");return t},enumerable:!1,configurable:!0}),n.tryValidSubject=function(e){try{new URL(e)}catch(t){throw new Error("Not a valid URL: ".concat(e,". ").concat(t))}},n.isValidSubject=function(e){if(typeof e!="string")return!1;try{return n.tryValidSubject(e),!0}catch{return!1}},n.removeQueryParamsFromURL=function(e){return e==null?void 0:e.split("?")[0]},n.prototype.setFetch=function(e){this.__fetchOverride=e},n.prototype.fetchResourceHTTP=function(e,t){return t===void 0&&(t={}),Yt(this,void 0,void 0,function(){var i,s,r,o,c,l,a,u,f,p,b,d,m,g,x,C,S;return Xt(this,function(R){switch(R.label){case 0:i=t.signInfo,s=t.from,r=t.body,o=t.method,c=[],l=new gt,a=new bt(e),R.label=1;case 1:return R.trys.push([1,7,,8]),n.tryValidSubject(e),u={},u.Accept=jr,i?Mt()&&e.startsWith(window.location.origin)?(Cr()||Qe(i.serverURL,i.agent),[3,4]):[3,2]:[3,4];case 2:return[4,Te(e,i.agent,u)];case 3:R.sent(),R.label=4;case 4:return f=e,s!==void 0&&(p=new URL("".concat(s,"/path")),p.searchParams.set("path",e),f=p.href),[4,this.fetch(f,{headers:u,method:o??"GET",body:r})];case 5:return b=R.sent(),[4,b.text()];case 6:if(d=R.sent(),b.status===200)try{m=JSON.parse(d),t.noNested?a=m:(g=Qt(l.parseObject(m,e),2),x=g[0],C=g[1],a=x,c.push.apply(c,Pr([],Qt(C),!1)))}catch(P){throw new W("Could not parse JSON from fetching ".concat(e,". Is it an Atomic Data resource? Error message: ").concat(P.message))}else throw b.status===401?new W(d,J.Unauthorized):b.status===500?new W(d,J.Server):b.status===404?new W(d,J.NotFound):new W(d);return[3,8];case 7:return S=R.sent(),a.setError(S),c=[a],console.error(e,S),[3,8];case 8:return a.loading=!1,[2,{resource:a,createdResources:c}]}})})},n.prototype.postCommit=function(e,t){return Yt(this,void 0,void 0,function(){var i,s,r,o,c;return Xt(this,function(l){switch(l.label){case 0:i=or(fe({},e)),s=new Headers,s.set("Content-Type","application/ad+json"),l.label=1;case 1:return l.trys.push([1,3,,4]),[4,this.fetch(t,{headers:s,method:"POST",body:i})];case 2:return r=l.sent(),[3,4];case 3:throw o=l.sent(),new W("Posting Commit to ".concat(t," failed: ").concat(o));case 4:return[4,r.text()];case 5:if(c=l.sent(),r.status!==200)throw new W(c,J.Server);return[2,ur(c)]}})})},n.prototype.uploadFiles=function(e,t,i,s){return Yt(this,void 0,void 0,function(){var r,o,c,l,a,u,f,p,b,d;return Xt(this,function(m){switch(m.label){case 0:return r=new gt,o=new FormData,e.map(function(g){kr(g)?o.append("assets",g.blob,g.name):o.append("assets",g,g.name)}),c=new URL("".concat(t,"/upload")),c.searchParams.set("parent",s),[4,Te(c.toString(),i,{})];case 1:return l=m.sent(),a={method:"POST",body:o,headers:l},[4,this.fetch(c.toString(),a)];case 2:return u=m.sent(),[4,u.text()];case 3:if(f=m.sent(),u.status!==200)throw Error(f);return p=JSON.parse(f),b=Qt(r.parseArray(p),1),d=b[0],[2,d]}})})},n}();const Nr={};/*! noble-ed25519 - MIT License (c) 2019 Paul Miller (paulmillr.com) */const j=BigInt(0),_=BigInt(1),L=BigInt(2),tr=BigInt(255),Ce=L**BigInt(252)+BigInt("27742317777372353535851937790883648493"),O={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),P:L**tr-BigInt(19),l:Ce,n:Ce,h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960")},er=L**BigInt(256),Rt=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt("6853475219497561581579357271197624642482790079785650197046958215289687604742");const Ir=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),Fr=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),Dr=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),Mr=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952");class T{constructor(e,t,i,s){this.x=e,this.y=t,this.z=i,this.t=s}static fromAffine(e){if(!(e instanceof k))throw new TypeError("ExtendedPoint#fromAffine: expected Point");return e.equals(k.ZERO)?T.ZERO:new T(e.x,e.y,_,y(e.x*e.y))}static toAffineBatch(e){const t=zr(e.map(i=>i.z));return e.map((i,s)=>i.toAffine(t[s]))}static normalizeZ(e){return this.toAffineBatch(e).map(this.fromAffine)}equals(e){Be(e);const{x:t,y:i,z:s}=this,{x:r,y:o,z:c}=e,l=y(t*c),a=y(r*s),u=y(i*c),f=y(o*s);return l===a&&u===f}negate(){return new T(y(-this.x),this.y,this.z,y(-this.t))}double(){const{x:e,y:t,z:i}=this,{a:s}=O,r=y(e**L),o=y(t**L),c=y(L*y(i**L)),l=y(s*r),a=y(y((e+t)**L)-r-o),u=l+o,f=u-c,p=l-o,b=y(a*f),d=y(u*p),m=y(a*p),g=y(f*u);return new T(b,d,g,m)}add(e){Be(e);const{x:t,y:i,z:s,t:r}=this,{x:o,y:c,z:l,t:a}=e,u=y((i-t)*(c+o)),f=y((i+t)*(c-o)),p=y(f-u);if(p===j)return this.double();const b=y(s*L*a),d=y(r*L*l),m=d+b,g=f+u,x=d-b,C=y(m*p),S=y(g*x),R=y(m*x),P=y(p*g);return new T(C,S,P,R)}subtract(e){return this.add(e.negate())}precomputeWindow(e){const t=1+256/e,i=[];let s=this,r=s;for(let o=0;o<t;o++){r=s,i.push(r);for(let c=1;c<2**(e-1);c++)r=r.add(s),i.push(r);s=r.double()}return i}wNAF(e,t){!t&&this.equals(T.BASE)&&(t=k.BASE);const i=t&&t._WINDOW_SIZE||1;if(256%i)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let s=t&&he.get(t);s||(s=this.precomputeWindow(i),t&&i!==1&&(s=T.normalizeZ(s),he.set(t,s)));let r=T.ZERO,o=T.ZERO;const c=1+256/i,l=2**(i-1),a=BigInt(2**i-1),u=2**i,f=BigInt(i);for(let p=0;p<c;p++){const b=p*l;let d=Number(e&a);if(e>>=f,d>l&&(d-=u,e+=_),d===0){let m=s[b];p%2&&(m=m.negate()),o=o.add(m)}else{let m=s[b+Math.abs(d)-1];d<0&&(m=m.negate()),r=r.add(m)}}return T.normalizeZ([r,o])[0]}multiply(e,t){return this.wNAF(Ht(e,O.l),t)}multiplyUnsafe(e){let t=Ht(e,O.l,!1);const i=T.BASE,s=T.ZERO;if(t===j)return s;if(this.equals(s)||t===_)return this;if(this.equals(i))return this.wNAF(t);let r=s,o=this;for(;t>j;)t&_&&(r=r.add(o)),o=o.double(),t>>=_;return r}isSmallOrder(){return this.multiplyUnsafe(O.h).equals(T.ZERO)}isTorsionFree(){return this.multiplyUnsafe(O.l).equals(T.ZERO)}toAffine(e=Vt(this.z)){const{x:t,y:i,z:s}=this,r=y(t*e),o=y(i*e);if(y(s*e)!==_)throw new Error("invZ was invalid");return new k(r,o)}fromRistrettoBytes(){ee()}toRistrettoBytes(){ee()}fromRistrettoHash(){ee()}}T.BASE=new T(O.Gx,O.Gy,_,y(O.Gx*O.Gy));T.ZERO=new T(j,_,_,j);function Be(n){if(!(n instanceof T))throw new TypeError("ExtendedPoint expected")}function te(n){if(!(n instanceof G))throw new TypeError("RistrettoPoint expected")}function ee(){throw new Error("Legacy method: switch to RistrettoPoint")}class G{constructor(e){this.ep=e}static calcElligatorRistrettoMap(e){const{d:t}=O,i=y(Rt*e*e),s=y((i+_)*Dr);let r=BigInt(-1);const o=y((r-t*i)*y(i+t));let{isValid:c,value:l}=be(s,o),a=y(l*e);rt(a)||(a=y(-a)),c||(l=a),c||(r=i);const u=y(r*(i-_)*Mr-o),f=l*l,p=y((l+l)*o),b=y(u*Ir),d=y(_-f),m=y(_+f);return new T(y(p*m),y(d*b),y(b*m),y(p*d))}static hashToCurve(e){e=ot(e,64);const t=re(e.slice(0,32)),i=this.calcElligatorRistrettoMap(t),s=re(e.slice(32,64)),r=this.calcElligatorRistrettoMap(s);return new G(i.add(r))}static fromHex(e){e=ot(e,32);const{a:t,d:i}=O,s="RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint",r=re(e);if(!Gr(Tt(r),e)||rt(r))throw new Error(s);const o=y(r*r),c=y(_+t*o),l=y(_-t*o),a=y(c*c),u=y(l*l),f=y(t*i*a-u),{isValid:p,value:b}=Oe(y(f*u)),d=y(b*l),m=y(b*d*f);let g=y((r+r)*d);rt(g)&&(g=y(-g));const x=y(c*m),C=y(g*x);if(!p||rt(C)||x===j)throw new Error(s);return new G(new T(g,x,_,C))}toRawBytes(){let{x:e,y:t,z:i,t:s}=this.ep;const r=y(y(i+t)*y(i-t)),o=y(e*t),{value:c}=Oe(y(r*o**L)),l=y(c*r),a=y(c*o),u=y(l*a*s);let f;if(rt(s*u)){let b=y(t*Rt),d=y(e*Rt);e=b,t=d,f=y(l*Fr)}else f=a;rt(e*u)&&(t=y(-t));let p=y((i-t)*f);return rt(p)&&(p=y(-p)),Tt(p)}toHex(){return Bt(this.toRawBytes())}toString(){return this.toHex()}equals(e){te(e);const t=this.ep,i=e.ep,s=y(t.x*i.y)===y(t.y*i.x),r=y(t.y*i.y)===y(t.x*i.x);return s||r}add(e){return te(e),new G(this.ep.add(e.ep))}subtract(e){return te(e),new G(this.ep.subtract(e.ep))}multiply(e){return new G(this.ep.multiply(e))}multiplyUnsafe(e){return new G(this.ep.multiplyUnsafe(e))}}G.BASE=new G(T.BASE);G.ZERO=new G(T.ZERO);const he=new WeakMap;class k{constructor(e,t){this.x=e,this.y=t}_setWindowSize(e){this._WINDOW_SIZE=e,he.delete(this)}static fromHex(e,t=!0){const{d:i,P:s}=O;e=ot(e,32);const r=e.slice();r[31]=e[31]&-129;const o=wt(r);if(t&&o>=s)throw new Error("Expected 0 < hex < P");if(!t&&o>=er)throw new Error("Expected 0 < hex < 2**256");const c=y(o*o),l=y(c-_),a=y(i*c+_);let{isValid:u,value:f}=be(l,a);if(!u)throw new Error("Point.fromHex: invalid y coordinate");const p=(f&_)===_;return(e[31]&128)!==0!==p&&(f=y(-f)),new k(f,o)}static async fromPrivateKey(e){return(await qt(e)).point}toRawBytes(){const e=Tt(this.y);return e[31]|=this.x&_?128:0,e}toHex(){return Bt(this.toRawBytes())}toX25519(){const{y:e}=this,t=y((_+e)*Vt(_-e));return Tt(t)}isTorsionFree(){return T.fromAffine(this).isTorsionFree()}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new k(y(-this.x),this.y)}add(e){return T.fromAffine(this).add(T.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return T.fromAffine(this).multiply(e,this).toAffine()}}k.BASE=new k(O.Gx,O.Gy);k.ZERO=new k(j,_);class ve{constructor(e,t){this.r=e,this.s=t,this.assertValidity()}static fromHex(e){const t=ot(e,64),i=k.fromHex(t.slice(0,32),!1),s=wt(t.slice(32,64));return new ve(i,s)}assertValidity(){const{r:e,s:t}=this;if(!(e instanceof k))throw new Error("Expected Point instance");return Ht(t,O.l,!1),this}toRawBytes(){const e=new Uint8Array(64);return e.set(this.r.toRawBytes()),e.set(Tt(this.s),32),e}toHex(){return Bt(this.toRawBytes())}}function Lr(...n){if(!n.every(i=>i instanceof Uint8Array))throw new Error("Expected Uint8Array list");if(n.length===1)return n[0];const e=n.reduce((i,s)=>i+s.length,0),t=new Uint8Array(e);for(let i=0,s=0;i<n.length;i++){const r=n[i];t.set(r,s),s+=r.length}return t}const Hr=Array.from({length:256},(n,e)=>e.toString(16).padStart(2,"0"));function Bt(n){if(!(n instanceof Uint8Array))throw new Error("Uint8Array expected");let e="";for(let t=0;t<n.length;t++)e+=Hr[n[t]];return e}function rr(n){if(typeof n!="string")throw new TypeError("hexToBytes: expected string, got "+typeof n);if(n.length%2)throw new Error("hexToBytes: received invalid unpadded hex");const e=new Uint8Array(n.length/2);for(let t=0;t<e.length;t++){const i=t*2,s=n.slice(i,i+2),r=Number.parseInt(s,16);if(Number.isNaN(r)||r<0)throw new Error("Invalid byte sequence");e[t]=r}return e}function nr(n){const t=n.toString(16).padStart(64,"0");return rr(t)}function Tt(n){return nr(n).reverse()}function rt(n){return(y(n)&_)===_}function wt(n){if(!(n instanceof Uint8Array))throw new Error("Expected Uint8Array");return BigInt("0x"+Bt(Uint8Array.from(n).reverse()))}function re(n){return y(wt(n)&L**tr-_)}function y(n,e=O.P){const t=n%e;return t>=j?t:e+t}function Vt(n,e=O.P){if(n===j||e<=j)throw new Error(`invert: expected positive integers, got n=${n} mod=${e}`);let t=y(n,e),i=e,s=j,r=_;for(;t!==j;){const c=i/t,l=i%t,a=s-r*c;i=t,t=l,s=r,r=a}if(i!==_)throw new Error("invert: does not exist");return y(s,e)}function zr(n,e=O.P){const t=new Array(n.length),i=n.reduce((r,o,c)=>o===j?r:(t[c]=r,y(r*o,e)),_),s=Vt(i,e);return n.reduceRight((r,o,c)=>o===j?r:(t[c]=y(r*t[c],e),y(r*o,e)),s),t}function K(n,e){const{P:t}=O;let i=n;for(;e-- >j;)i*=i,i%=t;return i}function Wr(n){const{P:e}=O,t=BigInt(5),i=BigInt(10),s=BigInt(20),r=BigInt(40),o=BigInt(80),l=n*n%e*n%e,a=K(l,L)*l%e,u=K(a,_)*n%e,f=K(u,t)*u%e,p=K(f,i)*f%e,b=K(p,s)*p%e,d=K(b,r)*b%e,m=K(d,o)*d%e,g=K(m,o)*d%e,x=K(g,i)*f%e;return{pow_p_5_8:K(x,L)*n%e,b2:l}}function be(n,e){const t=y(e*e*e),i=y(t*t*e),s=Wr(n*i).pow_p_5_8;let r=y(n*t*s);const o=y(e*r*r),c=r,l=y(r*Rt),a=o===n,u=o===y(-n),f=o===y(-n*Rt);return a&&(r=c),(u||f)&&(r=l),rt(r)&&(r=y(-r)),{isValid:a||u,value:r}}function Oe(n){return be(_,n)}async function Ue(...n){const e=await Jt.sha512(Lr(...n)),t=wt(e);return y(t,O.l)}function Gr(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function ot(n,e){const t=n instanceof Uint8Array?Uint8Array.from(n):rr(n);if(typeof e=="number"&&t.length!==e)throw new Error(`Expected ${e} bytes`);return t}function Ht(n,e,t=!0){if(!e)throw new TypeError("Specify max value");if(typeof n=="number"&&Number.isSafeInteger(n)&&(n=BigInt(n)),typeof n=="bigint"&&n<e){if(t){if(j<n)return n}else if(j<=n)return n}throw new TypeError("Expected valid scalar: 0 < scalar < max")}function Vr(n){return n[0]&=248,n[31]&=127,n[31]|=64,n}async function qt(n){if(n=typeof n=="bigint"||typeof n=="number"?nr(Ht(n,er)):ot(n),n.length!==32)throw new Error("Expected 32 bytes");const e=await Jt.sha512(n),t=Vr(e.slice(0,32)),i=e.slice(32,64),s=y(wt(t),O.l),r=k.BASE.multiply(s),o=r.toRawBytes();return{head:t,prefix:i,scalar:s,point:r,pointBytes:o}}async function qr(n){return(await qt(n)).pointBytes}async function Jr(n,e){n=ot(n);const{prefix:t,scalar:i,pointBytes:s}=await qt(e),r=await Ue(t,n),o=k.BASE.multiply(r),c=await Ue(o.toRawBytes(),s,n),l=y(r+c*i,O.l);return new ve(o,l).toRawBytes()}k.BASE._setWindowSize(8);const Q={node:Nr,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0},Jt={TORSION_SUBGROUP:["0100000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a","0000000000000000000000000000000000000000000000000000000000000080","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05","ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85","0000000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa"],bytesToHex:Bt,getExtendedPublicKey:qt,mod:y,invert:Vt,hashToPrivateScalar:n=>{if(n=ot(n),n.length<40||n.length>1024)throw new Error("Expected 40-1024 bytes of private key as per FIPS 186");const e=y(wt(n),O.l);if(e===j||e===_)throw new Error("Invalid private key");return e},randomBytes:(n=32)=>{if(Q.web)return Q.web.getRandomValues(new Uint8Array(n));if(Q.node){const{randomBytes:e}=Q.node;return new Uint8Array(e(n).buffer)}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>Jt.randomBytes(32),sha512:async n=>{if(Q.web){const e=await Q.web.subtle.digest("SHA-512",n.buffer);return new Uint8Array(e)}else{if(Q.node)return Uint8Array.from(Q.node.createHash("sha512").update(n).digest());throw new Error("The environment doesn't have sha512 function")}},precompute(n=8,e=k.BASE){const t=e.equals(k.BASE)?e:new k(e.x,e.y);return t._setWindowSize(n),t.multiply(L),t}};var Kr=function(n,e){e||(e={}),typeof e=="function"&&(e={cmp:e});var t=typeof e.cycles=="boolean"?e.cycles:!1,i=e.cmp&&function(r){return function(o){return function(c,l){var a={key:c,value:o[c]},u={key:l,value:o[l]};return r(a,u)}}}(e.cmp),s=[];return function r(o){if(o&&o.toJSON&&typeof o.toJSON=="function"&&(o=o.toJSON()),o!==void 0){if(typeof o=="number")return isFinite(o)?""+o:"null";if(typeof o!="object")return JSON.stringify(o);var c,l;if(Array.isArray(o)){for(l="[",c=0;c<o.length;c++)c&&(l+=","),l+=r(o[c])||"null";return l+"]"}if(o===null)return"null";if(s.indexOf(o)!==-1){if(t)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var a=s.push(o)-1,u=Object.keys(o).sort(i&&i(o));for(l="",c=0;c<u.length;c++){var f=u[c],p=r(o[f]);p&&(l&&(l+=","),l+=JSON.stringify(f)+":"+p)}return s.splice(a,1),"{"+l+"}"}}(n)};const $r=Ge(Kr);var vt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",_t=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var Ut=0;Ut<vt.length;Ut++)_t[vt.charCodeAt(Ut)]=Ut;var ir=function(n){var e=new Uint8Array(n),t,i=e.length,s="";for(t=0;t<i;t+=3)s+=vt[e[t]>>2],s+=vt[(e[t]&3)<<4|e[t+1]>>4],s+=vt[(e[t+1]&15)<<2|e[t+2]>>6],s+=vt[e[t+2]&63];return i%3===2?s=s.substring(0,s.length-1)+"=":i%3===1&&(s=s.substring(0,s.length-2)+"=="),s},sr=function(n){var e=n.length*.75,t=n.length,i,s=0,r,o,c,l;n[n.length-1]==="="&&(e--,n[n.length-2]==="="&&e--);var a=new ArrayBuffer(e),u=new Uint8Array(a);for(i=0;i<t;i+=4)r=_t[n.charCodeAt(i)],o=_t[n.charCodeAt(i+1)],c=_t[n.charCodeAt(i+2)],l=_t[n.charCodeAt(i+3)],u[s++]=r<<2|o>>4,u[s++]=(o&15)<<4|c>>2,u[s++]=(c&3)<<6|l&63;return a};/*! noble-hashes - MIT License (c) 2021 Paul Miller (paulmillr.com) */const ne=n=>new DataView(n.buffer,n.byteOffset,n.byteLength),Zr=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Zr)throw new Error("Non little-endian hardware is not supported");Array.from({length:256},(n,e)=>e.toString(16).padStart(2,"0"));(()=>{const n=typeof module<"u"&&typeof module.require=="function"&&module.require.bind(module);try{if(n){const{setImmediate:e}=n("timers");return()=>new Promise(t=>e(t))}}catch{}return()=>new Promise(e=>setTimeout(e,0))})();function Yr(n){if(typeof n!="string")throw new TypeError(`utf8ToBytes expected string, got ${typeof n}`);return new TextEncoder().encode(n)}function ar(n){if(typeof n=="string"&&(n=Yr(n)),!(n instanceof Uint8Array))throw new TypeError(`Expected input type is Uint8Array (got ${typeof n})`);return n}class Xr{clone(){return this._cloneInto()}}function ge(n){const e=i=>n().update(ar(i)).digest(),t=n();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>n(),e.init=e.create,e}function Qr(n,e,t,i){if(typeof n.setBigUint64=="function")return n.setBigUint64(e,t,i);const s=BigInt(32),r=BigInt(4294967295),o=Number(t>>s&r),c=Number(t&r),l=i?4:0,a=i?0:4;n.setUint32(e+l,o,i),n.setUint32(e+a,c,i)}class tn extends Xr{constructor(e,t,i,s){super(),this.blockLen=e,this.outputLen=t,this.padOffset=i,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=ne(this.buffer)}update(e){if(this.destroyed)throw new Error("instance is destroyed");const{view:t,buffer:i,blockLen:s,finished:r}=this;if(r)throw new Error("digest() was already called");e=ar(e);const o=e.length;for(let c=0;c<o;){const l=Math.min(s-this.pos,o-c);if(l===s){const a=ne(e);for(;s<=o-c;c+=s)this.process(a,c);continue}i.set(e.subarray(c,c+l),this.pos),this.pos+=l,c+=l,this.pos===s&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){if(this.destroyed)throw new Error("instance is destroyed");if(!(e instanceof Uint8Array)||e.length<this.outputLen)throw new Error("_Sha2: Invalid output buffer");if(this.finished)throw new Error("digest() was already called");this.finished=!0;const{buffer:t,view:i,blockLen:s,isLE:r}=this;let{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>s-o&&(this.process(i,0),o=0);for(let l=o;l<s;l++)t[l]=0;Qr(i,s-8,BigInt(this.length*8),r),this.process(i,0);const c=ne(e);this.get().forEach((l,a)=>c.setUint32(4*a,l,r))}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const i=e.slice(0,t);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:i,length:s,finished:r,destroyed:o,pos:c}=this;return e.length=s,e.pos=c,e.finished=r,e.destroyed=o,s%t&&e.buffer.set(i),e}}const Pt=BigInt(2**32-1),Pe=BigInt(32);function en(n,e=!1){return e?{h:Number(n&Pt),l:Number(n>>Pe&Pt)}:{h:Number(n>>Pe&Pt)|0,l:Number(n&Pt)|0}}function rn(n,e=!1){let t=new Uint32Array(n.length),i=new Uint32Array(n.length);for(let s=0;s<n.length;s++){const{h:r,l:o}=en(n[s],e);[t[s],i[s]]=[r,o]}return[t,i]}const ke=(n,e,t)=>n>>>t,je=(n,e,t)=>n<<32-t|e>>>t,ft=(n,e,t)=>n>>>t|e<<32-t,ht=(n,e,t)=>n<<32-t|e>>>t,kt=(n,e,t)=>n<<64-t|e>>>t-32,jt=(n,e,t)=>n>>>t-32|e<<64-t;function Z(n,e,t,i){const s=(e>>>0)+(i>>>0);return{h:n+t+(s/2**32|0)|0,l:s|0}}const nn=(n,e,t)=>(n>>>0)+(e>>>0)+(t>>>0),sn=(n,e,t,i)=>e+t+i+(n/2**32|0)|0,an=(n,e,t,i)=>(n>>>0)+(e>>>0)+(t>>>0)+(i>>>0),on=(n,e,t,i,s)=>e+t+i+s+(n/2**32|0)|0,cn=(n,e,t,i,s)=>(n>>>0)+(e>>>0)+(t>>>0)+(i>>>0)+(s>>>0),un=(n,e,t,i,s,r)=>e+t+i+s+r+(n/2**32|0)|0,[ln,fn]=rn(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(n=>BigInt(n))),tt=new Uint32Array(80),et=new Uint32Array(80);class we extends tn{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:t,Bh:i,Bl:s,Ch:r,Cl:o,Dh:c,Dl:l,Eh:a,El:u,Fh:f,Fl:p,Gh:b,Gl:d,Hh:m,Hl:g}=this;return[e,t,i,s,r,o,c,l,a,u,f,p,b,d,m,g]}set(e,t,i,s,r,o,c,l,a,u,f,p,b,d,m,g){this.Ah=e|0,this.Al=t|0,this.Bh=i|0,this.Bl=s|0,this.Ch=r|0,this.Cl=o|0,this.Dh=c|0,this.Dl=l|0,this.Eh=a|0,this.El=u|0,this.Fh=f|0,this.Fl=p|0,this.Gh=b|0,this.Gl=d|0,this.Hh=m|0,this.Hl=g|0}process(e,t){for(let S=0;S<16;S++,t+=4)tt[S]=e.getUint32(t),et[S]=e.getUint32(t+=4);for(let S=16;S<80;S++){const R=tt[S-15]|0,P=et[S-15]|0,$=ft(R,P,1)^ft(R,P,8)^ke(R,P,7),St=ht(R,P,1)^ht(R,P,8)^je(R,P,7),N=tt[S-2]|0,V=et[S-2]|0,ct=ft(N,V,19)^kt(N,V,61)^ke(N,V,6),H=ht(N,V,19)^jt(N,V,61)^je(N,V,6),ut=an(St,H,et[S-7],et[S-16]),it=on(ut,$,ct,tt[S-7],tt[S-16]);tt[S]=it|0,et[S]=ut|0}let{Ah:i,Al:s,Bh:r,Bl:o,Ch:c,Cl:l,Dh:a,Dl:u,Eh:f,El:p,Fh:b,Fl:d,Gh:m,Gl:g,Hh:x,Hl:C}=this;for(let S=0;S<80;S++){const R=ft(f,p,14)^ft(f,p,18)^kt(f,p,41),P=ht(f,p,14)^ht(f,p,18)^jt(f,p,41),$=f&b^~f&m,St=p&d^~p&g,N=cn(C,P,St,fn[S],et[S]),V=un(N,x,R,$,ln[S],tt[S]),ct=N|0,H=ft(i,s,28)^kt(i,s,34)^kt(i,s,39),ut=ht(i,s,28)^jt(i,s,34)^jt(i,s,39),it=i&r^i&c^r&c,h=s&o^s&l^o&l;x=m|0,C=g|0,m=b|0,g=d|0,b=f|0,d=p|0,{h:f,l:p}=Z(a|0,u|0,V|0,ct|0),a=c|0,u=l|0,c=r|0,l=o|0,r=i|0,o=s|0;const v=nn(ct,ut,h);i=sn(v,V,H,it),s=v|0}({h:i,l:s}=Z(this.Ah|0,this.Al|0,i|0,s|0)),{h:r,l:o}=Z(this.Bh|0,this.Bl|0,r|0,o|0),{h:c,l}=Z(this.Ch|0,this.Cl|0,c|0,l|0),{h:a,l:u}=Z(this.Dh|0,this.Dl|0,a|0,u|0),{h:f,l:p}=Z(this.Eh|0,this.El|0,f|0,p|0),{h:b,l:d}=Z(this.Fh|0,this.Fl|0,b|0,d|0),{h:m,l:g}=Z(this.Gh|0,this.Gl|0,m|0,g|0),{h:x,l:C}=Z(this.Hh|0,this.Hl|0,x|0,C|0),this.set(i,s,r,o,c,l,a,u,f,p,b,d,m,g,x,C)}roundClean(){tt.fill(0),et.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class hn extends we{constructor(){super(),this.Ah=573645204,this.Al=-64227540,this.Bh=-1621794909,this.Bl=-934517566,this.Ch=596883563,this.Cl=1867755857,this.Dh=-1774684391,this.Dl=1497426621,this.Eh=-1775747358,this.El=-1467023389,this.Fh=-1101128155,this.Fl=1401305490,this.Gh=721525244,this.Gl=746961066,this.Hh=246885852,this.Hl=-2117784414,this.outputLen=32}}class dn extends we{constructor(){super(),this.Ah=-876896931,this.Al=-1056596264,this.Bh=1654270250,this.Bl=914150663,this.Ch=-1856437926,this.Cl=812702999,this.Dh=355462360,this.Dl=-150054599,this.Eh=1731405415,this.El=-4191439,this.Fh=-1900787065,this.Fl=1750603025,this.Gh=-619958771,this.Gl=1694076839,this.Hh=1203062813,this.Hl=-1090891868,this.outputLen=48}}const pn=ge(()=>new we);ge(()=>new hn);ge(()=>new dn);var st=globalThis&&globalThis.__assign||function(){return st=Object.assign||function(n){for(var e,t=1,i=arguments.length;t<i;t++){e=arguments[t];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(n[s]=e[s])}return n},st.apply(this,arguments)},zt=globalThis&&globalThis.__awaiter||function(n,e,t,i){function s(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function c(u){try{a(i.next(u))}catch(f){o(f)}}function l(u){try{a(i.throw(u))}catch(f){o(f)}}function a(u){u.done?r(u.value):s(u.value).then(c,l)}a((i=i.apply(n,e||[])).next())})},Wt=globalThis&&globalThis.__generator||function(n,e){var t={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},i,s,r,o;return o={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function c(a){return function(u){return l([a,u])}}function l(a){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(t=0)),t;)try{if(i=1,s&&(r=a[0]&2?s.return:a[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,a[1])).done)return r;switch(s=0,r&&(a=[a[0]&2,r.value]),a[0]){case 0:case 1:r=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,s=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(r=t.trys,!(r=r.length>0&&r[r.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!r||a[1]>r[0]&&a[1]<r[3])){t.label=a[1];break}if(a[0]===6&&t.label<r[1]){t.label=r[1],r=a;break}if(r&&t.label<r[2]){t.label=r[2],t.ops.push(a);break}r[2]&&t.ops.pop(),t.trys.pop();continue}a=e.call(n,t)}catch(u){a=[6,u],s=0}finally{i=r=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},Kt=globalThis&&globalThis.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},q=globalThis&&globalThis.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var i=t.call(n),s,r=[],o;try{for(;(e===void 0||e-- >0)&&!(s=i.next()).done;)r.push(s.value)}catch(c){o={error:c}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return r},Et=globalThis&&globalThis.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var i=0,s=e.length,r;i<s;i++)(r||!(i in e))&&(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return n.concat(r||Array.prototype.slice.call(e))};Jt.sha512=function(n){return Promise.resolve(pn(n))};function Se(){return Math.round(new Date().getTime())}var ie=function(){function n(e,t){t===void 0&&(t={});var i,s,r;this._subject=X.removeQueryParamsFromURL(e),this._set=(i=t.set)!==null&&i!==void 0?i:new Map,this._push=(s=t.push)!==null&&s!==void 0?s:new Map,this._remove=(r=t.remove)!==null&&r!==void 0?r:new Set,this._destroy=t.destroy,this._previousCommit=t.previousCommit}return Object.defineProperty(n.prototype,"subject",{get:function(){return this._subject},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"set",{get:function(){return this._set},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"push",{get:function(){return this._push},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"remove",{get:function(){return this._remove},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"destroy",{get:function(){return this._destroy},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"previousCommit",{get:function(){return this._previousCommit},enumerable:!1,configurable:!0}),n.prototype.addSetAction=function(e,t){return this.removeRemoveAction(e),this._set.set(e,t),this},n.prototype.addPushAction=function(e){for(var t,i,s,r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];var c=(s=this._push.get(e))!==null&&s!==void 0?s:new Set;try{for(var l=Kt(r),a=l.next();!a.done;a=l.next()){var u=a.value;c.add(u)}}catch(f){t={error:f}}finally{try{a&&!a.done&&(i=l.return)&&i.call(l)}finally{if(t)throw t.error}}return this._push.set(e,c),this},n.prototype.addRemoveAction=function(e){return this._set.delete(e),this._push.delete(e),this._remove.add(e),this},n.prototype.removeRemoveAction=function(e){return this._remove.delete(e),this},n.prototype.setDestroy=function(e){return this._destroy=e,this},n.prototype.setPreviousCommit=function(e){return this._previousCommit=e,this},n.prototype.setSubject=function(e){return this._subject=e,this},n.prototype.sign=function(e,t){return zt(this,void 0,void 0,function(){var i;return Wt(this,function(s){switch(s.label){case 0:return[4,this.signAt(t,e,Se())];case 1:return i=s.sent(),[2,i]}})})},n.prototype.hasUnsavedChanges=function(){return this.set.size>0||this.push.size>0||this.destroy||this.remove.size>0},n.prototype.clone=function(){var e={set:this.set,push:this.push,remove:this.remove,destroy:this.destroy,previousCommit:this.previousCommit};return new n(this.subject,structuredClone(e))},n.prototype.toPlainObject=function(){return{subject:this.subject,set:Object.fromEntries(this.set.entries()),push:Object.fromEntries(Array.from(this.push.entries()).map(function(e){var t=q(e,2),i=t[0],s=t[1];return[i,Array.from(s)]})),remove:Array.from(this.remove),destroy:this.destroy,previousCommit:this.previousCommit}},n.prototype.signAt=function(e,t,i){return zt(this,void 0,void 0,function(){var s,r,o,c;return Wt(this,function(l){switch(l.label){case 0:if(e===void 0)throw new Error("No agent passed to sign commit");if(!this.hasUnsavedChanges())throw new Error("No changes to commit in ".concat(this.subject));return s=st(st({},this.clone().toPlainObject()),{createdAt:i,signer:e}),r=or(st({},s)),[4,cr(r,t)];case 1:return o=l.sent(),c=st(st({},s),{signature:o}),[2,c]}})})},n}();function Y(n,e,t){e in n&&e!==t&&(Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(n,e)),delete n[e])}function or(n){return n.remove&&Object.keys(n.remove).length===0&&delete n.remove,n.set&&Object.keys(n.set).length===0&&delete n.set,n.push&&Object.keys(n.push).length===0&&delete n.push,n.destroy===!1&&delete n.destroy,Y(n,"createdAt",w.properties.commit.createdAt),Y(n,"subject",w.properties.commit.subject),Y(n,"set",w.properties.commit.set),Y(n,"push",w.properties.commit.push),Y(n,"signer",w.properties.commit.signer),Y(n,"signature",w.properties.commit.signature),Y(n,"remove",w.properties.commit.remove),Y(n,"destroy",w.properties.commit.destroy),Y(n,"previousCommit",w.properties.commit.previousCommit),n[w.properties.isA]=[w.classes.commit],$r(n)}var cr=function(n,e){return zt(void 0,void 0,void 0,function(){var t,i,s,r,o,c;return Wt(this,function(l){switch(l.label){case 0:return t=sr(e),i=new Uint8Array(t),s=new TextEncoder,r=s.encode(n),[4,Jr(r,i)];case 1:return o=l.sent(),c=ir(o),[2,c]}})})},yn=function(n){return zt(void 0,void 0,void 0,function(){var e,t,i,s;return Wt(this,function(r){switch(r.label){case 0:return e=sr(n),t=new Uint8Array(e),[4,qr(t)];case 1:return i=r.sent(),s=ir(i),[2,s]}})})};function mn(n){var e={id:n.getSubject(),subject:n.get(w.properties.commit.subject),set:n.get(w.properties.commit.set),push:n.get(w.properties.commit.push),signer:n.get(w.properties.commit.signer),createdAt:n.get(w.properties.commit.createdAt),remove:n.get(w.properties.commit.remove),destroy:n.get(w.properties.commit.destroy),signature:n.get(w.properties.commit.signature)};return e}function ur(n){try{var e=JSON.parse(n);if(typeof e!="object")throw new Error("Commit is not an object");var t=e[w.properties.commit.subject],i=e[w.properties.commit.set],s=e[w.properties.commit.push],r=e[w.properties.commit.signer],o=e[w.properties.commit.createdAt],c=e[w.properties.commit.remove],l=e[w.properties.commit.destroy],a=e[w.properties.commit.signature],u=e["@id"],f=e[w.properties.commit.previousCommit];if(!a)throw new Error("Commit has no signature");return{subject:t,set:i,push:s,signer:r,createdAt:o,remove:c,destroy:l,signature:a,id:u,previousCommit:f}}catch(p){throw new Error("Could not parse commit: ".concat(p,", Commit: ").concat(n))}}function lr(n,e){var t=e.set,i=e.remove,s=e.push;return t&&bn(t,n),i&&gn(i,n),s&&wn(s,n),n}function vn(n,e){var t=ur(n),i=t.subject,s=t.id,r=t.destroy,o=t.signature,c=e.resources.get(i);if(!c)c=new bt(i);else if(c.appliedCommitSignatures.has(o))return;if(c=lr(c,t),s&&c.setUnsafe(U.commit.lastCommit,s),r){e.removeResource(i);return}else c.appliedCommitSignatures.add(o),e.addResources(c,{skipCommitCompare:!0})}function bn(n,e,t){var i,s,r=new gt,o=[],c=function(b,d){var m=d;if((d==null?void 0:d.constructor)==={}.constructor){var g=q(r.parseValue(d,b),2),x=g[0],C=g[1];m=x,o.push.apply(o,Et([],q(C),!1))}xe(d)&&(m=d.map(function(S){var R=q(r.parseValue(S,b),2),P=R[0],$=R[1];return o.push.apply(o,Et([],q($),!1)),P})),e.setUnsafe(b,m)};try{for(var l=Kt(Object.entries(n)),a=l.next();!a.done;a=l.next()){var u=q(a.value,2),f=u[0],p=u[1];c(f,p)}}catch(b){i={error:b}}finally{try{a&&!a.done&&(s=l.return)&&s.call(l)}finally{if(i)throw i.error}}t&&t.addResources(o)}function gn(n,e){var t,i;try{for(var s=Kt(n),r=s.next();!r.done;r=s.next()){var o=r.value;e.removePropValLocally(o)}}catch(c){t={error:c}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(t)throw t.error}}}function wn(n,e,t){var i,s,r=new gt,o=[],c=function(b,d){var m=e.get(b)||[],g=d,x=g.map(function(S){var R=q(r.parseValue(S,b),2),P=R[0],$=R[1];return o.push.apply(o,Et([],q($),!1)),P}),C=Et(Et([],q(m),!1),q(x),!1);e.setUnsafe(b,C)};try{for(var l=Kt(Object.entries(n)),a=l.next();!a.done;a=l.next()){var u=q(a.value,2),f=u[0],p=u[1];c(f,p)}}catch(b){i={error:b}}finally{try{a&&!a.done&&(s=l.return)&&s.call(l)}finally{if(i)throw i.error}}t&&t.addResources(o)}var Sn=globalThis&&globalThis.__extends||function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(i[r]=s[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),J;(function(n){n.Unauthorized="Unauthorized",n.NotFound="NotFound",n.Server="Server",n.Client="Client"})(J||(J={}));function xn(n){if(n instanceof W){if(n.type===J.Unauthorized)return!0;if(n.message.includes("Unauthorized"))return!0}return!1}var W=function(n){Sn(e,n);function e(t,i){i===void 0&&(i=J.Client);var s=n.call(this,t)||this;Object.setPrototypeOf(s,e.prototype),s.type=i,s.message=t;try{var r=JSON.parse(t),o=r[U.description];o&&(s.message=o)}catch{}return s.message||(s.message=s.createMessage()),s}return e.fromResource=function(t){var i=new e(t.get(U.description).toString());return i},e.prototype.createMessage=function(){switch(this.type){case J.Unauthorized:return"You don't have the rights to do this.";case J.NotFound:return"404 Not found.";case J.Server:return"500 Unknown server error.";default:return"Unknown error."}},e}(Error);globalThis&&globalThis.__awaiter;globalThis&&globalThis.__generator;globalThis&&globalThis.__values;globalThis&&globalThis.__read;var z,E;(function(n){n.ATOMIC_URL="https://atomicdata.dev/datatypes/atomicURL",n.BOOLEAN="https://atomicdata.dev/datatypes/boolean",n.DATE="https://atomicdata.dev/datatypes/date",n.FLOAT="https://atomicdata.dev/datatypes/float",n.INTEGER="https://atomicdata.dev/datatypes/integer",n.MARKDOWN="https://atomicdata.dev/datatypes/markdown",n.RESOURCEARRAY="https://atomicdata.dev/datatypes/resourceArray",n.SLUG="https://atomicdata.dev/datatypes/slug",n.STRING="https://atomicdata.dev/datatypes/string",n.TIMESTAMP="https://atomicdata.dev/datatypes/timestamp",n.UNKNOWN="unknown-datatype"})(E||(E={}));var An=function(n){switch(n){case w.datatypes.atomicUrl:return E.ATOMIC_URL;case w.datatypes.boolean:return E.BOOLEAN;case w.datatypes.date:return E.DATE;case w.datatypes.float:return E.FLOAT;case w.datatypes.integer:return E.INTEGER;case w.datatypes.markdown:return E.MARKDOWN;case w.datatypes.resourceArray:return E.RESOURCEARRAY;case w.datatypes.slug:return E.SLUG;case w.datatypes.string:return E.STRING;case w.datatypes.timestamp:return E.TIMESTAMP;default:return E.UNKNOWN}},_n=/^[a-z0-9]+(?:-[a-z0-9]+)*$/,Rn=/^\d{4}-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01])$/,En=function(n,e){var t=null;if(n===void 0)throw new Error("Value is undefined, expected ".concat(e));switch(e){case E.STRING:{if(!Nt(n)){t="Not a string";break}break}case E.SLUG:{if(!Nt(n)){t="Not a slug, not even a string";break}n.match(_n)===null&&(t="Not a valid slug. Only lowercase letters and numbers with dashes `-` between them");break}case E.ATOMIC_URL:{if(!Nt(n)){t="Not a string. Should be a URL";break}X.tryValidSubject(n);break}case E.RESOURCEARRAY:{if(!xe(n)){t="Not an array";break}n.map(function(i,s){try{X.tryValidSubject(i)}catch{var r=new Error("Invalid URL");throw r.index=s,r}});break}case E.INTEGER:{if(!fr(n)){t="Not a number";break}n%1!==0&&(t="Not an integer");break}case E.DATE:{if(!Nt(n)){t="Not a string";break}n.match(Rn)===null&&(t="Not a date string: YYYY-MM-DD");break}}if(t!==null)throw new Error(t)};function xe(n){return Object.prototype.toString.call(n)==="[object Array]"}function Nt(n){return typeof n=="string"}function fr(n){return typeof n=="number"}z={},z[E.STRING]="String",z[E.SLUG]="Slug",z[E.MARKDOWN]="Markdown",z[E.INTEGER]="Integer",z[E.FLOAT]="Float",z[E.BOOLEAN]="Boolean",z[E.DATE]="Date",z[E.TIMESTAMP]="Timestamp",z[E.ATOMIC_URL]="Resource",z[E.RESOURCEARRAY]="ResourceArray",z[E.UNKNOWN]="Unknown";var It=globalThis&&globalThis.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var i=t.call(n),s,r=[],o;try{for(;(e===void 0||e-- >0)&&!(s=i.next()).done;)r.push(s.value)}catch(c){o={error:c}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return r},se=globalThis&&globalThis.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var i=0,s=e.length,r;i<s;i++)(r||!(i in e))&&(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return n.concat(r||Array.prototype.slice.call(e))},Ne=globalThis&&globalThis.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},gt=function(){function n(){this.parsedResources=[]}return n.prototype.parseObject=function(e,t){this.parsedResources=[];var i=this.parseJsonADResource(e,t);return[i,se([],It(this.parsedResources),!1)]},n.prototype.parseArray=function(e){this.parsedResources=[];var t=this.parseJsonADArray(e);return[t,se([],It(this.parsedResources),!1)]},n.prototype.parseValue=function(e,t){this.parsedResources=[];var i=this.parseJsonAdResourceValue(e,t);return[i,se([],It(this.parsedResources),!1)]},n.prototype.parseJsonADResource=function(e,t){var i,s,r=this;t===void 0&&(t=at);var o=new bt(t);this.parsedResources.push(o);try{var c=function(d,m){if(d==="@id"){if(typeof m!="string")throw new Error("'@id' field must be a string");if(o.getSubject()!=="undefined"&&o.getSubject()!==at&&m!==o.getSubject())throw new Error("Resource has wrong subject in @id. Received subject was ".concat(m,", expected ").concat(o.getSubject(),"."));return o.setSubject(m),"continue"}try{if(xe(m)){var g=m.map(function(R){return r.parseJsonAdResourceValue(R,d)});o.setUnsafe(d,g)}else if(typeof m=="string")o.setUnsafe(d,m);else if(typeof m=="number")o.setUnsafe(d,m);else if(typeof m=="boolean")o.setUnsafe(d,m);else{var x=l.parseJsonAdResourceValue(m,d);o.setUnsafe(d,x)}}catch(R){var C="Failed creating value ".concat(m," for key ").concat(d," in resource ").concat(o.getSubject()),S="".concat(C,". ").concat(R.message);throw new Error(S)}},l=this;try{for(var a=Ne(Object.entries(e)),u=a.next();!u.done;u=a.next()){var f=It(u.value,2),p=f[0],b=f[1];c(p,b)}}catch(d){i={error:d}}finally{try{u&&!u.done&&(s=a.return)&&s.call(a)}finally{if(i)throw i.error}}o.loading=!1,o.hasClasses(w.classes.error)&&(o.error=W.fromResource(o))}catch(d){throw d.message="Failed parsing JSON "+d.message,o.setError(d),o.loading=!1,d}return o},n.prototype.parseJsonAdResourceValue=function(e,t){if(typeof e=="string")return e;if((e==null?void 0:e.constructor)==={}.constructor)if(Object.keys(e).includes("@id")){var i=e["@id"];return this.parseJsonADResource(e),i}else return e;throw new Error("Value ".concat(e," in ").concat(t," not a string or a nested Resource"))},n.prototype.parseJsonADArray=function(e){var t,i,s=[];try{try{for(var r=Ne(e),o=r.next();!o.done;o=r.next()){var c=o.value,l=this.parseJsonADResource(c);s.push(l)}}catch(a){t={error:a}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(t)throw t.error}}}catch(a){throw a.message="Failed parsing JSON "+a.message,a}return s},n}();globalThis&&globalThis.__read;globalThis&&globalThis.__values;var dt=globalThis&&globalThis.__awaiter||function(n,e,t,i){function s(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function c(u){try{a(i.next(u))}catch(f){o(f)}}function l(u){try{a(i.throw(u))}catch(f){o(f)}}function a(u){u.done?r(u.value):s(u.value).then(c,l)}a((i=i.apply(n,e||[])).next())})},pt=globalThis&&globalThis.__generator||function(n,e){var t={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},i,s,r,o;return o={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function c(a){return function(u){return l([a,u])}}function l(a){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(t=0)),t;)try{if(i=1,s&&(r=a[0]&2?s.return:a[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,a[1])).done)return r;switch(s=0,r&&(a=[a[0]&2,r.value]),a[0]){case 0:case 1:r=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,s=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(r=t.trys,!(r=r.length>0&&r[r.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!r||a[1]>r[0]&&a[1]<r[3])){t.label=a[1];break}if(a[0]===6&&t.label<r[1]){t.label=r[1],r=a;break}if(r&&t.label<r[2]){t.label=r[2],t.ops.push(a);break}r[2]&&t.ops.pop(),t.trys.pop();continue}a=e.call(n,t)}catch(u){a=[6,u],s=0}finally{i=r=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},Ie=globalThis&&globalThis.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},yt=globalThis&&globalThis.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var i=t.call(n),s,r=[],o;try{for(;(e===void 0||e-- >0)&&!(s=i.next()).done;)r.push(s.value)}catch(c){o={error:c}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return r},mt=globalThis&&globalThis.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var i=0,s=e.length,r;i<s;i++)(r||!(i in e))&&(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return n.concat(r||Array.prototype.slice.call(e))},at="unknown-subject",bt=function(){function n(e,t){if(this.__internalObject=this,this.hasQueue=!1,typeof e!="string")throw new Error("Invalid subject given to resource, must be a string, found "+e);this.new=!!t,this.loading=!1,this.subject=e,this.propvals=new Map,this.appliedCommitSignatures=new Set,this.commitBuilder=new ie(e)}return Object.defineProperty(n.prototype,"title",{get:function(){var e,t,i;return(i=(t=(e=this.get(U.name))!==null&&e!==void 0?e:this.get(U.shortname))!==null&&t!==void 0?t:this.get(U.file.filename))!==null&&i!==void 0?i:this.subject},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"props",{get:function(){var e,t,i={};try{for(var s=Ie(this.propvals.keys()),r=s.next();!r.done;r=s.next()){var o=r.value,c=Sr(o);c&&(i[c]=this.get(o))}}catch(l){e={error:l}}finally{try{r&&!r.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}return i},enumerable:!1,configurable:!0}),n.prototype.equals=function(e){return this===e.__internalObject?!0:!(this.getSubject()!==e.getSubject()||this.new!==e.new||this.error!==e.error||this.loading!==e.loading||JSON.stringify(Array.from(this.propvals.entries()))!==JSON.stringify(Array.from(e.propvals.entries()))||JSON.stringify(Array.from(this.commitBuilder.set.entries()))!==JSON.stringify(Array.from(e.commitBuilder.set.entries())))},n.prototype.canWrite=function(e,t,i){return dt(this,void 0,void 0,function(){var s,r,o;return pt(this,function(c){switch(c.label){case 0:return s=this.get(U.write),t?s&&oe(s).includes(t)?[2,[!0,void 0]]:s&&oe(s).includes(mr.publicAgent)?[2,[!0,void 0]]:(r=this.get(U.parent),r?r===t?[2,[!0,void 0]]:i===r?(console.warn("Circular parent",i),[2,[!0,"Circular parent in ".concat(this.getSubject())]]):[4,e.getResourceAsync(r)]:[2,[!1,"No write right or parent in ".concat(this.getSubject())]]):[2,[!1,"No agent given"]];case 1:return o=c.sent(),[4,o.canWrite(e,t,this.getSubject())];case 2:return[2,c.sent()]}})})},n.prototype.clone=function(){var e=new n(this.subject);return e.propvals=structuredClone(this.propvals),e.loading=this.loading,e.new=this.new,e.error=structuredClone(this.error),e.commitError=this.commitError,e.commitBuilder=this.commitBuilder.clone(),e.appliedCommitSignatures=this.appliedCommitSignatures,e},n.prototype.isReady=function(){return!this.loading&&this.error===void 0},n.prototype.get=function(e){return this.propvals.get(e)},n.prototype.getSubjects=function(e){return this.getArray(e).map(function(t){return typeof t=="string"?t:t["@id"]})},n.prototype.getArray=function(e){var t,i=(t=this.propvals.get(e))!==null&&t!==void 0?t:[];return oe(i)},n.prototype.getClasses=function(){return this.getSubjects(U.isA)},n.prototype.hasClasses=function(){for(var e=this,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return t.every(function(s){return e.getClasses().includes(s)})},n.prototype.removeClasses=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];return this.set(U.isA,this.getClasses().filter(function(s){return!t.includes(s)}),e)},n.prototype.addClasses=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var s=new Set(mt(mt([],yt(this.getClasses()),!1),yt(t),!1));return this.set(U.isA,Array.from(s),e)},n.prototype.hasUnsavedChanges=function(){return this.commitBuilder.hasUnsavedChanges()},n.prototype.getCommitsCollection=function(){var e=new URL(this.subject);return e.pathname="/commits",e.searchParams.append("property",w.properties.commit.subject),e.searchParams.append("value",this.subject),e.searchParams.append("sort_by",w.properties.commit.createdAt),e.searchParams.append("include_nested","true"),e.searchParams.append("page_size","9999"),e.toString()},n.prototype.getChildrenCollection=function(){var e=new URL(this.subject);return e.pathname="/query",e.searchParams.set("property",U.parent),e.searchParams.set("value",this.subject),e.toString()},n.prototype.getHistory=function(e){return dt(this,void 0,void 0,function(){var t,i,s,r,o,c,l,a,u,f,p,b,d;return pt(this,function(m){switch(m.label){case 0:return[4,e.fetchResourceFromServer(this.getCommitsCollection())];case 1:t=m.sent(),i=t.get(U.collection.members),s=[],r=new n(this.subject),m.label=2;case 2:m.trys.push([2,7,8,9]),o=Ie(i),c=o.next(),m.label=3;case 3:return c.done?[3,6]:(l=c.value,[4,e.getResourceAsync(l)]);case 4:a=m.sent(),u=mn(a),f=lr(r.clone(),u),s.push({commit:u,resource:f.clone()}),r=f,m.label=5;case 5:return c=o.next(),[3,3];case 6:return[3,9];case 7:return p=m.sent(),b={error:p},[3,9];case 8:try{c&&!c.done&&(d=o.return)&&d.call(o)}finally{if(b)throw b.error}return[7];case 9:return[2,s]}})})},n.prototype.getSubject=function(){return this.subject},n.prototype.getSubjectNoParams=function(){var e=new URL(this.subject);return e.origin+e.pathname},n.prototype.getPropVals=function(){return this.propvals},n.prototype.getRights=function(e){return dt(this,void 0,void 0,function(){var t,i,s,r,o,c,l=this;return pt(this,function(a){switch(a.label){case 0:return t=[],i=this.getSubjects(U.write),i.forEach(function(u){t.push({for:u,type:Gt.WRITE,setIn:l.subject})}),s=this.getSubjects(U.read),s.forEach(function(u){t.push({for:u,type:Gt.READ,setIn:l.subject})}),r=this.get(U.parent),r?r===this.getSubject()?(console.warn("Circular parent",r),[2,t]):[4,e.getResourceAsync(r)]:[3,3];case 1:return o=a.sent(),[4,o.getRights(e)];case 2:c=a.sent(),t.push.apply(t,mt([],yt(c),!1)),a.label=3;case 3:return[2,t]}})})},n.prototype.isUnauthorized=function(){return!!this.error&&xn(this.error)},n.prototype.destroy=function(e,t){return dt(this,void 0,void 0,function(){var i,s,r;return pt(this,function(o){switch(o.label){case 0:if(this.new)return e.removeResource(this.getSubject()),[2];if(i=new ie(this.getSubject()),i.setDestroy(!0),t===void 0&&(t=e.getAgent()),(t==null?void 0:t.subject)===void 0)throw new Error("No agent has been set or passed, you cannot delete this.");return[4,i.sign(t.privateKey,t.subject)];case 1:return s=o.sent(),r=new URL(this.getSubject()).origin+"/commit",[4,e.postCommit(s,r)];case 2:return o.sent(),e.removeResource(this.getSubject()),[2]}})})},n.prototype.pushPropVal=function(e,t,i){var s,r=this,o,c=(o=this.get(e))!==null&&o!==void 0?o:[];i&&(t=t.filter(function(l){return!c.includes(l)}).filter(function(l){var a;return!(!((a=r.commitBuilder.push[e])===null||a===void 0)&&a.includes(l))}).filter(function(l,a,u){return u.indexOf(l)===a})),(s=this.commitBuilder).addPushAction.apply(s,mt([e],yt(t),!1)),this.propvals.set(e,mt(mt([],yt(c),!1),yt(t),!1))},n.prototype.removePropVal=function(e){this.propvals.delete(e),this.commitBuilder.addRemoveAction(e)},n.prototype.removePropValLocally=function(e){this.propvals.delete(e)},n.prototype.save=function(e,t){var i,s,r;return dt(this,void 0,void 0,function(){var o,c,l,a,u,f,p,b,d,m,g;return pt(this,function(x){switch(x.label){case 0:if(!this.commitBuilder.hasUnsavedChanges())return console.warn("No changes to ".concat(this.subject,", not saving")),[2,void 0];if(o=(i=e.getAgent())!==null&&i!==void 0?i:t,!o)throw new Error("No agent has been set or passed, you cannot save.");return this.hasQueue?[2]:this.isParentNew(e)?(e.batchResource(this.getSubject()),[2]):this.inProgressCommit?(this.hasQueue=!0,[4,this.inProgressCommit]):[3,2];case 1:return x.sent(),this.hasQueue=!1,this.inProgressCommit=void 0,[2,this.save(e,t)];case 2:return c=(s=this.get(U.commit.lastCommit))===null||s===void 0?void 0:s.toString(),c&&this.commitBuilder.setPreviousCommit(c),l=this.new,a=function(){},this.inProgressCommit=new Promise(function(C){a=function(){C()}}),u=this.commitBuilder.clone(),this.commitBuilder=new ie(this.getSubject()),[4,u.sign(o.privateKey,o.subject)];case 3:f=x.sent(),this.appliedCommitSignatures.add(f.signature),this.loading=!1,this.new=!1,p=new URL(this.getSubject()).origin+"/commit",x.label=4;case 4:return x.trys.push([4,8,,12]),this.commitError=void 0,e.addResources(this,{skipCommitCompare:!0}),[4,e.postCommit(f,p)];case 5:return b=x.sent(),this.setUnsafe(U.commit.lastCommit,b.id),e.notifyResourceSaved(this),l?(e.subscribeWebSocket(this.subject),[4,e.saveBatchForParent(this.getSubject())]):[3,7];case 6:x.sent(),x.label=7;case 7:return a(),[2,b.id];case 8:return d=x.sent(),d.message.includes("previousCommit")?(console.warn("previousCommit missing or mismatch, retrying..."),[4,e.fetchResourceFromServer(this.getSubject())]):[3,11];case 9:return m=x.sent(),g=(r=m.get(U.commit.lastCommit))===null||r===void 0?void 0:r.toString(),g&&this.setUnsafe(U.commit.lastCommit,g),a(),[4,this.save(e,o)];case 10:return[2,x.sent()];case 11:throw this.commitBuilder=u,this.commitError=d,e.addResources(this,{skipCommitCompare:!0}),a(),d;case 12:return[2]}})})},n.prototype.set=function(e,t,i,s){return s===void 0&&(s=!0),dt(this,void 0,void 0,function(){var r;return pt(this,function(o){switch(o.label){case 0:return i.isOffline()&&(console.warn("Offline, not validating"),s=!1),s?[4,i.getProperty(e)]:[3,2];case 1:r=o.sent(),En(t,r.datatype),o.label=2;case 2:return t===void 0?(this.removePropVal(e),[2]):(this.propvals.set(e,t),this.commitBuilder.addSetAction(e,t),[2])}})})},n.prototype.setUnsafe=function(e,t){this.propvals.set(e,t)},n.prototype.setError=function(e){this.error=e},n.prototype.setSubject=function(e){X.tryValidSubject(e),this.commitBuilder.setSubject(e),this.subject=e},n.prototype.equalsCurrentValue=function(e,t){var i=this.get(e);return t===Object(t)?JSON.stringify(i)===JSON.stringify(t):i===t},n.prototype.isParentNew=function(e){var t=this.propvals.get(pe.properties.parent);if(!t)return!1;var i=e.getResourceLoading(t);return i.new},n}(),Gt;(function(n){n.READ="read",n.WRITE="write"})(Gt||(Gt={}));var Fe=globalThis&&globalThis.__awaiter||function(n,e,t,i){function s(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function c(u){try{a(i.next(u))}catch(f){o(f)}}function l(u){try{a(i.throw(u))}catch(f){o(f)}}function a(u){u.done?r(u.value):s(u.value).then(c,l)}a((i=i.apply(n,e||[])).next())})},De=globalThis&&globalThis.__generator||function(n,e){var t={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},i,s,r,o;return o={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function c(a){return function(u){return l([a,u])}}function l(a){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(t=0)),t;)try{if(i=1,s&&(r=a[0]&2?s.return:a[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,a[1])).done)return r;switch(s=0,r&&(a=[a[0]&2,r.value]),a[0]){case 0:case 1:r=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,s=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(r=t.trys,!(r=r.length>0&&r[r.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!r||a[1]>r[0]&&a[1]<r[3])){t.label=a[1];break}if(a[0]===6&&t.label<r[1]){t.label=r[1],r=a;break}if(r&&t.label<r[2]){t.label=r[2],t.ops.push(a);break}r[2]&&t.ops.pop(),t.trys.pop();continue}a=e.call(n,t)}catch(u){a=[6,u],s=0}finally{i=r=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},Me=globalThis&&globalThis.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var i=t.call(n),s,r=[],o;try{for(;(e===void 0||e-- >0)&&!(s=i.next()).done;)r.push(s.value)}catch(c){o={error:c}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return r},Le=globalThis&&globalThis.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var i=0,s=e.length,r;i<s;i++)(r||!(i in e))&&(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return n.concat(r||Array.prototype.slice.call(e))},Tn=function(){function n(){this.subscriptions=new Map}return n.prototype.register=function(e,t){var i,s=(i=this.subscriptions.get(e))!==null&&i!==void 0?i:new Set;return s.add(t),this.subscriptions.set(e,s),function(){s.delete(t)}},n.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];return Fe(this,void 0,void 0,function(){var s,r,o=this;return De(this,function(c){switch(c.label){case 0:return this.subscriptions.has(e)?(s=this.subscriptions.get(e),r=function(l){return Fe(o,void 0,void 0,function(){return De(this,function(a){return[2,l.apply(void 0,Le([],Me(t),!1))]})})},s?[4,Promise.allSettled(Le([],Me(s),!1).map(function(l){return r(l)}))]:[2]):[2];case 1:return c.sent(),[2]}})})},n.prototype.hasSubscriptions=function(e){return this.subscriptions.has(e)},n}(),hr=globalThis&&globalThis.__awaiter||function(n,e,t,i){function s(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function c(u){try{a(i.next(u))}catch(f){o(f)}}function l(u){try{a(i.throw(u))}catch(f){o(f)}}function a(u){u.done?r(u.value):s(u.value).then(c,l)}a((i=i.apply(n,e||[])).next())})},dr=globalThis&&globalThis.__generator||function(n,e){var t={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},i,s,r,o;return o={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function c(a){return function(u){return l([a,u])}}function l(a){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(t=0)),t;)try{if(i=1,s&&(r=a[0]&2?s.return:a[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,a[1])).done)return r;switch(s=0,r&&(a=[a[0]&2,r.value]),a[0]){case 0:case 1:r=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,s=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(r=t.trys,!(r=r.length>0&&r[r.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!r||a[1]>r[0]&&a[1]<r[3])){t.label=a[1];break}if(a[0]===6&&t.label<r[1]){t.label=r[1],r=a;break}if(r&&t.label<r[2]){t.label=r[2],t.ops.push(a);break}r[2]&&t.ops.pop(),t.trys.pop();continue}a=e.call(n,t)}catch(u){a=[6,u],s=0}finally{i=r=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},Cn=globalThis&&globalThis.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Bn=globalThis&&globalThis.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var i=t.call(n),s,r=[],o;try{for(;(e===void 0||e-- >0)&&!(s=i.next()).done;)r.push(s.value)}catch(c){o={error:c}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return r};function He(n,e){var t=new URL(n);t.protocol==="http:"?t.protocol="ws":t.protocol="wss",t.pathname="/ws";var i=new WebSocket(t.toString());return i.onopen=function(s){return On(e,i)},i.onmessage=function(s){return Un(s,e)},i.onerror=Pn,i}function On(n,e){yr(e,n).then(function(){var t,i;try{for(var s=Cn(n.subscribers.keys()),r=s.next();!r.done;r=s.next()){var o=r.value;n.subscribeWebSocket(o)}}catch(c){t={error:c}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(t)throw t.error}}})}function Un(n,e){if(n.data.startsWith("COMMIT ")){var t=n.data.slice(7);vn(t,e)}else if(n.data.startsWith("ERROR "))e.notifyError(n.data.slice(6));else if(n.data.startsWith("RESOURCE ")){var i=pr(n);e.addResources(i)}else console.warn("Unknown websocket message:",n)}function Pn(n){console.error("websocket error:",n)}function pr(n){var e=n.data.slice(9),t=JSON.parse(e),i=new gt,s=Bn(i.parseObject(t),2);s[0];var r=s[1];return r}function yr(n,e){var t;return hr(this,void 0,void 0,function(){var i,s;return dr(this,function(r){switch(r.label){case 0:return i=e.getAgent(),!i||!i.subject?[2]:!n.url.startsWith("ws://localhost:")&&(!((t=i==null?void 0:i.subject)===null||t===void 0)&&t.startsWith("http://localhost"))?(console.warn("Can't authenticate localhost Agent over websocket with remote server, because the server will nog be able to retrieve your Agent and verify your public key."),[2]):[4,Ze(n.url,i)];case 1:return s=r.sent(),n.send("AUTHENTICATE "+JSON.stringify(s)),[2]}})})}var ze=5e3;function kn(n,e){return hr(this,void 0,void 0,function(){return dr(this,function(t){return[2,new Promise(function(i,s){n.addEventListener("message",function r(o){var c=setTimeout(function(){n.removeEventListener("message",r),s(new Error('Request for subject "'.concat(e,'" timed out after ').concat(ze,"ms.")))},ze);o.data.startsWith("RESOURCE ")&&pr(o).forEach(function(l){l.getSubject()===e&&(clearTimeout(c),n.removeEventListener("message",r),i(l))})}),n.send("GET "+e)})]})})}var F=globalThis&&globalThis.__awaiter||function(n,e,t,i){function s(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function c(u){try{a(i.next(u))}catch(f){o(f)}}function l(u){try{a(i.throw(u))}catch(f){o(f)}}function a(u){u.done?r(u.value):s(u.value).then(c,l)}a((i=i.apply(n,e||[])).next())})},D=globalThis&&globalThis.__generator||function(n,e){var t={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},i,s,r,o;return o={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function c(a){return function(u){return l([a,u])}}function l(a){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(t=0)),t;)try{if(i=1,s&&(r=a[0]&2?s.return:a[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,a[1])).done)return r;switch(s=0,r&&(a=[a[0]&2,r.value]),a[0]){case 0:case 1:r=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,s=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(r=t.trys,!(r=r.length>0&&r[r.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!r||a[1]>r[0]&&a[1]<r[3])){t.label=a[1];break}if(a[0]===6&&t.label<r[1]){t.label=r[1],r=a;break}if(r&&t.label<r[2]){t.label=r[2],t.ops.push(a);break}r[2]&&t.ops.pop(),t.trys.pop();continue}a=e.call(n,t)}catch(u){a=[6,u],s=0}finally{i=r=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},We=globalThis&&globalThis.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},jn=globalThis&&globalThis.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var i=t.call(n),s,r=[],o;try{for(;(e===void 0||e-- >0)&&!(s=i.next()).done;)r.push(s.value)}catch(c){o={error:c}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return r},nt;(function(n){n.ResourceSaved="resource-saved",n.ResourceRemoved="resource-removed",n.ResourceManuallyCreated="resource-manually-created",n.AgentChanged="agent-changed",n.Error="error"})(nt||(nt={}));var ae=function(){return typeof WebSocket<"u"},qn=function(){function n(e){e===void 0&&(e={}),this.batchedResources=new Map,this.eventManager=new Tn,this._resources=new Map,this.webSockets=new Map,this.subscribers=new Map,e.serverUrl&&this.setServerUrl(e.serverUrl),e.agent&&this.setAgent(e.agent),this.client=new X(this.injectedFetch),this.getAgent=this.getAgent.bind(this),this.setAgent=this.setAgent.bind(this)}return Object.defineProperty(n.prototype,"resources",{get:function(){return this._resources},enumerable:!1,configurable:!0}),n.prototype.injectFetch=function(e){this.injectedFetch=e,this.client.setFetch(e)},n.prototype.addResources=function(e,t){var i,s;try{for(var r=We(Array.isArray(e)?e:[e]),o=r.next();!o.done;o=r.next()){var c=o.value;this.addResource(c,t??{})}}catch(l){i={error:l}}finally{try{o&&!o.done&&(s=r.return)&&s.call(r)}finally{if(i)throw i.error}}},n.prototype.addResource=function(e,t){var i=t.skipCommitCompare;if(e.get(w.properties.incomplete)){var s=this.resources.get(e.getSubject());if(s&&!s.loading)return}if(!i){var r=this.resources.get(e.getSubject());if(r&&!r.hasClasses($e.classes.collection)&&!r.loading&&!r.new&&r.get(ue.properties.lastCommit)===e.get(ue.properties.lastCommit))return}this.resources.set(e.getSubject(),e.__internalObject),this.notify(e.__internalObject)},n.prototype.checkSubjectTaken=function(e){var t;return F(this,void 0,void 0,function(){var i,s,r;return D(this,function(o){switch(o.label){case 0:if(i=this.resources.get(e),i!=null&&i.isReady()&&!(i!=null&&i.new))return[2,!0];o.label=1;case 1:return o.trys.push([1,3,,4]),s=this.agent?{agent:this.agent,serverURL:this.getServerUrl()}:void 0,[4,this.client.fetchResourceHTTP(e,{method:"GET",signInfo:s})];case 2:return r=o.sent().createdResources,!((t=r.find(function(c){return c.getSubject()===e}))===null||t===void 0)&&t.isReady()?[2,!0]:[3,4];case 3:return o.sent(),[3,4];case 4:return[2,!1]}})})},n.prototype.buildUniqueSubjectFromParts=function(e,t){return F(this,void 0,void 0,function(){var i,s;return D(this,function(r){return i=e.join("/"),s=t??this.getServerUrl(),[2,this.findAvailableSubject(i,s)]})})},n.prototype.createSubject=function(e,t){var i=this.randomPart();return e=e||"things",t?"".concat(t,"/").concat(e,"/").concat(i):"".concat(this.getServerUrl(),"/").concat(e,"/").concat(i)},n.prototype.fetchResourceFromServer=function(e,t){return t===void 0&&(t={}),F(this,void 0,void 0,function(){var i,s,r,o;return D(this,function(c){switch(c.label){case 0:return t.setLoading&&(i=new bt(e),i.loading=!0,this.addResources(i)),s=this.getWebSocketForSubject(e),!t.fromProxy&&!t.noWebSocket&&ae()&&(s==null?void 0:s.readyState)===WebSocket.OPEN?[4,kn(s,e)]:[3,2];case 1:return c.sent(),[3,4];case 2:return r=this.agent?{agent:this.agent,serverURL:this.getServerUrl()}:void 0,[4,this.client.fetchResourceHTTP(e,{from:t.fromProxy?this.getServerUrl():void 0,method:t.method,body:t.body,signInfo:r})];case 3:o=c.sent().createdResources,this.addResources(o),c.label=4;case 4:return[2,this.resources.get(e)]}})})},n.prototype.getAllSubjects=function(){return Array.from(this.resources.keys())},n.prototype.getDefaultWebSocket=function(){return this.webSockets.get(this.getServerUrl())},n.prototype.getWebSocketForSubject=function(e){var t=new URL(e),i=this.webSockets.get(t.origin);if(i)return i;typeof window<"u"&&this.webSockets.set(t.origin,He(t.origin,this))},n.prototype.getServerUrl=function(){return this.serverUrl},n.prototype.getAgent=function(){var e;return(e=this.agent)!==null&&e!==void 0?e:void 0},n.prototype.getResourceLoading=function(e,t){if(e===void 0&&(e=at),t===void 0&&(t={}),e===at||e===null){var i=new bt(at,t.newResource);return i}var s=this.resources.get(e);if(s)!t.allowIncomplete&&s.loading===!1&&s.get(w.properties.incomplete)&&(s.loading=!0,this.addResources(s),this.fetchResourceFromServer(e,t));else return s=new bt(e,t.newResource),s.loading=!0,this.addResources(s),t.newResource||this.fetchResourceFromServer(e,t),s;return s},n.prototype.getResourceAsync=function(e){return F(this,void 0,void 0,function(){var t,i=this;return D(this,function(s){return t=this.resources.get(e),t&&t.isReady()?[2,t]:t&&!t.isReady()?[2,new Promise(function(r,o){var c=5e3,l=function(a){i.unsubscribe(e,l),r(a)};i.subscribe(e,l),setTimeout(function(){i.unsubscribe(e,l),o(new Error('Async Request for subject "'.concat(e,'" timed out after ').concat(c,"ms.")))},c)})]:[2,this.fetchResourceFromServer(e)]})})},n.prototype.getProperty=function(e){var t;return F(this,void 0,void 0,function(){var i,s,r,o,c,l;return D(this,function(a){switch(a.label){case 0:return[4,this.getResourceAsync(e)];case 1:if(i=a.sent(),i===void 0)throw Error("Property ".concat(e," is not found"));if(i.error)throw Error("Property ".concat(e," cannot be loaded: ").concat(i.error));if(s=i.get(w.properties.datatype),s===void 0)throw Error("Property ".concat(e," has no datatype: ").concat(i.getPropVals()));if(r=i.get(w.properties.shortname),r===void 0)throw Error("Property ".concat(e," has no shortname: ").concat(i.getPropVals()));if(o=i.get(w.properties.description),o===void 0)throw Error("Property ".concat(e," has no description: ").concat(i.getPropVals()));return c=(t=i.get(w.properties.classType))===null||t===void 0?void 0:t.toString(),l={subject:e,classType:c,shortname:r.toString(),description:o.toString(),datatype:An(s.toString())},[2,l]}})})},n.prototype.notifyError=function(e){var t=e instanceof Error?e:new Error(e);if(this.eventManager.hasSubscriptions(nt.Error))this.eventManager.emit(nt.Error,t);else throw t},n.prototype.isOffline=function(){var e;return Mt()?!(!((e=window==null?void 0:window.navigator)===null||e===void 0)&&e.onLine):!1},n.prototype.notifyResourceSaved=function(e){return F(this,void 0,void 0,function(){return D(this,function(t){switch(t.label){case 0:return[4,this.eventManager.emit(nt.ResourceSaved,e)];case 1:return t.sent(),[2]}})})},n.prototype.notifyResourceManuallyCreated=function(e){return F(this,void 0,void 0,function(){return D(this,function(t){switch(t.label){case 0:return[4,this.eventManager.emit(nt.ResourceManuallyCreated,e)];case 1:return t.sent(),[2]}})})},n.prototype.parseMetaTags=function(){var e=this,t=document.querySelectorAll('meta[property="json-ad-initial"]'),i=new gt;t.forEach(function(s){var r=s.getAttribute("content");if(r!==null){var o=JSON.parse(atob(r)),c=jn(i.parseObject(o),2);c[0];var l=c[1];e.addResources(l)}})},n.prototype.preloadPropsAndClasses=function(){return F(this,void 0,void 0,function(){var e,t;return D(this,function(i){switch(i.label){case 0:return e=new URL("/classes",this.serverUrl),t=new URL("/properties",this.serverUrl),e.searchParams.set("include_external","true"),t.searchParams.set("include_external","true"),e.searchParams.set("include_nested","true"),t.searchParams.set("include_nested","true"),e.searchParams.set("page_size","999"),t.searchParams.set("page_size","999"),[4,Promise.all([this.fetchResourceFromServer(e.toString()),this.fetchResourceFromServer(t.toString())])];case 1:return i.sent(),[2]}})})},n.prototype.postToServer=function(e,t){return F(this,void 0,void 0,function(){return D(this,function(i){return[2,this.fetchResourceFromServer(e,{body:t,noWebSocket:!0,method:"POST"})]})})},n.prototype.removeResource=function(e){var t=this.resources.get(e);t&&(this.resources.delete(e),this.eventManager.emit(nt.ResourceRemoved,t))},n.prototype.renameSubject=function(e,t){var i;return F(this,void 0,void 0,function(){var s,r;return D(this,function(o){switch(o.label){case 0:return X.tryValidSubject(t),s=e.getSubject(),[4,this.checkSubjectTaken(t)];case 1:if(o.sent())throw Error("New subject name is already taken: ".concat(t));return e.setSubject(t),r=(i=this.subscribers.get(s))!==null&&i!==void 0?i:[],this.subscribers.set(t,r),this.removeResource(s),this.addResources(e),[2]}})})},n.prototype.setAgent=function(e){var t=this;this.agent=e,e&&e.subject?(Mt()&&Qe(this.serverUrl,e),this.webSockets.forEach(function(i){i.readyState===i.OPEN&&yr(i,t)}),this.resources.forEach(function(i){(i.isUnauthorized()||i.loading)&&t.fetchResourceFromServer(i.getSubject())})):Mt()&&Br(),this.eventManager.emit(nt.AgentChanged,e)},n.prototype.setServerUrl=function(e){if(X.tryValidSubject(e),e.substring(-1)==="/")throw Error("baseUrl should not have a trailing slash");this.serverUrl=e,ae()&&this.openWebSocket(e)},n.prototype.openWebSocket=function(e){if(ae()){if(this.webSockets.has(e))return;this.webSockets.set(e,He(e,this))}else console.warn("WebSockets not supported, no window available")},n.prototype.subscribe=function(e,t){var i=this;if(e===void 0)throw Error("Cannot subscribe to undefined subject");var s=this.subscribers.get(e);return s===void 0&&(this.subscribeWebSocket(e),s=[]),s.push(t),this.subscribers.set(e,s),function(){i.unsubscribe(e,t)}},n.prototype.subscribeWebSocket=function(e){if(e!==at)try{var t=this.getWebSocketForSubject(e);(t==null?void 0:t.readyState)===1&&(t==null||t.send("SUBSCRIBE ".concat(e)))}catch(i){console.error(i)}},n.prototype.unSubscribeWebSocket=function(e){var t;if(e!==at)try{(t=this.getDefaultWebSocket())===null||t===void 0||t.send("UNSUBSCRIBE ".concat(e))}catch(i){console.error(i)}},n.prototype.unsubscribe=function(e,t){if(e!==void 0){var i=this.subscribers.get(e);i&&(i=i==null?void 0:i.filter(function(s){return s!==t}),this.subscribers.set(e,i))}},n.prototype.on=function(e,t){return this.eventManager.register(e,t)},n.prototype.uploadFiles=function(e,t){return F(this,void 0,void 0,function(){var i,s;return D(this,function(r){switch(r.label){case 0:if(i=this.getAgent(),!i)throw Error("No agent set, cannot upload files");return[4,this.client.uploadFiles(e,this.getServerUrl(),i,t)];case 1:return s=r.sent(),this.addResources(s),[2,s.map(function(o){return o.getSubject()})]}})})},n.prototype.postCommit=function(e,t){return F(this,void 0,void 0,function(){return D(this,function(i){return[2,this.client.postCommit(e,t)]})})},n.prototype.getResourceAncestry=function(e){return F(this,void 0,void 0,function(){var t,i,s;return D(this,function(r){switch(r.label){case 0:t=[e.getSubject()],i=e.get(w.properties.parent),i&&t.push(i),r.label=1;case 1:return i?[4,this.getResourceAsync(i)]:[3,3];case 2:if(s=r.sent(),s){if(i=s.get(w.properties.parent),t.includes(i))throw new Error("Resource ".concat(e.getSubject()," ancestry is cyclical. ").concat(i," is already in the ancestry}"));t.push(i)}return[3,1];case 3:return[2,t]}})})},n.prototype.clientSideQuery=function(e){return Array.from(this.resources.values()).filter(e)},n.prototype.batchResource=function(e){var t=this._resources.get(e);if(!t)throw new Error("Resource ".concat(e," can not be saved because it is not in the store."));var i=t.get(pe.properties.parent);if(i===void 0)throw new Error("Resource ".concat(e," can not be added to a batch because it's missing a parent."));this.batchedResources.has(i)?this.batchedResources.get(i).add(e):this.batchedResources.set(i,new Set([e]))},n.prototype.saveBatchForParent=function(e){return F(this,void 0,void 0,function(){var t,i,s,r,o,c,l,a;return D(this,function(u){switch(u.label){case 0:if(t=this.batchedResources.get(e),!t)return[2];u.label=1;case 1:u.trys.push([1,6,7,8]),i=We(t),s=i.next(),u.label=2;case 2:return s.done?[3,5]:(r=s.value,o=this._resources.get(r),[4,o==null?void 0:o.save(this)]);case 3:u.sent(),u.label=4;case 4:return s=i.next(),[3,2];case 5:return[3,8];case 6:return c=u.sent(),l={error:c},[3,8];case 7:try{s&&!s.done&&(a=i.return)&&a.call(i)}finally{if(l)throw l.error}return[7];case 8:return this.batchedResources.delete(e),[2]}})})},n.prototype.randomPart=function(){return Math.random().toString(36).substring(2)},n.prototype.findAvailableSubject=function(e,t,i){return i===void 0&&(i=!0),F(this,void 0,void 0,function(){var s,r,o;return D(this,function(c){switch(c.label){case 0:return s="".concat(t,"/").concat(e),i||(r=this.randomPart(),s+="-".concat(r)),[4,this.checkSubjectTaken(s)];case 1:return o=c.sent(),o?[2,this.findAvailableSubject(e,t,!1)]:[2,s]}})})},n.prototype.notify=function(e){return F(this,void 0,void 0,function(){var t,i,s=this;return D(this,function(r){return t=e.getSubject(),i=this.subscribers.get(t),i===void 0?[2]:(Promise.allSettled(i.map(function(o){return F(s,void 0,void 0,function(){return D(this,function(c){return[2,o(e)]})})})),[2])})})},n}();globalThis&&globalThis.__read;function oe(n){if(n===void 0)throw new Error("Not an array: ".concat(n,", is ").concat(typeof n));if(n.constructor===Array)return n;throw new Error("Not an array: ".concat(n,", is a ").concat(typeof n))}var Nn={agent:"https://atomicdata.dev/classes/Agent",chatRoom:"https://atomicdata.dev/classes/ChatRoom",collection:"https://atomicdata.dev/classes/Collection",commit:"https://atomicdata.dev/classes/Commit",class:"https://atomicdata.dev/classes/Class",document:"https://atomicdata.dev/classes/Document",bookmark:"https://atomicdata.dev/class/Bookmark",elements:{paragraph:"https://atomicdata.dev/classes/elements/Paragraph"},error:"https://atomicdata.dev/classes/Error",property:"https://atomicdata.dev/classes/Property",datatype:"https://atomicdata.dev/classes/Datatype",endpoint:"https://atomicdata.dev/classes/Endpoint",drive:"https://atomicdata.dev/classes/Drive",redirect:"https://atomicdata.dev/classes/Redirect",invite:"https://atomicdata.dev/classes/Invite",file:"https://atomicdata.dev/classes/File",message:"https://atomicdata.dev/classes/Message",importer:"https://atomicdata.dev/classes/Importer",folder:"https://atomicdata.dev/classes/Folder",article:"https://atomicdata.dev/classes/Article",displayStyle:"https://atomicdata.dev/class/DisplayStyle",displayStyles:{grid:"https://atomicdata.dev/display-style/grid",list:"https://atomicdata.dev/display-style/list"},dateFormat:"https://atomicdata.dev/classes/DateFormat",numberFormat:"https://atomicdata.dev/classes/NumberFormat",constraintProperties:{rangeProperty:"https://atomicdata.dev/classes/RangeProperty",floatRangeProperty:"https://atomicdata.dev/classes/FloatRangeProperty",formattedNumber:"https://atomicdata.dev/classes/FormattedNumber",selectProperty:"https://atomicdata.dev/classes/SelectProperty",formattedDate:"https://atomicdata.dev/classes/FormattedDate"},table:"https://atomicdata.dev/classes/Table",tag:"https://atomicdata.dev/classes/Tag",ontology:"https://atomicdata.dev/class/ontology"},U={allowsOnly:"https://atomicdata.dev/properties/allowsOnly",getAll:"https://atomicdata.dev/properties/?page_size=999",children:"https://atomicdata.dev/properties/children",classType:"https://atomicdata.dev/properties/classtype",createdBy:"https://atomicdata.dev/properties/createdBy",datatype:"https://atomicdata.dev/properties/datatype",description:"https://atomicdata.dev/properties/description",drives:"https://atomicdata.dev/properties/drives",incomplete:"https://atomicdata.dev/properties/incomplete",isA:"https://atomicdata.dev/properties/isA",isDynamic:"https://atomicdata.dev/properties/isDynamic",name:"https://atomicdata.dev/properties/name",parent:"https://atomicdata.dev/properties/parent",paymentPointer:"https://atomicdata.dev/properties/paymentPointer",read:"https://atomicdata.dev/properties/read",recommends:"https://atomicdata.dev/properties/recommends",requires:"https://atomicdata.dev/properties/requires",shortname:"https://atomicdata.dev/properties/shortname",subResources:"https://atomicdata.dev/properties/subresources",write:"https://atomicdata.dev/properties/write",displayStyle:"https://atomicdata.dev/property/display-style",publishedAt:"https://atomicdata.dev/properties/published-at",agent:{publicKey:"https://atomicdata.dev/properties/publicKey"},collection:{members:"https://atomicdata.dev/properties/collection/members",currentPage:"https://atomicdata.dev/properties/collection/currentPage",pageSize:"https://atomicdata.dev/properties/collection/pageSize",property:"https://atomicdata.dev/properties/collection/property",totalMembers:"https://atomicdata.dev/properties/collection/totalMembers",totalPages:"https://atomicdata.dev/properties/collection/totalPages",value:"https://atomicdata.dev/properties/collection/value"},commit:{subject:"https://atomicdata.dev/properties/subject",createdAt:"https://atomicdata.dev/properties/createdAt",lastCommit:"https://atomicdata.dev/properties/lastCommit",previousCommit:"https://atomicdata.dev/properties/previousCommit",signer:"https://atomicdata.dev/properties/signer",set:"https://atomicdata.dev/properties/set",push:"https://atomicdata.dev/properties/push",remove:"https://atomicdata.dev/properties/remove",destroy:"https://atomicdata.dev/properties/destroy",signature:"https://atomicdata.dev/properties/signature"},document:{elements:"https://atomicdata.dev/properties/documents/elements"},endpoint:{parameters:"https://atomicdata.dev/properties/endpoint/parameters",results:"https://atomicdata.dev/properties/endpoint/results"},search:{query:"https://atomicdata.dev/properties/search/query",limit:"https://atomicdata.dev/properties/search/limit",property:"https://atomicdata.dev/properties/search/property"},redirect:{destination:"https://atomicdata.dev/properties/destination",redirectAgent:"https://atomicdata.dev/properties/invite/redirectAgent"},invite:{agent:"https://atomicdata.dev/properties/invite/agent",publicKey:"https://atomicdata.dev/properties/invite/publicKey",target:"https://atomicdata.dev/properties/invite/target",usagesLeft:"https://atomicdata.dev/properties/invite/usagesLeft",users:"https://atomicdata.dev/properties/invite/users",write:"https://atomicdata.dev/properties/invite/write"},file:{filename:"https://atomicdata.dev/properties/filename",filesize:"https://atomicdata.dev/properties/filesize",downloadUrl:"https://atomicdata.dev/properties/downloadURL",mimetype:"https://atomicdata.dev/properties/mimetype",attachments:"https://atomicdata.dev/properties/attachments"},chatRoom:{messages:"https://atomicdata.dev/properties/messages",nextPage:"https://atomicdata.dev/properties/nextPage",replyTo:"https://atomicdata.dev/properties/replyTo"},bookmark:{url:"https://atomicdata.dev/property/url",preview:"https://atomicdata.dev/property/preview",imageUrl:"https://atomicdata.dev/properties/imageUrl"},constraints:{max:"https://atomicdata.dev/properties/max",min:"https://atomicdata.dev/properties/min",maxFloat:"https://atomicdata.dev/properties/maxFloat",minFloat:"https://atomicdata.dev/properties/minFloat",numberFormatting:"https://atomicdata.dev/properties/numberFormatting",decimalPlaces:"https://atomicdata.dev/properties/decimalPlaces",dateFormat:"https://atomicdata.dev/properties/dateFormat"},table:{tableColumnWidths:"https://atomicdata.dev/properties/tableColumnWidths"},ontology:{customNodePositioning:"https://atomicdata.dev/properties/custom-node-positioning"},color:"https://atomicdata.dev/properties/color",emoji:"https://atomicdata.dev/properties/emoji",classes:"https://atomicdata.dev/properties/classes",properties:"https://atomicdata.dev/properties/properties",instances:"https://atomicdata.dev/properties/instances"},In={atomicUrl:"https://atomicdata.dev/datatypes/atomicURL",boolean:"https://atomicdata.dev/datatypes/boolean",date:"https://atomicdata.dev/datatypes/date",float:"https://atomicdata.dev/datatypes/float",integer:"https://atomicdata.dev/datatypes/integer",markdown:"https://atomicdata.dev/datatypes/markdown",resourceArray:"https://atomicdata.dev/datatypes/resourceArray",slug:"https://atomicdata.dev/datatypes/slug",string:"https://atomicdata.dev/datatypes/string",timestamp:"https://atomicdata.dev/datatypes/timestamp"},mr={publicAgent:"https://atomicdata.dev/agents/publicAgent",displayStyleGrid:"https://atomicdata.dev/agents/publicAgent",numberFormats:{number:"https://atomicdata.dev/classes/NumberFormat/number",percentage:"https://atomicdata.dev/classes/NumberFormat/Percentage"},dateFormats:{localNumeric:"https://atomicdata.dev/classes/DateFormat/localNumeric",localLong:"https://atomicdata.dev/classes/DateFormat/localLong",localRelative:"https://atomicdata.dev/classes/DateFormat/localRelative"}},Fn={import:"/import"},w={properties:U,endpoints:Fn,classes:Nn,datatypes:In,instances:mr},Ft=globalThis&&globalThis.__awaiter||function(n,e,t,i){function s(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function c(u){try{a(i.next(u))}catch(f){o(f)}}function l(u){try{a(i.throw(u))}catch(f){o(f)}}function a(u){u.done?r(u.value):s(u.value).then(c,l)}a((i=i.apply(n,e||[])).next())})},At=globalThis&&globalThis.__generator||function(n,e){var t={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},i,s,r,o;return o={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function c(a){return function(u){return l([a,u])}}function l(a){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(t=0)),t;)try{if(i=1,s&&(r=a[0]&2?s.return:a[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,a[1])).done)return r;switch(s=0,r&&(a=[a[0]&2,r.value]),a[0]){case 0:case 1:r=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,s=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(r=t.trys,!(r=r.length>0&&r[r.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!r||a[1]>r[0]&&a[1]<r[3])){t.label=a[1];break}if(a[0]===6&&t.label<r[1]){t.label=r[1],r=a;break}if(r&&t.label<r[2]){t.label=r[2],t.ops.push(a);break}r[2]&&t.ops.pop(),t.trys.pop();continue}a=e.call(n,t)}catch(u){a=[6,u],s=0}finally{i=r=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},Ct=globalThis&&globalThis.__await||function(n){return this instanceof Ct?(this.v=n,this):new Ct(n)},Dn=globalThis&&globalThis.__asyncGenerator||function(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(n,e||[]),s,r=[];return s={},o("next"),o("throw"),o("return"),s[Symbol.asyncIterator]=function(){return this},s;function o(p){i[p]&&(s[p]=function(b){return new Promise(function(d,m){r.push([p,b,d,m])>1||c(p,b)})})}function c(p,b){try{l(i[p](b))}catch(d){f(r[0][3],d)}}function l(p){p.value instanceof Ct?Promise.resolve(p.value.v).then(a,u):f(r[0][2],p)}function a(p){c("next",p)}function u(p){c("throw",p)}function f(p,b){p(b),r.shift(),r.length&&c(r[0][0],r[0][1])}},Mn=globalThis&&globalThis.__asyncValues||function(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof de=="function"?de(n):n[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(r){t[r]=n[r]&&function(o){return new Promise(function(c,l){o=n[r](o),s(c,l,o.done,o.value)})}}function s(r,o,c,l){Promise.resolve(l).then(function(a){r({value:a,done:c})},o)}},de=globalThis&&globalThis.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Ln=globalThis&&globalThis.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var i=t.call(n),s,r=[],o;try{for(;(e===void 0||e-- >0)&&!(s=i.next()).done;)r.push(s.value)}catch(c){o={error:c}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return r};(function(){function n(e,t,i,s){s===void 0&&(s=!1),this.__internalObject=this,this.pages=new Map,this._totalMembers=0,this.store=e,this.server=t,this.params=i,s||(this._waitForReady=this.fetchPage(0)),this.clearPages=this.clearPages.bind(this)}return Object.defineProperty(n.prototype,"property",{get:function(){return this.params.property},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"value",{get:function(){return this.params.value},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"sortBy",{get:function(){return this.params.sort_by},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"sortDesc",{get:function(){return!!this.params.sort_desc},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"pageSize",{get:function(){return parseInt(this.params.page_size,10)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"totalMembers",{get:function(){return this._totalMembers},enumerable:!1,configurable:!0}),n.prototype.waitForReady=function(){return this._waitForReady},n.prototype.getMemberWithIndex=function(e){return Ft(this,void 0,void 0,function(){var t,i,s;return At(this,function(r){switch(r.label){case 0:if(e>=this.totalMembers)throw new Error("Index out of bounds");return t=Math.floor(e/this.pageSize),this.pages.has(t)?[3,2]:(this._waitForReady=this.fetchPage(t),[4,this._waitForReady]);case 1:r.sent(),r.label=2;case 2:return i=this.pages.get(t),s=i.getArray(w.properties.collection.members),[2,s[e%this.pageSize]]}})})},n.prototype.clearPages=function(){this.pages=new Map},n.prototype.refresh=function(){return Ft(this,void 0,void 0,function(){return At(this,function(e){return this.clearPages(),this._waitForReady=this.fetchPage(0),[2,this._waitForReady]})})},n.prototype.clone=function(){var e=new n(this.store,this.server,this.params);return e._totalMembers=this._totalMembers,e._waitForReady=this._waitForReady,e.pages=this.pages,e},n.prototype[Symbol.asyncIterator]=function(){return Dn(this,arguments,function(){var t;return At(this,function(i){switch(i.label){case 0:return[4,Ct(this.waitForReady())];case 1:i.sent(),t=0,i.label=2;case 2:return t<this.totalMembers?[4,Ct(this.getMemberWithIndex(t))]:[3,6];case 3:return[4,i.sent()];case 4:i.sent(),i.label=5;case 5:return t++,[3,2];case 6:return[2]}})})},n.prototype.getAllMembers=function(){var e,t,i,s;return Ft(this,void 0,void 0,function(){var r,o,c,l,a,u,f;return At(this,function(p){switch(p.label){case 0:r=this.params.page_size,this.params.page_size="1000",o=[],p.label=1;case 1:p.trys.push([1,6,7,12]),c=!0,l=Mn(this),p.label=2;case 2:return[4,l.next()];case 3:if(a=p.sent(),e=a.done,!!e)return[3,5];s=a.value,c=!1;try{u=s,o.push(u)}finally{c=!0}p.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return f=p.sent(),t={error:f},[3,12];case 7:return p.trys.push([7,,10,11]),!c&&!e&&(i=l.return)?[4,i.call(l)]:[3,9];case 8:p.sent(),p.label=9;case 9:return[3,11];case 10:if(t)throw t.error;return[7];case 11:return[7];case 12:return this.params.page_size=r,[2,o]}})})},n.prototype.buildSubject=function(e){var t,i,s=new URL("".concat(this.server,"/query"));try{for(var r=de(Object.entries(this.params)),o=r.next();!o.done;o=r.next()){var c=Ln(o.value,2),l=c[0],a=c[1];s.searchParams.set(l,a)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(t)throw t.error}}return s.searchParams.set("current_page","".concat(e)),s.toString()},n.prototype.fetchPage=function(e){return Ft(this,void 0,void 0,function(){var t,i,s;return At(this,function(r){switch(r.label){case 0:return t=this.buildSubject(e),[4,this.store.fetchResourceFromServer(t)];case 1:if(i=r.sent(),!i)throw new Error("Invalid collection: resource does not exist");if(i.error)throw new Error("Invalid collection: resource has error: ".concat(i.error));if(this.pages.set(e,i),s=i.get(w.properties.collection.totalMembers),!fr(s))throw new Error("Invalid collection: total-members is not a number");return this._totalMembers=s,[2]}})})},n})();globalThis&&globalThis.__awaiter;globalThis&&globalThis.__generator;_r();export{Vn as A,zn as P,qn as S,Wn as T,Gn as q,w as u,Ke as y};
