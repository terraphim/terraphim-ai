var us=Object.defineProperty;var cs=(l,e,t)=>e in l?us(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var wt=(l,e,t)=>(cs(l,typeof e!="symbol"?e+"":e,t),t);import{aa as Lt,S as _t,i as mt,s as it,q as f,Y as F,b as E,y as s,Z as _e,I as ye,j as A,ak as Re,F as at,m as qt,a as g,v as a,l as Z,E as Je,au as Ht,r as ae,z as ue,t as W,d as V,B as ce,av as fs,aw as Jt,H as Ve,U as xe,V as et,ax as El,ay as ds,g as Ke,e as Ge,O as Ye,af as Ze,o as ps,W as re,az as Ml,aA as Rt,aB as Bn,aC as qn,a1 as Ae,C as rt,aD as De,aE as Jn,D as nl,G as sl,aF as Qn,w as Pt,x as It,A as jl,a2 as _s,aG as dl,ac as ms,a7 as hs,a9 as gs,n as bs}from"./vendor-ui-cd3d2b6a.js";import{R as Nt,S as Ol}from"./vendor-utils-1b347ea1.js";import{J as Vn,_ as vs,E as ks,d as ws,o as co}from"./vendor-editor-992829d3.js";import{P as Yn,T as Nl,u as Zn,y as ys,A as $s,S as Ss,q as Cs}from"./vendor-atomic-1ea13e29.js";import{t as Ts,S as Rs,E as As}from"./novel-editor-c665f5c2.js";import{s as Il,z as Ls,a as Es,l as Ns,m as Os,c as Ps,b as Is,B as Us,d as Ds}from"./vendor-charts-e6a4a6c9.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const u of n)if(u.type==="childList")for(const r of u.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function t(n){const u={};return n.integrity&&(u.integrity=n.integrity),n.referrerPolicy&&(u.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?u.credentials="include":n.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function o(n){if(n.ep)return;n.ep=!0;const u=t(n);fetch(n.href,u)}})();const pt={ServerURL:location.protocol+"//"+window.location.host||"/"},fl=Lt([]),Ms={id:"Desktop",global_shortcut:"",roles:{},default_role:{original:"",lowercase:""},selected_role:{original:"",lowercase:""}},pl=Lt("spacelab"),At=Lt("selected"),je=Lt(!1),js=Lt(`${pt.ServerURL}/documents/search`),St=Lt(Ms),fo=Lt([]);let Al=Lt("");const $t=Lt(!1);let Bt=null;function Hs(l){if(typeof document>"u")return;const e=`/assets/bulmaswatch/${l}/bulmaswatch.min.css`;if(Bt!=null&&Bt.href.endsWith(e))return;const t=document.createElement("link");t.rel="stylesheet",t.href=e,t.id="bulma-theme",t.onload=()=>{Bt&&Bt!==t&&Bt.remove(),Bt=t},document.head.appendChild(t);const o=document.head.querySelector('meta[name="color-scheme"]');o&&o.setAttribute("content",l)}pl.subscribe(Hs);function zs(l){let e,t;return{c(){e=f("option"),t=F(l[1]),e.__value=l[0],e.value=e.__value},m(o,n){E(o,e,n),s(e,t)},p(o,[n]){n&2&&_e(t,o[1]),n&1&&(e.__value=o[0],e.value=e.__value)},i:ye,o:ye,d(o){o&&A(e)}}}function Fs(l,e,t){let o,{subject:n}=e;const u=Yn(n),r=Nl(u,Zn.properties.name);return Re(l,r,c=>t(1,o=c)),Nl(u,"http://localhost:9883/property/theme"),l.$$set=c=>{"subject"in c&&t(0,n=c.subject)},[n,o,r]}class Ks extends _t{constructor(e){super(),mt(this,e,Fs,zs,it,{subject:0})}}function po(l){let e,t,o,n,u,r,c=l[0]&&_o();return{c(){e=f("button"),t=f("span"),t.innerHTML='<i class="fas fa-arrow-left"></i>',o=g(),c&&c.c(),a(t,"class","icon svelte-rnsqpo"),a(e,"class",n="button is-light back-button "+l[1]+" svelte-rnsqpo"),a(e,"title","Go back"),a(e,"aria-label","Go back")},m(i,d){E(i,e,d),s(e,t),s(e,o),c&&c.m(e,null),u||(r=[Z(e,"click",l[3]),Z(e,"keydown",l[6])],u=!0)},p(i,d){i[0]?c||(c=_o(),c.c(),c.m(e,null)):c&&(c.d(1),c=null),d&2&&n!==(n="button is-light back-button "+i[1]+" svelte-rnsqpo")&&a(e,"class",n)},d(i){i&&A(e),c&&c.d(),u=!1,Je(r)}}}function _o(l){let e;return{c(){e=f("span"),e.textContent="Back",a(e,"class","back-text svelte-rnsqpo")},m(t,o){E(t,e,o)},d(t){t&&A(e)}}}function Gs(l){let e,t=l[2]&&po(l);return{c(){t&&t.c(),e=at()},m(o,n){t&&t.m(o,n),E(o,e,n)},p(o,[n]){o[2]?t?t.p(o,n):(t=po(o),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:ye,o:ye,d(o){t&&t.d(o),o&&A(e)}}}function Ws(l,e,t){let{fallbackPath:o="/"}=e,{showText:n=!0}=e,{customClass:u=""}=e,{hideOnPaths:r=["/"]}=e,c=!0;function i(){var _;try{const m=((_=window.location)==null?void 0:_.pathname)||"/";t(2,c=!r.includes(m))}catch{t(2,c=!0)}}function d(){window.history.length>1?window.history.back():window.location.href=o}qt(()=>(i(),window.addEventListener("popstate",i),window.addEventListener("hashchange",i),()=>{window.removeEventListener("popstate",i),window.removeEventListener("hashchange",i)}));const p=_=>{(_.key==="Enter"||_.key===" ")&&(_.preventDefault(),d())};return l.$$set=_=>{"fallbackPath"in _&&t(4,o=_.fallbackPath),"showText"in _&&t(0,n=_.showText),"customClass"in _&&t(1,u=_.customClass),"hideOnPaths"in _&&t(5,r=_.hideOnPaths)},[n,u,c,d,o,r,p]}class rl extends _t{constructor(e){super(),mt(this,e,Ws,Gs,it,{fallbackPath:4,showText:0,customClass:1,hideOnPaths:5})}}function Bs(){return window.crypto.getRandomValues(new Uint32Array(1))[0]}function Ul(l,e=!1){const t=Bs(),o=`_${t}`;return Object.defineProperty(window,o,{value:n=>(e&&Reflect.deleteProperty(window,o),l==null?void 0:l(n)),writable:!1,configurable:!0}),t}async function We(l,e={}){return new Promise((t,o)=>{const n=Ul(r=>{t(r),Reflect.deleteProperty(window,`_${u}`)},!0),u=Ul(r=>{o(r),Reflect.deleteProperty(window,`_${n}`)},!0);window.__TAURI_IPC__({cmd:l,callback:n,error:u,...e})})}function mo(l,e,t){const o=l.slice();return o[25]=e[t],o}function qs(l){let e,t,o;function n(r){l[13](r)}let u={};return l[5]!==void 0&&(u.value=l[5]),e=new Jt({props:u}),Ve.push(()=>xe(e,"value",n)),{c(){ae(e.$$.fragment)},m(r,c){ue(e,r,c),o=!0},p(r,c){const i={};!t&&c&32&&(t=!0,i.value=r[5],et(()=>t=!1)),e.$set(i)},i(r){o||(W(e.$$.fragment,r),o=!0)},o(r){V(e.$$.fragment,r),o=!1},d(r){ce(e,r)}}}function Js(l){let e,t,o;function n(r){l[14](r)}let u={type:"password",placeholder:"secret",icon:"fas fa-lock",expanded:!0};return l[6]!==void 0&&(u.value=l[6]),e=new Jt({props:u}),Ve.push(()=>xe(e,"value",n)),{c(){ae(e.$$.fragment)},m(r,c){ue(e,r,c),o=!0},p(r,c){const i={};!t&&c&64&&(t=!0,i.value=r[6],et(()=>t=!1)),e.$set(i)},i(r){o||(W(e.$$.fragment,r),o=!0)},o(r){V(e.$$.fragment,r),o=!1},d(r){ce(e,r)}}}function Qs(l){let e;return{c(){e=F("Save")},m(t,o){E(t,e,o)},d(t){t&&A(e)}}}function Vs(l){let e,t;return e=new El({props:{type:"is-success",class:"is-right",iconPack:"fa",iconLeft:"check",$$slots:{default:[Qs]},$$scope:{ctx:l}}}),e.$on("click",l[8]),e.$on("submit",l[8]),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},p(o,n){const u={};n&268435456&&(u.$$scope={dirty:n,ctx:o}),e.$set(u)},i(o){t||(W(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function Ys(l){let e,t,o,n,u,r;return e=new Ht({props:{$$slots:{default:[qs]},$$scope:{ctx:l}}}),o=new Ht({props:{grouped:!0,$$slots:{default:[Js]},$$scope:{ctx:l}}}),u=new Ht({props:{grouped:!0,$$slots:{default:[Vs]},$$scope:{ctx:l}}}),{c(){ae(e.$$.fragment),t=g(),ae(o.$$.fragment),n=g(),ae(u.$$.fragment)},m(c,i){ue(e,c,i),E(c,t,i),ue(o,c,i),E(c,n,i),ue(u,c,i),r=!0},p(c,i){const d={};i&268435488&&(d.$$scope={dirty:i,ctx:c}),e.$set(d);const p={};i&268435520&&(p.$$scope={dirty:i,ctx:c}),o.$set(p);const _={};i&268435456&&(_.$$scope={dirty:i,ctx:c}),u.$set(_)},i(c){r||(W(e.$$.fragment,c),W(o.$$.fragment,c),W(u.$$.fragment,c),r=!0)},o(c){V(e.$$.fragment,c),V(o.$$.fragment,c),V(u.$$.fragment,c),r=!1},d(c){ce(e,c),c&&A(t),ce(o,c),c&&A(n),ce(u,c)}}}function Zs(l){let e,t,o;function n(r){l[15](r)}let u={type:"search",placeholder:"Fetch JSON",icon:"search"};return l[3]!==void 0&&(u.value=l[3]),e=new Jt({props:u}),Ve.push(()=>xe(e,"value",n)),{c(){ae(e.$$.fragment)},m(r,c){ue(e,r,c),o=!0},p(r,c){const i={};!t&&c&8&&(t=!0,i.value=r[3],et(()=>t=!1)),e.$set(i)},i(r){o||(W(e.$$.fragment,r),o=!0)},o(r){V(e.$$.fragment,r),o=!1},d(r){ce(e,r)}}}function Xs(l){let e;return{c(){e=F("WikiPage")},m(t,o){E(t,e,o)},d(t){t&&A(e)}}}function xs(l){let e,t,o,n,u,r;function c(_){l[16](_)}let i={type:"search",placeholder:"Post JSON",icon:"search"};l[4]!==void 0&&(i.value=l[4]),e=new Jt({props:i}),Ve.push(()=>xe(e,"value",c));function d(_){l[17](_)}let p={$$slots:{default:[Xs]},$$scope:{ctx:l}};return l[2]!==void 0&&(p.checked=l[2]),n=new ds({props:p}),Ve.push(()=>xe(n,"checked",d)),{c(){ae(e.$$.fragment),o=g(),ae(n.$$.fragment)},m(_,m){ue(e,_,m),E(_,o,m),ue(n,_,m),r=!0},p(_,m){const y={};!t&&m&16&&(t=!0,y.value=_[4],et(()=>t=!1)),e.$set(y);const h={};m&268435456&&(h.$$scope={dirty:m,ctx:_}),!u&&m&4&&(u=!0,h.checked=_[2],et(()=>u=!1)),n.$set(h)},i(_){r||(W(e.$$.fragment,_),W(n.$$.fragment,_),r=!0)},o(_){V(e.$$.fragment,_),V(n.$$.fragment,_),r=!1},d(_){ce(e,_),_&&A(o),ce(n,_)}}}function er(l){let e;return{c(){e=F("Fetch")},m(t,o){E(t,e,o)},d(t){t&&A(e)}}}function tr(l){let e,t;return e=new El({props:{type:"is-primary",$$slots:{default:[er]},$$scope:{ctx:l}}}),e.$on("click",l[9]),e.$on("submit",l[9]),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},p(o,n){const u={};n&268435456&&(u.$$scope={dirty:n,ctx:o}),e.$set(u)},i(o){t||(W(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function lr(l){let e,t,o,n,u,r;return e=new Ht({props:{grouped:!0,$$slots:{default:[Zs]},$$scope:{ctx:l}}}),o=new Ht({props:{grouped:!0,$$slots:{default:[xs]},$$scope:{ctx:l}}}),u=new Ht({props:{grouped:!0,$$slots:{default:[tr]},$$scope:{ctx:l}}}),{c(){ae(e.$$.fragment),t=g(),ae(o.$$.fragment),n=g(),ae(u.$$.fragment)},m(c,i){ue(e,c,i),E(c,t,i),ue(o,c,i),E(c,n,i),ue(u,c,i),r=!0},p(c,i){const d={};i&268435464&&(d.$$scope={dirty:i,ctx:c}),e.$set(d);const p={};i&268435476&&(p.$$scope={dirty:i,ctx:c}),o.$set(p);const _={};i&268435456&&(_.$$scope={dirty:i,ctx:c}),u.$set(_)},i(c){r||(W(e.$$.fragment,c),W(o.$$.fragment,c),W(u.$$.fragment,c),r=!0)},o(c){V(e.$$.fragment,c),V(o.$$.fragment,c),V(u.$$.fragment,c),r=!1},d(c){ce(e,c),c&&A(t),ce(o,c),c&&A(n),ce(u,c)}}}function or(l){let e,t,o,n,u;return n=new Vn({props:{content:l[1],onChange:l[7]}}),{c(){e=f("p"),e.innerHTML=`<i>The best editing experience is to configure Atomic Server, in the
        meantime use editor below. You will need to refresh page via Command R
        or Ctrl-R to see changes</i>`,t=g(),o=f("div"),ae(n.$$.fragment),a(o,"class","editor")},m(r,c){E(r,e,c),E(r,t,c),E(r,o,c),ue(n,o,null),u=!0},p(r,c){const i={};c&2&&(i.content=r[1]),n.$set(i)},i(r){u||(W(n.$$.fragment,r),u=!0)},o(r){V(n.$$.fragment,r),u=!1},d(r){r&&A(e),r&&A(t),r&&A(o),ce(n)}}}function ho(l){let e,t;return e=new Ks({props:{subject:l[25]}}),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},p(o,n){const u={};n&1&&(u.subject=o[25]),e.$set(u)},i(o){t||(W(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function nr(l){let e,t,o=l[0]??[],n=[];for(let r=0;r<o.length;r+=1)n[r]=ho(mo(l,o,r));const u=r=>V(n[r],1,1,()=>{n[r]=null});return{c(){for(let r=0;r<n.length;r+=1)n[r].c();e=at()},m(r,c){for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(r,c);E(r,e,c),t=!0},p(r,c){if(c&1){o=r[0]??[];let i;for(i=0;i<o.length;i+=1){const d=mo(r,o,i);n[i]?(n[i].p(d,c),W(n[i],1)):(n[i]=ho(d),n[i].c(),W(n[i],1),n[i].m(e.parentNode,e))}for(Ke(),i=o.length;i<n.length;i+=1)u(i);Ge()}},i(r){if(!t){for(let c=0;c<o.length;c+=1)W(n[c]);t=!0}},o(r){n=n.filter(Boolean);for(let c=0;c<n.length;c+=1)V(n[c]);t=!1},d(r){Ye(n,r),r&&A(e)}}}function sr(l){let e,t;return e=new fs({props:{$$slots:{default:[nr]},$$scope:{ctx:l}}}),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},p(o,n){const u={};n&268435457&&(u.$$scope={dirty:n,ctx:o}),e.$set(u)},i(o){t||(W(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function rr(l){let e,t,o,n,u,r,c,i,d,p,_,m,y,h,b;return e=new rl({props:{fallbackPath:"/"}}),n=new Nt({props:{path:"/atomic",$$slots:{default:[Ys]},$$scope:{ctx:l}}}),r=new Nt({props:{path:"/json",$$slots:{default:[lr]},$$scope:{ctx:l}}}),i=new Nt({props:{path:"/editor",$$slots:{default:[or]},$$scope:{ctx:l}}}),m=new Ht({props:{grouped:!0,position:"is-right",$$slots:{default:[sr]},$$scope:{ctx:l}}}),{c(){ae(e.$$.fragment),t=g(),o=f("div"),ae(n.$$.fragment),u=g(),ae(r.$$.fragment),c=g(),ae(i.$$.fragment),d=g(),p=f("hr"),_=g(),ae(m.$$.fragment),y=g(),h=f("nav"),h.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
    <a class="navbar-item" href="/fetch/json">Fetch JSON Data</a> 
    <a class="navbar-item" href="/fetch/atomic">Set Atomic Server</a> 
    <a class="navbar-item" href="/fetch/editor">Edit JSON config</a></div>`,a(o,"class","box"),a(h,"class","navbar")},m(k,C){ue(e,k,C),E(k,t,C),E(k,o,C),ue(n,o,null),s(o,u),ue(r,o,null),s(o,c),ue(i,o,null),E(k,d,C),E(k,p,C),E(k,_,C),ue(m,k,C),E(k,y,C),E(k,h,C),b=!0},p(k,[C]){const v={};C&268435552&&(v.$$scope={dirty:C,ctx:k}),n.$set(v);const w={};C&268435484&&(w.$$scope={dirty:C,ctx:k}),r.$set(w);const T={};C&268435458&&(T.$$scope={dirty:C,ctx:k}),i.$set(T);const J={};C&268435457&&(J.$$scope={dirty:C,ctx:k}),m.$set(J)},i(k){b||(W(e.$$.fragment,k),W(n.$$.fragment,k),W(r.$$.fragment,k),W(i.$$.fragment,k),W(m.$$.fragment,k),b=!0)},o(k){V(e.$$.fragment,k),V(n.$$.fragment,k),V(r.$$.fragment,k),V(i.$$.fragment,k),V(m.$$.fragment,k),b=!1},d(k){ce(e,k),k&&A(t),k&&A(o),ce(n),ce(r),ce(i),k&&A(d),k&&A(p),k&&A(_),ce(m,k),k&&A(y),k&&A(h)}}}function ir(l,e,t){let o,n,u,r,c;Re(l,ys,R=>t(19,u=R)),Re(l,je,R=>t(20,r=R)),Re(l,St,R=>t(21,c=R));let i={json:c};function d(R){if(console.log("contents changed:",R),console.log("is tauri",r),St.update(L=>(L=R.json,L)),je)console.log("Updating config on server"),We("update_config",{configNew:R.json}).then(L=>{console.log(`Message: ${L}`)}).catch(L=>console.error(L));else{let L=`${pt.ServerURL}/config/`;fetch(L,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(R.json)})}t(1,i=R)}let p=!1,_="https://raw.githubusercontent.com/terraphim/terraphim-cloud-fastapi/main/data/ref_arch.json",m="http://localhost:8000/documents/",y="http://localhost:9883/",h;const b=async()=>{console.log("Updating atomic server configuration");const R=$s.fromSecret(h);u.setServerUrl(y),console.log("Server set.Setting agent"),u.setAgent(R)},k=async()=>{w()},C=({data:{msg:R,data:L}})=>{console.log(R,L)};let v;const w=async()=>{const R=await vs(()=>import("./fetcher.worker-7e58969a.js"),[]);v=new R.default,v.onmessage=C;const L={msg:"fetcher",data:{url:_,postUrl:m,isWiki:p}};v.postMessage(L)},T=Yn("http://localhost:9883/config/y3zx5wtm0bq"),J=Nl(T,Zn.properties.name);Re(l,J,R=>t(12,n=R));const U=Nl(T,"http://localhost:9883/property/role");Re(l,U,R=>t(0,o=R));function H(R){y=R,t(5,y)}function N(R){h=R,t(6,h)}function q(R){_=R,t(3,_)}function G(R){m=R,t(4,m)}function K(R){p=R,t(2,p)}return l.$$.update=()=>{l.$$.dirty&4096&&console.log("Print name",n),l.$$.dirty&1&&console.log("Print roles",o)},[o,i,p,_,m,y,h,d,b,k,J,U,n,H,N,q,G,K]}class ar extends _t{constructor(e){super(),mt(this,e,ir,rr,it,{})}}class ur{constructor(){wt(this,"baseUrl");wt(this,"autocompleteIndexBuilt",!1);wt(this,"sessionId");wt(this,"currentRole","Default");wt(this,"connectionRetries",0);wt(this,"maxRetries",3);wt(this,"retryDelay",1e3);wt(this,"isConnecting",!1);this.baseUrl=typeof window<"u"?(window.location.protocol==="https:"?"https://":"http://")+window.location.hostname+":8000":"http://localhost:8000",this.sessionId=`novel-${Date.now()}`}setRole(e){this.currentRole=e,this.autocompleteIndexBuilt=!1}async detectServerPort(){if(Ze(je))return;const e=[8e3,3e3,8080,8001];for(const t of e)try{const o=typeof window<"u"?(window.location.protocol==="https:"?"https://":"http://")+window.location.hostname+":"+t:"http://localhost:"+t,n=await fetch(`${o}/health`,{method:"GET",signal:AbortSignal.timeout(2e3)});if(n.ok&&n.status===200){this.baseUrl=o,console.log(`NovelAutocompleteService: Detected server at ${o}`);return}}catch{continue}console.warn("NovelAutocompleteService: Could not detect running server, using default:",this.baseUrl)}async buildAutocompleteIndex(){if(this.isConnecting)return await new Promise(e=>setTimeout(e,1e3)),this.autocompleteIndexBuilt;this.isConnecting=!0;try{if(Ze(je)){console.log("Using Tauri autocomplete - testing connection");const e=await We("get_autocomplete_suggestions",{query:"test",roleName:this.currentRole,limit:1});return e&&e.status==="success"?(this.autocompleteIndexBuilt=!0,this.connectionRetries=0,console.log("Tauri autocomplete connection verified"),!0):(console.warn("Tauri autocomplete test failed:",e),!1)}else{await this.detectServerPort();const e="test",t=encodeURIComponent(this.currentRole),o=encodeURIComponent(e),n=await fetch(`${this.baseUrl}/autocomplete/${t}/${o}`,{method:"GET",signal:AbortSignal.timeout(5e3)});if(n.ok){const u=await n.json();if(console.log("REST API autocomplete test response:",u),u.status==="success")return this.autocompleteIndexBuilt=!0,this.connectionRetries=0,console.log("REST API autocomplete connection verified"),!0}return console.warn("REST API autocomplete test failed:",n.status,n.statusText),!1}}catch(e){return console.error("Error testing Novel autocomplete endpoint:",e),!1}finally{this.isConnecting=!1}}async getCompletion(e){if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return{text:""};try{const t=this.extractLastWord(e.prompt);if(!t||t.length<1)return{text:""};const o=await this.getSuggestionsWithSnippets(t,5);if(o.length===0)return{text:""};let u=o[0].text;u.toLowerCase().startsWith(t.toLowerCase())&&(u=u.substring(t.length));const r=e.prompt.length/4,c=u.length/4;return{text:u,usage:{promptTokens:Math.round(r),completionTokens:Math.round(c),totalTokens:Math.round(r+c)}}}catch(t){return console.error("Error getting Novel autocomplete completion:",t),{text:""}}}async getSuggestions(e,t=10){if(!e||e.trim().length===0)return[];if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return console.warn("Autocomplete endpoint not ready, returning empty suggestions"),[];try{return Ze(je)?await this.getTauriSuggestions(e,t):await this.getRestApiSuggestions(e,t)}catch(o){return console.error("Error getting autocomplete suggestions:",o),[]}}async getTauriSuggestions(e,t){const o=await We("get_autocomplete_suggestions",{query:e.trim(),roleName:this.currentRole,limit:t});return console.log("Tauri autocomplete response:",o),o&&o.status==="success"&&o.suggestions?o.suggestions.map(n=>({text:n.term||n.text||"",snippet:n.url||n.snippet||"",score:n.score||1})).filter(n=>n.text.length>0):(o&&o.error&&console.error("Tauri autocomplete error:",o.error),[])}async getRestApiSuggestions(e,t){await this.detectServerPort();const o=encodeURIComponent(this.currentRole),n=encodeURIComponent(e.trim()),u=await fetch(`${this.baseUrl}/autocomplete/${o}/${n}`,{method:"GET",signal:AbortSignal.timeout(5e3)});if(!u.ok)return console.error("REST API autocomplete request failed:",u.status,u.statusText),[];const r=await u.json();return console.log(`REST API autocomplete response for "${e}":`,r),r.status==="success"&&r.suggestions?r.suggestions.slice(0,t).map(c=>({text:c.text||c.term||"",snippet:c.snippet||c.url||"",score:c.score||1})).filter(c=>c.text.length>0):(r.error&&console.error("REST API autocomplete error:",r.error),[])}async getSuggestionsWithSnippets(e,t=10){if(!e||e.trim().length===0)return[];if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return console.warn("Autocomplete endpoint not ready, returning empty suggestions with snippets"),[];try{return Ze(je)?await this.getTauriSuggestions(e,t):await this.getRestApiSuggestions(e,t)}catch(o){return console.error("Error getting autocomplete suggestions with snippets:",o),[]}}extractLastWord(e){const t=e.trim().split(/\s+/);return t[t.length-1]||""}isReady(){return this.autocompleteIndexBuilt}getStatus(){return{ready:this.autocompleteIndexBuilt,baseUrl:this.baseUrl,sessionId:this.sessionId,usingTauri:Ze(je),currentRole:this.currentRole,connectionRetries:this.connectionRetries,isConnecting:this.isConnecting}}async refreshIndex(){return this.autocompleteIndexBuilt=!1,this.connectionRetries=0,await this.buildAutocompleteIndex()}async testConnection(){try{if(Ze(je)){const e=await We("get_config");return e&&e.status==="success"}else{await this.detectServerPort();const e=await fetch(`${this.baseUrl}/health`,{method:"GET",signal:AbortSignal.timeout(3e3)});return e.ok&&e.status===200}}catch(e){return console.warn("Connection test failed:",e),!1}}}const Ot=new ur,go=ks.create({name:"terraphimSuggestion",addOptions(){return{trigger:"/",pluginKey:new ws("terraphimSuggestion"),allowSpaces:!1,limit:8,minLength:1,debounce:300}},addCommands(){return{insertSuggestion:l=>({commands:e,chain:t})=>t().insertContent(l.text).run()}},addProseMirrorPlugins(){const l={editor:this.editor,char:this.options.trigger,pluginKey:this.options.pluginKey,allowSpaces:this.options.allowSpaces,startOfLine:!1,command:({editor:e,range:t,props:o})=>{const n=o;e.chain().focus().insertContentAt(t,n.text+" ").run()},items:async({query:e,editor:t})=>new Promise(o=>{setTimeout(async()=>{if(e.length<this.options.minLength){o([]);return}try{const n=await Ot.getSuggestionsWithSnippets(e,this.options.limit);console.log(`TerraphimSuggestion: Found ${n.length} suggestions for "${e}"`),o(n)}catch(n){console.error("TerraphimSuggestion: Error getting suggestions:",n),o([])}},this.options.debounce)}),render:()=>{let e,t;return{onStart:o=>{e=new cr({items:o.items,command:o.command}),o.clientRect&&(t=Ts("body",{getReferenceClientRect:o.clientRect,appendTo:()=>document.body,content:e.element,showOnCreate:!0,interactive:!0,trigger:"manual",placement:"bottom-start",theme:"terraphim-suggestion",maxWidth:"none"})[0])},onUpdate(o){e==null||e.updateItems(o.items),o.clientRect&&(t==null||t.setProps({getReferenceClientRect:o.clientRect}))},onKeyDown(o){return o.event.key==="Escape"?(t==null||t.hide(),!0):(e==null?void 0:e.onKeyDown(o))??!1},onExit(){t==null||t.destroy(),e==null||e.destroy()}}}};return[Rs(l)]}});class cr{constructor(e){wt(this,"element");wt(this,"items",[]);wt(this,"selectedIndex",0);wt(this,"command");this.items=e.items,this.command=e.command,this.element=document.createElement("div"),this.element.className="terraphim-suggestion-dropdown",this.render()}updateItems(e){this.items=e,this.selectedIndex=0,this.render()}onKeyDown({event:e}){return e.key==="ArrowUp"?(this.selectPrevious(),!0):e.key==="ArrowDown"?(this.selectNext(),!0):e.key==="Enter"||e.key==="Tab"?(this.selectItem(this.selectedIndex),!0):!1}selectPrevious(){this.selectedIndex=Math.max(0,this.selectedIndex-1),this.render()}selectNext(){this.selectedIndex=Math.min(this.items.length-1,this.selectedIndex+1),this.render()}selectItem(e){const t=this.items[e];t&&this.command(t)}render(){if(this.element.innerHTML="",this.items.length===0){this.element.innerHTML=`
        <div class="terraphim-suggestion-item terraphim-suggestion-empty">
          <div class="terraphim-suggestion-text">No suggestions found</div>
          <div class="terraphim-suggestion-hint">Try a different search term</div>
        </div>
      `;return}const e=document.createElement("div");e.className="terraphim-suggestion-header",e.innerHTML=`
      <div class="terraphim-suggestion-count">${this.items.length} suggestions</div>
      <div class="terraphim-suggestion-hint">↑↓ Navigate • Tab/Enter Select • Esc Cancel</div>
    `,this.element.appendChild(e),this.items.forEach((t,o)=>{const n=document.createElement("div");n.className=`terraphim-suggestion-item ${o===this.selectedIndex?"terraphim-suggestion-selected":""}`,n.innerHTML=`
        <div class="terraphim-suggestion-main">
          <div class="terraphim-suggestion-text">${this.escapeHtml(t.text)}</div>
          ${t.snippet?`<div class="terraphim-suggestion-snippet">${this.escapeHtml(t.snippet)}</div>`:""}
        </div>
        ${t.score?`<div class="terraphim-suggestion-score">${Math.round(t.score*100)}%</div>`:""}
      `,n.addEventListener("click",()=>this.selectItem(o)),n.addEventListener("mouseenter",()=>{this.selectedIndex=o,this.render()}),this.element.appendChild(n)})}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}destroy(){this.element.remove()}}const fr=`
.terraphim-suggestion-dropdown {
  background: white;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  box-shadow: 0 10px 38px -10px rgba(22, 23, 24, 0.35), 0 10px 20px -15px rgba(22, 23, 24, 0.2);
  max-height: 300px;
  min-width: 300px;
  overflow-y: auto;
  z-index: 1000;
}

.terraphim-suggestion-header {
  padding: 8px 12px;
  border-bottom: 1px solid #f1f5f9;
  background: #f8fafc;
  font-size: 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.terraphim-suggestion-count {
  font-weight: 600;
  color: #475569;
}

.terraphim-suggestion-hint {
  color: #64748b;
}

.terraphim-suggestion-item {
  padding: 8px 12px;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  border-bottom: 1px solid #f1f5f9;
}

.terraphim-suggestion-item:hover {
  background: #f8fafc;
}

.terraphim-suggestion-selected {
  background: #eff6ff !important;
  border-left: 3px solid #3b82f6;
}

.terraphim-suggestion-empty {
  color: #64748b;
  font-style: italic;
  text-align: center;
  cursor: default;
}

.terraphim-suggestion-main {
  flex: 1;
}

.terraphim-suggestion-text {
  font-weight: 500;
  color: #1e293b;
  margin-bottom: 2px;
}

.terraphim-suggestion-snippet {
  font-size: 12px;
  color: #64748b;
  line-height: 1.3;
}

.terraphim-suggestion-score {
  font-size: 11px;
  color: #10b981;
  font-weight: 600;
  background: #ecfdf5;
  padding: 2px 6px;
  border-radius: 4px;
  margin-left: 8px;
}

/* Dark theme support */
@media (prefers-color-scheme: dark) {
  .terraphim-suggestion-dropdown {
    background: #1e293b;
    border-color: #334155;
  }

  .terraphim-suggestion-header {
    background: #0f172a;
    border-color: #334155;
  }

  .terraphim-suggestion-item:hover {
    background: #334155;
  }

  .terraphim-suggestion-selected {
    background: #1e40af !important;
  }

  .terraphim-suggestion-text {
    color: #f1f5f9;
  }

  .terraphim-suggestion-snippet {
    color: #94a3b8;
  }
}

/* Tippy.js theme */
.tippy-box[data-theme~='terraphim-suggestion'] {
  background: transparent;
  box-shadow: none;
}

.tippy-box[data-theme~='terraphim-suggestion'] > .tippy-backdrop {
  background: transparent;
}

.tippy-box[data-theme~='terraphim-suggestion'] > .tippy-arrow {
  display: none;
}
`;function bo(l){let e,t,o,n,u,r,c,i,d,p,_,m,y,h,b,k,C,v,w,T,J,U,H,N,q,G,K=l[12]?"Tauri (native)":`REST API (${Ot.getStatus().baseUrl})`,R,L,O,S,z,x,B,Y,$,P,I,D,Q,ee,ne,ke,be,Pe,pe,fe,ie=l[6]!==1?"s":"",Ce,Te,oe,he,se,ve,Be,Se,Ne,le,we,Ue,Xe,He,Oe,ht,ze,Ct,tt=l[3]?"Enabled":"Disabled",gt,Qe,lt,ut,Le=l[11]&&!l[8]&&vo(l);function Tt(j,te){if(j[8])return mr;if(j[11])return _r}let M=Tt(l),X=M&&M(l);return{c(){e=f("div"),t=f("div"),o=f("strong"),o.textContent="Local Autocomplete Status:",n=g(),u=f("div"),r=f("button"),c=F("Test"),d=g(),p=f("button"),p.textContent="Rebuild Index",_=g(),m=f("button"),y=F("Demo"),b=g(),k=f("div"),C=F(l[10]),v=g(),Le&&Le.c(),w=g(),T=f("div"),J=f("strong"),J.textContent="Configuration:",U=g(),H=f("br"),N=F("• "),q=f("strong"),q.textContent="Backend:",G=g(),R=F(K),L=g(),O=f("br"),S=F("• "),z=f("strong"),z.textContent="Role:",x=g(),B=F(l[9]),Y=g(),$=f("br"),P=F("• "),I=f("strong"),I.textContent="Trigger:",D=F(' "'),Q=F(l[4]),ee=F(`" + text
      `),ne=f("br"),ke=F("• "),be=f("strong"),be.textContent="Min Length:",Pe=g(),pe=F(l[6]),fe=F(" character"),Ce=F(ie),Te=g(),oe=f("br"),he=F("• "),se=f("strong"),se.textContent="Max Results:",ve=g(),Be=F(l[5]),Se=g(),Ne=f("br"),le=F("• "),we=f("strong"),we.textContent="Debounce:",Ue=g(),Xe=F(l[7]),He=F(`ms
      `),Oe=f("br"),ht=F("• "),ze=f("strong"),ze.textContent="Snippets:",Ct=g(),gt=F(tt),Qe=g(),X&&X.c(),re(o,"color","#495057"),re(r,"padding","4px 8px"),re(r,"background","#007bff"),re(r,"color","white"),re(r,"border","none"),re(r,"border-radius","4px"),re(r,"cursor","pointer"),re(r,"font-size","12px"),r.disabled=i=!l[8],re(p,"padding","4px 8px"),re(p,"background","#28a745"),re(p,"color","white"),re(p,"border","none"),re(p,"border-radius","4px"),re(p,"cursor","pointer"),re(p,"font-size","12px"),re(m,"padding","4px 8px"),re(m,"background","#ffc107"),re(m,"color","#212529"),re(m,"border","none"),re(m,"border-radius","4px"),re(m,"cursor","pointer"),re(m,"font-size","12px"),m.disabled=h=!l[8],re(u,"display","flex"),re(u,"gap","8px"),re(t,"display","flex"),re(t,"justify-content","space-between"),re(t,"align-items","center"),re(t,"margin-bottom","8px"),re(k,"font-size","13px"),re(k,"color","#6c757d"),re(k,"margin-bottom","8px"),re(k,"font-family","monospace"),re(T,"font-size","12px"),re(T,"color","#6c757d"),re(e,"margin-top","10px"),re(e,"padding","12px"),re(e,"background","#f8f9fa"),re(e,"border-radius","6px"),re(e,"border","1px solid #e9ecef")},m(j,te){E(j,e,te),s(e,t),s(t,o),s(t,n),s(t,u),s(u,r),s(r,c),s(u,d),s(u,p),s(u,_),s(u,m),s(m,y),s(e,b),s(e,k),s(k,C),s(e,v),Le&&Le.m(e,null),s(e,w),s(e,T),s(T,J),s(T,U),s(T,H),s(T,N),s(T,q),s(T,G),s(T,R),s(T,L),s(T,O),s(T,S),s(T,z),s(T,x),s(T,B),s(T,Y),s(T,$),s(T,P),s(T,I),s(T,D),s(T,Q),s(T,ee),s(T,ne),s(T,ke),s(T,be),s(T,Pe),s(T,pe),s(T,fe),s(T,Ce),s(T,Te),s(T,oe),s(T,he),s(T,se),s(T,ve),s(T,Be),s(T,Se),s(T,Ne),s(T,le),s(T,we),s(T,Ue),s(T,Xe),s(T,He),s(T,Oe),s(T,ht),s(T,ze),s(T,Ct),s(T,gt),s(e,Qe),X&&X.m(e,null),lt||(ut=[Z(r,"click",l[14]),Z(p,"click",l[15]),Z(m,"click",l[16])],lt=!0)},p(j,te){te&256&&i!==(i=!j[8])&&(r.disabled=i),te&256&&h!==(h=!j[8])&&(m.disabled=h),te&1024&&_e(C,j[10]),j[11]&&!j[8]?Le?Le.p(j,te):(Le=vo(j),Le.c(),Le.m(e,w)):Le&&(Le.d(1),Le=null),te&4096&&K!==(K=j[12]?"Tauri (native)":`REST API (${Ot.getStatus().baseUrl})`)&&_e(R,K),te&512&&_e(B,j[9]),te&16&&_e(Q,j[4]),te&64&&_e(pe,j[6]),te&64&&ie!==(ie=j[6]!==1?"s":"")&&_e(Ce,ie),te&32&&_e(Be,j[5]),te&128&&_e(Xe,j[7]),te&8&&tt!==(tt=j[3]?"Enabled":"Disabled")&&_e(gt,tt),M===(M=Tt(j))&&X?X.p(j,te):(X&&X.d(1),X=M&&M(j),X&&(X.c(),X.m(e,null)))},d(j){j&&A(e),Le&&Le.d(),X&&X.d(),lt=!1,Je(ut)}}}function vo(l){let e,t,o,n;function u(i,d){return i[12]?pr:dr}let r=u(l),c=r(l);return{c(){e=f("div"),t=f("strong"),t.textContent="⚠️ Autocomplete Not Available",o=f("br"),n=g(),c.c(),re(e,"font-size","12px"),re(e,"color","#dc3545"),re(e,"margin-bottom","8px"),re(e,"padding","6px"),re(e,"background","#f8d7da"),re(e,"border-radius","4px")},m(i,d){E(i,e,d),s(e,t),s(e,o),s(e,n),c.m(e,null)},p(i,d){r===(r=u(i))&&c?c.p(i,d):(c.d(1),c=r(i),c&&(c.c(),c.m(e,null)))},d(i){i&&A(e),c.d()}}}function dr(l){let e,t=Ot.getStatus().baseUrl+"",o;return{c(){e=F("REST API server not responding. Ensure the server is running on "),o=F(t)},m(n,u){E(n,e,u),E(n,o,u)},p:ye,d(n){n&&A(e),n&&A(o)}}}function pr(l){let e;return{c(){e=F("Tauri backend connection failed. Ensure the application has proper permissions.")},m(t,o){E(t,e,o)},p:ye,d(t){t&&A(e)}}}function _r(l){let e;return{c(){e=f("div"),e.innerHTML=`<strong>❌ Autocomplete Unavailable</strong> 
        <div style="font-size: 11px; margin-top: 4px; color: #721c24;">Click &quot;Rebuild Index&quot; to retry or check server/backend status.</div>`,re(e,"margin-top","8px"),re(e,"padding","8px"),re(e,"background","#f8d7da"),re(e,"border","1px solid #f5c6cb"),re(e,"border-radius","4px")},m(t,o){E(t,e,o)},p:ye,d(t){t&&A(e)}}}function mr(l){let e,t,o,n,u,r,c,i,d,p,_,m,y,h,b,k,C;return{c(){e=f("div"),t=f("strong"),t.textContent="🎯 Autocomplete Active",o=g(),n=f("div"),u=F("Type "),r=f("code"),c=F(l[4]),i=F(" in the editor above to trigger suggestions."),d=f("br"),p=F(`
          Example: `),_=f("code"),m=F(l[4]),y=F("terraphim"),h=F(" or "),b=f("code"),k=F(l[4]),C=F("graph"),re(n,"font-size","11px"),re(n,"margin-top","4px"),re(n,"color","#0056b3"),re(e,"margin-top","8px"),re(e,"padding","8px"),re(e,"background","#d1edff"),re(e,"border","1px solid #b3d9ff"),re(e,"border-radius","4px")},m(v,w){E(v,e,w),s(e,t),s(e,o),s(e,n),s(n,u),s(n,r),s(r,c),s(n,i),s(n,d),s(n,p),s(n,_),s(_,m),s(_,y),s(n,h),s(n,b),s(b,k),s(b,C)},p(v,w){w&16&&_e(c,v[4]),w&16&&_e(m,v[4]),w&16&&_e(k,v[4])},d(v){v&&A(e)}}}function hr(l){let e,t,o,n;e=new As({props:{defaultValue:l[0],isEditable:!l[1],disableLocalStorage:!0,onUpdate:l[13],extensions:[co,...l[2]?[go.configure({trigger:l[4],allowSpaces:!1,limit:l[5],minLength:l[6],debounce:l[7]})]:[]]}});let u=l[2]&&bo(l);return{c(){ae(e.$$.fragment),t=g(),u&&u.c(),o=at()},m(r,c){ue(e,r,c),E(r,t,c),u&&u.m(r,c),E(r,o,c),n=!0},p(r,[c]){const i={};c&1&&(i.defaultValue=r[0]),c&2&&(i.isEditable=!r[1]),c&244&&(i.extensions=[co,...r[2]?[go.configure({trigger:r[4],allowSpaces:!1,limit:r[5],minLength:r[6],debounce:r[7]})]:[]]),e.$set(i),r[2]?u?u.p(r,c):(u=bo(r),u.c(),u.m(o.parentNode,o)):u&&(u.d(1),u=null)},i(r){n||(W(e.$$.fragment,r),n=!0)},o(r){V(e.$$.fragment,r),n=!1},d(r){ce(e,r),r&&A(t),u&&u.d(r),r&&A(o)}}}function gr(l,e,t){let o,n;Re(l,At,N=>t(9,o=N)),Re(l,je,N=>t(12,n=N));let{html:u=""}=e,{readOnly:r=!1}=e,{outputFormat:c="html"}=e,{enableAutocomplete:i=!0}=e,{showSnippets:d=!0}=e,{suggestionTrigger:p="/"}=e,{maxSuggestions:_=8}=e,{minQueryLength:m=1}=e,{debounceDelay:y=300}=e,h=null,b="⏳ Initializing...",k=!1,C=!1,v=null;qt(async()=>{i&&await w(),typeof document<"u"&&(v=document.createElement("style"),v.textContent=fr,document.head.appendChild(v))}),ps(()=>{v&&v.parentNode&&v.parentNode.removeChild(v)});async function w(){t(10,b="⏳ Initializing autocomplete..."),t(8,k=!1),t(11,C=!1);try{Ot.setRole(o),t(10,b="🔗 Testing connection...");const N=await Ot.testConnection();t(11,C=!0),N?(t(10,b="🔨 Building autocomplete index..."),await Ot.buildAutocompleteIndex()?(n?t(10,b="✅ Ready - Using Tauri backend"):t(10,b="✅ Ready - Using MCP server backend"),t(8,k=!0)):t(10,b="❌ Failed to build autocomplete index")):n?t(10,b="❌ Tauri backend not available"):t(10,b="❌ REST API server not responding")}catch(N){console.error("Error initializing autocomplete:",N),t(10,b="❌ Autocomplete initialization error")}}const T=N=>{h=N,c==="markdown"?t(0,u=N.storage.markdown.getMarkdown()):t(0,u=N.getHTML())},J=async()=>{if(!C){alert("Please wait for connection test to complete");return}if(!k){alert("Autocomplete service not ready. Check the status above.");return}try{t(10,b="🧪 Testing autocomplete...");const N="terraphim",q=await Ot.getSuggestions(N,5);if(console.log("Autocomplete test results:",q),q.length>0){const G=q.map((K,R)=>`${R+1}. ${K.text}${K.snippet?` (${K.snippet})`:""}`).join(`
`);alert(`✅ Found ${q.length} suggestions for '${N}':

${G}`),n?t(10,b="✅ Ready - Using Tauri backend"):t(10,b="✅ Ready - Using REST API backend")}else alert(`⚠️ No suggestions found for '${N}'. This might be normal if the term isn't in your knowledge graph.`)}catch(N){console.error("Autocomplete test failed:",N),alert(`❌ Autocomplete test failed: ${N.message}`),t(10,b="❌ Test failed - check console for details")}},U=async()=>{t(10,b="⏳ Rebuilding index..."),t(8,k=!1);try{await Ot.refreshIndex()?(n?t(10,b="✅ Ready - Tauri index rebuilt successfully"):t(10,b="✅ Ready - REST API connection verified"),t(8,k=!0)):t(10,b="❌ Failed to rebuild index")}catch(N){console.error("Error rebuilding index:",N),t(10,b="❌ Index rebuild failed - check console for details")}},H=()=>{if(!h){alert("Editor not ready yet");return}const N=`# Terraphim Autocomplete Demo

This is a demonstration of the integrated Terraphim autocomplete system.

## How to Use:
1. Type "${p}" to trigger autocomplete
2. Start typing any term (e.g., "${p}terraphim", "${p}graph")
3. Use ↑↓ arrows to navigate suggestions
4. Press Tab or Enter to select
5. Press Esc to cancel

## Try these queries:
- ${p}terraphim
- ${p}graph
- ${p}service
- ${p}automata
- ${p}role

The autocomplete system uses your local knowledge graph to provide intelligent suggestions based on your selected role: **${o}**.

---

Start typing below:`;h.commands.setContent(N),setTimeout(()=>{h.commands.focus("end")},100),alert(`Demo content inserted!

Type "${p}" followed by any term to see autocomplete suggestions.

Example: "${p}terraphim"`)};return l.$$set=N=>{"html"in N&&t(0,u=N.html),"readOnly"in N&&t(1,r=N.readOnly),"outputFormat"in N&&t(17,c=N.outputFormat),"enableAutocomplete"in N&&t(2,i=N.enableAutocomplete),"showSnippets"in N&&t(3,d=N.showSnippets),"suggestionTrigger"in N&&t(4,p=N.suggestionTrigger),"maxSuggestions"in N&&t(5,_=N.maxSuggestions),"minQueryLength"in N&&t(6,m=N.minQueryLength),"debounceDelay"in N&&t(7,y=N.debounceDelay)},l.$$.update=()=>{l.$$.dirty&772&&o&&i&&k&&(Ot.setRole(o),w())},[u,r,i,d,p,_,m,y,k,o,b,C,n,T,J,U,H,c]}class br extends _t{constructor(e){super(),mt(this,e,gr,hr,it,{html:0,readOnly:1,outputFormat:17,enableAutocomplete:2,showSnippets:3,suggestionTrigger:4,maxSuggestions:5,minQueryLength:6,debounceDelay:7})}}function ko(l){let e,t,o,n,u,r,c,i,d,p,_;return{c(){e=f("div"),t=f("h3"),o=f("span"),o.textContent="Knowledge Graph",n=F(`
          Term: `),u=f("strong"),r=F(l[2]),c=F(" | Rank: "),i=f("strong"),d=F(l[3]),p=g(),_=f("hr"),a(o,"class","tag is-info svelte-329px1"),a(t,"class","subtitle is-6 svelte-329px1"),a(_,"class","svelte-329px1"),a(e,"class","kg-context svelte-329px1")},m(m,y){E(m,e,y),s(e,t),s(t,o),s(t,n),s(t,u),s(u,r),s(t,c),s(t,i),s(i,d),s(e,p),s(e,_)},p(m,y){y&4&&_e(r,m[2]),y&8&&_e(d,m[3])},d(m){m&&A(e)}}}function vr(l){let e,t,o,n,u,r,c,i;const d=[yr,wr],p=[];function _(m,y){return m[5]?0:1}return t=_(l),o=p[t]=d[t](l),{c(){e=f("div"),o.c(),n=g(),u=f("div"),u.innerHTML='<span class="hint-text svelte-329px1">Double-click to edit • Ctrl+E to edit • Ctrl+S to save • Click KG links to explore</span>',a(u,"class","edit-hint svelte-329px1"),a(e,"class","content-viewer svelte-329px1"),a(e,"tabindex","0"),a(e,"role","button"),a(e,"aria-label","Double-click to edit article content")},m(m,y){E(m,e,y),p[t].m(e,null),s(e,n),s(e,u),l[20](e),r=!0,c||(i=[Z(e,"dblclick",l[14]),Z(e,"keydown",l[15]),Z(e,"click",l[13])],c=!0)},p(m,y){let h=t;t=_(m),t===h?p[t].p(m,y):(Ke(),V(p[h],1,1,()=>{p[h]=null}),Ge(),o=p[t],o?o.p(m,y):(o=p[t]=d[t](m),o.c()),W(o,1),o.m(e,n))},i(m){r||(W(o),r=!0)},o(m){V(o),r=!1},d(m){m&&A(e),p[t].d(),l[20](null),c=!1,Je(i)}}}function kr(l){let e,t,o,n,u,r,c,i,d,p;function _(y){l[18](y)}let m={outputFormat:l[11]};return l[1].body!==void 0&&(m.html=l[1].body),e=new br({props:m}),Ve.push(()=>xe(e,"html",_)),{c(){ae(e.$$.fragment),o=g(),n=f("div"),u=f("button"),u.textContent="Save",r=g(),c=f("button"),c.textContent="Cancel",a(u,"class","button is-primary"),a(c,"class","button is-light"),a(n,"class","edit-controls svelte-329px1")},m(y,h){ue(e,y,h),E(y,o,h),E(y,n,h),s(n,u),s(n,r),s(n,c),i=!0,d||(p=[Z(u,"click",l[12]),Z(c,"click",l[19])],d=!0)},p(y,h){const b={};h&2048&&(b.outputFormat=y[11]),!t&&h&2&&(t=!0,b.html=y[1].body,et(()=>t=!1)),e.$set(b)},i(y){i||(W(e.$$.fragment,y),i=!0)},o(y){V(e.$$.fragment,y),i=!1},d(y){ce(e,y),y&&A(o),y&&A(n),d=!1,Je(p)}}}function wr(l){let e,t,o;return t=new Ol({props:{source:l[1].body}}),{c(){e=f("div"),ae(t.$$.fragment),a(e,"class","markdown-content svelte-329px1")},m(n,u){E(n,e,u),ue(t,e,null),o=!0},p(n,u){const r={};u&2&&(r.source=n[1].body),t.$set(r)},i(n){o||(W(t.$$.fragment,n),o=!0)},o(n){V(t.$$.fragment,n),o=!1},d(n){n&&A(e),ce(t)}}}function yr(l){let e,t=l[1].body+"";return{c(){e=f("div"),a(e,"class","prose svelte-329px1")},m(o,n){E(o,e,n),e.innerHTML=t},p(o,n){n&2&&t!==(t=o[1].body+"")&&(e.innerHTML=t)},i:ye,o:ye,d(o){o&&A(e)}}}function $r(l){let e,t,o,n,u,r=l[1].title+"",c,i,d,p,_,m,y,h=l[2]&&l[3]!==null&&ko(l);const b=[kr,vr],k=[];function C(v,w){return v[4]?0:1}return d=C(l),p=k[d]=b[d](l),{c(){e=f("div"),t=f("button"),o=g(),h&&h.c(),n=g(),u=f("h2"),c=F(r),i=g(),p.c(),a(t,"class","delete is-large modal-close-btn svelte-329px1"),a(t,"aria-label","close"),a(u,"class","svelte-329px1"),a(e,"class","box wrapper svelte-329px1")},m(v,w){E(v,e,w),s(e,t),s(e,o),h&&h.m(e,null),s(e,n),s(e,u),s(u,c),s(e,i),k[d].m(e,null),_=!0,m||(y=Z(t,"click",l[17]),m=!0)},p(v,w){v[2]&&v[3]!==null?h?h.p(v,w):(h=ko(v),h.c(),h.m(e,n)):h&&(h.d(1),h=null),(!_||w&2)&&r!==(r=v[1].title+"")&&_e(c,r);let T=d;d=C(v),d===T?k[d].p(v,w):(Ke(),V(k[T],1,1,()=>{k[T]=null}),Ge(),p=k[d],p?p.p(v,w):(p=k[d]=b[d](v),p.c()),W(p,1),p.m(e,null))},i(v){_||(W(p),_=!0)},o(v){V(p),_=!1},d(v){v&&A(e),h&&h.d(),k[d].d(),m=!1,y()}}}function wo(l){let e,t,o;function n(r){l[23](r)}let u={$$slots:{default:[Tr]},$$scope:{ctx:l}};return l[7]!==void 0&&(u.active=l[7]),e=new Ml({props:u}),Ve.push(()=>xe(e,"active",n)),{c(){ae(e.$$.fragment)},m(r,c){ue(e,r,c),o=!0},p(r,c){const i={};c&536872832&&(i.$$scope={dirty:c,ctx:r}),!t&&c&128&&(t=!0,i.active=r[7],et(()=>t=!1)),e.$set(i)},i(r){o||(W(e.$$.fragment,r),o=!0)},o(r){V(e.$$.fragment,r),o=!1},d(r){ce(e,r)}}}function yo(l){let e,t,o,n,u,r,c,i,d,p,_;return{c(){e=f("div"),t=f("h3"),o=f("span"),o.textContent="Knowledge Graph",n=F(`
            Term: `),u=f("strong"),r=F(l[9]),c=F(" | Rank: "),i=f("strong"),d=F(l[10]),p=g(),_=f("hr"),a(o,"class","tag is-info svelte-329px1"),a(t,"class","subtitle is-6 svelte-329px1"),a(_,"class","svelte-329px1"),a(e,"class","kg-context svelte-329px1")},m(m,y){E(m,e,y),s(e,t),s(t,o),s(t,n),s(t,u),s(u,r),s(t,c),s(t,i),s(i,d),s(e,p),s(e,_)},p(m,y){y&512&&_e(r,m[9]),y&1024&&_e(d,m[10])},d(m){m&&A(e)}}}function Sr(l){let e,t,o;return t=new Ol({props:{source:l[8].body}}),{c(){e=f("div"),ae(t.$$.fragment),a(e,"class","markdown-content svelte-329px1")},m(n,u){E(n,e,u),ue(t,e,null),o=!0},p(n,u){const r={};u&256&&(r.source=n[8].body),t.$set(r)},i(n){o||(W(t.$$.fragment,n),o=!0)},o(n){V(t.$$.fragment,n),o=!1},d(n){n&&A(e),ce(t)}}}function Cr(l){let e,t=l[8].body+"";return{c(){e=f("div"),a(e,"class","prose svelte-329px1")},m(o,n){E(o,e,n),e.innerHTML=t},p(o,n){n&256&&t!==(t=o[8].body+"")&&(e.innerHTML=t)},i:ye,o:ye,d(o){o&&A(e)}}}function Tr(l){let e,t,o,n,u,r=l[8].title+"",c,i,d,p,_,m,y,h,b,k,C,v=l[9]&&l[10]!==null&&yo(l);const w=[Cr,Sr],T=[];function J(U,H){return H&256&&(p=null),p==null&&(p=!!(U[8].body&&(/<html/i.test(U[8].body)||/<body/i.test(U[8].body)||/<head/i.test(U[8].body)))),p?0:1}return _=J(l,-1),m=T[_]=w[_](l),{c(){e=f("div"),t=f("button"),o=g(),v&&v.c(),n=g(),u=f("h2"),c=F(r),i=g(),d=f("div"),m.c(),y=g(),h=f("div"),h.innerHTML='<span class="hint-text svelte-329px1">Knowledge Graph document • Click KG links to explore further</span>',a(t,"class","delete is-large modal-close-btn svelte-329px1"),a(t,"aria-label","close"),a(u,"class","svelte-329px1"),a(h,"class","edit-hint svelte-329px1"),a(d,"class","content-viewer svelte-329px1"),a(d,"tabindex","0"),a(d,"role","button"),a(d,"aria-label","KG document content - click KG links to explore further"),a(e,"class","box wrapper svelte-329px1")},m(U,H){E(U,e,H),s(e,t),s(e,o),v&&v.m(e,null),s(e,n),s(e,u),s(u,c),s(e,i),s(e,d),T[_].m(d,null),s(d,y),s(d,h),b=!0,k||(C=[Z(t,"click",l[22]),Z(d,"click",l[13])],k=!0)},p(U,H){U[9]&&U[10]!==null?v?v.p(U,H):(v=yo(U),v.c(),v.m(e,n)):v&&(v.d(1),v=null),(!b||H&256)&&r!==(r=U[8].title+"")&&_e(c,r);let N=_;_=J(U,H),_===N?T[_].p(U,H):(Ke(),V(T[N],1,1,()=>{T[N]=null}),Ge(),m=T[_],m?m.p(U,H):(m=T[_]=w[_](U),m.c()),W(m,1),m.m(d,y))},i(U){b||(W(m),b=!0)},o(U){V(m),b=!1},d(U){U&&A(e),v&&v.d(),T[_].d(),k=!1,Je(C)}}}function Rr(l){let e,t,o,n,u;function r(d){l[21](d)}let c={$$slots:{default:[$r]},$$scope:{ctx:l}};l[0]!==void 0&&(c.active=l[0]),e=new Ml({props:c}),Ve.push(()=>xe(e,"active",r));let i=l[8]&&wo(l);return{c(){ae(e.$$.fragment),o=g(),i&&i.c(),n=at()},m(d,p){ue(e,d,p),E(d,o,p),i&&i.m(d,p),E(d,n,p),u=!0},p(d,[p]){const _={};p&536873087&&(_.$$scope={dirty:p,ctx:d}),!t&&p&1&&(t=!0,_.active=d[0],et(()=>t=!1)),e.$set(_),d[8]?i?(i.p(d,p),p&256&&W(i,1)):(i=wo(d),i.c(),W(i,1),i.m(n.parentNode,n)):i&&(Ke(),V(i,1,1,()=>{i=null}),Ge())},i(d){u||(W(e.$$.fragment,d),W(i),u=!0)},o(d){V(e.$$.fragment,d),V(i),u=!1},d(d){ce(e,d),d&&A(o),i&&i.d(d),d&&A(n)}}}function Ar(l,e,t){let o,n,u,r;Re(l,je,S=>t(25,u=S)),Re(l,At,S=>t(26,r=S));let{active:c=!1}=e,{item:i}=e,{initialEdit:d=!1}=e,{kgTerm:p=null}=e,{kgRank:_=null}=e,m=!1,y,h=!1,b=null,k=null,C=null;async function v(){if(u)try{const S=await We("get_document",{documentId:i.id});S!=null&&S.document&&t(1,i=S.document)}catch(S){console.error("Failed to load document",S)}}async function w(){if(!u){t(4,m=!1);return}try{await We("create_document",{document:i}),t(4,m=!1)}catch(S){console.error("Failed to save document",S)}}async function T(S){var z,x,B,Y,$;t(9,k=S),console.log("🔍 KG Link Click Debug Info:"),console.log("  Term clicked:",S),console.log("  Current role:",r),console.log("  Is Tauri mode:",u);try{if(u){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:r,term:S});const P=await We("find_documents_for_kg_term",{roleName:r,term:S});console.log("  📥 Tauri response received:"),console.log("    Status:",P.status),console.log("    Results count:",((z=P.results)==null?void 0:z.length)||0),console.log("    Total:",P.total||0),console.log("    Full response:",JSON.stringify(P,null,2)),P.status==="success"&&P.results&&P.results.length>0?(t(8,b=P.results[0]),t(10,C=b.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",b.title),console.log("    Rank:",C),console.log("    Body length:",((x=b.body)==null?void 0:x.length)||0,"characters"),t(7,h=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${S}" in role: "${r}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const P=pt.ServerURL,I=encodeURIComponent(r),D=encodeURIComponent(S),Q=`${P}/roles/${I}/kg_search?term=${D}`;console.log("  📤 HTTP Request details:"),console.log("    Base URL:",P),console.log("    Role (encoded):",I),console.log("    Term (encoded):",D),console.log("    Full URL:",Q);const ee=await fetch(Q);if(console.log("  📥 HTTP Response received:"),console.log("    Status code:",ee.status),console.log("    Status text:",ee.statusText),console.log("    Headers:",Object.fromEntries(ee.headers.entries())),!ee.ok)throw new Error(`HTTP error! Status: ${ee.status} - ${ee.statusText}`);const ne=await ee.json();console.log("  📄 Response data:"),console.log("    Status:",ne.status),console.log("    Results count:",((B=ne.results)==null?void 0:B.length)||0),console.log("    Total:",ne.total||0),console.log("    Full response:",JSON.stringify(ne,null,2)),ne.status==="success"&&ne.results&&ne.results.length>0?(t(8,b=ne.results[0]),t(10,C=b.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",b.title),console.log("    Rank:",C),console.log("    Body length:",((Y=b.body)==null?void 0:Y.length)||0,"characters"),t(7,h=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${S}" in role: "${r}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",Q))}}catch(P){console.error("❌ Error fetching KG document:"),console.error("  Error type:",P.constructor.name),console.error("  Error message:",P.message||P),console.error("  Request details:",{term:S,role:r,isTauri:u,timestamp:new Date().toISOString()}),!u&&(($=P.message)!=null&&$.includes("Failed to fetch"))&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{}}function J(S){const z=S.target;if(z.tagName==="A"){const x=z.getAttribute("href");if(x&&x.startsWith("kg:")){S.preventDefault();const B=x.substring(3);T(B)}}}function U(){t(4,m=!0)}function H(S){S.type!=="dblclick"&&((S.ctrlKey||S.metaKey)&&S.key==="e"&&(S.preventDefault(),t(4,m=!0)),m&&(S.ctrlKey||S.metaKey)&&S.key==="s"&&(S.preventDefault(),w()),S.key==="Escape"&&(S.preventDefault(),m?t(4,m=!1):t(0,c=!1)))}const N=()=>t(0,c=!1);function q(S){l.$$.not_equal(i.body,S)&&(i.body=S,t(1,i))}const G=()=>t(4,m=!1);function K(S){Ve[S?"unshift":"push"](()=>{y=S,t(6,y)})}function R(S){c=S,t(0,c)}const L=()=>t(7,h=!1);function O(S){h=S,t(7,h)}return l.$$set=S=>{"active"in S&&t(0,c=S.active),"item"in S&&t(1,i=S.item),"initialEdit"in S&&t(16,d=S.initialEdit),"kgTerm"in S&&t(2,p=S.kgTerm),"kgRank"in S&&t(3,_=S.kgRank)},l.$$.update=()=>{l.$$.dirty&65537&&c&&d&&t(4,m=!0),l.$$.dirty&19&&c&&i&&!m&&v(),l.$$.dirty&2&&t(5,o=i!=null&&i.body?/<html/i.test(i.body)||/<body/i.test(i.body)||/<head/i.test(i.body)||/^\s*<(!DOCTYPE|html|head|body|div|p|span)/i.test(i.body.trim()):!1),l.$$.dirty&32&&t(11,n=o?"html":"markdown")},[c,i,p,_,m,o,y,h,b,k,C,n,w,J,U,H,d,N,q,G,K,R,L,O]}class Hl extends _t{constructor(e){super(),mt(this,e,Ar,Rr,it,{active:0,item:1,initialEdit:16,kgTerm:2,kgRank:3})}}function $o(l,e,t){const o=l.slice();return o[33]=e[t],o}function So(l,e,t){const o=l.slice();return o[36]=e[t],o}function Co(l,e,t){const o=l.slice();return o[39]=e[t],o}function To(l){let e,t;return e=new Bn({props:{type:"is-success",$$slots:{default:[Lr]},$$scope:{ctx:l}}}),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},i(o){t||(W(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function Lr(l){let e,t,o;return{c(){e=f("p"),e.innerHTML="<strong>Success!</strong> Article saved to atomic server successfully.",t=g(),o=f("p"),o.textContent="The modal will close automatically..."},m(n,u){E(n,e,u),E(n,t,u),E(n,o,u)},p:ye,d(n){n&&A(e),n&&A(t),n&&A(o)}}}function Ro(l){let e,t;return e=new Bn({props:{type:"is-danger",$$slots:{default:[Er]},$$scope:{ctx:l}}}),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},p(o,n){const u={};n[0]&8|n[1]&2048&&(u.$$scope={dirty:n,ctx:o}),e.$set(u)},i(o){t||(W(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function Er(l){let e,t,o,n;return{c(){e=f("p"),t=f("strong"),t.textContent="Error:",o=g(),n=F(l[3])},m(u,r){E(u,e,r),s(e,t),s(e,o),s(e,n)},p(u,r){r[0]&8&&_e(n,u[3])},d(u){u&&A(e)}}}function Ao(l){var O,S,z,x;let e,t,o,n,u,r=(((O=l[1])==null?void 0:O.title)||"Untitled")+"",c,i,d,p,_,m,y=(((S=l[1])==null?void 0:S.rank)||0)+"",h,b,k,C,v,w,T,J,U,H,N=((z=l[1])==null?void 0:z.description)&&Lo(l),q=((x=l[1])==null?void 0:x.tags)&&Eo(l);function G(B,Y){return B[10].length>0?Or:Nr}let K=G(l),R=K(l),L=l[10].length>0&&Po(l);return{c(){e=f("div"),t=f("label"),t.textContent="Document to Save",o=g(),n=f("div"),u=f("h5"),c=F(r),i=g(),N&&N.c(),d=g(),p=f("div"),_=f("span"),m=F("Rank: "),h=F(y),b=g(),q&&q.c(),k=g(),C=f("div"),v=f("label"),v.textContent="Atomic Server",w=g(),T=f("div"),R.c(),J=g(),L&&L.c(),U=at(),a(t,"class","label"),a(u,"class","title is-6"),a(_,"class","tag is-info svelte-48g63o"),a(p,"class","tags svelte-48g63o"),a(n,"class","box document-preview svelte-48g63o"),a(e,"class","field"),a(v,"class","label"),a(v,"for","atomic-server-select"),a(T,"class","control"),a(C,"class","field")},m(B,Y){E(B,e,Y),s(e,t),s(e,o),s(e,n),s(n,u),s(u,c),s(n,i),N&&N.m(n,null),s(n,d),s(n,p),s(p,_),s(_,m),s(_,h),s(p,b),q&&q.m(p,null),E(B,k,Y),E(B,C,Y),s(C,v),s(C,w),s(C,T),R.m(T,null),E(B,J,Y),L&&L.m(B,Y),E(B,U,Y),H=!0},p(B,Y){var $,P,I,D;(!H||Y[0]&2)&&r!==(r=((($=B[1])==null?void 0:$.title)||"Untitled")+"")&&_e(c,r),(P=B[1])!=null&&P.description?N?N.p(B,Y):(N=Lo(B),N.c(),N.m(n,d)):N&&(N.d(1),N=null),(!H||Y[0]&2)&&y!==(y=(((I=B[1])==null?void 0:I.rank)||0)+"")&&_e(h,y),(D=B[1])!=null&&D.tags?q?q.p(B,Y):(q=Eo(B),q.c(),q.m(p,null)):q&&(q.d(1),q=null),K===(K=G(B))&&R?R.p(B,Y):(R.d(1),R=K(B),R&&(R.c(),R.m(T,null))),B[10].length>0?L?(L.p(B,Y),Y[0]&1024&&W(L,1)):(L=Po(B),L.c(),W(L,1),L.m(U.parentNode,U)):L&&(Ke(),V(L,1,1,()=>{L=null}),Ge())},i(B){H||(W(L),H=!0)},o(B){V(L),H=!1},d(B){B&&A(e),N&&N.d(),q&&q.d(),B&&A(k),B&&A(C),R.d(),B&&A(J),L&&L.d(B),B&&A(U)}}}function Lo(l){let e,t=l[1].description+"",o;return{c(){e=f("p"),o=F(t),a(e,"class","content")},m(n,u){E(n,e,u),s(e,o)},p(n,u){u[0]&2&&t!==(t=n[1].description+"")&&_e(o,t)},d(n){n&&A(e)}}}function Eo(l){let e,t=l[1].tags,o=[];for(let n=0;n<t.length;n+=1)o[n]=No(Co(l,t,n));return{c(){for(let n=0;n<o.length;n+=1)o[n].c();e=at()},m(n,u){for(let r=0;r<o.length;r+=1)o[r]&&o[r].m(n,u);E(n,e,u)},p(n,u){if(u[0]&2){t=n[1].tags;let r;for(r=0;r<t.length;r+=1){const c=Co(n,t,r);o[r]?o[r].p(c,u):(o[r]=No(c),o[r].c(),o[r].m(e.parentNode,e))}for(;r<o.length;r+=1)o[r].d(1);o.length=t.length}},d(n){Ye(o,n),n&&A(e)}}}function No(l){let e,t=l[39]+"",o;return{c(){e=f("span"),o=F(t),a(e,"class","tag svelte-48g63o")},m(n,u){E(n,e,u),s(e,o)},p(n,u){u[0]&2&&t!==(t=n[39]+"")&&_e(o,t)},d(n){n&&A(e)}}}function Nr(l){let e,t,o,n,u,r,c,i,d;return{c(){e=f("div"),t=f("p"),t.innerHTML="<strong>No atomic servers available</strong>",o=g(),n=f("p"),u=F('Your current role "'),r=F(l[12]),c=F(`" doesn't have any writable atomic server configurations.`),i=g(),d=f("p"),d.textContent="Please configure an atomic server haystack in your role settings.",a(e,"class","notification is-warning")},m(p,_){E(p,e,_),s(e,t),s(e,o),s(e,n),s(n,u),s(n,r),s(n,c),s(e,i),s(e,d)},p(p,_){_[0]&4096&&_e(r,p[12])},d(p){p&&A(e)}}}function Or(l){let e,t,o,n,u,r,c=l[10],i=[];for(let d=0;d<c.length;d+=1)i[d]=Oo(So(l,c,d));return{c(){e=f("div"),t=f("select");for(let d=0;d<i.length;d+=1)i[d].c();o=g(),n=f("p"),n.textContent=`Select the atomic server from your current role configuration.
              🔐 = Authenticated, ⚠️ = Anonymous access`,a(t,"id","atomic-server-select"),t.disabled=l[2],l[11]===void 0&&rt(()=>l[18].call(t)),a(e,"class","select is-fullwidth"),a(n,"class","help svelte-48g63o")},m(d,p){E(d,e,p),s(e,t);for(let _=0;_<i.length;_+=1)i[_]&&i[_].m(t,null);De(t,l[11],!0),E(d,o,p),E(d,n,p),u||(r=Z(t,"change",l[18]),u=!0)},p(d,p){if(p[0]&1024){c=d[10];let _;for(_=0;_<c.length;_+=1){const m=So(d,c,_);i[_]?i[_].p(m,p):(i[_]=Oo(m),i[_].c(),i[_].m(t,null))}for(;_<i.length;_+=1)i[_].d(1);i.length=c.length}p[0]&4&&(t.disabled=d[2]),p[0]&3072&&De(t,d[11])},d(d){d&&A(e),Ye(i,d),d&&A(o),d&&A(n),u=!1,r()}}}function Pr(l){let e;return{c(){e=f("span"),e.textContent="⚠️ No Auth",a(e,"class","has-text-warning")},m(t,o){E(t,e,o)},d(t){t&&A(e)}}}function Ir(l){let e;return{c(){e=f("span"),e.textContent="🔐",a(e,"class","has-text-success")},m(t,o){E(t,e,o)},d(t){t&&A(e)}}}function Oo(l){let e,t=l[36].location+"",o,n,u,r;function c(p,_){return p[36].atomic_server_secret?Ir:Pr}let i=c(l),d=i(l);return{c(){e=f("option"),o=F(t),n=g(),d.c(),u=g(),e.__value=r=l[36].location,e.value=e.__value},m(p,_){E(p,e,_),s(e,o),s(e,n),d.m(e,null),s(e,u)},p(p,_){_[0]&1024&&t!==(t=p[36].location+"")&&_e(o,t),i!==(i=c(p))&&(d.d(1),d=i(p),d&&(d.c(),d.m(e,u))),_[0]&1024&&r!==(r=p[36].location)&&(e.__value=r,e.value=e.__value)},d(p){p&&A(e),d.d()}}}function Po(l){var M,X;let e,t,o,n,u,r,c,i,d,p,_,m,y,h,b,k,C,v,w,T,J,U,H,N,q,G,K,R,L,O,S,z,x,B,Y,$,P,I,D,Q,ee,ne,ke,be=(l[8]||"Untitled")+"",Pe,pe,fe,ie,Ce,Te=(((X=(M=l[1])==null?void 0:M.body)==null?void 0:X.length)||0)+"",oe,he,se,ve,Be,Se,Ne=l[14]()+"",le,we,Ue,Xe,He,Oe=l[15]()+"",ht,ze,Ct,tt,gt;function Qe(j){l[19](j)}let lt={id:"article-title",placeholder:"Enter article title",disabled:l[2],required:!0};l[8]!==void 0&&(lt.value=l[8]),u=new Jt({props:lt}),Ve.push(()=>xe(u,"value",Qe));const ut=[Dr,Ur],Le=[];function Tt(j,te){return j[7]?1:0}return G=Tt(l),K=Le[G]=ut[G](l),S=new El({props:{type:"is-primary",loading:l[2],disabled:l[2]||!l[8].trim()||!l[11],$$slots:{default:[Mr]},$$scope:{ctx:l}}}),S.$on("click",l[16]),B=new El({props:{type:"is-light",disabled:l[2],$$slots:{default:[jr]},$$scope:{ctx:l}}}),B.$on("click",l[17]),Ct=qn(l[22][0]),{c(){e=f("div"),t=f("label"),t.textContent="Article Title",o=g(),n=f("div"),ae(u.$$.fragment),c=g(),i=f("div"),d=f("label"),d.textContent="Description",p=g(),_=f("div"),m=f("textarea"),y=g(),h=f("div"),b=f("label"),b.textContent="Parent Collection",k=g(),C=f("div"),v=f("label"),w=f("input"),T=F(`
              Use predefined collection`),J=g(),U=f("label"),H=f("input"),N=F(`
              Custom parent URL/path`),q=g(),K.c(),R=g(),L=f("div"),O=f("div"),ae(S.$$.fragment),z=g(),x=f("div"),ae(B.$$.fragment),Y=g(),$=f("div"),P=f("div"),I=f("p"),I.innerHTML="<strong>What will be saved:</strong>",D=g(),Q=f("ul"),ee=f("li"),ne=f("strong"),ne.textContent="Title:",ke=g(),Pe=F(be),pe=g(),fe=f("li"),ie=f("strong"),ie.textContent="Body:",Ce=F(" Original document content ("),oe=F(Te),he=F(" characters)"),se=g(),ve=f("li"),Be=f("strong"),Be.textContent="Parent:",Se=g(),le=F(Ne),we=g(),Ue=f("li"),Xe=f("strong"),Xe.textContent="Subject URL:",He=g(),ht=F(Oe),a(t,"class","label"),a(t,"for","article-title"),a(n,"class","control"),a(e,"class","field"),a(d,"class","label"),a(d,"for","article-description"),a(m,"id","article-description"),a(m,"class","textarea"),a(m,"placeholder","Brief description of the article"),m.disabled=l[2],a(m,"rows","3"),a(_,"class","control"),a(i,"class","field"),a(b,"class","label"),a(w,"type","radio"),w.__value=!1,w.value=w.__value,w.disabled=l[2],a(v,"class","radio svelte-48g63o"),a(H,"type","radio"),H.__value=!0,H.value=H.__value,H.disabled=l[2],a(U,"class","radio svelte-48g63o"),a(C,"class","control"),a(h,"class","field"),a(O,"class","control"),a(x,"class","control"),a(L,"class","field is-grouped"),a(ee,"class","svelte-48g63o"),a(fe,"class","svelte-48g63o"),a(ve,"class","svelte-48g63o"),a(Ue,"class","svelte-48g63o"),a(Q,"class","svelte-48g63o"),a(P,"class","notification is-info is-light svelte-48g63o"),a($,"class","field"),Ct.p(w,H)},m(j,te){E(j,e,te),s(e,t),s(e,o),s(e,n),ue(u,n,null),E(j,c,te),E(j,i,te),s(i,d),s(i,p),s(i,_),s(_,m),Ae(m,l[9]),E(j,y,te),E(j,h,te),s(h,b),s(h,k),s(h,C),s(C,v),s(v,w),w.checked=w.__value===l[7],s(v,T),s(C,J),s(C,U),s(U,H),H.checked=H.__value===l[7],s(U,N),E(j,q,te),Le[G].m(j,te),E(j,R,te),E(j,L,te),s(L,O),ue(S,O,null),s(L,z),s(L,x),ue(B,x,null),E(j,Y,te),E(j,$,te),s($,P),s(P,I),s(P,D),s(P,Q),s(Q,ee),s(ee,ne),s(ee,ke),s(ee,Pe),s(Q,pe),s(Q,fe),s(fe,ie),s(fe,Ce),s(fe,oe),s(fe,he),s(Q,se),s(Q,ve),s(ve,Be),s(ve,Se),s(ve,le),s(Q,we),s(Q,Ue),s(Ue,Xe),s(Ue,He),s(Ue,ht),ze=!0,tt||(gt=[Z(m,"input",l[20]),Z(w,"change",l[21]),Z(H,"change",l[23])],tt=!0)},p(j,te){var Ee,Fe;const me={};te[0]&4&&(me.disabled=j[2]),!r&&te[0]&256&&(r=!0,me.value=j[8],et(()=>r=!1)),u.$set(me),(!ze||te[0]&4)&&(m.disabled=j[2]),te[0]&512&&Ae(m,j[9]),(!ze||te[0]&4)&&(w.disabled=j[2]),te[0]&128&&(w.checked=w.__value===j[7]),(!ze||te[0]&4)&&(H.disabled=j[2]),te[0]&128&&(H.checked=H.__value===j[7]);let de=G;G=Tt(j),G===de?Le[G].p(j,te):(Ke(),V(Le[de],1,1,()=>{Le[de]=null}),Ge(),K=Le[G],K?K.p(j,te):(K=Le[G]=ut[G](j),K.c()),W(K,1),K.m(R.parentNode,R));const Me={};te[0]&4&&(Me.loading=j[2]),te[0]&2308&&(Me.disabled=j[2]||!j[8].trim()||!j[11]),te[1]&2048&&(Me.$$scope={dirty:te,ctx:j}),S.$set(Me);const qe={};te[0]&4&&(qe.disabled=j[2]),te[1]&2048&&(qe.$$scope={dirty:te,ctx:j}),B.$set(qe),(!ze||te[0]&256)&&be!==(be=(j[8]||"Untitled")+"")&&_e(Pe,be),(!ze||te[0]&2)&&Te!==(Te=(((Fe=(Ee=j[1])==null?void 0:Ee.body)==null?void 0:Fe.length)||0)+"")&&_e(oe,Te)},i(j){ze||(W(u.$$.fragment,j),W(K),W(S.$$.fragment,j),W(B.$$.fragment,j),ze=!0)},o(j){V(u.$$.fragment,j),V(K),V(S.$$.fragment,j),V(B.$$.fragment,j),ze=!1},d(j){j&&A(e),ce(u),j&&A(c),j&&A(i),j&&A(y),j&&A(h),j&&A(q),Le[G].d(j),j&&A(R),j&&A(L),ce(S),ce(B),j&&A(Y),j&&A($),Ct.r(),tt=!1,Je(gt)}}}function Ur(l){let e,t,o,n,u,r,c;function i(p){l[25](p)}let d={placeholder:"e.g., my-collection or http://server/custom-parent",disabled:l[2]};return l[6]!==void 0&&(d.value=l[6]),o=new Jt({props:d}),Ve.push(()=>xe(o,"value",i)),{c(){e=f("div"),t=f("div"),ae(o.$$.fragment),u=g(),r=f("p"),r.textContent=`Enter a collection name (e.g., "my-articles") or full URL.
              If the collection doesn't exist, it will be created.`,a(t,"class","control"),a(r,"class","help svelte-48g63o"),a(e,"class","field")},m(p,_){E(p,e,_),s(e,t),ue(o,t,null),s(e,u),s(e,r),c=!0},p(p,_){const m={};_[0]&4&&(m.disabled=p[2]),!n&&_[0]&64&&(n=!0,m.value=p[6],et(()=>n=!1)),o.$set(m)},i(p){c||(W(o.$$.fragment,p),c=!0)},o(p){V(o.$$.fragment,p),c=!1},d(p){p&&A(e),ce(o)}}}function Dr(l){let e,t,o,n,u,r,c=l[13],i=[];for(let d=0;d<c.length;d+=1)i[d]=Io($o(l,c,d));return{c(){e=f("div"),t=f("div"),o=f("div"),n=f("select");for(let d=0;d<i.length;d+=1)i[d].c();n.disabled=l[2],l[5]===void 0&&rt(()=>l[24].call(n)),a(o,"class","select is-fullwidth"),a(t,"class","control"),a(e,"class","field")},m(d,p){E(d,e,p),s(e,t),s(t,o),s(o,n);for(let _=0;_<i.length;_+=1)i[_]&&i[_].m(n,null);De(n,l[5],!0),u||(r=Z(n,"change",l[24]),u=!0)},p(d,p){if(p[0]&8192){c=d[13];let _;for(_=0;_<c.length;_+=1){const m=$o(d,c,_);i[_]?i[_].p(m,p):(i[_]=Io(m),i[_].c(),i[_].m(n,null))}for(;_<i.length;_+=1)i[_].d(1);i.length=c.length}p[0]&4&&(n.disabled=d[2]),p[0]&8224&&De(n,d[5])},i:ye,o:ye,d(d){d&&A(e),Ye(i,d),u=!1,r()}}}function Io(l){let e,t=l[33].label+"",o;return{c(){e=f("option"),o=F(t),e.__value=l[33].value,e.value=e.__value},m(n,u){E(n,e,u),s(e,o)},p:ye,d(n){n&&A(e)}}}function Mr(l){let e,t,o;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-cloud-upload-alt"></i>',t=g(),o=f("span"),o.textContent="Save to Atomic Server",a(e,"class","icon")},m(n,u){E(n,e,u),E(n,t,u),E(n,o,u)},p:ye,d(n){n&&A(e),n&&A(t),n&&A(o)}}}function jr(l){let e;return{c(){e=F("Cancel")},m(t,o){E(t,e,o)},d(t){t&&A(e)}}}function Hr(l){let e,t,o,n,u,r,c,i,d,p,_,m,y,h=l[4]&&To(l),b=l[3]&&Ro(l),k=!l[4]&&Ao(l);return{c(){e=f("div"),t=f("div"),o=f("div"),o.innerHTML=`<div class="level-item"><h3 class="title is-4"><span class="icon"><i class="fas fa-save"></i></span>
            Save to Atomic Server</h3></div>`,n=g(),u=f("div"),r=f("div"),c=f("button"),i=g(),h&&h.c(),d=g(),b&&b.c(),p=g(),k&&k.c(),a(o,"class","level-left"),a(c,"class","delete is-large"),c.disabled=l[2],a(c,"aria-label","close"),a(r,"class","level-item"),a(u,"class","level-right"),a(t,"class","level svelte-48g63o"),a(e,"class","box")},m(C,v){E(C,e,v),s(e,t),s(t,o),s(t,n),s(t,u),s(u,r),s(r,c),s(e,i),h&&h.m(e,null),s(e,d),b&&b.m(e,null),s(e,p),k&&k.m(e,null),_=!0,m||(y=Z(c,"click",l[17]),m=!0)},p(C,v){(!_||v[0]&4)&&(c.disabled=C[2]),C[4]?h?v[0]&16&&W(h,1):(h=To(C),h.c(),W(h,1),h.m(e,d)):h&&(Ke(),V(h,1,1,()=>{h=null}),Ge()),C[3]?b?(b.p(C,v),v[0]&8&&W(b,1)):(b=Ro(C),b.c(),W(b,1),b.m(e,p)):b&&(Ke(),V(b,1,1,()=>{b=null}),Ge()),C[4]?k&&(Ke(),V(k,1,1,()=>{k=null}),Ge()):k?(k.p(C,v),v[0]&16&&W(k,1)):(k=Ao(C),k.c(),W(k,1),k.m(e,null))},i(C){_||(W(h),W(b),W(k),_=!0)},o(C){V(h),V(b),V(k),_=!1},d(C){C&&A(e),h&&h.d(),b&&b.d(),k&&k.d(),m=!1,y()}}}function zr(l){let e,t,o;function n(r){l[26](r)}let u={$$slots:{default:[Hr]},$$scope:{ctx:l}};return l[0]!==void 0&&(u.active=l[0]),e=new Ml({props:u}),Ve.push(()=>xe(e,"active",n)),e.$on("close",l[17]),{c(){ae(e.$$.fragment)},m(r,c){ue(e,r,c),o=!0},p(r,c){const i={};c[0]&8190|c[1]&2048&&(i.$$scope={dirty:c,ctx:r}),!t&&c[0]&1&&(t=!0,i.active=r[0],et(()=>t=!1)),e.$set(i)},i(r){o||(W(e.$$.fragment,r),o=!0)},o(r){V(e.$$.fragment,r),o=!1},d(r){ce(e,r)}}}function Fr(l,e,t){let o,n,u;Re(l,je,$=>t(27,o=$)),Re(l,St,$=>t(28,n=$)),Re(l,At,$=>t(12,u=$));let{active:r=!1}=e,{document:c}=e,i=!1,d=null,p=!1,_="",m="",y=!1,h="",b="",k=[],C="";const v=[{label:"Root (Server Root)",value:""},{label:"Articles Collection",value:"articles"},{label:"Documents Collection",value:"documents"},{label:"Knowledge Base",value:"knowledge-base"},{label:"Research",value:"research"},{label:"Projects",value:"projects"}];function w(){t(2,i=!1),t(3,d=null),t(4,p=!1),t(5,_=""),t(6,m=""),t(7,y=!1),t(8,h=(c==null?void 0:c.title)||""),t(9,b=(c==null?void 0:c.description)||`Article saved from Terraphim search: ${c==null?void 0:c.title}`),t(10,k=[]),t(11,C="")}function T(){var D;const $=u,P=n;if(!(P!=null&&P.roles)||!$){console.warn("No role configuration found");return}let I=null;try{for(const[Q,ee]of Object.entries(P.roles)){const ne=ee,ke=typeof ne.name=="object"?ne.name.original:String(ne.name);if(Q===$||ke===$){I=ne;break}}}catch(Q){console.warn("Error checking role configuration:",Q);return}if(!I){console.warn(`Role "${$}" not found in configuration`);return}t(10,k=((D=I.haystacks)==null?void 0:D.filter(Q=>Q.service==="Atomic"&&Q.location&&!Q.read_only))||[]),k.length>0&&t(11,C=k[0].location),console.log("Loaded atomic servers:",k)}function J(){const $=k.find(P=>P.location===C);return $==null?void 0:$.atomic_server_secret}function U(){const $=C.replace(/\/$/,"");if(y&&m.trim()){const P=m.trim();return P.startsWith("http://")||P.startsWith("https://")?P:`${$}/${P.replace(/^\//,"")}`}else return _?`${$}/${_}`:$}function H(){return h.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,50)}function N(){const $=C.replace(/\/$/,""),P=H(),I=Date.now();return`${$}/${P}-${I}`}async function q(){if(!C||!h.trim()){t(3,d="Please select an atomic server and provide a title");return}t(2,i=!0),t(3,d=null);try{const $=N(),P=U(),I=J();console.log("🔄 Saving article to atomic server:",{subject:$,parent:P,server:C,hasSecret:!!I});const D={subject:$,title:h.trim(),description:b.trim(),body:c.body,parent:P,shortname:H(),original_id:c.id,original_url:c.url,original_rank:c.rank,tags:c.tags||[]};if(o)await We("save_article_to_atomic",{article:D,serverUrl:C,atomicSecret:I});else{const Q=await fetch(`${pt.ServerURL}/atomic/save`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({article:D,server_url:C,atomic_secret:I})});if(!Q.ok){const ee=await Q.json().catch(()=>({error:Q.statusText}));throw new Error(ee.error||`HTTP ${Q.status}: ${Q.statusText}`)}}t(4,p=!0),console.log("✅ Article saved successfully to atomic server"),setTimeout(()=>{t(0,r=!1)},2e3)}catch($){console.error("❌ Failed to save article to atomic server:",$),t(3,d=$.message||"Failed to save article to atomic server")}finally{t(2,i=!1)}}function G(){i||t(0,r=!1)}const K=[[]];function R(){C=Rt(this),t(11,C),t(10,k)}function L($){h=$,t(8,h)}function O(){b=this.value,t(9,b)}function S(){y=this.__value,t(7,y)}function z(){y=this.__value,t(7,y)}function x(){_=Rt(this),t(5,_),t(13,v)}function B($){m=$,t(6,m)}function Y($){r=$,t(0,r)}return l.$$set=$=>{"active"in $&&t(0,r=$.active),"document"in $&&t(1,c=$.document)},l.$$.update=()=>{l.$$.dirty[0]&3&&r&&c&&(w(),T())},[r,c,i,d,p,_,m,y,h,b,k,C,u,v,U,N,q,G,R,L,O,S,K,z,x,B,Y]}class Kr extends _t{constructor(e){super(),mt(this,e,Fr,zr,it,{active:0,document:1},null,[-1,-1])}}async function zl(l){return We("tauri",l)}async function Gr(l,e){return zl({__tauriModule:"Event",message:{cmd:"unlisten",event:l,eventId:e}})}async function Wr(l,e,t){return zl({__tauriModule:"Event",message:{cmd:"listen",event:l,windowLabel:e,handler:Ul(t)}}).then(o=>async()=>Gr(l,o))}var Uo;(function(l){l.WINDOW_RESIZED="tauri://resize",l.WINDOW_MOVED="tauri://move",l.WINDOW_CLOSE_REQUESTED="tauri://close-requested",l.WINDOW_CREATED="tauri://window-created",l.WINDOW_DESTROYED="tauri://destroyed",l.WINDOW_FOCUS="tauri://focus",l.WINDOW_BLUR="tauri://blur",l.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",l.WINDOW_THEME_CHANGED="tauri://theme-changed",l.WINDOW_FILE_DROP="tauri://file-drop",l.WINDOW_FILE_DROP_HOVER="tauri://file-drop-hover",l.WINDOW_FILE_DROP_CANCELLED="tauri://file-drop-cancelled",l.MENU="tauri://menu",l.CHECK_UPDATE="tauri://update",l.UPDATE_AVAILABLE="tauri://update-available",l.INSTALL_UPDATE="tauri://update-install",l.STATUS_UPDATE="tauri://update-status",l.DOWNLOAD_PROGRESS="tauri://update-download-progress"})(Uo||(Uo={}));async function Br(l,e){return Wr(l,null,e)}function Do(l,e,t){const o=l.slice();return o[9]=e[t],o}function Mo(l){let e,t=l[9].name+"",o,n;return{c(){e=f("option"),o=F(t),e.__value=n=l[9].name,e.value=e.__value},m(u,r){E(u,e,r),s(e,o)},p(u,r){r&1&&t!==(t=u[9].name+"")&&_e(o,t),r&1&&n!==(n=u[9].name)&&(e.__value=n,e.value=e.__value)},d(u){u&&A(e)}}}function qr(l){let e,t,o,n,u,r,c=l[0],i=[];for(let d=0;d<c.length;d+=1)i[d]=Mo(Do(l,c,d));return{c(){e=f("div"),t=f("div"),o=f("div"),n=f("select");for(let d=0;d<i.length;d+=1)i[d].c();a(o,"class","select"),a(t,"class","control"),a(e,"class","field is-grouped is-grouped-right")},m(d,p){E(d,e,p),s(e,t),s(t,o),s(o,n);for(let _=0;_<i.length;_+=1)i[_]&&i[_].m(n,null);De(n,l[1]),u||(r=Z(n,"change",l[2]),u=!0)},p(d,[p]){if(p&1){c=d[0];let _;for(_=0;_<c.length;_+=1){const m=Do(d,c,_);i[_]?i[_].p(m,p):(i[_]=Mo(m),i[_].c(),i[_].m(n,null))}for(;_<i.length;_+=1)i[_].d(1);i.length=c.length}p&3&&De(n,d[1])},i:ye,o:ye,d(d){d&&A(e),Ye(i,d),u=!1,r()}}}function Jr(l,e,t){let o,n,u,r;Re(l,St,m=>t(5,o=m)),Re(l,je,m=>t(6,n=m)),Re(l,fo,m=>t(0,u=m)),Re(l,At,m=>t(1,r=m));let c="";async function i(){try{je.set(window.__TAURI__!==void 0),n?(console.log("Loading config from Tauri"),We("get_config").then(m=>{console.log("get_config response",m),m&&m.status==="success"&&d(m.config)}).catch(m=>console.error("Error fetching config in Tauri:",m))):(console.log("Loading config from server"),c=`${pt.ServerURL}/config/`,fetch(c).then(m=>m.json()).then(m=>{console.log("Config received",m),m&&m.status==="success"&&d(m.config)}).catch(m=>console.error("Error fetching config:",m)))}catch(m){console.error("Unhandled error in loadConfig:",m)}}function d(m){var k;console.log("Updating stores from config:",m);const y={default_role:m.selected_role,...m};St.set(y);const h=Object.entries(m.roles).map(([C,v])=>({name:C,...v}));fo.set(h),At.set(m.selected_role);const b=m.roles[m.selected_role];if(console.log("Selected role settings:",b),b){const C=b.theme||"spacelab";console.log("Setting theme to:",C),pl.set(C),(k=b.kg)!=null&&k.publish?n?We("publish_thesaurus",{roleName:m.selected_role}).then(v=>{console.log("publish_thesaurus response",v),fl.set(v),$t.set(!0)}):(console.log("Fetching thesaurus from HTTP endpoint for role",m.selected_role),fetch(`${pt.ServerURL}/thesaurus/${encodeURIComponent(m.selected_role)}`).then(v=>v.json()).then(v=>{console.log("thesaurus HTTP response",v),v&&v.status==="success"&&v.thesaurus?(fl.set(v.thesaurus),$t.set(!0)):(console.error("Failed to fetch thesaurus:",v),$t.set(!1))}).catch(v=>{console.error("Error fetching thesaurus:",v),$t.set(!1)})):$t.set(!1)}else console.warn("No role settings found for:",m.selected_role),pl.set("spacelab")}typeof window<"u"&&window.__TAURI__&&Br("role_changed",m=>{console.log("Role changed event received from backend:",m.payload),d(m.payload)});async function p(){await i()}p(),console.log("Using Terraphim Server URL:",pt.ServerURL);function _(m){var C,v;const h=m.currentTarget.value;console.log("Role change requested:",h),At.set(h);const b=u.find(w=>w.name===h);if(!b){console.error(`No role settings found for role: ${h}.`);return}const k=b.theme||"spacelab";pl.set(k),console.log(`Theme changed to ${k}`),St.update(w=>(w.selected_role=h,w)),n?(We("select_role",{roleName:h}).catch(w=>console.error("Error selecting role:",w)),(C=b.kg)!=null&&C.publish?(console.log("Publishing thesaurus for role",h),We("publish_thesaurus",{roleName:h}).then(w=>{fl.set(w),$t.set(!0)})):$t.set(!1)):(fetch(`${pt.ServerURL}/config/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).catch(w=>console.error("Error updating config on server:",w)),(v=b.kg)!=null&&v.publish?(console.log("Fetching thesaurus from HTTP endpoint for role",h),fetch(`${pt.ServerURL}/thesaurus/${encodeURIComponent(h)}`).then(w=>w.json()).then(w=>{console.log("thesaurus HTTP response",w),w&&w.status==="success"&&w.thesaurus?(fl.set(w.thesaurus),$t.set(!0)):(console.error("Failed to fetch thesaurus:",w),$t.set(!1))}).catch(w=>{console.error("Error fetching thesaurus:",w),$t.set(!1)})):$t.set(!1))}return[u,r,_,i]}class Ll extends _t{constructor(e){super(),mt(this,e,Jr,qr,it,{loadConfig:3})}get loadConfig(){return this.$$.ctx[3]}}function jo(l,e,t){const o=l.slice();return o[33]=e[t],o}function Ho(l,e,t){const o=l.slice();return o[36]=e[t],o}function zo(l){let e,t;return e=new Jn({props:{$$slots:{default:[Vr]},$$scope:{ctx:l}}}),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},p(o,n){const u={};n[0]&129|n[1]&256&&(u.$$scope={dirty:n,ctx:o}),e.$set(u)},i(o){t||(W(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function Qr(l){let e=l[36]+"",t;return{c(){t=F(e)},m(o,n){E(o,t,n)},p(o,n){n[0]&1&&e!==(e=o[36]+"")&&_e(t,e)},d(o){o&&A(t)}}}function Fo(l){let e,t,o,n,u,r;t=new Qn({props:{rounded:!0,$$slots:{default:[Qr]},$$scope:{ctx:l}}});function c(){return l[18](l[36])}return{c(){e=f("button"),ae(t.$$.fragment),o=g(),a(e,"class","tag-button svelte-2smypa"),e.disabled=l[7],a(e,"title","Click to view knowledge graph document")},m(i,d){E(i,e,d),ue(t,e,null),s(e,o),n=!0,u||(r=Z(e,"click",c),u=!0)},p(i,d){l=i;const p={};d[0]&1|d[1]&256&&(p.$$scope={dirty:d,ctx:l}),t.$set(p),(!n||d[0]&128)&&(e.disabled=l[7])},i(i){n||(W(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&A(e),ce(t),u=!1,r()}}}function Vr(l){let e,t,o=l[0].tags,n=[];for(let r=0;r<o.length;r+=1)n[r]=Fo(Ho(l,o,r));const u=r=>V(n[r],1,1,()=>{n[r]=null});return{c(){for(let r=0;r<n.length;r+=1)n[r].c();e=at()},m(r,c){for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(r,c);E(r,e,c),t=!0},p(r,c){if(c[0]&65665){o=r[0].tags;let i;for(i=0;i<o.length;i+=1){const d=Ho(r,o,i);n[i]?(n[i].p(d,c),W(n[i],1)):(n[i]=Fo(d),n[i].c(),W(n[i],1),n[i].m(e.parentNode,e))}for(Ke(),i=o.length;i<n.length;i+=1)u(i);Ge()}},i(r){if(!t){for(let c=0;c<o.length;c+=1)W(n[c]);t=!0}},o(r){n=n.filter(Boolean);for(let c=0;c<n.length;c+=1)V(n[c]);t=!1},d(r){Ye(n,r),r&&A(e)}}}function Yr(l){let e,t=(l[0].rank||0)+"",o;return{c(){e=F("Rank "),o=F(t)},m(n,u){E(n,e,u),E(n,o,u)},p(n,u){u[0]&1&&t!==(t=(n[0].rank||0)+"")&&_e(o,t)},d(n){n&&A(e),n&&A(o)}}}function Zr(l){let e,t;return e=new Qn({props:{rounded:!0,$$slots:{default:[Yr]},$$scope:{ctx:l}}}),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},p(o,n){const u={};n[0]&1|n[1]&256&&(u.$$scope={dirty:n,ctx:o}),e.$set(u)},i(o){t||(W(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function Xr(l){let e;return{c(){e=f("small"),e.textContent="No description available",a(e,"class","no-description svelte-2smypa")},m(t,o){E(t,e,o)},p:ye,i:ye,o:ye,d(t){t&&A(e)}}}function xr(l){let e,t;return e=new Ol({props:{source:l[0].description}}),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},p(o,n){const u={};n[0]&1&&(u.source=o[0].description),e.$set(u)},i(o){t||(W(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function Ko(l){let e,t,o,n,u,r;return{c(){e=f("button"),t=f("span"),t.innerHTML='<i class="fas fa-magic" aria-hidden="true"></i>',o=g(),n=f("span"),n.textContent="AI Summary",a(t,"class","icon is-small"),a(e,"class","button is-small is-info is-outlined ai-summary-button svelte-2smypa"),e.disabled=l[9],a(e,"title","Generate AI-powered summary using OpenRouter")},m(c,i){E(c,e,i),s(e,t),s(e,o),s(e,n),u||(r=Z(e,"click",l[17]),u=!0)},p(c,i){i[0]&512&&(e.disabled=c[9])},d(c){c&&A(e),u=!1,r()}}}function Go(l){let e;return{c(){e=f("div"),e.innerHTML=`<span class="icon"><i class="fas fa-spinner fa-spin" aria-hidden="true"></i></span> 
                <small>Generating AI summary...</small>`,a(e,"class","ai-summary-loading svelte-2smypa")},m(t,o){E(t,e,o)},d(t){t&&A(e)}}}function Wo(l){let e,t,o,n,u,r,c,i,d,p;return{c(){e=f("div"),t=f("span"),t.innerHTML='<i class="fas fa-exclamation-triangle" aria-hidden="true"></i>',o=g(),n=f("small"),u=F("Summary error: "),r=F(l[10]),c=g(),i=f("button"),i.textContent="Retry",a(t,"class","icon has-text-danger"),a(n,"class","has-text-danger"),a(i,"class","button is-small is-text svelte-2smypa"),a(i,"title","Retry generating summary"),a(e,"class","ai-summary-error svelte-2smypa")},m(_,m){E(_,e,m),s(e,t),s(e,o),s(e,n),s(n,u),s(n,r),s(e,c),s(e,i),d||(p=Z(i,"click",l[19]),d=!0)},p(_,m){m[0]&1024&&_e(r,_[10])},d(_){_&&A(e),d=!1,p()}}}function Bo(l){let e,t,o,n,u,r,c,i,d,p,_,m,y,h,b,k,C,v,w,T;function J(N,q){return N[12]?ti:ei}let U=J(l),H=U(l);return p=new Ol({props:{source:l[8]}}),{c(){e=f("div"),t=f("div"),o=f("small"),n=f("span"),n.innerHTML='<i class="fas fa-robot" aria-hidden="true"></i>',u=F(`
                    AI Summary
                    `),H.c(),r=g(),c=f("button"),c.innerHTML='<span class="icon is-small"><i class="fas fa-times" aria-hidden="true"></i></span>',i=g(),d=f("div"),ae(p.$$.fragment),_=g(),m=f("div"),y=f("button"),h=f("span"),h.innerHTML='<i class="fas fa-redo" aria-hidden="true"></i>',b=g(),k=f("span"),k.textContent="Regenerate",a(n,"class","icon is-small"),a(o,"class","ai-summary-label svelte-2smypa"),a(c,"class","button is-small is-text svelte-2smypa"),a(c,"title","Hide AI summary"),a(t,"class","ai-summary-header svelte-2smypa"),a(d,"class","ai-summary-content svelte-2smypa"),a(h,"class","icon is-small"),a(y,"class","button is-small is-text svelte-2smypa"),y.disabled=l[9],a(y,"title","Regenerate summary"),a(m,"class","ai-summary-actions svelte-2smypa"),a(e,"class","ai-summary svelte-2smypa")},m(N,q){E(N,e,q),s(e,t),s(t,o),s(o,n),s(o,u),H.m(o,null),s(t,r),s(t,c),s(e,i),s(e,d),ue(p,d,null),s(e,_),s(e,m),s(m,y),s(y,h),s(y,b),s(y,k),v=!0,w||(T=[Z(c,"click",l[20]),Z(y,"click",l[21])],w=!0)},p(N,q){U!==(U=J(N))&&(H.d(1),H=U(N),H&&(H.c(),H.m(o,null)));const G={};q[0]&256&&(G.source=N[8]),p.$set(G),(!v||q[0]&512)&&(y.disabled=N[9])},i(N){v||(W(p.$$.fragment,N),rt(()=>{v&&(C||(C=nl(e,sl,{},!0)),C.run(1))}),v=!0)},o(N){V(p.$$.fragment,N),C||(C=nl(e,sl,{},!1)),C.run(0),v=!1},d(N){N&&A(e),H.d(),ce(p),N&&C&&C.end(),w=!1,Je(T)}}}function ei(l){let e;return{c(){e=f("span"),e.textContent="fresh",a(e,"class","tag is-small is-success")},m(t,o){E(t,e,o)},d(t){t&&A(e)}}}function ti(l){let e;return{c(){e=f("span"),e.textContent="cached",a(e,"class","tag is-small is-light")},m(t,o){E(t,e,o)},d(t){t&&A(e)}}}function qo(l){let e;function t(u,r){return u[33].disabled?ni:u[33].isLink?oi:li}let o=t(l),n=o(l);return{c(){n.c(),e=at()},m(u,r){n.m(u,r),E(u,e,r)},p(u,r){o===(o=t(u))&&n?n.p(u,r):(n.d(1),n=o(u),n&&(n.c(),n.m(e.parentNode,e)))},d(u){n.d(u),u&&A(e)}}}function li(l){let e,t,o,n,u,r,c,i,d;return{c(){e=f("button"),t=f("span"),o=f("i"),u=g(),a(o,"class",n=Pt(l[33].icon)+" svelte-2smypa"),a(t,"class","icon is-medium"),It(t,"has-text-primary",l[33].className),a(e,"type","button"),a(e,"class","level-item button is-ghost svelte-2smypa"),a(e,"aria-label",r=l[33].title),a(e,"title",c=l[33].title)},m(p,_){E(p,e,_),s(e,t),s(t,o),s(e,u),i||(d=Z(e,"click",function(){jl(l[33].action)&&l[33].action.apply(this,arguments)}),i=!0)},p(p,_){l=p,_[0]&16384&&n!==(n=Pt(l[33].icon)+" svelte-2smypa")&&a(o,"class",n),_[0]&16384&&It(t,"has-text-primary",l[33].className),_[0]&16384&&r!==(r=l[33].title)&&a(e,"aria-label",r),_[0]&16384&&c!==(c=l[33].title)&&a(e,"title",c)},d(p){p&&A(e),i=!1,d()}}}function oi(l){let e,t,o,n,u,r,c,i;return{c(){e=f("a"),t=f("span"),o=f("i"),u=g(),a(o,"class",n=Pt(l[33].icon)+" svelte-2smypa"),a(t,"class","icon is-medium"),It(t,"has-text-primary",l[33].className),a(e,"href",r=l[33].href),a(e,"target","_blank"),a(e,"class","level-item"),a(e,"aria-label",c=l[33].title),a(e,"title",i=l[33].title)},m(d,p){E(d,e,p),s(e,t),s(t,o),s(e,u)},p(d,p){p[0]&16384&&n!==(n=Pt(d[33].icon)+" svelte-2smypa")&&a(o,"class",n),p[0]&16384&&It(t,"has-text-primary",d[33].className),p[0]&16384&&r!==(r=d[33].href)&&a(e,"href",r),p[0]&16384&&c!==(c=d[33].title)&&a(e,"aria-label",c),p[0]&16384&&i!==(i=d[33].title)&&a(e,"title",i)},d(d){d&&A(e)}}}function ni(l){let e,t,o,n,u,r,c;return{c(){e=f("button"),t=f("span"),o=f("i"),u=g(),a(o,"class",n=Pt(l[33].icon)+" svelte-2smypa"),a(t,"class","icon is-medium"),It(t,"has-text-primary",l[33].className),a(e,"type","button"),a(e,"class","level-item button is-ghost svelte-2smypa"),a(e,"aria-label",r=l[33].title),a(e,"title",c=l[33].title),e.disabled=!0},m(i,d){E(i,e,d),s(e,t),s(t,o),s(e,u)},p(i,d){d[0]&16384&&n!==(n=Pt(i[33].icon)+" svelte-2smypa")&&a(o,"class",n),d[0]&16384&&It(t,"has-text-primary",i[33].className),d[0]&16384&&r!==(r=i[33].title)&&a(e,"aria-label",r),d[0]&16384&&c!==(c=i[33].title)&&a(e,"title",c)},d(i){i&&A(e)}}}function Jo(l){let e,t=l[33].visible&&qo(l);return{c(){t&&t.c(),e=at()},m(o,n){t&&t.m(o,n),E(o,e,n)},p(o,n){o[33].visible?t?t.p(o,n):(t=qo(o),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(o){t&&t.d(o),o&&A(e)}}}function Qo(l){let e,t,o;function n(r){l[23](r)}let u={item:l[4],kgTerm:l[5],kgRank:l[6]};return l[2]!==void 0&&(u.active=l[2]),e=new Hl({props:u}),Ve.push(()=>xe(e,"active",n)),{c(){ae(e.$$.fragment)},m(r,c){ue(e,r,c),o=!0},p(r,c){const i={};c[0]&16&&(i.item=r[4]),c[0]&32&&(i.kgTerm=r[5]),c[0]&64&&(i.kgRank=r[6]),!t&&c[0]&4&&(t=!0,i.active=r[2],et(()=>t=!1)),e.$set(i)},i(r){o||(W(e.$$.fragment,r),o=!0)},o(r){V(e.$$.fragment,r),o=!1},d(r){ce(e,r)}}}function Vo(l){let e,t,o;function n(r){l[24](r)}let u={document:l[0]};return l[3]!==void 0&&(u.active=l[3]),e=new Kr({props:u}),Ve.push(()=>xe(e,"active",n)),{c(){ae(e.$$.fragment)},m(r,c){ue(e,r,c),o=!0},p(r,c){const i={};c[0]&1&&(i.document=r[0]),!t&&c[0]&8&&(t=!0,i.active=r[3],et(()=>t=!1)),e.$set(i)},i(r){o||(W(e.$$.fragment,r),o=!0)},o(r){V(e.$$.fragment,r),o=!1},d(r){ce(e,r)}}}function si(l){let e,t,o,n,u,r,c,i,d,p,_,m,y=l[0].title+"",h,b,k,C,v,w,T,J,U,H,N,q,G,K,R,L,O,S,z,x,B,Y,$,P,I,D,Q,ee,ne,ke,be=l[0].tags&&zo(l);i=new Jn({props:{$$slots:{default:[Zr]},$$scope:{ctx:l}}});const Pe=[xr,Xr],pe=[];function fe(le,we){return le[0].description?0:1}T=fe(l),J=pe[T]=Pe[T](l);let ie=!l[11]&&!l[9]&&!l[10]&&Ko(l),Ce=l[9]&&Go(),Te=l[10]&&Wo(l),oe=l[11]&&l[8]&&Bo(l),he=l[14],se=[];for(let le=0;le<he.length;le+=1)se[le]=Jo(jo(l,he,le));function ve(le){l[22](le)}let Be={item:l[0]};l[1]!==void 0&&(Be.active=l[1]),$=new Hl({props:Be}),Ve.push(()=>xe($,"active",ve));let Se=l[4]&&Qo(l),Ne=l[13]&&Vo(l);return{c(){e=f("div"),t=f("article"),o=f("div"),n=f("div"),u=f("div"),be&&be.c(),r=g(),c=f("div"),ae(i.$$.fragment),d=g(),p=f("div"),_=f("button"),m=f("h2"),h=F(y),b=g(),k=f("div"),C=f("small"),C.textContent="Description:",v=g(),w=f("div"),J.c(),U=g(),H=f("div"),ie&&ie.c(),N=g(),Ce&&Ce.c(),q=g(),Te&&Te.c(),G=g(),oe&&oe.c(),K=g(),R=f("br"),O=g(),S=f("div"),z=f("nav"),x=f("div");for(let le=0;le<se.length;le+=1)se[le].c();Y=g(),ae($.$$.fragment),I=g(),Se&&Se.c(),D=g(),Ne&&Ne.c(),Q=at(),a(u,"class","level-right"),a(c,"class","level-right"),a(m,"class","title svelte-2smypa"),a(_,"class","svelte-2smypa"),a(C,"class","description-label svelte-2smypa"),a(w,"class","description-content svelte-2smypa"),a(k,"class","description svelte-2smypa"),a(H,"class","ai-summary-section svelte-2smypa"),a(n,"class","content"),a(x,"class","level-right"),a(z,"class","level is-mobile"),a(S,"class","level-right"),a(o,"class","media-content"),a(t,"class","media"),a(e,"class","box")},m(le,we){E(le,e,we),s(e,t),s(t,o),s(o,n),s(n,u),be&&be.m(u,null),s(n,r),s(n,c),ue(i,c,null),s(n,d),s(n,p),s(p,_),s(_,m),s(m,h),s(p,b),s(p,k),s(k,C),s(k,v),s(k,w),pe[T].m(w,null),s(p,U),s(p,H),ie&&ie.m(H,null),s(H,N),Ce&&Ce.m(H,null),s(H,q),Te&&Te.m(H,null),s(H,G),oe&&oe.m(H,null),s(p,K),s(p,R),s(o,O),s(o,S),s(S,z),s(z,x);for(let Ue=0;Ue<se.length;Ue+=1)se[Ue]&&se[Ue].m(x,null);E(le,Y,we),ue($,le,we),E(le,I,we),Se&&Se.m(le,we),E(le,D,we),Ne&&Ne.m(le,we),E(le,Q,we),ee=!0,ne||(ke=Z(_,"click",l[15]),ne=!0)},p(le,we){le[0].tags?be?(be.p(le,we),we[0]&1&&W(be,1)):(be=zo(le),be.c(),W(be,1),be.m(u,null)):be&&(Ke(),V(be,1,1,()=>{be=null}),Ge());const Ue={};we[0]&1|we[1]&256&&(Ue.$$scope={dirty:we,ctx:le}),i.$set(Ue),(!ee||we[0]&1)&&y!==(y=le[0].title+"")&&_e(h,y);let Xe=T;if(T=fe(le),T===Xe?pe[T].p(le,we):(Ke(),V(pe[Xe],1,1,()=>{pe[Xe]=null}),Ge(),J=pe[T],J?J.p(le,we):(J=pe[T]=Pe[T](le),J.c()),W(J,1),J.m(w,null)),!le[11]&&!le[9]&&!le[10]?ie?ie.p(le,we):(ie=Ko(le),ie.c(),ie.m(H,N)):ie&&(ie.d(1),ie=null),le[9]?Ce||(Ce=Go(),Ce.c(),Ce.m(H,q)):Ce&&(Ce.d(1),Ce=null),le[10]?Te?Te.p(le,we):(Te=Wo(le),Te.c(),Te.m(H,G)):Te&&(Te.d(1),Te=null),le[11]&&le[8]?oe?(oe.p(le,we),we[0]&2304&&W(oe,1)):(oe=Bo(le),oe.c(),W(oe,1),oe.m(H,null)):oe&&(Ke(),V(oe,1,1,()=>{oe=null}),Ge()),we[0]&16384){he=le[14];let Oe;for(Oe=0;Oe<he.length;Oe+=1){const ht=jo(le,he,Oe);se[Oe]?se[Oe].p(ht,we):(se[Oe]=Jo(ht),se[Oe].c(),se[Oe].m(x,null))}for(;Oe<se.length;Oe+=1)se[Oe].d(1);se.length=he.length}const He={};we[0]&1&&(He.item=le[0]),!P&&we[0]&2&&(P=!0,He.active=le[1],et(()=>P=!1)),$.$set(He),le[4]?Se?(Se.p(le,we),we[0]&16&&W(Se,1)):(Se=Qo(le),Se.c(),W(Se,1),Se.m(D.parentNode,D)):Se&&(Ke(),V(Se,1,1,()=>{Se=null}),Ge()),le[13]?Ne?(Ne.p(le,we),we[0]&8192&&W(Ne,1)):(Ne=Vo(le),Ne.c(),W(Ne,1),Ne.m(Q.parentNode,Q)):Ne&&(Ke(),V(Ne,1,1,()=>{Ne=null}),Ge())},i(le){ee||(W(be),W(i.$$.fragment,le),W(J),W(oe),rt(()=>{ee&&(L||(L=nl(p,sl,{},!0)),L.run(1))}),rt(()=>{ee&&(B||(B=nl(z,sl,{},!0)),B.run(1))}),W($.$$.fragment,le),W(Se),W(Ne),ee=!0)},o(le){V(be),V(i.$$.fragment,le),V(J),V(oe),L||(L=nl(p,sl,{},!1)),L.run(0),B||(B=nl(z,sl,{},!1)),B.run(0),V($.$$.fragment,le),V(Se),V(Ne),ee=!1},d(le){le&&A(e),be&&be.d(),ce(i),pe[T].d(),ie&&ie.d(),Ce&&Ce.d(),Te&&Te.d(),oe&&oe.d(),le&&L&&L.end(),Ye(se,le),le&&B&&B.end(),le&&A(Y),ce($,le),le&&A(I),Se&&Se.d(le),le&&A(D),Ne&&Ne.d(le),le&&A(Q),ne=!1,ke()}}}function ri(l,e,t){let o,n,u,r,c;Re(l,At,$=>t(25,u=$)),Re(l,je,$=>t(26,r=$)),Re(l,St,$=>t(27,c=$));let{document:i}=e,d=!1,p=!1,_=!1,m=null,y=null,h=null,b=!1,k=null,C=!1,v=null,w=!1,T=!1;function J(){const $=[];return $.push({id:"download-markdown",label:"Download to Markdown",icon:"fas fa-download",action:()=>K(),visible:!0,title:"Download document as markdown file"}),o&&$.push({id:"save-atomic",label:"Save to Atomic Server",icon:"fas fa-cloud-upload-alt",action:()=>N(),visible:!0,title:"Save article to Atomic Server",className:"has-text-primary"}),i.url&&$.push({id:"external-url",label:"Open URL",icon:"fas fa-link",action:()=>window.open(i.url,"_blank"),visible:!0,title:"Open original URL in new tab",isLink:!0,href:i.url}),$.push({id:"open-vscode",label:"Open in VSCode",icon:"fas fa-code",action:()=>R(),visible:!0,title:"Open document in VSCode",isLink:!0,href:`vscode://${encodeURIComponent(i.title)}.md?${encodeURIComponent(i.body)}`}),$.push({id:"add-favorites",label:"Add to Favorites",icon:"fas fa-plus",action:()=>{},visible:!0,title:"Add to favorites (coming soon)",disabled:!0}),$}function U(){var Q;const $=u,P=c;if(!(P!=null&&P.roles)||!$)return!1;let I=null;try{for(const[ee,ne]of Object.entries(P.roles)){const ke=ne,be=typeof ke.name=="object"?ke.name.original:String(ke.name);if(ee===$||be===$){I=ke;break}}}catch(ee){return console.warn("Error checking role configuration:",ee),!1}return I?(((Q=I.haystacks)==null?void 0:Q.filter(ee=>ee.service==="Atomic"&&ee.location&&!ee.read_only))||[]).length>0:!1}const H=()=>{t(1,d=!0)},N=()=>{console.log("🔄 Opening atomic save modal for document:",i.title),t(3,_=!0)};async function q($){var P,I,D,Q,ee;t(7,b=!0),t(5,y=$),console.log("🔍 KG Search Debug Info:"),console.log("  Tag clicked:",$),console.log("  Current role:",u),console.log("  Is Tauri mode:",r);try{if(r){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:u,term:$});const ne=await We("find_documents_for_kg_term",{roleName:u,term:$});console.log("  📥 Tauri response received:"),console.log("    Status:",ne.status),console.log("    Results count:",((P=ne.results)==null?void 0:P.length)||0),console.log("    Total:",ne.total||0),console.log("    Full response:",JSON.stringify(ne,null,2)),ne.status==="success"&&ne.results&&ne.results.length>0?(t(4,m=ne.results[0]),t(6,h=m.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",m.title),console.log("    Rank:",h),console.log("    Body length:",((I=m.body)==null?void 0:I.length)||0,"characters"),t(2,p=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${$}" in role: "${u}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const ne=pt.ServerURL,ke=encodeURIComponent(u),be=encodeURIComponent($),Pe=`${ne}/roles/${ke}/kg_search?term=${be}`;console.log("  📤 HTTP Request details:"),console.log("    Base URL:",ne),console.log("    Role (encoded):",ke),console.log("    Term (encoded):",be),console.log("    Full URL:",Pe);const pe=await fetch(Pe);if(console.log("  📥 HTTP Response received:"),console.log("    Status code:",pe.status),console.log("    Status text:",pe.statusText),console.log("    Headers:",Object.fromEntries(pe.headers.entries())),!pe.ok)throw new Error(`HTTP error! Status: ${pe.status} - ${pe.statusText}`);const fe=await pe.json();console.log("  📄 Response data:"),console.log("    Status:",fe.status),console.log("    Results count:",((D=fe.results)==null?void 0:D.length)||0),console.log("    Total:",fe.total||0),console.log("    Full response:",JSON.stringify(fe,null,2)),fe.status==="success"&&fe.results&&fe.results.length>0?(t(4,m=fe.results[0]),t(6,h=m.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",m.title),console.log("    Rank:",h),console.log("    Body length:",((Q=m.body)==null?void 0:Q.length)||0,"characters"),t(2,p=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${$}" in role: "${u}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",Pe))}}catch(ne){console.error("❌ Error fetching KG document:"),console.error("  Error type:",ne.constructor.name),console.error("  Error message:",ne.message||ne),console.error("  Request details:",{tag:$,role:u,isTauri:r,timestamp:new Date().toISOString()}),!r&&((ee=ne.message)!=null&&ee.includes("Failed to fetch"))&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{t(7,b=!1)}}async function G(){var $;if(!(C||!i.id||!u)){t(9,C=!0),t(10,v=null),console.log("🤖 AI Summary Debug Info:"),console.log("  Document ID:",i.id),console.log("  Current role:",u),console.log("  Is Tauri mode:",r);try{const P={document_id:i.id,role:u,max_length:250,force_regenerate:!1};console.log("  📤 Summarization request:",P);let I;if(r){const ee=`${pt.ServerURL}/documents/summarize`;I=await fetch(ee,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(P)})}else{const ee=`${pt.ServerURL}/documents/summarize`;I=await fetch(ee,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(P)})}if(console.log("  📥 Summary response received:"),console.log("    Status code:",I.status),console.log("    Status text:",I.statusText),!I.ok)throw new Error(`HTTP error! Status: ${I.status} - ${I.statusText}`);const D=await I.json();console.log("  📄 Summary response data:",D),D.status==="Success"&&D.summary?(t(8,k=D.summary),t(12,T=D.from_cache||!1),t(11,w=!0),console.log("  ✅ Summary generated successfully"),console.log("    Summary length:",k.length,"characters"),console.log("    From cache:",T),console.log("    Model used:",D.model_used)):(t(10,v=D.error||"Failed to generate summary"),console.error("  ❌ Summary generation failed:",v))}catch(P){console.error("❌ Error generating summary:"),console.error("  Error type:",P.constructor.name),console.error("  Error message:",P.message||P),console.error("  Request details:",{document_id:i.id,role:u,isTauri:r,timestamp:new Date().toISOString()}),t(10,v=P.message||"Network error occurred"),($=P.message)!=null&&$.includes("Failed to fetch")&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Verify OpenRouter is enabled for this role"),console.error("    3. Check OPENROUTER_KEY environment variable"),console.error("    4. Verify server URL in CONFIG.ServerURL"))}finally{t(9,C=!1)}}}function K(){console.log("📥 Downloading document as markdown:",i.title);let $=`# ${i.title}

`;$+=`**Source:** Terraphim Search
`,$+=`**Rank:** ${i.rank||"N/A"}
`,i.url&&($+=`**URL:** ${i.url}
`),i.tags&&i.tags.length>0&&($+=`**Tags:** ${i.tags.join(", ")}
`),$+=`**Downloaded:** ${new Date().toISOString()}

`,i.description&&($+=`## Description

${i.description}

`),$+=`## Content

${i.body}
`;const P=`${i.title.replace(/[^a-z0-9]/gi,"_").toLowerCase()}_${Date.now()}.md`,I=new Blob([$],{type:"text/markdown"}),D=URL.createObjectURL(I),Q=window.document.createElement("a");Q.href=D,Q.download=P,window.document.body.appendChild(Q),Q.click(),window.document.body.removeChild(Q),URL.revokeObjectURL(D),console.log("✅ Markdown file downloaded:",P)}function R(){const $=`vscode://${encodeURIComponent(i.title)}.md?${encodeURIComponent(i.body)}`;window.open($,"_blank")}Ll[u]!==void 0&&(console.log("Have attribute",Ll[u]),Ll[u].hasOwnProperty("enableLogseq")?console.log("enable logseq True"):console.log("Didn't make it"));const L=$=>q($),O=()=>{t(10,v=null),G()},S=()=>t(11,w=!1),z=()=>{G()};function x($){d=$,t(1,d)}function B($){p=$,t(2,p)}function Y($){_=$,t(3,_)}return l.$$set=$=>{"document"in $&&t(0,i=$.document)},t(13,o=U()),t(14,n=J()),[i,d,p,_,m,y,h,b,k,C,v,w,T,o,n,H,q,G,L,O,S,z,x,B,Y]}class ii extends _t{constructor(e){super(),mt(this,e,ri,si,it,{document:0},null,[-1,-1])}}const ai="/assets/terraphim_gray.png";function ui(l){const e=l.trim();if(!e)return{hasOperator:!1,operator:null,terms:[l],originalQuery:l};const t=/\b(and)\b/i,o=/\b(or)\b/i,n=t.test(e),u=o.test(e);if(n&&!u)return{hasOperator:!0,operator:"AND",terms:e.split(t).filter((c,i)=>i%2===0).map(c=>c.trim()).filter(c=>c.length>0),originalQuery:l};if(u&&!n)return{hasOperator:!0,operator:"OR",terms:e.split(o).filter((c,i)=>i%2===0).map(c=>c.trim()).filter(c=>c.length>0),originalQuery:l};if(n&&u){const r=e.toLowerCase().indexOf(" and "),c=e.toLowerCase().indexOf(" or ");if(r!==-1&&(c===-1||r<c))return{hasOperator:!0,operator:"AND",terms:e.split(t).filter((d,p)=>p%2===0).map(d=>d.trim()).filter(d=>d.length>0),originalQuery:l};if(c!==-1)return{hasOperator:!0,operator:"OR",terms:e.split(o).filter((d,p)=>p%2===0).map(d=>d.trim()).filter(d=>d.length>0),originalQuery:l}}return{hasOperator:!1,operator:null,terms:[e],originalQuery:l}}function Yo(l,e){var o,n;if(l.hasOperator&&l.terms.length>1){const u=l.terms.filter(r=>r.trim().length>0);if(u.length>1)return{search_term:u[0],search_terms:u,operator:(o=l.operator)==null?void 0:o.toLowerCase(),skip:0,limit:50,role:e||null}}return{search_term:((n=l.terms[0])==null?void 0:n.trim())||"",search_terms:void 0,operator:void 0,skip:0,limit:50,role:e||null}}function Zo(l,e,t){const o=l.slice();return o[27]=e[t],o}function Xo(l,e,t){const o=l.slice();return o[30]=e[t],o[32]=t,o}function xo(l){let e,t=l[2],o=[];for(let n=0;n<t.length;n+=1)o[n]=en(Xo(l,t,n));return{c(){e=f("ul");for(let n=0;n<o.length;n+=1)o[n].c();a(e,"class","suggestions svelte-e76e8j")},m(n,u){E(n,e,u);for(let r=0;r<o.length;r+=1)o[r]&&o[r].m(e,null)},p(n,u){if(u[0]&1036){t=n[2];let r;for(r=0;r<t.length;r+=1){const c=Xo(n,t,r);o[r]?o[r].p(c,u):(o[r]=en(c),o[r].c(),o[r].m(e,null))}for(;r<o.length;r+=1)o[r].d(1);o.length=t.length}},d(n){n&&A(e),Ye(o,n)}}}function en(l){let e,t=l[30]+"",o,n,u,r,c,i;function d(){return l[14](l[30])}function p(..._){return l[15](l[30],..._)}return{c(){e=f("li"),o=F(t),n=g(),a(e,"tabindex","0"),a(e,"role","option"),a(e,"aria-selected",u=l[32]===l[3]),a(e,"aria-label",r=`Apply suggestion: ${l[30]}`),a(e,"class","svelte-e76e8j"),It(e,"active",l[32]===l[3])},m(_,m){E(_,e,m),s(e,o),s(e,n),c||(i=[Z(e,"click",d),Z(e,"keydown",p)],c=!0)},p(_,m){l=_,m[0]&4&&t!==(t=l[30]+"")&&_e(o,t),m[0]&8&&u!==(u=l[32]===l[3])&&a(e,"aria-selected",u),m[0]&4&&r!==(r=`Apply suggestion: ${l[30]}`)&&a(e,"aria-label",r),m[0]&8&&It(e,"active",l[32]===l[3])},d(_){_&&A(e),c=!1,Je(i)}}}function ci(l){let e,t,o,n,u,r,c,i,d,p,_,m,y,h,b,k,C,v,w,T,J,U,H;function N(K){l[13](K)}let q={type:"search",placeholder:l[7]?`Search over Knowledge graph for ${l[6]}`:"Search",icon:"search",expanded:!0,autofocus:!0};l[5]!==void 0&&(q.value=l[5]),o=new Jt({props:q}),Ve.push(()=>xe(o,"value",N)),o.$on("click",l[11]),o.$on("submit",l[11]),o.$on("keydown",l[9]),o.$on("input",l[8]);let G=l[2].length>0&&xo(l);return J=qn(l[17][0]),{c(){e=f("div"),t=f("div"),ae(o.$$.fragment),u=g(),G&&G.c(),r=g(),c=f("div"),i=f("div"),d=f("label"),p=f("input"),_=F(`
            Exact`),m=g(),y=f("label"),h=f("input"),b=F(`
            All (AND)`),k=g(),C=f("label"),v=f("input"),w=F(`
            Any (OR)`),a(t,"class","input-wrapper svelte-e76e8j"),a(p,"type","radio"),p.__value="none",p.value=p.__value,a(p,"class","svelte-e76e8j"),a(d,"class","radio svelte-e76e8j"),a(h,"type","radio"),h.__value="and",h.value=h.__value,a(h,"class","svelte-e76e8j"),a(y,"class","radio svelte-e76e8j"),a(v,"type","radio"),v.__value="or",v.value=v.__value,a(v,"class","svelte-e76e8j"),a(C,"class","radio svelte-e76e8j"),a(i,"class","control svelte-e76e8j"),a(c,"class","operator-controls svelte-e76e8j"),a(e,"class","search-row svelte-e76e8j"),J.p(p,h,v)},m(K,R){E(K,e,R),s(e,t),ue(o,t,null),s(t,u),G&&G.m(t,null),s(e,r),s(e,c),s(c,i),s(i,d),s(d,p),p.checked=p.__value===l[4],s(d,_),s(i,m),s(i,y),s(y,h),h.checked=h.__value===l[4],s(y,b),s(i,k),s(i,C),s(C,v),v.checked=v.__value===l[4],s(C,w),T=!0,U||(H=[Z(p,"change",l[16]),Z(h,"change",l[18]),Z(v,"change",l[19])],U=!0)},p(K,R){const L={};R[0]&192&&(L.placeholder=K[7]?`Search over Knowledge graph for ${K[6]}`:"Search"),!n&&R[0]&32&&(n=!0,L.value=K[5],et(()=>n=!1)),o.$set(L),K[2].length>0?G?G.p(K,R):(G=xo(K),G.c(),G.m(t,null)):G&&(G.d(1),G=null),R[0]&16&&(p.checked=p.__value===K[4]),R[0]&16&&(h.checked=h.__value===K[4]),R[0]&16&&(v.checked=v.__value===K[4])},i(K){T||(W(o.$$.fragment,K),T=!0)},o(K){V(o.$$.fragment,K),T=!1},d(K){K&&A(e),ce(o),G&&G.d(),J.r(),U=!1,Je(H)}}}function fi(l){let e,t,o,n,u,r,c,i,d,p;return{c(){e=f("section"),t=f("div"),o=f("img"),u=g(),r=f("p"),r.textContent="I am Terraphim, your personal assistant.",c=g(),i=f("button"),i.innerHTML=`<span class="icon"><i class="fas fa-magic"></i></span> 
        <span>Configuration Wizard</span>`,ms(o.src,n=ai)||a(o,"src",n),a(o,"alt","Terraphim Logo"),a(o,"class","svelte-e76e8j"),a(i,"class","button is-primary"),a(i,"data-testid","wizard-start"),a(t,"class","content has-text-grey has-text-centered svelte-e76e8j"),a(e,"class","section")},m(_,m){E(_,e,m),s(e,t),s(t,o),s(t,u),s(t,r),s(t,c),s(t,i),d||(p=Z(i,"click",l[20]),d=!0)},p:ye,i:ye,o:ye,d(_){_&&A(e),d=!1,p()}}}function di(l){let e,t,o=l[0],n=[];for(let r=0;r<o.length;r+=1)n[r]=tn(Zo(l,o,r));const u=r=>V(n[r],1,1,()=>{n[r]=null});return{c(){for(let r=0;r<n.length;r+=1)n[r].c();e=at()},m(r,c){for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(r,c);E(r,e,c),t=!0},p(r,c){if(c[0]&1){o=r[0];let i;for(i=0;i<o.length;i+=1){const d=Zo(r,o,i);n[i]?(n[i].p(d,c),W(n[i],1)):(n[i]=tn(d),n[i].c(),W(n[i],1),n[i].m(e.parentNode,e))}for(Ke(),i=o.length;i<n.length;i+=1)u(i);Ge()}},i(r){if(!t){for(let c=0;c<o.length;c+=1)W(n[c]);t=!0}},o(r){n=n.filter(Boolean);for(let c=0;c<n.length;c+=1)V(n[c]);t=!1},d(r){Ye(n,r),r&&A(e)}}}function pi(l){let e,t;return{c(){e=f("p"),t=F(l[1]),a(e,"class","error svelte-e76e8j")},m(o,n){E(o,e,n),s(e,t)},p(o,n){n[0]&2&&_e(t,o[1])},i:ye,o:ye,d(o){o&&A(e)}}}function tn(l){let e,t;return e=new ii({props:{document:l[27]}}),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},p(o,n){const u={};n[0]&1&&(u.document=o[27]),e.$set(u)},i(o){t||(W(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function _i(l){let e,t,o,n,u,r,c,i,d,p,_;e=new rl({props:{fallbackPath:"/"}}),n=new Ht({props:{$$slots:{default:[ci]},$$scope:{ctx:l}}});const m=[pi,di,fi],y=[];function h(b,k){return b[1]?0:b[0].length?1:2}return r=h(l),c=y[r]=m[r](l),{c(){ae(e.$$.fragment),t=g(),o=f("form"),ae(n.$$.fragment),u=g(),c.c(),i=at()},m(b,k){ue(e,b,k),E(b,t,k),E(b,o,k),ue(n,o,null),E(b,u,k),y[r].m(b,k),E(b,i,k),d=!0,p||(_=Z(o,"submit",_s(l[11])),p=!0)},p(b,k){const C={};k[0]&252|k[1]&4&&(C.$$scope={dirty:k,ctx:b}),n.$set(C);let v=r;r=h(b),r===v?y[r].p(b,k):(Ke(),V(y[v],1,1,()=>{y[v]=null}),Ge(),c=y[r],c?c.p(b,k):(c=y[r]=m[r](b),c.c()),W(c,1),c.m(i.parentNode,i))},i(b){d||(W(e.$$.fragment,b),W(n.$$.fragment,b),W(c),d=!0)},o(b){V(e.$$.fragment,b),V(n.$$.fragment,b),V(c),d=!1},d(b){ce(e,b),b&&A(t),b&&A(o),ce(n),b&&A(u),y[r].d(b),b&&A(i),p=!1,_()}}}function mi(l,e,t){let o,n,u,r,c,i,d;Re(l,js,O=>t(22,n=O)),Re(l,Al,O=>t(5,u=O)),Re(l,je,O=>t(23,r=O)),Re(l,At,O=>t(6,c=O)),Re(l,fl,O=>t(12,i=O)),Re(l,$t,O=>t(7,d=O));let p=[],_=null,m=[],y=-1,h="none";async function b(O){try{if(r){const S=await We("get_autocomplete_suggestions",{query:O,roleName:c,limit:8});if(S.status==="success"&&S.suggestions)return S.suggestions.map(z=>z.term)}else{const S=await fetch(`${n.replace("/documents/search","")}/autocomplete/${encodeURIComponent(c)}/${encodeURIComponent(O)}`);if(S.ok){const z=await S.json();if(z.status==="success"&&z.suggestions)return z.suggestions.map(x=>x.term)}}return o.filter(([S])=>S.toLowerCase().includes(O.toLowerCase())).map(([S])=>S).slice(0,8)}catch(S){return console.warn("Error fetching term suggestions:",S),[]}}async function k(O){const S=O.trim();if(S.length===0)return[];if(h!=="none"){const $=S.split(/\s+/),P=$[$.length-1].toLowerCase();return P.length<2?[]:b(P)}const x=S.split(/\s+/),B=x[x.length-1].toLowerCase();if(x.length>1&&h==="none"){const $=[];if("and".startsWith(B)&&$.push("AND"),"or".startsWith(B)&&$.push("OR"),$.length>0)return $}const Y=S.toLowerCase();if(Y.includes(" and ")||Y.includes(" or ")){const $=B;return $.length<2?[]:b($)}try{const $=await b(S);return x.length===1&&x[0].length>2&&h==="none"?[...$.slice(0,6),"AND","OR"]:$}catch($){console.warn("Error fetching autocomplete suggestions:",$);const P=o.filter(([I])=>I.toLowerCase().includes(S.toLowerCase())).map(([I])=>I).slice(0,6);return x.length===1&&x[0].length>2&&h==="none"?[...P,"AND","OR"]:P}}async function C(O){const S=O.target;if(!S||S.selectionStart==null)return;const z=S.selectionStart,B=u.slice(0,z).split(/\s+/),Y=B[B.length-1];if(Y.length>=2)try{t(2,m=await k(Y))}catch($){console.warn("Failed to get suggestions:",$),t(2,m=[])}else t(2,m=[]);t(3,y=-1)}function v(O){m.length!==0&&(O.key==="ArrowDown"?(O.preventDefault(),t(3,y=(y+1)%m.length)):O.key==="ArrowUp"?(O.preventDefault(),t(3,y=(y-1+m.length)%m.length)):(O.key==="Enter"||O.key==="Tab")&&y!==-1&&(O.preventDefault(),w(m[y])))}function w(O){var $,P;const S=document.querySelector('input[type="search"]'),z=(S==null?void 0:S.selectionStart)??0,x=u.slice(0,z),B=u.slice(z),Y=x.split(/\s+/);if(O==="AND"||O==="OR"){Y[Y.length-1]=O,dl(Al,u=[...Y,"",B].join(" "),u);const I=z+O.length+1;($=S==null?void 0:S.setSelectionRange)==null||$.call(S,I,I)}else{Y[Y.length-1]=O,dl(Al,u=[...Y,B].join(" "),u);const I=z+O.length;(P=S==null?void 0:S.setSelectionRange)==null||P.call(S,I,I)}t(2,m=[]),t(3,y=-1)}function T(){const O=u.trim();if(!O)return null;if(h!=="none"){const x=O.split(/\s+/).filter(B=>B.length>0);return x.length>1?{...Yo({hasOperator:!0,operator:h==="and"?"AND":"OR",terms:x,originalQuery:O},c),skip:0,limit:10}:{search_term:O,skip:0,limit:10,role:c}}const S=ui(O);return{...Yo(S,c),skip:0,limit:10}}async function J(){if(t(1,_=null),r){if(!u.trim())return;try{const O=T();if(!O)return;const S=await We("search",{searchQuery:O});S.status==="success"?(t(0,p=S.results),console.log("Response results"),console.log(p)):(t(1,_=`Search failed: ${S.status}`),console.error("Search failed:",S))}catch(O){t(1,_=`Error in Tauri search: ${O}`),console.error("Error in Tauri search:",O)}}else{if(!u.trim())return;const O=T();if(!O)return;const S=JSON.stringify(O);try{const z=await fetch(n,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:S}),x=await z.json();if(!z.ok)throw new Error(`HTTP error! Status: ${z.status}`);t(0,p=x.results)}catch(z){console.error("Error fetching data:",z),t(1,_=`Error fetching data: ${z}`)}}}const U=[[]];function H(O){u=O,Al.set(u)}const N=O=>w(O),q=(O,S)=>{(S.key==="Enter"||S.key===" ")&&(S.preventDefault(),w(O))};function G(){h=this.__value,t(4,h)}function K(){h=this.__value,t(4,h)}function R(){h=this.__value,t(4,h)}const L=()=>window.location.href="/config/wizard";return l.$$.update=()=>{l.$$.dirty[0]&4096&&(o=Object.entries(i))},[p,_,m,y,h,u,c,d,C,v,w,J,i,H,N,q,G,U,K,R,L]}class hi extends _t{constructor(e){super(),mt(this,e,mi,_i,it,{},null,[-1,-1])}}async function ln(l={}){return typeof l=="object"&&Object.freeze(l),zl({__tauriModule:"Dialog",message:{cmd:"openDialog",options:l}})}function on(l,e,t){const o=l.slice();return o[71]=e[t],o[79]=t,o}function nn(l,e,t){const o=l.slice();return o[77]=e[t],o[78]=e,o[79]=t,o}function sn(l,e,t){const o=l.slice();return o[80]=e[t],o}function rn(l,e,t){const o=l.slice();return o[80]=e[t],o}function an(l,e,t){const o=l.slice();return o[85]=e[t],o[86]=e,o[87]=t,o}function un(l,e,t){const o=l.slice();return o[88]=e[t][0],o[89]=e[t][1],o[90]=e,o[91]=t,o}function cn(l,e,t){const o=l.slice();return o[74]=e[t],o}function fn(l,e,t){const o=l.slice();return o[71]=e[t],o}function dn(l,e,t){const o=l.slice();return o[74]=e[t],o}function pn(l){let e,t,o,n,u;return{c(){e=f("div"),t=f("button"),o=F(`
      Configuration saved successfully!`),a(t,"class","delete"),a(e,"class","notification is-success"),a(e,"data-testid","wizard-success")},m(r,c){E(r,e,c),s(e,t),s(e,o),n||(u=Z(t,"click",l[20]),n=!0)},p:ye,d(r){r&&A(e),n=!1,u()}}}function _n(l){let e,t,o,n,u;return{c(){e=f("div"),t=f("button"),o=F(`
      Failed to save configuration. Please try again.`),a(t,"class","delete"),a(e,"class","notification is-danger"),a(e,"data-testid","wizard-error")},m(r,c){E(r,e,c),s(e,t),s(e,o),n||(u=Z(t,"click",l[21]),n=!0)},p:ye,d(r){r&&A(e),n=!1,u()}}}function gi(l){let e,t,o,n,u,r,c,i,d,p=l[3].id+"",_,m,y,h,b,k=l[3].global_shortcut+"",C,v,w,T,J,U=l[3].default_theme+"",H,N,q,G,K,R=l[3].default_role+"",L,O,S,z,x,B,Y=JSON.stringify(l[3],null,2)+"",$,P=l[3].roles,I=[];for(let D=0;D<P.length;D+=1)I[D]=mn(on(l,P,D));return{c(){e=f("h4"),e.textContent="Review",t=g(),o=f("div"),n=f("h5"),n.textContent="Configuration Summary:",u=g(),r=f("ul"),c=f("li"),i=f("strong"),i.textContent="Configuration ID:",d=g(),_=F(p),m=g(),y=f("li"),h=f("strong"),h.textContent="Global Shortcut:",b=g(),C=F(k),v=g(),w=f("li"),T=f("strong"),T.textContent="Default Theme:",J=g(),H=F(U),N=g(),q=f("li"),G=f("strong"),G.textContent="Default Role:",K=g(),L=F(R),O=g(),S=f("h5"),S.textContent="Roles:",z=g();for(let D=0;D<I.length;D+=1)I[D].c();x=g(),B=f("pre"),$=F(Y),a(e,"class","title is-5"),a(o,"class","content"),re(B,"max-height","300px"),re(B,"overflow","auto")},m(D,Q){E(D,e,Q),E(D,t,Q),E(D,o,Q),s(o,n),s(o,u),s(o,r),s(r,c),s(c,i),s(c,d),s(c,_),s(r,m),s(r,y),s(y,h),s(y,b),s(y,C),s(r,v),s(r,w),s(w,T),s(w,J),s(w,H),s(r,N),s(r,q),s(q,G),s(q,K),s(q,L),s(o,O),s(o,S),s(o,z);for(let ee=0;ee<I.length;ee+=1)I[ee]&&I[ee].m(o,null);E(D,x,Q),E(D,B,Q),s(B,$)},p(D,Q){if(Q[0]&8&&p!==(p=D[3].id+"")&&_e(_,p),Q[0]&8&&k!==(k=D[3].global_shortcut+"")&&_e(C,k),Q[0]&8&&U!==(U=D[3].default_theme+"")&&_e(H,U),Q[0]&8&&R!==(R=D[3].default_role+"")&&_e(L,R),Q[0]&10){P=D[3].roles;let ee;for(ee=0;ee<P.length;ee+=1){const ne=on(D,P,ee);I[ee]?I[ee].p(ne,Q):(I[ee]=mn(ne),I[ee].c(),I[ee].m(o,null))}for(;ee<I.length;ee+=1)I[ee].d(1);I.length=P.length}Q[0]&8&&Y!==(Y=JSON.stringify(D[3],null,2)+"")&&_e($,Y)},d(D){D&&A(e),D&&A(t),D&&A(o),Ye(I,D),D&&A(x),D&&A(B)}}}function bi(l){let e,t,o=[],n=new Map,u,r,c,i,d=l[3].roles;const p=_=>_[77].name;for(let _=0;_<d.length;_+=1){let m=nn(l,d,_),y=p(m);n.set(y,o[_]=En(y,m))}return{c(){e=f("h4"),e.textContent="Roles",t=g();for(let _=0;_<o.length;_+=1)o[_].c();u=g(),r=f("button"),r.textContent="Add Role",a(e,"class","title is-5"),a(r,"class","button is-link is-light"),a(r,"data-testid","add-role")},m(_,m){E(_,e,m),E(_,t,m);for(let y=0;y<o.length;y+=1)o[y]&&o[y].m(_,m);E(_,u,m),E(_,r,m),c||(i=Z(r,"click",l[12]),c=!0)},p(_,m){m[0]&516985&&(d=_[3].roles,o=hs(o,m,p,1,_,d,n,u.parentNode,gs,En,u,nn))},d(_){_&&A(e),_&&A(t);for(let m=0;m<o.length;m+=1)o[m].d(_);_&&A(u),_&&A(r),c=!1,i()}}}function vi(l){let e,t,o,n,u,r,c,i,d,p,_,m,y,h,b,k,C,v,w,T,J,U,H,N,q,G,K,R,L,O,S,z=l[8],x=[];for(let $=0;$<z.length;$+=1)x[$]=Nn(dn(l,z,$));let B=l[3].roles,Y=[];for(let $=0;$<B.length;$+=1)Y[$]=On(fn(l,B,$));return{c(){e=f("div"),t=f("label"),t.textContent="Configuration ID",o=g(),n=f("div"),u=f("div"),r=f("select"),c=f("option"),c.textContent="Desktop",i=f("option"),i.textContent="Server",d=f("option"),d.textContent="Embedded",p=g(),_=f("div"),m=f("label"),m.textContent="Global shortcut",y=g(),h=f("div"),b=f("input"),k=g(),C=f("div"),v=f("label"),v.textContent="Default theme",w=g(),T=f("div"),J=f("div"),U=f("select");for(let $=0;$<x.length;$+=1)x[$].c();H=g(),N=f("div"),q=f("label"),q.textContent="Default Role",G=g(),K=f("div"),R=f("div"),L=f("select");for(let $=0;$<Y.length;$+=1)Y[$].c();a(t,"class","label"),a(t,"for","config-id"),c.__value="Desktop",c.value=c.__value,i.__value="Server",i.value=i.__value,d.__value="Embedded",d.value=d.__value,a(r,"id","config-id"),l[3].id===void 0&&rt(()=>l[22].call(r)),a(u,"class","select"),a(n,"class","control"),a(e,"class","field"),a(m,"class","label"),a(m,"for","global-shortcut"),a(b,"class","input"),a(b,"id","global-shortcut"),a(b,"type","text"),a(h,"class","control"),a(_,"class","field"),a(v,"class","label"),a(v,"for","default-theme"),a(U,"id","default-theme"),l[3].default_theme===void 0&&rt(()=>l[24].call(U)),a(J,"class","select is-fullwidth"),a(T,"class","control"),a(C,"class","field"),a(q,"class","label"),a(q,"for","default-role"),a(L,"id","default-role"),l[3].default_role===void 0&&rt(()=>l[25].call(L)),a(R,"class","select"),a(K,"class","control"),a(N,"class","field")},m($,P){E($,e,P),s(e,t),s(e,o),s(e,n),s(n,u),s(u,r),s(r,c),s(r,i),s(r,d),De(r,l[3].id,!0),E($,p,P),E($,_,P),s(_,m),s(_,y),s(_,h),s(h,b),Ae(b,l[3].global_shortcut),E($,k,P),E($,C,P),s(C,v),s(C,w),s(C,T),s(T,J),s(J,U);for(let I=0;I<x.length;I+=1)x[I]&&x[I].m(U,null);De(U,l[3].default_theme,!0),E($,H,P),E($,N,P),s(N,q),s(N,G),s(N,K),s(K,R),s(R,L);for(let I=0;I<Y.length;I+=1)Y[I]&&Y[I].m(L,null);De(L,l[3].default_role,!0),O||(S=[Z(r,"change",l[22]),Z(b,"input",l[23]),Z(U,"change",l[24]),Z(L,"change",l[25])],O=!0)},p($,P){if(P[0]&264&&De(r,$[3].id),P[0]&264&&b.value!==$[3].global_shortcut&&Ae(b,$[3].global_shortcut),P[0]&256){z=$[8];let I;for(I=0;I<z.length;I+=1){const D=dn($,z,I);x[I]?x[I].p(D,P):(x[I]=Nn(D),x[I].c(),x[I].m(U,null))}for(;I<x.length;I+=1)x[I].d(1);x.length=z.length}if(P[0]&264&&De(U,$[3].default_theme),P[0]&8){B=$[3].roles;let I;for(I=0;I<B.length;I+=1){const D=fn($,B,I);Y[I]?Y[I].p(D,P):(Y[I]=On(D),Y[I].c(),Y[I].m(L,null))}for(;I<Y.length;I+=1)Y[I].d(1);Y.length=B.length}P[0]&264&&De(L,$[3].default_role)},d($){$&&A(e),$&&A(p),$&&A(_),$&&A(k),$&&A(C),Ye(x,$),$&&A(H),$&&A(N),Ye(Y,$),O=!1,Je(S)}}}function mn(l){let e,t,o=l[71].name+"",n,u,r,c,i,d=l[71].shortname+"",p,_,m,y,h,b=l[71].theme+"",k,C,v,w,T,J=l[71].relevance_function+"",U,H,N,q,G,K;return{c(){e=f("div"),t=f("h6"),n=F(o),u=g(),r=f("p"),c=f("strong"),c.textContent="Shortname:",i=g(),p=F(d),_=g(),m=f("p"),y=f("strong"),y.textContent="Theme:",h=g(),k=F(b),C=g(),v=f("p"),w=f("strong"),w.textContent="Relevance Function:",T=g(),U=F(J),H=g(),N=f("button"),N.textContent="Edit Role",q=g(),a(t,"data-testid","review-role-name-"+l[79]),a(N,"class","button is-small"),a(N,"data-testid","edit-role-"+l[79]),a(e,"class","box")},m(R,L){E(R,e,L),s(e,t),s(t,n),s(e,u),s(e,r),s(r,c),s(r,i),s(r,p),s(e,_),s(e,m),s(m,y),s(m,h),s(m,k),s(e,C),s(e,v),s(v,w),s(v,T),s(v,U),s(e,H),s(e,N),s(e,q),G||(K=Z(N,"click",l[68]),G=!0)},p(R,L){L[0]&8&&o!==(o=R[71].name+"")&&_e(n,o),L[0]&8&&d!==(d=R[71].shortname+"")&&_e(p,d),L[0]&8&&b!==(b=R[71].theme+"")&&_e(k,b),L[0]&8&&J!==(J=R[71].relevance_function+"")&&_e(U,J)},d(R){R&&A(e),G=!1,K()}}}function hn(l){let e,t=l[74]+"",o;return{c(){e=f("option"),o=F(t),e.__value=l[74],e.value=e.__value},m(n,u){E(n,e,u),s(e,o)},p:ye,d(n){n&&A(e)}}}function ki(l){let e;return{c(){e=F("Directory Path")},m(t,o){E(t,e,o)},d(t){t&&A(e)}}}function wi(l){let e;return{c(){e=F("Server URL")},m(t,o){E(t,e,o)},d(t){t&&A(e)}}}function gn(l){let e;return{c(){e=f("p"),e.textContent="Click to select directory",a(e,"class","help")},m(t,o){E(t,e,o)},d(t){t&&A(e)}}}function bn(l){let e,t,o,n,u,r,c,i,d,p,_,m;function y(){l[34].call(c,l[79],l[87])}return{c(){e=f("div"),t=f("label"),o=F("Atomic Server Secret"),u=g(),r=f("div"),c=f("input"),d=g(),p=f("p"),p.textContent="Leave empty for anonymous access",a(t,"class","label"),a(t,"for",n=`haystack-secret-${l[79]}-${l[87]}`),a(c,"class","input"),a(c,"id",i=`haystack-secret-${l[79]}-${l[87]}`),a(c,"type","password"),a(c,"placeholder","Base64 encoded secret (optional)"),a(r,"class","control"),a(p,"class","help"),a(e,"class","field")},m(h,b){E(h,e,b),s(e,t),s(t,o),s(e,u),s(e,r),s(r,c),Ae(c,l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret),s(e,d),s(e,p),_||(m=Z(c,"input",y),_=!0)},p(h,b){l=h,b[0]&264&&n!==(n=`haystack-secret-${l[79]}-${l[87]}`)&&a(t,"for",n),b[0]&264&&i!==(i=`haystack-secret-${l[79]}-${l[87]}`)&&a(c,"id",i),b[0]&264&&c.value!==l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret&&Ae(c,l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret)},d(h){h&&A(e),_=!1,m()}}}function vn(l){let e,t,o,n,u,r,c,i,d,p,_,m,y,h,b,k,C,v,w,T,J,U,H,N,q,G,K,R,L,O,S,z,x,B,Y,$,P,I,D,Q,ee,ne,ke;function be(){l[35].call(p,l[79],l[87])}function Pe(...oe){return l[36](l[79],l[87],...oe)}let pe=Object.entries(l[3].roles[l[79]].haystacks[l[87]].extra_parameters||{}),fe=[];for(let oe=0;oe<pe.length;oe+=1)fe[oe]=kn(un(l,pe,oe));function ie(){return l[40](l[79],l[87])}function Ce(){return l[41](l[79],l[87])}function Te(){return l[42](l[79],l[87])}return{c(){e=f("div"),t=f("label"),t.textContent="Extra Parameters (for filtering)",o=g(),n=f("div"),u=f("div"),r=f("label"),c=F("Hashtag"),d=g(),p=f("input"),m=g(),y=f("div"),h=f("div"),b=f("label"),k=F("Presets"),v=g(),w=f("div"),T=f("select"),J=f("option"),J.textContent="(choose)",U=f("option"),U.textContent="#rust",H=f("option"),H.textContent="#docs",N=f("option"),N.textContent="#test",q=f("option"),q.textContent="#todo",K=g(),R=f("p"),R.innerHTML="When set, searches will enforce the hashtag alongside your query (AND), e.g. <code>-e &quot;search&quot; -e &quot;#rust&quot;</code>.",L=g();for(let oe=0;oe<fe.length;oe+=1)fe[oe].c();O=g(),S=f("div"),z=f("div"),x=f("button"),x.textContent="+ Tag Filter",B=g(),Y=f("div"),$=f("button"),$.textContent="+ Max Results",P=g(),I=f("div"),D=f("button"),D.textContent="+ Custom Parameter",Q=g(),ee=f("p"),ee.innerHTML=`Common parameters: <code>tag</code> (e.g., &quot;#rust&quot;), <code>glob</code> (e.g., &quot;*.md&quot;),
                  <code>max_count</code> (e.g., &quot;10&quot;), <code>context</code> (e.g., &quot;5&quot;)`,a(t,"class","label"),a(r,"class","label"),a(r,"for",i=`ripgrep-hashtag-${l[79]}-${l[87]}`),a(p,"class","input"),a(p,"id",_=`ripgrep-hashtag-${l[79]}-${l[87]}`),a(p,"type","text"),a(p,"placeholder","#rust"),a(u,"class","control"),a(n,"class","field is-grouped"),a(b,"class","label"),a(b,"for",C=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`),J.__value="",J.value=J.__value,U.__value="#rust",U.value=U.__value,H.__value="#docs",H.value=H.__value,N.__value="#test",N.value=N.__value,q.__value="#todo",q.value=q.__value,a(T,"id",G=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`),a(w,"class","select is-small"),a(h,"class","control"),a(y,"class","field is-grouped"),re(y,"margin-bottom",".5rem"),a(R,"class","help"),a(x,"class","button is-small is-link is-light"),a(z,"class","control"),a($,"class","button is-small is-link is-light"),a(Y,"class","control"),a(D,"class","button is-small is-link is-light"),a(I,"class","control"),a(S,"class","field is-grouped"),a(ee,"class","help"),a(e,"class","field")},m(oe,he){E(oe,e,he),s(e,t),s(e,o),s(e,n),s(n,u),s(u,r),s(r,c),s(u,d),s(u,p),Ae(p,l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag),s(e,m),s(e,y),s(y,h),s(h,b),s(b,k),s(h,v),s(h,w),s(w,T),s(T,J),s(T,U),s(T,H),s(T,N),s(T,q),s(e,K),s(e,R),s(e,L);for(let se=0;se<fe.length;se+=1)fe[se]&&fe[se].m(e,null);s(e,O),s(e,S),s(S,z),s(z,x),s(S,B),s(S,Y),s(Y,$),s(S,P),s(S,I),s(I,D),s(e,Q),s(e,ee),ne||(ke=[Z(p,"input",be),Z(T,"change",Pe),Z(x,"click",ie),Z($,"click",Ce),Z(D,"click",Te)],ne=!0)},p(oe,he){if(l=oe,he[0]&264&&i!==(i=`ripgrep-hashtag-${l[79]}-${l[87]}`)&&a(r,"for",i),he[0]&264&&_!==(_=`ripgrep-hashtag-${l[79]}-${l[87]}`)&&a(p,"id",_),he[0]&264&&p.value!==l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag&&Ae(p,l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag),he[0]&264&&C!==(C=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`)&&a(b,"for",C),he[0]&264&&G!==(G=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`)&&a(T,"id",G),he[0]&393224){pe=Object.entries(l[3].roles[l[79]].haystacks[l[87]].extra_parameters||{});let se;for(se=0;se<pe.length;se+=1){const ve=un(l,pe,se);fe[se]?fe[se].p(ve,he):(fe[se]=kn(ve),fe[se].c(),fe[se].m(e,O))}for(;se<fe.length;se+=1)fe[se].d(1);fe.length=pe.length}},d(oe){oe&&A(e),Ye(fe,oe),ne=!1,Je(ke)}}}function kn(l){let e,t,o,n,u,r,c,i,d,p,_,m,y;function h(...C){return l[37](l[79],l[87],l[88],...C)}function b(){l[38].call(c,l[79],l[87],l[88])}function k(){return l[39](l[79],l[87],l[88])}return{c(){e=f("div"),t=f("div"),o=f("input"),u=g(),r=f("div"),c=f("input"),i=g(),d=f("div"),p=f("button"),p.textContent="×",_=g(),a(o,"class","input"),a(o,"type","text"),a(o,"placeholder","Parameter name"),o.value=n=l[88],a(t,"class","control"),a(c,"class","input"),a(c,"type","text"),a(c,"placeholder","Parameter value"),a(r,"class","control is-expanded"),a(p,"class","button is-small is-danger"),a(d,"class","control"),a(e,"class","field is-grouped")},m(C,v){E(C,e,v),s(e,t),s(t,o),s(e,u),s(e,r),s(r,c),Ae(c,l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]]),s(e,i),s(e,d),s(d,p),s(e,_),m||(y=[Z(o,"blur",h),Z(c,"input",b),Z(p,"click",k)],m=!0)},p(C,v){l=C,v[0]&264&&n!==(n=l[88])&&o.value!==n&&(o.value=n),v[0]&264&&c.value!==l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]]&&Ae(c,l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]])},d(C){C&&A(e),m=!1,Je(y)}}}function wn(l){let e,t,o,n,u,r,c,i,d,p,_,m,y,h,b,k,C,v,w,T,J,U,H,N,q,G,K,R,L,O,S,z,x,B,Y,$,P,I,D;function Q(){l[31].call(d,l[79],l[87])}function ee(oe,he){return oe[3].roles[oe[79]].haystacks[oe[87]].service==="Atomic"?wi:ki}let ne=ee(l),ke=ne(l);function be(){l[32].call(w,l[79],l[87])}function Pe(){return l[33](l[79],l[87])}let pe=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"&&gn(),fe=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"&&bn(l),ie=l[3].roles[l[79]].haystacks[l[87]].service==="Ripgrep"&&vn(l);function Ce(){l[43].call(L,l[79],l[87])}function Te(){return l[44](l[79],l[87])}return{c(){e=f("div"),t=f("div"),o=f("label"),n=F("Service Type"),r=g(),c=f("div"),i=f("div"),d=f("select"),p=f("option"),p.textContent="Ripgrep (File Search)",_=f("option"),_.textContent="Atomic Server",y=g(),h=f("div"),b=f("label"),ke.c(),C=g(),v=f("div"),w=f("input"),H=g(),pe&&pe.c(),N=g(),fe&&fe.c(),q=g(),ie&&ie.c(),G=g(),K=f("div"),R=f("label"),L=f("input"),S=F(`
                 Read-only`),x=g(),B=f("div"),Y=f("button"),$=F("Remove Haystack"),a(o,"class","label"),a(o,"for",u=`haystack-service-${l[79]}-${l[87]}`),p.__value="Ripgrep",p.value=p.__value,_.__value="Atomic",_.value=_.__value,a(d,"id",m=`haystack-service-${l[79]}-${l[87]}`),l[3].roles[l[79]].haystacks[l[87]].service===void 0&&rt(Q),a(i,"class","select"),a(c,"class","control"),a(t,"class","field"),a(b,"class","label"),a(b,"for",k=`haystack-path-${l[79]}-${l[87]}`),a(w,"class","input"),a(w,"id",T=`haystack-path-${l[79]}-${l[87]}`),a(w,"type","text"),a(w,"placeholder",J=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?"https://localhost:9883":"/path/to/documents"),w.readOnly=U=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic",a(v,"class","control"),a(h,"class","field"),a(L,"id",O=`haystack-readonly-${l[79]}-${l[87]}`),a(L,"type","checkbox"),a(R,"class","checkbox"),a(R,"for",z=`haystack-readonly-${l[79]}-${l[87]}`),a(K,"class","field"),a(Y,"class","button is-small is-danger"),a(Y,"data-testid",P="remove-haystack-"+l[79]+"-"+l[87]),a(B,"class","field"),a(e,"class","box is-light")},m(oe,he){E(oe,e,he),s(e,t),s(t,o),s(o,n),s(t,r),s(t,c),s(c,i),s(i,d),s(d,p),s(d,_),De(d,l[3].roles[l[79]].haystacks[l[87]].service,!0),s(e,y),s(e,h),s(h,b),ke.m(b,null),s(h,C),s(h,v),s(v,w),Ae(w,l[3].roles[l[79]].haystacks[l[87]].path),s(v,H),pe&&pe.m(v,null),s(e,N),fe&&fe.m(e,null),s(e,q),ie&&ie.m(e,null),s(e,G),s(e,K),s(K,R),s(R,L),L.checked=l[3].roles[l[79]].haystacks[l[87]].read_only,s(R,S),s(e,x),s(e,B),s(B,Y),s(Y,$),I||(D=[Z(d,"change",Q),Z(w,"input",be),Z(w,"click",function(){jl(l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?Pe:void 0)&&(l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?Pe:void 0).apply(this,arguments)}),Z(L,"change",Ce),Z(Y,"click",Te)],I=!0)},p(oe,he){l=oe,he[0]&264&&u!==(u=`haystack-service-${l[79]}-${l[87]}`)&&a(o,"for",u),he[0]&264&&m!==(m=`haystack-service-${l[79]}-${l[87]}`)&&a(d,"id",m),he[0]&264&&De(d,l[3].roles[l[79]].haystacks[l[87]].service),ne!==(ne=ee(l))&&(ke.d(1),ke=ne(l),ke&&(ke.c(),ke.m(b,null))),he[0]&264&&k!==(k=`haystack-path-${l[79]}-${l[87]}`)&&a(b,"for",k),he[0]&264&&T!==(T=`haystack-path-${l[79]}-${l[87]}`)&&a(w,"id",T),he[0]&264&&J!==(J=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?"https://localhost:9883":"/path/to/documents")&&a(w,"placeholder",J),he[0]&280&&U!==(U=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic")&&(w.readOnly=U),he[0]&264&&w.value!==l[3].roles[l[79]].haystacks[l[87]].path&&Ae(w,l[3].roles[l[79]].haystacks[l[87]].path),l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?pe||(pe=gn(),pe.c(),pe.m(v,null)):pe&&(pe.d(1),pe=null),l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?fe?fe.p(l,he):(fe=bn(l),fe.c(),fe.m(e,q)):fe&&(fe.d(1),fe=null),l[3].roles[l[79]].haystacks[l[87]].service==="Ripgrep"?ie?ie.p(l,he):(ie=vn(l),ie.c(),ie.m(e,G)):ie&&(ie.d(1),ie=null),he[0]&264&&O!==(O=`haystack-readonly-${l[79]}-${l[87]}`)&&a(L,"id",O),he[0]&264&&(L.checked=l[3].roles[l[79]].haystacks[l[87]].read_only),he[0]&264&&z!==(z=`haystack-readonly-${l[79]}-${l[87]}`)&&a(R,"for",z),he[0]&264&&P!==(P="remove-haystack-"+l[79]+"-"+l[87])&&a(Y,"data-testid",P)},d(oe){oe&&A(e),ke.d(),pe&&pe.d(),fe&&fe.d(),ie&&ie.d(),I=!1,Je(D)}}}function yn(l){var Y;let e,t,o,n,u,r,c,i,d,p,_,m,y,h,b,k,C,v,w,T,J,U,H,N,q,G,K,R,L;function O(){l[47].call(c,l[79])}function S(){return l[48](l[79])}let z=((Y=l[0][l[79]])==null?void 0:Y.length)&&$n(l);function x(){l[50].call(w,l[79])}function B(){l[51].call(N,l[79])}return{c(){e=f("div"),t=f("label"),o=F("Model"),u=g(),r=f("div"),c=f("input"),d=g(),p=f("button"),p.textContent="Fetch models",_=g(),z&&z.c(),m=g(),y=f("div"),h=f("label"),b=F("Base URL"),C=g(),v=f("div"),w=f("input"),J=g(),U=f("div"),H=f("label"),N=f("input"),G=F(`
               Automatically summarize search results`),a(t,"class","label"),a(t,"for",n=`llm-model-${l[79]}`),a(c,"class","input"),a(c,"id",i=`llm-model-${l[79]}`),a(c,"type","text"),a(c,"placeholder","llama3.1"),a(r,"class","control"),a(p,"class","button is-small"),a(e,"class","field"),a(h,"class","label"),a(h,"for",k=`llm-base-url-${l[79]}`),a(w,"class","input"),a(w,"id",T=`llm-base-url-${l[79]}`),a(w,"type","text"),a(w,"placeholder","http://127.0.0.1:11434"),a(v,"class","control"),a(y,"class","field"),a(N,"id",q=`llm-auto-summarize-${l[79]}`),a(N,"type","checkbox"),a(H,"class","checkbox"),a(H,"for",K=`llm-auto-summarize-${l[79]}`),a(U,"class","field")},m($,P){E($,e,P),s(e,t),s(t,o),s(e,u),s(e,r),s(r,c),Ae(c,l[3].roles[l[79]].llm_model),s(e,d),s(e,p),s(e,_),z&&z.m(e,null),E($,m,P),E($,y,P),s(y,h),s(h,b),s(y,C),s(y,v),s(v,w),Ae(w,l[3].roles[l[79]].llm_base_url),E($,J,P),E($,U,P),s(U,H),s(H,N),N.checked=l[3].roles[l[79]].llm_auto_summarize,s(H,G),R||(L=[Z(c,"input",O),Z(p,"click",S),Z(w,"input",x),Z(N,"change",B)],R=!0)},p($,P){var I;l=$,P[0]&264&&n!==(n=`llm-model-${l[79]}`)&&a(t,"for",n),P[0]&264&&i!==(i=`llm-model-${l[79]}`)&&a(c,"id",i),P[0]&264&&c.value!==l[3].roles[l[79]].llm_model&&Ae(c,l[3].roles[l[79]].llm_model),(I=l[0][l[79]])!=null&&I.length?z?z.p(l,P):(z=$n(l),z.c(),z.m(e,null)):z&&(z.d(1),z=null),P[0]&264&&k!==(k=`llm-base-url-${l[79]}`)&&a(h,"for",k),P[0]&264&&T!==(T=`llm-base-url-${l[79]}`)&&a(w,"id",T),P[0]&264&&w.value!==l[3].roles[l[79]].llm_base_url&&Ae(w,l[3].roles[l[79]].llm_base_url),P[0]&264&&q!==(q=`llm-auto-summarize-${l[79]}`)&&a(N,"id",q),P[0]&264&&(N.checked=l[3].roles[l[79]].llm_auto_summarize),P[0]&264&&K!==(K=`llm-auto-summarize-${l[79]}`)&&a(H,"for",K)},d($){$&&A(e),z&&z.d(),$&&A(m),$&&A(y),$&&A(J),$&&A(U),R=!1,Je(L)}}}function $n(l){let e,t,o,n,u=l[0][l[79]],r=[];for(let i=0;i<u.length;i+=1)r[i]=Sn(rn(l,u,i));function c(...i){return l[49](l[79],...i)}return{c(){e=f("div"),t=f("select");for(let i=0;i<r.length;i+=1)r[i].c();a(e,"class","select is-fullwidth"),re(e,"margin-top","0.5rem")},m(i,d){E(i,e,d),s(e,t);for(let p=0;p<r.length;p+=1)r[p]&&r[p].m(t,null);o||(n=Z(t,"change",c),o=!0)},p(i,d){if(l=i,d[0]&9){u=l[0][l[79]];let p;for(p=0;p<u.length;p+=1){const _=rn(l,u,p);r[p]?r[p].p(_,d):(r[p]=Sn(_),r[p].c(),r[p].m(t,null))}for(;p<r.length;p+=1)r[p].d(1);r.length=u.length}},d(i){i&&A(e),Ye(r,i),o=!1,n()}}}function Sn(l){let e,t=l[80]+"",o,n;return{c(){e=f("option"),o=F(t),e.__value=n=l[80],e.value=e.__value},m(u,r){E(u,e,r),s(e,o)},p(u,r){r[0]&9&&t!==(t=u[80]+"")&&_e(o,t),r[0]&265&&n!==(n=u[80])&&(e.__value=n,e.value=e.__value)},d(u){u&&A(e)}}}function Cn(l){var he;let e,t,o,n,u,r,c,i,d,p,_,m,y,h,b,k,C,v,w,T,J,U,H,N,q,G,K,R,L,O,S,z,x,B,Y,$,P,I,D,Q,ee,ne,ke,be;function Pe(){l[53].call(c,l[79])}function pe(){l[54].call(v,l[79])}function fe(){return l[55](l[79])}let ie=((he=l[0][l[79]])==null?void 0:he.length)&&Tn(l);function Ce(){l[57].call(R,l[79])}function Te(){l[58].call(P,l[79])}let oe=l[3].roles[l[79]].openrouter_chat_enabled&&An(l);return{c(){e=f("div"),t=f("label"),o=F("OpenRouter API Key"),u=g(),r=f("div"),c=f("input"),d=g(),p=f("p"),p.innerHTML='Get your API key from <a href="https://openrouter.ai" target="_blank" rel="noopener">OpenRouter</a>',_=g(),m=f("div"),y=f("label"),h=F("Model"),k=g(),C=f("div"),v=f("input"),T=g(),J=f("button"),J.textContent="Fetch models",U=g(),ie&&ie.c(),H=g(),N=f("p"),N.textContent="Choose the language model for generating summaries. Different models offer different speed/quality tradeoffs.",q=g(),G=f("div"),K=f("label"),R=f("input"),O=F(`
               Automatically summarize search results`),z=g(),x=f("p"),x.textContent="When enabled, summaries will be generated and shown in search results.",B=g(),Y=f("div"),$=f("label"),P=f("input"),D=F(`
               Enable Chat interface (OpenRouter)`),ee=g(),oe&&oe.c(),ne=at(),a(t,"class","label"),a(t,"for",n=`openrouter-api-key-${l[79]}`),a(c,"class","input"),a(c,"id",i=`openrouter-api-key-${l[79]}`),a(c,"type","password"),a(c,"placeholder","sk-or-v1-..."),a(r,"class","control"),a(p,"class","help"),a(e,"class","field"),a(y,"class","label"),a(y,"for",b=`openrouter-model-${l[79]}`),a(v,"class","input"),a(v,"id",w=`openrouter-model-${l[79]}`),a(v,"type","text"),a(v,"placeholder","openai/gpt-4-turbo"),a(C,"class","control"),a(J,"class","button is-small"),a(N,"class","help"),a(m,"class","field"),a(R,"id",L=`openrouter-auto-summarize-${l[79]}`),a(R,"type","checkbox"),a(K,"class","checkbox"),a(K,"for",S=`openrouter-auto-summarize-${l[79]}`),a(x,"class","help"),a(G,"class","field"),a(P,"id",I=`openrouter-chat-enabled-${l[79]}`),a(P,"type","checkbox"),a($,"class","checkbox"),a($,"for",Q=`openrouter-chat-enabled-${l[79]}`),a(Y,"class","field")},m(se,ve){E(se,e,ve),s(e,t),s(t,o),s(e,u),s(e,r),s(r,c),Ae(c,l[3].roles[l[79]].openrouter_api_key),s(e,d),s(e,p),E(se,_,ve),E(se,m,ve),s(m,y),s(y,h),s(m,k),s(m,C),s(C,v),Ae(v,l[3].roles[l[79]].openrouter_model),s(m,T),s(m,J),s(m,U),ie&&ie.m(m,null),s(m,H),s(m,N),E(se,q,ve),E(se,G,ve),s(G,K),s(K,R),R.checked=l[3].roles[l[79]].openrouter_auto_summarize,s(K,O),s(G,z),s(G,x),E(se,B,ve),E(se,Y,ve),s(Y,$),s($,P),P.checked=l[3].roles[l[79]].openrouter_chat_enabled,s($,D),E(se,ee,ve),oe&&oe.m(se,ve),E(se,ne,ve),ke||(be=[Z(c,"input",Pe),Z(v,"input",pe),Z(J,"click",fe),Z(R,"change",Ce),Z(P,"change",Te)],ke=!0)},p(se,ve){var Be;l=se,ve[0]&264&&n!==(n=`openrouter-api-key-${l[79]}`)&&a(t,"for",n),ve[0]&264&&i!==(i=`openrouter-api-key-${l[79]}`)&&a(c,"id",i),ve[0]&264&&c.value!==l[3].roles[l[79]].openrouter_api_key&&Ae(c,l[3].roles[l[79]].openrouter_api_key),ve[0]&264&&b!==(b=`openrouter-model-${l[79]}`)&&a(y,"for",b),ve[0]&264&&w!==(w=`openrouter-model-${l[79]}`)&&a(v,"id",w),ve[0]&264&&v.value!==l[3].roles[l[79]].openrouter_model&&Ae(v,l[3].roles[l[79]].openrouter_model),(Be=l[0][l[79]])!=null&&Be.length?ie?ie.p(l,ve):(ie=Tn(l),ie.c(),ie.m(m,H)):ie&&(ie.d(1),ie=null),ve[0]&264&&L!==(L=`openrouter-auto-summarize-${l[79]}`)&&a(R,"id",L),ve[0]&264&&(R.checked=l[3].roles[l[79]].openrouter_auto_summarize),ve[0]&264&&S!==(S=`openrouter-auto-summarize-${l[79]}`)&&a(K,"for",S),ve[0]&264&&I!==(I=`openrouter-chat-enabled-${l[79]}`)&&a(P,"id",I),ve[0]&264&&(P.checked=l[3].roles[l[79]].openrouter_chat_enabled),ve[0]&264&&Q!==(Q=`openrouter-chat-enabled-${l[79]}`)&&a($,"for",Q),l[3].roles[l[79]].openrouter_chat_enabled?oe?oe.p(l,ve):(oe=An(l),oe.c(),oe.m(ne.parentNode,ne)):oe&&(oe.d(1),oe=null)},d(se){se&&A(e),se&&A(_),se&&A(m),ie&&ie.d(),se&&A(q),se&&A(G),se&&A(B),se&&A(Y),se&&A(ee),oe&&oe.d(se),se&&A(ne),ke=!1,Je(be)}}}function Tn(l){let e,t,o,n,u=l[0][l[79]],r=[];for(let i=0;i<u.length;i+=1)r[i]=Rn(sn(l,u,i));function c(...i){return l[56](l[79],...i)}return{c(){e=f("div"),t=f("select");for(let i=0;i<r.length;i+=1)r[i].c();a(e,"class","select is-fullwidth"),re(e,"margin-top","0.5rem")},m(i,d){E(i,e,d),s(e,t);for(let p=0;p<r.length;p+=1)r[p]&&r[p].m(t,null);o||(n=Z(t,"change",c),o=!0)},p(i,d){if(l=i,d[0]&9){u=l[0][l[79]];let p;for(p=0;p<u.length;p+=1){const _=sn(l,u,p);r[p]?r[p].p(_,d):(r[p]=Rn(_),r[p].c(),r[p].m(t,null))}for(;p<r.length;p+=1)r[p].d(1);r.length=u.length}},d(i){i&&A(e),Ye(r,i),o=!1,n()}}}function Rn(l){let e,t=l[80]+"",o,n;return{c(){e=f("option"),o=F(t),e.__value=n=l[80],e.value=e.__value},m(u,r){E(u,e,r),s(e,o)},p(u,r){r[0]&9&&t!==(t=u[80]+"")&&_e(o,t),r[0]&265&&n!==(n=u[80])&&(e.__value=n,e.value=e.__value)},d(u){u&&A(e)}}}function An(l){let e,t,o,n,u,r,c,i,d,p,_,m,y,h,b,k,C,v,w,T,J,U,H,N,q;function G(){l[59].call(i,l[79])}function K(){l[60].call(U,l[79])}return{c(){e=f("div"),t=f("label"),o=F("Chat Model"),u=g(),r=f("div"),c=f("div"),i=f("select"),d=f("option"),d.textContent="GPT-3.5 Turbo",p=f("option"),p.textContent="GPT-4",_=f("option"),_.textContent="Claude 3 Sonnet",m=f("option"),m.textContent="Claude 3 Haiku",y=f("option"),y.textContent="Mixtral 8x7B",b=g(),k=f("div"),C=f("label"),v=F("System Prompt (optional)"),T=g(),J=f("div"),U=f("textarea"),a(t,"class","label"),a(t,"for",n=`openrouter-chat-model-${l[79]}`),d.__value="openai/gpt-3.5-turbo",d.value=d.__value,p.__value="openai/gpt-4",p.value=p.__value,_.__value="anthropic/claude-3-sonnet",_.value=_.__value,m.__value="anthropic/claude-3-haiku",m.value=m.__value,y.__value="mistralai/mixtral-8x7b-instruct",y.value=y.__value,a(i,"id",h=`openrouter-chat-model-${l[79]}`),l[3].roles[l[79]].openrouter_chat_model===void 0&&rt(G),a(c,"class","select is-fullwidth"),a(r,"class","control"),a(e,"class","field"),a(C,"class","label"),a(C,"for",w=`openrouter-chat-system-${l[79]}`),a(U,"class","textarea"),a(U,"id",H=`openrouter-chat-system-${l[79]}`),a(U,"rows","3"),a(U,"placeholder","You are a helpful Rust engineer assistant..."),a(J,"class","control"),a(k,"class","field")},m(R,L){E(R,e,L),s(e,t),s(t,o),s(e,u),s(e,r),s(r,c),s(c,i),s(i,d),s(i,p),s(i,_),s(i,m),s(i,y),De(i,l[3].roles[l[79]].openrouter_chat_model,!0),E(R,b,L),E(R,k,L),s(k,C),s(C,v),s(k,T),s(k,J),s(J,U),Ae(U,l[3].roles[l[79]].openrouter_chat_system_prompt),N||(q=[Z(i,"change",G),Z(U,"input",K)],N=!0)},p(R,L){l=R,L[0]&264&&n!==(n=`openrouter-chat-model-${l[79]}`)&&a(t,"for",n),L[0]&264&&h!==(h=`openrouter-chat-model-${l[79]}`)&&a(i,"id",h),L[0]&264&&De(i,l[3].roles[l[79]].openrouter_chat_model),L[0]&264&&w!==(w=`openrouter-chat-system-${l[79]}`)&&a(C,"for",w),L[0]&264&&H!==(H=`openrouter-chat-system-${l[79]}`)&&a(U,"id",H),L[0]&264&&Ae(U,l[3].roles[l[79]].openrouter_chat_system_prompt)},d(R){R&&A(e),R&&A(b),R&&A(k),N=!1,Je(q)}}}function Ln(l){let e;return{c(){e=f("p"),e.textContent="Click to select directory",a(e,"class","help")},m(t,o){E(t,e,o)},d(t){t&&A(e)}}}function En(l,e){let t,o,n,u,r,c,i,d,p,_,m,y,h,b,k,C,v,w,T,J,U,H,N,q,G,K,R,L,O,S,z,x,B,Y,$,P,I,D,Q,ee,ne,ke,be,Pe,pe,fe,ie,Ce,Te,oe,he,se,ve,Be,Se,Ne,le,we,Ue,Xe,He,Oe,ht,ze,Ct,tt,gt,Qe,lt,ut,Le,Tt,M,X,j,te,me,de,Me,qe,Ee,Fe,bt,ct,il,zt,al,Qt,Ft,ul,Ut,vt,Fl,_l,Kl,ml,yt,hl,Gl,Vt,Yt,Wl,gl,Bl,Kt,ot,bl,ql,Jl,vl,Zt,Xt,Ql,kl,Vl,wl,Et,xt,el,yl,Yl,tl,jt,Dt,$l,Zl,Sl,Xl,Gt,Mt,Cl,xl,Tl,eo,to,lo,Wt,oo,Rl,Pl,no;function xn(){e[26].call(d,e[79])}function es(){e[27].call(v,e[79])}let ll=e[8],nt=[];for(let Ie=0;Ie<ll.length;Ie+=1)nt[Ie]=hn(cn(e,ll,Ie));function so(){e[28].call(R,e[79])}function ro(){e[29].call(I,e[79])}function ts(){e[30].call(ie,e[79])}let ol=e[77].haystacks,st=[];for(let Ie=0;Ie<ol.length;Ie+=1)st[Ie]=wn(an(e,ol,Ie));function ls(){return e[45](e[79])}function io(){e[46].call(Qe,e[79])}let ft=e[3].roles[e[79]].llm_provider==="ollama"&&yn(e);function os(){e[52].call(Ee,e[79])}let dt=e[3].roles[e[79]].openrouter_enabled&&Cn(e);function ns(){e[61].call(yt,e[79])}function ss(){e[62].call(ot,e[79])}function ao(){return e[63](e[79])}let kt=e[4]&&Ln();function uo(){e[64].call(Et,e[79])}function rs(){e[65].call(Dt,e[79])}function is(){e[66].call(Mt,e[79])}function as(){return e[67](e[79])}return{key:l,first:null,c(){t=f("div"),o=f("div"),n=f("label"),u=F("Role name"),c=g(),i=f("div"),d=f("input"),_=g(),m=f("div"),y=f("label"),h=F("Short name"),k=g(),C=f("div"),v=f("input"),T=g(),J=f("div"),U=f("label"),H=F("Theme"),q=g(),G=f("div"),K=f("div"),R=f("select");for(let Ie=0;Ie<nt.length;Ie+=1)nt[Ie].c();O=g(),S=f("div"),z=f("label"),x=F("Relevance function"),Y=g(),$=f("div"),P=f("div"),I=f("select"),D=f("option"),D.textContent="title-scorer",Q=f("option"),Q.textContent="terraphim-graph",ee=f("option"),ee.textContent="bm25",ne=f("option"),ne.textContent="bm25f",ke=f("option"),ke.textContent="bm25plus",Pe=g(),pe=f("div"),fe=f("label"),ie=f("input"),Te=F(`
            Enable Terraphim IT features (KG preprocessing, auto-linking)`),he=g(),se=f("h5"),se.textContent="Haystacks",ve=g();for(let Ie=0;Ie<st.length;Ie+=1)st[Ie].c();Be=g(),Se=f("button"),Ne=F("Add Haystack"),we=g(),Ue=f("h5"),Ue.textContent="AI-Enhanced Summaries (LLM Provider)",Xe=g(),He=f("div"),Oe=f("label"),ht=F("Provider"),Ct=g(),tt=f("div"),gt=f("div"),Qe=f("select"),lt=f("option"),lt.textContent="(none)",ut=f("option"),ut.textContent="OpenRouter",Le=f("option"),Le.textContent="Ollama (local)",M=g(),X=f("p"),X.textContent="Choose a provider. OpenRouter uses API key; Ollama runs locally.",j=g(),ft&&ft.c(),te=g(),me=f("h5"),me.textContent="AI-Enhanced Summaries (OpenRouter)",de=g(),Me=f("div"),qe=f("label"),Ee=f("input"),bt=F(`
             Enable AI-generated article summaries`),il=g(),zt=f("p"),zt.textContent="Generate intelligent summaries using OpenRouter's language models",al=g(),dt&&dt.c(),Qt=g(),Ft=f("h5"),Ft.textContent="Knowledge Graph",ul=g(),Ut=f("div"),vt=f("label"),Fl=F("Remote automata URL"),Kl=g(),ml=f("div"),yt=f("input"),Gl=g(),Vt=f("div"),Yt=f("label"),Wl=F("Local KG path"),Bl=g(),Kt=f("div"),ot=f("input"),ql=g(),kt&&kt.c(),Jl=g(),vl=f("div"),Zt=f("div"),Xt=f("label"),Ql=F("Local KG type"),Vl=g(),wl=f("div"),Et=f("select"),xt=f("option"),xt.textContent="markdown",el=f("option"),el.textContent="json",Yl=g(),tl=f("div"),jt=f("label"),Dt=f("input"),Zl=F(`
             Public`),Xl=g(),Gt=f("label"),Mt=f("input"),xl=F(`
             Publish`),eo=g(),to=f("hr"),lo=g(),Wt=f("button"),oo=F("Remove Role"),a(n,"class","label"),a(n,"for",r=`role-name-${e[79]}`),a(d,"class","input"),a(d,"id",p=`role-name-${e[79]}`),a(d,"type","text"),a(i,"class","control"),a(o,"class","field"),a(y,"class","label"),a(y,"for",b=`role-shortname-${e[79]}`),a(v,"class","input"),a(v,"id",w=`role-shortname-${e[79]}`),a(v,"type","text"),a(C,"class","control"),a(m,"class","field"),a(U,"class","label"),a(U,"for",N=`role-theme-${e[79]}`),a(R,"id",L=`role-theme-${e[79]}`),e[3].roles[e[79]].theme===void 0&&rt(so),a(K,"class","select is-fullwidth"),a(G,"class","control"),a(J,"class","field"),a(z,"class","label"),a(z,"for",B=`role-relevance-${e[79]}`),D.__value="title-scorer",D.value=D.__value,Q.__value="terraphim-graph",Q.value=Q.__value,ee.__value="bm25",ee.value=ee.__value,ne.__value="bm25f",ne.value=ne.__value,ke.__value="bm25plus",ke.value=ke.__value,a(I,"id",be=`role-relevance-${e[79]}`),e[3].roles[e[79]].relevance_function===void 0&&rt(ro),a(P,"class","select is-fullwidth"),a($,"class","control"),a(S,"class","field"),a(ie,"class","checkbox"),a(ie,"id",Ce=`role-terraphim-it-${e[79]}`),a(ie,"type","checkbox"),a(fe,"class","label"),a(fe,"for",oe=`role-terraphim-it-${e[79]}`),a(pe,"class","field"),a(se,"class","title is-6"),a(Se,"class","button is-small"),a(Se,"data-testid",le="add-haystack-"+e[79]),a(Ue,"class","title is-6"),a(Oe,"class","label"),a(Oe,"for",ze=`llm-provider-${e[79]}`),lt.__value="",lt.value=lt.__value,ut.__value="openrouter",ut.value=ut.__value,Le.__value="ollama",Le.value=Le.__value,a(Qe,"id",Tt=`llm-provider-${e[79]}`),e[3].roles[e[79]].llm_provider===void 0&&rt(io),a(gt,"class","select"),a(tt,"class","control"),a(X,"class","help"),a(He,"class","field"),a(me,"class","title is-6"),a(Ee,"id",Fe=`openrouter-enabled-${e[79]}`),a(Ee,"type","checkbox"),a(qe,"class","checkbox"),a(qe,"for",ct=`openrouter-enabled-${e[79]}`),a(zt,"class","help"),a(Me,"class","field"),a(Ft,"class","title is-6"),a(vt,"class","label"),a(vt,"for",_l=`kg-url-${e[79]}`),a(yt,"class","input"),a(yt,"id",hl=`kg-url-${e[79]}`),a(yt,"type","text"),a(yt,"placeholder","https://example.com/thesaurus.json"),a(ml,"class","control"),a(Ut,"class","field"),a(Yt,"class","label"),a(Yt,"for",gl=`kg-local-path-${e[79]}`),a(ot,"class","input"),a(ot,"id",bl=`kg-local-path-${e[79]}`),a(ot,"type","text"),a(ot,"placeholder","/path/to/markdown"),ot.readOnly=e[4],a(Kt,"class","control"),a(Vt,"class","field"),a(Xt,"class","label"),a(Xt,"for",kl=`kg-local-type-${e[79]}`),xt.__value="markdown",xt.value=xt.__value,el.__value="json",el.value=el.__value,a(Et,"id",yl=`kg-local-type-${e[79]}`),e[3].roles[e[79]].kg.local_type===void 0&&rt(uo),a(wl,"class","select"),a(Zt,"class","control"),a(vl,"class","field is-grouped"),a(Dt,"id",$l=`kg-public-${e[79]}`),a(Dt,"type","checkbox"),a(jt,"class","checkbox"),a(jt,"for",Sl=`kg-public-${e[79]}`),re(jt,"margin-right","1rem"),a(Mt,"id",Cl=`kg-publish-${e[79]}`),a(Mt,"type","checkbox"),a(Gt,"class","checkbox"),a(Gt,"for",Tl=`kg-publish-${e[79]}`),a(tl,"class","field is-grouped"),a(Wt,"class","button is-small is-danger"),a(Wt,"data-testid",Rl="remove-role-"+e[79]),a(t,"class","box"),this.first=t},m(Ie,ge){E(Ie,t,ge),s(t,o),s(o,n),s(n,u),s(o,c),s(o,i),s(i,d),Ae(d,e[3].roles[e[79]].name),s(t,_),s(t,m),s(m,y),s(y,h),s(m,k),s(m,C),s(C,v),Ae(v,e[3].roles[e[79]].shortname),s(t,T),s(t,J),s(J,U),s(U,H),s(J,q),s(J,G),s(G,K),s(K,R);for(let $e=0;$e<nt.length;$e+=1)nt[$e]&&nt[$e].m(R,null);De(R,e[3].roles[e[79]].theme,!0),s(t,O),s(t,S),s(S,z),s(z,x),s(S,Y),s(S,$),s($,P),s(P,I),s(I,D),s(I,Q),s(I,ee),s(I,ne),s(I,ke),De(I,e[3].roles[e[79]].relevance_function,!0),s(t,Pe),s(t,pe),s(pe,fe),s(fe,ie),ie.checked=e[3].roles[e[79]].terraphim_it,s(fe,Te),s(t,he),s(t,se),s(t,ve);for(let $e=0;$e<st.length;$e+=1)st[$e]&&st[$e].m(t,null);s(t,Be),s(t,Se),s(Se,Ne),s(t,we),s(t,Ue),s(t,Xe),s(t,He),s(He,Oe),s(Oe,ht),s(He,Ct),s(He,tt),s(tt,gt),s(gt,Qe),s(Qe,lt),s(Qe,ut),s(Qe,Le),De(Qe,e[3].roles[e[79]].llm_provider,!0),s(He,M),s(He,X),s(t,j),ft&&ft.m(t,null),s(t,te),s(t,me),s(t,de),s(t,Me),s(Me,qe),s(qe,Ee),Ee.checked=e[3].roles[e[79]].openrouter_enabled,s(qe,bt),s(Me,il),s(Me,zt),s(t,al),dt&&dt.m(t,null),s(t,Qt),s(t,Ft),s(t,ul),s(t,Ut),s(Ut,vt),s(vt,Fl),s(Ut,Kl),s(Ut,ml),s(ml,yt),Ae(yt,e[3].roles[e[79]].kg.url),s(t,Gl),s(t,Vt),s(Vt,Yt),s(Yt,Wl),s(Vt,Bl),s(Vt,Kt),s(Kt,ot),Ae(ot,e[3].roles[e[79]].kg.local_path),s(Kt,ql),kt&&kt.m(Kt,null),s(t,Jl),s(t,vl),s(vl,Zt),s(Zt,Xt),s(Xt,Ql),s(Zt,Vl),s(Zt,wl),s(wl,Et),s(Et,xt),s(Et,el),De(Et,e[3].roles[e[79]].kg.local_type,!0),s(t,Yl),s(t,tl),s(tl,jt),s(jt,Dt),Dt.checked=e[3].roles[e[79]].kg.public,s(jt,Zl),s(tl,Xl),s(tl,Gt),s(Gt,Mt),Mt.checked=e[3].roles[e[79]].kg.publish,s(Gt,xl),s(t,eo),s(t,to),s(t,lo),s(t,Wt),s(Wt,oo),Pl||(no=[Z(d,"input",xn),Z(v,"input",es),Z(R,"change",so),Z(I,"change",ro),Z(ie,"change",ts),Z(Se,"click",ls),Z(Qe,"change",io),Z(Ee,"change",os),Z(yt,"input",ns),Z(ot,"input",ss),Z(ot,"click",function(){jl(e[4]?ao:void 0)&&(e[4]?ao:void 0).apply(this,arguments)}),Z(Et,"change",uo),Z(Dt,"change",rs),Z(Mt,"change",is),Z(Wt,"click",as)],Pl=!0)},p(Ie,ge){if(e=Ie,ge[0]&264&&r!==(r=`role-name-${e[79]}`)&&a(n,"for",r),ge[0]&264&&p!==(p=`role-name-${e[79]}`)&&a(d,"id",p),ge[0]&264&&d.value!==e[3].roles[e[79]].name&&Ae(d,e[3].roles[e[79]].name),ge[0]&264&&b!==(b=`role-shortname-${e[79]}`)&&a(y,"for",b),ge[0]&264&&w!==(w=`role-shortname-${e[79]}`)&&a(v,"id",w),ge[0]&264&&v.value!==e[3].roles[e[79]].shortname&&Ae(v,e[3].roles[e[79]].shortname),ge[0]&264&&N!==(N=`role-theme-${e[79]}`)&&a(U,"for",N),ge[0]&256){ll=e[8];let $e;for($e=0;$e<ll.length;$e+=1){const cl=cn(e,ll,$e);nt[$e]?nt[$e].p(cl,ge):(nt[$e]=hn(cl),nt[$e].c(),nt[$e].m(R,null))}for(;$e<nt.length;$e+=1)nt[$e].d(1);nt.length=ll.length}if(ge[0]&264&&L!==(L=`role-theme-${e[79]}`)&&a(R,"id",L),ge[0]&264&&De(R,e[3].roles[e[79]].theme),ge[0]&264&&B!==(B=`role-relevance-${e[79]}`)&&a(z,"for",B),ge[0]&264&&be!==(be=`role-relevance-${e[79]}`)&&a(I,"id",be),ge[0]&264&&De(I,e[3].roles[e[79]].relevance_function),ge[0]&264&&Ce!==(Ce=`role-terraphim-it-${e[79]}`)&&a(ie,"id",Ce),ge[0]&264&&(ie.checked=e[3].roles[e[79]].terraphim_it),ge[0]&264&&oe!==(oe=`role-terraphim-it-${e[79]}`)&&a(fe,"for",oe),ge[0]&491576){ol=e[77].haystacks;let $e;for($e=0;$e<ol.length;$e+=1){const cl=an(e,ol,$e);st[$e]?st[$e].p(cl,ge):(st[$e]=wn(cl),st[$e].c(),st[$e].m(t,Be))}for(;$e<st.length;$e+=1)st[$e].d(1);st.length=ol.length}ge[0]&264&&le!==(le="add-haystack-"+e[79])&&a(Se,"data-testid",le),ge[0]&264&&ze!==(ze=`llm-provider-${e[79]}`)&&a(Oe,"for",ze),ge[0]&264&&Tt!==(Tt=`llm-provider-${e[79]}`)&&a(Qe,"id",Tt),ge[0]&264&&De(Qe,e[3].roles[e[79]].llm_provider),e[3].roles[e[79]].llm_provider==="ollama"?ft?ft.p(e,ge):(ft=yn(e),ft.c(),ft.m(t,te)):ft&&(ft.d(1),ft=null),ge[0]&264&&Fe!==(Fe=`openrouter-enabled-${e[79]}`)&&a(Ee,"id",Fe),ge[0]&264&&(Ee.checked=e[3].roles[e[79]].openrouter_enabled),ge[0]&264&&ct!==(ct=`openrouter-enabled-${e[79]}`)&&a(qe,"for",ct),e[3].roles[e[79]].openrouter_enabled?dt?dt.p(e,ge):(dt=Cn(e),dt.c(),dt.m(t,Qt)):dt&&(dt.d(1),dt=null),ge[0]&264&&_l!==(_l=`kg-url-${e[79]}`)&&a(vt,"for",_l),ge[0]&264&&hl!==(hl=`kg-url-${e[79]}`)&&a(yt,"id",hl),ge[0]&264&&yt.value!==e[3].roles[e[79]].kg.url&&Ae(yt,e[3].roles[e[79]].kg.url),ge[0]&264&&gl!==(gl=`kg-local-path-${e[79]}`)&&a(Yt,"for",gl),ge[0]&264&&bl!==(bl=`kg-local-path-${e[79]}`)&&a(ot,"id",bl),ge[0]&16&&(ot.readOnly=e[4]),ge[0]&264&&ot.value!==e[3].roles[e[79]].kg.local_path&&Ae(ot,e[3].roles[e[79]].kg.local_path),e[4]?kt||(kt=Ln(),kt.c(),kt.m(Kt,null)):kt&&(kt.d(1),kt=null),ge[0]&264&&kl!==(kl=`kg-local-type-${e[79]}`)&&a(Xt,"for",kl),ge[0]&264&&yl!==(yl=`kg-local-type-${e[79]}`)&&a(Et,"id",yl),ge[0]&264&&De(Et,e[3].roles[e[79]].kg.local_type),ge[0]&264&&$l!==($l=`kg-public-${e[79]}`)&&a(Dt,"id",$l),ge[0]&264&&(Dt.checked=e[3].roles[e[79]].kg.public),ge[0]&264&&Sl!==(Sl=`kg-public-${e[79]}`)&&a(jt,"for",Sl),ge[0]&264&&Cl!==(Cl=`kg-publish-${e[79]}`)&&a(Mt,"id",Cl),ge[0]&264&&(Mt.checked=e[3].roles[e[79]].kg.publish),ge[0]&264&&Tl!==(Tl=`kg-publish-${e[79]}`)&&a(Gt,"for",Tl),ge[0]&264&&Rl!==(Rl="remove-role-"+e[79])&&a(Wt,"data-testid",Rl)},d(Ie){Ie&&A(t),Ye(nt,Ie),Ye(st,Ie),ft&&ft.d(),dt&&dt.d(),kt&&kt.d(),Pl=!1,Je(no)}}}function Nn(l){let e,t=l[74]+"",o;return{c(){e=f("option"),o=F(t),e.__value=l[74],e.value=e.__value},m(n,u){E(n,e,u),s(e,o)},p:ye,d(n){n&&A(e)}}}function On(l){let e,t=l[71].name+"",o,n;return{c(){e=f("option"),o=F(t),e.__value=n=l[71].name,e.value=e.__value},m(u,r){E(u,e,r),s(e,o)},p(u,r){r[0]&8&&t!==(t=u[71].name+"")&&_e(o,t),r[0]&264&&n!==(n=u[71].name)&&(e.__value=n,e.value=e.__value)},d(u){u&&A(e)}}}function Pn(l){let e,t,o;return{c(){e=f("button"),e.textContent="Back",a(e,"class","button"),a(e,"data-testid","wizard-back")},m(n,u){E(n,e,u),t||(o=Z(e,"click",l[11]),t=!0)},p:ye,d(n){n&&A(e),t=!1,o()}}}function yi(l){let e,t,o;return{c(){e=f("button"),e.textContent="Save",a(e,"class","button is-success"),a(e,"data-testid","wizard-save")},m(n,u){E(n,e,u),t||(o=Z(e,"click",l[19]),t=!0)},p:ye,d(n){n&&A(e),t=!1,o()}}}function $i(l){let e,t,o;return{c(){e=f("button"),e.textContent="Next",a(e,"class","button is-primary"),a(e,"data-testid","wizard-next")},m(n,u){E(n,e,u),t||(o=Z(e,"click",l[10]),t=!0)},p:ye,d(n){n&&A(e),t=!1,o()}}}function Si(l){let e,t,o,n,u,r,c,i,d,p,_,m,y,h,b,k,C,v;e=new rl({props:{fallbackPath:"/"}});let w=l[2]==="success"&&pn(l),T=l[2]==="error"&&_n(l);function J(R,L){return R[1]===1?vi:R[1]===2?bi:gi}let U=J(l),H=U(l),N=l[1]>1&&Pn(l);function q(R,L){return R[1]<Xn?$i:yi}let G=q(l),K=G(l);return{c(){ae(e.$$.fragment),t=g(),o=f("div"),n=f("div"),u=f("h3"),u.textContent="Configuration Wizard",r=g(),c=f("button"),c.textContent="Close",i=g(),w&&w.c(),d=g(),T&&T.c(),p=g(),H.c(),_=g(),m=f("nav"),y=f("div"),N&&N.c(),h=g(),b=f("div"),K.c(),a(u,"class","title is-4"),re(u,"margin-bottom","0"),a(c,"class","button is-small is-light"),a(c,"aria-label","Close configuration wizard"),a(n,"class","is-flex is-justify-content-space-between is-align-items-center"),re(n,"gap",".5rem"),a(y,"class","level-left"),a(b,"class","level-right"),a(m,"class","level"),a(o,"class","box")},m(R,L){ue(e,R,L),E(R,t,L),E(R,o,L),s(o,n),s(n,u),s(n,r),s(n,c),s(o,i),w&&w.m(o,null),s(o,d),T&&T.m(o,null),s(o,p),H.m(o,null),s(o,_),s(o,m),s(m,y),N&&N.m(y,null),s(m,h),s(m,b),K.m(b,null),k=!0,C||(v=Z(c,"click",Ci),C=!0)},p(R,L){R[2]==="success"?w?w.p(R,L):(w=pn(R),w.c(),w.m(o,d)):w&&(w.d(1),w=null),R[2]==="error"?T?T.p(R,L):(T=_n(R),T.c(),T.m(o,p)):T&&(T.d(1),T=null),U===(U=J(R))&&H?H.p(R,L):(H.d(1),H=U(R),H&&(H.c(),H.m(o,_))),R[1]>1?N?N.p(R,L):(N=Pn(R),N.c(),N.m(y,null)):N&&(N.d(1),N=null),G===(G=q(R))&&K?K.p(R,L):(K.d(1),K=G(R),K&&(K.c(),K.m(b,null)))},i(R){k||(W(e.$$.fragment,R),k=!0)},o(R){V(e.$$.fragment,R),k=!1},d(R){ce(e,R),R&&A(t),R&&A(o),w&&w.d(),T&&T.d(),H.d(),N&&N.d(),K.d(),C=!1,v()}}}const Xn=3;function Ci(){typeof window<"u"&&window.history.back()}function Ti(l,e,t){let o,n;Re(l,je,M=>t(4,n=M));const u=Lt(null);async function r(M,X){if(Ze(je))try{const j=await ln({directory:!0,multiple:!1});j&&typeof j=="string"&&i.update(te=>(te.roles[M].haystacks[X].path=j,te))}catch(j){console.error("Failed to open folder selector:",j)}}async function c(M){if(Ze(je))try{const X=await ln({directory:!0,multiple:!1});X&&typeof X=="string"&&i.update(j=>(j.roles[M].kg.local_path=X,j))}catch(X){console.error("Failed to open folder selector:",X)}}const i=Lt({id:"Desktop",global_shortcut:"Ctrl+X",default_theme:"spacelab",default_role:"Default",roles:[]});Re(l,i,M=>t(3,o=M));const d=["default","darkly","cerulean","cosmo","cyborg","flatly","journal","litera","lumen","lux","materia","minty","nuclear","pulse","sandstone","simplex","slate","solar","spacelab","superhero","united","yeti"];qt(async()=>{try{let M;Ze(je)?M=await We("get_config_schema"):M=await(await fetch("/config/schema")).json(),u.set(M);const X=Ze(St);X&&X.id&&i.update(j=>{var te;return{...j,id:X.id,global_shortcut:X.global_shortcut,default_theme:((te=X.roles[X.default_role])==null?void 0:te.theme)??"spacelab",default_role:X.default_role,roles:Object.values(X.roles).map(me=>{var Ee,Fe,bt,ct,il,zt,al,Qt,Ft,ul,Ut;const de=(Ee=me.kg)==null?void 0:Ee.automata_path,Me=(de==null?void 0:de.Remote)??"",qe=((bt=(Fe=me.kg)==null?void 0:Fe.knowledge_graph_local)==null?void 0:bt.path)??"";return{name:me.name,shortname:me.shortname,relevance_function:me.relevance_function,terraphim_it:me.terraphim_it??!1,theme:me.theme,haystacks:(me.haystacks??[]).map(vt=>({path:vt.location||vt.path||"",read_only:vt.read_only??!1,service:vt.service||"Ripgrep",atomic_server_secret:vt.atomic_server_secret||"",extra_parameters:vt.extra_parameters||{}})),kg:{url:Me,local_path:qe,local_type:((il=(ct=me.kg)==null?void 0:ct.knowledge_graph_local)==null?void 0:il.input_type)??"markdown",public:((zt=me.kg)==null?void 0:zt.public)??!1,publish:((al=me.kg)==null?void 0:al.publish)??!1},openrouter_enabled:me.openrouter_enabled??!1,openrouter_api_key:me.openrouter_api_key??"",openrouter_model:me.openrouter_model??"openai/gpt-3.5-turbo",openrouter_auto_summarize:me.openrouter_auto_summarize??!1,openrouter_chat_enabled:me.openrouter_chat_enabled??!1,openrouter_chat_model:me.openrouter_chat_model??me.openrouter_model??"openai/gpt-3.5-turbo",openrouter_chat_system_prompt:me.openrouter_chat_system_prompt??"",llm_provider:((Qt=me.extra)==null?void 0:Qt.llm_provider)??"",llm_model:((Ft=me.extra)==null?void 0:Ft.llm_model)??"",llm_base_url:((ul=me.extra)==null?void 0:ul.llm_base_url)??"",llm_auto_summarize:((Ut=me.extra)==null?void 0:Ut.llm_auto_summarize)??!1}})}})}catch(M){console.error("Failed to load schema",M)}}),qt(()=>{const M=X=>{X.key==="Escape"&&typeof window<"u"&&window.history.back()};return window.addEventListener("keydown",M),()=>window.removeEventListener("keydown",M)});let p={};async function _(M){var de;const j=Ze(i).roles[M],te=j.llm_provider||(j.openrouter_enabled?"openrouter":""),me=[];try{if(te==="ollama"){const Me=(j.llm_base_url||"http://127.0.0.1:11434").replace(/\/$/,""),Ee=await(await fetch(`${Me}/api/tags`)).json();if(Array.isArray(Ee==null?void 0:Ee.models))for(const Fe of Ee.models)Fe!=null&&Fe.name&&me.push(Fe.name)}else if(te==="openrouter"){const Me=(de=j.openrouter_api_key)==null?void 0:de.trim();if(!Me)throw new Error("OpenRouter API key required");const Ee=await(await fetch("https://openrouter.ai/api/v1/models",{headers:{Authorization:`Bearer ${Me}`,"HTTP-Referer":"https://terraphim.ai","X-Title":"Terraphim Desktop"}})).json(),Fe=Array.isArray(Ee==null?void 0:Ee.data)?Ee.data:[];for(const bt of Fe)bt!=null&&bt.id&&me.push(bt.id)}}catch(Me){console.error("Failed to fetch models",Me)}t(0,p={...p,[M]:me})}let m=1,y="";function h(){m<Xn&&t(1,m+=1)}function b(){m>1&&t(1,m-=1)}function k(){i.update(M=>({...M,roles:[...M.roles,{name:"New Role",shortname:"new",relevance_function:"title-scorer",terraphim_it:!1,theme:"spacelab",haystacks:[],kg:{url:"",local_path:"",local_type:"markdown",public:!1,publish:!1},openrouter_enabled:!1,openrouter_api_key:"",openrouter_model:"openai/gpt-3.5-turbo",openrouter_auto_summarize:!1,openrouter_chat_enabled:!1,openrouter_chat_model:"openai/gpt-3.5-turbo",openrouter_chat_system_prompt:"",llm_provider:"",llm_model:"",llm_base_url:"",llm_auto_summarize:!1}]}))}function C(M){i.update(X=>({...X,roles:X.roles.filter((j,te)=>te!==M)}))}function v(M){i.update(X=>(X.roles[M].haystacks.push({path:"",read_only:!1,service:"Ripgrep",atomic_server_secret:"",extra_parameters:{}}),X))}function w(M,X){i.update(j=>(j.roles[M].haystacks=j.roles[M].haystacks.filter((te,me)=>me!==X),j))}function T(M,X,j="",te=""){i.update(me=>{me.roles[M].haystacks[X].extra_parameters||(me.roles[M].haystacks[X].extra_parameters={});const de=j||`param_${Date.now()}`;return me.roles[M].haystacks[X].extra_parameters[de]=te,me})}function J(M,X,j){i.update(te=>(delete te.roles[M].haystacks[X].extra_parameters[j],te))}function U(M,X,j,te){i.update(me=>{const de=me.roles[M].haystacks[X].extra_parameters;return de[j]!==void 0&&j!==te&&(de[te]=de[j],delete de[j]),me})}function H(M,X,j,te){const me=te.target.value;U(M,X,j,me)}async function N(){var me;const M=Ze(i),X=Ze(St);let j={...X};j.id=M.id,j.global_shortcut=M.global_shortcut,j.default_role=M.default_role;const te={};M.roles.forEach(de=>{var Fe,bt;const Me=de.name,qe=Me.replace(/^"|"$/g,"");te[qe]={extra:((bt=(Fe=X.roles)==null?void 0:Fe[Me])==null?void 0:bt.extra)??{},name:de.name,shortname:de.shortname,theme:de.theme,relevance_function:de.relevance_function,terraphim_it:de.terraphim_it??!1,haystacks:de.haystacks.map(ct=>({location:ct.path,service:ct.service,read_only:ct.read_only,atomic_server_secret:ct.service==="Atomic"?ct.atomic_server_secret:void 0,extra_parameters:ct.extra_parameters||{}})),kg:de.kg.url||de.kg.local_path?{automata_path:de.kg.url?{Remote:de.kg.url}:null,knowledge_graph_local:de.kg.local_path?{input_type:de.kg.local_type,path:de.kg.local_path}:null,public:de.kg.public,publish:de.kg.publish}:null,...de.openrouter_enabled&&{openrouter_enabled:de.openrouter_enabled,openrouter_api_key:de.openrouter_api_key,openrouter_model:de.openrouter_model,openrouter_auto_summarize:de.openrouter_auto_summarize??!1,openrouter_chat_enabled:de.openrouter_chat_enabled??!1,openrouter_chat_model:de.openrouter_chat_model??de.openrouter_model,openrouter_chat_system_prompt:de.openrouter_chat_system_prompt??""}};const Ee={};de.llm_provider&&(Ee.llm_provider=de.llm_provider),de.llm_model&&(Ee.llm_model=de.llm_model),de.llm_base_url&&(Ee.llm_base_url=de.llm_base_url),typeof de.llm_auto_summarize=="boolean"&&(Ee.llm_auto_summarize=de.llm_auto_summarize),te[qe].extra={...te[qe].extra||{},...Ee}}),j.roles=te,(!j.default_role||!te[j.default_role])&&(j.default_role=((me=M.roles[0])==null?void 0:me.name)??"Default"),j.selected_role=j.default_role;try{if(Ze(je))await We("update_config",{configNew:j});else{const de=await fetch("/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(j)});if(!de.ok)throw new Error(`HTTP ${de.status}: ${de.statusText}`)}St.set(j),t(2,y="success"),setTimeout(()=>{t(2,y="")},3e3)}catch(de){console.error(de),t(2,y="error"),setTimeout(()=>{t(2,y="")},3e3)}}const q=()=>t(2,y=""),G=()=>t(2,y="");function K(){o.id=Rt(this),i.set(o),t(8,d)}function R(){o.global_shortcut=this.value,i.set(o),t(8,d)}function L(){o.default_theme=Rt(this),i.set(o),t(8,d)}function O(){o.default_role=Rt(this),i.set(o),t(8,d)}function S(M){o.roles[M].name=this.value,i.set(o),t(8,d)}function z(M){o.roles[M].shortname=this.value,i.set(o),t(8,d)}function x(M){o.roles[M].theme=Rt(this),i.set(o),t(8,d)}function B(M){o.roles[M].relevance_function=Rt(this),i.set(o),t(8,d)}function Y(M){o.roles[M].terraphim_it=this.checked,i.set(o),t(8,d)}function $(M,X){o.roles[M].haystacks[X].service=Rt(this),i.set(o),t(8,d)}function P(M,X){o.roles[M].haystacks[X].path=this.value,i.set(o),t(8,d)}const I=(M,X)=>r(M,X);function D(M,X){o.roles[M].haystacks[X].atomic_server_secret=this.value,i.set(o),t(8,d)}function Q(M,X){o.roles[M].haystacks[X].extra_parameters.tag=this.value,i.set(o),t(8,d)}const ee=(M,X,j)=>{const te=j.currentTarget.value;te&&dl(i,o.roles[M].haystacks[X].extra_parameters.tag=te,o)},ne=(M,X,j,te)=>H(M,X,j,te);function ke(M,X,j){o.roles[M].haystacks[X].extra_parameters[j]=this.value,i.set(o),t(8,d)}const be=(M,X,j)=>J(M,X,j),Pe=(M,X)=>T(M,X,"tag","#rust"),pe=(M,X)=>T(M,X,"max_count","10"),fe=(M,X)=>T(M,X,"","");function ie(M,X){o.roles[M].haystacks[X].read_only=this.checked,i.set(o),t(8,d)}const Ce=(M,X)=>w(M,X),Te=M=>v(M);function oe(M){o.roles[M].llm_provider=Rt(this),i.set(o),t(8,d)}function he(M){o.roles[M].llm_model=this.value,i.set(o),t(8,d)}const se=M=>_(M),ve=(M,X)=>{dl(i,o.roles[M].llm_model=X.currentTarget.value,o)};function Be(M){o.roles[M].llm_base_url=this.value,i.set(o),t(8,d)}function Se(M){o.roles[M].llm_auto_summarize=this.checked,i.set(o),t(8,d)}function Ne(M){o.roles[M].openrouter_enabled=this.checked,i.set(o),t(8,d)}function le(M){o.roles[M].openrouter_api_key=this.value,i.set(o),t(8,d)}function we(M){o.roles[M].openrouter_model=this.value,i.set(o),t(8,d)}const Ue=M=>_(M),Xe=(M,X)=>{dl(i,o.roles[M].openrouter_model=X.currentTarget.value,o)};function He(M){o.roles[M].openrouter_auto_summarize=this.checked,i.set(o),t(8,d)}function Oe(M){o.roles[M].openrouter_chat_enabled=this.checked,i.set(o),t(8,d)}function ht(M){o.roles[M].openrouter_chat_model=Rt(this),i.set(o),t(8,d)}function ze(M){o.roles[M].openrouter_chat_system_prompt=this.value,i.set(o),t(8,d)}function Ct(M){o.roles[M].kg.url=this.value,i.set(o),t(8,d)}function tt(M){o.roles[M].kg.local_path=this.value,i.set(o),t(8,d)}const gt=M=>c(M);function Qe(M){o.roles[M].kg.local_type=Rt(this),i.set(o),t(8,d)}function lt(M){o.roles[M].kg.public=this.checked,i.set(o),t(8,d)}function ut(M){o.roles[M].kg.publish=this.checked,i.set(o),t(8,d)}return[p,m,y,o,n,r,c,i,d,_,h,b,k,C,v,w,T,J,H,N,q,G,K,R,L,O,S,z,x,B,Y,$,P,I,D,Q,ee,ne,ke,be,Pe,pe,fe,ie,Ce,Te,oe,he,se,ve,Be,Se,Ne,le,we,Ue,Xe,He,Oe,ht,ze,Ct,tt,gt,Qe,lt,ut,M=>C(M),()=>{t(1,m=2)}]}class Ri extends _t{constructor(e){super(),mt(this,e,Ti,Si,it,{},null,[-1,-1,-1,-1])}}function Ai(l){let e,t,o,n,u,r,c,i;return e=new rl({props:{fallbackPath:"/"}}),c=new Vn({props:{content:l[0],onChange:l[1]}}),{c(){ae(e.$$.fragment),t=g(),o=f("div"),n=f("p"),n.innerHTML="<i>The best editing experience is to configure Atomic Server, in the meantime use editor below. You will need to refresh page via Command R or Ctrl-R to see changes</i>",u=g(),r=f("div"),ae(c.$$.fragment),a(r,"class","editor"),a(o,"class","box")},m(d,p){ue(e,d,p),E(d,t,p),E(d,o,p),s(o,n),s(o,u),s(o,r),ue(c,r,null),i=!0},p(d,[p]){const _={};p&1&&(_.content=d[0]),c.$set(_)},i(d){i||(W(e.$$.fragment,d),W(c.$$.fragment,d),i=!0)},o(d){V(e.$$.fragment,d),V(c.$$.fragment,d),i=!1},d(d){ce(e,d),d&&A(t),d&&A(o),ce(c)}}}function Li(l,e,t){let o,n;Re(l,St,c=>t(2,o=c)),Re(l,je,c=>t(3,n=c));let u={json:o};function r(c){if(console.log("contents changed:",c),console.log("is tauri",n),St.update(i=>(i=c.json,i)),Ze(je))console.log("Updating config on server"),We("update_config",{configNew:c.json}).then(i=>{console.log(`Message: ${i}`)}).catch(i=>console.error(i));else{let i=`${pt.ServerURL}/config/`;fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c.json)})}t(0,u=c)}return qt(()=>{t(0,u={json:o})}),[u,r]}class Ei extends _t{constructor(e){super(),mt(this,e,Li,Ai,it,{})}}const{window:Dl}=bs;function Ni(l){let e,t,o,n,u,r,c,i,d,p;return{c(){e=f("div"),t=f("div"),o=f("h3"),o.textContent="Error loading graph",n=g(),u=f("p"),r=F(l[3]),c=g(),i=f("button"),i.textContent="Retry",a(i,"class","button is-primary"),a(t,"class","error-content svelte-1ry9pkl"),a(e,"class","error-overlay svelte-1ry9pkl")},m(_,m){E(_,e,m),s(e,t),s(t,o),s(t,n),s(t,u),s(u,r),s(t,c),s(t,i),d||(p=Z(i,"click",l[11]),d=!0)},p(_,m){m&8&&_e(r,_[3])},d(_){_&&A(e),d=!1,p()}}}function Oi(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="loading-content svelte-1ry9pkl"><div class="loader svelte-1ry9pkl"></div> 
        <p>Loading knowledge graph...</p></div>`,a(e,"class","loading-overlay svelte-1ry9pkl")},m(t,o){E(t,e,o)},p:ye,d(t){t&&A(e)}}}function In(l){let e,t,o;return{c(){e=f("button"),e.innerHTML='<i class="fas fa-times svelte-1ry9pkl"></i>',a(e,"class","close-button svelte-1ry9pkl"),a(e,"title","Close Graph")},m(n,u){E(n,e,u),t||(o=Z(e,"click",l[17]),t=!0)},p:ye,d(n){n&&A(e),t=!1,o()}}}function Un(l){let e;return{c(){e=f("div"),e.innerHTML="<span><strong>Left-click:</strong> View node • <strong>Right-click:</strong> Edit node • <strong>Drag:</strong> Move • <strong>Scroll:</strong> Zoom</span>",a(e,"class","controls-info svelte-1ry9pkl")},m(t,o){E(t,e,o)},d(t){t&&A(e)}}}function Dn(l){let e,t;return{c(){e=f("div"),t=F(l[8]),a(e,"class","debug-message svelte-1ry9pkl")},m(o,n){E(o,e,n),s(e,t)},p(o,n){n&256&&_e(t,o[8])},d(o){o&&A(e)}}}function Mn(l){let e=l[5].id,t,o,n=jn(l);return{c(){n.c(),t=at()},m(u,r){n.m(u,r),E(u,t,r),o=!0},p(u,r){r&32&&it(e,e=u[5].id)?(Ke(),V(n,1,1,ye),Ge(),n=jn(u),n.c(),W(n,1),n.m(t.parentNode,t)):n.p(u,r)},i(u){o||(W(n),o=!0)},o(u){V(n),o=!1},d(u){u&&A(t),n.d(u)}}}function jn(l){let e,t,o;function n(r){l[18](r)}let u={item:l[5],initialEdit:l[7]};return l[6]!==void 0&&(u.active=l[6]),e=new Hl({props:u}),Ve.push(()=>xe(e,"active",n)),e.$on("close",l[12]),e.$on("save",l[13]),{c(){ae(e.$$.fragment)},m(r,c){ue(e,r,c),o=!0},p(r,c){const i={};c&32&&(i.item=r[5]),c&128&&(i.initialEdit=r[7]),!t&&c&64&&(t=!0,i.active=r[6],et(()=>t=!1)),e.$set(i)},i(r){o||(W(e.$$.fragment,r),o=!0)},o(r){V(e.$$.fragment,r),o=!1},d(r){ce(e,r)}}}function Pi(l){let e,t,o,n,u,r,c,i,d,p,_;rt(l[15]),e=new rl({props:{fallbackPath:"/"}});function m(w,T){if(w[2])return Oi;if(w[3])return Ni}let y=m(l),h=y&&y(l),b=l[0]&&In(l),k=!l[2]&&!l[3]&&l[4].length>0&&Un(),C=l[8]&&Dn(l),v=l[5]&&Mn(l);return{c(){ae(e.$$.fragment),t=g(),o=f("div"),h&&h.c(),n=g(),b&&b.c(),u=g(),k&&k.c(),r=g(),C&&C.c(),c=g(),v&&v.c(),i=at(),a(o,"class","graph-container svelte-1ry9pkl"),re(o,"width",l[0]?"100vw":"600px"),re(o,"height",l[0]?"100vh":"400px"),It(o,"fullscreen",l[0])},m(w,T){ue(e,w,T),E(w,t,T),E(w,o,T),h&&h.m(o,null),l[16](o),E(w,n,T),b&&b.m(w,T),E(w,u,T),k&&k.m(w,T),E(w,r,T),C&&C.m(w,T),E(w,c,T),v&&v.m(w,T),E(w,i,T),d=!0,p||(_=Z(Dl,"resize",l[15]),p=!0)},p(w,[T]){y===(y=m(w))&&h?h.p(w,T):(h&&h.d(1),h=y&&y(w),h&&(h.c(),h.m(o,null))),(!d||T&1)&&re(o,"width",w[0]?"100vw":"600px"),(!d||T&1)&&re(o,"height",w[0]?"100vh":"400px"),(!d||T&1)&&It(o,"fullscreen",w[0]),w[0]?b?b.p(w,T):(b=In(w),b.c(),b.m(u.parentNode,u)):b&&(b.d(1),b=null),!w[2]&&!w[3]&&w[4].length>0?k||(k=Un(),k.c(),k.m(r.parentNode,r)):k&&(k.d(1),k=null),w[8]?C?C.p(w,T):(C=Dn(w),C.c(),C.m(c.parentNode,c)):C&&(C.d(1),C=null),w[5]?v?(v.p(w,T),T&32&&W(v,1)):(v=Mn(w),v.c(),W(v,1),v.m(i.parentNode,i)):v&&(Ke(),V(v,1,1,()=>{v=null}),Ge())},i(w){d||(W(e.$$.fragment,w),W(v),d=!0)},o(w){V(e.$$.fragment,w),V(v),d=!1},d(w){ce(e,w),w&&A(t),w&&A(o),h&&h.d(),l[16](null),w&&A(n),b&&b.d(w),w&&A(u),k&&k.d(w),w&&A(r),C&&C.d(w),w&&A(c),v&&v.d(w),w&&A(i),p=!1,_()}}}function Hn(l){return{id:`kg-node-${l.id}`,url:`#/graph/node/${l.id}`,title:l.label,body:`# ${l.label}

**Knowledge Graph Node**

ID: ${l.id}
Rank: ${l.rank}

This is a concept node from the knowledge graph. You can edit this content to add more information about "${l.label}".`,description:`Knowledge graph concept: ${l.label}`,tags:["knowledge-graph","concept"],rank:l.rank,stub:`Knowledge graph concept: ${l.label}`}}function Ii(l,e,t){let o,n;Re(l,At,L=>t(20,o=L)),Re(l,je,L=>t(21,n=L));let{apiUrl:u="/rolegraph"}=e,{fullscreen:r=!0}=e,c,i=!0,d=null,p=[],_=[],m=null,y=!1,h=!1,b="",k=window.innerWidth,C=window.innerHeight;function v(){t(9,k=window.innerWidth),t(10,C=window.innerHeight),!i&&!d&&N()}async function w(){t(2,i=!0),t(3,d=null);try{if(n){console.log("Loading rolegraph from Tauri");const L=await We("get_rolegraph",{role_name:o||void 0});if(L&&L.status==="success")t(4,p=L.nodes),_=L.edges;else throw new Error(`Tauri rolegraph fetch failed: ${(L==null?void 0:L.status)||"unknown error"}`)}else{console.log("Loading rolegraph from server");const L=o?`${u}?role=${encodeURIComponent(o)}`:u,O=await fetch(L);if(!O.ok)throw new Error(`Failed to fetch: ${O.status}`);const S=await O.json();t(4,p=S.nodes),_=S.edges}}catch(L){t(3,d=L.message),console.error("Error fetching rolegraph:",L)}finally{t(2,i=!1)}}function T(L,O){L.stopPropagation(),console.log("Node clicked:",O.label),t(5,m=Hn(O)),t(7,h=!1),t(6,y=!0)}function J(L,O){L.preventDefault(),L.stopPropagation(),console.log("Node right-clicked:",O.label),t(8,b=`Right-clicked: ${O.label}`),t(5,m=Hn(O)),t(7,h=!0),t(6,y=!0),setTimeout(()=>{t(8,b="")},2e3)}function U(){t(6,y=!1),t(5,m=null),t(7,h=!1)}async function H(){if(m)try{const L=await fetch("/documents",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)});L.ok?console.log("Successfully saved KG record:",m.id):console.error("Failed to save KG record:",L.statusText)}catch(L){console.error("Error saving KG record:",L)}finally{t(6,y=!1),t(5,m=null),t(7,h=!1)}}function N(){if(!c)return;t(1,c.innerHTML="",c);const L=Il(c).append("svg").attr("width",k).attr("height",C),O=Ls().scaleExtent([.1,10]).on("zoom",D=>{S.attr("transform",D.transform)});L.call(O);const S=L.append("g"),z=Es(p).force("link",Ns(_).id(D=>D.id).distance(100)).force("charge",Os().strength(-200)).force("center",Ps(k/2,C/2)).force("collision",Is().radius(20)),x=S.append("g").attr("class","links").selectAll("line").data(_).enter().append("line").attr("stroke","#666").attr("stroke-opacity",.7).attr("stroke-width",D=>{const Q=D.weight||D.rank||1;return Math.max(1,Math.min(8,Q*2))}),B=S.append("g").attr("class","nodes").selectAll("circle").data(p).enter().append("circle").attr("r",D=>{const Q=D.rank||1;return Math.max(6,Math.min(20,Q*2))}).attr("fill",D=>{const Q=D.rank||1,ee=Math.min(Q/10,1);return Us(.2+ee*.6)}).attr("stroke","#fff").attr("stroke-width",2).style("cursor","pointer").on("click",(D,Q)=>T(D,Q)).on("contextmenu",(D,Q)=>J(D,Q)).on("mouseover",function(D,Q){Il(this).transition().duration(150).attr("stroke-width",3).attr("r",ee=>{const ne=ee.rank||1;return Math.max(8,Math.min(24,ne*2.5))})}).on("mouseout",function(D,Q){Il(this).transition().duration(150).attr("stroke-width",2).attr("r",ee=>{const ne=ee.rank||1;return Math.max(6,Math.min(20,ne*2))})}).call(Ds().on("start",$).on("drag",P).on("end",I)),Y=S.append("g").attr("class","labels").selectAll("text").data(p).enter().append("text").attr("text-anchor","middle").attr("dy",".35em").attr("font-size","11px").attr("font-family","Arial, sans-serif").attr("fill","#333").attr("pointer-events","none").text(D=>D.label.length>12?D.label.substring(0,12)+"...":D.label);z.on("tick",()=>{x.attr("x1",D=>D.source.x).attr("y1",D=>D.source.y).attr("x2",D=>D.target.x).attr("y2",D=>D.target.y),B.attr("cx",D=>D.x).attr("cy",D=>D.y),Y.attr("x",D=>D.x).attr("y",D=>D.y)});function $(D,Q){D.active||z.alphaTarget(.3).restart(),Q.fx=Q.x,Q.fy=Q.y}function P(D,Q){Q.fx=D.x,Q.fy=D.y}function I(D,Q){D.active||z.alphaTarget(0),Q.fx=null,Q.fy=null}}qt(()=>{w().then(()=>{d||N()});const L=O=>{O.preventDefault()};return c&&c.addEventListener("contextmenu",L),window.addEventListener("resize",v),()=>{c&&c.removeEventListener("contextmenu",L),window.removeEventListener("resize",v)}});function q(){t(9,k=Dl.innerWidth),t(10,C=Dl.innerHeight)}function G(L){Ve[L?"unshift":"push"](()=>{c=L,t(1,c)})}const K=()=>history.back();function R(L){y=L,t(6,y)}return l.$$set=L=>{"apiUrl"in L&&t(14,u=L.apiUrl),"fullscreen"in L&&t(0,r=L.fullscreen)},[r,c,i,d,p,m,y,h,b,k,C,w,U,H,u,q,G,K,R]}class Ui extends _t{constructor(e){super(),mt(this,e,Ii,Pi,it,{apiUrl:14,fullscreen:0})}}function zn(l,e,t){const o=l.slice();return o[9]=e[t],o[11]=t,o}function Fn(l){let e,t,o,n=l[9].content+"",u,r;return{c(){e=f("div"),t=f("div"),o=f("pre"),u=F(n),a(o,"class","svelte-tu8ic4"),a(t,"class","bubble svelte-tu8ic4"),a(e,"class",r=Pt(`msg ${l[9].role}`)+" svelte-tu8ic4")},m(c,i){E(c,e,i),s(e,t),s(t,o),s(o,u)},p(c,i){i&1&&n!==(n=c[9].content+"")&&_e(u,n),i&1&&r!==(r=Pt(`msg ${c[9].role}`)+" svelte-tu8ic4")&&a(e,"class",r)},d(c){c&&A(e)}}}function Kn(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="bubble loading svelte-tu8ic4"><span class="icon is-small"><i class="fas fa-spinner fa-spin"></i></span> 
            <span>Thinking...</span></div>`,a(e,"class","msg assistant svelte-tu8ic4")},m(t,o){E(t,e,o)},d(t){t&&A(e)}}}function Gn(l){let e,t,o;return{c(){e=f("p"),t=F("Model: "),o=F(l[4]),a(e,"class","is-size-7 has-text-grey")},m(n,u){E(n,e,u),s(e,t),s(e,o)},p(n,u){u&16&&_e(o,n[4])},d(n){n&&A(e)}}}function Wn(l){let e,t;return{c(){e=f("p"),t=F(l[3]),a(e,"class","has-text-danger is-size-7")},m(o,n){E(o,e,n),s(e,t)},p(o,n){n&8&&_e(t,o[3])},d(o){o&&A(e)}}}function Di(l){let e,t,o,n,u,r,c,i,d,p,_,m,y,h,b,k,C,v,w,T,J,U,H,N;e=new rl({props:{fallbackPath:"/"}});let q=l[0],G=[];for(let O=0;O<q.length;O+=1)G[O]=Fn(zn(l,q,O));let K=l[2]&&Kn(),R=l[4]&&Gn(l),L=l[3]&&Wn(l);return{c(){ae(e.$$.fragment),t=g(),o=f("section"),n=f("div"),u=f("h2"),u.textContent="Chat",r=g(),c=f("p"),c.textContent=`Role: ${Ze(At)}`,i=g(),d=f("div");for(let O=0;O<G.length;O+=1)G[O].c();p=g(),K&&K.c(),_=g(),R&&R.c(),m=g(),L&&L.c(),y=g(),h=f("div"),b=f("div"),k=f("textarea"),C=g(),v=f("div"),w=f("button"),T=f("span"),T.innerHTML='<i class="fas fa-paper-plane"></i>',a(u,"class","title is-4"),a(c,"class","subtitle is-6"),a(d,"class","chat-window svelte-tu8ic4"),a(k,"class","textarea"),a(k,"rows","3"),a(k,"placeholder","Type your message and press Enter..."),a(b,"class","control is-expanded"),a(T,"class","icon"),a(w,"class","button is-primary"),w.disabled=J=l[2]||!l[1].trim(),a(v,"class","control"),a(h,"class","field has-addons chat-input svelte-tu8ic4"),a(n,"class","container"),a(o,"class","section")},m(O,S){ue(e,O,S),E(O,t,S),E(O,o,S),s(o,n),s(n,u),s(n,r),s(n,c),s(n,i),s(n,d);for(let z=0;z<G.length;z+=1)G[z]&&G[z].m(d,null);s(d,p),K&&K.m(d,null),s(n,_),R&&R.m(n,null),s(n,m),L&&L.m(n,null),s(n,y),s(n,h),s(h,b),s(b,k),Ae(k,l[1]),s(h,C),s(h,v),s(v,w),s(w,T),U=!0,H||(N=[Z(k,"input",l[7]),Z(k,"keydown",l[6]),Z(w,"click",l[5])],H=!0)},p(O,[S]){if(S&1){q=O[0];let z;for(z=0;z<q.length;z+=1){const x=zn(O,q,z);G[z]?G[z].p(x,S):(G[z]=Fn(x),G[z].c(),G[z].m(d,p))}for(;z<G.length;z+=1)G[z].d(1);G.length=q.length}O[2]?K||(K=Kn(),K.c(),K.m(d,null)):K&&(K.d(1),K=null),O[4]?R?R.p(O,S):(R=Gn(O),R.c(),R.m(n,m)):R&&(R.d(1),R=null),O[3]?L?L.p(O,S):(L=Wn(O),L.c(),L.m(n,y)):L&&(L.d(1),L=null),S&2&&Ae(k,O[1]),(!U||S&6&&J!==(J=O[2]||!O[1].trim()))&&(w.disabled=J)},i(O){U||(W(e.$$.fragment,O),U=!0)},o(O){V(e.$$.fragment,O),U=!1},d(O){ce(e,O),O&&A(t),O&&A(o),Ye(G,O),K&&K.d(),R&&R.d(),L&&L.d(),H=!1,Je(N)}}}function Mi(l,e,t){let o=[],n="",u=!1,r=null,c=null;function i(m){t(0,o=[...o,{role:"user",content:m}])}async function d(){var h;if(!n.trim()||u)return;t(3,r=null);const m=Ze(At),y=n.trim();t(1,n=""),i(y),t(2,u=!0);try{const b=await fetch(`${pt.ServerURL}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({role:m,messages:o})});if(!b.ok)throw new Error(`HTTP ${b.status}`);const k=await b.json();t(4,c=k.model_used??null),((h=k.status)==null?void 0:h.toLowerCase())==="success"&&k.message?t(0,o=[...o,{role:"assistant",content:k.message}]):t(3,r=k.error||"Chat failed")}catch(b){t(3,r=(b==null?void 0:b.message)||String(b))}finally{t(2,u=!1)}}function p(m){(m.key==="Enter"||m.key==="Return")&&!m.shiftKey&&(m.preventDefault(),d())}qt(()=>{t(0,o=[{role:"assistant",content:"Hi! How can I help you? Ask me anything about your search results or documents."}])});function _(){n=this.value,t(1,n)}return[o,n,u,r,c,d,p,_]}class ji extends _t{constructor(e){super(),mt(this,e,Mi,Di,it,{})}}function Hi(l){let e,t;return e=new hi({}),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},i(o){t||(W(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function zi(l){let e,t;return e=new ar({}),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},i(o){t||(W(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function Fi(l){let e,t;return e=new Ri({}),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},i(o){t||(W(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function Ki(l){let e,t;return e=new Ei({}),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},i(o){t||(W(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function Gi(l){let e,t;return e=new Ui({}),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},i(o){t||(W(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function Wi(l){let e,t;return e=new ji({}),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},i(o){t||(W(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function Bi(l){let e;return{c(){e=f("nav"),e.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
            <a class="navbar-item" href="/config/wizard">Wizard</a> 
            <a class="navbar-item" href="/config/json">JSON Editor</a> 
            <a class="navbar-item" href="/graph">Graph</a> 
            <a class="navbar-item" href="/chat">Chat</a></div>`,a(e,"class","navbar")},m(t,o){E(t,e,o)},p:ye,d(t){t&&A(e)}}}function qi(l){let e,t,o,n,u,r,c,i,d,p,_,m,y,h,b,k,C,v,w,T,J,U,H,N,q,G,K,R,L,O;return c=new Ll({}),p=new Nt({props:{path:"/",$$slots:{default:[Hi]},$$scope:{ctx:l}}}),h=new Nt({props:{path:"/fetch/*",$$slots:{default:[zi]},$$scope:{ctx:l}}}),k=new Nt({props:{path:"/config/wizard",$$slots:{default:[Fi]},$$scope:{ctx:l}}}),v=new Nt({props:{path:"/config/json",$$slots:{default:[Ki]},$$scope:{ctx:l}}}),T=new Nt({props:{path:"/graph",$$slots:{default:[Gi]},$$scope:{ctx:l}}}),U=new Nt({props:{path:"/chat",$$slots:{default:[Wi]},$$scope:{ctx:l}}}),G=new Nt({props:{path:"/",$$slots:{default:[Bi]},$$scope:{ctx:l}}}),{c(){e=f("meta"),t=g(),o=f("div"),n=f("main"),u=f("div"),r=f("div"),ae(c.$$.fragment),i=g(),d=f("div"),ae(p.$$.fragment),_=g(),m=f("br"),y=g(),ae(h.$$.fragment),b=g(),ae(k.$$.fragment),C=g(),ae(v.$$.fragment),w=g(),ae(T.$$.fragment),J=g(),ae(U.$$.fragment),H=g(),N=f("footer"),q=f("div"),ae(G.$$.fragment),a(e,"name","color-scheme"),a(e,"content",l[1]),document.title="Terraphim",a(r,"class","role-selector svelte-1bfpta4"),a(u,"class","top-controls svelte-1bfpta4"),a(d,"class","search-area svelte-1bfpta4"),a(n,"class","main-content svelte-1bfpta4"),a(q,"class",K=Pt(l[0])+" svelte-1bfpta4"),a(N,"class","svelte-1bfpta4"),a(o,"class","is-full-height svelte-1bfpta4")},m(S,z){s(document.head,e),E(S,t,z),E(S,o,z),s(o,n),s(n,u),s(u,r),ue(c,r,null),s(n,i),s(n,d),ue(p,d,null),s(n,_),s(n,m),s(n,y),ue(h,n,null),s(n,b),ue(k,n,null),s(n,C),ue(v,n,null),s(n,w),ue(T,n,null),s(n,J),ue(U,n,null),s(o,H),s(o,N),s(N,q),ue(G,q,null),R=!0,L||(O=[Z(N,"mouseover",l[2]),Z(N,"focus",l[2])],L=!0)},p(S,[z]){(!R||z&2)&&a(e,"content",S[1]);const x={};z&8&&(x.$$scope={dirty:z,ctx:S}),p.$set(x);const B={};z&8&&(B.$$scope={dirty:z,ctx:S}),h.$set(B);const Y={};z&8&&(Y.$$scope={dirty:z,ctx:S}),k.$set(Y);const $={};z&8&&($.$$scope={dirty:z,ctx:S}),v.$set($);const P={};z&8&&(P.$$scope={dirty:z,ctx:S}),T.$set(P);const I={};z&8&&(I.$$scope={dirty:z,ctx:S}),U.$set(I);const D={};z&8&&(D.$$scope={dirty:z,ctx:S}),G.$set(D),(!R||z&1&&K!==(K=Pt(S[0])+" svelte-1bfpta4"))&&a(q,"class",K)},i(S){R||(W(c.$$.fragment,S),W(p.$$.fragment,S),W(h.$$.fragment,S),W(k.$$.fragment,S),W(v.$$.fragment,S),W(T.$$.fragment,S),W(U.$$.fragment,S),W(G.$$.fragment,S),R=!0)},o(S){V(c.$$.fragment,S),V(p.$$.fragment,S),V(h.$$.fragment,S),V(k.$$.fragment,S),V(v.$$.fragment,S),V(T.$$.fragment,S),V(U.$$.fragment,S),V(G.$$.fragment,S),R=!1},d(S){A(e),S&&A(t),S&&A(o),ce(c),ce(p),ce(h),ce(k),ce(v),ce(T),ce(U),ce(G),L=!1,Je(O)}}}function Ji(l,e,t){let o;Re(l,pl,r=>t(1,o=r));let n="is-hidden";function u(){t(0,n="")}return[n,o,u]}class Qi extends _t{constructor(e){super(),mt(this,e,Ji,qi,it,{})}}const Vi=new Ss;Cs(Vi);new Qi({target:document.getElementById("app")});
