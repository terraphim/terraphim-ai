var ks=Object.defineProperty;var ws=(l,e,t)=>e in l?ks(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var yt=(l,e,t)=>(ws(l,typeof e!="symbol"?e+"":e,t),t);import{aa as Et,S as gt,i as vt,s as ft,q as f,Y as H,b as L,y as s,Z as we,I as Ee,j as R,ak as De,F as it,m as Jt,a as g,v as a,l as ee,E as Ze,au as Ft,r as ve,z as be,t as Y,d as X,B as ke,av as ys,aw as Vt,H as lt,U as st,V as rt,ax as Pl,ay as $s,g as Ve,e as Qe,O as et,af as Ct,o as Cs,W as _e,az as Fl,aA as St,aB as ts,aC as ls,a1 as Ne,C as nt,aD as We,aE as os,D as sl,G as rl,aF as ns,w as Dt,x as ht,A as zl,a2 as Ts,aG as pl,ac as Ss,a7 as Rs,a9 as Ls,n as As,_ as Il}from"./vendor-ui-cd3d2b6a.js";import{R as Nt,S as Ol,f as Es,Y as Ul}from"./vendor-utils-740e9743.js";import{J as ss,_ as Ps,d as rs,P as Ns,k as Os,D as Ds,l as Is,E as Us,o as mo}from"./vendor-editor-992829d3.js";import{P as is,T as Nl,u as as,y as Ms,A as js,S as Hs,q as Fs}from"./vendor-atomic-1ea13e29.js";import{t as zs,E as qs}from"./novel-editor-becefd2f.js";import{s as Ml,z as Ws,a as Ks,l as Gs,m as Bs,c as Js,b as Vs,B as Qs,d as Ys}from"./vendor-charts-e6a4a6c9.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const r of c.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function t(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(n){if(n.ep)return;n.ep=!0;const c=t(n);fetch(n.href,c)}})();const Ye={ServerURL:location.protocol+"//"+window.location.host||"/"},dl=Et([]),Zs={id:"Desktop",global_shortcut:"",roles:{},default_role:{original:"",lowercase:""},selected_role:{original:"",lowercase:""}},ml=Et("spacelab"),Rt=Et("selected"),xe=Et(!1),Xs=Et(`${Ye.ServerURL}/documents/search`),Lt=Et(Zs),_o=Et([]);let Al=Et("");const $t=Et(!1);let Bt=null;function xs(l){if(typeof document>"u")return;const e=`/assets/bulmaswatch/${l}/bulmaswatch.min.css`;if(Bt!=null&&Bt.href.endsWith(e))return;const t=document.createElement("link");t.rel="stylesheet",t.href=e,t.id="bulma-theme",t.onload=()=>{Bt&&Bt!==t&&Bt.remove(),Bt=t},document.head.appendChild(t);const o=document.head.querySelector('meta[name="color-scheme"]');o&&o.setAttribute("content",l)}ml.subscribe(xs);function er(l){let e,t;return{c(){e=f("option"),t=H(l[1]),e.__value=l[0],e.value=e.__value},m(o,n){L(o,e,n),s(e,t)},p(o,[n]){n&2&&we(t,o[1]),n&1&&(e.__value=o[0],e.value=e.__value)},i:Ee,o:Ee,d(o){o&&R(e)}}}function tr(l,e,t){let o,{subject:n}=e;const c=is(n),r=Nl(c,as.properties.name);return De(l,r,u=>t(1,o=u)),Nl(c,"http://localhost:9883/property/theme"),l.$$set=u=>{"subject"in u&&t(0,n=u.subject)},[n,o,r]}class lr extends gt{constructor(e){super(),vt(this,e,tr,er,ft,{subject:0})}}function ho(l){let e,t,o,n,c,r,u=l[0]&&go();return{c(){e=f("button"),t=f("span"),t.innerHTML='<i class="fas fa-arrow-left"></i>',o=g(),u&&u.c(),a(t,"class","icon svelte-rnsqpo"),a(e,"class",n="button is-light back-button "+l[1]+" svelte-rnsqpo"),a(e,"title","Go back"),a(e,"aria-label","Go back")},m(i,d){L(i,e,d),s(e,t),s(e,o),u&&u.m(e,null),c||(r=[ee(e,"click",l[3]),ee(e,"keydown",l[6])],c=!0)},p(i,d){i[0]?u||(u=go(),u.c(),u.m(e,null)):u&&(u.d(1),u=null),d&2&&n!==(n="button is-light back-button "+i[1]+" svelte-rnsqpo")&&a(e,"class",n)},d(i){i&&R(e),u&&u.d(),c=!1,Ze(r)}}}function go(l){let e;return{c(){e=f("span"),e.textContent="Back",a(e,"class","back-text svelte-rnsqpo")},m(t,o){L(t,e,o)},d(t){t&&R(e)}}}function or(l){let e,t=l[2]&&ho(l);return{c(){t&&t.c(),e=it()},m(o,n){t&&t.m(o,n),L(o,e,n)},p(o,[n]){o[2]?t?t.p(o,n):(t=ho(o),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Ee,o:Ee,d(o){t&&t.d(o),o&&R(e)}}}function nr(l,e,t){let{fallbackPath:o="/"}=e,{showText:n=!0}=e,{customClass:c=""}=e,{hideOnPaths:r=["/"]}=e,u=!0;function i(){var _;try{const m=((_=window.location)==null?void 0:_.pathname)||"/";t(2,u=!r.includes(m))}catch{t(2,u=!0)}}function d(){window.history.length>1?window.history.back():window.location.href=o}Jt(()=>(i(),window.addEventListener("popstate",i),window.addEventListener("hashchange",i),()=>{window.removeEventListener("popstate",i),window.removeEventListener("hashchange",i)}));const p=_=>{(_.key==="Enter"||_.key===" ")&&(_.preventDefault(),d())};return l.$$set=_=>{"fallbackPath"in _&&t(4,o=_.fallbackPath),"showText"in _&&t(0,n=_.showText),"customClass"in _&&t(1,c=_.customClass),"hideOnPaths"in _&&t(5,r=_.hideOnPaths)},[n,c,u,d,o,r,p]}class il extends gt{constructor(e){super(),vt(this,e,nr,or,ft,{fallbackPath:4,showText:0,customClass:1,hideOnPaths:5})}}function sr(){return window.crypto.getRandomValues(new Uint32Array(1))[0]}function jl(l,e=!1){const t=sr(),o=`_${t}`;return Object.defineProperty(window,o,{value:n=>(e&&Reflect.deleteProperty(window,o),l==null?void 0:l(n)),writable:!1,configurable:!0}),t}async function ze(l,e={}){return new Promise((t,o)=>{const n=jl(r=>{t(r),Reflect.deleteProperty(window,`_${c}`)},!0),c=jl(r=>{o(r),Reflect.deleteProperty(window,`_${n}`)},!0);window.__TAURI_IPC__({cmd:l,callback:n,error:c,...e})})}function vo(l,e,t){const o=l.slice();return o[25]=e[t],o}function rr(l){let e,t,o;function n(r){l[13](r)}let c={};return l[5]!==void 0&&(c.value=l[5]),e=new Vt({props:c}),lt.push(()=>st(e,"value",n)),{c(){ve(e.$$.fragment)},m(r,u){be(e,r,u),o=!0},p(r,u){const i={};!t&&u&32&&(t=!0,i.value=r[5],rt(()=>t=!1)),e.$set(i)},i(r){o||(Y(e.$$.fragment,r),o=!0)},o(r){X(e.$$.fragment,r),o=!1},d(r){ke(e,r)}}}function ir(l){let e,t,o;function n(r){l[14](r)}let c={type:"password",placeholder:"secret",icon:"fas fa-lock",expanded:!0};return l[6]!==void 0&&(c.value=l[6]),e=new Vt({props:c}),lt.push(()=>st(e,"value",n)),{c(){ve(e.$$.fragment)},m(r,u){be(e,r,u),o=!0},p(r,u){const i={};!t&&u&64&&(t=!0,i.value=r[6],rt(()=>t=!1)),e.$set(i)},i(r){o||(Y(e.$$.fragment,r),o=!0)},o(r){X(e.$$.fragment,r),o=!1},d(r){ke(e,r)}}}function ar(l){let e;return{c(){e=H("Save")},m(t,o){L(t,e,o)},d(t){t&&R(e)}}}function cr(l){let e,t;return e=new Pl({props:{type:"is-success",class:"is-right",iconPack:"fa",iconLeft:"check",$$slots:{default:[ar]},$$scope:{ctx:l}}}),e.$on("click",l[8]),e.$on("submit",l[8]),{c(){ve(e.$$.fragment)},m(o,n){be(e,o,n),t=!0},p(o,n){const c={};n&268435456&&(c.$$scope={dirty:n,ctx:o}),e.$set(c)},i(o){t||(Y(e.$$.fragment,o),t=!0)},o(o){X(e.$$.fragment,o),t=!1},d(o){ke(e,o)}}}function ur(l){let e,t,o,n,c,r;return e=new Ft({props:{$$slots:{default:[rr]},$$scope:{ctx:l}}}),o=new Ft({props:{grouped:!0,$$slots:{default:[ir]},$$scope:{ctx:l}}}),c=new Ft({props:{grouped:!0,$$slots:{default:[cr]},$$scope:{ctx:l}}}),{c(){ve(e.$$.fragment),t=g(),ve(o.$$.fragment),n=g(),ve(c.$$.fragment)},m(u,i){be(e,u,i),L(u,t,i),be(o,u,i),L(u,n,i),be(c,u,i),r=!0},p(u,i){const d={};i&268435488&&(d.$$scope={dirty:i,ctx:u}),e.$set(d);const p={};i&268435520&&(p.$$scope={dirty:i,ctx:u}),o.$set(p);const _={};i&268435456&&(_.$$scope={dirty:i,ctx:u}),c.$set(_)},i(u){r||(Y(e.$$.fragment,u),Y(o.$$.fragment,u),Y(c.$$.fragment,u),r=!0)},o(u){X(e.$$.fragment,u),X(o.$$.fragment,u),X(c.$$.fragment,u),r=!1},d(u){ke(e,u),u&&R(t),ke(o,u),u&&R(n),ke(c,u)}}}function fr(l){let e,t,o;function n(r){l[15](r)}let c={type:"search",placeholder:"Fetch JSON",icon:"search"};return l[3]!==void 0&&(c.value=l[3]),e=new Vt({props:c}),lt.push(()=>st(e,"value",n)),{c(){ve(e.$$.fragment)},m(r,u){be(e,r,u),o=!0},p(r,u){const i={};!t&&u&8&&(t=!0,i.value=r[3],rt(()=>t=!1)),e.$set(i)},i(r){o||(Y(e.$$.fragment,r),o=!0)},o(r){X(e.$$.fragment,r),o=!1},d(r){ke(e,r)}}}function dr(l){let e;return{c(){e=H("WikiPage")},m(t,o){L(t,e,o)},d(t){t&&R(e)}}}function pr(l){let e,t,o,n,c,r;function u(_){l[16](_)}let i={type:"search",placeholder:"Post JSON",icon:"search"};l[4]!==void 0&&(i.value=l[4]),e=new Vt({props:i}),lt.push(()=>st(e,"value",u));function d(_){l[17](_)}let p={$$slots:{default:[dr]},$$scope:{ctx:l}};return l[2]!==void 0&&(p.checked=l[2]),n=new $s({props:p}),lt.push(()=>st(n,"checked",d)),{c(){ve(e.$$.fragment),o=g(),ve(n.$$.fragment)},m(_,m){be(e,_,m),L(_,o,m),be(n,_,m),r=!0},p(_,m){const b={};!t&&m&16&&(t=!0,b.value=_[4],rt(()=>t=!1)),e.$set(b);const v={};m&268435456&&(v.$$scope={dirty:m,ctx:_}),!c&&m&4&&(c=!0,v.checked=_[2],rt(()=>c=!1)),n.$set(v)},i(_){r||(Y(e.$$.fragment,_),Y(n.$$.fragment,_),r=!0)},o(_){X(e.$$.fragment,_),X(n.$$.fragment,_),r=!1},d(_){ke(e,_),_&&R(o),ke(n,_)}}}function mr(l){let e;return{c(){e=H("Fetch")},m(t,o){L(t,e,o)},d(t){t&&R(e)}}}function _r(l){let e,t;return e=new Pl({props:{type:"is-primary",$$slots:{default:[mr]},$$scope:{ctx:l}}}),e.$on("click",l[9]),e.$on("submit",l[9]),{c(){ve(e.$$.fragment)},m(o,n){be(e,o,n),t=!0},p(o,n){const c={};n&268435456&&(c.$$scope={dirty:n,ctx:o}),e.$set(c)},i(o){t||(Y(e.$$.fragment,o),t=!0)},o(o){X(e.$$.fragment,o),t=!1},d(o){ke(e,o)}}}function hr(l){let e,t,o,n,c,r;return e=new Ft({props:{grouped:!0,$$slots:{default:[fr]},$$scope:{ctx:l}}}),o=new Ft({props:{grouped:!0,$$slots:{default:[pr]},$$scope:{ctx:l}}}),c=new Ft({props:{grouped:!0,$$slots:{default:[_r]},$$scope:{ctx:l}}}),{c(){ve(e.$$.fragment),t=g(),ve(o.$$.fragment),n=g(),ve(c.$$.fragment)},m(u,i){be(e,u,i),L(u,t,i),be(o,u,i),L(u,n,i),be(c,u,i),r=!0},p(u,i){const d={};i&268435464&&(d.$$scope={dirty:i,ctx:u}),e.$set(d);const p={};i&268435476&&(p.$$scope={dirty:i,ctx:u}),o.$set(p);const _={};i&268435456&&(_.$$scope={dirty:i,ctx:u}),c.$set(_)},i(u){r||(Y(e.$$.fragment,u),Y(o.$$.fragment,u),Y(c.$$.fragment,u),r=!0)},o(u){X(e.$$.fragment,u),X(o.$$.fragment,u),X(c.$$.fragment,u),r=!1},d(u){ke(e,u),u&&R(t),ke(o,u),u&&R(n),ke(c,u)}}}function gr(l){let e,t,o,n,c;return n=new ss({props:{content:l[1],onChange:l[7]}}),{c(){e=f("p"),e.innerHTML=`<i>The best editing experience is to configure Atomic Server, in the
        meantime use editor below. You will need to refresh page via Command R
        or Ctrl-R to see changes</i>`,t=g(),o=f("div"),ve(n.$$.fragment),a(o,"class","editor")},m(r,u){L(r,e,u),L(r,t,u),L(r,o,u),be(n,o,null),c=!0},p(r,u){const i={};u&2&&(i.content=r[1]),n.$set(i)},i(r){c||(Y(n.$$.fragment,r),c=!0)},o(r){X(n.$$.fragment,r),c=!1},d(r){r&&R(e),r&&R(t),r&&R(o),ke(n)}}}function bo(l){let e,t;return e=new lr({props:{subject:l[25]}}),{c(){ve(e.$$.fragment)},m(o,n){be(e,o,n),t=!0},p(o,n){const c={};n&1&&(c.subject=o[25]),e.$set(c)},i(o){t||(Y(e.$$.fragment,o),t=!0)},o(o){X(e.$$.fragment,o),t=!1},d(o){ke(e,o)}}}function vr(l){let e,t,o=l[0]??[],n=[];for(let r=0;r<o.length;r+=1)n[r]=bo(vo(l,o,r));const c=r=>X(n[r],1,1,()=>{n[r]=null});return{c(){for(let r=0;r<n.length;r+=1)n[r].c();e=it()},m(r,u){for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(r,u);L(r,e,u),t=!0},p(r,u){if(u&1){o=r[0]??[];let i;for(i=0;i<o.length;i+=1){const d=vo(r,o,i);n[i]?(n[i].p(d,u),Y(n[i],1)):(n[i]=bo(d),n[i].c(),Y(n[i],1),n[i].m(e.parentNode,e))}for(Ve(),i=o.length;i<n.length;i+=1)c(i);Qe()}},i(r){if(!t){for(let u=0;u<o.length;u+=1)Y(n[u]);t=!0}},o(r){n=n.filter(Boolean);for(let u=0;u<n.length;u+=1)X(n[u]);t=!1},d(r){et(n,r),r&&R(e)}}}function br(l){let e,t;return e=new ys({props:{$$slots:{default:[vr]},$$scope:{ctx:l}}}),{c(){ve(e.$$.fragment)},m(o,n){be(e,o,n),t=!0},p(o,n){const c={};n&268435457&&(c.$$scope={dirty:n,ctx:o}),e.$set(c)},i(o){t||(Y(e.$$.fragment,o),t=!0)},o(o){X(e.$$.fragment,o),t=!1},d(o){ke(e,o)}}}function kr(l){let e,t,o,n,c,r,u,i,d,p,_,m,b,v,$;return e=new il({props:{fallbackPath:"/"}}),n=new Nt({props:{path:"/atomic",$$slots:{default:[ur]},$$scope:{ctx:l}}}),r=new Nt({props:{path:"/json",$$slots:{default:[hr]},$$scope:{ctx:l}}}),i=new Nt({props:{path:"/editor",$$slots:{default:[gr]},$$scope:{ctx:l}}}),m=new Ft({props:{grouped:!0,position:"is-right",$$slots:{default:[br]},$$scope:{ctx:l}}}),{c(){ve(e.$$.fragment),t=g(),o=f("div"),ve(n.$$.fragment),c=g(),ve(r.$$.fragment),u=g(),ve(i.$$.fragment),d=g(),p=f("hr"),_=g(),ve(m.$$.fragment),b=g(),v=f("nav"),v.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
    <a class="navbar-item" href="/fetch/json">Fetch JSON Data</a> 
    <a class="navbar-item" href="/fetch/atomic">Set Atomic Server</a> 
    <a class="navbar-item" href="/fetch/editor">Edit JSON config</a></div>`,a(o,"class","box"),a(v,"class","navbar")},m(w,k){be(e,w,k),L(w,t,k),L(w,o,k),be(n,o,null),s(o,c),be(r,o,null),s(o,u),be(i,o,null),L(w,d,k),L(w,p,k),L(w,_,k),be(m,w,k),L(w,b,k),L(w,v,k),$=!0},p(w,[k]){const y={};k&268435552&&(y.$$scope={dirty:k,ctx:w}),n.$set(y);const h={};k&268435484&&(h.$$scope={dirty:k,ctx:w}),r.$set(h);const T={};k&268435458&&(T.$$scope={dirty:k,ctx:w}),i.$set(T);const j={};k&268435457&&(j.$$scope={dirty:k,ctx:w}),m.$set(j)},i(w){$||(Y(e.$$.fragment,w),Y(n.$$.fragment,w),Y(r.$$.fragment,w),Y(i.$$.fragment,w),Y(m.$$.fragment,w),$=!0)},o(w){X(e.$$.fragment,w),X(n.$$.fragment,w),X(r.$$.fragment,w),X(i.$$.fragment,w),X(m.$$.fragment,w),$=!1},d(w){ke(e,w),w&&R(t),w&&R(o),ke(n),ke(r),ke(i),w&&R(d),w&&R(p),w&&R(_),ke(m,w),w&&R(b),w&&R(v)}}}function wr(l,e,t){let o,n,c,r,u;De(l,Ms,S=>t(19,c=S)),De(l,xe,S=>t(20,r=S)),De(l,Lt,S=>t(21,u=S));let i={json:u};function d(S){if(console.log("contents changed:",S),console.log("is tauri",r),Lt.update(C=>(C=S.json,C)),xe)console.log("Updating config on server"),ze("update_config",{configNew:S.json}).then(C=>{console.log(`Message: ${C}`)}).catch(C=>console.error(C));else{let C=`${Ye.ServerURL}/config/`;fetch(C,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(S.json)})}t(1,i=S)}let p=!1,_="https://raw.githubusercontent.com/terraphim/terraphim-cloud-fastapi/main/data/ref_arch.json",m="http://localhost:8000/documents/",b="http://localhost:9883/",v;const $=async()=>{console.log("Updating atomic server configuration");const S=js.fromSecret(v);c.setServerUrl(b),console.log("Server set.Setting agent"),c.setAgent(S)},w=async()=>{h()},k=({data:{msg:S,data:C}})=>{console.log(S,C)};let y;const h=async()=>{const S=await Ps(()=>import("./fetcher.worker-7e58969a.js"),[]);y=new S.default,y.onmessage=k;const C={msg:"fetcher",data:{url:_,postUrl:m,isWiki:p}};y.postMessage(C)},T=is("http://localhost:9883/config/y3zx5wtm0bq"),j=Nl(T,as.properties.name);De(l,j,S=>t(12,n=S));const D=Nl(T,"http://localhost:9883/property/role");De(l,D,S=>t(0,o=S));function N(S){b=S,t(5,b)}function E(S){v=S,t(6,v)}function G(S){_=S,t(3,_)}function B(S){m=S,t(4,m)}function M(S){p=S,t(2,p)}return l.$$.update=()=>{l.$$.dirty&4096&&console.log("Print name",n),l.$$.dirty&1&&console.log("Print roles",o)},[o,i,p,_,m,b,v,d,$,w,j,D,n,N,E,G,B,M]}class yr extends gt{constructor(e){super(),vt(this,e,wr,kr,ft,{})}}function Ht(){return Ct(xe)||typeof window<"u"&&window.__TAURI__!==void 0}class $r{constructor(){yt(this,"baseUrl");yt(this,"autocompleteIndexBuilt",!1);yt(this,"sessionId");yt(this,"currentRole","Default");yt(this,"connectionRetries",0);yt(this,"maxRetries",3);yt(this,"retryDelay",1e3);yt(this,"isConnecting",!1);this.baseUrl=typeof window<"u"?(window.location.protocol==="https:"?"https://":"http://")+window.location.hostname+":8001":"http://localhost:8001",this.sessionId=`novel-${Date.now()}`,typeof window<"u"&&!Ht()&&this.shouldPerformHealthCheck()?this.detectServerPort():typeof window<"u"&&!Ht()&&console.log("NovelAutocompleteService: Skipping server detection - not needed for current page")}setRole(e){this.currentRole=e,this.autocompleteIndexBuilt=!1}async detectServerPort(){if(Ht())return;if(!this.shouldPerformHealthCheck()){console.log("NovelAutocompleteService: Skipping health check - service not needed");return}const t=[8001,3e3];for(const o of t)try{const n=typeof window<"u"?(window.location.protocol==="https:"?"https://":"http://")+window.location.hostname+":"+o:"http://localhost:"+o,c=await fetch(`${n}/message?sessionId=health-check`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:0,method:"ping",params:{}}),signal:AbortSignal.timeout(1e3)});if(c.ok||c.status===404){this.baseUrl=n,console.log(`NovelAutocompleteService: Detected server at ${n}`);return}}catch{continue}console.warn("NovelAutocompleteService: Could not detect running server, using default:",this.baseUrl)}shouldPerformHealthCheck(){return!(typeof window<"u"&&(!window.location.pathname.startsWith("/chat")||!(document.querySelector('[contenteditable="true"]')||document.querySelector("textarea")||document.querySelector('input[type="text"]'))))}async buildAutocompleteIndex(){if(this.isConnecting)return await new Promise(e=>setTimeout(e,1e3)),this.autocompleteIndexBuilt;this.isConnecting=!0;try{return Ht()?(console.log("Using Tauri backend - no index building required"),this.autocompleteIndexBuilt=!0,this.connectionRetries=0,console.log("Tauri autocomplete ready"),!0):await this.buildMCPIndex()}catch(e){return console.error("Error building Novel autocomplete index:",e),!1}finally{this.isConnecting=!1}}async buildMCPIndex(){for(let e=0;e<=this.maxRetries;e++)try{const t=await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:Date.now(),method:"tools/call",params:{name:"build_autocomplete_index",arguments:{}}}),signal:AbortSignal.timeout(1e4)});if(t.ok){const o=await t.json();if(console.log(`MCP build index response (attempt ${e+1}):`,o),o.result&&!o.result.is_error)return this.autocompleteIndexBuilt=!0,this.connectionRetries=0,console.log("MCP autocomplete index built successfully"),!0}else if(t.status>=500&&e<this.maxRetries){console.warn(`MCP server error ${t.status}, retrying in ${this.retryDelay}ms...`),await new Promise(o=>setTimeout(o,this.retryDelay*(e+1)));continue}console.warn(`MCP build index failed (attempt ${e+1}):`,t.status,t.statusText)}catch(t){t instanceof Error&&t.name==="AbortError"?console.warn(`MCP request timeout (attempt ${e+1})`):console.warn(`MCP connection error (attempt ${e+1}):`,t),e<this.maxRetries&&await new Promise(o=>setTimeout(o,this.retryDelay*(e+1)))}return console.error("Failed to build MCP autocomplete index after all retries"),!1}async getCompletion(e){if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return{text:""};try{const t=this.extractLastWord(e.prompt);if(!t||t.length<1)return{text:""};const o=await this.getSuggestionsWithSnippets(t,5);if(o.length===0)return{text:""};let c=o[0].text;c.toLowerCase().startsWith(t.toLowerCase())&&(c=c.substring(t.length));const r=e.prompt.length/4,u=c.length/4;return{text:c,usage:{promptTokens:Math.round(r),completionTokens:Math.round(u),totalTokens:Math.round(r+u)}}}catch(t){return console.error("Error getting Novel autocomplete completion:",t),{text:""}}}async getSuggestions(e,t=10){if(!e||e.trim().length===0)return[];if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return console.warn("Autocomplete index not built, returning empty suggestions"),[];try{return Ht()?await this.getTauriSuggestions(e,t):await this.getMCPSuggestions(e,t,"autocomplete_terms")}catch(o){return console.error("Error getting autocomplete suggestions:",o),[]}}async getTauriSuggestions(e,t){const o=await ze("get_autocomplete_suggestions",{query:e.trim(),role_name:this.currentRole,limit:t});return console.log("Tauri autocomplete response:",o),o&&o.status==="success"&&o.suggestions?o.suggestions.map(n=>({text:n.term||n.text||"",snippet:n.url||n.snippet||"",score:n.score||1})).filter(n=>n.text.length>0):(o&&o.error&&console.error("Tauri autocomplete error:",o.error),[])}async getMCPSuggestions(e,t,o){const n=Date.now(),c=await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:n,method:"tools/call",params:{name:o,arguments:{query:e.trim(),limit:t,role:this.currentRole}}}),signal:AbortSignal.timeout(5e3)});if(!c.ok)return console.error(`MCP ${o} request failed:`,c.status,c.statusText),[];const r=await c.json();return console.log(`MCP ${o} response:`,r),r.result&&!r.result.is_error&&r.result.content?o==="autocomplete_with_snippets"?this.parseAutocompleteWithSnippetsContent(r.result.content):this.parseAutocompleteContent(r.result.content):(r.error&&console.error(`MCP ${o} error:`,r.error),[])}async getSuggestionsWithSnippets(e,t=10){if(!e||e.trim().length===0)return[];if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return console.warn("Autocomplete index not built, returning empty suggestions with snippets"),[];try{return Ht()?await this.getTauriSuggestions(e,t):await this.getMCPSuggestions(e,t,"autocomplete_with_snippets")}catch(o){return console.error("Error getting autocomplete suggestions with snippets:",o),[]}}extractLastWord(e){const t=e.trim().split(/\s+/);return t[t.length-1]||""}parseAutocompleteContent(e){const t=[];for(const o of e)if(o.type==="text"&&o.text){if(!o.text.startsWith("Found")&&!o.text.startsWith("•"))t.push({text:o.text.trim()});else if(o.text.startsWith("•")){const n=o.text.replace("•","").trim();n&&t.push({text:n})}}return t}parseAutocompleteWithSnippetsContent(e){const t=[];for(const o of e)if(o.type==="text"&&o.text){if(!o.text.startsWith("Found")&&!o.text.startsWith("•")){const n=o.text.split(" — ");n.length===2?t.push({text:n[0].trim(),snippet:n[1].trim()}):t.push({text:o.text.trim()})}else if(o.text.startsWith("•")){const n=o.text.replace("•","").trim();n&&t.push({text:n})}}return t}isReady(){return this.autocompleteIndexBuilt}getStatus(){return{ready:this.autocompleteIndexBuilt,baseUrl:this.baseUrl,sessionId:this.sessionId,usingTauri:Ht(),currentRole:this.currentRole,connectionRetries:this.connectionRetries,isConnecting:this.isConnecting}}async refreshIndex(){return this.autocompleteIndexBuilt=!1,this.connectionRetries=0,await this.buildAutocompleteIndex()}async testConnection(){try{if(Ht()){const e=await ze("get_autocomplete_suggestions",{query:"test",role_name:this.currentRole,limit:1});return e&&(e.status==="success"||e.status==="error")}else return(await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:Date.now(),method:"tools/list",params:{}}),signal:AbortSignal.timeout(3e3)})).ok}catch(e){return console.warn("Connection test failed:",e),!1}}}const Ot=new $r;function Cr(l){var e;const{char:t,allowSpaces:o,allowToIncludeChar:n,allowedPrefixes:c,startOfLine:r,$position:u}=l,i=o&&!n,d=Is(t),p=new RegExp(`\\s${d}$`),_=r?"^":"",m=n?"":d,b=i?new RegExp(`${_}${d}.*?(?=\\s${m}|$)`,"gm"):new RegExp(`${_}(?:^)?${d}[^\\s${m}]*`,"gm"),v=((e=u.nodeBefore)===null||e===void 0?void 0:e.isText)&&u.nodeBefore.text;if(!v)return null;const $=u.pos-v.length,w=Array.from(v.matchAll(b)).pop();if(!w||w.input===void 0||w.index===void 0)return null;const k=w.input.slice(Math.max(0,w.index-1),w.index),y=new RegExp(`^[${c==null?void 0:c.join("")}\0]?$`).test(k);if(c!==null&&!y)return null;const h=$+w.index;let T=h+w[0].length;return i&&p.test(v.slice(T-1,T+1))&&(w[0]+=" ",T+=1),h<u.pos&&T>=u.pos?{range:{from:h,to:T},query:w[0].slice(t.length),text:w[0]}:null}const Tr=new rs("suggestion");function Sr({pluginKey:l=Tr,editor:e,char:t="@",allowSpaces:o=!1,allowToIncludeChar:n=!1,allowedPrefixes:c=[" "],startOfLine:r=!1,decorationTag:u="span",decorationClass:i="suggestion",decorationContent:d="",decorationEmptyClass:p="is-empty",command:_=()=>null,items:m=()=>[],render:b=()=>({}),allow:v=()=>!0,findSuggestionMatch:$=Cr}){let w;const k=b==null?void 0:b(),y=new Ns({key:l,view(){return{update:async(h,T)=>{var j,D,N,E,G,B,M;const S=(j=this.key)===null||j===void 0?void 0:j.getState(T),C=(D=this.key)===null||D===void 0?void 0:D.getState(h.state),O=S.active&&C.active&&S.range.from!==C.range.from,A=!S.active&&C.active,W=S.active&&!C.active,J=!A&&!W&&S.query!==C.query,I=A||O&&J,Q=J||O,P=W||O&&J;if(!I&&!Q&&!P)return;const U=P&&!I?S:C,F=h.dom.querySelector(`[data-decoration-id="${U.decorationId}"]`);w={editor:e,range:U.range,query:U.query,text:U.text,items:[],command:z=>_({editor:e,range:U.range,props:z}),decorationNode:F,clientRect:F?()=>{var z;const{decorationId:Z}=(z=this.key)===null||z===void 0?void 0:z.getState(e.state),le=h.dom.querySelector(`[data-decoration-id="${Z}"]`);return(le==null?void 0:le.getBoundingClientRect())||null}:null},I&&((N=k==null?void 0:k.onBeforeStart)===null||N===void 0||N.call(k,w)),Q&&((E=k==null?void 0:k.onBeforeUpdate)===null||E===void 0||E.call(k,w)),(Q||I)&&(w.items=await m({editor:e,query:U.query})),P&&((G=k==null?void 0:k.onExit)===null||G===void 0||G.call(k,w)),Q&&((B=k==null?void 0:k.onUpdate)===null||B===void 0||B.call(k,w)),I&&((M=k==null?void 0:k.onStart)===null||M===void 0||M.call(k,w))},destroy:()=>{var h;w&&((h=k==null?void 0:k.onExit)===null||h===void 0||h.call(k,w))}}},state:{init(){return{active:!1,range:{from:0,to:0},query:null,text:null,composing:!1}},apply(h,T,j,D){const{isEditable:N}=e,{composing:E}=e.view,{selection:G}=h,{empty:B,from:M}=G,S={...T};if(S.composing=E,N&&(B||e.view.composing)){(M<T.range.from||M>T.range.to)&&!E&&!T.composing&&(S.active=!1);const C=$({char:t,allowSpaces:o,allowToIncludeChar:n,allowedPrefixes:c,startOfLine:r,$position:G.$from}),O=`id_${Math.floor(Math.random()*4294967295)}`;C&&v({editor:e,state:D,range:C.range,isActive:T.active})?(S.active=!0,S.decorationId=T.decorationId?T.decorationId:O,S.range=C.range,S.query=C.query,S.text=C.text):S.active=!1}else S.active=!1;return S.active||(S.decorationId=null,S.range={from:0,to:0},S.query=null,S.text=null),S}},props:{handleKeyDown(h,T){var j;const{active:D,range:N}=y.getState(h.state);return D&&((j=k==null?void 0:k.onKeyDown)===null||j===void 0?void 0:j.call(k,{view:h,event:T,range:N}))||!1},decorations(h){const{active:T,range:j,decorationId:D,query:N}=y.getState(h);if(!T)return null;const E=!(N!=null&&N.length),G=[i];return E&&G.push(p),Os.create(h.doc,[Ds.inline(j.from,j.to,{nodeName:u,class:G.join(" "),"data-decoration-id":D,"data-decoration-content":d})])}}});return y}const ko=Us.create({name:"terraphimSuggestion",addOptions(){return{trigger:"++",pluginKey:new rs("terraphimSuggestion"),allowSpaces:!1,limit:8,minLength:1,debounce:300}},addCommands(){return{insertSuggestion:l=>({commands:e,chain:t})=>t().insertContent(l.text).run()}},addProseMirrorPlugins(){const l={editor:this.editor,char:this.options.trigger,pluginKey:this.options.pluginKey,allowSpaces:this.options.allowSpaces,startOfLine:!1,command:({editor:e,range:t,props:o})=>{const n=o;e.chain().focus().insertContentAt(t,n.text+" ").run()},items:async({query:e,editor:t})=>new Promise(o=>{setTimeout(async()=>{if(e.length<this.options.minLength){o([]);return}try{const n=await Ot.getSuggestionsWithSnippets(e,this.options.limit);console.log(`TerraphimSuggestion: Found ${n.length} suggestions for "${e}"`),o(n)}catch(n){console.error("TerraphimSuggestion: Error getting suggestions:",n),o([])}},this.options.debounce)}),render:()=>{let e,t;return{onStart:o=>{e=new Rr({items:o.items,command:o.command}),o.clientRect&&(t=zs("body",{getReferenceClientRect:o.clientRect,appendTo:()=>document.body,content:e.element,showOnCreate:!0,interactive:!0,trigger:"manual",placement:"bottom-start",theme:"terraphim-suggestion",maxWidth:"none"})[0])},onUpdate(o){e==null||e.updateItems(o.items),o.clientRect&&(t==null||t.setProps({getReferenceClientRect:o.clientRect}))},onKeyDown(o){return o.event.key==="Escape"?(t==null||t.hide(),!0):(e==null?void 0:e.onKeyDown(o))??!1},onExit(){t==null||t.destroy(),e==null||e.destroy()}}}};return[Sr(l)]}});class Rr{constructor(e){yt(this,"element");yt(this,"items",[]);yt(this,"selectedIndex",0);yt(this,"command");this.items=e.items,this.command=e.command,this.element=document.createElement("div"),this.element.className="terraphim-suggestion-dropdown",this.render()}updateItems(e){this.items=e,this.selectedIndex=0,this.render()}onKeyDown({event:e}){return e.key==="ArrowUp"?(this.selectPrevious(),!0):e.key==="ArrowDown"?(this.selectNext(),!0):e.key==="Enter"||e.key==="Tab"?(this.selectItem(this.selectedIndex),!0):!1}selectPrevious(){this.selectedIndex=Math.max(0,this.selectedIndex-1),this.render()}selectNext(){this.selectedIndex=Math.min(this.items.length-1,this.selectedIndex+1),this.render()}selectItem(e){const t=this.items[e];t&&this.command({id:t.text,...t})}render(){if(this.element.innerHTML="",this.items.length===0){this.element.innerHTML=`
        <div class="terraphim-suggestion-item terraphim-suggestion-empty">
          <div class="terraphim-suggestion-text">No suggestions found</div>
          <div class="terraphim-suggestion-hint">Try a different search term</div>
        </div>
      `;return}const e=document.createElement("div");e.className="terraphim-suggestion-header",e.innerHTML=`
      <div class="terraphim-suggestion-count">${this.items.length} suggestions</div>
      <div class="terraphim-suggestion-hint">↑↓ Navigate • Tab/Enter Select • Esc Cancel</div>
    `,this.element.appendChild(e),this.items.forEach((t,o)=>{const n=document.createElement("div");n.className=`terraphim-suggestion-item ${o===this.selectedIndex?"terraphim-suggestion-selected":""}`,n.innerHTML=`
        <div class="terraphim-suggestion-main">
          <div class="terraphim-suggestion-text">${this.escapeHtml(t.text)}</div>
          ${t.snippet?`<div class="terraphim-suggestion-snippet">${this.escapeHtml(t.snippet)}</div>`:""}
        </div>
        ${t.score?`<div class="terraphim-suggestion-score">${Math.round(t.score*100)}%</div>`:""}
      `,n.addEventListener("click",()=>this.selectItem(o)),n.addEventListener("mouseenter",()=>{this.selectedIndex=o,this.render()}),this.element.appendChild(n)})}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}destroy(){this.element.remove()}}const Lr=`
.terraphim-suggestion-dropdown {
  background: white;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  box-shadow: 0 10px 38px -10px rgba(22, 23, 24, 0.35), 0 10px 20px -15px rgba(22, 23, 24, 0.2);
  max-height: 300px;
  min-width: 300px;
  overflow-y: auto;
  z-index: 1000;
}

.terraphim-suggestion-header {
  padding: 8px 12px;
  border-bottom: 1px solid #f1f5f9;
  background: #f8fafc;
  font-size: 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.terraphim-suggestion-count {
  font-weight: 600;
  color: #475569;
}

.terraphim-suggestion-hint {
  color: #64748b;
}

.terraphim-suggestion-item {
  padding: 8px 12px;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  border-bottom: 1px solid #f1f5f9;
}

.terraphim-suggestion-item:hover {
  background: #f8fafc;
}

.terraphim-suggestion-selected {
  background: #eff6ff !important;
  border-left: 3px solid #3b82f6;
}

.terraphim-suggestion-empty {
  color: #64748b;
  font-style: italic;
  text-align: center;
  cursor: default;
}

.terraphim-suggestion-main {
  flex: 1;
}

.terraphim-suggestion-text {
  font-weight: 500;
  color: #1e293b;
  margin-bottom: 2px;
}

.terraphim-suggestion-snippet {
  font-size: 12px;
  color: #64748b;
  line-height: 1.3;
}

.terraphim-suggestion-score {
  font-size: 11px;
  color: #10b981;
  font-weight: 600;
  background: #ecfdf5;
  padding: 2px 6px;
  border-radius: 4px;
  margin-left: 8px;
}

/* Dark theme support */
@media (prefers-color-scheme: dark) {
  .terraphim-suggestion-dropdown {
    background: #1e293b;
    border-color: #334155;
  }

  .terraphim-suggestion-header {
    background: #0f172a;
    border-color: #334155;
  }

  .terraphim-suggestion-item:hover {
    background: #334155;
  }

  .terraphim-suggestion-selected {
    background: #1e40af !important;
  }

  .terraphim-suggestion-text {
    color: #f1f5f9;
  }

  .terraphim-suggestion-snippet {
    color: #94a3b8;
  }
}

/* Tippy.js theme */
.tippy-box[data-theme~='terraphim-suggestion'] {
  background: transparent;
  box-shadow: none;
}

.tippy-box[data-theme~='terraphim-suggestion'] > .tippy-backdrop {
  background: transparent;
}

.tippy-box[data-theme~='terraphim-suggestion'] > .tippy-arrow {
  display: none;
}
`;function wo(l){let e,t,o,n,c,r,u,i,d,p,_,m,b,v,$,w,k,y,h,T,j,D,N,E,G,B,M=l[12]?"Tauri (native)":`MCP Server (${Ot.getStatus().baseUrl})`,S,C,O,A,W,J,I,Q,P,U,F,z,Z,le,ie,ae,V,se,ue,re,x=l[6]!==1?"s":"",he,me,te,de,pe,fe,Te,Ie,qe,Re,Le,oe,Ce,Ue,Me,ot,Ae,Ke,ge=l[3]?"Enabled":"Disabled",je,Pe,tt,dt,He=l[11]&&!l[8]&&yo(l);function At(K,ce){if(K[8])return Nr;if(K[11])return Pr}let q=At(l),ne=q&&q(l);return{c(){e=f("div"),t=f("div"),o=f("strong"),o.textContent="Local Autocomplete Status:",n=g(),c=f("div"),r=f("button"),u=H("Test"),d=g(),p=f("button"),p.textContent="Rebuild Index",_=g(),m=f("button"),b=H("Demo"),$=g(),w=f("div"),k=H(l[10]),y=g(),He&&He.c(),h=g(),T=f("div"),j=f("strong"),j.textContent="Configuration:",D=g(),N=f("br"),E=H("• "),G=f("strong"),G.textContent="Backend:",B=g(),S=H(M),C=g(),O=f("br"),A=H("• "),W=f("strong"),W.textContent="Role:",J=g(),I=H(l[9]),Q=g(),P=f("br"),U=H("• "),F=f("strong"),F.textContent="Trigger:",z=H(' "'),Z=H(l[4]),le=H(`" + text
      `),ie=f("br"),ae=H("• "),V=f("strong"),V.textContent="Min Length:",se=g(),ue=H(l[6]),re=H(" character"),he=H(x),me=g(),te=f("br"),de=H("• "),pe=f("strong"),pe.textContent="Max Results:",fe=g(),Te=H(l[5]),Ie=g(),qe=f("br"),Re=H("• "),Le=f("strong"),Le.textContent="Debounce:",oe=g(),Ce=H(l[7]),Ue=H(`ms
      `),Me=f("br"),ot=H("• "),Ae=f("strong"),Ae.textContent="Snippets:",Ke=g(),je=H(ge),Pe=g(),ne&&ne.c(),_e(o,"color","#495057"),_e(r,"padding","4px 8px"),_e(r,"background","#007bff"),_e(r,"color","white"),_e(r,"border","none"),_e(r,"border-radius","4px"),_e(r,"cursor","pointer"),_e(r,"font-size","12px"),r.disabled=i=!l[8],_e(p,"padding","4px 8px"),_e(p,"background","#28a745"),_e(p,"color","white"),_e(p,"border","none"),_e(p,"border-radius","4px"),_e(p,"cursor","pointer"),_e(p,"font-size","12px"),_e(m,"padding","4px 8px"),_e(m,"background","#ffc107"),_e(m,"color","#212529"),_e(m,"border","none"),_e(m,"border-radius","4px"),_e(m,"cursor","pointer"),_e(m,"font-size","12px"),m.disabled=v=!l[8],_e(c,"display","flex"),_e(c,"gap","8px"),_e(t,"display","flex"),_e(t,"justify-content","space-between"),_e(t,"align-items","center"),_e(t,"margin-bottom","8px"),_e(w,"font-size","13px"),_e(w,"color","#6c757d"),_e(w,"margin-bottom","8px"),_e(w,"font-family","monospace"),_e(T,"font-size","12px"),_e(T,"color","#6c757d"),_e(e,"margin-top","10px"),_e(e,"padding","12px"),_e(e,"background","#f8f9fa"),_e(e,"border-radius","6px"),_e(e,"border","1px solid #e9ecef")},m(K,ce){L(K,e,ce),s(e,t),s(t,o),s(t,n),s(t,c),s(c,r),s(r,u),s(c,d),s(c,p),s(c,_),s(c,m),s(m,b),s(e,$),s(e,w),s(w,k),s(e,y),He&&He.m(e,null),s(e,h),s(e,T),s(T,j),s(T,D),s(T,N),s(T,E),s(T,G),s(T,B),s(T,S),s(T,C),s(T,O),s(T,A),s(T,W),s(T,J),s(T,I),s(T,Q),s(T,P),s(T,U),s(T,F),s(T,z),s(T,Z),s(T,le),s(T,ie),s(T,ae),s(T,V),s(T,se),s(T,ue),s(T,re),s(T,he),s(T,me),s(T,te),s(T,de),s(T,pe),s(T,fe),s(T,Te),s(T,Ie),s(T,qe),s(T,Re),s(T,Le),s(T,oe),s(T,Ce),s(T,Ue),s(T,Me),s(T,ot),s(T,Ae),s(T,Ke),s(T,je),s(e,Pe),ne&&ne.m(e,null),tt||(dt=[ee(r,"click",l[14]),ee(p,"click",l[15]),ee(m,"click",l[16])],tt=!0)},p(K,ce){ce&256&&i!==(i=!K[8])&&(r.disabled=i),ce&256&&v!==(v=!K[8])&&(m.disabled=v),ce&1024&&we(k,K[10]),K[11]&&!K[8]?He?He.p(K,ce):(He=yo(K),He.c(),He.m(e,h)):He&&(He.d(1),He=null),ce&4096&&M!==(M=K[12]?"Tauri (native)":`MCP Server (${Ot.getStatus().baseUrl})`)&&we(S,M),ce&512&&we(I,K[9]),ce&16&&we(Z,K[4]),ce&64&&we(ue,K[6]),ce&64&&x!==(x=K[6]!==1?"s":"")&&we(he,x),ce&32&&we(Te,K[5]),ce&128&&we(Ce,K[7]),ce&8&&ge!==(ge=K[3]?"Enabled":"Disabled")&&we(je,ge),q===(q=At(K))&&ne?ne.p(K,ce):(ne&&ne.d(1),ne=q&&q(K),ne&&(ne.c(),ne.m(e,null)))},d(K){K&&R(e),He&&He.d(),ne&&ne.d(),tt=!1,Ze(dt)}}}function yo(l){let e,t,o,n;function c(i,d){return i[12]?Er:Ar}let r=c(l),u=r(l);return{c(){e=f("div"),t=f("strong"),t.textContent="⚠️ Autocomplete Not Available",o=f("br"),n=g(),u.c(),_e(e,"font-size","12px"),_e(e,"color","#dc3545"),_e(e,"margin-bottom","8px"),_e(e,"padding","6px"),_e(e,"background","#f8d7da"),_e(e,"border-radius","4px")},m(i,d){L(i,e,d),s(e,t),s(e,o),s(e,n),u.m(e,null)},p(i,d){r===(r=c(i))&&u?u.p(i,d):(u.d(1),u=r(i),u&&(u.c(),u.m(e,null)))},d(i){i&&R(e),u.d()}}}function Ar(l){let e,t=Ot.getStatus().baseUrl+"",o;return{c(){e=H("MCP server not responding. Ensure the server is running on "),o=H(t)},m(n,c){L(n,e,c),L(n,o,c)},p:Ee,d(n){n&&R(e),n&&R(o)}}}function Er(l){let e;return{c(){e=H("Tauri backend connection failed. Ensure the application has proper permissions.")},m(t,o){L(t,e,o)},p:Ee,d(t){t&&R(e)}}}function Pr(l){let e;return{c(){e=f("div"),e.innerHTML=`<strong>❌ Autocomplete Unavailable</strong> 
        <div style="font-size: 11px; margin-top: 4px; color: #721c24;">Click &quot;Rebuild Index&quot; to retry or check server/backend status.</div>`,_e(e,"margin-top","8px"),_e(e,"padding","8px"),_e(e,"background","#f8d7da"),_e(e,"border","1px solid #f5c6cb"),_e(e,"border-radius","4px")},m(t,o){L(t,e,o)},p:Ee,d(t){t&&R(e)}}}function Nr(l){let e,t,o,n,c,r,u,i,d,p,_,m,b,v,$,w,k;return{c(){e=f("div"),t=f("strong"),t.textContent="🎯 Autocomplete Active",o=g(),n=f("div"),c=H("Type "),r=f("code"),u=H(l[4]),i=H(" in the editor above to trigger suggestions."),d=f("br"),p=H(`
          Example: `),_=f("code"),m=H(l[4]),b=H("terraphim"),v=H(" or "),$=f("code"),w=H(l[4]),k=H("graph"),_e(n,"font-size","11px"),_e(n,"margin-top","4px"),_e(n,"color","#0056b3"),_e(e,"margin-top","8px"),_e(e,"padding","8px"),_e(e,"background","#d1edff"),_e(e,"border","1px solid #b3d9ff"),_e(e,"border-radius","4px")},m(y,h){L(y,e,h),s(e,t),s(e,o),s(e,n),s(n,c),s(n,r),s(r,u),s(n,i),s(n,d),s(n,p),s(n,_),s(_,m),s(_,b),s(n,v),s(n,$),s($,w),s($,k)},p(y,h){h&16&&we(u,y[4]),h&16&&we(m,y[4]),h&16&&we(w,y[4])},d(y){y&&R(e)}}}function Or(l){let e,t,o,n;e=new qs({props:{defaultValue:l[0],isEditable:!l[1],disableLocalStorage:!0,onUpdate:l[13],extensions:[mo,...l[2]?[ko.configure({trigger:l[4],allowSpaces:!1,limit:l[5],minLength:l[6],debounce:l[7]})]:[]]}});let c=l[2]&&wo(l);return{c(){ve(e.$$.fragment),t=g(),c&&c.c(),o=it()},m(r,u){be(e,r,u),L(r,t,u),c&&c.m(r,u),L(r,o,u),n=!0},p(r,[u]){const i={};u&1&&(i.defaultValue=r[0]),u&2&&(i.isEditable=!r[1]),u&244&&(i.extensions=[mo,...r[2]?[ko.configure({trigger:r[4],allowSpaces:!1,limit:r[5],minLength:r[6],debounce:r[7]})]:[]]),e.$set(i),r[2]?c?c.p(r,u):(c=wo(r),c.c(),c.m(o.parentNode,o)):c&&(c.d(1),c=null)},i(r){n||(Y(e.$$.fragment,r),n=!0)},o(r){X(e.$$.fragment,r),n=!1},d(r){ke(e,r),r&&R(t),c&&c.d(r),r&&R(o)}}}function Dr(l,e,t){let o,n;De(l,Rt,E=>t(9,o=E)),De(l,xe,E=>t(12,n=E));let{html:c=""}=e,{readOnly:r=!1}=e,{outputFormat:u="html"}=e,{enableAutocomplete:i=!0}=e,{showSnippets:d=!0}=e,{suggestionTrigger:p="++"}=e,{maxSuggestions:_=8}=e,{minQueryLength:m=1}=e,{debounceDelay:b=300}=e,v=null,$="⏳ Initializing...",w=!1,k=!1,y=null;Jt(async()=>{i&&await h(),typeof document<"u"&&(y=document.createElement("style"),y.textContent=Lr,document.head.appendChild(y))}),Cs(()=>{y&&y.parentNode&&y.parentNode.removeChild(y)});async function h(){t(10,$="⏳ Initializing autocomplete..."),t(8,w=!1),t(11,k=!1);try{Ot.setRole(o),t(10,$="🔗 Testing connection...");const E=await Ot.testConnection();t(11,k=!0),E?(t(10,$="🔨 Building autocomplete index..."),await Ot.buildAutocompleteIndex()?(n?t(10,$="✅ Ready - Using Tauri backend"):t(10,$="✅ Ready - Using MCP server backend"),t(8,w=!0)):t(10,$="❌ Failed to build autocomplete index")):n?t(10,$="❌ Tauri backend not available"):t(10,$="❌ MCP server not responding")}catch(E){console.error("Error initializing autocomplete:",E),t(10,$="❌ Autocomplete initialization error")}}const T=E=>{v=E,u==="markdown"?t(0,c=E.storage.markdown.getMarkdown()):t(0,c=E.getHTML())},j=async()=>{if(!k){alert("Please wait for connection test to complete");return}if(!w){alert("Autocomplete service not ready. Check the status above.");return}try{t(10,$="🧪 Testing autocomplete...");const E="terraphim",G=await Ot.getSuggestions(E,5);if(console.log("Autocomplete test results:",G),G.length>0){const B=G.map((M,S)=>`${S+1}. ${M.text}${M.snippet?` (${M.snippet})`:""}`).join(`
`);alert(`✅ Found ${G.length} suggestions for '${E}':

${B}`),n?t(10,$="✅ Ready - Using Tauri backend"):t(10,$="✅ Ready - Using MCP server backend")}else alert(`⚠️ No suggestions found for '${E}'. This might be normal if the term isn't in your knowledge graph.`)}catch(E){console.error("Autocomplete test failed:",E),alert(`❌ Autocomplete test failed: ${E.message}`),t(10,$="❌ Test failed - check console for details")}},D=async()=>{t(10,$="⏳ Rebuilding index..."),t(8,w=!1);try{await Ot.refreshIndex()?(n?t(10,$="✅ Ready - Tauri index rebuilt successfully"):t(10,$="✅ Ready - MCP server index rebuilt successfully"),t(8,w=!0)):t(10,$="❌ Failed to rebuild index")}catch(E){console.error("Error rebuilding index:",E),t(10,$="❌ Index rebuild failed - check console for details")}},N=()=>{if(!v){alert("Editor not ready yet");return}const E=`# Terraphim Autocomplete Demo

This is a demonstration of the integrated Terraphim autocomplete system.

## How to Use:
1. Type "${p}" to trigger autocomplete
2. Start typing any term (e.g., "${p}terraphim", "${p}graph")
3. Use ↑↓ arrows to navigate suggestions
4. Press Tab or Enter to select
5. Press Esc to cancel

## Try these queries:
- ${p}terraphim
- ${p}graph
- ${p}service
- ${p}automata
- ${p}role

The autocomplete system uses your local knowledge graph to provide intelligent suggestions based on your selected role: **${o}**.

---

Start typing below:`;v.commands.setContent(E),setTimeout(()=>{v.commands.focus("end")},100),alert(`Demo content inserted!

Type "${p}" followed by any term to see autocomplete suggestions.

Example: "${p}terraphim"`)};return l.$$set=E=>{"html"in E&&t(0,c=E.html),"readOnly"in E&&t(1,r=E.readOnly),"outputFormat"in E&&t(17,u=E.outputFormat),"enableAutocomplete"in E&&t(2,i=E.enableAutocomplete),"showSnippets"in E&&t(3,d=E.showSnippets),"suggestionTrigger"in E&&t(4,p=E.suggestionTrigger),"maxSuggestions"in E&&t(5,_=E.maxSuggestions),"minQueryLength"in E&&t(6,m=E.minQueryLength),"debounceDelay"in E&&t(7,b=E.debounceDelay)},l.$$.update=()=>{l.$$.dirty&772&&o&&i&&w&&(Ot.setRole(o),h())},[c,r,i,d,p,_,m,b,w,o,$,k,n,T,j,D,N,u]}class Ir extends gt{constructor(e){super(),vt(this,e,Dr,Or,ft,{html:0,readOnly:1,outputFormat:17,enableAutocomplete:2,showSnippets:3,suggestionTrigger:4,maxSuggestions:5,minQueryLength:6,debounceDelay:7})}}function $o(l){let e,t,o,n,c,r,u,i,d,p,_;return{c(){e=f("div"),t=f("h3"),o=f("span"),o.textContent="Knowledge Graph",n=H(`
          Term: `),c=f("strong"),r=H(l[2]),u=H(" | Rank: "),i=f("strong"),d=H(l[3]),p=g(),_=f("hr"),a(o,"class","tag is-info svelte-329px1"),a(t,"class","subtitle is-6 svelte-329px1"),a(_,"class","svelte-329px1"),a(e,"class","kg-context svelte-329px1")},m(m,b){L(m,e,b),s(e,t),s(t,o),s(t,n),s(t,c),s(c,r),s(t,u),s(t,i),s(i,d),s(e,p),s(e,_)},p(m,b){b&4&&we(r,m[2]),b&8&&we(d,m[3])},d(m){m&&R(e)}}}function Ur(l){let e,t,o,n,c,r,u,i;const d=[Hr,jr],p=[];function _(m,b){return m[5]?0:1}return t=_(l),o=p[t]=d[t](l),{c(){e=f("div"),o.c(),n=g(),c=f("div"),c.innerHTML='<span class="hint-text svelte-329px1">Double-click to edit • Ctrl+E to edit • Ctrl+S to save • Click KG links to explore</span>',a(c,"class","edit-hint svelte-329px1"),a(e,"class","content-viewer svelte-329px1"),a(e,"tabindex","0"),a(e,"role","button"),a(e,"aria-label","Double-click to edit article content")},m(m,b){L(m,e,b),p[t].m(e,null),s(e,n),s(e,c),l[20](e),r=!0,u||(i=[ee(e,"dblclick",l[14]),ee(e,"keydown",l[15]),ee(e,"click",l[13])],u=!0)},p(m,b){let v=t;t=_(m),t===v?p[t].p(m,b):(Ve(),X(p[v],1,1,()=>{p[v]=null}),Qe(),o=p[t],o?o.p(m,b):(o=p[t]=d[t](m),o.c()),Y(o,1),o.m(e,n))},i(m){r||(Y(o),r=!0)},o(m){X(o),r=!1},d(m){m&&R(e),p[t].d(),l[20](null),u=!1,Ze(i)}}}function Mr(l){let e,t,o,n,c,r,u,i,d,p;function _(b){l[18](b)}let m={outputFormat:l[11]};return l[1].body!==void 0&&(m.html=l[1].body),e=new Ir({props:m}),lt.push(()=>st(e,"html",_)),{c(){ve(e.$$.fragment),o=g(),n=f("div"),c=f("button"),c.textContent="Save",r=g(),u=f("button"),u.textContent="Cancel",a(c,"class","button is-primary"),a(u,"class","button is-light"),a(n,"class","edit-controls svelte-329px1")},m(b,v){be(e,b,v),L(b,o,v),L(b,n,v),s(n,c),s(n,r),s(n,u),i=!0,d||(p=[ee(c,"click",l[12]),ee(u,"click",l[19])],d=!0)},p(b,v){const $={};v&2048&&($.outputFormat=b[11]),!t&&v&2&&(t=!0,$.html=b[1].body,rt(()=>t=!1)),e.$set($)},i(b){i||(Y(e.$$.fragment,b),i=!0)},o(b){X(e.$$.fragment,b),i=!1},d(b){ke(e,b),b&&R(o),b&&R(n),d=!1,Ze(p)}}}function jr(l){let e,t,o;return t=new Ol({props:{source:l[1].body}}),{c(){e=f("div"),ve(t.$$.fragment),a(e,"class","markdown-content svelte-329px1")},m(n,c){L(n,e,c),be(t,e,null),o=!0},p(n,c){const r={};c&2&&(r.source=n[1].body),t.$set(r)},i(n){o||(Y(t.$$.fragment,n),o=!0)},o(n){X(t.$$.fragment,n),o=!1},d(n){n&&R(e),ke(t)}}}function Hr(l){let e,t=l[1].body+"";return{c(){e=f("div"),a(e,"class","prose svelte-329px1")},m(o,n){L(o,e,n),e.innerHTML=t},p(o,n){n&2&&t!==(t=o[1].body+"")&&(e.innerHTML=t)},i:Ee,o:Ee,d(o){o&&R(e)}}}function Fr(l){let e,t,o,n,c,r=l[1].title+"",u,i,d,p,_,m,b,v=l[2]&&l[3]!==null&&$o(l);const $=[Mr,Ur],w=[];function k(y,h){return y[4]?0:1}return d=k(l),p=w[d]=$[d](l),{c(){e=f("div"),t=f("button"),o=g(),v&&v.c(),n=g(),c=f("h2"),u=H(r),i=g(),p.c(),a(t,"class","delete is-large modal-close-btn svelte-329px1"),a(t,"aria-label","close"),a(c,"class","svelte-329px1"),a(e,"class","box wrapper svelte-329px1")},m(y,h){L(y,e,h),s(e,t),s(e,o),v&&v.m(e,null),s(e,n),s(e,c),s(c,u),s(e,i),w[d].m(e,null),_=!0,m||(b=ee(t,"click",l[17]),m=!0)},p(y,h){y[2]&&y[3]!==null?v?v.p(y,h):(v=$o(y),v.c(),v.m(e,n)):v&&(v.d(1),v=null),(!_||h&2)&&r!==(r=y[1].title+"")&&we(u,r);let T=d;d=k(y),d===T?w[d].p(y,h):(Ve(),X(w[T],1,1,()=>{w[T]=null}),Qe(),p=w[d],p?p.p(y,h):(p=w[d]=$[d](y),p.c()),Y(p,1),p.m(e,null))},i(y){_||(Y(p),_=!0)},o(y){X(p),_=!1},d(y){y&&R(e),v&&v.d(),w[d].d(),m=!1,b()}}}function Co(l){let e,t,o;function n(r){l[23](r)}let c={$$slots:{default:[Wr]},$$scope:{ctx:l}};return l[7]!==void 0&&(c.active=l[7]),e=new Fl({props:c}),lt.push(()=>st(e,"active",n)),{c(){ve(e.$$.fragment)},m(r,u){be(e,r,u),o=!0},p(r,u){const i={};u&536872832&&(i.$$scope={dirty:u,ctx:r}),!t&&u&128&&(t=!0,i.active=r[7],rt(()=>t=!1)),e.$set(i)},i(r){o||(Y(e.$$.fragment,r),o=!0)},o(r){X(e.$$.fragment,r),o=!1},d(r){ke(e,r)}}}function To(l){let e,t,o,n,c,r,u,i,d,p,_;return{c(){e=f("div"),t=f("h3"),o=f("span"),o.textContent="Knowledge Graph",n=H(`
            Term: `),c=f("strong"),r=H(l[9]),u=H(" | Rank: "),i=f("strong"),d=H(l[10]),p=g(),_=f("hr"),a(o,"class","tag is-info svelte-329px1"),a(t,"class","subtitle is-6 svelte-329px1"),a(_,"class","svelte-329px1"),a(e,"class","kg-context svelte-329px1")},m(m,b){L(m,e,b),s(e,t),s(t,o),s(t,n),s(t,c),s(c,r),s(t,u),s(t,i),s(i,d),s(e,p),s(e,_)},p(m,b){b&512&&we(r,m[9]),b&1024&&we(d,m[10])},d(m){m&&R(e)}}}function zr(l){let e,t,o;return t=new Ol({props:{source:l[8].body}}),{c(){e=f("div"),ve(t.$$.fragment),a(e,"class","markdown-content svelte-329px1")},m(n,c){L(n,e,c),be(t,e,null),o=!0},p(n,c){const r={};c&256&&(r.source=n[8].body),t.$set(r)},i(n){o||(Y(t.$$.fragment,n),o=!0)},o(n){X(t.$$.fragment,n),o=!1},d(n){n&&R(e),ke(t)}}}function qr(l){let e,t=l[8].body+"";return{c(){e=f("div"),a(e,"class","prose svelte-329px1")},m(o,n){L(o,e,n),e.innerHTML=t},p(o,n){n&256&&t!==(t=o[8].body+"")&&(e.innerHTML=t)},i:Ee,o:Ee,d(o){o&&R(e)}}}function Wr(l){let e,t,o,n,c,r=l[8].title+"",u,i,d,p,_,m,b,v,$,w,k,y=l[9]&&l[10]!==null&&To(l);const h=[qr,zr],T=[];function j(D,N){return N&256&&(p=null),p==null&&(p=!!(D[8].body&&(/<html/i.test(D[8].body)||/<body/i.test(D[8].body)||/<head/i.test(D[8].body)))),p?0:1}return _=j(l,-1),m=T[_]=h[_](l),{c(){e=f("div"),t=f("button"),o=g(),y&&y.c(),n=g(),c=f("h2"),u=H(r),i=g(),d=f("div"),m.c(),b=g(),v=f("div"),v.innerHTML='<span class="hint-text svelte-329px1">Knowledge Graph document • Click KG links to explore further</span>',a(t,"class","delete is-large modal-close-btn svelte-329px1"),a(t,"aria-label","close"),a(c,"class","svelte-329px1"),a(v,"class","edit-hint svelte-329px1"),a(d,"class","content-viewer svelte-329px1"),a(d,"tabindex","0"),a(d,"role","button"),a(d,"aria-label","KG document content - click KG links to explore further"),a(e,"class","box wrapper svelte-329px1")},m(D,N){L(D,e,N),s(e,t),s(e,o),y&&y.m(e,null),s(e,n),s(e,c),s(c,u),s(e,i),s(e,d),T[_].m(d,null),s(d,b),s(d,v),$=!0,w||(k=[ee(t,"click",l[22]),ee(d,"click",l[13])],w=!0)},p(D,N){D[9]&&D[10]!==null?y?y.p(D,N):(y=To(D),y.c(),y.m(e,n)):y&&(y.d(1),y=null),(!$||N&256)&&r!==(r=D[8].title+"")&&we(u,r);let E=_;_=j(D,N),_===E?T[_].p(D,N):(Ve(),X(T[E],1,1,()=>{T[E]=null}),Qe(),m=T[_],m?m.p(D,N):(m=T[_]=h[_](D),m.c()),Y(m,1),m.m(d,b))},i(D){$||(Y(m),$=!0)},o(D){X(m),$=!1},d(D){D&&R(e),y&&y.d(),T[_].d(),w=!1,Ze(k)}}}function Kr(l){let e,t,o,n,c;function r(d){l[21](d)}let u={$$slots:{default:[Fr]},$$scope:{ctx:l}};l[0]!==void 0&&(u.active=l[0]),e=new Fl({props:u}),lt.push(()=>st(e,"active",r));let i=l[8]&&Co(l);return{c(){ve(e.$$.fragment),o=g(),i&&i.c(),n=it()},m(d,p){be(e,d,p),L(d,o,p),i&&i.m(d,p),L(d,n,p),c=!0},p(d,[p]){const _={};p&536873087&&(_.$$scope={dirty:p,ctx:d}),!t&&p&1&&(t=!0,_.active=d[0],rt(()=>t=!1)),e.$set(_),d[8]?i?(i.p(d,p),p&256&&Y(i,1)):(i=Co(d),i.c(),Y(i,1),i.m(n.parentNode,n)):i&&(Ve(),X(i,1,1,()=>{i=null}),Qe())},i(d){c||(Y(e.$$.fragment,d),Y(i),c=!0)},o(d){X(e.$$.fragment,d),X(i),c=!1},d(d){ke(e,d),d&&R(o),i&&i.d(d),d&&R(n)}}}function Gr(l,e,t){let o,n,c,r;De(l,xe,A=>t(25,c=A)),De(l,Rt,A=>t(26,r=A));let{active:u=!1}=e,{item:i}=e,{initialEdit:d=!1}=e,{kgTerm:p=null}=e,{kgRank:_=null}=e,m=!1,b,v=!1,$=null,w=null,k=null;async function y(){if(c)try{const A=await ze("get_document",{documentId:i.id});A!=null&&A.document&&t(1,i=A.document)}catch(A){console.error("Failed to load document",A)}}async function h(){if(!c){t(4,m=!1);return}try{await ze("create_document",{document:i}),t(4,m=!1)}catch(A){console.error("Failed to save document",A)}}async function T(A){var W,J,I,Q,P;t(9,w=A),console.log("🔍 KG Link Click Debug Info:"),console.log("  Term clicked:",A),console.log("  Current role:",r),console.log("  Is Tauri mode:",c);try{if(c){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:r,term:A});const U=await ze("find_documents_for_kg_term",{roleName:r,term:A});console.log("  📥 Tauri response received:"),console.log("    Status:",U.status),console.log("    Results count:",((W=U.results)==null?void 0:W.length)||0),console.log("    Total:",U.total||0),console.log("    Full response:",JSON.stringify(U,null,2)),U.status==="success"&&U.results&&U.results.length>0?(t(8,$=U.results[0]),t(10,k=$.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",$.title),console.log("    Rank:",k),console.log("    Body length:",((J=$.body)==null?void 0:J.length)||0,"characters"),t(7,v=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${A}" in role: "${r}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const U=Ye.ServerURL,F=encodeURIComponent(r),z=encodeURIComponent(A),Z=`${U}/roles/${F}/kg_search?term=${z}`;console.log("  📤 HTTP Request details:"),console.log("    Base URL:",U),console.log("    Role (encoded):",F),console.log("    Term (encoded):",z),console.log("    Full URL:",Z);const le=await fetch(Z);if(console.log("  📥 HTTP Response received:"),console.log("    Status code:",le.status),console.log("    Status text:",le.statusText),console.log("    Headers:",Object.fromEntries(le.headers.entries())),!le.ok)throw new Error(`HTTP error! Status: ${le.status} - ${le.statusText}`);const ie=await le.json();console.log("  📄 Response data:"),console.log("    Status:",ie.status),console.log("    Results count:",((I=ie.results)==null?void 0:I.length)||0),console.log("    Total:",ie.total||0),console.log("    Full response:",JSON.stringify(ie,null,2)),ie.status==="success"&&ie.results&&ie.results.length>0?(t(8,$=ie.results[0]),t(10,k=$.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",$.title),console.log("    Rank:",k),console.log("    Body length:",((Q=$.body)==null?void 0:Q.length)||0,"characters"),t(7,v=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${A}" in role: "${r}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",Z))}}catch(U){console.error("❌ Error fetching KG document:"),console.error("  Error type:",U.constructor.name),console.error("  Error message:",U.message||U),console.error("  Request details:",{term:A,role:r,isTauri:c,timestamp:new Date().toISOString()}),!c&&((P=U.message)!=null&&P.includes("Failed to fetch"))&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{}}function j(A){const W=A.target;if(W.tagName==="A"){const J=W.getAttribute("href");if(J&&J.startsWith("kg:")){A.preventDefault();const I=J.substring(3);T(I)}}}function D(){t(4,m=!0)}function N(A){A.type!=="dblclick"&&((A.ctrlKey||A.metaKey)&&A.key==="e"&&(A.preventDefault(),t(4,m=!0)),m&&(A.ctrlKey||A.metaKey)&&A.key==="s"&&(A.preventDefault(),h()),A.key==="Escape"&&(A.preventDefault(),m?t(4,m=!1):t(0,u=!1)))}const E=()=>t(0,u=!1);function G(A){l.$$.not_equal(i.body,A)&&(i.body=A,t(1,i))}const B=()=>t(4,m=!1);function M(A){lt[A?"unshift":"push"](()=>{b=A,t(6,b)})}function S(A){u=A,t(0,u)}const C=()=>t(7,v=!1);function O(A){v=A,t(7,v)}return l.$$set=A=>{"active"in A&&t(0,u=A.active),"item"in A&&t(1,i=A.item),"initialEdit"in A&&t(16,d=A.initialEdit),"kgTerm"in A&&t(2,p=A.kgTerm),"kgRank"in A&&t(3,_=A.kgRank)},l.$$.update=()=>{l.$$.dirty&65537&&u&&d&&t(4,m=!0),l.$$.dirty&19&&u&&i&&!m&&y(),l.$$.dirty&2&&t(5,o=i!=null&&i.body?/<html/i.test(i.body)||/<body/i.test(i.body)||/<head/i.test(i.body)||/^\s*<(!DOCTYPE|html|head|body|div|p|span)/i.test(i.body.trim()):!1),l.$$.dirty&32&&t(11,n=o?"html":"markdown")},[u,i,p,_,m,o,b,v,$,w,k,n,h,j,D,N,d,E,G,B,M,S,C,O]}class ql extends gt{constructor(e){super(),vt(this,e,Gr,Kr,ft,{active:0,item:1,initialEdit:16,kgTerm:2,kgRank:3})}}function So(l,e,t){const o=l.slice();return o[33]=e[t],o}function Ro(l,e,t){const o=l.slice();return o[36]=e[t],o}function Lo(l,e,t){const o=l.slice();return o[39]=e[t],o}function Ao(l){let e,t;return e=new ts({props:{type:"is-success",$$slots:{default:[Br]},$$scope:{ctx:l}}}),{c(){ve(e.$$.fragment)},m(o,n){be(e,o,n),t=!0},i(o){t||(Y(e.$$.fragment,o),t=!0)},o(o){X(e.$$.fragment,o),t=!1},d(o){ke(e,o)}}}function Br(l){let e,t,o;return{c(){e=f("p"),e.innerHTML="<strong>Success!</strong> Article saved to atomic server successfully.",t=g(),o=f("p"),o.textContent="The modal will close automatically..."},m(n,c){L(n,e,c),L(n,t,c),L(n,o,c)},p:Ee,d(n){n&&R(e),n&&R(t),n&&R(o)}}}function Eo(l){let e,t;return e=new ts({props:{type:"is-danger",$$slots:{default:[Jr]},$$scope:{ctx:l}}}),{c(){ve(e.$$.fragment)},m(o,n){be(e,o,n),t=!0},p(o,n){const c={};n[0]&8|n[1]&2048&&(c.$$scope={dirty:n,ctx:o}),e.$set(c)},i(o){t||(Y(e.$$.fragment,o),t=!0)},o(o){X(e.$$.fragment,o),t=!1},d(o){ke(e,o)}}}function Jr(l){let e,t,o,n;return{c(){e=f("p"),t=f("strong"),t.textContent="Error:",o=g(),n=H(l[3])},m(c,r){L(c,e,r),s(e,t),s(e,o),s(e,n)},p(c,r){r[0]&8&&we(n,c[3])},d(c){c&&R(e)}}}function Po(l){var O,A,W,J;let e,t,o,n,c,r=(((O=l[1])==null?void 0:O.title)||"Untitled")+"",u,i,d,p,_,m,b=(((A=l[1])==null?void 0:A.rank)||0)+"",v,$,w,k,y,h,T,j,D,N,E=((W=l[1])==null?void 0:W.description)&&No(l),G=((J=l[1])==null?void 0:J.tags)&&Oo(l);function B(I,Q){return I[10].length>0?Qr:Vr}let M=B(l),S=M(l),C=l[10].length>0&&Uo(l);return{c(){e=f("div"),t=f("label"),t.textContent="Document to Save",o=g(),n=f("div"),c=f("h5"),u=H(r),i=g(),E&&E.c(),d=g(),p=f("div"),_=f("span"),m=H("Rank: "),v=H(b),$=g(),G&&G.c(),w=g(),k=f("div"),y=f("label"),y.textContent="Atomic Server",h=g(),T=f("div"),S.c(),j=g(),C&&C.c(),D=it(),a(t,"class","label"),a(c,"class","title is-6"),a(_,"class","tag is-info svelte-48g63o"),a(p,"class","tags svelte-48g63o"),a(n,"class","box document-preview svelte-48g63o"),a(e,"class","field"),a(y,"class","label"),a(y,"for","atomic-server-select"),a(T,"class","control"),a(k,"class","field")},m(I,Q){L(I,e,Q),s(e,t),s(e,o),s(e,n),s(n,c),s(c,u),s(n,i),E&&E.m(n,null),s(n,d),s(n,p),s(p,_),s(_,m),s(_,v),s(p,$),G&&G.m(p,null),L(I,w,Q),L(I,k,Q),s(k,y),s(k,h),s(k,T),S.m(T,null),L(I,j,Q),C&&C.m(I,Q),L(I,D,Q),N=!0},p(I,Q){var P,U,F,z;(!N||Q[0]&2)&&r!==(r=(((P=I[1])==null?void 0:P.title)||"Untitled")+"")&&we(u,r),(U=I[1])!=null&&U.description?E?E.p(I,Q):(E=No(I),E.c(),E.m(n,d)):E&&(E.d(1),E=null),(!N||Q[0]&2)&&b!==(b=(((F=I[1])==null?void 0:F.rank)||0)+"")&&we(v,b),(z=I[1])!=null&&z.tags?G?G.p(I,Q):(G=Oo(I),G.c(),G.m(p,null)):G&&(G.d(1),G=null),M===(M=B(I))&&S?S.p(I,Q):(S.d(1),S=M(I),S&&(S.c(),S.m(T,null))),I[10].length>0?C?(C.p(I,Q),Q[0]&1024&&Y(C,1)):(C=Uo(I),C.c(),Y(C,1),C.m(D.parentNode,D)):C&&(Ve(),X(C,1,1,()=>{C=null}),Qe())},i(I){N||(Y(C),N=!0)},o(I){X(C),N=!1},d(I){I&&R(e),E&&E.d(),G&&G.d(),I&&R(w),I&&R(k),S.d(),I&&R(j),C&&C.d(I),I&&R(D)}}}function No(l){let e,t=l[1].description+"",o;return{c(){e=f("p"),o=H(t),a(e,"class","content")},m(n,c){L(n,e,c),s(e,o)},p(n,c){c[0]&2&&t!==(t=n[1].description+"")&&we(o,t)},d(n){n&&R(e)}}}function Oo(l){let e,t=l[1].tags,o=[];for(let n=0;n<t.length;n+=1)o[n]=Do(Lo(l,t,n));return{c(){for(let n=0;n<o.length;n+=1)o[n].c();e=it()},m(n,c){for(let r=0;r<o.length;r+=1)o[r]&&o[r].m(n,c);L(n,e,c)},p(n,c){if(c[0]&2){t=n[1].tags;let r;for(r=0;r<t.length;r+=1){const u=Lo(n,t,r);o[r]?o[r].p(u,c):(o[r]=Do(u),o[r].c(),o[r].m(e.parentNode,e))}for(;r<o.length;r+=1)o[r].d(1);o.length=t.length}},d(n){et(o,n),n&&R(e)}}}function Do(l){let e,t=l[39]+"",o;return{c(){e=f("span"),o=H(t),a(e,"class","tag svelte-48g63o")},m(n,c){L(n,e,c),s(e,o)},p(n,c){c[0]&2&&t!==(t=n[39]+"")&&we(o,t)},d(n){n&&R(e)}}}function Vr(l){let e,t,o,n,c,r,u,i,d;return{c(){e=f("div"),t=f("p"),t.innerHTML="<strong>No atomic servers available</strong>",o=g(),n=f("p"),c=H('Your current role "'),r=H(l[12]),u=H(`" doesn't have any writable atomic server configurations.`),i=g(),d=f("p"),d.textContent="Please configure an atomic server haystack in your role settings.",a(e,"class","notification is-warning")},m(p,_){L(p,e,_),s(e,t),s(e,o),s(e,n),s(n,c),s(n,r),s(n,u),s(e,i),s(e,d)},p(p,_){_[0]&4096&&we(r,p[12])},d(p){p&&R(e)}}}function Qr(l){let e,t,o,n,c,r,u=l[10],i=[];for(let d=0;d<u.length;d+=1)i[d]=Io(Ro(l,u,d));return{c(){e=f("div"),t=f("select");for(let d=0;d<i.length;d+=1)i[d].c();o=g(),n=f("p"),n.textContent=`Select the atomic server from your current role configuration.
              🔐 = Authenticated, ⚠️ = Anonymous access`,a(t,"id","atomic-server-select"),t.disabled=l[2],l[11]===void 0&&nt(()=>l[18].call(t)),a(e,"class","select is-fullwidth"),a(n,"class","help svelte-48g63o")},m(d,p){L(d,e,p),s(e,t);for(let _=0;_<i.length;_+=1)i[_]&&i[_].m(t,null);We(t,l[11],!0),L(d,o,p),L(d,n,p),c||(r=ee(t,"change",l[18]),c=!0)},p(d,p){if(p[0]&1024){u=d[10];let _;for(_=0;_<u.length;_+=1){const m=Ro(d,u,_);i[_]?i[_].p(m,p):(i[_]=Io(m),i[_].c(),i[_].m(t,null))}for(;_<i.length;_+=1)i[_].d(1);i.length=u.length}p[0]&4&&(t.disabled=d[2]),p[0]&3072&&We(t,d[11])},d(d){d&&R(e),et(i,d),d&&R(o),d&&R(n),c=!1,r()}}}function Yr(l){let e;return{c(){e=f("span"),e.textContent="⚠️ No Auth",a(e,"class","has-text-warning")},m(t,o){L(t,e,o)},d(t){t&&R(e)}}}function Zr(l){let e;return{c(){e=f("span"),e.textContent="🔐",a(e,"class","has-text-success")},m(t,o){L(t,e,o)},d(t){t&&R(e)}}}function Io(l){let e,t=l[36].location+"",o,n,c,r;function u(p,_){return p[36].atomic_server_secret?Zr:Yr}let i=u(l),d=i(l);return{c(){e=f("option"),o=H(t),n=g(),d.c(),c=g(),e.__value=r=l[36].location,e.value=e.__value},m(p,_){L(p,e,_),s(e,o),s(e,n),d.m(e,null),s(e,c)},p(p,_){_[0]&1024&&t!==(t=p[36].location+"")&&we(o,t),i!==(i=u(p))&&(d.d(1),d=i(p),d&&(d.c(),d.m(e,c))),_[0]&1024&&r!==(r=p[36].location)&&(e.__value=r,e.value=e.__value)},d(p){p&&R(e),d.d()}}}function Uo(l){var q,ne;let e,t,o,n,c,r,u,i,d,p,_,m,b,v,$,w,k,y,h,T,j,D,N,E,G,B,M,S,C,O,A,W,J,I,Q,P,U,F,z,Z,le,ie,ae,V=(l[8]||"Untitled")+"",se,ue,re,x,he,me=(((ne=(q=l[1])==null?void 0:q.body)==null?void 0:ne.length)||0)+"",te,de,pe,fe,Te,Ie,qe=l[14]()+"",Re,Le,oe,Ce,Ue,Me=l[15]()+"",ot,Ae,Ke,ge,je;function Pe(K){l[19](K)}let tt={id:"article-title",placeholder:"Enter article title",disabled:l[2],required:!0};l[8]!==void 0&&(tt.value=l[8]),c=new Vt({props:tt}),lt.push(()=>st(c,"value",Pe));const dt=[xr,Xr],He=[];function At(K,ce){return K[7]?1:0}return B=At(l),M=He[B]=dt[B](l),A=new Pl({props:{type:"is-primary",loading:l[2],disabled:l[2]||!l[8].trim()||!l[11],$$slots:{default:[ei]},$$scope:{ctx:l}}}),A.$on("click",l[16]),I=new Pl({props:{type:"is-light",disabled:l[2],$$slots:{default:[ti]},$$scope:{ctx:l}}}),I.$on("click",l[17]),Ke=ls(l[22][0]),{c(){e=f("div"),t=f("label"),t.textContent="Article Title",o=g(),n=f("div"),ve(c.$$.fragment),u=g(),i=f("div"),d=f("label"),d.textContent="Description",p=g(),_=f("div"),m=f("textarea"),b=g(),v=f("div"),$=f("label"),$.textContent="Parent Collection",w=g(),k=f("div"),y=f("label"),h=f("input"),T=H(`
              Use predefined collection`),j=g(),D=f("label"),N=f("input"),E=H(`
              Custom parent URL/path`),G=g(),M.c(),S=g(),C=f("div"),O=f("div"),ve(A.$$.fragment),W=g(),J=f("div"),ve(I.$$.fragment),Q=g(),P=f("div"),U=f("div"),F=f("p"),F.innerHTML="<strong>What will be saved:</strong>",z=g(),Z=f("ul"),le=f("li"),ie=f("strong"),ie.textContent="Title:",ae=g(),se=H(V),ue=g(),re=f("li"),x=f("strong"),x.textContent="Body:",he=H(" Original document content ("),te=H(me),de=H(" characters)"),pe=g(),fe=f("li"),Te=f("strong"),Te.textContent="Parent:",Ie=g(),Re=H(qe),Le=g(),oe=f("li"),Ce=f("strong"),Ce.textContent="Subject URL:",Ue=g(),ot=H(Me),a(t,"class","label"),a(t,"for","article-title"),a(n,"class","control"),a(e,"class","field"),a(d,"class","label"),a(d,"for","article-description"),a(m,"id","article-description"),a(m,"class","textarea"),a(m,"placeholder","Brief description of the article"),m.disabled=l[2],a(m,"rows","3"),a(_,"class","control"),a(i,"class","field"),a($,"class","label"),a(h,"type","radio"),h.__value=!1,h.value=h.__value,h.disabled=l[2],a(y,"class","radio svelte-48g63o"),a(N,"type","radio"),N.__value=!0,N.value=N.__value,N.disabled=l[2],a(D,"class","radio svelte-48g63o"),a(k,"class","control"),a(v,"class","field"),a(O,"class","control"),a(J,"class","control"),a(C,"class","field is-grouped"),a(le,"class","svelte-48g63o"),a(re,"class","svelte-48g63o"),a(fe,"class","svelte-48g63o"),a(oe,"class","svelte-48g63o"),a(Z,"class","svelte-48g63o"),a(U,"class","notification is-info is-light svelte-48g63o"),a(P,"class","field"),Ke.p(h,N)},m(K,ce){L(K,e,ce),s(e,t),s(e,o),s(e,n),be(c,n,null),L(K,u,ce),L(K,i,ce),s(i,d),s(i,p),s(i,_),s(_,m),Ne(m,l[9]),L(K,b,ce),L(K,v,ce),s(v,$),s(v,w),s(v,k),s(k,y),s(y,h),h.checked=h.__value===l[7],s(y,T),s(k,j),s(k,D),s(D,N),N.checked=N.__value===l[7],s(D,E),L(K,G,ce),He[B].m(K,ce),L(K,S,ce),L(K,C,ce),s(C,O),be(A,O,null),s(C,W),s(C,J),be(I,J,null),L(K,Q,ce),L(K,P,ce),s(P,U),s(U,F),s(U,z),s(U,Z),s(Z,le),s(le,ie),s(le,ae),s(le,se),s(Z,ue),s(Z,re),s(re,x),s(re,he),s(re,te),s(re,de),s(Z,pe),s(Z,fe),s(fe,Te),s(fe,Ie),s(fe,Re),s(Z,Le),s(Z,oe),s(oe,Ce),s(oe,Ue),s(oe,ot),Ae=!0,ge||(je=[ee(m,"input",l[20]),ee(h,"change",l[21]),ee(N,"change",l[23])],ge=!0)},p(K,ce){var Fe,Je;const $e={};ce[0]&4&&($e.disabled=K[2]),!r&&ce[0]&256&&(r=!0,$e.value=K[8],rt(()=>r=!1)),c.$set($e),(!Ae||ce[0]&4)&&(m.disabled=K[2]),ce[0]&512&&Ne(m,K[9]),(!Ae||ce[0]&4)&&(h.disabled=K[2]),ce[0]&128&&(h.checked=h.__value===K[7]),(!Ae||ce[0]&4)&&(N.disabled=K[2]),ce[0]&128&&(N.checked=N.__value===K[7]);let ye=B;B=At(K),B===ye?He[B].p(K,ce):(Ve(),X(He[ye],1,1,()=>{He[ye]=null}),Qe(),M=He[B],M?M.p(K,ce):(M=He[B]=dt[B](K),M.c()),Y(M,1),M.m(S.parentNode,S));const Be={};ce[0]&4&&(Be.loading=K[2]),ce[0]&2308&&(Be.disabled=K[2]||!K[8].trim()||!K[11]),ce[1]&2048&&(Be.$$scope={dirty:ce,ctx:K}),A.$set(Be);const Xe={};ce[0]&4&&(Xe.disabled=K[2]),ce[1]&2048&&(Xe.$$scope={dirty:ce,ctx:K}),I.$set(Xe),(!Ae||ce[0]&256)&&V!==(V=(K[8]||"Untitled")+"")&&we(se,V),(!Ae||ce[0]&2)&&me!==(me=(((Je=(Fe=K[1])==null?void 0:Fe.body)==null?void 0:Je.length)||0)+"")&&we(te,me)},i(K){Ae||(Y(c.$$.fragment,K),Y(M),Y(A.$$.fragment,K),Y(I.$$.fragment,K),Ae=!0)},o(K){X(c.$$.fragment,K),X(M),X(A.$$.fragment,K),X(I.$$.fragment,K),Ae=!1},d(K){K&&R(e),ke(c),K&&R(u),K&&R(i),K&&R(b),K&&R(v),K&&R(G),He[B].d(K),K&&R(S),K&&R(C),ke(A),ke(I),K&&R(Q),K&&R(P),Ke.r(),ge=!1,Ze(je)}}}function Xr(l){let e,t,o,n,c,r,u;function i(p){l[25](p)}let d={placeholder:"e.g., my-collection or http://server/custom-parent",disabled:l[2]};return l[6]!==void 0&&(d.value=l[6]),o=new Vt({props:d}),lt.push(()=>st(o,"value",i)),{c(){e=f("div"),t=f("div"),ve(o.$$.fragment),c=g(),r=f("p"),r.textContent=`Enter a collection name (e.g., "my-articles") or full URL.
              If the collection doesn't exist, it will be created.`,a(t,"class","control"),a(r,"class","help svelte-48g63o"),a(e,"class","field")},m(p,_){L(p,e,_),s(e,t),be(o,t,null),s(e,c),s(e,r),u=!0},p(p,_){const m={};_[0]&4&&(m.disabled=p[2]),!n&&_[0]&64&&(n=!0,m.value=p[6],rt(()=>n=!1)),o.$set(m)},i(p){u||(Y(o.$$.fragment,p),u=!0)},o(p){X(o.$$.fragment,p),u=!1},d(p){p&&R(e),ke(o)}}}function xr(l){let e,t,o,n,c,r,u=l[13],i=[];for(let d=0;d<u.length;d+=1)i[d]=Mo(So(l,u,d));return{c(){e=f("div"),t=f("div"),o=f("div"),n=f("select");for(let d=0;d<i.length;d+=1)i[d].c();n.disabled=l[2],l[5]===void 0&&nt(()=>l[24].call(n)),a(o,"class","select is-fullwidth"),a(t,"class","control"),a(e,"class","field")},m(d,p){L(d,e,p),s(e,t),s(t,o),s(o,n);for(let _=0;_<i.length;_+=1)i[_]&&i[_].m(n,null);We(n,l[5],!0),c||(r=ee(n,"change",l[24]),c=!0)},p(d,p){if(p[0]&8192){u=d[13];let _;for(_=0;_<u.length;_+=1){const m=So(d,u,_);i[_]?i[_].p(m,p):(i[_]=Mo(m),i[_].c(),i[_].m(n,null))}for(;_<i.length;_+=1)i[_].d(1);i.length=u.length}p[0]&4&&(n.disabled=d[2]),p[0]&8224&&We(n,d[5])},i:Ee,o:Ee,d(d){d&&R(e),et(i,d),c=!1,r()}}}function Mo(l){let e,t=l[33].label+"",o;return{c(){e=f("option"),o=H(t),e.__value=l[33].value,e.value=e.__value},m(n,c){L(n,e,c),s(e,o)},p:Ee,d(n){n&&R(e)}}}function ei(l){let e,t,o;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-cloud-upload-alt"></i>',t=g(),o=f("span"),o.textContent="Save to Atomic Server",a(e,"class","icon")},m(n,c){L(n,e,c),L(n,t,c),L(n,o,c)},p:Ee,d(n){n&&R(e),n&&R(t),n&&R(o)}}}function ti(l){let e;return{c(){e=H("Cancel")},m(t,o){L(t,e,o)},d(t){t&&R(e)}}}function li(l){let e,t,o,n,c,r,u,i,d,p,_,m,b,v=l[4]&&Ao(l),$=l[3]&&Eo(l),w=!l[4]&&Po(l);return{c(){e=f("div"),t=f("div"),o=f("div"),o.innerHTML=`<div class="level-item"><h3 class="title is-4"><span class="icon"><i class="fas fa-save"></i></span>
            Save to Atomic Server</h3></div>`,n=g(),c=f("div"),r=f("div"),u=f("button"),i=g(),v&&v.c(),d=g(),$&&$.c(),p=g(),w&&w.c(),a(o,"class","level-left"),a(u,"class","delete is-large"),u.disabled=l[2],a(u,"aria-label","close"),a(r,"class","level-item"),a(c,"class","level-right"),a(t,"class","level svelte-48g63o"),a(e,"class","box")},m(k,y){L(k,e,y),s(e,t),s(t,o),s(t,n),s(t,c),s(c,r),s(r,u),s(e,i),v&&v.m(e,null),s(e,d),$&&$.m(e,null),s(e,p),w&&w.m(e,null),_=!0,m||(b=ee(u,"click",l[17]),m=!0)},p(k,y){(!_||y[0]&4)&&(u.disabled=k[2]),k[4]?v?y[0]&16&&Y(v,1):(v=Ao(k),v.c(),Y(v,1),v.m(e,d)):v&&(Ve(),X(v,1,1,()=>{v=null}),Qe()),k[3]?$?($.p(k,y),y[0]&8&&Y($,1)):($=Eo(k),$.c(),Y($,1),$.m(e,p)):$&&(Ve(),X($,1,1,()=>{$=null}),Qe()),k[4]?w&&(Ve(),X(w,1,1,()=>{w=null}),Qe()):w?(w.p(k,y),y[0]&16&&Y(w,1)):(w=Po(k),w.c(),Y(w,1),w.m(e,null))},i(k){_||(Y(v),Y($),Y(w),_=!0)},o(k){X(v),X($),X(w),_=!1},d(k){k&&R(e),v&&v.d(),$&&$.d(),w&&w.d(),m=!1,b()}}}function oi(l){let e,t,o;function n(r){l[26](r)}let c={$$slots:{default:[li]},$$scope:{ctx:l}};return l[0]!==void 0&&(c.active=l[0]),e=new Fl({props:c}),lt.push(()=>st(e,"active",n)),e.$on("close",l[17]),{c(){ve(e.$$.fragment)},m(r,u){be(e,r,u),o=!0},p(r,u){const i={};u[0]&8190|u[1]&2048&&(i.$$scope={dirty:u,ctx:r}),!t&&u[0]&1&&(t=!0,i.active=r[0],rt(()=>t=!1)),e.$set(i)},i(r){o||(Y(e.$$.fragment,r),o=!0)},o(r){X(e.$$.fragment,r),o=!1},d(r){ke(e,r)}}}function ni(l,e,t){let o,n,c;De(l,xe,P=>t(27,o=P)),De(l,Lt,P=>t(28,n=P)),De(l,Rt,P=>t(12,c=P));let{active:r=!1}=e,{document:u}=e,i=!1,d=null,p=!1,_="",m="",b=!1,v="",$="",w=[],k="";const y=[{label:"Root (Server Root)",value:""},{label:"Articles Collection",value:"articles"},{label:"Documents Collection",value:"documents"},{label:"Knowledge Base",value:"knowledge-base"},{label:"Research",value:"research"},{label:"Projects",value:"projects"}];function h(){t(2,i=!1),t(3,d=null),t(4,p=!1),t(5,_=""),t(6,m=""),t(7,b=!1),t(8,v=(u==null?void 0:u.title)||""),t(9,$=(u==null?void 0:u.description)||`Article saved from Terraphim search: ${u==null?void 0:u.title}`),t(10,w=[]),t(11,k="")}function T(){var z;const P=c,U=n;if(!(U!=null&&U.roles)||!P){console.warn("No role configuration found");return}let F=null;try{for(const[Z,le]of Object.entries(U.roles)){const ie=le,ae=typeof ie.name=="object"?ie.name.original:String(ie.name);if(Z===P||ae===P){F=ie;break}}}catch(Z){console.warn("Error checking role configuration:",Z);return}if(!F){console.warn(`Role "${P}" not found in configuration`);return}t(10,w=((z=F.haystacks)==null?void 0:z.filter(Z=>Z.service==="Atomic"&&Z.location&&!Z.read_only))||[]),w.length>0&&t(11,k=w[0].location),console.log("Loaded atomic servers:",w)}function j(){const P=w.find(U=>U.location===k);return P==null?void 0:P.atomic_server_secret}function D(){const P=k.replace(/\/$/,"");if(b&&m.trim()){const U=m.trim();return U.startsWith("http://")||U.startsWith("https://")?U:`${P}/${U.replace(/^\//,"")}`}else return _?`${P}/${_}`:P}function N(){return v.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,50)}function E(){const P=k.replace(/\/$/,""),U=N(),F=Date.now();return`${P}/${U}-${F}`}async function G(){if(!k||!v.trim()){t(3,d="Please select an atomic server and provide a title");return}t(2,i=!0),t(3,d=null);try{const P=E(),U=D(),F=j();console.log("🔄 Saving article to atomic server:",{subject:P,parent:U,server:k,hasSecret:!!F});const z={subject:P,title:v.trim(),description:$.trim(),body:u.body,parent:U,shortname:N(),original_id:u.id,original_url:u.url,original_rank:u.rank,tags:u.tags||[]};if(o)await ze("save_article_to_atomic",{article:z,serverUrl:k,atomicSecret:F});else{const Z=await fetch(`${Ye.ServerURL}/atomic/save`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({article:z,server_url:k,atomic_secret:F})});if(!Z.ok){const le=await Z.json().catch(()=>({error:Z.statusText}));throw new Error(le.error||`HTTP ${Z.status}: ${Z.statusText}`)}}t(4,p=!0),console.log("✅ Article saved successfully to atomic server"),setTimeout(()=>{t(0,r=!1)},2e3)}catch(P){console.error("❌ Failed to save article to atomic server:",P),t(3,d=P.message||"Failed to save article to atomic server")}finally{t(2,i=!1)}}function B(){i||t(0,r=!1)}const M=[[]];function S(){k=St(this),t(11,k),t(10,w)}function C(P){v=P,t(8,v)}function O(){$=this.value,t(9,$)}function A(){b=this.__value,t(7,b)}function W(){b=this.__value,t(7,b)}function J(){_=St(this),t(5,_),t(13,y)}function I(P){m=P,t(6,m)}function Q(P){r=P,t(0,r)}return l.$$set=P=>{"active"in P&&t(0,r=P.active),"document"in P&&t(1,u=P.document)},l.$$.update=()=>{l.$$.dirty[0]&3&&r&&u&&(h(),T())},[r,u,i,d,p,_,m,b,v,$,w,k,c,y,D,E,G,B,S,C,O,A,M,W,J,I,Q]}class si extends gt{constructor(e){super(),vt(this,e,ni,oi,ft,{active:0,document:1},null,[-1,-1])}}async function Wl(l){return ze("tauri",l)}async function ri(l,e){return Wl({__tauriModule:"Event",message:{cmd:"unlisten",event:l,eventId:e}})}async function ii(l,e,t){return Wl({__tauriModule:"Event",message:{cmd:"listen",event:l,windowLabel:e,handler:jl(t)}}).then(o=>async()=>ri(l,o))}var jo;(function(l){l.WINDOW_RESIZED="tauri://resize",l.WINDOW_MOVED="tauri://move",l.WINDOW_CLOSE_REQUESTED="tauri://close-requested",l.WINDOW_CREATED="tauri://window-created",l.WINDOW_DESTROYED="tauri://destroyed",l.WINDOW_FOCUS="tauri://focus",l.WINDOW_BLUR="tauri://blur",l.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",l.WINDOW_THEME_CHANGED="tauri://theme-changed",l.WINDOW_FILE_DROP="tauri://file-drop",l.WINDOW_FILE_DROP_HOVER="tauri://file-drop-hover",l.WINDOW_FILE_DROP_CANCELLED="tauri://file-drop-cancelled",l.MENU="tauri://menu",l.CHECK_UPDATE="tauri://update",l.UPDATE_AVAILABLE="tauri://update-available",l.INSTALL_UPDATE="tauri://update-install",l.STATUS_UPDATE="tauri://update-status",l.DOWNLOAD_PROGRESS="tauri://update-download-progress"})(jo||(jo={}));async function ai(l,e){return ii(l,null,e)}function Ho(l,e,t){const o=l.slice();return o[9]=e[t],o}function Fo(l){let e,t=l[9].name+"",o,n;return{c(){e=f("option"),o=H(t),e.__value=n=l[9].name,e.value=e.__value},m(c,r){L(c,e,r),s(e,o)},p(c,r){r&1&&t!==(t=c[9].name+"")&&we(o,t),r&1&&n!==(n=c[9].name)&&(e.__value=n,e.value=e.__value)},d(c){c&&R(e)}}}function ci(l){let e,t,o,n,c,r,u=l[0],i=[];for(let d=0;d<u.length;d+=1)i[d]=Fo(Ho(l,u,d));return{c(){e=f("div"),t=f("div"),o=f("div"),n=f("select");for(let d=0;d<i.length;d+=1)i[d].c();a(o,"class","select"),a(t,"class","control"),a(e,"class","field is-grouped is-grouped-right")},m(d,p){L(d,e,p),s(e,t),s(t,o),s(o,n);for(let _=0;_<i.length;_+=1)i[_]&&i[_].m(n,null);We(n,l[1]),c||(r=ee(n,"change",l[2]),c=!0)},p(d,[p]){if(p&1){u=d[0];let _;for(_=0;_<u.length;_+=1){const m=Ho(d,u,_);i[_]?i[_].p(m,p):(i[_]=Fo(m),i[_].c(),i[_].m(n,null))}for(;_<i.length;_+=1)i[_].d(1);i.length=u.length}p&3&&We(n,d[1])},i:Ee,o:Ee,d(d){d&&R(e),et(i,d),c=!1,r()}}}function ui(l,e,t){let o,n,c,r;De(l,Lt,m=>t(5,o=m)),De(l,xe,m=>t(6,n=m)),De(l,_o,m=>t(0,c=m)),De(l,Rt,m=>t(1,r=m));let u="";async function i(){try{xe.set(window.__TAURI__!==void 0),n?(console.log("Loading config from Tauri"),ze("get_config").then(m=>{console.log("get_config response",m),m&&m.status==="success"&&d(m.config)}).catch(m=>console.error("Error fetching config in Tauri:",m))):(console.log("Loading config from server"),u=`${Ye.ServerURL}/config/`,fetch(u).then(m=>m.json()).then(m=>{console.log("Config received",m),m&&m.status==="success"&&d(m.config)}).catch(m=>console.error("Error fetching config:",m)))}catch(m){console.error("Unhandled error in loadConfig:",m)}}function d(m){var w;console.log("Updating stores from config:",m);const b={default_role:m.selected_role,...m};Lt.set(b);const v=Object.entries(m.roles).map(([k,y])=>({name:k,...y}));_o.set(v),Rt.set(m.selected_role);const $=m.roles[m.selected_role];if(console.log("Selected role settings:",$),$){const k=$.theme||"spacelab";console.log("Setting theme to:",k),ml.set(k),(w=$.kg)!=null&&w.publish?n?ze("publish_thesaurus",{roleName:m.selected_role}).then(y=>{console.log("publish_thesaurus response",y),dl.set(y),$t.set(!0)}).catch(y=>{console.error("Error publishing thesaurus:",y),$t.set(!1)}):(console.log("Fetching thesaurus from HTTP endpoint for role",m.selected_role),fetch(`${Ye.ServerURL}/thesaurus/${encodeURIComponent(m.selected_role)}`).then(y=>y.json()).then(y=>{console.log("thesaurus HTTP response",y),y&&y.status==="success"&&y.thesaurus?(dl.set(y.thesaurus),$t.set(!0)):(console.error("Failed to fetch thesaurus:",y),$t.set(!1))}).catch(y=>{console.error("Error fetching thesaurus:",y),$t.set(!1)})):$t.set(!1)}else console.warn("No role settings found for:",m.selected_role),ml.set("spacelab")}typeof window<"u"&&window.__TAURI__&&ai("role_changed",m=>{console.log("Role changed event received from backend:",m.payload),d(m.payload)});async function p(){await i()}p(),console.log("Using Terraphim Server URL:",Ye.ServerURL);function _(m){var k,y;const v=m.currentTarget.value;console.log("Role change requested:",v),Rt.set(v);const $=c.find(h=>h.name===v);if(!$){console.error(`No role settings found for role: ${v}.`);return}const w=$.theme||"spacelab";ml.set(w),console.log(`Theme changed to ${w}`),Lt.update(h=>(h.selected_role=v,h)),n?(ze("select_role",{roleName:v}).catch(h=>console.error("Error selecting role:",h)),(k=$.kg)!=null&&k.publish?(console.log("Publishing thesaurus for role",v),ze("publish_thesaurus",{roleName:v}).then(h=>{dl.set(h),$t.set(!0)})):$t.set(!1)):(fetch(`${Ye.ServerURL}/config/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).catch(h=>console.error("Error updating config on server:",h)),(y=$.kg)!=null&&y.publish?(console.log("Fetching thesaurus from HTTP endpoint for role",v),fetch(`${Ye.ServerURL}/thesaurus/${encodeURIComponent(v)}`).then(h=>h.json()).then(h=>{console.log("thesaurus HTTP response",h),h&&h.status==="success"&&h.thesaurus?(dl.set(h.thesaurus),$t.set(!0)):(console.error("Failed to fetch thesaurus:",h),$t.set(!1))}).catch(h=>{console.error("Error fetching thesaurus:",h),$t.set(!1)})):$t.set(!1))}return[c,r,_,i]}class El extends gt{constructor(e){super(),vt(this,e,ui,ci,ft,{loadConfig:3})}get loadConfig(){return this.$$.ctx[3]}}function zo(l,e,t){const o=l.slice();return o[41]=e[t],o}function qo(l,e,t){const o=l.slice();return o[44]=e[t],o}function Wo(l){let e,t;return e=new os({props:{$$slots:{default:[di]},$$scope:{ctx:l}}}),{c(){ve(e.$$.fragment)},m(o,n){be(e,o,n),t=!0},p(o,n){const c={};n[0]&129|n[1]&65536&&(c.$$scope={dirty:n,ctx:o}),e.$set(c)},i(o){t||(Y(e.$$.fragment,o),t=!0)},o(o){X(e.$$.fragment,o),t=!1},d(o){ke(e,o)}}}function fi(l){let e=l[44]+"",t;return{c(){t=H(e)},m(o,n){L(o,t,n)},p(o,n){n[0]&1&&e!==(e=o[44]+"")&&we(t,e)},d(o){o&&R(t)}}}function Ko(l){let e,t,o,n,c,r;t=new ns({props:{rounded:!0,$$slots:{default:[fi]},$$scope:{ctx:l}}});function u(){return l[19](l[44])}return{c(){e=f("button"),ve(t.$$.fragment),o=g(),a(e,"class","tag-button svelte-2smypa"),e.disabled=l[7],a(e,"title","Click to view knowledge graph document")},m(i,d){L(i,e,d),be(t,e,null),s(e,o),n=!0,c||(r=ee(e,"click",u),c=!0)},p(i,d){l=i;const p={};d[0]&1|d[1]&65536&&(p.$$scope={dirty:d,ctx:l}),t.$set(p),(!n||d[0]&128)&&(e.disabled=l[7])},i(i){n||(Y(t.$$.fragment,i),n=!0)},o(i){X(t.$$.fragment,i),n=!1},d(i){i&&R(e),ke(t),c=!1,r()}}}function di(l){let e,t,o=l[0].tags,n=[];for(let r=0;r<o.length;r+=1)n[r]=Ko(qo(l,o,r));const c=r=>X(n[r],1,1,()=>{n[r]=null});return{c(){for(let r=0;r<n.length;r+=1)n[r].c();e=it()},m(r,u){for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(r,u);L(r,e,u),t=!0},p(r,u){if(u[0]&131201){o=r[0].tags;let i;for(i=0;i<o.length;i+=1){const d=qo(r,o,i);n[i]?(n[i].p(d,u),Y(n[i],1)):(n[i]=Ko(d),n[i].c(),Y(n[i],1),n[i].m(e.parentNode,e))}for(Ve(),i=o.length;i<n.length;i+=1)c(i);Qe()}},i(r){if(!t){for(let u=0;u<o.length;u+=1)Y(n[u]);t=!0}},o(r){n=n.filter(Boolean);for(let u=0;u<n.length;u+=1)X(n[u]);t=!1},d(r){et(n,r),r&&R(e)}}}function pi(l){let e,t=(l[0].rank||0)+"",o;return{c(){e=H("Rank "),o=H(t)},m(n,c){L(n,e,c),L(n,o,c)},p(n,c){c[0]&1&&t!==(t=(n[0].rank||0)+"")&&we(o,t)},d(n){n&&R(e),n&&R(o)}}}function mi(l){let e,t;return e=new ns({props:{rounded:!0,$$slots:{default:[pi]},$$scope:{ctx:l}}}),{c(){ve(e.$$.fragment)},m(o,n){be(e,o,n),t=!0},p(o,n){const c={};n[0]&1|n[1]&65536&&(c.$$scope={dirty:n,ctx:o}),e.$set(c)},i(o){t||(Y(e.$$.fragment,o),t=!0)},o(o){X(e.$$.fragment,o),t=!1},d(o){ke(e,o)}}}function _i(l){let e;return{c(){e=f("small"),e.textContent="No description available",a(e,"class","no-description svelte-2smypa")},m(t,o){L(t,e,o)},p:Ee,i:Ee,o:Ee,d(t){t&&R(e)}}}function hi(l){let e,t;return e=new Ol({props:{source:l[0].description}}),{c(){ve(e.$$.fragment)},m(o,n){be(e,o,n),t=!0},p(o,n){const c={};n[0]&1&&(c.source=o[0].description),e.$set(c)},i(o){t||(Y(e.$$.fragment,o),t=!0)},o(o){X(e.$$.fragment,o),t=!1},d(o){ke(e,o)}}}function Go(l){let e,t,o,n,c,r;return{c(){e=f("button"),t=f("span"),t.innerHTML='<i class="fas fa-magic" aria-hidden="true"></i>',o=g(),n=f("span"),n.textContent="AI Summary",a(t,"class","icon is-small"),a(e,"class","button is-small is-info is-outlined ai-summary-button svelte-2smypa"),e.disabled=l[9],a(e,"title","Generate AI-powered summary using OpenRouter")},m(u,i){L(u,e,i),s(e,t),s(e,o),s(e,n),c||(r=ee(e,"click",l[18]),c=!0)},p(u,i){i[0]&512&&(e.disabled=u[9])},d(u){u&&R(e),c=!1,r()}}}function Bo(l){let e;return{c(){e=f("div"),e.innerHTML=`<span class="icon"><i class="fas fa-spinner fa-spin" aria-hidden="true"></i></span> 
                <small>Generating AI summary...</small>`,a(e,"class","ai-summary-loading svelte-2smypa")},m(t,o){L(t,e,o)},d(t){t&&R(e)}}}function Jo(l){let e,t,o,n,c,r,u,i,d,p;return{c(){e=f("div"),t=f("span"),t.innerHTML='<i class="fas fa-exclamation-triangle" aria-hidden="true"></i>',o=g(),n=f("small"),c=H("Summary error: "),r=H(l[10]),u=g(),i=f("button"),i.textContent="Retry",a(t,"class","icon has-text-danger"),a(n,"class","has-text-danger"),a(i,"class","button is-small is-text svelte-2smypa"),a(i,"title","Retry generating summary"),a(e,"class","ai-summary-error svelte-2smypa")},m(_,m){L(_,e,m),s(e,t),s(e,o),s(e,n),s(n,c),s(n,r),s(e,u),s(e,i),d||(p=ee(i,"click",l[20]),d=!0)},p(_,m){m[0]&1024&&we(r,_[10])},d(_){_&&R(e),d=!1,p()}}}function Vo(l){let e,t,o,n,c,r,u,i,d,p,_,m,b,v,$,w,k,y,h,T;function j(E,G){return E[12]?vi:gi}let D=j(l),N=D(l);return p=new Ol({props:{source:l[8]}}),{c(){e=f("div"),t=f("div"),o=f("small"),n=f("span"),n.innerHTML='<i class="fas fa-robot" aria-hidden="true"></i>',c=H(`
                    AI Summary
                    `),N.c(),r=g(),u=f("button"),u.innerHTML='<span class="icon is-small"><i class="fas fa-times" aria-hidden="true"></i></span>',i=g(),d=f("div"),ve(p.$$.fragment),_=g(),m=f("div"),b=f("button"),v=f("span"),v.innerHTML='<i class="fas fa-redo" aria-hidden="true"></i>',$=g(),w=f("span"),w.textContent="Regenerate",a(n,"class","icon is-small"),a(o,"class","ai-summary-label svelte-2smypa"),a(u,"class","button is-small is-text svelte-2smypa"),a(u,"title","Hide AI summary"),a(t,"class","ai-summary-header svelte-2smypa"),a(d,"class","ai-summary-content svelte-2smypa"),a(v,"class","icon is-small"),a(b,"class","button is-small is-text svelte-2smypa"),b.disabled=l[9],a(b,"title","Regenerate summary"),a(m,"class","ai-summary-actions svelte-2smypa"),a(e,"class","ai-summary svelte-2smypa")},m(E,G){L(E,e,G),s(e,t),s(t,o),s(o,n),s(o,c),N.m(o,null),s(t,r),s(t,u),s(e,i),s(e,d),be(p,d,null),s(e,_),s(e,m),s(m,b),s(b,v),s(b,$),s(b,w),y=!0,h||(T=[ee(u,"click",l[21]),ee(b,"click",l[22])],h=!0)},p(E,G){D!==(D=j(E))&&(N.d(1),N=D(E),N&&(N.c(),N.m(o,null)));const B={};G[0]&256&&(B.source=E[8]),p.$set(B),(!y||G[0]&512)&&(b.disabled=E[9])},i(E){y||(Y(p.$$.fragment,E),nt(()=>{y&&(k||(k=sl(e,rl,{},!0)),k.run(1))}),y=!0)},o(E){X(p.$$.fragment,E),k||(k=sl(e,rl,{},!1)),k.run(0),y=!1},d(E){E&&R(e),N.d(),ke(p),E&&k&&k.end(),h=!1,Ze(T)}}}function gi(l){let e;return{c(){e=f("span"),e.textContent="fresh",a(e,"class","tag is-small is-success")},m(t,o){L(t,e,o)},d(t){t&&R(e)}}}function vi(l){let e;return{c(){e=f("span"),e.textContent="cached",a(e,"class","tag is-small is-light")},m(t,o){L(t,e,o)},d(t){t&&R(e)}}}function Qo(l){let e;function t(c,r){return c[41].disabled?wi:c[41].isLink?ki:bi}let o=t(l),n=o(l);return{c(){n.c(),e=it()},m(c,r){n.m(c,r),L(c,e,r)},p(c,r){o===(o=t(c))&&n?n.p(c,r):(n.d(1),n=o(c),n&&(n.c(),n.m(e.parentNode,e)))},d(c){n.d(c),c&&R(e)}}}function bi(l){let e,t,o,n,c,r,u,i,d,p;return{c(){var _,m,b;e=f("button"),t=f("span"),o=f("i"),c=g(),a(o,"class",n=Dt(l[41].icon)+" svelte-2smypa"),a(t,"class","icon is-medium"),ht(t,"has-text-primary",(_=l[41].className)==null?void 0:_.includes("primary")),ht(t,"has-text-success",(m=l[41].className)==null?void 0:m.includes("success")),ht(t,"has-text-danger",(b=l[41].className)==null?void 0:b.includes("danger")),a(e,"type","button"),a(e,"class","level-item button is-ghost svelte-2smypa"),a(e,"aria-label",r=l[41].title),a(e,"title",u=l[41].title),a(e,"data-testid",i=l[41].testId||"")},m(_,m){L(_,e,m),s(e,t),s(t,o),s(e,c),d||(p=ee(e,"click",function(){zl(l[41].action)&&l[41].action.apply(this,arguments)}),d=!0)},p(_,m){var b,v,$;l=_,m[0]&32768&&n!==(n=Dt(l[41].icon)+" svelte-2smypa")&&a(o,"class",n),m[0]&32768&&ht(t,"has-text-primary",(b=l[41].className)==null?void 0:b.includes("primary")),m[0]&32768&&ht(t,"has-text-success",(v=l[41].className)==null?void 0:v.includes("success")),m[0]&32768&&ht(t,"has-text-danger",($=l[41].className)==null?void 0:$.includes("danger")),m[0]&32768&&r!==(r=l[41].title)&&a(e,"aria-label",r),m[0]&32768&&u!==(u=l[41].title)&&a(e,"title",u),m[0]&32768&&i!==(i=l[41].testId||"")&&a(e,"data-testid",i)},d(_){_&&R(e),d=!1,p()}}}function ki(l){let e,t,o,n,c,r,u,i;return{c(){e=f("a"),t=f("span"),o=f("i"),c=g(),a(o,"class",n=Dt(l[41].icon)+" svelte-2smypa"),a(t,"class","icon is-medium"),ht(t,"has-text-primary",l[41].className),a(e,"href",r=l[41].href),a(e,"target","_blank"),a(e,"class","level-item"),a(e,"aria-label",u=l[41].title),a(e,"title",i=l[41].title)},m(d,p){L(d,e,p),s(e,t),s(t,o),s(e,c)},p(d,p){p[0]&32768&&n!==(n=Dt(d[41].icon)+" svelte-2smypa")&&a(o,"class",n),p[0]&32768&&ht(t,"has-text-primary",d[41].className),p[0]&32768&&r!==(r=d[41].href)&&a(e,"href",r),p[0]&32768&&u!==(u=d[41].title)&&a(e,"aria-label",u),p[0]&32768&&i!==(i=d[41].title)&&a(e,"title",i)},d(d){d&&R(e)}}}function wi(l){let e,t,o,n,c,r,u;return{c(){e=f("button"),t=f("span"),o=f("i"),c=g(),a(o,"class",n=Dt(l[41].icon)+" svelte-2smypa"),a(t,"class","icon is-medium"),ht(t,"has-text-primary",l[41].className),a(e,"type","button"),a(e,"class","level-item button is-ghost svelte-2smypa"),a(e,"aria-label",r=l[41].title),a(e,"title",u=l[41].title),e.disabled=!0},m(i,d){L(i,e,d),s(e,t),s(t,o),s(e,c)},p(i,d){d[0]&32768&&n!==(n=Dt(i[41].icon)+" svelte-2smypa")&&a(o,"class",n),d[0]&32768&&ht(t,"has-text-primary",i[41].className),d[0]&32768&&r!==(r=i[41].title)&&a(e,"aria-label",r),d[0]&32768&&u!==(u=i[41].title)&&a(e,"title",u)},d(i){i&&R(e)}}}function Yo(l){let e,t=l[41].visible&&Qo(l);return{c(){t&&t.c(),e=it()},m(o,n){t&&t.m(o,n),L(o,e,n)},p(o,n){o[41].visible?t?t.p(o,n):(t=Qo(o),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(o){t&&t.d(o),o&&R(e)}}}function Zo(l){let e,t,o,n,c,r;return{c(){e=f("div"),t=f("button"),o=g(),n=H(l[13]),a(t,"class","delete svelte-2smypa"),a(e,"class","notification is-danger is-light mt-2")},m(u,i){L(u,e,i),s(e,t),s(e,o),s(e,n),c||(r=ee(t,"click",l[23]),c=!0)},p(u,i){i[0]&8192&&we(n,u[13])},d(u){u&&R(e),c=!1,r()}}}function Xo(l){let e,t,o;function n(r){l[25](r)}let c={item:l[4],kgTerm:l[5],kgRank:l[6]};return l[2]!==void 0&&(c.active=l[2]),e=new ql({props:c}),lt.push(()=>st(e,"active",n)),{c(){ve(e.$$.fragment)},m(r,u){be(e,r,u),o=!0},p(r,u){const i={};u[0]&16&&(i.item=r[4]),u[0]&32&&(i.kgTerm=r[5]),u[0]&64&&(i.kgRank=r[6]),!t&&u[0]&4&&(t=!0,i.active=r[2],rt(()=>t=!1)),e.$set(i)},i(r){o||(Y(e.$$.fragment,r),o=!0)},o(r){X(e.$$.fragment,r),o=!1},d(r){ke(e,r)}}}function xo(l){let e,t,o;function n(r){l[26](r)}let c={document:l[0]};return l[3]!==void 0&&(c.active=l[3]),e=new si({props:c}),lt.push(()=>st(e,"active",n)),{c(){ve(e.$$.fragment)},m(r,u){be(e,r,u),o=!0},p(r,u){const i={};u[0]&1&&(i.document=r[0]),!t&&u[0]&8&&(t=!0,i.active=r[3],rt(()=>t=!1)),e.$set(i)},i(r){o||(Y(e.$$.fragment,r),o=!0)},o(r){X(e.$$.fragment,r),o=!1},d(r){ke(e,r)}}}function yi(l){let e,t,o,n,c,r,u,i,d,p,_,m,b=l[0].title+"",v,$,w,k,y,h,T,j,D,N,E,G,B,M,S,C,O,A,W,J,I,Q,P,U,F,z,Z,le,ie,ae,V,se=l[0].tags&&Wo(l);i=new os({props:{$$slots:{default:[mi]},$$scope:{ctx:l}}});const ue=[hi,_i],re=[];function x(oe,Ce){return oe[0].description?0:1}T=x(l),j=re[T]=ue[T](l);let he=!l[11]&&!l[9]&&!l[10]&&Go(l),me=l[9]&&Bo(),te=l[10]&&Jo(l),de=l[11]&&l[8]&&Vo(l),pe=l[15],fe=[];for(let oe=0;oe<pe.length;oe+=1)fe[oe]=Yo(zo(l,pe,oe));let Te=l[13]&&Zo(l);function Ie(oe){l[24](oe)}let qe={item:l[0]};l[1]!==void 0&&(qe.active=l[1]),U=new ql({props:qe}),lt.push(()=>st(U,"active",Ie));let Re=l[4]&&Xo(l),Le=l[14]&&xo(l);return{c(){e=f("div"),t=f("article"),o=f("div"),n=f("div"),c=f("div"),se&&se.c(),r=g(),u=f("div"),ve(i.$$.fragment),d=g(),p=f("div"),_=f("button"),m=f("h2"),v=H(b),$=g(),w=f("div"),k=f("small"),k.textContent="Description:",y=g(),h=f("div"),j.c(),D=g(),N=f("div"),he&&he.c(),E=g(),me&&me.c(),G=g(),te&&te.c(),B=g(),de&&de.c(),M=g(),S=f("br"),O=g(),A=f("div"),W=f("nav"),J=f("div");for(let oe=0;oe<fe.length;oe+=1)fe[oe].c();Q=g(),Te&&Te.c(),P=g(),ve(U.$$.fragment),z=g(),Re&&Re.c(),Z=g(),Le&&Le.c(),le=it(),a(c,"class","level-right"),a(u,"class","level-right"),a(m,"class","title svelte-2smypa"),a(_,"class","svelte-2smypa"),a(k,"class","description-label svelte-2smypa"),a(h,"class","description-content svelte-2smypa"),a(w,"class","description svelte-2smypa"),a(N,"class","ai-summary-section svelte-2smypa"),a(n,"class","content"),a(J,"class","level-right"),a(W,"class","level is-mobile"),a(A,"class","level-right"),a(o,"class","media-content"),a(t,"class","media"),a(e,"class","box")},m(oe,Ce){L(oe,e,Ce),s(e,t),s(t,o),s(o,n),s(n,c),se&&se.m(c,null),s(n,r),s(n,u),be(i,u,null),s(n,d),s(n,p),s(p,_),s(_,m),s(m,v),s(p,$),s(p,w),s(w,k),s(w,y),s(w,h),re[T].m(h,null),s(p,D),s(p,N),he&&he.m(N,null),s(N,E),me&&me.m(N,null),s(N,G),te&&te.m(N,null),s(N,B),de&&de.m(N,null),s(p,M),s(p,S),s(o,O),s(o,A),s(A,W),s(W,J);for(let Ue=0;Ue<fe.length;Ue+=1)fe[Ue]&&fe[Ue].m(J,null);s(e,Q),Te&&Te.m(e,null),L(oe,P,Ce),be(U,oe,Ce),L(oe,z,Ce),Re&&Re.m(oe,Ce),L(oe,Z,Ce),Le&&Le.m(oe,Ce),L(oe,le,Ce),ie=!0,ae||(V=ee(_,"click",l[16]),ae=!0)},p(oe,Ce){oe[0].tags?se?(se.p(oe,Ce),Ce[0]&1&&Y(se,1)):(se=Wo(oe),se.c(),Y(se,1),se.m(c,null)):se&&(Ve(),X(se,1,1,()=>{se=null}),Qe());const Ue={};Ce[0]&1|Ce[1]&65536&&(Ue.$$scope={dirty:Ce,ctx:oe}),i.$set(Ue),(!ie||Ce[0]&1)&&b!==(b=oe[0].title+"")&&we(v,b);let Me=T;if(T=x(oe),T===Me?re[T].p(oe,Ce):(Ve(),X(re[Me],1,1,()=>{re[Me]=null}),Qe(),j=re[T],j?j.p(oe,Ce):(j=re[T]=ue[T](oe),j.c()),Y(j,1),j.m(h,null)),!oe[11]&&!oe[9]&&!oe[10]?he?he.p(oe,Ce):(he=Go(oe),he.c(),he.m(N,E)):he&&(he.d(1),he=null),oe[9]?me||(me=Bo(),me.c(),me.m(N,G)):me&&(me.d(1),me=null),oe[10]?te?te.p(oe,Ce):(te=Jo(oe),te.c(),te.m(N,B)):te&&(te.d(1),te=null),oe[11]&&oe[8]?de?(de.p(oe,Ce),Ce[0]&2304&&Y(de,1)):(de=Vo(oe),de.c(),Y(de,1),de.m(N,null)):de&&(Ve(),X(de,1,1,()=>{de=null}),Qe()),Ce[0]&32768){pe=oe[15];let Ae;for(Ae=0;Ae<pe.length;Ae+=1){const Ke=zo(oe,pe,Ae);fe[Ae]?fe[Ae].p(Ke,Ce):(fe[Ae]=Yo(Ke),fe[Ae].c(),fe[Ae].m(J,null))}for(;Ae<fe.length;Ae+=1)fe[Ae].d(1);fe.length=pe.length}oe[13]?Te?Te.p(oe,Ce):(Te=Zo(oe),Te.c(),Te.m(e,null)):Te&&(Te.d(1),Te=null);const ot={};Ce[0]&1&&(ot.item=oe[0]),!F&&Ce[0]&2&&(F=!0,ot.active=oe[1],rt(()=>F=!1)),U.$set(ot),oe[4]?Re?(Re.p(oe,Ce),Ce[0]&16&&Y(Re,1)):(Re=Xo(oe),Re.c(),Y(Re,1),Re.m(Z.parentNode,Z)):Re&&(Ve(),X(Re,1,1,()=>{Re=null}),Qe()),oe[14]?Le?(Le.p(oe,Ce),Ce[0]&16384&&Y(Le,1)):(Le=xo(oe),Le.c(),Y(Le,1),Le.m(le.parentNode,le)):Le&&(Ve(),X(Le,1,1,()=>{Le=null}),Qe())},i(oe){ie||(Y(se),Y(i.$$.fragment,oe),Y(j),Y(de),nt(()=>{ie&&(C||(C=sl(p,rl,{},!0)),C.run(1))}),nt(()=>{ie&&(I||(I=sl(W,rl,{},!0)),I.run(1))}),Y(U.$$.fragment,oe),Y(Re),Y(Le),ie=!0)},o(oe){X(se),X(i.$$.fragment,oe),X(j),X(de),C||(C=sl(p,rl,{},!1)),C.run(0),I||(I=sl(W,rl,{},!1)),I.run(0),X(U.$$.fragment,oe),X(Re),X(Le),ie=!1},d(oe){oe&&R(e),se&&se.d(),ke(i),re[T].d(),he&&he.d(),me&&me.d(),te&&te.d(),de&&de.d(),oe&&C&&C.end(),et(fe,oe),oe&&I&&I.end(),Te&&Te.d(),oe&&R(P),ke(U,oe),oe&&R(z),Re&&Re.d(oe),oe&&R(Z),Le&&Le.d(oe),oe&&R(le),ae=!1,V()}}}function $i(l,e,t){let o,n,c,r,u;De(l,Rt,V=>t(31,c=V)),De(l,xe,V=>t(32,r=V)),De(l,Lt,V=>t(33,u=V));let{document:i}=e,d=!1,p=!1,_=!1,m=null,b=null,v=null,$=!1,w=null,k=!1,y=null,h=!1,T=!1,j=!1,D=!1,N=null,E=!1,G=!1;function B(){const V=[];return V.push({id:"download-markdown",label:"Download to Markdown",icon:"fas fa-download",action:()=>W(),visible:!0,title:"Download document as markdown file"}),o&&V.push({id:"save-atomic",label:"Save to Atomic Server",icon:"fas fa-cloud-upload-alt",action:()=>C(),visible:!0,title:"Save article to Atomic Server",className:"has-text-primary"}),i.url&&V.push({id:"external-url",label:"Open URL",icon:"fas fa-link",action:()=>window.open(i.url,"_blank"),visible:!0,title:"Open original URL in new tab",isLink:!0,href:i.url}),V.push({id:"open-vscode",label:"Open in VSCode",icon:"fas fa-code",action:()=>J(),visible:!0,title:"Open document in VSCode",isLink:!0,href:`vscode://${encodeURIComponent(i.title)}.md?${encodeURIComponent(i.body)}`}),V.push({id:"add-context",label:D?"Added to Context ✓":j?"Adding...":"Add to Context",icon:D?"fas fa-check-circle":j?"fas fa-spinner fa-spin":"fas fa-plus-circle",action:()=>I(),visible:!0,title:D?"Document successfully added to chat context. Go to Chat tab to see it.":"Add document to LLM conversation context",disabled:j||D,className:D?"has-text-success":N?"has-text-danger":"",testId:"add-to-context-button"}),V.push({id:"chat-with-document",label:G?"Opening Chat...":E?"Adding to Chat...":"Chat with Document",icon:G?"fas fa-external-link-alt":E?"fas fa-spinner fa-spin":"fas fa-comment-dots",action:()=>Q(),visible:!0,title:G?"Opening chat with this document":"Add document to context and open chat",disabled:E||G||j,className:G?"has-text-info":N?"has-text-danger":"has-text-primary",testId:"chat-with-document-button"}),V}function M(){var x;const V=c,se=u;if(!(se!=null&&se.roles)||!V)return!1;let ue=null;try{for(const[he,me]of Object.entries(se.roles)){const te=me,de=typeof te.name=="object"?te.name.original:String(te.name);if(he===V||de===V){ue=te;break}}}catch(he){return console.warn("Error checking role configuration:",he),!1}return ue?(((x=ue.haystacks)==null?void 0:x.filter(he=>he.service==="Atomic"&&he.location&&!he.read_only))||[]).length>0:!1}const S=()=>{t(1,d=!0)},C=()=>{console.log("🔄 Opening atomic save modal for document:",i.title),t(3,_=!0)};async function O(V){var se,ue,re,x,he;t(7,$=!0),t(5,b=V),console.log("🔍 KG Search Debug Info:"),console.log("  Tag clicked:",V),console.log("  Current role:",c),console.log("  Is Tauri mode:",r);try{if(r){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:c,term:V});const me=await ze("find_documents_for_kg_term",{roleName:c,term:V});console.log("  📥 Tauri response received:"),console.log("    Status:",me.status),console.log("    Results count:",((se=me.results)==null?void 0:se.length)||0),console.log("    Total:",me.total||0),console.log("    Full response:",JSON.stringify(me,null,2)),me.status==="success"&&me.results&&me.results.length>0?(t(4,m=me.results[0]),t(6,v=m.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",m.title),console.log("    Rank:",v),console.log("    Body length:",((ue=m.body)==null?void 0:ue.length)||0,"characters"),t(2,p=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${V}" in role: "${c}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const me=Ye.ServerURL,te=encodeURIComponent(c),de=encodeURIComponent(V),pe=`${me}/roles/${te}/kg_search?term=${de}`;console.log("  📤 HTTP Request details:"),console.log("    Base URL:",me),console.log("    Role (encoded):",te),console.log("    Term (encoded):",de),console.log("    Full URL:",pe);const fe=await fetch(pe);if(console.log("  📥 HTTP Response received:"),console.log("    Status code:",fe.status),console.log("    Status text:",fe.statusText),console.log("    Headers:",Object.fromEntries(fe.headers.entries())),!fe.ok)throw new Error(`HTTP error! Status: ${fe.status} - ${fe.statusText}`);const Te=await fe.json();console.log("  📄 Response data:"),console.log("    Status:",Te.status),console.log("    Results count:",((re=Te.results)==null?void 0:re.length)||0),console.log("    Total:",Te.total||0),console.log("    Full response:",JSON.stringify(Te,null,2)),Te.status==="success"&&Te.results&&Te.results.length>0?(t(4,m=Te.results[0]),t(6,v=m.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",m.title),console.log("    Rank:",v),console.log("    Body length:",((x=m.body)==null?void 0:x.length)||0,"characters"),t(2,p=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${V}" in role: "${c}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",pe))}}catch(me){console.error("❌ Error fetching KG document:"),console.error("  Error type:",me.constructor.name),console.error("  Error message:",me.message||me),console.error("  Request details:",{tag:V,role:c,isTauri:r,timestamp:new Date().toISOString()}),!r&&((he=me.message)!=null&&he.includes("Failed to fetch"))&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{t(7,$=!1)}}async function A(){var V;if(!(k||!i.id||!c)){t(9,k=!0),t(10,y=null),console.log("🤖 AI Summary Debug Info:"),console.log("  Document ID:",i.id),console.log("  Current role:",c),console.log("  Is Tauri mode:",r);try{const se={document_id:i.id,role:c,max_length:250,force_regenerate:!1};console.log("  📤 Summarization request:",se);let ue;if(r){const he=`${Ye.ServerURL}/documents/summarize`;ue=await fetch(he,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(se)})}else{const he=`${Ye.ServerURL}/documents/summarize`;ue=await fetch(he,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(se)})}if(console.log("  📥 Summary response received:"),console.log("    Status code:",ue.status),console.log("    Status text:",ue.statusText),!ue.ok)throw new Error(`HTTP error! Status: ${ue.status} - ${ue.statusText}`);const re=await ue.json();console.log("  📄 Summary response data:",re),re.status==="success"&&re.summary?(t(8,w=re.summary),t(12,T=re.from_cache||!1),t(11,h=!0),console.log("  ✅ Summary generated successfully"),console.log("    Summary length:",w.length,"characters"),console.log("    From cache:",T),console.log("    Model used:",re.model_used)):(t(10,y=re.error||"Failed to generate summary"),console.error("  ❌ Summary generation failed:",y))}catch(se){console.error("❌ Error generating summary:"),console.error("  Error type:",se.constructor.name),console.error("  Error message:",se.message||se),console.error("  Request details:",{document_id:i.id,role:c,isTauri:r,timestamp:new Date().toISOString()}),t(10,y=se.message||"Network error occurred"),(V=se.message)!=null&&V.includes("Failed to fetch")&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Verify OpenRouter is enabled for this role"),console.error("    3. Check OPENROUTER_KEY environment variable"),console.error("    4. Verify server URL in CONFIG.ServerURL"))}finally{t(9,k=!1)}}}function W(){console.log("📥 Downloading document as markdown:",i.title);let V=`# ${i.title}

`;V+=`**Source:** Terraphim Search
`,V+=`**Rank:** ${i.rank||"N/A"}
`,i.url&&(V+=`**URL:** ${i.url}
`),i.tags&&i.tags.length>0&&(V+=`**Tags:** ${i.tags.join(", ")}
`),V+=`**Downloaded:** ${new Date().toISOString()}

`,i.description&&(V+=`## Description

${i.description}

`),V+=`## Content

${i.body}
`;const se=`${i.title.replace(/[^a-z0-9]/gi,"_").toLowerCase()}_${Date.now()}.md`,ue=new Blob([V],{type:"text/markdown"}),re=URL.createObjectURL(ue),x=window.document.createElement("a");x.href=re,x.download=se,window.document.body.appendChild(x),x.click(),window.document.body.removeChild(x),URL.revokeObjectURL(re),console.log("✅ Markdown file downloaded:",se)}function J(){const V=`vscode://${encodeURIComponent(i.title)}.md?${encodeURIComponent(i.body)}`;window.open(V,"_blank")}async function I(){console.log("📝 Adding document to LLM context:",i.title),j=!0,D=!1,t(13,N=null);try{let V=null;if(r){try{const x=await ze("list_conversations");if(console.log("📋 Available conversations:",x),x!=null&&x.conversations&&x.conversations.length>0)V=x.conversations[0].id,console.log("🎯 Using existing conversation:",V);else{const he=await ze("create_conversation",{title:"Search Context",role:c||"default"});if(he.status==="success"&&he.conversation_id)V=he.conversation_id,console.log("🆕 Created new conversation:",V);else throw new Error("Failed to create conversation: "+(he.error||"Unknown error"))}}catch(x){throw console.error("❌ Failed to manage conversations:",x),new Error("Could not create or find conversation: "+x.message)}const ue={source_type:"document",document_id:i.id};i.url&&(ue.url=i.url),i.tags&&i.tags.length>0&&(ue.tags=i.tags.join(", ")),i.rank!==void 0&&(ue.rank=i.rank.toString());const re=await ze("add_context_to_conversation",{conversationId:V,contextType:"document",title:i.title,content:i.body,metadata:ue});console.log("✅ Document added to context via Tauri:",re)}else{const ue=Ye.ServerURL;try{const me=await fetch(`${ue}/conversations`);if(me.ok){const te=await me.json();if(te.conversations&&te.conversations.length>0)V=te.conversations[0].id,console.log("🎯 Using existing conversation:",V);else{const de=await fetch(`${ue}/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"Search Context",role:c||"default"})});if(de.ok){const pe=await de.json();if(pe.status==="success"&&pe.conversation_id)V=pe.conversation_id,console.log("🆕 Created new conversation:",V);else throw new Error("Failed to create conversation: "+(pe.error||"Unknown error"))}else throw new Error(`Failed to create conversation: ${de.status} ${de.statusText}`)}}else throw new Error(`Failed to list conversations: ${me.status} ${me.statusText}`)}catch(me){throw console.error("❌ Failed to manage conversations:",me),new Error("Could not create or find conversation: "+me.message)}const re=`${ue}/conversations/${V}/context`,x=await fetch(re,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context_type:"document",title:i.title,content:i.body,metadata:{source_type:"document",document_id:i.id,url:i.url||"",tags:i.tags?i.tags.join(", "):"",rank:i.rank?i.rank.toString():"0"}})});if(!x.ok)throw new Error(`HTTP error! Status: ${x.status} - ${x.statusText}`);const he=await x.json();console.log("✅ Document added to context via HTTP:",he)}console.log("✅ Successfully added document to LLM context"),D=!0;const se=window.document.createElement("div");se.className="notification is-success is-light",se.innerHTML=`
        <button class="delete" onclick="this.parentElement.remove()"></button>
        <strong>✓ Added to Chat Context</strong><br>
        <small>Document added successfully. <a href="/chat" class="has-text-success has-text-weight-bold">Go to Chat →</a> to see it in the context panel.</small>
      `,se.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(se),setTimeout(()=>{se.remove()},8e3),setTimeout(()=>{D=!1},5e3)}catch(V){console.error("❌ Error adding document to context:",V),t(13,N=V.message||"Failed to add document to context");const se=window.document.createElement("div");se.className="notification is-danger is-light",se.innerHTML=`
        <button class="delete" onclick="this.parentElement.remove()"></button>
        <strong>✗ Failed to Add Context</strong><br>
        <small>${N}</small>
      `,se.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(se),setTimeout(()=>{se.remove()},8e3),setTimeout(()=>{t(13,N=null)},5e3)}finally{j=!1}}async function Q(){console.log("💬 Adding document to context and opening chat:",i.title),E=!0,G=!1,t(13,N=null);try{let V=null;if(r){try{const x=await ze("list_conversations");if(console.log("📋 Available conversations:",x),x!=null&&x.conversations&&x.conversations.length>0)V=x.conversations[0].id,console.log("🎯 Using existing conversation:",V);else{const he=await ze("create_conversation",{title:"Chat with Documents",role:c||"default"});if(he.status==="success"&&he.conversation_id)V=he.conversation_id,console.log("🆕 Created new conversation:",V);else throw new Error("Failed to create conversation: "+(he.error||"Unknown error"))}}catch(x){throw console.error("❌ Failed to manage conversations:",x),new Error("Could not create or find conversation: "+x.message)}const ue={source_type:"document",document_id:i.id};i.url&&(ue.url=i.url),i.tags&&i.tags.length>0&&(ue.tags=i.tags.join(", ")),i.rank!==void 0&&(ue.rank=i.rank.toString());const re=await ze("add_context_to_conversation",{conversationId:V,contextType:"document",title:i.title,content:i.body,metadata:ue});console.log("✅ Document added to context via Tauri:",re)}else{const ue=Ye.ServerURL;try{const me=await fetch(`${ue}/conversations`);if(me.ok){const te=await me.json();if(te.conversations&&te.conversations.length>0)V=te.conversations[0].id,console.log("🎯 Using existing conversation:",V);else{const de=await fetch(`${ue}/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"Chat with Documents",role:c||"default"})});if(de.ok){const pe=await de.json();if(pe.status==="success"&&pe.conversation_id)V=pe.conversation_id,console.log("🆕 Created new conversation:",V);else throw new Error("Failed to create conversation: "+(pe.error||"Unknown error"))}else throw new Error(`Failed to create conversation: ${de.status} ${de.statusText}`)}}else throw new Error(`Failed to list conversations: ${me.status} ${me.statusText}`)}catch(me){throw console.error("❌ Failed to manage conversations:",me),new Error("Could not create or find conversation: "+me.message)}const re=`${ue}/conversations/${V}/context`,x=await fetch(re,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context_type:"document",title:i.title,content:i.body,metadata:{source_type:"document",document_id:i.id,url:i.url||"",tags:i.tags?i.tags.join(", "):"",rank:i.rank?i.rank.toString():"0"}})});if(!x.ok)throw new Error(`HTTP error! Status: ${x.status} - ${x.statusText}`);const he=await x.json();console.log("✅ Document added to context via HTTP:",he)}console.log("✅ Successfully added document to chat context, navigating to chat..."),G=!0;const se=window.document.createElement("div");se.className="notification is-success is-light",se.innerHTML=`
        <strong>💬 Opening Chat with Document</strong><br>
        <small>Context added successfully. Redirecting to chat...</small>
      `,se.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(se),setTimeout(()=>{se.remove(),Es.goto("/chat")},1500),setTimeout(()=>{G=!1},2e3)}catch(V){console.error("❌ Error adding document to context and opening chat:",V),t(13,N=V.message||"Failed to add document to context");const se=window.document.createElement("div");se.className="notification is-danger is-light",se.innerHTML=`
        <button class="delete" onclick="this.parentElement.remove()"></button>
        <strong>✗ Failed to Open Chat with Document</strong><br>
        <small>${N}</small>
      `,se.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(se),setTimeout(()=>{se.remove()},8e3),setTimeout(()=>{t(13,N=null)},5e3)}finally{E=!1}}El[c]!==void 0&&(console.log("Have attribute",El[c]),El[c].hasOwnProperty("enableLogseq")?console.log("enable logseq True"):console.log("Didn't make it"));const P=V=>O(V),U=()=>{t(10,y=null),A()},F=()=>t(11,h=!1),z=()=>{A()},Z=()=>t(13,N=null);function le(V){d=V,t(1,d)}function ie(V){p=V,t(2,p)}function ae(V){_=V,t(3,_)}return l.$$set=V=>{"document"in V&&t(0,i=V.document)},t(14,o=M()),t(15,n=B()),[i,d,p,_,m,b,v,$,w,k,y,h,T,N,o,n,S,O,A,P,U,F,z,Z,le,ie,ae]}class Ci extends gt{constructor(e){super(),vt(this,e,$i,yi,ft,{document:0},null,[-1,-1])}}const Ti="/assets/terraphim_gray.png";function Si(l){const e=l.trim();if(!e)return{hasOperator:!1,operator:null,terms:[l],originalQuery:l};const t=/\b(and)\b/i,o=/\b(or)\b/i,n=t.test(e),c=o.test(e);if(n&&!c)return{hasOperator:!0,operator:"AND",terms:e.split(t).filter((u,i)=>i%2===0).map(u=>u.trim()).filter(u=>u.length>0),originalQuery:l};if(c&&!n)return{hasOperator:!0,operator:"OR",terms:e.split(o).filter((u,i)=>i%2===0).map(u=>u.trim()).filter(u=>u.length>0),originalQuery:l};if(n&&c){const r=e.toLowerCase().indexOf(" and "),u=e.toLowerCase().indexOf(" or ");if(r!==-1&&(u===-1||r<u))return{hasOperator:!0,operator:"AND",terms:e.split(t).filter((d,p)=>p%2===0).map(d=>d.trim()).filter(d=>d.length>0),originalQuery:l};if(u!==-1)return{hasOperator:!0,operator:"OR",terms:e.split(o).filter((d,p)=>p%2===0).map(d=>d.trim()).filter(d=>d.length>0),originalQuery:l}}return{hasOperator:!1,operator:null,terms:[e],originalQuery:l}}function en(l,e){var o,n;if(l.hasOperator&&l.terms.length>1){const c=l.terms.filter(r=>r.trim().length>0);if(c.length>1)return{search_term:c[0],search_terms:c,operator:(o=l.operator)==null?void 0:o.toLowerCase(),skip:0,limit:50,role:e||null}}return{search_term:((n=l.terms[0])==null?void 0:n.trim())||"",search_terms:void 0,operator:void 0,skip:0,limit:50,role:e||null}}function tn(l,e,t){const o=l.slice();return o[27]=e[t],o}function ln(l,e,t){const o=l.slice();return o[30]=e[t],o[32]=t,o}function on(l){let e,t=l[2],o=[];for(let n=0;n<t.length;n+=1)o[n]=nn(ln(l,t,n));return{c(){e=f("ul");for(let n=0;n<o.length;n+=1)o[n].c();a(e,"class","suggestions svelte-e76e8j")},m(n,c){L(n,e,c);for(let r=0;r<o.length;r+=1)o[r]&&o[r].m(e,null)},p(n,c){if(c[0]&1036){t=n[2];let r;for(r=0;r<t.length;r+=1){const u=ln(n,t,r);o[r]?o[r].p(u,c):(o[r]=nn(u),o[r].c(),o[r].m(e,null))}for(;r<o.length;r+=1)o[r].d(1);o.length=t.length}},d(n){n&&R(e),et(o,n)}}}function nn(l){let e,t=l[30]+"",o,n,c,r,u,i;function d(){return l[14](l[30])}function p(..._){return l[15](l[30],..._)}return{c(){e=f("li"),o=H(t),n=g(),a(e,"tabindex","0"),a(e,"role","option"),a(e,"aria-selected",c=l[32]===l[3]),a(e,"aria-label",r=`Apply suggestion: ${l[30]}`),a(e,"class","svelte-e76e8j"),ht(e,"active",l[32]===l[3])},m(_,m){L(_,e,m),s(e,o),s(e,n),u||(i=[ee(e,"click",d),ee(e,"keydown",p)],u=!0)},p(_,m){l=_,m[0]&4&&t!==(t=l[30]+"")&&we(o,t),m[0]&8&&c!==(c=l[32]===l[3])&&a(e,"aria-selected",c),m[0]&4&&r!==(r=`Apply suggestion: ${l[30]}`)&&a(e,"aria-label",r),m[0]&8&&ht(e,"active",l[32]===l[3])},d(_){_&&R(e),u=!1,Ze(i)}}}function Ri(l){let e,t,o,n,c,r,u,i,d,p,_,m,b,v,$,w,k,y,h,T,j,D,N;function E(M){l[13](M)}let G={type:"search",placeholder:l[7]?`Search over Knowledge graph for ${l[6]}`:"Search",icon:"search",expanded:!0,autofocus:!0};l[5]!==void 0&&(G.value=l[5]),o=new Vt({props:G}),lt.push(()=>st(o,"value",E)),o.$on("click",l[11]),o.$on("submit",l[11]),o.$on("keydown",l[9]),o.$on("input",l[8]);let B=l[2].length>0&&on(l);return j=ls(l[17][0]),{c(){e=f("div"),t=f("div"),ve(o.$$.fragment),c=g(),B&&B.c(),r=g(),u=f("div"),i=f("div"),d=f("label"),p=f("input"),_=H(`
            Exact`),m=g(),b=f("label"),v=f("input"),$=H(`
            All (AND)`),w=g(),k=f("label"),y=f("input"),h=H(`
            Any (OR)`),a(t,"class","input-wrapper svelte-e76e8j"),a(p,"type","radio"),p.__value="none",p.value=p.__value,a(p,"class","svelte-e76e8j"),a(d,"class","radio svelte-e76e8j"),a(v,"type","radio"),v.__value="and",v.value=v.__value,a(v,"class","svelte-e76e8j"),a(b,"class","radio svelte-e76e8j"),a(y,"type","radio"),y.__value="or",y.value=y.__value,a(y,"class","svelte-e76e8j"),a(k,"class","radio svelte-e76e8j"),a(i,"class","control svelte-e76e8j"),a(u,"class","operator-controls svelte-e76e8j"),a(e,"class","search-row svelte-e76e8j"),j.p(p,v,y)},m(M,S){L(M,e,S),s(e,t),be(o,t,null),s(t,c),B&&B.m(t,null),s(e,r),s(e,u),s(u,i),s(i,d),s(d,p),p.checked=p.__value===l[4],s(d,_),s(i,m),s(i,b),s(b,v),v.checked=v.__value===l[4],s(b,$),s(i,w),s(i,k),s(k,y),y.checked=y.__value===l[4],s(k,h),T=!0,D||(N=[ee(p,"change",l[16]),ee(v,"change",l[18]),ee(y,"change",l[19])],D=!0)},p(M,S){const C={};S[0]&192&&(C.placeholder=M[7]?`Search over Knowledge graph for ${M[6]}`:"Search"),!n&&S[0]&32&&(n=!0,C.value=M[5],rt(()=>n=!1)),o.$set(C),M[2].length>0?B?B.p(M,S):(B=on(M),B.c(),B.m(t,null)):B&&(B.d(1),B=null),S[0]&16&&(p.checked=p.__value===M[4]),S[0]&16&&(v.checked=v.__value===M[4]),S[0]&16&&(y.checked=y.__value===M[4])},i(M){T||(Y(o.$$.fragment,M),T=!0)},o(M){X(o.$$.fragment,M),T=!1},d(M){M&&R(e),ke(o),B&&B.d(),j.r(),D=!1,Ze(N)}}}function Li(l){let e,t,o,n,c,r,u,i,d,p;return{c(){e=f("section"),t=f("div"),o=f("img"),c=g(),r=f("p"),r.textContent="I am Terraphim, your personal assistant.",u=g(),i=f("button"),i.innerHTML=`<span class="icon"><i class="fas fa-magic"></i></span> 
        <span>Configuration Wizard</span>`,Ss(o.src,n=Ti)||a(o,"src",n),a(o,"alt","Terraphim Logo"),a(o,"class","svelte-e76e8j"),a(i,"class","button is-primary"),a(i,"data-testid","wizard-start"),a(t,"class","content has-text-grey has-text-centered svelte-e76e8j"),a(e,"class","section")},m(_,m){L(_,e,m),s(e,t),s(t,o),s(t,c),s(t,r),s(t,u),s(t,i),d||(p=ee(i,"click",l[20]),d=!0)},p:Ee,i:Ee,o:Ee,d(_){_&&R(e),d=!1,p()}}}function Ai(l){let e,t,o=l[0],n=[];for(let r=0;r<o.length;r+=1)n[r]=sn(tn(l,o,r));const c=r=>X(n[r],1,1,()=>{n[r]=null});return{c(){for(let r=0;r<n.length;r+=1)n[r].c();e=it()},m(r,u){for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(r,u);L(r,e,u),t=!0},p(r,u){if(u[0]&1){o=r[0];let i;for(i=0;i<o.length;i+=1){const d=tn(r,o,i);n[i]?(n[i].p(d,u),Y(n[i],1)):(n[i]=sn(d),n[i].c(),Y(n[i],1),n[i].m(e.parentNode,e))}for(Ve(),i=o.length;i<n.length;i+=1)c(i);Qe()}},i(r){if(!t){for(let u=0;u<o.length;u+=1)Y(n[u]);t=!0}},o(r){n=n.filter(Boolean);for(let u=0;u<n.length;u+=1)X(n[u]);t=!1},d(r){et(n,r),r&&R(e)}}}function Ei(l){let e,t;return{c(){e=f("p"),t=H(l[1]),a(e,"class","error svelte-e76e8j")},m(o,n){L(o,e,n),s(e,t)},p(o,n){n[0]&2&&we(t,o[1])},i:Ee,o:Ee,d(o){o&&R(e)}}}function sn(l){let e,t;return e=new Ci({props:{document:l[27]}}),{c(){ve(e.$$.fragment)},m(o,n){be(e,o,n),t=!0},p(o,n){const c={};n[0]&1&&(c.document=o[27]),e.$set(c)},i(o){t||(Y(e.$$.fragment,o),t=!0)},o(o){X(e.$$.fragment,o),t=!1},d(o){ke(e,o)}}}function Pi(l){let e,t,o,n,c,r,u,i,d,p,_;e=new il({props:{fallbackPath:"/"}}),n=new Ft({props:{$$slots:{default:[Ri]},$$scope:{ctx:l}}});const m=[Ei,Ai,Li],b=[];function v($,w){return $[1]?0:$[0].length?1:2}return r=v(l),u=b[r]=m[r](l),{c(){ve(e.$$.fragment),t=g(),o=f("form"),ve(n.$$.fragment),c=g(),u.c(),i=it()},m($,w){be(e,$,w),L($,t,w),L($,o,w),be(n,o,null),L($,c,w),b[r].m($,w),L($,i,w),d=!0,p||(_=ee(o,"submit",Ts(l[11])),p=!0)},p($,w){const k={};w[0]&252|w[1]&4&&(k.$$scope={dirty:w,ctx:$}),n.$set(k);let y=r;r=v($),r===y?b[r].p($,w):(Ve(),X(b[y],1,1,()=>{b[y]=null}),Qe(),u=b[r],u?u.p($,w):(u=b[r]=m[r]($),u.c()),Y(u,1),u.m(i.parentNode,i))},i($){d||(Y(e.$$.fragment,$),Y(n.$$.fragment,$),Y(u),d=!0)},o($){X(e.$$.fragment,$),X(n.$$.fragment,$),X(u),d=!1},d($){ke(e,$),$&&R(t),$&&R(o),ke(n),$&&R(c),b[r].d($),$&&R(i),p=!1,_()}}}function Ni(l,e,t){let o,n,c,r,u,i,d;De(l,Xs,O=>t(22,n=O)),De(l,Al,O=>t(5,c=O)),De(l,xe,O=>t(23,r=O)),De(l,Rt,O=>t(6,u=O)),De(l,dl,O=>t(12,i=O)),De(l,$t,O=>t(7,d=O));let p=[],_=null,m=[],b=-1,v="none";async function $(O){try{if(r){const A=await ze("get_autocomplete_suggestions",{query:O,roleName:u,limit:8});if(A.status==="success"&&A.suggestions)return A.suggestions.map(W=>W.term)}else{const A=await fetch(`${n.replace("/documents/search","")}/autocomplete/${encodeURIComponent(u)}/${encodeURIComponent(O)}`);if(A.ok){const W=await A.json();if(W.status==="success"&&W.suggestions)return W.suggestions.map(J=>J.term)}}return o.filter(([A])=>A.toLowerCase().includes(O.toLowerCase())).map(([A])=>A).slice(0,8)}catch(A){return console.warn("Error fetching term suggestions:",A),[]}}async function w(O){const A=O.trim();if(A.length===0)return[];if(v!=="none"){const P=A.split(/\s+/),U=P[P.length-1].toLowerCase();return U.length<2?[]:$(U)}const J=A.split(/\s+/),I=J[J.length-1].toLowerCase();if(J.length>1&&v==="none"){const P=[];if("and".startsWith(I)&&P.push("AND"),"or".startsWith(I)&&P.push("OR"),P.length>0)return P}const Q=A.toLowerCase();if(Q.includes(" and ")||Q.includes(" or ")){const P=I;return P.length<2?[]:$(P)}try{const P=await $(A);return J.length===1&&J[0].length>2&&v==="none"?[...P.slice(0,6),"AND","OR"]:P}catch(P){console.warn("Error fetching autocomplete suggestions:",P);const U=o.filter(([F])=>F.toLowerCase().includes(A.toLowerCase())).map(([F])=>F).slice(0,6);return J.length===1&&J[0].length>2&&v==="none"?[...U,"AND","OR"]:U}}async function k(O){const A=O.target;if(!A||A.selectionStart==null)return;const W=A.selectionStart,I=c.slice(0,W).split(/\s+/),Q=I[I.length-1];if(Q.length>=2)try{t(2,m=await w(Q))}catch(P){console.warn("Failed to get suggestions:",P),t(2,m=[])}else t(2,m=[]);t(3,b=-1)}function y(O){m.length!==0&&(O.key==="ArrowDown"?(O.preventDefault(),t(3,b=(b+1)%m.length)):O.key==="ArrowUp"?(O.preventDefault(),t(3,b=(b-1+m.length)%m.length)):(O.key==="Enter"||O.key==="Tab")&&b!==-1&&(O.preventDefault(),h(m[b])))}function h(O){var P,U;const A=document.querySelector('input[type="search"]'),W=(A==null?void 0:A.selectionStart)??0,J=c.slice(0,W),I=c.slice(W),Q=J.split(/\s+/);if(O==="AND"||O==="OR"){Q[Q.length-1]=O,pl(Al,c=[...Q,"",I].join(" "),c);const F=W+O.length+1;(P=A==null?void 0:A.setSelectionRange)==null||P.call(A,F,F)}else{Q[Q.length-1]=O,pl(Al,c=[...Q,I].join(" "),c);const F=W+O.length;(U=A==null?void 0:A.setSelectionRange)==null||U.call(A,F,F)}t(2,m=[]),t(3,b=-1)}function T(){const O=c.trim();if(!O)return null;if(v!=="none"){const J=O.split(/\s+/).filter(I=>I.length>0);return J.length>1?{...en({hasOperator:!0,operator:v==="and"?"AND":"OR",terms:J,originalQuery:O},u),skip:0,limit:10}:{search_term:O,skip:0,limit:10,role:u}}const A=Si(O);return{...en(A,u),skip:0,limit:10}}async function j(){if(t(1,_=null),r){if(!c.trim())return;try{const O=T();if(!O)return;const A=await ze("search",{searchQuery:O});A.status==="success"?(t(0,p=A.results),console.log("Response results"),console.log(p)):(t(1,_=`Search failed: ${A.status}`),console.error("Search failed:",A))}catch(O){t(1,_=`Error in Tauri search: ${O}`),console.error("Error in Tauri search:",O)}}else{if(!c.trim())return;const O=T();if(!O)return;const A=JSON.stringify(O);try{const W=await fetch(n,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:A}),J=await W.json();if(!W.ok)throw new Error(`HTTP error! Status: ${W.status}`);t(0,p=J.results)}catch(W){console.error("Error fetching data:",W),t(1,_=`Error fetching data: ${W}`)}}}const D=[[]];function N(O){c=O,Al.set(c)}const E=O=>h(O),G=(O,A)=>{(A.key==="Enter"||A.key===" ")&&(A.preventDefault(),h(O))};function B(){v=this.__value,t(4,v)}function M(){v=this.__value,t(4,v)}function S(){v=this.__value,t(4,v)}const C=()=>window.location.href="/config/wizard";return l.$$.update=()=>{l.$$.dirty[0]&4096&&(o=Object.entries(i))},[p,_,m,b,v,c,u,d,k,y,h,j,i,N,E,G,B,D,M,S,C]}class Oi extends gt{constructor(e){super(),vt(this,e,Ni,Pi,ft,{},null,[-1,-1])}}async function rn(l={}){return typeof l=="object"&&Object.freeze(l),Wl({__tauriModule:"Dialog",message:{cmd:"openDialog",options:l}})}function an(l,e,t){const o=l.slice();return o[71]=e[t],o[79]=t,o}function cn(l,e,t){const o=l.slice();return o[77]=e[t],o[78]=e,o[79]=t,o}function un(l,e,t){const o=l.slice();return o[80]=e[t],o}function fn(l,e,t){const o=l.slice();return o[80]=e[t],o}function dn(l,e,t){const o=l.slice();return o[85]=e[t],o[86]=e,o[87]=t,o}function pn(l,e,t){const o=l.slice();return o[88]=e[t][0],o[89]=e[t][1],o[90]=e,o[91]=t,o}function mn(l,e,t){const o=l.slice();return o[74]=e[t],o}function _n(l,e,t){const o=l.slice();return o[71]=e[t],o}function hn(l,e,t){const o=l.slice();return o[74]=e[t],o}function gn(l){let e,t,o,n,c;return{c(){e=f("div"),t=f("button"),o=H(`
      Configuration saved successfully!`),a(t,"class","delete"),a(e,"class","notification is-success"),a(e,"data-testid","wizard-success")},m(r,u){L(r,e,u),s(e,t),s(e,o),n||(c=ee(t,"click",l[20]),n=!0)},p:Ee,d(r){r&&R(e),n=!1,c()}}}function vn(l){let e,t,o,n,c;return{c(){e=f("div"),t=f("button"),o=H(`
      Failed to save configuration. Please try again.`),a(t,"class","delete"),a(e,"class","notification is-danger"),a(e,"data-testid","wizard-error")},m(r,u){L(r,e,u),s(e,t),s(e,o),n||(c=ee(t,"click",l[21]),n=!0)},p:Ee,d(r){r&&R(e),n=!1,c()}}}function Di(l){let e,t,o,n,c,r,u,i,d,p=l[3].id+"",_,m,b,v,$,w=l[3].global_shortcut+"",k,y,h,T,j,D=l[3].default_theme+"",N,E,G,B,M,S=l[3].default_role+"",C,O,A,W,J,I,Q=JSON.stringify(l[3],null,2)+"",P,U=l[3].roles,F=[];for(let z=0;z<U.length;z+=1)F[z]=bn(an(l,U,z));return{c(){e=f("h4"),e.textContent="Review",t=g(),o=f("div"),n=f("h5"),n.textContent="Configuration Summary:",c=g(),r=f("ul"),u=f("li"),i=f("strong"),i.textContent="Configuration ID:",d=g(),_=H(p),m=g(),b=f("li"),v=f("strong"),v.textContent="Global Shortcut:",$=g(),k=H(w),y=g(),h=f("li"),T=f("strong"),T.textContent="Default Theme:",j=g(),N=H(D),E=g(),G=f("li"),B=f("strong"),B.textContent="Default Role:",M=g(),C=H(S),O=g(),A=f("h5"),A.textContent="Roles:",W=g();for(let z=0;z<F.length;z+=1)F[z].c();J=g(),I=f("pre"),P=H(Q),a(e,"class","title is-5"),a(o,"class","content"),_e(I,"max-height","300px"),_e(I,"overflow","auto")},m(z,Z){L(z,e,Z),L(z,t,Z),L(z,o,Z),s(o,n),s(o,c),s(o,r),s(r,u),s(u,i),s(u,d),s(u,_),s(r,m),s(r,b),s(b,v),s(b,$),s(b,k),s(r,y),s(r,h),s(h,T),s(h,j),s(h,N),s(r,E),s(r,G),s(G,B),s(G,M),s(G,C),s(o,O),s(o,A),s(o,W);for(let le=0;le<F.length;le+=1)F[le]&&F[le].m(o,null);L(z,J,Z),L(z,I,Z),s(I,P)},p(z,Z){if(Z[0]&8&&p!==(p=z[3].id+"")&&we(_,p),Z[0]&8&&w!==(w=z[3].global_shortcut+"")&&we(k,w),Z[0]&8&&D!==(D=z[3].default_theme+"")&&we(N,D),Z[0]&8&&S!==(S=z[3].default_role+"")&&we(C,S),Z[0]&10){U=z[3].roles;let le;for(le=0;le<U.length;le+=1){const ie=an(z,U,le);F[le]?F[le].p(ie,Z):(F[le]=bn(ie),F[le].c(),F[le].m(o,null))}for(;le<F.length;le+=1)F[le].d(1);F.length=U.length}Z[0]&8&&Q!==(Q=JSON.stringify(z[3],null,2)+"")&&we(P,Q)},d(z){z&&R(e),z&&R(t),z&&R(o),et(F,z),z&&R(J),z&&R(I)}}}function Ii(l){let e,t,o=[],n=new Map,c,r,u,i,d=l[3].roles;const p=_=>_[77].name;for(let _=0;_<d.length;_+=1){let m=cn(l,d,_),b=p(m);n.set(b,o[_]=Dn(b,m))}return{c(){e=f("h4"),e.textContent="Roles",t=g();for(let _=0;_<o.length;_+=1)o[_].c();c=g(),r=f("button"),r.textContent="Add Role",a(e,"class","title is-5"),a(r,"class","button is-link is-light"),a(r,"data-testid","add-role")},m(_,m){L(_,e,m),L(_,t,m);for(let b=0;b<o.length;b+=1)o[b]&&o[b].m(_,m);L(_,c,m),L(_,r,m),u||(i=ee(r,"click",l[12]),u=!0)},p(_,m){m[0]&516985&&(d=_[3].roles,o=Rs(o,m,p,1,_,d,n,c.parentNode,Ls,Dn,c,cn))},d(_){_&&R(e),_&&R(t);for(let m=0;m<o.length;m+=1)o[m].d(_);_&&R(c),_&&R(r),u=!1,i()}}}function Ui(l){let e,t,o,n,c,r,u,i,d,p,_,m,b,v,$,w,k,y,h,T,j,D,N,E,G,B,M,S,C,O,A,W=l[8],J=[];for(let P=0;P<W.length;P+=1)J[P]=In(hn(l,W,P));let I=l[3].roles,Q=[];for(let P=0;P<I.length;P+=1)Q[P]=Un(_n(l,I,P));return{c(){e=f("div"),t=f("label"),t.textContent="Configuration ID",o=g(),n=f("div"),c=f("div"),r=f("select"),u=f("option"),u.textContent="Desktop",i=f("option"),i.textContent="Server",d=f("option"),d.textContent="Embedded",p=g(),_=f("div"),m=f("label"),m.textContent="Global shortcut",b=g(),v=f("div"),$=f("input"),w=g(),k=f("div"),y=f("label"),y.textContent="Default theme",h=g(),T=f("div"),j=f("div"),D=f("select");for(let P=0;P<J.length;P+=1)J[P].c();N=g(),E=f("div"),G=f("label"),G.textContent="Default Role",B=g(),M=f("div"),S=f("div"),C=f("select");for(let P=0;P<Q.length;P+=1)Q[P].c();a(t,"class","label"),a(t,"for","config-id"),u.__value="Desktop",u.value=u.__value,i.__value="Server",i.value=i.__value,d.__value="Embedded",d.value=d.__value,a(r,"id","config-id"),l[3].id===void 0&&nt(()=>l[22].call(r)),a(c,"class","select"),a(n,"class","control"),a(e,"class","field"),a(m,"class","label"),a(m,"for","global-shortcut"),a($,"class","input"),a($,"id","global-shortcut"),a($,"type","text"),a(v,"class","control"),a(_,"class","field"),a(y,"class","label"),a(y,"for","default-theme"),a(D,"id","default-theme"),l[3].default_theme===void 0&&nt(()=>l[24].call(D)),a(j,"class","select is-fullwidth"),a(T,"class","control"),a(k,"class","field"),a(G,"class","label"),a(G,"for","default-role"),a(C,"id","default-role"),l[3].default_role===void 0&&nt(()=>l[25].call(C)),a(S,"class","select"),a(M,"class","control"),a(E,"class","field")},m(P,U){L(P,e,U),s(e,t),s(e,o),s(e,n),s(n,c),s(c,r),s(r,u),s(r,i),s(r,d),We(r,l[3].id,!0),L(P,p,U),L(P,_,U),s(_,m),s(_,b),s(_,v),s(v,$),Ne($,l[3].global_shortcut),L(P,w,U),L(P,k,U),s(k,y),s(k,h),s(k,T),s(T,j),s(j,D);for(let F=0;F<J.length;F+=1)J[F]&&J[F].m(D,null);We(D,l[3].default_theme,!0),L(P,N,U),L(P,E,U),s(E,G),s(E,B),s(E,M),s(M,S),s(S,C);for(let F=0;F<Q.length;F+=1)Q[F]&&Q[F].m(C,null);We(C,l[3].default_role,!0),O||(A=[ee(r,"change",l[22]),ee($,"input",l[23]),ee(D,"change",l[24]),ee(C,"change",l[25])],O=!0)},p(P,U){if(U[0]&264&&We(r,P[3].id),U[0]&264&&$.value!==P[3].global_shortcut&&Ne($,P[3].global_shortcut),U[0]&256){W=P[8];let F;for(F=0;F<W.length;F+=1){const z=hn(P,W,F);J[F]?J[F].p(z,U):(J[F]=In(z),J[F].c(),J[F].m(D,null))}for(;F<J.length;F+=1)J[F].d(1);J.length=W.length}if(U[0]&264&&We(D,P[3].default_theme),U[0]&8){I=P[3].roles;let F;for(F=0;F<I.length;F+=1){const z=_n(P,I,F);Q[F]?Q[F].p(z,U):(Q[F]=Un(z),Q[F].c(),Q[F].m(C,null))}for(;F<Q.length;F+=1)Q[F].d(1);Q.length=I.length}U[0]&264&&We(C,P[3].default_role)},d(P){P&&R(e),P&&R(p),P&&R(_),P&&R(w),P&&R(k),et(J,P),P&&R(N),P&&R(E),et(Q,P),O=!1,Ze(A)}}}function bn(l){let e,t,o=l[71].name+"",n,c,r,u,i,d=l[71].shortname+"",p,_,m,b,v,$=l[71].theme+"",w,k,y,h,T,j=l[71].relevance_function+"",D,N,E,G,B,M;return{c(){e=f("div"),t=f("h6"),n=H(o),c=g(),r=f("p"),u=f("strong"),u.textContent="Shortname:",i=g(),p=H(d),_=g(),m=f("p"),b=f("strong"),b.textContent="Theme:",v=g(),w=H($),k=g(),y=f("p"),h=f("strong"),h.textContent="Relevance Function:",T=g(),D=H(j),N=g(),E=f("button"),E.textContent="Edit Role",G=g(),a(t,"data-testid","review-role-name-"+l[79]),a(E,"class","button is-small"),a(E,"data-testid","edit-role-"+l[79]),a(e,"class","box")},m(S,C){L(S,e,C),s(e,t),s(t,n),s(e,c),s(e,r),s(r,u),s(r,i),s(r,p),s(e,_),s(e,m),s(m,b),s(m,v),s(m,w),s(e,k),s(e,y),s(y,h),s(y,T),s(y,D),s(e,N),s(e,E),s(e,G),B||(M=ee(E,"click",l[68]),B=!0)},p(S,C){C[0]&8&&o!==(o=S[71].name+"")&&we(n,o),C[0]&8&&d!==(d=S[71].shortname+"")&&we(p,d),C[0]&8&&$!==($=S[71].theme+"")&&we(w,$),C[0]&8&&j!==(j=S[71].relevance_function+"")&&we(D,j)},d(S){S&&R(e),B=!1,M()}}}function kn(l){let e,t=l[74]+"",o;return{c(){e=f("option"),o=H(t),e.__value=l[74],e.value=e.__value},m(n,c){L(n,e,c),s(e,o)},p:Ee,d(n){n&&R(e)}}}function Mi(l){let e;return{c(){e=H("Directory Path")},m(t,o){L(t,e,o)},d(t){t&&R(e)}}}function ji(l){let e;return{c(){e=H("Server URL")},m(t,o){L(t,e,o)},d(t){t&&R(e)}}}function wn(l){let e;return{c(){e=f("p"),e.textContent="Click to select directory",a(e,"class","help")},m(t,o){L(t,e,o)},d(t){t&&R(e)}}}function yn(l){let e,t,o,n,c,r,u,i,d,p,_,m;function b(){l[34].call(u,l[79],l[87])}return{c(){e=f("div"),t=f("label"),o=H("Atomic Server Secret"),c=g(),r=f("div"),u=f("input"),d=g(),p=f("p"),p.textContent="Leave empty for anonymous access",a(t,"class","label"),a(t,"for",n=`haystack-secret-${l[79]}-${l[87]}`),a(u,"class","input"),a(u,"id",i=`haystack-secret-${l[79]}-${l[87]}`),a(u,"type","password"),a(u,"placeholder","Base64 encoded secret (optional)"),a(r,"class","control"),a(p,"class","help"),a(e,"class","field")},m(v,$){L(v,e,$),s(e,t),s(t,o),s(e,c),s(e,r),s(r,u),Ne(u,l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret),s(e,d),s(e,p),_||(m=ee(u,"input",b),_=!0)},p(v,$){l=v,$[0]&264&&n!==(n=`haystack-secret-${l[79]}-${l[87]}`)&&a(t,"for",n),$[0]&264&&i!==(i=`haystack-secret-${l[79]}-${l[87]}`)&&a(u,"id",i),$[0]&264&&u.value!==l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret&&Ne(u,l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret)},d(v){v&&R(e),_=!1,m()}}}function $n(l){let e,t,o,n,c,r,u,i,d,p,_,m,b,v,$,w,k,y,h,T,j,D,N,E,G,B,M,S,C,O,A,W,J,I,Q,P,U,F,z,Z,le,ie,ae;function V(){l[35].call(p,l[79],l[87])}function se(...te){return l[36](l[79],l[87],...te)}let ue=Object.entries(l[3].roles[l[79]].haystacks[l[87]].extra_parameters||{}),re=[];for(let te=0;te<ue.length;te+=1)re[te]=Cn(pn(l,ue,te));function x(){return l[40](l[79],l[87])}function he(){return l[41](l[79],l[87])}function me(){return l[42](l[79],l[87])}return{c(){e=f("div"),t=f("label"),t.textContent="Extra Parameters (for filtering)",o=g(),n=f("div"),c=f("div"),r=f("label"),u=H("Hashtag"),d=g(),p=f("input"),m=g(),b=f("div"),v=f("div"),$=f("label"),w=H("Presets"),y=g(),h=f("div"),T=f("select"),j=f("option"),j.textContent="(choose)",D=f("option"),D.textContent="#rust",N=f("option"),N.textContent="#docs",E=f("option"),E.textContent="#test",G=f("option"),G.textContent="#todo",M=g(),S=f("p"),S.innerHTML="When set, searches will enforce the hashtag alongside your query (AND), e.g. <code>-e &quot;search&quot; -e &quot;#rust&quot;</code>.",C=g();for(let te=0;te<re.length;te+=1)re[te].c();O=g(),A=f("div"),W=f("div"),J=f("button"),J.textContent="+ Tag Filter",I=g(),Q=f("div"),P=f("button"),P.textContent="+ Max Results",U=g(),F=f("div"),z=f("button"),z.textContent="+ Custom Parameter",Z=g(),le=f("p"),le.innerHTML=`Common parameters: <code>tag</code> (e.g., &quot;#rust&quot;), <code>glob</code> (e.g., &quot;*.md&quot;),
                  <code>max_count</code> (e.g., &quot;10&quot;), <code>context</code> (e.g., &quot;5&quot;)`,a(t,"class","label"),a(r,"class","label"),a(r,"for",i=`ripgrep-hashtag-${l[79]}-${l[87]}`),a(p,"class","input"),a(p,"id",_=`ripgrep-hashtag-${l[79]}-${l[87]}`),a(p,"type","text"),a(p,"placeholder","#rust"),a(c,"class","control"),a(n,"class","field is-grouped"),a($,"class","label"),a($,"for",k=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`),j.__value="",j.value=j.__value,D.__value="#rust",D.value=D.__value,N.__value="#docs",N.value=N.__value,E.__value="#test",E.value=E.__value,G.__value="#todo",G.value=G.__value,a(T,"id",B=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`),a(h,"class","select is-small"),a(v,"class","control"),a(b,"class","field is-grouped"),_e(b,"margin-bottom",".5rem"),a(S,"class","help"),a(J,"class","button is-small is-link is-light"),a(W,"class","control"),a(P,"class","button is-small is-link is-light"),a(Q,"class","control"),a(z,"class","button is-small is-link is-light"),a(F,"class","control"),a(A,"class","field is-grouped"),a(le,"class","help"),a(e,"class","field")},m(te,de){L(te,e,de),s(e,t),s(e,o),s(e,n),s(n,c),s(c,r),s(r,u),s(c,d),s(c,p),Ne(p,l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag),s(e,m),s(e,b),s(b,v),s(v,$),s($,w),s(v,y),s(v,h),s(h,T),s(T,j),s(T,D),s(T,N),s(T,E),s(T,G),s(e,M),s(e,S),s(e,C);for(let pe=0;pe<re.length;pe+=1)re[pe]&&re[pe].m(e,null);s(e,O),s(e,A),s(A,W),s(W,J),s(A,I),s(A,Q),s(Q,P),s(A,U),s(A,F),s(F,z),s(e,Z),s(e,le),ie||(ae=[ee(p,"input",V),ee(T,"change",se),ee(J,"click",x),ee(P,"click",he),ee(z,"click",me)],ie=!0)},p(te,de){if(l=te,de[0]&264&&i!==(i=`ripgrep-hashtag-${l[79]}-${l[87]}`)&&a(r,"for",i),de[0]&264&&_!==(_=`ripgrep-hashtag-${l[79]}-${l[87]}`)&&a(p,"id",_),de[0]&264&&p.value!==l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag&&Ne(p,l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag),de[0]&264&&k!==(k=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`)&&a($,"for",k),de[0]&264&&B!==(B=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`)&&a(T,"id",B),de[0]&393224){ue=Object.entries(l[3].roles[l[79]].haystacks[l[87]].extra_parameters||{});let pe;for(pe=0;pe<ue.length;pe+=1){const fe=pn(l,ue,pe);re[pe]?re[pe].p(fe,de):(re[pe]=Cn(fe),re[pe].c(),re[pe].m(e,O))}for(;pe<re.length;pe+=1)re[pe].d(1);re.length=ue.length}},d(te){te&&R(e),et(re,te),ie=!1,Ze(ae)}}}function Cn(l){let e,t,o,n,c,r,u,i,d,p,_,m,b;function v(...k){return l[37](l[79],l[87],l[88],...k)}function $(){l[38].call(u,l[79],l[87],l[88])}function w(){return l[39](l[79],l[87],l[88])}return{c(){e=f("div"),t=f("div"),o=f("input"),c=g(),r=f("div"),u=f("input"),i=g(),d=f("div"),p=f("button"),p.textContent="×",_=g(),a(o,"class","input"),a(o,"type","text"),a(o,"placeholder","Parameter name"),o.value=n=l[88],a(t,"class","control"),a(u,"class","input"),a(u,"type","text"),a(u,"placeholder","Parameter value"),a(r,"class","control is-expanded"),a(p,"class","button is-small is-danger"),a(d,"class","control"),a(e,"class","field is-grouped")},m(k,y){L(k,e,y),s(e,t),s(t,o),s(e,c),s(e,r),s(r,u),Ne(u,l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]]),s(e,i),s(e,d),s(d,p),s(e,_),m||(b=[ee(o,"blur",v),ee(u,"input",$),ee(p,"click",w)],m=!0)},p(k,y){l=k,y[0]&264&&n!==(n=l[88])&&o.value!==n&&(o.value=n),y[0]&264&&u.value!==l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]]&&Ne(u,l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]])},d(k){k&&R(e),m=!1,Ze(b)}}}function Tn(l){let e,t,o,n,c,r,u,i,d,p,_,m,b,v,$,w,k,y,h,T,j,D,N,E,G,B,M,S,C,O,A,W,J,I,Q,P,U,F,z;function Z(){l[31].call(d,l[79],l[87])}function le(te,de){return te[3].roles[te[79]].haystacks[te[87]].service==="Atomic"?ji:Mi}let ie=le(l),ae=ie(l);function V(){l[32].call(h,l[79],l[87])}function se(){return l[33](l[79],l[87])}let ue=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"&&wn(),re=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"&&yn(l),x=l[3].roles[l[79]].haystacks[l[87]].service==="Ripgrep"&&$n(l);function he(){l[43].call(C,l[79],l[87])}function me(){return l[44](l[79],l[87])}return{c(){e=f("div"),t=f("div"),o=f("label"),n=H("Service Type"),r=g(),u=f("div"),i=f("div"),d=f("select"),p=f("option"),p.textContent="Ripgrep (File Search)",_=f("option"),_.textContent="Atomic Server",b=g(),v=f("div"),$=f("label"),ae.c(),k=g(),y=f("div"),h=f("input"),N=g(),ue&&ue.c(),E=g(),re&&re.c(),G=g(),x&&x.c(),B=g(),M=f("div"),S=f("label"),C=f("input"),A=H(`
                 Read-only`),J=g(),I=f("div"),Q=f("button"),P=H("Remove Haystack"),a(o,"class","label"),a(o,"for",c=`haystack-service-${l[79]}-${l[87]}`),p.__value="Ripgrep",p.value=p.__value,_.__value="Atomic",_.value=_.__value,a(d,"id",m=`haystack-service-${l[79]}-${l[87]}`),l[3].roles[l[79]].haystacks[l[87]].service===void 0&&nt(Z),a(i,"class","select"),a(u,"class","control"),a(t,"class","field"),a($,"class","label"),a($,"for",w=`haystack-path-${l[79]}-${l[87]}`),a(h,"class","input"),a(h,"id",T=`haystack-path-${l[79]}-${l[87]}`),a(h,"type","text"),a(h,"placeholder",j=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?"https://localhost:9883":"/path/to/documents"),h.readOnly=D=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic",a(y,"class","control"),a(v,"class","field"),a(C,"id",O=`haystack-readonly-${l[79]}-${l[87]}`),a(C,"type","checkbox"),a(S,"class","checkbox"),a(S,"for",W=`haystack-readonly-${l[79]}-${l[87]}`),a(M,"class","field"),a(Q,"class","button is-small is-danger"),a(Q,"data-testid",U="remove-haystack-"+l[79]+"-"+l[87]),a(I,"class","field"),a(e,"class","box is-light")},m(te,de){L(te,e,de),s(e,t),s(t,o),s(o,n),s(t,r),s(t,u),s(u,i),s(i,d),s(d,p),s(d,_),We(d,l[3].roles[l[79]].haystacks[l[87]].service,!0),s(e,b),s(e,v),s(v,$),ae.m($,null),s(v,k),s(v,y),s(y,h),Ne(h,l[3].roles[l[79]].haystacks[l[87]].path),s(y,N),ue&&ue.m(y,null),s(e,E),re&&re.m(e,null),s(e,G),x&&x.m(e,null),s(e,B),s(e,M),s(M,S),s(S,C),C.checked=l[3].roles[l[79]].haystacks[l[87]].read_only,s(S,A),s(e,J),s(e,I),s(I,Q),s(Q,P),F||(z=[ee(d,"change",Z),ee(h,"input",V),ee(h,"click",function(){zl(l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?se:void 0)&&(l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?se:void 0).apply(this,arguments)}),ee(C,"change",he),ee(Q,"click",me)],F=!0)},p(te,de){l=te,de[0]&264&&c!==(c=`haystack-service-${l[79]}-${l[87]}`)&&a(o,"for",c),de[0]&264&&m!==(m=`haystack-service-${l[79]}-${l[87]}`)&&a(d,"id",m),de[0]&264&&We(d,l[3].roles[l[79]].haystacks[l[87]].service),ie!==(ie=le(l))&&(ae.d(1),ae=ie(l),ae&&(ae.c(),ae.m($,null))),de[0]&264&&w!==(w=`haystack-path-${l[79]}-${l[87]}`)&&a($,"for",w),de[0]&264&&T!==(T=`haystack-path-${l[79]}-${l[87]}`)&&a(h,"id",T),de[0]&264&&j!==(j=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?"https://localhost:9883":"/path/to/documents")&&a(h,"placeholder",j),de[0]&280&&D!==(D=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic")&&(h.readOnly=D),de[0]&264&&h.value!==l[3].roles[l[79]].haystacks[l[87]].path&&Ne(h,l[3].roles[l[79]].haystacks[l[87]].path),l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?ue||(ue=wn(),ue.c(),ue.m(y,null)):ue&&(ue.d(1),ue=null),l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?re?re.p(l,de):(re=yn(l),re.c(),re.m(e,G)):re&&(re.d(1),re=null),l[3].roles[l[79]].haystacks[l[87]].service==="Ripgrep"?x?x.p(l,de):(x=$n(l),x.c(),x.m(e,B)):x&&(x.d(1),x=null),de[0]&264&&O!==(O=`haystack-readonly-${l[79]}-${l[87]}`)&&a(C,"id",O),de[0]&264&&(C.checked=l[3].roles[l[79]].haystacks[l[87]].read_only),de[0]&264&&W!==(W=`haystack-readonly-${l[79]}-${l[87]}`)&&a(S,"for",W),de[0]&264&&U!==(U="remove-haystack-"+l[79]+"-"+l[87])&&a(Q,"data-testid",U)},d(te){te&&R(e),ae.d(),ue&&ue.d(),re&&re.d(),x&&x.d(),F=!1,Ze(z)}}}function Sn(l){var Q;let e,t,o,n,c,r,u,i,d,p,_,m,b,v,$,w,k,y,h,T,j,D,N,E,G,B,M,S,C;function O(){l[47].call(u,l[79])}function A(){return l[48](l[79])}let W=((Q=l[0][l[79]])==null?void 0:Q.length)&&Rn(l);function J(){l[50].call(h,l[79])}function I(){l[51].call(E,l[79])}return{c(){e=f("div"),t=f("label"),o=H("Model"),c=g(),r=f("div"),u=f("input"),d=g(),p=f("button"),p.textContent="Fetch models",_=g(),W&&W.c(),m=g(),b=f("div"),v=f("label"),$=H("Base URL"),k=g(),y=f("div"),h=f("input"),j=g(),D=f("div"),N=f("label"),E=f("input"),B=H(`
               Automatically summarize search results`),a(t,"class","label"),a(t,"for",n=`llm-model-${l[79]}`),a(u,"class","input"),a(u,"id",i=`llm-model-${l[79]}`),a(u,"type","text"),a(u,"placeholder","llama3.1"),a(r,"class","control"),a(p,"class","button is-small"),a(e,"class","field"),a(v,"class","label"),a(v,"for",w=`llm-base-url-${l[79]}`),a(h,"class","input"),a(h,"id",T=`llm-base-url-${l[79]}`),a(h,"type","text"),a(h,"placeholder","http://127.0.0.1:11434"),a(y,"class","control"),a(b,"class","field"),a(E,"id",G=`llm-auto-summarize-${l[79]}`),a(E,"type","checkbox"),a(N,"class","checkbox"),a(N,"for",M=`llm-auto-summarize-${l[79]}`),a(D,"class","field")},m(P,U){L(P,e,U),s(e,t),s(t,o),s(e,c),s(e,r),s(r,u),Ne(u,l[3].roles[l[79]].llm_model),s(e,d),s(e,p),s(e,_),W&&W.m(e,null),L(P,m,U),L(P,b,U),s(b,v),s(v,$),s(b,k),s(b,y),s(y,h),Ne(h,l[3].roles[l[79]].llm_base_url),L(P,j,U),L(P,D,U),s(D,N),s(N,E),E.checked=l[3].roles[l[79]].llm_auto_summarize,s(N,B),S||(C=[ee(u,"input",O),ee(p,"click",A),ee(h,"input",J),ee(E,"change",I)],S=!0)},p(P,U){var F;l=P,U[0]&264&&n!==(n=`llm-model-${l[79]}`)&&a(t,"for",n),U[0]&264&&i!==(i=`llm-model-${l[79]}`)&&a(u,"id",i),U[0]&264&&u.value!==l[3].roles[l[79]].llm_model&&Ne(u,l[3].roles[l[79]].llm_model),(F=l[0][l[79]])!=null&&F.length?W?W.p(l,U):(W=Rn(l),W.c(),W.m(e,null)):W&&(W.d(1),W=null),U[0]&264&&w!==(w=`llm-base-url-${l[79]}`)&&a(v,"for",w),U[0]&264&&T!==(T=`llm-base-url-${l[79]}`)&&a(h,"id",T),U[0]&264&&h.value!==l[3].roles[l[79]].llm_base_url&&Ne(h,l[3].roles[l[79]].llm_base_url),U[0]&264&&G!==(G=`llm-auto-summarize-${l[79]}`)&&a(E,"id",G),U[0]&264&&(E.checked=l[3].roles[l[79]].llm_auto_summarize),U[0]&264&&M!==(M=`llm-auto-summarize-${l[79]}`)&&a(N,"for",M)},d(P){P&&R(e),W&&W.d(),P&&R(m),P&&R(b),P&&R(j),P&&R(D),S=!1,Ze(C)}}}function Rn(l){let e,t,o,n,c=l[0][l[79]],r=[];for(let i=0;i<c.length;i+=1)r[i]=Ln(fn(l,c,i));function u(...i){return l[49](l[79],...i)}return{c(){e=f("div"),t=f("select");for(let i=0;i<r.length;i+=1)r[i].c();a(e,"class","select is-fullwidth"),_e(e,"margin-top","0.5rem")},m(i,d){L(i,e,d),s(e,t);for(let p=0;p<r.length;p+=1)r[p]&&r[p].m(t,null);o||(n=ee(t,"change",u),o=!0)},p(i,d){if(l=i,d[0]&9){c=l[0][l[79]];let p;for(p=0;p<c.length;p+=1){const _=fn(l,c,p);r[p]?r[p].p(_,d):(r[p]=Ln(_),r[p].c(),r[p].m(t,null))}for(;p<r.length;p+=1)r[p].d(1);r.length=c.length}},d(i){i&&R(e),et(r,i),o=!1,n()}}}function Ln(l){let e,t=l[80]+"",o,n;return{c(){e=f("option"),o=H(t),e.__value=n=l[80],e.value=e.__value},m(c,r){L(c,e,r),s(e,o)},p(c,r){r[0]&9&&t!==(t=c[80]+"")&&we(o,t),r[0]&265&&n!==(n=c[80])&&(e.__value=n,e.value=e.__value)},d(c){c&&R(e)}}}function An(l){var de;let e,t,o,n,c,r,u,i,d,p,_,m,b,v,$,w,k,y,h,T,j,D,N,E,G,B,M,S,C,O,A,W,J,I,Q,P,U,F,z,Z,le,ie,ae,V;function se(){l[53].call(u,l[79])}function ue(){l[54].call(y,l[79])}function re(){return l[55](l[79])}let x=((de=l[0][l[79]])==null?void 0:de.length)&&En(l);function he(){l[57].call(S,l[79])}function me(){l[58].call(U,l[79])}let te=l[3].roles[l[79]].openrouter_chat_enabled&&Nn(l);return{c(){e=f("div"),t=f("label"),o=H("OpenRouter API Key"),c=g(),r=f("div"),u=f("input"),d=g(),p=f("p"),p.innerHTML='Get your API key from <a href="https://openrouter.ai" target="_blank" rel="noopener">OpenRouter</a>',_=g(),m=f("div"),b=f("label"),v=H("Model"),w=g(),k=f("div"),y=f("input"),T=g(),j=f("button"),j.textContent="Fetch models",D=g(),x&&x.c(),N=g(),E=f("p"),E.textContent="Choose the language model for generating summaries. Different models offer different speed/quality tradeoffs.",G=g(),B=f("div"),M=f("label"),S=f("input"),O=H(`
               Automatically summarize search results`),W=g(),J=f("p"),J.textContent="When enabled, summaries will be generated and shown in search results.",I=g(),Q=f("div"),P=f("label"),U=f("input"),z=H(`
               Enable Chat interface (OpenRouter)`),le=g(),te&&te.c(),ie=it(),a(t,"class","label"),a(t,"for",n=`openrouter-api-key-${l[79]}`),a(u,"class","input"),a(u,"id",i=`openrouter-api-key-${l[79]}`),a(u,"type","password"),a(u,"placeholder","sk-or-v1-..."),a(r,"class","control"),a(p,"class","help"),a(e,"class","field"),a(b,"class","label"),a(b,"for",$=`openrouter-model-${l[79]}`),a(y,"class","input"),a(y,"id",h=`openrouter-model-${l[79]}`),a(y,"type","text"),a(y,"placeholder","openai/gpt-4-turbo"),a(k,"class","control"),a(j,"class","button is-small"),a(E,"class","help"),a(m,"class","field"),a(S,"id",C=`openrouter-auto-summarize-${l[79]}`),a(S,"type","checkbox"),a(M,"class","checkbox"),a(M,"for",A=`openrouter-auto-summarize-${l[79]}`),a(J,"class","help"),a(B,"class","field"),a(U,"id",F=`openrouter-chat-enabled-${l[79]}`),a(U,"type","checkbox"),a(P,"class","checkbox"),a(P,"for",Z=`openrouter-chat-enabled-${l[79]}`),a(Q,"class","field")},m(pe,fe){L(pe,e,fe),s(e,t),s(t,o),s(e,c),s(e,r),s(r,u),Ne(u,l[3].roles[l[79]].openrouter_api_key),s(e,d),s(e,p),L(pe,_,fe),L(pe,m,fe),s(m,b),s(b,v),s(m,w),s(m,k),s(k,y),Ne(y,l[3].roles[l[79]].openrouter_model),s(m,T),s(m,j),s(m,D),x&&x.m(m,null),s(m,N),s(m,E),L(pe,G,fe),L(pe,B,fe),s(B,M),s(M,S),S.checked=l[3].roles[l[79]].openrouter_auto_summarize,s(M,O),s(B,W),s(B,J),L(pe,I,fe),L(pe,Q,fe),s(Q,P),s(P,U),U.checked=l[3].roles[l[79]].openrouter_chat_enabled,s(P,z),L(pe,le,fe),te&&te.m(pe,fe),L(pe,ie,fe),ae||(V=[ee(u,"input",se),ee(y,"input",ue),ee(j,"click",re),ee(S,"change",he),ee(U,"change",me)],ae=!0)},p(pe,fe){var Te;l=pe,fe[0]&264&&n!==(n=`openrouter-api-key-${l[79]}`)&&a(t,"for",n),fe[0]&264&&i!==(i=`openrouter-api-key-${l[79]}`)&&a(u,"id",i),fe[0]&264&&u.value!==l[3].roles[l[79]].openrouter_api_key&&Ne(u,l[3].roles[l[79]].openrouter_api_key),fe[0]&264&&$!==($=`openrouter-model-${l[79]}`)&&a(b,"for",$),fe[0]&264&&h!==(h=`openrouter-model-${l[79]}`)&&a(y,"id",h),fe[0]&264&&y.value!==l[3].roles[l[79]].openrouter_model&&Ne(y,l[3].roles[l[79]].openrouter_model),(Te=l[0][l[79]])!=null&&Te.length?x?x.p(l,fe):(x=En(l),x.c(),x.m(m,N)):x&&(x.d(1),x=null),fe[0]&264&&C!==(C=`openrouter-auto-summarize-${l[79]}`)&&a(S,"id",C),fe[0]&264&&(S.checked=l[3].roles[l[79]].openrouter_auto_summarize),fe[0]&264&&A!==(A=`openrouter-auto-summarize-${l[79]}`)&&a(M,"for",A),fe[0]&264&&F!==(F=`openrouter-chat-enabled-${l[79]}`)&&a(U,"id",F),fe[0]&264&&(U.checked=l[3].roles[l[79]].openrouter_chat_enabled),fe[0]&264&&Z!==(Z=`openrouter-chat-enabled-${l[79]}`)&&a(P,"for",Z),l[3].roles[l[79]].openrouter_chat_enabled?te?te.p(l,fe):(te=Nn(l),te.c(),te.m(ie.parentNode,ie)):te&&(te.d(1),te=null)},d(pe){pe&&R(e),pe&&R(_),pe&&R(m),x&&x.d(),pe&&R(G),pe&&R(B),pe&&R(I),pe&&R(Q),pe&&R(le),te&&te.d(pe),pe&&R(ie),ae=!1,Ze(V)}}}function En(l){let e,t,o,n,c=l[0][l[79]],r=[];for(let i=0;i<c.length;i+=1)r[i]=Pn(un(l,c,i));function u(...i){return l[56](l[79],...i)}return{c(){e=f("div"),t=f("select");for(let i=0;i<r.length;i+=1)r[i].c();a(e,"class","select is-fullwidth"),_e(e,"margin-top","0.5rem")},m(i,d){L(i,e,d),s(e,t);for(let p=0;p<r.length;p+=1)r[p]&&r[p].m(t,null);o||(n=ee(t,"change",u),o=!0)},p(i,d){if(l=i,d[0]&9){c=l[0][l[79]];let p;for(p=0;p<c.length;p+=1){const _=un(l,c,p);r[p]?r[p].p(_,d):(r[p]=Pn(_),r[p].c(),r[p].m(t,null))}for(;p<r.length;p+=1)r[p].d(1);r.length=c.length}},d(i){i&&R(e),et(r,i),o=!1,n()}}}function Pn(l){let e,t=l[80]+"",o,n;return{c(){e=f("option"),o=H(t),e.__value=n=l[80],e.value=e.__value},m(c,r){L(c,e,r),s(e,o)},p(c,r){r[0]&9&&t!==(t=c[80]+"")&&we(o,t),r[0]&265&&n!==(n=c[80])&&(e.__value=n,e.value=e.__value)},d(c){c&&R(e)}}}function Nn(l){let e,t,o,n,c,r,u,i,d,p,_,m,b,v,$,w,k,y,h,T,j,D,N,E,G;function B(){l[59].call(i,l[79])}function M(){l[60].call(D,l[79])}return{c(){e=f("div"),t=f("label"),o=H("Chat Model"),c=g(),r=f("div"),u=f("div"),i=f("select"),d=f("option"),d.textContent="GPT-3.5 Turbo",p=f("option"),p.textContent="GPT-4",_=f("option"),_.textContent="Claude 3 Sonnet",m=f("option"),m.textContent="Claude 3 Haiku",b=f("option"),b.textContent="Mixtral 8x7B",$=g(),w=f("div"),k=f("label"),y=H("System Prompt (optional)"),T=g(),j=f("div"),D=f("textarea"),a(t,"class","label"),a(t,"for",n=`openrouter-chat-model-${l[79]}`),d.__value="openai/gpt-3.5-turbo",d.value=d.__value,p.__value="openai/gpt-4",p.value=p.__value,_.__value="anthropic/claude-3-sonnet",_.value=_.__value,m.__value="anthropic/claude-3-haiku",m.value=m.__value,b.__value="mistralai/mixtral-8x7b-instruct",b.value=b.__value,a(i,"id",v=`openrouter-chat-model-${l[79]}`),l[3].roles[l[79]].openrouter_chat_model===void 0&&nt(B),a(u,"class","select is-fullwidth"),a(r,"class","control"),a(e,"class","field"),a(k,"class","label"),a(k,"for",h=`openrouter-chat-system-${l[79]}`),a(D,"class","textarea"),a(D,"id",N=`openrouter-chat-system-${l[79]}`),a(D,"rows","3"),a(D,"placeholder","You are a helpful Rust engineer assistant..."),a(j,"class","control"),a(w,"class","field")},m(S,C){L(S,e,C),s(e,t),s(t,o),s(e,c),s(e,r),s(r,u),s(u,i),s(i,d),s(i,p),s(i,_),s(i,m),s(i,b),We(i,l[3].roles[l[79]].openrouter_chat_model,!0),L(S,$,C),L(S,w,C),s(w,k),s(k,y),s(w,T),s(w,j),s(j,D),Ne(D,l[3].roles[l[79]].openrouter_chat_system_prompt),E||(G=[ee(i,"change",B),ee(D,"input",M)],E=!0)},p(S,C){l=S,C[0]&264&&n!==(n=`openrouter-chat-model-${l[79]}`)&&a(t,"for",n),C[0]&264&&v!==(v=`openrouter-chat-model-${l[79]}`)&&a(i,"id",v),C[0]&264&&We(i,l[3].roles[l[79]].openrouter_chat_model),C[0]&264&&h!==(h=`openrouter-chat-system-${l[79]}`)&&a(k,"for",h),C[0]&264&&N!==(N=`openrouter-chat-system-${l[79]}`)&&a(D,"id",N),C[0]&264&&Ne(D,l[3].roles[l[79]].openrouter_chat_system_prompt)},d(S){S&&R(e),S&&R($),S&&R(w),E=!1,Ze(G)}}}function On(l){let e;return{c(){e=f("p"),e.textContent="Click to select directory",a(e,"class","help")},m(t,o){L(t,e,o)},d(t){t&&R(e)}}}function Dn(l,e){let t,o,n,c,r,u,i,d,p,_,m,b,v,$,w,k,y,h,T,j,D,N,E,G,B,M,S,C,O,A,W,J,I,Q,P,U,F,z,Z,le,ie,ae,V,se,ue,re,x,he,me,te,de,pe,fe,Te,Ie,qe,Re,Le,oe,Ce,Ue,Me,ot,Ae,Ke,ge,je,Pe,tt,dt,He,At,q,ne,K,ce,$e,ye,Be,Xe,Fe,Je,bt,pt,al,zt,cl,Qt,qt,ul,It,kt,Kl,_l,Gl,hl,Tt,gl,Bl,Yt,Zt,Jl,vl,Vl,Wt,at,bl,Ql,Yl,kl,Xt,xt,Zl,wl,Xl,yl,Pt,el,tl,$l,xl,ll,jt,Ut,Cl,eo,Tl,to,Kt,Mt,Sl,lo,Rl,oo,no,so,Gt,ro,Ll,Dl,io;function us(){e[26].call(d,e[79])}function fs(){e[27].call(y,e[79])}let ol=e[8],ct=[];for(let Ge=0;Ge<ol.length;Ge+=1)ct[Ge]=kn(mn(e,ol,Ge));function ao(){e[28].call(S,e[79])}function co(){e[29].call(F,e[79])}function ds(){e[30].call(x,e[79])}let nl=e[77].haystacks,ut=[];for(let Ge=0;Ge<nl.length;Ge+=1)ut[Ge]=Tn(dn(e,nl,Ge));function ps(){return e[45](e[79])}function uo(){e[46].call(Pe,e[79])}let mt=e[3].roles[e[79]].llm_provider==="ollama"&&Sn(e);function ms(){e[52].call(Fe,e[79])}let _t=e[3].roles[e[79]].openrouter_enabled&&An(e);function _s(){e[61].call(Tt,e[79])}function hs(){e[62].call(at,e[79])}function fo(){return e[63](e[79])}let wt=e[4]&&On();function po(){e[64].call(Pt,e[79])}function gs(){e[65].call(Ut,e[79])}function vs(){e[66].call(Mt,e[79])}function bs(){return e[67](e[79])}return{key:l,first:null,c(){t=f("div"),o=f("div"),n=f("label"),c=H("Role name"),u=g(),i=f("div"),d=f("input"),_=g(),m=f("div"),b=f("label"),v=H("Short name"),w=g(),k=f("div"),y=f("input"),T=g(),j=f("div"),D=f("label"),N=H("Theme"),G=g(),B=f("div"),M=f("div"),S=f("select");for(let Ge=0;Ge<ct.length;Ge+=1)ct[Ge].c();O=g(),A=f("div"),W=f("label"),J=H("Relevance function"),Q=g(),P=f("div"),U=f("div"),F=f("select"),z=f("option"),z.textContent="title-scorer",Z=f("option"),Z.textContent="terraphim-graph",le=f("option"),le.textContent="bm25",ie=f("option"),ie.textContent="bm25f",ae=f("option"),ae.textContent="bm25plus",se=g(),ue=f("div"),re=f("label"),x=f("input"),me=H(`
            Enable Terraphim IT features (KG preprocessing, auto-linking)`),de=g(),pe=f("h5"),pe.textContent="Haystacks",fe=g();for(let Ge=0;Ge<ut.length;Ge+=1)ut[Ge].c();Te=g(),Ie=f("button"),qe=H("Add Haystack"),Le=g(),oe=f("h5"),oe.textContent="AI-Enhanced Summaries (LLM Provider)",Ce=g(),Ue=f("div"),Me=f("label"),ot=H("Provider"),Ke=g(),ge=f("div"),je=f("div"),Pe=f("select"),tt=f("option"),tt.textContent="(none)",dt=f("option"),dt.textContent="OpenRouter",He=f("option"),He.textContent="Ollama (local)",q=g(),ne=f("p"),ne.textContent="Choose a provider. OpenRouter uses API key; Ollama runs locally.",K=g(),mt&&mt.c(),ce=g(),$e=f("h5"),$e.textContent="AI-Enhanced Summaries (OpenRouter)",ye=g(),Be=f("div"),Xe=f("label"),Fe=f("input"),bt=H(`
             Enable AI-generated article summaries`),al=g(),zt=f("p"),zt.textContent="Generate intelligent summaries using OpenRouter's language models",cl=g(),_t&&_t.c(),Qt=g(),qt=f("h5"),qt.textContent="Knowledge Graph",ul=g(),It=f("div"),kt=f("label"),Kl=H("Remote automata URL"),Gl=g(),hl=f("div"),Tt=f("input"),Bl=g(),Yt=f("div"),Zt=f("label"),Jl=H("Local KG path"),Vl=g(),Wt=f("div"),at=f("input"),Ql=g(),wt&&wt.c(),Yl=g(),kl=f("div"),Xt=f("div"),xt=f("label"),Zl=H("Local KG type"),Xl=g(),yl=f("div"),Pt=f("select"),el=f("option"),el.textContent="markdown",tl=f("option"),tl.textContent="json",xl=g(),ll=f("div"),jt=f("label"),Ut=f("input"),eo=H(`
             Public`),to=g(),Kt=f("label"),Mt=f("input"),lo=H(`
             Publish`),oo=g(),no=f("hr"),so=g(),Gt=f("button"),ro=H("Remove Role"),a(n,"class","label"),a(n,"for",r=`role-name-${e[79]}`),a(d,"class","input"),a(d,"id",p=`role-name-${e[79]}`),a(d,"type","text"),a(i,"class","control"),a(o,"class","field"),a(b,"class","label"),a(b,"for",$=`role-shortname-${e[79]}`),a(y,"class","input"),a(y,"id",h=`role-shortname-${e[79]}`),a(y,"type","text"),a(k,"class","control"),a(m,"class","field"),a(D,"class","label"),a(D,"for",E=`role-theme-${e[79]}`),a(S,"id",C=`role-theme-${e[79]}`),e[3].roles[e[79]].theme===void 0&&nt(ao),a(M,"class","select is-fullwidth"),a(B,"class","control"),a(j,"class","field"),a(W,"class","label"),a(W,"for",I=`role-relevance-${e[79]}`),z.__value="title-scorer",z.value=z.__value,Z.__value="terraphim-graph",Z.value=Z.__value,le.__value="bm25",le.value=le.__value,ie.__value="bm25f",ie.value=ie.__value,ae.__value="bm25plus",ae.value=ae.__value,a(F,"id",V=`role-relevance-${e[79]}`),e[3].roles[e[79]].relevance_function===void 0&&nt(co),a(U,"class","select is-fullwidth"),a(P,"class","control"),a(A,"class","field"),a(x,"class","checkbox"),a(x,"id",he=`role-terraphim-it-${e[79]}`),a(x,"type","checkbox"),a(re,"class","label"),a(re,"for",te=`role-terraphim-it-${e[79]}`),a(ue,"class","field"),a(pe,"class","title is-6"),a(Ie,"class","button is-small"),a(Ie,"data-testid",Re="add-haystack-"+e[79]),a(oe,"class","title is-6"),a(Me,"class","label"),a(Me,"for",Ae=`llm-provider-${e[79]}`),tt.__value="",tt.value=tt.__value,dt.__value="openrouter",dt.value=dt.__value,He.__value="ollama",He.value=He.__value,a(Pe,"id",At=`llm-provider-${e[79]}`),e[3].roles[e[79]].llm_provider===void 0&&nt(uo),a(je,"class","select"),a(ge,"class","control"),a(ne,"class","help"),a(Ue,"class","field"),a($e,"class","title is-6"),a(Fe,"id",Je=`openrouter-enabled-${e[79]}`),a(Fe,"type","checkbox"),a(Xe,"class","checkbox"),a(Xe,"for",pt=`openrouter-enabled-${e[79]}`),a(zt,"class","help"),a(Be,"class","field"),a(qt,"class","title is-6"),a(kt,"class","label"),a(kt,"for",_l=`kg-url-${e[79]}`),a(Tt,"class","input"),a(Tt,"id",gl=`kg-url-${e[79]}`),a(Tt,"type","text"),a(Tt,"placeholder","https://example.com/thesaurus.json"),a(hl,"class","control"),a(It,"class","field"),a(Zt,"class","label"),a(Zt,"for",vl=`kg-local-path-${e[79]}`),a(at,"class","input"),a(at,"id",bl=`kg-local-path-${e[79]}`),a(at,"type","text"),a(at,"placeholder","/path/to/markdown"),at.readOnly=e[4],a(Wt,"class","control"),a(Yt,"class","field"),a(xt,"class","label"),a(xt,"for",wl=`kg-local-type-${e[79]}`),el.__value="markdown",el.value=el.__value,tl.__value="json",tl.value=tl.__value,a(Pt,"id",$l=`kg-local-type-${e[79]}`),e[3].roles[e[79]].kg.local_type===void 0&&nt(po),a(yl,"class","select"),a(Xt,"class","control"),a(kl,"class","field is-grouped"),a(Ut,"id",Cl=`kg-public-${e[79]}`),a(Ut,"type","checkbox"),a(jt,"class","checkbox"),a(jt,"for",Tl=`kg-public-${e[79]}`),_e(jt,"margin-right","1rem"),a(Mt,"id",Sl=`kg-publish-${e[79]}`),a(Mt,"type","checkbox"),a(Kt,"class","checkbox"),a(Kt,"for",Rl=`kg-publish-${e[79]}`),a(ll,"class","field is-grouped"),a(Gt,"class","button is-small is-danger"),a(Gt,"data-testid",Ll="remove-role-"+e[79]),a(t,"class","box"),this.first=t},m(Ge,Se){L(Ge,t,Se),s(t,o),s(o,n),s(n,c),s(o,u),s(o,i),s(i,d),Ne(d,e[3].roles[e[79]].name),s(t,_),s(t,m),s(m,b),s(b,v),s(m,w),s(m,k),s(k,y),Ne(y,e[3].roles[e[79]].shortname),s(t,T),s(t,j),s(j,D),s(D,N),s(j,G),s(j,B),s(B,M),s(M,S);for(let Oe=0;Oe<ct.length;Oe+=1)ct[Oe]&&ct[Oe].m(S,null);We(S,e[3].roles[e[79]].theme,!0),s(t,O),s(t,A),s(A,W),s(W,J),s(A,Q),s(A,P),s(P,U),s(U,F),s(F,z),s(F,Z),s(F,le),s(F,ie),s(F,ae),We(F,e[3].roles[e[79]].relevance_function,!0),s(t,se),s(t,ue),s(ue,re),s(re,x),x.checked=e[3].roles[e[79]].terraphim_it,s(re,me),s(t,de),s(t,pe),s(t,fe);for(let Oe=0;Oe<ut.length;Oe+=1)ut[Oe]&&ut[Oe].m(t,null);s(t,Te),s(t,Ie),s(Ie,qe),s(t,Le),s(t,oe),s(t,Ce),s(t,Ue),s(Ue,Me),s(Me,ot),s(Ue,Ke),s(Ue,ge),s(ge,je),s(je,Pe),s(Pe,tt),s(Pe,dt),s(Pe,He),We(Pe,e[3].roles[e[79]].llm_provider,!0),s(Ue,q),s(Ue,ne),s(t,K),mt&&mt.m(t,null),s(t,ce),s(t,$e),s(t,ye),s(t,Be),s(Be,Xe),s(Xe,Fe),Fe.checked=e[3].roles[e[79]].openrouter_enabled,s(Xe,bt),s(Be,al),s(Be,zt),s(t,cl),_t&&_t.m(t,null),s(t,Qt),s(t,qt),s(t,ul),s(t,It),s(It,kt),s(kt,Kl),s(It,Gl),s(It,hl),s(hl,Tt),Ne(Tt,e[3].roles[e[79]].kg.url),s(t,Bl),s(t,Yt),s(Yt,Zt),s(Zt,Jl),s(Yt,Vl),s(Yt,Wt),s(Wt,at),Ne(at,e[3].roles[e[79]].kg.local_path),s(Wt,Ql),wt&&wt.m(Wt,null),s(t,Yl),s(t,kl),s(kl,Xt),s(Xt,xt),s(xt,Zl),s(Xt,Xl),s(Xt,yl),s(yl,Pt),s(Pt,el),s(Pt,tl),We(Pt,e[3].roles[e[79]].kg.local_type,!0),s(t,xl),s(t,ll),s(ll,jt),s(jt,Ut),Ut.checked=e[3].roles[e[79]].kg.public,s(jt,eo),s(ll,to),s(ll,Kt),s(Kt,Mt),Mt.checked=e[3].roles[e[79]].kg.publish,s(Kt,lo),s(t,oo),s(t,no),s(t,so),s(t,Gt),s(Gt,ro),Dl||(io=[ee(d,"input",us),ee(y,"input",fs),ee(S,"change",ao),ee(F,"change",co),ee(x,"change",ds),ee(Ie,"click",ps),ee(Pe,"change",uo),ee(Fe,"change",ms),ee(Tt,"input",_s),ee(at,"input",hs),ee(at,"click",function(){zl(e[4]?fo:void 0)&&(e[4]?fo:void 0).apply(this,arguments)}),ee(Pt,"change",po),ee(Ut,"change",gs),ee(Mt,"change",vs),ee(Gt,"click",bs)],Dl=!0)},p(Ge,Se){if(e=Ge,Se[0]&264&&r!==(r=`role-name-${e[79]}`)&&a(n,"for",r),Se[0]&264&&p!==(p=`role-name-${e[79]}`)&&a(d,"id",p),Se[0]&264&&d.value!==e[3].roles[e[79]].name&&Ne(d,e[3].roles[e[79]].name),Se[0]&264&&$!==($=`role-shortname-${e[79]}`)&&a(b,"for",$),Se[0]&264&&h!==(h=`role-shortname-${e[79]}`)&&a(y,"id",h),Se[0]&264&&y.value!==e[3].roles[e[79]].shortname&&Ne(y,e[3].roles[e[79]].shortname),Se[0]&264&&E!==(E=`role-theme-${e[79]}`)&&a(D,"for",E),Se[0]&256){ol=e[8];let Oe;for(Oe=0;Oe<ol.length;Oe+=1){const fl=mn(e,ol,Oe);ct[Oe]?ct[Oe].p(fl,Se):(ct[Oe]=kn(fl),ct[Oe].c(),ct[Oe].m(S,null))}for(;Oe<ct.length;Oe+=1)ct[Oe].d(1);ct.length=ol.length}if(Se[0]&264&&C!==(C=`role-theme-${e[79]}`)&&a(S,"id",C),Se[0]&264&&We(S,e[3].roles[e[79]].theme),Se[0]&264&&I!==(I=`role-relevance-${e[79]}`)&&a(W,"for",I),Se[0]&264&&V!==(V=`role-relevance-${e[79]}`)&&a(F,"id",V),Se[0]&264&&We(F,e[3].roles[e[79]].relevance_function),Se[0]&264&&he!==(he=`role-terraphim-it-${e[79]}`)&&a(x,"id",he),Se[0]&264&&(x.checked=e[3].roles[e[79]].terraphim_it),Se[0]&264&&te!==(te=`role-terraphim-it-${e[79]}`)&&a(re,"for",te),Se[0]&491576){nl=e[77].haystacks;let Oe;for(Oe=0;Oe<nl.length;Oe+=1){const fl=dn(e,nl,Oe);ut[Oe]?ut[Oe].p(fl,Se):(ut[Oe]=Tn(fl),ut[Oe].c(),ut[Oe].m(t,Te))}for(;Oe<ut.length;Oe+=1)ut[Oe].d(1);ut.length=nl.length}Se[0]&264&&Re!==(Re="add-haystack-"+e[79])&&a(Ie,"data-testid",Re),Se[0]&264&&Ae!==(Ae=`llm-provider-${e[79]}`)&&a(Me,"for",Ae),Se[0]&264&&At!==(At=`llm-provider-${e[79]}`)&&a(Pe,"id",At),Se[0]&264&&We(Pe,e[3].roles[e[79]].llm_provider),e[3].roles[e[79]].llm_provider==="ollama"?mt?mt.p(e,Se):(mt=Sn(e),mt.c(),mt.m(t,ce)):mt&&(mt.d(1),mt=null),Se[0]&264&&Je!==(Je=`openrouter-enabled-${e[79]}`)&&a(Fe,"id",Je),Se[0]&264&&(Fe.checked=e[3].roles[e[79]].openrouter_enabled),Se[0]&264&&pt!==(pt=`openrouter-enabled-${e[79]}`)&&a(Xe,"for",pt),e[3].roles[e[79]].openrouter_enabled?_t?_t.p(e,Se):(_t=An(e),_t.c(),_t.m(t,Qt)):_t&&(_t.d(1),_t=null),Se[0]&264&&_l!==(_l=`kg-url-${e[79]}`)&&a(kt,"for",_l),Se[0]&264&&gl!==(gl=`kg-url-${e[79]}`)&&a(Tt,"id",gl),Se[0]&264&&Tt.value!==e[3].roles[e[79]].kg.url&&Ne(Tt,e[3].roles[e[79]].kg.url),Se[0]&264&&vl!==(vl=`kg-local-path-${e[79]}`)&&a(Zt,"for",vl),Se[0]&264&&bl!==(bl=`kg-local-path-${e[79]}`)&&a(at,"id",bl),Se[0]&16&&(at.readOnly=e[4]),Se[0]&264&&at.value!==e[3].roles[e[79]].kg.local_path&&Ne(at,e[3].roles[e[79]].kg.local_path),e[4]?wt||(wt=On(),wt.c(),wt.m(Wt,null)):wt&&(wt.d(1),wt=null),Se[0]&264&&wl!==(wl=`kg-local-type-${e[79]}`)&&a(xt,"for",wl),Se[0]&264&&$l!==($l=`kg-local-type-${e[79]}`)&&a(Pt,"id",$l),Se[0]&264&&We(Pt,e[3].roles[e[79]].kg.local_type),Se[0]&264&&Cl!==(Cl=`kg-public-${e[79]}`)&&a(Ut,"id",Cl),Se[0]&264&&(Ut.checked=e[3].roles[e[79]].kg.public),Se[0]&264&&Tl!==(Tl=`kg-public-${e[79]}`)&&a(jt,"for",Tl),Se[0]&264&&Sl!==(Sl=`kg-publish-${e[79]}`)&&a(Mt,"id",Sl),Se[0]&264&&(Mt.checked=e[3].roles[e[79]].kg.publish),Se[0]&264&&Rl!==(Rl=`kg-publish-${e[79]}`)&&a(Kt,"for",Rl),Se[0]&264&&Ll!==(Ll="remove-role-"+e[79])&&a(Gt,"data-testid",Ll)},d(Ge){Ge&&R(t),et(ct,Ge),et(ut,Ge),mt&&mt.d(),_t&&_t.d(),wt&&wt.d(),Dl=!1,Ze(io)}}}function In(l){let e,t=l[74]+"",o;return{c(){e=f("option"),o=H(t),e.__value=l[74],e.value=e.__value},m(n,c){L(n,e,c),s(e,o)},p:Ee,d(n){n&&R(e)}}}function Un(l){let e,t=l[71].name+"",o,n;return{c(){e=f("option"),o=H(t),e.__value=n=l[71].name,e.value=e.__value},m(c,r){L(c,e,r),s(e,o)},p(c,r){r[0]&8&&t!==(t=c[71].name+"")&&we(o,t),r[0]&264&&n!==(n=c[71].name)&&(e.__value=n,e.value=e.__value)},d(c){c&&R(e)}}}function Mn(l){let e,t,o;return{c(){e=f("button"),e.textContent="Back",a(e,"class","button"),a(e,"data-testid","wizard-back")},m(n,c){L(n,e,c),t||(o=ee(e,"click",l[11]),t=!0)},p:Ee,d(n){n&&R(e),t=!1,o()}}}function Hi(l){let e,t,o;return{c(){e=f("button"),e.textContent="Save",a(e,"class","button is-success"),a(e,"data-testid","wizard-save")},m(n,c){L(n,e,c),t||(o=ee(e,"click",l[19]),t=!0)},p:Ee,d(n){n&&R(e),t=!1,o()}}}function Fi(l){let e,t,o;return{c(){e=f("button"),e.textContent="Next",a(e,"class","button is-primary"),a(e,"data-testid","wizard-next")},m(n,c){L(n,e,c),t||(o=ee(e,"click",l[10]),t=!0)},p:Ee,d(n){n&&R(e),t=!1,o()}}}function zi(l){let e,t,o,n,c,r,u,i,d,p,_,m,b,v,$,w,k,y;e=new il({props:{fallbackPath:"/"}});let h=l[2]==="success"&&gn(l),T=l[2]==="error"&&vn(l);function j(S,C){return S[1]===1?Ui:S[1]===2?Ii:Di}let D=j(l),N=D(l),E=l[1]>1&&Mn(l);function G(S,C){return S[1]<cs?Fi:Hi}let B=G(l),M=B(l);return{c(){ve(e.$$.fragment),t=g(),o=f("div"),n=f("div"),c=f("h3"),c.textContent="Configuration Wizard",r=g(),u=f("button"),u.textContent="Close",i=g(),h&&h.c(),d=g(),T&&T.c(),p=g(),N.c(),_=g(),m=f("nav"),b=f("div"),E&&E.c(),v=g(),$=f("div"),M.c(),a(c,"class","title is-4"),_e(c,"margin-bottom","0"),a(u,"class","button is-small is-light"),a(u,"aria-label","Close configuration wizard"),a(n,"class","is-flex is-justify-content-space-between is-align-items-center"),_e(n,"gap",".5rem"),a(b,"class","level-left"),a($,"class","level-right"),a(m,"class","level"),a(o,"class","box")},m(S,C){be(e,S,C),L(S,t,C),L(S,o,C),s(o,n),s(n,c),s(n,r),s(n,u),s(o,i),h&&h.m(o,null),s(o,d),T&&T.m(o,null),s(o,p),N.m(o,null),s(o,_),s(o,m),s(m,b),E&&E.m(b,null),s(m,v),s(m,$),M.m($,null),w=!0,k||(y=ee(u,"click",qi),k=!0)},p(S,C){S[2]==="success"?h?h.p(S,C):(h=gn(S),h.c(),h.m(o,d)):h&&(h.d(1),h=null),S[2]==="error"?T?T.p(S,C):(T=vn(S),T.c(),T.m(o,p)):T&&(T.d(1),T=null),D===(D=j(S))&&N?N.p(S,C):(N.d(1),N=D(S),N&&(N.c(),N.m(o,_))),S[1]>1?E?E.p(S,C):(E=Mn(S),E.c(),E.m(b,null)):E&&(E.d(1),E=null),B===(B=G(S))&&M?M.p(S,C):(M.d(1),M=B(S),M&&(M.c(),M.m($,null)))},i(S){w||(Y(e.$$.fragment,S),w=!0)},o(S){X(e.$$.fragment,S),w=!1},d(S){ke(e,S),S&&R(t),S&&R(o),h&&h.d(),T&&T.d(),N.d(),E&&E.d(),M.d(),k=!1,y()}}}const cs=3;function qi(){typeof window<"u"&&window.history.back()}function Wi(l,e,t){let o,n;De(l,xe,q=>t(4,n=q));const c=Et(null);async function r(q,ne){if(Ct(xe))try{const K=await rn({directory:!0,multiple:!1});K&&typeof K=="string"&&i.update(ce=>(ce.roles[q].haystacks[ne].path=K,ce))}catch(K){console.error("Failed to open folder selector:",K)}}async function u(q){if(Ct(xe))try{const ne=await rn({directory:!0,multiple:!1});ne&&typeof ne=="string"&&i.update(K=>(K.roles[q].kg.local_path=ne,K))}catch(ne){console.error("Failed to open folder selector:",ne)}}const i=Et({id:"Desktop",global_shortcut:"Ctrl+X",default_theme:"spacelab",default_role:"Default",roles:[]});De(l,i,q=>t(3,o=q));const d=["default","darkly","cerulean","cosmo","cyborg","flatly","journal","litera","lumen","lux","materia","minty","nuclear","pulse","sandstone","simplex","slate","solar","spacelab","superhero","united","yeti"];Jt(async()=>{try{let q;Ct(xe)?q=await ze("get_config_schema"):q=await(await fetch("/config/schema")).json(),c.set(q);const ne=Ct(Lt);ne&&ne.id&&i.update(K=>{var ce;return{...K,id:ne.id,global_shortcut:ne.global_shortcut,default_theme:((ce=ne.roles[ne.default_role])==null?void 0:ce.theme)??"spacelab",default_role:ne.default_role,roles:Object.values(ne.roles).map($e=>{var Fe,Je,bt,pt,al,zt,cl,Qt,qt,ul,It;const ye=(Fe=$e.kg)==null?void 0:Fe.automata_path,Be=(ye==null?void 0:ye.Remote)??"",Xe=((bt=(Je=$e.kg)==null?void 0:Je.knowledge_graph_local)==null?void 0:bt.path)??"";return{name:$e.name,shortname:$e.shortname,relevance_function:$e.relevance_function,terraphim_it:$e.terraphim_it??!1,theme:$e.theme,haystacks:($e.haystacks??[]).map(kt=>({path:kt.location||kt.path||"",read_only:kt.read_only??!1,service:kt.service||"Ripgrep",atomic_server_secret:kt.atomic_server_secret||"",extra_parameters:kt.extra_parameters||{}})),kg:{url:Be,local_path:Xe,local_type:((al=(pt=$e.kg)==null?void 0:pt.knowledge_graph_local)==null?void 0:al.input_type)??"markdown",public:((zt=$e.kg)==null?void 0:zt.public)??!1,publish:((cl=$e.kg)==null?void 0:cl.publish)??!1},openrouter_enabled:$e.openrouter_enabled??!1,openrouter_api_key:$e.openrouter_api_key??"",openrouter_model:$e.openrouter_model??"openai/gpt-3.5-turbo",openrouter_auto_summarize:$e.openrouter_auto_summarize??!1,openrouter_chat_enabled:$e.openrouter_chat_enabled??!1,openrouter_chat_model:$e.openrouter_chat_model??$e.openrouter_model??"openai/gpt-3.5-turbo",openrouter_chat_system_prompt:$e.openrouter_chat_system_prompt??"",llm_provider:((Qt=$e.extra)==null?void 0:Qt.llm_provider)??"",llm_model:((qt=$e.extra)==null?void 0:qt.llm_model)??"",llm_base_url:((ul=$e.extra)==null?void 0:ul.llm_base_url)??"",llm_auto_summarize:((It=$e.extra)==null?void 0:It.llm_auto_summarize)??!1}})}})}catch(q){console.error("Failed to load schema",q)}}),Jt(()=>{const q=ne=>{ne.key==="Escape"&&typeof window<"u"&&window.history.back()};return window.addEventListener("keydown",q),()=>window.removeEventListener("keydown",q)});let p={};async function _(q){var ye;const K=Ct(i).roles[q],ce=K.llm_provider||(K.openrouter_enabled?"openrouter":""),$e=[];try{if(ce==="ollama"){const Be=(K.llm_base_url||"http://127.0.0.1:11434").replace(/\/$/,""),Fe=await(await fetch(`${Be}/api/tags`)).json();if(Array.isArray(Fe==null?void 0:Fe.models))for(const Je of Fe.models)Je!=null&&Je.name&&$e.push(Je.name)}else if(ce==="openrouter"){const Be=(ye=K.openrouter_api_key)==null?void 0:ye.trim();if(!Be)throw new Error("OpenRouter API key required");const Fe=await(await fetch("https://openrouter.ai/api/v1/models",{headers:{Authorization:`Bearer ${Be}`,"HTTP-Referer":"https://terraphim.ai","X-Title":"Terraphim Desktop"}})).json(),Je=Array.isArray(Fe==null?void 0:Fe.data)?Fe.data:[];for(const bt of Je)bt!=null&&bt.id&&$e.push(bt.id)}}catch(Be){console.error("Failed to fetch models",Be)}t(0,p={...p,[q]:$e})}let m=1,b="";function v(){m<cs&&t(1,m+=1)}function $(){m>1&&t(1,m-=1)}function w(){i.update(q=>({...q,roles:[...q.roles,{name:"New Role",shortname:"new",relevance_function:"title-scorer",terraphim_it:!1,theme:"spacelab",haystacks:[],kg:{url:"",local_path:"",local_type:"markdown",public:!1,publish:!1},openrouter_enabled:!1,openrouter_api_key:"",openrouter_model:"openai/gpt-3.5-turbo",openrouter_auto_summarize:!1,openrouter_chat_enabled:!1,openrouter_chat_model:"openai/gpt-3.5-turbo",openrouter_chat_system_prompt:"",llm_provider:"",llm_model:"",llm_base_url:"",llm_auto_summarize:!1}]}))}function k(q){i.update(ne=>({...ne,roles:ne.roles.filter((K,ce)=>ce!==q)}))}function y(q){i.update(ne=>(ne.roles[q].haystacks.push({path:"",read_only:!1,service:"Ripgrep",atomic_server_secret:"",extra_parameters:{}}),ne))}function h(q,ne){i.update(K=>(K.roles[q].haystacks=K.roles[q].haystacks.filter((ce,$e)=>$e!==ne),K))}function T(q,ne,K="",ce=""){i.update($e=>{$e.roles[q].haystacks[ne].extra_parameters||($e.roles[q].haystacks[ne].extra_parameters={});const ye=K||`param_${Date.now()}`;return $e.roles[q].haystacks[ne].extra_parameters[ye]=ce,$e})}function j(q,ne,K){i.update(ce=>(delete ce.roles[q].haystacks[ne].extra_parameters[K],ce))}function D(q,ne,K,ce){i.update($e=>{const ye=$e.roles[q].haystacks[ne].extra_parameters;return ye[K]!==void 0&&K!==ce&&(ye[ce]=ye[K],delete ye[K]),$e})}function N(q,ne,K,ce){const $e=ce.target.value;D(q,ne,K,$e)}async function E(){var $e;const q=Ct(i),ne=Ct(Lt);let K={...ne};K.id=q.id,K.global_shortcut=q.global_shortcut,K.default_role=q.default_role;const ce={};q.roles.forEach(ye=>{var Je,bt;const Be=ye.name,Xe=Be.replace(/^"|"$/g,"");ce[Xe]={extra:((bt=(Je=ne.roles)==null?void 0:Je[Be])==null?void 0:bt.extra)??{},name:ye.name,shortname:ye.shortname,theme:ye.theme,relevance_function:ye.relevance_function,terraphim_it:ye.terraphim_it??!1,haystacks:ye.haystacks.map(pt=>({location:pt.path,service:pt.service,read_only:pt.read_only,atomic_server_secret:pt.service==="Atomic"?pt.atomic_server_secret:void 0,extra_parameters:pt.extra_parameters||{}})),kg:ye.kg.url||ye.kg.local_path?{automata_path:ye.kg.url?{Remote:ye.kg.url}:null,knowledge_graph_local:ye.kg.local_path?{input_type:ye.kg.local_type,path:ye.kg.local_path}:null,public:ye.kg.public,publish:ye.kg.publish}:null,...ye.openrouter_enabled&&{openrouter_enabled:ye.openrouter_enabled,openrouter_api_key:ye.openrouter_api_key,openrouter_model:ye.openrouter_model,openrouter_auto_summarize:ye.openrouter_auto_summarize??!1,openrouter_chat_enabled:ye.openrouter_chat_enabled??!1,openrouter_chat_model:ye.openrouter_chat_model??ye.openrouter_model,openrouter_chat_system_prompt:ye.openrouter_chat_system_prompt??""}};const Fe={};ye.llm_provider&&(Fe.llm_provider=ye.llm_provider),ye.llm_model&&(Fe.llm_model=ye.llm_model),ye.llm_base_url&&(Fe.llm_base_url=ye.llm_base_url),typeof ye.llm_auto_summarize=="boolean"&&(Fe.llm_auto_summarize=ye.llm_auto_summarize),ce[Xe].extra={...ce[Xe].extra||{},...Fe}}),K.roles=ce,(!K.default_role||!ce[K.default_role])&&(K.default_role=(($e=q.roles[0])==null?void 0:$e.name)??"Default"),K.selected_role=K.default_role;try{if(Ct(xe))await ze("update_config",{configNew:K});else{const ye=await fetch("/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(K)});if(!ye.ok)throw new Error(`HTTP ${ye.status}: ${ye.statusText}`)}Lt.set(K),t(2,b="success"),setTimeout(()=>{t(2,b="")},3e3)}catch(ye){console.error(ye),t(2,b="error"),setTimeout(()=>{t(2,b="")},3e3)}}const G=()=>t(2,b=""),B=()=>t(2,b="");function M(){o.id=St(this),i.set(o),t(8,d)}function S(){o.global_shortcut=this.value,i.set(o),t(8,d)}function C(){o.default_theme=St(this),i.set(o),t(8,d)}function O(){o.default_role=St(this),i.set(o),t(8,d)}function A(q){o.roles[q].name=this.value,i.set(o),t(8,d)}function W(q){o.roles[q].shortname=this.value,i.set(o),t(8,d)}function J(q){o.roles[q].theme=St(this),i.set(o),t(8,d)}function I(q){o.roles[q].relevance_function=St(this),i.set(o),t(8,d)}function Q(q){o.roles[q].terraphim_it=this.checked,i.set(o),t(8,d)}function P(q,ne){o.roles[q].haystacks[ne].service=St(this),i.set(o),t(8,d)}function U(q,ne){o.roles[q].haystacks[ne].path=this.value,i.set(o),t(8,d)}const F=(q,ne)=>r(q,ne);function z(q,ne){o.roles[q].haystacks[ne].atomic_server_secret=this.value,i.set(o),t(8,d)}function Z(q,ne){o.roles[q].haystacks[ne].extra_parameters.tag=this.value,i.set(o),t(8,d)}const le=(q,ne,K)=>{const ce=K.currentTarget.value;ce&&pl(i,o.roles[q].haystacks[ne].extra_parameters.tag=ce,o)},ie=(q,ne,K,ce)=>N(q,ne,K,ce);function ae(q,ne,K){o.roles[q].haystacks[ne].extra_parameters[K]=this.value,i.set(o),t(8,d)}const V=(q,ne,K)=>j(q,ne,K),se=(q,ne)=>T(q,ne,"tag","#rust"),ue=(q,ne)=>T(q,ne,"max_count","10"),re=(q,ne)=>T(q,ne,"","");function x(q,ne){o.roles[q].haystacks[ne].read_only=this.checked,i.set(o),t(8,d)}const he=(q,ne)=>h(q,ne),me=q=>y(q);function te(q){o.roles[q].llm_provider=St(this),i.set(o),t(8,d)}function de(q){o.roles[q].llm_model=this.value,i.set(o),t(8,d)}const pe=q=>_(q),fe=(q,ne)=>{pl(i,o.roles[q].llm_model=ne.currentTarget.value,o)};function Te(q){o.roles[q].llm_base_url=this.value,i.set(o),t(8,d)}function Ie(q){o.roles[q].llm_auto_summarize=this.checked,i.set(o),t(8,d)}function qe(q){o.roles[q].openrouter_enabled=this.checked,i.set(o),t(8,d)}function Re(q){o.roles[q].openrouter_api_key=this.value,i.set(o),t(8,d)}function Le(q){o.roles[q].openrouter_model=this.value,i.set(o),t(8,d)}const oe=q=>_(q),Ce=(q,ne)=>{pl(i,o.roles[q].openrouter_model=ne.currentTarget.value,o)};function Ue(q){o.roles[q].openrouter_auto_summarize=this.checked,i.set(o),t(8,d)}function Me(q){o.roles[q].openrouter_chat_enabled=this.checked,i.set(o),t(8,d)}function ot(q){o.roles[q].openrouter_chat_model=St(this),i.set(o),t(8,d)}function Ae(q){o.roles[q].openrouter_chat_system_prompt=this.value,i.set(o),t(8,d)}function Ke(q){o.roles[q].kg.url=this.value,i.set(o),t(8,d)}function ge(q){o.roles[q].kg.local_path=this.value,i.set(o),t(8,d)}const je=q=>u(q);function Pe(q){o.roles[q].kg.local_type=St(this),i.set(o),t(8,d)}function tt(q){o.roles[q].kg.public=this.checked,i.set(o),t(8,d)}function dt(q){o.roles[q].kg.publish=this.checked,i.set(o),t(8,d)}return[p,m,b,o,n,r,u,i,d,_,v,$,w,k,y,h,T,j,N,E,G,B,M,S,C,O,A,W,J,I,Q,P,U,F,z,Z,le,ie,ae,V,se,ue,re,x,he,me,te,de,pe,fe,Te,Ie,qe,Re,Le,oe,Ce,Ue,Me,ot,Ae,Ke,ge,je,Pe,tt,dt,q=>k(q),()=>{t(1,m=2)}]}class Ki extends gt{constructor(e){super(),vt(this,e,Wi,zi,ft,{},null,[-1,-1,-1,-1])}}function Gi(l){let e,t,o,n,c,r,u,i;return e=new il({props:{fallbackPath:"/"}}),u=new ss({props:{content:l[0],onChange:l[1]}}),{c(){ve(e.$$.fragment),t=g(),o=f("div"),n=f("p"),n.innerHTML="<i>The best editing experience is to configure Atomic Server, in the meantime use editor below. You will need to refresh page via Command R or Ctrl-R to see changes</i>",c=g(),r=f("div"),ve(u.$$.fragment),a(r,"class","editor"),a(o,"class","box")},m(d,p){be(e,d,p),L(d,t,p),L(d,o,p),s(o,n),s(o,c),s(o,r),be(u,r,null),i=!0},p(d,[p]){const _={};p&1&&(_.content=d[0]),u.$set(_)},i(d){i||(Y(e.$$.fragment,d),Y(u.$$.fragment,d),i=!0)},o(d){X(e.$$.fragment,d),X(u.$$.fragment,d),i=!1},d(d){ke(e,d),d&&R(t),d&&R(o),ke(u)}}}function Bi(l,e,t){let o,n;De(l,Lt,u=>t(2,o=u)),De(l,xe,u=>t(3,n=u));let c={json:o};function r(u){if(console.log("contents changed:",u),console.log("is tauri",n),Lt.update(i=>(i=u.json,i)),Ct(xe))console.log("Updating config on server"),ze("update_config",{configNew:u.json}).then(i=>{console.log(`Message: ${i}`)}).catch(i=>console.error(i));else{let i=`${Ye.ServerURL}/config/`;fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u.json)})}t(0,c=u)}return Jt(()=>{t(0,c={json:o})}),[c,r]}class Ji extends gt{constructor(e){super(),vt(this,e,Bi,Gi,ft,{})}}const{window:Hl}=As;function Vi(l){let e,t,o,n,c,r,u,i,d,p;return{c(){e=f("div"),t=f("div"),o=f("h3"),o.textContent="Error loading graph",n=g(),c=f("p"),r=H(l[3]),u=g(),i=f("button"),i.textContent="Retry",a(i,"class","button is-primary"),a(t,"class","error-content svelte-1ry9pkl"),a(e,"class","error-overlay svelte-1ry9pkl")},m(_,m){L(_,e,m),s(e,t),s(t,o),s(t,n),s(t,c),s(c,r),s(t,u),s(t,i),d||(p=ee(i,"click",l[11]),d=!0)},p(_,m){m&8&&we(r,_[3])},d(_){_&&R(e),d=!1,p()}}}function Qi(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="loading-content svelte-1ry9pkl"><div class="loader svelte-1ry9pkl"></div> 
        <p>Loading knowledge graph...</p></div>`,a(e,"class","loading-overlay svelte-1ry9pkl")},m(t,o){L(t,e,o)},p:Ee,d(t){t&&R(e)}}}function jn(l){let e,t,o;return{c(){e=f("button"),e.innerHTML='<i class="fas fa-times svelte-1ry9pkl"></i>',a(e,"class","close-button svelte-1ry9pkl"),a(e,"title","Close Graph")},m(n,c){L(n,e,c),t||(o=ee(e,"click",l[17]),t=!0)},p:Ee,d(n){n&&R(e),t=!1,o()}}}function Hn(l){let e;return{c(){e=f("div"),e.innerHTML="<span><strong>Left-click:</strong> View node • <strong>Right-click:</strong> Edit node • <strong>Drag:</strong> Move • <strong>Scroll:</strong> Zoom</span>",a(e,"class","controls-info svelte-1ry9pkl")},m(t,o){L(t,e,o)},d(t){t&&R(e)}}}function Fn(l){let e,t;return{c(){e=f("div"),t=H(l[8]),a(e,"class","debug-message svelte-1ry9pkl")},m(o,n){L(o,e,n),s(e,t)},p(o,n){n&256&&we(t,o[8])},d(o){o&&R(e)}}}function zn(l){let e=l[5].id,t,o,n=qn(l);return{c(){n.c(),t=it()},m(c,r){n.m(c,r),L(c,t,r),o=!0},p(c,r){r&32&&ft(e,e=c[5].id)?(Ve(),X(n,1,1,Ee),Qe(),n=qn(c),n.c(),Y(n,1),n.m(t.parentNode,t)):n.p(c,r)},i(c){o||(Y(n),o=!0)},o(c){X(n),o=!1},d(c){c&&R(t),n.d(c)}}}function qn(l){let e,t,o;function n(r){l[18](r)}let c={item:l[5],initialEdit:l[7]};return l[6]!==void 0&&(c.active=l[6]),e=new ql({props:c}),lt.push(()=>st(e,"active",n)),e.$on("close",l[12]),e.$on("save",l[13]),{c(){ve(e.$$.fragment)},m(r,u){be(e,r,u),o=!0},p(r,u){const i={};u&32&&(i.item=r[5]),u&128&&(i.initialEdit=r[7]),!t&&u&64&&(t=!0,i.active=r[6],rt(()=>t=!1)),e.$set(i)},i(r){o||(Y(e.$$.fragment,r),o=!0)},o(r){X(e.$$.fragment,r),o=!1},d(r){ke(e,r)}}}function Yi(l){let e,t,o,n,c,r,u,i,d,p,_;nt(l[15]),e=new il({props:{fallbackPath:"/"}});function m(h,T){if(h[2])return Qi;if(h[3])return Vi}let b=m(l),v=b&&b(l),$=l[0]&&jn(l),w=!l[2]&&!l[3]&&l[4].length>0&&Hn(),k=l[8]&&Fn(l),y=l[5]&&zn(l);return{c(){ve(e.$$.fragment),t=g(),o=f("div"),v&&v.c(),n=g(),$&&$.c(),c=g(),w&&w.c(),r=g(),k&&k.c(),u=g(),y&&y.c(),i=it(),a(o,"class","graph-container svelte-1ry9pkl"),_e(o,"width",l[0]?"100vw":"600px"),_e(o,"height",l[0]?"100vh":"400px"),ht(o,"fullscreen",l[0])},m(h,T){be(e,h,T),L(h,t,T),L(h,o,T),v&&v.m(o,null),l[16](o),L(h,n,T),$&&$.m(h,T),L(h,c,T),w&&w.m(h,T),L(h,r,T),k&&k.m(h,T),L(h,u,T),y&&y.m(h,T),L(h,i,T),d=!0,p||(_=ee(Hl,"resize",l[15]),p=!0)},p(h,[T]){b===(b=m(h))&&v?v.p(h,T):(v&&v.d(1),v=b&&b(h),v&&(v.c(),v.m(o,null))),(!d||T&1)&&_e(o,"width",h[0]?"100vw":"600px"),(!d||T&1)&&_e(o,"height",h[0]?"100vh":"400px"),(!d||T&1)&&ht(o,"fullscreen",h[0]),h[0]?$?$.p(h,T):($=jn(h),$.c(),$.m(c.parentNode,c)):$&&($.d(1),$=null),!h[2]&&!h[3]&&h[4].length>0?w||(w=Hn(),w.c(),w.m(r.parentNode,r)):w&&(w.d(1),w=null),h[8]?k?k.p(h,T):(k=Fn(h),k.c(),k.m(u.parentNode,u)):k&&(k.d(1),k=null),h[5]?y?(y.p(h,T),T&32&&Y(y,1)):(y=zn(h),y.c(),Y(y,1),y.m(i.parentNode,i)):y&&(Ve(),X(y,1,1,()=>{y=null}),Qe())},i(h){d||(Y(e.$$.fragment,h),Y(y),d=!0)},o(h){X(e.$$.fragment,h),X(y),d=!1},d(h){ke(e,h),h&&R(t),h&&R(o),v&&v.d(),l[16](null),h&&R(n),$&&$.d(h),h&&R(c),w&&w.d(h),h&&R(r),k&&k.d(h),h&&R(u),y&&y.d(h),h&&R(i),p=!1,_()}}}function Wn(l){return{id:`kg-node-${l.id}`,url:`#/graph/node/${l.id}`,title:l.label,body:`# ${l.label}

**Knowledge Graph Node**

ID: ${l.id}
Rank: ${l.rank}

This is a concept node from the knowledge graph. You can edit this content to add more information about "${l.label}".`,description:`Knowledge graph concept: ${l.label}`,tags:["knowledge-graph","concept"],rank:l.rank,stub:`Knowledge graph concept: ${l.label}`}}function Zi(l,e,t){let o,n;De(l,Rt,C=>t(20,o=C)),De(l,xe,C=>t(21,n=C));let{apiUrl:c="/rolegraph"}=e,{fullscreen:r=!0}=e,u,i=!0,d=null,p=[],_=[],m=null,b=!1,v=!1,$="",w=window.innerWidth,k=window.innerHeight;function y(){t(9,w=window.innerWidth),t(10,k=window.innerHeight),!i&&!d&&E()}async function h(){t(2,i=!0),t(3,d=null);try{if(n){console.log("Loading rolegraph from Tauri");const C=await ze("get_rolegraph",{role_name:o||void 0});if(C&&C.status==="success")t(4,p=C.nodes),_=C.edges;else throw new Error(`Tauri rolegraph fetch failed: ${(C==null?void 0:C.status)||"unknown error"}`)}else{console.log("Loading rolegraph from server");const C=o?`${c}?role=${encodeURIComponent(o)}`:c,O=await fetch(C);if(!O.ok)throw new Error(`Failed to fetch: ${O.status}`);const A=await O.json();t(4,p=A.nodes),_=A.edges}}catch(C){t(3,d=C.message),console.error("Error fetching rolegraph:",C)}finally{t(2,i=!1)}}function T(C,O){C.stopPropagation(),console.log("Node clicked:",O.label),t(5,m=Wn(O)),t(7,v=!1),t(6,b=!0)}function j(C,O){C.preventDefault(),C.stopPropagation(),console.log("Node right-clicked:",O.label),t(8,$=`Right-clicked: ${O.label}`),t(5,m=Wn(O)),t(7,v=!0),t(6,b=!0),setTimeout(()=>{t(8,$="")},2e3)}function D(){t(6,b=!1),t(5,m=null),t(7,v=!1)}async function N(){if(m)try{const C=await fetch("/documents",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)});C.ok?console.log("Successfully saved KG record:",m.id):console.error("Failed to save KG record:",C.statusText)}catch(C){console.error("Error saving KG record:",C)}finally{t(6,b=!1),t(5,m=null),t(7,v=!1)}}function E(){if(!u)return;t(1,u.innerHTML="",u);const C=Ml(u).append("svg").attr("width",w).attr("height",k),O=Ws().scaleExtent([.1,10]).on("zoom",z=>{A.attr("transform",z.transform)});C.call(O);const A=C.append("g"),W=Ks(p).force("link",Gs(_).id(z=>z.id).distance(100)).force("charge",Bs().strength(-200)).force("center",Js(w/2,k/2)).force("collision",Vs().radius(20)),J=A.append("g").attr("class","links").selectAll("line").data(_).enter().append("line").attr("stroke","#666").attr("stroke-opacity",.7).attr("stroke-width",z=>{const Z=z.weight||z.rank||1;return Math.max(1,Math.min(8,Z*2))}),I=A.append("g").attr("class","nodes").selectAll("circle").data(p).enter().append("circle").attr("r",z=>{const Z=z.rank||1;return Math.max(6,Math.min(20,Z*2))}).attr("fill",z=>{const Z=z.rank||1,le=Math.min(Z/10,1);return Qs(.2+le*.6)}).attr("stroke","#fff").attr("stroke-width",2).style("cursor","pointer").on("click",(z,Z)=>T(z,Z)).on("contextmenu",(z,Z)=>j(z,Z)).on("mouseover",function(z,Z){Ml(this).transition().duration(150).attr("stroke-width",3).attr("r",le=>{const ie=le.rank||1;return Math.max(8,Math.min(24,ie*2.5))})}).on("mouseout",function(z,Z){Ml(this).transition().duration(150).attr("stroke-width",2).attr("r",le=>{const ie=le.rank||1;return Math.max(6,Math.min(20,ie*2))})}).call(Ys().on("start",P).on("drag",U).on("end",F)),Q=A.append("g").attr("class","labels").selectAll("text").data(p).enter().append("text").attr("text-anchor","middle").attr("dy",".35em").attr("font-size","11px").attr("font-family","Arial, sans-serif").attr("fill","#333").attr("pointer-events","none").text(z=>z.label.length>12?z.label.substring(0,12)+"...":z.label);W.on("tick",()=>{J.attr("x1",z=>z.source.x).attr("y1",z=>z.source.y).attr("x2",z=>z.target.x).attr("y2",z=>z.target.y),I.attr("cx",z=>z.x).attr("cy",z=>z.y),Q.attr("x",z=>z.x).attr("y",z=>z.y)});function P(z,Z){z.active||W.alphaTarget(.3).restart(),Z.fx=Z.x,Z.fy=Z.y}function U(z,Z){Z.fx=z.x,Z.fy=z.y}function F(z,Z){z.active||W.alphaTarget(0),Z.fx=null,Z.fy=null}}Jt(()=>{h().then(()=>{d||E()});const C=O=>{O.preventDefault()};return u&&u.addEventListener("contextmenu",C),window.addEventListener("resize",y),()=>{u&&u.removeEventListener("contextmenu",C),window.removeEventListener("resize",y)}});function G(){t(9,w=Hl.innerWidth),t(10,k=Hl.innerHeight)}function B(C){lt[C?"unshift":"push"](()=>{u=C,t(1,u)})}const M=()=>history.back();function S(C){b=C,t(6,b)}return l.$$set=C=>{"apiUrl"in C&&t(14,c=C.apiUrl),"fullscreen"in C&&t(0,r=C.fullscreen)},[r,u,i,d,p,m,b,v,$,w,k,h,D,N,c,G,B,M,S]}class Xi extends gt{constructor(e){super(),vt(this,e,Zi,Yi,ft,{apiUrl:14,fullscreen:0})}}function Kn(l,e,t){const o=l.slice();return o[26]=e[t],o[28]=t,o}function Gn(l,e,t){const o=l.slice();return o[29]=e[t],o[31]=t,o}function Bn(l){let e,t,o;return{c(){e=f("p"),t=H("Conversation ID: "),o=H(l[5]),a(e,"class","is-size-7 has-text-grey")},m(n,c){L(n,e,c),s(e,t),s(e,o)},p(n,c){c[0]&32&&we(o,n[5])},d(n){n&&R(e)}}}function Jn(l){let e,t,o,n=l[29].content+"",c,r;return{c(){e=f("div"),t=f("div"),o=f("pre"),c=H(n),a(o,"class","svelte-fa1qxe"),a(t,"class","bubble svelte-fa1qxe"),a(e,"class",r=Dt(`msg ${l[29].role}`)+" svelte-fa1qxe")},m(u,i){L(u,e,i),s(e,t),s(t,o),s(o,c)},p(u,i){i[0]&1&&n!==(n=u[29].content+"")&&we(c,n),i[0]&1&&r!==(r=Dt(`msg ${u[29].role}`)+" svelte-fa1qxe")&&a(e,"class",r)},d(u){u&&R(e)}}}function Vn(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="bubble loading svelte-fa1qxe"><span class="icon is-small"><i class="fas fa-spinner fa-spin"></i></span> 
            <span>Thinking...</span></div>`,a(e,"class","msg assistant svelte-fa1qxe")},m(t,o){L(t,e,o)},d(t){t&&R(e)}}}function Qn(l){let e,t,o;return{c(){e=f("p"),t=H("Model: "),o=H(l[4]),a(e,"class","is-size-7 has-text-grey")},m(n,c){L(n,e,c),s(e,t),s(e,o)},p(n,c){c[0]&16&&we(o,n[4])},d(n){n&&R(e)}}}function Yn(l){let e,t;return{c(){e=f("p"),t=H(l[3]),a(e,"class","has-text-danger is-size-7")},m(o,n){L(o,e,n),s(e,t)},p(o,n){n[0]&8&&we(t,o[3])},d(o){o&&R(e)}}}function xi(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-refresh"></i>',a(e,"class","icon is-small")},m(t,o){L(t,e,o)},d(t){t&&R(e)}}}function ea(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-spinner fa-spin"></i>',a(e,"class","icon is-small")},m(t,o){L(t,e,o)},d(t){t&&R(e)}}}function Zn(l){let e,t,o,n,c,r,u,i,d,p,_,m,b,v,$,w,k,y,h,T,j,D,N,E,G,B,M,S,C,O,A,W,J,I,Q,P,U,F;function z(ie,ae){return ie[12]?la:ta}let Z=z(l),le=Z(l);return{c(){e=f("div"),t=f("div"),o=f("label"),o.textContent="Context Type",n=g(),c=f("div"),r=f("div"),u=f("select"),i=f("option"),i.textContent="Document",d=f("option"),d.textContent="Search Result",p=f("option"),p.textContent="User Input",_=f("option"),_.textContent="Note",m=g(),b=f("div"),v=f("label"),v.textContent="Title",$=g(),w=f("div"),k=f("input"),y=g(),h=f("div"),T=f("label"),T.textContent="Content",j=g(),D=f("div"),N=f("textarea"),E=g(),G=f("div"),B=f("div"),M=f("button"),le.c(),S=g(),C=f("span"),C.textContent="Save Context",A=g(),W=f("div"),J=f("button"),I=f("span"),I.innerHTML='<i class="fas fa-times"></i>',Q=g(),P=f("span"),P.textContent="Cancel",a(o,"class","label is-small"),i.__value="document",i.value=i.__value,d.__value="search_result",d.value=d.__value,p.__value="user_input",p.value=p.__value,_.__value="note",_.value=_.__value,a(u,"data-testid","context-type-select"),l[11]===void 0&&nt(()=>l[19].call(u)),a(r,"class","select is-small is-fullwidth"),a(c,"class","control"),a(t,"class","field"),a(v,"class","label is-small"),a(k,"class","input is-small"),a(k,"type","text"),a(k,"placeholder","Enter context title"),a(k,"data-testid","context-title-input"),a(w,"class","control"),a(b,"class","field"),a(T,"class","label is-small"),a(N,"class","textarea is-small"),a(N,"rows","4"),a(N,"placeholder","Enter context content"),a(N,"data-testid","context-content-textarea"),a(D,"class","control"),a(h,"class","field"),a(M,"class","button is-primary is-small"),M.disabled=O=l[12]||!l[9].trim()||!l[10].trim(),a(M,"data-testid","add-context-submit-button"),a(B,"class","control"),a(I,"class","icon is-small"),a(J,"class","button is-light is-small"),J.disabled=l[12],a(W,"class","control"),a(G,"class","field is-grouped"),a(e,"class","box has-background-light mb-4"),a(e,"data-testid","add-context-form")},m(ie,ae){L(ie,e,ae),s(e,t),s(t,o),s(t,n),s(t,c),s(c,r),s(r,u),s(u,i),s(u,d),s(u,p),s(u,_),We(u,l[11],!0),s(e,m),s(e,b),s(b,v),s(b,$),s(b,w),s(w,k),Ne(k,l[9]),s(e,y),s(e,h),s(h,T),s(h,j),s(h,D),s(D,N),Ne(N,l[10]),s(e,E),s(e,G),s(G,B),s(B,M),le.m(M,null),s(M,S),s(M,C),s(G,A),s(G,W),s(W,J),s(J,I),s(J,Q),s(J,P),U||(F=[ee(u,"change",l[19]),ee(k,"input",l[20]),ee(N,"input",l[21]),ee(M,"click",l[15]),ee(J,"click",l[14])],U=!0)},p(ie,ae){ae[0]&2048&&We(u,ie[11]),ae[0]&512&&k.value!==ie[9]&&Ne(k,ie[9]),ae[0]&1024&&Ne(N,ie[10]),Z!==(Z=z(ie))&&(le.d(1),le=Z(ie),le&&(le.c(),le.m(M,S))),ae[0]&5632&&O!==(O=ie[12]||!ie[9].trim()||!ie[10].trim())&&(M.disabled=O),ae[0]&4096&&(J.disabled=ie[12])},d(ie){ie&&R(e),le.d(),U=!1,Ze(F)}}}function ta(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-save"></i>',a(e,"class","icon is-small")},m(t,o){L(t,e,o)},d(t){t&&R(e)}}}function la(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-spinner fa-spin"></i>',a(e,"class","icon is-small")},m(t,o){L(t,e,o)},d(t){t&&R(e)}}}function oa(l){let e,t=l[6],o=[];for(let n=0;n<t.length;n+=1)o[n]=es(Kn(l,t,n));return{c(){e=f("div");for(let n=0;n<o.length;n+=1)o[n].c();a(e,"class","context-items svelte-fa1qxe"),a(e,"data-testid","conversation-context")},m(n,c){L(n,e,c);for(let r=0;r<o.length;r+=1)o[r]&&o[r].m(e,null)},p(n,c){if(c[0]&64){t=n[6];let r;for(r=0;r<t.length;r+=1){const u=Kn(n,t,r);o[r]?o[r].p(u,c):(o[r]=es(u),o[r].c(),o[r].m(e,null))}for(;r<o.length;r+=1)o[r].d(1);o.length=t.length}},d(n){n&&R(e),et(o,n)}}}function na(l){let e;return{c(){e=f("div"),e.innerHTML=`<span class="icon is-large"><i class="fas fa-inbox fa-2x"></i></span> 
              <p class="is-size-6">No context items yet</p> 
              <p class="is-size-7">Add documents from search results to provide context for your chat.</p>`,a(e,"class","has-text-centered has-text-grey-light"),a(e,"data-testid","empty-context-message")},m(t,o){L(t,e,o)},p:Ee,d(t){t&&R(e)}}}function Xn(l){let e,t=l[26].relevance_score.toFixed(1)+"",o;return{c(){e=f("span"),o=H(t),a(e,"class","tag is-light is-small")},m(n,c){L(n,e,c),s(e,o)},p(n,c){c[0]&64&&t!==(t=n[26].relevance_score.toFixed(1)+"")&&we(o,t)},d(n){n&&R(e)}}}function xn(l){let e;return{c(){e=f("hr"),a(e,"class","context-divider svelte-fa1qxe")},m(t,o){L(t,e,o)},d(t){t&&R(e)}}}function es(l){let e,t,o,n,c,r=l[26].context_type.replace(/([A-Z])/g," $1").trim()+"",u,i,d,p,_,m,b,v=l[26].title+"",$,w,k,y,h=l[26].content.substring(0,150)+"",T,j=l[26].content.length>150?"...":"",D,N,E,G,B=new Date(l[26].created_at).toLocaleString()+"",M,S,C,O,A,W=l[26].relevance_score&&Xn(l),J=l[28]<l[6].length-1&&xn();return{c(){e=f("div"),t=f("div"),o=f("div"),n=f("div"),c=f("span"),u=H(r),d=g(),p=f("div"),_=f("div"),W&&W.c(),m=g(),b=f("h6"),$=H(v),w=g(),k=f("div"),y=f("p"),T=H(h),D=H(j),N=g(),E=f("div"),G=H("Added: "),M=H(B),O=g(),J&&J.c(),A=it(),a(c,"class",i="tag is-small "+(l[26].context_type==="Document"?"is-info":l[26].context_type==="SearchResult"?"is-primary":l[26].context_type==="UserInput"?"is-warning":"is-light")),a(c,"data-testid",`context-type-${l[28]}`),a(n,"class","level-item"),a(o,"class","level-left"),a(_,"class","level-item"),a(p,"class","level-right"),a(t,"class","level is-mobile"),a(b,"class","title is-6 has-text-dark"),a(b,"data-testid",`context-title-${l[28]}`),a(y,"class","context-preview svelte-fa1qxe"),a(y,"data-testid",`context-content-${l[28]}`),a(k,"class","content is-small"),a(E,"class","is-size-7 has-text-grey"),a(e,"class","context-item svelte-fa1qxe"),a(e,"data-context-id",S=l[26].id),a(e,"data-testid",`context-item-${l[28]}`),a(e,"data-context-type",C=l[26].context_type)},m(I,Q){L(I,e,Q),s(e,t),s(t,o),s(o,n),s(n,c),s(c,u),s(t,d),s(t,p),s(p,_),W&&W.m(_,null),s(e,m),s(e,b),s(b,$),s(e,w),s(e,k),s(k,y),s(y,T),s(y,D),s(e,N),s(e,E),s(E,G),s(E,M),L(I,O,Q),J&&J.m(I,Q),L(I,A,Q)},p(I,Q){Q[0]&64&&r!==(r=I[26].context_type.replace(/([A-Z])/g," $1").trim()+"")&&we(u,r),Q[0]&64&&i!==(i="tag is-small "+(I[26].context_type==="Document"?"is-info":I[26].context_type==="SearchResult"?"is-primary":I[26].context_type==="UserInput"?"is-warning":"is-light"))&&a(c,"class",i),I[26].relevance_score?W?W.p(I,Q):(W=Xn(I),W.c(),W.m(_,null)):W&&(W.d(1),W=null),Q[0]&64&&v!==(v=I[26].title+"")&&we($,v),Q[0]&64&&h!==(h=I[26].content.substring(0,150)+"")&&we(T,h),Q[0]&64&&j!==(j=I[26].content.length>150?"...":"")&&we(D,j),Q[0]&64&&B!==(B=new Date(I[26].created_at).toLocaleString()+"")&&we(M,B),Q[0]&64&&S!==(S=I[26].id)&&a(e,"data-context-id",S),Q[0]&64&&C!==(C=I[26].context_type)&&a(e,"data-context-type",C),I[28]<I[6].length-1?J||(J=xn(),J.c(),J.m(A.parentNode,A)):J&&(J.d(1),J=null)},d(I){I&&R(e),W&&W.d(),I&&R(O),J&&J.d(I),I&&R(A)}}}function sa(l){let e,t,o,n,c,r,u,i,d,p,_,m,b,v,$,w,k,y,h,T,j,D,N,E,G,B,M,S,C,O,A,W,J,I,Q,P,U,F,z,Z,le,ie,ae,V,se,ue=l[6].length+"",re,x,he,me,te,de,pe;e=new il({props:{fallbackPath:"/"}});let fe=l[5]&&Bn(l),Te=l[0],Ie=[];for(let ge=0;ge<Te.length;ge+=1)Ie[ge]=Jn(Gn(l,Te,ge));let qe=l[2]&&Vn(),Re=l[4]&&Qn(l),Le=l[3]&&Yn(l);function oe(ge,je){return ge[7]?ea:xi}let Ce=oe(l),Ue=Ce(l),Me=l[8]&&Zn(l);function ot(ge,je){return ge[6].length===0?na:oa}let Ae=ot(l),Ke=Ae(l);return{c(){ve(e.$$.fragment),t=g(),o=f("section"),n=f("div"),c=f("div"),r=f("div"),u=f("h2"),u.textContent="Chat",i=g(),d=f("p"),d.textContent=`Role: ${Ct(Rt)}`,p=g(),fe&&fe.c(),_=g(),m=f("div");for(let ge=0;ge<Ie.length;ge+=1)Ie[ge].c();b=g(),qe&&qe.c(),v=g(),Re&&Re.c(),$=g(),Le&&Le.c(),w=g(),k=f("div"),y=f("div"),h=f("textarea"),T=g(),j=f("div"),D=f("button"),N=f("span"),N.innerHTML='<i class="fas fa-paper-plane"></i>',G=g(),B=f("div"),M=f("div"),S=f("div"),C=f("div"),O=f("div"),A=f("h4"),A.textContent="Context",W=g(),J=f("button"),J.innerHTML=`<span class="icon is-small"><i class="fas fa-plus"></i></span> 
                  <span>Add Context</span>`,I=g(),Q=f("div"),P=f("div"),U=f("button"),Ue.c(),F=g(),Me&&Me.c(),z=g(),Ke.c(),Z=g(),le=f("div"),ie=f("div"),ae=f("div"),V=f("div"),se=f("span"),re=H(ue),x=H(" context items"),he=g(),me=f("div"),me.innerHTML='<div class="level-item"><span class="is-size-7 has-text-grey">Context is automatically included in your chat</span></div>',a(u,"class","title is-4"),a(d,"class","subtitle is-6"),a(m,"class","chat-window svelte-fa1qxe"),a(m,"data-testid","chat-messages"),a(h,"class","textarea"),a(h,"rows","3"),a(h,"placeholder","Type your message and press Enter..."),a(h,"data-testid","chat-input"),a(y,"class","control is-expanded"),a(N,"class","icon"),a(D,"class","button is-primary"),D.disabled=E=l[2]||!l[1].trim(),a(D,"data-testid","send-message-button"),a(j,"class","control"),a(k,"class","field has-addons chat-input svelte-fa1qxe"),a(r,"class","column is-8"),a(A,"class","title is-5"),a(J,"class","button is-small is-primary"),a(J,"data-testid","show-add-context-button"),a(O,"class","level-item"),a(C,"class","level-left"),a(U,"class","button is-small is-light"),U.disabled=l[7],a(U,"data-testid","refresh-context-button"),a(P,"class","level-item"),a(Q,"class","level-right"),a(S,"class","level is-mobile"),a(se,"class","tag is-light is-small"),a(se,"data-testid","context-summary"),a(V,"class","level-item"),a(ae,"class","level-left"),a(me,"class","level-right"),a(ie,"class","level is-mobile"),a(le,"class","mt-4"),a(M,"class","box context-panel svelte-fa1qxe"),a(M,"data-testid","context-panel"),a(B,"class","column is-4"),a(c,"class","columns svelte-fa1qxe"),a(n,"class","container"),a(o,"class","section"),a(o,"data-testid","chat-interface")},m(ge,je){be(e,ge,je),L(ge,t,je),L(ge,o,je),s(o,n),s(n,c),s(c,r),s(r,u),s(r,i),s(r,d),s(r,p),fe&&fe.m(r,null),s(r,_),s(r,m);for(let Pe=0;Pe<Ie.length;Pe+=1)Ie[Pe]&&Ie[Pe].m(m,null);s(m,b),qe&&qe.m(m,null),s(r,v),Re&&Re.m(r,null),s(r,$),Le&&Le.m(r,null),s(r,w),s(r,k),s(k,y),s(y,h),Ne(h,l[1]),s(k,T),s(k,j),s(j,D),s(D,N),s(c,G),s(c,B),s(B,M),s(M,S),s(S,C),s(C,O),s(O,A),s(O,W),s(O,J),s(S,I),s(S,Q),s(Q,P),s(P,U),Ue.m(U,null),s(M,F),Me&&Me.m(M,null),s(M,z),Ke.m(M,null),s(M,Z),s(M,le),s(le,ie),s(ie,ae),s(ae,V),s(V,se),s(se,re),s(se,x),s(ie,he),s(ie,me),te=!0,de||(pe=[ee(h,"input",l[18]),ee(h,"keydown",l[17]),ee(D,"click",l[16]),ee(J,"click",l[14]),ee(U,"click",l[13])],de=!0)},p(ge,je){if(ge[5]?fe?fe.p(ge,je):(fe=Bn(ge),fe.c(),fe.m(r,_)):fe&&(fe.d(1),fe=null),je[0]&1){Te=ge[0];let Pe;for(Pe=0;Pe<Te.length;Pe+=1){const tt=Gn(ge,Te,Pe);Ie[Pe]?Ie[Pe].p(tt,je):(Ie[Pe]=Jn(tt),Ie[Pe].c(),Ie[Pe].m(m,b))}for(;Pe<Ie.length;Pe+=1)Ie[Pe].d(1);Ie.length=Te.length}ge[2]?qe||(qe=Vn(),qe.c(),qe.m(m,null)):qe&&(qe.d(1),qe=null),ge[4]?Re?Re.p(ge,je):(Re=Qn(ge),Re.c(),Re.m(r,$)):Re&&(Re.d(1),Re=null),ge[3]?Le?Le.p(ge,je):(Le=Yn(ge),Le.c(),Le.m(r,w)):Le&&(Le.d(1),Le=null),je[0]&2&&Ne(h,ge[1]),(!te||je[0]&6&&E!==(E=ge[2]||!ge[1].trim()))&&(D.disabled=E),Ce!==(Ce=oe(ge))&&(Ue.d(1),Ue=Ce(ge),Ue&&(Ue.c(),Ue.m(U,null))),(!te||je[0]&128)&&(U.disabled=ge[7]),ge[8]?Me?Me.p(ge,je):(Me=Zn(ge),Me.c(),Me.m(M,z)):Me&&(Me.d(1),Me=null),Ae===(Ae=ot(ge))&&Ke?Ke.p(ge,je):(Ke.d(1),Ke=Ae(ge),Ke&&(Ke.c(),Ke.m(M,Z))),(!te||je[0]&64)&&ue!==(ue=ge[6].length+"")&&we(re,ue)},i(ge){te||(Y(e.$$.fragment,ge),te=!0)},o(ge){X(e.$$.fragment,ge),te=!1},d(ge){ke(e,ge),ge&&R(t),ge&&R(o),fe&&fe.d(),et(Ie,ge),qe&&qe.d(),Re&&Re.d(),Le&&Le.d(),Ue.d(),Me&&Me.d(),Ke.d(),de=!1,Ze(pe)}}}function ra(l,e,t){let o;De(l,xe,C=>t(22,o=C));let n=[],c="",r=!1,u=null,i=null,d=null,p=[],_=!1,m=!1,b="",v="",$="document",w=!1;function k(C){t(0,n=[...n,{role:"user",content:C}])}async function y(){try{if(o){const C=await ze("list_conversations");C!=null&&C.conversations&&C.conversations.length>0?(t(5,d=C.conversations[0].id),console.log("🎯 Using existing conversation:",d),await T()):await h()}else{const C=await fetch(`${Ye.ServerURL}/conversations`);if(C.ok){const O=await C.json();O.conversations&&O.conversations.length>0?(t(5,d=O.conversations[0].id),console.log("🎯 Using existing conversation:",d),await T()):await h()}else await h()}}catch(C){console.error("❌ Error initializing conversation:",C)}}async function h(){try{const C=Ct(Rt);if(o){const O=await ze("create_conversation",{title:"Chat Conversation",role:C});O.status==="success"&&O.conversation_id&&(t(5,d=O.conversation_id),console.log("🆕 Created new conversation:",d))}else{const O=await fetch(`${Ye.ServerURL}/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"Chat Conversation",role:C})});if(O.ok){const A=await O.json();A.status==="Success"&&A.conversation_id&&(t(5,d=A.conversation_id),console.log("🆕 Created new conversation:",d))}}}catch(C){console.error("❌ Error creating conversation:",C)}}async function T(){if(!d){console.warn("⚠️ Cannot load context: no conversation ID available");return}t(7,_=!0),console.log("🔄 Loading conversation context for:",d);try{if(o){console.log("📱 Loading context via Tauri...");const C=await ze("get_conversation",{conversationId:d});if(console.log("📥 Tauri response:",C),C.status==="success"&&C.conversation){const O=C.conversation.global_context||[];t(6,p=O),console.log(`✅ Loaded ${O.length} context items via Tauri`)}else console.error("❌ Failed to get conversation via Tauri:",C.error||"Unknown error"),t(6,p=[])}else{console.log("🌐 Loading context via HTTP...");const C=await fetch(`${Ye.ServerURL}/conversations/${d}`);if(console.log("📥 HTTP response status:",C.status,C.statusText),C.ok){const O=await C.json();if(console.log("📄 HTTP response data:",O),O.status==="success"&&O.conversation){const A=O.conversation.global_context||[];t(6,p=A),console.log(`✅ Loaded ${A.length} context items via HTTP`)}else console.error("❌ Failed to get conversation via HTTP:",O.error||"Unknown error"),t(6,p=[])}else console.error("❌ HTTP request failed:",C.status,C.statusText),t(6,p=[])}}catch(C){console.error("❌ Error loading conversation context:",{error:C.message||C,conversationId:d,isTauri:o,timestamp:new Date().toISOString()}),t(6,p=[])}finally{t(7,_=!1),console.log("🏁 Context loading completed. Items count:",p.length)}}function j(){t(8,m=!m),m||(t(9,b=""),t(10,v=""),t(11,$="document"))}async function D(){if(!(!d||!b.trim()||!v.trim())){t(12,w=!0);try{const C={title:b.trim(),content:v.trim(),context_type:$};if(o){const O=await ze("add_context_to_conversation",{conversationId:d,contextData:C});O.status==="success"?(await T(),j(),console.log("✅ Context added successfully via Tauri")):console.error("❌ Failed to add context via Tauri:",O.error)}else{const O=await fetch(`${Ye.ServerURL}/conversations/${d}/context`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(C)});if(O.ok){const A=await O.json();A.status==="success"?(await T(),j(),console.log("✅ Context added successfully via HTTP")):console.error("❌ Failed to add context via HTTP:",A.error)}else console.error("❌ HTTP request failed:",O.status,O.statusText)}}catch(C){console.error("❌ Error adding manual context:",C)}finally{t(12,w=!1)}}}async function N(){var A;if(!c.trim()||r)return;t(3,u=null);const C=Ct(Rt),O=c.trim();t(1,c=""),d||await y(),k(O),t(2,r=!0);try{const W={role:C,messages:n};d&&(W.conversation_id=d);const J=await fetch(`${Ye.ServerURL}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(W)});if(!J.ok)throw new Error(`HTTP ${J.status}`);const I=await J.json();t(4,i=I.model_used??null),((A=I.status)==null?void 0:A.toLowerCase())==="success"&&I.message?t(0,n=[...n,{role:"assistant",content:I.message}]):t(3,u=I.error||"Chat failed")}catch(W){t(3,u=(W==null?void 0:W.message)||String(W))}finally{t(2,r=!1)}}function E(C){(C.key==="Enter"||C.key==="Return")&&!C.shiftKey&&(C.preventDefault(),N())}Jt(()=>{if(t(0,n=[{role:"assistant",content:"Hi! How can I help you? Ask me anything about your search results or documents."}]),y(),typeof window<"u"){const C=()=>{d&&T()};return window.addEventListener("focus",C),()=>{window.removeEventListener("focus",C)}}});function G(){c=this.value,t(1,c)}function B(){$=St(this),t(11,$)}function M(){b=this.value,t(9,b)}function S(){v=this.value,t(10,v)}return[n,c,r,u,i,d,p,_,m,b,v,$,w,T,j,D,N,E,G,B,M,S]}class ia extends gt{constructor(e){super(),vt(this,e,ra,sa,ft,{},null,[-1,-1])}}function aa(l){let e,t;return e=new Oi({}),{c(){ve(e.$$.fragment)},m(o,n){be(e,o,n),t=!0},i(o){t||(Y(e.$$.fragment,o),t=!0)},o(o){X(e.$$.fragment,o),t=!1},d(o){ke(e,o)}}}function ca(l){let e,t;return e=new ia({}),{c(){ve(e.$$.fragment)},m(o,n){be(e,o,n),t=!0},i(o){t||(Y(e.$$.fragment,o),t=!0)},o(o){X(e.$$.fragment,o),t=!1},d(o){ke(e,o)}}}function ua(l){let e,t;return e=new Xi({}),{c(){ve(e.$$.fragment)},m(o,n){be(e,o,n),t=!0},i(o){t||(Y(e.$$.fragment,o),t=!0)},o(o){X(e.$$.fragment,o),t=!1},d(o){ke(e,o)}}}function fa(l){let e,t;return e=new yr({}),{c(){ve(e.$$.fragment)},m(o,n){be(e,o,n),t=!0},i(o){t||(Y(e.$$.fragment,o),t=!0)},o(o){X(e.$$.fragment,o),t=!1},d(o){ke(e,o)}}}function da(l){let e,t;return e=new Ki({}),{c(){ve(e.$$.fragment)},m(o,n){be(e,o,n),t=!0},i(o){t||(Y(e.$$.fragment,o),t=!0)},o(o){X(e.$$.fragment,o),t=!1},d(o){ke(e,o)}}}function pa(l){let e,t;return e=new Ji({}),{c(){ve(e.$$.fragment)},m(o,n){be(e,o,n),t=!0},i(o){t||(Y(e.$$.fragment,o),t=!0)},o(o){X(e.$$.fragment,o),t=!1},d(o){ke(e,o)}}}function ma(l){let e;return{c(){e=f("nav"),e.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
            <a class="navbar-item" href="/config/wizard">Wizard</a> 
            <a class="navbar-item" href="/config/json">JSON Editor</a> 
            <a class="navbar-item" href="/graph">Graph</a> 
            <a class="navbar-item" href="/chat">Chat</a></div>`,a(e,"class","navbar")},m(t,o){L(t,e,o)},p:Ee,d(t){t&&R(e)}}}function _a(l){let e,t,o,n,c,r,u,i,d,p,_,m,b,v,$,w,k,y,h,T,j,D,N,E,G,B,M,S,C,O,A,W,J,I,Q,P,U,F,z,Z,le,ie;return h=new El({}),D=new Nt({props:{path:"/",$$slots:{default:[aa]},$$scope:{ctx:l}}}),E=new Nt({props:{path:"/chat",$$slots:{default:[ca]},$$scope:{ctx:l}}}),B=new Nt({props:{path:"/graph",$$slots:{default:[ua]},$$scope:{ctx:l}}}),O=new Nt({props:{path:"/fetch/*",$$slots:{default:[fa]},$$scope:{ctx:l}}}),W=new Nt({props:{path:"/config/wizard",$$slots:{default:[da]},$$scope:{ctx:l}}}),I=new Nt({props:{path:"/config/json",$$slots:{default:[pa]},$$scope:{ctx:l}}}),F=new Nt({props:{path:"/",$$slots:{default:[ma]},$$scope:{ctx:l}}}),{c(){e=f("meta"),t=g(),o=f("div"),n=f("main"),c=f("div"),r=f("div"),u=f("div"),i=f("ul"),d=f("li"),p=f("a"),p.innerHTML=`<span class="icon is-small"><i class="fas fa-search"></i></span> 
                <span>Search</span>`,_=g(),m=f("li"),b=f("a"),b.innerHTML=`<span class="icon is-small"><i class="fas fa-comments"></i></span> 
                <span>Chat</span>`,v=g(),$=f("li"),w=f("a"),w.innerHTML=`<span class="icon is-small"><i class="fas fa-project-diagram"></i></span> 
                <span>Graph</span>`,k=g(),y=f("div"),ve(h.$$.fragment),T=g(),j=f("div"),ve(D.$$.fragment),N=g(),ve(E.$$.fragment),G=g(),ve(B.$$.fragment),M=g(),S=f("br"),C=g(),ve(O.$$.fragment),A=g(),ve(W.$$.fragment),J=g(),ve(I.$$.fragment),Q=g(),P=f("footer"),U=f("div"),ve(F.$$.fragment),a(e,"name","color-scheme"),a(e,"content",l[1]),document.title="Terraphim",a(p,"href","/"),a(p,"data-exact",""),a(p,"data-testid","search-tab"),a(d,"class","svelte-1nmgbjk"),a(b,"href","/chat"),a(b,"data-testid","chat-tab"),a(m,"class","svelte-1nmgbjk"),a(w,"href","/graph"),a(w,"data-testid","graph-tab"),a($,"class","svelte-1nmgbjk"),a(u,"class","tabs is-boxed svelte-1nmgbjk"),a(r,"class","main-navigation svelte-1nmgbjk"),a(y,"class","role-selector svelte-1nmgbjk"),a(c,"class","top-controls svelte-1nmgbjk"),a(j,"class","main-area svelte-1nmgbjk"),a(n,"class","main-content svelte-1nmgbjk"),a(U,"class",z=Dt(l[0])+" svelte-1nmgbjk"),a(P,"class","svelte-1nmgbjk"),a(o,"class","is-full-height svelte-1nmgbjk")},m(ae,V){s(document.head,e),L(ae,t,V),L(ae,o,V),s(o,n),s(n,c),s(c,r),s(r,u),s(u,i),s(i,d),s(d,p),s(i,_),s(i,m),s(m,b),s(i,v),s(i,$),s($,w),s(c,k),s(c,y),be(h,y,null),s(n,T),s(n,j),be(D,j,null),s(j,N),be(E,j,null),s(j,G),be(B,j,null),s(n,M),s(n,S),s(n,C),be(O,n,null),s(n,A),be(W,n,null),s(n,J),be(I,n,null),s(o,Q),s(o,P),s(P,U),be(F,U,null),Z=!0,le||(ie=[Il(Ul.call(null,p)),Il(Ul.call(null,b)),Il(Ul.call(null,w)),ee(P,"mouseover",l[2]),ee(P,"focus",l[2])],le=!0)},p(ae,[V]){(!Z||V&2)&&a(e,"content",ae[1]);const se={};V&16&&(se.$$scope={dirty:V,ctx:ae}),D.$set(se);const ue={};V&16&&(ue.$$scope={dirty:V,ctx:ae}),E.$set(ue);const re={};V&16&&(re.$$scope={dirty:V,ctx:ae}),B.$set(re);const x={};V&16&&(x.$$scope={dirty:V,ctx:ae}),O.$set(x);const he={};V&16&&(he.$$scope={dirty:V,ctx:ae}),W.$set(he);const me={};V&16&&(me.$$scope={dirty:V,ctx:ae}),I.$set(me);const te={};V&16&&(te.$$scope={dirty:V,ctx:ae}),F.$set(te),(!Z||V&1&&z!==(z=Dt(ae[0])+" svelte-1nmgbjk"))&&a(U,"class",z)},i(ae){Z||(Y(h.$$.fragment,ae),Y(D.$$.fragment,ae),Y(E.$$.fragment,ae),Y(B.$$.fragment,ae),Y(O.$$.fragment,ae),Y(W.$$.fragment,ae),Y(I.$$.fragment,ae),Y(F.$$.fragment,ae),Z=!0)},o(ae){X(h.$$.fragment,ae),X(D.$$.fragment,ae),X(E.$$.fragment,ae),X(B.$$.fragment,ae),X(O.$$.fragment,ae),X(W.$$.fragment,ae),X(I.$$.fragment,ae),X(F.$$.fragment,ae),Z=!1},d(ae){R(e),ae&&R(t),ae&&R(o),ke(h),ke(D),ke(E),ke(B),ke(O),ke(W),ke(I),ke(F),le=!1,Ze(ie)}}}function ha(l,e,t){let o;De(l,ml,r=>t(1,o=r));let n="is-hidden";function c(){t(0,n="")}return[n,o,c]}class ga extends gt{constructor(e){super(),vt(this,e,ha,_a,ft,{})}}const va=new Hs;Fs(va);new ga({target:document.getElementById("app")});
