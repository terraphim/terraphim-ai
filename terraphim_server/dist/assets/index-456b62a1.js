import{aa as lt,S as xe,i as et,s as Ze,q as f,Y as Z,b as S,y as a,Z as Se,I as ge,j as y,ak as he,au as dt,r as ee,a as $,v as c,z as te,t as A,d as M,B as le,av as Mn,aw as wt,H as Ee,U as je,V as He,ax as Wt,ay as Dn,F as rt,g as Ae,e as Oe,O as ot,az as xt,l as X,E as qe,aA as kt,aB as mn,aC as Pn,a1 as Ce,C as nt,aD as De,aE as gn,D as Ot,G as Et,aF as hn,a2 as jn,aG as Hn,x as qt,ac as In,m as el,af as At,W as $t,a7 as Fn,a9 as Gn,n as Kn,w as pl}from"./vendor-ui-cd3d2b6a.js";import{R as ct,S as zt}from"./vendor-utils-1b347ea1.js";import{J as vn,_ as Wn,o as qn}from"./vendor-editor-992829d3.js";import{P as bn,T as Bt,u as kn,y as Bn,A as zn,S as Jn,q as Vn}from"./vendor-atomic-1ea13e29.js";import{E as Yn}from"./novel-editor-b32024cb.js";import{s as Vt,z as Qn,a as Zn,l as Xn,m as xn,c as eo,b as to,B as lo,d as no}from"./vendor-charts-e6a4a6c9.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function t(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(o){if(o.ep)return;o.ep=!0;const r=t(o);fetch(o.href,r)}})();const tt={ServerURL:location.protocol+"//"+window.location.host||"/"},Qt=lt([]),oo={id:"Desktop",global_shortcut:"",roles:{},default_role:{original:"",lowercase:""},selected_role:{original:"",lowercase:""}},Pt=lt("spacelab"),_t=lt("selected"),Qe=lt(!1),so=lt(`${tt.ServerURL}/documents/search`),Xe=lt(oo),dl=lt([]);let Yt=lt("");const Dt=lt(!1);let bt=null;function ro(l){if(typeof document>"u")return;const e=`/assets/bulmaswatch/${l}/bulmaswatch.min.css`;if(bt!=null&&bt.href.endsWith(e))return;const t=document.createElement("link");t.rel="stylesheet",t.href=e,t.id="bulma-theme",t.onload=()=>{bt&&bt!==t&&bt.remove(),bt=t},document.head.appendChild(t);const n=document.head.querySelector('meta[name="color-scheme"]');n&&n.setAttribute("content",l)}Pt.subscribe(ro);function io(l){let e,t;return{c(){e=f("option"),t=Z(l[1]),e.__value=l[0],e.value=e.__value},m(n,o){S(n,e,o),a(e,t)},p(n,[o]){o&2&&Se(t,n[1]),o&1&&(e.__value=n[0],e.value=e.__value)},i:ge,o:ge,d(n){n&&y(e)}}}function ao(l,e,t){let n,{subject:o}=e;const r=bn(o),s=Bt(r,kn.properties.name);return he(l,s,i=>t(1,n=i)),Bt(r,"http://localhost:9883/property/theme"),l.$$set=i=>{"subject"in i&&t(0,o=i.subject)},[o,n,s]}class uo extends xe{constructor(e){super(),et(this,e,ao,io,Ze,{subject:0})}}function co(){return window.crypto.getRandomValues(new Uint32Array(1))[0]}function Zt(l,e=!1){const t=co(),n=`_${t}`;return Object.defineProperty(window,n,{value:o=>(e&&Reflect.deleteProperty(window,n),l==null?void 0:l(o)),writable:!1,configurable:!0}),t}async function Pe(l,e={}){return new Promise((t,n)=>{const o=Zt(s=>{t(s),Reflect.deleteProperty(window,`_${r}`)},!0),r=Zt(s=>{n(s),Reflect.deleteProperty(window,`_${o}`)},!0);window.__TAURI_IPC__({cmd:l,callback:o,error:r,...e})})}function _l(l,e,t){const n=l.slice();return n[25]=e[t],n}function fo(l){let e,t,n;function o(s){l[13](s)}let r={};return l[5]!==void 0&&(r.value=l[5]),e=new wt({props:r}),Ee.push(()=>je(e,"value",o)),{c(){ee(e.$$.fragment)},m(s,i){te(e,s,i),n=!0},p(s,i){const u={};!t&&i&32&&(t=!0,u.value=s[5],He(()=>t=!1)),e.$set(u)},i(s){n||(A(e.$$.fragment,s),n=!0)},o(s){M(e.$$.fragment,s),n=!1},d(s){le(e,s)}}}function po(l){let e,t,n;function o(s){l[14](s)}let r={type:"password",placeholder:"secret",icon:"fas fa-lock",expanded:!0};return l[6]!==void 0&&(r.value=l[6]),e=new wt({props:r}),Ee.push(()=>je(e,"value",o)),{c(){ee(e.$$.fragment)},m(s,i){te(e,s,i),n=!0},p(s,i){const u={};!t&&i&64&&(t=!0,u.value=s[6],He(()=>t=!1)),e.$set(u)},i(s){n||(A(e.$$.fragment,s),n=!0)},o(s){M(e.$$.fragment,s),n=!1},d(s){le(e,s)}}}function _o(l){let e;return{c(){e=Z("Save")},m(t,n){S(t,e,n)},d(t){t&&y(e)}}}function mo(l){let e,t;return e=new Wt({props:{type:"is-success",class:"is-right",iconPack:"fa",iconLeft:"check",$$slots:{default:[_o]},$$scope:{ctx:l}}}),e.$on("click",l[8]),e.$on("submit",l[8]),{c(){ee(e.$$.fragment)},m(n,o){te(e,n,o),t=!0},p(n,o){const r={};o&268435456&&(r.$$scope={dirty:o,ctx:n}),e.$set(r)},i(n){t||(A(e.$$.fragment,n),t=!0)},o(n){M(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function go(l){let e,t,n,o,r,s;return e=new dt({props:{$$slots:{default:[fo]},$$scope:{ctx:l}}}),n=new dt({props:{grouped:!0,$$slots:{default:[po]},$$scope:{ctx:l}}}),r=new dt({props:{grouped:!0,$$slots:{default:[mo]},$$scope:{ctx:l}}}),{c(){ee(e.$$.fragment),t=$(),ee(n.$$.fragment),o=$(),ee(r.$$.fragment)},m(i,u){te(e,i,u),S(i,t,u),te(n,i,u),S(i,o,u),te(r,i,u),s=!0},p(i,u){const p={};u&268435488&&(p.$$scope={dirty:u,ctx:i}),e.$set(p);const m={};u&268435520&&(m.$$scope={dirty:u,ctx:i}),n.$set(m);const d={};u&268435456&&(d.$$scope={dirty:u,ctx:i}),r.$set(d)},i(i){s||(A(e.$$.fragment,i),A(n.$$.fragment,i),A(r.$$.fragment,i),s=!0)},o(i){M(e.$$.fragment,i),M(n.$$.fragment,i),M(r.$$.fragment,i),s=!1},d(i){le(e,i),i&&y(t),le(n,i),i&&y(o),le(r,i)}}}function ho(l){let e,t,n;function o(s){l[15](s)}let r={type:"search",placeholder:"Fetch JSON",icon:"search"};return l[3]!==void 0&&(r.value=l[3]),e=new wt({props:r}),Ee.push(()=>je(e,"value",o)),{c(){ee(e.$$.fragment)},m(s,i){te(e,s,i),n=!0},p(s,i){const u={};!t&&i&8&&(t=!0,u.value=s[3],He(()=>t=!1)),e.$set(u)},i(s){n||(A(e.$$.fragment,s),n=!0)},o(s){M(e.$$.fragment,s),n=!1},d(s){le(e,s)}}}function vo(l){let e;return{c(){e=Z("WikiPage")},m(t,n){S(t,e,n)},d(t){t&&y(e)}}}function bo(l){let e,t,n,o,r,s;function i(d){l[16](d)}let u={type:"search",placeholder:"Post JSON",icon:"search"};l[4]!==void 0&&(u.value=l[4]),e=new wt({props:u}),Ee.push(()=>je(e,"value",i));function p(d){l[17](d)}let m={$$slots:{default:[vo]},$$scope:{ctx:l}};return l[2]!==void 0&&(m.checked=l[2]),o=new Dn({props:m}),Ee.push(()=>je(o,"checked",p)),{c(){ee(e.$$.fragment),n=$(),ee(o.$$.fragment)},m(d,_){te(e,d,_),S(d,n,_),te(o,d,_),s=!0},p(d,_){const h={};!t&&_&16&&(t=!0,h.value=d[4],He(()=>t=!1)),e.$set(h);const g={};_&268435456&&(g.$$scope={dirty:_,ctx:d}),!r&&_&4&&(r=!0,g.checked=d[2],He(()=>r=!1)),o.$set(g)},i(d){s||(A(e.$$.fragment,d),A(o.$$.fragment,d),s=!0)},o(d){M(e.$$.fragment,d),M(o.$$.fragment,d),s=!1},d(d){le(e,d),d&&y(n),le(o,d)}}}function ko(l){let e;return{c(){e=Z("Fetch")},m(t,n){S(t,e,n)},d(t){t&&y(e)}}}function $o(l){let e,t;return e=new Wt({props:{type:"is-primary",$$slots:{default:[ko]},$$scope:{ctx:l}}}),e.$on("click",l[9]),e.$on("submit",l[9]),{c(){ee(e.$$.fragment)},m(n,o){te(e,n,o),t=!0},p(n,o){const r={};o&268435456&&(r.$$scope={dirty:o,ctx:n}),e.$set(r)},i(n){t||(A(e.$$.fragment,n),t=!0)},o(n){M(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function wo(l){let e,t,n,o,r,s;return e=new dt({props:{grouped:!0,$$slots:{default:[ho]},$$scope:{ctx:l}}}),n=new dt({props:{grouped:!0,$$slots:{default:[bo]},$$scope:{ctx:l}}}),r=new dt({props:{grouped:!0,$$slots:{default:[$o]},$$scope:{ctx:l}}}),{c(){ee(e.$$.fragment),t=$(),ee(n.$$.fragment),o=$(),ee(r.$$.fragment)},m(i,u){te(e,i,u),S(i,t,u),te(n,i,u),S(i,o,u),te(r,i,u),s=!0},p(i,u){const p={};u&268435464&&(p.$$scope={dirty:u,ctx:i}),e.$set(p);const m={};u&268435476&&(m.$$scope={dirty:u,ctx:i}),n.$set(m);const d={};u&268435456&&(d.$$scope={dirty:u,ctx:i}),r.$set(d)},i(i){s||(A(e.$$.fragment,i),A(n.$$.fragment,i),A(r.$$.fragment,i),s=!0)},o(i){M(e.$$.fragment,i),M(n.$$.fragment,i),M(r.$$.fragment,i),s=!1},d(i){le(e,i),i&&y(t),le(n,i),i&&y(o),le(r,i)}}}function yo(l){let e,t,n,o,r;return o=new vn({props:{content:l[1],onChange:l[7]}}),{c(){e=f("p"),e.innerHTML=`<i>The best editing experience is to configure Atomic Server, in the
        meantime use editor below. You will need to refresh page via Command R
        or Ctrl-R to see changes</i>`,t=$(),n=f("div"),ee(o.$$.fragment),c(n,"class","editor")},m(s,i){S(s,e,i),S(s,t,i),S(s,n,i),te(o,n,null),r=!0},p(s,i){const u={};i&2&&(u.content=s[1]),o.$set(u)},i(s){r||(A(o.$$.fragment,s),r=!0)},o(s){M(o.$$.fragment,s),r=!1},d(s){s&&y(e),s&&y(t),s&&y(n),le(o)}}}function ml(l){let e,t;return e=new uo({props:{subject:l[25]}}),{c(){ee(e.$$.fragment)},m(n,o){te(e,n,o),t=!0},p(n,o){const r={};o&1&&(r.subject=n[25]),e.$set(r)},i(n){t||(A(e.$$.fragment,n),t=!0)},o(n){M(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function So(l){let e,t,n=l[0]??[],o=[];for(let s=0;s<n.length;s+=1)o[s]=ml(_l(l,n,s));const r=s=>M(o[s],1,1,()=>{o[s]=null});return{c(){for(let s=0;s<o.length;s+=1)o[s].c();e=rt()},m(s,i){for(let u=0;u<o.length;u+=1)o[u]&&o[u].m(s,i);S(s,e,i),t=!0},p(s,i){if(i&1){n=s[0]??[];let u;for(u=0;u<n.length;u+=1){const p=_l(s,n,u);o[u]?(o[u].p(p,i),A(o[u],1)):(o[u]=ml(p),o[u].c(),A(o[u],1),o[u].m(e.parentNode,e))}for(Ae(),u=n.length;u<o.length;u+=1)r(u);Oe()}},i(s){if(!t){for(let i=0;i<n.length;i+=1)A(o[i]);t=!0}},o(s){o=o.filter(Boolean);for(let i=0;i<o.length;i+=1)M(o[i]);t=!1},d(s){ot(o,s),s&&y(e)}}}function Co(l){let e,t;return e=new Mn({props:{$$slots:{default:[So]},$$scope:{ctx:l}}}),{c(){ee(e.$$.fragment)},m(n,o){te(e,n,o),t=!0},p(n,o){const r={};o&268435457&&(r.$$scope={dirty:o,ctx:n}),e.$set(r)},i(n){t||(A(e.$$.fragment,n),t=!0)},o(n){M(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function To(l){let e,t,n,o,r,s,i,u,p,m,d,_,h;return t=new ct({props:{path:"/atomic",$$slots:{default:[go]},$$scope:{ctx:l}}}),o=new ct({props:{path:"/json",$$slots:{default:[wo]},$$scope:{ctx:l}}}),s=new ct({props:{path:"/editor",$$slots:{default:[yo]},$$scope:{ctx:l}}}),m=new dt({props:{grouped:!0,position:"is-right",$$slots:{default:[Co]},$$scope:{ctx:l}}}),{c(){e=f("div"),ee(t.$$.fragment),n=$(),ee(o.$$.fragment),r=$(),ee(s.$$.fragment),i=$(),u=f("hr"),p=$(),ee(m.$$.fragment),d=$(),_=f("nav"),_.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
    <a class="navbar-item" href="/fetch/json">Fetch JSON Data</a> 
    <a class="navbar-item" href="/fetch/atomic">Set Atomic Server</a> 
    <a class="navbar-item" href="/fetch/editor">Edit JSON config</a></div>`,c(e,"class","box"),c(_,"class","navbar")},m(g,b){S(g,e,b),te(t,e,null),a(e,n),te(o,e,null),a(e,r),te(s,e,null),S(g,i,b),S(g,u,b),S(g,p,b),te(m,g,b),S(g,d,b),S(g,_,b),h=!0},p(g,[b]){const w={};b&268435552&&(w.$$scope={dirty:b,ctx:g}),t.$set(w);const v={};b&268435484&&(v.$$scope={dirty:b,ctx:g}),o.$set(v);const k={};b&268435458&&(k.$$scope={dirty:b,ctx:g}),s.$set(k);const L={};b&268435457&&(L.$$scope={dirty:b,ctx:g}),m.$set(L)},i(g){h||(A(t.$$.fragment,g),A(o.$$.fragment,g),A(s.$$.fragment,g),A(m.$$.fragment,g),h=!0)},o(g){M(t.$$.fragment,g),M(o.$$.fragment,g),M(s.$$.fragment,g),M(m.$$.fragment,g),h=!1},d(g){g&&y(e),le(t),le(o),le(s),g&&y(i),g&&y(u),g&&y(p),le(m,g),g&&y(d),g&&y(_)}}}function Ro(l,e,t){let n,o,r,s,i;he(l,Bn,j=>t(19,r=j)),he(l,Qe,j=>t(20,s=j)),he(l,Xe,j=>t(21,i=j));let u={json:i};function p(j){if(console.log("contents changed:",j),console.log("is tauri",s),Xe.update(C=>(C=j.json,C)),Qe)console.log("Updating config on server"),Pe("update_config",{configNew:j.json}).then(C=>{console.log(`Message: ${C}`)}).catch(C=>console.error(C));else{let C=`${tt.ServerURL}/config/`;fetch(C,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(j.json)})}t(1,u=j)}let m=!1,d="https://raw.githubusercontent.com/terraphim/terraphim-cloud-fastapi/main/data/ref_arch.json",_="http://localhost:8000/documents/",h="http://localhost:9883/",g;const b=async()=>{console.log("Updating atomic server configuration");const j=zn.fromSecret(g);r.setServerUrl(h),console.log("Server set.Setting agent"),r.setAgent(j)},w=async()=>{L()},v=({data:{msg:j,data:C}})=>{console.log(j,C)};let k;const L=async()=>{const j=await Wn(()=>import("./fetcher.worker-7e58969a.js"),[]);k=new j.default,k.onmessage=v;const C={msg:"fetcher",data:{url:d,postUrl:_,isWiki:m}};k.postMessage(C)},K=bn("http://localhost:9883/config/y3zx5wtm0bq"),z=Bt(K,kn.properties.name);he(l,z,j=>t(12,o=j));const R=Bt(K,"http://localhost:9883/property/role");he(l,R,j=>t(0,n=j));function T(j){h=j,t(5,h)}function U(j){g=j,t(6,g)}function I(j){d=j,t(3,d)}function V(j){_=j,t(4,_)}function J(j){m=j,t(2,m)}return l.$$.update=()=>{l.$$.dirty&4096&&console.log("Print name",o),l.$$.dirty&1&&console.log("Print roles",n)},[n,u,m,d,_,h,g,p,b,w,z,R,o,T,U,I,V,J]}class Lo extends xe{constructor(e){super(),et(this,e,Ro,To,Ze,{})}}function Ao(l){let e,t;return e=new Yn({props:{defaultValue:l[0],isEditable:!l[1],disableLocalStorage:!0,onUpdate:l[2],extensions:[qn]}}),{c(){ee(e.$$.fragment)},m(n,o){te(e,n,o),t=!0},p(n,[o]){const r={};o&1&&(r.defaultValue=n[0]),o&2&&(r.isEditable=!n[1]),e.$set(r)},i(n){t||(A(e.$$.fragment,n),t=!0)},o(n){M(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function Oo(l,e,t){let{html:n=""}=e,{readOnly:o=!1}=e,{outputFormat:r="html"}=e;const s=i=>{r==="markdown"?t(0,n=i.storage.markdown.getMarkdown()):t(0,n=i.getHTML())};return l.$$set=i=>{"html"in i&&t(0,n=i.html),"readOnly"in i&&t(1,o=i.readOnly),"outputFormat"in i&&t(3,r=i.outputFormat)},[n,o,s,r]}class Eo extends xe{constructor(e){super(),et(this,e,Oo,Ao,Ze,{html:0,readOnly:1,outputFormat:3})}}function gl(l){let e,t,n,o,r,s,i,u,p,m,d;return{c(){e=f("div"),t=f("h3"),n=f("span"),n.textContent="Knowledge Graph",o=Z(`
          Term: `),r=f("strong"),s=Z(l[2]),i=Z(" | Rank: "),u=f("strong"),p=Z(l[3]),m=$(),d=f("hr"),c(n,"class","tag is-info svelte-329px1"),c(t,"class","subtitle is-6 svelte-329px1"),c(d,"class","svelte-329px1"),c(e,"class","kg-context svelte-329px1")},m(_,h){S(_,e,h),a(e,t),a(t,n),a(t,o),a(t,r),a(r,s),a(t,i),a(t,u),a(u,p),a(e,m),a(e,d)},p(_,h){h&4&&Se(s,_[2]),h&8&&Se(p,_[3])},d(_){_&&y(e)}}}function No(l){let e,t,n,o,r,s,i,u;const p=[Do,Mo],m=[];function d(_,h){return _[5]?0:1}return t=d(l),n=m[t]=p[t](l),{c(){e=f("div"),n.c(),o=$(),r=f("div"),r.innerHTML='<span class="hint-text svelte-329px1">Double-click to edit • Ctrl+E to edit • Ctrl+S to save • Click KG links to explore</span>',c(r,"class","edit-hint svelte-329px1"),c(e,"class","content-viewer svelte-329px1"),c(e,"tabindex","0"),c(e,"role","button"),c(e,"aria-label","Double-click to edit article content")},m(_,h){S(_,e,h),m[t].m(e,null),a(e,o),a(e,r),l[20](e),s=!0,i||(u=[X(e,"dblclick",l[14]),X(e,"keydown",l[15]),X(e,"click",l[13])],i=!0)},p(_,h){let g=t;t=d(_),t===g?m[t].p(_,h):(Ae(),M(m[g],1,1,()=>{m[g]=null}),Oe(),n=m[t],n?n.p(_,h):(n=m[t]=p[t](_),n.c()),A(n,1),n.m(e,o))},i(_){s||(A(n),s=!0)},o(_){M(n),s=!1},d(_){_&&y(e),m[t].d(),l[20](null),i=!1,qe(u)}}}function Uo(l){let e,t,n,o,r,s,i,u,p,m;function d(h){l[18](h)}let _={outputFormat:l[11]};return l[1].body!==void 0&&(_.html=l[1].body),e=new Eo({props:_}),Ee.push(()=>je(e,"html",d)),{c(){ee(e.$$.fragment),n=$(),o=f("div"),r=f("button"),r.textContent="Save",s=$(),i=f("button"),i.textContent="Cancel",c(r,"class","button is-primary"),c(i,"class","button is-light"),c(o,"class","edit-controls svelte-329px1")},m(h,g){te(e,h,g),S(h,n,g),S(h,o,g),a(o,r),a(o,s),a(o,i),u=!0,p||(m=[X(r,"click",l[12]),X(i,"click",l[19])],p=!0)},p(h,g){const b={};g&2048&&(b.outputFormat=h[11]),!t&&g&2&&(t=!0,b.html=h[1].body,He(()=>t=!1)),e.$set(b)},i(h){u||(A(e.$$.fragment,h),u=!0)},o(h){M(e.$$.fragment,h),u=!1},d(h){le(e,h),h&&y(n),h&&y(o),p=!1,qe(m)}}}function Mo(l){let e,t,n;return t=new zt({props:{source:l[1].body}}),{c(){e=f("div"),ee(t.$$.fragment),c(e,"class","markdown-content svelte-329px1")},m(o,r){S(o,e,r),te(t,e,null),n=!0},p(o,r){const s={};r&2&&(s.source=o[1].body),t.$set(s)},i(o){n||(A(t.$$.fragment,o),n=!0)},o(o){M(t.$$.fragment,o),n=!1},d(o){o&&y(e),le(t)}}}function Do(l){let e,t=l[1].body+"";return{c(){e=f("div"),c(e,"class","prose svelte-329px1")},m(n,o){S(n,e,o),e.innerHTML=t},p(n,o){o&2&&t!==(t=n[1].body+"")&&(e.innerHTML=t)},i:ge,o:ge,d(n){n&&y(e)}}}function Po(l){let e,t,n,o,r,s=l[1].title+"",i,u,p,m,d,_,h,g=l[2]&&l[3]!==null&&gl(l);const b=[Uo,No],w=[];function v(k,L){return k[4]?0:1}return p=v(l),m=w[p]=b[p](l),{c(){e=f("div"),t=f("button"),n=$(),g&&g.c(),o=$(),r=f("h2"),i=Z(s),u=$(),m.c(),c(t,"class","delete is-large modal-close-btn svelte-329px1"),c(t,"aria-label","close"),c(r,"class","svelte-329px1"),c(e,"class","box wrapper svelte-329px1")},m(k,L){S(k,e,L),a(e,t),a(e,n),g&&g.m(e,null),a(e,o),a(e,r),a(r,i),a(e,u),w[p].m(e,null),d=!0,_||(h=X(t,"click",l[17]),_=!0)},p(k,L){k[2]&&k[3]!==null?g?g.p(k,L):(g=gl(k),g.c(),g.m(e,o)):g&&(g.d(1),g=null),(!d||L&2)&&s!==(s=k[1].title+"")&&Se(i,s);let K=p;p=v(k),p===K?w[p].p(k,L):(Ae(),M(w[K],1,1,()=>{w[K]=null}),Oe(),m=w[p],m?m.p(k,L):(m=w[p]=b[p](k),m.c()),A(m,1),m.m(e,null))},i(k){d||(A(m),d=!0)},o(k){M(m),d=!1},d(k){k&&y(e),g&&g.d(),w[p].d(),_=!1,h()}}}function hl(l){let e,t,n;function o(s){l[23](s)}let r={$$slots:{default:[Io]},$$scope:{ctx:l}};return l[7]!==void 0&&(r.active=l[7]),e=new xt({props:r}),Ee.push(()=>je(e,"active",o)),{c(){ee(e.$$.fragment)},m(s,i){te(e,s,i),n=!0},p(s,i){const u={};i&536872832&&(u.$$scope={dirty:i,ctx:s}),!t&&i&128&&(t=!0,u.active=s[7],He(()=>t=!1)),e.$set(u)},i(s){n||(A(e.$$.fragment,s),n=!0)},o(s){M(e.$$.fragment,s),n=!1},d(s){le(e,s)}}}function vl(l){let e,t,n,o,r,s,i,u,p,m,d;return{c(){e=f("div"),t=f("h3"),n=f("span"),n.textContent="Knowledge Graph",o=Z(`
            Term: `),r=f("strong"),s=Z(l[9]),i=Z(" | Rank: "),u=f("strong"),p=Z(l[10]),m=$(),d=f("hr"),c(n,"class","tag is-info svelte-329px1"),c(t,"class","subtitle is-6 svelte-329px1"),c(d,"class","svelte-329px1"),c(e,"class","kg-context svelte-329px1")},m(_,h){S(_,e,h),a(e,t),a(t,n),a(t,o),a(t,r),a(r,s),a(t,i),a(t,u),a(u,p),a(e,m),a(e,d)},p(_,h){h&512&&Se(s,_[9]),h&1024&&Se(p,_[10])},d(_){_&&y(e)}}}function jo(l){let e,t,n;return t=new zt({props:{source:l[8].body}}),{c(){e=f("div"),ee(t.$$.fragment),c(e,"class","markdown-content svelte-329px1")},m(o,r){S(o,e,r),te(t,e,null),n=!0},p(o,r){const s={};r&256&&(s.source=o[8].body),t.$set(s)},i(o){n||(A(t.$$.fragment,o),n=!0)},o(o){M(t.$$.fragment,o),n=!1},d(o){o&&y(e),le(t)}}}function Ho(l){let e,t=l[8].body+"";return{c(){e=f("div"),c(e,"class","prose svelte-329px1")},m(n,o){S(n,e,o),e.innerHTML=t},p(n,o){o&256&&t!==(t=n[8].body+"")&&(e.innerHTML=t)},i:ge,o:ge,d(n){n&&y(e)}}}function Io(l){let e,t,n,o,r,s=l[8].title+"",i,u,p,m,d,_,h,g,b,w,v,k=l[9]&&l[10]!==null&&vl(l);const L=[Ho,jo],K=[];function z(R,T){return T&256&&(m=null),m==null&&(m=!!(R[8].body&&(/<html/i.test(R[8].body)||/<body/i.test(R[8].body)||/<head/i.test(R[8].body)))),m?0:1}return d=z(l,-1),_=K[d]=L[d](l),{c(){e=f("div"),t=f("button"),n=$(),k&&k.c(),o=$(),r=f("h2"),i=Z(s),u=$(),p=f("div"),_.c(),h=$(),g=f("div"),g.innerHTML='<span class="hint-text svelte-329px1">Knowledge Graph document • Click KG links to explore further</span>',c(t,"class","delete is-large modal-close-btn svelte-329px1"),c(t,"aria-label","close"),c(r,"class","svelte-329px1"),c(g,"class","edit-hint svelte-329px1"),c(p,"class","content-viewer svelte-329px1"),c(p,"tabindex","0"),c(p,"role","button"),c(p,"aria-label","KG document content - click KG links to explore further"),c(e,"class","box wrapper svelte-329px1")},m(R,T){S(R,e,T),a(e,t),a(e,n),k&&k.m(e,null),a(e,o),a(e,r),a(r,i),a(e,u),a(e,p),K[d].m(p,null),a(p,h),a(p,g),b=!0,w||(v=[X(t,"click",l[22]),X(p,"click",l[13])],w=!0)},p(R,T){R[9]&&R[10]!==null?k?k.p(R,T):(k=vl(R),k.c(),k.m(e,o)):k&&(k.d(1),k=null),(!b||T&256)&&s!==(s=R[8].title+"")&&Se(i,s);let U=d;d=z(R,T),d===U?K[d].p(R,T):(Ae(),M(K[U],1,1,()=>{K[U]=null}),Oe(),_=K[d],_?_.p(R,T):(_=K[d]=L[d](R),_.c()),A(_,1),_.m(p,h))},i(R){b||(A(_),b=!0)},o(R){M(_),b=!1},d(R){R&&y(e),k&&k.d(),K[d].d(),w=!1,qe(v)}}}function Fo(l){let e,t,n,o,r;function s(p){l[21](p)}let i={$$slots:{default:[Po]},$$scope:{ctx:l}};l[0]!==void 0&&(i.active=l[0]),e=new xt({props:i}),Ee.push(()=>je(e,"active",s));let u=l[8]&&hl(l);return{c(){ee(e.$$.fragment),n=$(),u&&u.c(),o=rt()},m(p,m){te(e,p,m),S(p,n,m),u&&u.m(p,m),S(p,o,m),r=!0},p(p,[m]){const d={};m&536873087&&(d.$$scope={dirty:m,ctx:p}),!t&&m&1&&(t=!0,d.active=p[0],He(()=>t=!1)),e.$set(d),p[8]?u?(u.p(p,m),m&256&&A(u,1)):(u=hl(p),u.c(),A(u,1),u.m(o.parentNode,o)):u&&(Ae(),M(u,1,1,()=>{u=null}),Oe())},i(p){r||(A(e.$$.fragment,p),A(u),r=!0)},o(p){M(e.$$.fragment,p),M(u),r=!1},d(p){le(e,p),p&&y(n),u&&u.d(p),p&&y(o)}}}function Go(l,e,t){let n,o,r,s;he(l,Qe,O=>t(25,r=O)),he(l,_t,O=>t(26,s=O));let{active:i=!1}=e,{item:u}=e,{initialEdit:p=!1}=e,{kgTerm:m=null}=e,{kgRank:d=null}=e,_=!1,h,g=!1,b=null,w=null,v=null;async function k(){if(r)try{const O=await Pe("get_document",{document_id:u.id});O!=null&&O.document&&t(1,u=O.document)}catch(O){console.error("Failed to load document",O)}}async function L(){if(!r){t(4,_=!1);return}try{await Pe("create_document",{document:u}),t(4,_=!1)}catch(O){console.error("Failed to save document",O)}}async function K(O){var P,E,D,W,F;t(9,w=O),console.log("🔍 KG Link Click Debug Info:"),console.log("  Term clicked:",O),console.log("  Current role:",s),console.log("  Is Tauri mode:",r);try{if(r){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{role_name:s,term:O});const q=await Pe("find_documents_for_kg_term",{role_name:s,term:O});console.log("  📥 Tauri response received:"),console.log("    Status:",q.status),console.log("    Results count:",((P=q.results)==null?void 0:P.length)||0),console.log("    Total:",q.total||0),console.log("    Full response:",JSON.stringify(q,null,2)),q.status==="success"&&q.results&&q.results.length>0?(t(8,b=q.results[0]),t(10,v=b.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",b.title),console.log("    Rank:",v),console.log("    Body length:",((E=b.body)==null?void 0:E.length)||0,"characters"),t(7,g=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${O}" in role: "${s}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const q=tt.ServerURL,ne=encodeURIComponent(s),H=encodeURIComponent(O),Q=`${q}/roles/${ne}/kg_search?term=${H}`;console.log("  📤 HTTP Request details:"),console.log("    Base URL:",q),console.log("    Role (encoded):",ne),console.log("    Term (encoded):",H),console.log("    Full URL:",Q);const oe=await fetch(Q);if(console.log("  📥 HTTP Response received:"),console.log("    Status code:",oe.status),console.log("    Status text:",oe.statusText),console.log("    Headers:",Object.fromEntries(oe.headers.entries())),!oe.ok)throw new Error(`HTTP error! Status: ${oe.status} - ${oe.statusText}`);const se=await oe.json();console.log("  📄 Response data:"),console.log("    Status:",se.status),console.log("    Results count:",((D=se.results)==null?void 0:D.length)||0),console.log("    Total:",se.total||0),console.log("    Full response:",JSON.stringify(se,null,2)),se.status==="success"&&se.results&&se.results.length>0?(t(8,b=se.results[0]),t(10,v=b.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",b.title),console.log("    Rank:",v),console.log("    Body length:",((W=b.body)==null?void 0:W.length)||0,"characters"),t(7,g=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${O}" in role: "${s}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",Q))}}catch(q){console.error("❌ Error fetching KG document:"),console.error("  Error type:",q.constructor.name),console.error("  Error message:",q.message||q),console.error("  Request details:",{term:O,role:s,isTauri:r,timestamp:new Date().toISOString()}),!r&&((F=q.message)!=null&&F.includes("Failed to fetch"))&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{}}function z(O){const P=O.target;if(P.tagName==="A"){const E=P.getAttribute("href");if(E&&E.startsWith("kg:")){O.preventDefault();const D=E.substring(3);K(D)}}}function R(){t(4,_=!0)}function T(O){O.type!=="dblclick"&&((O.ctrlKey||O.metaKey)&&O.key==="e"&&(O.preventDefault(),t(4,_=!0)),_&&(O.ctrlKey||O.metaKey)&&O.key==="s"&&(O.preventDefault(),L()),O.key==="Escape"&&(O.preventDefault(),_?t(4,_=!1):t(0,i=!1)))}const U=()=>t(0,i=!1);function I(O){l.$$.not_equal(u.body,O)&&(u.body=O,t(1,u))}const V=()=>t(4,_=!1);function J(O){Ee[O?"unshift":"push"](()=>{h=O,t(6,h)})}function j(O){i=O,t(0,i)}const C=()=>t(7,g=!1);function Y(O){g=O,t(7,g)}return l.$$set=O=>{"active"in O&&t(0,i=O.active),"item"in O&&t(1,u=O.item),"initialEdit"in O&&t(16,p=O.initialEdit),"kgTerm"in O&&t(2,m=O.kgTerm),"kgRank"in O&&t(3,d=O.kgRank)},l.$$.update=()=>{l.$$.dirty&65537&&i&&p&&t(4,_=!0),l.$$.dirty&19&&i&&u&&!_&&k(),l.$$.dirty&2&&t(5,n=u!=null&&u.body?/<html/i.test(u.body)||/<body/i.test(u.body)||/<head/i.test(u.body)||/^\s*<(!DOCTYPE|html|head|body|div|p|span)/i.test(u.body.trim()):!1),l.$$.dirty&32&&t(11,o=n?"html":"markdown")},[i,u,m,d,_,n,h,g,b,w,v,o,L,z,R,T,p,U,I,V,J,j,C,Y]}class tl extends xe{constructor(e){super(),et(this,e,Go,Fo,Ze,{active:0,item:1,initialEdit:16,kgTerm:2,kgRank:3})}}function bl(l,e,t){const n=l.slice();return n[33]=e[t],n}function kl(l,e,t){const n=l.slice();return n[36]=e[t],n}function $l(l,e,t){const n=l.slice();return n[39]=e[t],n}function wl(l){let e,t;return e=new mn({props:{type:"is-success",$$slots:{default:[Ko]},$$scope:{ctx:l}}}),{c(){ee(e.$$.fragment)},m(n,o){te(e,n,o),t=!0},i(n){t||(A(e.$$.fragment,n),t=!0)},o(n){M(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function Ko(l){let e,t,n;return{c(){e=f("p"),e.innerHTML="<strong>Success!</strong> Article saved to atomic server successfully.",t=$(),n=f("p"),n.textContent="The modal will close automatically..."},m(o,r){S(o,e,r),S(o,t,r),S(o,n,r)},p:ge,d(o){o&&y(e),o&&y(t),o&&y(n)}}}function yl(l){let e,t;return e=new mn({props:{type:"is-danger",$$slots:{default:[Wo]},$$scope:{ctx:l}}}),{c(){ee(e.$$.fragment)},m(n,o){te(e,n,o),t=!0},p(n,o){const r={};o[0]&8|o[1]&2048&&(r.$$scope={dirty:o,ctx:n}),e.$set(r)},i(n){t||(A(e.$$.fragment,n),t=!0)},o(n){M(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function Wo(l){let e,t,n,o;return{c(){e=f("p"),t=f("strong"),t.textContent="Error:",n=$(),o=Z(l[3])},m(r,s){S(r,e,s),a(e,t),a(e,n),a(e,o)},p(r,s){s[0]&8&&Se(o,r[3])},d(r){r&&y(e)}}}function Sl(l){var Y,O,P,E;let e,t,n,o,r,s=(((Y=l[1])==null?void 0:Y.title)||"Untitled")+"",i,u,p,m,d,_,h=(((O=l[1])==null?void 0:O.rank)||0)+"",g,b,w,v,k,L,K,z,R,T,U=((P=l[1])==null?void 0:P.description)&&Cl(l),I=((E=l[1])==null?void 0:E.tags)&&Tl(l);function V(D,W){return D[10].length>0?Bo:qo}let J=V(l),j=J(l),C=l[10].length>0&&Al(l);return{c(){e=f("div"),t=f("label"),t.textContent="Document to Save",n=$(),o=f("div"),r=f("h5"),i=Z(s),u=$(),U&&U.c(),p=$(),m=f("div"),d=f("span"),_=Z("Rank: "),g=Z(h),b=$(),I&&I.c(),w=$(),v=f("div"),k=f("label"),k.textContent="Atomic Server",L=$(),K=f("div"),j.c(),z=$(),C&&C.c(),R=rt(),c(t,"class","label"),c(r,"class","title is-6"),c(d,"class","tag is-info svelte-48g63o"),c(m,"class","tags svelte-48g63o"),c(o,"class","box document-preview svelte-48g63o"),c(e,"class","field"),c(k,"class","label"),c(k,"for","atomic-server-select"),c(K,"class","control"),c(v,"class","field")},m(D,W){S(D,e,W),a(e,t),a(e,n),a(e,o),a(o,r),a(r,i),a(o,u),U&&U.m(o,null),a(o,p),a(o,m),a(m,d),a(d,_),a(d,g),a(m,b),I&&I.m(m,null),S(D,w,W),S(D,v,W),a(v,k),a(v,L),a(v,K),j.m(K,null),S(D,z,W),C&&C.m(D,W),S(D,R,W),T=!0},p(D,W){var F,q,ne,H;(!T||W[0]&2)&&s!==(s=(((F=D[1])==null?void 0:F.title)||"Untitled")+"")&&Se(i,s),(q=D[1])!=null&&q.description?U?U.p(D,W):(U=Cl(D),U.c(),U.m(o,p)):U&&(U.d(1),U=null),(!T||W[0]&2)&&h!==(h=(((ne=D[1])==null?void 0:ne.rank)||0)+"")&&Se(g,h),(H=D[1])!=null&&H.tags?I?I.p(D,W):(I=Tl(D),I.c(),I.m(m,null)):I&&(I.d(1),I=null),J===(J=V(D))&&j?j.p(D,W):(j.d(1),j=J(D),j&&(j.c(),j.m(K,null))),D[10].length>0?C?(C.p(D,W),W[0]&1024&&A(C,1)):(C=Al(D),C.c(),A(C,1),C.m(R.parentNode,R)):C&&(Ae(),M(C,1,1,()=>{C=null}),Oe())},i(D){T||(A(C),T=!0)},o(D){M(C),T=!1},d(D){D&&y(e),U&&U.d(),I&&I.d(),D&&y(w),D&&y(v),j.d(),D&&y(z),C&&C.d(D),D&&y(R)}}}function Cl(l){let e,t=l[1].description+"",n;return{c(){e=f("p"),n=Z(t),c(e,"class","content")},m(o,r){S(o,e,r),a(e,n)},p(o,r){r[0]&2&&t!==(t=o[1].description+"")&&Se(n,t)},d(o){o&&y(e)}}}function Tl(l){let e,t=l[1].tags,n=[];for(let o=0;o<t.length;o+=1)n[o]=Rl($l(l,t,o));return{c(){for(let o=0;o<n.length;o+=1)n[o].c();e=rt()},m(o,r){for(let s=0;s<n.length;s+=1)n[s]&&n[s].m(o,r);S(o,e,r)},p(o,r){if(r[0]&2){t=o[1].tags;let s;for(s=0;s<t.length;s+=1){const i=$l(o,t,s);n[s]?n[s].p(i,r):(n[s]=Rl(i),n[s].c(),n[s].m(e.parentNode,e))}for(;s<n.length;s+=1)n[s].d(1);n.length=t.length}},d(o){ot(n,o),o&&y(e)}}}function Rl(l){let e,t=l[39]+"",n;return{c(){e=f("span"),n=Z(t),c(e,"class","tag svelte-48g63o")},m(o,r){S(o,e,r),a(e,n)},p(o,r){r[0]&2&&t!==(t=o[39]+"")&&Se(n,t)},d(o){o&&y(e)}}}function qo(l){let e,t,n,o,r,s,i,u,p;return{c(){e=f("div"),t=f("p"),t.innerHTML="<strong>No atomic servers available</strong>",n=$(),o=f("p"),r=Z('Your current role "'),s=Z(l[12]),i=Z(`" doesn't have any writable atomic server configurations.`),u=$(),p=f("p"),p.textContent="Please configure an atomic server haystack in your role settings.",c(e,"class","notification is-warning")},m(m,d){S(m,e,d),a(e,t),a(e,n),a(e,o),a(o,r),a(o,s),a(o,i),a(e,u),a(e,p)},p(m,d){d[0]&4096&&Se(s,m[12])},d(m){m&&y(e)}}}function Bo(l){let e,t,n,o,r,s,i=l[10],u=[];for(let p=0;p<i.length;p+=1)u[p]=Ll(kl(l,i,p));return{c(){e=f("div"),t=f("select");for(let p=0;p<u.length;p+=1)u[p].c();n=$(),o=f("p"),o.textContent=`Select the atomic server from your current role configuration.
              🔐 = Authenticated, ⚠️ = Anonymous access`,c(t,"id","atomic-server-select"),t.disabled=l[2],l[11]===void 0&&nt(()=>l[18].call(t)),c(e,"class","select is-fullwidth"),c(o,"class","help svelte-48g63o")},m(p,m){S(p,e,m),a(e,t);for(let d=0;d<u.length;d+=1)u[d]&&u[d].m(t,null);De(t,l[11],!0),S(p,n,m),S(p,o,m),r||(s=X(t,"change",l[18]),r=!0)},p(p,m){if(m[0]&1024){i=p[10];let d;for(d=0;d<i.length;d+=1){const _=kl(p,i,d);u[d]?u[d].p(_,m):(u[d]=Ll(_),u[d].c(),u[d].m(t,null))}for(;d<u.length;d+=1)u[d].d(1);u.length=i.length}m[0]&4&&(t.disabled=p[2]),m[0]&3072&&De(t,p[11])},d(p){p&&y(e),ot(u,p),p&&y(n),p&&y(o),r=!1,s()}}}function zo(l){let e;return{c(){e=f("span"),e.textContent="⚠️ No Auth",c(e,"class","has-text-warning")},m(t,n){S(t,e,n)},d(t){t&&y(e)}}}function Jo(l){let e;return{c(){e=f("span"),e.textContent="🔐",c(e,"class","has-text-success")},m(t,n){S(t,e,n)},d(t){t&&y(e)}}}function Ll(l){let e,t=l[36].location+"",n,o,r,s;function i(m,d){return m[36].atomic_server_secret?Jo:zo}let u=i(l),p=u(l);return{c(){e=f("option"),n=Z(t),o=$(),p.c(),r=$(),e.__value=s=l[36].location,e.value=e.__value},m(m,d){S(m,e,d),a(e,n),a(e,o),p.m(e,null),a(e,r)},p(m,d){d[0]&1024&&t!==(t=m[36].location+"")&&Se(n,t),u!==(u=i(m))&&(p.d(1),p=u(m),p&&(p.c(),p.m(e,r))),d[0]&1024&&s!==(s=m[36].location)&&(e.__value=s,e.value=e.__value)},d(m){m&&y(e),p.d()}}}function Al(l){var gt,Ut;let e,t,n,o,r,s,i,u,p,m,d,_,h,g,b,w,v,k,L,K,z,R,T,U,I,V,J,j,C,Y,O,P,E,D,W,F,q,ne,H,Q,oe,se,ve,Ne=(l[8]||"Untitled")+"",Re,de,N,B,ie,_e=(((Ut=(gt=l[1])==null?void 0:gt.body)==null?void 0:Ut.length)||0)+"",re,ae,Le,Me,ke,$e,be=l[14]()+"",me,we,ye,Be,Ie,Te=l[15]()+"",pe,G,ce,ze,Je;function ft(x){l[19](x)}let mt={id:"article-title",placeholder:"Enter article title",disabled:l[2],required:!0};l[8]!==void 0&&(mt.value=l[8]),r=new wt({props:mt}),Ee.push(()=>je(r,"value",ft));const Nt=[Yo,Vo],Ve=[];function Fe(x,ue){return x[7]?1:0}return V=Fe(l),J=Ve[V]=Nt[V](l),O=new Wt({props:{type:"is-primary",loading:l[2],disabled:l[2]||!l[8].trim()||!l[11],$$slots:{default:[Qo]},$$scope:{ctx:l}}}),O.$on("click",l[16]),D=new Wt({props:{type:"is-light",disabled:l[2],$$slots:{default:[Zo]},$$scope:{ctx:l}}}),D.$on("click",l[17]),ce=Pn(l[22][0]),{c(){e=f("div"),t=f("label"),t.textContent="Article Title",n=$(),o=f("div"),ee(r.$$.fragment),i=$(),u=f("div"),p=f("label"),p.textContent="Description",m=$(),d=f("div"),_=f("textarea"),h=$(),g=f("div"),b=f("label"),b.textContent="Parent Collection",w=$(),v=f("div"),k=f("label"),L=f("input"),K=Z(`
              Use predefined collection`),z=$(),R=f("label"),T=f("input"),U=Z(`
              Custom parent URL/path`),I=$(),J.c(),j=$(),C=f("div"),Y=f("div"),ee(O.$$.fragment),P=$(),E=f("div"),ee(D.$$.fragment),W=$(),F=f("div"),q=f("div"),ne=f("p"),ne.innerHTML="<strong>What will be saved:</strong>",H=$(),Q=f("ul"),oe=f("li"),se=f("strong"),se.textContent="Title:",ve=$(),Re=Z(Ne),de=$(),N=f("li"),B=f("strong"),B.textContent="Body:",ie=Z(" Original document content ("),re=Z(_e),ae=Z(" characters)"),Le=$(),Me=f("li"),ke=f("strong"),ke.textContent="Parent:",$e=$(),me=Z(be),we=$(),ye=f("li"),Be=f("strong"),Be.textContent="Subject URL:",Ie=$(),pe=Z(Te),c(t,"class","label"),c(t,"for","article-title"),c(o,"class","control"),c(e,"class","field"),c(p,"class","label"),c(p,"for","article-description"),c(_,"id","article-description"),c(_,"class","textarea"),c(_,"placeholder","Brief description of the article"),_.disabled=l[2],c(_,"rows","3"),c(d,"class","control"),c(u,"class","field"),c(b,"class","label"),c(L,"type","radio"),L.__value=!1,L.value=L.__value,L.disabled=l[2],c(k,"class","radio svelte-48g63o"),c(T,"type","radio"),T.__value=!0,T.value=T.__value,T.disabled=l[2],c(R,"class","radio svelte-48g63o"),c(v,"class","control"),c(g,"class","field"),c(Y,"class","control"),c(E,"class","control"),c(C,"class","field is-grouped"),c(oe,"class","svelte-48g63o"),c(N,"class","svelte-48g63o"),c(Me,"class","svelte-48g63o"),c(ye,"class","svelte-48g63o"),c(Q,"class","svelte-48g63o"),c(q,"class","notification is-info is-light svelte-48g63o"),c(F,"class","field"),ce.p(L,T)},m(x,ue){S(x,e,ue),a(e,t),a(e,n),a(e,o),te(r,o,null),S(x,i,ue),S(x,u,ue),a(u,p),a(u,m),a(u,d),a(d,_),Ce(_,l[9]),S(x,h,ue),S(x,g,ue),a(g,b),a(g,w),a(g,v),a(v,k),a(k,L),L.checked=L.__value===l[7],a(k,K),a(v,z),a(v,R),a(R,T),T.checked=T.__value===l[7],a(R,U),S(x,I,ue),Ve[V].m(x,ue),S(x,j,ue),S(x,C,ue),a(C,Y),te(O,Y,null),a(C,P),a(C,E),te(D,E,null),S(x,W,ue),S(x,F,ue),a(F,q),a(q,ne),a(q,H),a(q,Q),a(Q,oe),a(oe,se),a(oe,ve),a(oe,Re),a(Q,de),a(Q,N),a(N,B),a(N,ie),a(N,re),a(N,ae),a(Q,Le),a(Q,Me),a(Me,ke),a(Me,$e),a(Me,me),a(Q,we),a(Q,ye),a(ye,Be),a(ye,Ie),a(ye,pe),G=!0,ze||(Je=[X(_,"input",l[20]),X(L,"change",l[21]),X(T,"change",l[23])],ze=!0)},p(x,ue){var ht,Ye;const st={};ue[0]&4&&(st.disabled=x[2]),!s&&ue[0]&256&&(s=!0,st.value=x[8],He(()=>s=!1)),r.$set(st),(!G||ue[0]&4)&&(_.disabled=x[2]),ue[0]&512&&Ce(_,x[9]),(!G||ue[0]&4)&&(L.disabled=x[2]),ue[0]&128&&(L.checked=L.__value===x[7]),(!G||ue[0]&4)&&(T.disabled=x[2]),ue[0]&128&&(T.checked=T.__value===x[7]);let yt=V;V=Fe(x),V===yt?Ve[V].p(x,ue):(Ae(),M(Ve[yt],1,1,()=>{Ve[yt]=null}),Oe(),J=Ve[V],J?J.p(x,ue):(J=Ve[V]=Nt[V](x),J.c()),A(J,1),J.m(j.parentNode,j));const it={};ue[0]&4&&(it.loading=x[2]),ue[0]&2308&&(it.disabled=x[2]||!x[8].trim()||!x[11]),ue[1]&2048&&(it.$$scope={dirty:ue,ctx:x}),O.$set(it);const St={};ue[0]&4&&(St.disabled=x[2]),ue[1]&2048&&(St.$$scope={dirty:ue,ctx:x}),D.$set(St),(!G||ue[0]&256)&&Ne!==(Ne=(x[8]||"Untitled")+"")&&Se(Re,Ne),(!G||ue[0]&2)&&_e!==(_e=(((Ye=(ht=x[1])==null?void 0:ht.body)==null?void 0:Ye.length)||0)+"")&&Se(re,_e)},i(x){G||(A(r.$$.fragment,x),A(J),A(O.$$.fragment,x),A(D.$$.fragment,x),G=!0)},o(x){M(r.$$.fragment,x),M(J),M(O.$$.fragment,x),M(D.$$.fragment,x),G=!1},d(x){x&&y(e),le(r),x&&y(i),x&&y(u),x&&y(h),x&&y(g),x&&y(I),Ve[V].d(x),x&&y(j),x&&y(C),le(O),le(D),x&&y(W),x&&y(F),ce.r(),ze=!1,qe(Je)}}}function Vo(l){let e,t,n,o,r,s,i;function u(m){l[25](m)}let p={placeholder:"e.g., my-collection or http://server/custom-parent",disabled:l[2]};return l[6]!==void 0&&(p.value=l[6]),n=new wt({props:p}),Ee.push(()=>je(n,"value",u)),{c(){e=f("div"),t=f("div"),ee(n.$$.fragment),r=$(),s=f("p"),s.textContent=`Enter a collection name (e.g., "my-articles") or full URL. 
              If the collection doesn't exist, it will be created.`,c(t,"class","control"),c(s,"class","help svelte-48g63o"),c(e,"class","field")},m(m,d){S(m,e,d),a(e,t),te(n,t,null),a(e,r),a(e,s),i=!0},p(m,d){const _={};d[0]&4&&(_.disabled=m[2]),!o&&d[0]&64&&(o=!0,_.value=m[6],He(()=>o=!1)),n.$set(_)},i(m){i||(A(n.$$.fragment,m),i=!0)},o(m){M(n.$$.fragment,m),i=!1},d(m){m&&y(e),le(n)}}}function Yo(l){let e,t,n,o,r,s,i=l[13],u=[];for(let p=0;p<i.length;p+=1)u[p]=Ol(bl(l,i,p));return{c(){e=f("div"),t=f("div"),n=f("div"),o=f("select");for(let p=0;p<u.length;p+=1)u[p].c();o.disabled=l[2],l[5]===void 0&&nt(()=>l[24].call(o)),c(n,"class","select is-fullwidth"),c(t,"class","control"),c(e,"class","field")},m(p,m){S(p,e,m),a(e,t),a(t,n),a(n,o);for(let d=0;d<u.length;d+=1)u[d]&&u[d].m(o,null);De(o,l[5],!0),r||(s=X(o,"change",l[24]),r=!0)},p(p,m){if(m[0]&8192){i=p[13];let d;for(d=0;d<i.length;d+=1){const _=bl(p,i,d);u[d]?u[d].p(_,m):(u[d]=Ol(_),u[d].c(),u[d].m(o,null))}for(;d<u.length;d+=1)u[d].d(1);u.length=i.length}m[0]&4&&(o.disabled=p[2]),m[0]&8224&&De(o,p[5])},i:ge,o:ge,d(p){p&&y(e),ot(u,p),r=!1,s()}}}function Ol(l){let e,t=l[33].label+"",n;return{c(){e=f("option"),n=Z(t),e.__value=l[33].value,e.value=e.__value},m(o,r){S(o,e,r),a(e,n)},p:ge,d(o){o&&y(e)}}}function Qo(l){let e,t,n;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-cloud-upload-alt"></i>',t=$(),n=f("span"),n.textContent="Save to Atomic Server",c(e,"class","icon")},m(o,r){S(o,e,r),S(o,t,r),S(o,n,r)},p:ge,d(o){o&&y(e),o&&y(t),o&&y(n)}}}function Zo(l){let e;return{c(){e=Z("Cancel")},m(t,n){S(t,e,n)},d(t){t&&y(e)}}}function Xo(l){let e,t,n,o,r,s,i,u,p,m,d,_,h,g=l[4]&&wl(l),b=l[3]&&yl(l),w=!l[4]&&Sl(l);return{c(){e=f("div"),t=f("div"),n=f("div"),n.innerHTML=`<div class="level-item"><h3 class="title is-4"><span class="icon"><i class="fas fa-save"></i></span>
            Save to Atomic Server</h3></div>`,o=$(),r=f("div"),s=f("div"),i=f("button"),u=$(),g&&g.c(),p=$(),b&&b.c(),m=$(),w&&w.c(),c(n,"class","level-left"),c(i,"class","delete is-large"),i.disabled=l[2],c(i,"aria-label","close"),c(s,"class","level-item"),c(r,"class","level-right"),c(t,"class","level svelte-48g63o"),c(e,"class","box")},m(v,k){S(v,e,k),a(e,t),a(t,n),a(t,o),a(t,r),a(r,s),a(s,i),a(e,u),g&&g.m(e,null),a(e,p),b&&b.m(e,null),a(e,m),w&&w.m(e,null),d=!0,_||(h=X(i,"click",l[17]),_=!0)},p(v,k){(!d||k[0]&4)&&(i.disabled=v[2]),v[4]?g?k[0]&16&&A(g,1):(g=wl(v),g.c(),A(g,1),g.m(e,p)):g&&(Ae(),M(g,1,1,()=>{g=null}),Oe()),v[3]?b?(b.p(v,k),k[0]&8&&A(b,1)):(b=yl(v),b.c(),A(b,1),b.m(e,m)):b&&(Ae(),M(b,1,1,()=>{b=null}),Oe()),v[4]?w&&(Ae(),M(w,1,1,()=>{w=null}),Oe()):w?(w.p(v,k),k[0]&16&&A(w,1)):(w=Sl(v),w.c(),A(w,1),w.m(e,null))},i(v){d||(A(g),A(b),A(w),d=!0)},o(v){M(g),M(b),M(w),d=!1},d(v){v&&y(e),g&&g.d(),b&&b.d(),w&&w.d(),_=!1,h()}}}function xo(l){let e,t,n;function o(s){l[26](s)}let r={$$slots:{default:[Xo]},$$scope:{ctx:l}};return l[0]!==void 0&&(r.active=l[0]),e=new xt({props:r}),Ee.push(()=>je(e,"active",o)),e.$on("close",l[17]),{c(){ee(e.$$.fragment)},m(s,i){te(e,s,i),n=!0},p(s,i){const u={};i[0]&8190|i[1]&2048&&(u.$$scope={dirty:i,ctx:s}),!t&&i[0]&1&&(t=!0,u.active=s[0],He(()=>t=!1)),e.$set(u)},i(s){n||(A(e.$$.fragment,s),n=!0)},o(s){M(e.$$.fragment,s),n=!1},d(s){le(e,s)}}}function es(l,e,t){let n,o,r;he(l,Qe,F=>t(27,n=F)),he(l,Xe,F=>t(28,o=F)),he(l,_t,F=>t(12,r=F));let{active:s=!1}=e,{document:i}=e,u=!1,p=null,m=!1,d="",_="",h=!1,g="",b="",w=[],v="";const k=[{label:"Root (Server Root)",value:""},{label:"Articles Collection",value:"articles"},{label:"Documents Collection",value:"documents"},{label:"Knowledge Base",value:"knowledge-base"},{label:"Research",value:"research"},{label:"Projects",value:"projects"}];function L(){t(2,u=!1),t(3,p=null),t(4,m=!1),t(5,d=""),t(6,_=""),t(7,h=!1),t(8,g=(i==null?void 0:i.title)||""),t(9,b=(i==null?void 0:i.description)||`Article saved from Terraphim search: ${i==null?void 0:i.title}`),t(10,w=[]),t(11,v="")}function K(){var H;const F=r,q=o;if(!(q!=null&&q.roles)||!F){console.warn("No role configuration found");return}let ne=null;try{for(const[Q,oe]of Object.entries(q.roles)){const se=oe,ve=typeof se.name=="object"?se.name.original:String(se.name);if(Q===F||ve===F){ne=se;break}}}catch(Q){console.warn("Error checking role configuration:",Q);return}if(!ne){console.warn(`Role "${F}" not found in configuration`);return}t(10,w=((H=ne.haystacks)==null?void 0:H.filter(Q=>Q.service==="Atomic"&&Q.location&&!Q.read_only))||[]),w.length>0&&t(11,v=w[0].location),console.log("Loaded atomic servers:",w)}function z(){const F=w.find(q=>q.location===v);return F==null?void 0:F.atomic_server_secret}function R(){const F=v.replace(/\/$/,"");if(h&&_.trim()){const q=_.trim();return q.startsWith("http://")||q.startsWith("https://")?q:`${F}/${q.replace(/^\//,"")}`}else return d?`${F}/${d}`:F}function T(){return g.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,50)}function U(){const F=v.replace(/\/$/,""),q=T(),ne=Date.now();return`${F}/${q}-${ne}`}async function I(){if(!v||!g.trim()){t(3,p="Please select an atomic server and provide a title");return}t(2,u=!0),t(3,p=null);try{const F=U(),q=R(),ne=z();console.log("🔄 Saving article to atomic server:",{subject:F,parent:q,server:v,hasSecret:!!ne});const H={subject:F,title:g.trim(),description:b.trim(),body:i.body,parent:q,shortname:T(),original_id:i.id,original_url:i.url,original_rank:i.rank,tags:i.tags||[]};if(n)await Pe("save_article_to_atomic",{article:H,serverUrl:v,atomicSecret:ne});else{const Q=await fetch(`${tt.ServerURL}/atomic/save`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({article:H,server_url:v,atomic_secret:ne})});if(!Q.ok){const oe=await Q.json().catch(()=>({error:Q.statusText}));throw new Error(oe.error||`HTTP ${Q.status}: ${Q.statusText}`)}}t(4,m=!0),console.log("✅ Article saved successfully to atomic server"),setTimeout(()=>{t(0,s=!1)},2e3)}catch(F){console.error("❌ Failed to save article to atomic server:",F),t(3,p=F.message||"Failed to save article to atomic server")}finally{t(2,u=!1)}}function V(){u||t(0,s=!1)}const J=[[]];function j(){v=kt(this),t(11,v),t(10,w)}function C(F){g=F,t(8,g)}function Y(){b=this.value,t(9,b)}function O(){h=this.__value,t(7,h)}function P(){h=this.__value,t(7,h)}function E(){d=kt(this),t(5,d),t(13,k)}function D(F){_=F,t(6,_)}function W(F){s=F,t(0,s)}return l.$$set=F=>{"active"in F&&t(0,s=F.active),"document"in F&&t(1,i=F.document)},l.$$.update=()=>{l.$$.dirty[0]&3&&s&&i&&(L(),K())},[s,i,u,p,m,d,_,h,g,b,w,v,r,k,R,U,I,V,j,C,Y,O,J,P,E,D,W]}class ts extends xe{constructor(e){super(),et(this,e,es,xo,Ze,{active:0,document:1},null,[-1,-1])}}async function $n(l){return Pe("tauri",l)}async function ls(l,e){return $n({__tauriModule:"Event",message:{cmd:"unlisten",event:l,eventId:e}})}async function ns(l,e,t){return $n({__tauriModule:"Event",message:{cmd:"listen",event:l,windowLabel:e,handler:Zt(t)}}).then(n=>async()=>ls(l,n))}var El;(function(l){l.WINDOW_RESIZED="tauri://resize",l.WINDOW_MOVED="tauri://move",l.WINDOW_CLOSE_REQUESTED="tauri://close-requested",l.WINDOW_CREATED="tauri://window-created",l.WINDOW_DESTROYED="tauri://destroyed",l.WINDOW_FOCUS="tauri://focus",l.WINDOW_BLUR="tauri://blur",l.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",l.WINDOW_THEME_CHANGED="tauri://theme-changed",l.WINDOW_FILE_DROP="tauri://file-drop",l.WINDOW_FILE_DROP_HOVER="tauri://file-drop-hover",l.WINDOW_FILE_DROP_CANCELLED="tauri://file-drop-cancelled",l.MENU="tauri://menu",l.CHECK_UPDATE="tauri://update",l.UPDATE_AVAILABLE="tauri://update-available",l.INSTALL_UPDATE="tauri://update-install",l.STATUS_UPDATE="tauri://update-status",l.DOWNLOAD_PROGRESS="tauri://update-download-progress"})(El||(El={}));async function os(l,e){return ns(l,null,e)}function Nl(l,e,t){const n=l.slice();return n[9]=e[t],n}function Ul(l){let e,t=l[9].name+"",n,o;return{c(){e=f("option"),n=Z(t),e.__value=o=l[9].name,e.value=e.__value},m(r,s){S(r,e,s),a(e,n)},p(r,s){s&1&&t!==(t=r[9].name+"")&&Se(n,t),s&1&&o!==(o=r[9].name)&&(e.__value=o,e.value=e.__value)},d(r){r&&y(e)}}}function ss(l){let e,t,n,o,r,s,i=l[0],u=[];for(let p=0;p<i.length;p+=1)u[p]=Ul(Nl(l,i,p));return{c(){e=f("div"),t=f("div"),n=f("div"),o=f("select");for(let p=0;p<u.length;p+=1)u[p].c();c(n,"class","select"),c(t,"class","control"),c(e,"class","field is-grouped is-grouped-right")},m(p,m){S(p,e,m),a(e,t),a(t,n),a(n,o);for(let d=0;d<u.length;d+=1)u[d]&&u[d].m(o,null);De(o,l[1]),r||(s=X(o,"change",l[2]),r=!0)},p(p,[m]){if(m&1){i=p[0];let d;for(d=0;d<i.length;d+=1){const _=Nl(p,i,d);u[d]?u[d].p(_,m):(u[d]=Ul(_),u[d].c(),u[d].m(o,null))}for(;d<u.length;d+=1)u[d].d(1);u.length=i.length}m&3&&De(o,p[1])},i:ge,o:ge,d(p){p&&y(e),ot(u,p),r=!1,s()}}}function rs(l,e,t){let n,o,r,s;he(l,Xe,_=>t(5,n=_)),he(l,Qe,_=>t(6,o=_)),he(l,dl,_=>t(0,r=_)),he(l,_t,_=>t(1,s=_));let i="";async function u(){try{Qe.set(window.__TAURI__!==void 0),o?(console.log("Loading config from Tauri"),Pe("get_config").then(_=>{console.log("get_config response",_),_&&_.status==="success"&&p(_.config)}).catch(_=>console.error("Error fetching config in Tauri:",_))):(console.log("Loading config from server"),i=`${tt.ServerURL}/config/`,fetch(i).then(_=>_.json()).then(_=>{console.log("Config received",_),_&&_.status==="success"&&p(_.config)}).catch(_=>console.error("Error fetching config:",_)))}catch(_){console.error("Unhandled error in loadConfig:",_)}}function p(_){var w;console.log("Updating stores from config:",_);const h={default_role:_.selected_role,..._};Xe.set(h);const g=Object.entries(_.roles).map(([v,k])=>({name:v,...k}));dl.set(g),_t.set(_.selected_role);const b=_.roles[_.selected_role];if(console.log("Selected role settings:",b),b){const v=b.theme||"spacelab";console.log("Setting theme to:",v),Pt.set(v),(w=b.kg)!=null&&w.publish?o&&Pe("publish_thesaurus",{role_name:_.selected_role}).then(k=>{console.log("publish_thesaurus response",k),Qt.set(k),Dt.set(!0)}):Dt.set(!1)}else console.warn("No role settings found for:",_.selected_role),Pt.set("spacelab")}typeof window<"u"&&window.__TAURI__&&os("role_changed",_=>{console.log("Role changed event received from backend:",_.payload),p(_.payload)});async function m(){await u()}m(),console.log("Using Terraphim Server URL:",tt.ServerURL);function d(_){var v;const g=_.target.value;console.log("Role change requested:",g),_t.set(g);const b=r.find(k=>k.name===g);if(!b){console.error(`No role settings found for role: ${g}.`);return}const w=b.theme||"spacelab";Pt.set(w),console.log(`Theme changed to ${w}`),Xe.update(k=>(k.selected_role=g,k)),o?(Pe("select_role",{role_name:g}).catch(k=>console.error("Error selecting role:",k)),(v=b.kg)!=null&&v.publish?(console.log("Publishing thesaurus for role",g),Pe("publish_thesaurus",{role_name:g}).then(k=>{Qt.set(k),Dt.set(!0)})):Dt.set(!1)):fetch(`${tt.ServerURL}/config/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).catch(k=>console.error("Error updating config on server:",k))}return[r,s,d,u]}class Kt extends xe{constructor(e){super(),et(this,e,rs,ss,Ze,{loadConfig:3})}get loadConfig(){return this.$$.ctx[3]}}function Ml(l,e,t){const n=l.slice();return n[29]=e[t],n}function Dl(l){let e,t;return e=new gn({props:{$$slots:{default:[as]},$$scope:{ctx:l}}}),{c(){ee(e.$$.fragment)},m(n,o){te(e,n,o),t=!0},p(n,o){const r={};o[0]&129|o[1]&2&&(r.$$scope={dirty:o,ctx:n}),e.$set(r)},i(n){t||(A(e.$$.fragment,n),t=!0)},o(n){M(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function is(l){let e=l[29]+"",t;return{c(){t=Z(e)},m(n,o){S(n,t,o)},p(n,o){o[0]&1&&e!==(e=n[29]+"")&&Se(t,e)},d(n){n&&y(t)}}}function Pl(l){let e,t,n,o,r,s;t=new hn({props:{rounded:!0,$$slots:{default:[is]},$$scope:{ctx:l}}});function i(){return l[18](l[29])}return{c(){e=f("button"),ee(t.$$.fragment),n=$(),c(e,"class","tag-button svelte-2smypa"),e.disabled=l[7],c(e,"title","Click to view knowledge graph document")},m(u,p){S(u,e,p),te(t,e,null),a(e,n),o=!0,r||(s=X(e,"click",i),r=!0)},p(u,p){l=u;const m={};p[0]&1|p[1]&2&&(m.$$scope={dirty:p,ctx:l}),t.$set(m),(!o||p[0]&128)&&(e.disabled=l[7])},i(u){o||(A(t.$$.fragment,u),o=!0)},o(u){M(t.$$.fragment,u),o=!1},d(u){u&&y(e),le(t),r=!1,s()}}}function as(l){let e,t,n=l[0].tags,o=[];for(let s=0;s<n.length;s+=1)o[s]=Pl(Ml(l,n,s));const r=s=>M(o[s],1,1,()=>{o[s]=null});return{c(){for(let s=0;s<o.length;s+=1)o[s].c();e=rt()},m(s,i){for(let u=0;u<o.length;u+=1)o[u]&&o[u].m(s,i);S(s,e,i),t=!0},p(s,i){if(i[0]&65665){n=s[0].tags;let u;for(u=0;u<n.length;u+=1){const p=Ml(s,n,u);o[u]?(o[u].p(p,i),A(o[u],1)):(o[u]=Pl(p),o[u].c(),A(o[u],1),o[u].m(e.parentNode,e))}for(Ae(),u=n.length;u<o.length;u+=1)r(u);Oe()}},i(s){if(!t){for(let i=0;i<n.length;i+=1)A(o[i]);t=!0}},o(s){o=o.filter(Boolean);for(let i=0;i<o.length;i+=1)M(o[i]);t=!1},d(s){ot(o,s),s&&y(e)}}}function us(l){let e,t=l[0].rank+"",n;return{c(){e=Z("Rank "),n=Z(t)},m(o,r){S(o,e,r),S(o,n,r)},p(o,r){r[0]&1&&t!==(t=o[0].rank+"")&&Se(n,t)},d(o){o&&y(e),o&&y(n)}}}function cs(l){let e,t;return e=new hn({props:{rounded:!0,$$slots:{default:[us]},$$scope:{ctx:l}}}),{c(){ee(e.$$.fragment)},m(n,o){te(e,n,o),t=!0},p(n,o){const r={};o[0]&1|o[1]&2&&(r.$$scope={dirty:o,ctx:n}),e.$set(r)},i(n){t||(A(e.$$.fragment,n),t=!0)},o(n){M(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function fs(l){let e;return{c(){e=f("small"),e.textContent="No description available",c(e,"class","no-description svelte-2smypa")},m(t,n){S(t,e,n)},p:ge,i:ge,o:ge,d(t){t&&y(e)}}}function ps(l){let e,t;return e=new zt({props:{source:l[0].description}}),{c(){ee(e.$$.fragment)},m(n,o){te(e,n,o),t=!0},p(n,o){const r={};o[0]&1&&(r.source=n[0].description),e.$set(r)},i(n){t||(A(e.$$.fragment,n),t=!0)},o(n){M(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function jl(l){let e,t,n,o,r,s;return{c(){e=f("button"),t=f("span"),t.innerHTML='<i class="fas fa-magic" aria-hidden="true"></i>',n=$(),o=f("span"),o.textContent="AI Summary",c(t,"class","icon is-small"),c(e,"class","button is-small is-info is-outlined ai-summary-button svelte-2smypa"),e.disabled=l[9],c(e,"title","Generate AI-powered summary using OpenRouter")},m(i,u){S(i,e,u),a(e,t),a(e,n),a(e,o),r||(s=X(e,"click",l[17]),r=!0)},p(i,u){u[0]&512&&(e.disabled=i[9])},d(i){i&&y(e),r=!1,s()}}}function Hl(l){let e;return{c(){e=f("div"),e.innerHTML=`<span class="icon"><i class="fas fa-spinner fa-spin" aria-hidden="true"></i></span> 
                <small>Generating AI summary...</small>`,c(e,"class","ai-summary-loading svelte-2smypa")},m(t,n){S(t,e,n)},d(t){t&&y(e)}}}function Il(l){let e,t,n,o,r,s,i,u,p,m;return{c(){e=f("div"),t=f("span"),t.innerHTML='<i class="fas fa-exclamation-triangle" aria-hidden="true"></i>',n=$(),o=f("small"),r=Z("Summary error: "),s=Z(l[10]),i=$(),u=f("button"),u.textContent="Retry",c(t,"class","icon has-text-danger"),c(o,"class","has-text-danger"),c(u,"class","button is-small is-text svelte-2smypa"),c(u,"title","Retry generating summary"),c(e,"class","ai-summary-error svelte-2smypa")},m(d,_){S(d,e,_),a(e,t),a(e,n),a(e,o),a(o,r),a(o,s),a(e,i),a(e,u),p||(m=X(u,"click",l[19]),p=!0)},p(d,_){_[0]&1024&&Se(s,d[10])},d(d){d&&y(e),p=!1,m()}}}function Fl(l){let e,t,n,o,r,s,i,u,p,m,d,_,h,g,b,w,v,k,L,K;function z(U,I){return U[12]?_s:ds}let R=z(l),T=R(l);return m=new zt({props:{source:l[8]}}),{c(){e=f("div"),t=f("div"),n=f("small"),o=f("span"),o.innerHTML='<i class="fas fa-robot" aria-hidden="true"></i>',r=Z(`
                    AI Summary
                    `),T.c(),s=$(),i=f("button"),i.innerHTML='<span class="icon is-small"><i class="fas fa-times" aria-hidden="true"></i></span>',u=$(),p=f("div"),ee(m.$$.fragment),d=$(),_=f("div"),h=f("button"),g=f("span"),g.innerHTML='<i class="fas fa-redo" aria-hidden="true"></i>',b=$(),w=f("span"),w.textContent="Regenerate",c(o,"class","icon is-small"),c(n,"class","ai-summary-label svelte-2smypa"),c(i,"class","button is-small is-text svelte-2smypa"),c(i,"title","Hide AI summary"),c(t,"class","ai-summary-header svelte-2smypa"),c(p,"class","ai-summary-content svelte-2smypa"),c(g,"class","icon is-small"),c(h,"class","button is-small is-text svelte-2smypa"),h.disabled=l[9],c(h,"title","Regenerate summary"),c(_,"class","ai-summary-actions svelte-2smypa"),c(e,"class","ai-summary svelte-2smypa")},m(U,I){S(U,e,I),a(e,t),a(t,n),a(n,o),a(n,r),T.m(n,null),a(t,s),a(t,i),a(e,u),a(e,p),te(m,p,null),a(e,d),a(e,_),a(_,h),a(h,g),a(h,b),a(h,w),k=!0,L||(K=[X(i,"click",l[20]),X(h,"click",l[21])],L=!0)},p(U,I){R!==(R=z(U))&&(T.d(1),T=R(U),T&&(T.c(),T.m(n,null)));const V={};I[0]&256&&(V.source=U[8]),m.$set(V),(!k||I[0]&512)&&(h.disabled=U[9])},i(U){k||(A(m.$$.fragment,U),nt(()=>{k&&(v||(v=Ot(e,Et,{},!0)),v.run(1))}),k=!0)},o(U){M(m.$$.fragment,U),v||(v=Ot(e,Et,{},!1)),v.run(0),k=!1},d(U){U&&y(e),T.d(),le(m),U&&v&&v.end(),L=!1,qe(K)}}}function ds(l){let e;return{c(){e=f("span"),e.textContent="fresh",c(e,"class","tag is-small is-success")},m(t,n){S(t,e,n)},d(t){t&&y(e)}}}function _s(l){let e;return{c(){e=f("span"),e.textContent="cached",c(e,"class","tag is-small is-light")},m(t,n){S(t,e,n)},d(t){t&&y(e)}}}function Gl(l){let e,t,n;return{c(){e=f("a"),t=f("span"),t.innerHTML='<i class="fas fa-link"></i>',c(t,"class","icon is-medium"),c(e,"href",n=l[0].url),c(e,"target","_blank"),c(e,"class","level-item"),c(e,"aria-label","URL")},m(o,r){S(o,e,r),a(e,t)},p(o,r){r[0]&1&&n!==(n=o[0].url)&&c(e,"href",n)},d(o){o&&y(e)}}}function Kl(l){let e,t,n;return{c(){e=f("button"),e.innerHTML='<span class="icon is-medium has-text-primary"><i class="fas fa-cloud-upload-alt" aria-hidden="true"></i></span>',c(e,"type","button"),c(e,"class","level-item button is-ghost svelte-2smypa"),c(e,"aria-label","Save to Atomic Server"),c(e,"title","Save article to Atomic Server")},m(o,r){S(o,e,r),t||(n=X(e,"click",l[15]),t=!0)},p:ge,d(o){o&&y(e),t=!1,n()}}}function Wl(l){let e,t,n;function o(s){l[23](s)}let r={item:l[4],kgTerm:l[5],kgRank:l[6]};return l[2]!==void 0&&(r.active=l[2]),e=new tl({props:r}),Ee.push(()=>je(e,"active",o)),{c(){ee(e.$$.fragment)},m(s,i){te(e,s,i),n=!0},p(s,i){const u={};i[0]&16&&(u.item=s[4]),i[0]&32&&(u.kgTerm=s[5]),i[0]&64&&(u.kgRank=s[6]),!t&&i[0]&4&&(t=!0,u.active=s[2],He(()=>t=!1)),e.$set(u)},i(s){n||(A(e.$$.fragment,s),n=!0)},o(s){M(e.$$.fragment,s),n=!1},d(s){le(e,s)}}}function ql(l){let e,t,n;function o(s){l[24](s)}let r={document:l[0]};return l[3]!==void 0&&(r.active=l[3]),e=new ts({props:r}),Ee.push(()=>je(e,"active",o)),{c(){ee(e.$$.fragment)},m(s,i){te(e,s,i),n=!0},p(s,i){const u={};i[0]&1&&(u.document=s[0]),!t&&i[0]&8&&(t=!0,u.active=s[3],He(()=>t=!1)),e.$set(u)},i(s){n||(A(e.$$.fragment,s),n=!0)},o(s){M(e.$$.fragment,s),n=!1},d(s){le(e,s)}}}function ms(l){let e,t,n,o,r,s,i,u,p,m,d,_,h=l[0].title+"",g,b,w,v,k,L,K,z,R,T,U,I,V,J,j,C,Y,O,P,E,D,W,F,q,ne,H,Q,oe,se,ve,Ne,Re,de,N,B,ie,_e,re=l[0].tags&&Dl(l);u=new gn({props:{$$slots:{default:[cs]},$$scope:{ctx:l}}});const ae=[ps,fs],Le=[];function Me(G,ce){return G[0].description?0:1}K=Me(l),z=Le[K]=ae[K](l);let ke=!l[11]&&!l[9]&&!l[10]&&jl(l),$e=l[9]&&Hl(),be=l[10]&&Il(l),me=l[11]&&l[8]&&Fl(l),we="url"in l[0]&&Gl(l),ye=l[13]&&Kl(l);function Be(G){l[22](G)}let Ie={item:l[0]};l[1]!==void 0&&(Ie.active=l[1]),ve=new tl({props:Ie}),Ee.push(()=>je(ve,"active",Be));let Te=l[4]&&Wl(l),pe=l[13]&&ql(l);return{c(){e=f("div"),t=f("article"),n=f("div"),o=f("div"),r=f("div"),re&&re.c(),s=$(),i=f("div"),ee(u.$$.fragment),p=$(),m=f("div"),d=f("button"),_=f("h2"),g=Z(h),b=$(),w=f("div"),v=f("small"),v.textContent="Description:",k=$(),L=f("div"),z.c(),R=$(),T=f("div"),ke&&ke.c(),U=$(),$e&&$e.c(),I=$(),be&&be.c(),V=$(),me&&me.c(),J=$(),j=f("br"),Y=$(),O=f("div"),P=f("nav"),E=f("div"),we&&we.c(),D=$(),W=f("button"),W.innerHTML='<span class="icon is-medium"><i class="fas fa-plus" aria-hidden="true"></i></span>',F=$(),ye&&ye.c(),q=$(),ne=f("a"),H=f("span"),H.innerHTML='<i class="fas fa-code" aria-hidden="true"></i>',se=$(),ee(ve.$$.fragment),Re=$(),Te&&Te.c(),de=$(),pe&&pe.c(),N=rt(),c(r,"class","level-right"),c(i,"class","level-right"),c(_,"class","title svelte-2smypa"),c(d,"class","svelte-2smypa"),c(v,"class","description-label svelte-2smypa"),c(L,"class","description-content svelte-2smypa"),c(w,"class","description svelte-2smypa"),c(T,"class","ai-summary-section svelte-2smypa"),c(o,"class","content"),c(W,"type","button"),c(W,"class","level-item button is-ghost svelte-2smypa"),c(W,"aria-label","Add to favorites"),c(H,"class","icon is-medium"),c(ne,"href",Q=`vscode://${encodeURIComponent(l[0].title)}.md?${encodeURIComponent(l[0].body)}`),c(ne,"class","level-item"),c(ne,"aria-label","Open in VSCode"),c(E,"class","level-right"),c(P,"class","level is-mobile"),c(O,"class","level-right"),c(n,"class","media-content"),c(t,"class","media"),c(e,"class","box")},m(G,ce){S(G,e,ce),a(e,t),a(t,n),a(n,o),a(o,r),re&&re.m(r,null),a(o,s),a(o,i),te(u,i,null),a(o,p),a(o,m),a(m,d),a(d,_),a(_,g),a(m,b),a(m,w),a(w,v),a(w,k),a(w,L),Le[K].m(L,null),a(m,R),a(m,T),ke&&ke.m(T,null),a(T,U),$e&&$e.m(T,null),a(T,I),be&&be.m(T,null),a(T,V),me&&me.m(T,null),a(m,J),a(m,j),a(n,Y),a(n,O),a(O,P),a(P,E),we&&we.m(E,null),a(E,D),a(E,W),a(E,F),ye&&ye.m(E,null),a(E,q),a(E,ne),a(ne,H),S(G,se,ce),te(ve,G,ce),S(G,Re,ce),Te&&Te.m(G,ce),S(G,de,ce),pe&&pe.m(G,ce),S(G,N,ce),B=!0,ie||(_e=[X(d,"click",l[14]),X(W,"click",gs)],ie=!0)},p(G,ce){G[0].tags?re?(re.p(G,ce),ce[0]&1&&A(re,1)):(re=Dl(G),re.c(),A(re,1),re.m(r,null)):re&&(Ae(),M(re,1,1,()=>{re=null}),Oe());const ze={};ce[0]&1|ce[1]&2&&(ze.$$scope={dirty:ce,ctx:G}),u.$set(ze),(!B||ce[0]&1)&&h!==(h=G[0].title+"")&&Se(g,h);let Je=K;K=Me(G),K===Je?Le[K].p(G,ce):(Ae(),M(Le[Je],1,1,()=>{Le[Je]=null}),Oe(),z=Le[K],z?z.p(G,ce):(z=Le[K]=ae[K](G),z.c()),A(z,1),z.m(L,null)),!G[11]&&!G[9]&&!G[10]?ke?ke.p(G,ce):(ke=jl(G),ke.c(),ke.m(T,U)):ke&&(ke.d(1),ke=null),G[9]?$e||($e=Hl(),$e.c(),$e.m(T,I)):$e&&($e.d(1),$e=null),G[10]?be?be.p(G,ce):(be=Il(G),be.c(),be.m(T,V)):be&&(be.d(1),be=null),G[11]&&G[8]?me?(me.p(G,ce),ce[0]&2304&&A(me,1)):(me=Fl(G),me.c(),A(me,1),me.m(T,null)):me&&(Ae(),M(me,1,1,()=>{me=null}),Oe()),"url"in G[0]?we?we.p(G,ce):(we=Gl(G),we.c(),we.m(E,D)):we&&(we.d(1),we=null),G[13]?ye?ye.p(G,ce):(ye=Kl(G),ye.c(),ye.m(E,q)):ye&&(ye.d(1),ye=null),(!B||ce[0]&1&&Q!==(Q=`vscode://${encodeURIComponent(G[0].title)}.md?${encodeURIComponent(G[0].body)}`))&&c(ne,"href",Q);const ft={};ce[0]&1&&(ft.item=G[0]),!Ne&&ce[0]&2&&(Ne=!0,ft.active=G[1],He(()=>Ne=!1)),ve.$set(ft),G[4]?Te?(Te.p(G,ce),ce[0]&16&&A(Te,1)):(Te=Wl(G),Te.c(),A(Te,1),Te.m(de.parentNode,de)):Te&&(Ae(),M(Te,1,1,()=>{Te=null}),Oe()),G[13]?pe?(pe.p(G,ce),ce[0]&8192&&A(pe,1)):(pe=ql(G),pe.c(),A(pe,1),pe.m(N.parentNode,N)):pe&&(Ae(),M(pe,1,1,()=>{pe=null}),Oe())},i(G){B||(A(re),A(u.$$.fragment,G),A(z),A(me),nt(()=>{B&&(C||(C=Ot(m,Et,{},!0)),C.run(1))}),nt(()=>{B&&(oe||(oe=Ot(P,Et,{},!0)),oe.run(1))}),A(ve.$$.fragment,G),A(Te),A(pe),B=!0)},o(G){M(re),M(u.$$.fragment,G),M(z),M(me),C||(C=Ot(m,Et,{},!1)),C.run(0),oe||(oe=Ot(P,Et,{},!1)),oe.run(0),M(ve.$$.fragment,G),M(Te),M(pe),B=!1},d(G){G&&y(e),re&&re.d(),le(u),Le[K].d(),ke&&ke.d(),$e&&$e.d(),be&&be.d(),me&&me.d(),G&&C&&C.end(),we&&we.d(),ye&&ye.d(),G&&oe&&oe.end(),G&&y(se),le(ve,G),G&&y(Re),Te&&Te.d(G),G&&y(de),pe&&pe.d(G),G&&y(N),ie=!1,qe(_e)}}}const gs=()=>{};function hs(l,e,t){let n,o,r,s;he(l,_t,P=>t(25,o=P)),he(l,Qe,P=>t(26,r=P)),he(l,Xe,P=>t(27,s=P));let{document:i}=e,u=!1,p=!1,m=!1,d=null,_=null,h=null,g=!1,b=null,w=!1,v=null,k=!1,L=!1;function K(){var F;const P=o,E=s;if(!(E!=null&&E.roles)||!P)return!1;let D=null;try{for(const[q,ne]of Object.entries(E.roles)){const H=ne,Q=typeof H.name=="object"?H.name.original:String(H.name);if(q===P||Q===P){D=H;break}}}catch(q){return console.warn("Error checking role configuration:",q),!1}return D?(((F=D.haystacks)==null?void 0:F.filter(q=>q.service==="Atomic"&&q.location&&!q.read_only))||[]).length>0:!1}const z=()=>{t(1,u=!0)},R=()=>{console.log("🔄 Opening atomic save modal for document:",i.title),t(3,m=!0)};async function T(P){var E,D,W,F,q;t(7,g=!0),t(5,_=P),console.log("🔍 KG Search Debug Info:"),console.log("  Tag clicked:",P),console.log("  Current role:",o),console.log("  Is Tauri mode:",r);try{if(r){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{role_name:o,term:P});const ne=await Pe("find_documents_for_kg_term",{role_name:o,term:P});console.log("  📥 Tauri response received:"),console.log("    Status:",ne.status),console.log("    Results count:",((E=ne.results)==null?void 0:E.length)||0),console.log("    Total:",ne.total||0),console.log("    Full response:",JSON.stringify(ne,null,2)),ne.status==="success"&&ne.results&&ne.results.length>0?(t(4,d=ne.results[0]),t(6,h=d.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",d.title),console.log("    Rank:",h),console.log("    Body length:",((D=d.body)==null?void 0:D.length)||0,"characters"),t(2,p=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${P}" in role: "${o}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const ne=tt.ServerURL,H=encodeURIComponent(o),Q=encodeURIComponent(P),oe=`${ne}/roles/${H}/kg_search?term=${Q}`;console.log("  📤 HTTP Request details:"),console.log("    Base URL:",ne),console.log("    Role (encoded):",H),console.log("    Term (encoded):",Q),console.log("    Full URL:",oe);const se=await fetch(oe);if(console.log("  📥 HTTP Response received:"),console.log("    Status code:",se.status),console.log("    Status text:",se.statusText),console.log("    Headers:",Object.fromEntries(se.headers.entries())),!se.ok)throw new Error(`HTTP error! Status: ${se.status} - ${se.statusText}`);const ve=await se.json();console.log("  📄 Response data:"),console.log("    Status:",ve.status),console.log("    Results count:",((W=ve.results)==null?void 0:W.length)||0),console.log("    Total:",ve.total||0),console.log("    Full response:",JSON.stringify(ve,null,2)),ve.status==="success"&&ve.results&&ve.results.length>0?(t(4,d=ve.results[0]),t(6,h=d.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",d.title),console.log("    Rank:",h),console.log("    Body length:",((F=d.body)==null?void 0:F.length)||0,"characters"),t(2,p=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${P}" in role: "${o}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",oe))}}catch(ne){console.error("❌ Error fetching KG document:"),console.error("  Error type:",ne.constructor.name),console.error("  Error message:",ne.message||ne),console.error("  Request details:",{tag:P,role:o,isTauri:r,timestamp:new Date().toISOString()}),!r&&((q=ne.message)!=null&&q.includes("Failed to fetch"))&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{t(7,g=!1)}}async function U(){var P;if(!(w||!i.id||!o)){t(9,w=!0),t(10,v=null),console.log("🤖 AI Summary Debug Info:"),console.log("  Document ID:",i.id),console.log("  Current role:",o),console.log("  Is Tauri mode:",r);try{const E={document_id:i.id,role:o,max_length:250,force_regenerate:!1};console.log("  📤 Summarization request:",E);let D;if(r){const q=`${tt.ServerURL}/documents/summarize`;D=await fetch(q,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(E)})}else{const q=`${tt.ServerURL}/documents/summarize`;D=await fetch(q,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(E)})}if(console.log("  📥 Summary response received:"),console.log("    Status code:",D.status),console.log("    Status text:",D.statusText),!D.ok)throw new Error(`HTTP error! Status: ${D.status} - ${D.statusText}`);const W=await D.json();console.log("  📄 Summary response data:",W),W.status==="Success"&&W.summary?(t(8,b=W.summary),t(12,L=W.from_cache||!1),t(11,k=!0),console.log("  ✅ Summary generated successfully"),console.log("    Summary length:",b.length,"characters"),console.log("    From cache:",L),console.log("    Model used:",W.model_used)):(t(10,v=W.error||"Failed to generate summary"),console.error("  ❌ Summary generation failed:",v))}catch(E){console.error("❌ Error generating summary:"),console.error("  Error type:",E.constructor.name),console.error("  Error message:",E.message||E),console.error("  Request details:",{document_id:i.id,role:o,isTauri:r,timestamp:new Date().toISOString()}),t(10,v=E.message||"Network error occurred"),(P=E.message)!=null&&P.includes("Failed to fetch")&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Verify OpenRouter is enabled for this role"),console.error("    3. Check OPENROUTER_KEY environment variable"),console.error("    4. Verify server URL in CONFIG.ServerURL"))}finally{t(9,w=!1)}}}Kt[o]!==void 0&&(console.log("Have attribute",Kt[o]),Kt[o].hasOwnProperty("enableLogseq")?console.log("enable logseq True"):console.log("Didn't make it"));const I=P=>T(P),V=()=>{t(10,v=null),U()},J=()=>t(11,k=!1),j=()=>{U()};function C(P){u=P,t(1,u)}function Y(P){p=P,t(2,p)}function O(P){m=P,t(3,m)}return l.$$set=P=>{"document"in P&&t(0,i=P.document)},t(13,n=K()),[i,u,p,m,d,_,h,g,b,w,v,k,L,n,z,R,T,U,I,V,J,j,C,Y,O]}class vs extends xe{constructor(e){super(),et(this,e,hs,ms,Ze,{document:0},null,[-1,-1])}}const bs="/assets/terraphim_gray.png";function Bl(l,e,t){const n=l.slice();return n[19]=e[t],n}function zl(l,e,t){const n=l.slice();return n[22]=e[t],n[24]=t,n}function Jl(l){let e,t=l[2],n=[];for(let o=0;o<t.length;o+=1)n[o]=Vl(zl(l,t,o));return{c(){e=f("ul");for(let o=0;o<n.length;o+=1)n[o].c();c(e,"class","suggestions svelte-13t09eu")},m(o,r){S(o,e,r);for(let s=0;s<n.length;s+=1)n[s]&&n[s].m(e,null)},p(o,r){if(r&524){t=o[2];let s;for(s=0;s<t.length;s+=1){const i=zl(o,t,s);n[s]?n[s].p(i,r):(n[s]=Vl(i),n[s].c(),n[s].m(e,null))}for(;s<n.length;s+=1)n[s].d(1);n.length=t.length}},d(o){o&&y(e),ot(n,o)}}}function Vl(l){let e,t=l[22]+"",n,o,r,s,i,u;function p(){return l[13](l[22])}function m(...d){return l[14](l[22],...d)}return{c(){e=f("li"),n=Z(t),o=$(),c(e,"tabindex","0"),c(e,"role","option"),c(e,"aria-selected",r=l[24]===l[3]),c(e,"aria-label",s=`Apply suggestion: ${l[22]}`),c(e,"class","svelte-13t09eu"),qt(e,"active",l[24]===l[3])},m(d,_){S(d,e,_),a(e,n),a(e,o),i||(u=[X(e,"click",p),X(e,"keydown",m)],i=!0)},p(d,_){l=d,_&4&&t!==(t=l[22]+"")&&Se(n,t),_&8&&r!==(r=l[24]===l[3])&&c(e,"aria-selected",r),_&4&&s!==(s=`Apply suggestion: ${l[22]}`)&&c(e,"aria-label",s),_&8&&qt(e,"active",l[24]===l[3])},d(d){d&&y(e),i=!1,qe(u)}}}function ks(l){let e,t,n,o,r;function s(p){l[12](p)}let i={type:"search",placeholder:l[6]?`Search over Knowledge graph for ${l[4]}`:"Search",icon:"search",expanded:!0,autofocus:!0};l[5]!==void 0&&(i.value=l[5]),t=new wt({props:i}),Ee.push(()=>je(t,"value",s)),t.$on("click",l[10]),t.$on("submit",l[10]),t.$on("keydown",l[8]),t.$on("input",l[7]);let u=l[2].length>0&&Jl(l);return{c(){e=f("div"),ee(t.$$.fragment),o=$(),u&&u.c(),c(e,"class","input-wrapper svelte-13t09eu")},m(p,m){S(p,e,m),te(t,e,null),a(e,o),u&&u.m(e,null),r=!0},p(p,m){const d={};m&80&&(d.placeholder=p[6]?`Search over Knowledge graph for ${p[4]}`:"Search"),!n&&m&32&&(n=!0,d.value=p[5],He(()=>n=!1)),t.$set(d),p[2].length>0?u?u.p(p,m):(u=Jl(p),u.c(),u.m(e,null)):u&&(u.d(1),u=null)},i(p){r||(A(t.$$.fragment,p),r=!0)},o(p){M(t.$$.fragment,p),r=!1},d(p){p&&y(e),le(t),u&&u.d()}}}function $s(l){let e,t,n,o,r,s;return{c(){e=f("section"),t=f("div"),n=f("img"),r=$(),s=f("p"),s.textContent="I am Terraphim, your personal assistant.",In(n.src,o=bs)||c(n,"src",o),c(n,"alt","Terraphim Logo"),c(n,"class","svelte-13t09eu"),c(t,"class","content has-text-grey has-text-centered svelte-13t09eu"),c(e,"class","section")},m(i,u){S(i,e,u),a(e,t),a(t,n),a(t,r),a(t,s)},p:ge,i:ge,o:ge,d(i){i&&y(e)}}}function ws(l){let e,t,n=l[0],o=[];for(let s=0;s<n.length;s+=1)o[s]=Yl(Bl(l,n,s));const r=s=>M(o[s],1,1,()=>{o[s]=null});return{c(){for(let s=0;s<o.length;s+=1)o[s].c();e=rt()},m(s,i){for(let u=0;u<o.length;u+=1)o[u]&&o[u].m(s,i);S(s,e,i),t=!0},p(s,i){if(i&1){n=s[0];let u;for(u=0;u<n.length;u+=1){const p=Bl(s,n,u);o[u]?(o[u].p(p,i),A(o[u],1)):(o[u]=Yl(p),o[u].c(),A(o[u],1),o[u].m(e.parentNode,e))}for(Ae(),u=n.length;u<o.length;u+=1)r(u);Oe()}},i(s){if(!t){for(let i=0;i<n.length;i+=1)A(o[i]);t=!0}},o(s){o=o.filter(Boolean);for(let i=0;i<o.length;i+=1)M(o[i]);t=!1},d(s){ot(o,s),s&&y(e)}}}function ys(l){let e,t;return{c(){e=f("p"),t=Z(l[1]),c(e,"class","error svelte-13t09eu")},m(n,o){S(n,e,o),a(e,t)},p(n,o){o&2&&Se(t,n[1])},i:ge,o:ge,d(n){n&&y(e)}}}function Yl(l){let e,t;return e=new vs({props:{document:l[19]}}),{c(){ee(e.$$.fragment)},m(n,o){te(e,n,o),t=!0},p(n,o){const r={};o&1&&(r.document=n[19]),e.$set(r)},i(n){t||(A(e.$$.fragment,n),t=!0)},o(n){M(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function Ss(l){let e,t,n,o,r,s,i,u,p;t=new dt({props:{$$slots:{default:[ks]},$$scope:{ctx:l}}});const m=[ys,ws,$s],d=[];function _(h,g){return h[1]?0:h[0].length?1:2}return o=_(l),r=d[o]=m[o](l),{c(){e=f("form"),ee(t.$$.fragment),n=$(),r.c(),s=rt()},m(h,g){S(h,e,g),te(t,e,null),S(h,n,g),d[o].m(h,g),S(h,s,g),i=!0,u||(p=X(e,"submit",jn(l[10])),u=!0)},p(h,[g]){const b={};g&33554556&&(b.$$scope={dirty:g,ctx:h}),t.$set(b);let w=o;o=_(h),o===w?d[o].p(h,g):(Ae(),M(d[w],1,1,()=>{d[w]=null}),Oe(),r=d[o],r?r.p(h,g):(r=d[o]=m[o](h),r.c()),A(r,1),r.m(s.parentNode,s))},i(h){i||(A(t.$$.fragment,h),A(r),i=!0)},o(h){M(t.$$.fragment,h),M(r),i=!1},d(h){h&&y(e),le(t),h&&y(n),d[o].d(h),h&&y(s),u=!1,p()}}}function Cs(l,e,t){let n,o,r,s,i,u,p;he(l,so,R=>t(16,o=R)),he(l,_t,R=>t(4,r=R)),he(l,Yt,R=>t(5,s=R)),he(l,Qe,R=>t(17,i=R)),he(l,Qt,R=>t(11,u=R)),he(l,Dt,R=>t(6,p=R));let m=[],d=null,_=[],h=-1;function g(R){const T=R.trim().toLowerCase();return T.length===0?[]:n.filter(([I])=>I.toLowerCase().includes(T)).map(([I])=>I).slice(0,5)}function b(R){const T=R.target;if(!T||T.selectionStart==null)return;const U=T.selectionStart,V=s.slice(0,U).split(/\s+/),J=V[V.length-1];t(2,_=g(J)),t(3,h=-1)}function w(R){_.length!==0&&(R.key==="ArrowDown"?(R.preventDefault(),t(3,h=(h+1)%_.length)):R.key==="ArrowUp"?(R.preventDefault(),t(3,h=(h-1+_.length)%_.length)):(R.key==="Enter"||R.key==="Tab")&&h!==-1&&(R.preventDefault(),v(_[h])))}function v(R){var j;const T=document.querySelector('input[type="search"]'),U=(T==null?void 0:T.selectionStart)??0,I=s.slice(0,U),V=s.slice(U),J=I.split(/\s+/);J[J.length-1]=R,Hn(Yt,s=[...J,V].join(" "),s),(j=T==null?void 0:T.setSelectionRange)==null||j.call(T,U+R.length,U+R.length),t(2,_=[]),t(3,h=-1)}async function k(){if(t(1,d=null),i)try{const R=await Pe("search",{searchQuery:{search_term:s,skip:0,limit:10,role:r}});R.status==="success"?(t(0,m=R.results),console.log("Response results"),console.log(m)):(t(1,d=`Search failed: ${R.status}`),console.error("Search failed:",R))}catch(R){t(1,d=`Error in Tauri search: ${R}`),console.error("Error in Tauri search:",R)}else{if(!s.trim())return;const R=JSON.stringify({search_term:s,skip:0,limit:10,role:r});try{const T=await fetch(o,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:R}),U=await T.json();if(!T.ok)throw new Error(`HTTP error! Status: ${T.status}`);t(0,m=U.results)}catch(T){console.error("Error fetching data:",T),t(1,d=`Error fetching data: ${T}`)}}}function L(R){s=R,Yt.set(s)}const K=R=>v(R),z=(R,T)=>{(T.key==="Enter"||T.key===" ")&&(T.preventDefault(),v(R))};return l.$$.update=()=>{l.$$.dirty&2048&&(n=Object.entries(u))},[m,d,_,h,r,s,p,b,w,v,k,u,L,K,z]}class Ts extends xe{constructor(e){super(),et(this,e,Cs,Ss,Ze,{})}}function Ql(l,e,t){const n=l.slice();return n[47]=e[t],n[48]=e,n[49]=t,n}function Zl(l,e,t){const n=l.slice();return n[50]=e[t],n[51]=e,n[52]=t,n}function Xl(l,e,t){const n=l.slice();return n[53]=e[t][0],n[54]=e[t][1],n[55]=e,n[56]=t,n}function xl(l,e,t){const n=l.slice();return n[44]=e[t],n}function Rs(l){let e,t,n,o=JSON.stringify(l[1],null,2)+"",r;return{c(){e=f("h4"),e.textContent="Review",t=$(),n=f("pre"),r=Z(o),c(e,"class","title is-5"),$t(n,"max-height","300px"),$t(n,"overflow","auto")},m(s,i){S(s,e,i),S(s,t,i),S(s,n,i),a(n,r)},p(s,i){i[0]&2&&o!==(o=JSON.stringify(s[1],null,2)+"")&&Se(r,o)},d(s){s&&y(e),s&&y(t),s&&y(n)}}}function Ls(l){let e,t,n=[],o=new Map,r,s,i,u,p=l[1].roles;const m=d=>d[47].name;for(let d=0;d<p.length;d+=1){let _=Ql(l,p,d),h=m(_);o.set(h,n[d]=sn(h,_))}return{c(){e=f("h4"),e.textContent="Roles",t=$();for(let d=0;d<n.length;d+=1)n[d].c();r=$(),s=f("button"),s.textContent="Add Role",c(e,"class","title is-5"),c(s,"class","button is-link is-light")},m(d,_){S(d,e,_),S(d,t,_);for(let h=0;h<n.length;h+=1)n[h]&&n[h].m(d,_);S(d,r,_),S(d,s,_),i||(u=X(s,"click",l[5]),i=!0)},p(d,_){_[0]&4034&&(p=d[1].roles,n=Fn(n,_,m,1,d,p,o,r.parentNode,Gn,sn,r,Ql))},d(d){d&&y(e),d&&y(t);for(let _=0;_<n.length;_+=1)n[_].d(d);d&&y(r),d&&y(s),i=!1,u()}}}function As(l){let e,t,n,o,r,s,i,u,p,m,d,_,h,g,b,w,v,k,L,K,z,R,T,U,I,V,J,j,C,Y,O=l[1].roles,P=[];for(let E=0;E<O.length;E+=1)P[E]=rn(xl(l,O,E));return{c(){e=f("div"),t=f("label"),t.textContent="Configuration ID",n=$(),o=f("div"),r=f("div"),s=f("select"),i=f("option"),i.textContent="Desktop",u=f("option"),u.textContent="Server",p=f("option"),p.textContent="Embedded",m=$(),d=f("div"),_=f("label"),_.textContent="Global shortcut",h=$(),g=f("div"),b=f("input"),w=$(),v=f("div"),k=f("label"),k.textContent="Default theme",L=$(),K=f("div"),z=f("input"),R=$(),T=f("div"),U=f("label"),U.textContent="Default Role",I=$(),V=f("div"),J=f("div"),j=f("select");for(let E=0;E<P.length;E+=1)P[E].c();c(t,"class","label"),c(t,"for","config-id"),i.__value="Desktop",i.value=i.__value,u.__value="Server",u.value=u.__value,p.__value="Embedded",p.value=p.__value,c(s,"id","config-id"),l[1].id===void 0&&nt(()=>l[13].call(s)),c(r,"class","select"),c(o,"class","control"),c(e,"class","field"),c(_,"class","label"),c(_,"for","global-shortcut"),c(b,"class","input"),c(b,"id","global-shortcut"),c(b,"type","text"),c(g,"class","control"),c(d,"class","field"),c(k,"class","label"),c(k,"for","default-theme"),c(z,"class","input"),c(z,"id","default-theme"),c(z,"type","text"),c(K,"class","control"),c(v,"class","field"),c(U,"class","label"),c(U,"for","default-role"),c(j,"id","default-role"),l[1].default_role===void 0&&nt(()=>l[16].call(j)),c(J,"class","select"),c(V,"class","control"),c(T,"class","field")},m(E,D){S(E,e,D),a(e,t),a(e,n),a(e,o),a(o,r),a(r,s),a(s,i),a(s,u),a(s,p),De(s,l[1].id,!0),S(E,m,D),S(E,d,D),a(d,_),a(d,h),a(d,g),a(g,b),Ce(b,l[1].global_shortcut),S(E,w,D),S(E,v,D),a(v,k),a(v,L),a(v,K),a(K,z),Ce(z,l[1].default_theme),S(E,R,D),S(E,T,D),a(T,U),a(T,I),a(T,V),a(V,J),a(J,j);for(let W=0;W<P.length;W+=1)P[W]&&P[W].m(j,null);De(j,l[1].default_role,!0),C||(Y=[X(s,"change",l[13]),X(b,"input",l[14]),X(z,"input",l[15]),X(j,"change",l[16])],C=!0)},p(E,D){if(D[0]&2&&De(s,E[1].id),D[0]&2&&b.value!==E[1].global_shortcut&&Ce(b,E[1].global_shortcut),D[0]&2&&z.value!==E[1].default_theme&&Ce(z,E[1].default_theme),D[0]&2){O=E[1].roles;let W;for(W=0;W<O.length;W+=1){const F=xl(E,O,W);P[W]?P[W].p(F,D):(P[W]=rn(F),P[W].c(),P[W].m(j,null))}for(;W<P.length;W+=1)P[W].d(1);P.length=O.length}D[0]&2&&De(j,E[1].default_role)},d(E){E&&y(e),E&&y(m),E&&y(d),E&&y(w),E&&y(v),E&&y(R),E&&y(T),ot(P,E),C=!1,qe(Y)}}}function Os(l){let e;return{c(){e=Z("Directory Path")},m(t,n){S(t,e,n)},d(t){t&&y(e)}}}function Es(l){let e;return{c(){e=Z("Server URL")},m(t,n){S(t,e,n)},d(t){t&&y(e)}}}function en(l){let e,t,n,o,r,s,i,u,p,m,d,_;function h(){l[23].call(i,l[49],l[52])}return{c(){e=f("div"),t=f("label"),n=Z("Atomic Server Secret"),r=$(),s=f("div"),i=f("input"),p=$(),m=f("p"),m.textContent="Leave empty for anonymous access",c(t,"class","label"),c(t,"for",o=`haystack-secret-${l[49]}-${l[52]}`),c(i,"class","input"),c(i,"id",u=`haystack-secret-${l[49]}-${l[52]}`),c(i,"type","password"),c(i,"placeholder","Base64 encoded secret (optional)"),c(s,"class","control"),c(m,"class","help"),c(e,"class","field")},m(g,b){S(g,e,b),a(e,t),a(t,n),a(e,r),a(e,s),a(s,i),Ce(i,l[1].roles[l[49]].haystacks[l[52]].atomic_server_secret),a(e,p),a(e,m),d||(_=X(i,"input",h),d=!0)},p(g,b){l=g,b[0]&2&&o!==(o=`haystack-secret-${l[49]}-${l[52]}`)&&c(t,"for",o),b[0]&2&&u!==(u=`haystack-secret-${l[49]}-${l[52]}`)&&c(i,"id",u),b[0]&2&&i.value!==l[1].roles[l[49]].haystacks[l[52]].atomic_server_secret&&Ce(i,l[1].roles[l[49]].haystacks[l[52]].atomic_server_secret)},d(g){g&&y(e),d=!1,_()}}}function tn(l){let e,t,n,o,r,s,i,u,p,m,d,_,h,g,b,w,v,k=Object.entries(l[1].roles[l[49]].haystacks[l[52]].extra_parameters||{}),L=[];for(let T=0;T<k.length;T+=1)L[T]=ln(Xl(l,k,T));function K(){return l[27](l[49],l[52])}function z(){return l[28](l[49],l[52])}function R(){return l[29](l[49],l[52])}return{c(){e=f("div"),t=f("label"),t.textContent="Extra Parameters (for filtering)",n=$();for(let T=0;T<L.length;T+=1)L[T].c();o=$(),r=f("div"),s=f("div"),i=f("button"),i.textContent="+ Tag Filter",u=$(),p=f("div"),m=f("button"),m.textContent="+ Max Results",d=$(),_=f("div"),h=f("button"),h.textContent="+ Custom Parameter",g=$(),b=f("p"),b.innerHTML=`Common parameters: <code>tag</code> (e.g., &quot;#rust&quot;), <code>glob</code> (e.g., &quot;*.md&quot;), 
                  <code>max_count</code> (e.g., &quot;10&quot;), <code>context</code> (e.g., &quot;5&quot;)`,c(t,"class","label"),c(i,"class","button is-small is-link is-light"),c(s,"class","control"),c(m,"class","button is-small is-link is-light"),c(p,"class","control"),c(h,"class","button is-small is-link is-light"),c(_,"class","control"),c(r,"class","field is-grouped"),c(b,"class","help"),c(e,"class","field")},m(T,U){S(T,e,U),a(e,t),a(e,n);for(let I=0;I<L.length;I+=1)L[I]&&L[I].m(e,null);a(e,o),a(e,r),a(r,s),a(s,i),a(r,u),a(r,p),a(p,m),a(r,d),a(r,_),a(_,h),a(e,g),a(e,b),w||(v=[X(i,"click",K),X(m,"click",z),X(h,"click",R)],w=!0)},p(T,U){if(l=T,U[0]&3074){k=Object.entries(l[1].roles[l[49]].haystacks[l[52]].extra_parameters||{});let I;for(I=0;I<k.length;I+=1){const V=Xl(l,k,I);L[I]?L[I].p(V,U):(L[I]=ln(V),L[I].c(),L[I].m(e,o))}for(;I<L.length;I+=1)L[I].d(1);L.length=k.length}},d(T){T&&y(e),ot(L,T),w=!1,qe(v)}}}function ln(l){let e,t,n,o,r,s,i,u,p,m,d,_,h;function g(...v){return l[24](l[49],l[52],l[53],...v)}function b(){l[25].call(i,l[49],l[52],l[53])}function w(){return l[26](l[49],l[52],l[53])}return{c(){e=f("div"),t=f("div"),n=f("input"),r=$(),s=f("div"),i=f("input"),u=$(),p=f("div"),m=f("button"),m.textContent="×",d=$(),c(n,"class","input"),c(n,"type","text"),c(n,"placeholder","Parameter name"),n.value=o=l[53],c(t,"class","control"),c(i,"class","input"),c(i,"type","text"),c(i,"placeholder","Parameter value"),c(s,"class","control is-expanded"),c(m,"class","button is-small is-danger"),c(p,"class","control"),c(e,"class","field is-grouped")},m(v,k){S(v,e,k),a(e,t),a(t,n),a(e,r),a(e,s),a(s,i),Ce(i,l[1].roles[l[49]].haystacks[l[52]].extra_parameters[l[53]]),a(e,u),a(e,p),a(p,m),a(e,d),_||(h=[X(n,"blur",g),X(i,"input",b),X(m,"click",w)],_=!0)},p(v,k){l=v,k[0]&2&&o!==(o=l[53])&&n.value!==o&&(n.value=o),k[0]&2&&i.value!==l[1].roles[l[49]].haystacks[l[52]].extra_parameters[l[53]]&&Ce(i,l[1].roles[l[49]].haystacks[l[52]].extra_parameters[l[53]])},d(v){v&&y(e),_=!1,qe(h)}}}function nn(l){let e,t,n,o,r,s,i,u,p,m,d,_,h,g,b,w,v,k,L,K,z,R,T,U,I,V,J,j,C,Y,O,P,E,D,W;function F(){l[21].call(p,l[49],l[52])}function q(Re,de){return Re[1].roles[Re[49]].haystacks[Re[52]].service==="Atomic"?Es:Os}let ne=q(l),H=ne(l);function Q(){l[22].call(L,l[49],l[52])}let oe=l[1].roles[l[49]].haystacks[l[52]].service==="Atomic"&&en(l),se=l[1].roles[l[49]].haystacks[l[52]].service==="Ripgrep"&&tn(l);function ve(){l[30].call(J,l[49],l[52])}function Ne(){return l[31](l[49],l[52])}return{c(){e=f("div"),t=f("div"),n=f("label"),o=Z("Service Type"),s=$(),i=f("div"),u=f("div"),p=f("select"),m=f("option"),m.textContent="Ripgrep (File Search)",d=f("option"),d.textContent="Atomic Server",h=$(),g=f("div"),b=f("label"),H.c(),v=$(),k=f("div"),L=f("input"),R=$(),oe&&oe.c(),T=$(),se&&se.c(),U=$(),I=f("div"),V=f("label"),J=f("input"),C=Z(`
                 Read-only`),O=$(),P=f("div"),E=f("button"),E.textContent="Remove Haystack",c(n,"class","label"),c(n,"for",r=`haystack-service-${l[49]}-${l[52]}`),m.__value="Ripgrep",m.value=m.__value,d.__value="Atomic",d.value=d.__value,c(p,"id",_=`haystack-service-${l[49]}-${l[52]}`),l[1].roles[l[49]].haystacks[l[52]].service===void 0&&nt(F),c(u,"class","select"),c(i,"class","control"),c(t,"class","field"),c(b,"class","label"),c(b,"for",w=`haystack-path-${l[49]}-${l[52]}`),c(L,"class","input"),c(L,"id",K=`haystack-path-${l[49]}-${l[52]}`),c(L,"type","text"),c(L,"placeholder",z=l[1].roles[l[49]].haystacks[l[52]].service==="Atomic"?"https://localhost:9883":"/path/to/documents"),c(k,"class","control"),c(g,"class","field"),c(J,"id",j=`haystack-readonly-${l[49]}-${l[52]}`),c(J,"type","checkbox"),c(V,"class","checkbox"),c(V,"for",Y=`haystack-readonly-${l[49]}-${l[52]}`),c(I,"class","field"),c(E,"class","button is-small is-danger"),c(P,"class","field"),c(e,"class","box is-light")},m(Re,de){S(Re,e,de),a(e,t),a(t,n),a(n,o),a(t,s),a(t,i),a(i,u),a(u,p),a(p,m),a(p,d),De(p,l[1].roles[l[49]].haystacks[l[52]].service,!0),a(e,h),a(e,g),a(g,b),H.m(b,null),a(g,v),a(g,k),a(k,L),Ce(L,l[1].roles[l[49]].haystacks[l[52]].path),a(e,R),oe&&oe.m(e,null),a(e,T),se&&se.m(e,null),a(e,U),a(e,I),a(I,V),a(V,J),J.checked=l[1].roles[l[49]].haystacks[l[52]].read_only,a(V,C),a(e,O),a(e,P),a(P,E),D||(W=[X(p,"change",F),X(L,"input",Q),X(J,"change",ve),X(E,"click",Ne)],D=!0)},p(Re,de){l=Re,de[0]&2&&r!==(r=`haystack-service-${l[49]}-${l[52]}`)&&c(n,"for",r),de[0]&2&&_!==(_=`haystack-service-${l[49]}-${l[52]}`)&&c(p,"id",_),de[0]&2&&De(p,l[1].roles[l[49]].haystacks[l[52]].service),ne!==(ne=q(l))&&(H.d(1),H=ne(l),H&&(H.c(),H.m(b,null))),de[0]&2&&w!==(w=`haystack-path-${l[49]}-${l[52]}`)&&c(b,"for",w),de[0]&2&&K!==(K=`haystack-path-${l[49]}-${l[52]}`)&&c(L,"id",K),de[0]&2&&z!==(z=l[1].roles[l[49]].haystacks[l[52]].service==="Atomic"?"https://localhost:9883":"/path/to/documents")&&c(L,"placeholder",z),de[0]&2&&L.value!==l[1].roles[l[49]].haystacks[l[52]].path&&Ce(L,l[1].roles[l[49]].haystacks[l[52]].path),l[1].roles[l[49]].haystacks[l[52]].service==="Atomic"?oe?oe.p(l,de):(oe=en(l),oe.c(),oe.m(e,T)):oe&&(oe.d(1),oe=null),l[1].roles[l[49]].haystacks[l[52]].service==="Ripgrep"?se?se.p(l,de):(se=tn(l),se.c(),se.m(e,U)):se&&(se.d(1),se=null),de[0]&2&&j!==(j=`haystack-readonly-${l[49]}-${l[52]}`)&&c(J,"id",j),de[0]&2&&(J.checked=l[1].roles[l[49]].haystacks[l[52]].read_only),de[0]&2&&Y!==(Y=`haystack-readonly-${l[49]}-${l[52]}`)&&c(V,"for",Y)},d(Re){Re&&y(e),H.d(),oe&&oe.d(),se&&se.d(),D=!1,qe(W)}}}function on(l){let e,t,n,o,r,s,i,u,p,m,d,_,h,g,b,w,v,k,L,K,z,R,T,U,I,V,J,j,C;function Y(){l[34].call(i,l[49])}function O(){l[35].call(L,l[49])}return{c(){e=f("div"),t=f("label"),n=Z("OpenRouter API Key"),r=$(),s=f("div"),i=f("input"),p=$(),m=f("p"),m.innerHTML='Get your API key from <a href="https://openrouter.ai" target="_blank" rel="noopener">OpenRouter</a>',d=$(),_=f("div"),h=f("label"),g=Z("Model"),w=$(),v=f("div"),k=f("div"),L=f("select"),K=f("option"),K.textContent="GPT-3.5 Turbo (Fast & Affordable)",z=f("option"),z.textContent="GPT-4 (High Quality)",R=f("option"),R.textContent="Claude 3 Sonnet (Balanced)",T=f("option"),T.textContent="Claude 3 Haiku (Fast)",U=f("option"),U.textContent="Mixtral 8x7B (Open Source)",V=$(),J=f("p"),J.textContent="Choose the language model for generating summaries. Different models offer different speed/quality tradeoffs.",c(t,"class","label"),c(t,"for",o=`openrouter-api-key-${l[49]}`),c(i,"class","input"),c(i,"id",u=`openrouter-api-key-${l[49]}`),c(i,"type","password"),c(i,"placeholder","sk-or-v1-..."),c(s,"class","control"),c(m,"class","help"),c(e,"class","field"),c(h,"class","label"),c(h,"for",b=`openrouter-model-${l[49]}`),K.__value="openai/gpt-3.5-turbo",K.value=K.__value,z.__value="openai/gpt-4",z.value=z.__value,R.__value="anthropic/claude-3-sonnet",R.value=R.__value,T.__value="anthropic/claude-3-haiku",T.value=T.__value,U.__value="mistralai/mixtral-8x7b-instruct",U.value=U.__value,c(L,"id",I=`openrouter-model-${l[49]}`),l[1].roles[l[49]].openrouter_model===void 0&&nt(O),c(k,"class","select is-fullwidth"),c(v,"class","control"),c(J,"class","help"),c(_,"class","field")},m(P,E){S(P,e,E),a(e,t),a(t,n),a(e,r),a(e,s),a(s,i),Ce(i,l[1].roles[l[49]].openrouter_api_key),a(e,p),a(e,m),S(P,d,E),S(P,_,E),a(_,h),a(h,g),a(_,w),a(_,v),a(v,k),a(k,L),a(L,K),a(L,z),a(L,R),a(L,T),a(L,U),De(L,l[1].roles[l[49]].openrouter_model,!0),a(_,V),a(_,J),j||(C=[X(i,"input",Y),X(L,"change",O)],j=!0)},p(P,E){l=P,E[0]&2&&o!==(o=`openrouter-api-key-${l[49]}`)&&c(t,"for",o),E[0]&2&&u!==(u=`openrouter-api-key-${l[49]}`)&&c(i,"id",u),E[0]&2&&i.value!==l[1].roles[l[49]].openrouter_api_key&&Ce(i,l[1].roles[l[49]].openrouter_api_key),E[0]&2&&b!==(b=`openrouter-model-${l[49]}`)&&c(h,"for",b),E[0]&2&&I!==(I=`openrouter-model-${l[49]}`)&&c(L,"id",I),E[0]&2&&De(L,l[1].roles[l[49]].openrouter_model)},d(P){P&&y(e),P&&y(d),P&&y(_),j=!1,qe(C)}}}function sn(l,e){let t,n,o,r,s,i,u,p,m,d,_,h,g,b,w,v,k,L,K,z,R,T,U,I,V,J,j,C,Y,O,P,E,D,W,F,q,ne,H,Q,oe,se,ve,Ne,Re,de,N,B,ie,_e,re,ae,Le,Me,ke,$e,be,me,we,ye,Be,Ie,Te,pe,G,ce,ze,Je,ft,mt,Nt,Ve,Fe,gt,Ut,x,ue,st,yt,it,St,ht,Ye,Ct,Tt,jt,ll,Rt,pt,at,Ht,nl,It,ol,vt,ut,Ft,sl,Gt,rl,il,al,Mt,Jt,ul;function yn(){e[17].call(p,e[49])}function Sn(){e[18].call(k,e[49])}function Cn(){e[19].call(J,e[49])}function Tn(){e[20].call(F,e[49])}let Lt=e[47].haystacks,Ge=[];for(let Ke=0;Ke<Lt.length;Ke+=1)Ge[Ke]=nn(Zl(e,Lt,Ke));function Rn(){return e[32](e[49])}function Ln(){e[33].call(B,e[49])}let We=e[1].roles[e[49]].openrouter_enabled&&on(e);function An(){e[36].call(pe,e[49])}function On(){e[37].call(Fe,e[49])}function cl(){e[38].call(Ye,e[49])}function En(){e[39].call(at,e[49])}function Nn(){e[40].call(ut,e[49])}function Un(){return e[41](e[49])}return{key:l,first:null,c(){t=f("div"),n=f("div"),o=f("label"),r=Z("Role name"),i=$(),u=f("div"),p=f("input"),d=$(),_=f("div"),h=f("label"),g=Z("Short name"),w=$(),v=f("div"),k=f("input"),K=$(),z=f("div"),R=f("label"),T=Z("Theme"),I=$(),V=f("div"),J=f("input"),C=$(),Y=f("div"),O=f("label"),P=Z("Relevance function"),D=$(),W=f("div"),F=f("input"),ne=$(),H=f("h5"),H.textContent="Haystacks",Q=$();for(let Ke=0;Ke<Ge.length;Ke+=1)Ge[Ke].c();oe=$(),se=f("button"),se.textContent="Add Haystack",ve=$(),Ne=f("h5"),Ne.textContent="AI-Enhanced Summaries (OpenRouter)",Re=$(),de=f("div"),N=f("label"),B=f("input"),_e=Z(`
             Enable AI-generated article summaries`),ae=$(),Le=f("p"),Le.textContent="Generate intelligent summaries using OpenRouter's language models",Me=$(),We&&We.c(),ke=$(),$e=f("h5"),$e.textContent="Knowledge Graph",be=$(),me=f("div"),we=f("label"),ye=Z("Remote automata URL"),Ie=$(),Te=f("div"),pe=f("input"),ce=$(),ze=f("div"),Je=f("label"),ft=Z("Local KG path"),Nt=$(),Ve=f("div"),Fe=f("input"),Ut=$(),x=f("div"),ue=f("div"),st=f("label"),yt=Z("Local KG type"),St=$(),ht=f("div"),Ye=f("select"),Ct=f("option"),Ct.textContent="markdown",Tt=f("option"),Tt.textContent="json",ll=$(),Rt=f("div"),pt=f("label"),at=f("input"),nl=Z(`
             Public`),ol=$(),vt=f("label"),ut=f("input"),sl=Z(`
             Publish`),rl=$(),il=f("hr"),al=$(),Mt=f("button"),Mt.textContent="Remove Role",c(o,"class","label"),c(o,"for",s=`role-name-${e[49]}`),c(p,"class","input"),c(p,"id",m=`role-name-${e[49]}`),c(p,"type","text"),c(u,"class","control"),c(n,"class","field"),c(h,"class","label"),c(h,"for",b=`role-shortname-${e[49]}`),c(k,"class","input"),c(k,"id",L=`role-shortname-${e[49]}`),c(k,"type","text"),c(v,"class","control"),c(_,"class","field"),c(R,"class","label"),c(R,"for",U=`role-theme-${e[49]}`),c(J,"class","input"),c(J,"id",j=`role-theme-${e[49]}`),c(J,"type","text"),c(V,"class","control"),c(z,"class","field"),c(O,"class","label"),c(O,"for",E=`role-relevance-${e[49]}`),c(F,"class","input"),c(F,"id",q=`role-relevance-${e[49]}`),c(F,"type","text"),c(W,"class","control"),c(Y,"class","field"),c(H,"class","title is-6"),c(se,"class","button is-small"),c(Ne,"class","title is-6"),c(B,"id",ie=`openrouter-enabled-${e[49]}`),c(B,"type","checkbox"),c(N,"class","checkbox"),c(N,"for",re=`openrouter-enabled-${e[49]}`),c(Le,"class","help"),c(de,"class","field"),c($e,"class","title is-6"),c(we,"class","label"),c(we,"for",Be=`kg-url-${e[49]}`),c(pe,"class","input"),c(pe,"id",G=`kg-url-${e[49]}`),c(pe,"type","text"),c(pe,"placeholder","https://example.com/thesaurus.json"),c(Te,"class","control"),c(me,"class","field"),c(Je,"class","label"),c(Je,"for",mt=`kg-local-path-${e[49]}`),c(Fe,"class","input"),c(Fe,"id",gt=`kg-local-path-${e[49]}`),c(Fe,"type","text"),c(Fe,"placeholder","/path/to/markdown"),c(Ve,"class","control"),c(ze,"class","field"),c(st,"class","label"),c(st,"for",it=`kg-local-type-${e[49]}`),Ct.__value="markdown",Ct.value=Ct.__value,Tt.__value="json",Tt.value=Tt.__value,c(Ye,"id",jt=`kg-local-type-${e[49]}`),e[1].roles[e[49]].kg.local_type===void 0&&nt(cl),c(ht,"class","select"),c(ue,"class","control"),c(x,"class","field is-grouped"),c(at,"id",Ht=`kg-public-${e[49]}`),c(at,"type","checkbox"),c(pt,"class","checkbox"),c(pt,"for",It=`kg-public-${e[49]}`),$t(pt,"margin-right","1rem"),c(ut,"id",Ft=`kg-publish-${e[49]}`),c(ut,"type","checkbox"),c(vt,"class","checkbox"),c(vt,"for",Gt=`kg-publish-${e[49]}`),c(Rt,"class","field is-grouped"),c(Mt,"class","button is-small is-danger"),c(t,"class","box"),this.first=t},m(Ke,fe){S(Ke,t,fe),a(t,n),a(n,o),a(o,r),a(n,i),a(n,u),a(u,p),Ce(p,e[1].roles[e[49]].name),a(t,d),a(t,_),a(_,h),a(h,g),a(_,w),a(_,v),a(v,k),Ce(k,e[1].roles[e[49]].shortname),a(t,K),a(t,z),a(z,R),a(R,T),a(z,I),a(z,V),a(V,J),Ce(J,e[1].roles[e[49]].theme),a(t,C),a(t,Y),a(Y,O),a(O,P),a(Y,D),a(Y,W),a(W,F),Ce(F,e[1].roles[e[49]].relevance_function),a(t,ne),a(t,H),a(t,Q);for(let Ue=0;Ue<Ge.length;Ue+=1)Ge[Ue]&&Ge[Ue].m(t,null);a(t,oe),a(t,se),a(t,ve),a(t,Ne),a(t,Re),a(t,de),a(de,N),a(N,B),B.checked=e[1].roles[e[49]].openrouter_enabled,a(N,_e),a(de,ae),a(de,Le),a(t,Me),We&&We.m(t,null),a(t,ke),a(t,$e),a(t,be),a(t,me),a(me,we),a(we,ye),a(me,Ie),a(me,Te),a(Te,pe),Ce(pe,e[1].roles[e[49]].kg.url),a(t,ce),a(t,ze),a(ze,Je),a(Je,ft),a(ze,Nt),a(ze,Ve),a(Ve,Fe),Ce(Fe,e[1].roles[e[49]].kg.local_path),a(t,Ut),a(t,x),a(x,ue),a(ue,st),a(st,yt),a(ue,St),a(ue,ht),a(ht,Ye),a(Ye,Ct),a(Ye,Tt),De(Ye,e[1].roles[e[49]].kg.local_type,!0),a(t,ll),a(t,Rt),a(Rt,pt),a(pt,at),at.checked=e[1].roles[e[49]].kg.public,a(pt,nl),a(Rt,ol),a(Rt,vt),a(vt,ut),ut.checked=e[1].roles[e[49]].kg.publish,a(vt,sl),a(t,rl),a(t,il),a(t,al),a(t,Mt),Jt||(ul=[X(p,"input",yn),X(k,"input",Sn),X(J,"input",Cn),X(F,"input",Tn),X(se,"click",Rn),X(B,"change",Ln),X(pe,"input",An),X(Fe,"input",On),X(Ye,"change",cl),X(at,"change",En),X(ut,"change",Nn),X(Mt,"click",Un)],Jt=!0)},p(Ke,fe){if(e=Ke,fe[0]&2&&s!==(s=`role-name-${e[49]}`)&&c(o,"for",s),fe[0]&2&&m!==(m=`role-name-${e[49]}`)&&c(p,"id",m),fe[0]&2&&p.value!==e[1].roles[e[49]].name&&Ce(p,e[1].roles[e[49]].name),fe[0]&2&&b!==(b=`role-shortname-${e[49]}`)&&c(h,"for",b),fe[0]&2&&L!==(L=`role-shortname-${e[49]}`)&&c(k,"id",L),fe[0]&2&&k.value!==e[1].roles[e[49]].shortname&&Ce(k,e[1].roles[e[49]].shortname),fe[0]&2&&U!==(U=`role-theme-${e[49]}`)&&c(R,"for",U),fe[0]&2&&j!==(j=`role-theme-${e[49]}`)&&c(J,"id",j),fe[0]&2&&J.value!==e[1].roles[e[49]].theme&&Ce(J,e[1].roles[e[49]].theme),fe[0]&2&&E!==(E=`role-relevance-${e[49]}`)&&c(O,"for",E),fe[0]&2&&q!==(q=`role-relevance-${e[49]}`)&&c(F,"id",q),fe[0]&2&&F.value!==e[1].roles[e[49]].relevance_function&&Ce(F,e[1].roles[e[49]].relevance_function),fe[0]&3842){Lt=e[47].haystacks;let Ue;for(Ue=0;Ue<Lt.length;Ue+=1){const fl=Zl(e,Lt,Ue);Ge[Ue]?Ge[Ue].p(fl,fe):(Ge[Ue]=nn(fl),Ge[Ue].c(),Ge[Ue].m(t,oe))}for(;Ue<Ge.length;Ue+=1)Ge[Ue].d(1);Ge.length=Lt.length}fe[0]&2&&ie!==(ie=`openrouter-enabled-${e[49]}`)&&c(B,"id",ie),fe[0]&2&&(B.checked=e[1].roles[e[49]].openrouter_enabled),fe[0]&2&&re!==(re=`openrouter-enabled-${e[49]}`)&&c(N,"for",re),e[1].roles[e[49]].openrouter_enabled?We?We.p(e,fe):(We=on(e),We.c(),We.m(t,ke)):We&&(We.d(1),We=null),fe[0]&2&&Be!==(Be=`kg-url-${e[49]}`)&&c(we,"for",Be),fe[0]&2&&G!==(G=`kg-url-${e[49]}`)&&c(pe,"id",G),fe[0]&2&&pe.value!==e[1].roles[e[49]].kg.url&&Ce(pe,e[1].roles[e[49]].kg.url),fe[0]&2&&mt!==(mt=`kg-local-path-${e[49]}`)&&c(Je,"for",mt),fe[0]&2&&gt!==(gt=`kg-local-path-${e[49]}`)&&c(Fe,"id",gt),fe[0]&2&&Fe.value!==e[1].roles[e[49]].kg.local_path&&Ce(Fe,e[1].roles[e[49]].kg.local_path),fe[0]&2&&it!==(it=`kg-local-type-${e[49]}`)&&c(st,"for",it),fe[0]&2&&jt!==(jt=`kg-local-type-${e[49]}`)&&c(Ye,"id",jt),fe[0]&2&&De(Ye,e[1].roles[e[49]].kg.local_type),fe[0]&2&&Ht!==(Ht=`kg-public-${e[49]}`)&&c(at,"id",Ht),fe[0]&2&&(at.checked=e[1].roles[e[49]].kg.public),fe[0]&2&&It!==(It=`kg-public-${e[49]}`)&&c(pt,"for",It),fe[0]&2&&Ft!==(Ft=`kg-publish-${e[49]}`)&&c(ut,"id",Ft),fe[0]&2&&(ut.checked=e[1].roles[e[49]].kg.publish),fe[0]&2&&Gt!==(Gt=`kg-publish-${e[49]}`)&&c(vt,"for",Gt)},d(Ke){Ke&&y(t),ot(Ge,Ke),We&&We.d(),Jt=!1,qe(ul)}}}function rn(l){let e,t=l[44].name+"",n,o;return{c(){e=f("option"),n=Z(t),e.__value=o=l[44].name,e.value=e.__value},m(r,s){S(r,e,s),a(e,n)},p(r,s){s[0]&2&&t!==(t=r[44].name+"")&&Se(n,t),s[0]&2&&o!==(o=r[44].name)&&(e.__value=o,e.value=e.__value)},d(r){r&&y(e)}}}function an(l){let e,t,n;return{c(){e=f("button"),e.textContent="Back",c(e,"class","button")},m(o,r){S(o,e,r),t||(n=X(e,"click",l[4]),t=!0)},p:ge,d(o){o&&y(e),t=!1,n()}}}function Ns(l){let e,t,n;return{c(){e=f("button"),e.textContent="Save",c(e,"class","button is-success")},m(o,r){S(o,e,r),t||(n=X(e,"click",l[12]),t=!0)},p:ge,d(o){o&&y(e),t=!1,n()}}}function Us(l){let e,t,n;return{c(){e=f("button"),e.textContent="Next",c(e,"class","button is-primary")},m(o,r){S(o,e,r),t||(n=X(e,"click",l[3]),t=!0)},p:ge,d(o){o&&y(e),t=!1,n()}}}function Ms(l){let e,t,n,o,r,s,i,u;function p(w,v){return w[0]===1?As:w[0]===2?Ls:Rs}let m=p(l),d=m(l),_=l[0]>1&&an(l);function h(w,v){return w[0]<wn?Us:Ns}let g=h(l),b=g(l);return{c(){e=f("div"),t=f("h3"),t.textContent="Configuration Wizard",n=$(),d.c(),o=$(),r=f("nav"),s=f("div"),_&&_.c(),i=$(),u=f("div"),b.c(),c(t,"class","title is-4"),c(s,"class","level-left"),c(u,"class","level-right"),c(r,"class","level"),c(e,"class","box")},m(w,v){S(w,e,v),a(e,t),a(e,n),d.m(e,null),a(e,o),a(e,r),a(r,s),_&&_.m(s,null),a(r,i),a(r,u),b.m(u,null)},p(w,v){m===(m=p(w))&&d?d.p(w,v):(d.d(1),d=m(w),d&&(d.c(),d.m(e,o))),w[0]>1?_?_.p(w,v):(_=an(w),_.c(),_.m(s,null)):_&&(_.d(1),_=null),g===(g=h(w))&&b?b.p(w,v):(b.d(1),b=g(w),b&&(b.c(),b.m(u,null)))},i:ge,o:ge,d(w){w&&y(e),d.d(),_&&_.d(),b.d()}}}const wn=3;function Ds(l,e,t){let n;const o=lt(null),r=lt({id:"Desktop",global_shortcut:"Ctrl+X",default_theme:"spacelab",default_role:"Default",roles:[]});he(l,r,N=>t(1,n=N)),el(async()=>{try{let N;At(Qe)?N=await Pe("get_config_schema"):N=await(await fetch("/config/schema")).json(),o.set(N);const B=At(Xe);B&&B.id&&r.update(ie=>{var _e;return{...ie,id:B.id,global_shortcut:B.global_shortcut,default_theme:((_e=B.roles[B.default_role])==null?void 0:_e.theme)??"spacelab",default_role:B.default_role,roles:Object.values(B.roles).map(re=>{var ke,$e,be,me,we,ye,Be;const ae=(ke=re.kg)==null?void 0:ke.automata_path,Le=(ae==null?void 0:ae.Remote)??"",Me=((be=($e=re.kg)==null?void 0:$e.knowledge_graph_local)==null?void 0:be.path)??"";return{name:re.name,shortname:re.shortname,relevance_function:re.relevance_function,theme:re.theme,haystacks:(re.haystacks??[]).map(Ie=>({path:Ie.location||Ie.path||"",read_only:Ie.read_only??!1,service:Ie.service||"Ripgrep",atomic_server_secret:Ie.atomic_server_secret||"",extra_parameters:Ie.extra_parameters||{}})),kg:{url:Le,local_path:Me,local_type:((we=(me=re.kg)==null?void 0:me.knowledge_graph_local)==null?void 0:we.input_type)??"markdown",public:((ye=re.kg)==null?void 0:ye.public)??!1,publish:((Be=re.kg)==null?void 0:Be.publish)??!1},openrouter_enabled:re.openrouter_enabled??!1,openrouter_api_key:re.openrouter_api_key??"",openrouter_model:re.openrouter_model??"openai/gpt-3.5-turbo"}})}})}catch(N){console.error("Failed to load schema",N)}});let s=1;function i(){s<wn&&t(0,s+=1)}function u(){s>1&&t(0,s-=1)}function p(){r.update(N=>({...N,roles:[...N.roles,{name:"New Role",shortname:"new",relevance_function:"title-scorer",theme:"spacelab",haystacks:[],kg:{url:"",local_path:"",local_type:"markdown",public:!1,publish:!1},openrouter_enabled:!1,openrouter_api_key:"",openrouter_model:"openai/gpt-3.5-turbo"}]}))}function m(N){r.update(B=>({...B,roles:B.roles.filter((ie,_e)=>_e!==N)}))}function d(N){r.update(B=>(B.roles[N].haystacks.push({path:"",read_only:!1,service:"Ripgrep",atomic_server_secret:"",extra_parameters:{}}),B))}function _(N,B){r.update(ie=>(ie.roles[N].haystacks=ie.roles[N].haystacks.filter((_e,re)=>re!==B),ie))}function h(N,B,ie="",_e=""){r.update(re=>{re.roles[N].haystacks[B].extra_parameters||(re.roles[N].haystacks[B].extra_parameters={});const ae=ie||`param_${Date.now()}`;return re.roles[N].haystacks[B].extra_parameters[ae]=_e,re})}function g(N,B,ie){r.update(_e=>(delete _e.roles[N].haystacks[B].extra_parameters[ie],_e))}function b(N,B,ie,_e){r.update(re=>{const ae=re.roles[N].haystacks[B].extra_parameters;return ae[ie]!==void 0&&ie!==_e&&(ae[_e]=ae[ie],delete ae[ie]),re})}function w(N,B,ie,_e){const re=_e.target.value;b(N,B,ie,re)}async function v(){var re;const N=At(r),B=At(Xe);let ie={...B};ie.id=N.id,ie.global_shortcut=N.global_shortcut,ie.default_role=N.default_role;const _e={};N.roles.forEach(ae=>{var ke,$e;const Le=ae.name,Me=Le.replace(/^"|"$/g,"");_e[Me]={extra:(($e=(ke=B.roles)==null?void 0:ke[Le])==null?void 0:$e.extra)??{},name:ae.name,shortname:ae.shortname,theme:ae.theme,relevance_function:ae.relevance_function,haystacks:ae.haystacks.map(be=>({location:be.path,service:be.service,read_only:be.read_only,atomic_server_secret:be.service==="Atomic"?be.atomic_server_secret:void 0,extra_parameters:be.extra_parameters||{}})),kg:ae.kg.url||ae.kg.local_path?{automata_path:ae.kg.url?{Remote:ae.kg.url}:null,knowledge_graph_local:ae.kg.local_path?{input_type:ae.kg.local_type,path:ae.kg.local_path}:null,public:ae.kg.public,publish:ae.kg.publish}:null,...ae.openrouter_enabled&&{openrouter_enabled:ae.openrouter_enabled,openrouter_api_key:ae.openrouter_api_key,openrouter_model:ae.openrouter_model}}}),ie.roles=_e,(!ie.default_role||!_e[ie.default_role])&&(ie.default_role=((re=N.roles[0])==null?void 0:re.name)??"Default"),ie.selected_role=ie.default_role;try{At(Qe)?await Pe("update_config",{configNew:ie}):await fetch("/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ie)}),Xe.set(ie),alert("Configuration saved")}catch(ae){console.error(ae),alert("Failed to save config")}}function k(){n.id=kt(this),r.set(n)}function L(){n.global_shortcut=this.value,r.set(n)}function K(){n.default_theme=this.value,r.set(n)}function z(){n.default_role=kt(this),r.set(n)}function R(N){n.roles[N].name=this.value,r.set(n)}function T(N){n.roles[N].shortname=this.value,r.set(n)}function U(N){n.roles[N].theme=this.value,r.set(n)}function I(N){n.roles[N].relevance_function=this.value,r.set(n)}function V(N,B){n.roles[N].haystacks[B].service=kt(this),r.set(n)}function J(N,B){n.roles[N].haystacks[B].path=this.value,r.set(n)}function j(N,B){n.roles[N].haystacks[B].atomic_server_secret=this.value,r.set(n)}const C=(N,B,ie,_e)=>w(N,B,ie,_e);function Y(N,B,ie){n.roles[N].haystacks[B].extra_parameters[ie]=this.value,r.set(n)}const O=(N,B,ie)=>g(N,B,ie),P=(N,B)=>h(N,B,"tag","#rust"),E=(N,B)=>h(N,B,"max_count","10"),D=(N,B)=>h(N,B,"","");function W(N,B){n.roles[N].haystacks[B].read_only=this.checked,r.set(n)}const F=(N,B)=>_(N,B),q=N=>d(N);function ne(N){n.roles[N].openrouter_enabled=this.checked,r.set(n)}function H(N){n.roles[N].openrouter_api_key=this.value,r.set(n)}function Q(N){n.roles[N].openrouter_model=kt(this),r.set(n)}function oe(N){n.roles[N].kg.url=this.value,r.set(n)}function se(N){n.roles[N].kg.local_path=this.value,r.set(n)}function ve(N){n.roles[N].kg.local_type=kt(this),r.set(n)}function Ne(N){n.roles[N].kg.public=this.checked,r.set(n)}function Re(N){n.roles[N].kg.publish=this.checked,r.set(n)}return[s,n,r,i,u,p,m,d,_,h,g,w,v,k,L,K,z,R,T,U,I,V,J,j,C,Y,O,P,E,D,W,F,q,ne,H,Q,oe,se,ve,Ne,Re,N=>m(N)]}class Ps extends xe{constructor(e){super(),et(this,e,Ds,Ms,Ze,{},null,[-1,-1])}}function js(l){let e,t,n,o,r,s;return r=new vn({props:{content:l[0],onChange:l[1]}}),{c(){e=f("div"),t=f("p"),t.innerHTML="<i>The best editing experience is to configure Atomic Server, in the meantime use editor below. You will need to refresh page via Command R or Ctrl-R to see changes</i>",n=$(),o=f("div"),ee(r.$$.fragment),c(o,"class","editor"),c(e,"class","box")},m(i,u){S(i,e,u),a(e,t),a(e,n),a(e,o),te(r,o,null),s=!0},p(i,[u]){const p={};u&1&&(p.content=i[0]),r.$set(p)},i(i){s||(A(r.$$.fragment,i),s=!0)},o(i){M(r.$$.fragment,i),s=!1},d(i){i&&y(e),le(r)}}}function Hs(l,e,t){let n,o;he(l,Xe,i=>t(2,n=i)),he(l,Qe,i=>t(3,o=i));let r={json:n};function s(i){if(console.log("contents changed:",i),console.log("is tauri",o),Xe.update(u=>(u=i.json,u)),At(Qe))console.log("Updating config on server"),Pe("update_config",{configNew:i.json}).then(u=>{console.log(`Message: ${u}`)}).catch(u=>console.error(u));else{let u=`${tt.ServerURL}/config/`;fetch(u,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i.json)})}t(0,r=i)}return el(()=>{t(0,r={json:n})}),[r,s]}class Is extends xe{constructor(e){super(),et(this,e,Hs,js,Ze,{})}}const{window:Xt}=Kn;function Fs(l){let e,t,n,o,r,s,i,u,p,m;return{c(){e=f("div"),t=f("div"),n=f("h3"),n.textContent="Error loading graph",o=$(),r=f("p"),s=Z(l[3]),i=$(),u=f("button"),u.textContent="Retry",c(u,"class","button is-primary"),c(t,"class","error-content svelte-1ry9pkl"),c(e,"class","error-overlay svelte-1ry9pkl")},m(d,_){S(d,e,_),a(e,t),a(t,n),a(t,o),a(t,r),a(r,s),a(t,i),a(t,u),p||(m=X(u,"click",l[11]),p=!0)},p(d,_){_&8&&Se(s,d[3])},d(d){d&&y(e),p=!1,m()}}}function Gs(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="loading-content svelte-1ry9pkl"><div class="loader svelte-1ry9pkl"></div> 
        <p>Loading knowledge graph...</p></div>`,c(e,"class","loading-overlay svelte-1ry9pkl")},m(t,n){S(t,e,n)},p:ge,d(t){t&&y(e)}}}function un(l){let e,t,n;return{c(){e=f("button"),e.innerHTML='<i class="fas fa-times svelte-1ry9pkl"></i>',c(e,"class","close-button svelte-1ry9pkl"),c(e,"title","Close Graph")},m(o,r){S(o,e,r),t||(n=X(e,"click",l[17]),t=!0)},p:ge,d(o){o&&y(e),t=!1,n()}}}function cn(l){let e;return{c(){e=f("div"),e.innerHTML="<span><strong>Left-click:</strong> View node • <strong>Right-click:</strong> Edit node • <strong>Drag:</strong> Move • <strong>Scroll:</strong> Zoom</span>",c(e,"class","controls-info svelte-1ry9pkl")},m(t,n){S(t,e,n)},d(t){t&&y(e)}}}function fn(l){let e,t;return{c(){e=f("div"),t=Z(l[8]),c(e,"class","debug-message svelte-1ry9pkl")},m(n,o){S(n,e,o),a(e,t)},p(n,o){o&256&&Se(t,n[8])},d(n){n&&y(e)}}}function pn(l){let e=l[5].id,t,n,o=dn(l);return{c(){o.c(),t=rt()},m(r,s){o.m(r,s),S(r,t,s),n=!0},p(r,s){s&32&&Ze(e,e=r[5].id)?(Ae(),M(o,1,1,ge),Oe(),o=dn(r),o.c(),A(o,1),o.m(t.parentNode,t)):o.p(r,s)},i(r){n||(A(o),n=!0)},o(r){M(o),n=!1},d(r){r&&y(t),o.d(r)}}}function dn(l){let e,t,n;function o(s){l[18](s)}let r={item:l[5],initialEdit:l[7]};return l[6]!==void 0&&(r.active=l[6]),e=new tl({props:r}),Ee.push(()=>je(e,"active",o)),e.$on("close",l[12]),e.$on("save",l[13]),{c(){ee(e.$$.fragment)},m(s,i){te(e,s,i),n=!0},p(s,i){const u={};i&32&&(u.item=s[5]),i&128&&(u.initialEdit=s[7]),!t&&i&64&&(t=!0,u.active=s[6],He(()=>t=!1)),e.$set(u)},i(s){n||(A(e.$$.fragment,s),n=!0)},o(s){M(e.$$.fragment,s),n=!1},d(s){le(e,s)}}}function Ks(l){let e,t,n,o,r,s,i,u,p;nt(l[15]);function m(v,k){if(v[2])return Gs;if(v[3])return Fs}let d=m(l),_=d&&d(l),h=l[0]&&un(l),g=!l[2]&&!l[3]&&l[4].length>0&&cn(),b=l[8]&&fn(l),w=l[5]&&pn(l);return{c(){e=f("div"),_&&_.c(),t=$(),h&&h.c(),n=$(),g&&g.c(),o=$(),b&&b.c(),r=$(),w&&w.c(),s=rt(),c(e,"class","graph-container svelte-1ry9pkl"),$t(e,"width",l[0]?"100vw":"600px"),$t(e,"height",l[0]?"100vh":"400px"),qt(e,"fullscreen",l[0])},m(v,k){S(v,e,k),_&&_.m(e,null),l[16](e),S(v,t,k),h&&h.m(v,k),S(v,n,k),g&&g.m(v,k),S(v,o,k),b&&b.m(v,k),S(v,r,k),w&&w.m(v,k),S(v,s,k),i=!0,u||(p=X(Xt,"resize",l[15]),u=!0)},p(v,[k]){d===(d=m(v))&&_?_.p(v,k):(_&&_.d(1),_=d&&d(v),_&&(_.c(),_.m(e,null))),(!i||k&1)&&$t(e,"width",v[0]?"100vw":"600px"),(!i||k&1)&&$t(e,"height",v[0]?"100vh":"400px"),(!i||k&1)&&qt(e,"fullscreen",v[0]),v[0]?h?h.p(v,k):(h=un(v),h.c(),h.m(n.parentNode,n)):h&&(h.d(1),h=null),!v[2]&&!v[3]&&v[4].length>0?g||(g=cn(),g.c(),g.m(o.parentNode,o)):g&&(g.d(1),g=null),v[8]?b?b.p(v,k):(b=fn(v),b.c(),b.m(r.parentNode,r)):b&&(b.d(1),b=null),v[5]?w?(w.p(v,k),k&32&&A(w,1)):(w=pn(v),w.c(),A(w,1),w.m(s.parentNode,s)):w&&(Ae(),M(w,1,1,()=>{w=null}),Oe())},i(v){i||(A(w),i=!0)},o(v){M(w),i=!1},d(v){v&&y(e),_&&_.d(),l[16](null),v&&y(t),h&&h.d(v),v&&y(n),g&&g.d(v),v&&y(o),b&&b.d(v),v&&y(r),w&&w.d(v),v&&y(s),u=!1,p()}}}function _n(l){return{id:`kg-node-${l.id}`,url:`#/graph/node/${l.id}`,title:l.label,body:`# ${l.label}

**Knowledge Graph Node**

ID: ${l.id}
Rank: ${l.rank}

This is a concept node from the knowledge graph. You can edit this content to add more information about "${l.label}".`,description:`Knowledge graph concept: ${l.label}`,tags:["knowledge-graph","concept"],rank:l.rank,stub:`Knowledge graph concept: ${l.label}`}}function Ws(l,e,t){let n,o;he(l,_t,C=>t(20,n=C)),he(l,Qe,C=>t(21,o=C));let{apiUrl:r="/rolegraph"}=e,{fullscreen:s=!0}=e,i,u=!0,p=null,m=[],d=[],_=null,h=!1,g=!1,b="",w=window.innerWidth,v=window.innerHeight;function k(){t(9,w=window.innerWidth),t(10,v=window.innerHeight),!u&&!p&&U()}async function L(){t(2,u=!0),t(3,p=null);try{if(o){console.log("Loading rolegraph from Tauri");const C=await Pe("get_rolegraph",{role_name:n||void 0});if(C&&C.status==="success")t(4,m=C.nodes),d=C.edges;else throw new Error(`Tauri rolegraph fetch failed: ${(C==null?void 0:C.status)||"unknown error"}`)}else{console.log("Loading rolegraph from server");const C=n?`${r}?role=${encodeURIComponent(n)}`:r,Y=await fetch(C);if(!Y.ok)throw new Error(`Failed to fetch: ${Y.status}`);const O=await Y.json();t(4,m=O.nodes),d=O.edges}}catch(C){t(3,p=C.message),console.error("Error fetching rolegraph:",C)}finally{t(2,u=!1)}}function K(C,Y){C.stopPropagation(),console.log("Node clicked:",Y.label),t(5,_=_n(Y)),t(7,g=!1),t(6,h=!0)}function z(C,Y){C.preventDefault(),C.stopPropagation(),console.log("Node right-clicked:",Y.label),t(8,b=`Right-clicked: ${Y.label}`),t(5,_=_n(Y)),t(7,g=!0),t(6,h=!0),setTimeout(()=>{t(8,b="")},2e3)}function R(){t(6,h=!1),t(5,_=null),t(7,g=!1)}async function T(){if(_)try{const C=await fetch("/documents",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(_)});C.ok?console.log("Successfully saved KG record:",_.id):console.error("Failed to save KG record:",C.statusText)}catch(C){console.error("Error saving KG record:",C)}finally{t(6,h=!1),t(5,_=null),t(7,g=!1)}}function U(){if(!i)return;t(1,i.innerHTML="",i);const C=Vt(i).append("svg").attr("width",w).attr("height",v),Y=Qn().scaleExtent([.1,10]).on("zoom",H=>{O.attr("transform",H.transform)});C.call(Y);const O=C.append("g"),P=Zn(m).force("link",Xn(d).id(H=>H.id).distance(100)).force("charge",xn().strength(-200)).force("center",eo(w/2,v/2)).force("collision",to().radius(20)),E=O.append("g").attr("class","links").selectAll("line").data(d).enter().append("line").attr("stroke","#666").attr("stroke-opacity",.7).attr("stroke-width",H=>{const Q=H.weight||H.rank||1;return Math.max(1,Math.min(8,Q*2))}),D=O.append("g").attr("class","nodes").selectAll("circle").data(m).enter().append("circle").attr("r",H=>{const Q=H.rank||1;return Math.max(6,Math.min(20,Q*2))}).attr("fill",H=>{const Q=H.rank||1,oe=Math.min(Q/10,1);return lo(.2+oe*.6)}).attr("stroke","#fff").attr("stroke-width",2).style("cursor","pointer").on("click",(H,Q)=>K(H,Q)).on("contextmenu",(H,Q)=>z(H,Q)).on("mouseover",function(H,Q){Vt(this).transition().duration(150).attr("stroke-width",3).attr("r",oe=>{const se=oe.rank||1;return Math.max(8,Math.min(24,se*2.5))})}).on("mouseout",function(H,Q){Vt(this).transition().duration(150).attr("stroke-width",2).attr("r",oe=>{const se=oe.rank||1;return Math.max(6,Math.min(20,se*2))})}).call(no().on("start",F).on("drag",q).on("end",ne)),W=O.append("g").attr("class","labels").selectAll("text").data(m).enter().append("text").attr("text-anchor","middle").attr("dy",".35em").attr("font-size","11px").attr("font-family","Arial, sans-serif").attr("fill","#333").attr("pointer-events","none").text(H=>H.label.length>12?H.label.substring(0,12)+"...":H.label);P.on("tick",()=>{E.attr("x1",H=>H.source.x).attr("y1",H=>H.source.y).attr("x2",H=>H.target.x).attr("y2",H=>H.target.y),D.attr("cx",H=>H.x).attr("cy",H=>H.y),W.attr("x",H=>H.x).attr("y",H=>H.y)});function F(H,Q){H.active||P.alphaTarget(.3).restart(),Q.fx=Q.x,Q.fy=Q.y}function q(H,Q){Q.fx=H.x,Q.fy=H.y}function ne(H,Q){H.active||P.alphaTarget(0),Q.fx=null,Q.fy=null}}el(()=>{L().then(()=>{p||U()});const C=Y=>{Y.preventDefault()};return i&&i.addEventListener("contextmenu",C),window.addEventListener("resize",k),()=>{i&&i.removeEventListener("contextmenu",C),window.removeEventListener("resize",k)}});function I(){t(9,w=Xt.innerWidth),t(10,v=Xt.innerHeight)}function V(C){Ee[C?"unshift":"push"](()=>{i=C,t(1,i)})}const J=()=>history.back();function j(C){h=C,t(6,h)}return l.$$set=C=>{"apiUrl"in C&&t(14,r=C.apiUrl),"fullscreen"in C&&t(0,s=C.fullscreen)},[s,i,u,p,m,_,h,g,b,w,v,L,R,T,r,I,V,J,j]}class qs extends xe{constructor(e){super(),et(this,e,Ws,Ks,Ze,{apiUrl:14,fullscreen:0})}}function Bs(l){let e,t;return e=new Ts({}),{c(){ee(e.$$.fragment)},m(n,o){te(e,n,o),t=!0},i(n){t||(A(e.$$.fragment,n),t=!0)},o(n){M(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function zs(l){let e,t;return e=new Lo({}),{c(){ee(e.$$.fragment)},m(n,o){te(e,n,o),t=!0},i(n){t||(A(e.$$.fragment,n),t=!0)},o(n){M(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function Js(l){let e,t;return e=new Ps({}),{c(){ee(e.$$.fragment)},m(n,o){te(e,n,o),t=!0},i(n){t||(A(e.$$.fragment,n),t=!0)},o(n){M(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function Vs(l){let e,t;return e=new Is({}),{c(){ee(e.$$.fragment)},m(n,o){te(e,n,o),t=!0},i(n){t||(A(e.$$.fragment,n),t=!0)},o(n){M(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function Ys(l){let e,t;return e=new qs({}),{c(){ee(e.$$.fragment)},m(n,o){te(e,n,o),t=!0},i(n){t||(A(e.$$.fragment,n),t=!0)},o(n){M(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function Qs(l){let e;return{c(){e=f("nav"),e.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
            <a class="navbar-item" href="/config/wizard">Wizard</a> 
            <a class="navbar-item" href="/config/json">JSON Editor</a> 
            <a class="navbar-item" href="/graph">Graph</a></div>`,c(e,"class","navbar")},m(t,n){S(t,e,n)},p:ge,d(t){t&&y(e)}}}function Zs(l){let e,t,n,o,r,s,i,u,p,m,d,_,h,g,b,w,v,k,L,K,z,R,T,U,I,V,J,j;return i=new Kt({}),m=new ct({props:{path:"/",$$slots:{default:[Bs]},$$scope:{ctx:l}}}),g=new ct({props:{path:"/fetch/*",$$slots:{default:[zs]},$$scope:{ctx:l}}}),w=new ct({props:{path:"/config/wizard",$$slots:{default:[Js]},$$scope:{ctx:l}}}),k=new ct({props:{path:"/config/json",$$slots:{default:[Vs]},$$scope:{ctx:l}}}),K=new ct({props:{path:"/graph",$$slots:{default:[Ys]},$$scope:{ctx:l}}}),U=new ct({props:{path:"/",$$slots:{default:[Qs]},$$scope:{ctx:l}}}),{c(){e=f("meta"),t=$(),n=f("div"),o=f("main"),r=f("div"),s=f("div"),ee(i.$$.fragment),u=$(),p=f("div"),ee(m.$$.fragment),d=$(),_=f("br"),h=$(),ee(g.$$.fragment),b=$(),ee(w.$$.fragment),v=$(),ee(k.$$.fragment),L=$(),ee(K.$$.fragment),z=$(),R=f("footer"),T=f("div"),ee(U.$$.fragment),c(e,"name","color-scheme"),c(e,"content",l[1]),document.title="Terraphim",c(s,"class","role-selector svelte-1bfpta4"),c(r,"class","top-controls svelte-1bfpta4"),c(p,"class","search-area svelte-1bfpta4"),c(o,"class","main-content svelte-1bfpta4"),c(T,"class",I=pl(l[0])+" svelte-1bfpta4"),c(R,"class","svelte-1bfpta4"),c(n,"class","is-full-height svelte-1bfpta4")},m(C,Y){a(document.head,e),S(C,t,Y),S(C,n,Y),a(n,o),a(o,r),a(r,s),te(i,s,null),a(o,u),a(o,p),te(m,p,null),a(o,d),a(o,_),a(o,h),te(g,o,null),a(o,b),te(w,o,null),a(o,v),te(k,o,null),a(o,L),te(K,o,null),a(n,z),a(n,R),a(R,T),te(U,T,null),V=!0,J||(j=[X(R,"mouseover",l[2]),X(R,"focus",l[2])],J=!0)},p(C,[Y]){(!V||Y&2)&&c(e,"content",C[1]);const O={};Y&8&&(O.$$scope={dirty:Y,ctx:C}),m.$set(O);const P={};Y&8&&(P.$$scope={dirty:Y,ctx:C}),g.$set(P);const E={};Y&8&&(E.$$scope={dirty:Y,ctx:C}),w.$set(E);const D={};Y&8&&(D.$$scope={dirty:Y,ctx:C}),k.$set(D);const W={};Y&8&&(W.$$scope={dirty:Y,ctx:C}),K.$set(W);const F={};Y&8&&(F.$$scope={dirty:Y,ctx:C}),U.$set(F),(!V||Y&1&&I!==(I=pl(C[0])+" svelte-1bfpta4"))&&c(T,"class",I)},i(C){V||(A(i.$$.fragment,C),A(m.$$.fragment,C),A(g.$$.fragment,C),A(w.$$.fragment,C),A(k.$$.fragment,C),A(K.$$.fragment,C),A(U.$$.fragment,C),V=!0)},o(C){M(i.$$.fragment,C),M(m.$$.fragment,C),M(g.$$.fragment,C),M(w.$$.fragment,C),M(k.$$.fragment,C),M(K.$$.fragment,C),M(U.$$.fragment,C),V=!1},d(C){y(e),C&&y(t),C&&y(n),le(i),le(m),le(g),le(w),le(k),le(K),le(U),J=!1,qe(j)}}}function Xs(l,e,t){let n;he(l,Pt,s=>t(1,n=s));let o="is-hidden";function r(){t(0,o="")}return[o,n,r]}class xs extends xe{constructor(e){super(),et(this,e,Xs,Zs,Ze,{})}}const er=new Jn;Vn(er);new xs({target:document.getElementById("app")});
