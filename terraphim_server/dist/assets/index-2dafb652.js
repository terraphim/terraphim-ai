var sr=Object.defineProperty;var rr=(l,e,t)=>e in l?sr(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var Ct=(l,e,t)=>(rr(l,typeof e!="symbol"?e+"":e,t),t);import{aa as Dt,S as _t,i as ht,s as pt,q as f,Y as P,b as S,y as s,Z as be,I as Re,j as T,ak as Ue,F as ut,m as tl,a as g,v as c,l as re,E as Ve,au as Ft,r as he,z as ge,t as U,d as Y,B as ve,av as ir,aw as Qt,H as lt,U as st,V as rt,ax as Kt,ay as ar,g as Fe,e as Ke,O as tt,af as Rt,o as Ks,W as we,az as wl,aA as St,aB as Wl,aC as qs,a1 as Oe,C as mt,aD as Je,aE as Bl,D as pl,G as ml,aF as qt,w as Pt,x as dt,A as Jl,a2 as cr,aG as Ht,ac as ur,a5 as fr,a7 as dr,a9 as pr,n as mr,k as Ql,aH as Vt,_ as Hl}from"./vendor-ui-65216d17.js";import{R as Nt,S as Ul,f as _r,Y as Fl}from"./vendor-utils-f7aada8e.js";import{J as Gs,_ as hr,c as Ws,P as gr,i as vr,D as br,j as kr,E as wr,k as wn}from"./vendor-editor-f87b2f73.js";import{P as Bs,T as jl,b as Js,y as yr,A as $r,a as Cr,q as Tr}from"./vendor-atomic-911c42f7.js";import{t as Sr,E as Rr}from"./novel-editor-72d0a44a.js";import{s as Kl,z as Ar,a as Er,l as Lr,m as Dr,c as Or,b as Nr,B as Ir,d as Pr}from"./vendor-charts-e6a4a6c9.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function t(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=t(o);fetch(o.href,a)}})();const Qe={ServerURL:location.protocol+"//"+window.location.host||"/"},bl=Dt([]),Mr={id:"Desktop",global_shortcut:"",roles:{},default_role:{original:"",lowercase:""},selected_role:{original:"",lowercase:""}},kl=Dt("spacelab"),At=Dt("selected"),ct=Dt(!1),jr=Dt(`${Qe.ServerURL}/documents/search`),Lt=Dt(Mr),yn=Dt([]);let Bt=Dt("");const Tt=Dt(!1);let el=null;function Ur(l){if(typeof document>"u")return;const e=`/assets/bulmaswatch/${l}/bulmaswatch.min.css`;if(el!=null&&el.href.endsWith(e))return;const t=document.createElement("link");t.rel="stylesheet",t.href=e,t.id="bulma-theme",t.onload=()=>{el&&el!==t&&el.remove(),el=t},document.head.appendChild(t);const n=document.head.querySelector('meta[name="color-scheme"]');n&&n.setAttribute("content",l)}kl.subscribe(Ur);function zr(l){let e,t;return{c(){e=f("option"),t=P(l[1]),e.__value=l[0],e.value=e.__value},m(n,o){S(n,e,o),s(e,t)},p(n,[o]){o&2&&be(t,n[1]),o&1&&(e.__value=n[0],e.value=e.__value)},i:Re,o:Re,d(n){n&&T(e)}}}function Hr(l,e,t){let n,{subject:o}=e;const a=Bs(o),r=jl(a,Js.properties.name);return Ue(l,r,u=>t(1,n=u)),jl(a,"http://localhost:9883/property/theme"),l.$$set=u=>{"subject"in u&&t(0,o=u.subject)},[o,n,r]}class Fr extends _t{constructor(e){super(),ht(this,e,Hr,zr,pt,{subject:0})}}function $n(l){let e,t,n,o,a,r,u=l[0]&&Cn();return{c(){e=f("button"),t=f("span"),t.innerHTML='<i class="fas fa-arrow-left"></i>',n=g(),u&&u.c(),c(t,"class","icon svelte-rnsqpo"),c(e,"class",o="button is-light back-button "+l[1]+" svelte-rnsqpo"),c(e,"title","Go back"),c(e,"aria-label","Go back")},m(i,d){S(i,e,d),s(e,t),s(e,n),u&&u.m(e,null),a||(r=[re(e,"click",l[3]),re(e,"keydown",l[6])],a=!0)},p(i,d){i[0]?u||(u=Cn(),u.c(),u.m(e,null)):u&&(u.d(1),u=null),d&2&&o!==(o="button is-light back-button "+i[1]+" svelte-rnsqpo")&&c(e,"class",o)},d(i){i&&T(e),u&&u.d(),a=!1,Ve(r)}}}function Cn(l){let e;return{c(){e=f("span"),e.textContent="Back",c(e,"class","back-text svelte-rnsqpo")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function Kr(l){let e,t=l[2]&&$n(l);return{c(){t&&t.c(),e=ut()},m(n,o){t&&t.m(n,o),S(n,e,o)},p(n,[o]){n[2]?t?t.p(n,o):(t=$n(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Re,o:Re,d(n){t&&t.d(n),n&&T(e)}}}function qr(l,e,t){let{fallbackPath:n="/"}=e,{showText:o=!0}=e,{customClass:a=""}=e,{hideOnPaths:r=["/"]}=e,u=!0;function i(){var m;try{const _=((m=window.location)==null?void 0:m.pathname)||"/";t(2,u=!r.includes(_))}catch{t(2,u=!0)}}function d(){window.history.length>1?window.history.back():window.location.href=n}tl(()=>(i(),window.addEventListener("popstate",i),window.addEventListener("hashchange",i),()=>{window.removeEventListener("popstate",i),window.removeEventListener("hashchange",i)}));const p=m=>{(m.key==="Enter"||m.key===" ")&&(m.preventDefault(),d())};return l.$$set=m=>{"fallbackPath"in m&&t(4,n=m.fallbackPath),"showText"in m&&t(0,o=m.showText),"customClass"in m&&t(1,a=m.customClass),"hideOnPaths"in m&&t(5,r=m.hideOnPaths)},[o,a,u,d,n,r,p]}class _l extends _t{constructor(e){super(),ht(this,e,qr,Kr,pt,{fallbackPath:4,showText:0,customClass:1,hideOnPaths:5})}}function Gr(){return window.crypto.getRandomValues(new Uint32Array(1))[0]}function ql(l,e=!1){const t=Gr(),n=`_${t}`;return Object.defineProperty(window,n,{value:o=>(e&&Reflect.deleteProperty(window,n),l==null?void 0:l(o)),writable:!1,configurable:!0}),t}async function je(l,e={}){return new Promise((t,n)=>{const o=ql(r=>{t(r),Reflect.deleteProperty(window,`_${a}`)},!0),a=ql(r=>{n(r),Reflect.deleteProperty(window,`_${o}`)},!0);window.__TAURI_IPC__({cmd:l,callback:o,error:a,...e})})}function Tn(l,e,t){const n=l.slice();return n[25]=e[t],n}function Wr(l){let e,t,n;function o(r){l[13](r)}let a={};return l[5]!==void 0&&(a.value=l[5]),e=new Qt({props:a}),lt.push(()=>st(e,"value",o)),{c(){he(e.$$.fragment)},m(r,u){ge(e,r,u),n=!0},p(r,u){const i={};!t&&u&32&&(t=!0,i.value=r[5],rt(()=>t=!1)),e.$set(i)},i(r){n||(U(e.$$.fragment,r),n=!0)},o(r){Y(e.$$.fragment,r),n=!1},d(r){ve(e,r)}}}function Br(l){let e,t,n;function o(r){l[14](r)}let a={type:"password",placeholder:"secret",icon:"fas fa-lock",expanded:!0};return l[6]!==void 0&&(a.value=l[6]),e=new Qt({props:a}),lt.push(()=>st(e,"value",o)),{c(){he(e.$$.fragment)},m(r,u){ge(e,r,u),n=!0},p(r,u){const i={};!t&&u&64&&(t=!0,i.value=r[6],rt(()=>t=!1)),e.$set(i)},i(r){n||(U(e.$$.fragment,r),n=!0)},o(r){Y(e.$$.fragment,r),n=!1},d(r){ve(e,r)}}}function Jr(l){let e;return{c(){e=P("Save")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function Qr(l){let e,t;return e=new Kt({props:{type:"is-success",class:"is-right",iconPack:"fa",iconLeft:"check",$$slots:{default:[Jr]},$$scope:{ctx:l}}}),e.$on("click",l[8]),e.$on("submit",l[8]),{c(){he(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},p(n,o){const a={};o&268435456&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(U(e.$$.fragment,n),t=!0)},o(n){Y(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function Vr(l){let e,t,n,o,a,r;return e=new Ft({props:{$$slots:{default:[Wr]},$$scope:{ctx:l}}}),n=new Ft({props:{grouped:!0,$$slots:{default:[Br]},$$scope:{ctx:l}}}),a=new Ft({props:{grouped:!0,$$slots:{default:[Qr]},$$scope:{ctx:l}}}),{c(){he(e.$$.fragment),t=g(),he(n.$$.fragment),o=g(),he(a.$$.fragment)},m(u,i){ge(e,u,i),S(u,t,i),ge(n,u,i),S(u,o,i),ge(a,u,i),r=!0},p(u,i){const d={};i&268435488&&(d.$$scope={dirty:i,ctx:u}),e.$set(d);const p={};i&268435520&&(p.$$scope={dirty:i,ctx:u}),n.$set(p);const m={};i&268435456&&(m.$$scope={dirty:i,ctx:u}),a.$set(m)},i(u){r||(U(e.$$.fragment,u),U(n.$$.fragment,u),U(a.$$.fragment,u),r=!0)},o(u){Y(e.$$.fragment,u),Y(n.$$.fragment,u),Y(a.$$.fragment,u),r=!1},d(u){ve(e,u),u&&T(t),ve(n,u),u&&T(o),ve(a,u)}}}function Yr(l){let e,t,n;function o(r){l[15](r)}let a={type:"search",placeholder:"Fetch JSON",icon:"search"};return l[3]!==void 0&&(a.value=l[3]),e=new Qt({props:a}),lt.push(()=>st(e,"value",o)),{c(){he(e.$$.fragment)},m(r,u){ge(e,r,u),n=!0},p(r,u){const i={};!t&&u&8&&(t=!0,i.value=r[3],rt(()=>t=!1)),e.$set(i)},i(r){n||(U(e.$$.fragment,r),n=!0)},o(r){Y(e.$$.fragment,r),n=!1},d(r){ve(e,r)}}}function Zr(l){let e;return{c(){e=P("WikiPage")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function Xr(l){let e,t,n,o,a,r;function u(m){l[16](m)}let i={type:"search",placeholder:"Post JSON",icon:"search"};l[4]!==void 0&&(i.value=l[4]),e=new Qt({props:i}),lt.push(()=>st(e,"value",u));function d(m){l[17](m)}let p={$$slots:{default:[Zr]},$$scope:{ctx:l}};return l[2]!==void 0&&(p.checked=l[2]),o=new ar({props:p}),lt.push(()=>st(o,"checked",d)),{c(){he(e.$$.fragment),n=g(),he(o.$$.fragment)},m(m,_){ge(e,m,_),S(m,n,_),ge(o,m,_),r=!0},p(m,_){const h={};!t&&_&16&&(t=!0,h.value=m[4],rt(()=>t=!1)),e.$set(h);const w={};_&268435456&&(w.$$scope={dirty:_,ctx:m}),!a&&_&4&&(a=!0,w.checked=m[2],rt(()=>a=!1)),o.$set(w)},i(m){r||(U(e.$$.fragment,m),U(o.$$.fragment,m),r=!0)},o(m){Y(e.$$.fragment,m),Y(o.$$.fragment,m),r=!1},d(m){ve(e,m),m&&T(n),ve(o,m)}}}function xr(l){let e;return{c(){e=P("Fetch")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function ei(l){let e,t;return e=new Kt({props:{type:"is-primary",$$slots:{default:[xr]},$$scope:{ctx:l}}}),e.$on("click",l[9]),e.$on("submit",l[9]),{c(){he(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},p(n,o){const a={};o&268435456&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(U(e.$$.fragment,n),t=!0)},o(n){Y(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function ti(l){let e,t,n,o,a,r;return e=new Ft({props:{grouped:!0,$$slots:{default:[Yr]},$$scope:{ctx:l}}}),n=new Ft({props:{grouped:!0,$$slots:{default:[Xr]},$$scope:{ctx:l}}}),a=new Ft({props:{grouped:!0,$$slots:{default:[ei]},$$scope:{ctx:l}}}),{c(){he(e.$$.fragment),t=g(),he(n.$$.fragment),o=g(),he(a.$$.fragment)},m(u,i){ge(e,u,i),S(u,t,i),ge(n,u,i),S(u,o,i),ge(a,u,i),r=!0},p(u,i){const d={};i&268435464&&(d.$$scope={dirty:i,ctx:u}),e.$set(d);const p={};i&268435476&&(p.$$scope={dirty:i,ctx:u}),n.$set(p);const m={};i&268435456&&(m.$$scope={dirty:i,ctx:u}),a.$set(m)},i(u){r||(U(e.$$.fragment,u),U(n.$$.fragment,u),U(a.$$.fragment,u),r=!0)},o(u){Y(e.$$.fragment,u),Y(n.$$.fragment,u),Y(a.$$.fragment,u),r=!1},d(u){ve(e,u),u&&T(t),ve(n,u),u&&T(o),ve(a,u)}}}function li(l){let e,t,n,o,a;return o=new Gs({props:{content:l[1],onChange:l[7]}}),{c(){e=f("p"),e.innerHTML=`<i>The best editing experience is to configure Atomic Server, in the
        meantime use editor below. You will need to refresh page via Command R
        or Ctrl-R to see changes</i>`,t=g(),n=f("div"),he(o.$$.fragment),c(n,"class","editor")},m(r,u){S(r,e,u),S(r,t,u),S(r,n,u),ge(o,n,null),a=!0},p(r,u){const i={};u&2&&(i.content=r[1]),o.$set(i)},i(r){a||(U(o.$$.fragment,r),a=!0)},o(r){Y(o.$$.fragment,r),a=!1},d(r){r&&T(e),r&&T(t),r&&T(n),ve(o)}}}function Sn(l){let e,t;return e=new Fr({props:{subject:l[25]}}),{c(){he(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},p(n,o){const a={};o&1&&(a.subject=n[25]),e.$set(a)},i(n){t||(U(e.$$.fragment,n),t=!0)},o(n){Y(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function ni(l){let e,t,n=l[0]??[],o=[];for(let r=0;r<n.length;r+=1)o[r]=Sn(Tn(l,n,r));const a=r=>Y(o[r],1,1,()=>{o[r]=null});return{c(){for(let r=0;r<o.length;r+=1)o[r].c();e=ut()},m(r,u){for(let i=0;i<o.length;i+=1)o[i]&&o[i].m(r,u);S(r,e,u),t=!0},p(r,u){if(u&1){n=r[0]??[];let i;for(i=0;i<n.length;i+=1){const d=Tn(r,n,i);o[i]?(o[i].p(d,u),U(o[i],1)):(o[i]=Sn(d),o[i].c(),U(o[i],1),o[i].m(e.parentNode,e))}for(Fe(),i=n.length;i<o.length;i+=1)a(i);Ke()}},i(r){if(!t){for(let u=0;u<n.length;u+=1)U(o[u]);t=!0}},o(r){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)Y(o[u]);t=!1},d(r){tt(o,r),r&&T(e)}}}function oi(l){let e,t;return e=new ir({props:{$$slots:{default:[ni]},$$scope:{ctx:l}}}),{c(){he(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},p(n,o){const a={};o&268435457&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(U(e.$$.fragment,n),t=!0)},o(n){Y(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function si(l){let e,t,n,o,a,r,u,i,d,p,m,_,h,w,b;return e=new _l({props:{fallbackPath:"/"}}),o=new Nt({props:{path:"/atomic",$$slots:{default:[Vr]},$$scope:{ctx:l}}}),r=new Nt({props:{path:"/json",$$slots:{default:[ti]},$$scope:{ctx:l}}}),i=new Nt({props:{path:"/editor",$$slots:{default:[li]},$$scope:{ctx:l}}}),_=new Ft({props:{grouped:!0,position:"is-right",$$slots:{default:[oi]},$$scope:{ctx:l}}}),{c(){he(e.$$.fragment),t=g(),n=f("div"),he(o.$$.fragment),a=g(),he(r.$$.fragment),u=g(),he(i.$$.fragment),d=g(),p=f("hr"),m=g(),he(_.$$.fragment),h=g(),w=f("nav"),w.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
    <a class="navbar-item" href="/fetch/json">Fetch JSON Data</a> 
    <a class="navbar-item" href="/fetch/atomic">Set Atomic Server</a> 
    <a class="navbar-item" href="/fetch/editor">Edit JSON config</a></div>`,c(n,"class","box"),c(w,"class","navbar")},m(k,$){ge(e,k,$),S(k,t,$),S(k,n,$),ge(o,n,null),s(n,a),ge(r,n,null),s(n,u),ge(i,n,null),S(k,d,$),S(k,p,$),S(k,m,$),ge(_,k,$),S(k,h,$),S(k,w,$),b=!0},p(k,[$]){const y={};$&268435552&&(y.$$scope={dirty:$,ctx:k}),o.$set(y);const v={};$&268435484&&(v.$$scope={dirty:$,ctx:k}),r.$set(v);const C={};$&268435458&&(C.$$scope={dirty:$,ctx:k}),i.$set(C);const q={};$&268435457&&(q.$$scope={dirty:$,ctx:k}),_.$set(q)},i(k){b||(U(e.$$.fragment,k),U(o.$$.fragment,k),U(r.$$.fragment,k),U(i.$$.fragment,k),U(_.$$.fragment,k),b=!0)},o(k){Y(e.$$.fragment,k),Y(o.$$.fragment,k),Y(r.$$.fragment,k),Y(i.$$.fragment,k),Y(_.$$.fragment,k),b=!1},d(k){ve(e,k),k&&T(t),k&&T(n),ve(o),ve(r),ve(i),k&&T(d),k&&T(p),k&&T(m),ve(_,k),k&&T(h),k&&T(w)}}}function ri(l,e,t){let n,o,a,r,u;Ue(l,yr,L=>t(19,a=L)),Ue(l,ct,L=>t(20,r=L)),Ue(l,Lt,L=>t(21,u=L));let i={json:u};function d(L){if(console.log("contents changed:",L),console.log("is tauri",r),Lt.update(A=>(A=L.json,A)),ct)console.log("Updating config on server"),je("update_config",{configNew:L.json}).then(A=>{console.log(`Message: ${A}`)}).catch(A=>console.error(A));else{let A=`${Qe.ServerURL}/config/`;fetch(A,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(L.json)})}t(1,i=L)}let p=!1,m="https://raw.githubusercontent.com/terraphim/terraphim-cloud-fastapi/main/data/ref_arch.json",_="http://localhost:8000/documents/",h="http://localhost:9883/",w;const b=async()=>{console.log("Updating atomic server configuration");const L=$r.fromSecret(w);a.setServerUrl(h),console.log("Server set.Setting agent"),a.setAgent(L)},k=async()=>{v()},$=({data:{msg:L,data:A}})=>{console.log(L,A)};let y;const v=async()=>{const L=await hr(()=>import("./fetcher.worker-7e58969a.js"),[]);y=new L.default,y.onmessage=$;const A={msg:"fetcher",data:{url:m,postUrl:_,isWiki:p}};y.postMessage(A)},C=Bs("http://localhost:9883/config/y3zx5wtm0bq"),q=jl(C,Js.properties.name);Ue(l,q,L=>t(12,o=L));const I=jl(C,"http://localhost:9883/property/role");Ue(l,I,L=>t(0,n=L));function N(L){h=L,t(5,h)}function R(L){w=L,t(6,w)}function F(L){m=L,t(3,m)}function le(L){_=L,t(4,_)}function V(L){p=L,t(2,p)}return l.$$.update=()=>{l.$$.dirty&4096&&console.log("Print name",o),l.$$.dirty&1&&console.log("Print roles",n)},[n,i,p,m,_,h,w,d,b,k,q,I,o,N,R,F,le,V]}class ii extends _t{constructor(e){super(),ht(this,e,ri,si,pt,{})}}function Jt(){return Rt(ct)||typeof window<"u"&&window.__TAURI__!==void 0}class ai{constructor(){Ct(this,"baseUrl");Ct(this,"autocompleteIndexBuilt",!1);Ct(this,"sessionId");Ct(this,"currentRole","Default");Ct(this,"connectionRetries",0);Ct(this,"maxRetries",3);Ct(this,"retryDelay",1e3);Ct(this,"isConnecting",!1);this.baseUrl=typeof window<"u"?(window.location.protocol==="https:"?"https://":"http://")+window.location.hostname+":8001":"http://localhost:8001",this.sessionId=`novel-${Date.now()}`,typeof window<"u"&&!Jt()&&this.shouldPerformHealthCheck()?this.detectServerPort():typeof window<"u"&&!Jt()&&console.log("NovelAutocompleteService: Skipping server detection - not needed for current page")}setRole(e){this.currentRole=e,this.autocompleteIndexBuilt=!1}async detectServerPort(){if(Jt())return;if(!this.shouldPerformHealthCheck()){console.log("NovelAutocompleteService: Skipping health check - service not needed");return}const t=[8001,3e3];for(const n of t)try{const o=typeof window<"u"?(window.location.protocol==="https:"?"https://":"http://")+window.location.hostname+":"+n:"http://localhost:"+n,a=await fetch(`${o}/message?sessionId=health-check`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:0,method:"ping",params:{}}),signal:AbortSignal.timeout(1e3)});if(a.ok||a.status===404){this.baseUrl=o,console.log(`NovelAutocompleteService: Detected server at ${o}`);return}}catch{continue}console.warn("NovelAutocompleteService: Could not detect running server, using default:",this.baseUrl)}shouldPerformHealthCheck(){return!(typeof window<"u"&&(!window.location.pathname.startsWith("/chat")||!(document.querySelector('[contenteditable="true"]')||document.querySelector("textarea")||document.querySelector('input[type="text"]'))))}async buildAutocompleteIndex(){if(this.isConnecting)return await new Promise(e=>setTimeout(e,1e3)),this.autocompleteIndexBuilt;this.isConnecting=!0;try{return Jt()?(console.log("Using Tauri backend - no index building required"),this.autocompleteIndexBuilt=!0,this.connectionRetries=0,console.log("Tauri autocomplete ready"),!0):await this.buildMCPIndex()}catch(e){return console.error("Error building Novel autocomplete index:",e),!1}finally{this.isConnecting=!1}}async buildMCPIndex(){for(let e=0;e<=this.maxRetries;e++)try{const t=await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:Date.now(),method:"tools/call",params:{name:"build_autocomplete_index",arguments:{}}}),signal:AbortSignal.timeout(1e4)});if(t.ok){const n=await t.json();if(console.log(`MCP build index response (attempt ${e+1}):`,n),n.result&&!n.result.is_error)return this.autocompleteIndexBuilt=!0,this.connectionRetries=0,console.log("MCP autocomplete index built successfully"),!0}else if(t.status>=500&&e<this.maxRetries){console.warn(`MCP server error ${t.status}, retrying in ${this.retryDelay}ms...`),await new Promise(n=>setTimeout(n,this.retryDelay*(e+1)));continue}console.warn(`MCP build index failed (attempt ${e+1}):`,t.status,t.statusText)}catch(t){t instanceof Error&&t.name==="AbortError"?console.warn(`MCP request timeout (attempt ${e+1})`):console.warn(`MCP connection error (attempt ${e+1}):`,t),e<this.maxRetries&&await new Promise(n=>setTimeout(n,this.retryDelay*(e+1)))}return console.error("Failed to build MCP autocomplete index after all retries"),!1}async getCompletion(e){if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return{text:""};try{const t=this.extractLastWord(e.prompt);if(!t||t.length<1)return{text:""};const n=await this.getSuggestionsWithSnippets(t,5);if(n.length===0)return{text:""};let a=n[0].text;a.toLowerCase().startsWith(t.toLowerCase())&&(a=a.substring(t.length));const r=e.prompt.length/4,u=a.length/4;return{text:a,usage:{promptTokens:Math.round(r),completionTokens:Math.round(u),totalTokens:Math.round(r+u)}}}catch(t){return console.error("Error getting Novel autocomplete completion:",t),{text:""}}}async getSuggestions(e,t=10){if(!e||e.trim().length===0)return[];if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return console.warn("Autocomplete index not built, returning empty suggestions"),[];try{return Jt()?await this.getTauriSuggestions(e,t):await this.getMCPSuggestions(e,t,"autocomplete_terms")}catch(n){return console.error("Error getting autocomplete suggestions:",n),[]}}async getTauriSuggestions(e,t){const n=await je("get_autocomplete_suggestions",{query:e.trim(),role_name:this.currentRole,limit:t});return console.log("Tauri autocomplete response:",n),n&&n.status==="success"&&n.suggestions?n.suggestions.map(o=>({text:o.term||o.text||"",snippet:o.url||o.snippet||"",score:o.score||1})).filter(o=>o.text.length>0):(n&&n.error&&console.error("Tauri autocomplete error:",n.error),[])}async getMCPSuggestions(e,t,n){const o=Date.now(),a=await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:o,method:"tools/call",params:{name:n,arguments:{query:e.trim(),limit:t,role:this.currentRole}}}),signal:AbortSignal.timeout(5e3)});if(!a.ok)return console.error(`MCP ${n} request failed:`,a.status,a.statusText),[];const r=await a.json();return console.log(`MCP ${n} response:`,r),r.result&&!r.result.is_error&&r.result.content?n==="autocomplete_with_snippets"?this.parseAutocompleteWithSnippetsContent(r.result.content):this.parseAutocompleteContent(r.result.content):(r.error&&console.error(`MCP ${n} error:`,r.error),[])}async getSuggestionsWithSnippets(e,t=10){if(!e||e.trim().length===0)return[];if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return console.warn("Autocomplete index not built, returning empty suggestions with snippets"),[];try{return Jt()?await this.getTauriSuggestions(e,t):await this.getMCPSuggestions(e,t,"autocomplete_with_snippets")}catch(n){return console.error("Error getting autocomplete suggestions with snippets:",n),[]}}extractLastWord(e){const t=e.trim().split(/\s+/);return t[t.length-1]||""}parseAutocompleteContent(e){const t=[];for(const n of e)if(n.type==="text"&&n.text){if(!n.text.startsWith("Found")&&!n.text.startsWith("•"))t.push({text:n.text.trim()});else if(n.text.startsWith("•")){const o=n.text.replace("•","").trim();o&&t.push({text:o})}}return t}parseAutocompleteWithSnippetsContent(e){const t=[];for(const n of e)if(n.type==="text"&&n.text){if(!n.text.startsWith("Found")&&!n.text.startsWith("•")){const o=n.text.split(" — ");o.length===2?t.push({text:o[0].trim(),snippet:o[1].trim()}):t.push({text:n.text.trim()})}else if(n.text.startsWith("•")){const o=n.text.replace("•","").trim();o&&t.push({text:o})}}return t}isReady(){return this.autocompleteIndexBuilt}getStatus(){return{ready:this.autocompleteIndexBuilt,baseUrl:this.baseUrl,sessionId:this.sessionId,usingTauri:Jt(),currentRole:this.currentRole,connectionRetries:this.connectionRetries,isConnecting:this.isConnecting}}async refreshIndex(){return this.autocompleteIndexBuilt=!1,this.connectionRetries=0,await this.buildAutocompleteIndex()}async testConnection(){try{if(Jt()){const e=await je("get_autocomplete_suggestions",{query:"test",role_name:this.currentRole,limit:1});return e&&(e.status==="success"||e.status==="error")}else return(await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:Date.now(),method:"tools/list",params:{}}),signal:AbortSignal.timeout(3e3)})).ok}catch(e){return console.warn("Connection test failed:",e),!1}}}const It=new ai;function ci(l){var e;const{char:t,allowSpaces:n,allowToIncludeChar:o,allowedPrefixes:a,startOfLine:r,$position:u}=l,i=n&&!o,d=kr(t),p=new RegExp(`\\s${d}$`),m=r?"^":"",_=o?"":d,h=i?new RegExp(`${m}${d}.*?(?=\\s${_}|$)`,"gm"):new RegExp(`${m}(?:^)?${d}[^\\s${_}]*`,"gm"),w=((e=u.nodeBefore)===null||e===void 0?void 0:e.isText)&&u.nodeBefore.text;if(!w)return null;const b=u.pos-w.length,k=Array.from(w.matchAll(h)).pop();if(!k||k.input===void 0||k.index===void 0)return null;const $=k.input.slice(Math.max(0,k.index-1),k.index),y=new RegExp(`^[${a==null?void 0:a.join("")}\0]?$`).test($);if(a!==null&&!y)return null;const v=b+k.index;let C=v+k[0].length;return i&&p.test(w.slice(C-1,C+1))&&(k[0]+=" ",C+=1),v<u.pos&&C>=u.pos?{range:{from:v,to:C},query:k[0].slice(t.length),text:k[0]}:null}const ui=new Ws("suggestion");function fi({pluginKey:l=ui,editor:e,char:t="@",allowSpaces:n=!1,allowToIncludeChar:o=!1,allowedPrefixes:a=[" "],startOfLine:r=!1,decorationTag:u="span",decorationClass:i="suggestion",decorationContent:d="",decorationEmptyClass:p="is-empty",command:m=()=>null,items:_=()=>[],render:h=()=>({}),allow:w=()=>!0,findSuggestionMatch:b=ci}){let k;const $=h==null?void 0:h(),y=new gr({key:l,view(){return{update:async(v,C)=>{var q,I,N,R,F,le,V;const L=(q=this.key)===null||q===void 0?void 0:q.getState(C),A=(I=this.key)===null||I===void 0?void 0:I.getState(v.state),ee=L.active&&A.active&&L.range.from!==A.range.from,K=!L.active&&A.active,X=L.active&&!A.active,x=!K&&!X&&L.query!==A.query,z=K||ee&&x,Z=x||ee,O=X||ee&&x;if(!z&&!Z&&!O)return;const H=O&&!z?L:A,E=v.dom.querySelector(`[data-decoration-id="${H.decorationId}"]`);k={editor:e,range:H.range,query:H.query,text:H.text,items:[],command:M=>m({editor:e,range:H.range,props:M}),decorationNode:E,clientRect:E?()=>{var M;const{decorationId:B}=(M=this.key)===null||M===void 0?void 0:M.getState(e.state),oe=v.dom.querySelector(`[data-decoration-id="${B}"]`);return(oe==null?void 0:oe.getBoundingClientRect())||null}:null},z&&((N=$==null?void 0:$.onBeforeStart)===null||N===void 0||N.call($,k)),Z&&((R=$==null?void 0:$.onBeforeUpdate)===null||R===void 0||R.call($,k)),(Z||z)&&(k.items=await _({editor:e,query:H.query})),O&&((F=$==null?void 0:$.onExit)===null||F===void 0||F.call($,k)),Z&&((le=$==null?void 0:$.onUpdate)===null||le===void 0||le.call($,k)),z&&((V=$==null?void 0:$.onStart)===null||V===void 0||V.call($,k))},destroy:()=>{var v;k&&((v=$==null?void 0:$.onExit)===null||v===void 0||v.call($,k))}}},state:{init(){return{active:!1,range:{from:0,to:0},query:null,text:null,composing:!1}},apply(v,C,q,I){const{isEditable:N}=e,{composing:R}=e.view,{selection:F}=v,{empty:le,from:V}=F,L={...C};if(L.composing=R,N&&(le||e.view.composing)){(V<C.range.from||V>C.range.to)&&!R&&!C.composing&&(L.active=!1);const A=b({char:t,allowSpaces:n,allowToIncludeChar:o,allowedPrefixes:a,startOfLine:r,$position:F.$from}),ee=`id_${Math.floor(Math.random()*4294967295)}`;A&&w({editor:e,state:I,range:A.range,isActive:C.active})?(L.active=!0,L.decorationId=C.decorationId?C.decorationId:ee,L.range=A.range,L.query=A.query,L.text=A.text):L.active=!1}else L.active=!1;return L.active||(L.decorationId=null,L.range={from:0,to:0},L.query=null,L.text=null),L}},props:{handleKeyDown(v,C){var q;const{active:I,range:N}=y.getState(v.state);return I&&((q=$==null?void 0:$.onKeyDown)===null||q===void 0?void 0:q.call($,{view:v,event:C,range:N}))||!1},decorations(v){const{active:C,range:q,decorationId:I,query:N}=y.getState(v);if(!C)return null;const R=!(N!=null&&N.length),F=[i];return R&&F.push(p),vr.create(v.doc,[br.inline(q.from,q.to,{nodeName:u,class:F.join(" "),"data-decoration-id":I,"data-decoration-content":d})])}}});return y}const Rn=wr.create({name:"terraphimSuggestion",addOptions(){return{trigger:"++",pluginKey:new Ws("terraphimSuggestion"),allowSpaces:!1,limit:8,minLength:1,debounce:300}},addCommands(){return{insertSuggestion:l=>({commands:e,chain:t})=>t().insertContent(l.text).run()}},addProseMirrorPlugins(){const l={editor:this.editor,char:this.options.trigger,pluginKey:this.options.pluginKey,allowSpaces:this.options.allowSpaces,startOfLine:!1,command:({editor:e,range:t,props:n})=>{const o=n;e.chain().focus().insertContentAt(t,o.text+" ").run()},items:async({query:e,editor:t})=>new Promise(n=>{setTimeout(async()=>{if(e.length<this.options.minLength){n([]);return}try{const o=await It.getSuggestionsWithSnippets(e,this.options.limit);console.log(`TerraphimSuggestion: Found ${o.length} suggestions for "${e}"`),n(o)}catch(o){console.error("TerraphimSuggestion: Error getting suggestions:",o),n([])}},this.options.debounce)}),render:()=>{let e,t;return{onStart:n=>{e=new di({items:n.items,command:n.command}),n.clientRect&&(t=Sr("body",{getReferenceClientRect:n.clientRect,appendTo:()=>document.body,content:e.element,showOnCreate:!0,interactive:!0,trigger:"manual",placement:"bottom-start",theme:"terraphim-suggestion",maxWidth:"none"})[0])},onUpdate(n){e==null||e.updateItems(n.items),n.clientRect&&(t==null||t.setProps({getReferenceClientRect:n.clientRect}))},onKeyDown(n){return n.event.key==="Escape"?(t==null||t.hide(),!0):(e==null?void 0:e.onKeyDown(n))??!1},onExit(){t==null||t.destroy(),e==null||e.destroy()}}}};return[fi(l)]}});class di{constructor(e){Ct(this,"element");Ct(this,"items",[]);Ct(this,"selectedIndex",0);Ct(this,"command");this.items=e.items,this.command=e.command,this.element=document.createElement("div"),this.element.className="terraphim-suggestion-dropdown",this.render()}updateItems(e){this.items=e,this.selectedIndex=0,this.render()}onKeyDown({event:e}){return e.key==="ArrowUp"?(this.selectPrevious(),!0):e.key==="ArrowDown"?(this.selectNext(),!0):e.key==="Enter"||e.key==="Tab"?(this.selectItem(this.selectedIndex),!0):!1}selectPrevious(){this.selectedIndex=Math.max(0,this.selectedIndex-1),this.render()}selectNext(){this.selectedIndex=Math.min(this.items.length-1,this.selectedIndex+1),this.render()}selectItem(e){const t=this.items[e];t&&this.command({id:t.text,...t})}render(){if(this.element.innerHTML="",this.items.length===0){this.element.innerHTML=`
        <div class="terraphim-suggestion-item terraphim-suggestion-empty">
          <div class="terraphim-suggestion-text">No suggestions found</div>
          <div class="terraphim-suggestion-hint">Try a different search term</div>
        </div>
      `;return}const e=document.createElement("div");e.className="terraphim-suggestion-header",e.innerHTML=`
      <div class="terraphim-suggestion-count">${this.items.length} suggestions</div>
      <div class="terraphim-suggestion-hint">↑↓ Navigate • Tab/Enter Select • Esc Cancel</div>
    `,this.element.appendChild(e),this.items.forEach((t,n)=>{const o=document.createElement("div");o.className=`terraphim-suggestion-item ${n===this.selectedIndex?"terraphim-suggestion-selected":""}`,o.innerHTML=`
        <div class="terraphim-suggestion-main">
          <div class="terraphim-suggestion-text">${this.escapeHtml(t.text)}</div>
          ${t.snippet?`<div class="terraphim-suggestion-snippet">${this.escapeHtml(t.snippet)}</div>`:""}
        </div>
        ${t.score?`<div class="terraphim-suggestion-score">${Math.round(t.score*100)}%</div>`:""}
      `,o.addEventListener("click",()=>this.selectItem(n)),o.addEventListener("mouseenter",()=>{this.selectedIndex=n,this.render()}),this.element.appendChild(o)})}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}destroy(){this.element.remove()}}const pi=`
.terraphim-suggestion-dropdown {
  background: white;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  box-shadow: 0 10px 38px -10px rgba(22, 23, 24, 0.35), 0 10px 20px -15px rgba(22, 23, 24, 0.2);
  max-height: 300px;
  min-width: 300px;
  overflow-y: auto;
  z-index: 1000;
}

.terraphim-suggestion-header {
  padding: 8px 12px;
  border-bottom: 1px solid #f1f5f9;
  background: #f8fafc;
  font-size: 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.terraphim-suggestion-count {
  font-weight: 600;
  color: #475569;
}

.terraphim-suggestion-hint {
  color: #64748b;
}

.terraphim-suggestion-item {
  padding: 8px 12px;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  border-bottom: 1px solid #f1f5f9;
}

.terraphim-suggestion-item:hover {
  background: #f8fafc;
}

.terraphim-suggestion-selected {
  background: #eff6ff !important;
  border-left: 3px solid #3b82f6;
}

.terraphim-suggestion-empty {
  color: #64748b;
  font-style: italic;
  text-align: center;
  cursor: default;
}

.terraphim-suggestion-main {
  flex: 1;
}

.terraphim-suggestion-text {
  font-weight: 500;
  color: #1e293b;
  margin-bottom: 2px;
}

.terraphim-suggestion-snippet {
  font-size: 12px;
  color: #64748b;
  line-height: 1.3;
}

.terraphim-suggestion-score {
  font-size: 11px;
  color: #10b981;
  font-weight: 600;
  background: #ecfdf5;
  padding: 2px 6px;
  border-radius: 4px;
  margin-left: 8px;
}

/* Dark theme support */
@media (prefers-color-scheme: dark) {
  .terraphim-suggestion-dropdown {
    background: #1e293b;
    border-color: #334155;
  }

  .terraphim-suggestion-header {
    background: #0f172a;
    border-color: #334155;
  }

  .terraphim-suggestion-item:hover {
    background: #334155;
  }

  .terraphim-suggestion-selected {
    background: #1e40af !important;
  }

  .terraphim-suggestion-text {
    color: #f1f5f9;
  }

  .terraphim-suggestion-snippet {
    color: #94a3b8;
  }
}

/* Tippy.js theme */
.tippy-box[data-theme~='terraphim-suggestion'] {
  background: transparent;
  box-shadow: none;
}

.tippy-box[data-theme~='terraphim-suggestion'] > .tippy-backdrop {
  background: transparent;
}

.tippy-box[data-theme~='terraphim-suggestion'] > .tippy-arrow {
  display: none;
}
`;function An(l){let e,t,n,o,a,r,u,i,d,p,m,_,h,w,b,k,$,y,v,C,q,I,N,R,F,le,V=l[12]?"Tauri (native)":`MCP Server (${It.getStatus().baseUrl})`,L,A,ee,K,X,x,z,Z,O,H,E,M,B,oe,D,j,W,ae,ce,se,ie=l[6]!==1?"s":"",me,G,te,ue,_e,ke,Te,Xe,Be,Ne,Pe,de,Se,Me,xe,et,ye,ze,qe=l[3]?"Enabled":"Disabled",Ge,Le,De,it,Ie=l[11]&&!l[8]&&En(l);function We(Q,fe){if(Q[8])return gi;if(Q[11])return hi}let J=We(l),ne=J&&J(l);return{c(){e=f("div"),t=f("div"),n=f("strong"),n.textContent="Local Autocomplete Status:",o=g(),a=f("div"),r=f("button"),u=P("Test"),d=g(),p=f("button"),p.textContent="Rebuild Index",m=g(),_=f("button"),h=P("Demo"),b=g(),k=f("div"),$=P(l[10]),y=g(),Ie&&Ie.c(),v=g(),C=f("div"),q=f("strong"),q.textContent="Configuration:",I=g(),N=f("br"),R=P("• "),F=f("strong"),F.textContent="Backend:",le=g(),L=P(V),A=g(),ee=f("br"),K=P("• "),X=f("strong"),X.textContent="Role:",x=g(),z=P(l[9]),Z=g(),O=f("br"),H=P("• "),E=f("strong"),E.textContent="Trigger:",M=P(' "'),B=P(l[4]),oe=P(`" + text
      `),D=f("br"),j=P("• "),W=f("strong"),W.textContent="Min Length:",ae=g(),ce=P(l[6]),se=P(" character"),me=P(ie),G=g(),te=f("br"),ue=P("• "),_e=f("strong"),_e.textContent="Max Results:",ke=g(),Te=P(l[5]),Xe=g(),Be=f("br"),Ne=P("• "),Pe=f("strong"),Pe.textContent="Debounce:",de=g(),Se=P(l[7]),Me=P(`ms
      `),xe=f("br"),et=P("• "),ye=f("strong"),ye.textContent="Snippets:",ze=g(),Ge=P(qe),Le=g(),ne&&ne.c(),we(n,"color","#495057"),we(r,"padding","4px 8px"),we(r,"background","#007bff"),we(r,"color","white"),we(r,"border","none"),we(r,"border-radius","4px"),we(r,"cursor","pointer"),we(r,"font-size","12px"),r.disabled=i=!l[8],we(p,"padding","4px 8px"),we(p,"background","#28a745"),we(p,"color","white"),we(p,"border","none"),we(p,"border-radius","4px"),we(p,"cursor","pointer"),we(p,"font-size","12px"),we(_,"padding","4px 8px"),we(_,"background","#ffc107"),we(_,"color","#212529"),we(_,"border","none"),we(_,"border-radius","4px"),we(_,"cursor","pointer"),we(_,"font-size","12px"),_.disabled=w=!l[8],we(a,"display","flex"),we(a,"gap","8px"),we(t,"display","flex"),we(t,"justify-content","space-between"),we(t,"align-items","center"),we(t,"margin-bottom","8px"),we(k,"font-size","13px"),we(k,"color","#6c757d"),we(k,"margin-bottom","8px"),we(k,"font-family","monospace"),we(C,"font-size","12px"),we(C,"color","#6c757d"),we(e,"margin-top","10px"),we(e,"padding","12px"),we(e,"background","#f8f9fa"),we(e,"border-radius","6px"),we(e,"border","1px solid #e9ecef")},m(Q,fe){S(Q,e,fe),s(e,t),s(t,n),s(t,o),s(t,a),s(a,r),s(r,u),s(a,d),s(a,p),s(a,m),s(a,_),s(_,h),s(e,b),s(e,k),s(k,$),s(e,y),Ie&&Ie.m(e,null),s(e,v),s(e,C),s(C,q),s(C,I),s(C,N),s(C,R),s(C,F),s(C,le),s(C,L),s(C,A),s(C,ee),s(C,K),s(C,X),s(C,x),s(C,z),s(C,Z),s(C,O),s(C,H),s(C,E),s(C,M),s(C,B),s(C,oe),s(C,D),s(C,j),s(C,W),s(C,ae),s(C,ce),s(C,se),s(C,me),s(C,G),s(C,te),s(C,ue),s(C,_e),s(C,ke),s(C,Te),s(C,Xe),s(C,Be),s(C,Ne),s(C,Pe),s(C,de),s(C,Se),s(C,Me),s(C,xe),s(C,et),s(C,ye),s(C,ze),s(C,Ge),s(e,Le),ne&&ne.m(e,null),De||(it=[re(r,"click",l[14]),re(p,"click",l[15]),re(_,"click",l[16])],De=!0)},p(Q,fe){fe&256&&i!==(i=!Q[8])&&(r.disabled=i),fe&256&&w!==(w=!Q[8])&&(_.disabled=w),fe&1024&&be($,Q[10]),Q[11]&&!Q[8]?Ie?Ie.p(Q,fe):(Ie=En(Q),Ie.c(),Ie.m(e,v)):Ie&&(Ie.d(1),Ie=null),fe&4096&&V!==(V=Q[12]?"Tauri (native)":`MCP Server (${It.getStatus().baseUrl})`)&&be(L,V),fe&512&&be(z,Q[9]),fe&16&&be(B,Q[4]),fe&64&&be(ce,Q[6]),fe&64&&ie!==(ie=Q[6]!==1?"s":"")&&be(me,ie),fe&32&&be(Te,Q[5]),fe&128&&be(Se,Q[7]),fe&8&&qe!==(qe=Q[3]?"Enabled":"Disabled")&&be(Ge,qe),J===(J=We(Q))&&ne?ne.p(Q,fe):(ne&&ne.d(1),ne=J&&J(Q),ne&&(ne.c(),ne.m(e,null)))},d(Q){Q&&T(e),Ie&&Ie.d(),ne&&ne.d(),De=!1,Ve(it)}}}function En(l){let e,t,n,o;function a(i,d){return i[12]?_i:mi}let r=a(l),u=r(l);return{c(){e=f("div"),t=f("strong"),t.textContent="⚠️ Autocomplete Not Available",n=f("br"),o=g(),u.c(),we(e,"font-size","12px"),we(e,"color","#dc3545"),we(e,"margin-bottom","8px"),we(e,"padding","6px"),we(e,"background","#f8d7da"),we(e,"border-radius","4px")},m(i,d){S(i,e,d),s(e,t),s(e,n),s(e,o),u.m(e,null)},p(i,d){r===(r=a(i))&&u?u.p(i,d):(u.d(1),u=r(i),u&&(u.c(),u.m(e,null)))},d(i){i&&T(e),u.d()}}}function mi(l){let e,t=It.getStatus().baseUrl+"",n;return{c(){e=P("MCP server not responding. Ensure the server is running on "),n=P(t)},m(o,a){S(o,e,a),S(o,n,a)},p:Re,d(o){o&&T(e),o&&T(n)}}}function _i(l){let e;return{c(){e=P("Tauri backend connection failed. Ensure the application has proper permissions.")},m(t,n){S(t,e,n)},p:Re,d(t){t&&T(e)}}}function hi(l){let e;return{c(){e=f("div"),e.innerHTML=`<strong>❌ Autocomplete Unavailable</strong> 
        <div style="font-size: 11px; margin-top: 4px; color: #721c24;">Click &quot;Rebuild Index&quot; to retry or check server/backend status.</div>`,we(e,"margin-top","8px"),we(e,"padding","8px"),we(e,"background","#f8d7da"),we(e,"border","1px solid #f5c6cb"),we(e,"border-radius","4px")},m(t,n){S(t,e,n)},p:Re,d(t){t&&T(e)}}}function gi(l){let e,t,n,o,a,r,u,i,d,p,m,_,h,w,b,k,$;return{c(){e=f("div"),t=f("strong"),t.textContent="🎯 Autocomplete Active",n=g(),o=f("div"),a=P("Type "),r=f("code"),u=P(l[4]),i=P(" in the editor above to trigger suggestions."),d=f("br"),p=P(`
          Example: `),m=f("code"),_=P(l[4]),h=P("terraphim"),w=P(" or "),b=f("code"),k=P(l[4]),$=P("graph"),we(o,"font-size","11px"),we(o,"margin-top","4px"),we(o,"color","#0056b3"),we(e,"margin-top","8px"),we(e,"padding","8px"),we(e,"background","#d1edff"),we(e,"border","1px solid #b3d9ff"),we(e,"border-radius","4px")},m(y,v){S(y,e,v),s(e,t),s(e,n),s(e,o),s(o,a),s(o,r),s(r,u),s(o,i),s(o,d),s(o,p),s(o,m),s(m,_),s(m,h),s(o,w),s(o,b),s(b,k),s(b,$)},p(y,v){v&16&&be(u,y[4]),v&16&&be(_,y[4]),v&16&&be(k,y[4])},d(y){y&&T(e)}}}function vi(l){let e,t,n,o;e=new Rr({props:{defaultValue:l[0],isEditable:!l[1],disableLocalStorage:!0,onUpdate:l[13],extensions:[wn,...l[2]?[Rn.configure({trigger:l[4],allowSpaces:!1,limit:l[5],minLength:l[6],debounce:l[7]})]:[]]}});let a=l[2]&&An(l);return{c(){he(e.$$.fragment),t=g(),a&&a.c(),n=ut()},m(r,u){ge(e,r,u),S(r,t,u),a&&a.m(r,u),S(r,n,u),o=!0},p(r,[u]){const i={};u&1&&(i.defaultValue=r[0]),u&2&&(i.isEditable=!r[1]),u&244&&(i.extensions=[wn,...r[2]?[Rn.configure({trigger:r[4],allowSpaces:!1,limit:r[5],minLength:r[6],debounce:r[7]})]:[]]),e.$set(i),r[2]?a?a.p(r,u):(a=An(r),a.c(),a.m(n.parentNode,n)):a&&(a.d(1),a=null)},i(r){o||(U(e.$$.fragment,r),o=!0)},o(r){Y(e.$$.fragment,r),o=!1},d(r){ve(e,r),r&&T(t),a&&a.d(r),r&&T(n)}}}function bi(l,e,t){let n,o;Ue(l,At,R=>t(9,n=R)),Ue(l,ct,R=>t(12,o=R));let{html:a=""}=e,{readOnly:r=!1}=e,{outputFormat:u="html"}=e,{enableAutocomplete:i=!0}=e,{showSnippets:d=!0}=e,{suggestionTrigger:p="++"}=e,{maxSuggestions:m=8}=e,{minQueryLength:_=1}=e,{debounceDelay:h=300}=e,w=null,b="⏳ Initializing...",k=!1,$=!1,y=null;tl(async()=>{i&&await v(),typeof document<"u"&&(y=document.createElement("style"),y.textContent=pi,document.head.appendChild(y))}),Ks(()=>{y&&y.parentNode&&y.parentNode.removeChild(y)});async function v(){t(10,b="⏳ Initializing autocomplete..."),t(8,k=!1),t(11,$=!1);try{It.setRole(n),t(10,b="🔗 Testing connection...");const R=await It.testConnection();t(11,$=!0),R?(t(10,b="🔨 Building autocomplete index..."),await It.buildAutocompleteIndex()?(o?t(10,b="✅ Ready - Using Tauri backend"):t(10,b="✅ Ready - Using MCP server backend"),t(8,k=!0)):t(10,b="❌ Failed to build autocomplete index")):o?t(10,b="❌ Tauri backend not available"):t(10,b="❌ MCP server not responding")}catch(R){console.error("Error initializing autocomplete:",R),t(10,b="❌ Autocomplete initialization error")}}const C=R=>{w=R,u==="markdown"?t(0,a=R.storage.markdown.getMarkdown()):t(0,a=R.getHTML())},q=async()=>{if(!$){alert("Please wait for connection test to complete");return}if(!k){alert("Autocomplete service not ready. Check the status above.");return}try{t(10,b="🧪 Testing autocomplete...");const R="terraphim",F=await It.getSuggestions(R,5);if(console.log("Autocomplete test results:",F),F.length>0){const le=F.map((V,L)=>`${L+1}. ${V.text}${V.snippet?` (${V.snippet})`:""}`).join(`
`);alert(`✅ Found ${F.length} suggestions for '${R}':

${le}`),o?t(10,b="✅ Ready - Using Tauri backend"):t(10,b="✅ Ready - Using MCP server backend")}else alert(`⚠️ No suggestions found for '${R}'. This might be normal if the term isn't in your knowledge graph.`)}catch(R){console.error("Autocomplete test failed:",R),alert(`❌ Autocomplete test failed: ${R.message}`),t(10,b="❌ Test failed - check console for details")}},I=async()=>{t(10,b="⏳ Rebuilding index..."),t(8,k=!1);try{await It.refreshIndex()?(o?t(10,b="✅ Ready - Tauri index rebuilt successfully"):t(10,b="✅ Ready - MCP server index rebuilt successfully"),t(8,k=!0)):t(10,b="❌ Failed to rebuild index")}catch(R){console.error("Error rebuilding index:",R),t(10,b="❌ Index rebuild failed - check console for details")}},N=()=>{if(!w){alert("Editor not ready yet");return}const R=`# Terraphim Autocomplete Demo

This is a demonstration of the integrated Terraphim autocomplete system.

## How to Use:
1. Type "${p}" to trigger autocomplete
2. Start typing any term (e.g., "${p}terraphim", "${p}graph")
3. Use ↑↓ arrows to navigate suggestions
4. Press Tab or Enter to select
5. Press Esc to cancel

## Try these queries:
- ${p}terraphim
- ${p}graph
- ${p}service
- ${p}automata
- ${p}role

The autocomplete system uses your local knowledge graph to provide intelligent suggestions based on your selected role: **${n}**.

---

Start typing below:`;w.commands.setContent(R),setTimeout(()=>{w.commands.focus("end")},100),alert(`Demo content inserted!

Type "${p}" followed by any term to see autocomplete suggestions.

Example: "${p}terraphim"`)};return l.$$set=R=>{"html"in R&&t(0,a=R.html),"readOnly"in R&&t(1,r=R.readOnly),"outputFormat"in R&&t(17,u=R.outputFormat),"enableAutocomplete"in R&&t(2,i=R.enableAutocomplete),"showSnippets"in R&&t(3,d=R.showSnippets),"suggestionTrigger"in R&&t(4,p=R.suggestionTrigger),"maxSuggestions"in R&&t(5,m=R.maxSuggestions),"minQueryLength"in R&&t(6,_=R.minQueryLength),"debounceDelay"in R&&t(7,h=R.debounceDelay)},l.$$.update=()=>{l.$$.dirty&772&&n&&i&&k&&(It.setRole(n),v())},[a,r,i,d,p,m,_,h,k,n,b,$,o,C,q,I,N,u]}class ki extends _t{constructor(e){super(),ht(this,e,bi,vi,pt,{html:0,readOnly:1,outputFormat:17,enableAutocomplete:2,showSnippets:3,suggestionTrigger:4,maxSuggestions:5,minQueryLength:6,debounceDelay:7})}}function Ln(l){let e,t,n,o,a,r,u,i,d,p,m;return{c(){e=f("div"),t=f("h3"),n=f("span"),n.textContent="Knowledge Graph",o=P(`
          Term: `),a=f("strong"),r=P(l[2]),u=P(" | Rank: "),i=f("strong"),d=P(l[3]),p=g(),m=f("hr"),c(n,"class","tag is-info svelte-329px1"),c(t,"class","subtitle is-6 svelte-329px1"),c(m,"class","svelte-329px1"),c(e,"class","kg-context svelte-329px1")},m(_,h){S(_,e,h),s(e,t),s(t,n),s(t,o),s(t,a),s(a,r),s(t,u),s(t,i),s(i,d),s(e,p),s(e,m)},p(_,h){h&4&&be(r,_[2]),h&8&&be(d,_[3])},d(_){_&&T(e)}}}function wi(l){let e,t,n,o,a,r,u,i;const d=[Ci,$i],p=[];function m(_,h){return _[5]?0:1}return t=m(l),n=p[t]=d[t](l),{c(){e=f("div"),n.c(),o=g(),a=f("div"),a.innerHTML='<span class="hint-text svelte-329px1">Double-click to edit • Ctrl+E to edit • Ctrl+S to save • Click KG links to explore</span>',c(a,"class","edit-hint svelte-329px1"),c(e,"class","content-viewer svelte-329px1"),c(e,"tabindex","0"),c(e,"role","button"),c(e,"aria-label","Double-click to edit article content")},m(_,h){S(_,e,h),p[t].m(e,null),s(e,o),s(e,a),l[20](e),r=!0,u||(i=[re(e,"dblclick",l[14]),re(e,"keydown",l[15]),re(e,"click",l[13])],u=!0)},p(_,h){let w=t;t=m(_),t===w?p[t].p(_,h):(Fe(),Y(p[w],1,1,()=>{p[w]=null}),Ke(),n=p[t],n?n.p(_,h):(n=p[t]=d[t](_),n.c()),U(n,1),n.m(e,o))},i(_){r||(U(n),r=!0)},o(_){Y(n),r=!1},d(_){_&&T(e),p[t].d(),l[20](null),u=!1,Ve(i)}}}function yi(l){let e,t,n,o,a,r,u,i,d,p;function m(h){l[18](h)}let _={outputFormat:l[11]};return l[1].body!==void 0&&(_.html=l[1].body),e=new ki({props:_}),lt.push(()=>st(e,"html",m)),{c(){he(e.$$.fragment),n=g(),o=f("div"),a=f("button"),a.textContent="Save",r=g(),u=f("button"),u.textContent="Cancel",c(a,"class","button is-primary"),c(u,"class","button is-light"),c(o,"class","edit-controls svelte-329px1")},m(h,w){ge(e,h,w),S(h,n,w),S(h,o,w),s(o,a),s(o,r),s(o,u),i=!0,d||(p=[re(a,"click",l[12]),re(u,"click",l[19])],d=!0)},p(h,w){const b={};w&2048&&(b.outputFormat=h[11]),!t&&w&2&&(t=!0,b.html=h[1].body,rt(()=>t=!1)),e.$set(b)},i(h){i||(U(e.$$.fragment,h),i=!0)},o(h){Y(e.$$.fragment,h),i=!1},d(h){ve(e,h),h&&T(n),h&&T(o),d=!1,Ve(p)}}}function $i(l){let e,t,n;return t=new Ul({props:{source:l[1].body}}),{c(){e=f("div"),he(t.$$.fragment),c(e,"class","markdown-content svelte-329px1")},m(o,a){S(o,e,a),ge(t,e,null),n=!0},p(o,a){const r={};a&2&&(r.source=o[1].body),t.$set(r)},i(o){n||(U(t.$$.fragment,o),n=!0)},o(o){Y(t.$$.fragment,o),n=!1},d(o){o&&T(e),ve(t)}}}function Ci(l){let e,t=l[1].body+"";return{c(){e=f("div"),c(e,"class","prose svelte-329px1")},m(n,o){S(n,e,o),e.innerHTML=t},p(n,o){o&2&&t!==(t=n[1].body+"")&&(e.innerHTML=t)},i:Re,o:Re,d(n){n&&T(e)}}}function Ti(l){let e,t,n,o,a,r=l[1].title+"",u,i,d,p,m,_,h,w=l[2]&&l[3]!==null&&Ln(l);const b=[yi,wi],k=[];function $(y,v){return y[4]?0:1}return d=$(l),p=k[d]=b[d](l),{c(){e=f("div"),t=f("button"),n=g(),w&&w.c(),o=g(),a=f("h2"),u=P(r),i=g(),p.c(),c(t,"class","delete is-large modal-close-btn svelte-329px1"),c(t,"aria-label","close"),c(a,"class","svelte-329px1"),c(e,"class","box wrapper svelte-329px1")},m(y,v){S(y,e,v),s(e,t),s(e,n),w&&w.m(e,null),s(e,o),s(e,a),s(a,u),s(e,i),k[d].m(e,null),m=!0,_||(h=re(t,"click",l[17]),_=!0)},p(y,v){y[2]&&y[3]!==null?w?w.p(y,v):(w=Ln(y),w.c(),w.m(e,o)):w&&(w.d(1),w=null),(!m||v&2)&&r!==(r=y[1].title+"")&&be(u,r);let C=d;d=$(y),d===C?k[d].p(y,v):(Fe(),Y(k[C],1,1,()=>{k[C]=null}),Ke(),p=k[d],p?p.p(y,v):(p=k[d]=b[d](y),p.c()),U(p,1),p.m(e,null))},i(y){m||(U(p),m=!0)},o(y){Y(p),m=!1},d(y){y&&T(e),w&&w.d(),k[d].d(),_=!1,h()}}}function Dn(l){let e,t,n;function o(r){l[23](r)}let a={$$slots:{default:[Ai]},$$scope:{ctx:l}};return l[7]!==void 0&&(a.active=l[7]),e=new wl({props:a}),lt.push(()=>st(e,"active",o)),{c(){he(e.$$.fragment)},m(r,u){ge(e,r,u),n=!0},p(r,u){const i={};u&536872832&&(i.$$scope={dirty:u,ctx:r}),!t&&u&128&&(t=!0,i.active=r[7],rt(()=>t=!1)),e.$set(i)},i(r){n||(U(e.$$.fragment,r),n=!0)},o(r){Y(e.$$.fragment,r),n=!1},d(r){ve(e,r)}}}function On(l){let e,t,n,o,a,r,u,i,d,p,m;return{c(){e=f("div"),t=f("h3"),n=f("span"),n.textContent="Knowledge Graph",o=P(`
            Term: `),a=f("strong"),r=P(l[9]),u=P(" | Rank: "),i=f("strong"),d=P(l[10]),p=g(),m=f("hr"),c(n,"class","tag is-info svelte-329px1"),c(t,"class","subtitle is-6 svelte-329px1"),c(m,"class","svelte-329px1"),c(e,"class","kg-context svelte-329px1")},m(_,h){S(_,e,h),s(e,t),s(t,n),s(t,o),s(t,a),s(a,r),s(t,u),s(t,i),s(i,d),s(e,p),s(e,m)},p(_,h){h&512&&be(r,_[9]),h&1024&&be(d,_[10])},d(_){_&&T(e)}}}function Si(l){let e,t,n;return t=new Ul({props:{source:l[8].body}}),{c(){e=f("div"),he(t.$$.fragment),c(e,"class","markdown-content svelte-329px1")},m(o,a){S(o,e,a),ge(t,e,null),n=!0},p(o,a){const r={};a&256&&(r.source=o[8].body),t.$set(r)},i(o){n||(U(t.$$.fragment,o),n=!0)},o(o){Y(t.$$.fragment,o),n=!1},d(o){o&&T(e),ve(t)}}}function Ri(l){let e,t=l[8].body+"";return{c(){e=f("div"),c(e,"class","prose svelte-329px1")},m(n,o){S(n,e,o),e.innerHTML=t},p(n,o){o&256&&t!==(t=n[8].body+"")&&(e.innerHTML=t)},i:Re,o:Re,d(n){n&&T(e)}}}function Ai(l){let e,t,n,o,a,r=l[8].title+"",u,i,d,p,m,_,h,w,b,k,$,y=l[9]&&l[10]!==null&&On(l);const v=[Ri,Si],C=[];function q(I,N){return N&256&&(p=null),p==null&&(p=!!(I[8].body&&(/<html/i.test(I[8].body)||/<body/i.test(I[8].body)||/<head/i.test(I[8].body)))),p?0:1}return m=q(l,-1),_=C[m]=v[m](l),{c(){e=f("div"),t=f("button"),n=g(),y&&y.c(),o=g(),a=f("h2"),u=P(r),i=g(),d=f("div"),_.c(),h=g(),w=f("div"),w.innerHTML='<span class="hint-text svelte-329px1">Knowledge Graph document • Click KG links to explore further</span>',c(t,"class","delete is-large modal-close-btn svelte-329px1"),c(t,"aria-label","close"),c(a,"class","svelte-329px1"),c(w,"class","edit-hint svelte-329px1"),c(d,"class","content-viewer svelte-329px1"),c(d,"tabindex","0"),c(d,"role","button"),c(d,"aria-label","KG document content - click KG links to explore further"),c(e,"class","box wrapper svelte-329px1")},m(I,N){S(I,e,N),s(e,t),s(e,n),y&&y.m(e,null),s(e,o),s(e,a),s(a,u),s(e,i),s(e,d),C[m].m(d,null),s(d,h),s(d,w),b=!0,k||($=[re(t,"click",l[22]),re(d,"click",l[13])],k=!0)},p(I,N){I[9]&&I[10]!==null?y?y.p(I,N):(y=On(I),y.c(),y.m(e,o)):y&&(y.d(1),y=null),(!b||N&256)&&r!==(r=I[8].title+"")&&be(u,r);let R=m;m=q(I,N),m===R?C[m].p(I,N):(Fe(),Y(C[R],1,1,()=>{C[R]=null}),Ke(),_=C[m],_?_.p(I,N):(_=C[m]=v[m](I),_.c()),U(_,1),_.m(d,h))},i(I){b||(U(_),b=!0)},o(I){Y(_),b=!1},d(I){I&&T(e),y&&y.d(),C[m].d(),k=!1,Ve($)}}}function Ei(l){let e,t,n,o,a;function r(d){l[21](d)}let u={$$slots:{default:[Ti]},$$scope:{ctx:l}};l[0]!==void 0&&(u.active=l[0]),e=new wl({props:u}),lt.push(()=>st(e,"active",r));let i=l[8]&&Dn(l);return{c(){he(e.$$.fragment),n=g(),i&&i.c(),o=ut()},m(d,p){ge(e,d,p),S(d,n,p),i&&i.m(d,p),S(d,o,p),a=!0},p(d,[p]){const m={};p&536873087&&(m.$$scope={dirty:p,ctx:d}),!t&&p&1&&(t=!0,m.active=d[0],rt(()=>t=!1)),e.$set(m),d[8]?i?(i.p(d,p),p&256&&U(i,1)):(i=Dn(d),i.c(),U(i,1),i.m(o.parentNode,o)):i&&(Fe(),Y(i,1,1,()=>{i=null}),Ke())},i(d){a||(U(e.$$.fragment,d),U(i),a=!0)},o(d){Y(e.$$.fragment,d),Y(i),a=!1},d(d){ve(e,d),d&&T(n),i&&i.d(d),d&&T(o)}}}function Li(l,e,t){let n,o,a,r;Ue(l,ct,K=>t(25,a=K)),Ue(l,At,K=>t(26,r=K));let{active:u=!1}=e,{item:i}=e,{initialEdit:d=!1}=e,{kgTerm:p=null}=e,{kgRank:m=null}=e,_=!1,h,w=!1,b=null,k=null,$=null;async function y(){if(a)try{const K=await je("get_document",{documentId:i.id});K!=null&&K.document&&t(1,i=K.document)}catch(K){console.error("Failed to load document",K)}}async function v(){if(!a){t(4,_=!1);return}try{await je("create_document",{document:i}),t(4,_=!1)}catch(K){console.error("Failed to save document",K)}}async function C(K){var X,x,z,Z,O;t(9,k=K),console.log("🔍 KG Link Click Debug Info:"),console.log("  Term clicked:",K),console.log("  Current role:",r),console.log("  Is Tauri mode:",a);try{if(a){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:r,term:K});const H=await je("find_documents_for_kg_term",{roleName:r,term:K});console.log("  📥 Tauri response received:"),console.log("    Status:",H.status),console.log("    Results count:",((X=H.results)==null?void 0:X.length)||0),console.log("    Total:",H.total||0),console.log("    Full response:",JSON.stringify(H,null,2)),H.status==="success"&&H.results&&H.results.length>0?(t(8,b=H.results[0]),t(10,$=b.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",b.title),console.log("    Rank:",$),console.log("    Body length:",((x=b.body)==null?void 0:x.length)||0,"characters"),t(7,w=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${K}" in role: "${r}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const H=Qe.ServerURL,E=encodeURIComponent(r),M=encodeURIComponent(K),B=`${H}/roles/${E}/kg_search?term=${M}`;console.log("  📤 HTTP Request details:"),console.log("    Base URL:",H),console.log("    Role (encoded):",E),console.log("    Term (encoded):",M),console.log("    Full URL:",B);const oe=await fetch(B);if(console.log("  📥 HTTP Response received:"),console.log("    Status code:",oe.status),console.log("    Status text:",oe.statusText),console.log("    Headers:",Object.fromEntries(oe.headers.entries())),!oe.ok)throw new Error(`HTTP error! Status: ${oe.status} - ${oe.statusText}`);const D=await oe.json();console.log("  📄 Response data:"),console.log("    Status:",D.status),console.log("    Results count:",((z=D.results)==null?void 0:z.length)||0),console.log("    Total:",D.total||0),console.log("    Full response:",JSON.stringify(D,null,2)),D.status==="success"&&D.results&&D.results.length>0?(t(8,b=D.results[0]),t(10,$=b.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",b.title),console.log("    Rank:",$),console.log("    Body length:",((Z=b.body)==null?void 0:Z.length)||0,"characters"),t(7,w=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${K}" in role: "${r}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",B))}}catch(H){console.error("❌ Error fetching KG document:"),console.error("  Error type:",H.constructor.name),console.error("  Error message:",H.message||H),console.error("  Request details:",{term:K,role:r,isTauri:a,timestamp:new Date().toISOString()}),!a&&((O=H.message)!=null&&O.includes("Failed to fetch"))&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{}}function q(K){const X=K.target;if(X.tagName==="A"){const x=X.getAttribute("href");if(x&&x.startsWith("kg:")){K.preventDefault();const z=x.substring(3);C(z)}}}function I(){t(4,_=!0)}function N(K){K.type!=="dblclick"&&((K.ctrlKey||K.metaKey)&&K.key==="e"&&(K.preventDefault(),t(4,_=!0)),_&&(K.ctrlKey||K.metaKey)&&K.key==="s"&&(K.preventDefault(),v()),K.key==="Escape"&&(K.preventDefault(),_?t(4,_=!1):t(0,u=!1)))}const R=()=>t(0,u=!1);function F(K){l.$$.not_equal(i.body,K)&&(i.body=K,t(1,i))}const le=()=>t(4,_=!1);function V(K){lt[K?"unshift":"push"](()=>{h=K,t(6,h)})}function L(K){u=K,t(0,u)}const A=()=>t(7,w=!1);function ee(K){w=K,t(7,w)}return l.$$set=K=>{"active"in K&&t(0,u=K.active),"item"in K&&t(1,i=K.item),"initialEdit"in K&&t(16,d=K.initialEdit),"kgTerm"in K&&t(2,p=K.kgTerm),"kgRank"in K&&t(3,m=K.kgRank)},l.$$.update=()=>{l.$$.dirty&65537&&u&&d&&t(4,_=!0),l.$$.dirty&19&&u&&i&&!_&&y(),l.$$.dirty&2&&t(5,n=i!=null&&i.body?/<html/i.test(i.body)||/<body/i.test(i.body)||/<head/i.test(i.body)||/^\s*<(!DOCTYPE|html|head|body|div|p|span)/i.test(i.body.trim()):!1),l.$$.dirty&32&&t(11,o=n?"html":"markdown")},[u,i,p,m,_,n,h,w,b,k,$,o,v,q,I,N,d,R,F,le,V,L,A,ee]}class Vl extends _t{constructor(e){super(),ht(this,e,Li,Ei,pt,{active:0,item:1,initialEdit:16,kgTerm:2,kgRank:3})}}function Nn(l,e,t){const n=l.slice();return n[33]=e[t],n}function In(l,e,t){const n=l.slice();return n[36]=e[t],n}function Pn(l,e,t){const n=l.slice();return n[39]=e[t],n}function Mn(l){let e,t;return e=new Wl({props:{type:"is-success",$$slots:{default:[Di]},$$scope:{ctx:l}}}),{c(){he(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},i(n){t||(U(e.$$.fragment,n),t=!0)},o(n){Y(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function Di(l){let e,t,n;return{c(){e=f("p"),e.innerHTML="<strong>Success!</strong> Article saved to atomic server successfully.",t=g(),n=f("p"),n.textContent="The modal will close automatically..."},m(o,a){S(o,e,a),S(o,t,a),S(o,n,a)},p:Re,d(o){o&&T(e),o&&T(t),o&&T(n)}}}function jn(l){let e,t;return e=new Wl({props:{type:"is-danger",$$slots:{default:[Oi]},$$scope:{ctx:l}}}),{c(){he(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},p(n,o){const a={};o[0]&8|o[1]&2048&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(U(e.$$.fragment,n),t=!0)},o(n){Y(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function Oi(l){let e,t,n,o;return{c(){e=f("p"),t=f("strong"),t.textContent="Error:",n=g(),o=P(l[3])},m(a,r){S(a,e,r),s(e,t),s(e,n),s(e,o)},p(a,r){r[0]&8&&be(o,a[3])},d(a){a&&T(e)}}}function Un(l){var ee,K,X,x;let e,t,n,o,a,r=(((ee=l[1])==null?void 0:ee.title)||"Untitled")+"",u,i,d,p,m,_,h=(((K=l[1])==null?void 0:K.rank)||0)+"",w,b,k,$,y,v,C,q,I,N,R=((X=l[1])==null?void 0:X.description)&&zn(l),F=((x=l[1])==null?void 0:x.tags)&&Hn(l);function le(z,Z){return z[10].length>0?Ii:Ni}let V=le(l),L=V(l),A=l[10].length>0&&qn(l);return{c(){e=f("div"),t=f("label"),t.textContent="Document to Save",n=g(),o=f("div"),a=f("h5"),u=P(r),i=g(),R&&R.c(),d=g(),p=f("div"),m=f("span"),_=P("Rank: "),w=P(h),b=g(),F&&F.c(),k=g(),$=f("div"),y=f("label"),y.textContent="Atomic Server",v=g(),C=f("div"),L.c(),q=g(),A&&A.c(),I=ut(),c(t,"class","label"),c(a,"class","title is-6"),c(m,"class","tag is-info svelte-48g63o"),c(p,"class","tags svelte-48g63o"),c(o,"class","box document-preview svelte-48g63o"),c(e,"class","field"),c(y,"class","label"),c(y,"for","atomic-server-select"),c(C,"class","control"),c($,"class","field")},m(z,Z){S(z,e,Z),s(e,t),s(e,n),s(e,o),s(o,a),s(a,u),s(o,i),R&&R.m(o,null),s(o,d),s(o,p),s(p,m),s(m,_),s(m,w),s(p,b),F&&F.m(p,null),S(z,k,Z),S(z,$,Z),s($,y),s($,v),s($,C),L.m(C,null),S(z,q,Z),A&&A.m(z,Z),S(z,I,Z),N=!0},p(z,Z){var O,H,E,M;(!N||Z[0]&2)&&r!==(r=(((O=z[1])==null?void 0:O.title)||"Untitled")+"")&&be(u,r),(H=z[1])!=null&&H.description?R?R.p(z,Z):(R=zn(z),R.c(),R.m(o,d)):R&&(R.d(1),R=null),(!N||Z[0]&2)&&h!==(h=(((E=z[1])==null?void 0:E.rank)||0)+"")&&be(w,h),(M=z[1])!=null&&M.tags?F?F.p(z,Z):(F=Hn(z),F.c(),F.m(p,null)):F&&(F.d(1),F=null),V===(V=le(z))&&L?L.p(z,Z):(L.d(1),L=V(z),L&&(L.c(),L.m(C,null))),z[10].length>0?A?(A.p(z,Z),Z[0]&1024&&U(A,1)):(A=qn(z),A.c(),U(A,1),A.m(I.parentNode,I)):A&&(Fe(),Y(A,1,1,()=>{A=null}),Ke())},i(z){N||(U(A),N=!0)},o(z){Y(A),N=!1},d(z){z&&T(e),R&&R.d(),F&&F.d(),z&&T(k),z&&T($),L.d(),z&&T(q),A&&A.d(z),z&&T(I)}}}function zn(l){let e,t=l[1].description+"",n;return{c(){e=f("p"),n=P(t),c(e,"class","content")},m(o,a){S(o,e,a),s(e,n)},p(o,a){a[0]&2&&t!==(t=o[1].description+"")&&be(n,t)},d(o){o&&T(e)}}}function Hn(l){let e,t=l[1].tags,n=[];for(let o=0;o<t.length;o+=1)n[o]=Fn(Pn(l,t,o));return{c(){for(let o=0;o<n.length;o+=1)n[o].c();e=ut()},m(o,a){for(let r=0;r<n.length;r+=1)n[r]&&n[r].m(o,a);S(o,e,a)},p(o,a){if(a[0]&2){t=o[1].tags;let r;for(r=0;r<t.length;r+=1){const u=Pn(o,t,r);n[r]?n[r].p(u,a):(n[r]=Fn(u),n[r].c(),n[r].m(e.parentNode,e))}for(;r<n.length;r+=1)n[r].d(1);n.length=t.length}},d(o){tt(n,o),o&&T(e)}}}function Fn(l){let e,t=l[39]+"",n;return{c(){e=f("span"),n=P(t),c(e,"class","tag svelte-48g63o")},m(o,a){S(o,e,a),s(e,n)},p(o,a){a[0]&2&&t!==(t=o[39]+"")&&be(n,t)},d(o){o&&T(e)}}}function Ni(l){let e,t,n,o,a,r,u,i,d;return{c(){e=f("div"),t=f("p"),t.innerHTML="<strong>No atomic servers available</strong>",n=g(),o=f("p"),a=P('Your current role "'),r=P(l[12]),u=P(`" doesn't have any writable atomic server configurations.`),i=g(),d=f("p"),d.textContent="Please configure an atomic server haystack in your role settings.",c(e,"class","notification is-warning")},m(p,m){S(p,e,m),s(e,t),s(e,n),s(e,o),s(o,a),s(o,r),s(o,u),s(e,i),s(e,d)},p(p,m){m[0]&4096&&be(r,p[12])},d(p){p&&T(e)}}}function Ii(l){let e,t,n,o,a,r,u=l[10],i=[];for(let d=0;d<u.length;d+=1)i[d]=Kn(In(l,u,d));return{c(){e=f("div"),t=f("select");for(let d=0;d<i.length;d+=1)i[d].c();n=g(),o=f("p"),o.textContent=`Select the atomic server from your current role configuration.
              🔐 = Authenticated, ⚠️ = Anonymous access`,c(t,"id","atomic-server-select"),t.disabled=l[2],l[11]===void 0&&mt(()=>l[18].call(t)),c(e,"class","select is-fullwidth"),c(o,"class","help svelte-48g63o")},m(d,p){S(d,e,p),s(e,t);for(let m=0;m<i.length;m+=1)i[m]&&i[m].m(t,null);Je(t,l[11],!0),S(d,n,p),S(d,o,p),a||(r=re(t,"change",l[18]),a=!0)},p(d,p){if(p[0]&1024){u=d[10];let m;for(m=0;m<u.length;m+=1){const _=In(d,u,m);i[m]?i[m].p(_,p):(i[m]=Kn(_),i[m].c(),i[m].m(t,null))}for(;m<i.length;m+=1)i[m].d(1);i.length=u.length}p[0]&4&&(t.disabled=d[2]),p[0]&3072&&Je(t,d[11])},d(d){d&&T(e),tt(i,d),d&&T(n),d&&T(o),a=!1,r()}}}function Pi(l){let e;return{c(){e=f("span"),e.textContent="⚠️ No Auth",c(e,"class","has-text-warning")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function Mi(l){let e;return{c(){e=f("span"),e.textContent="🔐",c(e,"class","has-text-success")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function Kn(l){let e,t=l[36].location+"",n,o,a,r;function u(p,m){return p[36].atomic_server_secret?Mi:Pi}let i=u(l),d=i(l);return{c(){e=f("option"),n=P(t),o=g(),d.c(),a=g(),e.__value=r=l[36].location,e.value=e.__value},m(p,m){S(p,e,m),s(e,n),s(e,o),d.m(e,null),s(e,a)},p(p,m){m[0]&1024&&t!==(t=p[36].location+"")&&be(n,t),i!==(i=u(p))&&(d.d(1),d=i(p),d&&(d.c(),d.m(e,a))),m[0]&1024&&r!==(r=p[36].location)&&(e.__value=r,e.value=e.__value)},d(p){p&&T(e),d.d()}}}function qn(l){var J,ne;let e,t,n,o,a,r,u,i,d,p,m,_,h,w,b,k,$,y,v,C,q,I,N,R,F,le,V,L,A,ee,K,X,x,z,Z,O,H,E,M,B,oe,D,j,W=(l[8]||"Untitled")+"",ae,ce,se,ie,me,G=(((ne=(J=l[1])==null?void 0:J.body)==null?void 0:ne.length)||0)+"",te,ue,_e,ke,Te,Xe,Be=l[14]()+"",Ne,Pe,de,Se,Me,xe=l[15]()+"",et,ye,ze,qe,Ge;function Le(Q){l[19](Q)}let De={id:"article-title",placeholder:"Enter article title",disabled:l[2],required:!0};l[8]!==void 0&&(De.value=l[8]),a=new Qt({props:De}),lt.push(()=>st(a,"value",Le));const it=[Ui,ji],Ie=[];function We(Q,fe){return Q[7]?1:0}return le=We(l),V=Ie[le]=it[le](l),K=new Kt({props:{type:"is-primary",loading:l[2],disabled:l[2]||!l[8].trim()||!l[11],$$slots:{default:[zi]},$$scope:{ctx:l}}}),K.$on("click",l[16]),z=new Kt({props:{type:"is-light",disabled:l[2],$$slots:{default:[Hi]},$$scope:{ctx:l}}}),z.$on("click",l[17]),ze=qs(l[22][0]),{c(){e=f("div"),t=f("label"),t.textContent="Article Title",n=g(),o=f("div"),he(a.$$.fragment),u=g(),i=f("div"),d=f("label"),d.textContent="Description",p=g(),m=f("div"),_=f("textarea"),h=g(),w=f("div"),b=f("label"),b.textContent="Parent Collection",k=g(),$=f("div"),y=f("label"),v=f("input"),C=P(`
              Use predefined collection`),q=g(),I=f("label"),N=f("input"),R=P(`
              Custom parent URL/path`),F=g(),V.c(),L=g(),A=f("div"),ee=f("div"),he(K.$$.fragment),X=g(),x=f("div"),he(z.$$.fragment),Z=g(),O=f("div"),H=f("div"),E=f("p"),E.innerHTML="<strong>What will be saved:</strong>",M=g(),B=f("ul"),oe=f("li"),D=f("strong"),D.textContent="Title:",j=g(),ae=P(W),ce=g(),se=f("li"),ie=f("strong"),ie.textContent="Body:",me=P(" Original document content ("),te=P(G),ue=P(" characters)"),_e=g(),ke=f("li"),Te=f("strong"),Te.textContent="Parent:",Xe=g(),Ne=P(Be),Pe=g(),de=f("li"),Se=f("strong"),Se.textContent="Subject URL:",Me=g(),et=P(xe),c(t,"class","label"),c(t,"for","article-title"),c(o,"class","control"),c(e,"class","field"),c(d,"class","label"),c(d,"for","article-description"),c(_,"id","article-description"),c(_,"class","textarea"),c(_,"placeholder","Brief description of the article"),_.disabled=l[2],c(_,"rows","3"),c(m,"class","control"),c(i,"class","field"),c(b,"class","label"),c(v,"type","radio"),v.__value=!1,v.value=v.__value,v.disabled=l[2],c(y,"class","radio svelte-48g63o"),c(N,"type","radio"),N.__value=!0,N.value=N.__value,N.disabled=l[2],c(I,"class","radio svelte-48g63o"),c($,"class","control"),c(w,"class","field"),c(ee,"class","control"),c(x,"class","control"),c(A,"class","field is-grouped"),c(oe,"class","svelte-48g63o"),c(se,"class","svelte-48g63o"),c(ke,"class","svelte-48g63o"),c(de,"class","svelte-48g63o"),c(B,"class","svelte-48g63o"),c(H,"class","notification is-info is-light svelte-48g63o"),c(O,"class","field"),ze.p(v,N)},m(Q,fe){S(Q,e,fe),s(e,t),s(e,n),s(e,o),ge(a,o,null),S(Q,u,fe),S(Q,i,fe),s(i,d),s(i,p),s(i,m),s(m,_),Oe(_,l[9]),S(Q,h,fe),S(Q,w,fe),s(w,b),s(w,k),s(w,$),s($,y),s(y,v),v.checked=v.__value===l[7],s(y,C),s($,q),s($,I),s(I,N),N.checked=N.__value===l[7],s(I,R),S(Q,F,fe),Ie[le].m(Q,fe),S(Q,L,fe),S(Q,A,fe),s(A,ee),ge(K,ee,null),s(A,X),s(A,x),ge(z,x,null),S(Q,Z,fe),S(Q,O,fe),s(O,H),s(H,E),s(H,M),s(H,B),s(B,oe),s(oe,D),s(oe,j),s(oe,ae),s(B,ce),s(B,se),s(se,ie),s(se,me),s(se,te),s(se,ue),s(B,_e),s(B,ke),s(ke,Te),s(ke,Xe),s(ke,Ne),s(B,Pe),s(B,de),s(de,Se),s(de,Me),s(de,et),ye=!0,qe||(Ge=[re(_,"input",l[20]),re(v,"change",l[21]),re(N,"change",l[23])],qe=!0)},p(Q,fe){var pe,Ae;const Ce={};fe[0]&4&&(Ce.disabled=Q[2]),!r&&fe[0]&256&&(r=!0,Ce.value=Q[8],rt(()=>r=!1)),a.$set(Ce),(!ye||fe[0]&4)&&(_.disabled=Q[2]),fe[0]&512&&Oe(_,Q[9]),(!ye||fe[0]&4)&&(v.disabled=Q[2]),fe[0]&128&&(v.checked=v.__value===Q[7]),(!ye||fe[0]&4)&&(N.disabled=Q[2]),fe[0]&128&&(N.checked=N.__value===Q[7]);let $e=le;le=We(Q),le===$e?Ie[le].p(Q,fe):(Fe(),Y(Ie[$e],1,1,()=>{Ie[$e]=null}),Ke(),V=Ie[le],V?V.p(Q,fe):(V=Ie[le]=it[le](Q),V.c()),U(V,1),V.m(L.parentNode,L));const Ye={};fe[0]&4&&(Ye.loading=Q[2]),fe[0]&2308&&(Ye.disabled=Q[2]||!Q[8].trim()||!Q[11]),fe[1]&2048&&(Ye.$$scope={dirty:fe,ctx:Q}),K.$set(Ye);const nt={};fe[0]&4&&(nt.disabled=Q[2]),fe[1]&2048&&(nt.$$scope={dirty:fe,ctx:Q}),z.$set(nt),(!ye||fe[0]&256)&&W!==(W=(Q[8]||"Untitled")+"")&&be(ae,W),(!ye||fe[0]&2)&&G!==(G=(((Ae=(pe=Q[1])==null?void 0:pe.body)==null?void 0:Ae.length)||0)+"")&&be(te,G)},i(Q){ye||(U(a.$$.fragment,Q),U(V),U(K.$$.fragment,Q),U(z.$$.fragment,Q),ye=!0)},o(Q){Y(a.$$.fragment,Q),Y(V),Y(K.$$.fragment,Q),Y(z.$$.fragment,Q),ye=!1},d(Q){Q&&T(e),ve(a),Q&&T(u),Q&&T(i),Q&&T(h),Q&&T(w),Q&&T(F),Ie[le].d(Q),Q&&T(L),Q&&T(A),ve(K),ve(z),Q&&T(Z),Q&&T(O),ze.r(),qe=!1,Ve(Ge)}}}function ji(l){let e,t,n,o,a,r,u;function i(p){l[25](p)}let d={placeholder:"e.g., my-collection or http://server/custom-parent",disabled:l[2]};return l[6]!==void 0&&(d.value=l[6]),n=new Qt({props:d}),lt.push(()=>st(n,"value",i)),{c(){e=f("div"),t=f("div"),he(n.$$.fragment),a=g(),r=f("p"),r.textContent=`Enter a collection name (e.g., "my-articles") or full URL.
              If the collection doesn't exist, it will be created.`,c(t,"class","control"),c(r,"class","help svelte-48g63o"),c(e,"class","field")},m(p,m){S(p,e,m),s(e,t),ge(n,t,null),s(e,a),s(e,r),u=!0},p(p,m){const _={};m[0]&4&&(_.disabled=p[2]),!o&&m[0]&64&&(o=!0,_.value=p[6],rt(()=>o=!1)),n.$set(_)},i(p){u||(U(n.$$.fragment,p),u=!0)},o(p){Y(n.$$.fragment,p),u=!1},d(p){p&&T(e),ve(n)}}}function Ui(l){let e,t,n,o,a,r,u=l[13],i=[];for(let d=0;d<u.length;d+=1)i[d]=Gn(Nn(l,u,d));return{c(){e=f("div"),t=f("div"),n=f("div"),o=f("select");for(let d=0;d<i.length;d+=1)i[d].c();o.disabled=l[2],l[5]===void 0&&mt(()=>l[24].call(o)),c(n,"class","select is-fullwidth"),c(t,"class","control"),c(e,"class","field")},m(d,p){S(d,e,p),s(e,t),s(t,n),s(n,o);for(let m=0;m<i.length;m+=1)i[m]&&i[m].m(o,null);Je(o,l[5],!0),a||(r=re(o,"change",l[24]),a=!0)},p(d,p){if(p[0]&8192){u=d[13];let m;for(m=0;m<u.length;m+=1){const _=Nn(d,u,m);i[m]?i[m].p(_,p):(i[m]=Gn(_),i[m].c(),i[m].m(o,null))}for(;m<i.length;m+=1)i[m].d(1);i.length=u.length}p[0]&4&&(o.disabled=d[2]),p[0]&8224&&Je(o,d[5])},i:Re,o:Re,d(d){d&&T(e),tt(i,d),a=!1,r()}}}function Gn(l){let e,t=l[33].label+"",n;return{c(){e=f("option"),n=P(t),e.__value=l[33].value,e.value=e.__value},m(o,a){S(o,e,a),s(e,n)},p:Re,d(o){o&&T(e)}}}function zi(l){let e,t,n;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-cloud-upload-alt"></i>',t=g(),n=f("span"),n.textContent="Save to Atomic Server",c(e,"class","icon")},m(o,a){S(o,e,a),S(o,t,a),S(o,n,a)},p:Re,d(o){o&&T(e),o&&T(t),o&&T(n)}}}function Hi(l){let e;return{c(){e=P("Cancel")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function Fi(l){let e,t,n,o,a,r,u,i,d,p,m,_,h,w=l[4]&&Mn(l),b=l[3]&&jn(l),k=!l[4]&&Un(l);return{c(){e=f("div"),t=f("div"),n=f("div"),n.innerHTML=`<div class="level-item"><h3 class="title is-4"><span class="icon"><i class="fas fa-save"></i></span>
            Save to Atomic Server</h3></div>`,o=g(),a=f("div"),r=f("div"),u=f("button"),i=g(),w&&w.c(),d=g(),b&&b.c(),p=g(),k&&k.c(),c(n,"class","level-left"),c(u,"class","delete is-large"),u.disabled=l[2],c(u,"aria-label","close"),c(r,"class","level-item"),c(a,"class","level-right"),c(t,"class","level svelte-48g63o"),c(e,"class","box")},m($,y){S($,e,y),s(e,t),s(t,n),s(t,o),s(t,a),s(a,r),s(r,u),s(e,i),w&&w.m(e,null),s(e,d),b&&b.m(e,null),s(e,p),k&&k.m(e,null),m=!0,_||(h=re(u,"click",l[17]),_=!0)},p($,y){(!m||y[0]&4)&&(u.disabled=$[2]),$[4]?w?y[0]&16&&U(w,1):(w=Mn($),w.c(),U(w,1),w.m(e,d)):w&&(Fe(),Y(w,1,1,()=>{w=null}),Ke()),$[3]?b?(b.p($,y),y[0]&8&&U(b,1)):(b=jn($),b.c(),U(b,1),b.m(e,p)):b&&(Fe(),Y(b,1,1,()=>{b=null}),Ke()),$[4]?k&&(Fe(),Y(k,1,1,()=>{k=null}),Ke()):k?(k.p($,y),y[0]&16&&U(k,1)):(k=Un($),k.c(),U(k,1),k.m(e,null))},i($){m||(U(w),U(b),U(k),m=!0)},o($){Y(w),Y(b),Y(k),m=!1},d($){$&&T(e),w&&w.d(),b&&b.d(),k&&k.d(),_=!1,h()}}}function Ki(l){let e,t,n;function o(r){l[26](r)}let a={$$slots:{default:[Fi]},$$scope:{ctx:l}};return l[0]!==void 0&&(a.active=l[0]),e=new wl({props:a}),lt.push(()=>st(e,"active",o)),e.$on("close",l[17]),{c(){he(e.$$.fragment)},m(r,u){ge(e,r,u),n=!0},p(r,u){const i={};u[0]&8190|u[1]&2048&&(i.$$scope={dirty:u,ctx:r}),!t&&u[0]&1&&(t=!0,i.active=r[0],rt(()=>t=!1)),e.$set(i)},i(r){n||(U(e.$$.fragment,r),n=!0)},o(r){Y(e.$$.fragment,r),n=!1},d(r){ve(e,r)}}}function qi(l,e,t){let n,o,a;Ue(l,ct,O=>t(27,n=O)),Ue(l,Lt,O=>t(28,o=O)),Ue(l,At,O=>t(12,a=O));let{active:r=!1}=e,{document:u}=e,i=!1,d=null,p=!1,m="",_="",h=!1,w="",b="",k=[],$="";const y=[{label:"Root (Server Root)",value:""},{label:"Articles Collection",value:"articles"},{label:"Documents Collection",value:"documents"},{label:"Knowledge Base",value:"knowledge-base"},{label:"Research",value:"research"},{label:"Projects",value:"projects"}];function v(){t(2,i=!1),t(3,d=null),t(4,p=!1),t(5,m=""),t(6,_=""),t(7,h=!1),t(8,w=(u==null?void 0:u.title)||""),t(9,b=(u==null?void 0:u.description)||`Article saved from Terraphim search: ${u==null?void 0:u.title}`),t(10,k=[]),t(11,$="")}function C(){var M;const O=a,H=o;if(!(H!=null&&H.roles)||!O){console.warn("No role configuration found");return}let E=null;try{for(const[B,oe]of Object.entries(H.roles)){const D=oe,j=typeof D.name=="object"?D.name.original:String(D.name);if(B===O||j===O){E=D;break}}}catch(B){console.warn("Error checking role configuration:",B);return}if(!E){console.warn(`Role "${O}" not found in configuration`);return}t(10,k=((M=E.haystacks)==null?void 0:M.filter(B=>B.service==="Atomic"&&B.location&&!B.read_only))||[]),k.length>0&&t(11,$=k[0].location),console.log("Loaded atomic servers:",k)}function q(){const O=k.find(H=>H.location===$);return O==null?void 0:O.atomic_server_secret}function I(){const O=$.replace(/\/$/,"");if(h&&_.trim()){const H=_.trim();return H.startsWith("http://")||H.startsWith("https://")?H:`${O}/${H.replace(/^\//,"")}`}else return m?`${O}/${m}`:O}function N(){return w.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,50)}function R(){const O=$.replace(/\/$/,""),H=N(),E=Date.now();return`${O}/${H}-${E}`}async function F(){if(!$||!w.trim()){t(3,d="Please select an atomic server and provide a title");return}t(2,i=!0),t(3,d=null);try{const O=R(),H=I(),E=q();console.log("🔄 Saving article to atomic server:",{subject:O,parent:H,server:$,hasSecret:!!E});const M={subject:O,title:w.trim(),description:b.trim(),body:u.body,parent:H,shortname:N(),original_id:u.id,original_url:u.url,original_rank:u.rank,tags:u.tags||[]};if(n)await je("save_article_to_atomic",{article:M,serverUrl:$,atomicSecret:E});else{const B=await fetch(`${Qe.ServerURL}/atomic/save`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({article:M,server_url:$,atomic_secret:E})});if(!B.ok){const oe=await B.json().catch(()=>({error:B.statusText}));throw new Error(oe.error||`HTTP ${B.status}: ${B.statusText}`)}}t(4,p=!0),console.log("✅ Article saved successfully to atomic server"),setTimeout(()=>{t(0,r=!1)},2e3)}catch(O){console.error("❌ Failed to save article to atomic server:",O),t(3,d=O.message||"Failed to save article to atomic server")}finally{t(2,i=!1)}}function le(){i||t(0,r=!1)}const V=[[]];function L(){$=St(this),t(11,$),t(10,k)}function A(O){w=O,t(8,w)}function ee(){b=this.value,t(9,b)}function K(){h=this.__value,t(7,h)}function X(){h=this.__value,t(7,h)}function x(){m=St(this),t(5,m),t(13,y)}function z(O){_=O,t(6,_)}function Z(O){r=O,t(0,r)}return l.$$set=O=>{"active"in O&&t(0,r=O.active),"document"in O&&t(1,u=O.document)},l.$$.update=()=>{l.$$.dirty[0]&3&&r&&u&&(v(),C())},[r,u,i,d,p,m,_,h,w,b,k,$,a,y,I,R,F,le,L,A,ee,K,V,X,x,z,Z]}class Gi extends _t{constructor(e){super(),ht(this,e,qi,Ki,pt,{active:0,document:1},null,[-1,-1])}}async function Yl(l){return je("tauri",l)}async function Wi(l,e){return Yl({__tauriModule:"Event",message:{cmd:"unlisten",event:l,eventId:e}})}async function Bi(l,e,t){return Yl({__tauriModule:"Event",message:{cmd:"listen",event:l,windowLabel:e,handler:ql(t)}}).then(n=>async()=>Wi(l,n))}var Wn;(function(l){l.WINDOW_RESIZED="tauri://resize",l.WINDOW_MOVED="tauri://move",l.WINDOW_CLOSE_REQUESTED="tauri://close-requested",l.WINDOW_CREATED="tauri://window-created",l.WINDOW_DESTROYED="tauri://destroyed",l.WINDOW_FOCUS="tauri://focus",l.WINDOW_BLUR="tauri://blur",l.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",l.WINDOW_THEME_CHANGED="tauri://theme-changed",l.WINDOW_FILE_DROP="tauri://file-drop",l.WINDOW_FILE_DROP_HOVER="tauri://file-drop-hover",l.WINDOW_FILE_DROP_CANCELLED="tauri://file-drop-cancelled",l.MENU="tauri://menu",l.CHECK_UPDATE="tauri://update",l.UPDATE_AVAILABLE="tauri://update-available",l.INSTALL_UPDATE="tauri://update-install",l.STATUS_UPDATE="tauri://update-status",l.DOWNLOAD_PROGRESS="tauri://update-download-progress"})(Wn||(Wn={}));async function Ji(l,e){return Bi(l,null,e)}function Bn(l,e,t){const n=l.slice();return n[9]=e[t],n}function Jn(l){let e,t=l[9].name+"",n,o;return{c(){e=f("option"),n=P(t),e.__value=o=l[9].name,e.value=e.__value},m(a,r){S(a,e,r),s(e,n)},p(a,r){r&1&&t!==(t=a[9].name+"")&&be(n,t),r&1&&o!==(o=a[9].name)&&(e.__value=o,e.value=e.__value)},d(a){a&&T(e)}}}function Qi(l){let e,t,n,o,a,r,u=l[0],i=[];for(let d=0;d<u.length;d+=1)i[d]=Jn(Bn(l,u,d));return{c(){e=f("div"),t=f("div"),n=f("div"),o=f("select");for(let d=0;d<i.length;d+=1)i[d].c();c(n,"class","select"),c(t,"class","control"),c(e,"class","field is-grouped is-grouped-right")},m(d,p){S(d,e,p),s(e,t),s(t,n),s(n,o);for(let m=0;m<i.length;m+=1)i[m]&&i[m].m(o,null);Je(o,l[1]),a||(r=re(o,"change",l[2]),a=!0)},p(d,[p]){if(p&1){u=d[0];let m;for(m=0;m<u.length;m+=1){const _=Bn(d,u,m);i[m]?i[m].p(_,p):(i[m]=Jn(_),i[m].c(),i[m].m(o,null))}for(;m<i.length;m+=1)i[m].d(1);i.length=u.length}p&3&&Je(o,d[1])},i:Re,o:Re,d(d){d&&T(e),tt(i,d),a=!1,r()}}}function Vi(l,e,t){let n,o,a,r;Ue(l,Lt,_=>t(5,n=_)),Ue(l,ct,_=>t(6,o=_)),Ue(l,yn,_=>t(0,a=_)),Ue(l,At,_=>t(1,r=_));let u="";async function i(){try{ct.set(window.__TAURI__!==void 0),o?(console.log("Loading config from Tauri"),je("get_config").then(_=>{console.log("get_config response",_),_&&_.status==="success"&&d(_.config)}).catch(_=>console.error("Error fetching config in Tauri:",_))):(console.log("Loading config from server"),u=`${Qe.ServerURL}/config/`,fetch(u).then(_=>_.json()).then(_=>{console.log("Config received",_),_&&_.status==="success"&&d(_.config)}).catch(_=>console.error("Error fetching config:",_)))}catch(_){console.error("Unhandled error in loadConfig:",_)}}function d(_){var k;console.log("Updating stores from config:",_);const h={default_role:_.selected_role,..._};Lt.set(h);const w=Object.entries(_.roles).map(([$,y])=>({name:$,...y}));yn.set(w),At.set(_.selected_role);const b=_.roles[_.selected_role];if(console.log("Selected role settings:",b),b){const $=b.theme||"spacelab";console.log("Setting theme to:",$),kl.set($),(k=b.kg)!=null&&k.publish?o?je("publish_thesaurus",{roleName:_.selected_role}).then(y=>{console.log("publish_thesaurus response",y),bl.set(y),Tt.set(!0)}).catch(y=>{console.error("Error publishing thesaurus:",y),Tt.set(!1)}):(console.log("Fetching thesaurus from HTTP endpoint for role",_.selected_role),fetch(`${Qe.ServerURL}/thesaurus/${encodeURIComponent(_.selected_role)}`).then(y=>y.json()).then(y=>{console.log("thesaurus HTTP response",y),y&&y.status==="success"&&y.thesaurus?(bl.set(y.thesaurus),Tt.set(!0)):(console.error("Failed to fetch thesaurus:",y),Tt.set(!1))}).catch(y=>{console.error("Error fetching thesaurus:",y),Tt.set(!1)})):Tt.set(!1)}else console.warn("No role settings found for:",_.selected_role),kl.set("spacelab")}typeof window<"u"&&window.__TAURI__&&Ji("role_changed",_=>{console.log("Role changed event received from backend:",_.payload),d(_.payload)});async function p(){await i()}p(),console.log("Using Terraphim Server URL:",Qe.ServerURL);function m(_){var $,y;const w=_.currentTarget.value;console.log("Role change requested:",w),At.set(w);const b=a.find(v=>v.name===w);if(!b){console.error(`No role settings found for role: ${w}.`);return}const k=b.theme||"spacelab";kl.set(k),console.log(`Theme changed to ${k}`),Lt.update(v=>(v.selected_role=w,v)),o?(je("select_role",{roleName:w}).catch(v=>console.error("Error selecting role:",v)),($=b.kg)!=null&&$.publish?(console.log("Publishing thesaurus for role",w),je("publish_thesaurus",{roleName:w}).then(v=>{bl.set(v),Tt.set(!0)})):Tt.set(!1)):(fetch(`${Qe.ServerURL}/config/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).catch(v=>console.error("Error updating config on server:",v)),(y=b.kg)!=null&&y.publish?(console.log("Fetching thesaurus from HTTP endpoint for role",w),fetch(`${Qe.ServerURL}/thesaurus/${encodeURIComponent(w)}`).then(v=>v.json()).then(v=>{console.log("thesaurus HTTP response",v),v&&v.status==="success"&&v.thesaurus?(bl.set(v.thesaurus),Tt.set(!0)):(console.error("Failed to fetch thesaurus:",v),Tt.set(!1))}).catch(v=>{console.error("Error fetching thesaurus:",v),Tt.set(!1)})):Tt.set(!1))}return[a,r,m,i]}class Ml extends _t{constructor(e){super(),ht(this,e,Vi,Qi,pt,{loadConfig:3})}get loadConfig(){return this.$$.ctx[3]}}function Qn(l,e,t){const n=l.slice();return n[41]=e[t],n}function Vn(l,e,t){const n=l.slice();return n[44]=e[t],n}function Yn(l){let e,t;return e=new Bl({props:{$$slots:{default:[Zi]},$$scope:{ctx:l}}}),{c(){he(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},p(n,o){const a={};o[0]&129|o[1]&65536&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(U(e.$$.fragment,n),t=!0)},o(n){Y(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function Yi(l){let e=l[44]+"",t;return{c(){t=P(e)},m(n,o){S(n,t,o)},p(n,o){o[0]&1&&e!==(e=n[44]+"")&&be(t,e)},d(n){n&&T(t)}}}function Zn(l){let e,t,n,o,a,r;t=new qt({props:{rounded:!0,$$slots:{default:[Yi]},$$scope:{ctx:l}}});function u(){return l[19](l[44])}return{c(){e=f("button"),he(t.$$.fragment),n=g(),c(e,"class","tag-button svelte-2smypa"),e.disabled=l[7],c(e,"title","Click to view knowledge graph document")},m(i,d){S(i,e,d),ge(t,e,null),s(e,n),o=!0,a||(r=re(e,"click",u),a=!0)},p(i,d){l=i;const p={};d[0]&1|d[1]&65536&&(p.$$scope={dirty:d,ctx:l}),t.$set(p),(!o||d[0]&128)&&(e.disabled=l[7])},i(i){o||(U(t.$$.fragment,i),o=!0)},o(i){Y(t.$$.fragment,i),o=!1},d(i){i&&T(e),ve(t),a=!1,r()}}}function Zi(l){let e,t,n=l[0].tags,o=[];for(let r=0;r<n.length;r+=1)o[r]=Zn(Vn(l,n,r));const a=r=>Y(o[r],1,1,()=>{o[r]=null});return{c(){for(let r=0;r<o.length;r+=1)o[r].c();e=ut()},m(r,u){for(let i=0;i<o.length;i+=1)o[i]&&o[i].m(r,u);S(r,e,u),t=!0},p(r,u){if(u[0]&131201){n=r[0].tags;let i;for(i=0;i<n.length;i+=1){const d=Vn(r,n,i);o[i]?(o[i].p(d,u),U(o[i],1)):(o[i]=Zn(d),o[i].c(),U(o[i],1),o[i].m(e.parentNode,e))}for(Fe(),i=n.length;i<o.length;i+=1)a(i);Ke()}},i(r){if(!t){for(let u=0;u<n.length;u+=1)U(o[u]);t=!0}},o(r){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)Y(o[u]);t=!1},d(r){tt(o,r),r&&T(e)}}}function Xi(l){let e,t=(l[0].rank||0)+"",n;return{c(){e=P("Rank "),n=P(t)},m(o,a){S(o,e,a),S(o,n,a)},p(o,a){a[0]&1&&t!==(t=(o[0].rank||0)+"")&&be(n,t)},d(o){o&&T(e),o&&T(n)}}}function xi(l){let e,t;return e=new qt({props:{rounded:!0,$$slots:{default:[Xi]},$$scope:{ctx:l}}}),{c(){he(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},p(n,o){const a={};o[0]&1|o[1]&65536&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(U(e.$$.fragment,n),t=!0)},o(n){Y(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function ea(l){let e;return{c(){e=f("small"),e.textContent="No description available",c(e,"class","no-description svelte-2smypa")},m(t,n){S(t,e,n)},p:Re,i:Re,o:Re,d(t){t&&T(e)}}}function ta(l){let e,t;return e=new Ul({props:{source:l[0].description}}),{c(){he(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},p(n,o){const a={};o[0]&1&&(a.source=n[0].description),e.$set(a)},i(n){t||(U(e.$$.fragment,n),t=!0)},o(n){Y(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function Xn(l){let e,t,n,o,a,r;return{c(){e=f("button"),t=f("span"),t.innerHTML='<i class="fas fa-magic" aria-hidden="true"></i>',n=g(),o=f("span"),o.textContent="AI Summary",c(t,"class","icon is-small"),c(e,"class","button is-small is-info is-outlined ai-summary-button svelte-2smypa"),e.disabled=l[9],c(e,"title","Generate AI-powered summary using OpenRouter")},m(u,i){S(u,e,i),s(e,t),s(e,n),s(e,o),a||(r=re(e,"click",l[18]),a=!0)},p(u,i){i[0]&512&&(e.disabled=u[9])},d(u){u&&T(e),a=!1,r()}}}function xn(l){let e;return{c(){e=f("div"),e.innerHTML=`<span class="icon"><i class="fas fa-spinner fa-spin" aria-hidden="true"></i></span> 
                <small>Generating AI summary...</small>`,c(e,"class","ai-summary-loading svelte-2smypa")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function eo(l){let e,t,n,o,a,r,u,i,d,p;return{c(){e=f("div"),t=f("span"),t.innerHTML='<i class="fas fa-exclamation-triangle" aria-hidden="true"></i>',n=g(),o=f("small"),a=P("Summary error: "),r=P(l[10]),u=g(),i=f("button"),i.textContent="Retry",c(t,"class","icon has-text-danger"),c(o,"class","has-text-danger"),c(i,"class","button is-small is-text svelte-2smypa"),c(i,"title","Retry generating summary"),c(e,"class","ai-summary-error svelte-2smypa")},m(m,_){S(m,e,_),s(e,t),s(e,n),s(e,o),s(o,a),s(o,r),s(e,u),s(e,i),d||(p=re(i,"click",l[20]),d=!0)},p(m,_){_[0]&1024&&be(r,m[10])},d(m){m&&T(e),d=!1,p()}}}function to(l){let e,t,n,o,a,r,u,i,d,p,m,_,h,w,b,k,$,y,v,C;function q(R,F){return R[12]?na:la}let I=q(l),N=I(l);return p=new Ul({props:{source:l[8]}}),{c(){e=f("div"),t=f("div"),n=f("small"),o=f("span"),o.innerHTML='<i class="fas fa-robot" aria-hidden="true"></i>',a=P(`
                    AI Summary
                    `),N.c(),r=g(),u=f("button"),u.innerHTML='<span class="icon is-small"><i class="fas fa-times" aria-hidden="true"></i></span>',i=g(),d=f("div"),he(p.$$.fragment),m=g(),_=f("div"),h=f("button"),w=f("span"),w.innerHTML='<i class="fas fa-redo" aria-hidden="true"></i>',b=g(),k=f("span"),k.textContent="Regenerate",c(o,"class","icon is-small"),c(n,"class","ai-summary-label svelte-2smypa"),c(u,"class","button is-small is-text svelte-2smypa"),c(u,"title","Hide AI summary"),c(t,"class","ai-summary-header svelte-2smypa"),c(d,"class","ai-summary-content svelte-2smypa"),c(w,"class","icon is-small"),c(h,"class","button is-small is-text svelte-2smypa"),h.disabled=l[9],c(h,"title","Regenerate summary"),c(_,"class","ai-summary-actions svelte-2smypa"),c(e,"class","ai-summary svelte-2smypa")},m(R,F){S(R,e,F),s(e,t),s(t,n),s(n,o),s(n,a),N.m(n,null),s(t,r),s(t,u),s(e,i),s(e,d),ge(p,d,null),s(e,m),s(e,_),s(_,h),s(h,w),s(h,b),s(h,k),y=!0,v||(C=[re(u,"click",l[21]),re(h,"click",l[22])],v=!0)},p(R,F){I!==(I=q(R))&&(N.d(1),N=I(R),N&&(N.c(),N.m(n,null)));const le={};F[0]&256&&(le.source=R[8]),p.$set(le),(!y||F[0]&512)&&(h.disabled=R[9])},i(R){y||(U(p.$$.fragment,R),mt(()=>{y&&($||($=pl(e,ml,{},!0)),$.run(1))}),y=!0)},o(R){Y(p.$$.fragment,R),$||($=pl(e,ml,{},!1)),$.run(0),y=!1},d(R){R&&T(e),N.d(),ve(p),R&&$&&$.end(),v=!1,Ve(C)}}}function la(l){let e;return{c(){e=f("span"),e.textContent="fresh",c(e,"class","tag is-small is-success")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function na(l){let e;return{c(){e=f("span"),e.textContent="cached",c(e,"class","tag is-small is-light")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function lo(l){let e;function t(a,r){return a[41].disabled?ra:a[41].isLink?sa:oa}let n=t(l),o=n(l);return{c(){o.c(),e=ut()},m(a,r){o.m(a,r),S(a,e,r)},p(a,r){n===(n=t(a))&&o?o.p(a,r):(o.d(1),o=n(a),o&&(o.c(),o.m(e.parentNode,e)))},d(a){o.d(a),a&&T(e)}}}function oa(l){let e,t,n,o,a,r,u,i,d,p;return{c(){var m,_,h;e=f("button"),t=f("span"),n=f("i"),a=g(),c(n,"class",o=Pt(l[41].icon)+" svelte-2smypa"),c(t,"class","icon is-medium"),dt(t,"has-text-primary",(m=l[41].className)==null?void 0:m.includes("primary")),dt(t,"has-text-success",(_=l[41].className)==null?void 0:_.includes("success")),dt(t,"has-text-danger",(h=l[41].className)==null?void 0:h.includes("danger")),c(e,"type","button"),c(e,"class","level-item button is-ghost svelte-2smypa"),c(e,"aria-label",r=l[41].title),c(e,"title",u=l[41].title),c(e,"data-testid",i=l[41].testId||"")},m(m,_){S(m,e,_),s(e,t),s(t,n),s(e,a),d||(p=re(e,"click",function(){Jl(l[41].action)&&l[41].action.apply(this,arguments)}),d=!0)},p(m,_){var h,w,b;l=m,_[0]&32768&&o!==(o=Pt(l[41].icon)+" svelte-2smypa")&&c(n,"class",o),_[0]&32768&&dt(t,"has-text-primary",(h=l[41].className)==null?void 0:h.includes("primary")),_[0]&32768&&dt(t,"has-text-success",(w=l[41].className)==null?void 0:w.includes("success")),_[0]&32768&&dt(t,"has-text-danger",(b=l[41].className)==null?void 0:b.includes("danger")),_[0]&32768&&r!==(r=l[41].title)&&c(e,"aria-label",r),_[0]&32768&&u!==(u=l[41].title)&&c(e,"title",u),_[0]&32768&&i!==(i=l[41].testId||"")&&c(e,"data-testid",i)},d(m){m&&T(e),d=!1,p()}}}function sa(l){let e,t,n,o,a,r,u,i;return{c(){e=f("a"),t=f("span"),n=f("i"),a=g(),c(n,"class",o=Pt(l[41].icon)+" svelte-2smypa"),c(t,"class","icon is-medium"),dt(t,"has-text-primary",l[41].className),c(e,"href",r=l[41].href),c(e,"target","_blank"),c(e,"class","level-item"),c(e,"aria-label",u=l[41].title),c(e,"title",i=l[41].title)},m(d,p){S(d,e,p),s(e,t),s(t,n),s(e,a)},p(d,p){p[0]&32768&&o!==(o=Pt(d[41].icon)+" svelte-2smypa")&&c(n,"class",o),p[0]&32768&&dt(t,"has-text-primary",d[41].className),p[0]&32768&&r!==(r=d[41].href)&&c(e,"href",r),p[0]&32768&&u!==(u=d[41].title)&&c(e,"aria-label",u),p[0]&32768&&i!==(i=d[41].title)&&c(e,"title",i)},d(d){d&&T(e)}}}function ra(l){let e,t,n,o,a,r,u;return{c(){e=f("button"),t=f("span"),n=f("i"),a=g(),c(n,"class",o=Pt(l[41].icon)+" svelte-2smypa"),c(t,"class","icon is-medium"),dt(t,"has-text-primary",l[41].className),c(e,"type","button"),c(e,"class","level-item button is-ghost svelte-2smypa"),c(e,"aria-label",r=l[41].title),c(e,"title",u=l[41].title),e.disabled=!0},m(i,d){S(i,e,d),s(e,t),s(t,n),s(e,a)},p(i,d){d[0]&32768&&o!==(o=Pt(i[41].icon)+" svelte-2smypa")&&c(n,"class",o),d[0]&32768&&dt(t,"has-text-primary",i[41].className),d[0]&32768&&r!==(r=i[41].title)&&c(e,"aria-label",r),d[0]&32768&&u!==(u=i[41].title)&&c(e,"title",u)},d(i){i&&T(e)}}}function no(l){let e,t=l[41].visible&&lo(l);return{c(){t&&t.c(),e=ut()},m(n,o){t&&t.m(n,o),S(n,e,o)},p(n,o){n[41].visible?t?t.p(n,o):(t=lo(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(n){t&&t.d(n),n&&T(e)}}}function oo(l){let e,t,n,o,a,r;return{c(){e=f("div"),t=f("button"),n=g(),o=P(l[13]),c(t,"class","delete svelte-2smypa"),c(e,"class","notification is-danger is-light mt-2")},m(u,i){S(u,e,i),s(e,t),s(e,n),s(e,o),a||(r=re(t,"click",l[23]),a=!0)},p(u,i){i[0]&8192&&be(o,u[13])},d(u){u&&T(e),a=!1,r()}}}function so(l){let e,t,n;function o(r){l[25](r)}let a={item:l[4],kgTerm:l[5],kgRank:l[6]};return l[2]!==void 0&&(a.active=l[2]),e=new Vl({props:a}),lt.push(()=>st(e,"active",o)),{c(){he(e.$$.fragment)},m(r,u){ge(e,r,u),n=!0},p(r,u){const i={};u[0]&16&&(i.item=r[4]),u[0]&32&&(i.kgTerm=r[5]),u[0]&64&&(i.kgRank=r[6]),!t&&u[0]&4&&(t=!0,i.active=r[2],rt(()=>t=!1)),e.$set(i)},i(r){n||(U(e.$$.fragment,r),n=!0)},o(r){Y(e.$$.fragment,r),n=!1},d(r){ve(e,r)}}}function ro(l){let e,t,n;function o(r){l[26](r)}let a={document:l[0]};return l[3]!==void 0&&(a.active=l[3]),e=new Gi({props:a}),lt.push(()=>st(e,"active",o)),{c(){he(e.$$.fragment)},m(r,u){ge(e,r,u),n=!0},p(r,u){const i={};u[0]&1&&(i.document=r[0]),!t&&u[0]&8&&(t=!0,i.active=r[3],rt(()=>t=!1)),e.$set(i)},i(r){n||(U(e.$$.fragment,r),n=!0)},o(r){Y(e.$$.fragment,r),n=!1},d(r){ve(e,r)}}}function ia(l){let e,t,n,o,a,r,u,i,d,p,m,_,h=l[0].title+"",w,b,k,$,y,v,C,q,I,N,R,F,le,V,L,A,ee,K,X,x,z,Z,O,H,E,M,B,oe,D,j,W,ae=l[0].tags&&Yn(l);i=new Bl({props:{$$slots:{default:[xi]},$$scope:{ctx:l}}});const ce=[ta,ea],se=[];function ie(de,Se){return de[0].description?0:1}C=ie(l),q=se[C]=ce[C](l);let me=!l[11]&&!l[9]&&!l[10]&&Xn(l),G=l[9]&&xn(),te=l[10]&&eo(l),ue=l[11]&&l[8]&&to(l),_e=l[15],ke=[];for(let de=0;de<_e.length;de+=1)ke[de]=no(Qn(l,_e,de));let Te=l[13]&&oo(l);function Xe(de){l[24](de)}let Be={item:l[0]};l[1]!==void 0&&(Be.active=l[1]),H=new Vl({props:Be}),lt.push(()=>st(H,"active",Xe));let Ne=l[4]&&so(l),Pe=l[14]&&ro(l);return{c(){e=f("div"),t=f("article"),n=f("div"),o=f("div"),a=f("div"),ae&&ae.c(),r=g(),u=f("div"),he(i.$$.fragment),d=g(),p=f("div"),m=f("button"),_=f("h2"),w=P(h),b=g(),k=f("div"),$=f("small"),$.textContent="Description:",y=g(),v=f("div"),q.c(),I=g(),N=f("div"),me&&me.c(),R=g(),G&&G.c(),F=g(),te&&te.c(),le=g(),ue&&ue.c(),V=g(),L=f("br"),ee=g(),K=f("div"),X=f("nav"),x=f("div");for(let de=0;de<ke.length;de+=1)ke[de].c();Z=g(),Te&&Te.c(),O=g(),he(H.$$.fragment),M=g(),Ne&&Ne.c(),B=g(),Pe&&Pe.c(),oe=ut(),c(a,"class","level-right"),c(u,"class","level-right"),c(_,"class","title svelte-2smypa"),c(m,"class","svelte-2smypa"),c($,"class","description-label svelte-2smypa"),c(v,"class","description-content svelte-2smypa"),c(k,"class","description svelte-2smypa"),c(N,"class","ai-summary-section svelte-2smypa"),c(o,"class","content"),c(x,"class","level-right"),c(X,"class","level is-mobile"),c(K,"class","level-right"),c(n,"class","media-content"),c(t,"class","media"),c(e,"class","box")},m(de,Se){S(de,e,Se),s(e,t),s(t,n),s(n,o),s(o,a),ae&&ae.m(a,null),s(o,r),s(o,u),ge(i,u,null),s(o,d),s(o,p),s(p,m),s(m,_),s(_,w),s(p,b),s(p,k),s(k,$),s(k,y),s(k,v),se[C].m(v,null),s(p,I),s(p,N),me&&me.m(N,null),s(N,R),G&&G.m(N,null),s(N,F),te&&te.m(N,null),s(N,le),ue&&ue.m(N,null),s(p,V),s(p,L),s(n,ee),s(n,K),s(K,X),s(X,x);for(let Me=0;Me<ke.length;Me+=1)ke[Me]&&ke[Me].m(x,null);s(e,Z),Te&&Te.m(e,null),S(de,O,Se),ge(H,de,Se),S(de,M,Se),Ne&&Ne.m(de,Se),S(de,B,Se),Pe&&Pe.m(de,Se),S(de,oe,Se),D=!0,j||(W=re(m,"click",l[16]),j=!0)},p(de,Se){de[0].tags?ae?(ae.p(de,Se),Se[0]&1&&U(ae,1)):(ae=Yn(de),ae.c(),U(ae,1),ae.m(a,null)):ae&&(Fe(),Y(ae,1,1,()=>{ae=null}),Ke());const Me={};Se[0]&1|Se[1]&65536&&(Me.$$scope={dirty:Se,ctx:de}),i.$set(Me),(!D||Se[0]&1)&&h!==(h=de[0].title+"")&&be(w,h);let xe=C;if(C=ie(de),C===xe?se[C].p(de,Se):(Fe(),Y(se[xe],1,1,()=>{se[xe]=null}),Ke(),q=se[C],q?q.p(de,Se):(q=se[C]=ce[C](de),q.c()),U(q,1),q.m(v,null)),!de[11]&&!de[9]&&!de[10]?me?me.p(de,Se):(me=Xn(de),me.c(),me.m(N,R)):me&&(me.d(1),me=null),de[9]?G||(G=xn(),G.c(),G.m(N,F)):G&&(G.d(1),G=null),de[10]?te?te.p(de,Se):(te=eo(de),te.c(),te.m(N,le)):te&&(te.d(1),te=null),de[11]&&de[8]?ue?(ue.p(de,Se),Se[0]&2304&&U(ue,1)):(ue=to(de),ue.c(),U(ue,1),ue.m(N,null)):ue&&(Fe(),Y(ue,1,1,()=>{ue=null}),Ke()),Se[0]&32768){_e=de[15];let ye;for(ye=0;ye<_e.length;ye+=1){const ze=Qn(de,_e,ye);ke[ye]?ke[ye].p(ze,Se):(ke[ye]=no(ze),ke[ye].c(),ke[ye].m(x,null))}for(;ye<ke.length;ye+=1)ke[ye].d(1);ke.length=_e.length}de[13]?Te?Te.p(de,Se):(Te=oo(de),Te.c(),Te.m(e,null)):Te&&(Te.d(1),Te=null);const et={};Se[0]&1&&(et.item=de[0]),!E&&Se[0]&2&&(E=!0,et.active=de[1],rt(()=>E=!1)),H.$set(et),de[4]?Ne?(Ne.p(de,Se),Se[0]&16&&U(Ne,1)):(Ne=so(de),Ne.c(),U(Ne,1),Ne.m(B.parentNode,B)):Ne&&(Fe(),Y(Ne,1,1,()=>{Ne=null}),Ke()),de[14]?Pe?(Pe.p(de,Se),Se[0]&16384&&U(Pe,1)):(Pe=ro(de),Pe.c(),U(Pe,1),Pe.m(oe.parentNode,oe)):Pe&&(Fe(),Y(Pe,1,1,()=>{Pe=null}),Ke())},i(de){D||(U(ae),U(i.$$.fragment,de),U(q),U(ue),mt(()=>{D&&(A||(A=pl(p,ml,{},!0)),A.run(1))}),mt(()=>{D&&(z||(z=pl(X,ml,{},!0)),z.run(1))}),U(H.$$.fragment,de),U(Ne),U(Pe),D=!0)},o(de){Y(ae),Y(i.$$.fragment,de),Y(q),Y(ue),A||(A=pl(p,ml,{},!1)),A.run(0),z||(z=pl(X,ml,{},!1)),z.run(0),Y(H.$$.fragment,de),Y(Ne),Y(Pe),D=!1},d(de){de&&T(e),ae&&ae.d(),ve(i),se[C].d(),me&&me.d(),G&&G.d(),te&&te.d(),ue&&ue.d(),de&&A&&A.end(),tt(ke,de),de&&z&&z.end(),Te&&Te.d(),de&&T(O),ve(H,de),de&&T(M),Ne&&Ne.d(de),de&&T(B),Pe&&Pe.d(de),de&&T(oe),j=!1,W()}}}function aa(l,e,t){let n,o,a,r,u;Ue(l,At,W=>t(31,a=W)),Ue(l,ct,W=>t(32,r=W)),Ue(l,Lt,W=>t(33,u=W));let{document:i}=e,d=!1,p=!1,m=!1,_=null,h=null,w=null,b=!1,k=null,$=!1,y=null,v=!1,C=!1,q=!1,I=!1,N=null,R=!1,F=!1;function le(){const W=[];return W.push({id:"download-markdown",label:"Download to Markdown",icon:"fas fa-download",action:()=>X(),visible:!0,title:"Download document as markdown file"}),n&&W.push({id:"save-atomic",label:"Save to Atomic Server",icon:"fas fa-cloud-upload-alt",action:()=>A(),visible:!0,title:"Save article to Atomic Server",className:"has-text-primary"}),i.url&&W.push({id:"external-url",label:"Open URL",icon:"fas fa-link",action:()=>window.open(i.url,"_blank"),visible:!0,title:"Open original URL in new tab",isLink:!0,href:i.url}),W.push({id:"open-vscode",label:"Open in VSCode",icon:"fas fa-code",action:()=>x(),visible:!0,title:"Open document in VSCode",isLink:!0,href:`vscode://${encodeURIComponent(i.title)}.md?${encodeURIComponent(i.body)}`}),W.push({id:"add-context",label:I?"Added to Context ✓":q?"Adding...":"Add to Context",icon:I?"fas fa-check-circle":q?"fas fa-spinner fa-spin":"fas fa-plus-circle",action:()=>z(),visible:!0,title:I?"Document successfully added to chat context. Go to Chat tab to see it.":"Add document to LLM conversation context",disabled:q||I,className:I?"has-text-success":N?"has-text-danger":"",testId:"add-to-context-button"}),W.push({id:"chat-with-document",label:F?"Opening Chat...":R?"Adding to Chat...":"Chat with Document",icon:F?"fas fa-external-link-alt":R?"fas fa-spinner fa-spin":"fas fa-comment-dots",action:()=>Z(),visible:!0,title:F?"Opening chat with this document":"Add document to context and open chat",disabled:R||F||q,className:F?"has-text-info":N?"has-text-danger":"has-text-primary",testId:"chat-with-document-button"}),W}function V(){var ie;const W=a,ae=u;if(!(ae!=null&&ae.roles)||!W)return!1;let ce=null;try{for(const[me,G]of Object.entries(ae.roles)){const te=G,ue=typeof te.name=="object"?te.name.original:String(te.name);if(me===W||ue===W){ce=te;break}}}catch(me){return console.warn("Error checking role configuration:",me),!1}return ce?(((ie=ce.haystacks)==null?void 0:ie.filter(me=>me.service==="Atomic"&&me.location&&!me.read_only))||[]).length>0:!1}const L=()=>{t(1,d=!0)},A=()=>{console.log("🔄 Opening atomic save modal for document:",i.title),t(3,m=!0)};async function ee(W){var ae,ce,se,ie,me;t(7,b=!0),t(5,h=W),console.log("🔍 KG Search Debug Info:"),console.log("  Tag clicked:",W),console.log("  Current role:",a),console.log("  Is Tauri mode:",r);try{if(r){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:a,term:W});const G=await je("find_documents_for_kg_term",{roleName:a,term:W});console.log("  📥 Tauri response received:"),console.log("    Status:",G.status),console.log("    Results count:",((ae=G.results)==null?void 0:ae.length)||0),console.log("    Total:",G.total||0),console.log("    Full response:",JSON.stringify(G,null,2)),G.status==="success"&&G.results&&G.results.length>0?(t(4,_=G.results[0]),t(6,w=_.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",_.title),console.log("    Rank:",w),console.log("    Body length:",((ce=_.body)==null?void 0:ce.length)||0,"characters"),t(2,p=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${W}" in role: "${a}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const G=Qe.ServerURL,te=encodeURIComponent(a),ue=encodeURIComponent(W),_e=`${G}/roles/${te}/kg_search?term=${ue}`;console.log("  📤 HTTP Request details:"),console.log("    Base URL:",G),console.log("    Role (encoded):",te),console.log("    Term (encoded):",ue),console.log("    Full URL:",_e);const ke=await fetch(_e);if(console.log("  📥 HTTP Response received:"),console.log("    Status code:",ke.status),console.log("    Status text:",ke.statusText),console.log("    Headers:",Object.fromEntries(ke.headers.entries())),!ke.ok)throw new Error(`HTTP error! Status: ${ke.status} - ${ke.statusText}`);const Te=await ke.json();console.log("  📄 Response data:"),console.log("    Status:",Te.status),console.log("    Results count:",((se=Te.results)==null?void 0:se.length)||0),console.log("    Total:",Te.total||0),console.log("    Full response:",JSON.stringify(Te,null,2)),Te.status==="success"&&Te.results&&Te.results.length>0?(t(4,_=Te.results[0]),t(6,w=_.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",_.title),console.log("    Rank:",w),console.log("    Body length:",((ie=_.body)==null?void 0:ie.length)||0,"characters"),t(2,p=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${W}" in role: "${a}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",_e))}}catch(G){console.error("❌ Error fetching KG document:"),console.error("  Error type:",G.constructor.name),console.error("  Error message:",G.message||G),console.error("  Request details:",{tag:W,role:a,isTauri:r,timestamp:new Date().toISOString()}),!r&&((me=G.message)!=null&&me.includes("Failed to fetch"))&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{t(7,b=!1)}}async function K(){var W;if(!($||!i.id||!a)){t(9,$=!0),t(10,y=null),console.log("🤖 AI Summary Debug Info:"),console.log("  Document ID:",i.id),console.log("  Current role:",a),console.log("  Is Tauri mode:",r);try{const ae={document_id:i.id,role:a,max_length:250,force_regenerate:!1};console.log("  📤 Summarization request:",ae);let ce;if(r){const me=`${Qe.ServerURL}/documents/summarize`;ce=await fetch(me,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ae)})}else{const me=`${Qe.ServerURL}/documents/summarize`;ce=await fetch(me,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ae)})}if(console.log("  📥 Summary response received:"),console.log("    Status code:",ce.status),console.log("    Status text:",ce.statusText),!ce.ok)throw new Error(`HTTP error! Status: ${ce.status} - ${ce.statusText}`);const se=await ce.json();console.log("  📄 Summary response data:",se),se.status==="success"&&se.summary?(t(8,k=se.summary),t(12,C=se.from_cache||!1),t(11,v=!0),console.log("  ✅ Summary generated successfully"),console.log("    Summary length:",k.length,"characters"),console.log("    From cache:",C),console.log("    Model used:",se.model_used)):(t(10,y=se.error||"Failed to generate summary"),console.error("  ❌ Summary generation failed:",y))}catch(ae){console.error("❌ Error generating summary:"),console.error("  Error type:",ae.constructor.name),console.error("  Error message:",ae.message||ae),console.error("  Request details:",{document_id:i.id,role:a,isTauri:r,timestamp:new Date().toISOString()}),t(10,y=ae.message||"Network error occurred"),(W=ae.message)!=null&&W.includes("Failed to fetch")&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Verify OpenRouter is enabled for this role"),console.error("    3. Check OPENROUTER_KEY environment variable"),console.error("    4. Verify server URL in CONFIG.ServerURL"))}finally{t(9,$=!1)}}}function X(){console.log("📥 Downloading document as markdown:",i.title);let W=`# ${i.title}

`;W+=`**Source:** Terraphim Search
`,W+=`**Rank:** ${i.rank||"N/A"}
`,i.url&&(W+=`**URL:** ${i.url}
`),i.tags&&i.tags.length>0&&(W+=`**Tags:** ${i.tags.join(", ")}
`),W+=`**Downloaded:** ${new Date().toISOString()}

`,i.description&&(W+=`## Description

${i.description}

`),W+=`## Content

${i.body}
`;const ae=`${i.title.replace(/[^a-z0-9]/gi,"_").toLowerCase()}_${Date.now()}.md`,ce=new Blob([W],{type:"text/markdown"}),se=URL.createObjectURL(ce),ie=window.document.createElement("a");ie.href=se,ie.download=ae,window.document.body.appendChild(ie),ie.click(),window.document.body.removeChild(ie),URL.revokeObjectURL(se),console.log("✅ Markdown file downloaded:",ae)}function x(){const W=`vscode://${encodeURIComponent(i.title)}.md?${encodeURIComponent(i.body)}`;window.open(W,"_blank")}async function z(){console.log("📝 Adding document to LLM context:",i.title),q=!0,I=!1,t(13,N=null);try{let W=null;if(r){try{const ie=await je("list_conversations");if(console.log("📋 Available conversations:",ie),ie!=null&&ie.conversations&&ie.conversations.length>0)W=ie.conversations[0].id,console.log("🎯 Using existing conversation:",W);else{const me=await je("create_conversation",{title:"Search Context",role:a||"default"});if(me.status==="success"&&me.conversation_id)W=me.conversation_id,console.log("🆕 Created new conversation:",W);else throw new Error("Failed to create conversation: "+(me.error||"Unknown error"))}}catch(ie){throw console.error("❌ Failed to manage conversations:",ie),new Error("Could not create or find conversation: "+ie.message)}const ce={source_type:"document",document_id:i.id};i.url&&(ce.url=i.url),i.tags&&i.tags.length>0&&(ce.tags=i.tags.join(", ")),i.rank!==void 0&&(ce.rank=i.rank.toString());const se=await je("add_context_to_conversation",{conversationId:W,contextType:"document",title:i.title,content:i.body,metadata:ce});console.log("✅ Document added to context via Tauri:",se)}else{const ce=Qe.ServerURL;try{const G=await fetch(`${ce}/conversations`);if(G.ok){const te=await G.json();if(te.conversations&&te.conversations.length>0)W=te.conversations[0].id,console.log("🎯 Using existing conversation:",W);else{const ue=await fetch(`${ce}/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"Search Context",role:a||"default"})});if(ue.ok){const _e=await ue.json();if(_e.status==="success"&&_e.conversation_id)W=_e.conversation_id,console.log("🆕 Created new conversation:",W);else throw new Error("Failed to create conversation: "+(_e.error||"Unknown error"))}else throw new Error(`Failed to create conversation: ${ue.status} ${ue.statusText}`)}}else throw new Error(`Failed to list conversations: ${G.status} ${G.statusText}`)}catch(G){throw console.error("❌ Failed to manage conversations:",G),new Error("Could not create or find conversation: "+G.message)}const se=`${ce}/conversations/${W}/context`,ie=await fetch(se,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context_type:"document",title:i.title,content:i.body,metadata:{source_type:"document",document_id:i.id,url:i.url||"",tags:i.tags?i.tags.join(", "):"",rank:i.rank?i.rank.toString():"0"}})});if(!ie.ok)throw new Error(`HTTP error! Status: ${ie.status} - ${ie.statusText}`);const me=await ie.json();console.log("✅ Document added to context via HTTP:",me)}console.log("✅ Successfully added document to LLM context"),I=!0;const ae=window.document.createElement("div");ae.className="notification is-success is-light",ae.innerHTML=`
        <button class="delete" onclick="this.parentElement.remove()"></button>
        <strong>✓ Added to Chat Context</strong><br>
        <small>Document added successfully. <a href="/chat" class="has-text-success has-text-weight-bold">Go to Chat →</a> to see it in the context panel.</small>
      `,ae.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(ae),setTimeout(()=>{ae.remove()},8e3),setTimeout(()=>{I=!1},5e3)}catch(W){console.error("❌ Error adding document to context:",W),t(13,N=W.message||"Failed to add document to context");const ae=window.document.createElement("div");ae.className="notification is-danger is-light",ae.innerHTML=`
        <button class="delete" onclick="this.parentElement.remove()"></button>
        <strong>✗ Failed to Add Context</strong><br>
        <small>${N}</small>
      `,ae.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(ae),setTimeout(()=>{ae.remove()},8e3),setTimeout(()=>{t(13,N=null)},5e3)}finally{q=!1}}async function Z(){console.log("💬 Adding document to context and opening chat:",i.title),R=!0,F=!1,t(13,N=null);try{let W=null;if(r){try{const ie=await je("list_conversations");if(console.log("📋 Available conversations:",ie),ie!=null&&ie.conversations&&ie.conversations.length>0)W=ie.conversations[0].id,console.log("🎯 Using existing conversation:",W);else{const me=await je("create_conversation",{title:"Chat with Documents",role:a||"default"});if(me.status==="success"&&me.conversation_id)W=me.conversation_id,console.log("🆕 Created new conversation:",W);else throw new Error("Failed to create conversation: "+(me.error||"Unknown error"))}}catch(ie){throw console.error("❌ Failed to manage conversations:",ie),new Error("Could not create or find conversation: "+ie.message)}const ce={source_type:"document",document_id:i.id};i.url&&(ce.url=i.url),i.tags&&i.tags.length>0&&(ce.tags=i.tags.join(", ")),i.rank!==void 0&&(ce.rank=i.rank.toString());const se=await je("add_context_to_conversation",{conversationId:W,contextType:"document",title:i.title,content:i.body,metadata:ce});console.log("✅ Document added to context via Tauri:",se)}else{const ce=Qe.ServerURL;try{const G=await fetch(`${ce}/conversations`);if(G.ok){const te=await G.json();if(te.conversations&&te.conversations.length>0)W=te.conversations[0].id,console.log("🎯 Using existing conversation:",W);else{const ue=await fetch(`${ce}/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"Chat with Documents",role:a||"default"})});if(ue.ok){const _e=await ue.json();if(_e.status==="success"&&_e.conversation_id)W=_e.conversation_id,console.log("🆕 Created new conversation:",W);else throw new Error("Failed to create conversation: "+(_e.error||"Unknown error"))}else throw new Error(`Failed to create conversation: ${ue.status} ${ue.statusText}`)}}else throw new Error(`Failed to list conversations: ${G.status} ${G.statusText}`)}catch(G){throw console.error("❌ Failed to manage conversations:",G),new Error("Could not create or find conversation: "+G.message)}const se=`${ce}/conversations/${W}/context`,ie=await fetch(se,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context_type:"document",title:i.title,content:i.body,metadata:{source_type:"document",document_id:i.id,url:i.url||"",tags:i.tags?i.tags.join(", "):"",rank:i.rank?i.rank.toString():"0"}})});if(!ie.ok)throw new Error(`HTTP error! Status: ${ie.status} - ${ie.statusText}`);const me=await ie.json();console.log("✅ Document added to context via HTTP:",me)}console.log("✅ Successfully added document to chat context, navigating to chat..."),F=!0;const ae=window.document.createElement("div");ae.className="notification is-success is-light",ae.innerHTML=`
        <strong>💬 Opening Chat with Document</strong><br>
        <small>Context added successfully. Redirecting to chat...</small>
      `,ae.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(ae),setTimeout(()=>{ae.remove(),_r.goto("/chat")},1500),setTimeout(()=>{F=!1},2e3)}catch(W){console.error("❌ Error adding document to context and opening chat:",W),t(13,N=W.message||"Failed to add document to context");const ae=window.document.createElement("div");ae.className="notification is-danger is-light",ae.innerHTML=`
        <button class="delete" onclick="this.parentElement.remove()"></button>
        <strong>✗ Failed to Open Chat with Document</strong><br>
        <small>${N}</small>
      `,ae.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(ae),setTimeout(()=>{ae.remove()},8e3),setTimeout(()=>{t(13,N=null)},5e3)}finally{R=!1}}Ml[a]!==void 0&&(console.log("Have attribute",Ml[a]),Ml[a].hasOwnProperty("enableLogseq")?console.log("enable logseq True"):console.log("Didn't make it"));const O=W=>ee(W),H=()=>{t(10,y=null),K()},E=()=>t(11,v=!1),M=()=>{K()},B=()=>t(13,N=null);function oe(W){d=W,t(1,d)}function D(W){p=W,t(2,p)}function j(W){m=W,t(3,m)}return l.$$set=W=>{"document"in W&&t(0,i=W.document)},t(14,n=V()),t(15,o=le()),[i,d,p,m,_,h,w,b,k,$,y,v,C,N,n,o,L,ee,K,O,H,E,M,B,oe,D,j]}class ca extends _t{constructor(e){super(),ht(this,e,aa,ia,pt,{document:0},null,[-1,-1])}}const ua="/assets/terraphim_gray.png";function vl(l){const e=l.trim();if(!e)return{hasOperator:!1,operator:null,terms:[l],originalQuery:l};const t=/\b(AND)\b/,n=/\b(OR)\b/,o=/\b(and)\b/i,a=/\b(or)\b/i,r=t.test(e),u=n.test(e),i=o.test(e)&&!r,d=a.test(e)&&!u;if(r&&!u)return{hasOperator:!0,operator:"AND",terms:e.split(t).filter((m,_)=>_%2===0).map(m=>m.trim()).filter(m=>m.length>0),originalQuery:l};if(u&&!r)return{hasOperator:!0,operator:"OR",terms:e.split(n).filter((m,_)=>_%2===0).map(m=>m.trim()).filter(m=>m.length>0),originalQuery:l};if(r&&u){const p=e.indexOf(" AND "),m=e.indexOf(" OR ");if(p!==-1&&(m===-1||p<m))return{hasOperator:!0,operator:"AND",terms:e.split(/\s+(?:AND|OR)\s+/i).map(h=>h.trim()).filter(h=>h.length>0),originalQuery:l};if(m!==-1)return{hasOperator:!0,operator:"OR",terms:e.split(/\s+(?:AND|OR)\s+/i).map(h=>h.trim()).filter(h=>h.length>0),originalQuery:l}}if(i&&!d)return{hasOperator:!0,operator:"AND",terms:e.split(o).filter((m,_)=>_%2===0).map(m=>m.trim()).filter(m=>m.length>0),originalQuery:l};if(d&&!i)return{hasOperator:!0,operator:"OR",terms:e.split(a).filter((m,_)=>_%2===0).map(m=>m.trim()).filter(m=>m.length>0),originalQuery:l};if(i&&d){const p=e.toLowerCase().indexOf(" and "),m=e.toLowerCase().indexOf(" or ");if(p!==-1&&(m===-1||p<m))return{hasOperator:!0,operator:"AND",terms:e.split(/\s+(?:and|or)\s+/i).map(h=>h.trim()).filter(h=>h.length>0),originalQuery:l};if(m!==-1)return{hasOperator:!0,operator:"OR",terms:e.split(/\s+(?:and|or)\s+/i).map(h=>h.trim()).filter(h=>h.length>0),originalQuery:l}}return{hasOperator:!1,operator:null,terms:[e],originalQuery:l}}function io(l,e){var n,o;if(l.hasOperator&&l.terms.length>1){const a=l.terms.filter(r=>r.trim().length>0);if(a.length>1)return{search_term:a[0],search_terms:a,operator:(n=l.operator)==null?void 0:n.toLowerCase(),skip:0,limit:50,role:e||null}}return{search_term:((o=l.terms[0])==null?void 0:o.trim())||"",search_terms:void 0,operator:void 0,skip:0,limit:50,role:e||null}}function ao(l,e,t){const n=l.slice();return n[39]=e[t],n}function co(l,e,t){const n=l.slice();return n[42]=e[t],n[44]=t,n}function uo(l,e,t){const n=l.slice();return n[45]=e[t],n[44]=t,n}function fo(l){let e,t=l[3],n=[];for(let o=0;o<t.length;o+=1)n[o]=po(uo(l,t,o));return{c(){e=f("ul");for(let o=0;o<n.length;o+=1)n[o].c();c(e,"class","suggestions svelte-1pq1n28")},m(o,a){S(o,e,a);for(let r=0;r<n.length;r+=1)n[r]&&n[r].m(e,null)},p(o,a){if(a[0]&8216){t=o[3];let r;for(r=0;r<t.length;r+=1){const u=uo(o,t,r);n[r]?n[r].p(u,a):(n[r]=po(u),n[r].c(),n[r].m(e,null))}for(;r<n.length;r+=1)n[r].d(1);n.length=t.length}},d(o){o&&T(e),tt(n,o)}}}function po(l){let e,t=l[45]+"",n,o,a,r,u,i;function d(){return l[20](l[45])}function p(...m){return l[21](l[45],...m)}return{c(){e=f("li"),n=P(t),o=g(),c(e,"tabindex","0"),c(e,"role","option"),c(e,"aria-selected",a=l[44]===l[4]),c(e,"aria-label",r=`Apply suggestion: ${l[45]}`),c(e,"class","svelte-1pq1n28"),dt(e,"active",l[44]===l[4])},m(m,_){S(m,e,_),s(e,n),s(e,o),u||(i=[re(e,"click",d),re(e,"keydown",p)],u=!0)},p(m,_){l=m,_[0]&8&&t!==(t=l[45]+"")&&be(n,t),_[0]&16&&a!==(a=l[44]===l[4])&&c(e,"aria-selected",a),_[0]&8&&r!==(r=`Apply suggestion: ${l[45]}`)&&c(e,"aria-label",r),_[0]&16&&dt(e,"active",l[44]===l[4])},d(m){m&&T(e),u=!1,Ve(i)}}}function mo(l){let e,t,n,o,a,r,u;return t=new Bl({props:{$$slots:{default:[pa]},$$scope:{ctx:l}}}),{c(){e=f("div"),he(t.$$.fragment),n=g(),o=f("button"),o.textContent="Clear all",c(o,"type","button"),c(o,"class","clear-terms-btn svelte-1pq1n28"),c(e,"class","selected-terms-section svelte-1pq1n28")},m(i,d){S(i,e,d),ge(t,e,null),s(e,n),s(e,o),a=!0,r||(u=re(o,"click",l[15]),r=!0)},p(i,d){const p={};d[0]&192|d[1]&65536&&(p.$$scope={dirty:d,ctx:i}),t.$set(p)},i(i){a||(U(t.$$.fragment,i),a=!0)},o(i){Y(t.$$.fragment,i),a=!1},d(i){i&&T(e),ve(t),r=!1,u()}}}function fa(l){let e=l[42].value+"",t,n,o,a,r,u,i;function d(){return l[22](l[42])}return{c(){t=P(e),n=g(),o=f("button"),a=P("×"),c(o,"class","remove-tag-btn svelte-1pq1n28"),c(o,"aria-label",r=`Remove term: ${l[42].value}`)},m(p,m){S(p,t,m),S(p,n,m),S(p,o,m),s(o,a),u||(i=re(o,"click",fr(d)),u=!0)},p(p,m){l=p,m[0]&64&&e!==(e=l[42].value+"")&&be(t,e),m[0]&64&&r!==(r=`Remove term: ${l[42].value}`)&&c(o,"aria-label",r)},d(p){p&&T(t),p&&T(n),p&&T(o),u=!1,i()}}}function _o(l){let e,t,n,o;return t=new qt({props:{class:"operator-tag",rounded:!0,$$slots:{default:[da]},$$scope:{ctx:l}}}),{c(){e=f("div"),he(t.$$.fragment),n=g(),c(e,"class","operator-tag-wrapper svelte-1pq1n28")},m(a,r){S(a,e,r),ge(t,e,null),s(e,n),o=!0},p(a,r){const u={};r[0]&128|r[1]&65536&&(u.$$scope={dirty:r,ctx:a}),t.$set(u)},i(a){o||(U(t.$$.fragment,a),o=!0)},o(a){Y(t.$$.fragment,a),o=!1},d(a){a&&T(e),ve(t)}}}function da(l){let e=(l[7]||"AND")+"",t;return{c(){t=P(e)},m(n,o){S(n,t,o)},p(n,o){o[0]&128&&e!==(e=(n[7]||"AND")+"")&&be(t,e)},d(n){n&&T(t)}}}function ho(l){let e,t,n,o,a;function r(){return l[23](l[42])}t=new qt({props:{rounded:!0,title:"Click to remove term",$$slots:{default:[fa]},$$scope:{ctx:l}}}),t.$on("click",r);let u=l[44]<l[6].length-1&&_o(l);return{c(){e=f("div"),he(t.$$.fragment),n=g(),u&&u.c(),o=ut(),c(e,"class","term-tag-wrapper svelte-1pq1n28"),dt(e,"from-kg",l[42].isFromKG)},m(i,d){S(i,e,d),ge(t,e,null),S(i,n,d),u&&u.m(i,d),S(i,o,d),a=!0},p(i,d){l=i;const p={};d[0]&64|d[1]&65536&&(p.$$scope={dirty:d,ctx:l}),t.$set(p),(!a||d[0]&64)&&dt(e,"from-kg",l[42].isFromKG),l[44]<l[6].length-1?u?(u.p(l,d),d[0]&64&&U(u,1)):(u=_o(l),u.c(),U(u,1),u.m(o.parentNode,o)):u&&(Fe(),Y(u,1,1,()=>{u=null}),Ke())},i(i){a||(U(t.$$.fragment,i),U(u),a=!0)},o(i){Y(t.$$.fragment,i),Y(u),a=!1},d(i){i&&T(e),ve(t),i&&T(n),u&&u.d(i),i&&T(o)}}}function pa(l){let e,t,n=l[6],o=[];for(let r=0;r<n.length;r+=1)o[r]=ho(co(l,n,r));const a=r=>Y(o[r],1,1,()=>{o[r]=null});return{c(){for(let r=0;r<o.length;r+=1)o[r].c();e=ut()},m(r,u){for(let i=0;i<o.length;i+=1)o[i]&&o[i].m(r,u);S(r,e,u),t=!0},p(r,u){if(u[0]&16576){n=r[6];let i;for(i=0;i<n.length;i+=1){const d=co(r,n,i);o[i]?(o[i].p(d,u),U(o[i],1)):(o[i]=ho(d),o[i].c(),U(o[i],1),o[i].m(e.parentNode,e))}for(Fe(),i=n.length;i<o.length;i+=1)a(i);Ke()}},i(r){if(!t){for(let u=0;u<n.length;u+=1)U(o[u]);t=!0}},o(r){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)Y(o[u]);t=!1},d(r){tt(o,r),r&&T(e)}}}function go(l){let e,t,n;return{c(){e=f("button"),e.textContent="Parse Terms",c(e,"type","button"),c(e,"class","button is-small is-info")},m(o,a){S(o,e,a),t||(n=re(e,"click",l[28]),t=!0)},p:Re,d(o){o&&T(e),t=!1,n()}}}function ma(l){let e,t,n,o,a,r,u,i,d,p,m,_,h,w,b,k,$,y,v,C,q,I=l[0]&&(l[0].includes(" AND ")||l[0].includes(" OR "))&&l[6].length===0,N,R,F,le;function V(X){l[19](X)}let L={type:"search",placeholder:l[9]?`Search over Knowledge graph for ${l[8]}`:"Search",icon:"search",expanded:!0,autofocus:!0};l[0]!==void 0&&(L.value=l[0]),n=new Qt({props:L}),lt.push(()=>st(n,"value",V)),n.$on("click",l[16]),n.$on("submit",l[16]),n.$on("keydown",l[12]),n.$on("input",l[11]);let A=l[3].length>0&&fo(l),ee=l[6].length>0&&mo(l),K=I&&go(l);return R=qs(l[25][0]),{c(){e=f("div"),t=f("div"),he(n.$$.fragment),a=g(),A&&A.c(),r=g(),ee&&ee.c(),u=g(),i=f("div"),d=f("div"),p=f("label"),m=f("input"),_=P(`
            Exact`),h=g(),w=f("label"),b=f("input"),k=P(`
            All (AND)`),$=g(),y=f("label"),v=f("input"),C=P(`
            Any (OR)`),q=g(),K&&K.c(),c(t,"class","input-wrapper svelte-1pq1n28"),c(m,"type","radio"),m.__value="none",m.value=m.__value,c(m,"class","svelte-1pq1n28"),c(p,"class","radio svelte-1pq1n28"),c(b,"type","radio"),b.__value="and",b.value=b.__value,c(b,"class","svelte-1pq1n28"),c(w,"class","radio svelte-1pq1n28"),c(v,"type","radio"),v.__value="or",v.value=v.__value,c(v,"class","svelte-1pq1n28"),c(y,"class","radio svelte-1pq1n28"),c(d,"class","control svelte-1pq1n28"),c(i,"class","operator-controls svelte-1pq1n28"),c(e,"class","search-row svelte-1pq1n28"),R.p(m,b,v)},m(X,x){S(X,e,x),s(e,t),ge(n,t,null),s(t,a),A&&A.m(t,null),s(e,r),ee&&ee.m(e,null),s(e,u),s(e,i),s(i,d),s(d,p),s(p,m),m.checked=m.__value===l[5],s(p,_),s(d,h),s(d,w),s(w,b),b.checked=b.__value===l[5],s(w,k),s(d,$),s(d,y),s(y,v),v.checked=v.__value===l[5],s(y,C),s(i,q),K&&K.m(i,null),N=!0,F||(le=[re(m,"change",l[24]),re(b,"change",l[26]),re(v,"change",l[27])],F=!0)},p(X,x){const z={};x[0]&768&&(z.placeholder=X[9]?`Search over Knowledge graph for ${X[8]}`:"Search"),!o&&x[0]&1&&(o=!0,z.value=X[0],rt(()=>o=!1)),n.$set(z),X[3].length>0?A?A.p(X,x):(A=fo(X),A.c(),A.m(t,null)):A&&(A.d(1),A=null),X[6].length>0?ee?(ee.p(X,x),x[0]&64&&U(ee,1)):(ee=mo(X),ee.c(),U(ee,1),ee.m(e,u)):ee&&(Fe(),Y(ee,1,1,()=>{ee=null}),Ke()),x[0]&32&&(m.checked=m.__value===X[5]),x[0]&32&&(b.checked=b.__value===X[5]),x[0]&32&&(v.checked=v.__value===X[5]),x[0]&65&&(I=X[0]&&(X[0].includes(" AND ")||X[0].includes(" OR "))&&X[6].length===0),I?K?K.p(X,x):(K=go(X),K.c(),K.m(i,null)):K&&(K.d(1),K=null)},i(X){N||(U(n.$$.fragment,X),U(ee),N=!0)},o(X){Y(n.$$.fragment,X),Y(ee),N=!1},d(X){X&&T(e),ve(n),A&&A.d(),ee&&ee.d(),K&&K.d(),R.r(),F=!1,Ve(le)}}}function _a(l){let e,t,n,o,a,r,u,i,d,p;return{c(){e=f("section"),t=f("div"),n=f("img"),a=g(),r=f("p"),r.textContent="I am Terraphim, your personal assistant.",u=g(),i=f("button"),i.innerHTML=`<span class="icon"><i class="fas fa-magic"></i></span> 
        <span>Configuration Wizard</span>`,ur(n.src,o=ua)||c(n,"src",o),c(n,"alt","Terraphim Logo"),c(n,"class","svelte-1pq1n28"),c(i,"class","button is-primary"),c(i,"data-testid","wizard-start"),c(t,"class","content has-text-grey has-text-centered svelte-1pq1n28"),c(e,"class","section")},m(m,_){S(m,e,_),s(e,t),s(t,n),s(t,a),s(t,r),s(t,u),s(t,i),d||(p=re(i,"click",l[29]),d=!0)},p:Re,i:Re,o:Re,d(m){m&&T(e),d=!1,p()}}}function ha(l){let e,t,n=l[1],o=[];for(let r=0;r<n.length;r+=1)o[r]=vo(ao(l,n,r));const a=r=>Y(o[r],1,1,()=>{o[r]=null});return{c(){for(let r=0;r<o.length;r+=1)o[r].c();e=ut()},m(r,u){for(let i=0;i<o.length;i+=1)o[i]&&o[i].m(r,u);S(r,e,u),t=!0},p(r,u){if(u[0]&2){n=r[1];let i;for(i=0;i<n.length;i+=1){const d=ao(r,n,i);o[i]?(o[i].p(d,u),U(o[i],1)):(o[i]=vo(d),o[i].c(),U(o[i],1),o[i].m(e.parentNode,e))}for(Fe(),i=n.length;i<o.length;i+=1)a(i);Ke()}},i(r){if(!t){for(let u=0;u<n.length;u+=1)U(o[u]);t=!0}},o(r){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)Y(o[u]);t=!1},d(r){tt(o,r),r&&T(e)}}}function ga(l){let e,t;return{c(){e=f("p"),t=P(l[2]),c(e,"class","error svelte-1pq1n28")},m(n,o){S(n,e,o),s(e,t)},p(n,o){o[0]&4&&be(t,n[2])},i:Re,o:Re,d(n){n&&T(e)}}}function vo(l){let e,t;return e=new ca({props:{document:l[39]}}),{c(){he(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},p(n,o){const a={};o[0]&2&&(a.document=n[39]),e.$set(a)},i(n){t||(U(e.$$.fragment,n),t=!0)},o(n){Y(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function va(l){let e,t,n,o,a,r,u,i,d,p,m;e=new _l({props:{fallbackPath:"/"}}),o=new Ft({props:{$$slots:{default:[ma]},$$scope:{ctx:l}}});const _=[ga,ha,_a],h=[];function w(b,k){return b[2]?0:b[1].length?1:2}return r=w(l),u=h[r]=_[r](l),{c(){he(e.$$.fragment),t=g(),n=f("form"),he(o.$$.fragment),a=g(),u.c(),i=ut()},m(b,k){ge(e,b,k),S(b,t,k),S(b,n,k),ge(o,n,null),S(b,a,k),h[r].m(b,k),S(b,i,k),d=!0,p||(m=re(n,"submit",cr(l[16])),p=!0)},p(b,k){const $={};k[0]&1017|k[1]&65536&&($.$$scope={dirty:k,ctx:b}),o.$set($);let y=r;r=w(b),r===y?h[r].p(b,k):(Fe(),Y(h[y],1,1,()=>{h[y]=null}),Ke(),u=h[r],u?u.p(b,k):(u=h[r]=_[r](b),u.c()),U(u,1),u.m(i.parentNode,i))},i(b){d||(U(e.$$.fragment,b),U(o.$$.fragment,b),U(u),d=!0)},o(b){Y(e.$$.fragment,b),Y(o.$$.fragment,b),Y(u),d=!1},d(b){ve(e,b),b&&T(t),b&&T(n),ve(o),b&&T(a),h[r].d(b),b&&T(i),p=!1,m()}}}function ba(l,e,t){let n,o,a,r,u,i,d;Ue(l,jr,D=>t(31,o=D)),Ue(l,Bt,D=>t(0,a=D)),Ue(l,ct,D=>t(32,r=D)),Ue(l,At,D=>t(8,u=D)),Ue(l,bl,D=>t(18,i=D)),Ue(l,Tt,D=>t(9,d=D));let p=[],m=null,_=[],h=-1,w="none",b=[],k=null,$=!1;function y(D){const j=vl(D);if(j.hasOperator&&j.terms.length>1){const W=j.terms.map(se=>{const ie=n.some(([me])=>me.toLowerCase()===se.toLowerCase());return{value:se,isFromKG:ie}}),ae=b.map(se=>se.value),ce=W.map(se=>se.value);(JSON.stringify(ae)!==JSON.stringify(ce)||k!==j.operator)&&(t(6,b=W),t(7,k=j.operator))}else j.terms.length===1&&b.length>0?(t(6,b=[]),t(7,k=null)):j.terms.length===0&&(t(6,b=[]),t(7,k=null))}async function v(D){try{if(r){const j=await je("get_autocomplete_suggestions",{query:D,roleName:u,limit:8});if(j.status==="success"&&j.suggestions)return j.suggestions.map(W=>W.term)}else{const j=await fetch(`${o.replace("/documents/search","")}/autocomplete/${encodeURIComponent(u)}/${encodeURIComponent(D)}`);if(j.ok){const W=await j.json();if(W.status==="success"&&W.suggestions)return W.suggestions.map(ae=>ae.term)}}return n.filter(([j])=>j.toLowerCase().includes(D.toLowerCase())).map(([j])=>j).slice(0,8)}catch(j){return console.warn("Error fetching term suggestions:",j),[]}}async function C(D){const j=D.trim();if(j.length===0)return[];const ae=vl(j),ce=j.split(/\s+/),se=ce[ce.length-1].toLowerCase();if(w!=="none")return se.length<2?[]:v(se);if(ae.hasOperator&&ae.terms.length>0){const me=ae.terms[ae.terms.length-1];return me&&me.length>=2?v(me):[]}if(ce.length>1&&w==="none"){const me=[];if("and".startsWith(se)&&me.push("AND"),"or".startsWith(se)&&me.push("OR"),me.length>0)return me}const ie=j.toLowerCase();if(ie.includes(" and ")||ie.includes(" or ")||ie.includes(" AND ")||ie.includes(" OR ")){const me=se;return me.length<2?[]:v(me)}try{const me=await v(j);return ce.length===1&&ce[0].length>2&&w==="none"?[...me.slice(0,5),"AND","OR"]:me}catch(me){console.warn("Error fetching autocomplete suggestions:",me);const G=n.filter(([te])=>te.toLowerCase().includes(j.toLowerCase())).map(([te])=>te).slice(0,5);return ce.length===1&&ce[0].length>2&&w==="none"?[...G,"AND","OR"]:G}}async function q(D){const j=D.target;if(!j||j.selectionStart==null)return;const W=j.selectionStart,ae=a.slice(0,W),ce=ae.split(/\s+/),se=ce[ce.length-1];if(se.toLowerCase()==="a"||se.toLowerCase()==="an")t(3,_=["AND"]);else if(se.toLowerCase()==="o"||se.toLowerCase()==="or")t(3,_=["OR"]);else if(se.length>=2)try{const ie=await C(se);ce.length>1&&!ae.includes(" AND ")&&!ae.includes(" OR ")?t(3,_=[...ie,"AND","OR"]):t(3,_=ie)}catch(ie){console.warn("Failed to get suggestions:",ie),t(3,_=[])}else t(3,_=[]);t(4,h=-1)}function I(D){_.length>0?D.key==="ArrowDown"?(D.preventDefault(),t(4,h=(h+1)%_.length)):D.key==="ArrowUp"?(D.preventDefault(),t(4,h=(h-1+_.length)%_.length)):(D.key==="Enter"||D.key==="Tab")&&h!==-1?(D.preventDefault(),R(_[h])):D.key==="Escape"&&(D.preventDefault(),t(3,_=[]),t(4,h=-1)):D.key==="Enter"&&(D.preventDefault(),N())}function N(){y(a),ee()}function R(D){if(D==="AND"||D==="OR"){t(7,k=D);const j=vl(a);j.terms.length>0&&!b.some(W=>W.value===j.terms[j.terms.length-1])&&le(j.terms[j.terms.length-1]),Ht(Bt,a=a+` ${D} `,a)}else{const j=a.trim().split(/\s+/),W=j[j.length-1];D.toLowerCase().startsWith(W.toLowerCase())?(j[j.length-1]=D,Ht(Bt,a=j.join(" "),a),y(a)):le(D,k)}t(3,_=[]),t(4,h=-1)}function F(){const D=a.trim();if(!D)return null;if(w!=="none"){const ae=vl(D),ce=ae.hasOperator?ae.terms:D.split(/\s+/).filter(se=>se.length>0);return ce.length>1?{...io({hasOperator:!0,operator:w==="and"?"AND":"OR",terms:ce,originalQuery:D},u),skip:0,limit:10}:{search_term:D,skip:0,limit:10,role:u}}const j=vl(D);return{...io(j,u),skip:0,limit:10}}function le(D,j=null){const W=n.some(([ae])=>ae.toLowerCase()===D.toLowerCase());b.some(ae=>ae.value.toLowerCase()===D.toLowerCase())||(t(6,b=[...b,{value:D,isFromKG:W}]),j&&b.length>1&&t(7,k=j),L())}function V(D){t(6,b=b.filter(j=>j.value!==D)),L()}function L(){if(t(17,$=!0),b.length===0)Ht(Bt,a="",a),t(7,k=null);else if(b.length===1)Ht(Bt,a=b[0].value,a),t(7,k=null);else{const D=k||"AND";Ht(Bt,a=b.map(j=>j.value).join(` ${D} `),a)}setTimeout(()=>{t(17,$=!1)},10)}function A(){t(6,b=[]),t(7,k=null),Ht(Bt,a="",a)}async function ee(){if(t(2,m=null),r){if(!a.trim())return;try{const D=F();if(!D)return;const j=await je("search",{searchQuery:D});j.status==="success"?(t(1,p=j.results),console.log("Response results"),console.log(p)):(t(2,m=`Search failed: ${j.status}`),console.error("Search failed:",j))}catch(D){t(2,m=`Error in Tauri search: ${D}`),console.error("Error in Tauri search:",D)}}else{if(!a.trim())return;const D=F();if(!D)return;const j=JSON.stringify(D);try{const W=await fetch(o,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:j}),ae=await W.json();if(!W.ok)throw new Error(`HTTP error! Status: ${W.status}`);t(1,p=ae.results)}catch(W){console.error("Error fetching data:",W),t(2,m=`Error fetching data: ${W}`)}}}const K=[[]];function X(D){a=D,Bt.set(a)}const x=D=>R(D),z=(D,j)=>{(j.key==="Enter"||j.key===" ")&&(j.preventDefault(),R(D))},Z=D=>V(D.value),O=D=>V(D.value);function H(){w=this.__value,t(5,w)}function E(){w=this.__value,t(5,w)}function M(){w=this.__value,t(5,w)}const B=()=>y(a),oe=()=>window.location.href="/config/wizard";return l.$$.update=()=>{l.$$.dirty[0]&262144&&(n=Object.entries(i)),l.$$.dirty[0]&131073&&a&&!$&&(a.includes(" AND ")||a.includes(" OR ")||a.includes(" and ")||a.includes(" or "))&&y(a)},[a,p,m,_,h,w,b,k,u,d,y,q,I,R,V,A,ee,$,i,X,x,z,Z,O,H,K,E,M,B,oe]}class ka extends _t{constructor(e){super(),ht(this,e,ba,va,pt,{},null,[-1,-1])}}async function bo(l={}){return typeof l=="object"&&Object.freeze(l),Yl({__tauriModule:"Dialog",message:{cmd:"openDialog",options:l}})}function ko(l,e,t){const n=l.slice();return n[71]=e[t],n[79]=t,n}function wo(l,e,t){const n=l.slice();return n[77]=e[t],n[78]=e,n[79]=t,n}function yo(l,e,t){const n=l.slice();return n[80]=e[t],n}function $o(l,e,t){const n=l.slice();return n[80]=e[t],n}function Co(l,e,t){const n=l.slice();return n[85]=e[t],n[86]=e,n[87]=t,n}function To(l,e,t){const n=l.slice();return n[88]=e[t][0],n[89]=e[t][1],n[90]=e,n[91]=t,n}function So(l,e,t){const n=l.slice();return n[74]=e[t],n}function Ro(l,e,t){const n=l.slice();return n[71]=e[t],n}function Ao(l,e,t){const n=l.slice();return n[74]=e[t],n}function Eo(l){let e,t,n,o,a;return{c(){e=f("div"),t=f("button"),n=P(`
      Configuration saved successfully!`),c(t,"class","delete"),c(e,"class","notification is-success"),c(e,"data-testid","wizard-success")},m(r,u){S(r,e,u),s(e,t),s(e,n),o||(a=re(t,"click",l[20]),o=!0)},p:Re,d(r){r&&T(e),o=!1,a()}}}function Lo(l){let e,t,n,o,a;return{c(){e=f("div"),t=f("button"),n=P(`
      Failed to save configuration. Please try again.`),c(t,"class","delete"),c(e,"class","notification is-danger"),c(e,"data-testid","wizard-error")},m(r,u){S(r,e,u),s(e,t),s(e,n),o||(a=re(t,"click",l[21]),o=!0)},p:Re,d(r){r&&T(e),o=!1,a()}}}function wa(l){let e,t,n,o,a,r,u,i,d,p=l[3].id+"",m,_,h,w,b,k=l[3].global_shortcut+"",$,y,v,C,q,I=l[3].default_theme+"",N,R,F,le,V,L=l[3].default_role+"",A,ee,K,X,x,z,Z=JSON.stringify(l[3],null,2)+"",O,H=l[3].roles,E=[];for(let M=0;M<H.length;M+=1)E[M]=Do(ko(l,H,M));return{c(){e=f("h4"),e.textContent="Review",t=g(),n=f("div"),o=f("h5"),o.textContent="Configuration Summary:",a=g(),r=f("ul"),u=f("li"),i=f("strong"),i.textContent="Configuration ID:",d=g(),m=P(p),_=g(),h=f("li"),w=f("strong"),w.textContent="Global Shortcut:",b=g(),$=P(k),y=g(),v=f("li"),C=f("strong"),C.textContent="Default Theme:",q=g(),N=P(I),R=g(),F=f("li"),le=f("strong"),le.textContent="Default Role:",V=g(),A=P(L),ee=g(),K=f("h5"),K.textContent="Roles:",X=g();for(let M=0;M<E.length;M+=1)E[M].c();x=g(),z=f("pre"),O=P(Z),c(e,"class","title is-5"),c(n,"class","content"),we(z,"max-height","300px"),we(z,"overflow","auto")},m(M,B){S(M,e,B),S(M,t,B),S(M,n,B),s(n,o),s(n,a),s(n,r),s(r,u),s(u,i),s(u,d),s(u,m),s(r,_),s(r,h),s(h,w),s(h,b),s(h,$),s(r,y),s(r,v),s(v,C),s(v,q),s(v,N),s(r,R),s(r,F),s(F,le),s(F,V),s(F,A),s(n,ee),s(n,K),s(n,X);for(let oe=0;oe<E.length;oe+=1)E[oe]&&E[oe].m(n,null);S(M,x,B),S(M,z,B),s(z,O)},p(M,B){if(B[0]&8&&p!==(p=M[3].id+"")&&be(m,p),B[0]&8&&k!==(k=M[3].global_shortcut+"")&&be($,k),B[0]&8&&I!==(I=M[3].default_theme+"")&&be(N,I),B[0]&8&&L!==(L=M[3].default_role+"")&&be(A,L),B[0]&10){H=M[3].roles;let oe;for(oe=0;oe<H.length;oe+=1){const D=ko(M,H,oe);E[oe]?E[oe].p(D,B):(E[oe]=Do(D),E[oe].c(),E[oe].m(n,null))}for(;oe<E.length;oe+=1)E[oe].d(1);E.length=H.length}B[0]&8&&Z!==(Z=JSON.stringify(M[3],null,2)+"")&&be(O,Z)},d(M){M&&T(e),M&&T(t),M&&T(n),tt(E,M),M&&T(x),M&&T(z)}}}function ya(l){let e,t,n=[],o=new Map,a,r,u,i,d=l[3].roles;const p=m=>m[77].name;for(let m=0;m<d.length;m+=1){let _=wo(l,d,m),h=p(_);o.set(h,n[m]=Bo(h,_))}return{c(){e=f("h4"),e.textContent="Roles",t=g();for(let m=0;m<n.length;m+=1)n[m].c();a=g(),r=f("button"),r.textContent="Add Role",c(e,"class","title is-5"),c(r,"class","button is-link is-light"),c(r,"data-testid","add-role")},m(m,_){S(m,e,_),S(m,t,_);for(let h=0;h<n.length;h+=1)n[h]&&n[h].m(m,_);S(m,a,_),S(m,r,_),u||(i=re(r,"click",l[12]),u=!0)},p(m,_){_[0]&516985&&(d=m[3].roles,n=dr(n,_,p,1,m,d,o,a.parentNode,pr,Bo,a,wo))},d(m){m&&T(e),m&&T(t);for(let _=0;_<n.length;_+=1)n[_].d(m);m&&T(a),m&&T(r),u=!1,i()}}}function $a(l){let e,t,n,o,a,r,u,i,d,p,m,_,h,w,b,k,$,y,v,C,q,I,N,R,F,le,V,L,A,ee,K,X=l[8],x=[];for(let O=0;O<X.length;O+=1)x[O]=Jo(Ao(l,X,O));let z=l[3].roles,Z=[];for(let O=0;O<z.length;O+=1)Z[O]=Qo(Ro(l,z,O));return{c(){e=f("div"),t=f("label"),t.textContent="Configuration ID",n=g(),o=f("div"),a=f("div"),r=f("select"),u=f("option"),u.textContent="Desktop",i=f("option"),i.textContent="Server",d=f("option"),d.textContent="Embedded",p=g(),m=f("div"),_=f("label"),_.textContent="Global shortcut",h=g(),w=f("div"),b=f("input"),k=g(),$=f("div"),y=f("label"),y.textContent="Default theme",v=g(),C=f("div"),q=f("div"),I=f("select");for(let O=0;O<x.length;O+=1)x[O].c();N=g(),R=f("div"),F=f("label"),F.textContent="Default Role",le=g(),V=f("div"),L=f("div"),A=f("select");for(let O=0;O<Z.length;O+=1)Z[O].c();c(t,"class","label"),c(t,"for","config-id"),u.__value="Desktop",u.value=u.__value,i.__value="Server",i.value=i.__value,d.__value="Embedded",d.value=d.__value,c(r,"id","config-id"),l[3].id===void 0&&mt(()=>l[22].call(r)),c(a,"class","select"),c(o,"class","control"),c(e,"class","field"),c(_,"class","label"),c(_,"for","global-shortcut"),c(b,"class","input"),c(b,"id","global-shortcut"),c(b,"type","text"),c(w,"class","control"),c(m,"class","field"),c(y,"class","label"),c(y,"for","default-theme"),c(I,"id","default-theme"),l[3].default_theme===void 0&&mt(()=>l[24].call(I)),c(q,"class","select is-fullwidth"),c(C,"class","control"),c($,"class","field"),c(F,"class","label"),c(F,"for","default-role"),c(A,"id","default-role"),l[3].default_role===void 0&&mt(()=>l[25].call(A)),c(L,"class","select"),c(V,"class","control"),c(R,"class","field")},m(O,H){S(O,e,H),s(e,t),s(e,n),s(e,o),s(o,a),s(a,r),s(r,u),s(r,i),s(r,d),Je(r,l[3].id,!0),S(O,p,H),S(O,m,H),s(m,_),s(m,h),s(m,w),s(w,b),Oe(b,l[3].global_shortcut),S(O,k,H),S(O,$,H),s($,y),s($,v),s($,C),s(C,q),s(q,I);for(let E=0;E<x.length;E+=1)x[E]&&x[E].m(I,null);Je(I,l[3].default_theme,!0),S(O,N,H),S(O,R,H),s(R,F),s(R,le),s(R,V),s(V,L),s(L,A);for(let E=0;E<Z.length;E+=1)Z[E]&&Z[E].m(A,null);Je(A,l[3].default_role,!0),ee||(K=[re(r,"change",l[22]),re(b,"input",l[23]),re(I,"change",l[24]),re(A,"change",l[25])],ee=!0)},p(O,H){if(H[0]&264&&Je(r,O[3].id),H[0]&264&&b.value!==O[3].global_shortcut&&Oe(b,O[3].global_shortcut),H[0]&256){X=O[8];let E;for(E=0;E<X.length;E+=1){const M=Ao(O,X,E);x[E]?x[E].p(M,H):(x[E]=Jo(M),x[E].c(),x[E].m(I,null))}for(;E<x.length;E+=1)x[E].d(1);x.length=X.length}if(H[0]&264&&Je(I,O[3].default_theme),H[0]&8){z=O[3].roles;let E;for(E=0;E<z.length;E+=1){const M=Ro(O,z,E);Z[E]?Z[E].p(M,H):(Z[E]=Qo(M),Z[E].c(),Z[E].m(A,null))}for(;E<Z.length;E+=1)Z[E].d(1);Z.length=z.length}H[0]&264&&Je(A,O[3].default_role)},d(O){O&&T(e),O&&T(p),O&&T(m),O&&T(k),O&&T($),tt(x,O),O&&T(N),O&&T(R),tt(Z,O),ee=!1,Ve(K)}}}function Do(l){let e,t,n=l[71].name+"",o,a,r,u,i,d=l[71].shortname+"",p,m,_,h,w,b=l[71].theme+"",k,$,y,v,C,q=l[71].relevance_function+"",I,N,R,F,le,V;return{c(){e=f("div"),t=f("h6"),o=P(n),a=g(),r=f("p"),u=f("strong"),u.textContent="Shortname:",i=g(),p=P(d),m=g(),_=f("p"),h=f("strong"),h.textContent="Theme:",w=g(),k=P(b),$=g(),y=f("p"),v=f("strong"),v.textContent="Relevance Function:",C=g(),I=P(q),N=g(),R=f("button"),R.textContent="Edit Role",F=g(),c(t,"data-testid","review-role-name-"+l[79]),c(R,"class","button is-small"),c(R,"data-testid","edit-role-"+l[79]),c(e,"class","box")},m(L,A){S(L,e,A),s(e,t),s(t,o),s(e,a),s(e,r),s(r,u),s(r,i),s(r,p),s(e,m),s(e,_),s(_,h),s(_,w),s(_,k),s(e,$),s(e,y),s(y,v),s(y,C),s(y,I),s(e,N),s(e,R),s(e,F),le||(V=re(R,"click",l[68]),le=!0)},p(L,A){A[0]&8&&n!==(n=L[71].name+"")&&be(o,n),A[0]&8&&d!==(d=L[71].shortname+"")&&be(p,d),A[0]&8&&b!==(b=L[71].theme+"")&&be(k,b),A[0]&8&&q!==(q=L[71].relevance_function+"")&&be(I,q)},d(L){L&&T(e),le=!1,V()}}}function Oo(l){let e,t=l[74]+"",n;return{c(){e=f("option"),n=P(t),e.__value=l[74],e.value=e.__value},m(o,a){S(o,e,a),s(e,n)},p:Re,d(o){o&&T(e)}}}function Ca(l){let e;return{c(){e=P("Directory Path")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function Ta(l){let e;return{c(){e=P("Server URL")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function No(l){let e;return{c(){e=f("p"),e.textContent="Click to select directory",c(e,"class","help")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function Io(l){let e,t,n,o,a,r,u,i,d,p,m,_;function h(){l[34].call(u,l[79],l[87])}return{c(){e=f("div"),t=f("label"),n=P("Atomic Server Secret"),a=g(),r=f("div"),u=f("input"),d=g(),p=f("p"),p.textContent="Leave empty for anonymous access",c(t,"class","label"),c(t,"for",o=`haystack-secret-${l[79]}-${l[87]}`),c(u,"class","input"),c(u,"id",i=`haystack-secret-${l[79]}-${l[87]}`),c(u,"type","password"),c(u,"placeholder","Base64 encoded secret (optional)"),c(r,"class","control"),c(p,"class","help"),c(e,"class","field")},m(w,b){S(w,e,b),s(e,t),s(t,n),s(e,a),s(e,r),s(r,u),Oe(u,l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret),s(e,d),s(e,p),m||(_=re(u,"input",h),m=!0)},p(w,b){l=w,b[0]&264&&o!==(o=`haystack-secret-${l[79]}-${l[87]}`)&&c(t,"for",o),b[0]&264&&i!==(i=`haystack-secret-${l[79]}-${l[87]}`)&&c(u,"id",i),b[0]&264&&u.value!==l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret&&Oe(u,l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret)},d(w){w&&T(e),m=!1,_()}}}function Po(l){let e,t,n,o,a,r,u,i,d,p,m,_,h,w,b,k,$,y,v,C,q,I,N,R,F,le,V,L,A,ee,K,X,x,z,Z,O,H,E,M,B,oe,D,j;function W(){l[35].call(p,l[79],l[87])}function ae(...te){return l[36](l[79],l[87],...te)}let ce=Object.entries(l[3].roles[l[79]].haystacks[l[87]].extra_parameters||{}),se=[];for(let te=0;te<ce.length;te+=1)se[te]=Mo(To(l,ce,te));function ie(){return l[40](l[79],l[87])}function me(){return l[41](l[79],l[87])}function G(){return l[42](l[79],l[87])}return{c(){e=f("div"),t=f("label"),t.textContent="Extra Parameters (for filtering)",n=g(),o=f("div"),a=f("div"),r=f("label"),u=P("Hashtag"),d=g(),p=f("input"),_=g(),h=f("div"),w=f("div"),b=f("label"),k=P("Presets"),y=g(),v=f("div"),C=f("select"),q=f("option"),q.textContent="(choose)",I=f("option"),I.textContent="#rust",N=f("option"),N.textContent="#docs",R=f("option"),R.textContent="#test",F=f("option"),F.textContent="#todo",V=g(),L=f("p"),L.innerHTML="When set, searches will enforce the hashtag alongside your query (AND), e.g. <code>-e &quot;search&quot; -e &quot;#rust&quot;</code>.",A=g();for(let te=0;te<se.length;te+=1)se[te].c();ee=g(),K=f("div"),X=f("div"),x=f("button"),x.textContent="+ Tag Filter",z=g(),Z=f("div"),O=f("button"),O.textContent="+ Max Results",H=g(),E=f("div"),M=f("button"),M.textContent="+ Custom Parameter",B=g(),oe=f("p"),oe.innerHTML=`Common parameters: <code>tag</code> (e.g., &quot;#rust&quot;), <code>glob</code> (e.g., &quot;*.md&quot;),
                  <code>max_count</code> (e.g., &quot;10&quot;), <code>context</code> (e.g., &quot;5&quot;)`,c(t,"class","label"),c(r,"class","label"),c(r,"for",i=`ripgrep-hashtag-${l[79]}-${l[87]}`),c(p,"class","input"),c(p,"id",m=`ripgrep-hashtag-${l[79]}-${l[87]}`),c(p,"type","text"),c(p,"placeholder","#rust"),c(a,"class","control"),c(o,"class","field is-grouped"),c(b,"class","label"),c(b,"for",$=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`),q.__value="",q.value=q.__value,I.__value="#rust",I.value=I.__value,N.__value="#docs",N.value=N.__value,R.__value="#test",R.value=R.__value,F.__value="#todo",F.value=F.__value,c(C,"id",le=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`),c(v,"class","select is-small"),c(w,"class","control"),c(h,"class","field is-grouped"),we(h,"margin-bottom",".5rem"),c(L,"class","help"),c(x,"class","button is-small is-link is-light"),c(X,"class","control"),c(O,"class","button is-small is-link is-light"),c(Z,"class","control"),c(M,"class","button is-small is-link is-light"),c(E,"class","control"),c(K,"class","field is-grouped"),c(oe,"class","help"),c(e,"class","field")},m(te,ue){S(te,e,ue),s(e,t),s(e,n),s(e,o),s(o,a),s(a,r),s(r,u),s(a,d),s(a,p),Oe(p,l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag),s(e,_),s(e,h),s(h,w),s(w,b),s(b,k),s(w,y),s(w,v),s(v,C),s(C,q),s(C,I),s(C,N),s(C,R),s(C,F),s(e,V),s(e,L),s(e,A);for(let _e=0;_e<se.length;_e+=1)se[_e]&&se[_e].m(e,null);s(e,ee),s(e,K),s(K,X),s(X,x),s(K,z),s(K,Z),s(Z,O),s(K,H),s(K,E),s(E,M),s(e,B),s(e,oe),D||(j=[re(p,"input",W),re(C,"change",ae),re(x,"click",ie),re(O,"click",me),re(M,"click",G)],D=!0)},p(te,ue){if(l=te,ue[0]&264&&i!==(i=`ripgrep-hashtag-${l[79]}-${l[87]}`)&&c(r,"for",i),ue[0]&264&&m!==(m=`ripgrep-hashtag-${l[79]}-${l[87]}`)&&c(p,"id",m),ue[0]&264&&p.value!==l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag&&Oe(p,l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag),ue[0]&264&&$!==($=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`)&&c(b,"for",$),ue[0]&264&&le!==(le=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`)&&c(C,"id",le),ue[0]&393224){ce=Object.entries(l[3].roles[l[79]].haystacks[l[87]].extra_parameters||{});let _e;for(_e=0;_e<ce.length;_e+=1){const ke=To(l,ce,_e);se[_e]?se[_e].p(ke,ue):(se[_e]=Mo(ke),se[_e].c(),se[_e].m(e,ee))}for(;_e<se.length;_e+=1)se[_e].d(1);se.length=ce.length}},d(te){te&&T(e),tt(se,te),D=!1,Ve(j)}}}function Mo(l){let e,t,n,o,a,r,u,i,d,p,m,_,h;function w(...$){return l[37](l[79],l[87],l[88],...$)}function b(){l[38].call(u,l[79],l[87],l[88])}function k(){return l[39](l[79],l[87],l[88])}return{c(){e=f("div"),t=f("div"),n=f("input"),a=g(),r=f("div"),u=f("input"),i=g(),d=f("div"),p=f("button"),p.textContent="×",m=g(),c(n,"class","input"),c(n,"type","text"),c(n,"placeholder","Parameter name"),n.value=o=l[88],c(t,"class","control"),c(u,"class","input"),c(u,"type","text"),c(u,"placeholder","Parameter value"),c(r,"class","control is-expanded"),c(p,"class","button is-small is-danger"),c(d,"class","control"),c(e,"class","field is-grouped")},m($,y){S($,e,y),s(e,t),s(t,n),s(e,a),s(e,r),s(r,u),Oe(u,l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]]),s(e,i),s(e,d),s(d,p),s(e,m),_||(h=[re(n,"blur",w),re(u,"input",b),re(p,"click",k)],_=!0)},p($,y){l=$,y[0]&264&&o!==(o=l[88])&&n.value!==o&&(n.value=o),y[0]&264&&u.value!==l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]]&&Oe(u,l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]])},d($){$&&T(e),_=!1,Ve(h)}}}function jo(l){let e,t,n,o,a,r,u,i,d,p,m,_,h,w,b,k,$,y,v,C,q,I,N,R,F,le,V,L,A,ee,K,X,x,z,Z,O,H,E,M;function B(){l[31].call(d,l[79],l[87])}function oe(te,ue){return te[3].roles[te[79]].haystacks[te[87]].service==="Atomic"?Ta:Ca}let D=oe(l),j=D(l);function W(){l[32].call(v,l[79],l[87])}function ae(){return l[33](l[79],l[87])}let ce=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"&&No(),se=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"&&Io(l),ie=l[3].roles[l[79]].haystacks[l[87]].service==="Ripgrep"&&Po(l);function me(){l[43].call(A,l[79],l[87])}function G(){return l[44](l[79],l[87])}return{c(){e=f("div"),t=f("div"),n=f("label"),o=P("Service Type"),r=g(),u=f("div"),i=f("div"),d=f("select"),p=f("option"),p.textContent="Ripgrep (File Search)",m=f("option"),m.textContent="Atomic Server",h=g(),w=f("div"),b=f("label"),j.c(),$=g(),y=f("div"),v=f("input"),N=g(),ce&&ce.c(),R=g(),se&&se.c(),F=g(),ie&&ie.c(),le=g(),V=f("div"),L=f("label"),A=f("input"),K=P(`
                 Read-only`),x=g(),z=f("div"),Z=f("button"),O=P("Remove Haystack"),c(n,"class","label"),c(n,"for",a=`haystack-service-${l[79]}-${l[87]}`),p.__value="Ripgrep",p.value=p.__value,m.__value="Atomic",m.value=m.__value,c(d,"id",_=`haystack-service-${l[79]}-${l[87]}`),l[3].roles[l[79]].haystacks[l[87]].service===void 0&&mt(B),c(i,"class","select"),c(u,"class","control"),c(t,"class","field"),c(b,"class","label"),c(b,"for",k=`haystack-path-${l[79]}-${l[87]}`),c(v,"class","input"),c(v,"id",C=`haystack-path-${l[79]}-${l[87]}`),c(v,"type","text"),c(v,"placeholder",q=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?"https://localhost:9883":"/path/to/documents"),v.readOnly=I=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic",c(y,"class","control"),c(w,"class","field"),c(A,"id",ee=`haystack-readonly-${l[79]}-${l[87]}`),c(A,"type","checkbox"),c(L,"class","checkbox"),c(L,"for",X=`haystack-readonly-${l[79]}-${l[87]}`),c(V,"class","field"),c(Z,"class","button is-small is-danger"),c(Z,"data-testid",H="remove-haystack-"+l[79]+"-"+l[87]),c(z,"class","field"),c(e,"class","box is-light")},m(te,ue){S(te,e,ue),s(e,t),s(t,n),s(n,o),s(t,r),s(t,u),s(u,i),s(i,d),s(d,p),s(d,m),Je(d,l[3].roles[l[79]].haystacks[l[87]].service,!0),s(e,h),s(e,w),s(w,b),j.m(b,null),s(w,$),s(w,y),s(y,v),Oe(v,l[3].roles[l[79]].haystacks[l[87]].path),s(y,N),ce&&ce.m(y,null),s(e,R),se&&se.m(e,null),s(e,F),ie&&ie.m(e,null),s(e,le),s(e,V),s(V,L),s(L,A),A.checked=l[3].roles[l[79]].haystacks[l[87]].read_only,s(L,K),s(e,x),s(e,z),s(z,Z),s(Z,O),E||(M=[re(d,"change",B),re(v,"input",W),re(v,"click",function(){Jl(l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?ae:void 0)&&(l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?ae:void 0).apply(this,arguments)}),re(A,"change",me),re(Z,"click",G)],E=!0)},p(te,ue){l=te,ue[0]&264&&a!==(a=`haystack-service-${l[79]}-${l[87]}`)&&c(n,"for",a),ue[0]&264&&_!==(_=`haystack-service-${l[79]}-${l[87]}`)&&c(d,"id",_),ue[0]&264&&Je(d,l[3].roles[l[79]].haystacks[l[87]].service),D!==(D=oe(l))&&(j.d(1),j=D(l),j&&(j.c(),j.m(b,null))),ue[0]&264&&k!==(k=`haystack-path-${l[79]}-${l[87]}`)&&c(b,"for",k),ue[0]&264&&C!==(C=`haystack-path-${l[79]}-${l[87]}`)&&c(v,"id",C),ue[0]&264&&q!==(q=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?"https://localhost:9883":"/path/to/documents")&&c(v,"placeholder",q),ue[0]&280&&I!==(I=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic")&&(v.readOnly=I),ue[0]&264&&v.value!==l[3].roles[l[79]].haystacks[l[87]].path&&Oe(v,l[3].roles[l[79]].haystacks[l[87]].path),l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?ce||(ce=No(),ce.c(),ce.m(y,null)):ce&&(ce.d(1),ce=null),l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?se?se.p(l,ue):(se=Io(l),se.c(),se.m(e,F)):se&&(se.d(1),se=null),l[3].roles[l[79]].haystacks[l[87]].service==="Ripgrep"?ie?ie.p(l,ue):(ie=Po(l),ie.c(),ie.m(e,le)):ie&&(ie.d(1),ie=null),ue[0]&264&&ee!==(ee=`haystack-readonly-${l[79]}-${l[87]}`)&&c(A,"id",ee),ue[0]&264&&(A.checked=l[3].roles[l[79]].haystacks[l[87]].read_only),ue[0]&264&&X!==(X=`haystack-readonly-${l[79]}-${l[87]}`)&&c(L,"for",X),ue[0]&264&&H!==(H="remove-haystack-"+l[79]+"-"+l[87])&&c(Z,"data-testid",H)},d(te){te&&T(e),j.d(),ce&&ce.d(),se&&se.d(),ie&&ie.d(),E=!1,Ve(M)}}}function Uo(l){var Z;let e,t,n,o,a,r,u,i,d,p,m,_,h,w,b,k,$,y,v,C,q,I,N,R,F,le,V,L,A;function ee(){l[47].call(u,l[79])}function K(){return l[48](l[79])}let X=((Z=l[0][l[79]])==null?void 0:Z.length)&&zo(l);function x(){l[50].call(v,l[79])}function z(){l[51].call(R,l[79])}return{c(){e=f("div"),t=f("label"),n=P("Model"),a=g(),r=f("div"),u=f("input"),d=g(),p=f("button"),p.textContent="Fetch models",m=g(),X&&X.c(),_=g(),h=f("div"),w=f("label"),b=P("Base URL"),$=g(),y=f("div"),v=f("input"),q=g(),I=f("div"),N=f("label"),R=f("input"),le=P(`
               Automatically summarize search results`),c(t,"class","label"),c(t,"for",o=`llm-model-${l[79]}`),c(u,"class","input"),c(u,"id",i=`llm-model-${l[79]}`),c(u,"type","text"),c(u,"placeholder","llama3.1"),c(r,"class","control"),c(p,"class","button is-small"),c(e,"class","field"),c(w,"class","label"),c(w,"for",k=`llm-base-url-${l[79]}`),c(v,"class","input"),c(v,"id",C=`llm-base-url-${l[79]}`),c(v,"type","text"),c(v,"placeholder","http://127.0.0.1:11434"),c(y,"class","control"),c(h,"class","field"),c(R,"id",F=`llm-auto-summarize-${l[79]}`),c(R,"type","checkbox"),c(N,"class","checkbox"),c(N,"for",V=`llm-auto-summarize-${l[79]}`),c(I,"class","field")},m(O,H){S(O,e,H),s(e,t),s(t,n),s(e,a),s(e,r),s(r,u),Oe(u,l[3].roles[l[79]].llm_model),s(e,d),s(e,p),s(e,m),X&&X.m(e,null),S(O,_,H),S(O,h,H),s(h,w),s(w,b),s(h,$),s(h,y),s(y,v),Oe(v,l[3].roles[l[79]].llm_base_url),S(O,q,H),S(O,I,H),s(I,N),s(N,R),R.checked=l[3].roles[l[79]].llm_auto_summarize,s(N,le),L||(A=[re(u,"input",ee),re(p,"click",K),re(v,"input",x),re(R,"change",z)],L=!0)},p(O,H){var E;l=O,H[0]&264&&o!==(o=`llm-model-${l[79]}`)&&c(t,"for",o),H[0]&264&&i!==(i=`llm-model-${l[79]}`)&&c(u,"id",i),H[0]&264&&u.value!==l[3].roles[l[79]].llm_model&&Oe(u,l[3].roles[l[79]].llm_model),(E=l[0][l[79]])!=null&&E.length?X?X.p(l,H):(X=zo(l),X.c(),X.m(e,null)):X&&(X.d(1),X=null),H[0]&264&&k!==(k=`llm-base-url-${l[79]}`)&&c(w,"for",k),H[0]&264&&C!==(C=`llm-base-url-${l[79]}`)&&c(v,"id",C),H[0]&264&&v.value!==l[3].roles[l[79]].llm_base_url&&Oe(v,l[3].roles[l[79]].llm_base_url),H[0]&264&&F!==(F=`llm-auto-summarize-${l[79]}`)&&c(R,"id",F),H[0]&264&&(R.checked=l[3].roles[l[79]].llm_auto_summarize),H[0]&264&&V!==(V=`llm-auto-summarize-${l[79]}`)&&c(N,"for",V)},d(O){O&&T(e),X&&X.d(),O&&T(_),O&&T(h),O&&T(q),O&&T(I),L=!1,Ve(A)}}}function zo(l){let e,t,n,o,a=l[0][l[79]],r=[];for(let i=0;i<a.length;i+=1)r[i]=Ho($o(l,a,i));function u(...i){return l[49](l[79],...i)}return{c(){e=f("div"),t=f("select");for(let i=0;i<r.length;i+=1)r[i].c();c(e,"class","select is-fullwidth"),we(e,"margin-top","0.5rem")},m(i,d){S(i,e,d),s(e,t);for(let p=0;p<r.length;p+=1)r[p]&&r[p].m(t,null);n||(o=re(t,"change",u),n=!0)},p(i,d){if(l=i,d[0]&9){a=l[0][l[79]];let p;for(p=0;p<a.length;p+=1){const m=$o(l,a,p);r[p]?r[p].p(m,d):(r[p]=Ho(m),r[p].c(),r[p].m(t,null))}for(;p<r.length;p+=1)r[p].d(1);r.length=a.length}},d(i){i&&T(e),tt(r,i),n=!1,o()}}}function Ho(l){let e,t=l[80]+"",n,o;return{c(){e=f("option"),n=P(t),e.__value=o=l[80],e.value=e.__value},m(a,r){S(a,e,r),s(e,n)},p(a,r){r[0]&9&&t!==(t=a[80]+"")&&be(n,t),r[0]&265&&o!==(o=a[80])&&(e.__value=o,e.value=e.__value)},d(a){a&&T(e)}}}function Fo(l){var ue;let e,t,n,o,a,r,u,i,d,p,m,_,h,w,b,k,$,y,v,C,q,I,N,R,F,le,V,L,A,ee,K,X,x,z,Z,O,H,E,M,B,oe,D,j,W;function ae(){l[53].call(u,l[79])}function ce(){l[54].call(y,l[79])}function se(){return l[55](l[79])}let ie=((ue=l[0][l[79]])==null?void 0:ue.length)&&Ko(l);function me(){l[57].call(L,l[79])}function G(){l[58].call(H,l[79])}let te=l[3].roles[l[79]].openrouter_chat_enabled&&Go(l);return{c(){e=f("div"),t=f("label"),n=P("OpenRouter API Key"),a=g(),r=f("div"),u=f("input"),d=g(),p=f("p"),p.innerHTML='Get your API key from <a href="https://openrouter.ai" target="_blank" rel="noopener">OpenRouter</a>',m=g(),_=f("div"),h=f("label"),w=P("Model"),k=g(),$=f("div"),y=f("input"),C=g(),q=f("button"),q.textContent="Fetch models",I=g(),ie&&ie.c(),N=g(),R=f("p"),R.textContent="Choose the language model for generating summaries. Different models offer different speed/quality tradeoffs.",F=g(),le=f("div"),V=f("label"),L=f("input"),ee=P(`
               Automatically summarize search results`),X=g(),x=f("p"),x.textContent="When enabled, summaries will be generated and shown in search results.",z=g(),Z=f("div"),O=f("label"),H=f("input"),M=P(`
               Enable Chat interface (OpenRouter)`),oe=g(),te&&te.c(),D=ut(),c(t,"class","label"),c(t,"for",o=`openrouter-api-key-${l[79]}`),c(u,"class","input"),c(u,"id",i=`openrouter-api-key-${l[79]}`),c(u,"type","password"),c(u,"placeholder","sk-or-v1-..."),c(r,"class","control"),c(p,"class","help"),c(e,"class","field"),c(h,"class","label"),c(h,"for",b=`openrouter-model-${l[79]}`),c(y,"class","input"),c(y,"id",v=`openrouter-model-${l[79]}`),c(y,"type","text"),c(y,"placeholder","openai/gpt-4-turbo"),c($,"class","control"),c(q,"class","button is-small"),c(R,"class","help"),c(_,"class","field"),c(L,"id",A=`openrouter-auto-summarize-${l[79]}`),c(L,"type","checkbox"),c(V,"class","checkbox"),c(V,"for",K=`openrouter-auto-summarize-${l[79]}`),c(x,"class","help"),c(le,"class","field"),c(H,"id",E=`openrouter-chat-enabled-${l[79]}`),c(H,"type","checkbox"),c(O,"class","checkbox"),c(O,"for",B=`openrouter-chat-enabled-${l[79]}`),c(Z,"class","field")},m(_e,ke){S(_e,e,ke),s(e,t),s(t,n),s(e,a),s(e,r),s(r,u),Oe(u,l[3].roles[l[79]].openrouter_api_key),s(e,d),s(e,p),S(_e,m,ke),S(_e,_,ke),s(_,h),s(h,w),s(_,k),s(_,$),s($,y),Oe(y,l[3].roles[l[79]].openrouter_model),s(_,C),s(_,q),s(_,I),ie&&ie.m(_,null),s(_,N),s(_,R),S(_e,F,ke),S(_e,le,ke),s(le,V),s(V,L),L.checked=l[3].roles[l[79]].openrouter_auto_summarize,s(V,ee),s(le,X),s(le,x),S(_e,z,ke),S(_e,Z,ke),s(Z,O),s(O,H),H.checked=l[3].roles[l[79]].openrouter_chat_enabled,s(O,M),S(_e,oe,ke),te&&te.m(_e,ke),S(_e,D,ke),j||(W=[re(u,"input",ae),re(y,"input",ce),re(q,"click",se),re(L,"change",me),re(H,"change",G)],j=!0)},p(_e,ke){var Te;l=_e,ke[0]&264&&o!==(o=`openrouter-api-key-${l[79]}`)&&c(t,"for",o),ke[0]&264&&i!==(i=`openrouter-api-key-${l[79]}`)&&c(u,"id",i),ke[0]&264&&u.value!==l[3].roles[l[79]].openrouter_api_key&&Oe(u,l[3].roles[l[79]].openrouter_api_key),ke[0]&264&&b!==(b=`openrouter-model-${l[79]}`)&&c(h,"for",b),ke[0]&264&&v!==(v=`openrouter-model-${l[79]}`)&&c(y,"id",v),ke[0]&264&&y.value!==l[3].roles[l[79]].openrouter_model&&Oe(y,l[3].roles[l[79]].openrouter_model),(Te=l[0][l[79]])!=null&&Te.length?ie?ie.p(l,ke):(ie=Ko(l),ie.c(),ie.m(_,N)):ie&&(ie.d(1),ie=null),ke[0]&264&&A!==(A=`openrouter-auto-summarize-${l[79]}`)&&c(L,"id",A),ke[0]&264&&(L.checked=l[3].roles[l[79]].openrouter_auto_summarize),ke[0]&264&&K!==(K=`openrouter-auto-summarize-${l[79]}`)&&c(V,"for",K),ke[0]&264&&E!==(E=`openrouter-chat-enabled-${l[79]}`)&&c(H,"id",E),ke[0]&264&&(H.checked=l[3].roles[l[79]].openrouter_chat_enabled),ke[0]&264&&B!==(B=`openrouter-chat-enabled-${l[79]}`)&&c(O,"for",B),l[3].roles[l[79]].openrouter_chat_enabled?te?te.p(l,ke):(te=Go(l),te.c(),te.m(D.parentNode,D)):te&&(te.d(1),te=null)},d(_e){_e&&T(e),_e&&T(m),_e&&T(_),ie&&ie.d(),_e&&T(F),_e&&T(le),_e&&T(z),_e&&T(Z),_e&&T(oe),te&&te.d(_e),_e&&T(D),j=!1,Ve(W)}}}function Ko(l){let e,t,n,o,a=l[0][l[79]],r=[];for(let i=0;i<a.length;i+=1)r[i]=qo(yo(l,a,i));function u(...i){return l[56](l[79],...i)}return{c(){e=f("div"),t=f("select");for(let i=0;i<r.length;i+=1)r[i].c();c(e,"class","select is-fullwidth"),we(e,"margin-top","0.5rem")},m(i,d){S(i,e,d),s(e,t);for(let p=0;p<r.length;p+=1)r[p]&&r[p].m(t,null);n||(o=re(t,"change",u),n=!0)},p(i,d){if(l=i,d[0]&9){a=l[0][l[79]];let p;for(p=0;p<a.length;p+=1){const m=yo(l,a,p);r[p]?r[p].p(m,d):(r[p]=qo(m),r[p].c(),r[p].m(t,null))}for(;p<r.length;p+=1)r[p].d(1);r.length=a.length}},d(i){i&&T(e),tt(r,i),n=!1,o()}}}function qo(l){let e,t=l[80]+"",n,o;return{c(){e=f("option"),n=P(t),e.__value=o=l[80],e.value=e.__value},m(a,r){S(a,e,r),s(e,n)},p(a,r){r[0]&9&&t!==(t=a[80]+"")&&be(n,t),r[0]&265&&o!==(o=a[80])&&(e.__value=o,e.value=e.__value)},d(a){a&&T(e)}}}function Go(l){let e,t,n,o,a,r,u,i,d,p,m,_,h,w,b,k,$,y,v,C,q,I,N,R,F;function le(){l[59].call(i,l[79])}function V(){l[60].call(I,l[79])}return{c(){e=f("div"),t=f("label"),n=P("Chat Model"),a=g(),r=f("div"),u=f("div"),i=f("select"),d=f("option"),d.textContent="GPT-3.5 Turbo",p=f("option"),p.textContent="GPT-4",m=f("option"),m.textContent="Claude 3 Sonnet",_=f("option"),_.textContent="Claude 3 Haiku",h=f("option"),h.textContent="Mixtral 8x7B",b=g(),k=f("div"),$=f("label"),y=P("System Prompt (optional)"),C=g(),q=f("div"),I=f("textarea"),c(t,"class","label"),c(t,"for",o=`openrouter-chat-model-${l[79]}`),d.__value="openai/gpt-3.5-turbo",d.value=d.__value,p.__value="openai/gpt-4",p.value=p.__value,m.__value="anthropic/claude-3-sonnet",m.value=m.__value,_.__value="anthropic/claude-3-haiku",_.value=_.__value,h.__value="mistralai/mixtral-8x7b-instruct",h.value=h.__value,c(i,"id",w=`openrouter-chat-model-${l[79]}`),l[3].roles[l[79]].openrouter_chat_model===void 0&&mt(le),c(u,"class","select is-fullwidth"),c(r,"class","control"),c(e,"class","field"),c($,"class","label"),c($,"for",v=`openrouter-chat-system-${l[79]}`),c(I,"class","textarea"),c(I,"id",N=`openrouter-chat-system-${l[79]}`),c(I,"rows","3"),c(I,"placeholder","You are a helpful Rust engineer assistant..."),c(q,"class","control"),c(k,"class","field")},m(L,A){S(L,e,A),s(e,t),s(t,n),s(e,a),s(e,r),s(r,u),s(u,i),s(i,d),s(i,p),s(i,m),s(i,_),s(i,h),Je(i,l[3].roles[l[79]].openrouter_chat_model,!0),S(L,b,A),S(L,k,A),s(k,$),s($,y),s(k,C),s(k,q),s(q,I),Oe(I,l[3].roles[l[79]].openrouter_chat_system_prompt),R||(F=[re(i,"change",le),re(I,"input",V)],R=!0)},p(L,A){l=L,A[0]&264&&o!==(o=`openrouter-chat-model-${l[79]}`)&&c(t,"for",o),A[0]&264&&w!==(w=`openrouter-chat-model-${l[79]}`)&&c(i,"id",w),A[0]&264&&Je(i,l[3].roles[l[79]].openrouter_chat_model),A[0]&264&&v!==(v=`openrouter-chat-system-${l[79]}`)&&c($,"for",v),A[0]&264&&N!==(N=`openrouter-chat-system-${l[79]}`)&&c(I,"id",N),A[0]&264&&Oe(I,l[3].roles[l[79]].openrouter_chat_system_prompt)},d(L){L&&T(e),L&&T(b),L&&T(k),R=!1,Ve(F)}}}function Wo(l){let e;return{c(){e=f("p"),e.textContent="Click to select directory",c(e,"class","help")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function Bo(l,e){let t,n,o,a,r,u,i,d,p,m,_,h,w,b,k,$,y,v,C,q,I,N,R,F,le,V,L,A,ee,K,X,x,z,Z,O,H,E,M,B,oe,D,j,W,ae,ce,se,ie,me,G,te,ue,_e,ke,Te,Xe,Be,Ne,Pe,de,Se,Me,xe,et,ye,ze,qe,Ge,Le,De,it,Ie,We,J,ne,Q,fe,Ce,$e,Ye,nt,pe,Ae,ot,ft,Mt,at,Gt,ll,Yt,hl,jt,yt,Zl,yl,Xl,$l,Et,Cl,xl,nl,ol,en,Tl,tn,Zt,gt,Sl,ln,nn,Rl,sl,rl,on,Al,sn,El,Ot,il,al,Ll,rn,cl,Wt,Ut,Dl,an,Ol,cn,Xt,zt,Nl,un,Il,fn,dn,pn,xt,mn,Pl,zl,_n;function Vs(){e[26].call(d,e[79])}function Ys(){e[27].call(y,e[79])}let ul=e[8],vt=[];for(let Ze=0;Ze<ul.length;Ze+=1)vt[Ze]=Oo(So(e,ul,Ze));function hn(){e[28].call(L,e[79])}function gn(){e[29].call(E,e[79])}function Zs(){e[30].call(ie,e[79])}let fl=e[77].haystacks,bt=[];for(let Ze=0;Ze<fl.length;Ze+=1)bt[Ze]=jo(Co(e,fl,Ze));function Xs(){return e[45](e[79])}function vn(){e[46].call(Le,e[79])}let kt=e[3].roles[e[79]].llm_provider==="ollama"&&Uo(e);function xs(){e[52].call(pe,e[79])}let wt=e[3].roles[e[79]].openrouter_enabled&&Fo(e);function er(){e[61].call(Et,e[79])}function tr(){e[62].call(gt,e[79])}function bn(){return e[63](e[79])}let $t=e[4]&&Wo();function kn(){e[64].call(Ot,e[79])}function lr(){e[65].call(Ut,e[79])}function nr(){e[66].call(zt,e[79])}function or(){return e[67](e[79])}return{key:l,first:null,c(){t=f("div"),n=f("div"),o=f("label"),a=P("Role name"),u=g(),i=f("div"),d=f("input"),m=g(),_=f("div"),h=f("label"),w=P("Short name"),k=g(),$=f("div"),y=f("input"),C=g(),q=f("div"),I=f("label"),N=P("Theme"),F=g(),le=f("div"),V=f("div"),L=f("select");for(let Ze=0;Ze<vt.length;Ze+=1)vt[Ze].c();ee=g(),K=f("div"),X=f("label"),x=P("Relevance function"),Z=g(),O=f("div"),H=f("div"),E=f("select"),M=f("option"),M.textContent="title-scorer",B=f("option"),B.textContent="terraphim-graph",oe=f("option"),oe.textContent="bm25",D=f("option"),D.textContent="bm25f",j=f("option"),j.textContent="bm25plus",ae=g(),ce=f("div"),se=f("label"),ie=f("input"),G=P(`
            Enable Terraphim IT features (KG preprocessing, auto-linking)`),ue=g(),_e=f("h5"),_e.textContent="Haystacks",ke=g();for(let Ze=0;Ze<bt.length;Ze+=1)bt[Ze].c();Te=g(),Xe=f("button"),Be=P("Add Haystack"),Pe=g(),de=f("h5"),de.textContent="AI-Enhanced Summaries (LLM Provider)",Se=g(),Me=f("div"),xe=f("label"),et=P("Provider"),ze=g(),qe=f("div"),Ge=f("div"),Le=f("select"),De=f("option"),De.textContent="(none)",it=f("option"),it.textContent="OpenRouter",Ie=f("option"),Ie.textContent="Ollama (local)",J=g(),ne=f("p"),ne.textContent="Choose a provider. OpenRouter uses API key; Ollama runs locally.",Q=g(),kt&&kt.c(),fe=g(),Ce=f("h5"),Ce.textContent="AI-Enhanced Summaries (OpenRouter)",$e=g(),Ye=f("div"),nt=f("label"),pe=f("input"),ot=P(`
             Enable AI-generated article summaries`),Mt=g(),at=f("p"),at.textContent="Generate intelligent summaries using OpenRouter's language models",Gt=g(),wt&&wt.c(),ll=g(),Yt=f("h5"),Yt.textContent="Knowledge Graph",hl=g(),jt=f("div"),yt=f("label"),Zl=P("Remote automata URL"),Xl=g(),$l=f("div"),Et=f("input"),xl=g(),nl=f("div"),ol=f("label"),en=P("Local KG path"),tn=g(),Zt=f("div"),gt=f("input"),ln=g(),$t&&$t.c(),nn=g(),Rl=f("div"),sl=f("div"),rl=f("label"),on=P("Local KG type"),sn=g(),El=f("div"),Ot=f("select"),il=f("option"),il.textContent="markdown",al=f("option"),al.textContent="json",rn=g(),cl=f("div"),Wt=f("label"),Ut=f("input"),an=P(`
             Public`),cn=g(),Xt=f("label"),zt=f("input"),un=P(`
             Publish`),fn=g(),dn=f("hr"),pn=g(),xt=f("button"),mn=P("Remove Role"),c(o,"class","label"),c(o,"for",r=`role-name-${e[79]}`),c(d,"class","input"),c(d,"id",p=`role-name-${e[79]}`),c(d,"type","text"),c(i,"class","control"),c(n,"class","field"),c(h,"class","label"),c(h,"for",b=`role-shortname-${e[79]}`),c(y,"class","input"),c(y,"id",v=`role-shortname-${e[79]}`),c(y,"type","text"),c($,"class","control"),c(_,"class","field"),c(I,"class","label"),c(I,"for",R=`role-theme-${e[79]}`),c(L,"id",A=`role-theme-${e[79]}`),e[3].roles[e[79]].theme===void 0&&mt(hn),c(V,"class","select is-fullwidth"),c(le,"class","control"),c(q,"class","field"),c(X,"class","label"),c(X,"for",z=`role-relevance-${e[79]}`),M.__value="title-scorer",M.value=M.__value,B.__value="terraphim-graph",B.value=B.__value,oe.__value="bm25",oe.value=oe.__value,D.__value="bm25f",D.value=D.__value,j.__value="bm25plus",j.value=j.__value,c(E,"id",W=`role-relevance-${e[79]}`),e[3].roles[e[79]].relevance_function===void 0&&mt(gn),c(H,"class","select is-fullwidth"),c(O,"class","control"),c(K,"class","field"),c(ie,"class","checkbox"),c(ie,"id",me=`role-terraphim-it-${e[79]}`),c(ie,"type","checkbox"),c(se,"class","label"),c(se,"for",te=`role-terraphim-it-${e[79]}`),c(ce,"class","field"),c(_e,"class","title is-6"),c(Xe,"class","button is-small"),c(Xe,"data-testid",Ne="add-haystack-"+e[79]),c(de,"class","title is-6"),c(xe,"class","label"),c(xe,"for",ye=`llm-provider-${e[79]}`),De.__value="",De.value=De.__value,it.__value="openrouter",it.value=it.__value,Ie.__value="ollama",Ie.value=Ie.__value,c(Le,"id",We=`llm-provider-${e[79]}`),e[3].roles[e[79]].llm_provider===void 0&&mt(vn),c(Ge,"class","select"),c(qe,"class","control"),c(ne,"class","help"),c(Me,"class","field"),c(Ce,"class","title is-6"),c(pe,"id",Ae=`openrouter-enabled-${e[79]}`),c(pe,"type","checkbox"),c(nt,"class","checkbox"),c(nt,"for",ft=`openrouter-enabled-${e[79]}`),c(at,"class","help"),c(Ye,"class","field"),c(Yt,"class","title is-6"),c(yt,"class","label"),c(yt,"for",yl=`kg-url-${e[79]}`),c(Et,"class","input"),c(Et,"id",Cl=`kg-url-${e[79]}`),c(Et,"type","text"),c(Et,"placeholder","https://example.com/thesaurus.json"),c($l,"class","control"),c(jt,"class","field"),c(ol,"class","label"),c(ol,"for",Tl=`kg-local-path-${e[79]}`),c(gt,"class","input"),c(gt,"id",Sl=`kg-local-path-${e[79]}`),c(gt,"type","text"),c(gt,"placeholder","/path/to/markdown"),gt.readOnly=e[4],c(Zt,"class","control"),c(nl,"class","field"),c(rl,"class","label"),c(rl,"for",Al=`kg-local-type-${e[79]}`),il.__value="markdown",il.value=il.__value,al.__value="json",al.value=al.__value,c(Ot,"id",Ll=`kg-local-type-${e[79]}`),e[3].roles[e[79]].kg.local_type===void 0&&mt(kn),c(El,"class","select"),c(sl,"class","control"),c(Rl,"class","field is-grouped"),c(Ut,"id",Dl=`kg-public-${e[79]}`),c(Ut,"type","checkbox"),c(Wt,"class","checkbox"),c(Wt,"for",Ol=`kg-public-${e[79]}`),we(Wt,"margin-right","1rem"),c(zt,"id",Nl=`kg-publish-${e[79]}`),c(zt,"type","checkbox"),c(Xt,"class","checkbox"),c(Xt,"for",Il=`kg-publish-${e[79]}`),c(cl,"class","field is-grouped"),c(xt,"class","button is-small is-danger"),c(xt,"data-testid",Pl="remove-role-"+e[79]),c(t,"class","box"),this.first=t},m(Ze,Ee){S(Ze,t,Ee),s(t,n),s(n,o),s(o,a),s(n,u),s(n,i),s(i,d),Oe(d,e[3].roles[e[79]].name),s(t,m),s(t,_),s(_,h),s(h,w),s(_,k),s(_,$),s($,y),Oe(y,e[3].roles[e[79]].shortname),s(t,C),s(t,q),s(q,I),s(I,N),s(q,F),s(q,le),s(le,V),s(V,L);for(let He=0;He<vt.length;He+=1)vt[He]&&vt[He].m(L,null);Je(L,e[3].roles[e[79]].theme,!0),s(t,ee),s(t,K),s(K,X),s(X,x),s(K,Z),s(K,O),s(O,H),s(H,E),s(E,M),s(E,B),s(E,oe),s(E,D),s(E,j),Je(E,e[3].roles[e[79]].relevance_function,!0),s(t,ae),s(t,ce),s(ce,se),s(se,ie),ie.checked=e[3].roles[e[79]].terraphim_it,s(se,G),s(t,ue),s(t,_e),s(t,ke);for(let He=0;He<bt.length;He+=1)bt[He]&&bt[He].m(t,null);s(t,Te),s(t,Xe),s(Xe,Be),s(t,Pe),s(t,de),s(t,Se),s(t,Me),s(Me,xe),s(xe,et),s(Me,ze),s(Me,qe),s(qe,Ge),s(Ge,Le),s(Le,De),s(Le,it),s(Le,Ie),Je(Le,e[3].roles[e[79]].llm_provider,!0),s(Me,J),s(Me,ne),s(t,Q),kt&&kt.m(t,null),s(t,fe),s(t,Ce),s(t,$e),s(t,Ye),s(Ye,nt),s(nt,pe),pe.checked=e[3].roles[e[79]].openrouter_enabled,s(nt,ot),s(Ye,Mt),s(Ye,at),s(t,Gt),wt&&wt.m(t,null),s(t,ll),s(t,Yt),s(t,hl),s(t,jt),s(jt,yt),s(yt,Zl),s(jt,Xl),s(jt,$l),s($l,Et),Oe(Et,e[3].roles[e[79]].kg.url),s(t,xl),s(t,nl),s(nl,ol),s(ol,en),s(nl,tn),s(nl,Zt),s(Zt,gt),Oe(gt,e[3].roles[e[79]].kg.local_path),s(Zt,ln),$t&&$t.m(Zt,null),s(t,nn),s(t,Rl),s(Rl,sl),s(sl,rl),s(rl,on),s(sl,sn),s(sl,El),s(El,Ot),s(Ot,il),s(Ot,al),Je(Ot,e[3].roles[e[79]].kg.local_type,!0),s(t,rn),s(t,cl),s(cl,Wt),s(Wt,Ut),Ut.checked=e[3].roles[e[79]].kg.public,s(Wt,an),s(cl,cn),s(cl,Xt),s(Xt,zt),zt.checked=e[3].roles[e[79]].kg.publish,s(Xt,un),s(t,fn),s(t,dn),s(t,pn),s(t,xt),s(xt,mn),zl||(_n=[re(d,"input",Vs),re(y,"input",Ys),re(L,"change",hn),re(E,"change",gn),re(ie,"change",Zs),re(Xe,"click",Xs),re(Le,"change",vn),re(pe,"change",xs),re(Et,"input",er),re(gt,"input",tr),re(gt,"click",function(){Jl(e[4]?bn:void 0)&&(e[4]?bn:void 0).apply(this,arguments)}),re(Ot,"change",kn),re(Ut,"change",lr),re(zt,"change",nr),re(xt,"click",or)],zl=!0)},p(Ze,Ee){if(e=Ze,Ee[0]&264&&r!==(r=`role-name-${e[79]}`)&&c(o,"for",r),Ee[0]&264&&p!==(p=`role-name-${e[79]}`)&&c(d,"id",p),Ee[0]&264&&d.value!==e[3].roles[e[79]].name&&Oe(d,e[3].roles[e[79]].name),Ee[0]&264&&b!==(b=`role-shortname-${e[79]}`)&&c(h,"for",b),Ee[0]&264&&v!==(v=`role-shortname-${e[79]}`)&&c(y,"id",v),Ee[0]&264&&y.value!==e[3].roles[e[79]].shortname&&Oe(y,e[3].roles[e[79]].shortname),Ee[0]&264&&R!==(R=`role-theme-${e[79]}`)&&c(I,"for",R),Ee[0]&256){ul=e[8];let He;for(He=0;He<ul.length;He+=1){const gl=So(e,ul,He);vt[He]?vt[He].p(gl,Ee):(vt[He]=Oo(gl),vt[He].c(),vt[He].m(L,null))}for(;He<vt.length;He+=1)vt[He].d(1);vt.length=ul.length}if(Ee[0]&264&&A!==(A=`role-theme-${e[79]}`)&&c(L,"id",A),Ee[0]&264&&Je(L,e[3].roles[e[79]].theme),Ee[0]&264&&z!==(z=`role-relevance-${e[79]}`)&&c(X,"for",z),Ee[0]&264&&W!==(W=`role-relevance-${e[79]}`)&&c(E,"id",W),Ee[0]&264&&Je(E,e[3].roles[e[79]].relevance_function),Ee[0]&264&&me!==(me=`role-terraphim-it-${e[79]}`)&&c(ie,"id",me),Ee[0]&264&&(ie.checked=e[3].roles[e[79]].terraphim_it),Ee[0]&264&&te!==(te=`role-terraphim-it-${e[79]}`)&&c(se,"for",te),Ee[0]&491576){fl=e[77].haystacks;let He;for(He=0;He<fl.length;He+=1){const gl=Co(e,fl,He);bt[He]?bt[He].p(gl,Ee):(bt[He]=jo(gl),bt[He].c(),bt[He].m(t,Te))}for(;He<bt.length;He+=1)bt[He].d(1);bt.length=fl.length}Ee[0]&264&&Ne!==(Ne="add-haystack-"+e[79])&&c(Xe,"data-testid",Ne),Ee[0]&264&&ye!==(ye=`llm-provider-${e[79]}`)&&c(xe,"for",ye),Ee[0]&264&&We!==(We=`llm-provider-${e[79]}`)&&c(Le,"id",We),Ee[0]&264&&Je(Le,e[3].roles[e[79]].llm_provider),e[3].roles[e[79]].llm_provider==="ollama"?kt?kt.p(e,Ee):(kt=Uo(e),kt.c(),kt.m(t,fe)):kt&&(kt.d(1),kt=null),Ee[0]&264&&Ae!==(Ae=`openrouter-enabled-${e[79]}`)&&c(pe,"id",Ae),Ee[0]&264&&(pe.checked=e[3].roles[e[79]].openrouter_enabled),Ee[0]&264&&ft!==(ft=`openrouter-enabled-${e[79]}`)&&c(nt,"for",ft),e[3].roles[e[79]].openrouter_enabled?wt?wt.p(e,Ee):(wt=Fo(e),wt.c(),wt.m(t,ll)):wt&&(wt.d(1),wt=null),Ee[0]&264&&yl!==(yl=`kg-url-${e[79]}`)&&c(yt,"for",yl),Ee[0]&264&&Cl!==(Cl=`kg-url-${e[79]}`)&&c(Et,"id",Cl),Ee[0]&264&&Et.value!==e[3].roles[e[79]].kg.url&&Oe(Et,e[3].roles[e[79]].kg.url),Ee[0]&264&&Tl!==(Tl=`kg-local-path-${e[79]}`)&&c(ol,"for",Tl),Ee[0]&264&&Sl!==(Sl=`kg-local-path-${e[79]}`)&&c(gt,"id",Sl),Ee[0]&16&&(gt.readOnly=e[4]),Ee[0]&264&&gt.value!==e[3].roles[e[79]].kg.local_path&&Oe(gt,e[3].roles[e[79]].kg.local_path),e[4]?$t||($t=Wo(),$t.c(),$t.m(Zt,null)):$t&&($t.d(1),$t=null),Ee[0]&264&&Al!==(Al=`kg-local-type-${e[79]}`)&&c(rl,"for",Al),Ee[0]&264&&Ll!==(Ll=`kg-local-type-${e[79]}`)&&c(Ot,"id",Ll),Ee[0]&264&&Je(Ot,e[3].roles[e[79]].kg.local_type),Ee[0]&264&&Dl!==(Dl=`kg-public-${e[79]}`)&&c(Ut,"id",Dl),Ee[0]&264&&(Ut.checked=e[3].roles[e[79]].kg.public),Ee[0]&264&&Ol!==(Ol=`kg-public-${e[79]}`)&&c(Wt,"for",Ol),Ee[0]&264&&Nl!==(Nl=`kg-publish-${e[79]}`)&&c(zt,"id",Nl),Ee[0]&264&&(zt.checked=e[3].roles[e[79]].kg.publish),Ee[0]&264&&Il!==(Il=`kg-publish-${e[79]}`)&&c(Xt,"for",Il),Ee[0]&264&&Pl!==(Pl="remove-role-"+e[79])&&c(xt,"data-testid",Pl)},d(Ze){Ze&&T(t),tt(vt,Ze),tt(bt,Ze),kt&&kt.d(),wt&&wt.d(),$t&&$t.d(),zl=!1,Ve(_n)}}}function Jo(l){let e,t=l[74]+"",n;return{c(){e=f("option"),n=P(t),e.__value=l[74],e.value=e.__value},m(o,a){S(o,e,a),s(e,n)},p:Re,d(o){o&&T(e)}}}function Qo(l){let e,t=l[71].name+"",n,o;return{c(){e=f("option"),n=P(t),e.__value=o=l[71].name,e.value=e.__value},m(a,r){S(a,e,r),s(e,n)},p(a,r){r[0]&8&&t!==(t=a[71].name+"")&&be(n,t),r[0]&264&&o!==(o=a[71].name)&&(e.__value=o,e.value=e.__value)},d(a){a&&T(e)}}}function Vo(l){let e,t,n;return{c(){e=f("button"),e.textContent="Back",c(e,"class","button"),c(e,"data-testid","wizard-back")},m(o,a){S(o,e,a),t||(n=re(e,"click",l[11]),t=!0)},p:Re,d(o){o&&T(e),t=!1,n()}}}function Sa(l){let e,t,n;return{c(){e=f("button"),e.textContent="Save",c(e,"class","button is-success"),c(e,"data-testid","wizard-save")},m(o,a){S(o,e,a),t||(n=re(e,"click",l[19]),t=!0)},p:Re,d(o){o&&T(e),t=!1,n()}}}function Ra(l){let e,t,n;return{c(){e=f("button"),e.textContent="Next",c(e,"class","button is-primary"),c(e,"data-testid","wizard-next")},m(o,a){S(o,e,a),t||(n=re(e,"click",l[10]),t=!0)},p:Re,d(o){o&&T(e),t=!1,n()}}}function Aa(l){let e,t,n,o,a,r,u,i,d,p,m,_,h,w,b,k,$,y;e=new _l({props:{fallbackPath:"/"}});let v=l[2]==="success"&&Eo(l),C=l[2]==="error"&&Lo(l);function q(L,A){return L[1]===1?$a:L[1]===2?ya:wa}let I=q(l),N=I(l),R=l[1]>1&&Vo(l);function F(L,A){return L[1]<Qs?Ra:Sa}let le=F(l),V=le(l);return{c(){he(e.$$.fragment),t=g(),n=f("div"),o=f("div"),a=f("h3"),a.textContent="Configuration Wizard",r=g(),u=f("button"),u.textContent="Close",i=g(),v&&v.c(),d=g(),C&&C.c(),p=g(),N.c(),m=g(),_=f("nav"),h=f("div"),R&&R.c(),w=g(),b=f("div"),V.c(),c(a,"class","title is-4"),we(a,"margin-bottom","0"),c(u,"class","button is-small is-light"),c(u,"aria-label","Close configuration wizard"),c(o,"class","is-flex is-justify-content-space-between is-align-items-center"),we(o,"gap",".5rem"),c(h,"class","level-left"),c(b,"class","level-right"),c(_,"class","level"),c(n,"class","box")},m(L,A){ge(e,L,A),S(L,t,A),S(L,n,A),s(n,o),s(o,a),s(o,r),s(o,u),s(n,i),v&&v.m(n,null),s(n,d),C&&C.m(n,null),s(n,p),N.m(n,null),s(n,m),s(n,_),s(_,h),R&&R.m(h,null),s(_,w),s(_,b),V.m(b,null),k=!0,$||(y=re(u,"click",Ea),$=!0)},p(L,A){L[2]==="success"?v?v.p(L,A):(v=Eo(L),v.c(),v.m(n,d)):v&&(v.d(1),v=null),L[2]==="error"?C?C.p(L,A):(C=Lo(L),C.c(),C.m(n,p)):C&&(C.d(1),C=null),I===(I=q(L))&&N?N.p(L,A):(N.d(1),N=I(L),N&&(N.c(),N.m(n,m))),L[1]>1?R?R.p(L,A):(R=Vo(L),R.c(),R.m(h,null)):R&&(R.d(1),R=null),le===(le=F(L))&&V?V.p(L,A):(V.d(1),V=le(L),V&&(V.c(),V.m(b,null)))},i(L){k||(U(e.$$.fragment,L),k=!0)},o(L){Y(e.$$.fragment,L),k=!1},d(L){ve(e,L),L&&T(t),L&&T(n),v&&v.d(),C&&C.d(),N.d(),R&&R.d(),V.d(),$=!1,y()}}}const Qs=3;function Ea(){typeof window<"u"&&window.history.back()}function La(l,e,t){let n,o;Ue(l,ct,J=>t(4,o=J));const a=Dt(null);async function r(J,ne){if(Rt(ct))try{const Q=await bo({directory:!0,multiple:!1});Q&&typeof Q=="string"&&i.update(fe=>(fe.roles[J].haystacks[ne].path=Q,fe))}catch(Q){console.error("Failed to open folder selector:",Q)}}async function u(J){if(Rt(ct))try{const ne=await bo({directory:!0,multiple:!1});ne&&typeof ne=="string"&&i.update(Q=>(Q.roles[J].kg.local_path=ne,Q))}catch(ne){console.error("Failed to open folder selector:",ne)}}const i=Dt({id:"Desktop",global_shortcut:"Ctrl+X",default_theme:"spacelab",default_role:"Default",roles:[]});Ue(l,i,J=>t(3,n=J));const d=["default","darkly","cerulean","cosmo","cyborg","flatly","journal","litera","lumen","lux","materia","minty","nuclear","pulse","sandstone","simplex","slate","solar","spacelab","superhero","united","yeti"];tl(async()=>{try{let J;Rt(ct)?J=await je("get_config_schema"):J=await(await fetch("/config/schema")).json(),a.set(J);const ne=Rt(Lt);ne&&ne.id&&i.update(Q=>{var fe;return{...Q,id:ne.id,global_shortcut:ne.global_shortcut,default_theme:((fe=ne.roles[ne.default_role])==null?void 0:fe.theme)??"spacelab",default_role:ne.default_role,roles:Object.values(ne.roles).map(Ce=>{var pe,Ae,ot,ft,Mt,at,Gt,ll,Yt,hl,jt;const $e=(pe=Ce.kg)==null?void 0:pe.automata_path,Ye=($e==null?void 0:$e.Remote)??"",nt=((ot=(Ae=Ce.kg)==null?void 0:Ae.knowledge_graph_local)==null?void 0:ot.path)??"";return{name:Ce.name,shortname:Ce.shortname,relevance_function:Ce.relevance_function,terraphim_it:Ce.terraphim_it??!1,theme:Ce.theme,haystacks:(Ce.haystacks??[]).map(yt=>({path:yt.location||yt.path||"",read_only:yt.read_only??!1,service:yt.service||"Ripgrep",atomic_server_secret:yt.atomic_server_secret||"",extra_parameters:yt.extra_parameters||{}})),kg:{url:Ye,local_path:nt,local_type:((Mt=(ft=Ce.kg)==null?void 0:ft.knowledge_graph_local)==null?void 0:Mt.input_type)??"markdown",public:((at=Ce.kg)==null?void 0:at.public)??!1,publish:((Gt=Ce.kg)==null?void 0:Gt.publish)??!1},openrouter_enabled:Ce.openrouter_enabled??!1,openrouter_api_key:Ce.openrouter_api_key??"",openrouter_model:Ce.openrouter_model??"openai/gpt-3.5-turbo",openrouter_auto_summarize:Ce.openrouter_auto_summarize??!1,openrouter_chat_enabled:Ce.openrouter_chat_enabled??!1,openrouter_chat_model:Ce.openrouter_chat_model??Ce.openrouter_model??"openai/gpt-3.5-turbo",openrouter_chat_system_prompt:Ce.openrouter_chat_system_prompt??"",llm_provider:((ll=Ce.extra)==null?void 0:ll.llm_provider)??"",llm_model:((Yt=Ce.extra)==null?void 0:Yt.llm_model)??"",llm_base_url:((hl=Ce.extra)==null?void 0:hl.llm_base_url)??"",llm_auto_summarize:((jt=Ce.extra)==null?void 0:jt.llm_auto_summarize)??!1}})}})}catch(J){console.error("Failed to load schema",J)}}),tl(()=>{const J=ne=>{ne.key==="Escape"&&typeof window<"u"&&window.history.back()};return window.addEventListener("keydown",J),()=>window.removeEventListener("keydown",J)});let p={};async function m(J){var $e;const Q=Rt(i).roles[J],fe=Q.llm_provider||(Q.openrouter_enabled?"openrouter":""),Ce=[];try{if(fe==="ollama"){const Ye=(Q.llm_base_url||"http://127.0.0.1:11434").replace(/\/$/,""),pe=await(await fetch(`${Ye}/api/tags`)).json();if(Array.isArray(pe==null?void 0:pe.models))for(const Ae of pe.models)Ae!=null&&Ae.name&&Ce.push(Ae.name)}else if(fe==="openrouter"){const Ye=($e=Q.openrouter_api_key)==null?void 0:$e.trim();if(!Ye)throw new Error("OpenRouter API key required");const pe=await(await fetch("https://openrouter.ai/api/v1/models",{headers:{Authorization:`Bearer ${Ye}`,"HTTP-Referer":"https://terraphim.ai","X-Title":"Terraphim Desktop"}})).json(),Ae=Array.isArray(pe==null?void 0:pe.data)?pe.data:[];for(const ot of Ae)ot!=null&&ot.id&&Ce.push(ot.id)}}catch(Ye){console.error("Failed to fetch models",Ye)}t(0,p={...p,[J]:Ce})}let _=1,h="";function w(){_<Qs&&t(1,_+=1)}function b(){_>1&&t(1,_-=1)}function k(){i.update(J=>({...J,roles:[...J.roles,{name:"New Role",shortname:"new",relevance_function:"title-scorer",terraphim_it:!1,theme:"spacelab",haystacks:[],kg:{url:"",local_path:"",local_type:"markdown",public:!1,publish:!1},openrouter_enabled:!1,openrouter_api_key:"",openrouter_model:"openai/gpt-3.5-turbo",openrouter_auto_summarize:!1,openrouter_chat_enabled:!1,openrouter_chat_model:"openai/gpt-3.5-turbo",openrouter_chat_system_prompt:"",llm_provider:"",llm_model:"",llm_base_url:"",llm_auto_summarize:!1}]}))}function $(J){i.update(ne=>({...ne,roles:ne.roles.filter((Q,fe)=>fe!==J)}))}function y(J){i.update(ne=>(ne.roles[J].haystacks.push({path:"",read_only:!1,service:"Ripgrep",atomic_server_secret:"",extra_parameters:{}}),ne))}function v(J,ne){i.update(Q=>(Q.roles[J].haystacks=Q.roles[J].haystacks.filter((fe,Ce)=>Ce!==ne),Q))}function C(J,ne,Q="",fe=""){i.update(Ce=>{Ce.roles[J].haystacks[ne].extra_parameters||(Ce.roles[J].haystacks[ne].extra_parameters={});const $e=Q||`param_${Date.now()}`;return Ce.roles[J].haystacks[ne].extra_parameters[$e]=fe,Ce})}function q(J,ne,Q){i.update(fe=>(delete fe.roles[J].haystacks[ne].extra_parameters[Q],fe))}function I(J,ne,Q,fe){i.update(Ce=>{const $e=Ce.roles[J].haystacks[ne].extra_parameters;return $e[Q]!==void 0&&Q!==fe&&($e[fe]=$e[Q],delete $e[Q]),Ce})}function N(J,ne,Q,fe){const Ce=fe.target.value;I(J,ne,Q,Ce)}async function R(){var Ce;const J=Rt(i),ne=Rt(Lt);let Q={...ne};Q.id=J.id,Q.global_shortcut=J.global_shortcut,Q.default_role=J.default_role;const fe={};J.roles.forEach($e=>{var Ae,ot;const Ye=$e.name,nt=Ye.replace(/^"|"$/g,"");fe[nt]={extra:((ot=(Ae=ne.roles)==null?void 0:Ae[Ye])==null?void 0:ot.extra)??{},name:$e.name,shortname:$e.shortname,theme:$e.theme,relevance_function:$e.relevance_function,terraphim_it:$e.terraphim_it??!1,haystacks:$e.haystacks.map(ft=>({location:ft.path,service:ft.service,read_only:ft.read_only,atomic_server_secret:ft.service==="Atomic"?ft.atomic_server_secret:void 0,extra_parameters:ft.extra_parameters||{}})),kg:$e.kg.url||$e.kg.local_path?{automata_path:$e.kg.url?{Remote:$e.kg.url}:null,knowledge_graph_local:$e.kg.local_path?{input_type:$e.kg.local_type,path:$e.kg.local_path}:null,public:$e.kg.public,publish:$e.kg.publish}:null,...$e.openrouter_enabled&&{openrouter_enabled:$e.openrouter_enabled,openrouter_api_key:$e.openrouter_api_key,openrouter_model:$e.openrouter_model,openrouter_auto_summarize:$e.openrouter_auto_summarize??!1,openrouter_chat_enabled:$e.openrouter_chat_enabled??!1,openrouter_chat_model:$e.openrouter_chat_model??$e.openrouter_model,openrouter_chat_system_prompt:$e.openrouter_chat_system_prompt??""}};const pe={};$e.llm_provider&&(pe.llm_provider=$e.llm_provider),$e.llm_model&&(pe.llm_model=$e.llm_model),$e.llm_base_url&&(pe.llm_base_url=$e.llm_base_url),typeof $e.llm_auto_summarize=="boolean"&&(pe.llm_auto_summarize=$e.llm_auto_summarize),fe[nt].extra={...fe[nt].extra||{},...pe}}),Q.roles=fe,(!Q.default_role||!fe[Q.default_role])&&(Q.default_role=((Ce=J.roles[0])==null?void 0:Ce.name)??"Default"),Q.selected_role=Q.default_role;try{if(Rt(ct))await je("update_config",{configNew:Q});else{const $e=await fetch("/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Q)});if(!$e.ok)throw new Error(`HTTP ${$e.status}: ${$e.statusText}`)}Lt.set(Q),t(2,h="success"),setTimeout(()=>{t(2,h="")},3e3)}catch($e){console.error($e),t(2,h="error"),setTimeout(()=>{t(2,h="")},3e3)}}const F=()=>t(2,h=""),le=()=>t(2,h="");function V(){n.id=St(this),i.set(n),t(8,d)}function L(){n.global_shortcut=this.value,i.set(n),t(8,d)}function A(){n.default_theme=St(this),i.set(n),t(8,d)}function ee(){n.default_role=St(this),i.set(n),t(8,d)}function K(J){n.roles[J].name=this.value,i.set(n),t(8,d)}function X(J){n.roles[J].shortname=this.value,i.set(n),t(8,d)}function x(J){n.roles[J].theme=St(this),i.set(n),t(8,d)}function z(J){n.roles[J].relevance_function=St(this),i.set(n),t(8,d)}function Z(J){n.roles[J].terraphim_it=this.checked,i.set(n),t(8,d)}function O(J,ne){n.roles[J].haystacks[ne].service=St(this),i.set(n),t(8,d)}function H(J,ne){n.roles[J].haystacks[ne].path=this.value,i.set(n),t(8,d)}const E=(J,ne)=>r(J,ne);function M(J,ne){n.roles[J].haystacks[ne].atomic_server_secret=this.value,i.set(n),t(8,d)}function B(J,ne){n.roles[J].haystacks[ne].extra_parameters.tag=this.value,i.set(n),t(8,d)}const oe=(J,ne,Q)=>{const fe=Q.currentTarget.value;fe&&Ht(i,n.roles[J].haystacks[ne].extra_parameters.tag=fe,n)},D=(J,ne,Q,fe)=>N(J,ne,Q,fe);function j(J,ne,Q){n.roles[J].haystacks[ne].extra_parameters[Q]=this.value,i.set(n),t(8,d)}const W=(J,ne,Q)=>q(J,ne,Q),ae=(J,ne)=>C(J,ne,"tag","#rust"),ce=(J,ne)=>C(J,ne,"max_count","10"),se=(J,ne)=>C(J,ne,"","");function ie(J,ne){n.roles[J].haystacks[ne].read_only=this.checked,i.set(n),t(8,d)}const me=(J,ne)=>v(J,ne),G=J=>y(J);function te(J){n.roles[J].llm_provider=St(this),i.set(n),t(8,d)}function ue(J){n.roles[J].llm_model=this.value,i.set(n),t(8,d)}const _e=J=>m(J),ke=(J,ne)=>{Ht(i,n.roles[J].llm_model=ne.currentTarget.value,n)};function Te(J){n.roles[J].llm_base_url=this.value,i.set(n),t(8,d)}function Xe(J){n.roles[J].llm_auto_summarize=this.checked,i.set(n),t(8,d)}function Be(J){n.roles[J].openrouter_enabled=this.checked,i.set(n),t(8,d)}function Ne(J){n.roles[J].openrouter_api_key=this.value,i.set(n),t(8,d)}function Pe(J){n.roles[J].openrouter_model=this.value,i.set(n),t(8,d)}const de=J=>m(J),Se=(J,ne)=>{Ht(i,n.roles[J].openrouter_model=ne.currentTarget.value,n)};function Me(J){n.roles[J].openrouter_auto_summarize=this.checked,i.set(n),t(8,d)}function xe(J){n.roles[J].openrouter_chat_enabled=this.checked,i.set(n),t(8,d)}function et(J){n.roles[J].openrouter_chat_model=St(this),i.set(n),t(8,d)}function ye(J){n.roles[J].openrouter_chat_system_prompt=this.value,i.set(n),t(8,d)}function ze(J){n.roles[J].kg.url=this.value,i.set(n),t(8,d)}function qe(J){n.roles[J].kg.local_path=this.value,i.set(n),t(8,d)}const Ge=J=>u(J);function Le(J){n.roles[J].kg.local_type=St(this),i.set(n),t(8,d)}function De(J){n.roles[J].kg.public=this.checked,i.set(n),t(8,d)}function it(J){n.roles[J].kg.publish=this.checked,i.set(n),t(8,d)}return[p,_,h,n,o,r,u,i,d,m,w,b,k,$,y,v,C,q,N,R,F,le,V,L,A,ee,K,X,x,z,Z,O,H,E,M,B,oe,D,j,W,ae,ce,se,ie,me,G,te,ue,_e,ke,Te,Xe,Be,Ne,Pe,de,Se,Me,xe,et,ye,ze,qe,Ge,Le,De,it,J=>$(J),()=>{t(1,_=2)}]}class Da extends _t{constructor(e){super(),ht(this,e,La,Aa,pt,{},null,[-1,-1,-1,-1])}}function Oa(l){let e,t,n,o,a,r,u,i;return e=new _l({props:{fallbackPath:"/"}}),u=new Gs({props:{content:l[0],onChange:l[1]}}),{c(){he(e.$$.fragment),t=g(),n=f("div"),o=f("p"),o.innerHTML="<i>The best editing experience is to configure Atomic Server, in the meantime use editor below. You will need to refresh page via Command R or Ctrl-R to see changes</i>",a=g(),r=f("div"),he(u.$$.fragment),c(r,"class","editor"),c(n,"class","box")},m(d,p){ge(e,d,p),S(d,t,p),S(d,n,p),s(n,o),s(n,a),s(n,r),ge(u,r,null),i=!0},p(d,[p]){const m={};p&1&&(m.content=d[0]),u.$set(m)},i(d){i||(U(e.$$.fragment,d),U(u.$$.fragment,d),i=!0)},o(d){Y(e.$$.fragment,d),Y(u.$$.fragment,d),i=!1},d(d){ve(e,d),d&&T(t),d&&T(n),ve(u)}}}function Na(l,e,t){let n,o;Ue(l,Lt,u=>t(2,n=u)),Ue(l,ct,u=>t(3,o=u));let a={json:n};function r(u){if(console.log("contents changed:",u),console.log("is tauri",o),Lt.update(i=>(i=u.json,i)),Rt(ct))console.log("Updating config on server"),je("update_config",{configNew:u.json}).then(i=>{console.log(`Message: ${i}`)}).catch(i=>console.error(i));else{let i=`${Qe.ServerURL}/config/`;fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u.json)})}t(0,a=u)}return tl(()=>{t(0,a={json:n})}),[a,r]}class Ia extends _t{constructor(e){super(),ht(this,e,Na,Oa,pt,{})}}const{window:Gl}=mr;function Pa(l){let e,t,n,o,a,r,u,i,d,p;return{c(){e=f("div"),t=f("div"),n=f("h3"),n.textContent="Error loading graph",o=g(),a=f("p"),r=P(l[3]),u=g(),i=f("button"),i.textContent="Retry",c(i,"class","button is-primary"),c(t,"class","error-content svelte-1ry9pkl"),c(e,"class","error-overlay svelte-1ry9pkl")},m(m,_){S(m,e,_),s(e,t),s(t,n),s(t,o),s(t,a),s(a,r),s(t,u),s(t,i),d||(p=re(i,"click",l[11]),d=!0)},p(m,_){_&8&&be(r,m[3])},d(m){m&&T(e),d=!1,p()}}}function Ma(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="loading-content svelte-1ry9pkl"><div class="loader svelte-1ry9pkl"></div> 
        <p>Loading knowledge graph...</p></div>`,c(e,"class","loading-overlay svelte-1ry9pkl")},m(t,n){S(t,e,n)},p:Re,d(t){t&&T(e)}}}function Yo(l){let e,t,n;return{c(){e=f("button"),e.innerHTML='<i class="fas fa-times svelte-1ry9pkl"></i>',c(e,"class","close-button svelte-1ry9pkl"),c(e,"title","Close Graph")},m(o,a){S(o,e,a),t||(n=re(e,"click",l[17]),t=!0)},p:Re,d(o){o&&T(e),t=!1,n()}}}function Zo(l){let e;return{c(){e=f("div"),e.innerHTML="<span><strong>Left-click:</strong> View node • <strong>Right-click:</strong> Edit node • <strong>Drag:</strong> Move • <strong>Scroll:</strong> Zoom</span>",c(e,"class","controls-info svelte-1ry9pkl")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function Xo(l){let e,t;return{c(){e=f("div"),t=P(l[8]),c(e,"class","debug-message svelte-1ry9pkl")},m(n,o){S(n,e,o),s(e,t)},p(n,o){o&256&&be(t,n[8])},d(n){n&&T(e)}}}function xo(l){let e=l[5].id,t,n,o=es(l);return{c(){o.c(),t=ut()},m(a,r){o.m(a,r),S(a,t,r),n=!0},p(a,r){r&32&&pt(e,e=a[5].id)?(Fe(),Y(o,1,1,Re),Ke(),o=es(a),o.c(),U(o,1),o.m(t.parentNode,t)):o.p(a,r)},i(a){n||(U(o),n=!0)},o(a){Y(o),n=!1},d(a){a&&T(t),o.d(a)}}}function es(l){let e,t,n;function o(r){l[18](r)}let a={item:l[5],initialEdit:l[7]};return l[6]!==void 0&&(a.active=l[6]),e=new Vl({props:a}),lt.push(()=>st(e,"active",o)),e.$on("close",l[12]),e.$on("save",l[13]),{c(){he(e.$$.fragment)},m(r,u){ge(e,r,u),n=!0},p(r,u){const i={};u&32&&(i.item=r[5]),u&128&&(i.initialEdit=r[7]),!t&&u&64&&(t=!0,i.active=r[6],rt(()=>t=!1)),e.$set(i)},i(r){n||(U(e.$$.fragment,r),n=!0)},o(r){Y(e.$$.fragment,r),n=!1},d(r){ve(e,r)}}}function ja(l){let e,t,n,o,a,r,u,i,d,p,m;mt(l[15]),e=new _l({props:{fallbackPath:"/"}});function _(v,C){if(v[2])return Ma;if(v[3])return Pa}let h=_(l),w=h&&h(l),b=l[0]&&Yo(l),k=!l[2]&&!l[3]&&l[4].length>0&&Zo(),$=l[8]&&Xo(l),y=l[5]&&xo(l);return{c(){he(e.$$.fragment),t=g(),n=f("div"),w&&w.c(),o=g(),b&&b.c(),a=g(),k&&k.c(),r=g(),$&&$.c(),u=g(),y&&y.c(),i=ut(),c(n,"class","graph-container svelte-1ry9pkl"),we(n,"width",l[0]?"100vw":"600px"),we(n,"height",l[0]?"100vh":"400px"),dt(n,"fullscreen",l[0])},m(v,C){ge(e,v,C),S(v,t,C),S(v,n,C),w&&w.m(n,null),l[16](n),S(v,o,C),b&&b.m(v,C),S(v,a,C),k&&k.m(v,C),S(v,r,C),$&&$.m(v,C),S(v,u,C),y&&y.m(v,C),S(v,i,C),d=!0,p||(m=re(Gl,"resize",l[15]),p=!0)},p(v,[C]){h===(h=_(v))&&w?w.p(v,C):(w&&w.d(1),w=h&&h(v),w&&(w.c(),w.m(n,null))),(!d||C&1)&&we(n,"width",v[0]?"100vw":"600px"),(!d||C&1)&&we(n,"height",v[0]?"100vh":"400px"),(!d||C&1)&&dt(n,"fullscreen",v[0]),v[0]?b?b.p(v,C):(b=Yo(v),b.c(),b.m(a.parentNode,a)):b&&(b.d(1),b=null),!v[2]&&!v[3]&&v[4].length>0?k||(k=Zo(),k.c(),k.m(r.parentNode,r)):k&&(k.d(1),k=null),v[8]?$?$.p(v,C):($=Xo(v),$.c(),$.m(u.parentNode,u)):$&&($.d(1),$=null),v[5]?y?(y.p(v,C),C&32&&U(y,1)):(y=xo(v),y.c(),U(y,1),y.m(i.parentNode,i)):y&&(Fe(),Y(y,1,1,()=>{y=null}),Ke())},i(v){d||(U(e.$$.fragment,v),U(y),d=!0)},o(v){Y(e.$$.fragment,v),Y(y),d=!1},d(v){ve(e,v),v&&T(t),v&&T(n),w&&w.d(),l[16](null),v&&T(o),b&&b.d(v),v&&T(a),k&&k.d(v),v&&T(r),$&&$.d(v),v&&T(u),y&&y.d(v),v&&T(i),p=!1,m()}}}function ts(l){return{id:`kg-node-${l.id}`,url:`#/graph/node/${l.id}`,title:l.label,body:`# ${l.label}

**Knowledge Graph Node**

ID: ${l.id}
Rank: ${l.rank}

This is a concept node from the knowledge graph. You can edit this content to add more information about "${l.label}".`,description:`Knowledge graph concept: ${l.label}`,tags:["knowledge-graph","concept"],rank:l.rank,stub:`Knowledge graph concept: ${l.label}`}}function Ua(l,e,t){let n,o;Ue(l,At,A=>t(20,n=A)),Ue(l,ct,A=>t(21,o=A));let{apiUrl:a="/rolegraph"}=e,{fullscreen:r=!0}=e,u,i=!0,d=null,p=[],m=[],_=null,h=!1,w=!1,b="",k=window.innerWidth,$=window.innerHeight;function y(){t(9,k=window.innerWidth),t(10,$=window.innerHeight),!i&&!d&&R()}async function v(){t(2,i=!0),t(3,d=null);try{if(o){console.log("Loading rolegraph from Tauri");const A=await je("get_rolegraph",{role_name:n||void 0});if(A&&A.status==="success")t(4,p=A.nodes),m=A.edges;else throw new Error(`Tauri rolegraph fetch failed: ${(A==null?void 0:A.status)||"unknown error"}`)}else{console.log("Loading rolegraph from server");const A=n?`${a}?role=${encodeURIComponent(n)}`:a,ee=await fetch(A);if(!ee.ok)throw new Error(`Failed to fetch: ${ee.status}`);const K=await ee.json();t(4,p=K.nodes),m=K.edges}}catch(A){t(3,d=A.message),console.error("Error fetching rolegraph:",A)}finally{t(2,i=!1)}}function C(A,ee){A.stopPropagation(),console.log("Node clicked:",ee.label),t(5,_=ts(ee)),t(7,w=!1),t(6,h=!0)}function q(A,ee){A.preventDefault(),A.stopPropagation(),console.log("Node right-clicked:",ee.label),t(8,b=`Right-clicked: ${ee.label}`),t(5,_=ts(ee)),t(7,w=!0),t(6,h=!0),setTimeout(()=>{t(8,b="")},2e3)}function I(){t(6,h=!1),t(5,_=null),t(7,w=!1)}async function N(){if(_)try{const A=await fetch("/documents",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(_)});A.ok?console.log("Successfully saved KG record:",_.id):console.error("Failed to save KG record:",A.statusText)}catch(A){console.error("Error saving KG record:",A)}finally{t(6,h=!1),t(5,_=null),t(7,w=!1)}}function R(){if(!u)return;t(1,u.innerHTML="",u);const A=Kl(u).append("svg").attr("width",k).attr("height",$),ee=Ar().scaleExtent([.1,10]).on("zoom",M=>{K.attr("transform",M.transform)});A.call(ee);const K=A.append("g"),X=Er(p).force("link",Lr(m).id(M=>M.id).distance(100)).force("charge",Dr().strength(-200)).force("center",Or(k/2,$/2)).force("collision",Nr().radius(20)),x=K.append("g").attr("class","links").selectAll("line").data(m).enter().append("line").attr("stroke","#666").attr("stroke-opacity",.7).attr("stroke-width",M=>{const B=M.weight||M.rank||1;return Math.max(1,Math.min(8,B*2))}),z=K.append("g").attr("class","nodes").selectAll("circle").data(p).enter().append("circle").attr("r",M=>{const B=M.rank||1;return Math.max(6,Math.min(20,B*2))}).attr("fill",M=>{const B=M.rank||1,oe=Math.min(B/10,1);return Ir(.2+oe*.6)}).attr("stroke","#fff").attr("stroke-width",2).style("cursor","pointer").on("click",(M,B)=>C(M,B)).on("contextmenu",(M,B)=>q(M,B)).on("mouseover",function(M,B){Kl(this).transition().duration(150).attr("stroke-width",3).attr("r",oe=>{const D=oe.rank||1;return Math.max(8,Math.min(24,D*2.5))})}).on("mouseout",function(M,B){Kl(this).transition().duration(150).attr("stroke-width",2).attr("r",oe=>{const D=oe.rank||1;return Math.max(6,Math.min(20,D*2))})}).call(Pr().on("start",O).on("drag",H).on("end",E)),Z=K.append("g").attr("class","labels").selectAll("text").data(p).enter().append("text").attr("text-anchor","middle").attr("dy",".35em").attr("font-size","11px").attr("font-family","Arial, sans-serif").attr("fill","#333").attr("pointer-events","none").text(M=>M.label.length>12?M.label.substring(0,12)+"...":M.label);X.on("tick",()=>{x.attr("x1",M=>M.source.x).attr("y1",M=>M.source.y).attr("x2",M=>M.target.x).attr("y2",M=>M.target.y),z.attr("cx",M=>M.x).attr("cy",M=>M.y),Z.attr("x",M=>M.x).attr("y",M=>M.y)});function O(M,B){M.active||X.alphaTarget(.3).restart(),B.fx=B.x,B.fy=B.y}function H(M,B){B.fx=M.x,B.fy=M.y}function E(M,B){M.active||X.alphaTarget(0),B.fx=null,B.fy=null}}tl(()=>{v().then(()=>{d||R()});const A=ee=>{ee.preventDefault()};return u&&u.addEventListener("contextmenu",A),window.addEventListener("resize",y),()=>{u&&u.removeEventListener("contextmenu",A),window.removeEventListener("resize",y)}});function F(){t(9,k=Gl.innerWidth),t(10,$=Gl.innerHeight)}function le(A){lt[A?"unshift":"push"](()=>{u=A,t(1,u)})}const V=()=>history.back();function L(A){h=A,t(6,h)}return l.$$set=A=>{"apiUrl"in A&&t(14,a=A.apiUrl),"fullscreen"in A&&t(0,r=A.fullscreen)},[r,u,i,d,p,_,h,w,b,k,$,v,I,N,a,F,le,V,L]}class za extends _t{constructor(e){super(),ht(this,e,Ua,ja,pt,{apiUrl:14,fullscreen:0})}}function ls(l,e,t){const n=l.slice();return n[19]=e[t][0],n[20]=e[t][1],n[21]=e,n[22]=t,n}function ns(l,e,t){const n=l.slice();return n[23]=e[t],n}function os(l){let e,t,n,o,a,r,u,i,d,p,m,_,h,w,b=l[2].title.trim()==="",k,$,y,v,C,q,I,N,R,F,le,V,L,A,ee,K=l[2].content.trim()==="",X,x,z,Z,O,H,E,M,B,oe,D,j,W,ae,ce,se,ie,me,G,te,ue,_e=l[1]==="edit"?"Save Changes":"Add Context",ke,Te,Xe,Be,Ne,Pe,de,Se,Me,xe,et=l[4],ye=[];for(let ne=0;ne<et.length;ne+=1)ye[ne]=ss(ns(l,et,ne));let ze=b&&rs();function qe(ne,Q){return ne[2].summary?Fa:Ha}let Ge=qe(l),Le=Ge(l),De=K&&is();function it(ne,Q){return Q&4&&(D=null),D==null&&(D=Object.keys(ne[2].metadata).length===0),D?qa:Ka}let Ie=it(l,-1),We=Ie(l),J=l[1]==="edit"&&cs(l);return{c(){e=f("section"),t=f("div"),n=f("label"),n.textContent="Type",o=g(),a=f("div"),r=f("div"),u=f("select");for(let ne=0;ne<ye.length;ne+=1)ye[ne].c();i=g(),d=f("div"),p=f("label"),p.textContent="Title *",m=g(),_=f("div"),h=f("input"),w=g(),ze&&ze.c(),k=g(),$=f("div"),y=f("label"),y.textContent="Summary",v=g(),C=f("div"),q=f("textarea"),I=g(),N=f("p"),Le.c(),R=g(),F=f("div"),le=f("label"),le.textContent="Content *",V=g(),L=f("div"),A=f("textarea"),ee=g(),De&&De.c(),X=g(),x=f("details"),z=f("summary"),z.innerHTML=`<span class="icon-text"><span class="icon"><i class="fas fa-cog"></i></span> 
              <span>Advanced Options</span></span>`,Z=g(),O=f("div"),H=f("label"),H.textContent="Metadata",E=g(),M=f("div"),B=f("p"),B.textContent="Additional key-value pairs for this context item",oe=g(),We.c(),j=g(),W=f("button"),W.innerHTML=`<span class="icon"><i class="fas fa-plus"></i></span> 
                <span>Add Metadata</span>`,ae=g(),ce=f("footer"),se=f("div"),ie=f("div"),me=f("button"),G=f("span"),G.innerHTML='<i class="fas fa-save"></i>',te=g(),ue=f("span"),ke=P(_e),Xe=g(),Be=f("div"),Ne=f("button"),Ne.innerHTML="<span>Cancel</span>",Pe=g(),J&&J.c(),de=g(),Se=f("div"),Se.innerHTML=`<strong>Keyboard shortcuts:</strong>
          Ctrl/Cmd + Enter to save, Escape to close`,c(n,"class","label"),c(n,"for","context-type"),c(u,"id","context-type"),c(u,"data-testid","context-type-select"),l[2].context_type===void 0&&mt(()=>l[10].call(u)),c(r,"class","select is-fullwidth"),c(a,"class","control"),c(t,"class","field"),c(p,"class","label"),c(p,"for","context-title"),c(h,"id","context-title"),c(h,"class","input"),c(h,"type","text"),c(h,"placeholder","Enter title..."),c(h,"data-testid","context-title-input"),h.required=!0,c(_,"class","control"),c(d,"class","field"),c(y,"class","label"),c(y,"for","context-summary"),c(q,"id","context-summary"),c(q,"class","textarea svelte-1oesbw7"),c(q,"placeholder","Brief summary of the content (optional)..."),c(q,"data-testid","context-summary-textarea"),c(q,"rows","3"),c(q,"maxlength","500"),c(C,"class","control"),c(N,"class","help svelte-1oesbw7"),c($,"class","field"),c(le,"class","label"),c(le,"for","context-content"),c(A,"id","context-content"),c(A,"class","textarea svelte-1oesbw7"),c(A,"placeholder","Enter the full content..."),c(A,"data-testid","context-content-textarea"),c(A,"rows","8"),A.required=!0,c(L,"class","control"),c(F,"class","field"),c(z,"class","summary svelte-1oesbw7"),c(H,"class","label"),c(B,"class","help svelte-1oesbw7"),c(W,"class","button is-small is-light"),c(M,"class","content"),c(O,"class","field mt-4"),c(x,"class","details svelte-1oesbw7"),c(e,"class","modal-card-body svelte-1oesbw7"),c(G,"class","icon"),c(me,"class","button is-primary"),me.disabled=Te=!l[3],c(me,"data-testid","save-context-button"),c(ie,"class","control"),c(Ne,"class","button is-light"),c(Ne,"data-testid","cancel-context-button"),c(Be,"class","control"),c(se,"class","field is-grouped"),c(Se,"class","help svelte-1oesbw7"),c(ce,"class","modal-card-foot")},m(ne,Q){S(ne,e,Q),s(e,t),s(t,n),s(t,o),s(t,a),s(a,r),s(r,u);for(let fe=0;fe<ye.length;fe+=1)ye[fe]&&ye[fe].m(u,null);Je(u,l[2].context_type,!0),s(e,i),s(e,d),s(d,p),s(d,m),s(d,_),s(_,h),Oe(h,l[2].title),s(d,w),ze&&ze.m(d,null),s(e,k),s(e,$),s($,y),s($,v),s($,C),s(C,q),Oe(q,l[2].summary),s($,I),s($,N),Le.m(N,null),s(e,R),s(e,F),s(F,le),s(F,V),s(F,L),s(L,A),Oe(A,l[2].content),s(F,ee),De&&De.m(F,null),s(e,X),s(e,x),s(x,z),s(x,Z),s(x,O),s(O,H),s(O,E),s(O,M),s(M,B),s(M,oe),We.m(M,null),s(M,j),s(M,W),S(ne,ae,Q),S(ne,ce,Q),s(ce,se),s(se,ie),s(ie,me),s(me,G),s(me,te),s(me,ue),s(ue,ke),s(se,Xe),s(se,Be),s(Be,Ne),s(se,Pe),J&&J.m(se,null),s(ce,de),s(ce,Se),Me||(xe=[re(u,"change",l[10]),re(h,"input",l[11]),re(q,"input",l[12]),re(A,"input",l[13]),re(W,"click",l[17]),re(me,"click",l[6]),re(Ne,"click",l[5])],Me=!0)},p(ne,Q){if(Q&16){et=ne[4];let fe;for(fe=0;fe<et.length;fe+=1){const Ce=ns(ne,et,fe);ye[fe]?ye[fe].p(Ce,Q):(ye[fe]=ss(Ce),ye[fe].c(),ye[fe].m(u,null))}for(;fe<ye.length;fe+=1)ye[fe].d(1);ye.length=et.length}Q&20&&Je(u,ne[2].context_type),Q&20&&h.value!==ne[2].title&&Oe(h,ne[2].title),Q&4&&(b=ne[2].title.trim()===""),b?ze||(ze=rs(),ze.c(),ze.m(d,null)):ze&&(ze.d(1),ze=null),Q&20&&Oe(q,ne[2].summary),Ge===(Ge=qe(ne))&&Le?Le.p(ne,Q):(Le.d(1),Le=Ge(ne),Le&&(Le.c(),Le.m(N,null))),Q&20&&Oe(A,ne[2].content),Q&4&&(K=ne[2].content.trim()===""),K?De||(De=is(),De.c(),De.m(F,null)):De&&(De.d(1),De=null),Ie===(Ie=it(ne,Q))&&We?We.p(ne,Q):(We.d(1),We=Ie(ne),We&&(We.c(),We.m(M,j))),Q&2&&_e!==(_e=ne[1]==="edit"?"Save Changes":"Add Context")&&be(ke,_e),Q&8&&Te!==(Te=!ne[3])&&(me.disabled=Te),ne[1]==="edit"?J?J.p(ne,Q):(J=cs(ne),J.c(),J.m(se,null)):J&&(J.d(1),J=null)},d(ne){ne&&T(e),tt(ye,ne),ze&&ze.d(),Le.d(),De&&De.d(),We.d(),ne&&T(ae),ne&&T(ce),J&&J.d(),Me=!1,Ve(xe)}}}function ss(l){let e,t=l[23].label+"",n;return{c(){e=f("option"),n=P(t),e.__value=l[23].value,e.value=e.__value},m(o,a){S(o,e,a),s(e,n)},p:Re,d(o){o&&T(e)}}}function rs(l){let e;return{c(){e=f("p"),e.textContent="Title is required",c(e,"class","help is-danger svelte-1oesbw7")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function Ha(l){let e;return{c(){e=P("Optional brief summary (up to 500 characters)")},m(t,n){S(t,e,n)},p:Re,d(t){t&&T(e)}}}function Fa(l){let e=l[2].summary.length+"",t,n;return{c(){t=P(e),n=P("/500 characters")},m(o,a){S(o,t,a),S(o,n,a)},p(o,a){a&4&&e!==(e=o[2].summary.length+"")&&be(t,e)},d(o){o&&T(t),o&&T(n)}}}function is(l){let e;return{c(){e=f("p"),e.textContent="Content is required",c(e,"class","help is-danger svelte-1oesbw7")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function Ka(l){let e,t=Object.entries(l[2].metadata),n=[];for(let o=0;o<t.length;o+=1)n[o]=as(ls(l,t,o));return{c(){for(let o=0;o<n.length;o+=1)n[o].c();e=ut()},m(o,a){for(let r=0;r<n.length;r+=1)n[r]&&n[r].m(o,a);S(o,e,a)},p(o,a){if(a&4){t=Object.entries(o[2].metadata);let r;for(r=0;r<t.length;r+=1){const u=ls(o,t,r);n[r]?n[r].p(u,a):(n[r]=as(u),n[r].c(),n[r].m(e.parentNode,e))}for(;r<n.length;r+=1)n[r].d(1);n.length=t.length}},d(o){tt(n,o),o&&T(e)}}}function qa(l){let e;return{c(){e=f("p"),e.textContent="No metadata defined",c(e,"class","has-text-grey-light")},m(t,n){S(t,e,n)},p:Re,d(t){t&&T(e)}}}function as(l){let e,t,n,o,a,r,u,i,d,p,m,_,h;function w(...$){return l[14](l[19],l[20],...$)}function b(){l[15].call(u,l[19])}function k(){return l[16](l[19])}return{c(){e=f("div"),t=f("div"),n=f("input"),a=g(),r=f("div"),u=f("input"),i=g(),d=f("div"),p=f("button"),p.innerHTML='<span class="icon"><i class="fas fa-times"></i></span>',m=g(),c(n,"class","input is-small"),c(n,"type","text"),c(n,"placeholder","Key"),n.value=o=l[19],c(t,"class","control is-expanded"),c(u,"class","input is-small"),c(u,"type","text"),c(u,"placeholder","Value"),c(r,"class","control is-expanded"),c(p,"class","button is-small is-danger is-outlined"),c(d,"class","control"),c(e,"class","field is-grouped")},m($,y){S($,e,y),s(e,t),s(t,n),s(e,a),s(e,r),s(r,u),Oe(u,l[2].metadata[l[19]]),s(e,i),s(e,d),s(d,p),s(e,m),_||(h=[re(n,"input",w),re(u,"input",b),re(p,"click",k)],_=!0)},p($,y){l=$,y&20&&o!==(o=l[19])&&n.value!==o&&(n.value=o),y&20&&u.value!==l[2].metadata[l[19]]&&Oe(u,l[2].metadata[l[19]])},d($){$&&T(e),_=!1,Ve(h)}}}function cs(l){let e,t,n,o,a,r;return{c(){e=f("div"),t=g(),n=f("div"),o=f("button"),o.innerHTML=`<span class="icon"><i class="fas fa-trash"></i></span> 
                <span>Delete</span>`,c(e,"class","control is-expanded"),c(o,"class","button is-danger is-outlined"),c(o,"data-testid","delete-context-button"),c(n,"class","control")},m(u,i){S(u,e,i),S(u,t,i),S(u,n,i),s(n,o),a||(r=re(o,"click",l[7]),a=!0)},p:Re,d(u){u&&T(e),u&&T(t),u&&T(n),a=!1,r()}}}function Ga(l){let e,t,n,o=l[1]==="edit"?"Edit Context Item":"Add Context Item",a,r,u,i,d,p,m=l[2]&&os(l);return{c(){e=f("div"),t=f("header"),n=f("p"),a=P(o),r=g(),u=f("button"),i=g(),m&&m.c(),c(n,"class","modal-card-title"),c(u,"class","delete"),c(u,"aria-label","close"),c(t,"class","modal-card-head"),c(e,"class","modal-card")},m(_,h){S(_,e,h),s(e,t),s(t,n),s(n,a),s(t,r),s(t,u),s(e,i),m&&m.m(e,null),d||(p=re(u,"click",l[5]),d=!0)},p(_,h){h&2&&o!==(o=_[1]==="edit"?"Edit Context Item":"Add Context Item")&&be(a,o),_[2]?m?m.p(_,h):(m=os(_),m.c(),m.m(e,null)):m&&(m.d(1),m=null)},d(_){_&&T(e),m&&m.d(),d=!1,p()}}}function Wa(l){let e,t,n,o;return e=new wl({props:{active:l[0],$$slots:{default:[Ga]},$$scope:{ctx:l}}}),e.$on("close",l[5]),{c(){he(e.$$.fragment)},m(a,r){ge(e,a,r),t=!0,n||(o=re(window,"keydown",l[8]),n=!0)},p(a,[r]){const u={};r&1&&(u.active=a[0]),r&67108878&&(u.$$scope={dirty:r,ctx:a}),e.$set(u)},i(a){t||(U(e.$$.fragment,a),t=!0)},o(a){Y(e.$$.fragment,a),t=!1},d(a){ve(e,a),n=!1,o()}}}function Ba(l,e,t){let n,{active:o=!1}=e,{context:a=null}=e,{mode:r="edit"}=e;const u=Ql();let i=null,d=[{value:"Document",label:"Document"},{value:"SearchResult",label:"Search Result"},{value:"UserInput",label:"User Input"},{value:"System",label:"System"},{value:"External",label:"External"}];function p(){t(0,o=!1),t(2,i=null),u("close")}function m(){!n||!i||(u(r==="edit"?"update":"create",i),p())}function _(){r==="edit"&&a&&(u("delete",a.id),p())}function h(I){I.key==="Escape"?p():I.key==="Enter"&&(I.ctrlKey||I.metaKey)&&m()}function w(){i.context_type=St(this),t(2,i),t(0,o),t(9,a),t(1,r),t(4,d)}function b(){i.title=this.value,t(2,i),t(0,o),t(9,a),t(1,r),t(4,d)}function k(){i.summary=this.value,t(2,i),t(0,o),t(9,a),t(1,r),t(4,d)}function $(){i.content=this.value,t(2,i),t(0,o),t(9,a),t(1,r),t(4,d)}const y=(I,N,R)=>{const F={...i.metadata};delete F[I],F[R.target.value]=N,t(2,i.metadata=F,i)};function v(I){i.metadata[I]=this.value,t(2,i),t(0,o),t(9,a),t(1,r),t(4,d)}const C=I=>{const N={...i.metadata};delete N[I],t(2,i.metadata=N,i)},q=()=>{t(2,i.metadata={...i.metadata,[`key_${Date.now()}`]:""},i)};return l.$$set=I=>{"active"in I&&t(0,o=I.active),"context"in I&&t(9,a=I.context),"mode"in I&&t(1,r=I.mode)},l.$$.update=()=>{l.$$.dirty&515&&(o&&a?t(2,i={...a,metadata:{...a.metadata}}):o&&r==="create"&&t(2,i={id:"",context_type:"UserInput",title:"",summary:"",content:"",metadata:{},created_at:new Date().toISOString(),relevance_score:null})),l.$$.dirty&4&&t(3,n=i&&i.title.trim()!==""&&i.content.trim()!=="")},[o,r,i,n,d,p,m,_,h,a,w,b,k,$,y,v,C,q]}class Ja extends _t{constructor(e){super(),ht(this,e,Ba,Wa,pt,{active:0,context:9,mode:1})}}function us(l,e,t){const n=l.slice();return n[35]=e[t],n}function fs(l,e,t){const n=l.slice();return n[38]=e[t],n[40]=t,n}function ds(l){let e,t=l[7],n=[];for(let o=0;o<t.length;o+=1)n[o]=ps(fs(l,t,o));return{c(){e=f("ul");for(let o=0;o<n.length;o+=1)n[o].c();c(e,"class","suggestions svelte-k0eopx"),c(e,"data-testid","kg-typeahead-list")},m(o,a){S(o,e,a);for(let r=0;r<n.length;r+=1)n[r]&&n[r].m(e,null)},p(o,a){if(a[0]&4480){t=o[7];let r;for(r=0;r<t.length;r+=1){const u=fs(o,t,r);n[r]?n[r].p(u,a):(n[r]=ps(u),n[r].c(),n[r].m(e,null))}for(;r<n.length;r+=1)n[r].d(1);n.length=t.length}},d(o){o&&T(e),tt(n,o)}}}function ps(l){let e,t=l[38]+"",n,o,a,r,u,i;function d(){return l[24](l[38])}function p(...m){return l[25](l[38],...m)}return{c(){e=f("li"),n=P(t),o=g(),c(e,"tabindex","0"),c(e,"role","option"),c(e,"aria-selected",a=l[40]===l[8]),c(e,"aria-label",r=`Apply suggestion: ${l[38]}`),c(e,"data-testid","kg-typeahead-item"),c(e,"class","svelte-k0eopx"),dt(e,"active",l[40]===l[8])},m(m,_){S(m,e,_),s(e,n),s(e,o),u||(i=[re(e,"click",d),re(e,"keydown",p)],u=!0)},p(m,_){l=m,_[0]&128&&t!==(t=l[38]+"")&&be(n,t),_[0]&256&&a!==(a=l[40]===l[8])&&c(e,"aria-selected",a),_[0]&128&&r!==(r=`Apply suggestion: ${l[38]}`)&&c(e,"aria-label",r),_[0]&256&&dt(e,"active",l[40]===l[8])},d(m){m&&T(e),u=!1,Ve(i)}}}function Qa(l){let e,t,n,o,a,r;function u(m){l[21](m)}function i(m){l[22](m)}let d={placeholder:"Search knowledge graph terms...",type:"search",disabled:l[4],icon:"search",expanded:!0,autofocus:!0,"data-testid":"kg-search-input"};l[2]!==void 0&&(d.element=l[2]),l[1]!==void 0&&(d.value=l[1]),t=new Qt({props:d}),lt.push(()=>st(t,"element",u)),lt.push(()=>st(t,"value",i)),t.$on("input",l[23]),t.$on("keydown",l[13]);let p=l[7].length>0&&ds(l);return{c(){e=f("div"),he(t.$$.fragment),a=g(),p&&p.c(),c(e,"class","input-wrapper svelte-k0eopx")},m(m,_){S(m,e,_),ge(t,e,null),s(e,a),p&&p.m(e,null),r=!0},p(m,_){const h={};_[0]&16&&(h.disabled=m[4]),!n&&_[0]&4&&(n=!0,h.element=m[2],rt(()=>n=!1)),!o&&_[0]&2&&(o=!0,h.value=m[1],rt(()=>o=!1)),t.$set(h),m[7].length>0?p?p.p(m,_):(p=ds(m),p.c(),p.m(e,null)):p&&(p.d(1),p=null)},i(m){r||(U(t.$$.fragment,m),r=!0)},o(m){Y(t.$$.fragment,m),r=!1},d(m){m&&T(e),ve(t),p&&p.d()}}}function ms(l){let e,t;return e=new Wl({props:{type:"is-danger","data-testid":"kg-search-error",$$slots:{default:[Va]},$$scope:{ctx:l}}}),{c(){he(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},p(n,o){const a={};o[0]&32|o[1]&1024&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(U(e.$$.fragment,n),t=!0)},o(n){Y(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function Va(l){let e;return{c(){e=P(l[5])},m(t,n){S(t,e,n)},p(t,n){n[0]&32&&be(e,t[5])},d(t){t&&T(e)}}}function Ya(l){let e,t,n,o,a,r,u;return{c(){e=f("div"),t=f("p"),t.textContent="Enter at least 2 characters to search the knowledge graph",n=g(),o=f("p"),a=P('This will search terms from the knowledge graph for role "'),r=P(l[9]),u=P('"'),c(t,"class","has-text-centered"),c(o,"class","has-text-centered is-size-7 mt-2"),c(e,"class","notification is-info is-light")},m(i,d){S(i,e,d),s(e,t),s(e,n),s(e,o),s(o,a),s(o,r),s(o,u)},p(i,d){d[0]&512&&be(r,i[9])},d(i){i&&T(e)}}}function Za(l){let e,t,n,o,a,r,u,i,d,p,m;return{c(){e=f("div"),t=f("p"),n=P('No knowledge graph terms found for "'),o=f("strong"),a=P(l[1]),r=P('"'),u=g(),i=f("p"),d=P('Try different keywords or check if the role "'),p=P(l[9]),m=P('" has a knowledge graph enabled.'),c(t,"class","has-text-centered"),c(i,"class","has-text-centered is-size-7 has-text-grey mt-2"),c(e,"class","notification is-light"),c(e,"data-testid","kg-search-empty")},m(_,h){S(_,e,h),s(e,t),s(t,n),s(t,o),s(o,a),s(t,r),s(e,u),s(e,i),s(i,d),s(i,p),s(i,m)},p(_,h){h[0]&2&&be(a,_[1]),h[0]&512&&be(p,_[9])},d(_){_&&T(e)}}}function Xa(l){let e,t=l[3],n=[];for(let o=0;o<t.length;o+=1)n[o]=vs(us(l,t,o));return{c(){e=f("div");for(let o=0;o<n.length;o+=1)n[o].c();c(e,"class","suggestions-container svelte-k0eopx"),c(e,"data-testid","kg-suggestions-list")},m(o,a){S(o,e,a);for(let r=0;r<n.length;r+=1)n[r]&&n[r].m(e,null)},p(o,a){if(a[0]&16456){t=o[3];let r;for(r=0;r<t.length;r+=1){const u=us(o,t,r);n[r]?n[r].p(u,a):(n[r]=vs(u),n[r].c(),n[r].m(e,null))}for(;r<n.length;r+=1)n[r].d(1);n.length=t.length}},d(o){o&&T(e),tt(n,o)}}}function xa(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="progress-container svelte-k0eopx"><div class="progress-bar svelte-k0eopx"><div class="progress-fill svelte-k0eopx"></div></div></div> 
          <p>Searching knowledge graph...</p>`,c(e,"class","empty-state svelte-k0eopx"),c(e,"data-testid","kg-search-loading")},m(t,n){S(t,e,n)},p:Re,d(t){t&&T(e)}}}function _s(l){let e,t,n=l[35].normalized_term+"",o;return{c(){e=f("span"),t=P("→ "),o=P(n),c(e,"class","has-text-grey")},m(a,r){S(a,e,r),s(e,t),s(e,o)},p(a,r){r[0]&8&&n!==(n=a[35].normalized_term+"")&&be(o,n)},d(a){a&&T(e)}}}function hs(l){let e,t=l[35].suggestion_type+"",n;return{c(){e=f("span"),n=P(t),c(e,"class","tag is-small is-light")},m(o,a){S(o,e,a),s(e,n)},p(o,a){a[0]&8&&t!==(t=o[35].suggestion_type+"")&&be(n,t)},d(o){o&&T(e)}}}function gs(l){let e,t=l[35].url+"",n;return{c(){e=f("div"),n=P(t),c(e,"class","suggestion-url svelte-k0eopx")},m(o,a){S(o,e,a),s(e,n)},p(o,a){a[0]&8&&t!==(t=o[35].url+"")&&be(n,t)},d(o){o&&T(e)}}}function vs(l){let e,t,n=l[35].term+"",o,a,r,u,i=(l[35].score*100).toFixed(0)+"",d,p,m,_,h,w,b,k,$,y=l[35].normalized_term&&l[35].normalized_term!==l[35].term&&_s(l),v=l[35].suggestion_type&&hs(l),C=l[35].url&&gs(l);function q(){return l[26](l[35])}function I(...N){return l[27](l[35],...N)}return{c(){var N;e=f("button"),t=f("div"),o=P(n),a=g(),r=f("div"),u=f("span"),d=P(i),p=P("%"),m=g(),y&&y.c(),_=g(),v&&v.c(),h=g(),C&&C.c(),w=g(),c(t,"class","suggestion-term svelte-k0eopx"),c(u,"class","tag is-info is-small"),c(r,"class","suggestion-meta svelte-k0eopx"),c(e,"class",b="suggestion-item "+(((N=l[6])==null?void 0:N.term)===l[35].term?"is-active":"")+" svelte-k0eopx"),c(e,"type","button"),c(e,"data-testid","kg-suggestion-item")},m(N,R){S(N,e,R),s(e,t),s(t,o),s(e,a),s(e,r),s(r,u),s(u,d),s(u,p),s(r,m),y&&y.m(r,null),s(r,_),v&&v.m(r,null),s(e,h),C&&C.m(e,null),s(e,w),k||($=[re(e,"click",q),re(e,"keydown",I)],k=!0)},p(N,R){var F;l=N,R[0]&8&&n!==(n=l[35].term+"")&&be(o,n),R[0]&8&&i!==(i=(l[35].score*100).toFixed(0)+"")&&be(d,i),l[35].normalized_term&&l[35].normalized_term!==l[35].term?y?y.p(l,R):(y=_s(l),y.c(),y.m(r,_)):y&&(y.d(1),y=null),l[35].suggestion_type?v?v.p(l,R):(v=hs(l),v.c(),v.m(r,null)):v&&(v.d(1),v=null),l[35].url?C?C.p(l,R):(C=gs(l),C.c(),C.m(e,w)):C&&(C.d(1),C=null),R[0]&72&&b!==(b="suggestion-item "+(((F=l[6])==null?void 0:F.term)===l[35].term?"is-active":"")+" svelte-k0eopx")&&c(e,"class",b)},d(N){N&&T(e),y&&y.d(),v&&v.d(),C&&C.d(),k=!1,Ve($)}}}function ec(l){let e;return{c(){e=P("Cancel")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function bs(l){let e,t;return e=new Kt({props:{type:"is-primary",disabled:!l[6],"data-testid":"kg-add-term-button",$$slots:{default:[tc]},$$scope:{ctx:l}}}),e.$on("click",l[15]),{c(){he(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},p(n,o){const a={};o[0]&64&&(a.disabled=!n[6]),o[0]&64|o[1]&1024&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(U(e.$$.fragment,n),t=!0)},o(n){Y(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function tc(l){let e,t=l[6].term+"",n,o;return{c(){e=P('Add "'),n=P(t),o=P('" to Context')},m(a,r){S(a,e,r),S(a,n,r),S(a,o,r)},p(a,r){r[0]&64&&t!==(t=a[6].term+"")&&be(n,t)},d(a){a&&T(e),a&&T(n),a&&T(o)}}}function lc(l){let e;return{c(){e=P("Add Complete Thesaurus to Context")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function nc(l){let e,t,n,o,a,r,u,i,d,p,m,_,h,w,b,k,$,y,v,C,q,I,N,R,F,le,V,L,A;i=new Ft({props:{$$slots:{default:[Qa]},$$scope:{ctx:l}}});let ee=l[5]&&ms(l);function K(Z,O){return O[0]&2&&(m=null),Z[4]?xa:Z[3].length>0?Xa:(m==null&&(m=Z[1].trim().length>=2),m?Za:Ya)}let X=K(l,[-1,-1]),x=X(l);b=new Kt({props:{$$slots:{default:[ec]},$$scope:{ctx:l}}}),b.$on("click",l[17]);let z=l[6]&&bs(l);return le=new Kt({props:{type:"is-link",size:"is-small",style:"width: 100%;","data-testid":"kg-add-index-button",$$slots:{default:[lc]},$$scope:{ctx:l}}}),le.$on("click",l[16]),{c(){e=f("div"),t=f("div"),n=f("button"),o=g(),a=f("div"),a.innerHTML=`<div class="modal-title svelte-k0eopx"><h3 class="svelte-k0eopx">Knowledge Graph Search</h3> 
          <p class="svelte-k0eopx">Search and add terms from the knowledge graph to your context</p></div>`,r=g(),u=f("div"),he(i.$$.fragment),d=g(),ee&&ee.c(),p=g(),x.c(),_=g(),h=f("div"),w=f("div"),he(b.$$.fragment),k=g(),z&&z.c(),$=g(),y=f("div"),v=f("div"),C=f("p"),q=f("strong"),q.textContent="Alternative:",I=P(' Add the complete thesaurus for role "'),N=P(l[9]),R=P('". This includes all domain-specific terms and their normalized mappings in JSON format for comprehensive vocabulary context.'),F=g(),he(le.$$.fragment),c(n,"class","delete is-large modal-close-btn svelte-k0eopx"),c(n,"aria-label","close"),c(a,"class","modal-header svelte-k0eopx"),c(u,"class","search-section svelte-k0eopx"),c(w,"class","action-buttons svelte-k0eopx"),c(h,"class","modal-actions svelte-k0eopx"),c(C,"class","svelte-k0eopx"),c(v,"class","alternative-content svelte-k0eopx"),c(y,"class","alternative-section svelte-k0eopx"),c(t,"class","kg-search-container svelte-k0eopx"),c(e,"class","box wrapper svelte-k0eopx"),c(e,"data-testid","kg-search-modal")},m(Z,O){S(Z,e,O),s(e,t),s(t,n),s(t,o),s(t,a),s(t,r),s(t,u),ge(i,u,null),s(t,d),ee&&ee.m(t,null),s(t,p),x.m(t,null),s(t,_),s(t,h),s(h,w),ge(b,w,null),s(w,k),z&&z.m(w,null),s(t,$),s(t,y),s(y,v),s(v,C),s(C,q),s(C,I),s(C,N),s(C,R),s(y,F),ge(le,y,null),V=!0,L||(A=[re(n,"click",l[17]),re(t,"keydown",l[18])],L=!0)},p(Z,O){const H={};O[0]&406|O[1]&1024&&(H.$$scope={dirty:O,ctx:Z}),i.$set(H),Z[5]?ee?(ee.p(Z,O),O[0]&32&&U(ee,1)):(ee=ms(Z),ee.c(),U(ee,1),ee.m(t,p)):ee&&(Fe(),Y(ee,1,1,()=>{ee=null}),Ke()),X===(X=K(Z,O))&&x?x.p(Z,O):(x.d(1),x=X(Z),x&&(x.c(),x.m(t,_)));const E={};O[1]&1024&&(E.$$scope={dirty:O,ctx:Z}),b.$set(E),Z[6]?z?(z.p(Z,O),O[0]&64&&U(z,1)):(z=bs(Z),z.c(),U(z,1),z.m(w,null)):z&&(Fe(),Y(z,1,1,()=>{z=null}),Ke()),(!V||O[0]&512)&&be(N,Z[9]);const M={};O[1]&1024&&(M.$$scope={dirty:O,ctx:Z}),le.$set(M)},i(Z){V||(U(i.$$.fragment,Z),U(ee),U(b.$$.fragment,Z),U(z),U(le.$$.fragment,Z),V=!0)},o(Z){Y(i.$$.fragment,Z),Y(ee),Y(b.$$.fragment,Z),Y(z),Y(le.$$.fragment,Z),V=!1},d(Z){Z&&T(e),ve(i),ee&&ee.d(),x.d(),ve(b),z&&z.d(),ve(le),L=!1,Ve(A)}}}function oc(l){let e,t,n;function o(r){l[28](r)}let a={$$slots:{default:[nc]},$$scope:{ctx:l}};return l[0]!==void 0&&(a.active=l[0]),e=new wl({props:a}),lt.push(()=>st(e,"active",o)),e.$on("close",l[17]),{c(){he(e.$$.fragment)},m(r,u){ge(e,r,u),n=!0},p(r,u){const i={};u[0]&1022|u[1]&1024&&(i.$$scope={dirty:u,ctx:r}),!t&&u[0]&1&&(t=!0,i.active=r[0],rt(()=>t=!1)),e.$set(i)},i(r){n||(U(e.$$.fragment,r),n=!0)},o(r){Y(e.$$.fragment,r),n=!1},d(r){ve(e,r)}}}function sc(l,e,t){let n,o;Ue(l,At,E=>t(9,n=E)),Ue(l,ct,E=>t(30,o=E));let{active:a=!1}=e,{initialQuery:r=""}=e,{conversationId:u=null}=e;const i=Ql();let d="",p=[],m=!1,_=null,h=null,w=null,b=[],k=-1,$;function y(){w&&clearTimeout(w),w=setTimeout(()=>{d.trim().length>=2?N():(t(3,p=[]),t(6,h=null))},300)}async function v(E){const M=E.trim();if(!M)return[];try{if(o){const B=await je("get_autocomplete_suggestions",{query:M,roleName:n,limit:8});if((B==null?void 0:B.status)==="success"&&Array.isArray(B.suggestions))return B.suggestions.map(oe=>oe.term)}else{const B=await fetch(`${Qe.ServerURL}/autocomplete/${encodeURIComponent(n)}/${encodeURIComponent(M)}`);if(B.ok){const oe=await B.json();if((oe==null?void 0:oe.status)==="success"&&Array.isArray(oe.suggestions))return oe.suggestions.map(D=>D.term)}}}catch(B){console.warn("KG typeahead failed",B)}return[]}async function C(){if(d.trim().length<1){t(7,b=[]),t(8,k=-1);return}t(7,b=await v(d)),t(8,k=-1)}async function q(E){t(6,h={term:E,score:1}),t(7,b=[]),t(8,k=-1),await F()}function I(E){b.length>0&&(E.key==="ArrowDown"?(E.preventDefault(),t(8,k=(k+1)%b.length)):E.key==="ArrowUp"?(E.preventDefault(),t(8,k=(k-1+b.length)%b.length)):(E.key==="Enter"||E.key==="Tab")&&k!==-1?(E.preventDefault(),q(b[k])):E.key==="Escape"&&(t(7,b=[]),t(8,k=-1)))}async function N(){if(!d.trim()||d.trim().length<2){t(3,p=[]);return}t(4,m=!0),t(5,_=null);try{if(o){const E=await je("search_kg_terms",{request:{query:d.trim(),role_name:n,limit:20,min_similarity:.6}});E.status==="success"?(t(3,p=E.suggestions||[]),p.length>0&&!h&&t(6,h=p[0])):(t(5,_=E.error||"Search failed"),t(3,p=[]))}else{if(!u){t(5,_="No active conversation. Please start a conversation first."),t(3,p=[]);return}const E=await fetch(`${Qe.ServerURL}/conversations/${u}/context/kg/search?query=${encodeURIComponent(d.trim())}&role=${encodeURIComponent(n)}`);if(E.ok){const M=await E.json();M.status==="success"?(t(3,p=M.suggestions||[]),p.length>0&&!h&&t(6,h=p[0])):(t(5,_=M.error||"Search failed"),t(3,p=[]))}else t(5,_=`HTTP ${E.status}: ${E.statusText}`),t(3,p=[])}}catch(E){console.error("KG search error:",E),t(5,_=`Search failed: ${E}`),t(3,p=[])}finally{t(4,m=!1)}}function R(E){t(6,h=E)}async function F(){if(h){if(!u){t(5,_="No active conversation. Please start a conversation first.");return}try{if(o)await je("add_kg_term_context",{request:{conversation_id:u,term:h.term,role_name:n}}),i("termAdded",{term:h.term,suggestion:h}),V();else{const E=await fetch(`${Qe.ServerURL}/conversations/${u}/context/kg/term`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({term:h.term,role:n})});if(E.ok){const M=await E.json();M.status==="success"?(i("termAdded",{term:h.term,suggestion:h}),V()):t(5,_=M.error||"Failed to add term to context")}else t(5,_=`HTTP ${E.status}: ${E.statusText}`)}}catch(E){console.error("Error adding term to context:",E),t(5,_=`Failed to add term to context: ${E}`)}}}async function le(){if(!u){t(5,_="No active conversation. Please start a conversation first.");return}try{if(o)await je("add_kg_index_context",{request:{conversation_id:u,role_name:n}}),i("kgIndexAdded",{role:n}),V();else{const E=await fetch(`${Qe.ServerURL}/conversations/${u}/context/kg/index`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({role:n})});if(E.ok){const M=await E.json();M.status==="success"?(i("kgIndexAdded",{role:n}),V()):t(5,_=M.error||"Failed to add KG index to context")}else t(5,_=`HTTP ${E.status}: ${E.statusText}`)}}catch(E){console.error("Error adding KG index to context:",E),t(5,_=`Failed to add KG index to context: ${E}`)}}function V(){t(0,a=!1),t(1,d=""),t(3,p=[]),t(6,h=null),t(5,_=null),t(4,m=!1),w&&(clearTimeout(w),w=null)}function L(E){switch(E.key){case"Escape":V();break;case"ArrowDown":E.preventDefault(),A(1);break;case"ArrowUp":E.preventDefault(),A(-1);break;case"Enter":E.preventDefault(),h&&F();break}}function A(E){if(p.length===0)return;let B=(h?p.findIndex(oe=>oe.term===(h==null?void 0:h.term)):-1)+E;B<0?B=p.length-1:B>=p.length&&(B=0),t(6,h=p[B])}Ks(()=>{w&&clearTimeout(w)});function ee(E){$=E,t(2,$)}function K(E){d=E,t(1,d),t(0,a),t(19,r)}const X=()=>{y(),C()},x=E=>q(E),z=(E,M)=>{(M.key==="Enter"||M.key===" ")&&(M.preventDefault(),q(E))},Z=E=>R(E),O=(E,M)=>M.key==="Enter"&&R(E);function H(E){a=E,t(0,a)}return l.$$set=E=>{"active"in E&&t(0,a=E.active),"initialQuery"in E&&t(19,r=E.initialQuery),"conversationId"in E&&t(20,u=E.conversationId)},l.$$.update=()=>{l.$$.dirty[0]&524291&&a&&r!==d&&(t(1,d=r),d.trim()&&N()),l.$$.dirty[0]&5&&a&&$&&setTimeout(()=>{$==null||$.focus(),t(5,_=null)},100)},[a,d,$,p,m,_,h,b,k,n,y,C,q,I,R,F,le,V,L,r,u,ee,K,X,x,z,Z,O,H]}class rc extends _t{constructor(e){super(),ht(this,e,sc,oc,pt,{active:0,initialQuery:19,conversationId:20},null,[-1,-1])}}function ic(l){const e=l.slice(),t=e[0].kg_index_info;return e[9]=t,e}function ac(l){const e=l.slice(),t=e[0].kg_term_definition;return e[8]=t,e}function cc(l){let e=l[0].context_type==="KGTermDefinition"?"KG Term":"KG Index",t;return{c(){t=P(e)},m(n,o){S(n,t,o)},p(n,o){o&1&&e!==(e=n[0].context_type==="KGTermDefinition"?"KG Term":"KG Index")&&be(t,e)},d(n){n&&T(t)}}}function uc(l){let e,t;return e=new Vt({props:{icon:"fas fa-eye",size:"is-small"}}),{c(){he(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},p:Re,i(n){t||(U(e.$$.fragment,n),t=!0)},o(n){Y(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function ks(l){let e,t;return e=new Kt({props:{size:"is-small",type:"is-ghost",title:"Remove from context",$$slots:{default:[fc]},$$scope:{ctx:l}}}),e.$on("click",l[5]),{c(){he(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},p(n,o){const a={};o&1024&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(U(e.$$.fragment,n),t=!0)},o(n){Y(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function fc(l){let e,t;return e=new Vt({props:{icon:"fas fa-times",size:"is-small"}}),{c(){he(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},p:Re,i(n){t||(U(e.$$.fragment,n),t=!0)},o(n){Y(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function dc(l){let e,t,n,o=dl(l[9].total_terms)+"",a,r,u,i,d,p,m,_=dl(l[9].total_nodes)+"",h,w,b,k,$,y,v,C=dl(l[9].total_edges)+"",q,I,N,R,F,le,V,L=(l[9].version||"N/A")+"",A,ee,K,X,x,z,Z,O=!l[2]&&ws();return{c(){e=f("div"),t=f("div"),n=f("div"),a=P(o),u=g(),i=f("div"),i.textContent="Terms",d=g(),p=f("div"),m=f("div"),h=P(_),b=g(),k=f("div"),k.textContent="Nodes",$=g(),y=f("div"),v=f("div"),q=P(C),N=g(),R=f("div"),R.textContent="Edges",F=g(),le=f("div"),V=f("div"),A=P(L),K=g(),X=f("div"),X.textContent="Version",z=g(),O&&O.c(),Z=ut(),c(n,"class",r="stat-value "+(l[2]?"compact":"")+" svelte-lkmjyw"),c(i,"class","stat-label svelte-lkmjyw"),c(t,"class","stat-item svelte-lkmjyw"),c(m,"class",w="stat-value "+(l[2]?"compact":"")+" svelte-lkmjyw"),c(k,"class","stat-label svelte-lkmjyw"),c(p,"class","stat-item svelte-lkmjyw"),c(v,"class",I="stat-value "+(l[2]?"compact":"")+" svelte-lkmjyw"),c(R,"class","stat-label svelte-lkmjyw"),c(y,"class","stat-item svelte-lkmjyw"),c(V,"class",ee="stat-value "+(l[2]?"compact":"")+" svelte-lkmjyw"),c(X,"class","stat-label svelte-lkmjyw"),c(le,"class","stat-item svelte-lkmjyw"),c(e,"class",x="kg-index-stats "+(l[2]?"compact":"")+" svelte-lkmjyw")},m(H,E){S(H,e,E),s(e,t),s(t,n),s(n,a),s(t,u),s(t,i),s(e,d),s(e,p),s(p,m),s(m,h),s(p,b),s(p,k),s(e,$),s(e,y),s(y,v),s(v,q),s(y,N),s(y,R),s(e,F),s(e,le),s(le,V),s(V,A),s(le,K),s(le,X),S(H,z,E),O&&O.m(H,E),S(H,Z,E)},p(H,E){E&1&&o!==(o=dl(H[9].total_terms)+"")&&be(a,o),E&4&&r!==(r="stat-value "+(H[2]?"compact":"")+" svelte-lkmjyw")&&c(n,"class",r),E&1&&_!==(_=dl(H[9].total_nodes)+"")&&be(h,_),E&4&&w!==(w="stat-value "+(H[2]?"compact":"")+" svelte-lkmjyw")&&c(m,"class",w),E&1&&C!==(C=dl(H[9].total_edges)+"")&&be(q,C),E&4&&I!==(I="stat-value "+(H[2]?"compact":"")+" svelte-lkmjyw")&&c(v,"class",I),E&1&&L!==(L=(H[9].version||"N/A")+"")&&be(A,L),E&4&&ee!==(ee="stat-value "+(H[2]?"compact":"")+" svelte-lkmjyw")&&c(V,"class",ee),E&4&&x!==(x="kg-index-stats "+(H[2]?"compact":"")+" svelte-lkmjyw")&&c(e,"class",x),H[2]?O&&(O.d(1),O=null):O||(O=ws(),O.c(),O.m(Z.parentNode,Z))},i:Re,o:Re,d(H){H&&T(e),H&&T(z),O&&O.d(H),H&&T(Z)}}}function pc(l){let e,t,n,o,a,r,u,i,d,p=l[8].definition&&ys(l),m=l[8].synonyms.length>0&&$s(l),_=l[8].related_terms.length>0&&Cs(l),h=l[8].usage_examples.length>0&&Ts(l),w=l[8].url&&Ss(l);return{c(){e=f("div"),p&&p.c(),t=g(),n=f("div"),m&&m.c(),o=g(),_&&_.c(),a=g(),h&&h.c(),r=g(),w&&w.c(),c(n,"class",u="term-metadata "+(l[2]?"compact":"")+" svelte-lkmjyw"),c(e,"class",i="term-definition "+(l[2]?"compact":"")+" svelte-lkmjyw")},m(b,k){S(b,e,k),p&&p.m(e,null),s(e,t),s(e,n),m&&m.m(n,null),s(n,o),_&&_.m(n,null),s(n,a),h&&h.m(n,null),s(n,r),w&&w.m(n,null),d=!0},p(b,k){b[8].definition?p?p.p(b,k):(p=ys(b),p.c(),p.m(e,t)):p&&(p.d(1),p=null),b[8].synonyms.length>0?m?(m.p(b,k),k&1&&U(m,1)):(m=$s(b),m.c(),U(m,1),m.m(n,o)):m&&(Fe(),Y(m,1,1,()=>{m=null}),Ke()),b[8].related_terms.length>0?_?(_.p(b,k),k&1&&U(_,1)):(_=Cs(b),_.c(),U(_,1),_.m(n,a)):_&&(Fe(),Y(_,1,1,()=>{_=null}),Ke()),b[8].usage_examples.length>0?h?(h.p(b,k),k&1&&U(h,1)):(h=Ts(b),h.c(),U(h,1),h.m(n,r)):h&&(Fe(),Y(h,1,1,()=>{h=null}),Ke()),b[8].url?w?k&1&&U(w,1):(w=Ss(b),w.c(),U(w,1),w.m(n,null)):w&&(Fe(),Y(w,1,1,()=>{w=null}),Ke()),(!d||k&4&&u!==(u="term-metadata "+(b[2]?"compact":"")+" svelte-lkmjyw"))&&c(n,"class",u),(!d||k&4&&i!==(i="term-definition "+(b[2]?"compact":"")+" svelte-lkmjyw"))&&c(e,"class",i)},i(b){d||(U(m),U(_),U(h),U(w),d=!0)},o(b){Y(m),Y(_),Y(h),Y(w),d=!1},d(b){b&&T(e),p&&p.d(),m&&m.d(),_&&_.d(),h&&h.d(),w&&w.d()}}}function ws(l){let e;return{c(){e=f("div"),e.innerHTML='<p class="is-size-7"><strong>Thesaurus Data:</strong> This context item contains the complete thesaurus as JSON, providing all domain-specific vocabulary and term mappings for comprehensive AI understanding.</p>',c(e,"class","notification is-success is-light mt-3")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function ys(l){let e,t=l[8].definition+"",n,o;return{c(){e=f("div"),n=P(t),c(e,"class",o="definition-text "+(l[2]?"compact":"")+" svelte-lkmjyw")},m(a,r){S(a,e,r),s(e,n)},p(a,r){r&1&&t!==(t=a[8].definition+"")&&be(n,t),r&4&&o!==(o="definition-text "+(a[2]?"compact":"")+" svelte-lkmjyw")&&c(e,"class",o)},d(a){a&&T(e)}}}function $s(l){let e,t;return e=new qt({props:{type:"is-light",size:"is-small",title:"Synonyms",$$slots:{default:[mc]},$$scope:{ctx:l}}}),{c(){he(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},p(n,o){const a={};o&1025&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(U(e.$$.fragment,n),t=!0)},o(n){Y(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function mc(l){let e,t,n,o=l[8].synonyms.length+"",a,r,u=l[8].synonyms.length!==1?"s":"",i,d;return e=new Vt({props:{icon:"fas fa-equals",size:"is-small"}}),{c(){he(e.$$.fragment),t=g(),n=f("span"),a=P(o),r=P(" synonym"),i=P(u)},m(p,m){ge(e,p,m),S(p,t,m),S(p,n,m),s(n,a),s(n,r),s(n,i),d=!0},p(p,m){(!d||m&1)&&o!==(o=p[8].synonyms.length+"")&&be(a,o),(!d||m&1)&&u!==(u=p[8].synonyms.length!==1?"s":"")&&be(i,u)},i(p){d||(U(e.$$.fragment,p),d=!0)},o(p){Y(e.$$.fragment,p),d=!1},d(p){ve(e,p),p&&T(t),p&&T(n)}}}function Cs(l){let e,t;return e=new qt({props:{type:"is-light",size:"is-small",title:"Related Terms",$$slots:{default:[_c]},$$scope:{ctx:l}}}),{c(){he(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},p(n,o){const a={};o&1025&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(U(e.$$.fragment,n),t=!0)},o(n){Y(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function _c(l){let e,t,n,o=l[8].related_terms.length+"",a,r,u;return e=new Vt({props:{icon:"fas fa-link",size:"is-small"}}),{c(){he(e.$$.fragment),t=g(),n=f("span"),a=P(o),r=P(" related")},m(i,d){ge(e,i,d),S(i,t,d),S(i,n,d),s(n,a),s(n,r),u=!0},p(i,d){(!u||d&1)&&o!==(o=i[8].related_terms.length+"")&&be(a,o)},i(i){u||(U(e.$$.fragment,i),u=!0)},o(i){Y(e.$$.fragment,i),u=!1},d(i){ve(e,i),i&&T(t),i&&T(n)}}}function Ts(l){let e,t;return e=new qt({props:{type:"is-light",size:"is-small",title:"Usage Examples",$$slots:{default:[hc]},$$scope:{ctx:l}}}),{c(){he(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},p(n,o){const a={};o&1025&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(U(e.$$.fragment,n),t=!0)},o(n){Y(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function hc(l){let e,t,n,o=l[8].usage_examples.length+"",a,r,u=l[8].usage_examples.length!==1?"s":"",i,d;return e=new Vt({props:{icon:"fas fa-quote-left",size:"is-small"}}),{c(){he(e.$$.fragment),t=g(),n=f("span"),a=P(o),r=P(" example"),i=P(u)},m(p,m){ge(e,p,m),S(p,t,m),S(p,n,m),s(n,a),s(n,r),s(n,i),d=!0},p(p,m){(!d||m&1)&&o!==(o=p[8].usage_examples.length+"")&&be(a,o),(!d||m&1)&&u!==(u=p[8].usage_examples.length!==1?"s":"")&&be(i,u)},i(p){d||(U(e.$$.fragment,p),d=!0)},o(p){Y(e.$$.fragment,p),d=!1},d(p){ve(e,p),p&&T(t),p&&T(n)}}}function Ss(l){let e,t;return e=new qt({props:{type:"is-link",size:"is-small",$$slots:{default:[gc]},$$scope:{ctx:l}}}),{c(){he(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},i(n){t||(U(e.$$.fragment,n),t=!0)},o(n){Y(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function gc(l){let e,t,n,o;return e=new Vt({props:{icon:"fas fa-external-link-alt",size:"is-small"}}),{c(){he(e.$$.fragment),t=g(),n=f("span"),n.textContent="Source"},m(a,r){ge(e,a,r),S(a,t,r),S(a,n,r),o=!0},p:Re,i(a){o||(U(e.$$.fragment,a),o=!0)},o(a){Y(e.$$.fragment,a),o=!1},d(a){ve(e,a),a&&T(t),a&&T(n)}}}function Rs(l){let e,t=l[0].summary+"",n;return{c(){e=f("div"),n=P(t),c(e,"class","context-summary svelte-lkmjyw")},m(o,a){S(o,e,a),s(e,n)},p(o,a){a&1&&t!==(t=o[0].summary+"")&&be(n,t)},d(o){o&&T(e)}}}function As(l){let e,t,n=(l[0].relevance_score*100).toFixed(0)+"",o,a;return{c(){e=f("span"),t=P("Relevance: "),o=P(n),a=P("%"),c(e,"class","relevance-score svelte-lkmjyw")},m(r,u){S(r,e,u),s(e,t),s(e,o),s(e,a)},p(r,u){u&1&&n!==(n=(r[0].relevance_score*100).toFixed(0)+"")&&be(o,n)},d(r){r&&T(e)}}}function Es(l){let e,t,n,o=(l[0].metadata.document_title||l[0].metadata.source_document)+"",a,r;return t=new Vt({props:{icon:"fas fa-file-alt",size:"is-small"}}),{c(){e=f("span"),he(t.$$.fragment),n=g(),a=P(o),c(e,"title","Source Document")},m(u,i){S(u,e,i),ge(t,e,null),s(e,n),s(e,a),r=!0},p(u,i){(!r||i&1)&&o!==(o=(u[0].metadata.document_title||u[0].metadata.source_document)+"")&&be(a,o)},i(u){r||(U(t.$$.fragment,u),r=!0)},o(u){Y(t.$$.fragment,u),r=!1},d(u){u&&T(e),ve(t)}}}function vc(l){let e,t,n,o,a,r,u=l[0].title+"",i,d,p,m,_,h,w,b,k,$,y,v,C,q,I,N,R,F,le,V=Ls(l[0].created_at)+"",L,A,ee,K,X,x;o=new Vt({props:{icon:l[4],size:"is-small"}}),m=new qt({props:{type:l[3],size:"is-small",$$slots:{default:[cc]},$$scope:{ctx:l}}}),w=new Kt({props:{size:"is-small",type:"is-ghost",title:"View details",$$slots:{default:[uc]},$$scope:{ctx:l}}}),w.$on("click",l[6]);let z=l[1]&&ks(l);const Z=[pc,dc],O=[];function H(D,j){return D[0].context_type==="KGTermDefinition"&&D[0].kg_term_definition?0:D[0].context_type==="KGIndex"&&D[0].kg_index_info?1:-1}function E(D,j){if(j===0)return ac(D);if(j===1)return ic(D)}~(v=H(l))&&(C=O[v]=Z[v](E(l,v)));let M=l[0].summary&&!l[2]&&Rs(l),B=l[0].relevance_score&&As(l),oe=l[0].metadata.source_document&&Es(l);return{c(){e=f("div"),t=f("div"),n=f("div"),he(o.$$.fragment),a=g(),r=f("span"),i=P(u),p=g(),he(m.$$.fragment),_=g(),h=f("div"),he(w.$$.fragment),b=g(),z&&z.c(),$=g(),y=f("div"),C&&C.c(),q=g(),M&&M.c(),N=g(),R=f("div"),F=f("span"),le=P("Added "),L=P(V),A=g(),B&&B.c(),ee=g(),oe&&oe.c(),c(r,"class",d="context-title-text "+(l[2]?"compact":"")+" svelte-lkmjyw"),c(n,"class","context-title svelte-lkmjyw"),c(h,"class","context-actions svelte-lkmjyw"),c(t,"class",k="context-header "+(l[2]?"compact":"")+" svelte-lkmjyw"),c(y,"class",I="context-content "+(l[2]?"compact":"")+" svelte-lkmjyw"),c(R,"class",K="context-meta "+(l[2]?"compact":"")+" svelte-lkmjyw"),c(e,"class",X="kg-context-item "+(l[2]?"compact":"")+" svelte-lkmjyw")},m(D,j){S(D,e,j),s(e,t),s(t,n),ge(o,n,null),s(n,a),s(n,r),s(r,i),s(n,p),ge(m,n,null),s(t,_),s(t,h),ge(w,h,null),s(h,b),z&&z.m(h,null),s(e,$),s(e,y),~v&&O[v].m(y,null),s(y,q),M&&M.m(y,null),s(e,N),s(e,R),s(R,F),s(F,le),s(F,L),s(R,A),B&&B.m(R,null),s(R,ee),oe&&oe.m(R,null),x=!0},p(D,[j]){const W={};j&16&&(W.icon=D[4]),o.$set(W),(!x||j&1)&&u!==(u=D[0].title+"")&&be(i,u),(!x||j&4&&d!==(d="context-title-text "+(D[2]?"compact":"")+" svelte-lkmjyw"))&&c(r,"class",d);const ae={};j&8&&(ae.type=D[3]),j&1025&&(ae.$$scope={dirty:j,ctx:D}),m.$set(ae);const ce={};j&1024&&(ce.$$scope={dirty:j,ctx:D}),w.$set(ce),D[1]?z?(z.p(D,j),j&2&&U(z,1)):(z=ks(D),z.c(),U(z,1),z.m(h,null)):z&&(Fe(),Y(z,1,1,()=>{z=null}),Ke()),(!x||j&4&&k!==(k="context-header "+(D[2]?"compact":"")+" svelte-lkmjyw"))&&c(t,"class",k);let se=v;v=H(D),v===se?~v&&O[v].p(E(D,v),j):(C&&(Fe(),Y(O[se],1,1,()=>{O[se]=null}),Ke()),~v?(C=O[v],C?C.p(E(D,v),j):(C=O[v]=Z[v](E(D,v)),C.c()),U(C,1),C.m(y,q)):C=null),D[0].summary&&!D[2]?M?M.p(D,j):(M=Rs(D),M.c(),M.m(y,null)):M&&(M.d(1),M=null),(!x||j&4&&I!==(I="context-content "+(D[2]?"compact":"")+" svelte-lkmjyw"))&&c(y,"class",I),(!x||j&1)&&V!==(V=Ls(D[0].created_at)+"")&&be(L,V),D[0].relevance_score?B?B.p(D,j):(B=As(D),B.c(),B.m(R,ee)):B&&(B.d(1),B=null),D[0].metadata.source_document?oe?(oe.p(D,j),j&1&&U(oe,1)):(oe=Es(D),oe.c(),U(oe,1),oe.m(R,null)):oe&&(Fe(),Y(oe,1,1,()=>{oe=null}),Ke()),(!x||j&4&&K!==(K="context-meta "+(D[2]?"compact":"")+" svelte-lkmjyw"))&&c(R,"class",K),(!x||j&4&&X!==(X="kg-context-item "+(D[2]?"compact":"")+" svelte-lkmjyw"))&&c(e,"class",X)},i(D){x||(U(o.$$.fragment,D),U(m.$$.fragment,D),U(w.$$.fragment,D),U(z),U(C),U(oe),x=!0)},o(D){Y(o.$$.fragment,D),Y(m.$$.fragment,D),Y(w.$$.fragment,D),Y(z),Y(C),Y(oe),x=!1},d(D){D&&T(e),ve(o),ve(m),ve(w),z&&z.d(),~v&&O[v].d(),M&&M.d(),B&&B.d(),oe&&oe.d()}}}function dl(l){return new Intl.NumberFormat().format(l)}function Ls(l){try{return new Date(l).toLocaleDateString()}catch{return l}}function bc(l,e,t){let n,o,{contextItem:a}=e,{removable:r=!0}=e,{compact:u=!1}=e;const i=Ql();function d(){i("remove",{contextId:a.id})}function p(){i("viewDetails",{contextItem:a})}return l.$$set=m=>{"contextItem"in m&&t(0,a=m.contextItem),"removable"in m&&t(1,r=m.removable),"compact"in m&&t(2,u=m.compact)},l.$$.update=()=>{l.$$.dirty&1&&t(4,n=a.context_type==="KGTermDefinition"?"fas fa-tag":"fas fa-sitemap"),l.$$.dirty&1&&t(3,o=a.context_type==="KGTermDefinition"?"is-info":"is-primary")},[a,r,u,o,n,d,p]}class kc extends _t{constructor(e){super(),ht(this,e,bc,vc,pt,{contextItem:0,removable:1,compact:2})}}function Ds(l,e,t){const n=l.slice();return n[47]=e[t],n[49]=t,n}function Os(l,e,t){const n=l.slice();return n[50]=e[t],n[52]=t,n}function Ns(l){let e,t,n;return{c(){e=f("p"),t=P("Conversation ID: "),n=P(l[5]),c(e,"class","is-size-7 has-text-grey")},m(o,a){S(o,e,a),s(e,t),s(e,n)},p(o,a){a[0]&32&&be(n,o[5])},d(o){o&&T(e)}}}function Is(l){let e,t,n,o=l[50].content+"",a,r;return{c(){e=f("div"),t=f("div"),n=f("pre"),a=P(o),c(n,"class","svelte-rbq0zi"),c(t,"class","bubble svelte-rbq0zi"),c(e,"class",r=Pt(`msg ${l[50].role}`)+" svelte-rbq0zi")},m(u,i){S(u,e,i),s(e,t),s(t,n),s(n,a)},p(u,i){i[0]&1&&o!==(o=u[50].content+"")&&be(a,o),i[0]&1&&r!==(r=Pt(`msg ${u[50].role}`)+" svelte-rbq0zi")&&c(e,"class",r)},d(u){u&&T(e)}}}function Ps(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="bubble loading svelte-rbq0zi"><span class="icon is-small"><i class="fas fa-spinner fa-spin"></i></span> 
            <span>Thinking...</span></div>`,c(e,"class","msg assistant svelte-rbq0zi")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function Ms(l){let e,t,n;return{c(){e=f("p"),t=P("Model: "),n=P(l[4]),c(e,"class","is-size-7 has-text-grey")},m(o,a){S(o,e,a),s(e,t),s(e,n)},p(o,a){a[0]&16&&be(n,o[4])},d(o){o&&T(e)}}}function js(l){let e,t;return{c(){e=f("p"),t=P(l[3]),c(e,"class","has-text-danger is-size-7")},m(n,o){S(n,e,o),s(e,t)},p(n,o){o[0]&8&&be(t,n[3])},d(n){n&&T(e)}}}function wc(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-refresh"></i>',c(e,"class","icon is-small")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function yc(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-spinner fa-spin"></i>',c(e,"class","icon is-small")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function Us(l){let e,t,n,o,a,r,u,i,d,p,m,_,h,w,b,k,$,y,v,C,q,I,N,R,F,le,V,L,A,ee,K,X,x,z,Z,O,H,E;function M(D,j){return D[12]?Cc:$c}let B=M(l),oe=B(l);return{c(){e=f("div"),t=f("div"),n=f("label"),n.textContent="Context Type",o=g(),a=f("div"),r=f("div"),u=f("select"),i=f("option"),i.textContent="Document",d=f("option"),d.textContent="Search Result",p=f("option"),p.textContent="User Input",m=f("option"),m.textContent="Note",_=g(),h=f("div"),w=f("label"),w.textContent="Title",b=g(),k=f("div"),$=f("input"),y=g(),v=f("div"),C=f("label"),C.textContent="Content",q=g(),I=f("div"),N=f("textarea"),R=g(),F=f("div"),le=f("div"),V=f("button"),oe.c(),L=g(),A=f("span"),A.textContent="Save Context",K=g(),X=f("div"),x=f("button"),z=f("span"),z.innerHTML='<i class="fas fa-times"></i>',Z=g(),O=f("span"),O.textContent="Cancel",c(n,"class","label is-small"),i.__value="document",i.value=i.__value,d.__value="search_result",d.value=d.__value,p.__value="user_input",p.value=p.__value,m.__value="note",m.value=m.__value,c(u,"data-testid","context-type-select"),l[11]===void 0&&mt(()=>l[30].call(u)),c(r,"class","select is-small is-fullwidth"),c(a,"class","control"),c(t,"class","field"),c(w,"class","label is-small"),c($,"class","input is-small"),c($,"type","text"),c($,"placeholder","Enter context title"),c($,"data-testid","context-title-input"),c(k,"class","control"),c(h,"class","field"),c(C,"class","label is-small"),c(N,"class","textarea is-small"),c(N,"rows","4"),c(N,"placeholder","Enter context content"),c(N,"data-testid","context-content-textarea"),c(I,"class","control"),c(v,"class","field"),c(V,"class","button is-primary is-small"),V.disabled=ee=l[12]||!l[9].trim()||!l[10].trim(),c(V,"data-testid","add-context-submit-button"),c(le,"class","control"),c(z,"class","icon is-small"),c(x,"class","button is-light is-small"),x.disabled=l[12],c(X,"class","control"),c(F,"class","field is-grouped"),c(e,"class","box has-background-light mb-4"),c(e,"data-testid","add-context-form")},m(D,j){S(D,e,j),s(e,t),s(t,n),s(t,o),s(t,a),s(a,r),s(r,u),s(u,i),s(u,d),s(u,p),s(u,m),Je(u,l[11],!0),s(e,_),s(e,h),s(h,w),s(h,b),s(h,k),s(k,$),Oe($,l[9]),s(e,y),s(e,v),s(v,C),s(v,q),s(v,I),s(I,N),Oe(N,l[10]),s(e,R),s(e,F),s(F,le),s(le,V),oe.m(V,null),s(V,L),s(V,A),s(F,K),s(F,X),s(X,x),s(x,z),s(x,Z),s(x,O),H||(E=[re(u,"change",l[30]),re($,"input",l[31]),re(N,"input",l[32]),re(V,"click",l[19]),re(x,"click",l[18])],H=!0)},p(D,j){j[0]&2048&&Je(u,D[11]),j[0]&512&&$.value!==D[9]&&Oe($,D[9]),j[0]&1024&&Oe(N,D[10]),B!==(B=M(D))&&(oe.d(1),oe=B(D),oe&&(oe.c(),oe.m(V,L))),j[0]&5632&&ee!==(ee=D[12]||!D[9].trim()||!D[10].trim())&&(V.disabled=ee),j[0]&4096&&(x.disabled=D[12])},d(D){D&&T(e),oe.d(),H=!1,Ve(E)}}}function $c(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-save"></i>',c(e,"class","icon is-small")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function Cc(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-spinner fa-spin"></i>',c(e,"class","icon is-small")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function Tc(l){let e,t,n=l[6],o=[];for(let r=0;r<n.length;r+=1)o[r]=Fs(Ds(l,n,r));const a=r=>Y(o[r],1,1,()=>{o[r]=null});return{c(){e=f("div");for(let r=0;r<o.length;r+=1)o[r].c();c(e,"class","context-items svelte-rbq0zi"),c(e,"data-testid","conversation-context")},m(r,u){S(r,e,u);for(let i=0;i<o.length;i+=1)o[i]&&o[i].m(e,null);t=!0},p(r,u){if(u[0]&7340096){n=r[6];let i;for(i=0;i<n.length;i+=1){const d=Ds(r,n,i);o[i]?(o[i].p(d,u),U(o[i],1)):(o[i]=Fs(d),o[i].c(),U(o[i],1),o[i].m(e,null))}for(Fe(),i=n.length;i<o.length;i+=1)a(i);Ke()}},i(r){if(!t){for(let u=0;u<n.length;u+=1)U(o[u]);t=!0}},o(r){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)Y(o[u]);t=!1},d(r){r&&T(e),tt(o,r)}}}function Sc(l){let e;return{c(){e=f("div"),e.innerHTML=`<span class="icon is-large"><i class="fas fa-inbox fa-2x"></i></span> 
              <p class="is-size-6">No context items yet</p> 
              <p class="is-size-7">Add documents from search results to provide context for your chat.</p>`,c(e,"class","has-text-centered has-text-grey-light"),c(e,"data-testid","empty-context-message")},m(t,n){S(t,e,n)},p:Re,i:Re,o:Re,d(t){t&&T(e)}}}function Rc(l){let e,t,n,o,a,r=l[47].context_type.replace(/([A-Z])/g," $1").trim()+"",u,i,d,p,m,_,h,w,b,k,$,y,v,C,q,I=l[47].title+"",N,R,F,le,V,L,A=new Date(l[47].created_at).toLocaleString()+"",ee,K,X,x,z,Z=l[47].relevance_score&&zs(l);function O(){return l[35](l[47])}function H(){return l[36](l[47])}function E(oe,D){return oe[47].summary?Lc:Ec}let M=E(l),B=M(l);return{c(){e=f("div"),t=f("div"),n=f("div"),o=f("div"),a=f("span"),u=P(r),d=g(),p=f("div"),m=f("div"),Z&&Z.c(),_=g(),h=f("div"),w=f("div"),b=f("div"),k=f("button"),k.innerHTML='<span class="icon is-small"><i class="fas fa-edit"></i></span>',$=g(),y=f("div"),v=f("button"),v.innerHTML='<span class="icon is-small"><i class="fas fa-trash"></i></span>',C=g(),q=f("h6"),N=P(I),R=g(),F=f("div"),B.c(),le=g(),V=f("div"),L=P("Added: "),ee=P(A),c(a,"class",i="tag is-small "+(l[47].context_type==="Document"?"is-info":l[47].context_type==="SearchResult"?"is-primary":l[47].context_type==="UserInput"?"is-warning":"is-light")),c(a,"data-testid",`context-type-${l[49]}`),c(o,"class","level-item"),c(n,"class","level-left"),c(m,"class","level-item"),c(k,"class","button is-small is-light"),c(k,"data-testid",`edit-context-${l[49]}`),c(k,"title","Edit context"),c(b,"class","control"),c(v,"class","button is-small is-light is-danger"),c(v,"data-testid",`delete-context-${l[49]}`),c(v,"title","Delete context"),c(y,"class","control"),c(w,"class","field is-grouped"),c(h,"class","level-item context-actions svelte-rbq0zi"),c(p,"class","level-right"),c(t,"class","level is-mobile"),c(q,"class","title is-6 has-text-dark"),c(q,"data-testid",`context-title-${l[49]}`),c(F,"class","content is-small"),c(V,"class","is-size-7 has-text-grey"),c(e,"class","context-item svelte-rbq0zi"),c(e,"data-context-id",K=l[47].id),c(e,"data-testid",`context-item-${l[49]}`),c(e,"data-context-type",X=l[47].context_type)},m(oe,D){S(oe,e,D),s(e,t),s(t,n),s(n,o),s(o,a),s(a,u),s(t,d),s(t,p),s(p,m),Z&&Z.m(m,null),s(p,_),s(p,h),s(h,w),s(w,b),s(b,k),s(w,$),s(w,y),s(y,v),s(e,C),s(e,q),s(q,N),s(e,R),s(e,F),B.m(F,null),s(e,le),s(e,V),s(V,L),s(V,ee),x||(z=[re(k,"click",O),re(v,"click",H)],x=!0)},p(oe,D){l=oe,D[0]&64&&r!==(r=l[47].context_type.replace(/([A-Z])/g," $1").trim()+"")&&be(u,r),D[0]&64&&i!==(i="tag is-small "+(l[47].context_type==="Document"?"is-info":l[47].context_type==="SearchResult"?"is-primary":l[47].context_type==="UserInput"?"is-warning":"is-light"))&&c(a,"class",i),l[47].relevance_score?Z?Z.p(l,D):(Z=zs(l),Z.c(),Z.m(m,null)):Z&&(Z.d(1),Z=null),D[0]&64&&I!==(I=l[47].title+"")&&be(N,I),M===(M=E(l))&&B?B.p(l,D):(B.d(1),B=M(l),B&&(B.c(),B.m(F,null))),D[0]&64&&A!==(A=new Date(l[47].created_at).toLocaleString()+"")&&be(ee,A),D[0]&64&&K!==(K=l[47].id)&&c(e,"data-context-id",K),D[0]&64&&X!==(X=l[47].context_type)&&c(e,"data-context-type",X)},i:Re,o:Re,d(oe){oe&&T(e),Z&&Z.d(),B.d(),x=!1,Ve(z)}}}function Ac(l){let e,t;return e=new kc({props:{contextItem:l[47],compact:!0}}),e.$on("remove",l[33]),e.$on("viewDetails",l[34]),{c(){he(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},p(n,o){const a={};o[0]&64&&(a.contextItem=n[47]),e.$set(a)},i(n){t||(U(e.$$.fragment,n),t=!0)},o(n){Y(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function zs(l){let e,t=l[47].relevance_score.toFixed(1)+"",n;return{c(){e=f("span"),n=P(t),c(e,"class","tag is-light is-small")},m(o,a){S(o,e,a),s(e,n)},p(o,a){a[0]&64&&t!==(t=o[47].relevance_score.toFixed(1)+"")&&be(n,t)},d(o){o&&T(e)}}}function Ec(l){let e,t=l[47].content.substring(0,150)+"",n,o=l[47].content.length>150?"...":"",a;return{c(){e=f("p"),n=P(t),a=P(o),c(e,"class","context-preview svelte-rbq0zi"),c(e,"data-testid",`context-content-${l[49]}`)},m(r,u){S(r,e,u),s(e,n),s(e,a)},p(r,u){u[0]&64&&t!==(t=r[47].content.substring(0,150)+"")&&be(n,t),u[0]&64&&o!==(o=r[47].content.length>150?"...":"")&&be(a,o)},d(r){r&&T(e)}}}function Lc(l){let e,t=l[47].summary+"",n;return{c(){e=f("p"),n=P(t),c(e,"class","context-summary svelte-rbq0zi"),c(e,"data-testid",`context-summary-${l[49]}`)},m(o,a){S(o,e,a),s(e,n)},p(o,a){a[0]&64&&t!==(t=o[47].summary+"")&&be(n,t)},d(o){o&&T(e)}}}function Hs(l){let e;return{c(){e=f("hr"),c(e,"class","context-divider svelte-rbq0zi")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function Fs(l){let e,t,n,o,a;const r=[Ac,Rc],u=[];function i(p,m){return p[47].context_type==="KGTermDefinition"||p[47].context_type==="KGIndex"?0:1}e=i(l),t=u[e]=r[e](l);let d=l[49]<l[6].length-1&&Hs();return{c(){t.c(),n=g(),d&&d.c(),o=ut()},m(p,m){u[e].m(p,m),S(p,n,m),d&&d.m(p,m),S(p,o,m),a=!0},p(p,m){let _=e;e=i(p),e===_?u[e].p(p,m):(Fe(),Y(u[_],1,1,()=>{u[_]=null}),Ke(),t=u[e],t?t.p(p,m):(t=u[e]=r[e](p),t.c()),U(t,1),t.m(n.parentNode,n)),p[49]<p[6].length-1?d||(d=Hs(),d.c(),d.m(o.parentNode,o)):d&&(d.d(1),d=null)},i(p){a||(U(t),a=!0)},o(p){Y(t),a=!1},d(p){u[e].d(p),p&&T(n),d&&d.d(p),p&&T(o)}}}function Dc(l){let e,t,n,o,a,r,u,i,d,p,m,_,h,w,b,k,$,y,v,C,q,I,N,R,F,le,V,L,A,ee,K,X,x,z,Z,O,H,E,M,B,oe,D,j,W,ae,ce,se,ie,me,G,te=l[6].length+"",ue,_e,ke,Te,Xe,Be,Ne,Pe,de,Se,Me,xe,et;e=new _l({props:{fallbackPath:"/"}});let ye=l[5]&&Ns(l),ze=l[0],qe=[];for(let pe=0;pe<ze.length;pe+=1)qe[pe]=Is(Os(l,ze,pe));let Ge=l[2]&&Ps(),Le=l[4]&&Ms(l),De=l[3]&&js(l);function it(pe,Ae){return pe[7]?yc:wc}let Ie=it(l),We=Ie(l),J=l[8]&&Us(l);const ne=[Sc,Tc],Q=[];function fe(pe,Ae){return pe[6].length===0?0:1}j=fe(l),W=Q[j]=ne[j](l);function Ce(pe){l[37](pe)}let $e={context:l[14],mode:l[15]};l[13]!==void 0&&($e.active=l[13]),Be=new Ja({props:$e}),lt.push(()=>st(Be,"active",Ce)),Be.$on("update",l[38]),Be.$on("delete",l[39]),Be.$on("close",l[40]);function Ye(pe){l[41](pe)}let nt={conversationId:l[5]};return l[16]!==void 0&&(nt.active=l[16]),de=new rc({props:nt}),lt.push(()=>st(de,"active",Ye)),de.$on("termAdded",l[27]),de.$on("kgIndexAdded",l[28]),{c(){he(e.$$.fragment),t=g(),n=f("section"),o=f("div"),a=f("div"),r=f("div"),u=f("h2"),u.textContent="Chat",i=g(),d=f("p"),d.textContent=`Role: ${Rt(At)}`,p=g(),ye&&ye.c(),m=g(),_=f("div");for(let pe=0;pe<qe.length;pe+=1)qe[pe].c();h=g(),Ge&&Ge.c(),w=g(),Le&&Le.c(),b=g(),De&&De.c(),k=g(),$=f("div"),y=f("div"),v=f("textarea"),C=g(),q=f("div"),I=f("button"),N=f("span"),N.innerHTML='<i class="fas fa-paper-plane"></i>',F=g(),le=f("div"),V=f("div"),L=f("div"),A=f("div"),ee=f("div"),K=f("h4"),K.textContent="Context",X=g(),x=f("div"),z=f("button"),z.innerHTML=`<span class="icon is-small"><i class="fas fa-plus"></i></span> 
                    <span>Add</span>`,Z=g(),O=f("button"),O.innerHTML=`<span class="icon is-small"><i class="fas fa-sitemap"></i></span> 
                    <span>KG Search</span>`,H=g(),E=f("div"),M=f("div"),B=f("button"),We.c(),oe=g(),J&&J.c(),D=g(),W.c(),ae=g(),ce=f("div"),se=f("div"),ie=f("div"),me=f("div"),G=f("span"),ue=P(te),_e=P(" context items"),ke=g(),Te=f("div"),Te.innerHTML='<div class="level-item"><span class="is-size-7 has-text-grey">Context is automatically included in your chat</span></div>',Xe=g(),he(Be.$$.fragment),Pe=g(),he(de.$$.fragment),c(u,"class","title is-4"),c(d,"class","subtitle is-6"),c(_,"class","chat-window svelte-rbq0zi"),c(_,"data-testid","chat-messages"),c(v,"class","textarea"),c(v,"rows","3"),c(v,"placeholder","Type your message and press Enter..."),c(v,"data-testid","chat-input"),c(y,"class","control is-expanded"),c(N,"class","icon"),c(I,"class","button is-primary"),I.disabled=R=l[2]||!l[1].trim(),c(I,"data-testid","send-message-button"),c(q,"class","control"),c($,"class","field has-addons chat-input svelte-rbq0zi"),c(r,"class","column is-8"),c(K,"class","title is-5"),c(z,"class","button is-small is-primary"),c(z,"data-testid","show-add-context-button"),c(O,"class","button is-small is-info"),c(O,"data-testid","kg-search-button"),c(x,"class","buttons has-addons"),c(ee,"class","level-item"),c(A,"class","level-left"),c(B,"class","button is-small is-light"),B.disabled=l[7],c(B,"data-testid","refresh-context-button"),c(M,"class","level-item"),c(E,"class","level-right"),c(L,"class","level is-mobile"),c(G,"class","tag is-light is-small"),c(G,"data-testid","context-summary"),c(me,"class","level-item"),c(ie,"class","level-left"),c(Te,"class","level-right"),c(se,"class","level is-mobile"),c(ce,"class","mt-4"),c(V,"class","box context-panel svelte-rbq0zi"),c(V,"data-testid","context-panel"),c(le,"class","column is-4"),c(a,"class","columns svelte-rbq0zi"),c(o,"class","container"),c(n,"class","section"),c(n,"data-testid","chat-interface")},m(pe,Ae){ge(e,pe,Ae),S(pe,t,Ae),S(pe,n,Ae),s(n,o),s(o,a),s(a,r),s(r,u),s(r,i),s(r,d),s(r,p),ye&&ye.m(r,null),s(r,m),s(r,_);for(let ot=0;ot<qe.length;ot+=1)qe[ot]&&qe[ot].m(_,null);s(_,h),Ge&&Ge.m(_,null),s(r,w),Le&&Le.m(r,null),s(r,b),De&&De.m(r,null),s(r,k),s(r,$),s($,y),s(y,v),Oe(v,l[1]),s($,C),s($,q),s(q,I),s(I,N),s(a,F),s(a,le),s(le,V),s(V,L),s(L,A),s(A,ee),s(ee,K),s(ee,X),s(ee,x),s(x,z),s(x,Z),s(x,O),s(L,H),s(L,E),s(E,M),s(M,B),We.m(B,null),s(V,oe),J&&J.m(V,null),s(V,D),Q[j].m(V,null),s(V,ae),s(V,ce),s(ce,se),s(se,ie),s(ie,me),s(me,G),s(G,ue),s(G,_e),s(se,ke),s(se,Te),S(pe,Xe,Ae),ge(Be,pe,Ae),S(pe,Pe,Ae),ge(de,pe,Ae),Me=!0,xe||(et=[re(v,"input",l[29]),re(v,"keydown",l[25]),re(I,"click",l[24]),re(z,"click",l[18]),re(O,"click",l[26]),re(B,"click",l[17])],xe=!0)},p(pe,Ae){if(pe[5]?ye?ye.p(pe,Ae):(ye=Ns(pe),ye.c(),ye.m(r,m)):ye&&(ye.d(1),ye=null),Ae[0]&1){ze=pe[0];let at;for(at=0;at<ze.length;at+=1){const Gt=Os(pe,ze,at);qe[at]?qe[at].p(Gt,Ae):(qe[at]=Is(Gt),qe[at].c(),qe[at].m(_,h))}for(;at<qe.length;at+=1)qe[at].d(1);qe.length=ze.length}pe[2]?Ge||(Ge=Ps(),Ge.c(),Ge.m(_,null)):Ge&&(Ge.d(1),Ge=null),pe[4]?Le?Le.p(pe,Ae):(Le=Ms(pe),Le.c(),Le.m(r,b)):Le&&(Le.d(1),Le=null),pe[3]?De?De.p(pe,Ae):(De=js(pe),De.c(),De.m(r,k)):De&&(De.d(1),De=null),Ae[0]&2&&Oe(v,pe[1]),(!Me||Ae[0]&6&&R!==(R=pe[2]||!pe[1].trim()))&&(I.disabled=R),Ie!==(Ie=it(pe))&&(We.d(1),We=Ie(pe),We&&(We.c(),We.m(B,null))),(!Me||Ae[0]&128)&&(B.disabled=pe[7]),pe[8]?J?J.p(pe,Ae):(J=Us(pe),J.c(),J.m(V,D)):J&&(J.d(1),J=null);let ot=j;j=fe(pe),j===ot?Q[j].p(pe,Ae):(Fe(),Y(Q[ot],1,1,()=>{Q[ot]=null}),Ke(),W=Q[j],W?W.p(pe,Ae):(W=Q[j]=ne[j](pe),W.c()),U(W,1),W.m(V,ae)),(!Me||Ae[0]&64)&&te!==(te=pe[6].length+"")&&be(ue,te);const ft={};Ae[0]&16384&&(ft.context=pe[14]),Ae[0]&32768&&(ft.mode=pe[15]),!Ne&&Ae[0]&8192&&(Ne=!0,ft.active=pe[13],rt(()=>Ne=!1)),Be.$set(ft);const Mt={};Ae[0]&32&&(Mt.conversationId=pe[5]),!Se&&Ae[0]&65536&&(Se=!0,Mt.active=pe[16],rt(()=>Se=!1)),de.$set(Mt)},i(pe){Me||(U(e.$$.fragment,pe),U(W),U(Be.$$.fragment,pe),U(de.$$.fragment,pe),Me=!0)},o(pe){Y(e.$$.fragment,pe),Y(W),Y(Be.$$.fragment,pe),Y(de.$$.fragment,pe),Me=!1},d(pe){ve(e,pe),pe&&T(t),pe&&T(n),ye&&ye.d(),tt(qe,pe),Ge&&Ge.d(),Le&&Le.d(),De&&De.d(),We.d(),J&&J.d(),Q[j].d(),pe&&T(Xe),ve(Be,pe),pe&&T(Pe),ve(de,pe),xe=!1,Ve(et)}}}function Oc(l,e,t){let n;Ue(l,ct,G=>t(43,n=G));let o=[],a="",r=!1,u=null,i=null,d=null,p=[],m=!1,_=!1,h="",w="",b="document",k=!1,$=!1,y=null,v="edit",C=null,q=!1;function I(G){t(0,o=[...o,{role:"user",content:G}])}async function N(){try{if(n){const G=await je("list_conversations");G!=null&&G.conversations&&G.conversations.length>0?(t(5,d=G.conversations[0].id),console.log("🎯 Using existing conversation:",d),await F()):await R()}else{const G=await fetch(`${Qe.ServerURL}/conversations`);if(G.ok){const te=await G.json();te.conversations&&te.conversations.length>0?(t(5,d=te.conversations[0].id),console.log("🎯 Using existing conversation:",d),await F()):await R()}else await R()}}catch(G){console.error("❌ Error initializing conversation:",G)}}async function R(){try{const G=Rt(At);if(n){const te=await je("create_conversation",{title:"Chat Conversation",role:G});te.status==="success"&&te.conversation_id&&(t(5,d=te.conversation_id),console.log("🆕 Created new conversation:",d))}else{const te=await fetch(`${Qe.ServerURL}/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"Chat Conversation",role:G})});if(te.ok){const ue=await te.json();ue.status==="Success"&&ue.conversation_id&&(t(5,d=ue.conversation_id),console.log("🆕 Created new conversation:",d))}}}catch(G){console.error("❌ Error creating conversation:",G)}}async function F(){if(!d){console.warn("⚠️ Cannot load context: no conversation ID available");return}t(7,m=!0),console.log("🔄 Loading conversation context for:",d);try{if(n){console.log("📱 Loading context via Tauri...");const G=await je("get_conversation",{conversationId:d});if(console.log("📥 Tauri response:",G),G.status==="success"&&G.conversation){const te=G.conversation.global_context||[];t(6,p=te),console.log(`✅ Loaded ${te.length} context items via Tauri`)}else console.error("❌ Failed to get conversation via Tauri:",G.error||"Unknown error"),t(6,p=[])}else{console.log("🌐 Loading context via HTTP...");const G=await fetch(`${Qe.ServerURL}/conversations/${d}`);if(console.log("📥 HTTP response status:",G.status,G.statusText),G.ok){const te=await G.json();if(console.log("📄 HTTP response data:",te),te.status==="success"&&te.conversation){const ue=te.conversation.global_context||[];t(6,p=ue),console.log(`✅ Loaded ${ue.length} context items via HTTP`)}else console.error("❌ Failed to get conversation via HTTP:",te.error||"Unknown error"),t(6,p=[])}else console.error("❌ HTTP request failed:",G.status,G.statusText),t(6,p=[])}}catch(G){console.error("❌ Error loading conversation context:",{error:G.message||G,conversationId:d,isTauri:n,timestamp:new Date().toISOString()}),t(6,p=[])}finally{t(7,m=!1),console.log("🏁 Context loading completed. Items count:",p.length)}}function le(){t(8,_=!_),_||(t(9,h=""),t(10,w=""),t(11,b="document"))}async function V(){if(!(!d||!h.trim()||!w.trim())){t(12,k=!0);try{const G={title:h.trim(),summary:null,content:w.trim(),context_type:b};if(n){const te=await je("add_context_to_conversation",{conversationId:d,contextData:G});te.status==="success"?(await F(),le(),console.log("✅ Context added successfully via Tauri")):console.error("❌ Failed to add context via Tauri:",te.error)}else{const te=await fetch(`${Qe.ServerURL}/conversations/${d}/context`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(G)});if(te.ok){const ue=await te.json();ue.status==="success"?(await F(),le(),console.log("✅ Context added successfully via HTTP")):console.error("❌ Failed to add context via HTTP:",ue.error)}else console.error("❌ HTTP request failed:",te.status,te.statusText)}}catch(G){console.error("❌ Error adding manual context:",G)}finally{t(12,k=!1)}}}function L(G){t(14,y=G),t(15,v="edit"),t(13,$=!0)}function A(G){confirm(`Are you sure you want to delete "${G.title}"?`)&&ee(G.id)}async function ee(G){if(!(!d||C)){C=G,console.log("🗑️ Deleting context:",G);try{if(n){const te=await je("delete_context",{conversationId:d,contextId:G});(te==null?void 0:te.status)==="success"?(console.log("✅ Context deleted successfully via Tauri"),await F()):console.error("❌ Failed to delete context via Tauri:",te==null?void 0:te.error)}else{const te=await fetch(`${Qe.ServerURL}/conversations/${d}/context/${G}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(te.ok){const ue=await te.json();ue.status==="success"?(console.log("✅ Context deleted successfully via HTTP"),await F()):console.error("❌ Failed to delete context via HTTP:",ue.error)}else console.error("❌ HTTP delete request failed:",te.status)}}catch(te){console.error("❌ Error deleting context:",te)}finally{C=null}}}async function K(G){if(d){console.log("📝 Updating context:",G.id);try{const te={context_type:G.context_type,title:G.title,summary:G.summary,content:G.content,metadata:G.metadata};if(n){const ue=await je("update_context",{conversationId:d,contextId:G.id,request:te});(ue==null?void 0:ue.status)==="success"?(console.log("✅ Context updated successfully via Tauri"),await F()):console.error("❌ Failed to update context via Tauri:",ue==null?void 0:ue.error)}else{const ue=await fetch(`${Qe.ServerURL}/conversations/${d}/context/${G.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(te)});if(ue.ok){const _e=await ue.json();_e.status==="success"?(console.log("✅ Context updated successfully via HTTP"),await F()):console.error("❌ Failed to update context via HTTP:",_e.error)}else console.error("❌ HTTP update request failed:",ue.status)}}catch(te){console.error("❌ Error updating context:",te)}}}async function X(){var ue;if(!a.trim()||r)return;t(3,u=null);const G=Rt(At),te=a.trim();t(1,a=""),d||await N(),I(te),t(2,r=!0);try{const _e={role:G,messages:o};d&&(_e.conversation_id=d);let ke;if(n)ke=await je("chat",{request:_e});else{const Te=await fetch(`${Qe.ServerURL}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(_e)});if(!Te.ok)throw new Error(`HTTP ${Te.status}`);ke=await Te.json()}t(4,i=ke.model_used??null),((ue=ke.status)==null?void 0:ue.toLowerCase())==="success"&&ke.message?t(0,o=[...o,{role:"assistant",content:ke.message}]):t(3,u=ke.error||"Chat failed")}catch(_e){t(3,u=(_e==null?void 0:_e.message)||String(_e))}finally{t(2,r=!1)}}function x(G){(G.key==="Enter"||G.key==="Return")&&!G.shiftKey&&(G.preventDefault(),X())}function z(){t(16,q=!0)}function Z(G){console.log("✅ KG term added to context:",G.detail.term),F()}function O(G){console.log("✅ KG index added to context for role:",G.detail.role),F()}tl(()=>{if(t(0,o=[{role:"assistant",content:"Hi! How can I help you? Ask me anything about your search results or documents."}]),N(),typeof window<"u"){const G=()=>{d&&F()};return window.addEventListener("focus",G),()=>{window.removeEventListener("focus",G)}}});function H(){a=this.value,t(1,a)}function E(){b=St(this),t(11,b)}function M(){h=this.value,t(9,h)}function B(){w=this.value,t(10,w)}const oe=G=>ee(G.detail.contextId),D=G=>L(G.detail.contextItem),j=G=>L(G),W=G=>A(G);function ae(G){$=G,t(13,$)}const ce=G=>K(G.detail),se=G=>ee(G.detail),ie=()=>{t(13,$=!1),t(14,y=null)};function me(G){q=G,t(16,q)}return[o,a,r,u,i,d,p,m,_,h,w,b,k,$,y,v,q,F,le,V,L,A,ee,K,X,x,z,Z,O,H,E,M,B,oe,D,j,W,ae,ce,se,ie,me]}class Nc extends _t{constructor(e){super(),ht(this,e,Oc,Dc,pt,{},null,[-1,-1])}}function Ic(l){let e,t;return e=new ka({}),{c(){he(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},i(n){t||(U(e.$$.fragment,n),t=!0)},o(n){Y(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function Pc(l){let e,t;return e=new Nc({}),{c(){he(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},i(n){t||(U(e.$$.fragment,n),t=!0)},o(n){Y(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function Mc(l){let e,t;return e=new za({}),{c(){he(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},i(n){t||(U(e.$$.fragment,n),t=!0)},o(n){Y(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function jc(l){let e,t;return e=new ii({}),{c(){he(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},i(n){t||(U(e.$$.fragment,n),t=!0)},o(n){Y(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function Uc(l){let e,t;return e=new Da({}),{c(){he(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},i(n){t||(U(e.$$.fragment,n),t=!0)},o(n){Y(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function zc(l){let e,t;return e=new Ia({}),{c(){he(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},i(n){t||(U(e.$$.fragment,n),t=!0)},o(n){Y(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function Hc(l){let e;return{c(){e=f("nav"),e.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
            <a class="navbar-item" href="/config/wizard">Wizard</a> 
            <a class="navbar-item" href="/config/json">JSON Editor</a> 
            <a class="navbar-item" href="/graph">Graph</a> 
            <a class="navbar-item" href="/chat">Chat</a></div>`,c(e,"class","navbar")},m(t,n){S(t,e,n)},p:Re,d(t){t&&T(e)}}}function Fc(l){let e,t,n,o,a,r,u,i,d,p,m,_,h,w,b,k,$,y,v,C,q,I,N,R,F,le,V,L,A,ee,K,X,x,z,Z,O,H,E,M,B,oe,D;return v=new Ml({}),I=new Nt({props:{path:"/",$$slots:{default:[Ic]},$$scope:{ctx:l}}}),R=new Nt({props:{path:"/chat",$$slots:{default:[Pc]},$$scope:{ctx:l}}}),le=new Nt({props:{path:"/graph",$$slots:{default:[Mc]},$$scope:{ctx:l}}}),ee=new Nt({props:{path:"/fetch/*",$$slots:{default:[jc]},$$scope:{ctx:l}}}),X=new Nt({props:{path:"/config/wizard",$$slots:{default:[Uc]},$$scope:{ctx:l}}}),z=new Nt({props:{path:"/config/json",$$slots:{default:[zc]},$$scope:{ctx:l}}}),E=new Nt({props:{path:"/",$$slots:{default:[Hc]},$$scope:{ctx:l}}}),{c(){e=f("meta"),t=g(),n=f("div"),o=f("main"),a=f("div"),r=f("div"),u=f("div"),i=f("ul"),d=f("li"),p=f("a"),p.innerHTML=`<span class="icon is-small"><i class="fas fa-search"></i></span> 
                <span>Search</span>`,m=g(),_=f("li"),h=f("a"),h.innerHTML=`<span class="icon is-small"><i class="fas fa-comments"></i></span> 
                <span>Chat</span>`,w=g(),b=f("li"),k=f("a"),k.innerHTML=`<span class="icon is-small"><i class="fas fa-project-diagram"></i></span> 
                <span>Graph</span>`,$=g(),y=f("div"),he(v.$$.fragment),C=g(),q=f("div"),he(I.$$.fragment),N=g(),he(R.$$.fragment),F=g(),he(le.$$.fragment),V=g(),L=f("br"),A=g(),he(ee.$$.fragment),K=g(),he(X.$$.fragment),x=g(),he(z.$$.fragment),Z=g(),O=f("footer"),H=f("div"),he(E.$$.fragment),c(e,"name","color-scheme"),c(e,"content",l[1]),document.title="Terraphim",c(p,"href","/"),c(p,"data-exact",""),c(p,"data-testid","search-tab"),c(d,"class","svelte-1nmgbjk"),c(h,"href","/chat"),c(h,"data-testid","chat-tab"),c(_,"class","svelte-1nmgbjk"),c(k,"href","/graph"),c(k,"data-testid","graph-tab"),c(b,"class","svelte-1nmgbjk"),c(u,"class","tabs is-boxed svelte-1nmgbjk"),c(r,"class","main-navigation svelte-1nmgbjk"),c(y,"class","role-selector svelte-1nmgbjk"),c(a,"class","top-controls svelte-1nmgbjk"),c(q,"class","main-area svelte-1nmgbjk"),c(o,"class","main-content svelte-1nmgbjk"),c(H,"class",M=Pt(l[0])+" svelte-1nmgbjk"),c(O,"class","svelte-1nmgbjk"),c(n,"class","is-full-height svelte-1nmgbjk")},m(j,W){s(document.head,e),S(j,t,W),S(j,n,W),s(n,o),s(o,a),s(a,r),s(r,u),s(u,i),s(i,d),s(d,p),s(i,m),s(i,_),s(_,h),s(i,w),s(i,b),s(b,k),s(a,$),s(a,y),ge(v,y,null),s(o,C),s(o,q),ge(I,q,null),s(q,N),ge(R,q,null),s(q,F),ge(le,q,null),s(o,V),s(o,L),s(o,A),ge(ee,o,null),s(o,K),ge(X,o,null),s(o,x),ge(z,o,null),s(n,Z),s(n,O),s(O,H),ge(E,H,null),B=!0,oe||(D=[Hl(Fl.call(null,p)),Hl(Fl.call(null,h)),Hl(Fl.call(null,k)),re(O,"mouseover",l[2]),re(O,"focus",l[2])],oe=!0)},p(j,[W]){(!B||W&2)&&c(e,"content",j[1]);const ae={};W&16&&(ae.$$scope={dirty:W,ctx:j}),I.$set(ae);const ce={};W&16&&(ce.$$scope={dirty:W,ctx:j}),R.$set(ce);const se={};W&16&&(se.$$scope={dirty:W,ctx:j}),le.$set(se);const ie={};W&16&&(ie.$$scope={dirty:W,ctx:j}),ee.$set(ie);const me={};W&16&&(me.$$scope={dirty:W,ctx:j}),X.$set(me);const G={};W&16&&(G.$$scope={dirty:W,ctx:j}),z.$set(G);const te={};W&16&&(te.$$scope={dirty:W,ctx:j}),E.$set(te),(!B||W&1&&M!==(M=Pt(j[0])+" svelte-1nmgbjk"))&&c(H,"class",M)},i(j){B||(U(v.$$.fragment,j),U(I.$$.fragment,j),U(R.$$.fragment,j),U(le.$$.fragment,j),U(ee.$$.fragment,j),U(X.$$.fragment,j),U(z.$$.fragment,j),U(E.$$.fragment,j),B=!0)},o(j){Y(v.$$.fragment,j),Y(I.$$.fragment,j),Y(R.$$.fragment,j),Y(le.$$.fragment,j),Y(ee.$$.fragment,j),Y(X.$$.fragment,j),Y(z.$$.fragment,j),Y(E.$$.fragment,j),B=!1},d(j){T(e),j&&T(t),j&&T(n),ve(v),ve(I),ve(R),ve(le),ve(ee),ve(X),ve(z),ve(E),oe=!1,Ve(D)}}}function Kc(l,e,t){let n;Ue(l,kl,r=>t(1,n=r));let o="is-hidden";function a(){t(0,o="")}return[o,n,a]}class qc extends _t{constructor(e){super(),ht(this,e,Kc,Fc,pt,{})}}const Gc=new Cr;Tr(Gc);new qc({target:document.getElementById("app")});
