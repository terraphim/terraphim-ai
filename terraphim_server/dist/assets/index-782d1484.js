var ts=Object.defineProperty;var ls=(l,e,t)=>e in l?ts(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var wl=(l,e,t)=>(ls(l,typeof e!="symbol"?e+"":e,t),t);import{aa as kt,S as ct,i as ft,s as et,q as f,Y as K,b as S,y as i,Z as be,I as Se,j as C,ak as Re,F as tt,m as Kt,a as g,v as a,l as Q,E as Ge,au as Mt,r as se,z as re,t as H,d as q,B as ie,av as os,aw as Bt,H as Fe,U as Je,V as Ve,ax as Cl,ay as ns,g as Me,e as De,O as We,W as fe,az as El,aA as yt,aB as In,aC as ss,a1 as Ce,C as ut,aD as Pe,aE as jn,D as ll,G as ol,aF as zn,w as Tt,x as Rt,A as Pl,a2 as rs,aG as $l,ac as is,af as vt,a7 as as,a9 as us,n as cs}from"./vendor-ui-cd3d2b6a.js";import{R as Ct,S as Tl}from"./vendor-utils-1b347ea1.js";import{J as Hn,_ as fs,o as ps}from"./vendor-editor-992829d3.js";import{P as Fn,T as Sl,u as Wn,y as ds,A as _s,S as ms,q as hs}from"./vendor-atomic-1ea13e29.js";import{E as gs}from"./novel-editor-b32024cb.js";import{s as Al,z as bs,a as vs,l as ks,m as ws,c as $s,b as ys,B as Cs,d as Ss}from"./vendor-charts-e6a4a6c9.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const u of n)if(u.type==="childList")for(const s of u.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function t(n){const u={};return n.integrity&&(u.integrity=n.integrity),n.referrerPolicy&&(u.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?u.credentials="include":n.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function o(n){if(n.ep)return;n.ep=!0;const u=t(n);fetch(n.href,u)}})();const at={ServerURL:location.protocol+"//"+window.location.host||"/"},al=kt([]),Ts={id:"Desktop",global_shortcut:"",roles:{},default_role:{original:"",lowercase:""},selected_role:{original:"",lowercase:""}},ul=kt("spacelab"),St=kt("selected"),Be=kt(!1),Rs=kt(`${at.ServerURL}/documents/search`),gt=kt(Ts),oo=kt([]);let Ll=kt("");const ht=kt(!1);let Gt=null;function As(l){if(typeof document>"u")return;const e=`/assets/bulmaswatch/${l}/bulmaswatch.min.css`;if(Gt!=null&&Gt.href.endsWith(e))return;const t=document.createElement("link");t.rel="stylesheet",t.href=e,t.id="bulma-theme",t.onload=()=>{Gt&&Gt!==t&&Gt.remove(),Gt=t},document.head.appendChild(t);const o=document.head.querySelector('meta[name="color-scheme"]');o&&o.setAttribute("content",l)}ul.subscribe(As);function Ls(l){let e,t;return{c(){e=f("option"),t=K(l[1]),e.__value=l[0],e.value=e.__value},m(o,n){S(o,e,n),i(e,t)},p(o,[n]){n&2&&be(t,o[1]),n&1&&(e.__value=o[0],e.value=e.__value)},i:Se,o:Se,d(o){o&&C(e)}}}function Ns(l,e,t){let o,{subject:n}=e;const u=Fn(n),s=Sl(u,Wn.properties.name);return Re(l,s,c=>t(1,o=c)),Sl(u,"http://localhost:9883/property/theme"),l.$$set=c=>{"subject"in c&&t(0,n=c.subject)},[n,o,s]}class Os extends ct{constructor(e){super(),ft(this,e,Ns,Ls,et,{subject:0})}}function no(l){let e,t,o,n,u,s,c=l[0]&&so();return{c(){e=f("button"),t=f("span"),t.innerHTML='<i class="fas fa-arrow-left"></i>',o=g(),c&&c.c(),a(t,"class","icon svelte-f11u1"),a(e,"class",n="button is-light back-button "+l[1]+" svelte-f11u1"),a(e,"title","Go back"),a(e,"aria-label","Go back")},m(r,p){S(r,e,p),i(e,t),i(e,o),c&&c.m(e,null),u||(s=[Q(e,"click",l[3]),Q(e,"keydown",l[6])],u=!0)},p(r,p){r[0]?c||(c=so(),c.c(),c.m(e,null)):c&&(c.d(1),c=null),p&2&&n!==(n="button is-light back-button "+r[1]+" svelte-f11u1")&&a(e,"class",n)},d(r){r&&C(e),c&&c.d(),u=!1,Ge(s)}}}function so(l){let e;return{c(){e=f("span"),e.textContent="Back",a(e,"class","back-text svelte-f11u1")},m(t,o){S(t,e,o)},d(t){t&&C(e)}}}function Us(l){let e,t=l[2]&&no(l);return{c(){t&&t.c(),e=tt()},m(o,n){t&&t.m(o,n),S(o,e,n)},p(o,[n]){o[2]?t?t.p(o,n):(t=no(o),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Se,o:Se,d(o){t&&t.d(o),o&&C(e)}}}function Es(l,e,t){let{fallbackPath:o="/"}=e,{showText:n=!0}=e,{customClass:u=""}=e,{hideOnPaths:s=["/"]}=e,c=!0;function r(){var _;try{const m=((_=window.location)==null?void 0:_.pathname)||"/";t(2,c=!s.includes(m))}catch{t(2,c=!0)}}function p(){window.history.length>1?window.history.back():window.location.href=o}Kt(()=>(r(),window.addEventListener("popstate",r),window.addEventListener("hashchange",r),()=>{window.removeEventListener("popstate",r),window.removeEventListener("hashchange",r)}));const d=_=>{(_.key==="Enter"||_.key===" ")&&(_.preventDefault(),p())};return l.$$set=_=>{"fallbackPath"in _&&t(4,o=_.fallbackPath),"showText"in _&&t(0,n=_.showText),"customClass"in _&&t(1,u=_.customClass),"hideOnPaths"in _&&t(5,s=_.hideOnPaths)},[n,u,c,p,o,s,d]}class nl extends ct{constructor(e){super(),ft(this,e,Es,Us,et,{fallbackPath:4,showText:0,customClass:1,hideOnPaths:5})}}function Ps(){return window.crypto.getRandomValues(new Uint32Array(1))[0]}function Ol(l,e=!1){const t=Ps(),o=`_${t}`;return Object.defineProperty(window,o,{value:n=>(e&&Reflect.deleteProperty(window,o),l==null?void 0:l(n)),writable:!1,configurable:!0}),t}async function qe(l,e={}){return new Promise((t,o)=>{const n=Ol(s=>{t(s),Reflect.deleteProperty(window,`_${u}`)},!0),u=Ol(s=>{o(s),Reflect.deleteProperty(window,`_${n}`)},!0);window.__TAURI_IPC__({cmd:l,callback:n,error:u,...e})})}function ro(l,e,t){const o=l.slice();return o[25]=e[t],o}function Ms(l){let e,t,o;function n(s){l[13](s)}let u={};return l[5]!==void 0&&(u.value=l[5]),e=new Bt({props:u}),Fe.push(()=>Je(e,"value",n)),{c(){se(e.$$.fragment)},m(s,c){re(e,s,c),o=!0},p(s,c){const r={};!t&&c&32&&(t=!0,r.value=s[5],Ve(()=>t=!1)),e.$set(r)},i(s){o||(H(e.$$.fragment,s),o=!0)},o(s){q(e.$$.fragment,s),o=!1},d(s){ie(e,s)}}}function Ds(l){let e,t,o;function n(s){l[14](s)}let u={type:"password",placeholder:"secret",icon:"fas fa-lock",expanded:!0};return l[6]!==void 0&&(u.value=l[6]),e=new Bt({props:u}),Fe.push(()=>Je(e,"value",n)),{c(){se(e.$$.fragment)},m(s,c){re(e,s,c),o=!0},p(s,c){const r={};!t&&c&64&&(t=!0,r.value=s[6],Ve(()=>t=!1)),e.$set(r)},i(s){o||(H(e.$$.fragment,s),o=!0)},o(s){q(e.$$.fragment,s),o=!1},d(s){ie(e,s)}}}function Is(l){let e;return{c(){e=K("Save")},m(t,o){S(t,e,o)},d(t){t&&C(e)}}}function js(l){let e,t;return e=new Cl({props:{type:"is-success",class:"is-right",iconPack:"fa",iconLeft:"check",$$slots:{default:[Is]},$$scope:{ctx:l}}}),e.$on("click",l[8]),e.$on("submit",l[8]),{c(){se(e.$$.fragment)},m(o,n){re(e,o,n),t=!0},p(o,n){const u={};n&268435456&&(u.$$scope={dirty:n,ctx:o}),e.$set(u)},i(o){t||(H(e.$$.fragment,o),t=!0)},o(o){q(e.$$.fragment,o),t=!1},d(o){ie(e,o)}}}function zs(l){let e,t,o,n,u,s;return e=new Mt({props:{$$slots:{default:[Ms]},$$scope:{ctx:l}}}),o=new Mt({props:{grouped:!0,$$slots:{default:[Ds]},$$scope:{ctx:l}}}),u=new Mt({props:{grouped:!0,$$slots:{default:[js]},$$scope:{ctx:l}}}),{c(){se(e.$$.fragment),t=g(),se(o.$$.fragment),n=g(),se(u.$$.fragment)},m(c,r){re(e,c,r),S(c,t,r),re(o,c,r),S(c,n,r),re(u,c,r),s=!0},p(c,r){const p={};r&268435488&&(p.$$scope={dirty:r,ctx:c}),e.$set(p);const d={};r&268435520&&(d.$$scope={dirty:r,ctx:c}),o.$set(d);const _={};r&268435456&&(_.$$scope={dirty:r,ctx:c}),u.$set(_)},i(c){s||(H(e.$$.fragment,c),H(o.$$.fragment,c),H(u.$$.fragment,c),s=!0)},o(c){q(e.$$.fragment,c),q(o.$$.fragment,c),q(u.$$.fragment,c),s=!1},d(c){ie(e,c),c&&C(t),ie(o,c),c&&C(n),ie(u,c)}}}function Hs(l){let e,t,o;function n(s){l[15](s)}let u={type:"search",placeholder:"Fetch JSON",icon:"search"};return l[3]!==void 0&&(u.value=l[3]),e=new Bt({props:u}),Fe.push(()=>Je(e,"value",n)),{c(){se(e.$$.fragment)},m(s,c){re(e,s,c),o=!0},p(s,c){const r={};!t&&c&8&&(t=!0,r.value=s[3],Ve(()=>t=!1)),e.$set(r)},i(s){o||(H(e.$$.fragment,s),o=!0)},o(s){q(e.$$.fragment,s),o=!1},d(s){ie(e,s)}}}function Fs(l){let e;return{c(){e=K("WikiPage")},m(t,o){S(t,e,o)},d(t){t&&C(e)}}}function Ws(l){let e,t,o,n,u,s;function c(_){l[16](_)}let r={type:"search",placeholder:"Post JSON",icon:"search"};l[4]!==void 0&&(r.value=l[4]),e=new Bt({props:r}),Fe.push(()=>Je(e,"value",c));function p(_){l[17](_)}let d={$$slots:{default:[Fs]},$$scope:{ctx:l}};return l[2]!==void 0&&(d.checked=l[2]),n=new ns({props:d}),Fe.push(()=>Je(n,"checked",p)),{c(){se(e.$$.fragment),o=g(),se(n.$$.fragment)},m(_,m){re(e,_,m),S(_,o,m),re(n,_,m),s=!0},p(_,m){const k={};!t&&m&16&&(t=!0,k.value=_[4],Ve(()=>t=!1)),e.$set(k);const v={};m&268435456&&(v.$$scope={dirty:m,ctx:_}),!u&&m&4&&(u=!0,v.checked=_[2],Ve(()=>u=!1)),n.$set(v)},i(_){s||(H(e.$$.fragment,_),H(n.$$.fragment,_),s=!0)},o(_){q(e.$$.fragment,_),q(n.$$.fragment,_),s=!1},d(_){ie(e,_),_&&C(o),ie(n,_)}}}function Gs(l){let e;return{c(){e=K("Fetch")},m(t,o){S(t,e,o)},d(t){t&&C(e)}}}function Ks(l){let e,t;return e=new Cl({props:{type:"is-primary",$$slots:{default:[Gs]},$$scope:{ctx:l}}}),e.$on("click",l[9]),e.$on("submit",l[9]),{c(){se(e.$$.fragment)},m(o,n){re(e,o,n),t=!0},p(o,n){const u={};n&268435456&&(u.$$scope={dirty:n,ctx:o}),e.$set(u)},i(o){t||(H(e.$$.fragment,o),t=!0)},o(o){q(e.$$.fragment,o),t=!1},d(o){ie(e,o)}}}function Bs(l){let e,t,o,n,u,s;return e=new Mt({props:{grouped:!0,$$slots:{default:[Hs]},$$scope:{ctx:l}}}),o=new Mt({props:{grouped:!0,$$slots:{default:[Ws]},$$scope:{ctx:l}}}),u=new Mt({props:{grouped:!0,$$slots:{default:[Ks]},$$scope:{ctx:l}}}),{c(){se(e.$$.fragment),t=g(),se(o.$$.fragment),n=g(),se(u.$$.fragment)},m(c,r){re(e,c,r),S(c,t,r),re(o,c,r),S(c,n,r),re(u,c,r),s=!0},p(c,r){const p={};r&268435464&&(p.$$scope={dirty:r,ctx:c}),e.$set(p);const d={};r&268435476&&(d.$$scope={dirty:r,ctx:c}),o.$set(d);const _={};r&268435456&&(_.$$scope={dirty:r,ctx:c}),u.$set(_)},i(c){s||(H(e.$$.fragment,c),H(o.$$.fragment,c),H(u.$$.fragment,c),s=!0)},o(c){q(e.$$.fragment,c),q(o.$$.fragment,c),q(u.$$.fragment,c),s=!1},d(c){ie(e,c),c&&C(t),ie(o,c),c&&C(n),ie(u,c)}}}function qs(l){let e,t,o,n,u;return n=new Hn({props:{content:l[1],onChange:l[7]}}),{c(){e=f("p"),e.innerHTML=`<i>The best editing experience is to configure Atomic Server, in the
        meantime use editor below. You will need to refresh page via Command R
        or Ctrl-R to see changes</i>`,t=g(),o=f("div"),se(n.$$.fragment),a(o,"class","editor")},m(s,c){S(s,e,c),S(s,t,c),S(s,o,c),re(n,o,null),u=!0},p(s,c){const r={};c&2&&(r.content=s[1]),n.$set(r)},i(s){u||(H(n.$$.fragment,s),u=!0)},o(s){q(n.$$.fragment,s),u=!1},d(s){s&&C(e),s&&C(t),s&&C(o),ie(n)}}}function io(l){let e,t;return e=new Os({props:{subject:l[25]}}),{c(){se(e.$$.fragment)},m(o,n){re(e,o,n),t=!0},p(o,n){const u={};n&1&&(u.subject=o[25]),e.$set(u)},i(o){t||(H(e.$$.fragment,o),t=!0)},o(o){q(e.$$.fragment,o),t=!1},d(o){ie(e,o)}}}function Js(l){let e,t,o=l[0]??[],n=[];for(let s=0;s<o.length;s+=1)n[s]=io(ro(l,o,s));const u=s=>q(n[s],1,1,()=>{n[s]=null});return{c(){for(let s=0;s<n.length;s+=1)n[s].c();e=tt()},m(s,c){for(let r=0;r<n.length;r+=1)n[r]&&n[r].m(s,c);S(s,e,c),t=!0},p(s,c){if(c&1){o=s[0]??[];let r;for(r=0;r<o.length;r+=1){const p=ro(s,o,r);n[r]?(n[r].p(p,c),H(n[r],1)):(n[r]=io(p),n[r].c(),H(n[r],1),n[r].m(e.parentNode,e))}for(Me(),r=o.length;r<n.length;r+=1)u(r);De()}},i(s){if(!t){for(let c=0;c<o.length;c+=1)H(n[c]);t=!0}},o(s){n=n.filter(Boolean);for(let c=0;c<n.length;c+=1)q(n[c]);t=!1},d(s){We(n,s),s&&C(e)}}}function Vs(l){let e,t;return e=new os({props:{$$slots:{default:[Js]},$$scope:{ctx:l}}}),{c(){se(e.$$.fragment)},m(o,n){re(e,o,n),t=!0},p(o,n){const u={};n&268435457&&(u.$$scope={dirty:n,ctx:o}),e.$set(u)},i(o){t||(H(e.$$.fragment,o),t=!0)},o(o){q(e.$$.fragment,o),t=!1},d(o){ie(e,o)}}}function Ys(l){let e,t,o,n,u,s,c,r,p,d,_,m,k,v,w;return e=new nl({props:{fallbackPath:"/"}}),n=new Ct({props:{path:"/atomic",$$slots:{default:[zs]},$$scope:{ctx:l}}}),s=new Ct({props:{path:"/json",$$slots:{default:[Bs]},$$scope:{ctx:l}}}),r=new Ct({props:{path:"/editor",$$slots:{default:[qs]},$$scope:{ctx:l}}}),m=new Mt({props:{grouped:!0,position:"is-right",$$slots:{default:[Vs]},$$scope:{ctx:l}}}),{c(){se(e.$$.fragment),t=g(),o=f("div"),se(n.$$.fragment),u=g(),se(s.$$.fragment),c=g(),se(r.$$.fragment),p=g(),d=f("hr"),_=g(),se(m.$$.fragment),k=g(),v=f("nav"),v.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
    <a class="navbar-item" href="/fetch/json">Fetch JSON Data</a> 
    <a class="navbar-item" href="/fetch/atomic">Set Atomic Server</a> 
    <a class="navbar-item" href="/fetch/editor">Edit JSON config</a></div>`,a(o,"class","box"),a(v,"class","navbar")},m(h,T){re(e,h,T),S(h,t,T),S(h,o,T),re(n,o,null),i(o,u),re(s,o,null),i(o,c),re(r,o,null),S(h,p,T),S(h,d,T),S(h,_,T),re(m,h,T),S(h,k,T),S(h,v,T),w=!0},p(h,[T]){const $={};T&268435552&&($.$$scope={dirty:T,ctx:h}),n.$set($);const b={};T&268435484&&(b.$$scope={dirty:T,ctx:h}),s.$set(b);const U={};T&268435458&&(U.$$scope={dirty:T,ctx:h}),r.$set(U);const J={};T&268435457&&(J.$$scope={dirty:T,ctx:h}),m.$set(J)},i(h){w||(H(e.$$.fragment,h),H(n.$$.fragment,h),H(s.$$.fragment,h),H(r.$$.fragment,h),H(m.$$.fragment,h),w=!0)},o(h){q(e.$$.fragment,h),q(n.$$.fragment,h),q(s.$$.fragment,h),q(r.$$.fragment,h),q(m.$$.fragment,h),w=!1},d(h){ie(e,h),h&&C(t),h&&C(o),ie(n),ie(s),ie(r),h&&C(p),h&&C(d),h&&C(_),ie(m,h),h&&C(k),h&&C(v)}}}function Zs(l,e,t){let o,n,u,s,c;Re(l,ds,A=>t(19,u=A)),Re(l,Be,A=>t(20,s=A)),Re(l,gt,A=>t(21,c=A));let r={json:c};function p(A){if(console.log("contents changed:",A),console.log("is tauri",s),gt.update(R=>(R=A.json,R)),Be)console.log("Updating config on server"),qe("update_config",{configNew:A.json}).then(R=>{console.log(`Message: ${R}`)}).catch(R=>console.error(R));else{let R=`${at.ServerURL}/config/`;fetch(R,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(A.json)})}t(1,r=A)}let d=!1,_="https://raw.githubusercontent.com/terraphim/terraphim-cloud-fastapi/main/data/ref_arch.json",m="http://localhost:8000/documents/",k="http://localhost:9883/",v;const w=async()=>{console.log("Updating atomic server configuration");const A=_s.fromSecret(v);u.setServerUrl(k),console.log("Server set.Setting agent"),u.setAgent(A)},h=async()=>{b()},T=({data:{msg:A,data:R}})=>{console.log(A,R)};let $;const b=async()=>{const A=await fs(()=>import("./fetcher.worker-7e58969a.js"),[]);$=new A.default,$.onmessage=T;const R={msg:"fetcher",data:{url:_,postUrl:m,isWiki:d}};$.postMessage(R)},U=Fn("http://localhost:9883/config/y3zx5wtm0bq"),J=Sl(U,Wn.properties.name);Re(l,J,A=>t(12,n=A));const M=Sl(U,"http://localhost:9883/property/role");Re(l,M,A=>t(0,o=A));function L(A){k=A,t(5,k)}function O(A){v=A,t(6,v)}function G(A){_=A,t(3,_)}function F(A){m=A,t(4,m)}function B(A){d=A,t(2,d)}return l.$$.update=()=>{l.$$.dirty&4096&&console.log("Print name",n),l.$$.dirty&1&&console.log("Print roles",o)},[o,r,d,_,m,k,v,p,w,h,J,M,n,L,O,G,F,B]}class Qs extends ct{constructor(e){super(),ft(this,e,Zs,Ys,et,{})}}class Xs{constructor(){wl(this,"baseUrl");wl(this,"autocompleteIndexBuilt",!1);wl(this,"sessionId");this.baseUrl="http://localhost:8001",this.sessionId=`novel-${Date.now()}`}async buildAutocompleteIndex(){try{const e=await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:1,method:"tools/call",params:{name:"build_autocomplete_index",arguments:{}}})});if(e.ok){const t=await e.json();if(console.log("Build index response:",t),t.result&&!t.result.is_error)return this.autocompleteIndexBuilt=!0,console.log("Novel autocomplete index built successfully"),!0}return console.warn("Failed to build Novel autocomplete index"),!1}catch(e){return console.error("Error building Novel autocomplete index:",e),!1}}async getCompletion(e){if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return{text:""};try{const t=this.extractLastWord(e.prompt);if(!t||t.length<2)return{text:""};const o=await this.getSuggestionsWithSnippets(t,5);if(o.length===0)return{text:""};const u=o[0].text,s=e.prompt.length/4,c=u.length/4;return{text:u,usage:{promptTokens:Math.round(s),completionTokens:Math.round(c),totalTokens:Math.round(s+c)}}}catch(t){return console.error("Error getting Novel autocomplete completion:",t),{text:""}}}async getSuggestions(e,t=10){if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return[];try{const o=await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:1,method:"tools/call",params:{name:"autocomplete_terms",arguments:{query:e,limit:t}}})});if(o.ok){const n=await o.json();if(console.log("Get suggestions response:",n),n.result&&!n.result.is_error&&n.result.content)return this.parseAutocompleteContent(n.result.content)}return[]}catch(o){return console.error("Error getting autocomplete suggestions:",o),[]}}async getSuggestionsWithSnippets(e,t=10){if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return[];try{const o=await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:1,method:"tools/call",params:{name:"autocomplete_with_snippets",arguments:{query:e,limit:t}}})});if(o.ok){const n=await o.json();if(console.log("Get suggestions with snippets response:",n),n.result&&!n.result.is_error&&n.result.content)return this.parseAutocompleteWithSnippetsContent(n.result.content)}return[]}catch(o){return console.error("Error getting autocomplete suggestions with snippets:",o),[]}}extractLastWord(e){const t=e.trim().split(/\s+/);return t[t.length-1]||""}parseAutocompleteContent(e){const t=[];for(const o of e)if(o.type==="text"&&o.text){if(!o.text.startsWith("Found")&&!o.text.startsWith("•"))t.push({text:o.text.trim()});else if(o.text.startsWith("•")){const n=o.text.replace("•","").trim();n&&t.push({text:n})}}return t}parseAutocompleteWithSnippetsContent(e){const t=[];for(const o of e)if(o.type==="text"&&o.text){if(!o.text.startsWith("Found")&&!o.text.startsWith("•")){const n=o.text.split(" — ");n.length===2?t.push({text:n[0].trim(),snippet:n[1].trim()}):t.push({text:o.text.trim()})}else if(o.text.startsWith("•")){const n=o.text.replace("•","").trim();n&&t.push({text:n})}}return t}isReady(){return this.autocompleteIndexBuilt}getStatus(){return{ready:this.autocompleteIndexBuilt,baseUrl:this.baseUrl,sessionId:this.sessionId}}}const Nl=new Xs;function ao(l){let e,t,o,n,u,s,c,r,p,d,_,m,k,v,w,h,T,$,b,U,J,M,L,O,G,F,B,A,R;function Z(Y,y){return Y[3]?er:xs}let N=Z(l),z=N(l),X=l[6].length>0&&uo(),W=l[6].length>0&&co(l);return{c(){e=f("div"),t=f("div"),o=f("strong"),o.textContent="Local Autocomplete Status:",n=g(),u=f("div"),s=f("button"),c=K("Test"),p=g(),d=f("button"),d.textContent="Rebuild Index",_=g(),m=f("button"),k=K("Demo"),w=g(),h=f("div"),T=K(l[4]),$=g(),b=f("div"),U=f("strong"),U.textContent="Features:",J=g(),z.c(),M=g(),L=f("br"),O=K(`• Type at least 2 characters to trigger
      `),G=f("br"),F=K(`• Uses role-based knowledge graph for suggestions
      `),X&&X.c(),B=g(),W&&W.c(),fe(o,"color","#495057"),fe(s,"padding","4px 8px"),fe(s,"background","#007bff"),fe(s,"color","white"),fe(s,"border","none"),fe(s,"border-radius","4px"),fe(s,"cursor","pointer"),fe(s,"font-size","12px"),s.disabled=r=!l[5],fe(d,"padding","4px 8px"),fe(d,"background","#28a745"),fe(d,"color","white"),fe(d,"border","none"),fe(d,"border-radius","4px"),fe(d,"cursor","pointer"),fe(d,"font-size","12px"),fe(m,"padding","4px 8px"),fe(m,"background","#ffc107"),fe(m,"color","#212529"),fe(m,"border","none"),fe(m,"border-radius","4px"),fe(m,"cursor","pointer"),fe(m,"font-size","12px"),m.disabled=v=!l[5],fe(u,"display","flex"),fe(u,"gap","8px"),fe(t,"display","flex"),fe(t,"justify-content","space-between"),fe(t,"align-items","center"),fe(t,"margin-bottom","8px"),fe(h,"font-size","13px"),fe(h,"color","#6c757d"),fe(h,"margin-bottom","8px"),fe(b,"font-size","12px"),fe(b,"color","#6c757d"),fe(e,"margin-top","10px"),fe(e,"padding","12px"),fe(e,"background","#f8f9fa"),fe(e,"border-radius","6px"),fe(e,"border","1px solid #e9ecef")},m(Y,y){S(Y,e,y),i(e,t),i(t,o),i(t,n),i(t,u),i(u,s),i(s,c),i(u,p),i(u,d),i(u,_),i(u,m),i(m,k),i(e,w),i(e,h),i(h,T),i(e,$),i(e,b),i(b,U),i(b,J),z.m(b,null),i(b,M),i(b,L),i(b,O),i(b,G),i(b,F),X&&X.m(b,null),i(e,B),W&&W.m(e,null),A||(R=[Q(s,"click",l[8]),Q(d,"click",l[9]),Q(m,"click",l[10])],A=!0)},p(Y,y){y&32&&r!==(r=!Y[5])&&(s.disabled=r),y&32&&v!==(v=!Y[5])&&(m.disabled=v),y&16&&be(T,Y[4]),N!==(N=Z(Y))&&(z.d(1),z=N(Y),z&&(z.c(),z.m(b,M))),Y[6].length>0?X||(X=uo(),X.c(),X.m(b,null)):X&&(X.d(1),X=null),Y[6].length>0?W?W.p(Y,y):(W=co(Y),W.c(),W.m(e,null)):W&&(W.d(1),W=null)},d(Y){Y&&C(e),z.d(),X&&X.d(),W&&W.d(),A=!1,Ge(R)}}}function xs(l){let e,t;return{c(){e=f("br"),t=K("• Local autocomplete from MCP server")},m(o,n){S(o,e,n),S(o,t,n)},d(o){o&&C(e),o&&C(t)}}}function er(l){let e,t;return{c(){e=f("br"),t=K("• Local autocomplete with snippets from MCP server")},m(o,n){S(o,e,n),S(o,t,n)},d(o){o&&C(e),o&&C(t)}}}function uo(l){let e,t,o,n;return{c(){e=f("br"),t=K("• "),o=f("strong"),o.textContent="Demo Mode:",n=K(" Using mock suggestions for demonstration")},m(u,s){S(u,e,s),S(u,t,s),S(u,o,s),S(u,n,s)},d(u){u&&C(e),u&&C(t),u&&C(o),u&&C(n)}}}function co(l){let e,t,o,n,u=l[6].slice(0,6).join(" • ")+"",s,c,r=l[6].length>6&&fo(l);return{c(){e=f("div"),t=f("strong"),t.textContent="🎯 Mock Autocomplete Suggestions:",o=g(),n=f("div"),s=K(u),c=g(),r&&r.c(),fe(n,"font-size","11px"),fe(n,"margin-top","4px"),fe(e,"margin-top","8px"),fe(e,"padding","8px"),fe(e,"background","#fff3cd"),fe(e,"border","1px solid #ffeaa7"),fe(e,"border-radius","4px")},m(p,d){S(p,e,d),i(e,t),i(e,o),i(e,n),i(n,s),i(n,c),r&&r.m(n,null)},p(p,d){d&64&&u!==(u=p[6].slice(0,6).join(" • ")+"")&&be(s,u),p[6].length>6?r?r.p(p,d):(r=fo(p),r.c(),r.m(n,null)):r&&(r.d(1),r=null)},d(p){p&&C(e),r&&r.d()}}}function fo(l){let e,t,o=l[6].length-6+"",n,u;return{c(){e=f("br"),t=K("... and "),n=K(o),u=K(" more")},m(s,c){S(s,e,c),S(s,t,c),S(s,n,c),S(s,u,c)},p(s,c){c&64&&o!==(o=s[6].length-6+"")&&be(n,o)},d(s){s&&C(e),s&&C(t),s&&C(n),s&&C(u)}}}function tr(l){let e,t,o,n;e=new gs({props:{defaultValue:l[0],isEditable:!l[1],disableLocalStorage:!0,onUpdate:l[7],extensions:[ps]}});let u=l[2]&&ao(l);return{c(){se(e.$$.fragment),t=g(),u&&u.c(),o=tt()},m(s,c){re(e,s,c),S(s,t,c),u&&u.m(s,c),S(s,o,c),n=!0},p(s,[c]){const r={};c&1&&(r.defaultValue=s[0]),c&2&&(r.isEditable=!s[1]),e.$set(r),s[2]?u?u.p(s,c):(u=ao(s),u.c(),u.m(o.parentNode,o)):u&&(u.d(1),u=null)},i(s){n||(H(e.$$.fragment,s),n=!0)},o(s){q(e.$$.fragment,s),n=!1},d(s){ie(e,s),s&&C(t),u&&u.d(s),s&&C(o)}}}function lr(l,e,t){let{html:o=""}=e,{readOnly:n=!1}=e,{outputFormat:u="html"}=e,{enableAutocomplete:s=!0}=e,{showSnippets:c=!0}=e,r=null,p="⏳ Initializing...",d=!1,_=[];Kt(async()=>{if(s)try{await Nl.buildAutocompleteIndex()?(t(4,p="✅ Ready - Type to trigger autocomplete"),t(5,d=!0)):(t(4,p="⚠️ Using mock autocomplete (MCP server not responding)"),t(5,d=!0),t(6,_=["terraphim-graph","terraphim-automata","terraphim-service","terraphim-types","terraphim-config","knowledge-graph","role-based-search","haystack-integration","atomic-server","mcp-protocol"]))}catch(h){console.error("Error initializing autocomplete:",h),t(4,p="⚠️ Using mock autocomplete (MCP server error)"),t(5,d=!0),t(6,_=["terraphim-graph","terraphim-automata","terraphim-service","terraphim-types","terraphim-config","knowledge-graph","role-based-search","haystack-integration","atomic-server","mcp-protocol"])}});const m=h=>{r=h,u==="markdown"?t(0,o=h.storage.markdown.getMarkdown()):t(0,o=h.getHTML())},k=async()=>{if(d)try{if(_.length>0)console.log("Mock autocomplete suggestions:",_),alert(`Found ${_.length} mock suggestions:
${_.slice(0,5).join(`
`)}`);else{const h=await Nl.getSuggestions("terraphim",5);console.log("Autocomplete test results:",h),alert(`Found ${h.length} suggestions for 'terraphim'`)}}catch(h){console.error("Autocomplete test failed:",h),alert("Autocomplete test failed - check console for details")}else alert("Autocomplete service not ready yet")},v=async()=>{t(4,p="⏳ Rebuilding index...");try{await Nl.buildAutocompleteIndex()?(t(4,p="✅ Ready - Index rebuilt successfully"),t(5,d=!0)):(t(4,p="⚠️ Using mock autocomplete (MCP server not responding)"),t(5,d=!0))}catch(h){console.error("Error rebuilding index:",h),t(4,p="⚠️ Using mock autocomplete (MCP server error)"),t(5,d=!0)}},w=()=>{if(r&&_.length>0){const h=`# Terraphim Autocomplete Demo

This is a demonstration of how autocomplete would work in the Novel editor.

Try typing these terms to see autocomplete suggestions:
- terraphim
- graph
- service
- automata

The autocomplete system provides suggestions based on your knowledge graph and document content.`;r.commands.setContent(h),alert('Demo content inserted! Type "terraphim" or "graph" to see autocomplete suggestions.')}};return l.$$set=h=>{"html"in h&&t(0,o=h.html),"readOnly"in h&&t(1,n=h.readOnly),"outputFormat"in h&&t(11,u=h.outputFormat),"enableAutocomplete"in h&&t(2,s=h.enableAutocomplete),"showSnippets"in h&&t(3,c=h.showSnippets)},[o,n,s,c,p,d,_,m,k,v,w,u]}class or extends ct{constructor(e){super(),ft(this,e,lr,tr,et,{html:0,readOnly:1,outputFormat:11,enableAutocomplete:2,showSnippets:3})}}function po(l){let e,t,o,n,u,s,c,r,p,d,_;return{c(){e=f("div"),t=f("h3"),o=f("span"),o.textContent="Knowledge Graph",n=K(`
          Term: `),u=f("strong"),s=K(l[2]),c=K(" | Rank: "),r=f("strong"),p=K(l[3]),d=g(),_=f("hr"),a(o,"class","tag is-info svelte-329px1"),a(t,"class","subtitle is-6 svelte-329px1"),a(_,"class","svelte-329px1"),a(e,"class","kg-context svelte-329px1")},m(m,k){S(m,e,k),i(e,t),i(t,o),i(t,n),i(t,u),i(u,s),i(t,c),i(t,r),i(r,p),i(e,d),i(e,_)},p(m,k){k&4&&be(s,m[2]),k&8&&be(p,m[3])},d(m){m&&C(e)}}}function nr(l){let e,t,o,n,u,s,c,r;const p=[ir,rr],d=[];function _(m,k){return m[5]?0:1}return t=_(l),o=d[t]=p[t](l),{c(){e=f("div"),o.c(),n=g(),u=f("div"),u.innerHTML='<span class="hint-text svelte-329px1">Double-click to edit • Ctrl+E to edit • Ctrl+S to save • Click KG links to explore</span>',a(u,"class","edit-hint svelte-329px1"),a(e,"class","content-viewer svelte-329px1"),a(e,"tabindex","0"),a(e,"role","button"),a(e,"aria-label","Double-click to edit article content")},m(m,k){S(m,e,k),d[t].m(e,null),i(e,n),i(e,u),l[20](e),s=!0,c||(r=[Q(e,"dblclick",l[14]),Q(e,"keydown",l[15]),Q(e,"click",l[13])],c=!0)},p(m,k){let v=t;t=_(m),t===v?d[t].p(m,k):(Me(),q(d[v],1,1,()=>{d[v]=null}),De(),o=d[t],o?o.p(m,k):(o=d[t]=p[t](m),o.c()),H(o,1),o.m(e,n))},i(m){s||(H(o),s=!0)},o(m){q(o),s=!1},d(m){m&&C(e),d[t].d(),l[20](null),c=!1,Ge(r)}}}function sr(l){let e,t,o,n,u,s,c,r,p,d;function _(k){l[18](k)}let m={outputFormat:l[11]};return l[1].body!==void 0&&(m.html=l[1].body),e=new or({props:m}),Fe.push(()=>Je(e,"html",_)),{c(){se(e.$$.fragment),o=g(),n=f("div"),u=f("button"),u.textContent="Save",s=g(),c=f("button"),c.textContent="Cancel",a(u,"class","button is-primary"),a(c,"class","button is-light"),a(n,"class","edit-controls svelte-329px1")},m(k,v){re(e,k,v),S(k,o,v),S(k,n,v),i(n,u),i(n,s),i(n,c),r=!0,p||(d=[Q(u,"click",l[12]),Q(c,"click",l[19])],p=!0)},p(k,v){const w={};v&2048&&(w.outputFormat=k[11]),!t&&v&2&&(t=!0,w.html=k[1].body,Ve(()=>t=!1)),e.$set(w)},i(k){r||(H(e.$$.fragment,k),r=!0)},o(k){q(e.$$.fragment,k),r=!1},d(k){ie(e,k),k&&C(o),k&&C(n),p=!1,Ge(d)}}}function rr(l){let e,t,o;return t=new Tl({props:{source:l[1].body}}),{c(){e=f("div"),se(t.$$.fragment),a(e,"class","markdown-content svelte-329px1")},m(n,u){S(n,e,u),re(t,e,null),o=!0},p(n,u){const s={};u&2&&(s.source=n[1].body),t.$set(s)},i(n){o||(H(t.$$.fragment,n),o=!0)},o(n){q(t.$$.fragment,n),o=!1},d(n){n&&C(e),ie(t)}}}function ir(l){let e,t=l[1].body+"";return{c(){e=f("div"),a(e,"class","prose svelte-329px1")},m(o,n){S(o,e,n),e.innerHTML=t},p(o,n){n&2&&t!==(t=o[1].body+"")&&(e.innerHTML=t)},i:Se,o:Se,d(o){o&&C(e)}}}function ar(l){let e,t,o,n,u,s=l[1].title+"",c,r,p,d,_,m,k,v=l[2]&&l[3]!==null&&po(l);const w=[sr,nr],h=[];function T($,b){return $[4]?0:1}return p=T(l),d=h[p]=w[p](l),{c(){e=f("div"),t=f("button"),o=g(),v&&v.c(),n=g(),u=f("h2"),c=K(s),r=g(),d.c(),a(t,"class","delete is-large modal-close-btn svelte-329px1"),a(t,"aria-label","close"),a(u,"class","svelte-329px1"),a(e,"class","box wrapper svelte-329px1")},m($,b){S($,e,b),i(e,t),i(e,o),v&&v.m(e,null),i(e,n),i(e,u),i(u,c),i(e,r),h[p].m(e,null),_=!0,m||(k=Q(t,"click",l[17]),m=!0)},p($,b){$[2]&&$[3]!==null?v?v.p($,b):(v=po($),v.c(),v.m(e,n)):v&&(v.d(1),v=null),(!_||b&2)&&s!==(s=$[1].title+"")&&be(c,s);let U=p;p=T($),p===U?h[p].p($,b):(Me(),q(h[U],1,1,()=>{h[U]=null}),De(),d=h[p],d?d.p($,b):(d=h[p]=w[p]($),d.c()),H(d,1),d.m(e,null))},i($){_||(H(d),_=!0)},o($){q(d),_=!1},d($){$&&C(e),v&&v.d(),h[p].d(),m=!1,k()}}}function _o(l){let e,t,o;function n(s){l[23](s)}let u={$$slots:{default:[fr]},$$scope:{ctx:l}};return l[7]!==void 0&&(u.active=l[7]),e=new El({props:u}),Fe.push(()=>Je(e,"active",n)),{c(){se(e.$$.fragment)},m(s,c){re(e,s,c),o=!0},p(s,c){const r={};c&536872832&&(r.$$scope={dirty:c,ctx:s}),!t&&c&128&&(t=!0,r.active=s[7],Ve(()=>t=!1)),e.$set(r)},i(s){o||(H(e.$$.fragment,s),o=!0)},o(s){q(e.$$.fragment,s),o=!1},d(s){ie(e,s)}}}function mo(l){let e,t,o,n,u,s,c,r,p,d,_;return{c(){e=f("div"),t=f("h3"),o=f("span"),o.textContent="Knowledge Graph",n=K(`
            Term: `),u=f("strong"),s=K(l[9]),c=K(" | Rank: "),r=f("strong"),p=K(l[10]),d=g(),_=f("hr"),a(o,"class","tag is-info svelte-329px1"),a(t,"class","subtitle is-6 svelte-329px1"),a(_,"class","svelte-329px1"),a(e,"class","kg-context svelte-329px1")},m(m,k){S(m,e,k),i(e,t),i(t,o),i(t,n),i(t,u),i(u,s),i(t,c),i(t,r),i(r,p),i(e,d),i(e,_)},p(m,k){k&512&&be(s,m[9]),k&1024&&be(p,m[10])},d(m){m&&C(e)}}}function ur(l){let e,t,o;return t=new Tl({props:{source:l[8].body}}),{c(){e=f("div"),se(t.$$.fragment),a(e,"class","markdown-content svelte-329px1")},m(n,u){S(n,e,u),re(t,e,null),o=!0},p(n,u){const s={};u&256&&(s.source=n[8].body),t.$set(s)},i(n){o||(H(t.$$.fragment,n),o=!0)},o(n){q(t.$$.fragment,n),o=!1},d(n){n&&C(e),ie(t)}}}function cr(l){let e,t=l[8].body+"";return{c(){e=f("div"),a(e,"class","prose svelte-329px1")},m(o,n){S(o,e,n),e.innerHTML=t},p(o,n){n&256&&t!==(t=o[8].body+"")&&(e.innerHTML=t)},i:Se,o:Se,d(o){o&&C(e)}}}function fr(l){let e,t,o,n,u,s=l[8].title+"",c,r,p,d,_,m,k,v,w,h,T,$=l[9]&&l[10]!==null&&mo(l);const b=[cr,ur],U=[];function J(M,L){return L&256&&(d=null),d==null&&(d=!!(M[8].body&&(/<html/i.test(M[8].body)||/<body/i.test(M[8].body)||/<head/i.test(M[8].body)))),d?0:1}return _=J(l,-1),m=U[_]=b[_](l),{c(){e=f("div"),t=f("button"),o=g(),$&&$.c(),n=g(),u=f("h2"),c=K(s),r=g(),p=f("div"),m.c(),k=g(),v=f("div"),v.innerHTML='<span class="hint-text svelte-329px1">Knowledge Graph document • Click KG links to explore further</span>',a(t,"class","delete is-large modal-close-btn svelte-329px1"),a(t,"aria-label","close"),a(u,"class","svelte-329px1"),a(v,"class","edit-hint svelte-329px1"),a(p,"class","content-viewer svelte-329px1"),a(p,"tabindex","0"),a(p,"role","button"),a(p,"aria-label","KG document content - click KG links to explore further"),a(e,"class","box wrapper svelte-329px1")},m(M,L){S(M,e,L),i(e,t),i(e,o),$&&$.m(e,null),i(e,n),i(e,u),i(u,c),i(e,r),i(e,p),U[_].m(p,null),i(p,k),i(p,v),w=!0,h||(T=[Q(t,"click",l[22]),Q(p,"click",l[13])],h=!0)},p(M,L){M[9]&&M[10]!==null?$?$.p(M,L):($=mo(M),$.c(),$.m(e,n)):$&&($.d(1),$=null),(!w||L&256)&&s!==(s=M[8].title+"")&&be(c,s);let O=_;_=J(M,L),_===O?U[_].p(M,L):(Me(),q(U[O],1,1,()=>{U[O]=null}),De(),m=U[_],m?m.p(M,L):(m=U[_]=b[_](M),m.c()),H(m,1),m.m(p,k))},i(M){w||(H(m),w=!0)},o(M){q(m),w=!1},d(M){M&&C(e),$&&$.d(),U[_].d(),h=!1,Ge(T)}}}function pr(l){let e,t,o,n,u;function s(p){l[21](p)}let c={$$slots:{default:[ar]},$$scope:{ctx:l}};l[0]!==void 0&&(c.active=l[0]),e=new El({props:c}),Fe.push(()=>Je(e,"active",s));let r=l[8]&&_o(l);return{c(){se(e.$$.fragment),o=g(),r&&r.c(),n=tt()},m(p,d){re(e,p,d),S(p,o,d),r&&r.m(p,d),S(p,n,d),u=!0},p(p,[d]){const _={};d&536873087&&(_.$$scope={dirty:d,ctx:p}),!t&&d&1&&(t=!0,_.active=p[0],Ve(()=>t=!1)),e.$set(_),p[8]?r?(r.p(p,d),d&256&&H(r,1)):(r=_o(p),r.c(),H(r,1),r.m(n.parentNode,n)):r&&(Me(),q(r,1,1,()=>{r=null}),De())},i(p){u||(H(e.$$.fragment,p),H(r),u=!0)},o(p){q(e.$$.fragment,p),q(r),u=!1},d(p){ie(e,p),p&&C(o),r&&r.d(p),p&&C(n)}}}function dr(l,e,t){let o,n,u,s;Re(l,Be,N=>t(25,u=N)),Re(l,St,N=>t(26,s=N));let{active:c=!1}=e,{item:r}=e,{initialEdit:p=!1}=e,{kgTerm:d=null}=e,{kgRank:_=null}=e,m=!1,k,v=!1,w=null,h=null,T=null;async function $(){if(u)try{const N=await qe("get_document",{documentId:r.id});N!=null&&N.document&&t(1,r=N.document)}catch(N){console.error("Failed to load document",N)}}async function b(){if(!u){t(4,m=!1);return}try{await qe("create_document",{document:r}),t(4,m=!1)}catch(N){console.error("Failed to save document",N)}}async function U(N){var z,X,W,Y,y;t(9,h=N),console.log("🔍 KG Link Click Debug Info:"),console.log("  Term clicked:",N),console.log("  Current role:",s),console.log("  Is Tauri mode:",u);try{if(u){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:s,term:N});const E=await qe("find_documents_for_kg_term",{roleName:s,term:N});console.log("  📥 Tauri response received:"),console.log("    Status:",E.status),console.log("    Results count:",((z=E.results)==null?void 0:z.length)||0),console.log("    Total:",E.total||0),console.log("    Full response:",JSON.stringify(E,null,2)),E.status==="success"&&E.results&&E.results.length>0?(t(8,w=E.results[0]),t(10,T=w.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",w.title),console.log("    Rank:",T),console.log("    Body length:",((X=w.body)==null?void 0:X.length)||0,"characters"),t(7,v=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${N}" in role: "${s}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const E=at.ServerURL,I=encodeURIComponent(s),D=encodeURIComponent(N),V=`${E}/roles/${I}/kg_search?term=${D}`;console.log("  📤 HTTP Request details:"),console.log("    Base URL:",E),console.log("    Role (encoded):",I),console.log("    Term (encoded):",D),console.log("    Full URL:",V);const x=await fetch(V);if(console.log("  📥 HTTP Response received:"),console.log("    Status code:",x.status),console.log("    Status text:",x.statusText),console.log("    Headers:",Object.fromEntries(x.headers.entries())),!x.ok)throw new Error(`HTTP error! Status: ${x.status} - ${x.statusText}`);const le=await x.json();console.log("  📄 Response data:"),console.log("    Status:",le.status),console.log("    Results count:",((W=le.results)==null?void 0:W.length)||0),console.log("    Total:",le.total||0),console.log("    Full response:",JSON.stringify(le,null,2)),le.status==="success"&&le.results&&le.results.length>0?(t(8,w=le.results[0]),t(10,T=w.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",w.title),console.log("    Rank:",T),console.log("    Body length:",((Y=w.body)==null?void 0:Y.length)||0,"characters"),t(7,v=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${N}" in role: "${s}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",V))}}catch(E){console.error("❌ Error fetching KG document:"),console.error("  Error type:",E.constructor.name),console.error("  Error message:",E.message||E),console.error("  Request details:",{term:N,role:s,isTauri:u,timestamp:new Date().toISOString()}),!u&&((y=E.message)!=null&&y.includes("Failed to fetch"))&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{}}function J(N){const z=N.target;if(z.tagName==="A"){const X=z.getAttribute("href");if(X&&X.startsWith("kg:")){N.preventDefault();const W=X.substring(3);U(W)}}}function M(){t(4,m=!0)}function L(N){N.type!=="dblclick"&&((N.ctrlKey||N.metaKey)&&N.key==="e"&&(N.preventDefault(),t(4,m=!0)),m&&(N.ctrlKey||N.metaKey)&&N.key==="s"&&(N.preventDefault(),b()),N.key==="Escape"&&(N.preventDefault(),m?t(4,m=!1):t(0,c=!1)))}const O=()=>t(0,c=!1);function G(N){l.$$.not_equal(r.body,N)&&(r.body=N,t(1,r))}const F=()=>t(4,m=!1);function B(N){Fe[N?"unshift":"push"](()=>{k=N,t(6,k)})}function A(N){c=N,t(0,c)}const R=()=>t(7,v=!1);function Z(N){v=N,t(7,v)}return l.$$set=N=>{"active"in N&&t(0,c=N.active),"item"in N&&t(1,r=N.item),"initialEdit"in N&&t(16,p=N.initialEdit),"kgTerm"in N&&t(2,d=N.kgTerm),"kgRank"in N&&t(3,_=N.kgRank)},l.$$.update=()=>{l.$$.dirty&65537&&c&&p&&t(4,m=!0),l.$$.dirty&19&&c&&r&&!m&&$(),l.$$.dirty&2&&t(5,o=r!=null&&r.body?/<html/i.test(r.body)||/<body/i.test(r.body)||/<head/i.test(r.body)||/^\s*<(!DOCTYPE|html|head|body|div|p|span)/i.test(r.body.trim()):!1),l.$$.dirty&32&&t(11,n=o?"html":"markdown")},[c,r,d,_,m,o,k,v,w,h,T,n,b,J,M,L,p,O,G,F,B,A,R,Z]}class Ml extends ct{constructor(e){super(),ft(this,e,dr,pr,et,{active:0,item:1,initialEdit:16,kgTerm:2,kgRank:3})}}function ho(l,e,t){const o=l.slice();return o[33]=e[t],o}function go(l,e,t){const o=l.slice();return o[36]=e[t],o}function bo(l,e,t){const o=l.slice();return o[39]=e[t],o}function vo(l){let e,t;return e=new In({props:{type:"is-success",$$slots:{default:[_r]},$$scope:{ctx:l}}}),{c(){se(e.$$.fragment)},m(o,n){re(e,o,n),t=!0},i(o){t||(H(e.$$.fragment,o),t=!0)},o(o){q(e.$$.fragment,o),t=!1},d(o){ie(e,o)}}}function _r(l){let e,t,o;return{c(){e=f("p"),e.innerHTML="<strong>Success!</strong> Article saved to atomic server successfully.",t=g(),o=f("p"),o.textContent="The modal will close automatically..."},m(n,u){S(n,e,u),S(n,t,u),S(n,o,u)},p:Se,d(n){n&&C(e),n&&C(t),n&&C(o)}}}function ko(l){let e,t;return e=new In({props:{type:"is-danger",$$slots:{default:[mr]},$$scope:{ctx:l}}}),{c(){se(e.$$.fragment)},m(o,n){re(e,o,n),t=!0},p(o,n){const u={};n[0]&8|n[1]&2048&&(u.$$scope={dirty:n,ctx:o}),e.$set(u)},i(o){t||(H(e.$$.fragment,o),t=!0)},o(o){q(e.$$.fragment,o),t=!1},d(o){ie(e,o)}}}function mr(l){let e,t,o,n;return{c(){e=f("p"),t=f("strong"),t.textContent="Error:",o=g(),n=K(l[3])},m(u,s){S(u,e,s),i(e,t),i(e,o),i(e,n)},p(u,s){s[0]&8&&be(n,u[3])},d(u){u&&C(e)}}}function wo(l){var Z,N,z,X;let e,t,o,n,u,s=(((Z=l[1])==null?void 0:Z.title)||"Untitled")+"",c,r,p,d,_,m,k=(((N=l[1])==null?void 0:N.rank)||0)+"",v,w,h,T,$,b,U,J,M,L,O=((z=l[1])==null?void 0:z.description)&&$o(l),G=((X=l[1])==null?void 0:X.tags)&&yo(l);function F(W,Y){return W[10].length>0?gr:hr}let B=F(l),A=B(l),R=l[10].length>0&&To(l);return{c(){e=f("div"),t=f("label"),t.textContent="Document to Save",o=g(),n=f("div"),u=f("h5"),c=K(s),r=g(),O&&O.c(),p=g(),d=f("div"),_=f("span"),m=K("Rank: "),v=K(k),w=g(),G&&G.c(),h=g(),T=f("div"),$=f("label"),$.textContent="Atomic Server",b=g(),U=f("div"),A.c(),J=g(),R&&R.c(),M=tt(),a(t,"class","label"),a(u,"class","title is-6"),a(_,"class","tag is-info svelte-48g63o"),a(d,"class","tags svelte-48g63o"),a(n,"class","box document-preview svelte-48g63o"),a(e,"class","field"),a($,"class","label"),a($,"for","atomic-server-select"),a(U,"class","control"),a(T,"class","field")},m(W,Y){S(W,e,Y),i(e,t),i(e,o),i(e,n),i(n,u),i(u,c),i(n,r),O&&O.m(n,null),i(n,p),i(n,d),i(d,_),i(_,m),i(_,v),i(d,w),G&&G.m(d,null),S(W,h,Y),S(W,T,Y),i(T,$),i(T,b),i(T,U),A.m(U,null),S(W,J,Y),R&&R.m(W,Y),S(W,M,Y),L=!0},p(W,Y){var y,E,I,D;(!L||Y[0]&2)&&s!==(s=(((y=W[1])==null?void 0:y.title)||"Untitled")+"")&&be(c,s),(E=W[1])!=null&&E.description?O?O.p(W,Y):(O=$o(W),O.c(),O.m(n,p)):O&&(O.d(1),O=null),(!L||Y[0]&2)&&k!==(k=(((I=W[1])==null?void 0:I.rank)||0)+"")&&be(v,k),(D=W[1])!=null&&D.tags?G?G.p(W,Y):(G=yo(W),G.c(),G.m(d,null)):G&&(G.d(1),G=null),B===(B=F(W))&&A?A.p(W,Y):(A.d(1),A=B(W),A&&(A.c(),A.m(U,null))),W[10].length>0?R?(R.p(W,Y),Y[0]&1024&&H(R,1)):(R=To(W),R.c(),H(R,1),R.m(M.parentNode,M)):R&&(Me(),q(R,1,1,()=>{R=null}),De())},i(W){L||(H(R),L=!0)},o(W){q(R),L=!1},d(W){W&&C(e),O&&O.d(),G&&G.d(),W&&C(h),W&&C(T),A.d(),W&&C(J),R&&R.d(W),W&&C(M)}}}function $o(l){let e,t=l[1].description+"",o;return{c(){e=f("p"),o=K(t),a(e,"class","content")},m(n,u){S(n,e,u),i(e,o)},p(n,u){u[0]&2&&t!==(t=n[1].description+"")&&be(o,t)},d(n){n&&C(e)}}}function yo(l){let e,t=l[1].tags,o=[];for(let n=0;n<t.length;n+=1)o[n]=Co(bo(l,t,n));return{c(){for(let n=0;n<o.length;n+=1)o[n].c();e=tt()},m(n,u){for(let s=0;s<o.length;s+=1)o[s]&&o[s].m(n,u);S(n,e,u)},p(n,u){if(u[0]&2){t=n[1].tags;let s;for(s=0;s<t.length;s+=1){const c=bo(n,t,s);o[s]?o[s].p(c,u):(o[s]=Co(c),o[s].c(),o[s].m(e.parentNode,e))}for(;s<o.length;s+=1)o[s].d(1);o.length=t.length}},d(n){We(o,n),n&&C(e)}}}function Co(l){let e,t=l[39]+"",o;return{c(){e=f("span"),o=K(t),a(e,"class","tag svelte-48g63o")},m(n,u){S(n,e,u),i(e,o)},p(n,u){u[0]&2&&t!==(t=n[39]+"")&&be(o,t)},d(n){n&&C(e)}}}function hr(l){let e,t,o,n,u,s,c,r,p;return{c(){e=f("div"),t=f("p"),t.innerHTML="<strong>No atomic servers available</strong>",o=g(),n=f("p"),u=K('Your current role "'),s=K(l[12]),c=K(`" doesn't have any writable atomic server configurations.`),r=g(),p=f("p"),p.textContent="Please configure an atomic server haystack in your role settings.",a(e,"class","notification is-warning")},m(d,_){S(d,e,_),i(e,t),i(e,o),i(e,n),i(n,u),i(n,s),i(n,c),i(e,r),i(e,p)},p(d,_){_[0]&4096&&be(s,d[12])},d(d){d&&C(e)}}}function gr(l){let e,t,o,n,u,s,c=l[10],r=[];for(let p=0;p<c.length;p+=1)r[p]=So(go(l,c,p));return{c(){e=f("div"),t=f("select");for(let p=0;p<r.length;p+=1)r[p].c();o=g(),n=f("p"),n.textContent=`Select the atomic server from your current role configuration.
              🔐 = Authenticated, ⚠️ = Anonymous access`,a(t,"id","atomic-server-select"),t.disabled=l[2],l[11]===void 0&&ut(()=>l[18].call(t)),a(e,"class","select is-fullwidth"),a(n,"class","help svelte-48g63o")},m(p,d){S(p,e,d),i(e,t);for(let _=0;_<r.length;_+=1)r[_]&&r[_].m(t,null);Pe(t,l[11],!0),S(p,o,d),S(p,n,d),u||(s=Q(t,"change",l[18]),u=!0)},p(p,d){if(d[0]&1024){c=p[10];let _;for(_=0;_<c.length;_+=1){const m=go(p,c,_);r[_]?r[_].p(m,d):(r[_]=So(m),r[_].c(),r[_].m(t,null))}for(;_<r.length;_+=1)r[_].d(1);r.length=c.length}d[0]&4&&(t.disabled=p[2]),d[0]&3072&&Pe(t,p[11])},d(p){p&&C(e),We(r,p),p&&C(o),p&&C(n),u=!1,s()}}}function br(l){let e;return{c(){e=f("span"),e.textContent="⚠️ No Auth",a(e,"class","has-text-warning")},m(t,o){S(t,e,o)},d(t){t&&C(e)}}}function vr(l){let e;return{c(){e=f("span"),e.textContent="🔐",a(e,"class","has-text-success")},m(t,o){S(t,e,o)},d(t){t&&C(e)}}}function So(l){let e,t=l[36].location+"",o,n,u,s;function c(d,_){return d[36].atomic_server_secret?vr:br}let r=c(l),p=r(l);return{c(){e=f("option"),o=K(t),n=g(),p.c(),u=g(),e.__value=s=l[36].location,e.value=e.__value},m(d,_){S(d,e,_),i(e,o),i(e,n),p.m(e,null),i(e,u)},p(d,_){_[0]&1024&&t!==(t=d[36].location+"")&&be(o,t),r!==(r=c(d))&&(p.d(1),p=r(d),p&&(p.c(),p.m(e,u))),_[0]&1024&&s!==(s=d[36].location)&&(e.__value=s,e.value=e.__value)},d(d){d&&C(e),p.d()}}}function To(l){var P,ee;let e,t,o,n,u,s,c,r,p,d,_,m,k,v,w,h,T,$,b,U,J,M,L,O,G,F,B,A,R,Z,N,z,X,W,Y,y,E,I,D,V,x,le,we,ve=(l[8]||"Untitled")+"",Ue,_e,ce,pe,Le,$e=(((ee=(P=l[1])==null?void 0:P.body)==null?void 0:ee.length)||0)+"",oe,me,ae,ge,lt,Te,Ae=l[14]()+"",te,ke,Ie,ot,pt,Ne=l[15]()+"",nt,He,_t,wt,Dt;function Ut(j){l[19](j)}let It={id:"article-title",placeholder:"Enter article title",disabled:l[2],required:!0};l[8]!==void 0&&(It.value=l[8]),u=new Bt({props:It}),Fe.push(()=>Je(u,"value",Ut));const Et=[wr,kr],st=[];function qt(j,ne){return j[7]?1:0}return F=qt(l),B=st[F]=Et[F](l),N=new Cl({props:{type:"is-primary",loading:l[2],disabled:l[2]||!l[8].trim()||!l[11],$$slots:{default:[$r]},$$scope:{ctx:l}}}),N.$on("click",l[16]),W=new Cl({props:{type:"is-light",disabled:l[2],$$slots:{default:[yr]},$$scope:{ctx:l}}}),W.$on("click",l[17]),_t=ss(l[22][0]),{c(){e=f("div"),t=f("label"),t.textContent="Article Title",o=g(),n=f("div"),se(u.$$.fragment),c=g(),r=f("div"),p=f("label"),p.textContent="Description",d=g(),_=f("div"),m=f("textarea"),k=g(),v=f("div"),w=f("label"),w.textContent="Parent Collection",h=g(),T=f("div"),$=f("label"),b=f("input"),U=K(`
              Use predefined collection`),J=g(),M=f("label"),L=f("input"),O=K(`
              Custom parent URL/path`),G=g(),B.c(),A=g(),R=f("div"),Z=f("div"),se(N.$$.fragment),z=g(),X=f("div"),se(W.$$.fragment),Y=g(),y=f("div"),E=f("div"),I=f("p"),I.innerHTML="<strong>What will be saved:</strong>",D=g(),V=f("ul"),x=f("li"),le=f("strong"),le.textContent="Title:",we=g(),Ue=K(ve),_e=g(),ce=f("li"),pe=f("strong"),pe.textContent="Body:",Le=K(" Original document content ("),oe=K($e),me=K(" characters)"),ae=g(),ge=f("li"),lt=f("strong"),lt.textContent="Parent:",Te=g(),te=K(Ae),ke=g(),Ie=f("li"),ot=f("strong"),ot.textContent="Subject URL:",pt=g(),nt=K(Ne),a(t,"class","label"),a(t,"for","article-title"),a(n,"class","control"),a(e,"class","field"),a(p,"class","label"),a(p,"for","article-description"),a(m,"id","article-description"),a(m,"class","textarea"),a(m,"placeholder","Brief description of the article"),m.disabled=l[2],a(m,"rows","3"),a(_,"class","control"),a(r,"class","field"),a(w,"class","label"),a(b,"type","radio"),b.__value=!1,b.value=b.__value,b.disabled=l[2],a($,"class","radio svelte-48g63o"),a(L,"type","radio"),L.__value=!0,L.value=L.__value,L.disabled=l[2],a(M,"class","radio svelte-48g63o"),a(T,"class","control"),a(v,"class","field"),a(Z,"class","control"),a(X,"class","control"),a(R,"class","field is-grouped"),a(x,"class","svelte-48g63o"),a(ce,"class","svelte-48g63o"),a(ge,"class","svelte-48g63o"),a(Ie,"class","svelte-48g63o"),a(V,"class","svelte-48g63o"),a(E,"class","notification is-info is-light svelte-48g63o"),a(y,"class","field"),_t.p(b,L)},m(j,ne){S(j,e,ne),i(e,t),i(e,o),i(e,n),re(u,n,null),S(j,c,ne),S(j,r,ne),i(r,p),i(r,d),i(r,_),i(_,m),Ce(m,l[9]),S(j,k,ne),S(j,v,ne),i(v,w),i(v,h),i(v,T),i(T,$),i($,b),b.checked=b.__value===l[7],i($,U),i(T,J),i(T,M),i(M,L),L.checked=L.__value===l[7],i(M,O),S(j,G,ne),st[F].m(j,ne),S(j,A,ne),S(j,R,ne),i(R,Z),re(N,Z,null),i(R,z),i(R,X),re(W,X,null),S(j,Y,ne),S(j,y,ne),i(y,E),i(E,I),i(E,D),i(E,V),i(V,x),i(x,le),i(x,we),i(x,Ue),i(V,_e),i(V,ce),i(ce,pe),i(ce,Le),i(ce,oe),i(ce,me),i(V,ae),i(V,ge),i(ge,lt),i(ge,Te),i(ge,te),i(V,ke),i(V,Ie),i(Ie,ot),i(Ie,pt),i(Ie,nt),He=!0,wt||(Dt=[Q(m,"input",l[20]),Q(b,"change",l[21]),Q(L,"change",l[23])],wt=!0)},p(j,ne){var Ee,ze;const de={};ne[0]&4&&(de.disabled=j[2]),!s&&ne[0]&256&&(s=!0,de.value=j[8],Ve(()=>s=!1)),u.$set(de),(!He||ne[0]&4)&&(m.disabled=j[2]),ne[0]&512&&Ce(m,j[9]),(!He||ne[0]&4)&&(b.disabled=j[2]),ne[0]&128&&(b.checked=b.__value===j[7]),(!He||ne[0]&4)&&(L.disabled=j[2]),ne[0]&128&&(L.checked=L.__value===j[7]);let ue=F;F=qt(j),F===ue?st[F].p(j,ne):(Me(),q(st[ue],1,1,()=>{st[ue]=null}),De(),B=st[F],B?B.p(j,ne):(B=st[F]=Et[F](j),B.c()),H(B,1),B.m(A.parentNode,A));const je={};ne[0]&4&&(je.loading=j[2]),ne[0]&2308&&(je.disabled=j[2]||!j[8].trim()||!j[11]),ne[1]&2048&&(je.$$scope={dirty:ne,ctx:j}),N.$set(je);const Ke={};ne[0]&4&&(Ke.disabled=j[2]),ne[1]&2048&&(Ke.$$scope={dirty:ne,ctx:j}),W.$set(Ke),(!He||ne[0]&256)&&ve!==(ve=(j[8]||"Untitled")+"")&&be(Ue,ve),(!He||ne[0]&2)&&$e!==($e=(((ze=(Ee=j[1])==null?void 0:Ee.body)==null?void 0:ze.length)||0)+"")&&be(oe,$e)},i(j){He||(H(u.$$.fragment,j),H(B),H(N.$$.fragment,j),H(W.$$.fragment,j),He=!0)},o(j){q(u.$$.fragment,j),q(B),q(N.$$.fragment,j),q(W.$$.fragment,j),He=!1},d(j){j&&C(e),ie(u),j&&C(c),j&&C(r),j&&C(k),j&&C(v),j&&C(G),st[F].d(j),j&&C(A),j&&C(R),ie(N),ie(W),j&&C(Y),j&&C(y),_t.r(),wt=!1,Ge(Dt)}}}function kr(l){let e,t,o,n,u,s,c;function r(d){l[25](d)}let p={placeholder:"e.g., my-collection or http://server/custom-parent",disabled:l[2]};return l[6]!==void 0&&(p.value=l[6]),o=new Bt({props:p}),Fe.push(()=>Je(o,"value",r)),{c(){e=f("div"),t=f("div"),se(o.$$.fragment),u=g(),s=f("p"),s.textContent=`Enter a collection name (e.g., "my-articles") or full URL. 
              If the collection doesn't exist, it will be created.`,a(t,"class","control"),a(s,"class","help svelte-48g63o"),a(e,"class","field")},m(d,_){S(d,e,_),i(e,t),re(o,t,null),i(e,u),i(e,s),c=!0},p(d,_){const m={};_[0]&4&&(m.disabled=d[2]),!n&&_[0]&64&&(n=!0,m.value=d[6],Ve(()=>n=!1)),o.$set(m)},i(d){c||(H(o.$$.fragment,d),c=!0)},o(d){q(o.$$.fragment,d),c=!1},d(d){d&&C(e),ie(o)}}}function wr(l){let e,t,o,n,u,s,c=l[13],r=[];for(let p=0;p<c.length;p+=1)r[p]=Ro(ho(l,c,p));return{c(){e=f("div"),t=f("div"),o=f("div"),n=f("select");for(let p=0;p<r.length;p+=1)r[p].c();n.disabled=l[2],l[5]===void 0&&ut(()=>l[24].call(n)),a(o,"class","select is-fullwidth"),a(t,"class","control"),a(e,"class","field")},m(p,d){S(p,e,d),i(e,t),i(t,o),i(o,n);for(let _=0;_<r.length;_+=1)r[_]&&r[_].m(n,null);Pe(n,l[5],!0),u||(s=Q(n,"change",l[24]),u=!0)},p(p,d){if(d[0]&8192){c=p[13];let _;for(_=0;_<c.length;_+=1){const m=ho(p,c,_);r[_]?r[_].p(m,d):(r[_]=Ro(m),r[_].c(),r[_].m(n,null))}for(;_<r.length;_+=1)r[_].d(1);r.length=c.length}d[0]&4&&(n.disabled=p[2]),d[0]&8224&&Pe(n,p[5])},i:Se,o:Se,d(p){p&&C(e),We(r,p),u=!1,s()}}}function Ro(l){let e,t=l[33].label+"",o;return{c(){e=f("option"),o=K(t),e.__value=l[33].value,e.value=e.__value},m(n,u){S(n,e,u),i(e,o)},p:Se,d(n){n&&C(e)}}}function $r(l){let e,t,o;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-cloud-upload-alt"></i>',t=g(),o=f("span"),o.textContent="Save to Atomic Server",a(e,"class","icon")},m(n,u){S(n,e,u),S(n,t,u),S(n,o,u)},p:Se,d(n){n&&C(e),n&&C(t),n&&C(o)}}}function yr(l){let e;return{c(){e=K("Cancel")},m(t,o){S(t,e,o)},d(t){t&&C(e)}}}function Cr(l){let e,t,o,n,u,s,c,r,p,d,_,m,k,v=l[4]&&vo(l),w=l[3]&&ko(l),h=!l[4]&&wo(l);return{c(){e=f("div"),t=f("div"),o=f("div"),o.innerHTML=`<div class="level-item"><h3 class="title is-4"><span class="icon"><i class="fas fa-save"></i></span>
            Save to Atomic Server</h3></div>`,n=g(),u=f("div"),s=f("div"),c=f("button"),r=g(),v&&v.c(),p=g(),w&&w.c(),d=g(),h&&h.c(),a(o,"class","level-left"),a(c,"class","delete is-large"),c.disabled=l[2],a(c,"aria-label","close"),a(s,"class","level-item"),a(u,"class","level-right"),a(t,"class","level svelte-48g63o"),a(e,"class","box")},m(T,$){S(T,e,$),i(e,t),i(t,o),i(t,n),i(t,u),i(u,s),i(s,c),i(e,r),v&&v.m(e,null),i(e,p),w&&w.m(e,null),i(e,d),h&&h.m(e,null),_=!0,m||(k=Q(c,"click",l[17]),m=!0)},p(T,$){(!_||$[0]&4)&&(c.disabled=T[2]),T[4]?v?$[0]&16&&H(v,1):(v=vo(T),v.c(),H(v,1),v.m(e,p)):v&&(Me(),q(v,1,1,()=>{v=null}),De()),T[3]?w?(w.p(T,$),$[0]&8&&H(w,1)):(w=ko(T),w.c(),H(w,1),w.m(e,d)):w&&(Me(),q(w,1,1,()=>{w=null}),De()),T[4]?h&&(Me(),q(h,1,1,()=>{h=null}),De()):h?(h.p(T,$),$[0]&16&&H(h,1)):(h=wo(T),h.c(),H(h,1),h.m(e,null))},i(T){_||(H(v),H(w),H(h),_=!0)},o(T){q(v),q(w),q(h),_=!1},d(T){T&&C(e),v&&v.d(),w&&w.d(),h&&h.d(),m=!1,k()}}}function Sr(l){let e,t,o;function n(s){l[26](s)}let u={$$slots:{default:[Cr]},$$scope:{ctx:l}};return l[0]!==void 0&&(u.active=l[0]),e=new El({props:u}),Fe.push(()=>Je(e,"active",n)),e.$on("close",l[17]),{c(){se(e.$$.fragment)},m(s,c){re(e,s,c),o=!0},p(s,c){const r={};c[0]&8190|c[1]&2048&&(r.$$scope={dirty:c,ctx:s}),!t&&c[0]&1&&(t=!0,r.active=s[0],Ve(()=>t=!1)),e.$set(r)},i(s){o||(H(e.$$.fragment,s),o=!0)},o(s){q(e.$$.fragment,s),o=!1},d(s){ie(e,s)}}}function Tr(l,e,t){let o,n,u;Re(l,Be,y=>t(27,o=y)),Re(l,gt,y=>t(28,n=y)),Re(l,St,y=>t(12,u=y));let{active:s=!1}=e,{document:c}=e,r=!1,p=null,d=!1,_="",m="",k=!1,v="",w="",h=[],T="";const $=[{label:"Root (Server Root)",value:""},{label:"Articles Collection",value:"articles"},{label:"Documents Collection",value:"documents"},{label:"Knowledge Base",value:"knowledge-base"},{label:"Research",value:"research"},{label:"Projects",value:"projects"}];function b(){t(2,r=!1),t(3,p=null),t(4,d=!1),t(5,_=""),t(6,m=""),t(7,k=!1),t(8,v=(c==null?void 0:c.title)||""),t(9,w=(c==null?void 0:c.description)||`Article saved from Terraphim search: ${c==null?void 0:c.title}`),t(10,h=[]),t(11,T="")}function U(){var D;const y=u,E=n;if(!(E!=null&&E.roles)||!y){console.warn("No role configuration found");return}let I=null;try{for(const[V,x]of Object.entries(E.roles)){const le=x,we=typeof le.name=="object"?le.name.original:String(le.name);if(V===y||we===y){I=le;break}}}catch(V){console.warn("Error checking role configuration:",V);return}if(!I){console.warn(`Role "${y}" not found in configuration`);return}t(10,h=((D=I.haystacks)==null?void 0:D.filter(V=>V.service==="Atomic"&&V.location&&!V.read_only))||[]),h.length>0&&t(11,T=h[0].location),console.log("Loaded atomic servers:",h)}function J(){const y=h.find(E=>E.location===T);return y==null?void 0:y.atomic_server_secret}function M(){const y=T.replace(/\/$/,"");if(k&&m.trim()){const E=m.trim();return E.startsWith("http://")||E.startsWith("https://")?E:`${y}/${E.replace(/^\//,"")}`}else return _?`${y}/${_}`:y}function L(){return v.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,50)}function O(){const y=T.replace(/\/$/,""),E=L(),I=Date.now();return`${y}/${E}-${I}`}async function G(){if(!T||!v.trim()){t(3,p="Please select an atomic server and provide a title");return}t(2,r=!0),t(3,p=null);try{const y=O(),E=M(),I=J();console.log("🔄 Saving article to atomic server:",{subject:y,parent:E,server:T,hasSecret:!!I});const D={subject:y,title:v.trim(),description:w.trim(),body:c.body,parent:E,shortname:L(),original_id:c.id,original_url:c.url,original_rank:c.rank,tags:c.tags||[]};if(o)await qe("save_article_to_atomic",{article:D,serverUrl:T,atomicSecret:I});else{const V=await fetch(`${at.ServerURL}/atomic/save`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({article:D,server_url:T,atomic_secret:I})});if(!V.ok){const x=await V.json().catch(()=>({error:V.statusText}));throw new Error(x.error||`HTTP ${V.status}: ${V.statusText}`)}}t(4,d=!0),console.log("✅ Article saved successfully to atomic server"),setTimeout(()=>{t(0,s=!1)},2e3)}catch(y){console.error("❌ Failed to save article to atomic server:",y),t(3,p=y.message||"Failed to save article to atomic server")}finally{t(2,r=!1)}}function F(){r||t(0,s=!1)}const B=[[]];function A(){T=yt(this),t(11,T),t(10,h)}function R(y){v=y,t(8,v)}function Z(){w=this.value,t(9,w)}function N(){k=this.__value,t(7,k)}function z(){k=this.__value,t(7,k)}function X(){_=yt(this),t(5,_),t(13,$)}function W(y){m=y,t(6,m)}function Y(y){s=y,t(0,s)}return l.$$set=y=>{"active"in y&&t(0,s=y.active),"document"in y&&t(1,c=y.document)},l.$$.update=()=>{l.$$.dirty[0]&3&&s&&c&&(b(),U())},[s,c,r,p,d,_,m,k,v,w,h,T,u,$,M,O,G,F,A,R,Z,N,B,z,X,W,Y]}class Rr extends ct{constructor(e){super(),ft(this,e,Tr,Sr,et,{active:0,document:1},null,[-1,-1])}}async function Dl(l){return qe("tauri",l)}async function Ar(l,e){return Dl({__tauriModule:"Event",message:{cmd:"unlisten",event:l,eventId:e}})}async function Lr(l,e,t){return Dl({__tauriModule:"Event",message:{cmd:"listen",event:l,windowLabel:e,handler:Ol(t)}}).then(o=>async()=>Ar(l,o))}var Ao;(function(l){l.WINDOW_RESIZED="tauri://resize",l.WINDOW_MOVED="tauri://move",l.WINDOW_CLOSE_REQUESTED="tauri://close-requested",l.WINDOW_CREATED="tauri://window-created",l.WINDOW_DESTROYED="tauri://destroyed",l.WINDOW_FOCUS="tauri://focus",l.WINDOW_BLUR="tauri://blur",l.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",l.WINDOW_THEME_CHANGED="tauri://theme-changed",l.WINDOW_FILE_DROP="tauri://file-drop",l.WINDOW_FILE_DROP_HOVER="tauri://file-drop-hover",l.WINDOW_FILE_DROP_CANCELLED="tauri://file-drop-cancelled",l.MENU="tauri://menu",l.CHECK_UPDATE="tauri://update",l.UPDATE_AVAILABLE="tauri://update-available",l.INSTALL_UPDATE="tauri://update-install",l.STATUS_UPDATE="tauri://update-status",l.DOWNLOAD_PROGRESS="tauri://update-download-progress"})(Ao||(Ao={}));async function Nr(l,e){return Lr(l,null,e)}function Lo(l,e,t){const o=l.slice();return o[9]=e[t],o}function No(l){let e,t=l[9].name+"",o,n;return{c(){e=f("option"),o=K(t),e.__value=n=l[9].name,e.value=e.__value},m(u,s){S(u,e,s),i(e,o)},p(u,s){s&1&&t!==(t=u[9].name+"")&&be(o,t),s&1&&n!==(n=u[9].name)&&(e.__value=n,e.value=e.__value)},d(u){u&&C(e)}}}function Or(l){let e,t,o,n,u,s,c=l[0],r=[];for(let p=0;p<c.length;p+=1)r[p]=No(Lo(l,c,p));return{c(){e=f("div"),t=f("div"),o=f("div"),n=f("select");for(let p=0;p<r.length;p+=1)r[p].c();a(o,"class","select"),a(t,"class","control"),a(e,"class","field is-grouped is-grouped-right")},m(p,d){S(p,e,d),i(e,t),i(t,o),i(o,n);for(let _=0;_<r.length;_+=1)r[_]&&r[_].m(n,null);Pe(n,l[1]),u||(s=Q(n,"change",l[2]),u=!0)},p(p,[d]){if(d&1){c=p[0];let _;for(_=0;_<c.length;_+=1){const m=Lo(p,c,_);r[_]?r[_].p(m,d):(r[_]=No(m),r[_].c(),r[_].m(n,null))}for(;_<r.length;_+=1)r[_].d(1);r.length=c.length}d&3&&Pe(n,p[1])},i:Se,o:Se,d(p){p&&C(e),We(r,p),u=!1,s()}}}function Ur(l,e,t){let o,n,u,s;Re(l,gt,m=>t(5,o=m)),Re(l,Be,m=>t(6,n=m)),Re(l,oo,m=>t(0,u=m)),Re(l,St,m=>t(1,s=m));let c="";async function r(){try{Be.set(window.__TAURI__!==void 0),n?(console.log("Loading config from Tauri"),qe("get_config").then(m=>{console.log("get_config response",m),m&&m.status==="success"&&p(m.config)}).catch(m=>console.error("Error fetching config in Tauri:",m))):(console.log("Loading config from server"),c=`${at.ServerURL}/config/`,fetch(c).then(m=>m.json()).then(m=>{console.log("Config received",m),m&&m.status==="success"&&p(m.config)}).catch(m=>console.error("Error fetching config:",m)))}catch(m){console.error("Unhandled error in loadConfig:",m)}}function p(m){var h;console.log("Updating stores from config:",m);const k={default_role:m.selected_role,...m};gt.set(k);const v=Object.entries(m.roles).map(([T,$])=>({name:T,...$}));oo.set(v),St.set(m.selected_role);const w=m.roles[m.selected_role];if(console.log("Selected role settings:",w),w){const T=w.theme||"spacelab";console.log("Setting theme to:",T),ul.set(T),(h=w.kg)!=null&&h.publish?n?qe("publish_thesaurus",{roleName:m.selected_role}).then($=>{console.log("publish_thesaurus response",$),al.set($),ht.set(!0)}):(console.log("Fetching thesaurus from HTTP endpoint for role",m.selected_role),fetch(`${at.ServerURL}/thesaurus/${encodeURIComponent(m.selected_role)}`).then($=>$.json()).then($=>{console.log("thesaurus HTTP response",$),$&&$.status==="success"&&$.thesaurus?(al.set($.thesaurus),ht.set(!0)):(console.error("Failed to fetch thesaurus:",$),ht.set(!1))}).catch($=>{console.error("Error fetching thesaurus:",$),ht.set(!1)})):ht.set(!1)}else console.warn("No role settings found for:",m.selected_role),ul.set("spacelab")}typeof window<"u"&&window.__TAURI__&&Nr("role_changed",m=>{console.log("Role changed event received from backend:",m.payload),p(m.payload)});async function d(){await r()}d(),console.log("Using Terraphim Server URL:",at.ServerURL);function _(m){var T,$;const v=m.currentTarget.value;console.log("Role change requested:",v),St.set(v);const w=u.find(b=>b.name===v);if(!w){console.error(`No role settings found for role: ${v}.`);return}const h=w.theme||"spacelab";ul.set(h),console.log(`Theme changed to ${h}`),gt.update(b=>(b.selected_role=v,b)),n?(qe("select_role",{roleName:v}).catch(b=>console.error("Error selecting role:",b)),(T=w.kg)!=null&&T.publish?(console.log("Publishing thesaurus for role",v),qe("publish_thesaurus",{roleName:v}).then(b=>{al.set(b),ht.set(!0)})):ht.set(!1)):(fetch(`${at.ServerURL}/config/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).catch(b=>console.error("Error updating config on server:",b)),($=w.kg)!=null&&$.publish?(console.log("Fetching thesaurus from HTTP endpoint for role",v),fetch(`${at.ServerURL}/thesaurus/${encodeURIComponent(v)}`).then(b=>b.json()).then(b=>{console.log("thesaurus HTTP response",b),b&&b.status==="success"&&b.thesaurus?(al.set(b.thesaurus),ht.set(!0)):(console.error("Failed to fetch thesaurus:",b),ht.set(!1))}).catch(b=>{console.error("Error fetching thesaurus:",b),ht.set(!1)})):ht.set(!1))}return[u,s,_,r]}class yl extends ct{constructor(e){super(),ft(this,e,Ur,Or,et,{loadConfig:3})}get loadConfig(){return this.$$.ctx[3]}}function Oo(l,e,t){const o=l.slice();return o[33]=e[t],o}function Uo(l,e,t){const o=l.slice();return o[36]=e[t],o}function Eo(l){let e,t;return e=new jn({props:{$$slots:{default:[Pr]},$$scope:{ctx:l}}}),{c(){se(e.$$.fragment)},m(o,n){re(e,o,n),t=!0},p(o,n){const u={};n[0]&129|n[1]&256&&(u.$$scope={dirty:n,ctx:o}),e.$set(u)},i(o){t||(H(e.$$.fragment,o),t=!0)},o(o){q(e.$$.fragment,o),t=!1},d(o){ie(e,o)}}}function Er(l){let e=l[36]+"",t;return{c(){t=K(e)},m(o,n){S(o,t,n)},p(o,n){n[0]&1&&e!==(e=o[36]+"")&&be(t,e)},d(o){o&&C(t)}}}function Po(l){let e,t,o,n,u,s;t=new zn({props:{rounded:!0,$$slots:{default:[Er]},$$scope:{ctx:l}}});function c(){return l[18](l[36])}return{c(){e=f("button"),se(t.$$.fragment),o=g(),a(e,"class","tag-button svelte-2smypa"),e.disabled=l[7],a(e,"title","Click to view knowledge graph document")},m(r,p){S(r,e,p),re(t,e,null),i(e,o),n=!0,u||(s=Q(e,"click",c),u=!0)},p(r,p){l=r;const d={};p[0]&1|p[1]&256&&(d.$$scope={dirty:p,ctx:l}),t.$set(d),(!n||p[0]&128)&&(e.disabled=l[7])},i(r){n||(H(t.$$.fragment,r),n=!0)},o(r){q(t.$$.fragment,r),n=!1},d(r){r&&C(e),ie(t),u=!1,s()}}}function Pr(l){let e,t,o=l[0].tags,n=[];for(let s=0;s<o.length;s+=1)n[s]=Po(Uo(l,o,s));const u=s=>q(n[s],1,1,()=>{n[s]=null});return{c(){for(let s=0;s<n.length;s+=1)n[s].c();e=tt()},m(s,c){for(let r=0;r<n.length;r+=1)n[r]&&n[r].m(s,c);S(s,e,c),t=!0},p(s,c){if(c[0]&65665){o=s[0].tags;let r;for(r=0;r<o.length;r+=1){const p=Uo(s,o,r);n[r]?(n[r].p(p,c),H(n[r],1)):(n[r]=Po(p),n[r].c(),H(n[r],1),n[r].m(e.parentNode,e))}for(Me(),r=o.length;r<n.length;r+=1)u(r);De()}},i(s){if(!t){for(let c=0;c<o.length;c+=1)H(n[c]);t=!0}},o(s){n=n.filter(Boolean);for(let c=0;c<n.length;c+=1)q(n[c]);t=!1},d(s){We(n,s),s&&C(e)}}}function Mr(l){let e,t=(l[0].rank||0)+"",o;return{c(){e=K("Rank "),o=K(t)},m(n,u){S(n,e,u),S(n,o,u)},p(n,u){u[0]&1&&t!==(t=(n[0].rank||0)+"")&&be(o,t)},d(n){n&&C(e),n&&C(o)}}}function Dr(l){let e,t;return e=new zn({props:{rounded:!0,$$slots:{default:[Mr]},$$scope:{ctx:l}}}),{c(){se(e.$$.fragment)},m(o,n){re(e,o,n),t=!0},p(o,n){const u={};n[0]&1|n[1]&256&&(u.$$scope={dirty:n,ctx:o}),e.$set(u)},i(o){t||(H(e.$$.fragment,o),t=!0)},o(o){q(e.$$.fragment,o),t=!1},d(o){ie(e,o)}}}function Ir(l){let e;return{c(){e=f("small"),e.textContent="No description available",a(e,"class","no-description svelte-2smypa")},m(t,o){S(t,e,o)},p:Se,i:Se,o:Se,d(t){t&&C(e)}}}function jr(l){let e,t;return e=new Tl({props:{source:l[0].description}}),{c(){se(e.$$.fragment)},m(o,n){re(e,o,n),t=!0},p(o,n){const u={};n[0]&1&&(u.source=o[0].description),e.$set(u)},i(o){t||(H(e.$$.fragment,o),t=!0)},o(o){q(e.$$.fragment,o),t=!1},d(o){ie(e,o)}}}function Mo(l){let e,t,o,n,u,s;return{c(){e=f("button"),t=f("span"),t.innerHTML='<i class="fas fa-magic" aria-hidden="true"></i>',o=g(),n=f("span"),n.textContent="AI Summary",a(t,"class","icon is-small"),a(e,"class","button is-small is-info is-outlined ai-summary-button svelte-2smypa"),e.disabled=l[9],a(e,"title","Generate AI-powered summary using OpenRouter")},m(c,r){S(c,e,r),i(e,t),i(e,o),i(e,n),u||(s=Q(e,"click",l[17]),u=!0)},p(c,r){r[0]&512&&(e.disabled=c[9])},d(c){c&&C(e),u=!1,s()}}}function Do(l){let e;return{c(){e=f("div"),e.innerHTML=`<span class="icon"><i class="fas fa-spinner fa-spin" aria-hidden="true"></i></span> 
                <small>Generating AI summary...</small>`,a(e,"class","ai-summary-loading svelte-2smypa")},m(t,o){S(t,e,o)},d(t){t&&C(e)}}}function Io(l){let e,t,o,n,u,s,c,r,p,d;return{c(){e=f("div"),t=f("span"),t.innerHTML='<i class="fas fa-exclamation-triangle" aria-hidden="true"></i>',o=g(),n=f("small"),u=K("Summary error: "),s=K(l[10]),c=g(),r=f("button"),r.textContent="Retry",a(t,"class","icon has-text-danger"),a(n,"class","has-text-danger"),a(r,"class","button is-small is-text svelte-2smypa"),a(r,"title","Retry generating summary"),a(e,"class","ai-summary-error svelte-2smypa")},m(_,m){S(_,e,m),i(e,t),i(e,o),i(e,n),i(n,u),i(n,s),i(e,c),i(e,r),p||(d=Q(r,"click",l[19]),p=!0)},p(_,m){m[0]&1024&&be(s,_[10])},d(_){_&&C(e),p=!1,d()}}}function jo(l){let e,t,o,n,u,s,c,r,p,d,_,m,k,v,w,h,T,$,b,U;function J(O,G){return O[12]?Hr:zr}let M=J(l),L=M(l);return d=new Tl({props:{source:l[8]}}),{c(){e=f("div"),t=f("div"),o=f("small"),n=f("span"),n.innerHTML='<i class="fas fa-robot" aria-hidden="true"></i>',u=K(`
                    AI Summary
                    `),L.c(),s=g(),c=f("button"),c.innerHTML='<span class="icon is-small"><i class="fas fa-times" aria-hidden="true"></i></span>',r=g(),p=f("div"),se(d.$$.fragment),_=g(),m=f("div"),k=f("button"),v=f("span"),v.innerHTML='<i class="fas fa-redo" aria-hidden="true"></i>',w=g(),h=f("span"),h.textContent="Regenerate",a(n,"class","icon is-small"),a(o,"class","ai-summary-label svelte-2smypa"),a(c,"class","button is-small is-text svelte-2smypa"),a(c,"title","Hide AI summary"),a(t,"class","ai-summary-header svelte-2smypa"),a(p,"class","ai-summary-content svelte-2smypa"),a(v,"class","icon is-small"),a(k,"class","button is-small is-text svelte-2smypa"),k.disabled=l[9],a(k,"title","Regenerate summary"),a(m,"class","ai-summary-actions svelte-2smypa"),a(e,"class","ai-summary svelte-2smypa")},m(O,G){S(O,e,G),i(e,t),i(t,o),i(o,n),i(o,u),L.m(o,null),i(t,s),i(t,c),i(e,r),i(e,p),re(d,p,null),i(e,_),i(e,m),i(m,k),i(k,v),i(k,w),i(k,h),$=!0,b||(U=[Q(c,"click",l[20]),Q(k,"click",l[21])],b=!0)},p(O,G){M!==(M=J(O))&&(L.d(1),L=M(O),L&&(L.c(),L.m(o,null)));const F={};G[0]&256&&(F.source=O[8]),d.$set(F),(!$||G[0]&512)&&(k.disabled=O[9])},i(O){$||(H(d.$$.fragment,O),ut(()=>{$&&(T||(T=ll(e,ol,{},!0)),T.run(1))}),$=!0)},o(O){q(d.$$.fragment,O),T||(T=ll(e,ol,{},!1)),T.run(0),$=!1},d(O){O&&C(e),L.d(),ie(d),O&&T&&T.end(),b=!1,Ge(U)}}}function zr(l){let e;return{c(){e=f("span"),e.textContent="fresh",a(e,"class","tag is-small is-success")},m(t,o){S(t,e,o)},d(t){t&&C(e)}}}function Hr(l){let e;return{c(){e=f("span"),e.textContent="cached",a(e,"class","tag is-small is-light")},m(t,o){S(t,e,o)},d(t){t&&C(e)}}}function zo(l){let e;function t(u,s){return u[33].disabled?Gr:u[33].isLink?Wr:Fr}let o=t(l),n=o(l);return{c(){n.c(),e=tt()},m(u,s){n.m(u,s),S(u,e,s)},p(u,s){o===(o=t(u))&&n?n.p(u,s):(n.d(1),n=o(u),n&&(n.c(),n.m(e.parentNode,e)))},d(u){n.d(u),u&&C(e)}}}function Fr(l){let e,t,o,n,u,s,c,r,p;return{c(){e=f("button"),t=f("span"),o=f("i"),u=g(),a(o,"class",n=Tt(l[33].icon)+" svelte-2smypa"),a(t,"class","icon is-medium"),Rt(t,"has-text-primary",l[33].className),a(e,"type","button"),a(e,"class","level-item button is-ghost svelte-2smypa"),a(e,"aria-label",s=l[33].title),a(e,"title",c=l[33].title)},m(d,_){S(d,e,_),i(e,t),i(t,o),i(e,u),r||(p=Q(e,"click",function(){Pl(l[33].action)&&l[33].action.apply(this,arguments)}),r=!0)},p(d,_){l=d,_[0]&16384&&n!==(n=Tt(l[33].icon)+" svelte-2smypa")&&a(o,"class",n),_[0]&16384&&Rt(t,"has-text-primary",l[33].className),_[0]&16384&&s!==(s=l[33].title)&&a(e,"aria-label",s),_[0]&16384&&c!==(c=l[33].title)&&a(e,"title",c)},d(d){d&&C(e),r=!1,p()}}}function Wr(l){let e,t,o,n,u,s,c,r;return{c(){e=f("a"),t=f("span"),o=f("i"),u=g(),a(o,"class",n=Tt(l[33].icon)+" svelte-2smypa"),a(t,"class","icon is-medium"),Rt(t,"has-text-primary",l[33].className),a(e,"href",s=l[33].href),a(e,"target","_blank"),a(e,"class","level-item"),a(e,"aria-label",c=l[33].title),a(e,"title",r=l[33].title)},m(p,d){S(p,e,d),i(e,t),i(t,o),i(e,u)},p(p,d){d[0]&16384&&n!==(n=Tt(p[33].icon)+" svelte-2smypa")&&a(o,"class",n),d[0]&16384&&Rt(t,"has-text-primary",p[33].className),d[0]&16384&&s!==(s=p[33].href)&&a(e,"href",s),d[0]&16384&&c!==(c=p[33].title)&&a(e,"aria-label",c),d[0]&16384&&r!==(r=p[33].title)&&a(e,"title",r)},d(p){p&&C(e)}}}function Gr(l){let e,t,o,n,u,s,c;return{c(){e=f("button"),t=f("span"),o=f("i"),u=g(),a(o,"class",n=Tt(l[33].icon)+" svelte-2smypa"),a(t,"class","icon is-medium"),Rt(t,"has-text-primary",l[33].className),a(e,"type","button"),a(e,"class","level-item button is-ghost svelte-2smypa"),a(e,"aria-label",s=l[33].title),a(e,"title",c=l[33].title),e.disabled=!0},m(r,p){S(r,e,p),i(e,t),i(t,o),i(e,u)},p(r,p){p[0]&16384&&n!==(n=Tt(r[33].icon)+" svelte-2smypa")&&a(o,"class",n),p[0]&16384&&Rt(t,"has-text-primary",r[33].className),p[0]&16384&&s!==(s=r[33].title)&&a(e,"aria-label",s),p[0]&16384&&c!==(c=r[33].title)&&a(e,"title",c)},d(r){r&&C(e)}}}function Ho(l){let e,t=l[33].visible&&zo(l);return{c(){t&&t.c(),e=tt()},m(o,n){t&&t.m(o,n),S(o,e,n)},p(o,n){o[33].visible?t?t.p(o,n):(t=zo(o),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(o){t&&t.d(o),o&&C(e)}}}function Fo(l){let e,t,o;function n(s){l[23](s)}let u={item:l[4],kgTerm:l[5],kgRank:l[6]};return l[2]!==void 0&&(u.active=l[2]),e=new Ml({props:u}),Fe.push(()=>Je(e,"active",n)),{c(){se(e.$$.fragment)},m(s,c){re(e,s,c),o=!0},p(s,c){const r={};c[0]&16&&(r.item=s[4]),c[0]&32&&(r.kgTerm=s[5]),c[0]&64&&(r.kgRank=s[6]),!t&&c[0]&4&&(t=!0,r.active=s[2],Ve(()=>t=!1)),e.$set(r)},i(s){o||(H(e.$$.fragment,s),o=!0)},o(s){q(e.$$.fragment,s),o=!1},d(s){ie(e,s)}}}function Wo(l){let e,t,o;function n(s){l[24](s)}let u={document:l[0]};return l[3]!==void 0&&(u.active=l[3]),e=new Rr({props:u}),Fe.push(()=>Je(e,"active",n)),{c(){se(e.$$.fragment)},m(s,c){re(e,s,c),o=!0},p(s,c){const r={};c[0]&1&&(r.document=s[0]),!t&&c[0]&8&&(t=!0,r.active=s[3],Ve(()=>t=!1)),e.$set(r)},i(s){o||(H(e.$$.fragment,s),o=!0)},o(s){q(e.$$.fragment,s),o=!1},d(s){ie(e,s)}}}function Kr(l){let e,t,o,n,u,s,c,r,p,d,_,m,k=l[0].title+"",v,w,h,T,$,b,U,J,M,L,O,G,F,B,A,R,Z,N,z,X,W,Y,y,E,I,D,V,x,le,we,ve=l[0].tags&&Eo(l);r=new jn({props:{$$slots:{default:[Dr]},$$scope:{ctx:l}}});const Ue=[jr,Ir],_e=[];function ce(te,ke){return te[0].description?0:1}U=ce(l),J=_e[U]=Ue[U](l);let pe=!l[11]&&!l[9]&&!l[10]&&Mo(l),Le=l[9]&&Do(),$e=l[10]&&Io(l),oe=l[11]&&l[8]&&jo(l),me=l[14],ae=[];for(let te=0;te<me.length;te+=1)ae[te]=Ho(Oo(l,me,te));function ge(te){l[22](te)}let lt={item:l[0]};l[1]!==void 0&&(lt.active=l[1]),y=new Ml({props:lt}),Fe.push(()=>Je(y,"active",ge));let Te=l[4]&&Fo(l),Ae=l[13]&&Wo(l);return{c(){e=f("div"),t=f("article"),o=f("div"),n=f("div"),u=f("div"),ve&&ve.c(),s=g(),c=f("div"),se(r.$$.fragment),p=g(),d=f("div"),_=f("button"),m=f("h2"),v=K(k),w=g(),h=f("div"),T=f("small"),T.textContent="Description:",$=g(),b=f("div"),J.c(),M=g(),L=f("div"),pe&&pe.c(),O=g(),Le&&Le.c(),G=g(),$e&&$e.c(),F=g(),oe&&oe.c(),B=g(),A=f("br"),Z=g(),N=f("div"),z=f("nav"),X=f("div");for(let te=0;te<ae.length;te+=1)ae[te].c();Y=g(),se(y.$$.fragment),I=g(),Te&&Te.c(),D=g(),Ae&&Ae.c(),V=tt(),a(u,"class","level-right"),a(c,"class","level-right"),a(m,"class","title svelte-2smypa"),a(_,"class","svelte-2smypa"),a(T,"class","description-label svelte-2smypa"),a(b,"class","description-content svelte-2smypa"),a(h,"class","description svelte-2smypa"),a(L,"class","ai-summary-section svelte-2smypa"),a(n,"class","content"),a(X,"class","level-right"),a(z,"class","level is-mobile"),a(N,"class","level-right"),a(o,"class","media-content"),a(t,"class","media"),a(e,"class","box")},m(te,ke){S(te,e,ke),i(e,t),i(t,o),i(o,n),i(n,u),ve&&ve.m(u,null),i(n,s),i(n,c),re(r,c,null),i(n,p),i(n,d),i(d,_),i(_,m),i(m,v),i(d,w),i(d,h),i(h,T),i(h,$),i(h,b),_e[U].m(b,null),i(d,M),i(d,L),pe&&pe.m(L,null),i(L,O),Le&&Le.m(L,null),i(L,G),$e&&$e.m(L,null),i(L,F),oe&&oe.m(L,null),i(d,B),i(d,A),i(o,Z),i(o,N),i(N,z),i(z,X);for(let Ie=0;Ie<ae.length;Ie+=1)ae[Ie]&&ae[Ie].m(X,null);S(te,Y,ke),re(y,te,ke),S(te,I,ke),Te&&Te.m(te,ke),S(te,D,ke),Ae&&Ae.m(te,ke),S(te,V,ke),x=!0,le||(we=Q(_,"click",l[15]),le=!0)},p(te,ke){te[0].tags?ve?(ve.p(te,ke),ke[0]&1&&H(ve,1)):(ve=Eo(te),ve.c(),H(ve,1),ve.m(u,null)):ve&&(Me(),q(ve,1,1,()=>{ve=null}),De());const Ie={};ke[0]&1|ke[1]&256&&(Ie.$$scope={dirty:ke,ctx:te}),r.$set(Ie),(!x||ke[0]&1)&&k!==(k=te[0].title+"")&&be(v,k);let ot=U;if(U=ce(te),U===ot?_e[U].p(te,ke):(Me(),q(_e[ot],1,1,()=>{_e[ot]=null}),De(),J=_e[U],J?J.p(te,ke):(J=_e[U]=Ue[U](te),J.c()),H(J,1),J.m(b,null)),!te[11]&&!te[9]&&!te[10]?pe?pe.p(te,ke):(pe=Mo(te),pe.c(),pe.m(L,O)):pe&&(pe.d(1),pe=null),te[9]?Le||(Le=Do(),Le.c(),Le.m(L,G)):Le&&(Le.d(1),Le=null),te[10]?$e?$e.p(te,ke):($e=Io(te),$e.c(),$e.m(L,F)):$e&&($e.d(1),$e=null),te[11]&&te[8]?oe?(oe.p(te,ke),ke[0]&2304&&H(oe,1)):(oe=jo(te),oe.c(),H(oe,1),oe.m(L,null)):oe&&(Me(),q(oe,1,1,()=>{oe=null}),De()),ke[0]&16384){me=te[14];let Ne;for(Ne=0;Ne<me.length;Ne+=1){const nt=Oo(te,me,Ne);ae[Ne]?ae[Ne].p(nt,ke):(ae[Ne]=Ho(nt),ae[Ne].c(),ae[Ne].m(X,null))}for(;Ne<ae.length;Ne+=1)ae[Ne].d(1);ae.length=me.length}const pt={};ke[0]&1&&(pt.item=te[0]),!E&&ke[0]&2&&(E=!0,pt.active=te[1],Ve(()=>E=!1)),y.$set(pt),te[4]?Te?(Te.p(te,ke),ke[0]&16&&H(Te,1)):(Te=Fo(te),Te.c(),H(Te,1),Te.m(D.parentNode,D)):Te&&(Me(),q(Te,1,1,()=>{Te=null}),De()),te[13]?Ae?(Ae.p(te,ke),ke[0]&8192&&H(Ae,1)):(Ae=Wo(te),Ae.c(),H(Ae,1),Ae.m(V.parentNode,V)):Ae&&(Me(),q(Ae,1,1,()=>{Ae=null}),De())},i(te){x||(H(ve),H(r.$$.fragment,te),H(J),H(oe),ut(()=>{x&&(R||(R=ll(d,ol,{},!0)),R.run(1))}),ut(()=>{x&&(W||(W=ll(z,ol,{},!0)),W.run(1))}),H(y.$$.fragment,te),H(Te),H(Ae),x=!0)},o(te){q(ve),q(r.$$.fragment,te),q(J),q(oe),R||(R=ll(d,ol,{},!1)),R.run(0),W||(W=ll(z,ol,{},!1)),W.run(0),q(y.$$.fragment,te),q(Te),q(Ae),x=!1},d(te){te&&C(e),ve&&ve.d(),ie(r),_e[U].d(),pe&&pe.d(),Le&&Le.d(),$e&&$e.d(),oe&&oe.d(),te&&R&&R.end(),We(ae,te),te&&W&&W.end(),te&&C(Y),ie(y,te),te&&C(I),Te&&Te.d(te),te&&C(D),Ae&&Ae.d(te),te&&C(V),le=!1,we()}}}function Br(l,e,t){let o,n,u,s,c;Re(l,St,y=>t(25,u=y)),Re(l,Be,y=>t(26,s=y)),Re(l,gt,y=>t(27,c=y));let{document:r}=e,p=!1,d=!1,_=!1,m=null,k=null,v=null,w=!1,h=null,T=!1,$=null,b=!1,U=!1;function J(){const y=[];return y.push({id:"download-markdown",label:"Download to Markdown",icon:"fas fa-download",action:()=>B(),visible:!0,title:"Download document as markdown file"}),o&&y.push({id:"save-atomic",label:"Save to Atomic Server",icon:"fas fa-cloud-upload-alt",action:()=>O(),visible:!0,title:"Save article to Atomic Server",className:"has-text-primary"}),r.url&&y.push({id:"external-url",label:"Open URL",icon:"fas fa-link",action:()=>window.open(r.url,"_blank"),visible:!0,title:"Open original URL in new tab",isLink:!0,href:r.url}),y.push({id:"open-vscode",label:"Open in VSCode",icon:"fas fa-code",action:()=>A(),visible:!0,title:"Open document in VSCode",isLink:!0,href:`vscode://${encodeURIComponent(r.title)}.md?${encodeURIComponent(r.body)}`}),y.push({id:"add-favorites",label:"Add to Favorites",icon:"fas fa-plus",action:()=>{},visible:!0,title:"Add to favorites (coming soon)",disabled:!0}),y}function M(){var V;const y=u,E=c;if(!(E!=null&&E.roles)||!y)return!1;let I=null;try{for(const[x,le]of Object.entries(E.roles)){const we=le,ve=typeof we.name=="object"?we.name.original:String(we.name);if(x===y||ve===y){I=we;break}}}catch(x){return console.warn("Error checking role configuration:",x),!1}return I?(((V=I.haystacks)==null?void 0:V.filter(x=>x.service==="Atomic"&&x.location&&!x.read_only))||[]).length>0:!1}const L=()=>{t(1,p=!0)},O=()=>{console.log("🔄 Opening atomic save modal for document:",r.title),t(3,_=!0)};async function G(y){var E,I,D,V,x;t(7,w=!0),t(5,k=y),console.log("🔍 KG Search Debug Info:"),console.log("  Tag clicked:",y),console.log("  Current role:",u),console.log("  Is Tauri mode:",s);try{if(s){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:u,term:y});const le=await qe("find_documents_for_kg_term",{roleName:u,term:y});console.log("  📥 Tauri response received:"),console.log("    Status:",le.status),console.log("    Results count:",((E=le.results)==null?void 0:E.length)||0),console.log("    Total:",le.total||0),console.log("    Full response:",JSON.stringify(le,null,2)),le.status==="success"&&le.results&&le.results.length>0?(t(4,m=le.results[0]),t(6,v=m.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",m.title),console.log("    Rank:",v),console.log("    Body length:",((I=m.body)==null?void 0:I.length)||0,"characters"),t(2,d=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${y}" in role: "${u}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const le=at.ServerURL,we=encodeURIComponent(u),ve=encodeURIComponent(y),Ue=`${le}/roles/${we}/kg_search?term=${ve}`;console.log("  📤 HTTP Request details:"),console.log("    Base URL:",le),console.log("    Role (encoded):",we),console.log("    Term (encoded):",ve),console.log("    Full URL:",Ue);const _e=await fetch(Ue);if(console.log("  📥 HTTP Response received:"),console.log("    Status code:",_e.status),console.log("    Status text:",_e.statusText),console.log("    Headers:",Object.fromEntries(_e.headers.entries())),!_e.ok)throw new Error(`HTTP error! Status: ${_e.status} - ${_e.statusText}`);const ce=await _e.json();console.log("  📄 Response data:"),console.log("    Status:",ce.status),console.log("    Results count:",((D=ce.results)==null?void 0:D.length)||0),console.log("    Total:",ce.total||0),console.log("    Full response:",JSON.stringify(ce,null,2)),ce.status==="success"&&ce.results&&ce.results.length>0?(t(4,m=ce.results[0]),t(6,v=m.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",m.title),console.log("    Rank:",v),console.log("    Body length:",((V=m.body)==null?void 0:V.length)||0,"characters"),t(2,d=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${y}" in role: "${u}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",Ue))}}catch(le){console.error("❌ Error fetching KG document:"),console.error("  Error type:",le.constructor.name),console.error("  Error message:",le.message||le),console.error("  Request details:",{tag:y,role:u,isTauri:s,timestamp:new Date().toISOString()}),!s&&((x=le.message)!=null&&x.includes("Failed to fetch"))&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{t(7,w=!1)}}async function F(){var y;if(!(T||!r.id||!u)){t(9,T=!0),t(10,$=null),console.log("🤖 AI Summary Debug Info:"),console.log("  Document ID:",r.id),console.log("  Current role:",u),console.log("  Is Tauri mode:",s);try{const E={document_id:r.id,role:u,max_length:250,force_regenerate:!1};console.log("  📤 Summarization request:",E);let I;if(s){const x=`${at.ServerURL}/documents/summarize`;I=await fetch(x,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(E)})}else{const x=`${at.ServerURL}/documents/summarize`;I=await fetch(x,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(E)})}if(console.log("  📥 Summary response received:"),console.log("    Status code:",I.status),console.log("    Status text:",I.statusText),!I.ok)throw new Error(`HTTP error! Status: ${I.status} - ${I.statusText}`);const D=await I.json();console.log("  📄 Summary response data:",D),D.status==="Success"&&D.summary?(t(8,h=D.summary),t(12,U=D.from_cache||!1),t(11,b=!0),console.log("  ✅ Summary generated successfully"),console.log("    Summary length:",h.length,"characters"),console.log("    From cache:",U),console.log("    Model used:",D.model_used)):(t(10,$=D.error||"Failed to generate summary"),console.error("  ❌ Summary generation failed:",$))}catch(E){console.error("❌ Error generating summary:"),console.error("  Error type:",E.constructor.name),console.error("  Error message:",E.message||E),console.error("  Request details:",{document_id:r.id,role:u,isTauri:s,timestamp:new Date().toISOString()}),t(10,$=E.message||"Network error occurred"),(y=E.message)!=null&&y.includes("Failed to fetch")&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Verify OpenRouter is enabled for this role"),console.error("    3. Check OPENROUTER_KEY environment variable"),console.error("    4. Verify server URL in CONFIG.ServerURL"))}finally{t(9,T=!1)}}}function B(){console.log("📥 Downloading document as markdown:",r.title);let y=`# ${r.title}

`;y+=`**Source:** Terraphim Search
`,y+=`**Rank:** ${r.rank||"N/A"}
`,r.url&&(y+=`**URL:** ${r.url}
`),r.tags&&r.tags.length>0&&(y+=`**Tags:** ${r.tags.join(", ")}
`),y+=`**Downloaded:** ${new Date().toISOString()}

`,r.description&&(y+=`## Description

${r.description}

`),y+=`## Content

${r.body}
`;const E=`${r.title.replace(/[^a-z0-9]/gi,"_").toLowerCase()}_${Date.now()}.md`,I=new Blob([y],{type:"text/markdown"}),D=URL.createObjectURL(I),V=window.document.createElement("a");V.href=D,V.download=E,window.document.body.appendChild(V),V.click(),window.document.body.removeChild(V),URL.revokeObjectURL(D),console.log("✅ Markdown file downloaded:",E)}function A(){const y=`vscode://${encodeURIComponent(r.title)}.md?${encodeURIComponent(r.body)}`;window.open(y,"_blank")}yl[u]!==void 0&&(console.log("Have attribute",yl[u]),yl[u].hasOwnProperty("enableLogseq")?console.log("enable logseq True"):console.log("Didn't make it"));const R=y=>G(y),Z=()=>{t(10,$=null),F()},N=()=>t(11,b=!1),z=()=>{F()};function X(y){p=y,t(1,p)}function W(y){d=y,t(2,d)}function Y(y){_=y,t(3,_)}return l.$$set=y=>{"document"in y&&t(0,r=y.document)},t(13,o=M()),t(14,n=J()),[r,p,d,_,m,k,v,w,h,T,$,b,U,o,n,L,G,F,R,Z,N,z,X,W,Y]}class qr extends ct{constructor(e){super(),ft(this,e,Br,Kr,et,{document:0},null,[-1,-1])}}const Jr="/assets/terraphim_gray.png";function Go(l,e,t){const o=l.slice();return o[20]=e[t],o}function Ko(l,e,t){const o=l.slice();return o[23]=e[t],o[25]=t,o}function Bo(l){let e,t=l[2],o=[];for(let n=0;n<t.length;n+=1)o[n]=qo(Ko(l,t,n));return{c(){e=f("ul");for(let n=0;n<o.length;n+=1)o[n].c();a(e,"class","suggestions svelte-13t09eu")},m(n,u){S(n,e,u);for(let s=0;s<o.length;s+=1)o[s]&&o[s].m(e,null)},p(n,u){if(u&524){t=n[2];let s;for(s=0;s<t.length;s+=1){const c=Ko(n,t,s);o[s]?o[s].p(c,u):(o[s]=qo(c),o[s].c(),o[s].m(e,null))}for(;s<o.length;s+=1)o[s].d(1);o.length=t.length}},d(n){n&&C(e),We(o,n)}}}function qo(l){let e,t=l[23]+"",o,n,u,s,c,r;function p(){return l[13](l[23])}function d(..._){return l[14](l[23],..._)}return{c(){e=f("li"),o=K(t),n=g(),a(e,"tabindex","0"),a(e,"role","option"),a(e,"aria-selected",u=l[25]===l[3]),a(e,"aria-label",s=`Apply suggestion: ${l[23]}`),a(e,"class","svelte-13t09eu"),Rt(e,"active",l[25]===l[3])},m(_,m){S(_,e,m),i(e,o),i(e,n),c||(r=[Q(e,"click",p),Q(e,"keydown",d)],c=!0)},p(_,m){l=_,m&4&&t!==(t=l[23]+"")&&be(o,t),m&8&&u!==(u=l[25]===l[3])&&a(e,"aria-selected",u),m&4&&s!==(s=`Apply suggestion: ${l[23]}`)&&a(e,"aria-label",s),m&8&&Rt(e,"active",l[25]===l[3])},d(_){_&&C(e),c=!1,Ge(r)}}}function Vr(l){let e,t,o,n,u;function s(p){l[12](p)}let c={type:"search",placeholder:l[6]?`Search over Knowledge graph for ${l[4]}`:"Search",icon:"search",expanded:!0,autofocus:!0};l[5]!==void 0&&(c.value=l[5]),t=new Bt({props:c}),Fe.push(()=>Je(t,"value",s)),t.$on("click",l[10]),t.$on("submit",l[10]),t.$on("keydown",l[8]),t.$on("input",l[7]);let r=l[2].length>0&&Bo(l);return{c(){e=f("div"),se(t.$$.fragment),n=g(),r&&r.c(),a(e,"class","input-wrapper svelte-13t09eu")},m(p,d){S(p,e,d),re(t,e,null),i(e,n),r&&r.m(e,null),u=!0},p(p,d){const _={};d&80&&(_.placeholder=p[6]?`Search over Knowledge graph for ${p[4]}`:"Search"),!o&&d&32&&(o=!0,_.value=p[5],Ve(()=>o=!1)),t.$set(_),p[2].length>0?r?r.p(p,d):(r=Bo(p),r.c(),r.m(e,null)):r&&(r.d(1),r=null)},i(p){u||(H(t.$$.fragment,p),u=!0)},o(p){q(t.$$.fragment,p),u=!1},d(p){p&&C(e),ie(t),r&&r.d()}}}function Yr(l){let e,t,o,n,u,s,c,r,p,d;return{c(){e=f("section"),t=f("div"),o=f("img"),u=g(),s=f("p"),s.textContent="I am Terraphim, your personal assistant.",c=g(),r=f("button"),r.innerHTML=`<span class="icon"><i class="fas fa-magic"></i></span> 
        <span>Configuration Wizard</span>`,is(o.src,n=Jr)||a(o,"src",n),a(o,"alt","Terraphim Logo"),a(o,"class","svelte-13t09eu"),a(r,"class","button is-primary"),a(r,"data-testid","wizard-start"),a(t,"class","content has-text-grey has-text-centered svelte-13t09eu"),a(e,"class","section")},m(_,m){S(_,e,m),i(e,t),i(t,o),i(t,u),i(t,s),i(t,c),i(t,r),p||(d=Q(r,"click",l[15]),p=!0)},p:Se,i:Se,o:Se,d(_){_&&C(e),p=!1,d()}}}function Zr(l){let e,t,o=l[0],n=[];for(let s=0;s<o.length;s+=1)n[s]=Jo(Go(l,o,s));const u=s=>q(n[s],1,1,()=>{n[s]=null});return{c(){for(let s=0;s<n.length;s+=1)n[s].c();e=tt()},m(s,c){for(let r=0;r<n.length;r+=1)n[r]&&n[r].m(s,c);S(s,e,c),t=!0},p(s,c){if(c&1){o=s[0];let r;for(r=0;r<o.length;r+=1){const p=Go(s,o,r);n[r]?(n[r].p(p,c),H(n[r],1)):(n[r]=Jo(p),n[r].c(),H(n[r],1),n[r].m(e.parentNode,e))}for(Me(),r=o.length;r<n.length;r+=1)u(r);De()}},i(s){if(!t){for(let c=0;c<o.length;c+=1)H(n[c]);t=!0}},o(s){n=n.filter(Boolean);for(let c=0;c<n.length;c+=1)q(n[c]);t=!1},d(s){We(n,s),s&&C(e)}}}function Qr(l){let e,t;return{c(){e=f("p"),t=K(l[1]),a(e,"class","error svelte-13t09eu")},m(o,n){S(o,e,n),i(e,t)},p(o,n){n&2&&be(t,o[1])},i:Se,o:Se,d(o){o&&C(e)}}}function Jo(l){let e,t;return e=new qr({props:{document:l[20]}}),{c(){se(e.$$.fragment)},m(o,n){re(e,o,n),t=!0},p(o,n){const u={};n&1&&(u.document=o[20]),e.$set(u)},i(o){t||(H(e.$$.fragment,o),t=!0)},o(o){q(e.$$.fragment,o),t=!1},d(o){ie(e,o)}}}function Xr(l){let e,t,o,n,u,s,c,r,p,d,_;e=new nl({props:{fallbackPath:"/"}}),n=new Mt({props:{$$slots:{default:[Vr]},$$scope:{ctx:l}}});const m=[Qr,Zr,Yr],k=[];function v(w,h){return w[1]?0:w[0].length?1:2}return s=v(l),c=k[s]=m[s](l),{c(){se(e.$$.fragment),t=g(),o=f("form"),se(n.$$.fragment),u=g(),c.c(),r=tt()},m(w,h){re(e,w,h),S(w,t,h),S(w,o,h),re(n,o,null),S(w,u,h),k[s].m(w,h),S(w,r,h),p=!0,d||(_=Q(o,"submit",rs(l[10])),d=!0)},p(w,[h]){const T={};h&67108988&&(T.$$scope={dirty:h,ctx:w}),n.$set(T);let $=s;s=v(w),s===$?k[s].p(w,h):(Me(),q(k[$],1,1,()=>{k[$]=null}),De(),c=k[s],c?c.p(w,h):(c=k[s]=m[s](w),c.c()),H(c,1),c.m(r.parentNode,r))},i(w){p||(H(e.$$.fragment,w),H(n.$$.fragment,w),H(c),p=!0)},o(w){q(e.$$.fragment,w),q(n.$$.fragment,w),q(c),p=!1},d(w){ie(e,w),w&&C(t),w&&C(o),ie(n),w&&C(u),k[s].d(w),w&&C(r),d=!1,_()}}}function xr(l,e,t){let o,n,u,s,c,r,p;Re(l,Rs,L=>t(17,n=L)),Re(l,St,L=>t(4,u=L)),Re(l,Ll,L=>t(5,s=L)),Re(l,Be,L=>t(18,c=L)),Re(l,al,L=>t(11,r=L)),Re(l,ht,L=>t(6,p=L));let d=[],_=null,m=[],k=-1;function v(L){const O=L.trim().toLowerCase();return O.length===0?[]:o.filter(([F])=>F.toLowerCase().includes(O)).map(([F])=>F).slice(0,5)}function w(L){const O=L.target;if(!O||O.selectionStart==null)return;const G=O.selectionStart,B=s.slice(0,G).split(/\s+/),A=B[B.length-1];t(2,m=v(A)),t(3,k=-1)}function h(L){m.length!==0&&(L.key==="ArrowDown"?(L.preventDefault(),t(3,k=(k+1)%m.length)):L.key==="ArrowUp"?(L.preventDefault(),t(3,k=(k-1+m.length)%m.length)):(L.key==="Enter"||L.key==="Tab")&&k!==-1&&(L.preventDefault(),T(m[k])))}function T(L){var R;const O=document.querySelector('input[type="search"]'),G=(O==null?void 0:O.selectionStart)??0,F=s.slice(0,G),B=s.slice(G),A=F.split(/\s+/);A[A.length-1]=L,$l(Ll,s=[...A,B].join(" "),s),(R=O==null?void 0:O.setSelectionRange)==null||R.call(O,G+L.length,G+L.length),t(2,m=[]),t(3,k=-1)}async function $(){if(t(1,_=null),c)try{const L=await qe("search",{searchQuery:{search_term:s,skip:0,limit:10,role:u}});L.status==="success"?(t(0,d=L.results),console.log("Response results"),console.log(d)):(t(1,_=`Search failed: ${L.status}`),console.error("Search failed:",L))}catch(L){t(1,_=`Error in Tauri search: ${L}`),console.error("Error in Tauri search:",L)}else{if(!s.trim())return;const L=JSON.stringify({search_term:s,skip:0,limit:10,role:u});try{const O=await fetch(n,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:L}),G=await O.json();if(!O.ok)throw new Error(`HTTP error! Status: ${O.status}`);t(0,d=G.results)}catch(O){console.error("Error fetching data:",O),t(1,_=`Error fetching data: ${O}`)}}}function b(L){s=L,Ll.set(s)}const U=L=>T(L),J=(L,O)=>{(O.key==="Enter"||O.key===" ")&&(O.preventDefault(),T(L))},M=()=>window.location.href="/config/wizard";return l.$$.update=()=>{l.$$.dirty&2048&&(o=Object.entries(r))},[d,_,m,k,u,s,p,w,h,T,$,r,b,U,J,M]}class ei extends ct{constructor(e){super(),ft(this,e,xr,Xr,et,{})}}async function Vo(l={}){return typeof l=="object"&&Object.freeze(l),Dl({__tauriModule:"Dialog",message:{cmd:"openDialog",options:l}})}function Yo(l,e,t){const o=l.slice();return o[71]=e[t],o[79]=t,o}function Zo(l,e,t){const o=l.slice();return o[77]=e[t],o[78]=e,o[79]=t,o}function Qo(l,e,t){const o=l.slice();return o[80]=e[t],o}function Xo(l,e,t){const o=l.slice();return o[80]=e[t],o}function xo(l,e,t){const o=l.slice();return o[85]=e[t],o[86]=e,o[87]=t,o}function en(l,e,t){const o=l.slice();return o[88]=e[t][0],o[89]=e[t][1],o[90]=e,o[91]=t,o}function tn(l,e,t){const o=l.slice();return o[74]=e[t],o}function ln(l,e,t){const o=l.slice();return o[71]=e[t],o}function on(l,e,t){const o=l.slice();return o[74]=e[t],o}function nn(l){let e,t,o,n,u;return{c(){e=f("div"),t=f("button"),o=K(`
      Configuration saved successfully!`),a(t,"class","delete"),a(e,"class","notification is-success"),a(e,"data-testid","wizard-success")},m(s,c){S(s,e,c),i(e,t),i(e,o),n||(u=Q(t,"click",l[20]),n=!0)},p:Se,d(s){s&&C(e),n=!1,u()}}}function sn(l){let e,t,o,n,u;return{c(){e=f("div"),t=f("button"),o=K(`
      Failed to save configuration. Please try again.`),a(t,"class","delete"),a(e,"class","notification is-danger"),a(e,"data-testid","wizard-error")},m(s,c){S(s,e,c),i(e,t),i(e,o),n||(u=Q(t,"click",l[21]),n=!0)},p:Se,d(s){s&&C(e),n=!1,u()}}}function ti(l){let e,t,o,n,u,s,c,r,p,d=l[3].id+"",_,m,k,v,w,h=l[3].global_shortcut+"",T,$,b,U,J,M=l[3].default_theme+"",L,O,G,F,B,A=l[3].default_role+"",R,Z,N,z,X,W,Y=JSON.stringify(l[3],null,2)+"",y,E=l[3].roles,I=[];for(let D=0;D<E.length;D+=1)I[D]=rn(Yo(l,E,D));return{c(){e=f("h4"),e.textContent="Review",t=g(),o=f("div"),n=f("h5"),n.textContent="Configuration Summary:",u=g(),s=f("ul"),c=f("li"),r=f("strong"),r.textContent="Configuration ID:",p=g(),_=K(d),m=g(),k=f("li"),v=f("strong"),v.textContent="Global Shortcut:",w=g(),T=K(h),$=g(),b=f("li"),U=f("strong"),U.textContent="Default Theme:",J=g(),L=K(M),O=g(),G=f("li"),F=f("strong"),F.textContent="Default Role:",B=g(),R=K(A),Z=g(),N=f("h5"),N.textContent="Roles:",z=g();for(let D=0;D<I.length;D+=1)I[D].c();X=g(),W=f("pre"),y=K(Y),a(e,"class","title is-5"),a(o,"class","content"),fe(W,"max-height","300px"),fe(W,"overflow","auto")},m(D,V){S(D,e,V),S(D,t,V),S(D,o,V),i(o,n),i(o,u),i(o,s),i(s,c),i(c,r),i(c,p),i(c,_),i(s,m),i(s,k),i(k,v),i(k,w),i(k,T),i(s,$),i(s,b),i(b,U),i(b,J),i(b,L),i(s,O),i(s,G),i(G,F),i(G,B),i(G,R),i(o,Z),i(o,N),i(o,z);for(let x=0;x<I.length;x+=1)I[x]&&I[x].m(o,null);S(D,X,V),S(D,W,V),i(W,y)},p(D,V){if(V[0]&8&&d!==(d=D[3].id+"")&&be(_,d),V[0]&8&&h!==(h=D[3].global_shortcut+"")&&be(T,h),V[0]&8&&M!==(M=D[3].default_theme+"")&&be(L,M),V[0]&8&&A!==(A=D[3].default_role+"")&&be(R,A),V[0]&10){E=D[3].roles;let x;for(x=0;x<E.length;x+=1){const le=Yo(D,E,x);I[x]?I[x].p(le,V):(I[x]=rn(le),I[x].c(),I[x].m(o,null))}for(;x<I.length;x+=1)I[x].d(1);I.length=E.length}V[0]&8&&Y!==(Y=JSON.stringify(D[3],null,2)+"")&&be(y,Y)},d(D){D&&C(e),D&&C(t),D&&C(o),We(I,D),D&&C(X),D&&C(W)}}}function li(l){let e,t,o=[],n=new Map,u,s,c,r,p=l[3].roles;const d=_=>_[77].name;for(let _=0;_<p.length;_+=1){let m=Zo(l,p,_),k=d(m);n.set(k,o[_]=$n(k,m))}return{c(){e=f("h4"),e.textContent="Roles",t=g();for(let _=0;_<o.length;_+=1)o[_].c();u=g(),s=f("button"),s.textContent="Add Role",a(e,"class","title is-5"),a(s,"class","button is-link is-light"),a(s,"data-testid","add-role")},m(_,m){S(_,e,m),S(_,t,m);for(let k=0;k<o.length;k+=1)o[k]&&o[k].m(_,m);S(_,u,m),S(_,s,m),c||(r=Q(s,"click",l[12]),c=!0)},p(_,m){m[0]&516985&&(p=_[3].roles,o=as(o,m,d,1,_,p,n,u.parentNode,us,$n,u,Zo))},d(_){_&&C(e),_&&C(t);for(let m=0;m<o.length;m+=1)o[m].d(_);_&&C(u),_&&C(s),c=!1,r()}}}function oi(l){let e,t,o,n,u,s,c,r,p,d,_,m,k,v,w,h,T,$,b,U,J,M,L,O,G,F,B,A,R,Z,N,z=l[8],X=[];for(let y=0;y<z.length;y+=1)X[y]=yn(on(l,z,y));let W=l[3].roles,Y=[];for(let y=0;y<W.length;y+=1)Y[y]=Cn(ln(l,W,y));return{c(){e=f("div"),t=f("label"),t.textContent="Configuration ID",o=g(),n=f("div"),u=f("div"),s=f("select"),c=f("option"),c.textContent="Desktop",r=f("option"),r.textContent="Server",p=f("option"),p.textContent="Embedded",d=g(),_=f("div"),m=f("label"),m.textContent="Global shortcut",k=g(),v=f("div"),w=f("input"),h=g(),T=f("div"),$=f("label"),$.textContent="Default theme",b=g(),U=f("div"),J=f("div"),M=f("select");for(let y=0;y<X.length;y+=1)X[y].c();L=g(),O=f("div"),G=f("label"),G.textContent="Default Role",F=g(),B=f("div"),A=f("div"),R=f("select");for(let y=0;y<Y.length;y+=1)Y[y].c();a(t,"class","label"),a(t,"for","config-id"),c.__value="Desktop",c.value=c.__value,r.__value="Server",r.value=r.__value,p.__value="Embedded",p.value=p.__value,a(s,"id","config-id"),l[3].id===void 0&&ut(()=>l[22].call(s)),a(u,"class","select"),a(n,"class","control"),a(e,"class","field"),a(m,"class","label"),a(m,"for","global-shortcut"),a(w,"class","input"),a(w,"id","global-shortcut"),a(w,"type","text"),a(v,"class","control"),a(_,"class","field"),a($,"class","label"),a($,"for","default-theme"),a(M,"id","default-theme"),l[3].default_theme===void 0&&ut(()=>l[24].call(M)),a(J,"class","select is-fullwidth"),a(U,"class","control"),a(T,"class","field"),a(G,"class","label"),a(G,"for","default-role"),a(R,"id","default-role"),l[3].default_role===void 0&&ut(()=>l[25].call(R)),a(A,"class","select"),a(B,"class","control"),a(O,"class","field")},m(y,E){S(y,e,E),i(e,t),i(e,o),i(e,n),i(n,u),i(u,s),i(s,c),i(s,r),i(s,p),Pe(s,l[3].id,!0),S(y,d,E),S(y,_,E),i(_,m),i(_,k),i(_,v),i(v,w),Ce(w,l[3].global_shortcut),S(y,h,E),S(y,T,E),i(T,$),i(T,b),i(T,U),i(U,J),i(J,M);for(let I=0;I<X.length;I+=1)X[I]&&X[I].m(M,null);Pe(M,l[3].default_theme,!0),S(y,L,E),S(y,O,E),i(O,G),i(O,F),i(O,B),i(B,A),i(A,R);for(let I=0;I<Y.length;I+=1)Y[I]&&Y[I].m(R,null);Pe(R,l[3].default_role,!0),Z||(N=[Q(s,"change",l[22]),Q(w,"input",l[23]),Q(M,"change",l[24]),Q(R,"change",l[25])],Z=!0)},p(y,E){if(E[0]&264&&Pe(s,y[3].id),E[0]&264&&w.value!==y[3].global_shortcut&&Ce(w,y[3].global_shortcut),E[0]&256){z=y[8];let I;for(I=0;I<z.length;I+=1){const D=on(y,z,I);X[I]?X[I].p(D,E):(X[I]=yn(D),X[I].c(),X[I].m(M,null))}for(;I<X.length;I+=1)X[I].d(1);X.length=z.length}if(E[0]&264&&Pe(M,y[3].default_theme),E[0]&8){W=y[3].roles;let I;for(I=0;I<W.length;I+=1){const D=ln(y,W,I);Y[I]?Y[I].p(D,E):(Y[I]=Cn(D),Y[I].c(),Y[I].m(R,null))}for(;I<Y.length;I+=1)Y[I].d(1);Y.length=W.length}E[0]&264&&Pe(R,y[3].default_role)},d(y){y&&C(e),y&&C(d),y&&C(_),y&&C(h),y&&C(T),We(X,y),y&&C(L),y&&C(O),We(Y,y),Z=!1,Ge(N)}}}function rn(l){let e,t,o=l[71].name+"",n,u,s,c,r,p=l[71].shortname+"",d,_,m,k,v,w=l[71].theme+"",h,T,$,b,U,J=l[71].relevance_function+"",M,L,O,G,F,B;return{c(){e=f("div"),t=f("h6"),n=K(o),u=g(),s=f("p"),c=f("strong"),c.textContent="Shortname:",r=g(),d=K(p),_=g(),m=f("p"),k=f("strong"),k.textContent="Theme:",v=g(),h=K(w),T=g(),$=f("p"),b=f("strong"),b.textContent="Relevance Function:",U=g(),M=K(J),L=g(),O=f("button"),O.textContent="Edit Role",G=g(),a(t,"data-testid","review-role-name-"+l[79]),a(O,"class","button is-small"),a(O,"data-testid","edit-role-"+l[79]),a(e,"class","box")},m(A,R){S(A,e,R),i(e,t),i(t,n),i(e,u),i(e,s),i(s,c),i(s,r),i(s,d),i(e,_),i(e,m),i(m,k),i(m,v),i(m,h),i(e,T),i(e,$),i($,b),i($,U),i($,M),i(e,L),i(e,O),i(e,G),F||(B=Q(O,"click",l[68]),F=!0)},p(A,R){R[0]&8&&o!==(o=A[71].name+"")&&be(n,o),R[0]&8&&p!==(p=A[71].shortname+"")&&be(d,p),R[0]&8&&w!==(w=A[71].theme+"")&&be(h,w),R[0]&8&&J!==(J=A[71].relevance_function+"")&&be(M,J)},d(A){A&&C(e),F=!1,B()}}}function an(l){let e,t=l[74]+"",o;return{c(){e=f("option"),o=K(t),e.__value=l[74],e.value=e.__value},m(n,u){S(n,e,u),i(e,o)},p:Se,d(n){n&&C(e)}}}function ni(l){let e;return{c(){e=K("Directory Path")},m(t,o){S(t,e,o)},d(t){t&&C(e)}}}function si(l){let e;return{c(){e=K("Server URL")},m(t,o){S(t,e,o)},d(t){t&&C(e)}}}function un(l){let e;return{c(){e=f("p"),e.textContent="Click to select directory",a(e,"class","help")},m(t,o){S(t,e,o)},d(t){t&&C(e)}}}function cn(l){let e,t,o,n,u,s,c,r,p,d,_,m;function k(){l[34].call(c,l[79],l[87])}return{c(){e=f("div"),t=f("label"),o=K("Atomic Server Secret"),u=g(),s=f("div"),c=f("input"),p=g(),d=f("p"),d.textContent="Leave empty for anonymous access",a(t,"class","label"),a(t,"for",n=`haystack-secret-${l[79]}-${l[87]}`),a(c,"class","input"),a(c,"id",r=`haystack-secret-${l[79]}-${l[87]}`),a(c,"type","password"),a(c,"placeholder","Base64 encoded secret (optional)"),a(s,"class","control"),a(d,"class","help"),a(e,"class","field")},m(v,w){S(v,e,w),i(e,t),i(t,o),i(e,u),i(e,s),i(s,c),Ce(c,l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret),i(e,p),i(e,d),_||(m=Q(c,"input",k),_=!0)},p(v,w){l=v,w[0]&264&&n!==(n=`haystack-secret-${l[79]}-${l[87]}`)&&a(t,"for",n),w[0]&264&&r!==(r=`haystack-secret-${l[79]}-${l[87]}`)&&a(c,"id",r),w[0]&264&&c.value!==l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret&&Ce(c,l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret)},d(v){v&&C(e),_=!1,m()}}}function fn(l){let e,t,o,n,u,s,c,r,p,d,_,m,k,v,w,h,T,$,b,U,J,M,L,O,G,F,B,A,R,Z,N,z,X,W,Y,y,E,I,D,V,x,le,we;function ve(){l[35].call(d,l[79],l[87])}function Ue(...oe){return l[36](l[79],l[87],...oe)}let _e=Object.entries(l[3].roles[l[79]].haystacks[l[87]].extra_parameters||{}),ce=[];for(let oe=0;oe<_e.length;oe+=1)ce[oe]=pn(en(l,_e,oe));function pe(){return l[40](l[79],l[87])}function Le(){return l[41](l[79],l[87])}function $e(){return l[42](l[79],l[87])}return{c(){e=f("div"),t=f("label"),t.textContent="Extra Parameters (for filtering)",o=g(),n=f("div"),u=f("div"),s=f("label"),c=K("Hashtag"),p=g(),d=f("input"),m=g(),k=f("div"),v=f("div"),w=f("label"),h=K("Presets"),$=g(),b=f("div"),U=f("select"),J=f("option"),J.textContent="(choose)",M=f("option"),M.textContent="#rust",L=f("option"),L.textContent="#docs",O=f("option"),O.textContent="#test",G=f("option"),G.textContent="#todo",B=g(),A=f("p"),A.innerHTML="When set, searches will enforce the hashtag alongside your query (AND), e.g. <code>-e &quot;search&quot; -e &quot;#rust&quot;</code>.",R=g();for(let oe=0;oe<ce.length;oe+=1)ce[oe].c();Z=g(),N=f("div"),z=f("div"),X=f("button"),X.textContent="+ Tag Filter",W=g(),Y=f("div"),y=f("button"),y.textContent="+ Max Results",E=g(),I=f("div"),D=f("button"),D.textContent="+ Custom Parameter",V=g(),x=f("p"),x.innerHTML=`Common parameters: <code>tag</code> (e.g., &quot;#rust&quot;), <code>glob</code> (e.g., &quot;*.md&quot;), 
                  <code>max_count</code> (e.g., &quot;10&quot;), <code>context</code> (e.g., &quot;5&quot;)`,a(t,"class","label"),a(s,"class","label"),a(s,"for",r=`ripgrep-hashtag-${l[79]}-${l[87]}`),a(d,"class","input"),a(d,"id",_=`ripgrep-hashtag-${l[79]}-${l[87]}`),a(d,"type","text"),a(d,"placeholder","#rust"),a(u,"class","control"),a(n,"class","field is-grouped"),a(w,"class","label"),a(w,"for",T=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`),J.__value="",J.value=J.__value,M.__value="#rust",M.value=M.__value,L.__value="#docs",L.value=L.__value,O.__value="#test",O.value=O.__value,G.__value="#todo",G.value=G.__value,a(U,"id",F=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`),a(b,"class","select is-small"),a(v,"class","control"),a(k,"class","field is-grouped"),fe(k,"margin-bottom",".5rem"),a(A,"class","help"),a(X,"class","button is-small is-link is-light"),a(z,"class","control"),a(y,"class","button is-small is-link is-light"),a(Y,"class","control"),a(D,"class","button is-small is-link is-light"),a(I,"class","control"),a(N,"class","field is-grouped"),a(x,"class","help"),a(e,"class","field")},m(oe,me){S(oe,e,me),i(e,t),i(e,o),i(e,n),i(n,u),i(u,s),i(s,c),i(u,p),i(u,d),Ce(d,l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag),i(e,m),i(e,k),i(k,v),i(v,w),i(w,h),i(v,$),i(v,b),i(b,U),i(U,J),i(U,M),i(U,L),i(U,O),i(U,G),i(e,B),i(e,A),i(e,R);for(let ae=0;ae<ce.length;ae+=1)ce[ae]&&ce[ae].m(e,null);i(e,Z),i(e,N),i(N,z),i(z,X),i(N,W),i(N,Y),i(Y,y),i(N,E),i(N,I),i(I,D),i(e,V),i(e,x),le||(we=[Q(d,"input",ve),Q(U,"change",Ue),Q(X,"click",pe),Q(y,"click",Le),Q(D,"click",$e)],le=!0)},p(oe,me){if(l=oe,me[0]&264&&r!==(r=`ripgrep-hashtag-${l[79]}-${l[87]}`)&&a(s,"for",r),me[0]&264&&_!==(_=`ripgrep-hashtag-${l[79]}-${l[87]}`)&&a(d,"id",_),me[0]&264&&d.value!==l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag&&Ce(d,l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag),me[0]&264&&T!==(T=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`)&&a(w,"for",T),me[0]&264&&F!==(F=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`)&&a(U,"id",F),me[0]&393224){_e=Object.entries(l[3].roles[l[79]].haystacks[l[87]].extra_parameters||{});let ae;for(ae=0;ae<_e.length;ae+=1){const ge=en(l,_e,ae);ce[ae]?ce[ae].p(ge,me):(ce[ae]=pn(ge),ce[ae].c(),ce[ae].m(e,Z))}for(;ae<ce.length;ae+=1)ce[ae].d(1);ce.length=_e.length}},d(oe){oe&&C(e),We(ce,oe),le=!1,Ge(we)}}}function pn(l){let e,t,o,n,u,s,c,r,p,d,_,m,k;function v(...T){return l[37](l[79],l[87],l[88],...T)}function w(){l[38].call(c,l[79],l[87],l[88])}function h(){return l[39](l[79],l[87],l[88])}return{c(){e=f("div"),t=f("div"),o=f("input"),u=g(),s=f("div"),c=f("input"),r=g(),p=f("div"),d=f("button"),d.textContent="×",_=g(),a(o,"class","input"),a(o,"type","text"),a(o,"placeholder","Parameter name"),o.value=n=l[88],a(t,"class","control"),a(c,"class","input"),a(c,"type","text"),a(c,"placeholder","Parameter value"),a(s,"class","control is-expanded"),a(d,"class","button is-small is-danger"),a(p,"class","control"),a(e,"class","field is-grouped")},m(T,$){S(T,e,$),i(e,t),i(t,o),i(e,u),i(e,s),i(s,c),Ce(c,l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]]),i(e,r),i(e,p),i(p,d),i(e,_),m||(k=[Q(o,"blur",v),Q(c,"input",w),Q(d,"click",h)],m=!0)},p(T,$){l=T,$[0]&264&&n!==(n=l[88])&&o.value!==n&&(o.value=n),$[0]&264&&c.value!==l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]]&&Ce(c,l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]])},d(T){T&&C(e),m=!1,Ge(k)}}}function dn(l){let e,t,o,n,u,s,c,r,p,d,_,m,k,v,w,h,T,$,b,U,J,M,L,O,G,F,B,A,R,Z,N,z,X,W,Y,y,E,I,D;function V(){l[31].call(p,l[79],l[87])}function x(oe,me){return oe[3].roles[oe[79]].haystacks[oe[87]].service==="Atomic"?si:ni}let le=x(l),we=le(l);function ve(){l[32].call(b,l[79],l[87])}function Ue(){return l[33](l[79],l[87])}let _e=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"&&un(),ce=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"&&cn(l),pe=l[3].roles[l[79]].haystacks[l[87]].service==="Ripgrep"&&fn(l);function Le(){l[43].call(R,l[79],l[87])}function $e(){return l[44](l[79],l[87])}return{c(){e=f("div"),t=f("div"),o=f("label"),n=K("Service Type"),s=g(),c=f("div"),r=f("div"),p=f("select"),d=f("option"),d.textContent="Ripgrep (File Search)",_=f("option"),_.textContent="Atomic Server",k=g(),v=f("div"),w=f("label"),we.c(),T=g(),$=f("div"),b=f("input"),L=g(),_e&&_e.c(),O=g(),ce&&ce.c(),G=g(),pe&&pe.c(),F=g(),B=f("div"),A=f("label"),R=f("input"),N=K(`
                 Read-only`),X=g(),W=f("div"),Y=f("button"),y=K("Remove Haystack"),a(o,"class","label"),a(o,"for",u=`haystack-service-${l[79]}-${l[87]}`),d.__value="Ripgrep",d.value=d.__value,_.__value="Atomic",_.value=_.__value,a(p,"id",m=`haystack-service-${l[79]}-${l[87]}`),l[3].roles[l[79]].haystacks[l[87]].service===void 0&&ut(V),a(r,"class","select"),a(c,"class","control"),a(t,"class","field"),a(w,"class","label"),a(w,"for",h=`haystack-path-${l[79]}-${l[87]}`),a(b,"class","input"),a(b,"id",U=`haystack-path-${l[79]}-${l[87]}`),a(b,"type","text"),a(b,"placeholder",J=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?"https://localhost:9883":"/path/to/documents"),b.readOnly=M=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic",a($,"class","control"),a(v,"class","field"),a(R,"id",Z=`haystack-readonly-${l[79]}-${l[87]}`),a(R,"type","checkbox"),a(A,"class","checkbox"),a(A,"for",z=`haystack-readonly-${l[79]}-${l[87]}`),a(B,"class","field"),a(Y,"class","button is-small is-danger"),a(Y,"data-testid",E="remove-haystack-"+l[79]+"-"+l[87]),a(W,"class","field"),a(e,"class","box is-light")},m(oe,me){S(oe,e,me),i(e,t),i(t,o),i(o,n),i(t,s),i(t,c),i(c,r),i(r,p),i(p,d),i(p,_),Pe(p,l[3].roles[l[79]].haystacks[l[87]].service,!0),i(e,k),i(e,v),i(v,w),we.m(w,null),i(v,T),i(v,$),i($,b),Ce(b,l[3].roles[l[79]].haystacks[l[87]].path),i($,L),_e&&_e.m($,null),i(e,O),ce&&ce.m(e,null),i(e,G),pe&&pe.m(e,null),i(e,F),i(e,B),i(B,A),i(A,R),R.checked=l[3].roles[l[79]].haystacks[l[87]].read_only,i(A,N),i(e,X),i(e,W),i(W,Y),i(Y,y),I||(D=[Q(p,"change",V),Q(b,"input",ve),Q(b,"click",function(){Pl(l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?Ue:void 0)&&(l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?Ue:void 0).apply(this,arguments)}),Q(R,"change",Le),Q(Y,"click",$e)],I=!0)},p(oe,me){l=oe,me[0]&264&&u!==(u=`haystack-service-${l[79]}-${l[87]}`)&&a(o,"for",u),me[0]&264&&m!==(m=`haystack-service-${l[79]}-${l[87]}`)&&a(p,"id",m),me[0]&264&&Pe(p,l[3].roles[l[79]].haystacks[l[87]].service),le!==(le=x(l))&&(we.d(1),we=le(l),we&&(we.c(),we.m(w,null))),me[0]&264&&h!==(h=`haystack-path-${l[79]}-${l[87]}`)&&a(w,"for",h),me[0]&264&&U!==(U=`haystack-path-${l[79]}-${l[87]}`)&&a(b,"id",U),me[0]&264&&J!==(J=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?"https://localhost:9883":"/path/to/documents")&&a(b,"placeholder",J),me[0]&280&&M!==(M=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic")&&(b.readOnly=M),me[0]&264&&b.value!==l[3].roles[l[79]].haystacks[l[87]].path&&Ce(b,l[3].roles[l[79]].haystacks[l[87]].path),l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?_e||(_e=un(),_e.c(),_e.m($,null)):_e&&(_e.d(1),_e=null),l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?ce?ce.p(l,me):(ce=cn(l),ce.c(),ce.m(e,G)):ce&&(ce.d(1),ce=null),l[3].roles[l[79]].haystacks[l[87]].service==="Ripgrep"?pe?pe.p(l,me):(pe=fn(l),pe.c(),pe.m(e,F)):pe&&(pe.d(1),pe=null),me[0]&264&&Z!==(Z=`haystack-readonly-${l[79]}-${l[87]}`)&&a(R,"id",Z),me[0]&264&&(R.checked=l[3].roles[l[79]].haystacks[l[87]].read_only),me[0]&264&&z!==(z=`haystack-readonly-${l[79]}-${l[87]}`)&&a(A,"for",z),me[0]&264&&E!==(E="remove-haystack-"+l[79]+"-"+l[87])&&a(Y,"data-testid",E)},d(oe){oe&&C(e),we.d(),_e&&_e.d(),ce&&ce.d(),pe&&pe.d(),I=!1,Ge(D)}}}function _n(l){var Y;let e,t,o,n,u,s,c,r,p,d,_,m,k,v,w,h,T,$,b,U,J,M,L,O,G,F,B,A,R;function Z(){l[47].call(c,l[79])}function N(){return l[48](l[79])}let z=((Y=l[0][l[79]])==null?void 0:Y.length)&&mn(l);function X(){l[50].call(b,l[79])}function W(){l[51].call(O,l[79])}return{c(){e=f("div"),t=f("label"),o=K("Model"),u=g(),s=f("div"),c=f("input"),p=g(),d=f("button"),d.textContent="Fetch models",_=g(),z&&z.c(),m=g(),k=f("div"),v=f("label"),w=K("Base URL"),T=g(),$=f("div"),b=f("input"),J=g(),M=f("div"),L=f("label"),O=f("input"),F=K(`
               Automatically summarize search results`),a(t,"class","label"),a(t,"for",n=`llm-model-${l[79]}`),a(c,"class","input"),a(c,"id",r=`llm-model-${l[79]}`),a(c,"type","text"),a(c,"placeholder","llama3.1"),a(s,"class","control"),a(d,"class","button is-small"),a(e,"class","field"),a(v,"class","label"),a(v,"for",h=`llm-base-url-${l[79]}`),a(b,"class","input"),a(b,"id",U=`llm-base-url-${l[79]}`),a(b,"type","text"),a(b,"placeholder","http://127.0.0.1:11434"),a($,"class","control"),a(k,"class","field"),a(O,"id",G=`llm-auto-summarize-${l[79]}`),a(O,"type","checkbox"),a(L,"class","checkbox"),a(L,"for",B=`llm-auto-summarize-${l[79]}`),a(M,"class","field")},m(y,E){S(y,e,E),i(e,t),i(t,o),i(e,u),i(e,s),i(s,c),Ce(c,l[3].roles[l[79]].llm_model),i(e,p),i(e,d),i(e,_),z&&z.m(e,null),S(y,m,E),S(y,k,E),i(k,v),i(v,w),i(k,T),i(k,$),i($,b),Ce(b,l[3].roles[l[79]].llm_base_url),S(y,J,E),S(y,M,E),i(M,L),i(L,O),O.checked=l[3].roles[l[79]].llm_auto_summarize,i(L,F),A||(R=[Q(c,"input",Z),Q(d,"click",N),Q(b,"input",X),Q(O,"change",W)],A=!0)},p(y,E){var I;l=y,E[0]&264&&n!==(n=`llm-model-${l[79]}`)&&a(t,"for",n),E[0]&264&&r!==(r=`llm-model-${l[79]}`)&&a(c,"id",r),E[0]&264&&c.value!==l[3].roles[l[79]].llm_model&&Ce(c,l[3].roles[l[79]].llm_model),(I=l[0][l[79]])!=null&&I.length?z?z.p(l,E):(z=mn(l),z.c(),z.m(e,null)):z&&(z.d(1),z=null),E[0]&264&&h!==(h=`llm-base-url-${l[79]}`)&&a(v,"for",h),E[0]&264&&U!==(U=`llm-base-url-${l[79]}`)&&a(b,"id",U),E[0]&264&&b.value!==l[3].roles[l[79]].llm_base_url&&Ce(b,l[3].roles[l[79]].llm_base_url),E[0]&264&&G!==(G=`llm-auto-summarize-${l[79]}`)&&a(O,"id",G),E[0]&264&&(O.checked=l[3].roles[l[79]].llm_auto_summarize),E[0]&264&&B!==(B=`llm-auto-summarize-${l[79]}`)&&a(L,"for",B)},d(y){y&&C(e),z&&z.d(),y&&C(m),y&&C(k),y&&C(J),y&&C(M),A=!1,Ge(R)}}}function mn(l){let e,t,o,n,u=l[0][l[79]],s=[];for(let r=0;r<u.length;r+=1)s[r]=hn(Xo(l,u,r));function c(...r){return l[49](l[79],...r)}return{c(){e=f("div"),t=f("select");for(let r=0;r<s.length;r+=1)s[r].c();a(e,"class","select is-fullwidth"),fe(e,"margin-top","0.5rem")},m(r,p){S(r,e,p),i(e,t);for(let d=0;d<s.length;d+=1)s[d]&&s[d].m(t,null);o||(n=Q(t,"change",c),o=!0)},p(r,p){if(l=r,p[0]&9){u=l[0][l[79]];let d;for(d=0;d<u.length;d+=1){const _=Xo(l,u,d);s[d]?s[d].p(_,p):(s[d]=hn(_),s[d].c(),s[d].m(t,null))}for(;d<s.length;d+=1)s[d].d(1);s.length=u.length}},d(r){r&&C(e),We(s,r),o=!1,n()}}}function hn(l){let e,t=l[80]+"",o,n;return{c(){e=f("option"),o=K(t),e.__value=n=l[80],e.value=e.__value},m(u,s){S(u,e,s),i(e,o)},p(u,s){s[0]&9&&t!==(t=u[80]+"")&&be(o,t),s[0]&265&&n!==(n=u[80])&&(e.__value=n,e.value=e.__value)},d(u){u&&C(e)}}}function gn(l){var me;let e,t,o,n,u,s,c,r,p,d,_,m,k,v,w,h,T,$,b,U,J,M,L,O,G,F,B,A,R,Z,N,z,X,W,Y,y,E,I,D,V,x,le,we,ve;function Ue(){l[53].call(c,l[79])}function _e(){l[54].call($,l[79])}function ce(){return l[55](l[79])}let pe=((me=l[0][l[79]])==null?void 0:me.length)&&bn(l);function Le(){l[57].call(A,l[79])}function $e(){l[58].call(E,l[79])}let oe=l[3].roles[l[79]].openrouter_chat_enabled&&kn(l);return{c(){e=f("div"),t=f("label"),o=K("OpenRouter API Key"),u=g(),s=f("div"),c=f("input"),p=g(),d=f("p"),d.innerHTML='Get your API key from <a href="https://openrouter.ai" target="_blank" rel="noopener">OpenRouter</a>',_=g(),m=f("div"),k=f("label"),v=K("Model"),h=g(),T=f("div"),$=f("input"),U=g(),J=f("button"),J.textContent="Fetch models",M=g(),pe&&pe.c(),L=g(),O=f("p"),O.textContent="Choose the language model for generating summaries. Different models offer different speed/quality tradeoffs.",G=g(),F=f("div"),B=f("label"),A=f("input"),Z=K(`
               Automatically summarize search results`),z=g(),X=f("p"),X.textContent="When enabled, summaries will be generated and shown in search results.",W=g(),Y=f("div"),y=f("label"),E=f("input"),D=K(`
               Enable Chat interface (OpenRouter)`),x=g(),oe&&oe.c(),le=tt(),a(t,"class","label"),a(t,"for",n=`openrouter-api-key-${l[79]}`),a(c,"class","input"),a(c,"id",r=`openrouter-api-key-${l[79]}`),a(c,"type","password"),a(c,"placeholder","sk-or-v1-..."),a(s,"class","control"),a(d,"class","help"),a(e,"class","field"),a(k,"class","label"),a(k,"for",w=`openrouter-model-${l[79]}`),a($,"class","input"),a($,"id",b=`openrouter-model-${l[79]}`),a($,"type","text"),a($,"placeholder","openai/gpt-4-turbo"),a(T,"class","control"),a(J,"class","button is-small"),a(O,"class","help"),a(m,"class","field"),a(A,"id",R=`openrouter-auto-summarize-${l[79]}`),a(A,"type","checkbox"),a(B,"class","checkbox"),a(B,"for",N=`openrouter-auto-summarize-${l[79]}`),a(X,"class","help"),a(F,"class","field"),a(E,"id",I=`openrouter-chat-enabled-${l[79]}`),a(E,"type","checkbox"),a(y,"class","checkbox"),a(y,"for",V=`openrouter-chat-enabled-${l[79]}`),a(Y,"class","field")},m(ae,ge){S(ae,e,ge),i(e,t),i(t,o),i(e,u),i(e,s),i(s,c),Ce(c,l[3].roles[l[79]].openrouter_api_key),i(e,p),i(e,d),S(ae,_,ge),S(ae,m,ge),i(m,k),i(k,v),i(m,h),i(m,T),i(T,$),Ce($,l[3].roles[l[79]].openrouter_model),i(m,U),i(m,J),i(m,M),pe&&pe.m(m,null),i(m,L),i(m,O),S(ae,G,ge),S(ae,F,ge),i(F,B),i(B,A),A.checked=l[3].roles[l[79]].openrouter_auto_summarize,i(B,Z),i(F,z),i(F,X),S(ae,W,ge),S(ae,Y,ge),i(Y,y),i(y,E),E.checked=l[3].roles[l[79]].openrouter_chat_enabled,i(y,D),S(ae,x,ge),oe&&oe.m(ae,ge),S(ae,le,ge),we||(ve=[Q(c,"input",Ue),Q($,"input",_e),Q(J,"click",ce),Q(A,"change",Le),Q(E,"change",$e)],we=!0)},p(ae,ge){var lt;l=ae,ge[0]&264&&n!==(n=`openrouter-api-key-${l[79]}`)&&a(t,"for",n),ge[0]&264&&r!==(r=`openrouter-api-key-${l[79]}`)&&a(c,"id",r),ge[0]&264&&c.value!==l[3].roles[l[79]].openrouter_api_key&&Ce(c,l[3].roles[l[79]].openrouter_api_key),ge[0]&264&&w!==(w=`openrouter-model-${l[79]}`)&&a(k,"for",w),ge[0]&264&&b!==(b=`openrouter-model-${l[79]}`)&&a($,"id",b),ge[0]&264&&$.value!==l[3].roles[l[79]].openrouter_model&&Ce($,l[3].roles[l[79]].openrouter_model),(lt=l[0][l[79]])!=null&&lt.length?pe?pe.p(l,ge):(pe=bn(l),pe.c(),pe.m(m,L)):pe&&(pe.d(1),pe=null),ge[0]&264&&R!==(R=`openrouter-auto-summarize-${l[79]}`)&&a(A,"id",R),ge[0]&264&&(A.checked=l[3].roles[l[79]].openrouter_auto_summarize),ge[0]&264&&N!==(N=`openrouter-auto-summarize-${l[79]}`)&&a(B,"for",N),ge[0]&264&&I!==(I=`openrouter-chat-enabled-${l[79]}`)&&a(E,"id",I),ge[0]&264&&(E.checked=l[3].roles[l[79]].openrouter_chat_enabled),ge[0]&264&&V!==(V=`openrouter-chat-enabled-${l[79]}`)&&a(y,"for",V),l[3].roles[l[79]].openrouter_chat_enabled?oe?oe.p(l,ge):(oe=kn(l),oe.c(),oe.m(le.parentNode,le)):oe&&(oe.d(1),oe=null)},d(ae){ae&&C(e),ae&&C(_),ae&&C(m),pe&&pe.d(),ae&&C(G),ae&&C(F),ae&&C(W),ae&&C(Y),ae&&C(x),oe&&oe.d(ae),ae&&C(le),we=!1,Ge(ve)}}}function bn(l){let e,t,o,n,u=l[0][l[79]],s=[];for(let r=0;r<u.length;r+=1)s[r]=vn(Qo(l,u,r));function c(...r){return l[56](l[79],...r)}return{c(){e=f("div"),t=f("select");for(let r=0;r<s.length;r+=1)s[r].c();a(e,"class","select is-fullwidth"),fe(e,"margin-top","0.5rem")},m(r,p){S(r,e,p),i(e,t);for(let d=0;d<s.length;d+=1)s[d]&&s[d].m(t,null);o||(n=Q(t,"change",c),o=!0)},p(r,p){if(l=r,p[0]&9){u=l[0][l[79]];let d;for(d=0;d<u.length;d+=1){const _=Qo(l,u,d);s[d]?s[d].p(_,p):(s[d]=vn(_),s[d].c(),s[d].m(t,null))}for(;d<s.length;d+=1)s[d].d(1);s.length=u.length}},d(r){r&&C(e),We(s,r),o=!1,n()}}}function vn(l){let e,t=l[80]+"",o,n;return{c(){e=f("option"),o=K(t),e.__value=n=l[80],e.value=e.__value},m(u,s){S(u,e,s),i(e,o)},p(u,s){s[0]&9&&t!==(t=u[80]+"")&&be(o,t),s[0]&265&&n!==(n=u[80])&&(e.__value=n,e.value=e.__value)},d(u){u&&C(e)}}}function kn(l){let e,t,o,n,u,s,c,r,p,d,_,m,k,v,w,h,T,$,b,U,J,M,L,O,G;function F(){l[59].call(r,l[79])}function B(){l[60].call(M,l[79])}return{c(){e=f("div"),t=f("label"),o=K("Chat Model"),u=g(),s=f("div"),c=f("div"),r=f("select"),p=f("option"),p.textContent="GPT-3.5 Turbo",d=f("option"),d.textContent="GPT-4",_=f("option"),_.textContent="Claude 3 Sonnet",m=f("option"),m.textContent="Claude 3 Haiku",k=f("option"),k.textContent="Mixtral 8x7B",w=g(),h=f("div"),T=f("label"),$=K("System Prompt (optional)"),U=g(),J=f("div"),M=f("textarea"),a(t,"class","label"),a(t,"for",n=`openrouter-chat-model-${l[79]}`),p.__value="openai/gpt-3.5-turbo",p.value=p.__value,d.__value="openai/gpt-4",d.value=d.__value,_.__value="anthropic/claude-3-sonnet",_.value=_.__value,m.__value="anthropic/claude-3-haiku",m.value=m.__value,k.__value="mistralai/mixtral-8x7b-instruct",k.value=k.__value,a(r,"id",v=`openrouter-chat-model-${l[79]}`),l[3].roles[l[79]].openrouter_chat_model===void 0&&ut(F),a(c,"class","select is-fullwidth"),a(s,"class","control"),a(e,"class","field"),a(T,"class","label"),a(T,"for",b=`openrouter-chat-system-${l[79]}`),a(M,"class","textarea"),a(M,"id",L=`openrouter-chat-system-${l[79]}`),a(M,"rows","3"),a(M,"placeholder","You are a helpful Rust engineer assistant..."),a(J,"class","control"),a(h,"class","field")},m(A,R){S(A,e,R),i(e,t),i(t,o),i(e,u),i(e,s),i(s,c),i(c,r),i(r,p),i(r,d),i(r,_),i(r,m),i(r,k),Pe(r,l[3].roles[l[79]].openrouter_chat_model,!0),S(A,w,R),S(A,h,R),i(h,T),i(T,$),i(h,U),i(h,J),i(J,M),Ce(M,l[3].roles[l[79]].openrouter_chat_system_prompt),O||(G=[Q(r,"change",F),Q(M,"input",B)],O=!0)},p(A,R){l=A,R[0]&264&&n!==(n=`openrouter-chat-model-${l[79]}`)&&a(t,"for",n),R[0]&264&&v!==(v=`openrouter-chat-model-${l[79]}`)&&a(r,"id",v),R[0]&264&&Pe(r,l[3].roles[l[79]].openrouter_chat_model),R[0]&264&&b!==(b=`openrouter-chat-system-${l[79]}`)&&a(T,"for",b),R[0]&264&&L!==(L=`openrouter-chat-system-${l[79]}`)&&a(M,"id",L),R[0]&264&&Ce(M,l[3].roles[l[79]].openrouter_chat_system_prompt)},d(A){A&&C(e),A&&C(w),A&&C(h),O=!1,Ge(G)}}}function wn(l){let e;return{c(){e=f("p"),e.textContent="Click to select directory",a(e,"class","help")},m(t,o){S(t,e,o)},d(t){t&&C(e)}}}function $n(l,e){let t,o,n,u,s,c,r,p,d,_,m,k,v,w,h,T,$,b,U,J,M,L,O,G,F,B,A,R,Z,N,z,X,W,Y,y,E,I,D,V,x,le,we,ve,Ue,_e,ce,pe,Le,$e,oe,me,ae,ge,lt,Te,Ae,te,ke,Ie,ot,pt,Ne,nt,He,_t,wt,Dt,Ut,It,Et,st,qt,P,ee,j,ne,de,ue,je,Ke,Ee,ze,Ye,mt,At,Lt,sl,jt,rl,zt,Ze,bt,Il,Jt,Vt,jl,cl,zl,Ht,Qe,fl,Hl,Fl,pl,Yt,Zt,Wl,dl,Gl,_l,$t,Qt,Xt,ml,Kl,xt,Pt,Nt,hl,Bl,gl,ql,Ft,Ot,bl,Jl,vl,Vl,Yl,Zl,Wt,Ql,kl,Rl,Xl;function Kn(){e[26].call(p,e[79])}function Bn(){e[27].call($,e[79])}let el=e[8],Xe=[];for(let Oe=0;Oe<el.length;Oe+=1)Xe[Oe]=an(tn(e,el,Oe));function xl(){e[28].call(A,e[79])}function qn(){e[29].call(E,e[79])}function Jn(){e[30].call(le,e[79])}let tl=e[77].haystacks,xe=[];for(let Oe=0;Oe<tl.length;Oe+=1)xe[Oe]=dn(xo(e,tl,Oe));function Vn(){return e[45](e[79])}function eo(){e[46].call(Ne,e[79])}let rt=e[3].roles[e[79]].llm_provider==="ollama"&&_n(e);function Yn(){e[52].call(j,e[79])}let it=e[3].roles[e[79]].openrouter_enabled&&gn(e);function Zn(){e[61].call(Ze,e[79])}function Qn(){e[62].call(Qe,e[79])}function to(){return e[63](e[79])}let dt=e[4]&&wn();function lo(){e[64].call($t,e[79])}function Xn(){e[65].call(Nt,e[79])}function xn(){e[66].call(Ot,e[79])}function es(){return e[67](e[79])}return{key:l,first:null,c(){t=f("div"),o=f("div"),n=f("label"),u=K("Role name"),c=g(),r=f("div"),p=f("input"),_=g(),m=f("div"),k=f("label"),v=K("Short name"),h=g(),T=f("div"),$=f("input"),U=g(),J=f("div"),M=f("label"),L=K("Theme"),G=g(),F=f("div"),B=f("div"),A=f("select");for(let Oe=0;Oe<Xe.length;Oe+=1)Xe[Oe].c();Z=g(),N=f("div"),z=f("label"),X=K("Relevance function"),Y=g(),y=f("div"),E=f("input"),D=g(),V=f("div"),x=f("label"),le=f("input"),ve=K(`
            Enable Terraphim IT features (KG preprocessing, auto-linking)`),_e=g(),ce=f("h5"),ce.textContent="Haystacks",pe=g();for(let Oe=0;Oe<xe.length;Oe+=1)xe[Oe].c();Le=g(),$e=f("button"),oe=K("Add Haystack"),ae=g(),ge=f("h5"),ge.textContent="AI-Enhanced Summaries (LLM Provider)",lt=g(),Te=f("div"),Ae=f("label"),te=K("Provider"),Ie=g(),ot=f("div"),pt=f("div"),Ne=f("select"),nt=f("option"),nt.textContent="(none)",He=f("option"),He.textContent="OpenRouter",_t=f("option"),_t.textContent="Ollama (local)",Dt=g(),Ut=f("p"),Ut.textContent="Choose a provider. OpenRouter uses API key; Ollama runs locally.",It=g(),rt&&rt.c(),Et=g(),st=f("h5"),st.textContent="AI-Enhanced Summaries (OpenRouter)",qt=g(),P=f("div"),ee=f("label"),j=f("input"),de=K(`
             Enable AI-generated article summaries`),je=g(),Ke=f("p"),Ke.textContent="Generate intelligent summaries using OpenRouter's language models",Ee=g(),it&&it.c(),ze=g(),Ye=f("h5"),Ye.textContent="Knowledge Graph",mt=g(),At=f("div"),Lt=f("label"),sl=K("Remote automata URL"),rl=g(),zt=f("div"),Ze=f("input"),Il=g(),Jt=f("div"),Vt=f("label"),jl=K("Local KG path"),zl=g(),Ht=f("div"),Qe=f("input"),Hl=g(),dt&&dt.c(),Fl=g(),pl=f("div"),Yt=f("div"),Zt=f("label"),Wl=K("Local KG type"),Gl=g(),_l=f("div"),$t=f("select"),Qt=f("option"),Qt.textContent="markdown",Xt=f("option"),Xt.textContent="json",Kl=g(),xt=f("div"),Pt=f("label"),Nt=f("input"),Bl=K(`
             Public`),ql=g(),Ft=f("label"),Ot=f("input"),Jl=K(`
             Publish`),Vl=g(),Yl=f("hr"),Zl=g(),Wt=f("button"),Ql=K("Remove Role"),a(n,"class","label"),a(n,"for",s=`role-name-${e[79]}`),a(p,"class","input"),a(p,"id",d=`role-name-${e[79]}`),a(p,"type","text"),a(r,"class","control"),a(o,"class","field"),a(k,"class","label"),a(k,"for",w=`role-shortname-${e[79]}`),a($,"class","input"),a($,"id",b=`role-shortname-${e[79]}`),a($,"type","text"),a(T,"class","control"),a(m,"class","field"),a(M,"class","label"),a(M,"for",O=`role-theme-${e[79]}`),a(A,"id",R=`role-theme-${e[79]}`),e[3].roles[e[79]].theme===void 0&&ut(xl),a(B,"class","select is-fullwidth"),a(F,"class","control"),a(J,"class","field"),a(z,"class","label"),a(z,"for",W=`role-relevance-${e[79]}`),a(E,"class","input"),a(E,"id",I=`role-relevance-${e[79]}`),a(E,"type","text"),a(y,"class","control"),a(N,"class","field"),a(le,"class","checkbox"),a(le,"id",we=`role-terraphim-it-${e[79]}`),a(le,"type","checkbox"),a(x,"class","label"),a(x,"for",Ue=`role-terraphim-it-${e[79]}`),a(V,"class","field"),a(ce,"class","title is-6"),a($e,"class","button is-small"),a($e,"data-testid",me="add-haystack-"+e[79]),a(ge,"class","title is-6"),a(Ae,"class","label"),a(Ae,"for",ke=`llm-provider-${e[79]}`),nt.__value="",nt.value=nt.__value,He.__value="openrouter",He.value=He.__value,_t.__value="ollama",_t.value=_t.__value,a(Ne,"id",wt=`llm-provider-${e[79]}`),e[3].roles[e[79]].llm_provider===void 0&&ut(eo),a(pt,"class","select"),a(ot,"class","control"),a(Ut,"class","help"),a(Te,"class","field"),a(st,"class","title is-6"),a(j,"id",ne=`openrouter-enabled-${e[79]}`),a(j,"type","checkbox"),a(ee,"class","checkbox"),a(ee,"for",ue=`openrouter-enabled-${e[79]}`),a(Ke,"class","help"),a(P,"class","field"),a(Ye,"class","title is-6"),a(Lt,"class","label"),a(Lt,"for",jt=`kg-url-${e[79]}`),a(Ze,"class","input"),a(Ze,"id",bt=`kg-url-${e[79]}`),a(Ze,"type","text"),a(Ze,"placeholder","https://example.com/thesaurus.json"),a(zt,"class","control"),a(At,"class","field"),a(Vt,"class","label"),a(Vt,"for",cl=`kg-local-path-${e[79]}`),a(Qe,"class","input"),a(Qe,"id",fl=`kg-local-path-${e[79]}`),a(Qe,"type","text"),a(Qe,"placeholder","/path/to/markdown"),Qe.readOnly=e[4],a(Ht,"class","control"),a(Jt,"class","field"),a(Zt,"class","label"),a(Zt,"for",dl=`kg-local-type-${e[79]}`),Qt.__value="markdown",Qt.value=Qt.__value,Xt.__value="json",Xt.value=Xt.__value,a($t,"id",ml=`kg-local-type-${e[79]}`),e[3].roles[e[79]].kg.local_type===void 0&&ut(lo),a(_l,"class","select"),a(Yt,"class","control"),a(pl,"class","field is-grouped"),a(Nt,"id",hl=`kg-public-${e[79]}`),a(Nt,"type","checkbox"),a(Pt,"class","checkbox"),a(Pt,"for",gl=`kg-public-${e[79]}`),fe(Pt,"margin-right","1rem"),a(Ot,"id",bl=`kg-publish-${e[79]}`),a(Ot,"type","checkbox"),a(Ft,"class","checkbox"),a(Ft,"for",vl=`kg-publish-${e[79]}`),a(xt,"class","field is-grouped"),a(Wt,"class","button is-small is-danger"),a(Wt,"data-testid",kl="remove-role-"+e[79]),a(t,"class","box"),this.first=t},m(Oe,he){S(Oe,t,he),i(t,o),i(o,n),i(n,u),i(o,c),i(o,r),i(r,p),Ce(p,e[3].roles[e[79]].name),i(t,_),i(t,m),i(m,k),i(k,v),i(m,h),i(m,T),i(T,$),Ce($,e[3].roles[e[79]].shortname),i(t,U),i(t,J),i(J,M),i(M,L),i(J,G),i(J,F),i(F,B),i(B,A);for(let ye=0;ye<Xe.length;ye+=1)Xe[ye]&&Xe[ye].m(A,null);Pe(A,e[3].roles[e[79]].theme,!0),i(t,Z),i(t,N),i(N,z),i(z,X),i(N,Y),i(N,y),i(y,E),Ce(E,e[3].roles[e[79]].relevance_function),i(t,D),i(t,V),i(V,x),i(x,le),le.checked=e[3].roles[e[79]].terraphim_it,i(x,ve),i(t,_e),i(t,ce),i(t,pe);for(let ye=0;ye<xe.length;ye+=1)xe[ye]&&xe[ye].m(t,null);i(t,Le),i(t,$e),i($e,oe),i(t,ae),i(t,ge),i(t,lt),i(t,Te),i(Te,Ae),i(Ae,te),i(Te,Ie),i(Te,ot),i(ot,pt),i(pt,Ne),i(Ne,nt),i(Ne,He),i(Ne,_t),Pe(Ne,e[3].roles[e[79]].llm_provider,!0),i(Te,Dt),i(Te,Ut),i(t,It),rt&&rt.m(t,null),i(t,Et),i(t,st),i(t,qt),i(t,P),i(P,ee),i(ee,j),j.checked=e[3].roles[e[79]].openrouter_enabled,i(ee,de),i(P,je),i(P,Ke),i(t,Ee),it&&it.m(t,null),i(t,ze),i(t,Ye),i(t,mt),i(t,At),i(At,Lt),i(Lt,sl),i(At,rl),i(At,zt),i(zt,Ze),Ce(Ze,e[3].roles[e[79]].kg.url),i(t,Il),i(t,Jt),i(Jt,Vt),i(Vt,jl),i(Jt,zl),i(Jt,Ht),i(Ht,Qe),Ce(Qe,e[3].roles[e[79]].kg.local_path),i(Ht,Hl),dt&&dt.m(Ht,null),i(t,Fl),i(t,pl),i(pl,Yt),i(Yt,Zt),i(Zt,Wl),i(Yt,Gl),i(Yt,_l),i(_l,$t),i($t,Qt),i($t,Xt),Pe($t,e[3].roles[e[79]].kg.local_type,!0),i(t,Kl),i(t,xt),i(xt,Pt),i(Pt,Nt),Nt.checked=e[3].roles[e[79]].kg.public,i(Pt,Bl),i(xt,ql),i(xt,Ft),i(Ft,Ot),Ot.checked=e[3].roles[e[79]].kg.publish,i(Ft,Jl),i(t,Vl),i(t,Yl),i(t,Zl),i(t,Wt),i(Wt,Ql),Rl||(Xl=[Q(p,"input",Kn),Q($,"input",Bn),Q(A,"change",xl),Q(E,"input",qn),Q(le,"change",Jn),Q($e,"click",Vn),Q(Ne,"change",eo),Q(j,"change",Yn),Q(Ze,"input",Zn),Q(Qe,"input",Qn),Q(Qe,"click",function(){Pl(e[4]?to:void 0)&&(e[4]?to:void 0).apply(this,arguments)}),Q($t,"change",lo),Q(Nt,"change",Xn),Q(Ot,"change",xn),Q(Wt,"click",es)],Rl=!0)},p(Oe,he){if(e=Oe,he[0]&264&&s!==(s=`role-name-${e[79]}`)&&a(n,"for",s),he[0]&264&&d!==(d=`role-name-${e[79]}`)&&a(p,"id",d),he[0]&264&&p.value!==e[3].roles[e[79]].name&&Ce(p,e[3].roles[e[79]].name),he[0]&264&&w!==(w=`role-shortname-${e[79]}`)&&a(k,"for",w),he[0]&264&&b!==(b=`role-shortname-${e[79]}`)&&a($,"id",b),he[0]&264&&$.value!==e[3].roles[e[79]].shortname&&Ce($,e[3].roles[e[79]].shortname),he[0]&264&&O!==(O=`role-theme-${e[79]}`)&&a(M,"for",O),he[0]&256){el=e[8];let ye;for(ye=0;ye<el.length;ye+=1){const il=tn(e,el,ye);Xe[ye]?Xe[ye].p(il,he):(Xe[ye]=an(il),Xe[ye].c(),Xe[ye].m(A,null))}for(;ye<Xe.length;ye+=1)Xe[ye].d(1);Xe.length=el.length}if(he[0]&264&&R!==(R=`role-theme-${e[79]}`)&&a(A,"id",R),he[0]&264&&Pe(A,e[3].roles[e[79]].theme),he[0]&264&&W!==(W=`role-relevance-${e[79]}`)&&a(z,"for",W),he[0]&264&&I!==(I=`role-relevance-${e[79]}`)&&a(E,"id",I),he[0]&264&&E.value!==e[3].roles[e[79]].relevance_function&&Ce(E,e[3].roles[e[79]].relevance_function),he[0]&264&&we!==(we=`role-terraphim-it-${e[79]}`)&&a(le,"id",we),he[0]&264&&(le.checked=e[3].roles[e[79]].terraphim_it),he[0]&264&&Ue!==(Ue=`role-terraphim-it-${e[79]}`)&&a(x,"for",Ue),he[0]&491576){tl=e[77].haystacks;let ye;for(ye=0;ye<tl.length;ye+=1){const il=xo(e,tl,ye);xe[ye]?xe[ye].p(il,he):(xe[ye]=dn(il),xe[ye].c(),xe[ye].m(t,Le))}for(;ye<xe.length;ye+=1)xe[ye].d(1);xe.length=tl.length}he[0]&264&&me!==(me="add-haystack-"+e[79])&&a($e,"data-testid",me),he[0]&264&&ke!==(ke=`llm-provider-${e[79]}`)&&a(Ae,"for",ke),he[0]&264&&wt!==(wt=`llm-provider-${e[79]}`)&&a(Ne,"id",wt),he[0]&264&&Pe(Ne,e[3].roles[e[79]].llm_provider),e[3].roles[e[79]].llm_provider==="ollama"?rt?rt.p(e,he):(rt=_n(e),rt.c(),rt.m(t,Et)):rt&&(rt.d(1),rt=null),he[0]&264&&ne!==(ne=`openrouter-enabled-${e[79]}`)&&a(j,"id",ne),he[0]&264&&(j.checked=e[3].roles[e[79]].openrouter_enabled),he[0]&264&&ue!==(ue=`openrouter-enabled-${e[79]}`)&&a(ee,"for",ue),e[3].roles[e[79]].openrouter_enabled?it?it.p(e,he):(it=gn(e),it.c(),it.m(t,ze)):it&&(it.d(1),it=null),he[0]&264&&jt!==(jt=`kg-url-${e[79]}`)&&a(Lt,"for",jt),he[0]&264&&bt!==(bt=`kg-url-${e[79]}`)&&a(Ze,"id",bt),he[0]&264&&Ze.value!==e[3].roles[e[79]].kg.url&&Ce(Ze,e[3].roles[e[79]].kg.url),he[0]&264&&cl!==(cl=`kg-local-path-${e[79]}`)&&a(Vt,"for",cl),he[0]&264&&fl!==(fl=`kg-local-path-${e[79]}`)&&a(Qe,"id",fl),he[0]&16&&(Qe.readOnly=e[4]),he[0]&264&&Qe.value!==e[3].roles[e[79]].kg.local_path&&Ce(Qe,e[3].roles[e[79]].kg.local_path),e[4]?dt||(dt=wn(),dt.c(),dt.m(Ht,null)):dt&&(dt.d(1),dt=null),he[0]&264&&dl!==(dl=`kg-local-type-${e[79]}`)&&a(Zt,"for",dl),he[0]&264&&ml!==(ml=`kg-local-type-${e[79]}`)&&a($t,"id",ml),he[0]&264&&Pe($t,e[3].roles[e[79]].kg.local_type),he[0]&264&&hl!==(hl=`kg-public-${e[79]}`)&&a(Nt,"id",hl),he[0]&264&&(Nt.checked=e[3].roles[e[79]].kg.public),he[0]&264&&gl!==(gl=`kg-public-${e[79]}`)&&a(Pt,"for",gl),he[0]&264&&bl!==(bl=`kg-publish-${e[79]}`)&&a(Ot,"id",bl),he[0]&264&&(Ot.checked=e[3].roles[e[79]].kg.publish),he[0]&264&&vl!==(vl=`kg-publish-${e[79]}`)&&a(Ft,"for",vl),he[0]&264&&kl!==(kl="remove-role-"+e[79])&&a(Wt,"data-testid",kl)},d(Oe){Oe&&C(t),We(Xe,Oe),We(xe,Oe),rt&&rt.d(),it&&it.d(),dt&&dt.d(),Rl=!1,Ge(Xl)}}}function yn(l){let e,t=l[74]+"",o;return{c(){e=f("option"),o=K(t),e.__value=l[74],e.value=e.__value},m(n,u){S(n,e,u),i(e,o)},p:Se,d(n){n&&C(e)}}}function Cn(l){let e,t=l[71].name+"",o,n;return{c(){e=f("option"),o=K(t),e.__value=n=l[71].name,e.value=e.__value},m(u,s){S(u,e,s),i(e,o)},p(u,s){s[0]&8&&t!==(t=u[71].name+"")&&be(o,t),s[0]&264&&n!==(n=u[71].name)&&(e.__value=n,e.value=e.__value)},d(u){u&&C(e)}}}function Sn(l){let e,t,o;return{c(){e=f("button"),e.textContent="Back",a(e,"class","button"),a(e,"data-testid","wizard-back")},m(n,u){S(n,e,u),t||(o=Q(e,"click",l[11]),t=!0)},p:Se,d(n){n&&C(e),t=!1,o()}}}function ri(l){let e,t,o;return{c(){e=f("button"),e.textContent="Save",a(e,"class","button is-success"),a(e,"data-testid","wizard-save")},m(n,u){S(n,e,u),t||(o=Q(e,"click",l[19]),t=!0)},p:Se,d(n){n&&C(e),t=!1,o()}}}function ii(l){let e,t,o;return{c(){e=f("button"),e.textContent="Next",a(e,"class","button is-primary"),a(e,"data-testid","wizard-next")},m(n,u){S(n,e,u),t||(o=Q(e,"click",l[10]),t=!0)},p:Se,d(n){n&&C(e),t=!1,o()}}}function ai(l){let e,t,o,n,u,s,c,r,p,d,_,m,k,v,w,h,T,$;e=new nl({props:{fallbackPath:"/"}});let b=l[2]==="success"&&nn(l),U=l[2]==="error"&&sn(l);function J(A,R){return A[1]===1?oi:A[1]===2?li:ti}let M=J(l),L=M(l),O=l[1]>1&&Sn(l);function G(A,R){return A[1]<Gn?ii:ri}let F=G(l),B=F(l);return{c(){se(e.$$.fragment),t=g(),o=f("div"),n=f("div"),u=f("h3"),u.textContent="Configuration Wizard",s=g(),c=f("button"),c.textContent="Close",r=g(),b&&b.c(),p=g(),U&&U.c(),d=g(),L.c(),_=g(),m=f("nav"),k=f("div"),O&&O.c(),v=g(),w=f("div"),B.c(),a(u,"class","title is-4"),fe(u,"margin-bottom","0"),a(c,"class","button is-small is-light"),a(c,"aria-label","Close configuration wizard"),a(n,"class","is-flex is-justify-content-space-between is-align-items-center"),fe(n,"gap",".5rem"),a(k,"class","level-left"),a(w,"class","level-right"),a(m,"class","level"),a(o,"class","box")},m(A,R){re(e,A,R),S(A,t,R),S(A,o,R),i(o,n),i(n,u),i(n,s),i(n,c),i(o,r),b&&b.m(o,null),i(o,p),U&&U.m(o,null),i(o,d),L.m(o,null),i(o,_),i(o,m),i(m,k),O&&O.m(k,null),i(m,v),i(m,w),B.m(w,null),h=!0,T||($=Q(c,"click",ui),T=!0)},p(A,R){A[2]==="success"?b?b.p(A,R):(b=nn(A),b.c(),b.m(o,p)):b&&(b.d(1),b=null),A[2]==="error"?U?U.p(A,R):(U=sn(A),U.c(),U.m(o,d)):U&&(U.d(1),U=null),M===(M=J(A))&&L?L.p(A,R):(L.d(1),L=M(A),L&&(L.c(),L.m(o,_))),A[1]>1?O?O.p(A,R):(O=Sn(A),O.c(),O.m(k,null)):O&&(O.d(1),O=null),F===(F=G(A))&&B?B.p(A,R):(B.d(1),B=F(A),B&&(B.c(),B.m(w,null)))},i(A){h||(H(e.$$.fragment,A),h=!0)},o(A){q(e.$$.fragment,A),h=!1},d(A){ie(e,A),A&&C(t),A&&C(o),b&&b.d(),U&&U.d(),L.d(),O&&O.d(),B.d(),T=!1,$()}}}const Gn=3;function ui(){typeof window<"u"&&window.history.back()}function ci(l,e,t){let o,n;Re(l,Be,P=>t(4,n=P));const u=kt(null);async function s(P,ee){if(vt(Be))try{const j=await Vo({directory:!0,multiple:!1});j&&typeof j=="string"&&r.update(ne=>(ne.roles[P].haystacks[ee].path=j,ne))}catch(j){console.error("Failed to open folder selector:",j)}}async function c(P){if(vt(Be))try{const ee=await Vo({directory:!0,multiple:!1});ee&&typeof ee=="string"&&r.update(j=>(j.roles[P].kg.local_path=ee,j))}catch(ee){console.error("Failed to open folder selector:",ee)}}const r=kt({id:"Desktop",global_shortcut:"Ctrl+X",default_theme:"spacelab",default_role:"Default",roles:[]});Re(l,r,P=>t(3,o=P));const p=["default","darkly","cerulean","cosmo","cyborg","flatly","journal","litera","lumen","lux","materia","minty","nuclear","pulse","sandstone","simplex","slate","solar","spacelab","superhero","united","yeti"];Kt(async()=>{try{let P;vt(Be)?P=await qe("get_config_schema"):P=await(await fetch("/config/schema")).json(),u.set(P);const ee=vt(gt);ee&&ee.id&&r.update(j=>{var ne;return{...j,id:ee.id,global_shortcut:ee.global_shortcut,default_theme:((ne=ee.roles[ee.default_role])==null?void 0:ne.theme)??"spacelab",default_role:ee.default_role,roles:Object.values(ee.roles).map(de=>{var Ee,ze,Ye,mt,At,Lt,sl,jt,rl,zt,Ze;const ue=(Ee=de.kg)==null?void 0:Ee.automata_path,je=(ue==null?void 0:ue.Remote)??"",Ke=((Ye=(ze=de.kg)==null?void 0:ze.knowledge_graph_local)==null?void 0:Ye.path)??"";return{name:de.name,shortname:de.shortname,relevance_function:de.relevance_function,terraphim_it:de.terraphim_it??!1,theme:de.theme,haystacks:(de.haystacks??[]).map(bt=>({path:bt.location||bt.path||"",read_only:bt.read_only??!1,service:bt.service||"Ripgrep",atomic_server_secret:bt.atomic_server_secret||"",extra_parameters:bt.extra_parameters||{}})),kg:{url:je,local_path:Ke,local_type:((At=(mt=de.kg)==null?void 0:mt.knowledge_graph_local)==null?void 0:At.input_type)??"markdown",public:((Lt=de.kg)==null?void 0:Lt.public)??!1,publish:((sl=de.kg)==null?void 0:sl.publish)??!1},openrouter_enabled:de.openrouter_enabled??!1,openrouter_api_key:de.openrouter_api_key??"",openrouter_model:de.openrouter_model??"openai/gpt-3.5-turbo",openrouter_auto_summarize:de.openrouter_auto_summarize??!1,openrouter_chat_enabled:de.openrouter_chat_enabled??!1,openrouter_chat_model:de.openrouter_chat_model??de.openrouter_model??"openai/gpt-3.5-turbo",openrouter_chat_system_prompt:de.openrouter_chat_system_prompt??"",llm_provider:((jt=de.extra)==null?void 0:jt.llm_provider)??"",llm_model:((rl=de.extra)==null?void 0:rl.llm_model)??"",llm_base_url:((zt=de.extra)==null?void 0:zt.llm_base_url)??"",llm_auto_summarize:((Ze=de.extra)==null?void 0:Ze.llm_auto_summarize)??!1}})}})}catch(P){console.error("Failed to load schema",P)}}),Kt(()=>{const P=ee=>{ee.key==="Escape"&&typeof window<"u"&&window.history.back()};return window.addEventListener("keydown",P),()=>window.removeEventListener("keydown",P)});let d={};async function _(P){var ue;const j=vt(r).roles[P],ne=j.llm_provider||(j.openrouter_enabled?"openrouter":""),de=[];try{if(ne==="ollama"){const je=(j.llm_base_url||"http://127.0.0.1:11434").replace(/\/$/,""),Ee=await(await fetch(`${je}/api/tags`)).json();if(Array.isArray(Ee==null?void 0:Ee.models))for(const ze of Ee.models)ze!=null&&ze.name&&de.push(ze.name)}else if(ne==="openrouter"){const je=(ue=j.openrouter_api_key)==null?void 0:ue.trim();if(!je)throw new Error("OpenRouter API key required");const Ee=await(await fetch("https://openrouter.ai/api/v1/models",{headers:{Authorization:`Bearer ${je}`,"HTTP-Referer":"https://terraphim.ai","X-Title":"Terraphim Desktop"}})).json(),ze=Array.isArray(Ee==null?void 0:Ee.data)?Ee.data:[];for(const Ye of ze)Ye!=null&&Ye.id&&de.push(Ye.id)}}catch(je){console.error("Failed to fetch models",je)}t(0,d={...d,[P]:de})}let m=1,k="";function v(){m<Gn&&t(1,m+=1)}function w(){m>1&&t(1,m-=1)}function h(){r.update(P=>({...P,roles:[...P.roles,{name:"New Role",shortname:"new",relevance_function:"title-scorer",terraphim_it:!1,theme:"spacelab",haystacks:[],kg:{url:"",local_path:"",local_type:"markdown",public:!1,publish:!1},openrouter_enabled:!1,openrouter_api_key:"",openrouter_model:"openai/gpt-3.5-turbo",openrouter_auto_summarize:!1,openrouter_chat_enabled:!1,openrouter_chat_model:"openai/gpt-3.5-turbo",openrouter_chat_system_prompt:"",llm_provider:"",llm_model:"",llm_base_url:"",llm_auto_summarize:!1}]}))}function T(P){r.update(ee=>({...ee,roles:ee.roles.filter((j,ne)=>ne!==P)}))}function $(P){r.update(ee=>(ee.roles[P].haystacks.push({path:"",read_only:!1,service:"Ripgrep",atomic_server_secret:"",extra_parameters:{}}),ee))}function b(P,ee){r.update(j=>(j.roles[P].haystacks=j.roles[P].haystacks.filter((ne,de)=>de!==ee),j))}function U(P,ee,j="",ne=""){r.update(de=>{de.roles[P].haystacks[ee].extra_parameters||(de.roles[P].haystacks[ee].extra_parameters={});const ue=j||`param_${Date.now()}`;return de.roles[P].haystacks[ee].extra_parameters[ue]=ne,de})}function J(P,ee,j){r.update(ne=>(delete ne.roles[P].haystacks[ee].extra_parameters[j],ne))}function M(P,ee,j,ne){r.update(de=>{const ue=de.roles[P].haystacks[ee].extra_parameters;return ue[j]!==void 0&&j!==ne&&(ue[ne]=ue[j],delete ue[j]),de})}function L(P,ee,j,ne){const de=ne.target.value;M(P,ee,j,de)}async function O(){var de;const P=vt(r),ee=vt(gt);let j={...ee};j.id=P.id,j.global_shortcut=P.global_shortcut,j.default_role=P.default_role;const ne={};P.roles.forEach(ue=>{var ze,Ye;const je=ue.name,Ke=je.replace(/^"|"$/g,"");ne[Ke]={extra:((Ye=(ze=ee.roles)==null?void 0:ze[je])==null?void 0:Ye.extra)??{},name:ue.name,shortname:ue.shortname,theme:ue.theme,relevance_function:ue.relevance_function,terraphim_it:ue.terraphim_it??!1,haystacks:ue.haystacks.map(mt=>({location:mt.path,service:mt.service,read_only:mt.read_only,atomic_server_secret:mt.service==="Atomic"?mt.atomic_server_secret:void 0,extra_parameters:mt.extra_parameters||{}})),kg:ue.kg.url||ue.kg.local_path?{automata_path:ue.kg.url?{Remote:ue.kg.url}:null,knowledge_graph_local:ue.kg.local_path?{input_type:ue.kg.local_type,path:ue.kg.local_path}:null,public:ue.kg.public,publish:ue.kg.publish}:null,...ue.openrouter_enabled&&{openrouter_enabled:ue.openrouter_enabled,openrouter_api_key:ue.openrouter_api_key,openrouter_model:ue.openrouter_model,openrouter_auto_summarize:ue.openrouter_auto_summarize??!1,openrouter_chat_enabled:ue.openrouter_chat_enabled??!1,openrouter_chat_model:ue.openrouter_chat_model??ue.openrouter_model,openrouter_chat_system_prompt:ue.openrouter_chat_system_prompt??""}};const Ee={};ue.llm_provider&&(Ee.llm_provider=ue.llm_provider),ue.llm_model&&(Ee.llm_model=ue.llm_model),ue.llm_base_url&&(Ee.llm_base_url=ue.llm_base_url),typeof ue.llm_auto_summarize=="boolean"&&(Ee.llm_auto_summarize=ue.llm_auto_summarize),ne[Ke].extra={...ne[Ke].extra||{},...Ee}}),j.roles=ne,(!j.default_role||!ne[j.default_role])&&(j.default_role=((de=P.roles[0])==null?void 0:de.name)??"Default"),j.selected_role=j.default_role;try{if(vt(Be))await qe("update_config",{configNew:j});else{const ue=await fetch("/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(j)});if(!ue.ok)throw new Error(`HTTP ${ue.status}: ${ue.statusText}`)}gt.set(j),t(2,k="success"),setTimeout(()=>{t(2,k="")},3e3)}catch(ue){console.error(ue),t(2,k="error"),setTimeout(()=>{t(2,k="")},3e3)}}const G=()=>t(2,k=""),F=()=>t(2,k="");function B(){o.id=yt(this),r.set(o),t(8,p)}function A(){o.global_shortcut=this.value,r.set(o),t(8,p)}function R(){o.default_theme=yt(this),r.set(o),t(8,p)}function Z(){o.default_role=yt(this),r.set(o),t(8,p)}function N(P){o.roles[P].name=this.value,r.set(o),t(8,p)}function z(P){o.roles[P].shortname=this.value,r.set(o),t(8,p)}function X(P){o.roles[P].theme=yt(this),r.set(o),t(8,p)}function W(P){o.roles[P].relevance_function=this.value,r.set(o),t(8,p)}function Y(P){o.roles[P].terraphim_it=this.checked,r.set(o),t(8,p)}function y(P,ee){o.roles[P].haystacks[ee].service=yt(this),r.set(o),t(8,p)}function E(P,ee){o.roles[P].haystacks[ee].path=this.value,r.set(o),t(8,p)}const I=(P,ee)=>s(P,ee);function D(P,ee){o.roles[P].haystacks[ee].atomic_server_secret=this.value,r.set(o),t(8,p)}function V(P,ee){o.roles[P].haystacks[ee].extra_parameters.tag=this.value,r.set(o),t(8,p)}const x=(P,ee,j)=>{const ne=j.currentTarget.value;ne&&$l(r,o.roles[P].haystacks[ee].extra_parameters.tag=ne,o)},le=(P,ee,j,ne)=>L(P,ee,j,ne);function we(P,ee,j){o.roles[P].haystacks[ee].extra_parameters[j]=this.value,r.set(o),t(8,p)}const ve=(P,ee,j)=>J(P,ee,j),Ue=(P,ee)=>U(P,ee,"tag","#rust"),_e=(P,ee)=>U(P,ee,"max_count","10"),ce=(P,ee)=>U(P,ee,"","");function pe(P,ee){o.roles[P].haystacks[ee].read_only=this.checked,r.set(o),t(8,p)}const Le=(P,ee)=>b(P,ee),$e=P=>$(P);function oe(P){o.roles[P].llm_provider=yt(this),r.set(o),t(8,p)}function me(P){o.roles[P].llm_model=this.value,r.set(o),t(8,p)}const ae=P=>_(P),ge=(P,ee)=>{$l(r,o.roles[P].llm_model=ee.currentTarget.value,o)};function lt(P){o.roles[P].llm_base_url=this.value,r.set(o),t(8,p)}function Te(P){o.roles[P].llm_auto_summarize=this.checked,r.set(o),t(8,p)}function Ae(P){o.roles[P].openrouter_enabled=this.checked,r.set(o),t(8,p)}function te(P){o.roles[P].openrouter_api_key=this.value,r.set(o),t(8,p)}function ke(P){o.roles[P].openrouter_model=this.value,r.set(o),t(8,p)}const Ie=P=>_(P),ot=(P,ee)=>{$l(r,o.roles[P].openrouter_model=ee.currentTarget.value,o)};function pt(P){o.roles[P].openrouter_auto_summarize=this.checked,r.set(o),t(8,p)}function Ne(P){o.roles[P].openrouter_chat_enabled=this.checked,r.set(o),t(8,p)}function nt(P){o.roles[P].openrouter_chat_model=yt(this),r.set(o),t(8,p)}function He(P){o.roles[P].openrouter_chat_system_prompt=this.value,r.set(o),t(8,p)}function _t(P){o.roles[P].kg.url=this.value,r.set(o),t(8,p)}function wt(P){o.roles[P].kg.local_path=this.value,r.set(o),t(8,p)}const Dt=P=>c(P);function Ut(P){o.roles[P].kg.local_type=yt(this),r.set(o),t(8,p)}function It(P){o.roles[P].kg.public=this.checked,r.set(o),t(8,p)}function Et(P){o.roles[P].kg.publish=this.checked,r.set(o),t(8,p)}return[d,m,k,o,n,s,c,r,p,_,v,w,h,T,$,b,U,J,L,O,G,F,B,A,R,Z,N,z,X,W,Y,y,E,I,D,V,x,le,we,ve,Ue,_e,ce,pe,Le,$e,oe,me,ae,ge,lt,Te,Ae,te,ke,Ie,ot,pt,Ne,nt,He,_t,wt,Dt,Ut,It,Et,P=>T(P),()=>{t(1,m=2)}]}class fi extends ct{constructor(e){super(),ft(this,e,ci,ai,et,{},null,[-1,-1,-1,-1])}}function pi(l){let e,t,o,n,u,s,c,r;return e=new nl({props:{fallbackPath:"/"}}),c=new Hn({props:{content:l[0],onChange:l[1]}}),{c(){se(e.$$.fragment),t=g(),o=f("div"),n=f("p"),n.innerHTML="<i>The best editing experience is to configure Atomic Server, in the meantime use editor below. You will need to refresh page via Command R or Ctrl-R to see changes</i>",u=g(),s=f("div"),se(c.$$.fragment),a(s,"class","editor"),a(o,"class","box")},m(p,d){re(e,p,d),S(p,t,d),S(p,o,d),i(o,n),i(o,u),i(o,s),re(c,s,null),r=!0},p(p,[d]){const _={};d&1&&(_.content=p[0]),c.$set(_)},i(p){r||(H(e.$$.fragment,p),H(c.$$.fragment,p),r=!0)},o(p){q(e.$$.fragment,p),q(c.$$.fragment,p),r=!1},d(p){ie(e,p),p&&C(t),p&&C(o),ie(c)}}}function di(l,e,t){let o,n;Re(l,gt,c=>t(2,o=c)),Re(l,Be,c=>t(3,n=c));let u={json:o};function s(c){if(console.log("contents changed:",c),console.log("is tauri",n),gt.update(r=>(r=c.json,r)),vt(Be))console.log("Updating config on server"),qe("update_config",{configNew:c.json}).then(r=>{console.log(`Message: ${r}`)}).catch(r=>console.error(r));else{let r=`${at.ServerURL}/config/`;fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c.json)})}t(0,u=c)}return Kt(()=>{t(0,u={json:o})}),[u,s]}class _i extends ct{constructor(e){super(),ft(this,e,di,pi,et,{})}}const{window:Ul}=cs;function mi(l){let e,t,o,n,u,s,c,r,p,d;return{c(){e=f("div"),t=f("div"),o=f("h3"),o.textContent="Error loading graph",n=g(),u=f("p"),s=K(l[3]),c=g(),r=f("button"),r.textContent="Retry",a(r,"class","button is-primary"),a(t,"class","error-content svelte-1ry9pkl"),a(e,"class","error-overlay svelte-1ry9pkl")},m(_,m){S(_,e,m),i(e,t),i(t,o),i(t,n),i(t,u),i(u,s),i(t,c),i(t,r),p||(d=Q(r,"click",l[11]),p=!0)},p(_,m){m&8&&be(s,_[3])},d(_){_&&C(e),p=!1,d()}}}function hi(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="loading-content svelte-1ry9pkl"><div class="loader svelte-1ry9pkl"></div> 
        <p>Loading knowledge graph...</p></div>`,a(e,"class","loading-overlay svelte-1ry9pkl")},m(t,o){S(t,e,o)},p:Se,d(t){t&&C(e)}}}function Tn(l){let e,t,o;return{c(){e=f("button"),e.innerHTML='<i class="fas fa-times svelte-1ry9pkl"></i>',a(e,"class","close-button svelte-1ry9pkl"),a(e,"title","Close Graph")},m(n,u){S(n,e,u),t||(o=Q(e,"click",l[17]),t=!0)},p:Se,d(n){n&&C(e),t=!1,o()}}}function Rn(l){let e;return{c(){e=f("div"),e.innerHTML="<span><strong>Left-click:</strong> View node • <strong>Right-click:</strong> Edit node • <strong>Drag:</strong> Move • <strong>Scroll:</strong> Zoom</span>",a(e,"class","controls-info svelte-1ry9pkl")},m(t,o){S(t,e,o)},d(t){t&&C(e)}}}function An(l){let e,t;return{c(){e=f("div"),t=K(l[8]),a(e,"class","debug-message svelte-1ry9pkl")},m(o,n){S(o,e,n),i(e,t)},p(o,n){n&256&&be(t,o[8])},d(o){o&&C(e)}}}function Ln(l){let e=l[5].id,t,o,n=Nn(l);return{c(){n.c(),t=tt()},m(u,s){n.m(u,s),S(u,t,s),o=!0},p(u,s){s&32&&et(e,e=u[5].id)?(Me(),q(n,1,1,Se),De(),n=Nn(u),n.c(),H(n,1),n.m(t.parentNode,t)):n.p(u,s)},i(u){o||(H(n),o=!0)},o(u){q(n),o=!1},d(u){u&&C(t),n.d(u)}}}function Nn(l){let e,t,o;function n(s){l[18](s)}let u={item:l[5],initialEdit:l[7]};return l[6]!==void 0&&(u.active=l[6]),e=new Ml({props:u}),Fe.push(()=>Je(e,"active",n)),e.$on("close",l[12]),e.$on("save",l[13]),{c(){se(e.$$.fragment)},m(s,c){re(e,s,c),o=!0},p(s,c){const r={};c&32&&(r.item=s[5]),c&128&&(r.initialEdit=s[7]),!t&&c&64&&(t=!0,r.active=s[6],Ve(()=>t=!1)),e.$set(r)},i(s){o||(H(e.$$.fragment,s),o=!0)},o(s){q(e.$$.fragment,s),o=!1},d(s){ie(e,s)}}}function gi(l){let e,t,o,n,u,s,c,r,p,d,_;ut(l[15]),e=new nl({props:{fallbackPath:"/"}});function m(b,U){if(b[2])return hi;if(b[3])return mi}let k=m(l),v=k&&k(l),w=l[0]&&Tn(l),h=!l[2]&&!l[3]&&l[4].length>0&&Rn(),T=l[8]&&An(l),$=l[5]&&Ln(l);return{c(){se(e.$$.fragment),t=g(),o=f("div"),v&&v.c(),n=g(),w&&w.c(),u=g(),h&&h.c(),s=g(),T&&T.c(),c=g(),$&&$.c(),r=tt(),a(o,"class","graph-container svelte-1ry9pkl"),fe(o,"width",l[0]?"100vw":"600px"),fe(o,"height",l[0]?"100vh":"400px"),Rt(o,"fullscreen",l[0])},m(b,U){re(e,b,U),S(b,t,U),S(b,o,U),v&&v.m(o,null),l[16](o),S(b,n,U),w&&w.m(b,U),S(b,u,U),h&&h.m(b,U),S(b,s,U),T&&T.m(b,U),S(b,c,U),$&&$.m(b,U),S(b,r,U),p=!0,d||(_=Q(Ul,"resize",l[15]),d=!0)},p(b,[U]){k===(k=m(b))&&v?v.p(b,U):(v&&v.d(1),v=k&&k(b),v&&(v.c(),v.m(o,null))),(!p||U&1)&&fe(o,"width",b[0]?"100vw":"600px"),(!p||U&1)&&fe(o,"height",b[0]?"100vh":"400px"),(!p||U&1)&&Rt(o,"fullscreen",b[0]),b[0]?w?w.p(b,U):(w=Tn(b),w.c(),w.m(u.parentNode,u)):w&&(w.d(1),w=null),!b[2]&&!b[3]&&b[4].length>0?h||(h=Rn(),h.c(),h.m(s.parentNode,s)):h&&(h.d(1),h=null),b[8]?T?T.p(b,U):(T=An(b),T.c(),T.m(c.parentNode,c)):T&&(T.d(1),T=null),b[5]?$?($.p(b,U),U&32&&H($,1)):($=Ln(b),$.c(),H($,1),$.m(r.parentNode,r)):$&&(Me(),q($,1,1,()=>{$=null}),De())},i(b){p||(H(e.$$.fragment,b),H($),p=!0)},o(b){q(e.$$.fragment,b),q($),p=!1},d(b){ie(e,b),b&&C(t),b&&C(o),v&&v.d(),l[16](null),b&&C(n),w&&w.d(b),b&&C(u),h&&h.d(b),b&&C(s),T&&T.d(b),b&&C(c),$&&$.d(b),b&&C(r),d=!1,_()}}}function On(l){return{id:`kg-node-${l.id}`,url:`#/graph/node/${l.id}`,title:l.label,body:`# ${l.label}

**Knowledge Graph Node**

ID: ${l.id}
Rank: ${l.rank}

This is a concept node from the knowledge graph. You can edit this content to add more information about "${l.label}".`,description:`Knowledge graph concept: ${l.label}`,tags:["knowledge-graph","concept"],rank:l.rank,stub:`Knowledge graph concept: ${l.label}`}}function bi(l,e,t){let o,n;Re(l,St,R=>t(20,o=R)),Re(l,Be,R=>t(21,n=R));let{apiUrl:u="/rolegraph"}=e,{fullscreen:s=!0}=e,c,r=!0,p=null,d=[],_=[],m=null,k=!1,v=!1,w="",h=window.innerWidth,T=window.innerHeight;function $(){t(9,h=window.innerWidth),t(10,T=window.innerHeight),!r&&!p&&O()}async function b(){t(2,r=!0),t(3,p=null);try{if(n){console.log("Loading rolegraph from Tauri");const R=await qe("get_rolegraph",{role_name:o||void 0});if(R&&R.status==="success")t(4,d=R.nodes),_=R.edges;else throw new Error(`Tauri rolegraph fetch failed: ${(R==null?void 0:R.status)||"unknown error"}`)}else{console.log("Loading rolegraph from server");const R=o?`${u}?role=${encodeURIComponent(o)}`:u,Z=await fetch(R);if(!Z.ok)throw new Error(`Failed to fetch: ${Z.status}`);const N=await Z.json();t(4,d=N.nodes),_=N.edges}}catch(R){t(3,p=R.message),console.error("Error fetching rolegraph:",R)}finally{t(2,r=!1)}}function U(R,Z){R.stopPropagation(),console.log("Node clicked:",Z.label),t(5,m=On(Z)),t(7,v=!1),t(6,k=!0)}function J(R,Z){R.preventDefault(),R.stopPropagation(),console.log("Node right-clicked:",Z.label),t(8,w=`Right-clicked: ${Z.label}`),t(5,m=On(Z)),t(7,v=!0),t(6,k=!0),setTimeout(()=>{t(8,w="")},2e3)}function M(){t(6,k=!1),t(5,m=null),t(7,v=!1)}async function L(){if(m)try{const R=await fetch("/documents",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)});R.ok?console.log("Successfully saved KG record:",m.id):console.error("Failed to save KG record:",R.statusText)}catch(R){console.error("Error saving KG record:",R)}finally{t(6,k=!1),t(5,m=null),t(7,v=!1)}}function O(){if(!c)return;t(1,c.innerHTML="",c);const R=Al(c).append("svg").attr("width",h).attr("height",T),Z=bs().scaleExtent([.1,10]).on("zoom",D=>{N.attr("transform",D.transform)});R.call(Z);const N=R.append("g"),z=vs(d).force("link",ks(_).id(D=>D.id).distance(100)).force("charge",ws().strength(-200)).force("center",$s(h/2,T/2)).force("collision",ys().radius(20)),X=N.append("g").attr("class","links").selectAll("line").data(_).enter().append("line").attr("stroke","#666").attr("stroke-opacity",.7).attr("stroke-width",D=>{const V=D.weight||D.rank||1;return Math.max(1,Math.min(8,V*2))}),W=N.append("g").attr("class","nodes").selectAll("circle").data(d).enter().append("circle").attr("r",D=>{const V=D.rank||1;return Math.max(6,Math.min(20,V*2))}).attr("fill",D=>{const V=D.rank||1,x=Math.min(V/10,1);return Cs(.2+x*.6)}).attr("stroke","#fff").attr("stroke-width",2).style("cursor","pointer").on("click",(D,V)=>U(D,V)).on("contextmenu",(D,V)=>J(D,V)).on("mouseover",function(D,V){Al(this).transition().duration(150).attr("stroke-width",3).attr("r",x=>{const le=x.rank||1;return Math.max(8,Math.min(24,le*2.5))})}).on("mouseout",function(D,V){Al(this).transition().duration(150).attr("stroke-width",2).attr("r",x=>{const le=x.rank||1;return Math.max(6,Math.min(20,le*2))})}).call(Ss().on("start",y).on("drag",E).on("end",I)),Y=N.append("g").attr("class","labels").selectAll("text").data(d).enter().append("text").attr("text-anchor","middle").attr("dy",".35em").attr("font-size","11px").attr("font-family","Arial, sans-serif").attr("fill","#333").attr("pointer-events","none").text(D=>D.label.length>12?D.label.substring(0,12)+"...":D.label);z.on("tick",()=>{X.attr("x1",D=>D.source.x).attr("y1",D=>D.source.y).attr("x2",D=>D.target.x).attr("y2",D=>D.target.y),W.attr("cx",D=>D.x).attr("cy",D=>D.y),Y.attr("x",D=>D.x).attr("y",D=>D.y)});function y(D,V){D.active||z.alphaTarget(.3).restart(),V.fx=V.x,V.fy=V.y}function E(D,V){V.fx=D.x,V.fy=D.y}function I(D,V){D.active||z.alphaTarget(0),V.fx=null,V.fy=null}}Kt(()=>{b().then(()=>{p||O()});const R=Z=>{Z.preventDefault()};return c&&c.addEventListener("contextmenu",R),window.addEventListener("resize",$),()=>{c&&c.removeEventListener("contextmenu",R),window.removeEventListener("resize",$)}});function G(){t(9,h=Ul.innerWidth),t(10,T=Ul.innerHeight)}function F(R){Fe[R?"unshift":"push"](()=>{c=R,t(1,c)})}const B=()=>history.back();function A(R){k=R,t(6,k)}return l.$$set=R=>{"apiUrl"in R&&t(14,u=R.apiUrl),"fullscreen"in R&&t(0,s=R.fullscreen)},[s,c,r,p,d,m,k,v,w,h,T,b,M,L,u,G,F,B,A]}class vi extends ct{constructor(e){super(),ft(this,e,bi,gi,et,{apiUrl:14,fullscreen:0})}}function Un(l,e,t){const o=l.slice();return o[9]=e[t],o[11]=t,o}function En(l){let e,t,o,n=l[9].content+"",u,s;return{c(){e=f("div"),t=f("div"),o=f("pre"),u=K(n),a(o,"class","svelte-tu8ic4"),a(t,"class","bubble svelte-tu8ic4"),a(e,"class",s=Tt(`msg ${l[9].role}`)+" svelte-tu8ic4")},m(c,r){S(c,e,r),i(e,t),i(t,o),i(o,u)},p(c,r){r&1&&n!==(n=c[9].content+"")&&be(u,n),r&1&&s!==(s=Tt(`msg ${c[9].role}`)+" svelte-tu8ic4")&&a(e,"class",s)},d(c){c&&C(e)}}}function Pn(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="bubble loading svelte-tu8ic4"><span class="icon is-small"><i class="fas fa-spinner fa-spin"></i></span> 
            <span>Thinking...</span></div>`,a(e,"class","msg assistant svelte-tu8ic4")},m(t,o){S(t,e,o)},d(t){t&&C(e)}}}function Mn(l){let e,t,o;return{c(){e=f("p"),t=K("Model: "),o=K(l[4]),a(e,"class","is-size-7 has-text-grey")},m(n,u){S(n,e,u),i(e,t),i(e,o)},p(n,u){u&16&&be(o,n[4])},d(n){n&&C(e)}}}function Dn(l){let e,t;return{c(){e=f("p"),t=K(l[3]),a(e,"class","has-text-danger is-size-7")},m(o,n){S(o,e,n),i(e,t)},p(o,n){n&8&&be(t,o[3])},d(o){o&&C(e)}}}function ki(l){let e,t,o,n,u,s,c,r,p,d,_,m,k,v,w,h,T,$,b,U,J,M,L,O;e=new nl({props:{fallbackPath:"/"}});let G=l[0],F=[];for(let Z=0;Z<G.length;Z+=1)F[Z]=En(Un(l,G,Z));let B=l[2]&&Pn(),A=l[4]&&Mn(l),R=l[3]&&Dn(l);return{c(){se(e.$$.fragment),t=g(),o=f("section"),n=f("div"),u=f("h2"),u.textContent="Chat",s=g(),c=f("p"),c.textContent=`Role: ${vt(St)}`,r=g(),p=f("div");for(let Z=0;Z<F.length;Z+=1)F[Z].c();d=g(),B&&B.c(),_=g(),A&&A.c(),m=g(),R&&R.c(),k=g(),v=f("div"),w=f("div"),h=f("textarea"),T=g(),$=f("div"),b=f("button"),U=f("span"),U.innerHTML='<i class="fas fa-paper-plane"></i>',a(u,"class","title is-4"),a(c,"class","subtitle is-6"),a(p,"class","chat-window svelte-tu8ic4"),a(h,"class","textarea"),a(h,"rows","3"),a(h,"placeholder","Type your message and press Enter..."),a(w,"class","control is-expanded"),a(U,"class","icon"),a(b,"class","button is-primary"),b.disabled=J=l[2]||!l[1].trim(),a($,"class","control"),a(v,"class","field has-addons chat-input svelte-tu8ic4"),a(n,"class","container"),a(o,"class","section")},m(Z,N){re(e,Z,N),S(Z,t,N),S(Z,o,N),i(o,n),i(n,u),i(n,s),i(n,c),i(n,r),i(n,p);for(let z=0;z<F.length;z+=1)F[z]&&F[z].m(p,null);i(p,d),B&&B.m(p,null),i(n,_),A&&A.m(n,null),i(n,m),R&&R.m(n,null),i(n,k),i(n,v),i(v,w),i(w,h),Ce(h,l[1]),i(v,T),i(v,$),i($,b),i(b,U),M=!0,L||(O=[Q(h,"input",l[7]),Q(h,"keydown",l[6]),Q(b,"click",l[5])],L=!0)},p(Z,[N]){if(N&1){G=Z[0];let z;for(z=0;z<G.length;z+=1){const X=Un(Z,G,z);F[z]?F[z].p(X,N):(F[z]=En(X),F[z].c(),F[z].m(p,d))}for(;z<F.length;z+=1)F[z].d(1);F.length=G.length}Z[2]?B||(B=Pn(),B.c(),B.m(p,null)):B&&(B.d(1),B=null),Z[4]?A?A.p(Z,N):(A=Mn(Z),A.c(),A.m(n,m)):A&&(A.d(1),A=null),Z[3]?R?R.p(Z,N):(R=Dn(Z),R.c(),R.m(n,k)):R&&(R.d(1),R=null),N&2&&Ce(h,Z[1]),(!M||N&6&&J!==(J=Z[2]||!Z[1].trim()))&&(b.disabled=J)},i(Z){M||(H(e.$$.fragment,Z),M=!0)},o(Z){q(e.$$.fragment,Z),M=!1},d(Z){ie(e,Z),Z&&C(t),Z&&C(o),We(F,Z),B&&B.d(),A&&A.d(),R&&R.d(),L=!1,Ge(O)}}}function wi(l,e,t){let o=[],n="",u=!1,s=null,c=null;function r(m){t(0,o=[...o,{role:"user",content:m}])}async function p(){var v;if(!n.trim()||u)return;t(3,s=null);const m=vt(St),k=n.trim();t(1,n=""),r(k),t(2,u=!0);try{const w=await fetch(`${at.ServerURL}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({role:m,messages:o})});if(!w.ok)throw new Error(`HTTP ${w.status}`);const h=await w.json();t(4,c=h.model_used??null),((v=h.status)==null?void 0:v.toLowerCase())==="success"&&h.message?t(0,o=[...o,{role:"assistant",content:h.message}]):t(3,s=h.error||"Chat failed")}catch(w){t(3,s=(w==null?void 0:w.message)||String(w))}finally{t(2,u=!1)}}function d(m){(m.key==="Enter"||m.key==="Return")&&!m.shiftKey&&(m.preventDefault(),p())}Kt(()=>{t(0,o=[{role:"assistant",content:"Hi! How can I help you? Ask me anything about your search results or documents."}])});function _(){n=this.value,t(1,n)}return[o,n,u,s,c,p,d,_]}class $i extends ct{constructor(e){super(),ft(this,e,wi,ki,et,{})}}function yi(l){let e,t;return e=new ei({}),{c(){se(e.$$.fragment)},m(o,n){re(e,o,n),t=!0},i(o){t||(H(e.$$.fragment,o),t=!0)},o(o){q(e.$$.fragment,o),t=!1},d(o){ie(e,o)}}}function Ci(l){let e,t;return e=new Qs({}),{c(){se(e.$$.fragment)},m(o,n){re(e,o,n),t=!0},i(o){t||(H(e.$$.fragment,o),t=!0)},o(o){q(e.$$.fragment,o),t=!1},d(o){ie(e,o)}}}function Si(l){let e,t;return e=new fi({}),{c(){se(e.$$.fragment)},m(o,n){re(e,o,n),t=!0},i(o){t||(H(e.$$.fragment,o),t=!0)},o(o){q(e.$$.fragment,o),t=!1},d(o){ie(e,o)}}}function Ti(l){let e,t;return e=new _i({}),{c(){se(e.$$.fragment)},m(o,n){re(e,o,n),t=!0},i(o){t||(H(e.$$.fragment,o),t=!0)},o(o){q(e.$$.fragment,o),t=!1},d(o){ie(e,o)}}}function Ri(l){let e,t;return e=new vi({}),{c(){se(e.$$.fragment)},m(o,n){re(e,o,n),t=!0},i(o){t||(H(e.$$.fragment,o),t=!0)},o(o){q(e.$$.fragment,o),t=!1},d(o){ie(e,o)}}}function Ai(l){let e,t;return e=new $i({}),{c(){se(e.$$.fragment)},m(o,n){re(e,o,n),t=!0},i(o){t||(H(e.$$.fragment,o),t=!0)},o(o){q(e.$$.fragment,o),t=!1},d(o){ie(e,o)}}}function Li(l){let e;return{c(){e=f("nav"),e.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
            <a class="navbar-item" href="/config/wizard">Wizard</a> 
            <a class="navbar-item" href="/config/json">JSON Editor</a> 
            <a class="navbar-item" href="/graph">Graph</a> 
            <a class="navbar-item" href="/chat">Chat</a></div>`,a(e,"class","navbar")},m(t,o){S(t,e,o)},p:Se,d(t){t&&C(e)}}}function Ni(l){let e,t,o,n,u,s,c,r,p,d,_,m,k,v,w,h,T,$,b,U,J,M,L,O,G,F,B,A,R,Z;return c=new yl({}),d=new Ct({props:{path:"/",$$slots:{default:[yi]},$$scope:{ctx:l}}}),v=new Ct({props:{path:"/fetch/*",$$slots:{default:[Ci]},$$scope:{ctx:l}}}),h=new Ct({props:{path:"/config/wizard",$$slots:{default:[Si]},$$scope:{ctx:l}}}),$=new Ct({props:{path:"/config/json",$$slots:{default:[Ti]},$$scope:{ctx:l}}}),U=new Ct({props:{path:"/graph",$$slots:{default:[Ri]},$$scope:{ctx:l}}}),M=new Ct({props:{path:"/chat",$$slots:{default:[Ai]},$$scope:{ctx:l}}}),F=new Ct({props:{path:"/",$$slots:{default:[Li]},$$scope:{ctx:l}}}),{c(){e=f("meta"),t=g(),o=f("div"),n=f("main"),u=f("div"),s=f("div"),se(c.$$.fragment),r=g(),p=f("div"),se(d.$$.fragment),_=g(),m=f("br"),k=g(),se(v.$$.fragment),w=g(),se(h.$$.fragment),T=g(),se($.$$.fragment),b=g(),se(U.$$.fragment),J=g(),se(M.$$.fragment),L=g(),O=f("footer"),G=f("div"),se(F.$$.fragment),a(e,"name","color-scheme"),a(e,"content",l[1]),document.title="Terraphim",a(s,"class","role-selector svelte-1bfpta4"),a(u,"class","top-controls svelte-1bfpta4"),a(p,"class","search-area svelte-1bfpta4"),a(n,"class","main-content svelte-1bfpta4"),a(G,"class",B=Tt(l[0])+" svelte-1bfpta4"),a(O,"class","svelte-1bfpta4"),a(o,"class","is-full-height svelte-1bfpta4")},m(N,z){i(document.head,e),S(N,t,z),S(N,o,z),i(o,n),i(n,u),i(u,s),re(c,s,null),i(n,r),i(n,p),re(d,p,null),i(n,_),i(n,m),i(n,k),re(v,n,null),i(n,w),re(h,n,null),i(n,T),re($,n,null),i(n,b),re(U,n,null),i(n,J),re(M,n,null),i(o,L),i(o,O),i(O,G),re(F,G,null),A=!0,R||(Z=[Q(O,"mouseover",l[2]),Q(O,"focus",l[2])],R=!0)},p(N,[z]){(!A||z&2)&&a(e,"content",N[1]);const X={};z&8&&(X.$$scope={dirty:z,ctx:N}),d.$set(X);const W={};z&8&&(W.$$scope={dirty:z,ctx:N}),v.$set(W);const Y={};z&8&&(Y.$$scope={dirty:z,ctx:N}),h.$set(Y);const y={};z&8&&(y.$$scope={dirty:z,ctx:N}),$.$set(y);const E={};z&8&&(E.$$scope={dirty:z,ctx:N}),U.$set(E);const I={};z&8&&(I.$$scope={dirty:z,ctx:N}),M.$set(I);const D={};z&8&&(D.$$scope={dirty:z,ctx:N}),F.$set(D),(!A||z&1&&B!==(B=Tt(N[0])+" svelte-1bfpta4"))&&a(G,"class",B)},i(N){A||(H(c.$$.fragment,N),H(d.$$.fragment,N),H(v.$$.fragment,N),H(h.$$.fragment,N),H($.$$.fragment,N),H(U.$$.fragment,N),H(M.$$.fragment,N),H(F.$$.fragment,N),A=!0)},o(N){q(c.$$.fragment,N),q(d.$$.fragment,N),q(v.$$.fragment,N),q(h.$$.fragment,N),q($.$$.fragment,N),q(U.$$.fragment,N),q(M.$$.fragment,N),q(F.$$.fragment,N),A=!1},d(N){C(e),N&&C(t),N&&C(o),ie(c),ie(d),ie(v),ie(h),ie($),ie(U),ie(M),ie(F),R=!1,Ge(Z)}}}function Oi(l,e,t){let o;Re(l,ul,s=>t(1,o=s));let n="is-hidden";function u(){t(0,n="")}return[n,o,u]}class Ui extends ct{constructor(e){super(),ft(this,e,Oi,Ni,et,{})}}const Ei=new ms;hs(Ei);new Ui({target:document.getElementById("app")});
