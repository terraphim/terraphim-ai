var gs=Object.defineProperty;var vs=(l,e,t)=>e in l?gs(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var wt=(l,e,t)=>(vs(l,typeof e!="symbol"?e+"":e,t),t);import{aa as Lt,S as _t,i as ht,s as ct,q as f,Y as D,b as A,y as s,Z as ve,I as Te,j as R,ak as Oe,F as lt,m as Jt,a as v,v as a,l as ee,E as Qe,au as Ht,r as pe,z as me,t as Q,d as Z,B as _e,av as bs,aw as Vt,H as Xe,U as et,V as tt,ax as Pl,ay as ks,g as qe,e as Ge,O as Ve,af as yt,o as ws,W as de,az as jl,aA as At,aB as Xn,aC as xn,a1 as Ne,C as at,aD as He,aE as es,D as sl,G as rl,aF as ts,w as It,x as Nt,A as Hl,a2 as ys,aG as pl,ac as $s,a7 as Cs,a9 as Ss,n as Ts}from"./vendor-ui-cd3d2b6a.js";import{R as Pt,S as Il}from"./vendor-utils-1b347ea1.js";import{J as ls,_ as Rs,d as os,P as As,k as Ls,D as Es,l as Ps,E as Os,o as fo}from"./vendor-editor-992829d3.js";import{P as ns,T as Ol,u as ss,y as Is,A as Ns,S as Us,q as Ds}from"./vendor-atomic-1ea13e29.js";import{t as Ms,E as js}from"./novel-editor-becefd2f.js";import{s as Ul,z as Hs,a as zs,l as Fs,m as Ks,c as Ws,b as qs,B as Gs,d as Bs}from"./vendor-charts-e6a4a6c9.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const r of c.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function t(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(n){if(n.ep)return;n.ep=!0;const c=t(n);fetch(n.href,c)}})();const Ze={ServerURL:location.protocol+"//"+window.location.host||"/"},dl=Lt([]),Js={id:"Desktop",global_shortcut:"",roles:{},default_role:{original:"",lowercase:""},selected_role:{original:"",lowercase:""}},ml=Lt("spacelab"),St=Lt("selected"),Je=Lt(!1),Vs=Lt(`${Ze.ServerURL}/documents/search`),Tt=Lt(Js),po=Lt([]);let Ll=Lt("");const Ct=Lt(!1);let Gt=null;function Qs(l){if(typeof document>"u")return;const e=`/assets/bulmaswatch/${l}/bulmaswatch.min.css`;if(Gt!=null&&Gt.href.endsWith(e))return;const t=document.createElement("link");t.rel="stylesheet",t.href=e,t.id="bulma-theme",t.onload=()=>{Gt&&Gt!==t&&Gt.remove(),Gt=t},document.head.appendChild(t);const o=document.head.querySelector('meta[name="color-scheme"]');o&&o.setAttribute("content",l)}ml.subscribe(Qs);function Ys(l){let e,t;return{c(){e=f("option"),t=D(l[1]),e.__value=l[0],e.value=e.__value},m(o,n){A(o,e,n),s(e,t)},p(o,[n]){n&2&&ve(t,o[1]),n&1&&(e.__value=o[0],e.value=e.__value)},i:Te,o:Te,d(o){o&&R(e)}}}function Zs(l,e,t){let o,{subject:n}=e;const c=ns(n),r=Ol(c,ss.properties.name);return Oe(l,r,u=>t(1,o=u)),Ol(c,"http://localhost:9883/property/theme"),l.$$set=u=>{"subject"in u&&t(0,n=u.subject)},[n,o,r]}class Xs extends _t{constructor(e){super(),ht(this,e,Zs,Ys,ct,{subject:0})}}function mo(l){let e,t,o,n,c,r,u=l[0]&&_o();return{c(){e=f("button"),t=f("span"),t.innerHTML='<i class="fas fa-arrow-left"></i>',o=v(),u&&u.c(),a(t,"class","icon svelte-rnsqpo"),a(e,"class",n="button is-light back-button "+l[1]+" svelte-rnsqpo"),a(e,"title","Go back"),a(e,"aria-label","Go back")},m(i,d){A(i,e,d),s(e,t),s(e,o),u&&u.m(e,null),c||(r=[ee(e,"click",l[3]),ee(e,"keydown",l[6])],c=!0)},p(i,d){i[0]?u||(u=_o(),u.c(),u.m(e,null)):u&&(u.d(1),u=null),d&2&&n!==(n="button is-light back-button "+i[1]+" svelte-rnsqpo")&&a(e,"class",n)},d(i){i&&R(e),u&&u.d(),c=!1,Qe(r)}}}function _o(l){let e;return{c(){e=f("span"),e.textContent="Back",a(e,"class","back-text svelte-rnsqpo")},m(t,o){A(t,e,o)},d(t){t&&R(e)}}}function xs(l){let e,t=l[2]&&mo(l);return{c(){t&&t.c(),e=lt()},m(o,n){t&&t.m(o,n),A(o,e,n)},p(o,[n]){o[2]?t?t.p(o,n):(t=mo(o),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Te,o:Te,d(o){t&&t.d(o),o&&R(e)}}}function er(l,e,t){let{fallbackPath:o="/"}=e,{showText:n=!0}=e,{customClass:c=""}=e,{hideOnPaths:r=["/"]}=e,u=!0;function i(){var m;try{const _=((m=window.location)==null?void 0:m.pathname)||"/";t(2,u=!r.includes(_))}catch{t(2,u=!0)}}function d(){window.history.length>1?window.history.back():window.location.href=o}Jt(()=>(i(),window.addEventListener("popstate",i),window.addEventListener("hashchange",i),()=>{window.removeEventListener("popstate",i),window.removeEventListener("hashchange",i)}));const p=m=>{(m.key==="Enter"||m.key===" ")&&(m.preventDefault(),d())};return l.$$set=m=>{"fallbackPath"in m&&t(4,o=m.fallbackPath),"showText"in m&&t(0,n=m.showText),"customClass"in m&&t(1,c=m.customClass),"hideOnPaths"in m&&t(5,r=m.hideOnPaths)},[n,c,u,d,o,r,p]}class il extends _t{constructor(e){super(),ht(this,e,er,xs,ct,{fallbackPath:4,showText:0,customClass:1,hideOnPaths:5})}}function tr(){return window.crypto.getRandomValues(new Uint32Array(1))[0]}function Dl(l,e=!1){const t=tr(),o=`_${t}`;return Object.defineProperty(window,o,{value:n=>(e&&Reflect.deleteProperty(window,o),l==null?void 0:l(n)),writable:!1,configurable:!0}),t}async function je(l,e={}){return new Promise((t,o)=>{const n=Dl(r=>{t(r),Reflect.deleteProperty(window,`_${c}`)},!0),c=Dl(r=>{o(r),Reflect.deleteProperty(window,`_${n}`)},!0);window.__TAURI_IPC__({cmd:l,callback:n,error:c,...e})})}function ho(l,e,t){const o=l.slice();return o[25]=e[t],o}function lr(l){let e,t,o;function n(r){l[13](r)}let c={};return l[5]!==void 0&&(c.value=l[5]),e=new Vt({props:c}),Xe.push(()=>et(e,"value",n)),{c(){pe(e.$$.fragment)},m(r,u){me(e,r,u),o=!0},p(r,u){const i={};!t&&u&32&&(t=!0,i.value=r[5],tt(()=>t=!1)),e.$set(i)},i(r){o||(Q(e.$$.fragment,r),o=!0)},o(r){Z(e.$$.fragment,r),o=!1},d(r){_e(e,r)}}}function or(l){let e,t,o;function n(r){l[14](r)}let c={type:"password",placeholder:"secret",icon:"fas fa-lock",expanded:!0};return l[6]!==void 0&&(c.value=l[6]),e=new Vt({props:c}),Xe.push(()=>et(e,"value",n)),{c(){pe(e.$$.fragment)},m(r,u){me(e,r,u),o=!0},p(r,u){const i={};!t&&u&64&&(t=!0,i.value=r[6],tt(()=>t=!1)),e.$set(i)},i(r){o||(Q(e.$$.fragment,r),o=!0)},o(r){Z(e.$$.fragment,r),o=!1},d(r){_e(e,r)}}}function nr(l){let e;return{c(){e=D("Save")},m(t,o){A(t,e,o)},d(t){t&&R(e)}}}function sr(l){let e,t;return e=new Pl({props:{type:"is-success",class:"is-right",iconPack:"fa",iconLeft:"check",$$slots:{default:[nr]},$$scope:{ctx:l}}}),e.$on("click",l[8]),e.$on("submit",l[8]),{c(){pe(e.$$.fragment)},m(o,n){me(e,o,n),t=!0},p(o,n){const c={};n&268435456&&(c.$$scope={dirty:n,ctx:o}),e.$set(c)},i(o){t||(Q(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){_e(e,o)}}}function rr(l){let e,t,o,n,c,r;return e=new Ht({props:{$$slots:{default:[lr]},$$scope:{ctx:l}}}),o=new Ht({props:{grouped:!0,$$slots:{default:[or]},$$scope:{ctx:l}}}),c=new Ht({props:{grouped:!0,$$slots:{default:[sr]},$$scope:{ctx:l}}}),{c(){pe(e.$$.fragment),t=v(),pe(o.$$.fragment),n=v(),pe(c.$$.fragment)},m(u,i){me(e,u,i),A(u,t,i),me(o,u,i),A(u,n,i),me(c,u,i),r=!0},p(u,i){const d={};i&268435488&&(d.$$scope={dirty:i,ctx:u}),e.$set(d);const p={};i&268435520&&(p.$$scope={dirty:i,ctx:u}),o.$set(p);const m={};i&268435456&&(m.$$scope={dirty:i,ctx:u}),c.$set(m)},i(u){r||(Q(e.$$.fragment,u),Q(o.$$.fragment,u),Q(c.$$.fragment,u),r=!0)},o(u){Z(e.$$.fragment,u),Z(o.$$.fragment,u),Z(c.$$.fragment,u),r=!1},d(u){_e(e,u),u&&R(t),_e(o,u),u&&R(n),_e(c,u)}}}function ir(l){let e,t,o;function n(r){l[15](r)}let c={type:"search",placeholder:"Fetch JSON",icon:"search"};return l[3]!==void 0&&(c.value=l[3]),e=new Vt({props:c}),Xe.push(()=>et(e,"value",n)),{c(){pe(e.$$.fragment)},m(r,u){me(e,r,u),o=!0},p(r,u){const i={};!t&&u&8&&(t=!0,i.value=r[3],tt(()=>t=!1)),e.$set(i)},i(r){o||(Q(e.$$.fragment,r),o=!0)},o(r){Z(e.$$.fragment,r),o=!1},d(r){_e(e,r)}}}function ar(l){let e;return{c(){e=D("WikiPage")},m(t,o){A(t,e,o)},d(t){t&&R(e)}}}function cr(l){let e,t,o,n,c,r;function u(m){l[16](m)}let i={type:"search",placeholder:"Post JSON",icon:"search"};l[4]!==void 0&&(i.value=l[4]),e=new Vt({props:i}),Xe.push(()=>et(e,"value",u));function d(m){l[17](m)}let p={$$slots:{default:[ar]},$$scope:{ctx:l}};return l[2]!==void 0&&(p.checked=l[2]),n=new ks({props:p}),Xe.push(()=>et(n,"checked",d)),{c(){pe(e.$$.fragment),o=v(),pe(n.$$.fragment)},m(m,_){me(e,m,_),A(m,o,_),me(n,m,_),r=!0},p(m,_){const C={};!t&&_&16&&(t=!0,C.value=m[4],tt(()=>t=!1)),e.$set(C);const g={};_&268435456&&(g.$$scope={dirty:_,ctx:m}),!c&&_&4&&(c=!0,g.checked=m[2],tt(()=>c=!1)),n.$set(g)},i(m){r||(Q(e.$$.fragment,m),Q(n.$$.fragment,m),r=!0)},o(m){Z(e.$$.fragment,m),Z(n.$$.fragment,m),r=!1},d(m){_e(e,m),m&&R(o),_e(n,m)}}}function ur(l){let e;return{c(){e=D("Fetch")},m(t,o){A(t,e,o)},d(t){t&&R(e)}}}function fr(l){let e,t;return e=new Pl({props:{type:"is-primary",$$slots:{default:[ur]},$$scope:{ctx:l}}}),e.$on("click",l[9]),e.$on("submit",l[9]),{c(){pe(e.$$.fragment)},m(o,n){me(e,o,n),t=!0},p(o,n){const c={};n&268435456&&(c.$$scope={dirty:n,ctx:o}),e.$set(c)},i(o){t||(Q(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){_e(e,o)}}}function dr(l){let e,t,o,n,c,r;return e=new Ht({props:{grouped:!0,$$slots:{default:[ir]},$$scope:{ctx:l}}}),o=new Ht({props:{grouped:!0,$$slots:{default:[cr]},$$scope:{ctx:l}}}),c=new Ht({props:{grouped:!0,$$slots:{default:[fr]},$$scope:{ctx:l}}}),{c(){pe(e.$$.fragment),t=v(),pe(o.$$.fragment),n=v(),pe(c.$$.fragment)},m(u,i){me(e,u,i),A(u,t,i),me(o,u,i),A(u,n,i),me(c,u,i),r=!0},p(u,i){const d={};i&268435464&&(d.$$scope={dirty:i,ctx:u}),e.$set(d);const p={};i&268435476&&(p.$$scope={dirty:i,ctx:u}),o.$set(p);const m={};i&268435456&&(m.$$scope={dirty:i,ctx:u}),c.$set(m)},i(u){r||(Q(e.$$.fragment,u),Q(o.$$.fragment,u),Q(c.$$.fragment,u),r=!0)},o(u){Z(e.$$.fragment,u),Z(o.$$.fragment,u),Z(c.$$.fragment,u),r=!1},d(u){_e(e,u),u&&R(t),_e(o,u),u&&R(n),_e(c,u)}}}function pr(l){let e,t,o,n,c;return n=new ls({props:{content:l[1],onChange:l[7]}}),{c(){e=f("p"),e.innerHTML=`<i>The best editing experience is to configure Atomic Server, in the
        meantime use editor below. You will need to refresh page via Command R
        or Ctrl-R to see changes</i>`,t=v(),o=f("div"),pe(n.$$.fragment),a(o,"class","editor")},m(r,u){A(r,e,u),A(r,t,u),A(r,o,u),me(n,o,null),c=!0},p(r,u){const i={};u&2&&(i.content=r[1]),n.$set(i)},i(r){c||(Q(n.$$.fragment,r),c=!0)},o(r){Z(n.$$.fragment,r),c=!1},d(r){r&&R(e),r&&R(t),r&&R(o),_e(n)}}}function go(l){let e,t;return e=new Xs({props:{subject:l[25]}}),{c(){pe(e.$$.fragment)},m(o,n){me(e,o,n),t=!0},p(o,n){const c={};n&1&&(c.subject=o[25]),e.$set(c)},i(o){t||(Q(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){_e(e,o)}}}function mr(l){let e,t,o=l[0]??[],n=[];for(let r=0;r<o.length;r+=1)n[r]=go(ho(l,o,r));const c=r=>Z(n[r],1,1,()=>{n[r]=null});return{c(){for(let r=0;r<n.length;r+=1)n[r].c();e=lt()},m(r,u){for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(r,u);A(r,e,u),t=!0},p(r,u){if(u&1){o=r[0]??[];let i;for(i=0;i<o.length;i+=1){const d=ho(r,o,i);n[i]?(n[i].p(d,u),Q(n[i],1)):(n[i]=go(d),n[i].c(),Q(n[i],1),n[i].m(e.parentNode,e))}for(qe(),i=o.length;i<n.length;i+=1)c(i);Ge()}},i(r){if(!t){for(let u=0;u<o.length;u+=1)Q(n[u]);t=!0}},o(r){n=n.filter(Boolean);for(let u=0;u<n.length;u+=1)Z(n[u]);t=!1},d(r){Ve(n,r),r&&R(e)}}}function _r(l){let e,t;return e=new bs({props:{$$slots:{default:[mr]},$$scope:{ctx:l}}}),{c(){pe(e.$$.fragment)},m(o,n){me(e,o,n),t=!0},p(o,n){const c={};n&268435457&&(c.$$scope={dirty:n,ctx:o}),e.$set(c)},i(o){t||(Q(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){_e(e,o)}}}function hr(l){let e,t,o,n,c,r,u,i,d,p,m,_,C,g,y;return e=new il({props:{fallbackPath:"/"}}),n=new Pt({props:{path:"/atomic",$$slots:{default:[rr]},$$scope:{ctx:l}}}),r=new Pt({props:{path:"/json",$$slots:{default:[dr]},$$scope:{ctx:l}}}),i=new Pt({props:{path:"/editor",$$slots:{default:[pr]},$$scope:{ctx:l}}}),_=new Ht({props:{grouped:!0,position:"is-right",$$slots:{default:[_r]},$$scope:{ctx:l}}}),{c(){pe(e.$$.fragment),t=v(),o=f("div"),pe(n.$$.fragment),c=v(),pe(r.$$.fragment),u=v(),pe(i.$$.fragment),d=v(),p=f("hr"),m=v(),pe(_.$$.fragment),C=v(),g=f("nav"),g.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
    <a class="navbar-item" href="/fetch/json">Fetch JSON Data</a> 
    <a class="navbar-item" href="/fetch/atomic">Set Atomic Server</a> 
    <a class="navbar-item" href="/fetch/editor">Edit JSON config</a></div>`,a(o,"class","box"),a(g,"class","navbar")},m(k,w){me(e,k,w),A(k,t,w),A(k,o,w),me(n,o,null),s(o,c),me(r,o,null),s(o,u),me(i,o,null),A(k,d,w),A(k,p,w),A(k,m,w),me(_,k,w),A(k,C,w),A(k,g,w),y=!0},p(k,[w]){const b={};w&268435552&&(b.$$scope={dirty:w,ctx:k}),n.$set(b);const h={};w&268435484&&(h.$$scope={dirty:w,ctx:k}),r.$set(h);const $={};w&268435458&&($.$$scope={dirty:w,ctx:k}),i.$set($);const z={};w&268435457&&(z.$$scope={dirty:w,ctx:k}),_.$set(z)},i(k){y||(Q(e.$$.fragment,k),Q(n.$$.fragment,k),Q(r.$$.fragment,k),Q(i.$$.fragment,k),Q(_.$$.fragment,k),y=!0)},o(k){Z(e.$$.fragment,k),Z(n.$$.fragment,k),Z(r.$$.fragment,k),Z(i.$$.fragment,k),Z(_.$$.fragment,k),y=!1},d(k){_e(e,k),k&&R(t),k&&R(o),_e(n),_e(r),_e(i),k&&R(d),k&&R(p),k&&R(m),_e(_,k),k&&R(C),k&&R(g)}}}function gr(l,e,t){let o,n,c,r,u;Oe(l,Is,T=>t(19,c=T)),Oe(l,Je,T=>t(20,r=T)),Oe(l,Tt,T=>t(21,u=T));let i={json:u};function d(T){if(console.log("contents changed:",T),console.log("is tauri",r),Tt.update(L=>(L=T.json,L)),Je)console.log("Updating config on server"),je("update_config",{configNew:T.json}).then(L=>{console.log(`Message: ${L}`)}).catch(L=>console.error(L));else{let L=`${Ze.ServerURL}/config/`;fetch(L,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(T.json)})}t(1,i=T)}let p=!1,m="https://raw.githubusercontent.com/terraphim/terraphim-cloud-fastapi/main/data/ref_arch.json",_="http://localhost:8000/documents/",C="http://localhost:9883/",g;const y=async()=>{console.log("Updating atomic server configuration");const T=Ns.fromSecret(g);c.setServerUrl(C),console.log("Server set.Setting agent"),c.setAgent(T)},k=async()=>{h()},w=({data:{msg:T,data:L}})=>{console.log(T,L)};let b;const h=async()=>{const T=await Rs(()=>import("./fetcher.worker-7e58969a.js"),[]);b=new T.default,b.onmessage=w;const L={msg:"fetcher",data:{url:m,postUrl:_,isWiki:p}};b.postMessage(L)},$=ns("http://localhost:9883/config/y3zx5wtm0bq"),z=Ol($,ss.properties.name);Oe(l,z,T=>t(12,n=T));const O=Ol($,"http://localhost:9883/property/role");Oe(l,O,T=>t(0,o=T));function I(T){C=T,t(5,C)}function E(T){g=T,t(6,g)}function V(T){m=T,t(3,m)}function J(T){_=T,t(4,_)}function K(T){p=T,t(2,p)}return l.$$.update=()=>{l.$$.dirty&4096&&console.log("Print name",n),l.$$.dirty&1&&console.log("Print roles",o)},[o,i,p,m,_,C,g,d,y,k,z,O,n,I,E,V,J,K]}class vr extends _t{constructor(e){super(),ht(this,e,gr,hr,ct,{})}}function Bt(){return yt(Je)||typeof window<"u"&&window.__TAURI__!==void 0}class br{constructor(){wt(this,"baseUrl");wt(this,"autocompleteIndexBuilt",!1);wt(this,"sessionId");wt(this,"currentRole","Default");wt(this,"connectionRetries",0);wt(this,"maxRetries",3);wt(this,"retryDelay",1e3);wt(this,"isConnecting",!1);this.baseUrl=typeof window<"u"?(window.location.protocol==="https:"?"https://":"http://")+window.location.hostname+":8001":"http://localhost:8001",this.sessionId=`novel-${Date.now()}`,typeof window<"u"&&!Bt()&&this.detectServerPort()}setRole(e){this.currentRole=e,this.autocompleteIndexBuilt=!1}async detectServerPort(){if(Bt())return;const e=[8001,3e3,8e3,8080];for(const t of e)try{const o=typeof window<"u"?(window.location.protocol==="https:"?"https://":"http://")+window.location.hostname+":"+t:"http://localhost:"+t,n=await fetch(`${o}/message?sessionId=health-check`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:0,method:"ping",params:{}}),signal:AbortSignal.timeout(2e3)});if(n.ok||n.status===404){this.baseUrl=o,console.log(`NovelAutocompleteService: Detected server at ${o}`);return}}catch{continue}console.warn("NovelAutocompleteService: Could not detect running server, using default:",this.baseUrl)}async buildAutocompleteIndex(){if(this.isConnecting)return await new Promise(e=>setTimeout(e,1e3)),this.autocompleteIndexBuilt;this.isConnecting=!0;try{return Bt()?(console.log("Using Tauri backend - no index building required"),this.autocompleteIndexBuilt=!0,this.connectionRetries=0,console.log("Tauri autocomplete ready"),!0):await this.buildMCPIndex()}catch(e){return console.error("Error building Novel autocomplete index:",e),!1}finally{this.isConnecting=!1}}async buildMCPIndex(){for(let e=0;e<=this.maxRetries;e++)try{const t=await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:Date.now(),method:"tools/call",params:{name:"build_autocomplete_index",arguments:{}}}),signal:AbortSignal.timeout(1e4)});if(t.ok){const o=await t.json();if(console.log(`MCP build index response (attempt ${e+1}):`,o),o.result&&!o.result.is_error)return this.autocompleteIndexBuilt=!0,this.connectionRetries=0,console.log("MCP autocomplete index built successfully"),!0}else if(t.status>=500&&e<this.maxRetries){console.warn(`MCP server error ${t.status}, retrying in ${this.retryDelay}ms...`),await new Promise(o=>setTimeout(o,this.retryDelay*(e+1)));continue}console.warn(`MCP build index failed (attempt ${e+1}):`,t.status,t.statusText)}catch(t){t instanceof Error&&t.name==="AbortError"?console.warn(`MCP request timeout (attempt ${e+1})`):console.warn(`MCP connection error (attempt ${e+1}):`,t),e<this.maxRetries&&await new Promise(o=>setTimeout(o,this.retryDelay*(e+1)))}return console.error("Failed to build MCP autocomplete index after all retries"),!1}async getCompletion(e){if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return{text:""};try{const t=this.extractLastWord(e.prompt);if(!t||t.length<1)return{text:""};const o=await this.getSuggestionsWithSnippets(t,5);if(o.length===0)return{text:""};let c=o[0].text;c.toLowerCase().startsWith(t.toLowerCase())&&(c=c.substring(t.length));const r=e.prompt.length/4,u=c.length/4;return{text:c,usage:{promptTokens:Math.round(r),completionTokens:Math.round(u),totalTokens:Math.round(r+u)}}}catch(t){return console.error("Error getting Novel autocomplete completion:",t),{text:""}}}async getSuggestions(e,t=10){if(!e||e.trim().length===0)return[];if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return console.warn("Autocomplete index not built, returning empty suggestions"),[];try{return Bt()?await this.getTauriSuggestions(e,t):await this.getMCPSuggestions(e,t,"autocomplete_terms")}catch(o){return console.error("Error getting autocomplete suggestions:",o),[]}}async getTauriSuggestions(e,t){const o=await je("get_autocomplete_suggestions",{query:e.trim(),role_name:this.currentRole,limit:t});return console.log("Tauri autocomplete response:",o),o&&o.status==="success"&&o.suggestions?o.suggestions.map(n=>({text:n.term||n.text||"",snippet:n.url||n.snippet||"",score:n.score||1})).filter(n=>n.text.length>0):(o&&o.error&&console.error("Tauri autocomplete error:",o.error),[])}async getMCPSuggestions(e,t,o){const n=Date.now(),c=await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:n,method:"tools/call",params:{name:o,arguments:{query:e.trim(),limit:t,role:this.currentRole}}}),signal:AbortSignal.timeout(5e3)});if(!c.ok)return console.error(`MCP ${o} request failed:`,c.status,c.statusText),[];const r=await c.json();return console.log(`MCP ${o} response:`,r),r.result&&!r.result.is_error&&r.result.content?o==="autocomplete_with_snippets"?this.parseAutocompleteWithSnippetsContent(r.result.content):this.parseAutocompleteContent(r.result.content):(r.error&&console.error(`MCP ${o} error:`,r.error),[])}async getSuggestionsWithSnippets(e,t=10){if(!e||e.trim().length===0)return[];if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return console.warn("Autocomplete index not built, returning empty suggestions with snippets"),[];try{return Bt()?await this.getTauriSuggestions(e,t):await this.getMCPSuggestions(e,t,"autocomplete_with_snippets")}catch(o){return console.error("Error getting autocomplete suggestions with snippets:",o),[]}}extractLastWord(e){const t=e.trim().split(/\s+/);return t[t.length-1]||""}parseAutocompleteContent(e){const t=[];for(const o of e)if(o.type==="text"&&o.text){if(!o.text.startsWith("Found")&&!o.text.startsWith("‚Ä¢"))t.push({text:o.text.trim()});else if(o.text.startsWith("‚Ä¢")){const n=o.text.replace("‚Ä¢","").trim();n&&t.push({text:n})}}return t}parseAutocompleteWithSnippetsContent(e){const t=[];for(const o of e)if(o.type==="text"&&o.text){if(!o.text.startsWith("Found")&&!o.text.startsWith("‚Ä¢")){const n=o.text.split(" ‚Äî ");n.length===2?t.push({text:n[0].trim(),snippet:n[1].trim()}):t.push({text:o.text.trim()})}else if(o.text.startsWith("‚Ä¢")){const n=o.text.replace("‚Ä¢","").trim();n&&t.push({text:n})}}return t}isReady(){return this.autocompleteIndexBuilt}getStatus(){return{ready:this.autocompleteIndexBuilt,baseUrl:this.baseUrl,sessionId:this.sessionId,usingTauri:Bt(),currentRole:this.currentRole,connectionRetries:this.connectionRetries,isConnecting:this.isConnecting}}async refreshIndex(){return this.autocompleteIndexBuilt=!1,this.connectionRetries=0,await this.buildAutocompleteIndex()}async testConnection(){try{if(Bt()){const e=await je("get_autocomplete_suggestions",{query:"test",role_name:this.currentRole,limit:1});return e&&(e.status==="success"||e.status==="error")}else return(await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:Date.now(),method:"tools/list",params:{}}),signal:AbortSignal.timeout(3e3)})).ok}catch(e){return console.warn("Connection test failed:",e),!1}}}const Ot=new br;function kr(l){var e;const{char:t,allowSpaces:o,allowToIncludeChar:n,allowedPrefixes:c,startOfLine:r,$position:u}=l,i=o&&!n,d=Ps(t),p=new RegExp(`\\s${d}$`),m=r?"^":"",_=n?"":d,C=i?new RegExp(`${m}${d}.*?(?=\\s${_}|$)`,"gm"):new RegExp(`${m}(?:^)?${d}[^\\s${_}]*`,"gm"),g=((e=u.nodeBefore)===null||e===void 0?void 0:e.isText)&&u.nodeBefore.text;if(!g)return null;const y=u.pos-g.length,k=Array.from(g.matchAll(C)).pop();if(!k||k.input===void 0||k.index===void 0)return null;const w=k.input.slice(Math.max(0,k.index-1),k.index),b=new RegExp(`^[${c==null?void 0:c.join("")}\0]?$`).test(w);if(c!==null&&!b)return null;const h=y+k.index;let $=h+k[0].length;return i&&p.test(g.slice($-1,$+1))&&(k[0]+=" ",$+=1),h<u.pos&&$>=u.pos?{range:{from:h,to:$},query:k[0].slice(t.length),text:k[0]}:null}const wr=new os("suggestion");function yr({pluginKey:l=wr,editor:e,char:t="@",allowSpaces:o=!1,allowToIncludeChar:n=!1,allowedPrefixes:c=[" "],startOfLine:r=!1,decorationTag:u="span",decorationClass:i="suggestion",decorationContent:d="",decorationEmptyClass:p="is-empty",command:m=()=>null,items:_=()=>[],render:C=()=>({}),allow:g=()=>!0,findSuggestionMatch:y=kr}){let k;const w=C==null?void 0:C(),b=new As({key:l,view(){return{update:async(h,$)=>{var z,O,I,E,V,J,K;const T=(z=this.key)===null||z===void 0?void 0:z.getState($),L=(O=this.key)===null||O===void 0?void 0:O.getState(h.state),G=T.active&&L.active&&T.range.from!==L.range.from,S=!T.active&&L.active,j=T.active&&!L.active,B=!S&&!j&&T.query!==L.query,F=S||G&&B,Y=B||G,P=j||G&&B;if(!F&&!Y&&!P)return;const N=P&&!F?T:L,q=h.dom.querySelector(`[data-decoration-id="${N.decorationId}"]`);k={editor:e,range:N.range,query:N.query,text:N.text,items:[],command:W=>m({editor:e,range:N.range,props:W}),decorationNode:q,clientRect:q?()=>{var W;const{decorationId:X}=(W=this.key)===null||W===void 0?void 0:W.getState(e.state),U=h.dom.querySelector(`[data-decoration-id="${X}"]`);return(U==null?void 0:U.getBoundingClientRect())||null}:null},F&&((I=w==null?void 0:w.onBeforeStart)===null||I===void 0||I.call(w,k)),Y&&((E=w==null?void 0:w.onBeforeUpdate)===null||E===void 0||E.call(w,k)),(Y||F)&&(k.items=await _({editor:e,query:N.query})),P&&((V=w==null?void 0:w.onExit)===null||V===void 0||V.call(w,k)),Y&&((J=w==null?void 0:w.onUpdate)===null||J===void 0||J.call(w,k)),F&&((K=w==null?void 0:w.onStart)===null||K===void 0||K.call(w,k))},destroy:()=>{var h;k&&((h=w==null?void 0:w.onExit)===null||h===void 0||h.call(w,k))}}},state:{init(){return{active:!1,range:{from:0,to:0},query:null,text:null,composing:!1}},apply(h,$,z,O){const{isEditable:I}=e,{composing:E}=e.view,{selection:V}=h,{empty:J,from:K}=V,T={...$};if(T.composing=E,I&&(J||e.view.composing)){(K<$.range.from||K>$.range.to)&&!E&&!$.composing&&(T.active=!1);const L=y({char:t,allowSpaces:o,allowToIncludeChar:n,allowedPrefixes:c,startOfLine:r,$position:V.$from}),G=`id_${Math.floor(Math.random()*4294967295)}`;L&&g({editor:e,state:O,range:L.range,isActive:$.active})?(T.active=!0,T.decorationId=$.decorationId?$.decorationId:G,T.range=L.range,T.query=L.query,T.text=L.text):T.active=!1}else T.active=!1;return T.active||(T.decorationId=null,T.range={from:0,to:0},T.query=null,T.text=null),T}},props:{handleKeyDown(h,$){var z;const{active:O,range:I}=b.getState(h.state);return O&&((z=w==null?void 0:w.onKeyDown)===null||z===void 0?void 0:z.call(w,{view:h,event:$,range:I}))||!1},decorations(h){const{active:$,range:z,decorationId:O,query:I}=b.getState(h);if(!$)return null;const E=!(I!=null&&I.length),V=[i];return E&&V.push(p),Ls.create(h.doc,[Es.inline(z.from,z.to,{nodeName:u,class:V.join(" "),"data-decoration-id":O,"data-decoration-content":d})])}}});return b}const vo=Os.create({name:"terraphimSuggestion",addOptions(){return{trigger:"++",pluginKey:new os("terraphimSuggestion"),allowSpaces:!1,limit:8,minLength:1,debounce:300}},addCommands(){return{insertSuggestion:l=>({commands:e,chain:t})=>t().insertContent(l.text).run()}},addProseMirrorPlugins(){const l={editor:this.editor,char:this.options.trigger,pluginKey:this.options.pluginKey,allowSpaces:this.options.allowSpaces,startOfLine:!1,command:({editor:e,range:t,props:o})=>{const n=o;e.chain().focus().insertContentAt(t,n.text+" ").run()},items:async({query:e,editor:t})=>new Promise(o=>{setTimeout(async()=>{if(e.length<this.options.minLength){o([]);return}try{const n=await Ot.getSuggestionsWithSnippets(e,this.options.limit);console.log(`TerraphimSuggestion: Found ${n.length} suggestions for "${e}"`),o(n)}catch(n){console.error("TerraphimSuggestion: Error getting suggestions:",n),o([])}},this.options.debounce)}),render:()=>{let e,t;return{onStart:o=>{e=new $r({items:o.items,command:o.command}),o.clientRect&&(t=Ms("body",{getReferenceClientRect:o.clientRect,appendTo:()=>document.body,content:e.element,showOnCreate:!0,interactive:!0,trigger:"manual",placement:"bottom-start",theme:"terraphim-suggestion",maxWidth:"none"})[0])},onUpdate(o){e==null||e.updateItems(o.items),o.clientRect&&(t==null||t.setProps({getReferenceClientRect:o.clientRect}))},onKeyDown(o){return o.event.key==="Escape"?(t==null||t.hide(),!0):(e==null?void 0:e.onKeyDown(o))??!1},onExit(){t==null||t.destroy(),e==null||e.destroy()}}}};return[yr(l)]}});class $r{constructor(e){wt(this,"element");wt(this,"items",[]);wt(this,"selectedIndex",0);wt(this,"command");this.items=e.items,this.command=e.command,this.element=document.createElement("div"),this.element.className="terraphim-suggestion-dropdown",this.render()}updateItems(e){this.items=e,this.selectedIndex=0,this.render()}onKeyDown({event:e}){return e.key==="ArrowUp"?(this.selectPrevious(),!0):e.key==="ArrowDown"?(this.selectNext(),!0):e.key==="Enter"||e.key==="Tab"?(this.selectItem(this.selectedIndex),!0):!1}selectPrevious(){this.selectedIndex=Math.max(0,this.selectedIndex-1),this.render()}selectNext(){this.selectedIndex=Math.min(this.items.length-1,this.selectedIndex+1),this.render()}selectItem(e){const t=this.items[e];t&&this.command({id:t.text,...t})}render(){if(this.element.innerHTML="",this.items.length===0){this.element.innerHTML=`
        <div class="terraphim-suggestion-item terraphim-suggestion-empty">
          <div class="terraphim-suggestion-text">No suggestions found</div>
          <div class="terraphim-suggestion-hint">Try a different search term</div>
        </div>
      `;return}const e=document.createElement("div");e.className="terraphim-suggestion-header",e.innerHTML=`
      <div class="terraphim-suggestion-count">${this.items.length} suggestions</div>
      <div class="terraphim-suggestion-hint">‚Üë‚Üì Navigate ‚Ä¢ Tab/Enter Select ‚Ä¢ Esc Cancel</div>
    `,this.element.appendChild(e),this.items.forEach((t,o)=>{const n=document.createElement("div");n.className=`terraphim-suggestion-item ${o===this.selectedIndex?"terraphim-suggestion-selected":""}`,n.innerHTML=`
        <div class="terraphim-suggestion-main">
          <div class="terraphim-suggestion-text">${this.escapeHtml(t.text)}</div>
          ${t.snippet?`<div class="terraphim-suggestion-snippet">${this.escapeHtml(t.snippet)}</div>`:""}
        </div>
        ${t.score?`<div class="terraphim-suggestion-score">${Math.round(t.score*100)}%</div>`:""}
      `,n.addEventListener("click",()=>this.selectItem(o)),n.addEventListener("mouseenter",()=>{this.selectedIndex=o,this.render()}),this.element.appendChild(n)})}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}destroy(){this.element.remove()}}const Cr=`
.terraphim-suggestion-dropdown {
  background: white;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  box-shadow: 0 10px 38px -10px rgba(22, 23, 24, 0.35), 0 10px 20px -15px rgba(22, 23, 24, 0.2);
  max-height: 300px;
  min-width: 300px;
  overflow-y: auto;
  z-index: 1000;
}

.terraphim-suggestion-header {
  padding: 8px 12px;
  border-bottom: 1px solid #f1f5f9;
  background: #f8fafc;
  font-size: 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.terraphim-suggestion-count {
  font-weight: 600;
  color: #475569;
}

.terraphim-suggestion-hint {
  color: #64748b;
}

.terraphim-suggestion-item {
  padding: 8px 12px;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  border-bottom: 1px solid #f1f5f9;
}

.terraphim-suggestion-item:hover {
  background: #f8fafc;
}

.terraphim-suggestion-selected {
  background: #eff6ff !important;
  border-left: 3px solid #3b82f6;
}

.terraphim-suggestion-empty {
  color: #64748b;
  font-style: italic;
  text-align: center;
  cursor: default;
}

.terraphim-suggestion-main {
  flex: 1;
}

.terraphim-suggestion-text {
  font-weight: 500;
  color: #1e293b;
  margin-bottom: 2px;
}

.terraphim-suggestion-snippet {
  font-size: 12px;
  color: #64748b;
  line-height: 1.3;
}

.terraphim-suggestion-score {
  font-size: 11px;
  color: #10b981;
  font-weight: 600;
  background: #ecfdf5;
  padding: 2px 6px;
  border-radius: 4px;
  margin-left: 8px;
}

/* Dark theme support */
@media (prefers-color-scheme: dark) {
  .terraphim-suggestion-dropdown {
    background: #1e293b;
    border-color: #334155;
  }

  .terraphim-suggestion-header {
    background: #0f172a;
    border-color: #334155;
  }

  .terraphim-suggestion-item:hover {
    background: #334155;
  }

  .terraphim-suggestion-selected {
    background: #1e40af !important;
  }

  .terraphim-suggestion-text {
    color: #f1f5f9;
  }

  .terraphim-suggestion-snippet {
    color: #94a3b8;
  }
}

/* Tippy.js theme */
.tippy-box[data-theme~='terraphim-suggestion'] {
  background: transparent;
  box-shadow: none;
}

.tippy-box[data-theme~='terraphim-suggestion'] > .tippy-backdrop {
  background: transparent;
}

.tippy-box[data-theme~='terraphim-suggestion'] > .tippy-arrow {
  display: none;
}
`;function bo(l){let e,t,o,n,c,r,u,i,d,p,m,_,C,g,y,k,w,b,h,$,z,O,I,E,V,J,K=l[12]?"Tauri (native)":`MCP Server (${Ot.getStatus().baseUrl})`,T,L,G,S,j,B,F,Y,P,N,q,W,X,U,oe,ge,we,he,fe,se,ue=l[6]!==1?"s":"",ke,Ce,te,ie,ae,ce,Ee,Fe,Ke,Pe,Re,x,ne,Se,Ae,xe,Ie,ut,ot=l[3]?"Enabled":"Disabled",gt,Ye,nt,ft,Ue=l[11]&&!l[8]&&ko(l);function Rt(H,re){if(H[8])return Ar;if(H[11])return Rr}let M=Rt(l),le=M&&M(l);return{c(){e=f("div"),t=f("div"),o=f("strong"),o.textContent="Local Autocomplete Status:",n=v(),c=f("div"),r=f("button"),u=D("Test"),d=v(),p=f("button"),p.textContent="Rebuild Index",m=v(),_=f("button"),C=D("Demo"),y=v(),k=f("div"),w=D(l[10]),b=v(),Ue&&Ue.c(),h=v(),$=f("div"),z=f("strong"),z.textContent="Configuration:",O=v(),I=f("br"),E=D("‚Ä¢ "),V=f("strong"),V.textContent="Backend:",J=v(),T=D(K),L=v(),G=f("br"),S=D("‚Ä¢ "),j=f("strong"),j.textContent="Role:",B=v(),F=D(l[9]),Y=v(),P=f("br"),N=D("‚Ä¢ "),q=f("strong"),q.textContent="Trigger:",W=D(' "'),X=D(l[4]),U=D(`" + text
      `),oe=f("br"),ge=D("‚Ä¢ "),we=f("strong"),we.textContent="Min Length:",he=v(),fe=D(l[6]),se=D(" character"),ke=D(ue),Ce=v(),te=f("br"),ie=D("‚Ä¢ "),ae=f("strong"),ae.textContent="Max Results:",ce=v(),Ee=D(l[5]),Fe=v(),Ke=f("br"),Pe=D("‚Ä¢ "),Re=f("strong"),Re.textContent="Debounce:",x=v(),ne=D(l[7]),Se=D(`ms
      `),Ae=f("br"),xe=D("‚Ä¢ "),Ie=f("strong"),Ie.textContent="Snippets:",ut=v(),gt=D(ot),Ye=v(),le&&le.c(),de(o,"color","#495057"),de(r,"padding","4px 8px"),de(r,"background","#007bff"),de(r,"color","white"),de(r,"border","none"),de(r,"border-radius","4px"),de(r,"cursor","pointer"),de(r,"font-size","12px"),r.disabled=i=!l[8],de(p,"padding","4px 8px"),de(p,"background","#28a745"),de(p,"color","white"),de(p,"border","none"),de(p,"border-radius","4px"),de(p,"cursor","pointer"),de(p,"font-size","12px"),de(_,"padding","4px 8px"),de(_,"background","#ffc107"),de(_,"color","#212529"),de(_,"border","none"),de(_,"border-radius","4px"),de(_,"cursor","pointer"),de(_,"font-size","12px"),_.disabled=g=!l[8],de(c,"display","flex"),de(c,"gap","8px"),de(t,"display","flex"),de(t,"justify-content","space-between"),de(t,"align-items","center"),de(t,"margin-bottom","8px"),de(k,"font-size","13px"),de(k,"color","#6c757d"),de(k,"margin-bottom","8px"),de(k,"font-family","monospace"),de($,"font-size","12px"),de($,"color","#6c757d"),de(e,"margin-top","10px"),de(e,"padding","12px"),de(e,"background","#f8f9fa"),de(e,"border-radius","6px"),de(e,"border","1px solid #e9ecef")},m(H,re){A(H,e,re),s(e,t),s(t,o),s(t,n),s(t,c),s(c,r),s(r,u),s(c,d),s(c,p),s(c,m),s(c,_),s(_,C),s(e,y),s(e,k),s(k,w),s(e,b),Ue&&Ue.m(e,null),s(e,h),s(e,$),s($,z),s($,O),s($,I),s($,E),s($,V),s($,J),s($,T),s($,L),s($,G),s($,S),s($,j),s($,B),s($,F),s($,Y),s($,P),s($,N),s($,q),s($,W),s($,X),s($,U),s($,oe),s($,ge),s($,we),s($,he),s($,fe),s($,se),s($,ke),s($,Ce),s($,te),s($,ie),s($,ae),s($,ce),s($,Ee),s($,Fe),s($,Ke),s($,Pe),s($,Re),s($,x),s($,ne),s($,Se),s($,Ae),s($,xe),s($,Ie),s($,ut),s($,gt),s(e,Ye),le&&le.m(e,null),nt||(ft=[ee(r,"click",l[14]),ee(p,"click",l[15]),ee(_,"click",l[16])],nt=!0)},p(H,re){re&256&&i!==(i=!H[8])&&(r.disabled=i),re&256&&g!==(g=!H[8])&&(_.disabled=g),re&1024&&ve(w,H[10]),H[11]&&!H[8]?Ue?Ue.p(H,re):(Ue=ko(H),Ue.c(),Ue.m(e,h)):Ue&&(Ue.d(1),Ue=null),re&4096&&K!==(K=H[12]?"Tauri (native)":`MCP Server (${Ot.getStatus().baseUrl})`)&&ve(T,K),re&512&&ve(F,H[9]),re&16&&ve(X,H[4]),re&64&&ve(fe,H[6]),re&64&&ue!==(ue=H[6]!==1?"s":"")&&ve(ke,ue),re&32&&ve(Ee,H[5]),re&128&&ve(ne,H[7]),re&8&&ot!==(ot=H[3]?"Enabled":"Disabled")&&ve(gt,ot),M===(M=Rt(H))&&le?le.p(H,re):(le&&le.d(1),le=M&&M(H),le&&(le.c(),le.m(e,null)))},d(H){H&&R(e),Ue&&Ue.d(),le&&le.d(),nt=!1,Qe(ft)}}}function ko(l){let e,t,o,n;function c(i,d){return i[12]?Tr:Sr}let r=c(l),u=r(l);return{c(){e=f("div"),t=f("strong"),t.textContent="‚ö†Ô∏è Autocomplete Not Available",o=f("br"),n=v(),u.c(),de(e,"font-size","12px"),de(e,"color","#dc3545"),de(e,"margin-bottom","8px"),de(e,"padding","6px"),de(e,"background","#f8d7da"),de(e,"border-radius","4px")},m(i,d){A(i,e,d),s(e,t),s(e,o),s(e,n),u.m(e,null)},p(i,d){r===(r=c(i))&&u?u.p(i,d):(u.d(1),u=r(i),u&&(u.c(),u.m(e,null)))},d(i){i&&R(e),u.d()}}}function Sr(l){let e,t=Ot.getStatus().baseUrl+"",o;return{c(){e=D("MCP server not responding. Ensure the server is running on "),o=D(t)},m(n,c){A(n,e,c),A(n,o,c)},p:Te,d(n){n&&R(e),n&&R(o)}}}function Tr(l){let e;return{c(){e=D("Tauri backend connection failed. Ensure the application has proper permissions.")},m(t,o){A(t,e,o)},p:Te,d(t){t&&R(e)}}}function Rr(l){let e;return{c(){e=f("div"),e.innerHTML=`<strong>‚ùå Autocomplete Unavailable</strong> 
        <div style="font-size: 11px; margin-top: 4px; color: #721c24;">Click &quot;Rebuild Index&quot; to retry or check server/backend status.</div>`,de(e,"margin-top","8px"),de(e,"padding","8px"),de(e,"background","#f8d7da"),de(e,"border","1px solid #f5c6cb"),de(e,"border-radius","4px")},m(t,o){A(t,e,o)},p:Te,d(t){t&&R(e)}}}function Ar(l){let e,t,o,n,c,r,u,i,d,p,m,_,C,g,y,k,w;return{c(){e=f("div"),t=f("strong"),t.textContent="üéØ Autocomplete Active",o=v(),n=f("div"),c=D("Type "),r=f("code"),u=D(l[4]),i=D(" in the editor above to trigger suggestions."),d=f("br"),p=D(`
          Example: `),m=f("code"),_=D(l[4]),C=D("terraphim"),g=D(" or "),y=f("code"),k=D(l[4]),w=D("graph"),de(n,"font-size","11px"),de(n,"margin-top","4px"),de(n,"color","#0056b3"),de(e,"margin-top","8px"),de(e,"padding","8px"),de(e,"background","#d1edff"),de(e,"border","1px solid #b3d9ff"),de(e,"border-radius","4px")},m(b,h){A(b,e,h),s(e,t),s(e,o),s(e,n),s(n,c),s(n,r),s(r,u),s(n,i),s(n,d),s(n,p),s(n,m),s(m,_),s(m,C),s(n,g),s(n,y),s(y,k),s(y,w)},p(b,h){h&16&&ve(u,b[4]),h&16&&ve(_,b[4]),h&16&&ve(k,b[4])},d(b){b&&R(e)}}}function Lr(l){let e,t,o,n;e=new js({props:{defaultValue:l[0],isEditable:!l[1],disableLocalStorage:!0,onUpdate:l[13],extensions:[fo,...l[2]?[vo.configure({trigger:l[4],allowSpaces:!1,limit:l[5],minLength:l[6],debounce:l[7]})]:[]]}});let c=l[2]&&bo(l);return{c(){pe(e.$$.fragment),t=v(),c&&c.c(),o=lt()},m(r,u){me(e,r,u),A(r,t,u),c&&c.m(r,u),A(r,o,u),n=!0},p(r,[u]){const i={};u&1&&(i.defaultValue=r[0]),u&2&&(i.isEditable=!r[1]),u&244&&(i.extensions=[fo,...r[2]?[vo.configure({trigger:r[4],allowSpaces:!1,limit:r[5],minLength:r[6],debounce:r[7]})]:[]]),e.$set(i),r[2]?c?c.p(r,u):(c=bo(r),c.c(),c.m(o.parentNode,o)):c&&(c.d(1),c=null)},i(r){n||(Q(e.$$.fragment,r),n=!0)},o(r){Z(e.$$.fragment,r),n=!1},d(r){_e(e,r),r&&R(t),c&&c.d(r),r&&R(o)}}}function Er(l,e,t){let o,n;Oe(l,St,E=>t(9,o=E)),Oe(l,Je,E=>t(12,n=E));let{html:c=""}=e,{readOnly:r=!1}=e,{outputFormat:u="html"}=e,{enableAutocomplete:i=!0}=e,{showSnippets:d=!0}=e,{suggestionTrigger:p="++"}=e,{maxSuggestions:m=8}=e,{minQueryLength:_=1}=e,{debounceDelay:C=300}=e,g=null,y="‚è≥ Initializing...",k=!1,w=!1,b=null;Jt(async()=>{i&&await h(),typeof document<"u"&&(b=document.createElement("style"),b.textContent=Cr,document.head.appendChild(b))}),ws(()=>{b&&b.parentNode&&b.parentNode.removeChild(b)});async function h(){t(10,y="‚è≥ Initializing autocomplete..."),t(8,k=!1),t(11,w=!1);try{Ot.setRole(o),t(10,y="üîó Testing connection...");const E=await Ot.testConnection();t(11,w=!0),E?(t(10,y="üî® Building autocomplete index..."),await Ot.buildAutocompleteIndex()?(n?t(10,y="‚úÖ Ready - Using Tauri backend"):t(10,y="‚úÖ Ready - Using MCP server backend"),t(8,k=!0)):t(10,y="‚ùå Failed to build autocomplete index")):n?t(10,y="‚ùå Tauri backend not available"):t(10,y="‚ùå MCP server not responding")}catch(E){console.error("Error initializing autocomplete:",E),t(10,y="‚ùå Autocomplete initialization error")}}const $=E=>{g=E,u==="markdown"?t(0,c=E.storage.markdown.getMarkdown()):t(0,c=E.getHTML())},z=async()=>{if(!w){alert("Please wait for connection test to complete");return}if(!k){alert("Autocomplete service not ready. Check the status above.");return}try{t(10,y="üß™ Testing autocomplete...");const E="terraphim",V=await Ot.getSuggestions(E,5);if(console.log("Autocomplete test results:",V),V.length>0){const J=V.map((K,T)=>`${T+1}. ${K.text}${K.snippet?` (${K.snippet})`:""}`).join(`
`);alert(`‚úÖ Found ${V.length} suggestions for '${E}':

${J}`),n?t(10,y="‚úÖ Ready - Using Tauri backend"):t(10,y="‚úÖ Ready - Using MCP server backend")}else alert(`‚ö†Ô∏è No suggestions found for '${E}'. This might be normal if the term isn't in your knowledge graph.`)}catch(E){console.error("Autocomplete test failed:",E),alert(`‚ùå Autocomplete test failed: ${E.message}`),t(10,y="‚ùå Test failed - check console for details")}},O=async()=>{t(10,y="‚è≥ Rebuilding index..."),t(8,k=!1);try{await Ot.refreshIndex()?(n?t(10,y="‚úÖ Ready - Tauri index rebuilt successfully"):t(10,y="‚úÖ Ready - MCP server index rebuilt successfully"),t(8,k=!0)):t(10,y="‚ùå Failed to rebuild index")}catch(E){console.error("Error rebuilding index:",E),t(10,y="‚ùå Index rebuild failed - check console for details")}},I=()=>{if(!g){alert("Editor not ready yet");return}const E=`# Terraphim Autocomplete Demo

This is a demonstration of the integrated Terraphim autocomplete system.

## How to Use:
1. Type "${p}" to trigger autocomplete
2. Start typing any term (e.g., "${p}terraphim", "${p}graph")
3. Use ‚Üë‚Üì arrows to navigate suggestions
4. Press Tab or Enter to select
5. Press Esc to cancel

## Try these queries:
- ${p}terraphim
- ${p}graph
- ${p}service
- ${p}automata
- ${p}role

The autocomplete system uses your local knowledge graph to provide intelligent suggestions based on your selected role: **${o}**.

---

Start typing below:`;g.commands.setContent(E),setTimeout(()=>{g.commands.focus("end")},100),alert(`Demo content inserted!

Type "${p}" followed by any term to see autocomplete suggestions.

Example: "${p}terraphim"`)};return l.$$set=E=>{"html"in E&&t(0,c=E.html),"readOnly"in E&&t(1,r=E.readOnly),"outputFormat"in E&&t(17,u=E.outputFormat),"enableAutocomplete"in E&&t(2,i=E.enableAutocomplete),"showSnippets"in E&&t(3,d=E.showSnippets),"suggestionTrigger"in E&&t(4,p=E.suggestionTrigger),"maxSuggestions"in E&&t(5,m=E.maxSuggestions),"minQueryLength"in E&&t(6,_=E.minQueryLength),"debounceDelay"in E&&t(7,C=E.debounceDelay)},l.$$.update=()=>{l.$$.dirty&772&&o&&i&&k&&(Ot.setRole(o),h())},[c,r,i,d,p,m,_,C,k,o,y,w,n,$,z,O,I,u]}class Pr extends _t{constructor(e){super(),ht(this,e,Er,Lr,ct,{html:0,readOnly:1,outputFormat:17,enableAutocomplete:2,showSnippets:3,suggestionTrigger:4,maxSuggestions:5,minQueryLength:6,debounceDelay:7})}}function wo(l){let e,t,o,n,c,r,u,i,d,p,m;return{c(){e=f("div"),t=f("h3"),o=f("span"),o.textContent="Knowledge Graph",n=D(`
          Term: `),c=f("strong"),r=D(l[2]),u=D(" | Rank: "),i=f("strong"),d=D(l[3]),p=v(),m=f("hr"),a(o,"class","tag is-info svelte-329px1"),a(t,"class","subtitle is-6 svelte-329px1"),a(m,"class","svelte-329px1"),a(e,"class","kg-context svelte-329px1")},m(_,C){A(_,e,C),s(e,t),s(t,o),s(t,n),s(t,c),s(c,r),s(t,u),s(t,i),s(i,d),s(e,p),s(e,m)},p(_,C){C&4&&ve(r,_[2]),C&8&&ve(d,_[3])},d(_){_&&R(e)}}}function Or(l){let e,t,o,n,c,r,u,i;const d=[Ur,Nr],p=[];function m(_,C){return _[5]?0:1}return t=m(l),o=p[t]=d[t](l),{c(){e=f("div"),o.c(),n=v(),c=f("div"),c.innerHTML='<span class="hint-text svelte-329px1">Double-click to edit ‚Ä¢ Ctrl+E to edit ‚Ä¢ Ctrl+S to save ‚Ä¢ Click KG links to explore</span>',a(c,"class","edit-hint svelte-329px1"),a(e,"class","content-viewer svelte-329px1"),a(e,"tabindex","0"),a(e,"role","button"),a(e,"aria-label","Double-click to edit article content")},m(_,C){A(_,e,C),p[t].m(e,null),s(e,n),s(e,c),l[20](e),r=!0,u||(i=[ee(e,"dblclick",l[14]),ee(e,"keydown",l[15]),ee(e,"click",l[13])],u=!0)},p(_,C){let g=t;t=m(_),t===g?p[t].p(_,C):(qe(),Z(p[g],1,1,()=>{p[g]=null}),Ge(),o=p[t],o?o.p(_,C):(o=p[t]=d[t](_),o.c()),Q(o,1),o.m(e,n))},i(_){r||(Q(o),r=!0)},o(_){Z(o),r=!1},d(_){_&&R(e),p[t].d(),l[20](null),u=!1,Qe(i)}}}function Ir(l){let e,t,o,n,c,r,u,i,d,p;function m(C){l[18](C)}let _={outputFormat:l[11]};return l[1].body!==void 0&&(_.html=l[1].body),e=new Pr({props:_}),Xe.push(()=>et(e,"html",m)),{c(){pe(e.$$.fragment),o=v(),n=f("div"),c=f("button"),c.textContent="Save",r=v(),u=f("button"),u.textContent="Cancel",a(c,"class","button is-primary"),a(u,"class","button is-light"),a(n,"class","edit-controls svelte-329px1")},m(C,g){me(e,C,g),A(C,o,g),A(C,n,g),s(n,c),s(n,r),s(n,u),i=!0,d||(p=[ee(c,"click",l[12]),ee(u,"click",l[19])],d=!0)},p(C,g){const y={};g&2048&&(y.outputFormat=C[11]),!t&&g&2&&(t=!0,y.html=C[1].body,tt(()=>t=!1)),e.$set(y)},i(C){i||(Q(e.$$.fragment,C),i=!0)},o(C){Z(e.$$.fragment,C),i=!1},d(C){_e(e,C),C&&R(o),C&&R(n),d=!1,Qe(p)}}}function Nr(l){let e,t,o;return t=new Il({props:{source:l[1].body}}),{c(){e=f("div"),pe(t.$$.fragment),a(e,"class","markdown-content svelte-329px1")},m(n,c){A(n,e,c),me(t,e,null),o=!0},p(n,c){const r={};c&2&&(r.source=n[1].body),t.$set(r)},i(n){o||(Q(t.$$.fragment,n),o=!0)},o(n){Z(t.$$.fragment,n),o=!1},d(n){n&&R(e),_e(t)}}}function Ur(l){let e,t=l[1].body+"";return{c(){e=f("div"),a(e,"class","prose svelte-329px1")},m(o,n){A(o,e,n),e.innerHTML=t},p(o,n){n&2&&t!==(t=o[1].body+"")&&(e.innerHTML=t)},i:Te,o:Te,d(o){o&&R(e)}}}function Dr(l){let e,t,o,n,c,r=l[1].title+"",u,i,d,p,m,_,C,g=l[2]&&l[3]!==null&&wo(l);const y=[Ir,Or],k=[];function w(b,h){return b[4]?0:1}return d=w(l),p=k[d]=y[d](l),{c(){e=f("div"),t=f("button"),o=v(),g&&g.c(),n=v(),c=f("h2"),u=D(r),i=v(),p.c(),a(t,"class","delete is-large modal-close-btn svelte-329px1"),a(t,"aria-label","close"),a(c,"class","svelte-329px1"),a(e,"class","box wrapper svelte-329px1")},m(b,h){A(b,e,h),s(e,t),s(e,o),g&&g.m(e,null),s(e,n),s(e,c),s(c,u),s(e,i),k[d].m(e,null),m=!0,_||(C=ee(t,"click",l[17]),_=!0)},p(b,h){b[2]&&b[3]!==null?g?g.p(b,h):(g=wo(b),g.c(),g.m(e,n)):g&&(g.d(1),g=null),(!m||h&2)&&r!==(r=b[1].title+"")&&ve(u,r);let $=d;d=w(b),d===$?k[d].p(b,h):(qe(),Z(k[$],1,1,()=>{k[$]=null}),Ge(),p=k[d],p?p.p(b,h):(p=k[d]=y[d](b),p.c()),Q(p,1),p.m(e,null))},i(b){m||(Q(p),m=!0)},o(b){Z(p),m=!1},d(b){b&&R(e),g&&g.d(),k[d].d(),_=!1,C()}}}function yo(l){let e,t,o;function n(r){l[23](r)}let c={$$slots:{default:[Hr]},$$scope:{ctx:l}};return l[7]!==void 0&&(c.active=l[7]),e=new jl({props:c}),Xe.push(()=>et(e,"active",n)),{c(){pe(e.$$.fragment)},m(r,u){me(e,r,u),o=!0},p(r,u){const i={};u&536872832&&(i.$$scope={dirty:u,ctx:r}),!t&&u&128&&(t=!0,i.active=r[7],tt(()=>t=!1)),e.$set(i)},i(r){o||(Q(e.$$.fragment,r),o=!0)},o(r){Z(e.$$.fragment,r),o=!1},d(r){_e(e,r)}}}function $o(l){let e,t,o,n,c,r,u,i,d,p,m;return{c(){e=f("div"),t=f("h3"),o=f("span"),o.textContent="Knowledge Graph",n=D(`
            Term: `),c=f("strong"),r=D(l[9]),u=D(" | Rank: "),i=f("strong"),d=D(l[10]),p=v(),m=f("hr"),a(o,"class","tag is-info svelte-329px1"),a(t,"class","subtitle is-6 svelte-329px1"),a(m,"class","svelte-329px1"),a(e,"class","kg-context svelte-329px1")},m(_,C){A(_,e,C),s(e,t),s(t,o),s(t,n),s(t,c),s(c,r),s(t,u),s(t,i),s(i,d),s(e,p),s(e,m)},p(_,C){C&512&&ve(r,_[9]),C&1024&&ve(d,_[10])},d(_){_&&R(e)}}}function Mr(l){let e,t,o;return t=new Il({props:{source:l[8].body}}),{c(){e=f("div"),pe(t.$$.fragment),a(e,"class","markdown-content svelte-329px1")},m(n,c){A(n,e,c),me(t,e,null),o=!0},p(n,c){const r={};c&256&&(r.source=n[8].body),t.$set(r)},i(n){o||(Q(t.$$.fragment,n),o=!0)},o(n){Z(t.$$.fragment,n),o=!1},d(n){n&&R(e),_e(t)}}}function jr(l){let e,t=l[8].body+"";return{c(){e=f("div"),a(e,"class","prose svelte-329px1")},m(o,n){A(o,e,n),e.innerHTML=t},p(o,n){n&256&&t!==(t=o[8].body+"")&&(e.innerHTML=t)},i:Te,o:Te,d(o){o&&R(e)}}}function Hr(l){let e,t,o,n,c,r=l[8].title+"",u,i,d,p,m,_,C,g,y,k,w,b=l[9]&&l[10]!==null&&$o(l);const h=[jr,Mr],$=[];function z(O,I){return I&256&&(p=null),p==null&&(p=!!(O[8].body&&(/<html/i.test(O[8].body)||/<body/i.test(O[8].body)||/<head/i.test(O[8].body)))),p?0:1}return m=z(l,-1),_=$[m]=h[m](l),{c(){e=f("div"),t=f("button"),o=v(),b&&b.c(),n=v(),c=f("h2"),u=D(r),i=v(),d=f("div"),_.c(),C=v(),g=f("div"),g.innerHTML='<span class="hint-text svelte-329px1">Knowledge Graph document ‚Ä¢ Click KG links to explore further</span>',a(t,"class","delete is-large modal-close-btn svelte-329px1"),a(t,"aria-label","close"),a(c,"class","svelte-329px1"),a(g,"class","edit-hint svelte-329px1"),a(d,"class","content-viewer svelte-329px1"),a(d,"tabindex","0"),a(d,"role","button"),a(d,"aria-label","KG document content - click KG links to explore further"),a(e,"class","box wrapper svelte-329px1")},m(O,I){A(O,e,I),s(e,t),s(e,o),b&&b.m(e,null),s(e,n),s(e,c),s(c,u),s(e,i),s(e,d),$[m].m(d,null),s(d,C),s(d,g),y=!0,k||(w=[ee(t,"click",l[22]),ee(d,"click",l[13])],k=!0)},p(O,I){O[9]&&O[10]!==null?b?b.p(O,I):(b=$o(O),b.c(),b.m(e,n)):b&&(b.d(1),b=null),(!y||I&256)&&r!==(r=O[8].title+"")&&ve(u,r);let E=m;m=z(O,I),m===E?$[m].p(O,I):(qe(),Z($[E],1,1,()=>{$[E]=null}),Ge(),_=$[m],_?_.p(O,I):(_=$[m]=h[m](O),_.c()),Q(_,1),_.m(d,C))},i(O){y||(Q(_),y=!0)},o(O){Z(_),y=!1},d(O){O&&R(e),b&&b.d(),$[m].d(),k=!1,Qe(w)}}}function zr(l){let e,t,o,n,c;function r(d){l[21](d)}let u={$$slots:{default:[Dr]},$$scope:{ctx:l}};l[0]!==void 0&&(u.active=l[0]),e=new jl({props:u}),Xe.push(()=>et(e,"active",r));let i=l[8]&&yo(l);return{c(){pe(e.$$.fragment),o=v(),i&&i.c(),n=lt()},m(d,p){me(e,d,p),A(d,o,p),i&&i.m(d,p),A(d,n,p),c=!0},p(d,[p]){const m={};p&536873087&&(m.$$scope={dirty:p,ctx:d}),!t&&p&1&&(t=!0,m.active=d[0],tt(()=>t=!1)),e.$set(m),d[8]?i?(i.p(d,p),p&256&&Q(i,1)):(i=yo(d),i.c(),Q(i,1),i.m(n.parentNode,n)):i&&(qe(),Z(i,1,1,()=>{i=null}),Ge())},i(d){c||(Q(e.$$.fragment,d),Q(i),c=!0)},o(d){Z(e.$$.fragment,d),Z(i),c=!1},d(d){_e(e,d),d&&R(o),i&&i.d(d),d&&R(n)}}}function Fr(l,e,t){let o,n,c,r;Oe(l,Je,S=>t(25,c=S)),Oe(l,St,S=>t(26,r=S));let{active:u=!1}=e,{item:i}=e,{initialEdit:d=!1}=e,{kgTerm:p=null}=e,{kgRank:m=null}=e,_=!1,C,g=!1,y=null,k=null,w=null;async function b(){if(c)try{const S=await je("get_document",{documentId:i.id});S!=null&&S.document&&t(1,i=S.document)}catch(S){console.error("Failed to load document",S)}}async function h(){if(!c){t(4,_=!1);return}try{await je("create_document",{document:i}),t(4,_=!1)}catch(S){console.error("Failed to save document",S)}}async function $(S){var j,B,F,Y,P;t(9,k=S),console.log("üîç KG Link Click Debug Info:"),console.log("  Term clicked:",S),console.log("  Current role:",r),console.log("  Is Tauri mode:",c);try{if(c){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:r,term:S});const N=await je("find_documents_for_kg_term",{roleName:r,term:S});console.log("  üì• Tauri response received:"),console.log("    Status:",N.status),console.log("    Results count:",((j=N.results)==null?void 0:j.length)||0),console.log("    Total:",N.total||0),console.log("    Full response:",JSON.stringify(N,null,2)),N.status==="success"&&N.results&&N.results.length>0?(t(8,y=N.results[0]),t(10,w=y.rank||0),console.log("  ‚úÖ Found KG document:"),console.log("    Title:",y.title),console.log("    Rank:",w),console.log("    Body length:",((B=y.body)==null?void 0:B.length)||0,"characters"),t(7,g=!0)):(console.warn(`  ‚ö†Ô∏è  No KG documents found for term: "${S}" in role: "${r}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const N=Ze.ServerURL,q=encodeURIComponent(r),W=encodeURIComponent(S),X=`${N}/roles/${q}/kg_search?term=${W}`;console.log("  üì§ HTTP Request details:"),console.log("    Base URL:",N),console.log("    Role (encoded):",q),console.log("    Term (encoded):",W),console.log("    Full URL:",X);const U=await fetch(X);if(console.log("  üì• HTTP Response received:"),console.log("    Status code:",U.status),console.log("    Status text:",U.statusText),console.log("    Headers:",Object.fromEntries(U.headers.entries())),!U.ok)throw new Error(`HTTP error! Status: ${U.status} - ${U.statusText}`);const oe=await U.json();console.log("  üìÑ Response data:"),console.log("    Status:",oe.status),console.log("    Results count:",((F=oe.results)==null?void 0:F.length)||0),console.log("    Total:",oe.total||0),console.log("    Full response:",JSON.stringify(oe,null,2)),oe.status==="success"&&oe.results&&oe.results.length>0?(t(8,y=oe.results[0]),t(10,w=y.rank||0),console.log("  ‚úÖ Found KG document:"),console.log("    Title:",y.title),console.log("    Rank:",w),console.log("    Body length:",((Y=y.body)==null?void 0:Y.length)||0,"characters"),t(7,g=!0)):(console.warn(`  ‚ö†Ô∏è  No KG documents found for term: "${S}" in role: "${r}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",X))}}catch(N){console.error("‚ùå Error fetching KG document:"),console.error("  Error type:",N.constructor.name),console.error("  Error message:",N.message||N),console.error("  Request details:",{term:S,role:r,isTauri:c,timestamp:new Date().toISOString()}),!c&&((P=N.message)!=null&&P.includes("Failed to fetch"))&&(console.error("  üí° Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{}}function z(S){const j=S.target;if(j.tagName==="A"){const B=j.getAttribute("href");if(B&&B.startsWith("kg:")){S.preventDefault();const F=B.substring(3);$(F)}}}function O(){t(4,_=!0)}function I(S){S.type!=="dblclick"&&((S.ctrlKey||S.metaKey)&&S.key==="e"&&(S.preventDefault(),t(4,_=!0)),_&&(S.ctrlKey||S.metaKey)&&S.key==="s"&&(S.preventDefault(),h()),S.key==="Escape"&&(S.preventDefault(),_?t(4,_=!1):t(0,u=!1)))}const E=()=>t(0,u=!1);function V(S){l.$$.not_equal(i.body,S)&&(i.body=S,t(1,i))}const J=()=>t(4,_=!1);function K(S){Xe[S?"unshift":"push"](()=>{C=S,t(6,C)})}function T(S){u=S,t(0,u)}const L=()=>t(7,g=!1);function G(S){g=S,t(7,g)}return l.$$set=S=>{"active"in S&&t(0,u=S.active),"item"in S&&t(1,i=S.item),"initialEdit"in S&&t(16,d=S.initialEdit),"kgTerm"in S&&t(2,p=S.kgTerm),"kgRank"in S&&t(3,m=S.kgRank)},l.$$.update=()=>{l.$$.dirty&65537&&u&&d&&t(4,_=!0),l.$$.dirty&19&&u&&i&&!_&&b(),l.$$.dirty&2&&t(5,o=i!=null&&i.body?/<html/i.test(i.body)||/<body/i.test(i.body)||/<head/i.test(i.body)||/^\s*<(!DOCTYPE|html|head|body|div|p|span)/i.test(i.body.trim()):!1),l.$$.dirty&32&&t(11,n=o?"html":"markdown")},[u,i,p,m,_,o,C,g,y,k,w,n,h,z,O,I,d,E,V,J,K,T,L,G]}class zl extends _t{constructor(e){super(),ht(this,e,Fr,zr,ct,{active:0,item:1,initialEdit:16,kgTerm:2,kgRank:3})}}function Co(l,e,t){const o=l.slice();return o[33]=e[t],o}function So(l,e,t){const o=l.slice();return o[36]=e[t],o}function To(l,e,t){const o=l.slice();return o[39]=e[t],o}function Ro(l){let e,t;return e=new Xn({props:{type:"is-success",$$slots:{default:[Kr]},$$scope:{ctx:l}}}),{c(){pe(e.$$.fragment)},m(o,n){me(e,o,n),t=!0},i(o){t||(Q(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){_e(e,o)}}}function Kr(l){let e,t,o;return{c(){e=f("p"),e.innerHTML="<strong>Success!</strong> Article saved to atomic server successfully.",t=v(),o=f("p"),o.textContent="The modal will close automatically..."},m(n,c){A(n,e,c),A(n,t,c),A(n,o,c)},p:Te,d(n){n&&R(e),n&&R(t),n&&R(o)}}}function Ao(l){let e,t;return e=new Xn({props:{type:"is-danger",$$slots:{default:[Wr]},$$scope:{ctx:l}}}),{c(){pe(e.$$.fragment)},m(o,n){me(e,o,n),t=!0},p(o,n){const c={};n[0]&8|n[1]&2048&&(c.$$scope={dirty:n,ctx:o}),e.$set(c)},i(o){t||(Q(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){_e(e,o)}}}function Wr(l){let e,t,o,n;return{c(){e=f("p"),t=f("strong"),t.textContent="Error:",o=v(),n=D(l[3])},m(c,r){A(c,e,r),s(e,t),s(e,o),s(e,n)},p(c,r){r[0]&8&&ve(n,c[3])},d(c){c&&R(e)}}}function Lo(l){var G,S,j,B;let e,t,o,n,c,r=(((G=l[1])==null?void 0:G.title)||"Untitled")+"",u,i,d,p,m,_,C=(((S=l[1])==null?void 0:S.rank)||0)+"",g,y,k,w,b,h,$,z,O,I,E=((j=l[1])==null?void 0:j.description)&&Eo(l),V=((B=l[1])==null?void 0:B.tags)&&Po(l);function J(F,Y){return F[10].length>0?Gr:qr}let K=J(l),T=K(l),L=l[10].length>0&&No(l);return{c(){e=f("div"),t=f("label"),t.textContent="Document to Save",o=v(),n=f("div"),c=f("h5"),u=D(r),i=v(),E&&E.c(),d=v(),p=f("div"),m=f("span"),_=D("Rank: "),g=D(C),y=v(),V&&V.c(),k=v(),w=f("div"),b=f("label"),b.textContent="Atomic Server",h=v(),$=f("div"),T.c(),z=v(),L&&L.c(),O=lt(),a(t,"class","label"),a(c,"class","title is-6"),a(m,"class","tag is-info svelte-48g63o"),a(p,"class","tags svelte-48g63o"),a(n,"class","box document-preview svelte-48g63o"),a(e,"class","field"),a(b,"class","label"),a(b,"for","atomic-server-select"),a($,"class","control"),a(w,"class","field")},m(F,Y){A(F,e,Y),s(e,t),s(e,o),s(e,n),s(n,c),s(c,u),s(n,i),E&&E.m(n,null),s(n,d),s(n,p),s(p,m),s(m,_),s(m,g),s(p,y),V&&V.m(p,null),A(F,k,Y),A(F,w,Y),s(w,b),s(w,h),s(w,$),T.m($,null),A(F,z,Y),L&&L.m(F,Y),A(F,O,Y),I=!0},p(F,Y){var P,N,q,W;(!I||Y[0]&2)&&r!==(r=(((P=F[1])==null?void 0:P.title)||"Untitled")+"")&&ve(u,r),(N=F[1])!=null&&N.description?E?E.p(F,Y):(E=Eo(F),E.c(),E.m(n,d)):E&&(E.d(1),E=null),(!I||Y[0]&2)&&C!==(C=(((q=F[1])==null?void 0:q.rank)||0)+"")&&ve(g,C),(W=F[1])!=null&&W.tags?V?V.p(F,Y):(V=Po(F),V.c(),V.m(p,null)):V&&(V.d(1),V=null),K===(K=J(F))&&T?T.p(F,Y):(T.d(1),T=K(F),T&&(T.c(),T.m($,null))),F[10].length>0?L?(L.p(F,Y),Y[0]&1024&&Q(L,1)):(L=No(F),L.c(),Q(L,1),L.m(O.parentNode,O)):L&&(qe(),Z(L,1,1,()=>{L=null}),Ge())},i(F){I||(Q(L),I=!0)},o(F){Z(L),I=!1},d(F){F&&R(e),E&&E.d(),V&&V.d(),F&&R(k),F&&R(w),T.d(),F&&R(z),L&&L.d(F),F&&R(O)}}}function Eo(l){let e,t=l[1].description+"",o;return{c(){e=f("p"),o=D(t),a(e,"class","content")},m(n,c){A(n,e,c),s(e,o)},p(n,c){c[0]&2&&t!==(t=n[1].description+"")&&ve(o,t)},d(n){n&&R(e)}}}function Po(l){let e,t=l[1].tags,o=[];for(let n=0;n<t.length;n+=1)o[n]=Oo(To(l,t,n));return{c(){for(let n=0;n<o.length;n+=1)o[n].c();e=lt()},m(n,c){for(let r=0;r<o.length;r+=1)o[r]&&o[r].m(n,c);A(n,e,c)},p(n,c){if(c[0]&2){t=n[1].tags;let r;for(r=0;r<t.length;r+=1){const u=To(n,t,r);o[r]?o[r].p(u,c):(o[r]=Oo(u),o[r].c(),o[r].m(e.parentNode,e))}for(;r<o.length;r+=1)o[r].d(1);o.length=t.length}},d(n){Ve(o,n),n&&R(e)}}}function Oo(l){let e,t=l[39]+"",o;return{c(){e=f("span"),o=D(t),a(e,"class","tag svelte-48g63o")},m(n,c){A(n,e,c),s(e,o)},p(n,c){c[0]&2&&t!==(t=n[39]+"")&&ve(o,t)},d(n){n&&R(e)}}}function qr(l){let e,t,o,n,c,r,u,i,d;return{c(){e=f("div"),t=f("p"),t.innerHTML="<strong>No atomic servers available</strong>",o=v(),n=f("p"),c=D('Your current role "'),r=D(l[12]),u=D(`" doesn't have any writable atomic server configurations.`),i=v(),d=f("p"),d.textContent="Please configure an atomic server haystack in your role settings.",a(e,"class","notification is-warning")},m(p,m){A(p,e,m),s(e,t),s(e,o),s(e,n),s(n,c),s(n,r),s(n,u),s(e,i),s(e,d)},p(p,m){m[0]&4096&&ve(r,p[12])},d(p){p&&R(e)}}}function Gr(l){let e,t,o,n,c,r,u=l[10],i=[];for(let d=0;d<u.length;d+=1)i[d]=Io(So(l,u,d));return{c(){e=f("div"),t=f("select");for(let d=0;d<i.length;d+=1)i[d].c();o=v(),n=f("p"),n.textContent=`Select the atomic server from your current role configuration.
              üîê = Authenticated, ‚ö†Ô∏è = Anonymous access`,a(t,"id","atomic-server-select"),t.disabled=l[2],l[11]===void 0&&at(()=>l[18].call(t)),a(e,"class","select is-fullwidth"),a(n,"class","help svelte-48g63o")},m(d,p){A(d,e,p),s(e,t);for(let m=0;m<i.length;m+=1)i[m]&&i[m].m(t,null);He(t,l[11],!0),A(d,o,p),A(d,n,p),c||(r=ee(t,"change",l[18]),c=!0)},p(d,p){if(p[0]&1024){u=d[10];let m;for(m=0;m<u.length;m+=1){const _=So(d,u,m);i[m]?i[m].p(_,p):(i[m]=Io(_),i[m].c(),i[m].m(t,null))}for(;m<i.length;m+=1)i[m].d(1);i.length=u.length}p[0]&4&&(t.disabled=d[2]),p[0]&3072&&He(t,d[11])},d(d){d&&R(e),Ve(i,d),d&&R(o),d&&R(n),c=!1,r()}}}function Br(l){let e;return{c(){e=f("span"),e.textContent="‚ö†Ô∏è No Auth",a(e,"class","has-text-warning")},m(t,o){A(t,e,o)},d(t){t&&R(e)}}}function Jr(l){let e;return{c(){e=f("span"),e.textContent="üîê",a(e,"class","has-text-success")},m(t,o){A(t,e,o)},d(t){t&&R(e)}}}function Io(l){let e,t=l[36].location+"",o,n,c,r;function u(p,m){return p[36].atomic_server_secret?Jr:Br}let i=u(l),d=i(l);return{c(){e=f("option"),o=D(t),n=v(),d.c(),c=v(),e.__value=r=l[36].location,e.value=e.__value},m(p,m){A(p,e,m),s(e,o),s(e,n),d.m(e,null),s(e,c)},p(p,m){m[0]&1024&&t!==(t=p[36].location+"")&&ve(o,t),i!==(i=u(p))&&(d.d(1),d=i(p),d&&(d.c(),d.m(e,c))),m[0]&1024&&r!==(r=p[36].location)&&(e.__value=r,e.value=e.__value)},d(p){p&&R(e),d.d()}}}function No(l){var M,le;let e,t,o,n,c,r,u,i,d,p,m,_,C,g,y,k,w,b,h,$,z,O,I,E,V,J,K,T,L,G,S,j,B,F,Y,P,N,q,W,X,U,oe,ge,we=(l[8]||"Untitled")+"",he,fe,se,ue,ke,Ce=(((le=(M=l[1])==null?void 0:M.body)==null?void 0:le.length)||0)+"",te,ie,ae,ce,Ee,Fe,Ke=l[14]()+"",Pe,Re,x,ne,Se,Ae=l[15]()+"",xe,Ie,ut,ot,gt;function Ye(H){l[19](H)}let nt={id:"article-title",placeholder:"Enter article title",disabled:l[2],required:!0};l[8]!==void 0&&(nt.value=l[8]),c=new Vt({props:nt}),Xe.push(()=>et(c,"value",Ye));const ft=[Qr,Vr],Ue=[];function Rt(H,re){return H[7]?1:0}return J=Rt(l),K=Ue[J]=ft[J](l),S=new Pl({props:{type:"is-primary",loading:l[2],disabled:l[2]||!l[8].trim()||!l[11],$$slots:{default:[Yr]},$$scope:{ctx:l}}}),S.$on("click",l[16]),F=new Pl({props:{type:"is-light",disabled:l[2],$$slots:{default:[Zr]},$$scope:{ctx:l}}}),F.$on("click",l[17]),ut=xn(l[22][0]),{c(){e=f("div"),t=f("label"),t.textContent="Article Title",o=v(),n=f("div"),pe(c.$$.fragment),u=v(),i=f("div"),d=f("label"),d.textContent="Description",p=v(),m=f("div"),_=f("textarea"),C=v(),g=f("div"),y=f("label"),y.textContent="Parent Collection",k=v(),w=f("div"),b=f("label"),h=f("input"),$=D(`
              Use predefined collection`),z=v(),O=f("label"),I=f("input"),E=D(`
              Custom parent URL/path`),V=v(),K.c(),T=v(),L=f("div"),G=f("div"),pe(S.$$.fragment),j=v(),B=f("div"),pe(F.$$.fragment),Y=v(),P=f("div"),N=f("div"),q=f("p"),q.innerHTML="<strong>What will be saved:</strong>",W=v(),X=f("ul"),U=f("li"),oe=f("strong"),oe.textContent="Title:",ge=v(),he=D(we),fe=v(),se=f("li"),ue=f("strong"),ue.textContent="Body:",ke=D(" Original document content ("),te=D(Ce),ie=D(" characters)"),ae=v(),ce=f("li"),Ee=f("strong"),Ee.textContent="Parent:",Fe=v(),Pe=D(Ke),Re=v(),x=f("li"),ne=f("strong"),ne.textContent="Subject URL:",Se=v(),xe=D(Ae),a(t,"class","label"),a(t,"for","article-title"),a(n,"class","control"),a(e,"class","field"),a(d,"class","label"),a(d,"for","article-description"),a(_,"id","article-description"),a(_,"class","textarea"),a(_,"placeholder","Brief description of the article"),_.disabled=l[2],a(_,"rows","3"),a(m,"class","control"),a(i,"class","field"),a(y,"class","label"),a(h,"type","radio"),h.__value=!1,h.value=h.__value,h.disabled=l[2],a(b,"class","radio svelte-48g63o"),a(I,"type","radio"),I.__value=!0,I.value=I.__value,I.disabled=l[2],a(O,"class","radio svelte-48g63o"),a(w,"class","control"),a(g,"class","field"),a(G,"class","control"),a(B,"class","control"),a(L,"class","field is-grouped"),a(U,"class","svelte-48g63o"),a(se,"class","svelte-48g63o"),a(ce,"class","svelte-48g63o"),a(x,"class","svelte-48g63o"),a(X,"class","svelte-48g63o"),a(N,"class","notification is-info is-light svelte-48g63o"),a(P,"class","field"),ut.p(h,I)},m(H,re){A(H,e,re),s(e,t),s(e,o),s(e,n),me(c,n,null),A(H,u,re),A(H,i,re),s(i,d),s(i,p),s(i,m),s(m,_),Ne(_,l[9]),A(H,C,re),A(H,g,re),s(g,y),s(g,k),s(g,w),s(w,b),s(b,h),h.checked=h.__value===l[7],s(b,$),s(w,z),s(w,O),s(O,I),I.checked=I.__value===l[7],s(O,E),A(H,V,re),Ue[J].m(H,re),A(H,T,re),A(H,L,re),s(L,G),me(S,G,null),s(L,j),s(L,B),me(F,B,null),A(H,Y,re),A(H,P,re),s(P,N),s(N,q),s(N,W),s(N,X),s(X,U),s(U,oe),s(U,ge),s(U,he),s(X,fe),s(X,se),s(se,ue),s(se,ke),s(se,te),s(se,ie),s(X,ae),s(X,ce),s(ce,Ee),s(ce,Fe),s(ce,Pe),s(X,Re),s(X,x),s(x,ne),s(x,Se),s(x,xe),Ie=!0,ot||(gt=[ee(_,"input",l[20]),ee(h,"change",l[21]),ee(I,"change",l[23])],ot=!0)},p(H,re){var De,We;const ye={};re[0]&4&&(ye.disabled=H[2]),!r&&re[0]&256&&(r=!0,ye.value=H[8],tt(()=>r=!1)),c.$set(ye),(!Ie||re[0]&4)&&(_.disabled=H[2]),re[0]&512&&Ne(_,H[9]),(!Ie||re[0]&4)&&(h.disabled=H[2]),re[0]&128&&(h.checked=h.__value===H[7]),(!Ie||re[0]&4)&&(I.disabled=H[2]),re[0]&128&&(I.checked=I.__value===H[7]);let be=J;J=Rt(H),J===be?Ue[J].p(H,re):(qe(),Z(Ue[be],1,1,()=>{Ue[be]=null}),Ge(),K=Ue[J],K?K.p(H,re):(K=Ue[J]=ft[J](H),K.c()),Q(K,1),K.m(T.parentNode,T));const ze={};re[0]&4&&(ze.loading=H[2]),re[0]&2308&&(ze.disabled=H[2]||!H[8].trim()||!H[11]),re[1]&2048&&(ze.$$scope={dirty:re,ctx:H}),S.$set(ze);const Be={};re[0]&4&&(Be.disabled=H[2]),re[1]&2048&&(Be.$$scope={dirty:re,ctx:H}),F.$set(Be),(!Ie||re[0]&256)&&we!==(we=(H[8]||"Untitled")+"")&&ve(he,we),(!Ie||re[0]&2)&&Ce!==(Ce=(((We=(De=H[1])==null?void 0:De.body)==null?void 0:We.length)||0)+"")&&ve(te,Ce)},i(H){Ie||(Q(c.$$.fragment,H),Q(K),Q(S.$$.fragment,H),Q(F.$$.fragment,H),Ie=!0)},o(H){Z(c.$$.fragment,H),Z(K),Z(S.$$.fragment,H),Z(F.$$.fragment,H),Ie=!1},d(H){H&&R(e),_e(c),H&&R(u),H&&R(i),H&&R(C),H&&R(g),H&&R(V),Ue[J].d(H),H&&R(T),H&&R(L),_e(S),_e(F),H&&R(Y),H&&R(P),ut.r(),ot=!1,Qe(gt)}}}function Vr(l){let e,t,o,n,c,r,u;function i(p){l[25](p)}let d={placeholder:"e.g., my-collection or http://server/custom-parent",disabled:l[2]};return l[6]!==void 0&&(d.value=l[6]),o=new Vt({props:d}),Xe.push(()=>et(o,"value",i)),{c(){e=f("div"),t=f("div"),pe(o.$$.fragment),c=v(),r=f("p"),r.textContent=`Enter a collection name (e.g., "my-articles") or full URL.
              If the collection doesn't exist, it will be created.`,a(t,"class","control"),a(r,"class","help svelte-48g63o"),a(e,"class","field")},m(p,m){A(p,e,m),s(e,t),me(o,t,null),s(e,c),s(e,r),u=!0},p(p,m){const _={};m[0]&4&&(_.disabled=p[2]),!n&&m[0]&64&&(n=!0,_.value=p[6],tt(()=>n=!1)),o.$set(_)},i(p){u||(Q(o.$$.fragment,p),u=!0)},o(p){Z(o.$$.fragment,p),u=!1},d(p){p&&R(e),_e(o)}}}function Qr(l){let e,t,o,n,c,r,u=l[13],i=[];for(let d=0;d<u.length;d+=1)i[d]=Uo(Co(l,u,d));return{c(){e=f("div"),t=f("div"),o=f("div"),n=f("select");for(let d=0;d<i.length;d+=1)i[d].c();n.disabled=l[2],l[5]===void 0&&at(()=>l[24].call(n)),a(o,"class","select is-fullwidth"),a(t,"class","control"),a(e,"class","field")},m(d,p){A(d,e,p),s(e,t),s(t,o),s(o,n);for(let m=0;m<i.length;m+=1)i[m]&&i[m].m(n,null);He(n,l[5],!0),c||(r=ee(n,"change",l[24]),c=!0)},p(d,p){if(p[0]&8192){u=d[13];let m;for(m=0;m<u.length;m+=1){const _=Co(d,u,m);i[m]?i[m].p(_,p):(i[m]=Uo(_),i[m].c(),i[m].m(n,null))}for(;m<i.length;m+=1)i[m].d(1);i.length=u.length}p[0]&4&&(n.disabled=d[2]),p[0]&8224&&He(n,d[5])},i:Te,o:Te,d(d){d&&R(e),Ve(i,d),c=!1,r()}}}function Uo(l){let e,t=l[33].label+"",o;return{c(){e=f("option"),o=D(t),e.__value=l[33].value,e.value=e.__value},m(n,c){A(n,e,c),s(e,o)},p:Te,d(n){n&&R(e)}}}function Yr(l){let e,t,o;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-cloud-upload-alt"></i>',t=v(),o=f("span"),o.textContent="Save to Atomic Server",a(e,"class","icon")},m(n,c){A(n,e,c),A(n,t,c),A(n,o,c)},p:Te,d(n){n&&R(e),n&&R(t),n&&R(o)}}}function Zr(l){let e;return{c(){e=D("Cancel")},m(t,o){A(t,e,o)},d(t){t&&R(e)}}}function Xr(l){let e,t,o,n,c,r,u,i,d,p,m,_,C,g=l[4]&&Ro(l),y=l[3]&&Ao(l),k=!l[4]&&Lo(l);return{c(){e=f("div"),t=f("div"),o=f("div"),o.innerHTML=`<div class="level-item"><h3 class="title is-4"><span class="icon"><i class="fas fa-save"></i></span>
            Save to Atomic Server</h3></div>`,n=v(),c=f("div"),r=f("div"),u=f("button"),i=v(),g&&g.c(),d=v(),y&&y.c(),p=v(),k&&k.c(),a(o,"class","level-left"),a(u,"class","delete is-large"),u.disabled=l[2],a(u,"aria-label","close"),a(r,"class","level-item"),a(c,"class","level-right"),a(t,"class","level svelte-48g63o"),a(e,"class","box")},m(w,b){A(w,e,b),s(e,t),s(t,o),s(t,n),s(t,c),s(c,r),s(r,u),s(e,i),g&&g.m(e,null),s(e,d),y&&y.m(e,null),s(e,p),k&&k.m(e,null),m=!0,_||(C=ee(u,"click",l[17]),_=!0)},p(w,b){(!m||b[0]&4)&&(u.disabled=w[2]),w[4]?g?b[0]&16&&Q(g,1):(g=Ro(w),g.c(),Q(g,1),g.m(e,d)):g&&(qe(),Z(g,1,1,()=>{g=null}),Ge()),w[3]?y?(y.p(w,b),b[0]&8&&Q(y,1)):(y=Ao(w),y.c(),Q(y,1),y.m(e,p)):y&&(qe(),Z(y,1,1,()=>{y=null}),Ge()),w[4]?k&&(qe(),Z(k,1,1,()=>{k=null}),Ge()):k?(k.p(w,b),b[0]&16&&Q(k,1)):(k=Lo(w),k.c(),Q(k,1),k.m(e,null))},i(w){m||(Q(g),Q(y),Q(k),m=!0)},o(w){Z(g),Z(y),Z(k),m=!1},d(w){w&&R(e),g&&g.d(),y&&y.d(),k&&k.d(),_=!1,C()}}}function xr(l){let e,t,o;function n(r){l[26](r)}let c={$$slots:{default:[Xr]},$$scope:{ctx:l}};return l[0]!==void 0&&(c.active=l[0]),e=new jl({props:c}),Xe.push(()=>et(e,"active",n)),e.$on("close",l[17]),{c(){pe(e.$$.fragment)},m(r,u){me(e,r,u),o=!0},p(r,u){const i={};u[0]&8190|u[1]&2048&&(i.$$scope={dirty:u,ctx:r}),!t&&u[0]&1&&(t=!0,i.active=r[0],tt(()=>t=!1)),e.$set(i)},i(r){o||(Q(e.$$.fragment,r),o=!0)},o(r){Z(e.$$.fragment,r),o=!1},d(r){_e(e,r)}}}function ei(l,e,t){let o,n,c;Oe(l,Je,P=>t(27,o=P)),Oe(l,Tt,P=>t(28,n=P)),Oe(l,St,P=>t(12,c=P));let{active:r=!1}=e,{document:u}=e,i=!1,d=null,p=!1,m="",_="",C=!1,g="",y="",k=[],w="";const b=[{label:"Root (Server Root)",value:""},{label:"Articles Collection",value:"articles"},{label:"Documents Collection",value:"documents"},{label:"Knowledge Base",value:"knowledge-base"},{label:"Research",value:"research"},{label:"Projects",value:"projects"}];function h(){t(2,i=!1),t(3,d=null),t(4,p=!1),t(5,m=""),t(6,_=""),t(7,C=!1),t(8,g=(u==null?void 0:u.title)||""),t(9,y=(u==null?void 0:u.description)||`Article saved from Terraphim search: ${u==null?void 0:u.title}`),t(10,k=[]),t(11,w="")}function $(){var W;const P=c,N=n;if(!(N!=null&&N.roles)||!P){console.warn("No role configuration found");return}let q=null;try{for(const[X,U]of Object.entries(N.roles)){const oe=U,ge=typeof oe.name=="object"?oe.name.original:String(oe.name);if(X===P||ge===P){q=oe;break}}}catch(X){console.warn("Error checking role configuration:",X);return}if(!q){console.warn(`Role "${P}" not found in configuration`);return}t(10,k=((W=q.haystacks)==null?void 0:W.filter(X=>X.service==="Atomic"&&X.location&&!X.read_only))||[]),k.length>0&&t(11,w=k[0].location),console.log("Loaded atomic servers:",k)}function z(){const P=k.find(N=>N.location===w);return P==null?void 0:P.atomic_server_secret}function O(){const P=w.replace(/\/$/,"");if(C&&_.trim()){const N=_.trim();return N.startsWith("http://")||N.startsWith("https://")?N:`${P}/${N.replace(/^\//,"")}`}else return m?`${P}/${m}`:P}function I(){return g.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,50)}function E(){const P=w.replace(/\/$/,""),N=I(),q=Date.now();return`${P}/${N}-${q}`}async function V(){if(!w||!g.trim()){t(3,d="Please select an atomic server and provide a title");return}t(2,i=!0),t(3,d=null);try{const P=E(),N=O(),q=z();console.log("üîÑ Saving article to atomic server:",{subject:P,parent:N,server:w,hasSecret:!!q});const W={subject:P,title:g.trim(),description:y.trim(),body:u.body,parent:N,shortname:I(),original_id:u.id,original_url:u.url,original_rank:u.rank,tags:u.tags||[]};if(o)await je("save_article_to_atomic",{article:W,serverUrl:w,atomicSecret:q});else{const X=await fetch(`${Ze.ServerURL}/atomic/save`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({article:W,server_url:w,atomic_secret:q})});if(!X.ok){const U=await X.json().catch(()=>({error:X.statusText}));throw new Error(U.error||`HTTP ${X.status}: ${X.statusText}`)}}t(4,p=!0),console.log("‚úÖ Article saved successfully to atomic server"),setTimeout(()=>{t(0,r=!1)},2e3)}catch(P){console.error("‚ùå Failed to save article to atomic server:",P),t(3,d=P.message||"Failed to save article to atomic server")}finally{t(2,i=!1)}}function J(){i||t(0,r=!1)}const K=[[]];function T(){w=At(this),t(11,w),t(10,k)}function L(P){g=P,t(8,g)}function G(){y=this.value,t(9,y)}function S(){C=this.__value,t(7,C)}function j(){C=this.__value,t(7,C)}function B(){m=At(this),t(5,m),t(13,b)}function F(P){_=P,t(6,_)}function Y(P){r=P,t(0,r)}return l.$$set=P=>{"active"in P&&t(0,r=P.active),"document"in P&&t(1,u=P.document)},l.$$.update=()=>{l.$$.dirty[0]&3&&r&&u&&(h(),$())},[r,u,i,d,p,m,_,C,g,y,k,w,c,b,O,E,V,J,T,L,G,S,K,j,B,F,Y]}class ti extends _t{constructor(e){super(),ht(this,e,ei,xr,ct,{active:0,document:1},null,[-1,-1])}}async function Fl(l){return je("tauri",l)}async function li(l,e){return Fl({__tauriModule:"Event",message:{cmd:"unlisten",event:l,eventId:e}})}async function oi(l,e,t){return Fl({__tauriModule:"Event",message:{cmd:"listen",event:l,windowLabel:e,handler:Dl(t)}}).then(o=>async()=>li(l,o))}var Do;(function(l){l.WINDOW_RESIZED="tauri://resize",l.WINDOW_MOVED="tauri://move",l.WINDOW_CLOSE_REQUESTED="tauri://close-requested",l.WINDOW_CREATED="tauri://window-created",l.WINDOW_DESTROYED="tauri://destroyed",l.WINDOW_FOCUS="tauri://focus",l.WINDOW_BLUR="tauri://blur",l.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",l.WINDOW_THEME_CHANGED="tauri://theme-changed",l.WINDOW_FILE_DROP="tauri://file-drop",l.WINDOW_FILE_DROP_HOVER="tauri://file-drop-hover",l.WINDOW_FILE_DROP_CANCELLED="tauri://file-drop-cancelled",l.MENU="tauri://menu",l.CHECK_UPDATE="tauri://update",l.UPDATE_AVAILABLE="tauri://update-available",l.INSTALL_UPDATE="tauri://update-install",l.STATUS_UPDATE="tauri://update-status",l.DOWNLOAD_PROGRESS="tauri://update-download-progress"})(Do||(Do={}));async function ni(l,e){return oi(l,null,e)}function Mo(l,e,t){const o=l.slice();return o[9]=e[t],o}function jo(l){let e,t=l[9].name+"",o,n;return{c(){e=f("option"),o=D(t),e.__value=n=l[9].name,e.value=e.__value},m(c,r){A(c,e,r),s(e,o)},p(c,r){r&1&&t!==(t=c[9].name+"")&&ve(o,t),r&1&&n!==(n=c[9].name)&&(e.__value=n,e.value=e.__value)},d(c){c&&R(e)}}}function si(l){let e,t,o,n,c,r,u=l[0],i=[];for(let d=0;d<u.length;d+=1)i[d]=jo(Mo(l,u,d));return{c(){e=f("div"),t=f("div"),o=f("div"),n=f("select");for(let d=0;d<i.length;d+=1)i[d].c();a(o,"class","select"),a(t,"class","control"),a(e,"class","field is-grouped is-grouped-right")},m(d,p){A(d,e,p),s(e,t),s(t,o),s(o,n);for(let m=0;m<i.length;m+=1)i[m]&&i[m].m(n,null);He(n,l[1]),c||(r=ee(n,"change",l[2]),c=!0)},p(d,[p]){if(p&1){u=d[0];let m;for(m=0;m<u.length;m+=1){const _=Mo(d,u,m);i[m]?i[m].p(_,p):(i[m]=jo(_),i[m].c(),i[m].m(n,null))}for(;m<i.length;m+=1)i[m].d(1);i.length=u.length}p&3&&He(n,d[1])},i:Te,o:Te,d(d){d&&R(e),Ve(i,d),c=!1,r()}}}function ri(l,e,t){let o,n,c,r;Oe(l,Tt,_=>t(5,o=_)),Oe(l,Je,_=>t(6,n=_)),Oe(l,po,_=>t(0,c=_)),Oe(l,St,_=>t(1,r=_));let u="";async function i(){try{Je.set(window.__TAURI__!==void 0),n?(console.log("Loading config from Tauri"),je("get_config").then(_=>{console.log("get_config response",_),_&&_.status==="success"&&d(_.config)}).catch(_=>console.error("Error fetching config in Tauri:",_))):(console.log("Loading config from server"),u=`${Ze.ServerURL}/config/`,fetch(u).then(_=>_.json()).then(_=>{console.log("Config received",_),_&&_.status==="success"&&d(_.config)}).catch(_=>console.error("Error fetching config:",_)))}catch(_){console.error("Unhandled error in loadConfig:",_)}}function d(_){var k;console.log("Updating stores from config:",_);const C={default_role:_.selected_role,..._};Tt.set(C);const g=Object.entries(_.roles).map(([w,b])=>({name:w,...b}));po.set(g),St.set(_.selected_role);const y=_.roles[_.selected_role];if(console.log("Selected role settings:",y),y){const w=y.theme||"spacelab";console.log("Setting theme to:",w),ml.set(w),(k=y.kg)!=null&&k.publish?n?je("publish_thesaurus",{roleName:_.selected_role}).then(b=>{console.log("publish_thesaurus response",b),dl.set(b),Ct.set(!0)}):(console.log("Fetching thesaurus from HTTP endpoint for role",_.selected_role),fetch(`${Ze.ServerURL}/thesaurus/${encodeURIComponent(_.selected_role)}`).then(b=>b.json()).then(b=>{console.log("thesaurus HTTP response",b),b&&b.status==="success"&&b.thesaurus?(dl.set(b.thesaurus),Ct.set(!0)):(console.error("Failed to fetch thesaurus:",b),Ct.set(!1))}).catch(b=>{console.error("Error fetching thesaurus:",b),Ct.set(!1)})):Ct.set(!1)}else console.warn("No role settings found for:",_.selected_role),ml.set("spacelab")}typeof window<"u"&&window.__TAURI__&&ni("role_changed",_=>{console.log("Role changed event received from backend:",_.payload),d(_.payload)});async function p(){await i()}p(),console.log("Using Terraphim Server URL:",Ze.ServerURL);function m(_){var w,b;const g=_.currentTarget.value;console.log("Role change requested:",g),St.set(g);const y=c.find(h=>h.name===g);if(!y){console.error(`No role settings found for role: ${g}.`);return}const k=y.theme||"spacelab";ml.set(k),console.log(`Theme changed to ${k}`),Tt.update(h=>(h.selected_role=g,h)),n?(je("select_role",{roleName:g}).catch(h=>console.error("Error selecting role:",h)),(w=y.kg)!=null&&w.publish?(console.log("Publishing thesaurus for role",g),je("publish_thesaurus",{roleName:g}).then(h=>{dl.set(h),Ct.set(!0)})):Ct.set(!1)):(fetch(`${Ze.ServerURL}/config/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).catch(h=>console.error("Error updating config on server:",h)),(b=y.kg)!=null&&b.publish?(console.log("Fetching thesaurus from HTTP endpoint for role",g),fetch(`${Ze.ServerURL}/thesaurus/${encodeURIComponent(g)}`).then(h=>h.json()).then(h=>{console.log("thesaurus HTTP response",h),h&&h.status==="success"&&h.thesaurus?(dl.set(h.thesaurus),Ct.set(!0)):(console.error("Failed to fetch thesaurus:",h),Ct.set(!1))}).catch(h=>{console.error("Error fetching thesaurus:",h),Ct.set(!1)})):Ct.set(!1))}return[c,r,m,i]}class El extends _t{constructor(e){super(),ht(this,e,ri,si,ct,{loadConfig:3})}get loadConfig(){return this.$$.ctx[3]}}function Ho(l,e,t){const o=l.slice();return o[38]=e[t],o}function zo(l,e,t){const o=l.slice();return o[41]=e[t],o}function Fo(l){let e,t;return e=new es({props:{$$slots:{default:[ai]},$$scope:{ctx:l}}}),{c(){pe(e.$$.fragment)},m(o,n){me(e,o,n),t=!0},p(o,n){const c={};n[0]&129|n[1]&8192&&(c.$$scope={dirty:n,ctx:o}),e.$set(c)},i(o){t||(Q(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){_e(e,o)}}}function ii(l){let e=l[41]+"",t;return{c(){t=D(e)},m(o,n){A(o,t,n)},p(o,n){n[0]&1&&e!==(e=o[41]+"")&&ve(t,e)},d(o){o&&R(t)}}}function Ko(l){let e,t,o,n,c,r;t=new ts({props:{rounded:!0,$$slots:{default:[ii]},$$scope:{ctx:l}}});function u(){return l[19](l[41])}return{c(){e=f("button"),pe(t.$$.fragment),o=v(),a(e,"class","tag-button svelte-2smypa"),e.disabled=l[7],a(e,"title","Click to view knowledge graph document")},m(i,d){A(i,e,d),me(t,e,null),s(e,o),n=!0,c||(r=ee(e,"click",u),c=!0)},p(i,d){l=i;const p={};d[0]&1|d[1]&8192&&(p.$$scope={dirty:d,ctx:l}),t.$set(p),(!n||d[0]&128)&&(e.disabled=l[7])},i(i){n||(Q(t.$$.fragment,i),n=!0)},o(i){Z(t.$$.fragment,i),n=!1},d(i){i&&R(e),_e(t),c=!1,r()}}}function ai(l){let e,t,o=l[0].tags,n=[];for(let r=0;r<o.length;r+=1)n[r]=Ko(zo(l,o,r));const c=r=>Z(n[r],1,1,()=>{n[r]=null});return{c(){for(let r=0;r<n.length;r+=1)n[r].c();e=lt()},m(r,u){for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(r,u);A(r,e,u),t=!0},p(r,u){if(u[0]&131201){o=r[0].tags;let i;for(i=0;i<o.length;i+=1){const d=zo(r,o,i);n[i]?(n[i].p(d,u),Q(n[i],1)):(n[i]=Ko(d),n[i].c(),Q(n[i],1),n[i].m(e.parentNode,e))}for(qe(),i=o.length;i<n.length;i+=1)c(i);Ge()}},i(r){if(!t){for(let u=0;u<o.length;u+=1)Q(n[u]);t=!0}},o(r){n=n.filter(Boolean);for(let u=0;u<n.length;u+=1)Z(n[u]);t=!1},d(r){Ve(n,r),r&&R(e)}}}function ci(l){let e,t=(l[0].rank||0)+"",o;return{c(){e=D("Rank "),o=D(t)},m(n,c){A(n,e,c),A(n,o,c)},p(n,c){c[0]&1&&t!==(t=(n[0].rank||0)+"")&&ve(o,t)},d(n){n&&R(e),n&&R(o)}}}function ui(l){let e,t;return e=new ts({props:{rounded:!0,$$slots:{default:[ci]},$$scope:{ctx:l}}}),{c(){pe(e.$$.fragment)},m(o,n){me(e,o,n),t=!0},p(o,n){const c={};n[0]&1|n[1]&8192&&(c.$$scope={dirty:n,ctx:o}),e.$set(c)},i(o){t||(Q(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){_e(e,o)}}}function fi(l){let e;return{c(){e=f("small"),e.textContent="No description available",a(e,"class","no-description svelte-2smypa")},m(t,o){A(t,e,o)},p:Te,i:Te,o:Te,d(t){t&&R(e)}}}function di(l){let e,t;return e=new Il({props:{source:l[0].description}}),{c(){pe(e.$$.fragment)},m(o,n){me(e,o,n),t=!0},p(o,n){const c={};n[0]&1&&(c.source=o[0].description),e.$set(c)},i(o){t||(Q(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){_e(e,o)}}}function Wo(l){let e,t,o,n,c,r;return{c(){e=f("button"),t=f("span"),t.innerHTML='<i class="fas fa-magic" aria-hidden="true"></i>',o=v(),n=f("span"),n.textContent="AI Summary",a(t,"class","icon is-small"),a(e,"class","button is-small is-info is-outlined ai-summary-button svelte-2smypa"),e.disabled=l[9],a(e,"title","Generate AI-powered summary using OpenRouter")},m(u,i){A(u,e,i),s(e,t),s(e,o),s(e,n),c||(r=ee(e,"click",l[18]),c=!0)},p(u,i){i[0]&512&&(e.disabled=u[9])},d(u){u&&R(e),c=!1,r()}}}function qo(l){let e;return{c(){e=f("div"),e.innerHTML=`<span class="icon"><i class="fas fa-spinner fa-spin" aria-hidden="true"></i></span> 
                <small>Generating AI summary...</small>`,a(e,"class","ai-summary-loading svelte-2smypa")},m(t,o){A(t,e,o)},d(t){t&&R(e)}}}function Go(l){let e,t,o,n,c,r,u,i,d,p;return{c(){e=f("div"),t=f("span"),t.innerHTML='<i class="fas fa-exclamation-triangle" aria-hidden="true"></i>',o=v(),n=f("small"),c=D("Summary error: "),r=D(l[10]),u=v(),i=f("button"),i.textContent="Retry",a(t,"class","icon has-text-danger"),a(n,"class","has-text-danger"),a(i,"class","button is-small is-text svelte-2smypa"),a(i,"title","Retry generating summary"),a(e,"class","ai-summary-error svelte-2smypa")},m(m,_){A(m,e,_),s(e,t),s(e,o),s(e,n),s(n,c),s(n,r),s(e,u),s(e,i),d||(p=ee(i,"click",l[20]),d=!0)},p(m,_){_[0]&1024&&ve(r,m[10])},d(m){m&&R(e),d=!1,p()}}}function Bo(l){let e,t,o,n,c,r,u,i,d,p,m,_,C,g,y,k,w,b,h,$;function z(E,V){return E[12]?mi:pi}let O=z(l),I=O(l);return p=new Il({props:{source:l[8]}}),{c(){e=f("div"),t=f("div"),o=f("small"),n=f("span"),n.innerHTML='<i class="fas fa-robot" aria-hidden="true"></i>',c=D(`
                    AI Summary
                    `),I.c(),r=v(),u=f("button"),u.innerHTML='<span class="icon is-small"><i class="fas fa-times" aria-hidden="true"></i></span>',i=v(),d=f("div"),pe(p.$$.fragment),m=v(),_=f("div"),C=f("button"),g=f("span"),g.innerHTML='<i class="fas fa-redo" aria-hidden="true"></i>',y=v(),k=f("span"),k.textContent="Regenerate",a(n,"class","icon is-small"),a(o,"class","ai-summary-label svelte-2smypa"),a(u,"class","button is-small is-text svelte-2smypa"),a(u,"title","Hide AI summary"),a(t,"class","ai-summary-header svelte-2smypa"),a(d,"class","ai-summary-content svelte-2smypa"),a(g,"class","icon is-small"),a(C,"class","button is-small is-text svelte-2smypa"),C.disabled=l[9],a(C,"title","Regenerate summary"),a(_,"class","ai-summary-actions svelte-2smypa"),a(e,"class","ai-summary svelte-2smypa")},m(E,V){A(E,e,V),s(e,t),s(t,o),s(o,n),s(o,c),I.m(o,null),s(t,r),s(t,u),s(e,i),s(e,d),me(p,d,null),s(e,m),s(e,_),s(_,C),s(C,g),s(C,y),s(C,k),b=!0,h||($=[ee(u,"click",l[21]),ee(C,"click",l[22])],h=!0)},p(E,V){O!==(O=z(E))&&(I.d(1),I=O(E),I&&(I.c(),I.m(o,null)));const J={};V[0]&256&&(J.source=E[8]),p.$set(J),(!b||V[0]&512)&&(C.disabled=E[9])},i(E){b||(Q(p.$$.fragment,E),at(()=>{b&&(w||(w=sl(e,rl,{},!0)),w.run(1))}),b=!0)},o(E){Z(p.$$.fragment,E),w||(w=sl(e,rl,{},!1)),w.run(0),b=!1},d(E){E&&R(e),I.d(),_e(p),E&&w&&w.end(),h=!1,Qe($)}}}function pi(l){let e;return{c(){e=f("span"),e.textContent="fresh",a(e,"class","tag is-small is-success")},m(t,o){A(t,e,o)},d(t){t&&R(e)}}}function mi(l){let e;return{c(){e=f("span"),e.textContent="cached",a(e,"class","tag is-small is-light")},m(t,o){A(t,e,o)},d(t){t&&R(e)}}}function Jo(l){let e;function t(c,r){return c[38].disabled?gi:c[38].isLink?hi:_i}let o=t(l),n=o(l);return{c(){n.c(),e=lt()},m(c,r){n.m(c,r),A(c,e,r)},p(c,r){o===(o=t(c))&&n?n.p(c,r):(n.d(1),n=o(c),n&&(n.c(),n.m(e.parentNode,e)))},d(c){n.d(c),c&&R(e)}}}function _i(l){let e,t,o,n,c,r,u,i,d;return{c(){e=f("button"),t=f("span"),o=f("i"),c=v(),a(o,"class",n=It(l[38].icon)+" svelte-2smypa"),a(t,"class","icon is-medium"),Nt(t,"has-text-primary",l[38].className),a(e,"type","button"),a(e,"class","level-item button is-ghost svelte-2smypa"),a(e,"aria-label",r=l[38].title),a(e,"title",u=l[38].title)},m(p,m){A(p,e,m),s(e,t),s(t,o),s(e,c),i||(d=ee(e,"click",function(){Hl(l[38].action)&&l[38].action.apply(this,arguments)}),i=!0)},p(p,m){l=p,m[0]&32768&&n!==(n=It(l[38].icon)+" svelte-2smypa")&&a(o,"class",n),m[0]&32768&&Nt(t,"has-text-primary",l[38].className),m[0]&32768&&r!==(r=l[38].title)&&a(e,"aria-label",r),m[0]&32768&&u!==(u=l[38].title)&&a(e,"title",u)},d(p){p&&R(e),i=!1,d()}}}function hi(l){let e,t,o,n,c,r,u,i;return{c(){e=f("a"),t=f("span"),o=f("i"),c=v(),a(o,"class",n=It(l[38].icon)+" svelte-2smypa"),a(t,"class","icon is-medium"),Nt(t,"has-text-primary",l[38].className),a(e,"href",r=l[38].href),a(e,"target","_blank"),a(e,"class","level-item"),a(e,"aria-label",u=l[38].title),a(e,"title",i=l[38].title)},m(d,p){A(d,e,p),s(e,t),s(t,o),s(e,c)},p(d,p){p[0]&32768&&n!==(n=It(d[38].icon)+" svelte-2smypa")&&a(o,"class",n),p[0]&32768&&Nt(t,"has-text-primary",d[38].className),p[0]&32768&&r!==(r=d[38].href)&&a(e,"href",r),p[0]&32768&&u!==(u=d[38].title)&&a(e,"aria-label",u),p[0]&32768&&i!==(i=d[38].title)&&a(e,"title",i)},d(d){d&&R(e)}}}function gi(l){let e,t,o,n,c,r,u;return{c(){e=f("button"),t=f("span"),o=f("i"),c=v(),a(o,"class",n=It(l[38].icon)+" svelte-2smypa"),a(t,"class","icon is-medium"),Nt(t,"has-text-primary",l[38].className),a(e,"type","button"),a(e,"class","level-item button is-ghost svelte-2smypa"),a(e,"aria-label",r=l[38].title),a(e,"title",u=l[38].title),e.disabled=!0},m(i,d){A(i,e,d),s(e,t),s(t,o),s(e,c)},p(i,d){d[0]&32768&&n!==(n=It(i[38].icon)+" svelte-2smypa")&&a(o,"class",n),d[0]&32768&&Nt(t,"has-text-primary",i[38].className),d[0]&32768&&r!==(r=i[38].title)&&a(e,"aria-label",r),d[0]&32768&&u!==(u=i[38].title)&&a(e,"title",u)},d(i){i&&R(e)}}}function Vo(l){let e,t=l[38].visible&&Jo(l);return{c(){t&&t.c(),e=lt()},m(o,n){t&&t.m(o,n),A(o,e,n)},p(o,n){o[38].visible?t?t.p(o,n):(t=Jo(o),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(o){t&&t.d(o),o&&R(e)}}}function Qo(l){let e,t,o,n,c,r;return{c(){e=f("div"),t=f("button"),o=v(),n=D(l[13]),a(t,"class","delete svelte-2smypa"),a(e,"class","notification is-danger is-light mt-2")},m(u,i){A(u,e,i),s(e,t),s(e,o),s(e,n),c||(r=ee(t,"click",l[23]),c=!0)},p(u,i){i[0]&8192&&ve(n,u[13])},d(u){u&&R(e),c=!1,r()}}}function Yo(l){let e,t,o;function n(r){l[25](r)}let c={item:l[4],kgTerm:l[5],kgRank:l[6]};return l[2]!==void 0&&(c.active=l[2]),e=new zl({props:c}),Xe.push(()=>et(e,"active",n)),{c(){pe(e.$$.fragment)},m(r,u){me(e,r,u),o=!0},p(r,u){const i={};u[0]&16&&(i.item=r[4]),u[0]&32&&(i.kgTerm=r[5]),u[0]&64&&(i.kgRank=r[6]),!t&&u[0]&4&&(t=!0,i.active=r[2],tt(()=>t=!1)),e.$set(i)},i(r){o||(Q(e.$$.fragment,r),o=!0)},o(r){Z(e.$$.fragment,r),o=!1},d(r){_e(e,r)}}}function Zo(l){let e,t,o;function n(r){l[26](r)}let c={document:l[0]};return l[3]!==void 0&&(c.active=l[3]),e=new ti({props:c}),Xe.push(()=>et(e,"active",n)),{c(){pe(e.$$.fragment)},m(r,u){me(e,r,u),o=!0},p(r,u){const i={};u[0]&1&&(i.document=r[0]),!t&&u[0]&8&&(t=!0,i.active=r[3],tt(()=>t=!1)),e.$set(i)},i(r){o||(Q(e.$$.fragment,r),o=!0)},o(r){Z(e.$$.fragment,r),o=!1},d(r){_e(e,r)}}}function vi(l){let e,t,o,n,c,r,u,i,d,p,m,_,C=l[0].title+"",g,y,k,w,b,h,$,z,O,I,E,V,J,K,T,L,G,S,j,B,F,Y,P,N,q,W,X,U,oe,ge,we,he=l[0].tags&&Fo(l);i=new es({props:{$$slots:{default:[ui]},$$scope:{ctx:l}}});const fe=[di,fi],se=[];function ue(x,ne){return x[0].description?0:1}$=ue(l),z=se[$]=fe[$](l);let ke=!l[11]&&!l[9]&&!l[10]&&Wo(l),Ce=l[9]&&qo(),te=l[10]&&Go(l),ie=l[11]&&l[8]&&Bo(l),ae=l[15],ce=[];for(let x=0;x<ae.length;x+=1)ce[x]=Vo(Ho(l,ae,x));let Ee=l[13]&&Qo(l);function Fe(x){l[24](x)}let Ke={item:l[0]};l[1]!==void 0&&(Ke.active=l[1]),N=new zl({props:Ke}),Xe.push(()=>et(N,"active",Fe));let Pe=l[4]&&Yo(l),Re=l[14]&&Zo(l);return{c(){e=f("div"),t=f("article"),o=f("div"),n=f("div"),c=f("div"),he&&he.c(),r=v(),u=f("div"),pe(i.$$.fragment),d=v(),p=f("div"),m=f("button"),_=f("h2"),g=D(C),y=v(),k=f("div"),w=f("small"),w.textContent="Description:",b=v(),h=f("div"),z.c(),O=v(),I=f("div"),ke&&ke.c(),E=v(),Ce&&Ce.c(),V=v(),te&&te.c(),J=v(),ie&&ie.c(),K=v(),T=f("br"),G=v(),S=f("div"),j=f("nav"),B=f("div");for(let x=0;x<ce.length;x+=1)ce[x].c();Y=v(),Ee&&Ee.c(),P=v(),pe(N.$$.fragment),W=v(),Pe&&Pe.c(),X=v(),Re&&Re.c(),U=lt(),a(c,"class","level-right"),a(u,"class","level-right"),a(_,"class","title svelte-2smypa"),a(m,"class","svelte-2smypa"),a(w,"class","description-label svelte-2smypa"),a(h,"class","description-content svelte-2smypa"),a(k,"class","description svelte-2smypa"),a(I,"class","ai-summary-section svelte-2smypa"),a(n,"class","content"),a(B,"class","level-right"),a(j,"class","level is-mobile"),a(S,"class","level-right"),a(o,"class","media-content"),a(t,"class","media"),a(e,"class","box")},m(x,ne){A(x,e,ne),s(e,t),s(t,o),s(o,n),s(n,c),he&&he.m(c,null),s(n,r),s(n,u),me(i,u,null),s(n,d),s(n,p),s(p,m),s(m,_),s(_,g),s(p,y),s(p,k),s(k,w),s(k,b),s(k,h),se[$].m(h,null),s(p,O),s(p,I),ke&&ke.m(I,null),s(I,E),Ce&&Ce.m(I,null),s(I,V),te&&te.m(I,null),s(I,J),ie&&ie.m(I,null),s(p,K),s(p,T),s(o,G),s(o,S),s(S,j),s(j,B);for(let Se=0;Se<ce.length;Se+=1)ce[Se]&&ce[Se].m(B,null);s(e,Y),Ee&&Ee.m(e,null),A(x,P,ne),me(N,x,ne),A(x,W,ne),Pe&&Pe.m(x,ne),A(x,X,ne),Re&&Re.m(x,ne),A(x,U,ne),oe=!0,ge||(we=ee(m,"click",l[16]),ge=!0)},p(x,ne){x[0].tags?he?(he.p(x,ne),ne[0]&1&&Q(he,1)):(he=Fo(x),he.c(),Q(he,1),he.m(c,null)):he&&(qe(),Z(he,1,1,()=>{he=null}),Ge());const Se={};ne[0]&1|ne[1]&8192&&(Se.$$scope={dirty:ne,ctx:x}),i.$set(Se),(!oe||ne[0]&1)&&C!==(C=x[0].title+"")&&ve(g,C);let Ae=$;if($=ue(x),$===Ae?se[$].p(x,ne):(qe(),Z(se[Ae],1,1,()=>{se[Ae]=null}),Ge(),z=se[$],z?z.p(x,ne):(z=se[$]=fe[$](x),z.c()),Q(z,1),z.m(h,null)),!x[11]&&!x[9]&&!x[10]?ke?ke.p(x,ne):(ke=Wo(x),ke.c(),ke.m(I,E)):ke&&(ke.d(1),ke=null),x[9]?Ce||(Ce=qo(),Ce.c(),Ce.m(I,V)):Ce&&(Ce.d(1),Ce=null),x[10]?te?te.p(x,ne):(te=Go(x),te.c(),te.m(I,J)):te&&(te.d(1),te=null),x[11]&&x[8]?ie?(ie.p(x,ne),ne[0]&2304&&Q(ie,1)):(ie=Bo(x),ie.c(),Q(ie,1),ie.m(I,null)):ie&&(qe(),Z(ie,1,1,()=>{ie=null}),Ge()),ne[0]&32768){ae=x[15];let Ie;for(Ie=0;Ie<ae.length;Ie+=1){const ut=Ho(x,ae,Ie);ce[Ie]?ce[Ie].p(ut,ne):(ce[Ie]=Vo(ut),ce[Ie].c(),ce[Ie].m(B,null))}for(;Ie<ce.length;Ie+=1)ce[Ie].d(1);ce.length=ae.length}x[13]?Ee?Ee.p(x,ne):(Ee=Qo(x),Ee.c(),Ee.m(e,null)):Ee&&(Ee.d(1),Ee=null);const xe={};ne[0]&1&&(xe.item=x[0]),!q&&ne[0]&2&&(q=!0,xe.active=x[1],tt(()=>q=!1)),N.$set(xe),x[4]?Pe?(Pe.p(x,ne),ne[0]&16&&Q(Pe,1)):(Pe=Yo(x),Pe.c(),Q(Pe,1),Pe.m(X.parentNode,X)):Pe&&(qe(),Z(Pe,1,1,()=>{Pe=null}),Ge()),x[14]?Re?(Re.p(x,ne),ne[0]&16384&&Q(Re,1)):(Re=Zo(x),Re.c(),Q(Re,1),Re.m(U.parentNode,U)):Re&&(qe(),Z(Re,1,1,()=>{Re=null}),Ge())},i(x){oe||(Q(he),Q(i.$$.fragment,x),Q(z),Q(ie),at(()=>{oe&&(L||(L=sl(p,rl,{},!0)),L.run(1))}),at(()=>{oe&&(F||(F=sl(j,rl,{},!0)),F.run(1))}),Q(N.$$.fragment,x),Q(Pe),Q(Re),oe=!0)},o(x){Z(he),Z(i.$$.fragment,x),Z(z),Z(ie),L||(L=sl(p,rl,{},!1)),L.run(0),F||(F=sl(j,rl,{},!1)),F.run(0),Z(N.$$.fragment,x),Z(Pe),Z(Re),oe=!1},d(x){x&&R(e),he&&he.d(),_e(i),se[$].d(),ke&&ke.d(),Ce&&Ce.d(),te&&te.d(),ie&&ie.d(),x&&L&&L.end(),Ve(ce,x),x&&F&&F.end(),Ee&&Ee.d(),x&&R(P),_e(N,x),x&&R(W),Pe&&Pe.d(x),x&&R(X),Re&&Re.d(x),x&&R(U),ge=!1,we()}}}function bi(l,e,t){let o,n,c,r,u;Oe(l,St,U=>t(29,c=U)),Oe(l,Je,U=>t(30,r=U)),Oe(l,Tt,U=>t(31,u=U));let{document:i}=e,d=!1,p=!1,m=!1,_=null,C=null,g=null,y=!1,k=null,w=!1,b=null,h=!1,$=!1,z=!1,O=!1,I=null;function E(){const U=[];return U.push({id:"download-markdown",label:"Download to Markdown",icon:"fas fa-download",action:()=>G(),visible:!0,title:"Download document as markdown file"}),o&&U.push({id:"save-atomic",label:"Save to Atomic Server",icon:"fas fa-cloud-upload-alt",action:()=>K(),visible:!0,title:"Save article to Atomic Server",className:"has-text-primary"}),i.url&&U.push({id:"external-url",label:"Open URL",icon:"fas fa-link",action:()=>window.open(i.url,"_blank"),visible:!0,title:"Open original URL in new tab",isLink:!0,href:i.url}),U.push({id:"open-vscode",label:"Open in VSCode",icon:"fas fa-code",action:()=>S(),visible:!0,title:"Open document in VSCode",isLink:!0,href:`vscode://${encodeURIComponent(i.title)}.md?${encodeURIComponent(i.body)}`}),U.push({id:"add-context",label:O?"Added to Context":z?"Adding...":"Add to Context",icon:O?"fas fa-check":z?"fas fa-spinner fa-spin":"fas fa-plus",action:()=>j(),visible:!0,title:O?"Document added to context":"Add document to LLM conversation context",disabled:z||O}),U}function V(){var he;const U=c,oe=u;if(!(oe!=null&&oe.roles)||!U)return!1;let ge=null;try{for(const[fe,se]of Object.entries(oe.roles)){const ue=se,ke=typeof ue.name=="object"?ue.name.original:String(ue.name);if(fe===U||ke===U){ge=ue;break}}}catch(fe){return console.warn("Error checking role configuration:",fe),!1}return ge?(((he=ge.haystacks)==null?void 0:he.filter(fe=>fe.service==="Atomic"&&fe.location&&!fe.read_only))||[]).length>0:!1}const J=()=>{t(1,d=!0)},K=()=>{console.log("üîÑ Opening atomic save modal for document:",i.title),t(3,m=!0)};async function T(U){var oe,ge,we,he,fe;t(7,y=!0),t(5,C=U),console.log("üîç KG Search Debug Info:"),console.log("  Tag clicked:",U),console.log("  Current role:",c),console.log("  Is Tauri mode:",r);try{if(r){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:c,term:U});const se=await je("find_documents_for_kg_term",{roleName:c,term:U});console.log("  üì• Tauri response received:"),console.log("    Status:",se.status),console.log("    Results count:",((oe=se.results)==null?void 0:oe.length)||0),console.log("    Total:",se.total||0),console.log("    Full response:",JSON.stringify(se,null,2)),se.status==="success"&&se.results&&se.results.length>0?(t(4,_=se.results[0]),t(6,g=_.rank||0),console.log("  ‚úÖ Found KG document:"),console.log("    Title:",_.title),console.log("    Rank:",g),console.log("    Body length:",((ge=_.body)==null?void 0:ge.length)||0,"characters"),t(2,p=!0)):(console.warn(`  ‚ö†Ô∏è  No KG documents found for term: "${U}" in role: "${c}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const se=Ze.ServerURL,ue=encodeURIComponent(c),ke=encodeURIComponent(U),Ce=`${se}/roles/${ue}/kg_search?term=${ke}`;console.log("  üì§ HTTP Request details:"),console.log("    Base URL:",se),console.log("    Role (encoded):",ue),console.log("    Term (encoded):",ke),console.log("    Full URL:",Ce);const te=await fetch(Ce);if(console.log("  üì• HTTP Response received:"),console.log("    Status code:",te.status),console.log("    Status text:",te.statusText),console.log("    Headers:",Object.fromEntries(te.headers.entries())),!te.ok)throw new Error(`HTTP error! Status: ${te.status} - ${te.statusText}`);const ie=await te.json();console.log("  üìÑ Response data:"),console.log("    Status:",ie.status),console.log("    Results count:",((we=ie.results)==null?void 0:we.length)||0),console.log("    Total:",ie.total||0),console.log("    Full response:",JSON.stringify(ie,null,2)),ie.status==="success"&&ie.results&&ie.results.length>0?(t(4,_=ie.results[0]),t(6,g=_.rank||0),console.log("  ‚úÖ Found KG document:"),console.log("    Title:",_.title),console.log("    Rank:",g),console.log("    Body length:",((he=_.body)==null?void 0:he.length)||0,"characters"),t(2,p=!0)):(console.warn(`  ‚ö†Ô∏è  No KG documents found for term: "${U}" in role: "${c}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",Ce))}}catch(se){console.error("‚ùå Error fetching KG document:"),console.error("  Error type:",se.constructor.name),console.error("  Error message:",se.message||se),console.error("  Request details:",{tag:U,role:c,isTauri:r,timestamp:new Date().toISOString()}),!r&&((fe=se.message)!=null&&fe.includes("Failed to fetch"))&&(console.error("  üí° Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{t(7,y=!1)}}async function L(){var U;if(!(w||!i.id||!c)){t(9,w=!0),t(10,b=null),console.log("ü§ñ AI Summary Debug Info:"),console.log("  Document ID:",i.id),console.log("  Current role:",c),console.log("  Is Tauri mode:",r);try{const oe={document_id:i.id,role:c,max_length:250,force_regenerate:!1};console.log("  üì§ Summarization request:",oe);let ge;if(r){const fe=`${Ze.ServerURL}/documents/summarize`;ge=await fetch(fe,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(oe)})}else{const fe=`${Ze.ServerURL}/documents/summarize`;ge=await fetch(fe,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(oe)})}if(console.log("  üì• Summary response received:"),console.log("    Status code:",ge.status),console.log("    Status text:",ge.statusText),!ge.ok)throw new Error(`HTTP error! Status: ${ge.status} - ${ge.statusText}`);const we=await ge.json();console.log("  üìÑ Summary response data:",we),we.status==="Success"&&we.summary?(t(8,k=we.summary),t(12,$=we.from_cache||!1),t(11,h=!0),console.log("  ‚úÖ Summary generated successfully"),console.log("    Summary length:",k.length,"characters"),console.log("    From cache:",$),console.log("    Model used:",we.model_used)):(t(10,b=we.error||"Failed to generate summary"),console.error("  ‚ùå Summary generation failed:",b))}catch(oe){console.error("‚ùå Error generating summary:"),console.error("  Error type:",oe.constructor.name),console.error("  Error message:",oe.message||oe),console.error("  Request details:",{document_id:i.id,role:c,isTauri:r,timestamp:new Date().toISOString()}),t(10,b=oe.message||"Network error occurred"),(U=oe.message)!=null&&U.includes("Failed to fetch")&&(console.error("  üí° Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Verify OpenRouter is enabled for this role"),console.error("    3. Check OPENROUTER_KEY environment variable"),console.error("    4. Verify server URL in CONFIG.ServerURL"))}finally{t(9,w=!1)}}}function G(){console.log("üì• Downloading document as markdown:",i.title);let U=`# ${i.title}

`;U+=`**Source:** Terraphim Search
`,U+=`**Rank:** ${i.rank||"N/A"}
`,i.url&&(U+=`**URL:** ${i.url}
`),i.tags&&i.tags.length>0&&(U+=`**Tags:** ${i.tags.join(", ")}
`),U+=`**Downloaded:** ${new Date().toISOString()}

`,i.description&&(U+=`## Description

${i.description}

`),U+=`## Content

${i.body}
`;const oe=`${i.title.replace(/[^a-z0-9]/gi,"_").toLowerCase()}_${Date.now()}.md`,ge=new Blob([U],{type:"text/markdown"}),we=URL.createObjectURL(ge),he=window.document.createElement("a");he.href=we,he.download=oe,window.document.body.appendChild(he),he.click(),window.document.body.removeChild(he),URL.revokeObjectURL(we),console.log("‚úÖ Markdown file downloaded:",oe)}function S(){const U=`vscode://${encodeURIComponent(i.title)}.md?${encodeURIComponent(i.body)}`;window.open(U,"_blank")}async function j(){console.log("üìù Adding document to LLM context:",i.title),z=!0,O=!1,t(13,I=null);try{let U=null;if(r){try{const we=await je("list_conversations");if(console.log("üìã Available conversations:",we),we!=null&&we.conversations&&we.conversations.length>0)U=we.conversations[0].id,console.log("üéØ Using existing conversation:",U);else{const he=await je("create_conversation",{title:"Search Context",role:c||"default"});if(he.status==="Success"&&he.conversationId)U=he.conversationId,console.log("üÜï Created new conversation:",U);else throw new Error("Failed to create conversation: "+(he.error||"Unknown error"))}}catch(we){throw console.error("‚ùå Failed to manage conversations:",we),new Error("Could not create or find conversation: "+we.message)}const oe={source_type:"document",document_id:i.id};i.url&&(oe.url=i.url),i.tags&&i.tags.length>0&&(oe.tags=i.tags.join(", ")),i.rank!==void 0&&(oe.rank=i.rank.toString());const ge=await je("add_context_to_conversation",{conversationId:U,contextType:"document",title:i.title,content:i.body,metadata:oe});console.log("‚úÖ Document added to context via Tauri:",ge)}else{const oe=Ze.ServerURL;try{const fe=await fetch(`${oe}/conversations`);if(fe.ok){const se=await fe.json();if(se.conversations&&se.conversations.length>0)U=se.conversations[0].id,console.log("üéØ Using existing conversation:",U);else{const ue=await fetch(`${oe}/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"Search Context",role:c||"default"})});if(ue.ok){const ke=await ue.json();if(ke.status==="Success"&&ke.conversation_id)U=ke.conversation_id,console.log("üÜï Created new conversation:",U);else throw new Error("Failed to create conversation: "+(ke.error||"Unknown error"))}else throw new Error(`Failed to create conversation: ${ue.status} ${ue.statusText}`)}}else throw new Error(`Failed to list conversations: ${fe.status} ${fe.statusText}`)}catch(fe){throw console.error("‚ùå Failed to manage conversations:",fe),new Error("Could not create or find conversation: "+fe.message)}const ge=`${oe}/conversations/${U}/context`,we=await fetch(ge,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context_item:{id:"",context_type:"Document",title:i.title,content:i.body,metadata:{source_type:"document",document_id:i.id,url:i.url||"",tags:i.tags?i.tags.join(", "):"",rank:i.rank?i.rank.toString():"0"},created_at:new Date().toISOString(),relevance_score:i.rank}})});if(!we.ok)throw new Error(`HTTP error! Status: ${we.status} - ${we.statusText}`);const he=await we.json();console.log("‚úÖ Document added to context via HTTP:",he)}console.log("‚úÖ Successfully added document to LLM context"),O=!0,setTimeout(()=>{O=!1},3e3)}catch(U){console.error("‚ùå Error adding document to context:",U),t(13,I=U.message||"Failed to add document to context"),setTimeout(()=>{t(13,I=null)},5e3)}finally{z=!1}}El[c]!==void 0&&(console.log("Have attribute",El[c]),El[c].hasOwnProperty("enableLogseq")?console.log("enable logseq True"):console.log("Didn't make it"));const B=U=>T(U),F=()=>{t(10,b=null),L()},Y=()=>t(11,h=!1),P=()=>{L()},N=()=>t(13,I=null);function q(U){d=U,t(1,d)}function W(U){p=U,t(2,p)}function X(U){m=U,t(3,m)}return l.$$set=U=>{"document"in U&&t(0,i=U.document)},t(14,o=V()),t(15,n=E()),[i,d,p,m,_,C,g,y,k,w,b,h,$,I,o,n,J,T,L,B,F,Y,P,N,q,W,X]}class ki extends _t{constructor(e){super(),ht(this,e,bi,vi,ct,{document:0},null,[-1,-1])}}const wi="/assets/terraphim_gray.png";function yi(l){const e=l.trim();if(!e)return{hasOperator:!1,operator:null,terms:[l],originalQuery:l};const t=/\b(and)\b/i,o=/\b(or)\b/i,n=t.test(e),c=o.test(e);if(n&&!c)return{hasOperator:!0,operator:"AND",terms:e.split(t).filter((u,i)=>i%2===0).map(u=>u.trim()).filter(u=>u.length>0),originalQuery:l};if(c&&!n)return{hasOperator:!0,operator:"OR",terms:e.split(o).filter((u,i)=>i%2===0).map(u=>u.trim()).filter(u=>u.length>0),originalQuery:l};if(n&&c){const r=e.toLowerCase().indexOf(" and "),u=e.toLowerCase().indexOf(" or ");if(r!==-1&&(u===-1||r<u))return{hasOperator:!0,operator:"AND",terms:e.split(t).filter((d,p)=>p%2===0).map(d=>d.trim()).filter(d=>d.length>0),originalQuery:l};if(u!==-1)return{hasOperator:!0,operator:"OR",terms:e.split(o).filter((d,p)=>p%2===0).map(d=>d.trim()).filter(d=>d.length>0),originalQuery:l}}return{hasOperator:!1,operator:null,terms:[e],originalQuery:l}}function Xo(l,e){var o,n;if(l.hasOperator&&l.terms.length>1){const c=l.terms.filter(r=>r.trim().length>0);if(c.length>1)return{search_term:c[0],search_terms:c,operator:(o=l.operator)==null?void 0:o.toLowerCase(),skip:0,limit:50,role:e||null}}return{search_term:((n=l.terms[0])==null?void 0:n.trim())||"",search_terms:void 0,operator:void 0,skip:0,limit:50,role:e||null}}function xo(l,e,t){const o=l.slice();return o[27]=e[t],o}function en(l,e,t){const o=l.slice();return o[30]=e[t],o[32]=t,o}function tn(l){let e,t=l[2],o=[];for(let n=0;n<t.length;n+=1)o[n]=ln(en(l,t,n));return{c(){e=f("ul");for(let n=0;n<o.length;n+=1)o[n].c();a(e,"class","suggestions svelte-e76e8j")},m(n,c){A(n,e,c);for(let r=0;r<o.length;r+=1)o[r]&&o[r].m(e,null)},p(n,c){if(c[0]&1036){t=n[2];let r;for(r=0;r<t.length;r+=1){const u=en(n,t,r);o[r]?o[r].p(u,c):(o[r]=ln(u),o[r].c(),o[r].m(e,null))}for(;r<o.length;r+=1)o[r].d(1);o.length=t.length}},d(n){n&&R(e),Ve(o,n)}}}function ln(l){let e,t=l[30]+"",o,n,c,r,u,i;function d(){return l[14](l[30])}function p(...m){return l[15](l[30],...m)}return{c(){e=f("li"),o=D(t),n=v(),a(e,"tabindex","0"),a(e,"role","option"),a(e,"aria-selected",c=l[32]===l[3]),a(e,"aria-label",r=`Apply suggestion: ${l[30]}`),a(e,"class","svelte-e76e8j"),Nt(e,"active",l[32]===l[3])},m(m,_){A(m,e,_),s(e,o),s(e,n),u||(i=[ee(e,"click",d),ee(e,"keydown",p)],u=!0)},p(m,_){l=m,_[0]&4&&t!==(t=l[30]+"")&&ve(o,t),_[0]&8&&c!==(c=l[32]===l[3])&&a(e,"aria-selected",c),_[0]&4&&r!==(r=`Apply suggestion: ${l[30]}`)&&a(e,"aria-label",r),_[0]&8&&Nt(e,"active",l[32]===l[3])},d(m){m&&R(e),u=!1,Qe(i)}}}function $i(l){let e,t,o,n,c,r,u,i,d,p,m,_,C,g,y,k,w,b,h,$,z,O,I;function E(K){l[13](K)}let V={type:"search",placeholder:l[7]?`Search over Knowledge graph for ${l[6]}`:"Search",icon:"search",expanded:!0,autofocus:!0};l[5]!==void 0&&(V.value=l[5]),o=new Vt({props:V}),Xe.push(()=>et(o,"value",E)),o.$on("click",l[11]),o.$on("submit",l[11]),o.$on("keydown",l[9]),o.$on("input",l[8]);let J=l[2].length>0&&tn(l);return z=xn(l[17][0]),{c(){e=f("div"),t=f("div"),pe(o.$$.fragment),c=v(),J&&J.c(),r=v(),u=f("div"),i=f("div"),d=f("label"),p=f("input"),m=D(`
            Exact`),_=v(),C=f("label"),g=f("input"),y=D(`
            All (AND)`),k=v(),w=f("label"),b=f("input"),h=D(`
            Any (OR)`),a(t,"class","input-wrapper svelte-e76e8j"),a(p,"type","radio"),p.__value="none",p.value=p.__value,a(p,"class","svelte-e76e8j"),a(d,"class","radio svelte-e76e8j"),a(g,"type","radio"),g.__value="and",g.value=g.__value,a(g,"class","svelte-e76e8j"),a(C,"class","radio svelte-e76e8j"),a(b,"type","radio"),b.__value="or",b.value=b.__value,a(b,"class","svelte-e76e8j"),a(w,"class","radio svelte-e76e8j"),a(i,"class","control svelte-e76e8j"),a(u,"class","operator-controls svelte-e76e8j"),a(e,"class","search-row svelte-e76e8j"),z.p(p,g,b)},m(K,T){A(K,e,T),s(e,t),me(o,t,null),s(t,c),J&&J.m(t,null),s(e,r),s(e,u),s(u,i),s(i,d),s(d,p),p.checked=p.__value===l[4],s(d,m),s(i,_),s(i,C),s(C,g),g.checked=g.__value===l[4],s(C,y),s(i,k),s(i,w),s(w,b),b.checked=b.__value===l[4],s(w,h),$=!0,O||(I=[ee(p,"change",l[16]),ee(g,"change",l[18]),ee(b,"change",l[19])],O=!0)},p(K,T){const L={};T[0]&192&&(L.placeholder=K[7]?`Search over Knowledge graph for ${K[6]}`:"Search"),!n&&T[0]&32&&(n=!0,L.value=K[5],tt(()=>n=!1)),o.$set(L),K[2].length>0?J?J.p(K,T):(J=tn(K),J.c(),J.m(t,null)):J&&(J.d(1),J=null),T[0]&16&&(p.checked=p.__value===K[4]),T[0]&16&&(g.checked=g.__value===K[4]),T[0]&16&&(b.checked=b.__value===K[4])},i(K){$||(Q(o.$$.fragment,K),$=!0)},o(K){Z(o.$$.fragment,K),$=!1},d(K){K&&R(e),_e(o),J&&J.d(),z.r(),O=!1,Qe(I)}}}function Ci(l){let e,t,o,n,c,r,u,i,d,p;return{c(){e=f("section"),t=f("div"),o=f("img"),c=v(),r=f("p"),r.textContent="I am Terraphim, your personal assistant.",u=v(),i=f("button"),i.innerHTML=`<span class="icon"><i class="fas fa-magic"></i></span> 
        <span>Configuration Wizard</span>`,$s(o.src,n=wi)||a(o,"src",n),a(o,"alt","Terraphim Logo"),a(o,"class","svelte-e76e8j"),a(i,"class","button is-primary"),a(i,"data-testid","wizard-start"),a(t,"class","content has-text-grey has-text-centered svelte-e76e8j"),a(e,"class","section")},m(m,_){A(m,e,_),s(e,t),s(t,o),s(t,c),s(t,r),s(t,u),s(t,i),d||(p=ee(i,"click",l[20]),d=!0)},p:Te,i:Te,o:Te,d(m){m&&R(e),d=!1,p()}}}function Si(l){let e,t,o=l[0],n=[];for(let r=0;r<o.length;r+=1)n[r]=on(xo(l,o,r));const c=r=>Z(n[r],1,1,()=>{n[r]=null});return{c(){for(let r=0;r<n.length;r+=1)n[r].c();e=lt()},m(r,u){for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(r,u);A(r,e,u),t=!0},p(r,u){if(u[0]&1){o=r[0];let i;for(i=0;i<o.length;i+=1){const d=xo(r,o,i);n[i]?(n[i].p(d,u),Q(n[i],1)):(n[i]=on(d),n[i].c(),Q(n[i],1),n[i].m(e.parentNode,e))}for(qe(),i=o.length;i<n.length;i+=1)c(i);Ge()}},i(r){if(!t){for(let u=0;u<o.length;u+=1)Q(n[u]);t=!0}},o(r){n=n.filter(Boolean);for(let u=0;u<n.length;u+=1)Z(n[u]);t=!1},d(r){Ve(n,r),r&&R(e)}}}function Ti(l){let e,t;return{c(){e=f("p"),t=D(l[1]),a(e,"class","error svelte-e76e8j")},m(o,n){A(o,e,n),s(e,t)},p(o,n){n[0]&2&&ve(t,o[1])},i:Te,o:Te,d(o){o&&R(e)}}}function on(l){let e,t;return e=new ki({props:{document:l[27]}}),{c(){pe(e.$$.fragment)},m(o,n){me(e,o,n),t=!0},p(o,n){const c={};n[0]&1&&(c.document=o[27]),e.$set(c)},i(o){t||(Q(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){_e(e,o)}}}function Ri(l){let e,t,o,n,c,r,u,i,d,p,m;e=new il({props:{fallbackPath:"/"}}),n=new Ht({props:{$$slots:{default:[$i]},$$scope:{ctx:l}}});const _=[Ti,Si,Ci],C=[];function g(y,k){return y[1]?0:y[0].length?1:2}return r=g(l),u=C[r]=_[r](l),{c(){pe(e.$$.fragment),t=v(),o=f("form"),pe(n.$$.fragment),c=v(),u.c(),i=lt()},m(y,k){me(e,y,k),A(y,t,k),A(y,o,k),me(n,o,null),A(y,c,k),C[r].m(y,k),A(y,i,k),d=!0,p||(m=ee(o,"submit",ys(l[11])),p=!0)},p(y,k){const w={};k[0]&252|k[1]&4&&(w.$$scope={dirty:k,ctx:y}),n.$set(w);let b=r;r=g(y),r===b?C[r].p(y,k):(qe(),Z(C[b],1,1,()=>{C[b]=null}),Ge(),u=C[r],u?u.p(y,k):(u=C[r]=_[r](y),u.c()),Q(u,1),u.m(i.parentNode,i))},i(y){d||(Q(e.$$.fragment,y),Q(n.$$.fragment,y),Q(u),d=!0)},o(y){Z(e.$$.fragment,y),Z(n.$$.fragment,y),Z(u),d=!1},d(y){_e(e,y),y&&R(t),y&&R(o),_e(n),y&&R(c),C[r].d(y),y&&R(i),p=!1,m()}}}function Ai(l,e,t){let o,n,c,r,u,i,d;Oe(l,Vs,G=>t(22,n=G)),Oe(l,Ll,G=>t(5,c=G)),Oe(l,Je,G=>t(23,r=G)),Oe(l,St,G=>t(6,u=G)),Oe(l,dl,G=>t(12,i=G)),Oe(l,Ct,G=>t(7,d=G));let p=[],m=null,_=[],C=-1,g="none";async function y(G){try{if(r){const S=await je("get_autocomplete_suggestions",{query:G,roleName:u,limit:8});if(S.status==="success"&&S.suggestions)return S.suggestions.map(j=>j.term)}else{const S=await fetch(`${n.replace("/documents/search","")}/autocomplete/${encodeURIComponent(u)}/${encodeURIComponent(G)}`);if(S.ok){const j=await S.json();if(j.status==="success"&&j.suggestions)return j.suggestions.map(B=>B.term)}}return o.filter(([S])=>S.toLowerCase().includes(G.toLowerCase())).map(([S])=>S).slice(0,8)}catch(S){return console.warn("Error fetching term suggestions:",S),[]}}async function k(G){const S=G.trim();if(S.length===0)return[];if(g!=="none"){const P=S.split(/\s+/),N=P[P.length-1].toLowerCase();return N.length<2?[]:y(N)}const B=S.split(/\s+/),F=B[B.length-1].toLowerCase();if(B.length>1&&g==="none"){const P=[];if("and".startsWith(F)&&P.push("AND"),"or".startsWith(F)&&P.push("OR"),P.length>0)return P}const Y=S.toLowerCase();if(Y.includes(" and ")||Y.includes(" or ")){const P=F;return P.length<2?[]:y(P)}try{const P=await y(S);return B.length===1&&B[0].length>2&&g==="none"?[...P.slice(0,6),"AND","OR"]:P}catch(P){console.warn("Error fetching autocomplete suggestions:",P);const N=o.filter(([q])=>q.toLowerCase().includes(S.toLowerCase())).map(([q])=>q).slice(0,6);return B.length===1&&B[0].length>2&&g==="none"?[...N,"AND","OR"]:N}}async function w(G){const S=G.target;if(!S||S.selectionStart==null)return;const j=S.selectionStart,F=c.slice(0,j).split(/\s+/),Y=F[F.length-1];if(Y.length>=2)try{t(2,_=await k(Y))}catch(P){console.warn("Failed to get suggestions:",P),t(2,_=[])}else t(2,_=[]);t(3,C=-1)}function b(G){_.length!==0&&(G.key==="ArrowDown"?(G.preventDefault(),t(3,C=(C+1)%_.length)):G.key==="ArrowUp"?(G.preventDefault(),t(3,C=(C-1+_.length)%_.length)):(G.key==="Enter"||G.key==="Tab")&&C!==-1&&(G.preventDefault(),h(_[C])))}function h(G){var P,N;const S=document.querySelector('input[type="search"]'),j=(S==null?void 0:S.selectionStart)??0,B=c.slice(0,j),F=c.slice(j),Y=B.split(/\s+/);if(G==="AND"||G==="OR"){Y[Y.length-1]=G,pl(Ll,c=[...Y,"",F].join(" "),c);const q=j+G.length+1;(P=S==null?void 0:S.setSelectionRange)==null||P.call(S,q,q)}else{Y[Y.length-1]=G,pl(Ll,c=[...Y,F].join(" "),c);const q=j+G.length;(N=S==null?void 0:S.setSelectionRange)==null||N.call(S,q,q)}t(2,_=[]),t(3,C=-1)}function $(){const G=c.trim();if(!G)return null;if(g!=="none"){const B=G.split(/\s+/).filter(F=>F.length>0);return B.length>1?{...Xo({hasOperator:!0,operator:g==="and"?"AND":"OR",terms:B,originalQuery:G},u),skip:0,limit:10}:{search_term:G,skip:0,limit:10,role:u}}const S=yi(G);return{...Xo(S,u),skip:0,limit:10}}async function z(){if(t(1,m=null),r){if(!c.trim())return;try{const G=$();if(!G)return;const S=await je("search",{searchQuery:G});S.status==="success"?(t(0,p=S.results),console.log("Response results"),console.log(p)):(t(1,m=`Search failed: ${S.status}`),console.error("Search failed:",S))}catch(G){t(1,m=`Error in Tauri search: ${G}`),console.error("Error in Tauri search:",G)}}else{if(!c.trim())return;const G=$();if(!G)return;const S=JSON.stringify(G);try{const j=await fetch(n,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:S}),B=await j.json();if(!j.ok)throw new Error(`HTTP error! Status: ${j.status}`);t(0,p=B.results)}catch(j){console.error("Error fetching data:",j),t(1,m=`Error fetching data: ${j}`)}}}const O=[[]];function I(G){c=G,Ll.set(c)}const E=G=>h(G),V=(G,S)=>{(S.key==="Enter"||S.key===" ")&&(S.preventDefault(),h(G))};function J(){g=this.__value,t(4,g)}function K(){g=this.__value,t(4,g)}function T(){g=this.__value,t(4,g)}const L=()=>window.location.href="/config/wizard";return l.$$.update=()=>{l.$$.dirty[0]&4096&&(o=Object.entries(i))},[p,m,_,C,g,c,u,d,w,b,h,z,i,I,E,V,J,O,K,T,L]}class Li extends _t{constructor(e){super(),ht(this,e,Ai,Ri,ct,{},null,[-1,-1])}}async function nn(l={}){return typeof l=="object"&&Object.freeze(l),Fl({__tauriModule:"Dialog",message:{cmd:"openDialog",options:l}})}function sn(l,e,t){const o=l.slice();return o[71]=e[t],o[79]=t,o}function rn(l,e,t){const o=l.slice();return o[77]=e[t],o[78]=e,o[79]=t,o}function an(l,e,t){const o=l.slice();return o[80]=e[t],o}function cn(l,e,t){const o=l.slice();return o[80]=e[t],o}function un(l,e,t){const o=l.slice();return o[85]=e[t],o[86]=e,o[87]=t,o}function fn(l,e,t){const o=l.slice();return o[88]=e[t][0],o[89]=e[t][1],o[90]=e,o[91]=t,o}function dn(l,e,t){const o=l.slice();return o[74]=e[t],o}function pn(l,e,t){const o=l.slice();return o[71]=e[t],o}function mn(l,e,t){const o=l.slice();return o[74]=e[t],o}function _n(l){let e,t,o,n,c;return{c(){e=f("div"),t=f("button"),o=D(`
      Configuration saved successfully!`),a(t,"class","delete"),a(e,"class","notification is-success"),a(e,"data-testid","wizard-success")},m(r,u){A(r,e,u),s(e,t),s(e,o),n||(c=ee(t,"click",l[20]),n=!0)},p:Te,d(r){r&&R(e),n=!1,c()}}}function hn(l){let e,t,o,n,c;return{c(){e=f("div"),t=f("button"),o=D(`
      Failed to save configuration. Please try again.`),a(t,"class","delete"),a(e,"class","notification is-danger"),a(e,"data-testid","wizard-error")},m(r,u){A(r,e,u),s(e,t),s(e,o),n||(c=ee(t,"click",l[21]),n=!0)},p:Te,d(r){r&&R(e),n=!1,c()}}}function Ei(l){let e,t,o,n,c,r,u,i,d,p=l[3].id+"",m,_,C,g,y,k=l[3].global_shortcut+"",w,b,h,$,z,O=l[3].default_theme+"",I,E,V,J,K,T=l[3].default_role+"",L,G,S,j,B,F,Y=JSON.stringify(l[3],null,2)+"",P,N=l[3].roles,q=[];for(let W=0;W<N.length;W+=1)q[W]=gn(sn(l,N,W));return{c(){e=f("h4"),e.textContent="Review",t=v(),o=f("div"),n=f("h5"),n.textContent="Configuration Summary:",c=v(),r=f("ul"),u=f("li"),i=f("strong"),i.textContent="Configuration ID:",d=v(),m=D(p),_=v(),C=f("li"),g=f("strong"),g.textContent="Global Shortcut:",y=v(),w=D(k),b=v(),h=f("li"),$=f("strong"),$.textContent="Default Theme:",z=v(),I=D(O),E=v(),V=f("li"),J=f("strong"),J.textContent="Default Role:",K=v(),L=D(T),G=v(),S=f("h5"),S.textContent="Roles:",j=v();for(let W=0;W<q.length;W+=1)q[W].c();B=v(),F=f("pre"),P=D(Y),a(e,"class","title is-5"),a(o,"class","content"),de(F,"max-height","300px"),de(F,"overflow","auto")},m(W,X){A(W,e,X),A(W,t,X),A(W,o,X),s(o,n),s(o,c),s(o,r),s(r,u),s(u,i),s(u,d),s(u,m),s(r,_),s(r,C),s(C,g),s(C,y),s(C,w),s(r,b),s(r,h),s(h,$),s(h,z),s(h,I),s(r,E),s(r,V),s(V,J),s(V,K),s(V,L),s(o,G),s(o,S),s(o,j);for(let U=0;U<q.length;U+=1)q[U]&&q[U].m(o,null);A(W,B,X),A(W,F,X),s(F,P)},p(W,X){if(X[0]&8&&p!==(p=W[3].id+"")&&ve(m,p),X[0]&8&&k!==(k=W[3].global_shortcut+"")&&ve(w,k),X[0]&8&&O!==(O=W[3].default_theme+"")&&ve(I,O),X[0]&8&&T!==(T=W[3].default_role+"")&&ve(L,T),X[0]&10){N=W[3].roles;let U;for(U=0;U<N.length;U+=1){const oe=sn(W,N,U);q[U]?q[U].p(oe,X):(q[U]=gn(oe),q[U].c(),q[U].m(o,null))}for(;U<q.length;U+=1)q[U].d(1);q.length=N.length}X[0]&8&&Y!==(Y=JSON.stringify(W[3],null,2)+"")&&ve(P,Y)},d(W){W&&R(e),W&&R(t),W&&R(o),Ve(q,W),W&&R(B),W&&R(F)}}}function Pi(l){let e,t,o=[],n=new Map,c,r,u,i,d=l[3].roles;const p=m=>m[77].name;for(let m=0;m<d.length;m+=1){let _=rn(l,d,m),C=p(_);n.set(C,o[m]=On(C,_))}return{c(){e=f("h4"),e.textContent="Roles",t=v();for(let m=0;m<o.length;m+=1)o[m].c();c=v(),r=f("button"),r.textContent="Add Role",a(e,"class","title is-5"),a(r,"class","button is-link is-light"),a(r,"data-testid","add-role")},m(m,_){A(m,e,_),A(m,t,_);for(let C=0;C<o.length;C+=1)o[C]&&o[C].m(m,_);A(m,c,_),A(m,r,_),u||(i=ee(r,"click",l[12]),u=!0)},p(m,_){_[0]&516985&&(d=m[3].roles,o=Cs(o,_,p,1,m,d,n,c.parentNode,Ss,On,c,rn))},d(m){m&&R(e),m&&R(t);for(let _=0;_<o.length;_+=1)o[_].d(m);m&&R(c),m&&R(r),u=!1,i()}}}function Oi(l){let e,t,o,n,c,r,u,i,d,p,m,_,C,g,y,k,w,b,h,$,z,O,I,E,V,J,K,T,L,G,S,j=l[8],B=[];for(let P=0;P<j.length;P+=1)B[P]=In(mn(l,j,P));let F=l[3].roles,Y=[];for(let P=0;P<F.length;P+=1)Y[P]=Nn(pn(l,F,P));return{c(){e=f("div"),t=f("label"),t.textContent="Configuration ID",o=v(),n=f("div"),c=f("div"),r=f("select"),u=f("option"),u.textContent="Desktop",i=f("option"),i.textContent="Server",d=f("option"),d.textContent="Embedded",p=v(),m=f("div"),_=f("label"),_.textContent="Global shortcut",C=v(),g=f("div"),y=f("input"),k=v(),w=f("div"),b=f("label"),b.textContent="Default theme",h=v(),$=f("div"),z=f("div"),O=f("select");for(let P=0;P<B.length;P+=1)B[P].c();I=v(),E=f("div"),V=f("label"),V.textContent="Default Role",J=v(),K=f("div"),T=f("div"),L=f("select");for(let P=0;P<Y.length;P+=1)Y[P].c();a(t,"class","label"),a(t,"for","config-id"),u.__value="Desktop",u.value=u.__value,i.__value="Server",i.value=i.__value,d.__value="Embedded",d.value=d.__value,a(r,"id","config-id"),l[3].id===void 0&&at(()=>l[22].call(r)),a(c,"class","select"),a(n,"class","control"),a(e,"class","field"),a(_,"class","label"),a(_,"for","global-shortcut"),a(y,"class","input"),a(y,"id","global-shortcut"),a(y,"type","text"),a(g,"class","control"),a(m,"class","field"),a(b,"class","label"),a(b,"for","default-theme"),a(O,"id","default-theme"),l[3].default_theme===void 0&&at(()=>l[24].call(O)),a(z,"class","select is-fullwidth"),a($,"class","control"),a(w,"class","field"),a(V,"class","label"),a(V,"for","default-role"),a(L,"id","default-role"),l[3].default_role===void 0&&at(()=>l[25].call(L)),a(T,"class","select"),a(K,"class","control"),a(E,"class","field")},m(P,N){A(P,e,N),s(e,t),s(e,o),s(e,n),s(n,c),s(c,r),s(r,u),s(r,i),s(r,d),He(r,l[3].id,!0),A(P,p,N),A(P,m,N),s(m,_),s(m,C),s(m,g),s(g,y),Ne(y,l[3].global_shortcut),A(P,k,N),A(P,w,N),s(w,b),s(w,h),s(w,$),s($,z),s(z,O);for(let q=0;q<B.length;q+=1)B[q]&&B[q].m(O,null);He(O,l[3].default_theme,!0),A(P,I,N),A(P,E,N),s(E,V),s(E,J),s(E,K),s(K,T),s(T,L);for(let q=0;q<Y.length;q+=1)Y[q]&&Y[q].m(L,null);He(L,l[3].default_role,!0),G||(S=[ee(r,"change",l[22]),ee(y,"input",l[23]),ee(O,"change",l[24]),ee(L,"change",l[25])],G=!0)},p(P,N){if(N[0]&264&&He(r,P[3].id),N[0]&264&&y.value!==P[3].global_shortcut&&Ne(y,P[3].global_shortcut),N[0]&256){j=P[8];let q;for(q=0;q<j.length;q+=1){const W=mn(P,j,q);B[q]?B[q].p(W,N):(B[q]=In(W),B[q].c(),B[q].m(O,null))}for(;q<B.length;q+=1)B[q].d(1);B.length=j.length}if(N[0]&264&&He(O,P[3].default_theme),N[0]&8){F=P[3].roles;let q;for(q=0;q<F.length;q+=1){const W=pn(P,F,q);Y[q]?Y[q].p(W,N):(Y[q]=Nn(W),Y[q].c(),Y[q].m(L,null))}for(;q<Y.length;q+=1)Y[q].d(1);Y.length=F.length}N[0]&264&&He(L,P[3].default_role)},d(P){P&&R(e),P&&R(p),P&&R(m),P&&R(k),P&&R(w),Ve(B,P),P&&R(I),P&&R(E),Ve(Y,P),G=!1,Qe(S)}}}function gn(l){let e,t,o=l[71].name+"",n,c,r,u,i,d=l[71].shortname+"",p,m,_,C,g,y=l[71].theme+"",k,w,b,h,$,z=l[71].relevance_function+"",O,I,E,V,J,K;return{c(){e=f("div"),t=f("h6"),n=D(o),c=v(),r=f("p"),u=f("strong"),u.textContent="Shortname:",i=v(),p=D(d),m=v(),_=f("p"),C=f("strong"),C.textContent="Theme:",g=v(),k=D(y),w=v(),b=f("p"),h=f("strong"),h.textContent="Relevance Function:",$=v(),O=D(z),I=v(),E=f("button"),E.textContent="Edit Role",V=v(),a(t,"data-testid","review-role-name-"+l[79]),a(E,"class","button is-small"),a(E,"data-testid","edit-role-"+l[79]),a(e,"class","box")},m(T,L){A(T,e,L),s(e,t),s(t,n),s(e,c),s(e,r),s(r,u),s(r,i),s(r,p),s(e,m),s(e,_),s(_,C),s(_,g),s(_,k),s(e,w),s(e,b),s(b,h),s(b,$),s(b,O),s(e,I),s(e,E),s(e,V),J||(K=ee(E,"click",l[68]),J=!0)},p(T,L){L[0]&8&&o!==(o=T[71].name+"")&&ve(n,o),L[0]&8&&d!==(d=T[71].shortname+"")&&ve(p,d),L[0]&8&&y!==(y=T[71].theme+"")&&ve(k,y),L[0]&8&&z!==(z=T[71].relevance_function+"")&&ve(O,z)},d(T){T&&R(e),J=!1,K()}}}function vn(l){let e,t=l[74]+"",o;return{c(){e=f("option"),o=D(t),e.__value=l[74],e.value=e.__value},m(n,c){A(n,e,c),s(e,o)},p:Te,d(n){n&&R(e)}}}function Ii(l){let e;return{c(){e=D("Directory Path")},m(t,o){A(t,e,o)},d(t){t&&R(e)}}}function Ni(l){let e;return{c(){e=D("Server URL")},m(t,o){A(t,e,o)},d(t){t&&R(e)}}}function bn(l){let e;return{c(){e=f("p"),e.textContent="Click to select directory",a(e,"class","help")},m(t,o){A(t,e,o)},d(t){t&&R(e)}}}function kn(l){let e,t,o,n,c,r,u,i,d,p,m,_;function C(){l[34].call(u,l[79],l[87])}return{c(){e=f("div"),t=f("label"),o=D("Atomic Server Secret"),c=v(),r=f("div"),u=f("input"),d=v(),p=f("p"),p.textContent="Leave empty for anonymous access",a(t,"class","label"),a(t,"for",n=`haystack-secret-${l[79]}-${l[87]}`),a(u,"class","input"),a(u,"id",i=`haystack-secret-${l[79]}-${l[87]}`),a(u,"type","password"),a(u,"placeholder","Base64 encoded secret (optional)"),a(r,"class","control"),a(p,"class","help"),a(e,"class","field")},m(g,y){A(g,e,y),s(e,t),s(t,o),s(e,c),s(e,r),s(r,u),Ne(u,l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret),s(e,d),s(e,p),m||(_=ee(u,"input",C),m=!0)},p(g,y){l=g,y[0]&264&&n!==(n=`haystack-secret-${l[79]}-${l[87]}`)&&a(t,"for",n),y[0]&264&&i!==(i=`haystack-secret-${l[79]}-${l[87]}`)&&a(u,"id",i),y[0]&264&&u.value!==l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret&&Ne(u,l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret)},d(g){g&&R(e),m=!1,_()}}}function wn(l){let e,t,o,n,c,r,u,i,d,p,m,_,C,g,y,k,w,b,h,$,z,O,I,E,V,J,K,T,L,G,S,j,B,F,Y,P,N,q,W,X,U,oe,ge;function we(){l[35].call(p,l[79],l[87])}function he(...te){return l[36](l[79],l[87],...te)}let fe=Object.entries(l[3].roles[l[79]].haystacks[l[87]].extra_parameters||{}),se=[];for(let te=0;te<fe.length;te+=1)se[te]=yn(fn(l,fe,te));function ue(){return l[40](l[79],l[87])}function ke(){return l[41](l[79],l[87])}function Ce(){return l[42](l[79],l[87])}return{c(){e=f("div"),t=f("label"),t.textContent="Extra Parameters (for filtering)",o=v(),n=f("div"),c=f("div"),r=f("label"),u=D("Hashtag"),d=v(),p=f("input"),_=v(),C=f("div"),g=f("div"),y=f("label"),k=D("Presets"),b=v(),h=f("div"),$=f("select"),z=f("option"),z.textContent="(choose)",O=f("option"),O.textContent="#rust",I=f("option"),I.textContent="#docs",E=f("option"),E.textContent="#test",V=f("option"),V.textContent="#todo",K=v(),T=f("p"),T.innerHTML="When set, searches will enforce the hashtag alongside your query (AND), e.g. <code>-e &quot;search&quot; -e &quot;#rust&quot;</code>.",L=v();for(let te=0;te<se.length;te+=1)se[te].c();G=v(),S=f("div"),j=f("div"),B=f("button"),B.textContent="+ Tag Filter",F=v(),Y=f("div"),P=f("button"),P.textContent="+ Max Results",N=v(),q=f("div"),W=f("button"),W.textContent="+ Custom Parameter",X=v(),U=f("p"),U.innerHTML=`Common parameters: <code>tag</code> (e.g., &quot;#rust&quot;), <code>glob</code> (e.g., &quot;*.md&quot;),
                  <code>max_count</code> (e.g., &quot;10&quot;), <code>context</code> (e.g., &quot;5&quot;)`,a(t,"class","label"),a(r,"class","label"),a(r,"for",i=`ripgrep-hashtag-${l[79]}-${l[87]}`),a(p,"class","input"),a(p,"id",m=`ripgrep-hashtag-${l[79]}-${l[87]}`),a(p,"type","text"),a(p,"placeholder","#rust"),a(c,"class","control"),a(n,"class","field is-grouped"),a(y,"class","label"),a(y,"for",w=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`),z.__value="",z.value=z.__value,O.__value="#rust",O.value=O.__value,I.__value="#docs",I.value=I.__value,E.__value="#test",E.value=E.__value,V.__value="#todo",V.value=V.__value,a($,"id",J=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`),a(h,"class","select is-small"),a(g,"class","control"),a(C,"class","field is-grouped"),de(C,"margin-bottom",".5rem"),a(T,"class","help"),a(B,"class","button is-small is-link is-light"),a(j,"class","control"),a(P,"class","button is-small is-link is-light"),a(Y,"class","control"),a(W,"class","button is-small is-link is-light"),a(q,"class","control"),a(S,"class","field is-grouped"),a(U,"class","help"),a(e,"class","field")},m(te,ie){A(te,e,ie),s(e,t),s(e,o),s(e,n),s(n,c),s(c,r),s(r,u),s(c,d),s(c,p),Ne(p,l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag),s(e,_),s(e,C),s(C,g),s(g,y),s(y,k),s(g,b),s(g,h),s(h,$),s($,z),s($,O),s($,I),s($,E),s($,V),s(e,K),s(e,T),s(e,L);for(let ae=0;ae<se.length;ae+=1)se[ae]&&se[ae].m(e,null);s(e,G),s(e,S),s(S,j),s(j,B),s(S,F),s(S,Y),s(Y,P),s(S,N),s(S,q),s(q,W),s(e,X),s(e,U),oe||(ge=[ee(p,"input",we),ee($,"change",he),ee(B,"click",ue),ee(P,"click",ke),ee(W,"click",Ce)],oe=!0)},p(te,ie){if(l=te,ie[0]&264&&i!==(i=`ripgrep-hashtag-${l[79]}-${l[87]}`)&&a(r,"for",i),ie[0]&264&&m!==(m=`ripgrep-hashtag-${l[79]}-${l[87]}`)&&a(p,"id",m),ie[0]&264&&p.value!==l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag&&Ne(p,l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag),ie[0]&264&&w!==(w=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`)&&a(y,"for",w),ie[0]&264&&J!==(J=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`)&&a($,"id",J),ie[0]&393224){fe=Object.entries(l[3].roles[l[79]].haystacks[l[87]].extra_parameters||{});let ae;for(ae=0;ae<fe.length;ae+=1){const ce=fn(l,fe,ae);se[ae]?se[ae].p(ce,ie):(se[ae]=yn(ce),se[ae].c(),se[ae].m(e,G))}for(;ae<se.length;ae+=1)se[ae].d(1);se.length=fe.length}},d(te){te&&R(e),Ve(se,te),oe=!1,Qe(ge)}}}function yn(l){let e,t,o,n,c,r,u,i,d,p,m,_,C;function g(...w){return l[37](l[79],l[87],l[88],...w)}function y(){l[38].call(u,l[79],l[87],l[88])}function k(){return l[39](l[79],l[87],l[88])}return{c(){e=f("div"),t=f("div"),o=f("input"),c=v(),r=f("div"),u=f("input"),i=v(),d=f("div"),p=f("button"),p.textContent="√ó",m=v(),a(o,"class","input"),a(o,"type","text"),a(o,"placeholder","Parameter name"),o.value=n=l[88],a(t,"class","control"),a(u,"class","input"),a(u,"type","text"),a(u,"placeholder","Parameter value"),a(r,"class","control is-expanded"),a(p,"class","button is-small is-danger"),a(d,"class","control"),a(e,"class","field is-grouped")},m(w,b){A(w,e,b),s(e,t),s(t,o),s(e,c),s(e,r),s(r,u),Ne(u,l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]]),s(e,i),s(e,d),s(d,p),s(e,m),_||(C=[ee(o,"blur",g),ee(u,"input",y),ee(p,"click",k)],_=!0)},p(w,b){l=w,b[0]&264&&n!==(n=l[88])&&o.value!==n&&(o.value=n),b[0]&264&&u.value!==l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]]&&Ne(u,l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]])},d(w){w&&R(e),_=!1,Qe(C)}}}function $n(l){let e,t,o,n,c,r,u,i,d,p,m,_,C,g,y,k,w,b,h,$,z,O,I,E,V,J,K,T,L,G,S,j,B,F,Y,P,N,q,W;function X(){l[31].call(d,l[79],l[87])}function U(te,ie){return te[3].roles[te[79]].haystacks[te[87]].service==="Atomic"?Ni:Ii}let oe=U(l),ge=oe(l);function we(){l[32].call(h,l[79],l[87])}function he(){return l[33](l[79],l[87])}let fe=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"&&bn(),se=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"&&kn(l),ue=l[3].roles[l[79]].haystacks[l[87]].service==="Ripgrep"&&wn(l);function ke(){l[43].call(L,l[79],l[87])}function Ce(){return l[44](l[79],l[87])}return{c(){e=f("div"),t=f("div"),o=f("label"),n=D("Service Type"),r=v(),u=f("div"),i=f("div"),d=f("select"),p=f("option"),p.textContent="Ripgrep (File Search)",m=f("option"),m.textContent="Atomic Server",C=v(),g=f("div"),y=f("label"),ge.c(),w=v(),b=f("div"),h=f("input"),I=v(),fe&&fe.c(),E=v(),se&&se.c(),V=v(),ue&&ue.c(),J=v(),K=f("div"),T=f("label"),L=f("input"),S=D(`
                ¬†Read-only`),B=v(),F=f("div"),Y=f("button"),P=D("Remove Haystack"),a(o,"class","label"),a(o,"for",c=`haystack-service-${l[79]}-${l[87]}`),p.__value="Ripgrep",p.value=p.__value,m.__value="Atomic",m.value=m.__value,a(d,"id",_=`haystack-service-${l[79]}-${l[87]}`),l[3].roles[l[79]].haystacks[l[87]].service===void 0&&at(X),a(i,"class","select"),a(u,"class","control"),a(t,"class","field"),a(y,"class","label"),a(y,"for",k=`haystack-path-${l[79]}-${l[87]}`),a(h,"class","input"),a(h,"id",$=`haystack-path-${l[79]}-${l[87]}`),a(h,"type","text"),a(h,"placeholder",z=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?"https://localhost:9883":"/path/to/documents"),h.readOnly=O=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic",a(b,"class","control"),a(g,"class","field"),a(L,"id",G=`haystack-readonly-${l[79]}-${l[87]}`),a(L,"type","checkbox"),a(T,"class","checkbox"),a(T,"for",j=`haystack-readonly-${l[79]}-${l[87]}`),a(K,"class","field"),a(Y,"class","button is-small is-danger"),a(Y,"data-testid",N="remove-haystack-"+l[79]+"-"+l[87]),a(F,"class","field"),a(e,"class","box is-light")},m(te,ie){A(te,e,ie),s(e,t),s(t,o),s(o,n),s(t,r),s(t,u),s(u,i),s(i,d),s(d,p),s(d,m),He(d,l[3].roles[l[79]].haystacks[l[87]].service,!0),s(e,C),s(e,g),s(g,y),ge.m(y,null),s(g,w),s(g,b),s(b,h),Ne(h,l[3].roles[l[79]].haystacks[l[87]].path),s(b,I),fe&&fe.m(b,null),s(e,E),se&&se.m(e,null),s(e,V),ue&&ue.m(e,null),s(e,J),s(e,K),s(K,T),s(T,L),L.checked=l[3].roles[l[79]].haystacks[l[87]].read_only,s(T,S),s(e,B),s(e,F),s(F,Y),s(Y,P),q||(W=[ee(d,"change",X),ee(h,"input",we),ee(h,"click",function(){Hl(l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?he:void 0)&&(l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?he:void 0).apply(this,arguments)}),ee(L,"change",ke),ee(Y,"click",Ce)],q=!0)},p(te,ie){l=te,ie[0]&264&&c!==(c=`haystack-service-${l[79]}-${l[87]}`)&&a(o,"for",c),ie[0]&264&&_!==(_=`haystack-service-${l[79]}-${l[87]}`)&&a(d,"id",_),ie[0]&264&&He(d,l[3].roles[l[79]].haystacks[l[87]].service),oe!==(oe=U(l))&&(ge.d(1),ge=oe(l),ge&&(ge.c(),ge.m(y,null))),ie[0]&264&&k!==(k=`haystack-path-${l[79]}-${l[87]}`)&&a(y,"for",k),ie[0]&264&&$!==($=`haystack-path-${l[79]}-${l[87]}`)&&a(h,"id",$),ie[0]&264&&z!==(z=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?"https://localhost:9883":"/path/to/documents")&&a(h,"placeholder",z),ie[0]&280&&O!==(O=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic")&&(h.readOnly=O),ie[0]&264&&h.value!==l[3].roles[l[79]].haystacks[l[87]].path&&Ne(h,l[3].roles[l[79]].haystacks[l[87]].path),l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?fe||(fe=bn(),fe.c(),fe.m(b,null)):fe&&(fe.d(1),fe=null),l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?se?se.p(l,ie):(se=kn(l),se.c(),se.m(e,V)):se&&(se.d(1),se=null),l[3].roles[l[79]].haystacks[l[87]].service==="Ripgrep"?ue?ue.p(l,ie):(ue=wn(l),ue.c(),ue.m(e,J)):ue&&(ue.d(1),ue=null),ie[0]&264&&G!==(G=`haystack-readonly-${l[79]}-${l[87]}`)&&a(L,"id",G),ie[0]&264&&(L.checked=l[3].roles[l[79]].haystacks[l[87]].read_only),ie[0]&264&&j!==(j=`haystack-readonly-${l[79]}-${l[87]}`)&&a(T,"for",j),ie[0]&264&&N!==(N="remove-haystack-"+l[79]+"-"+l[87])&&a(Y,"data-testid",N)},d(te){te&&R(e),ge.d(),fe&&fe.d(),se&&se.d(),ue&&ue.d(),q=!1,Qe(W)}}}function Cn(l){var Y;let e,t,o,n,c,r,u,i,d,p,m,_,C,g,y,k,w,b,h,$,z,O,I,E,V,J,K,T,L;function G(){l[47].call(u,l[79])}function S(){return l[48](l[79])}let j=((Y=l[0][l[79]])==null?void 0:Y.length)&&Sn(l);function B(){l[50].call(h,l[79])}function F(){l[51].call(E,l[79])}return{c(){e=f("div"),t=f("label"),o=D("Model"),c=v(),r=f("div"),u=f("input"),d=v(),p=f("button"),p.textContent="Fetch models",m=v(),j&&j.c(),_=v(),C=f("div"),g=f("label"),y=D("Base URL"),w=v(),b=f("div"),h=f("input"),z=v(),O=f("div"),I=f("label"),E=f("input"),J=D(`
              ¬†Automatically summarize search results`),a(t,"class","label"),a(t,"for",n=`llm-model-${l[79]}`),a(u,"class","input"),a(u,"id",i=`llm-model-${l[79]}`),a(u,"type","text"),a(u,"placeholder","llama3.1"),a(r,"class","control"),a(p,"class","button is-small"),a(e,"class","field"),a(g,"class","label"),a(g,"for",k=`llm-base-url-${l[79]}`),a(h,"class","input"),a(h,"id",$=`llm-base-url-${l[79]}`),a(h,"type","text"),a(h,"placeholder","http://127.0.0.1:11434"),a(b,"class","control"),a(C,"class","field"),a(E,"id",V=`llm-auto-summarize-${l[79]}`),a(E,"type","checkbox"),a(I,"class","checkbox"),a(I,"for",K=`llm-auto-summarize-${l[79]}`),a(O,"class","field")},m(P,N){A(P,e,N),s(e,t),s(t,o),s(e,c),s(e,r),s(r,u),Ne(u,l[3].roles[l[79]].llm_model),s(e,d),s(e,p),s(e,m),j&&j.m(e,null),A(P,_,N),A(P,C,N),s(C,g),s(g,y),s(C,w),s(C,b),s(b,h),Ne(h,l[3].roles[l[79]].llm_base_url),A(P,z,N),A(P,O,N),s(O,I),s(I,E),E.checked=l[3].roles[l[79]].llm_auto_summarize,s(I,J),T||(L=[ee(u,"input",G),ee(p,"click",S),ee(h,"input",B),ee(E,"change",F)],T=!0)},p(P,N){var q;l=P,N[0]&264&&n!==(n=`llm-model-${l[79]}`)&&a(t,"for",n),N[0]&264&&i!==(i=`llm-model-${l[79]}`)&&a(u,"id",i),N[0]&264&&u.value!==l[3].roles[l[79]].llm_model&&Ne(u,l[3].roles[l[79]].llm_model),(q=l[0][l[79]])!=null&&q.length?j?j.p(l,N):(j=Sn(l),j.c(),j.m(e,null)):j&&(j.d(1),j=null),N[0]&264&&k!==(k=`llm-base-url-${l[79]}`)&&a(g,"for",k),N[0]&264&&$!==($=`llm-base-url-${l[79]}`)&&a(h,"id",$),N[0]&264&&h.value!==l[3].roles[l[79]].llm_base_url&&Ne(h,l[3].roles[l[79]].llm_base_url),N[0]&264&&V!==(V=`llm-auto-summarize-${l[79]}`)&&a(E,"id",V),N[0]&264&&(E.checked=l[3].roles[l[79]].llm_auto_summarize),N[0]&264&&K!==(K=`llm-auto-summarize-${l[79]}`)&&a(I,"for",K)},d(P){P&&R(e),j&&j.d(),P&&R(_),P&&R(C),P&&R(z),P&&R(O),T=!1,Qe(L)}}}function Sn(l){let e,t,o,n,c=l[0][l[79]],r=[];for(let i=0;i<c.length;i+=1)r[i]=Tn(cn(l,c,i));function u(...i){return l[49](l[79],...i)}return{c(){e=f("div"),t=f("select");for(let i=0;i<r.length;i+=1)r[i].c();a(e,"class","select is-fullwidth"),de(e,"margin-top","0.5rem")},m(i,d){A(i,e,d),s(e,t);for(let p=0;p<r.length;p+=1)r[p]&&r[p].m(t,null);o||(n=ee(t,"change",u),o=!0)},p(i,d){if(l=i,d[0]&9){c=l[0][l[79]];let p;for(p=0;p<c.length;p+=1){const m=cn(l,c,p);r[p]?r[p].p(m,d):(r[p]=Tn(m),r[p].c(),r[p].m(t,null))}for(;p<r.length;p+=1)r[p].d(1);r.length=c.length}},d(i){i&&R(e),Ve(r,i),o=!1,n()}}}function Tn(l){let e,t=l[80]+"",o,n;return{c(){e=f("option"),o=D(t),e.__value=n=l[80],e.value=e.__value},m(c,r){A(c,e,r),s(e,o)},p(c,r){r[0]&9&&t!==(t=c[80]+"")&&ve(o,t),r[0]&265&&n!==(n=c[80])&&(e.__value=n,e.value=e.__value)},d(c){c&&R(e)}}}function Rn(l){var ie;let e,t,o,n,c,r,u,i,d,p,m,_,C,g,y,k,w,b,h,$,z,O,I,E,V,J,K,T,L,G,S,j,B,F,Y,P,N,q,W,X,U,oe,ge,we;function he(){l[53].call(u,l[79])}function fe(){l[54].call(b,l[79])}function se(){return l[55](l[79])}let ue=((ie=l[0][l[79]])==null?void 0:ie.length)&&An(l);function ke(){l[57].call(T,l[79])}function Ce(){l[58].call(N,l[79])}let te=l[3].roles[l[79]].openrouter_chat_enabled&&En(l);return{c(){e=f("div"),t=f("label"),o=D("OpenRouter API Key"),c=v(),r=f("div"),u=f("input"),d=v(),p=f("p"),p.innerHTML='Get your API key from <a href="https://openrouter.ai" target="_blank" rel="noopener">OpenRouter</a>',m=v(),_=f("div"),C=f("label"),g=D("Model"),k=v(),w=f("div"),b=f("input"),$=v(),z=f("button"),z.textContent="Fetch models",O=v(),ue&&ue.c(),I=v(),E=f("p"),E.textContent="Choose the language model for generating summaries. Different models offer different speed/quality tradeoffs.",V=v(),J=f("div"),K=f("label"),T=f("input"),G=D(`
              ¬†Automatically summarize search results`),j=v(),B=f("p"),B.textContent="When enabled, summaries will be generated and shown in search results.",F=v(),Y=f("div"),P=f("label"),N=f("input"),W=D(`
              ¬†Enable Chat interface (OpenRouter)`),U=v(),te&&te.c(),oe=lt(),a(t,"class","label"),a(t,"for",n=`openrouter-api-key-${l[79]}`),a(u,"class","input"),a(u,"id",i=`openrouter-api-key-${l[79]}`),a(u,"type","password"),a(u,"placeholder","sk-or-v1-..."),a(r,"class","control"),a(p,"class","help"),a(e,"class","field"),a(C,"class","label"),a(C,"for",y=`openrouter-model-${l[79]}`),a(b,"class","input"),a(b,"id",h=`openrouter-model-${l[79]}`),a(b,"type","text"),a(b,"placeholder","openai/gpt-4-turbo"),a(w,"class","control"),a(z,"class","button is-small"),a(E,"class","help"),a(_,"class","field"),a(T,"id",L=`openrouter-auto-summarize-${l[79]}`),a(T,"type","checkbox"),a(K,"class","checkbox"),a(K,"for",S=`openrouter-auto-summarize-${l[79]}`),a(B,"class","help"),a(J,"class","field"),a(N,"id",q=`openrouter-chat-enabled-${l[79]}`),a(N,"type","checkbox"),a(P,"class","checkbox"),a(P,"for",X=`openrouter-chat-enabled-${l[79]}`),a(Y,"class","field")},m(ae,ce){A(ae,e,ce),s(e,t),s(t,o),s(e,c),s(e,r),s(r,u),Ne(u,l[3].roles[l[79]].openrouter_api_key),s(e,d),s(e,p),A(ae,m,ce),A(ae,_,ce),s(_,C),s(C,g),s(_,k),s(_,w),s(w,b),Ne(b,l[3].roles[l[79]].openrouter_model),s(_,$),s(_,z),s(_,O),ue&&ue.m(_,null),s(_,I),s(_,E),A(ae,V,ce),A(ae,J,ce),s(J,K),s(K,T),T.checked=l[3].roles[l[79]].openrouter_auto_summarize,s(K,G),s(J,j),s(J,B),A(ae,F,ce),A(ae,Y,ce),s(Y,P),s(P,N),N.checked=l[3].roles[l[79]].openrouter_chat_enabled,s(P,W),A(ae,U,ce),te&&te.m(ae,ce),A(ae,oe,ce),ge||(we=[ee(u,"input",he),ee(b,"input",fe),ee(z,"click",se),ee(T,"change",ke),ee(N,"change",Ce)],ge=!0)},p(ae,ce){var Ee;l=ae,ce[0]&264&&n!==(n=`openrouter-api-key-${l[79]}`)&&a(t,"for",n),ce[0]&264&&i!==(i=`openrouter-api-key-${l[79]}`)&&a(u,"id",i),ce[0]&264&&u.value!==l[3].roles[l[79]].openrouter_api_key&&Ne(u,l[3].roles[l[79]].openrouter_api_key),ce[0]&264&&y!==(y=`openrouter-model-${l[79]}`)&&a(C,"for",y),ce[0]&264&&h!==(h=`openrouter-model-${l[79]}`)&&a(b,"id",h),ce[0]&264&&b.value!==l[3].roles[l[79]].openrouter_model&&Ne(b,l[3].roles[l[79]].openrouter_model),(Ee=l[0][l[79]])!=null&&Ee.length?ue?ue.p(l,ce):(ue=An(l),ue.c(),ue.m(_,I)):ue&&(ue.d(1),ue=null),ce[0]&264&&L!==(L=`openrouter-auto-summarize-${l[79]}`)&&a(T,"id",L),ce[0]&264&&(T.checked=l[3].roles[l[79]].openrouter_auto_summarize),ce[0]&264&&S!==(S=`openrouter-auto-summarize-${l[79]}`)&&a(K,"for",S),ce[0]&264&&q!==(q=`openrouter-chat-enabled-${l[79]}`)&&a(N,"id",q),ce[0]&264&&(N.checked=l[3].roles[l[79]].openrouter_chat_enabled),ce[0]&264&&X!==(X=`openrouter-chat-enabled-${l[79]}`)&&a(P,"for",X),l[3].roles[l[79]].openrouter_chat_enabled?te?te.p(l,ce):(te=En(l),te.c(),te.m(oe.parentNode,oe)):te&&(te.d(1),te=null)},d(ae){ae&&R(e),ae&&R(m),ae&&R(_),ue&&ue.d(),ae&&R(V),ae&&R(J),ae&&R(F),ae&&R(Y),ae&&R(U),te&&te.d(ae),ae&&R(oe),ge=!1,Qe(we)}}}function An(l){let e,t,o,n,c=l[0][l[79]],r=[];for(let i=0;i<c.length;i+=1)r[i]=Ln(an(l,c,i));function u(...i){return l[56](l[79],...i)}return{c(){e=f("div"),t=f("select");for(let i=0;i<r.length;i+=1)r[i].c();a(e,"class","select is-fullwidth"),de(e,"margin-top","0.5rem")},m(i,d){A(i,e,d),s(e,t);for(let p=0;p<r.length;p+=1)r[p]&&r[p].m(t,null);o||(n=ee(t,"change",u),o=!0)},p(i,d){if(l=i,d[0]&9){c=l[0][l[79]];let p;for(p=0;p<c.length;p+=1){const m=an(l,c,p);r[p]?r[p].p(m,d):(r[p]=Ln(m),r[p].c(),r[p].m(t,null))}for(;p<r.length;p+=1)r[p].d(1);r.length=c.length}},d(i){i&&R(e),Ve(r,i),o=!1,n()}}}function Ln(l){let e,t=l[80]+"",o,n;return{c(){e=f("option"),o=D(t),e.__value=n=l[80],e.value=e.__value},m(c,r){A(c,e,r),s(e,o)},p(c,r){r[0]&9&&t!==(t=c[80]+"")&&ve(o,t),r[0]&265&&n!==(n=c[80])&&(e.__value=n,e.value=e.__value)},d(c){c&&R(e)}}}function En(l){let e,t,o,n,c,r,u,i,d,p,m,_,C,g,y,k,w,b,h,$,z,O,I,E,V;function J(){l[59].call(i,l[79])}function K(){l[60].call(O,l[79])}return{c(){e=f("div"),t=f("label"),o=D("Chat Model"),c=v(),r=f("div"),u=f("div"),i=f("select"),d=f("option"),d.textContent="GPT-3.5 Turbo",p=f("option"),p.textContent="GPT-4",m=f("option"),m.textContent="Claude 3 Sonnet",_=f("option"),_.textContent="Claude 3 Haiku",C=f("option"),C.textContent="Mixtral 8x7B",y=v(),k=f("div"),w=f("label"),b=D("System Prompt (optional)"),$=v(),z=f("div"),O=f("textarea"),a(t,"class","label"),a(t,"for",n=`openrouter-chat-model-${l[79]}`),d.__value="openai/gpt-3.5-turbo",d.value=d.__value,p.__value="openai/gpt-4",p.value=p.__value,m.__value="anthropic/claude-3-sonnet",m.value=m.__value,_.__value="anthropic/claude-3-haiku",_.value=_.__value,C.__value="mistralai/mixtral-8x7b-instruct",C.value=C.__value,a(i,"id",g=`openrouter-chat-model-${l[79]}`),l[3].roles[l[79]].openrouter_chat_model===void 0&&at(J),a(u,"class","select is-fullwidth"),a(r,"class","control"),a(e,"class","field"),a(w,"class","label"),a(w,"for",h=`openrouter-chat-system-${l[79]}`),a(O,"class","textarea"),a(O,"id",I=`openrouter-chat-system-${l[79]}`),a(O,"rows","3"),a(O,"placeholder","You are a helpful Rust engineer assistant..."),a(z,"class","control"),a(k,"class","field")},m(T,L){A(T,e,L),s(e,t),s(t,o),s(e,c),s(e,r),s(r,u),s(u,i),s(i,d),s(i,p),s(i,m),s(i,_),s(i,C),He(i,l[3].roles[l[79]].openrouter_chat_model,!0),A(T,y,L),A(T,k,L),s(k,w),s(w,b),s(k,$),s(k,z),s(z,O),Ne(O,l[3].roles[l[79]].openrouter_chat_system_prompt),E||(V=[ee(i,"change",J),ee(O,"input",K)],E=!0)},p(T,L){l=T,L[0]&264&&n!==(n=`openrouter-chat-model-${l[79]}`)&&a(t,"for",n),L[0]&264&&g!==(g=`openrouter-chat-model-${l[79]}`)&&a(i,"id",g),L[0]&264&&He(i,l[3].roles[l[79]].openrouter_chat_model),L[0]&264&&h!==(h=`openrouter-chat-system-${l[79]}`)&&a(w,"for",h),L[0]&264&&I!==(I=`openrouter-chat-system-${l[79]}`)&&a(O,"id",I),L[0]&264&&Ne(O,l[3].roles[l[79]].openrouter_chat_system_prompt)},d(T){T&&R(e),T&&R(y),T&&R(k),E=!1,Qe(V)}}}function Pn(l){let e;return{c(){e=f("p"),e.textContent="Click to select directory",a(e,"class","help")},m(t,o){A(t,e,o)},d(t){t&&R(e)}}}function On(l,e){let t,o,n,c,r,u,i,d,p,m,_,C,g,y,k,w,b,h,$,z,O,I,E,V,J,K,T,L,G,S,j,B,F,Y,P,N,q,W,X,U,oe,ge,we,he,fe,se,ue,ke,Ce,te,ie,ae,ce,Ee,Fe,Ke,Pe,Re,x,ne,Se,Ae,xe,Ie,ut,ot,gt,Ye,nt,ft,Ue,Rt,M,le,H,re,ye,be,ze,Be,De,We,vt,dt,al,zt,cl,Qt,Ft,ul,Ut,bt,Kl,_l,Wl,hl,$t,gl,ql,Yt,Zt,Gl,vl,Bl,Kt,st,bl,Jl,Vl,kl,Xt,xt,Ql,wl,Yl,yl,Et,el,tl,$l,Zl,ll,jt,Dt,Cl,Xl,Sl,xl,Wt,Mt,Tl,eo,Rl,to,lo,oo,qt,no,Al,Nl,so;function is(){e[26].call(d,e[79])}function as(){e[27].call(b,e[79])}let ol=e[8],rt=[];for(let Me=0;Me<ol.length;Me+=1)rt[Me]=vn(dn(e,ol,Me));function ro(){e[28].call(T,e[79])}function io(){e[29].call(q,e[79])}function cs(){e[30].call(ue,e[79])}let nl=e[77].haystacks,it=[];for(let Me=0;Me<nl.length;Me+=1)it[Me]=$n(un(e,nl,Me));function us(){return e[45](e[79])}function ao(){e[46].call(Ye,e[79])}let pt=e[3].roles[e[79]].llm_provider==="ollama"&&Cn(e);function fs(){e[52].call(De,e[79])}let mt=e[3].roles[e[79]].openrouter_enabled&&Rn(e);function ds(){e[61].call($t,e[79])}function ps(){e[62].call(st,e[79])}function co(){return e[63](e[79])}let kt=e[4]&&Pn();function uo(){e[64].call(Et,e[79])}function ms(){e[65].call(Dt,e[79])}function _s(){e[66].call(Mt,e[79])}function hs(){return e[67](e[79])}return{key:l,first:null,c(){t=f("div"),o=f("div"),n=f("label"),c=D("Role name"),u=v(),i=f("div"),d=f("input"),m=v(),_=f("div"),C=f("label"),g=D("Short name"),k=v(),w=f("div"),b=f("input"),$=v(),z=f("div"),O=f("label"),I=D("Theme"),V=v(),J=f("div"),K=f("div"),T=f("select");for(let Me=0;Me<rt.length;Me+=1)rt[Me].c();G=v(),S=f("div"),j=f("label"),B=D("Relevance function"),Y=v(),P=f("div"),N=f("div"),q=f("select"),W=f("option"),W.textContent="title-scorer",X=f("option"),X.textContent="terraphim-graph",U=f("option"),U.textContent="bm25",oe=f("option"),oe.textContent="bm25f",ge=f("option"),ge.textContent="bm25plus",he=v(),fe=f("div"),se=f("label"),ue=f("input"),Ce=D(`
            Enable Terraphim IT features (KG preprocessing, auto-linking)`),ie=v(),ae=f("h5"),ae.textContent="Haystacks",ce=v();for(let Me=0;Me<it.length;Me+=1)it[Me].c();Ee=v(),Fe=f("button"),Ke=D("Add Haystack"),Re=v(),x=f("h5"),x.textContent="AI-Enhanced Summaries (LLM Provider)",ne=v(),Se=f("div"),Ae=f("label"),xe=D("Provider"),ut=v(),ot=f("div"),gt=f("div"),Ye=f("select"),nt=f("option"),nt.textContent="(none)",ft=f("option"),ft.textContent="OpenRouter",Ue=f("option"),Ue.textContent="Ollama (local)",M=v(),le=f("p"),le.textContent="Choose a provider. OpenRouter uses API key; Ollama runs locally.",H=v(),pt&&pt.c(),re=v(),ye=f("h5"),ye.textContent="AI-Enhanced Summaries (OpenRouter)",be=v(),ze=f("div"),Be=f("label"),De=f("input"),vt=D(`
            ¬†Enable AI-generated article summaries`),al=v(),zt=f("p"),zt.textContent="Generate intelligent summaries using OpenRouter's language models",cl=v(),mt&&mt.c(),Qt=v(),Ft=f("h5"),Ft.textContent="Knowledge Graph",ul=v(),Ut=f("div"),bt=f("label"),Kl=D("Remote automata URL"),Wl=v(),hl=f("div"),$t=f("input"),ql=v(),Yt=f("div"),Zt=f("label"),Gl=D("Local KG path"),Bl=v(),Kt=f("div"),st=f("input"),Jl=v(),kt&&kt.c(),Vl=v(),kl=f("div"),Xt=f("div"),xt=f("label"),Ql=D("Local KG type"),Yl=v(),yl=f("div"),Et=f("select"),el=f("option"),el.textContent="markdown",tl=f("option"),tl.textContent="json",Zl=v(),ll=f("div"),jt=f("label"),Dt=f("input"),Xl=D(`
            ¬†Public`),xl=v(),Wt=f("label"),Mt=f("input"),eo=D(`
            ¬†Publish`),to=v(),lo=f("hr"),oo=v(),qt=f("button"),no=D("Remove Role"),a(n,"class","label"),a(n,"for",r=`role-name-${e[79]}`),a(d,"class","input"),a(d,"id",p=`role-name-${e[79]}`),a(d,"type","text"),a(i,"class","control"),a(o,"class","field"),a(C,"class","label"),a(C,"for",y=`role-shortname-${e[79]}`),a(b,"class","input"),a(b,"id",h=`role-shortname-${e[79]}`),a(b,"type","text"),a(w,"class","control"),a(_,"class","field"),a(O,"class","label"),a(O,"for",E=`role-theme-${e[79]}`),a(T,"id",L=`role-theme-${e[79]}`),e[3].roles[e[79]].theme===void 0&&at(ro),a(K,"class","select is-fullwidth"),a(J,"class","control"),a(z,"class","field"),a(j,"class","label"),a(j,"for",F=`role-relevance-${e[79]}`),W.__value="title-scorer",W.value=W.__value,X.__value="terraphim-graph",X.value=X.__value,U.__value="bm25",U.value=U.__value,oe.__value="bm25f",oe.value=oe.__value,ge.__value="bm25plus",ge.value=ge.__value,a(q,"id",we=`role-relevance-${e[79]}`),e[3].roles[e[79]].relevance_function===void 0&&at(io),a(N,"class","select is-fullwidth"),a(P,"class","control"),a(S,"class","field"),a(ue,"class","checkbox"),a(ue,"id",ke=`role-terraphim-it-${e[79]}`),a(ue,"type","checkbox"),a(se,"class","label"),a(se,"for",te=`role-terraphim-it-${e[79]}`),a(fe,"class","field"),a(ae,"class","title is-6"),a(Fe,"class","button is-small"),a(Fe,"data-testid",Pe="add-haystack-"+e[79]),a(x,"class","title is-6"),a(Ae,"class","label"),a(Ae,"for",Ie=`llm-provider-${e[79]}`),nt.__value="",nt.value=nt.__value,ft.__value="openrouter",ft.value=ft.__value,Ue.__value="ollama",Ue.value=Ue.__value,a(Ye,"id",Rt=`llm-provider-${e[79]}`),e[3].roles[e[79]].llm_provider===void 0&&at(ao),a(gt,"class","select"),a(ot,"class","control"),a(le,"class","help"),a(Se,"class","field"),a(ye,"class","title is-6"),a(De,"id",We=`openrouter-enabled-${e[79]}`),a(De,"type","checkbox"),a(Be,"class","checkbox"),a(Be,"for",dt=`openrouter-enabled-${e[79]}`),a(zt,"class","help"),a(ze,"class","field"),a(Ft,"class","title is-6"),a(bt,"class","label"),a(bt,"for",_l=`kg-url-${e[79]}`),a($t,"class","input"),a($t,"id",gl=`kg-url-${e[79]}`),a($t,"type","text"),a($t,"placeholder","https://example.com/thesaurus.json"),a(hl,"class","control"),a(Ut,"class","field"),a(Zt,"class","label"),a(Zt,"for",vl=`kg-local-path-${e[79]}`),a(st,"class","input"),a(st,"id",bl=`kg-local-path-${e[79]}`),a(st,"type","text"),a(st,"placeholder","/path/to/markdown"),st.readOnly=e[4],a(Kt,"class","control"),a(Yt,"class","field"),a(xt,"class","label"),a(xt,"for",wl=`kg-local-type-${e[79]}`),el.__value="markdown",el.value=el.__value,tl.__value="json",tl.value=tl.__value,a(Et,"id",$l=`kg-local-type-${e[79]}`),e[3].roles[e[79]].kg.local_type===void 0&&at(uo),a(yl,"class","select"),a(Xt,"class","control"),a(kl,"class","field is-grouped"),a(Dt,"id",Cl=`kg-public-${e[79]}`),a(Dt,"type","checkbox"),a(jt,"class","checkbox"),a(jt,"for",Sl=`kg-public-${e[79]}`),de(jt,"margin-right","1rem"),a(Mt,"id",Tl=`kg-publish-${e[79]}`),a(Mt,"type","checkbox"),a(Wt,"class","checkbox"),a(Wt,"for",Rl=`kg-publish-${e[79]}`),a(ll,"class","field is-grouped"),a(qt,"class","button is-small is-danger"),a(qt,"data-testid",Al="remove-role-"+e[79]),a(t,"class","box"),this.first=t},m(Me,$e){A(Me,t,$e),s(t,o),s(o,n),s(n,c),s(o,u),s(o,i),s(i,d),Ne(d,e[3].roles[e[79]].name),s(t,m),s(t,_),s(_,C),s(C,g),s(_,k),s(_,w),s(w,b),Ne(b,e[3].roles[e[79]].shortname),s(t,$),s(t,z),s(z,O),s(O,I),s(z,V),s(z,J),s(J,K),s(K,T);for(let Le=0;Le<rt.length;Le+=1)rt[Le]&&rt[Le].m(T,null);He(T,e[3].roles[e[79]].theme,!0),s(t,G),s(t,S),s(S,j),s(j,B),s(S,Y),s(S,P),s(P,N),s(N,q),s(q,W),s(q,X),s(q,U),s(q,oe),s(q,ge),He(q,e[3].roles[e[79]].relevance_function,!0),s(t,he),s(t,fe),s(fe,se),s(se,ue),ue.checked=e[3].roles[e[79]].terraphim_it,s(se,Ce),s(t,ie),s(t,ae),s(t,ce);for(let Le=0;Le<it.length;Le+=1)it[Le]&&it[Le].m(t,null);s(t,Ee),s(t,Fe),s(Fe,Ke),s(t,Re),s(t,x),s(t,ne),s(t,Se),s(Se,Ae),s(Ae,xe),s(Se,ut),s(Se,ot),s(ot,gt),s(gt,Ye),s(Ye,nt),s(Ye,ft),s(Ye,Ue),He(Ye,e[3].roles[e[79]].llm_provider,!0),s(Se,M),s(Se,le),s(t,H),pt&&pt.m(t,null),s(t,re),s(t,ye),s(t,be),s(t,ze),s(ze,Be),s(Be,De),De.checked=e[3].roles[e[79]].openrouter_enabled,s(Be,vt),s(ze,al),s(ze,zt),s(t,cl),mt&&mt.m(t,null),s(t,Qt),s(t,Ft),s(t,ul),s(t,Ut),s(Ut,bt),s(bt,Kl),s(Ut,Wl),s(Ut,hl),s(hl,$t),Ne($t,e[3].roles[e[79]].kg.url),s(t,ql),s(t,Yt),s(Yt,Zt),s(Zt,Gl),s(Yt,Bl),s(Yt,Kt),s(Kt,st),Ne(st,e[3].roles[e[79]].kg.local_path),s(Kt,Jl),kt&&kt.m(Kt,null),s(t,Vl),s(t,kl),s(kl,Xt),s(Xt,xt),s(xt,Ql),s(Xt,Yl),s(Xt,yl),s(yl,Et),s(Et,el),s(Et,tl),He(Et,e[3].roles[e[79]].kg.local_type,!0),s(t,Zl),s(t,ll),s(ll,jt),s(jt,Dt),Dt.checked=e[3].roles[e[79]].kg.public,s(jt,Xl),s(ll,xl),s(ll,Wt),s(Wt,Mt),Mt.checked=e[3].roles[e[79]].kg.publish,s(Wt,eo),s(t,to),s(t,lo),s(t,oo),s(t,qt),s(qt,no),Nl||(so=[ee(d,"input",is),ee(b,"input",as),ee(T,"change",ro),ee(q,"change",io),ee(ue,"change",cs),ee(Fe,"click",us),ee(Ye,"change",ao),ee(De,"change",fs),ee($t,"input",ds),ee(st,"input",ps),ee(st,"click",function(){Hl(e[4]?co:void 0)&&(e[4]?co:void 0).apply(this,arguments)}),ee(Et,"change",uo),ee(Dt,"change",ms),ee(Mt,"change",_s),ee(qt,"click",hs)],Nl=!0)},p(Me,$e){if(e=Me,$e[0]&264&&r!==(r=`role-name-${e[79]}`)&&a(n,"for",r),$e[0]&264&&p!==(p=`role-name-${e[79]}`)&&a(d,"id",p),$e[0]&264&&d.value!==e[3].roles[e[79]].name&&Ne(d,e[3].roles[e[79]].name),$e[0]&264&&y!==(y=`role-shortname-${e[79]}`)&&a(C,"for",y),$e[0]&264&&h!==(h=`role-shortname-${e[79]}`)&&a(b,"id",h),$e[0]&264&&b.value!==e[3].roles[e[79]].shortname&&Ne(b,e[3].roles[e[79]].shortname),$e[0]&264&&E!==(E=`role-theme-${e[79]}`)&&a(O,"for",E),$e[0]&256){ol=e[8];let Le;for(Le=0;Le<ol.length;Le+=1){const fl=dn(e,ol,Le);rt[Le]?rt[Le].p(fl,$e):(rt[Le]=vn(fl),rt[Le].c(),rt[Le].m(T,null))}for(;Le<rt.length;Le+=1)rt[Le].d(1);rt.length=ol.length}if($e[0]&264&&L!==(L=`role-theme-${e[79]}`)&&a(T,"id",L),$e[0]&264&&He(T,e[3].roles[e[79]].theme),$e[0]&264&&F!==(F=`role-relevance-${e[79]}`)&&a(j,"for",F),$e[0]&264&&we!==(we=`role-relevance-${e[79]}`)&&a(q,"id",we),$e[0]&264&&He(q,e[3].roles[e[79]].relevance_function),$e[0]&264&&ke!==(ke=`role-terraphim-it-${e[79]}`)&&a(ue,"id",ke),$e[0]&264&&(ue.checked=e[3].roles[e[79]].terraphim_it),$e[0]&264&&te!==(te=`role-terraphim-it-${e[79]}`)&&a(se,"for",te),$e[0]&491576){nl=e[77].haystacks;let Le;for(Le=0;Le<nl.length;Le+=1){const fl=un(e,nl,Le);it[Le]?it[Le].p(fl,$e):(it[Le]=$n(fl),it[Le].c(),it[Le].m(t,Ee))}for(;Le<it.length;Le+=1)it[Le].d(1);it.length=nl.length}$e[0]&264&&Pe!==(Pe="add-haystack-"+e[79])&&a(Fe,"data-testid",Pe),$e[0]&264&&Ie!==(Ie=`llm-provider-${e[79]}`)&&a(Ae,"for",Ie),$e[0]&264&&Rt!==(Rt=`llm-provider-${e[79]}`)&&a(Ye,"id",Rt),$e[0]&264&&He(Ye,e[3].roles[e[79]].llm_provider),e[3].roles[e[79]].llm_provider==="ollama"?pt?pt.p(e,$e):(pt=Cn(e),pt.c(),pt.m(t,re)):pt&&(pt.d(1),pt=null),$e[0]&264&&We!==(We=`openrouter-enabled-${e[79]}`)&&a(De,"id",We),$e[0]&264&&(De.checked=e[3].roles[e[79]].openrouter_enabled),$e[0]&264&&dt!==(dt=`openrouter-enabled-${e[79]}`)&&a(Be,"for",dt),e[3].roles[e[79]].openrouter_enabled?mt?mt.p(e,$e):(mt=Rn(e),mt.c(),mt.m(t,Qt)):mt&&(mt.d(1),mt=null),$e[0]&264&&_l!==(_l=`kg-url-${e[79]}`)&&a(bt,"for",_l),$e[0]&264&&gl!==(gl=`kg-url-${e[79]}`)&&a($t,"id",gl),$e[0]&264&&$t.value!==e[3].roles[e[79]].kg.url&&Ne($t,e[3].roles[e[79]].kg.url),$e[0]&264&&vl!==(vl=`kg-local-path-${e[79]}`)&&a(Zt,"for",vl),$e[0]&264&&bl!==(bl=`kg-local-path-${e[79]}`)&&a(st,"id",bl),$e[0]&16&&(st.readOnly=e[4]),$e[0]&264&&st.value!==e[3].roles[e[79]].kg.local_path&&Ne(st,e[3].roles[e[79]].kg.local_path),e[4]?kt||(kt=Pn(),kt.c(),kt.m(Kt,null)):kt&&(kt.d(1),kt=null),$e[0]&264&&wl!==(wl=`kg-local-type-${e[79]}`)&&a(xt,"for",wl),$e[0]&264&&$l!==($l=`kg-local-type-${e[79]}`)&&a(Et,"id",$l),$e[0]&264&&He(Et,e[3].roles[e[79]].kg.local_type),$e[0]&264&&Cl!==(Cl=`kg-public-${e[79]}`)&&a(Dt,"id",Cl),$e[0]&264&&(Dt.checked=e[3].roles[e[79]].kg.public),$e[0]&264&&Sl!==(Sl=`kg-public-${e[79]}`)&&a(jt,"for",Sl),$e[0]&264&&Tl!==(Tl=`kg-publish-${e[79]}`)&&a(Mt,"id",Tl),$e[0]&264&&(Mt.checked=e[3].roles[e[79]].kg.publish),$e[0]&264&&Rl!==(Rl=`kg-publish-${e[79]}`)&&a(Wt,"for",Rl),$e[0]&264&&Al!==(Al="remove-role-"+e[79])&&a(qt,"data-testid",Al)},d(Me){Me&&R(t),Ve(rt,Me),Ve(it,Me),pt&&pt.d(),mt&&mt.d(),kt&&kt.d(),Nl=!1,Qe(so)}}}function In(l){let e,t=l[74]+"",o;return{c(){e=f("option"),o=D(t),e.__value=l[74],e.value=e.__value},m(n,c){A(n,e,c),s(e,o)},p:Te,d(n){n&&R(e)}}}function Nn(l){let e,t=l[71].name+"",o,n;return{c(){e=f("option"),o=D(t),e.__value=n=l[71].name,e.value=e.__value},m(c,r){A(c,e,r),s(e,o)},p(c,r){r[0]&8&&t!==(t=c[71].name+"")&&ve(o,t),r[0]&264&&n!==(n=c[71].name)&&(e.__value=n,e.value=e.__value)},d(c){c&&R(e)}}}function Un(l){let e,t,o;return{c(){e=f("button"),e.textContent="Back",a(e,"class","button"),a(e,"data-testid","wizard-back")},m(n,c){A(n,e,c),t||(o=ee(e,"click",l[11]),t=!0)},p:Te,d(n){n&&R(e),t=!1,o()}}}function Ui(l){let e,t,o;return{c(){e=f("button"),e.textContent="Save",a(e,"class","button is-success"),a(e,"data-testid","wizard-save")},m(n,c){A(n,e,c),t||(o=ee(e,"click",l[19]),t=!0)},p:Te,d(n){n&&R(e),t=!1,o()}}}function Di(l){let e,t,o;return{c(){e=f("button"),e.textContent="Next",a(e,"class","button is-primary"),a(e,"data-testid","wizard-next")},m(n,c){A(n,e,c),t||(o=ee(e,"click",l[10]),t=!0)},p:Te,d(n){n&&R(e),t=!1,o()}}}function Mi(l){let e,t,o,n,c,r,u,i,d,p,m,_,C,g,y,k,w,b;e=new il({props:{fallbackPath:"/"}});let h=l[2]==="success"&&_n(l),$=l[2]==="error"&&hn(l);function z(T,L){return T[1]===1?Oi:T[1]===2?Pi:Ei}let O=z(l),I=O(l),E=l[1]>1&&Un(l);function V(T,L){return T[1]<rs?Di:Ui}let J=V(l),K=J(l);return{c(){pe(e.$$.fragment),t=v(),o=f("div"),n=f("div"),c=f("h3"),c.textContent="Configuration Wizard",r=v(),u=f("button"),u.textContent="Close",i=v(),h&&h.c(),d=v(),$&&$.c(),p=v(),I.c(),m=v(),_=f("nav"),C=f("div"),E&&E.c(),g=v(),y=f("div"),K.c(),a(c,"class","title is-4"),de(c,"margin-bottom","0"),a(u,"class","button is-small is-light"),a(u,"aria-label","Close configuration wizard"),a(n,"class","is-flex is-justify-content-space-between is-align-items-center"),de(n,"gap",".5rem"),a(C,"class","level-left"),a(y,"class","level-right"),a(_,"class","level"),a(o,"class","box")},m(T,L){me(e,T,L),A(T,t,L),A(T,o,L),s(o,n),s(n,c),s(n,r),s(n,u),s(o,i),h&&h.m(o,null),s(o,d),$&&$.m(o,null),s(o,p),I.m(o,null),s(o,m),s(o,_),s(_,C),E&&E.m(C,null),s(_,g),s(_,y),K.m(y,null),k=!0,w||(b=ee(u,"click",ji),w=!0)},p(T,L){T[2]==="success"?h?h.p(T,L):(h=_n(T),h.c(),h.m(o,d)):h&&(h.d(1),h=null),T[2]==="error"?$?$.p(T,L):($=hn(T),$.c(),$.m(o,p)):$&&($.d(1),$=null),O===(O=z(T))&&I?I.p(T,L):(I.d(1),I=O(T),I&&(I.c(),I.m(o,m))),T[1]>1?E?E.p(T,L):(E=Un(T),E.c(),E.m(C,null)):E&&(E.d(1),E=null),J===(J=V(T))&&K?K.p(T,L):(K.d(1),K=J(T),K&&(K.c(),K.m(y,null)))},i(T){k||(Q(e.$$.fragment,T),k=!0)},o(T){Z(e.$$.fragment,T),k=!1},d(T){_e(e,T),T&&R(t),T&&R(o),h&&h.d(),$&&$.d(),I.d(),E&&E.d(),K.d(),w=!1,b()}}}const rs=3;function ji(){typeof window<"u"&&window.history.back()}function Hi(l,e,t){let o,n;Oe(l,Je,M=>t(4,n=M));const c=Lt(null);async function r(M,le){if(yt(Je))try{const H=await nn({directory:!0,multiple:!1});H&&typeof H=="string"&&i.update(re=>(re.roles[M].haystacks[le].path=H,re))}catch(H){console.error("Failed to open folder selector:",H)}}async function u(M){if(yt(Je))try{const le=await nn({directory:!0,multiple:!1});le&&typeof le=="string"&&i.update(H=>(H.roles[M].kg.local_path=le,H))}catch(le){console.error("Failed to open folder selector:",le)}}const i=Lt({id:"Desktop",global_shortcut:"Ctrl+X",default_theme:"spacelab",default_role:"Default",roles:[]});Oe(l,i,M=>t(3,o=M));const d=["default","darkly","cerulean","cosmo","cyborg","flatly","journal","litera","lumen","lux","materia","minty","nuclear","pulse","sandstone","simplex","slate","solar","spacelab","superhero","united","yeti"];Jt(async()=>{try{let M;yt(Je)?M=await je("get_config_schema"):M=await(await fetch("/config/schema")).json(),c.set(M);const le=yt(Tt);le&&le.id&&i.update(H=>{var re;return{...H,id:le.id,global_shortcut:le.global_shortcut,default_theme:((re=le.roles[le.default_role])==null?void 0:re.theme)??"spacelab",default_role:le.default_role,roles:Object.values(le.roles).map(ye=>{var De,We,vt,dt,al,zt,cl,Qt,Ft,ul,Ut;const be=(De=ye.kg)==null?void 0:De.automata_path,ze=(be==null?void 0:be.Remote)??"",Be=((vt=(We=ye.kg)==null?void 0:We.knowledge_graph_local)==null?void 0:vt.path)??"";return{name:ye.name,shortname:ye.shortname,relevance_function:ye.relevance_function,terraphim_it:ye.terraphim_it??!1,theme:ye.theme,haystacks:(ye.haystacks??[]).map(bt=>({path:bt.location||bt.path||"",read_only:bt.read_only??!1,service:bt.service||"Ripgrep",atomic_server_secret:bt.atomic_server_secret||"",extra_parameters:bt.extra_parameters||{}})),kg:{url:ze,local_path:Be,local_type:((al=(dt=ye.kg)==null?void 0:dt.knowledge_graph_local)==null?void 0:al.input_type)??"markdown",public:((zt=ye.kg)==null?void 0:zt.public)??!1,publish:((cl=ye.kg)==null?void 0:cl.publish)??!1},openrouter_enabled:ye.openrouter_enabled??!1,openrouter_api_key:ye.openrouter_api_key??"",openrouter_model:ye.openrouter_model??"openai/gpt-3.5-turbo",openrouter_auto_summarize:ye.openrouter_auto_summarize??!1,openrouter_chat_enabled:ye.openrouter_chat_enabled??!1,openrouter_chat_model:ye.openrouter_chat_model??ye.openrouter_model??"openai/gpt-3.5-turbo",openrouter_chat_system_prompt:ye.openrouter_chat_system_prompt??"",llm_provider:((Qt=ye.extra)==null?void 0:Qt.llm_provider)??"",llm_model:((Ft=ye.extra)==null?void 0:Ft.llm_model)??"",llm_base_url:((ul=ye.extra)==null?void 0:ul.llm_base_url)??"",llm_auto_summarize:((Ut=ye.extra)==null?void 0:Ut.llm_auto_summarize)??!1}})}})}catch(M){console.error("Failed to load schema",M)}}),Jt(()=>{const M=le=>{le.key==="Escape"&&typeof window<"u"&&window.history.back()};return window.addEventListener("keydown",M),()=>window.removeEventListener("keydown",M)});let p={};async function m(M){var be;const H=yt(i).roles[M],re=H.llm_provider||(H.openrouter_enabled?"openrouter":""),ye=[];try{if(re==="ollama"){const ze=(H.llm_base_url||"http://127.0.0.1:11434").replace(/\/$/,""),De=await(await fetch(`${ze}/api/tags`)).json();if(Array.isArray(De==null?void 0:De.models))for(const We of De.models)We!=null&&We.name&&ye.push(We.name)}else if(re==="openrouter"){const ze=(be=H.openrouter_api_key)==null?void 0:be.trim();if(!ze)throw new Error("OpenRouter API key required");const De=await(await fetch("https://openrouter.ai/api/v1/models",{headers:{Authorization:`Bearer ${ze}`,"HTTP-Referer":"https://terraphim.ai","X-Title":"Terraphim Desktop"}})).json(),We=Array.isArray(De==null?void 0:De.data)?De.data:[];for(const vt of We)vt!=null&&vt.id&&ye.push(vt.id)}}catch(ze){console.error("Failed to fetch models",ze)}t(0,p={...p,[M]:ye})}let _=1,C="";function g(){_<rs&&t(1,_+=1)}function y(){_>1&&t(1,_-=1)}function k(){i.update(M=>({...M,roles:[...M.roles,{name:"New Role",shortname:"new",relevance_function:"title-scorer",terraphim_it:!1,theme:"spacelab",haystacks:[],kg:{url:"",local_path:"",local_type:"markdown",public:!1,publish:!1},openrouter_enabled:!1,openrouter_api_key:"",openrouter_model:"openai/gpt-3.5-turbo",openrouter_auto_summarize:!1,openrouter_chat_enabled:!1,openrouter_chat_model:"openai/gpt-3.5-turbo",openrouter_chat_system_prompt:"",llm_provider:"",llm_model:"",llm_base_url:"",llm_auto_summarize:!1}]}))}function w(M){i.update(le=>({...le,roles:le.roles.filter((H,re)=>re!==M)}))}function b(M){i.update(le=>(le.roles[M].haystacks.push({path:"",read_only:!1,service:"Ripgrep",atomic_server_secret:"",extra_parameters:{}}),le))}function h(M,le){i.update(H=>(H.roles[M].haystacks=H.roles[M].haystacks.filter((re,ye)=>ye!==le),H))}function $(M,le,H="",re=""){i.update(ye=>{ye.roles[M].haystacks[le].extra_parameters||(ye.roles[M].haystacks[le].extra_parameters={});const be=H||`param_${Date.now()}`;return ye.roles[M].haystacks[le].extra_parameters[be]=re,ye})}function z(M,le,H){i.update(re=>(delete re.roles[M].haystacks[le].extra_parameters[H],re))}function O(M,le,H,re){i.update(ye=>{const be=ye.roles[M].haystacks[le].extra_parameters;return be[H]!==void 0&&H!==re&&(be[re]=be[H],delete be[H]),ye})}function I(M,le,H,re){const ye=re.target.value;O(M,le,H,ye)}async function E(){var ye;const M=yt(i),le=yt(Tt);let H={...le};H.id=M.id,H.global_shortcut=M.global_shortcut,H.default_role=M.default_role;const re={};M.roles.forEach(be=>{var We,vt;const ze=be.name,Be=ze.replace(/^"|"$/g,"");re[Be]={extra:((vt=(We=le.roles)==null?void 0:We[ze])==null?void 0:vt.extra)??{},name:be.name,shortname:be.shortname,theme:be.theme,relevance_function:be.relevance_function,terraphim_it:be.terraphim_it??!1,haystacks:be.haystacks.map(dt=>({location:dt.path,service:dt.service,read_only:dt.read_only,atomic_server_secret:dt.service==="Atomic"?dt.atomic_server_secret:void 0,extra_parameters:dt.extra_parameters||{}})),kg:be.kg.url||be.kg.local_path?{automata_path:be.kg.url?{Remote:be.kg.url}:null,knowledge_graph_local:be.kg.local_path?{input_type:be.kg.local_type,path:be.kg.local_path}:null,public:be.kg.public,publish:be.kg.publish}:null,...be.openrouter_enabled&&{openrouter_enabled:be.openrouter_enabled,openrouter_api_key:be.openrouter_api_key,openrouter_model:be.openrouter_model,openrouter_auto_summarize:be.openrouter_auto_summarize??!1,openrouter_chat_enabled:be.openrouter_chat_enabled??!1,openrouter_chat_model:be.openrouter_chat_model??be.openrouter_model,openrouter_chat_system_prompt:be.openrouter_chat_system_prompt??""}};const De={};be.llm_provider&&(De.llm_provider=be.llm_provider),be.llm_model&&(De.llm_model=be.llm_model),be.llm_base_url&&(De.llm_base_url=be.llm_base_url),typeof be.llm_auto_summarize=="boolean"&&(De.llm_auto_summarize=be.llm_auto_summarize),re[Be].extra={...re[Be].extra||{},...De}}),H.roles=re,(!H.default_role||!re[H.default_role])&&(H.default_role=((ye=M.roles[0])==null?void 0:ye.name)??"Default"),H.selected_role=H.default_role;try{if(yt(Je))await je("update_config",{configNew:H});else{const be=await fetch("/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(H)});if(!be.ok)throw new Error(`HTTP ${be.status}: ${be.statusText}`)}Tt.set(H),t(2,C="success"),setTimeout(()=>{t(2,C="")},3e3)}catch(be){console.error(be),t(2,C="error"),setTimeout(()=>{t(2,C="")},3e3)}}const V=()=>t(2,C=""),J=()=>t(2,C="");function K(){o.id=At(this),i.set(o),t(8,d)}function T(){o.global_shortcut=this.value,i.set(o),t(8,d)}function L(){o.default_theme=At(this),i.set(o),t(8,d)}function G(){o.default_role=At(this),i.set(o),t(8,d)}function S(M){o.roles[M].name=this.value,i.set(o),t(8,d)}function j(M){o.roles[M].shortname=this.value,i.set(o),t(8,d)}function B(M){o.roles[M].theme=At(this),i.set(o),t(8,d)}function F(M){o.roles[M].relevance_function=At(this),i.set(o),t(8,d)}function Y(M){o.roles[M].terraphim_it=this.checked,i.set(o),t(8,d)}function P(M,le){o.roles[M].haystacks[le].service=At(this),i.set(o),t(8,d)}function N(M,le){o.roles[M].haystacks[le].path=this.value,i.set(o),t(8,d)}const q=(M,le)=>r(M,le);function W(M,le){o.roles[M].haystacks[le].atomic_server_secret=this.value,i.set(o),t(8,d)}function X(M,le){o.roles[M].haystacks[le].extra_parameters.tag=this.value,i.set(o),t(8,d)}const U=(M,le,H)=>{const re=H.currentTarget.value;re&&pl(i,o.roles[M].haystacks[le].extra_parameters.tag=re,o)},oe=(M,le,H,re)=>I(M,le,H,re);function ge(M,le,H){o.roles[M].haystacks[le].extra_parameters[H]=this.value,i.set(o),t(8,d)}const we=(M,le,H)=>z(M,le,H),he=(M,le)=>$(M,le,"tag","#rust"),fe=(M,le)=>$(M,le,"max_count","10"),se=(M,le)=>$(M,le,"","");function ue(M,le){o.roles[M].haystacks[le].read_only=this.checked,i.set(o),t(8,d)}const ke=(M,le)=>h(M,le),Ce=M=>b(M);function te(M){o.roles[M].llm_provider=At(this),i.set(o),t(8,d)}function ie(M){o.roles[M].llm_model=this.value,i.set(o),t(8,d)}const ae=M=>m(M),ce=(M,le)=>{pl(i,o.roles[M].llm_model=le.currentTarget.value,o)};function Ee(M){o.roles[M].llm_base_url=this.value,i.set(o),t(8,d)}function Fe(M){o.roles[M].llm_auto_summarize=this.checked,i.set(o),t(8,d)}function Ke(M){o.roles[M].openrouter_enabled=this.checked,i.set(o),t(8,d)}function Pe(M){o.roles[M].openrouter_api_key=this.value,i.set(o),t(8,d)}function Re(M){o.roles[M].openrouter_model=this.value,i.set(o),t(8,d)}const x=M=>m(M),ne=(M,le)=>{pl(i,o.roles[M].openrouter_model=le.currentTarget.value,o)};function Se(M){o.roles[M].openrouter_auto_summarize=this.checked,i.set(o),t(8,d)}function Ae(M){o.roles[M].openrouter_chat_enabled=this.checked,i.set(o),t(8,d)}function xe(M){o.roles[M].openrouter_chat_model=At(this),i.set(o),t(8,d)}function Ie(M){o.roles[M].openrouter_chat_system_prompt=this.value,i.set(o),t(8,d)}function ut(M){o.roles[M].kg.url=this.value,i.set(o),t(8,d)}function ot(M){o.roles[M].kg.local_path=this.value,i.set(o),t(8,d)}const gt=M=>u(M);function Ye(M){o.roles[M].kg.local_type=At(this),i.set(o),t(8,d)}function nt(M){o.roles[M].kg.public=this.checked,i.set(o),t(8,d)}function ft(M){o.roles[M].kg.publish=this.checked,i.set(o),t(8,d)}return[p,_,C,o,n,r,u,i,d,m,g,y,k,w,b,h,$,z,I,E,V,J,K,T,L,G,S,j,B,F,Y,P,N,q,W,X,U,oe,ge,we,he,fe,se,ue,ke,Ce,te,ie,ae,ce,Ee,Fe,Ke,Pe,Re,x,ne,Se,Ae,xe,Ie,ut,ot,gt,Ye,nt,ft,M=>w(M),()=>{t(1,_=2)}]}class zi extends _t{constructor(e){super(),ht(this,e,Hi,Mi,ct,{},null,[-1,-1,-1,-1])}}function Fi(l){let e,t,o,n,c,r,u,i;return e=new il({props:{fallbackPath:"/"}}),u=new ls({props:{content:l[0],onChange:l[1]}}),{c(){pe(e.$$.fragment),t=v(),o=f("div"),n=f("p"),n.innerHTML="<i>The best editing experience is to configure Atomic Server, in the meantime use editor below. You will need to refresh page via Command R or Ctrl-R to see changes</i>",c=v(),r=f("div"),pe(u.$$.fragment),a(r,"class","editor"),a(o,"class","box")},m(d,p){me(e,d,p),A(d,t,p),A(d,o,p),s(o,n),s(o,c),s(o,r),me(u,r,null),i=!0},p(d,[p]){const m={};p&1&&(m.content=d[0]),u.$set(m)},i(d){i||(Q(e.$$.fragment,d),Q(u.$$.fragment,d),i=!0)},o(d){Z(e.$$.fragment,d),Z(u.$$.fragment,d),i=!1},d(d){_e(e,d),d&&R(t),d&&R(o),_e(u)}}}function Ki(l,e,t){let o,n;Oe(l,Tt,u=>t(2,o=u)),Oe(l,Je,u=>t(3,n=u));let c={json:o};function r(u){if(console.log("contents changed:",u),console.log("is tauri",n),Tt.update(i=>(i=u.json,i)),yt(Je))console.log("Updating config on server"),je("update_config",{configNew:u.json}).then(i=>{console.log(`Message: ${i}`)}).catch(i=>console.error(i));else{let i=`${Ze.ServerURL}/config/`;fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u.json)})}t(0,c=u)}return Jt(()=>{t(0,c={json:o})}),[c,r]}class Wi extends _t{constructor(e){super(),ht(this,e,Ki,Fi,ct,{})}}const{window:Ml}=Ts;function qi(l){let e,t,o,n,c,r,u,i,d,p;return{c(){e=f("div"),t=f("div"),o=f("h3"),o.textContent="Error loading graph",n=v(),c=f("p"),r=D(l[3]),u=v(),i=f("button"),i.textContent="Retry",a(i,"class","button is-primary"),a(t,"class","error-content svelte-1ry9pkl"),a(e,"class","error-overlay svelte-1ry9pkl")},m(m,_){A(m,e,_),s(e,t),s(t,o),s(t,n),s(t,c),s(c,r),s(t,u),s(t,i),d||(p=ee(i,"click",l[11]),d=!0)},p(m,_){_&8&&ve(r,m[3])},d(m){m&&R(e),d=!1,p()}}}function Gi(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="loading-content svelte-1ry9pkl"><div class="loader svelte-1ry9pkl"></div> 
        <p>Loading knowledge graph...</p></div>`,a(e,"class","loading-overlay svelte-1ry9pkl")},m(t,o){A(t,e,o)},p:Te,d(t){t&&R(e)}}}function Dn(l){let e,t,o;return{c(){e=f("button"),e.innerHTML='<i class="fas fa-times svelte-1ry9pkl"></i>',a(e,"class","close-button svelte-1ry9pkl"),a(e,"title","Close Graph")},m(n,c){A(n,e,c),t||(o=ee(e,"click",l[17]),t=!0)},p:Te,d(n){n&&R(e),t=!1,o()}}}function Mn(l){let e;return{c(){e=f("div"),e.innerHTML="<span><strong>Left-click:</strong> View node ‚Ä¢ <strong>Right-click:</strong> Edit node ‚Ä¢ <strong>Drag:</strong> Move ‚Ä¢ <strong>Scroll:</strong> Zoom</span>",a(e,"class","controls-info svelte-1ry9pkl")},m(t,o){A(t,e,o)},d(t){t&&R(e)}}}function jn(l){let e,t;return{c(){e=f("div"),t=D(l[8]),a(e,"class","debug-message svelte-1ry9pkl")},m(o,n){A(o,e,n),s(e,t)},p(o,n){n&256&&ve(t,o[8])},d(o){o&&R(e)}}}function Hn(l){let e=l[5].id,t,o,n=zn(l);return{c(){n.c(),t=lt()},m(c,r){n.m(c,r),A(c,t,r),o=!0},p(c,r){r&32&&ct(e,e=c[5].id)?(qe(),Z(n,1,1,Te),Ge(),n=zn(c),n.c(),Q(n,1),n.m(t.parentNode,t)):n.p(c,r)},i(c){o||(Q(n),o=!0)},o(c){Z(n),o=!1},d(c){c&&R(t),n.d(c)}}}function zn(l){let e,t,o;function n(r){l[18](r)}let c={item:l[5],initialEdit:l[7]};return l[6]!==void 0&&(c.active=l[6]),e=new zl({props:c}),Xe.push(()=>et(e,"active",n)),e.$on("close",l[12]),e.$on("save",l[13]),{c(){pe(e.$$.fragment)},m(r,u){me(e,r,u),o=!0},p(r,u){const i={};u&32&&(i.item=r[5]),u&128&&(i.initialEdit=r[7]),!t&&u&64&&(t=!0,i.active=r[6],tt(()=>t=!1)),e.$set(i)},i(r){o||(Q(e.$$.fragment,r),o=!0)},o(r){Z(e.$$.fragment,r),o=!1},d(r){_e(e,r)}}}function Bi(l){let e,t,o,n,c,r,u,i,d,p,m;at(l[15]),e=new il({props:{fallbackPath:"/"}});function _(h,$){if(h[2])return Gi;if(h[3])return qi}let C=_(l),g=C&&C(l),y=l[0]&&Dn(l),k=!l[2]&&!l[3]&&l[4].length>0&&Mn(),w=l[8]&&jn(l),b=l[5]&&Hn(l);return{c(){pe(e.$$.fragment),t=v(),o=f("div"),g&&g.c(),n=v(),y&&y.c(),c=v(),k&&k.c(),r=v(),w&&w.c(),u=v(),b&&b.c(),i=lt(),a(o,"class","graph-container svelte-1ry9pkl"),de(o,"width",l[0]?"100vw":"600px"),de(o,"height",l[0]?"100vh":"400px"),Nt(o,"fullscreen",l[0])},m(h,$){me(e,h,$),A(h,t,$),A(h,o,$),g&&g.m(o,null),l[16](o),A(h,n,$),y&&y.m(h,$),A(h,c,$),k&&k.m(h,$),A(h,r,$),w&&w.m(h,$),A(h,u,$),b&&b.m(h,$),A(h,i,$),d=!0,p||(m=ee(Ml,"resize",l[15]),p=!0)},p(h,[$]){C===(C=_(h))&&g?g.p(h,$):(g&&g.d(1),g=C&&C(h),g&&(g.c(),g.m(o,null))),(!d||$&1)&&de(o,"width",h[0]?"100vw":"600px"),(!d||$&1)&&de(o,"height",h[0]?"100vh":"400px"),(!d||$&1)&&Nt(o,"fullscreen",h[0]),h[0]?y?y.p(h,$):(y=Dn(h),y.c(),y.m(c.parentNode,c)):y&&(y.d(1),y=null),!h[2]&&!h[3]&&h[4].length>0?k||(k=Mn(),k.c(),k.m(r.parentNode,r)):k&&(k.d(1),k=null),h[8]?w?w.p(h,$):(w=jn(h),w.c(),w.m(u.parentNode,u)):w&&(w.d(1),w=null),h[5]?b?(b.p(h,$),$&32&&Q(b,1)):(b=Hn(h),b.c(),Q(b,1),b.m(i.parentNode,i)):b&&(qe(),Z(b,1,1,()=>{b=null}),Ge())},i(h){d||(Q(e.$$.fragment,h),Q(b),d=!0)},o(h){Z(e.$$.fragment,h),Z(b),d=!1},d(h){_e(e,h),h&&R(t),h&&R(o),g&&g.d(),l[16](null),h&&R(n),y&&y.d(h),h&&R(c),k&&k.d(h),h&&R(r),w&&w.d(h),h&&R(u),b&&b.d(h),h&&R(i),p=!1,m()}}}function Fn(l){return{id:`kg-node-${l.id}`,url:`#/graph/node/${l.id}`,title:l.label,body:`# ${l.label}

**Knowledge Graph Node**

ID: ${l.id}
Rank: ${l.rank}

This is a concept node from the knowledge graph. You can edit this content to add more information about "${l.label}".`,description:`Knowledge graph concept: ${l.label}`,tags:["knowledge-graph","concept"],rank:l.rank,stub:`Knowledge graph concept: ${l.label}`}}function Ji(l,e,t){let o,n;Oe(l,St,L=>t(20,o=L)),Oe(l,Je,L=>t(21,n=L));let{apiUrl:c="/rolegraph"}=e,{fullscreen:r=!0}=e,u,i=!0,d=null,p=[],m=[],_=null,C=!1,g=!1,y="",k=window.innerWidth,w=window.innerHeight;function b(){t(9,k=window.innerWidth),t(10,w=window.innerHeight),!i&&!d&&E()}async function h(){t(2,i=!0),t(3,d=null);try{if(n){console.log("Loading rolegraph from Tauri");const L=await je("get_rolegraph",{role_name:o||void 0});if(L&&L.status==="success")t(4,p=L.nodes),m=L.edges;else throw new Error(`Tauri rolegraph fetch failed: ${(L==null?void 0:L.status)||"unknown error"}`)}else{console.log("Loading rolegraph from server");const L=o?`${c}?role=${encodeURIComponent(o)}`:c,G=await fetch(L);if(!G.ok)throw new Error(`Failed to fetch: ${G.status}`);const S=await G.json();t(4,p=S.nodes),m=S.edges}}catch(L){t(3,d=L.message),console.error("Error fetching rolegraph:",L)}finally{t(2,i=!1)}}function $(L,G){L.stopPropagation(),console.log("Node clicked:",G.label),t(5,_=Fn(G)),t(7,g=!1),t(6,C=!0)}function z(L,G){L.preventDefault(),L.stopPropagation(),console.log("Node right-clicked:",G.label),t(8,y=`Right-clicked: ${G.label}`),t(5,_=Fn(G)),t(7,g=!0),t(6,C=!0),setTimeout(()=>{t(8,y="")},2e3)}function O(){t(6,C=!1),t(5,_=null),t(7,g=!1)}async function I(){if(_)try{const L=await fetch("/documents",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(_)});L.ok?console.log("Successfully saved KG record:",_.id):console.error("Failed to save KG record:",L.statusText)}catch(L){console.error("Error saving KG record:",L)}finally{t(6,C=!1),t(5,_=null),t(7,g=!1)}}function E(){if(!u)return;t(1,u.innerHTML="",u);const L=Ul(u).append("svg").attr("width",k).attr("height",w),G=Hs().scaleExtent([.1,10]).on("zoom",W=>{S.attr("transform",W.transform)});L.call(G);const S=L.append("g"),j=zs(p).force("link",Fs(m).id(W=>W.id).distance(100)).force("charge",Ks().strength(-200)).force("center",Ws(k/2,w/2)).force("collision",qs().radius(20)),B=S.append("g").attr("class","links").selectAll("line").data(m).enter().append("line").attr("stroke","#666").attr("stroke-opacity",.7).attr("stroke-width",W=>{const X=W.weight||W.rank||1;return Math.max(1,Math.min(8,X*2))}),F=S.append("g").attr("class","nodes").selectAll("circle").data(p).enter().append("circle").attr("r",W=>{const X=W.rank||1;return Math.max(6,Math.min(20,X*2))}).attr("fill",W=>{const X=W.rank||1,U=Math.min(X/10,1);return Gs(.2+U*.6)}).attr("stroke","#fff").attr("stroke-width",2).style("cursor","pointer").on("click",(W,X)=>$(W,X)).on("contextmenu",(W,X)=>z(W,X)).on("mouseover",function(W,X){Ul(this).transition().duration(150).attr("stroke-width",3).attr("r",U=>{const oe=U.rank||1;return Math.max(8,Math.min(24,oe*2.5))})}).on("mouseout",function(W,X){Ul(this).transition().duration(150).attr("stroke-width",2).attr("r",U=>{const oe=U.rank||1;return Math.max(6,Math.min(20,oe*2))})}).call(Bs().on("start",P).on("drag",N).on("end",q)),Y=S.append("g").attr("class","labels").selectAll("text").data(p).enter().append("text").attr("text-anchor","middle").attr("dy",".35em").attr("font-size","11px").attr("font-family","Arial, sans-serif").attr("fill","#333").attr("pointer-events","none").text(W=>W.label.length>12?W.label.substring(0,12)+"...":W.label);j.on("tick",()=>{B.attr("x1",W=>W.source.x).attr("y1",W=>W.source.y).attr("x2",W=>W.target.x).attr("y2",W=>W.target.y),F.attr("cx",W=>W.x).attr("cy",W=>W.y),Y.attr("x",W=>W.x).attr("y",W=>W.y)});function P(W,X){W.active||j.alphaTarget(.3).restart(),X.fx=X.x,X.fy=X.y}function N(W,X){X.fx=W.x,X.fy=W.y}function q(W,X){W.active||j.alphaTarget(0),X.fx=null,X.fy=null}}Jt(()=>{h().then(()=>{d||E()});const L=G=>{G.preventDefault()};return u&&u.addEventListener("contextmenu",L),window.addEventListener("resize",b),()=>{u&&u.removeEventListener("contextmenu",L),window.removeEventListener("resize",b)}});function V(){t(9,k=Ml.innerWidth),t(10,w=Ml.innerHeight)}function J(L){Xe[L?"unshift":"push"](()=>{u=L,t(1,u)})}const K=()=>history.back();function T(L){C=L,t(6,C)}return l.$$set=L=>{"apiUrl"in L&&t(14,c=L.apiUrl),"fullscreen"in L&&t(0,r=L.fullscreen)},[r,u,i,d,p,_,C,g,y,k,w,h,O,I,c,V,J,K,T]}class Vi extends _t{constructor(e){super(),ht(this,e,Ji,Bi,ct,{apiUrl:14,fullscreen:0})}}function Kn(l,e,t){const o=l.slice();return o[16]=e[t],o[18]=t,o}function Wn(l,e,t){const o=l.slice();return o[19]=e[t],o[21]=t,o}function qn(l){let e,t,o;return{c(){e=f("p"),t=D("Conversation ID: "),o=D(l[5]),a(e,"class","is-size-7 has-text-grey")},m(n,c){A(n,e,c),s(e,t),s(e,o)},p(n,c){c&32&&ve(o,n[5])},d(n){n&&R(e)}}}function Gn(l){let e,t,o,n=l[19].content+"",c,r;return{c(){e=f("div"),t=f("div"),o=f("pre"),c=D(n),a(o,"class","svelte-fa1qxe"),a(t,"class","bubble svelte-fa1qxe"),a(e,"class",r=It(`msg ${l[19].role}`)+" svelte-fa1qxe")},m(u,i){A(u,e,i),s(e,t),s(t,o),s(o,c)},p(u,i){i&1&&n!==(n=u[19].content+"")&&ve(c,n),i&1&&r!==(r=It(`msg ${u[19].role}`)+" svelte-fa1qxe")&&a(e,"class",r)},d(u){u&&R(e)}}}function Bn(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="bubble loading svelte-fa1qxe"><span class="icon is-small"><i class="fas fa-spinner fa-spin"></i></span> 
            <span>Thinking...</span></div>`,a(e,"class","msg assistant svelte-fa1qxe")},m(t,o){A(t,e,o)},d(t){t&&R(e)}}}function Jn(l){let e,t,o;return{c(){e=f("p"),t=D("Model: "),o=D(l[4]),a(e,"class","is-size-7 has-text-grey")},m(n,c){A(n,e,c),s(e,t),s(e,o)},p(n,c){c&16&&ve(o,n[4])},d(n){n&&R(e)}}}function Vn(l){let e,t;return{c(){e=f("p"),t=D(l[3]),a(e,"class","has-text-danger is-size-7")},m(o,n){A(o,e,n),s(e,t)},p(o,n){n&8&&ve(t,o[3])},d(o){o&&R(e)}}}function Qi(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-refresh"></i>',a(e,"class","icon is-small")},m(t,o){A(t,e,o)},d(t){t&&R(e)}}}function Yi(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-spinner fa-spin"></i>',a(e,"class","icon is-small")},m(t,o){A(t,e,o)},d(t){t&&R(e)}}}function Zi(l){let e,t=l[6],o=[];for(let n=0;n<t.length;n+=1)o[n]=Zn(Kn(l,t,n));return{c(){e=f("div");for(let n=0;n<o.length;n+=1)o[n].c();a(e,"class","context-items svelte-fa1qxe")},m(n,c){A(n,e,c);for(let r=0;r<o.length;r+=1)o[r]&&o[r].m(e,null)},p(n,c){if(c&64){t=n[6];let r;for(r=0;r<t.length;r+=1){const u=Kn(n,t,r);o[r]?o[r].p(u,c):(o[r]=Zn(u),o[r].c(),o[r].m(e,null))}for(;r<o.length;r+=1)o[r].d(1);o.length=t.length}},d(n){n&&R(e),Ve(o,n)}}}function Xi(l){let e;return{c(){e=f("div"),e.innerHTML=`<span class="icon is-large"><i class="fas fa-inbox fa-2x"></i></span> 
              <p class="is-size-6">No context items yet</p> 
              <p class="is-size-7">Add documents from search results to provide context for your chat.</p>`,a(e,"class","has-text-centered has-text-grey-light")},m(t,o){A(t,e,o)},p:Te,d(t){t&&R(e)}}}function Qn(l){let e,t=l[16].relevance_score.toFixed(1)+"",o;return{c(){e=f("span"),o=D(t),a(e,"class","tag is-light is-small")},m(n,c){A(n,e,c),s(e,o)},p(n,c){c&64&&t!==(t=n[16].relevance_score.toFixed(1)+"")&&ve(o,t)},d(n){n&&R(e)}}}function Yn(l){let e;return{c(){e=f("hr"),a(e,"class","context-divider svelte-fa1qxe")},m(t,o){A(t,e,o)},d(t){t&&R(e)}}}function Zn(l){let e,t,o,n,c,r=l[16].context_type.replace(/([A-Z])/g," $1").trim()+"",u,i,d,p,m,_,C,g=l[16].title+"",y,k,w,b,h=l[16].content.substring(0,150)+"",$,z=l[16].content.length>150?"...":"",O,I,E,V,J=new Date(l[16].created_at).toLocaleString()+"",K,T,L,G,S=l[16].relevance_score&&Qn(l),j=l[18]<l[6].length-1&&Yn();return{c(){e=f("div"),t=f("div"),o=f("div"),n=f("div"),c=f("span"),u=D(r),d=v(),p=f("div"),m=f("div"),S&&S.c(),_=v(),C=f("h6"),y=D(g),k=v(),w=f("div"),b=f("p"),$=D(h),O=D(z),I=v(),E=f("div"),V=D("Added: "),K=D(J),L=v(),j&&j.c(),G=lt(),a(c,"class",i="tag is-small "+(l[16].context_type==="Document"?"is-info":l[16].context_type==="SearchResult"?"is-primary":l[16].context_type==="UserInput"?"is-warning":"is-light")),a(n,"class","level-item"),a(o,"class","level-left"),a(m,"class","level-item"),a(p,"class","level-right"),a(t,"class","level is-mobile"),a(C,"class","title is-6 has-text-dark"),a(b,"class","context-preview svelte-fa1qxe"),a(w,"class","content is-small"),a(E,"class","is-size-7 has-text-grey"),a(e,"class","context-item svelte-fa1qxe"),a(e,"data-context-id",T=l[16].id)},m(B,F){A(B,e,F),s(e,t),s(t,o),s(o,n),s(n,c),s(c,u),s(t,d),s(t,p),s(p,m),S&&S.m(m,null),s(e,_),s(e,C),s(C,y),s(e,k),s(e,w),s(w,b),s(b,$),s(b,O),s(e,I),s(e,E),s(E,V),s(E,K),A(B,L,F),j&&j.m(B,F),A(B,G,F)},p(B,F){F&64&&r!==(r=B[16].context_type.replace(/([A-Z])/g," $1").trim()+"")&&ve(u,r),F&64&&i!==(i="tag is-small "+(B[16].context_type==="Document"?"is-info":B[16].context_type==="SearchResult"?"is-primary":B[16].context_type==="UserInput"?"is-warning":"is-light"))&&a(c,"class",i),B[16].relevance_score?S?S.p(B,F):(S=Qn(B),S.c(),S.m(m,null)):S&&(S.d(1),S=null),F&64&&g!==(g=B[16].title+"")&&ve(y,g),F&64&&h!==(h=B[16].content.substring(0,150)+"")&&ve($,h),F&64&&z!==(z=B[16].content.length>150?"...":"")&&ve(O,z),F&64&&J!==(J=new Date(B[16].created_at).toLocaleString()+"")&&ve(K,J),F&64&&T!==(T=B[16].id)&&a(e,"data-context-id",T),B[18]<B[6].length-1?j||(j=Yn(),j.c(),j.m(G.parentNode,G)):j&&(j.d(1),j=null)},d(B){B&&R(e),S&&S.d(),B&&R(L),j&&j.d(B),B&&R(G)}}}function xi(l){let e,t,o,n,c,r,u,i,d,p,m,_,C,g,y,k,w,b,h,$,z,O,I,E,V,J,K,T,L,G,S,j,B,F,Y,P,N,q,W,X,U=l[6].length+"",oe,ge,we,he,fe,se,ue;e=new il({props:{fallbackPath:"/"}});let ke=l[5]&&qn(l),Ce=l[0],te=[];for(let ne=0;ne<Ce.length;ne+=1)te[ne]=Gn(Wn(l,Ce,ne));let ie=l[2]&&Bn(),ae=l[4]&&Jn(l),ce=l[3]&&Vn(l);function Ee(ne,Se){return ne[7]?Yi:Qi}let Fe=Ee(l),Ke=Fe(l);function Pe(ne,Se){return ne[6].length===0?Xi:Zi}let Re=Pe(l),x=Re(l);return{c(){pe(e.$$.fragment),t=v(),o=f("section"),n=f("div"),c=f("div"),r=f("div"),u=f("h2"),u.textContent="Chat",i=v(),d=f("p"),d.textContent=`Role: ${yt(St)}`,p=v(),ke&&ke.c(),m=v(),_=f("div");for(let ne=0;ne<te.length;ne+=1)te[ne].c();C=v(),ie&&ie.c(),g=v(),ae&&ae.c(),y=v(),ce&&ce.c(),k=v(),w=f("div"),b=f("div"),h=f("textarea"),$=v(),z=f("div"),O=f("button"),I=f("span"),I.innerHTML='<i class="fas fa-paper-plane"></i>',V=v(),J=f("div"),K=f("div"),T=f("div"),L=f("div"),L.innerHTML='<div class="level-item"><h4 class="title is-5">Context</h4></div>',G=v(),S=f("div"),j=f("div"),B=f("button"),Ke.c(),F=v(),x.c(),Y=v(),P=f("div"),N=f("div"),q=f("div"),W=f("div"),X=f("span"),oe=D(U),ge=D(" context items"),we=v(),he=f("div"),he.innerHTML='<div class="level-item"><span class="is-size-7 has-text-grey">Context is automatically included in your chat</span></div>',a(u,"class","title is-4"),a(d,"class","subtitle is-6"),a(_,"class","chat-window svelte-fa1qxe"),a(h,"class","textarea"),a(h,"rows","3"),a(h,"placeholder","Type your message and press Enter..."),a(b,"class","control is-expanded"),a(I,"class","icon"),a(O,"class","button is-primary"),O.disabled=E=l[2]||!l[1].trim(),a(z,"class","control"),a(w,"class","field has-addons chat-input svelte-fa1qxe"),a(r,"class","column is-8"),a(L,"class","level-left"),a(B,"class","button is-small is-light"),B.disabled=l[7],a(j,"class","level-item"),a(S,"class","level-right"),a(T,"class","level is-mobile"),a(X,"class","tag is-light is-small"),a(W,"class","level-item"),a(q,"class","level-left"),a(he,"class","level-right"),a(N,"class","level is-mobile"),a(P,"class","mt-4"),a(K,"class","box context-panel svelte-fa1qxe"),a(J,"class","column is-4"),a(c,"class","columns svelte-fa1qxe"),a(n,"class","container"),a(o,"class","section")},m(ne,Se){me(e,ne,Se),A(ne,t,Se),A(ne,o,Se),s(o,n),s(n,c),s(c,r),s(r,u),s(r,i),s(r,d),s(r,p),ke&&ke.m(r,null),s(r,m),s(r,_);for(let Ae=0;Ae<te.length;Ae+=1)te[Ae]&&te[Ae].m(_,null);s(_,C),ie&&ie.m(_,null),s(r,g),ae&&ae.m(r,null),s(r,y),ce&&ce.m(r,null),s(r,k),s(r,w),s(w,b),s(b,h),Ne(h,l[1]),s(w,$),s(w,z),s(z,O),s(O,I),s(c,V),s(c,J),s(J,K),s(K,T),s(T,L),s(T,G),s(T,S),s(S,j),s(j,B),Ke.m(B,null),s(K,F),x.m(K,null),s(K,Y),s(K,P),s(P,N),s(N,q),s(q,W),s(W,X),s(X,oe),s(X,ge),s(N,we),s(N,he),fe=!0,se||(ue=[ee(h,"input",l[11]),ee(h,"keydown",l[10]),ee(O,"click",l[9]),ee(B,"click",l[8])],se=!0)},p(ne,[Se]){if(ne[5]?ke?ke.p(ne,Se):(ke=qn(ne),ke.c(),ke.m(r,m)):ke&&(ke.d(1),ke=null),Se&1){Ce=ne[0];let Ae;for(Ae=0;Ae<Ce.length;Ae+=1){const xe=Wn(ne,Ce,Ae);te[Ae]?te[Ae].p(xe,Se):(te[Ae]=Gn(xe),te[Ae].c(),te[Ae].m(_,C))}for(;Ae<te.length;Ae+=1)te[Ae].d(1);te.length=Ce.length}ne[2]?ie||(ie=Bn(),ie.c(),ie.m(_,null)):ie&&(ie.d(1),ie=null),ne[4]?ae?ae.p(ne,Se):(ae=Jn(ne),ae.c(),ae.m(r,y)):ae&&(ae.d(1),ae=null),ne[3]?ce?ce.p(ne,Se):(ce=Vn(ne),ce.c(),ce.m(r,k)):ce&&(ce.d(1),ce=null),Se&2&&Ne(h,ne[1]),(!fe||Se&6&&E!==(E=ne[2]||!ne[1].trim()))&&(O.disabled=E),Fe!==(Fe=Ee(ne))&&(Ke.d(1),Ke=Fe(ne),Ke&&(Ke.c(),Ke.m(B,null))),(!fe||Se&128)&&(B.disabled=ne[7]),Re===(Re=Pe(ne))&&x?x.p(ne,Se):(x.d(1),x=Re(ne),x&&(x.c(),x.m(K,Y))),(!fe||Se&64)&&U!==(U=ne[6].length+"")&&ve(oe,U)},i(ne){fe||(Q(e.$$.fragment,ne),fe=!0)},o(ne){Z(e.$$.fragment,ne),fe=!1},d(ne){_e(e,ne),ne&&R(t),ne&&R(o),ke&&ke.d(),Ve(te,ne),ie&&ie.d(),ae&&ae.d(),ce&&ce.d(),Ke.d(),x.d(),se=!1,Qe(ue)}}}function ea(l,e,t){let o;Oe(l,Je,h=>t(12,o=h));let n=[],c="",r=!1,u=null,i=null,d=null,p=[],m=!1;function _(h){t(0,n=[...n,{role:"user",content:h}])}async function C(){try{if(o){const h=await je("list_conversations");h!=null&&h.conversations&&h.conversations.length>0?(t(5,d=h.conversations[0].id),console.log("üéØ Using existing conversation:",d),await y()):await g()}else{const h=await fetch(`${Ze.ServerURL}/conversations`);if(h.ok){const $=await h.json();$.conversations&&$.conversations.length>0?(t(5,d=$.conversations[0].id),console.log("üéØ Using existing conversation:",d),await y()):await g()}else await g()}}catch(h){console.error("‚ùå Error initializing conversation:",h)}}async function g(){try{const h=yt(St);if(o){const $=await je("create_conversation",{title:"Chat Conversation",role:h});$.status==="Success"&&$.conversationId&&(t(5,d=$.conversationId),console.log("üÜï Created new conversation:",d))}else{const $=await fetch(`${Ze.ServerURL}/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"Chat Conversation",role:h})});if($.ok){const z=await $.json();z.status==="Success"&&z.conversation_id&&(t(5,d=z.conversation_id),console.log("üÜï Created new conversation:",d))}}}catch(h){console.error("‚ùå Error creating conversation:",h)}}async function y(){if(d){t(7,m=!0);try{if(o){const h=await je("get_conversation",{conversationId:d});h.status==="Success"&&h.conversation&&t(6,p=h.conversation.global_context||[])}else{const h=await fetch(`${Ze.ServerURL}/conversations/${d}`);if(h.ok){const $=await h.json();$.status==="Success"&&$.conversation&&t(6,p=$.conversation.global_context||[])}}}catch(h){console.error("‚ùå Error loading conversation context:",h)}finally{t(7,m=!1)}}}async function k(){var z;if(!c.trim()||r)return;t(3,u=null);const h=yt(St),$=c.trim();t(1,c=""),d||await C(),_($),t(2,r=!0);try{const O={role:h,messages:n};d&&(O.conversation_id=d);const I=await fetch(`${Ze.ServerURL}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(O)});if(!I.ok)throw new Error(`HTTP ${I.status}`);const E=await I.json();t(4,i=E.model_used??null),((z=E.status)==null?void 0:z.toLowerCase())==="success"&&E.message?t(0,n=[...n,{role:"assistant",content:E.message}]):t(3,u=E.error||"Chat failed")}catch(O){t(3,u=(O==null?void 0:O.message)||String(O))}finally{t(2,r=!1)}}function w(h){(h.key==="Enter"||h.key==="Return")&&!h.shiftKey&&(h.preventDefault(),k())}Jt(()=>{t(0,n=[{role:"assistant",content:"Hi! How can I help you? Ask me anything about your search results or documents."}]),C()});function b(){c=this.value,t(1,c)}return[n,c,r,u,i,d,p,m,y,k,w,b]}class ta extends _t{constructor(e){super(),ht(this,e,ea,xi,ct,{})}}function la(l){let e,t;return e=new Li({}),{c(){pe(e.$$.fragment)},m(o,n){me(e,o,n),t=!0},i(o){t||(Q(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){_e(e,o)}}}function oa(l){let e,t;return e=new vr({}),{c(){pe(e.$$.fragment)},m(o,n){me(e,o,n),t=!0},i(o){t||(Q(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){_e(e,o)}}}function na(l){let e,t;return e=new zi({}),{c(){pe(e.$$.fragment)},m(o,n){me(e,o,n),t=!0},i(o){t||(Q(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){_e(e,o)}}}function sa(l){let e,t;return e=new Wi({}),{c(){pe(e.$$.fragment)},m(o,n){me(e,o,n),t=!0},i(o){t||(Q(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){_e(e,o)}}}function ra(l){let e,t;return e=new Vi({}),{c(){pe(e.$$.fragment)},m(o,n){me(e,o,n),t=!0},i(o){t||(Q(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){_e(e,o)}}}function ia(l){let e,t;return e=new ta({}),{c(){pe(e.$$.fragment)},m(o,n){me(e,o,n),t=!0},i(o){t||(Q(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){_e(e,o)}}}function aa(l){let e;return{c(){e=f("nav"),e.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
            <a class="navbar-item" href="/config/wizard">Wizard</a> 
            <a class="navbar-item" href="/config/json">JSON¬†Editor</a> 
            <a class="navbar-item" href="/graph">Graph</a> 
            <a class="navbar-item" href="/chat">Chat</a></div>`,a(e,"class","navbar")},m(t,o){A(t,e,o)},p:Te,d(t){t&&R(e)}}}function ca(l){let e,t,o,n,c,r,u,i,d,p,m,_,C,g,y,k,w,b,h,$,z,O,I,E,V,J,K,T,L,G;return u=new El({}),p=new Pt({props:{path:"/",$$slots:{default:[la]},$$scope:{ctx:l}}}),g=new Pt({props:{path:"/fetch/*",$$slots:{default:[oa]},$$scope:{ctx:l}}}),k=new Pt({props:{path:"/config/wizard",$$slots:{default:[na]},$$scope:{ctx:l}}}),b=new Pt({props:{path:"/config/json",$$slots:{default:[sa]},$$scope:{ctx:l}}}),$=new Pt({props:{path:"/graph",$$slots:{default:[ra]},$$scope:{ctx:l}}}),O=new Pt({props:{path:"/chat",$$slots:{default:[ia]},$$scope:{ctx:l}}}),J=new Pt({props:{path:"/",$$slots:{default:[aa]},$$scope:{ctx:l}}}),{c(){e=f("meta"),t=v(),o=f("div"),n=f("main"),c=f("div"),r=f("div"),pe(u.$$.fragment),i=v(),d=f("div"),pe(p.$$.fragment),m=v(),_=f("br"),C=v(),pe(g.$$.fragment),y=v(),pe(k.$$.fragment),w=v(),pe(b.$$.fragment),h=v(),pe($.$$.fragment),z=v(),pe(O.$$.fragment),I=v(),E=f("footer"),V=f("div"),pe(J.$$.fragment),a(e,"name","color-scheme"),a(e,"content",l[1]),document.title="Terraphim",a(r,"class","role-selector svelte-1bfpta4"),a(c,"class","top-controls svelte-1bfpta4"),a(d,"class","search-area svelte-1bfpta4"),a(n,"class","main-content svelte-1bfpta4"),a(V,"class",K=It(l[0])+" svelte-1bfpta4"),a(E,"class","svelte-1bfpta4"),a(o,"class","is-full-height svelte-1bfpta4")},m(S,j){s(document.head,e),A(S,t,j),A(S,o,j),s(o,n),s(n,c),s(c,r),me(u,r,null),s(n,i),s(n,d),me(p,d,null),s(n,m),s(n,_),s(n,C),me(g,n,null),s(n,y),me(k,n,null),s(n,w),me(b,n,null),s(n,h),me($,n,null),s(n,z),me(O,n,null),s(o,I),s(o,E),s(E,V),me(J,V,null),T=!0,L||(G=[ee(E,"mouseover",l[2]),ee(E,"focus",l[2])],L=!0)},p(S,[j]){(!T||j&2)&&a(e,"content",S[1]);const B={};j&8&&(B.$$scope={dirty:j,ctx:S}),p.$set(B);const F={};j&8&&(F.$$scope={dirty:j,ctx:S}),g.$set(F);const Y={};j&8&&(Y.$$scope={dirty:j,ctx:S}),k.$set(Y);const P={};j&8&&(P.$$scope={dirty:j,ctx:S}),b.$set(P);const N={};j&8&&(N.$$scope={dirty:j,ctx:S}),$.$set(N);const q={};j&8&&(q.$$scope={dirty:j,ctx:S}),O.$set(q);const W={};j&8&&(W.$$scope={dirty:j,ctx:S}),J.$set(W),(!T||j&1&&K!==(K=It(S[0])+" svelte-1bfpta4"))&&a(V,"class",K)},i(S){T||(Q(u.$$.fragment,S),Q(p.$$.fragment,S),Q(g.$$.fragment,S),Q(k.$$.fragment,S),Q(b.$$.fragment,S),Q($.$$.fragment,S),Q(O.$$.fragment,S),Q(J.$$.fragment,S),T=!0)},o(S){Z(u.$$.fragment,S),Z(p.$$.fragment,S),Z(g.$$.fragment,S),Z(k.$$.fragment,S),Z(b.$$.fragment,S),Z($.$$.fragment,S),Z(O.$$.fragment,S),Z(J.$$.fragment,S),T=!1},d(S){R(e),S&&R(t),S&&R(o),_e(u),_e(p),_e(g),_e(k),_e(b),_e($),_e(O),_e(J),L=!1,Qe(G)}}}function ua(l,e,t){let o;Oe(l,ml,r=>t(1,o=r));let n="is-hidden";function c(){t(0,n="")}return[n,o,c]}class fa extends _t{constructor(e){super(),ht(this,e,ua,ca,ct,{})}}const da=new Us;Ds(da);new fa({target:document.getElementById("app")});
