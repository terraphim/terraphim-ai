var nr=Object.defineProperty;var or=(l,e,t)=>e in l?nr(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var Ct=(l,e,t)=>(or(l,typeof e!="symbol"?e+"":e,t),t);import{aa as Dt,S as _t,i as gt,s as pt,q as f,Y as P,b as R,y as r,Z as ve,I as Re,j as S,ak as Ue,F as ut,m as tl,a as h,v as c,l as se,E as Ze,au as Ft,r as _e,z as ge,t as j,d as B,B as he,av as sr,aw as Vt,H as lt,U as st,V as rt,ax as Kt,ay as rr,g as Fe,e as Ke,O as tt,af as Rt,o as Wl,W as we,az as kl,aA as St,aB as Bl,aC as ir,a1 as Ie,C as mt,aD as Je,aE as Jl,D as pl,G as ml,aF as Gt,w as Pt,x as dt,A as Vl,a2 as ar,aG as Ht,ac as cr,a5 as ur,a7 as fr,a9 as dr,n as pr,k as Ql,aH as Qt,_ as Hl}from"./vendor-ui-427b5e16.js";import{R as Nt,S as Ul,f as mr,Y as Fl}from"./vendor-utils-26f00247.js";import{J as Ks,_ as _r,d as Gs,P as gr,k as hr,D as vr,l as br,E as kr,o as yn}from"./vendor-editor-f769871a.js";import{P as qs,T as jl,u as Ws,y as wr,A as yr,S as $r,q as Cr}from"./vendor-atomic-21763cf9.js";import{t as Tr,E as Sr}from"./novel-editor-8ce540cf.js";import{s as Kl,z as Rr,a as Ar,l as Er,m as Lr,c as Dr,b as Ir,B as Nr,d as Or}from"./vendor-charts-e6a4a6c9.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function t(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=t(o);fetch(o.href,a)}})();const Ve={ServerURL:location.protocol+"//"+window.location.host||"/"},vl=Dt([]),Pr={id:"Desktop",global_shortcut:"",roles:{},default_role:{original:"",lowercase:""},selected_role:{original:"",lowercase:""}},bl=Dt("spacelab"),At=Dt("selected"),ct=Dt(!1),Mr=Dt(`${Ve.ServerURL}/documents/search`),Lt=Dt(Pr),$n=Dt([]);let Bt=Dt("");const Tt=Dt(!1);let el=null;function jr(l){if(typeof document>"u")return;const e=`/assets/bulmaswatch/${l}/bulmaswatch.min.css`;if(el!=null&&el.href.endsWith(e))return;const t=document.createElement("link");t.rel="stylesheet",t.href=e,t.id="bulma-theme",t.onload=()=>{el&&el!==t&&el.remove(),el=t},document.head.appendChild(t);const n=document.head.querySelector('meta[name="color-scheme"]');n&&n.setAttribute("content",l)}bl.subscribe(jr);function Ur(l){let e,t;return{c(){e=f("option"),t=P(l[1]),e.__value=l[0],e.value=e.__value},m(n,o){R(n,e,o),r(e,t)},p(n,[o]){o&2&&ve(t,n[1]),o&1&&(e.__value=n[0],e.value=e.__value)},i:Re,o:Re,d(n){n&&S(e)}}}function zr(l,e,t){let n,{subject:o}=e;const a=qs(o),s=jl(a,Ws.properties.name);return Ue(l,s,u=>t(1,n=u)),jl(a,"http://localhost:9883/property/theme"),l.$$set=u=>{"subject"in u&&t(0,o=u.subject)},[o,n,s]}class Hr extends _t{constructor(e){super(),gt(this,e,zr,Ur,pt,{subject:0})}}function Cn(l){let e,t,n,o,a,s,u=l[0]&&Tn();return{c(){e=f("button"),t=f("span"),t.innerHTML='<i class="fas fa-arrow-left"></i>',n=h(),u&&u.c(),c(t,"class","icon svelte-rnsqpo"),c(e,"class",o="button is-light back-button "+l[1]+" svelte-rnsqpo"),c(e,"title","Go back"),c(e,"aria-label","Go back")},m(i,d){R(i,e,d),r(e,t),r(e,n),u&&u.m(e,null),a||(s=[se(e,"click",l[3]),se(e,"keydown",l[6])],a=!0)},p(i,d){i[0]?u||(u=Tn(),u.c(),u.m(e,null)):u&&(u.d(1),u=null),d&2&&o!==(o="button is-light back-button "+i[1]+" svelte-rnsqpo")&&c(e,"class",o)},d(i){i&&S(e),u&&u.d(),a=!1,Ze(s)}}}function Tn(l){let e;return{c(){e=f("span"),e.textContent="Back",c(e,"class","back-text svelte-rnsqpo")},m(t,n){R(t,e,n)},d(t){t&&S(e)}}}function Fr(l){let e,t=l[2]&&Cn(l);return{c(){t&&t.c(),e=ut()},m(n,o){t&&t.m(n,o),R(n,e,o)},p(n,[o]){n[2]?t?t.p(n,o):(t=Cn(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Re,o:Re,d(n){t&&t.d(n),n&&S(e)}}}function Kr(l,e,t){let{fallbackPath:n="/"}=e,{showText:o=!0}=e,{customClass:a=""}=e,{hideOnPaths:s=["/"]}=e,u=!0;function i(){var m;try{const _=((m=window.location)==null?void 0:m.pathname)||"/";t(2,u=!s.includes(_))}catch{t(2,u=!0)}}function d(){window.history.length>1?window.history.back():window.location.href=n}tl(()=>(i(),window.addEventListener("popstate",i),window.addEventListener("hashchange",i),()=>{window.removeEventListener("popstate",i),window.removeEventListener("hashchange",i)}));const p=m=>{(m.key==="Enter"||m.key===" ")&&(m.preventDefault(),d())};return l.$$set=m=>{"fallbackPath"in m&&t(4,n=m.fallbackPath),"showText"in m&&t(0,o=m.showText),"customClass"in m&&t(1,a=m.customClass),"hideOnPaths"in m&&t(5,s=m.hideOnPaths)},[o,a,u,d,n,s,p]}class _l extends _t{constructor(e){super(),gt(this,e,Kr,Fr,pt,{fallbackPath:4,showText:0,customClass:1,hideOnPaths:5})}}function Gr(){return window.crypto.getRandomValues(new Uint32Array(1))[0]}function Gl(l,e=!1){const t=Gr(),n=`_${t}`;return Object.defineProperty(window,n,{value:o=>(e&&Reflect.deleteProperty(window,n),l==null?void 0:l(o)),writable:!1,configurable:!0}),t}async function je(l,e={}){return new Promise((t,n)=>{const o=Gl(s=>{t(s),Reflect.deleteProperty(window,`_${a}`)},!0),a=Gl(s=>{n(s),Reflect.deleteProperty(window,`_${o}`)},!0);window.__TAURI_IPC__({cmd:l,callback:o,error:a,...e})})}function Sn(l,e,t){const n=l.slice();return n[25]=e[t],n}function qr(l){let e,t,n;function o(s){l[13](s)}let a={};return l[5]!==void 0&&(a.value=l[5]),e=new Vt({props:a}),lt.push(()=>st(e,"value",o)),{c(){_e(e.$$.fragment)},m(s,u){ge(e,s,u),n=!0},p(s,u){const i={};!t&&u&32&&(t=!0,i.value=s[5],rt(()=>t=!1)),e.$set(i)},i(s){n||(j(e.$$.fragment,s),n=!0)},o(s){B(e.$$.fragment,s),n=!1},d(s){he(e,s)}}}function Wr(l){let e,t,n;function o(s){l[14](s)}let a={type:"password",placeholder:"secret",icon:"fas fa-lock",expanded:!0};return l[6]!==void 0&&(a.value=l[6]),e=new Vt({props:a}),lt.push(()=>st(e,"value",o)),{c(){_e(e.$$.fragment)},m(s,u){ge(e,s,u),n=!0},p(s,u){const i={};!t&&u&64&&(t=!0,i.value=s[6],rt(()=>t=!1)),e.$set(i)},i(s){n||(j(e.$$.fragment,s),n=!0)},o(s){B(e.$$.fragment,s),n=!1},d(s){he(e,s)}}}function Br(l){let e;return{c(){e=P("Save")},m(t,n){R(t,e,n)},d(t){t&&S(e)}}}function Jr(l){let e,t;return e=new Kt({props:{type:"is-success",class:"is-right",iconPack:"fa",iconLeft:"check",$$slots:{default:[Br]},$$scope:{ctx:l}}}),e.$on("click",l[8]),e.$on("submit",l[8]),{c(){_e(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},p(n,o){const a={};o&268435456&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function Vr(l){let e,t,n,o,a,s;return e=new Ft({props:{$$slots:{default:[qr]},$$scope:{ctx:l}}}),n=new Ft({props:{grouped:!0,$$slots:{default:[Wr]},$$scope:{ctx:l}}}),a=new Ft({props:{grouped:!0,$$slots:{default:[Jr]},$$scope:{ctx:l}}}),{c(){_e(e.$$.fragment),t=h(),_e(n.$$.fragment),o=h(),_e(a.$$.fragment)},m(u,i){ge(e,u,i),R(u,t,i),ge(n,u,i),R(u,o,i),ge(a,u,i),s=!0},p(u,i){const d={};i&268435488&&(d.$$scope={dirty:i,ctx:u}),e.$set(d);const p={};i&268435520&&(p.$$scope={dirty:i,ctx:u}),n.$set(p);const m={};i&268435456&&(m.$$scope={dirty:i,ctx:u}),a.$set(m)},i(u){s||(j(e.$$.fragment,u),j(n.$$.fragment,u),j(a.$$.fragment,u),s=!0)},o(u){B(e.$$.fragment,u),B(n.$$.fragment,u),B(a.$$.fragment,u),s=!1},d(u){he(e,u),u&&S(t),he(n,u),u&&S(o),he(a,u)}}}function Qr(l){let e,t,n;function o(s){l[15](s)}let a={type:"search",placeholder:"Fetch JSON",icon:"search"};return l[3]!==void 0&&(a.value=l[3]),e=new Vt({props:a}),lt.push(()=>st(e,"value",o)),{c(){_e(e.$$.fragment)},m(s,u){ge(e,s,u),n=!0},p(s,u){const i={};!t&&u&8&&(t=!0,i.value=s[3],rt(()=>t=!1)),e.$set(i)},i(s){n||(j(e.$$.fragment,s),n=!0)},o(s){B(e.$$.fragment,s),n=!1},d(s){he(e,s)}}}function Yr(l){let e;return{c(){e=P("WikiPage")},m(t,n){R(t,e,n)},d(t){t&&S(e)}}}function Zr(l){let e,t,n,o,a,s;function u(m){l[16](m)}let i={type:"search",placeholder:"Post JSON",icon:"search"};l[4]!==void 0&&(i.value=l[4]),e=new Vt({props:i}),lt.push(()=>st(e,"value",u));function d(m){l[17](m)}let p={$$slots:{default:[Yr]},$$scope:{ctx:l}};return l[2]!==void 0&&(p.checked=l[2]),o=new rr({props:p}),lt.push(()=>st(o,"checked",d)),{c(){_e(e.$$.fragment),n=h(),_e(o.$$.fragment)},m(m,_){ge(e,m,_),R(m,n,_),ge(o,m,_),s=!0},p(m,_){const g={};!t&&_&16&&(t=!0,g.value=m[4],rt(()=>t=!1)),e.$set(g);const b={};_&268435456&&(b.$$scope={dirty:_,ctx:m}),!a&&_&4&&(a=!0,b.checked=m[2],rt(()=>a=!1)),o.$set(b)},i(m){s||(j(e.$$.fragment,m),j(o.$$.fragment,m),s=!0)},o(m){B(e.$$.fragment,m),B(o.$$.fragment,m),s=!1},d(m){he(e,m),m&&S(n),he(o,m)}}}function Xr(l){let e;return{c(){e=P("Fetch")},m(t,n){R(t,e,n)},d(t){t&&S(e)}}}function xr(l){let e,t;return e=new Kt({props:{type:"is-primary",$$slots:{default:[Xr]},$$scope:{ctx:l}}}),e.$on("click",l[9]),e.$on("submit",l[9]),{c(){_e(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},p(n,o){const a={};o&268435456&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function ei(l){let e,t,n,o,a,s;return e=new Ft({props:{grouped:!0,$$slots:{default:[Qr]},$$scope:{ctx:l}}}),n=new Ft({props:{grouped:!0,$$slots:{default:[Zr]},$$scope:{ctx:l}}}),a=new Ft({props:{grouped:!0,$$slots:{default:[xr]},$$scope:{ctx:l}}}),{c(){_e(e.$$.fragment),t=h(),_e(n.$$.fragment),o=h(),_e(a.$$.fragment)},m(u,i){ge(e,u,i),R(u,t,i),ge(n,u,i),R(u,o,i),ge(a,u,i),s=!0},p(u,i){const d={};i&268435464&&(d.$$scope={dirty:i,ctx:u}),e.$set(d);const p={};i&268435476&&(p.$$scope={dirty:i,ctx:u}),n.$set(p);const m={};i&268435456&&(m.$$scope={dirty:i,ctx:u}),a.$set(m)},i(u){s||(j(e.$$.fragment,u),j(n.$$.fragment,u),j(a.$$.fragment,u),s=!0)},o(u){B(e.$$.fragment,u),B(n.$$.fragment,u),B(a.$$.fragment,u),s=!1},d(u){he(e,u),u&&S(t),he(n,u),u&&S(o),he(a,u)}}}function ti(l){let e,t,n,o,a;return o=new Ks({props:{content:l[1],onChange:l[7]}}),{c(){e=f("p"),e.innerHTML=`<i>The best editing experience is to configure Atomic Server, in the
        meantime use editor below. You will need to refresh page via Command R
        or Ctrl-R to see changes</i>`,t=h(),n=f("div"),_e(o.$$.fragment),c(n,"class","editor")},m(s,u){R(s,e,u),R(s,t,u),R(s,n,u),ge(o,n,null),a=!0},p(s,u){const i={};u&2&&(i.content=s[1]),o.$set(i)},i(s){a||(j(o.$$.fragment,s),a=!0)},o(s){B(o.$$.fragment,s),a=!1},d(s){s&&S(e),s&&S(t),s&&S(n),he(o)}}}function Rn(l){let e,t;return e=new Hr({props:{subject:l[25]}}),{c(){_e(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},p(n,o){const a={};o&1&&(a.subject=n[25]),e.$set(a)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function li(l){let e,t,n=l[0]??[],o=[];for(let s=0;s<n.length;s+=1)o[s]=Rn(Sn(l,n,s));const a=s=>B(o[s],1,1,()=>{o[s]=null});return{c(){for(let s=0;s<o.length;s+=1)o[s].c();e=ut()},m(s,u){for(let i=0;i<o.length;i+=1)o[i]&&o[i].m(s,u);R(s,e,u),t=!0},p(s,u){if(u&1){n=s[0]??[];let i;for(i=0;i<n.length;i+=1){const d=Sn(s,n,i);o[i]?(o[i].p(d,u),j(o[i],1)):(o[i]=Rn(d),o[i].c(),j(o[i],1),o[i].m(e.parentNode,e))}for(Fe(),i=n.length;i<o.length;i+=1)a(i);Ke()}},i(s){if(!t){for(let u=0;u<n.length;u+=1)j(o[u]);t=!0}},o(s){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)B(o[u]);t=!1},d(s){tt(o,s),s&&S(e)}}}function ni(l){let e,t;return e=new sr({props:{$$slots:{default:[li]},$$scope:{ctx:l}}}),{c(){_e(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},p(n,o){const a={};o&268435457&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function oi(l){let e,t,n,o,a,s,u,i,d,p,m,_,g,b,v;return e=new _l({props:{fallbackPath:"/"}}),o=new Nt({props:{path:"/atomic",$$slots:{default:[Vr]},$$scope:{ctx:l}}}),s=new Nt({props:{path:"/json",$$slots:{default:[ei]},$$scope:{ctx:l}}}),i=new Nt({props:{path:"/editor",$$slots:{default:[ti]},$$scope:{ctx:l}}}),_=new Ft({props:{grouped:!0,position:"is-right",$$slots:{default:[ni]},$$scope:{ctx:l}}}),{c(){_e(e.$$.fragment),t=h(),n=f("div"),_e(o.$$.fragment),a=h(),_e(s.$$.fragment),u=h(),_e(i.$$.fragment),d=h(),p=f("hr"),m=h(),_e(_.$$.fragment),g=h(),b=f("nav"),b.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
    <a class="navbar-item" href="/fetch/json">Fetch JSON Data</a> 
    <a class="navbar-item" href="/fetch/atomic">Set Atomic Server</a> 
    <a class="navbar-item" href="/fetch/editor">Edit JSON config</a></div>`,c(n,"class","box"),c(b,"class","navbar")},m(w,$){ge(e,w,$),R(w,t,$),R(w,n,$),ge(o,n,null),r(n,a),ge(s,n,null),r(n,u),ge(i,n,null),R(w,d,$),R(w,p,$),R(w,m,$),ge(_,w,$),R(w,g,$),R(w,b,$),v=!0},p(w,[$]){const C={};$&268435552&&(C.$$scope={dirty:$,ctx:w}),o.$set(C);const k={};$&268435484&&(k.$$scope={dirty:$,ctx:w}),s.$set(k);const T={};$&268435458&&(T.$$scope={dirty:$,ctx:w}),i.$set(T);const F={};$&268435457&&(F.$$scope={dirty:$,ctx:w}),_.$set(F)},i(w){v||(j(e.$$.fragment,w),j(o.$$.fragment,w),j(s.$$.fragment,w),j(i.$$.fragment,w),j(_.$$.fragment,w),v=!0)},o(w){B(e.$$.fragment,w),B(o.$$.fragment,w),B(s.$$.fragment,w),B(i.$$.fragment,w),B(_.$$.fragment,w),v=!1},d(w){he(e,w),w&&S(t),w&&S(n),he(o),he(s),he(i),w&&S(d),w&&S(p),w&&S(m),he(_,w),w&&S(g),w&&S(b)}}}function si(l,e,t){let n,o,a,s,u;Ue(l,wr,L=>t(19,a=L)),Ue(l,ct,L=>t(20,s=L)),Ue(l,Lt,L=>t(21,u=L));let i={json:u};function d(L){if(console.log("contents changed:",L),console.log("is tauri",s),Lt.update(D=>(D=L.json,D)),ct)console.log("Updating config on server"),je("update_config",{configNew:L.json}).then(D=>{console.log(`Message: ${D}`)}).catch(D=>console.error(D));else{let D=`${Ve.ServerURL}/config/`;fetch(D,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(L.json)})}t(1,i=L)}let p=!1,m="https://raw.githubusercontent.com/terraphim/terraphim-cloud-fastapi/main/data/ref_arch.json",_="http://localhost:8000/documents/",g="http://localhost:9883/",b;const v=async()=>{console.log("Updating atomic server configuration");const L=yr.fromSecret(b);a.setServerUrl(g),console.log("Server set.Setting agent"),a.setAgent(L)},w=async()=>{k()},$=({data:{msg:L,data:D}})=>{console.log(L,D)};let C;const k=async()=>{const L=await _r(()=>import("./fetcher.worker-7e58969a.js"),[]);C=new L.default,C.onmessage=$;const D={msg:"fetcher",data:{url:m,postUrl:_,isWiki:p}};C.postMessage(D)},T=qs("http://localhost:9883/config/y3zx5wtm0bq"),F=jl(T,Ws.properties.name);Ue(l,F,L=>t(12,o=L));const O=jl(T,"http://localhost:9883/property/role");Ue(l,O,L=>t(0,n=L));function N(L){g=L,t(5,g)}function E(L){b=L,t(6,b)}function H(L){m=L,t(3,m)}function ee(L){_=L,t(4,_)}function J(L){p=L,t(2,p)}return l.$$.update=()=>{l.$$.dirty&4096&&console.log("Print name",o),l.$$.dirty&1&&console.log("Print roles",n)},[n,i,p,m,_,g,b,d,v,w,F,O,o,N,E,H,ee,J]}class ri extends _t{constructor(e){super(),gt(this,e,si,oi,pt,{})}}function Jt(){return Rt(ct)||typeof window<"u"&&window.__TAURI__!==void 0}class ii{constructor(){Ct(this,"baseUrl");Ct(this,"autocompleteIndexBuilt",!1);Ct(this,"sessionId");Ct(this,"currentRole","Default");Ct(this,"connectionRetries",0);Ct(this,"maxRetries",3);Ct(this,"retryDelay",1e3);Ct(this,"isConnecting",!1);this.baseUrl=typeof window<"u"?(window.location.protocol==="https:"?"https://":"http://")+window.location.hostname+":8001":"http://localhost:8001",this.sessionId=`novel-${Date.now()}`,typeof window<"u"&&!Jt()&&this.shouldPerformHealthCheck()?this.detectServerPort():typeof window<"u"&&!Jt()&&console.log("NovelAutocompleteService: Skipping server detection - not needed for current page")}setRole(e){this.currentRole=e,this.autocompleteIndexBuilt=!1}async detectServerPort(){if(Jt())return;if(!this.shouldPerformHealthCheck()){console.log("NovelAutocompleteService: Skipping health check - service not needed");return}const t=[8001,3e3];for(const n of t)try{const o=typeof window<"u"?(window.location.protocol==="https:"?"https://":"http://")+window.location.hostname+":"+n:"http://localhost:"+n,a=await fetch(`${o}/message?sessionId=health-check`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:0,method:"ping",params:{}}),signal:AbortSignal.timeout(1e3)});if(a.ok||a.status===404){this.baseUrl=o,console.log(`NovelAutocompleteService: Detected server at ${o}`);return}}catch{continue}console.warn("NovelAutocompleteService: Could not detect running server, using default:",this.baseUrl)}shouldPerformHealthCheck(){return!(typeof window<"u"&&(!window.location.pathname.startsWith("/chat")||!(document.querySelector('[contenteditable="true"]')||document.querySelector("textarea")||document.querySelector('input[type="text"]'))))}async buildAutocompleteIndex(){if(this.isConnecting)return await new Promise(e=>setTimeout(e,1e3)),this.autocompleteIndexBuilt;this.isConnecting=!0;try{return Jt()?(console.log("Using Tauri backend - no index building required"),this.autocompleteIndexBuilt=!0,this.connectionRetries=0,console.log("Tauri autocomplete ready"),!0):await this.buildMCPIndex()}catch(e){return console.error("Error building Novel autocomplete index:",e),!1}finally{this.isConnecting=!1}}async buildMCPIndex(){for(let e=0;e<=this.maxRetries;e++)try{const t=await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:Date.now(),method:"tools/call",params:{name:"build_autocomplete_index",arguments:{}}}),signal:AbortSignal.timeout(1e4)});if(t.ok){const n=await t.json();if(console.log(`MCP build index response (attempt ${e+1}):`,n),n.result&&!n.result.is_error)return this.autocompleteIndexBuilt=!0,this.connectionRetries=0,console.log("MCP autocomplete index built successfully"),!0}else if(t.status>=500&&e<this.maxRetries){console.warn(`MCP server error ${t.status}, retrying in ${this.retryDelay}ms...`),await new Promise(n=>setTimeout(n,this.retryDelay*(e+1)));continue}console.warn(`MCP build index failed (attempt ${e+1}):`,t.status,t.statusText)}catch(t){t instanceof Error&&t.name==="AbortError"?console.warn(`MCP request timeout (attempt ${e+1})`):console.warn(`MCP connection error (attempt ${e+1}):`,t),e<this.maxRetries&&await new Promise(n=>setTimeout(n,this.retryDelay*(e+1)))}return console.error("Failed to build MCP autocomplete index after all retries"),!1}async getCompletion(e){if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return{text:""};try{const t=this.extractLastWord(e.prompt);if(!t||t.length<1)return{text:""};const n=await this.getSuggestionsWithSnippets(t,5);if(n.length===0)return{text:""};let a=n[0].text;a.toLowerCase().startsWith(t.toLowerCase())&&(a=a.substring(t.length));const s=e.prompt.length/4,u=a.length/4;return{text:a,usage:{promptTokens:Math.round(s),completionTokens:Math.round(u),totalTokens:Math.round(s+u)}}}catch(t){return console.error("Error getting Novel autocomplete completion:",t),{text:""}}}async getSuggestions(e,t=10){if(!e||e.trim().length===0)return[];if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return console.warn("Autocomplete index not built, returning empty suggestions"),[];try{return Jt()?await this.getTauriSuggestions(e,t):await this.getMCPSuggestions(e,t,"autocomplete_terms")}catch(n){return console.error("Error getting autocomplete suggestions:",n),[]}}async getTauriSuggestions(e,t){const n=await je("get_autocomplete_suggestions",{query:e.trim(),role_name:this.currentRole,limit:t});return console.log("Tauri autocomplete response:",n),n&&n.status==="success"&&n.suggestions?n.suggestions.map(o=>({text:o.term||o.text||"",snippet:o.url||o.snippet||"",score:o.score||1})).filter(o=>o.text.length>0):(n&&n.error&&console.error("Tauri autocomplete error:",n.error),[])}async getMCPSuggestions(e,t,n){const o=Date.now(),a=await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:o,method:"tools/call",params:{name:n,arguments:{query:e.trim(),limit:t,role:this.currentRole}}}),signal:AbortSignal.timeout(5e3)});if(!a.ok)return console.error(`MCP ${n} request failed:`,a.status,a.statusText),[];const s=await a.json();return console.log(`MCP ${n} response:`,s),s.result&&!s.result.is_error&&s.result.content?n==="autocomplete_with_snippets"?this.parseAutocompleteWithSnippetsContent(s.result.content):this.parseAutocompleteContent(s.result.content):(s.error&&console.error(`MCP ${n} error:`,s.error),[])}async getSuggestionsWithSnippets(e,t=10){if(!e||e.trim().length===0)return[];if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return console.warn("Autocomplete index not built, returning empty suggestions with snippets"),[];try{return Jt()?await this.getTauriSuggestions(e,t):await this.getMCPSuggestions(e,t,"autocomplete_with_snippets")}catch(n){return console.error("Error getting autocomplete suggestions with snippets:",n),[]}}extractLastWord(e){const t=e.trim().split(/\s+/);return t[t.length-1]||""}parseAutocompleteContent(e){const t=[];for(const n of e)if(n.type==="text"&&n.text){if(!n.text.startsWith("Found")&&!n.text.startsWith("•"))t.push({text:n.text.trim()});else if(n.text.startsWith("•")){const o=n.text.replace("•","").trim();o&&t.push({text:o})}}return t}parseAutocompleteWithSnippetsContent(e){const t=[];for(const n of e)if(n.type==="text"&&n.text){if(!n.text.startsWith("Found")&&!n.text.startsWith("•")){const o=n.text.split(" — ");o.length===2?t.push({text:o[0].trim(),snippet:o[1].trim()}):t.push({text:n.text.trim()})}else if(n.text.startsWith("•")){const o=n.text.replace("•","").trim();o&&t.push({text:o})}}return t}isReady(){return this.autocompleteIndexBuilt}getStatus(){return{ready:this.autocompleteIndexBuilt,baseUrl:this.baseUrl,sessionId:this.sessionId,usingTauri:Jt(),currentRole:this.currentRole,connectionRetries:this.connectionRetries,isConnecting:this.isConnecting}}async refreshIndex(){return this.autocompleteIndexBuilt=!1,this.connectionRetries=0,await this.buildAutocompleteIndex()}async testConnection(){try{if(Jt()){const e=await je("get_autocomplete_suggestions",{query:"test",role_name:this.currentRole,limit:1});return e&&(e.status==="success"||e.status==="error")}else return(await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:Date.now(),method:"tools/list",params:{}}),signal:AbortSignal.timeout(3e3)})).ok}catch(e){return console.warn("Connection test failed:",e),!1}}}const Ot=new ii;function ai(l){var e;const{char:t,allowSpaces:n,allowToIncludeChar:o,allowedPrefixes:a,startOfLine:s,$position:u}=l,i=n&&!o,d=br(t),p=new RegExp(`\\s${d}$`),m=s?"^":"",_=o?"":d,g=i?new RegExp(`${m}${d}.*?(?=\\s${_}|$)`,"gm"):new RegExp(`${m}(?:^)?${d}[^\\s${_}]*`,"gm"),b=((e=u.nodeBefore)===null||e===void 0?void 0:e.isText)&&u.nodeBefore.text;if(!b)return null;const v=u.pos-b.length,w=Array.from(b.matchAll(g)).pop();if(!w||w.input===void 0||w.index===void 0)return null;const $=w.input.slice(Math.max(0,w.index-1),w.index),C=new RegExp(`^[${a==null?void 0:a.join("")}\0]?$`).test($);if(a!==null&&!C)return null;const k=v+w.index;let T=k+w[0].length;return i&&p.test(b.slice(T-1,T+1))&&(w[0]+=" ",T+=1),k<u.pos&&T>=u.pos?{range:{from:k,to:T},query:w[0].slice(t.length),text:w[0]}:null}const ci=new Gs("suggestion");function ui({pluginKey:l=ci,editor:e,char:t="@",allowSpaces:n=!1,allowToIncludeChar:o=!1,allowedPrefixes:a=[" "],startOfLine:s=!1,decorationTag:u="span",decorationClass:i="suggestion",decorationContent:d="",decorationEmptyClass:p="is-empty",command:m=()=>null,items:_=()=>[],render:g=()=>({}),allow:b=()=>!0,findSuggestionMatch:v=ai}){let w;const $=g==null?void 0:g(),C=new gr({key:l,view(){return{update:async(k,T)=>{var F,O,N,E,H,ee,J;const L=(F=this.key)===null||F===void 0?void 0:F.getState(T),D=(O=this.key)===null||O===void 0?void 0:O.getState(k.state),ne=L.active&&D.active&&L.range.from!==D.range.from,W=!L.active&&D.active,oe=L.active&&!D.active,le=!W&&!oe&&L.query!==D.query,z=W||ne&&le,Q=le||ne,I=oe||ne&&le;if(!z&&!Q&&!I)return;const U=I&&!z?L:D,y=k.dom.querySelector(`[data-decoration-id="${U.decorationId}"]`);w={editor:e,range:U.range,query:U.query,text:U.text,items:[],command:A=>m({editor:e,range:U.range,props:A}),decorationNode:y,clientRect:y?()=>{var A;const{decorationId:M}=(A=this.key)===null||A===void 0?void 0:A.getState(e.state),Z=k.dom.querySelector(`[data-decoration-id="${M}"]`);return(Z==null?void 0:Z.getBoundingClientRect())||null}:null},z&&((N=$==null?void 0:$.onBeforeStart)===null||N===void 0||N.call($,w)),Q&&((E=$==null?void 0:$.onBeforeUpdate)===null||E===void 0||E.call($,w)),(Q||z)&&(w.items=await _({editor:e,query:U.query})),I&&((H=$==null?void 0:$.onExit)===null||H===void 0||H.call($,w)),Q&&((ee=$==null?void 0:$.onUpdate)===null||ee===void 0||ee.call($,w)),z&&((J=$==null?void 0:$.onStart)===null||J===void 0||J.call($,w))},destroy:()=>{var k;w&&((k=$==null?void 0:$.onExit)===null||k===void 0||k.call($,w))}}},state:{init(){return{active:!1,range:{from:0,to:0},query:null,text:null,composing:!1}},apply(k,T,F,O){const{isEditable:N}=e,{composing:E}=e.view,{selection:H}=k,{empty:ee,from:J}=H,L={...T};if(L.composing=E,N&&(ee||e.view.composing)){(J<T.range.from||J>T.range.to)&&!E&&!T.composing&&(L.active=!1);const D=v({char:t,allowSpaces:n,allowToIncludeChar:o,allowedPrefixes:a,startOfLine:s,$position:H.$from}),ne=`id_${Math.floor(Math.random()*4294967295)}`;D&&b({editor:e,state:O,range:D.range,isActive:T.active})?(L.active=!0,L.decorationId=T.decorationId?T.decorationId:ne,L.range=D.range,L.query=D.query,L.text=D.text):L.active=!1}else L.active=!1;return L.active||(L.decorationId=null,L.range={from:0,to:0},L.query=null,L.text=null),L}},props:{handleKeyDown(k,T){var F;const{active:O,range:N}=C.getState(k.state);return O&&((F=$==null?void 0:$.onKeyDown)===null||F===void 0?void 0:F.call($,{view:k,event:T,range:N}))||!1},decorations(k){const{active:T,range:F,decorationId:O,query:N}=C.getState(k);if(!T)return null;const E=!(N!=null&&N.length),H=[i];return E&&H.push(p),hr.create(k.doc,[vr.inline(F.from,F.to,{nodeName:u,class:H.join(" "),"data-decoration-id":O,"data-decoration-content":d})])}}});return C}const An=kr.create({name:"terraphimSuggestion",addOptions(){return{trigger:"++",pluginKey:new Gs("terraphimSuggestion"),allowSpaces:!1,limit:8,minLength:1,debounce:300}},addCommands(){return{insertSuggestion:l=>({commands:e,chain:t})=>t().insertContent(l.text).run()}},addProseMirrorPlugins(){const l={editor:this.editor,char:this.options.trigger,pluginKey:this.options.pluginKey,allowSpaces:this.options.allowSpaces,startOfLine:!1,command:({editor:e,range:t,props:n})=>{const o=n;e.chain().focus().insertContentAt(t,o.text+" ").run()},items:async({query:e,editor:t})=>new Promise(n=>{setTimeout(async()=>{if(e.length<this.options.minLength){n([]);return}try{const o=await Ot.getSuggestionsWithSnippets(e,this.options.limit);console.log(`TerraphimSuggestion: Found ${o.length} suggestions for "${e}"`),n(o)}catch(o){console.error("TerraphimSuggestion: Error getting suggestions:",o),n([])}},this.options.debounce)}),render:()=>{let e,t;return{onStart:n=>{e=new fi({items:n.items,command:n.command}),n.clientRect&&(t=Tr("body",{getReferenceClientRect:n.clientRect,appendTo:()=>document.body,content:e.element,showOnCreate:!0,interactive:!0,trigger:"manual",placement:"bottom-start",theme:"terraphim-suggestion",maxWidth:"none"})[0])},onUpdate(n){e==null||e.updateItems(n.items),n.clientRect&&(t==null||t.setProps({getReferenceClientRect:n.clientRect}))},onKeyDown(n){return n.event.key==="Escape"?(t==null||t.hide(),!0):(e==null?void 0:e.onKeyDown(n))??!1},onExit(){t==null||t.destroy(),e==null||e.destroy()}}}};return[ui(l)]}});class fi{constructor(e){Ct(this,"element");Ct(this,"items",[]);Ct(this,"selectedIndex",0);Ct(this,"command");this.items=e.items,this.command=e.command,this.element=document.createElement("div"),this.element.className="terraphim-suggestion-dropdown",this.render()}updateItems(e){this.items=e,this.selectedIndex=0,this.render()}onKeyDown({event:e}){return e.key==="ArrowUp"?(this.selectPrevious(),!0):e.key==="ArrowDown"?(this.selectNext(),!0):e.key==="Enter"||e.key==="Tab"?(this.selectItem(this.selectedIndex),!0):!1}selectPrevious(){this.selectedIndex=Math.max(0,this.selectedIndex-1),this.render()}selectNext(){this.selectedIndex=Math.min(this.items.length-1,this.selectedIndex+1),this.render()}selectItem(e){const t=this.items[e];t&&this.command({id:t.text,...t})}render(){if(this.element.innerHTML="",this.items.length===0){this.element.innerHTML=`
        <div class="terraphim-suggestion-item terraphim-suggestion-empty">
          <div class="terraphim-suggestion-text">No suggestions found</div>
          <div class="terraphim-suggestion-hint">Try a different search term</div>
        </div>
      `;return}const e=document.createElement("div");e.className="terraphim-suggestion-header",e.innerHTML=`
      <div class="terraphim-suggestion-count">${this.items.length} suggestions</div>
      <div class="terraphim-suggestion-hint">↑↓ Navigate • Tab/Enter Select • Esc Cancel</div>
    `,this.element.appendChild(e),this.items.forEach((t,n)=>{const o=document.createElement("div");o.className=`terraphim-suggestion-item ${n===this.selectedIndex?"terraphim-suggestion-selected":""}`,o.innerHTML=`
        <div class="terraphim-suggestion-main">
          <div class="terraphim-suggestion-text">${this.escapeHtml(t.text)}</div>
          ${t.snippet?`<div class="terraphim-suggestion-snippet">${this.escapeHtml(t.snippet)}</div>`:""}
        </div>
        ${t.score?`<div class="terraphim-suggestion-score">${Math.round(t.score*100)}%</div>`:""}
      `,o.addEventListener("click",()=>this.selectItem(n)),o.addEventListener("mouseenter",()=>{this.selectedIndex=n,this.render()}),this.element.appendChild(o)})}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}destroy(){this.element.remove()}}const di=`
.terraphim-suggestion-dropdown {
  background: white;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  box-shadow: 0 10px 38px -10px rgba(22, 23, 24, 0.35), 0 10px 20px -15px rgba(22, 23, 24, 0.2);
  max-height: 300px;
  min-width: 300px;
  overflow-y: auto;
  z-index: 1000;
}

.terraphim-suggestion-header {
  padding: 8px 12px;
  border-bottom: 1px solid #f1f5f9;
  background: #f8fafc;
  font-size: 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.terraphim-suggestion-count {
  font-weight: 600;
  color: #475569;
}

.terraphim-suggestion-hint {
  color: #64748b;
}

.terraphim-suggestion-item {
  padding: 8px 12px;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  border-bottom: 1px solid #f1f5f9;
}

.terraphim-suggestion-item:hover {
  background: #f8fafc;
}

.terraphim-suggestion-selected {
  background: #eff6ff !important;
  border-left: 3px solid #3b82f6;
}

.terraphim-suggestion-empty {
  color: #64748b;
  font-style: italic;
  text-align: center;
  cursor: default;
}

.terraphim-suggestion-main {
  flex: 1;
}

.terraphim-suggestion-text {
  font-weight: 500;
  color: #1e293b;
  margin-bottom: 2px;
}

.terraphim-suggestion-snippet {
  font-size: 12px;
  color: #64748b;
  line-height: 1.3;
}

.terraphim-suggestion-score {
  font-size: 11px;
  color: #10b981;
  font-weight: 600;
  background: #ecfdf5;
  padding: 2px 6px;
  border-radius: 4px;
  margin-left: 8px;
}

/* Dark theme support */
@media (prefers-color-scheme: dark) {
  .terraphim-suggestion-dropdown {
    background: #1e293b;
    border-color: #334155;
  }

  .terraphim-suggestion-header {
    background: #0f172a;
    border-color: #334155;
  }

  .terraphim-suggestion-item:hover {
    background: #334155;
  }

  .terraphim-suggestion-selected {
    background: #1e40af !important;
  }

  .terraphim-suggestion-text {
    color: #f1f5f9;
  }

  .terraphim-suggestion-snippet {
    color: #94a3b8;
  }
}

/* Tippy.js theme */
.tippy-box[data-theme~='terraphim-suggestion'] {
  background: transparent;
  box-shadow: none;
}

.tippy-box[data-theme~='terraphim-suggestion'] > .tippy-backdrop {
  background: transparent;
}

.tippy-box[data-theme~='terraphim-suggestion'] > .tippy-arrow {
  display: none;
}
`;function En(l){let e,t,n,o,a,s,u,i,d,p,m,_,g,b,v,w,$,C,k,T,F,O,N,E,H,ee,J=l[12]?"Tauri (native)":`MCP Server (${Ot.getStatus().baseUrl})`,L,D,ne,W,oe,le,z,Q,I,U,y,A,M,Z,V,X,Y,re,pe,ie,ae=l[6]!==1?"s":"",be,K,x,ce,me,ke,Te,Xe,Be,Ne,Pe,fe,Se,Me,xe,et,ye,ze,Ge=l[3]?"Enabled":"Disabled",qe,Le,De,it,Oe=l[11]&&!l[8]&&Ln(l);function We(q,ue){if(q[8])return gi;if(q[11])return _i}let G=We(l),te=G&&G(l);return{c(){e=f("div"),t=f("div"),n=f("strong"),n.textContent="Local Autocomplete Status:",o=h(),a=f("div"),s=f("button"),u=P("Test"),d=h(),p=f("button"),p.textContent="Rebuild Index",m=h(),_=f("button"),g=P("Demo"),v=h(),w=f("div"),$=P(l[10]),C=h(),Oe&&Oe.c(),k=h(),T=f("div"),F=f("strong"),F.textContent="Configuration:",O=h(),N=f("br"),E=P("• "),H=f("strong"),H.textContent="Backend:",ee=h(),L=P(J),D=h(),ne=f("br"),W=P("• "),oe=f("strong"),oe.textContent="Role:",le=h(),z=P(l[9]),Q=h(),I=f("br"),U=P("• "),y=f("strong"),y.textContent="Trigger:",A=P(' "'),M=P(l[4]),Z=P(`" + text
      `),V=f("br"),X=P("• "),Y=f("strong"),Y.textContent="Min Length:",re=h(),pe=P(l[6]),ie=P(" character"),be=P(ae),K=h(),x=f("br"),ce=P("• "),me=f("strong"),me.textContent="Max Results:",ke=h(),Te=P(l[5]),Xe=h(),Be=f("br"),Ne=P("• "),Pe=f("strong"),Pe.textContent="Debounce:",fe=h(),Se=P(l[7]),Me=P(`ms
      `),xe=f("br"),et=P("• "),ye=f("strong"),ye.textContent="Snippets:",ze=h(),qe=P(Ge),Le=h(),te&&te.c(),we(n,"color","#495057"),we(s,"padding","4px 8px"),we(s,"background","#007bff"),we(s,"color","white"),we(s,"border","none"),we(s,"border-radius","4px"),we(s,"cursor","pointer"),we(s,"font-size","12px"),s.disabled=i=!l[8],we(p,"padding","4px 8px"),we(p,"background","#28a745"),we(p,"color","white"),we(p,"border","none"),we(p,"border-radius","4px"),we(p,"cursor","pointer"),we(p,"font-size","12px"),we(_,"padding","4px 8px"),we(_,"background","#ffc107"),we(_,"color","#212529"),we(_,"border","none"),we(_,"border-radius","4px"),we(_,"cursor","pointer"),we(_,"font-size","12px"),_.disabled=b=!l[8],we(a,"display","flex"),we(a,"gap","8px"),we(t,"display","flex"),we(t,"justify-content","space-between"),we(t,"align-items","center"),we(t,"margin-bottom","8px"),we(w,"font-size","13px"),we(w,"color","#6c757d"),we(w,"margin-bottom","8px"),we(w,"font-family","monospace"),we(T,"font-size","12px"),we(T,"color","#6c757d"),we(e,"margin-top","10px"),we(e,"padding","12px"),we(e,"background","#f8f9fa"),we(e,"border-radius","6px"),we(e,"border","1px solid #e9ecef")},m(q,ue){R(q,e,ue),r(e,t),r(t,n),r(t,o),r(t,a),r(a,s),r(s,u),r(a,d),r(a,p),r(a,m),r(a,_),r(_,g),r(e,v),r(e,w),r(w,$),r(e,C),Oe&&Oe.m(e,null),r(e,k),r(e,T),r(T,F),r(T,O),r(T,N),r(T,E),r(T,H),r(T,ee),r(T,L),r(T,D),r(T,ne),r(T,W),r(T,oe),r(T,le),r(T,z),r(T,Q),r(T,I),r(T,U),r(T,y),r(T,A),r(T,M),r(T,Z),r(T,V),r(T,X),r(T,Y),r(T,re),r(T,pe),r(T,ie),r(T,be),r(T,K),r(T,x),r(T,ce),r(T,me),r(T,ke),r(T,Te),r(T,Xe),r(T,Be),r(T,Ne),r(T,Pe),r(T,fe),r(T,Se),r(T,Me),r(T,xe),r(T,et),r(T,ye),r(T,ze),r(T,qe),r(e,Le),te&&te.m(e,null),De||(it=[se(s,"click",l[14]),se(p,"click",l[15]),se(_,"click",l[16])],De=!0)},p(q,ue){ue&256&&i!==(i=!q[8])&&(s.disabled=i),ue&256&&b!==(b=!q[8])&&(_.disabled=b),ue&1024&&ve($,q[10]),q[11]&&!q[8]?Oe?Oe.p(q,ue):(Oe=Ln(q),Oe.c(),Oe.m(e,k)):Oe&&(Oe.d(1),Oe=null),ue&4096&&J!==(J=q[12]?"Tauri (native)":`MCP Server (${Ot.getStatus().baseUrl})`)&&ve(L,J),ue&512&&ve(z,q[9]),ue&16&&ve(M,q[4]),ue&64&&ve(pe,q[6]),ue&64&&ae!==(ae=q[6]!==1?"s":"")&&ve(be,ae),ue&32&&ve(Te,q[5]),ue&128&&ve(Se,q[7]),ue&8&&Ge!==(Ge=q[3]?"Enabled":"Disabled")&&ve(qe,Ge),G===(G=We(q))&&te?te.p(q,ue):(te&&te.d(1),te=G&&G(q),te&&(te.c(),te.m(e,null)))},d(q){q&&S(e),Oe&&Oe.d(),te&&te.d(),De=!1,Ze(it)}}}function Ln(l){let e,t,n,o;function a(i,d){return i[12]?mi:pi}let s=a(l),u=s(l);return{c(){e=f("div"),t=f("strong"),t.textContent="⚠️ Autocomplete Not Available",n=f("br"),o=h(),u.c(),we(e,"font-size","12px"),we(e,"color","#dc3545"),we(e,"margin-bottom","8px"),we(e,"padding","6px"),we(e,"background","#f8d7da"),we(e,"border-radius","4px")},m(i,d){R(i,e,d),r(e,t),r(e,n),r(e,o),u.m(e,null)},p(i,d){s===(s=a(i))&&u?u.p(i,d):(u.d(1),u=s(i),u&&(u.c(),u.m(e,null)))},d(i){i&&S(e),u.d()}}}function pi(l){let e,t=Ot.getStatus().baseUrl+"",n;return{c(){e=P("MCP server not responding. Ensure the server is running on "),n=P(t)},m(o,a){R(o,e,a),R(o,n,a)},p:Re,d(o){o&&S(e),o&&S(n)}}}function mi(l){let e;return{c(){e=P("Tauri backend connection failed. Ensure the application has proper permissions.")},m(t,n){R(t,e,n)},p:Re,d(t){t&&S(e)}}}function _i(l){let e;return{c(){e=f("div"),e.innerHTML=`<strong>❌ Autocomplete Unavailable</strong> 
        <div style="font-size: 11px; margin-top: 4px; color: #721c24;">Click &quot;Rebuild Index&quot; to retry or check server/backend status.</div>`,we(e,"margin-top","8px"),we(e,"padding","8px"),we(e,"background","#f8d7da"),we(e,"border","1px solid #f5c6cb"),we(e,"border-radius","4px")},m(t,n){R(t,e,n)},p:Re,d(t){t&&S(e)}}}function gi(l){let e,t,n,o,a,s,u,i,d,p,m,_,g,b,v,w,$;return{c(){e=f("div"),t=f("strong"),t.textContent="🎯 Autocomplete Active",n=h(),o=f("div"),a=P("Type "),s=f("code"),u=P(l[4]),i=P(" in the editor above to trigger suggestions."),d=f("br"),p=P(`
          Example: `),m=f("code"),_=P(l[4]),g=P("terraphim"),b=P(" or "),v=f("code"),w=P(l[4]),$=P("graph"),we(o,"font-size","11px"),we(o,"margin-top","4px"),we(o,"color","#0056b3"),we(e,"margin-top","8px"),we(e,"padding","8px"),we(e,"background","#d1edff"),we(e,"border","1px solid #b3d9ff"),we(e,"border-radius","4px")},m(C,k){R(C,e,k),r(e,t),r(e,n),r(e,o),r(o,a),r(o,s),r(s,u),r(o,i),r(o,d),r(o,p),r(o,m),r(m,_),r(m,g),r(o,b),r(o,v),r(v,w),r(v,$)},p(C,k){k&16&&ve(u,C[4]),k&16&&ve(_,C[4]),k&16&&ve(w,C[4])},d(C){C&&S(e)}}}function hi(l){let e,t,n,o;e=new Sr({props:{defaultValue:l[0],isEditable:!l[1],disableLocalStorage:!0,onUpdate:l[13],extensions:[yn,...l[2]?[An.configure({trigger:l[4],allowSpaces:!1,limit:l[5],minLength:l[6],debounce:l[7]})]:[]]}});let a=l[2]&&En(l);return{c(){_e(e.$$.fragment),t=h(),a&&a.c(),n=ut()},m(s,u){ge(e,s,u),R(s,t,u),a&&a.m(s,u),R(s,n,u),o=!0},p(s,[u]){const i={};u&1&&(i.defaultValue=s[0]),u&2&&(i.isEditable=!s[1]),u&244&&(i.extensions=[yn,...s[2]?[An.configure({trigger:s[4],allowSpaces:!1,limit:s[5],minLength:s[6],debounce:s[7]})]:[]]),e.$set(i),s[2]?a?a.p(s,u):(a=En(s),a.c(),a.m(n.parentNode,n)):a&&(a.d(1),a=null)},i(s){o||(j(e.$$.fragment,s),o=!0)},o(s){B(e.$$.fragment,s),o=!1},d(s){he(e,s),s&&S(t),a&&a.d(s),s&&S(n)}}}function vi(l,e,t){let n,o;Ue(l,At,E=>t(9,n=E)),Ue(l,ct,E=>t(12,o=E));let{html:a=""}=e,{readOnly:s=!1}=e,{outputFormat:u="html"}=e,{enableAutocomplete:i=!0}=e,{showSnippets:d=!0}=e,{suggestionTrigger:p="++"}=e,{maxSuggestions:m=8}=e,{minQueryLength:_=1}=e,{debounceDelay:g=300}=e,b=null,v="⏳ Initializing...",w=!1,$=!1,C=null;tl(async()=>{i&&await k(),typeof document<"u"&&(C=document.createElement("style"),C.textContent=di,document.head.appendChild(C))}),Wl(()=>{C&&C.parentNode&&C.parentNode.removeChild(C)});async function k(){t(10,v="⏳ Initializing autocomplete..."),t(8,w=!1),t(11,$=!1);try{Ot.setRole(n),t(10,v="🔗 Testing connection...");const E=await Ot.testConnection();t(11,$=!0),E?(t(10,v="🔨 Building autocomplete index..."),await Ot.buildAutocompleteIndex()?(o?t(10,v="✅ Ready - Using Tauri backend"):t(10,v="✅ Ready - Using MCP server backend"),t(8,w=!0)):t(10,v="❌ Failed to build autocomplete index")):o?t(10,v="❌ Tauri backend not available"):t(10,v="❌ MCP server not responding")}catch(E){console.error("Error initializing autocomplete:",E),t(10,v="❌ Autocomplete initialization error")}}const T=E=>{b=E,u==="markdown"?t(0,a=E.storage.markdown.getMarkdown()):t(0,a=E.getHTML())},F=async()=>{if(!$){alert("Please wait for connection test to complete");return}if(!w){alert("Autocomplete service not ready. Check the status above.");return}try{t(10,v="🧪 Testing autocomplete...");const E="terraphim",H=await Ot.getSuggestions(E,5);if(console.log("Autocomplete test results:",H),H.length>0){const ee=H.map((J,L)=>`${L+1}. ${J.text}${J.snippet?` (${J.snippet})`:""}`).join(`
`);alert(`✅ Found ${H.length} suggestions for '${E}':

${ee}`),o?t(10,v="✅ Ready - Using Tauri backend"):t(10,v="✅ Ready - Using MCP server backend")}else alert(`⚠️ No suggestions found for '${E}'. This might be normal if the term isn't in your knowledge graph.`)}catch(E){console.error("Autocomplete test failed:",E),alert(`❌ Autocomplete test failed: ${E.message}`),t(10,v="❌ Test failed - check console for details")}},O=async()=>{t(10,v="⏳ Rebuilding index..."),t(8,w=!1);try{await Ot.refreshIndex()?(o?t(10,v="✅ Ready - Tauri index rebuilt successfully"):t(10,v="✅ Ready - MCP server index rebuilt successfully"),t(8,w=!0)):t(10,v="❌ Failed to rebuild index")}catch(E){console.error("Error rebuilding index:",E),t(10,v="❌ Index rebuild failed - check console for details")}},N=()=>{if(!b){alert("Editor not ready yet");return}const E=`# Terraphim Autocomplete Demo

This is a demonstration of the integrated Terraphim autocomplete system.

## How to Use:
1. Type "${p}" to trigger autocomplete
2. Start typing any term (e.g., "${p}terraphim", "${p}graph")
3. Use ↑↓ arrows to navigate suggestions
4. Press Tab or Enter to select
5. Press Esc to cancel

## Try these queries:
- ${p}terraphim
- ${p}graph
- ${p}service
- ${p}automata
- ${p}role

The autocomplete system uses your local knowledge graph to provide intelligent suggestions based on your selected role: **${n}**.

---

Start typing below:`;b.commands.setContent(E),setTimeout(()=>{b.commands.focus("end")},100),alert(`Demo content inserted!

Type "${p}" followed by any term to see autocomplete suggestions.

Example: "${p}terraphim"`)};return l.$$set=E=>{"html"in E&&t(0,a=E.html),"readOnly"in E&&t(1,s=E.readOnly),"outputFormat"in E&&t(17,u=E.outputFormat),"enableAutocomplete"in E&&t(2,i=E.enableAutocomplete),"showSnippets"in E&&t(3,d=E.showSnippets),"suggestionTrigger"in E&&t(4,p=E.suggestionTrigger),"maxSuggestions"in E&&t(5,m=E.maxSuggestions),"minQueryLength"in E&&t(6,_=E.minQueryLength),"debounceDelay"in E&&t(7,g=E.debounceDelay)},l.$$.update=()=>{l.$$.dirty&772&&n&&i&&w&&(Ot.setRole(n),k())},[a,s,i,d,p,m,_,g,w,n,v,$,o,T,F,O,N,u]}class bi extends _t{constructor(e){super(),gt(this,e,vi,hi,pt,{html:0,readOnly:1,outputFormat:17,enableAutocomplete:2,showSnippets:3,suggestionTrigger:4,maxSuggestions:5,minQueryLength:6,debounceDelay:7})}}function Dn(l){let e,t,n,o,a,s,u,i,d,p,m;return{c(){e=f("div"),t=f("h3"),n=f("span"),n.textContent="Knowledge Graph",o=P(`
          Term: `),a=f("strong"),s=P(l[2]),u=P(" | Rank: "),i=f("strong"),d=P(l[3]),p=h(),m=f("hr"),c(n,"class","tag is-info svelte-329px1"),c(t,"class","subtitle is-6 svelte-329px1"),c(m,"class","svelte-329px1"),c(e,"class","kg-context svelte-329px1")},m(_,g){R(_,e,g),r(e,t),r(t,n),r(t,o),r(t,a),r(a,s),r(t,u),r(t,i),r(i,d),r(e,p),r(e,m)},p(_,g){g&4&&ve(s,_[2]),g&8&&ve(d,_[3])},d(_){_&&S(e)}}}function ki(l){let e,t,n,o,a,s,u,i;const d=[$i,yi],p=[];function m(_,g){return _[5]?0:1}return t=m(l),n=p[t]=d[t](l),{c(){e=f("div"),n.c(),o=h(),a=f("div"),a.innerHTML='<span class="hint-text svelte-329px1">Double-click to edit • Ctrl+E to edit • Ctrl+S to save • Click KG links to explore</span>',c(a,"class","edit-hint svelte-329px1"),c(e,"class","content-viewer svelte-329px1"),c(e,"tabindex","0"),c(e,"role","button"),c(e,"aria-label","Double-click to edit article content")},m(_,g){R(_,e,g),p[t].m(e,null),r(e,o),r(e,a),l[20](e),s=!0,u||(i=[se(e,"dblclick",l[14]),se(e,"keydown",l[15]),se(e,"click",l[13])],u=!0)},p(_,g){let b=t;t=m(_),t===b?p[t].p(_,g):(Fe(),B(p[b],1,1,()=>{p[b]=null}),Ke(),n=p[t],n?n.p(_,g):(n=p[t]=d[t](_),n.c()),j(n,1),n.m(e,o))},i(_){s||(j(n),s=!0)},o(_){B(n),s=!1},d(_){_&&S(e),p[t].d(),l[20](null),u=!1,Ze(i)}}}function wi(l){let e,t,n,o,a,s,u,i,d,p;function m(g){l[18](g)}let _={outputFormat:l[11]};return l[1].body!==void 0&&(_.html=l[1].body),e=new bi({props:_}),lt.push(()=>st(e,"html",m)),{c(){_e(e.$$.fragment),n=h(),o=f("div"),a=f("button"),a.textContent="Save",s=h(),u=f("button"),u.textContent="Cancel",c(a,"class","button is-primary"),c(u,"class","button is-light"),c(o,"class","edit-controls svelte-329px1")},m(g,b){ge(e,g,b),R(g,n,b),R(g,o,b),r(o,a),r(o,s),r(o,u),i=!0,d||(p=[se(a,"click",l[12]),se(u,"click",l[19])],d=!0)},p(g,b){const v={};b&2048&&(v.outputFormat=g[11]),!t&&b&2&&(t=!0,v.html=g[1].body,rt(()=>t=!1)),e.$set(v)},i(g){i||(j(e.$$.fragment,g),i=!0)},o(g){B(e.$$.fragment,g),i=!1},d(g){he(e,g),g&&S(n),g&&S(o),d=!1,Ze(p)}}}function yi(l){let e,t,n;return t=new Ul({props:{source:l[1].body}}),{c(){e=f("div"),_e(t.$$.fragment),c(e,"class","markdown-content svelte-329px1")},m(o,a){R(o,e,a),ge(t,e,null),n=!0},p(o,a){const s={};a&2&&(s.source=o[1].body),t.$set(s)},i(o){n||(j(t.$$.fragment,o),n=!0)},o(o){B(t.$$.fragment,o),n=!1},d(o){o&&S(e),he(t)}}}function $i(l){let e,t=l[1].body+"";return{c(){e=f("div"),c(e,"class","prose svelte-329px1")},m(n,o){R(n,e,o),e.innerHTML=t},p(n,o){o&2&&t!==(t=n[1].body+"")&&(e.innerHTML=t)},i:Re,o:Re,d(n){n&&S(e)}}}function Ci(l){let e,t,n,o,a,s=l[1].title+"",u,i,d,p,m,_,g,b=l[2]&&l[3]!==null&&Dn(l);const v=[wi,ki],w=[];function $(C,k){return C[4]?0:1}return d=$(l),p=w[d]=v[d](l),{c(){e=f("div"),t=f("button"),n=h(),b&&b.c(),o=h(),a=f("h2"),u=P(s),i=h(),p.c(),c(t,"class","delete is-large modal-close-btn svelte-329px1"),c(t,"aria-label","close"),c(a,"class","svelte-329px1"),c(e,"class","box wrapper svelte-329px1")},m(C,k){R(C,e,k),r(e,t),r(e,n),b&&b.m(e,null),r(e,o),r(e,a),r(a,u),r(e,i),w[d].m(e,null),m=!0,_||(g=se(t,"click",l[17]),_=!0)},p(C,k){C[2]&&C[3]!==null?b?b.p(C,k):(b=Dn(C),b.c(),b.m(e,o)):b&&(b.d(1),b=null),(!m||k&2)&&s!==(s=C[1].title+"")&&ve(u,s);let T=d;d=$(C),d===T?w[d].p(C,k):(Fe(),B(w[T],1,1,()=>{w[T]=null}),Ke(),p=w[d],p?p.p(C,k):(p=w[d]=v[d](C),p.c()),j(p,1),p.m(e,null))},i(C){m||(j(p),m=!0)},o(C){B(p),m=!1},d(C){C&&S(e),b&&b.d(),w[d].d(),_=!1,g()}}}function In(l){let e,t,n;function o(s){l[23](s)}let a={$$slots:{default:[Ri]},$$scope:{ctx:l}};return l[7]!==void 0&&(a.active=l[7]),e=new kl({props:a}),lt.push(()=>st(e,"active",o)),{c(){_e(e.$$.fragment)},m(s,u){ge(e,s,u),n=!0},p(s,u){const i={};u&536872832&&(i.$$scope={dirty:u,ctx:s}),!t&&u&128&&(t=!0,i.active=s[7],rt(()=>t=!1)),e.$set(i)},i(s){n||(j(e.$$.fragment,s),n=!0)},o(s){B(e.$$.fragment,s),n=!1},d(s){he(e,s)}}}function Nn(l){let e,t,n,o,a,s,u,i,d,p,m;return{c(){e=f("div"),t=f("h3"),n=f("span"),n.textContent="Knowledge Graph",o=P(`
            Term: `),a=f("strong"),s=P(l[9]),u=P(" | Rank: "),i=f("strong"),d=P(l[10]),p=h(),m=f("hr"),c(n,"class","tag is-info svelte-329px1"),c(t,"class","subtitle is-6 svelte-329px1"),c(m,"class","svelte-329px1"),c(e,"class","kg-context svelte-329px1")},m(_,g){R(_,e,g),r(e,t),r(t,n),r(t,o),r(t,a),r(a,s),r(t,u),r(t,i),r(i,d),r(e,p),r(e,m)},p(_,g){g&512&&ve(s,_[9]),g&1024&&ve(d,_[10])},d(_){_&&S(e)}}}function Ti(l){let e,t,n;return t=new Ul({props:{source:l[8].body}}),{c(){e=f("div"),_e(t.$$.fragment),c(e,"class","markdown-content svelte-329px1")},m(o,a){R(o,e,a),ge(t,e,null),n=!0},p(o,a){const s={};a&256&&(s.source=o[8].body),t.$set(s)},i(o){n||(j(t.$$.fragment,o),n=!0)},o(o){B(t.$$.fragment,o),n=!1},d(o){o&&S(e),he(t)}}}function Si(l){let e,t=l[8].body+"";return{c(){e=f("div"),c(e,"class","prose svelte-329px1")},m(n,o){R(n,e,o),e.innerHTML=t},p(n,o){o&256&&t!==(t=n[8].body+"")&&(e.innerHTML=t)},i:Re,o:Re,d(n){n&&S(e)}}}function Ri(l){let e,t,n,o,a,s=l[8].title+"",u,i,d,p,m,_,g,b,v,w,$,C=l[9]&&l[10]!==null&&Nn(l);const k=[Si,Ti],T=[];function F(O,N){return N&256&&(p=null),p==null&&(p=!!(O[8].body&&(/<html/i.test(O[8].body)||/<body/i.test(O[8].body)||/<head/i.test(O[8].body)))),p?0:1}return m=F(l,-1),_=T[m]=k[m](l),{c(){e=f("div"),t=f("button"),n=h(),C&&C.c(),o=h(),a=f("h2"),u=P(s),i=h(),d=f("div"),_.c(),g=h(),b=f("div"),b.innerHTML='<span class="hint-text svelte-329px1">Knowledge Graph document • Click KG links to explore further</span>',c(t,"class","delete is-large modal-close-btn svelte-329px1"),c(t,"aria-label","close"),c(a,"class","svelte-329px1"),c(b,"class","edit-hint svelte-329px1"),c(d,"class","content-viewer svelte-329px1"),c(d,"tabindex","0"),c(d,"role","button"),c(d,"aria-label","KG document content - click KG links to explore further"),c(e,"class","box wrapper svelte-329px1")},m(O,N){R(O,e,N),r(e,t),r(e,n),C&&C.m(e,null),r(e,o),r(e,a),r(a,u),r(e,i),r(e,d),T[m].m(d,null),r(d,g),r(d,b),v=!0,w||($=[se(t,"click",l[22]),se(d,"click",l[13])],w=!0)},p(O,N){O[9]&&O[10]!==null?C?C.p(O,N):(C=Nn(O),C.c(),C.m(e,o)):C&&(C.d(1),C=null),(!v||N&256)&&s!==(s=O[8].title+"")&&ve(u,s);let E=m;m=F(O,N),m===E?T[m].p(O,N):(Fe(),B(T[E],1,1,()=>{T[E]=null}),Ke(),_=T[m],_?_.p(O,N):(_=T[m]=k[m](O),_.c()),j(_,1),_.m(d,g))},i(O){v||(j(_),v=!0)},o(O){B(_),v=!1},d(O){O&&S(e),C&&C.d(),T[m].d(),w=!1,Ze($)}}}function Ai(l){let e,t,n,o,a;function s(d){l[21](d)}let u={$$slots:{default:[Ci]},$$scope:{ctx:l}};l[0]!==void 0&&(u.active=l[0]),e=new kl({props:u}),lt.push(()=>st(e,"active",s));let i=l[8]&&In(l);return{c(){_e(e.$$.fragment),n=h(),i&&i.c(),o=ut()},m(d,p){ge(e,d,p),R(d,n,p),i&&i.m(d,p),R(d,o,p),a=!0},p(d,[p]){const m={};p&536873087&&(m.$$scope={dirty:p,ctx:d}),!t&&p&1&&(t=!0,m.active=d[0],rt(()=>t=!1)),e.$set(m),d[8]?i?(i.p(d,p),p&256&&j(i,1)):(i=In(d),i.c(),j(i,1),i.m(o.parentNode,o)):i&&(Fe(),B(i,1,1,()=>{i=null}),Ke())},i(d){a||(j(e.$$.fragment,d),j(i),a=!0)},o(d){B(e.$$.fragment,d),B(i),a=!1},d(d){he(e,d),d&&S(n),i&&i.d(d),d&&S(o)}}}function Ei(l,e,t){let n,o,a,s;Ue(l,ct,W=>t(25,a=W)),Ue(l,At,W=>t(26,s=W));let{active:u=!1}=e,{item:i}=e,{initialEdit:d=!1}=e,{kgTerm:p=null}=e,{kgRank:m=null}=e,_=!1,g,b=!1,v=null,w=null,$=null;async function C(){if(a)try{const W=await je("get_document",{documentId:i.id});W!=null&&W.document&&t(1,i=W.document)}catch(W){console.error("Failed to load document",W)}}async function k(){if(!a){t(4,_=!1);return}try{await je("create_document",{document:i}),t(4,_=!1)}catch(W){console.error("Failed to save document",W)}}async function T(W){var oe,le,z,Q,I;t(9,w=W),console.log("🔍 KG Link Click Debug Info:"),console.log("  Term clicked:",W),console.log("  Current role:",s),console.log("  Is Tauri mode:",a);try{if(a){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:s,term:W});const U=await je("find_documents_for_kg_term",{roleName:s,term:W});console.log("  📥 Tauri response received:"),console.log("    Status:",U.status),console.log("    Results count:",((oe=U.results)==null?void 0:oe.length)||0),console.log("    Total:",U.total||0),console.log("    Full response:",JSON.stringify(U,null,2)),U.status==="success"&&U.results&&U.results.length>0?(t(8,v=U.results[0]),t(10,$=v.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",v.title),console.log("    Rank:",$),console.log("    Body length:",((le=v.body)==null?void 0:le.length)||0,"characters"),t(7,b=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${W}" in role: "${s}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const U=Ve.ServerURL,y=encodeURIComponent(s),A=encodeURIComponent(W),M=`${U}/roles/${y}/kg_search?term=${A}`;console.log("  📤 HTTP Request details:"),console.log("    Base URL:",U),console.log("    Role (encoded):",y),console.log("    Term (encoded):",A),console.log("    Full URL:",M);const Z=await fetch(M);if(console.log("  📥 HTTP Response received:"),console.log("    Status code:",Z.status),console.log("    Status text:",Z.statusText),console.log("    Headers:",Object.fromEntries(Z.headers.entries())),!Z.ok)throw new Error(`HTTP error! Status: ${Z.status} - ${Z.statusText}`);const V=await Z.json();console.log("  📄 Response data:"),console.log("    Status:",V.status),console.log("    Results count:",((z=V.results)==null?void 0:z.length)||0),console.log("    Total:",V.total||0),console.log("    Full response:",JSON.stringify(V,null,2)),V.status==="success"&&V.results&&V.results.length>0?(t(8,v=V.results[0]),t(10,$=v.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",v.title),console.log("    Rank:",$),console.log("    Body length:",((Q=v.body)==null?void 0:Q.length)||0,"characters"),t(7,b=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${W}" in role: "${s}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",M))}}catch(U){console.error("❌ Error fetching KG document:"),console.error("  Error type:",U.constructor.name),console.error("  Error message:",U.message||U),console.error("  Request details:",{term:W,role:s,isTauri:a,timestamp:new Date().toISOString()}),!a&&((I=U.message)!=null&&I.includes("Failed to fetch"))&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{}}function F(W){const oe=W.target;if(oe.tagName==="A"){const le=oe.getAttribute("href");if(le&&le.startsWith("kg:")){W.preventDefault();const z=le.substring(3);T(z)}}}function O(){t(4,_=!0)}function N(W){W.type!=="dblclick"&&((W.ctrlKey||W.metaKey)&&W.key==="e"&&(W.preventDefault(),t(4,_=!0)),_&&(W.ctrlKey||W.metaKey)&&W.key==="s"&&(W.preventDefault(),k()),W.key==="Escape"&&(W.preventDefault(),_?t(4,_=!1):t(0,u=!1)))}const E=()=>t(0,u=!1);function H(W){l.$$.not_equal(i.body,W)&&(i.body=W,t(1,i))}const ee=()=>t(4,_=!1);function J(W){lt[W?"unshift":"push"](()=>{g=W,t(6,g)})}function L(W){u=W,t(0,u)}const D=()=>t(7,b=!1);function ne(W){b=W,t(7,b)}return l.$$set=W=>{"active"in W&&t(0,u=W.active),"item"in W&&t(1,i=W.item),"initialEdit"in W&&t(16,d=W.initialEdit),"kgTerm"in W&&t(2,p=W.kgTerm),"kgRank"in W&&t(3,m=W.kgRank)},l.$$.update=()=>{l.$$.dirty&65537&&u&&d&&t(4,_=!0),l.$$.dirty&19&&u&&i&&!_&&C(),l.$$.dirty&2&&t(5,n=i!=null&&i.body?/<html/i.test(i.body)||/<body/i.test(i.body)||/<head/i.test(i.body)||/^\s*<(!DOCTYPE|html|head|body|div|p|span)/i.test(i.body.trim()):!1),l.$$.dirty&32&&t(11,o=n?"html":"markdown")},[u,i,p,m,_,n,g,b,v,w,$,o,k,F,O,N,d,E,H,ee,J,L,D,ne]}class Yl extends _t{constructor(e){super(),gt(this,e,Ei,Ai,pt,{active:0,item:1,initialEdit:16,kgTerm:2,kgRank:3})}}function On(l,e,t){const n=l.slice();return n[33]=e[t],n}function Pn(l,e,t){const n=l.slice();return n[36]=e[t],n}function Mn(l,e,t){const n=l.slice();return n[39]=e[t],n}function jn(l){let e,t;return e=new Bl({props:{type:"is-success",$$slots:{default:[Li]},$$scope:{ctx:l}}}),{c(){_e(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function Li(l){let e,t,n;return{c(){e=f("p"),e.innerHTML="<strong>Success!</strong> Article saved to atomic server successfully.",t=h(),n=f("p"),n.textContent="The modal will close automatically..."},m(o,a){R(o,e,a),R(o,t,a),R(o,n,a)},p:Re,d(o){o&&S(e),o&&S(t),o&&S(n)}}}function Un(l){let e,t;return e=new Bl({props:{type:"is-danger",$$slots:{default:[Di]},$$scope:{ctx:l}}}),{c(){_e(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},p(n,o){const a={};o[0]&8|o[1]&2048&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function Di(l){let e,t,n,o;return{c(){e=f("p"),t=f("strong"),t.textContent="Error:",n=h(),o=P(l[3])},m(a,s){R(a,e,s),r(e,t),r(e,n),r(e,o)},p(a,s){s[0]&8&&ve(o,a[3])},d(a){a&&S(e)}}}function zn(l){var ne,W,oe,le;let e,t,n,o,a,s=(((ne=l[1])==null?void 0:ne.title)||"Untitled")+"",u,i,d,p,m,_,g=(((W=l[1])==null?void 0:W.rank)||0)+"",b,v,w,$,C,k,T,F,O,N,E=((oe=l[1])==null?void 0:oe.description)&&Hn(l),H=((le=l[1])==null?void 0:le.tags)&&Fn(l);function ee(z,Q){return z[10].length>0?Ni:Ii}let J=ee(l),L=J(l),D=l[10].length>0&&qn(l);return{c(){e=f("div"),t=f("label"),t.textContent="Document to Save",n=h(),o=f("div"),a=f("h5"),u=P(s),i=h(),E&&E.c(),d=h(),p=f("div"),m=f("span"),_=P("Rank: "),b=P(g),v=h(),H&&H.c(),w=h(),$=f("div"),C=f("label"),C.textContent="Atomic Server",k=h(),T=f("div"),L.c(),F=h(),D&&D.c(),O=ut(),c(t,"class","label"),c(a,"class","title is-6"),c(m,"class","tag is-info svelte-48g63o"),c(p,"class","tags svelte-48g63o"),c(o,"class","box document-preview svelte-48g63o"),c(e,"class","field"),c(C,"class","label"),c(C,"for","atomic-server-select"),c(T,"class","control"),c($,"class","field")},m(z,Q){R(z,e,Q),r(e,t),r(e,n),r(e,o),r(o,a),r(a,u),r(o,i),E&&E.m(o,null),r(o,d),r(o,p),r(p,m),r(m,_),r(m,b),r(p,v),H&&H.m(p,null),R(z,w,Q),R(z,$,Q),r($,C),r($,k),r($,T),L.m(T,null),R(z,F,Q),D&&D.m(z,Q),R(z,O,Q),N=!0},p(z,Q){var I,U,y,A;(!N||Q[0]&2)&&s!==(s=(((I=z[1])==null?void 0:I.title)||"Untitled")+"")&&ve(u,s),(U=z[1])!=null&&U.description?E?E.p(z,Q):(E=Hn(z),E.c(),E.m(o,d)):E&&(E.d(1),E=null),(!N||Q[0]&2)&&g!==(g=(((y=z[1])==null?void 0:y.rank)||0)+"")&&ve(b,g),(A=z[1])!=null&&A.tags?H?H.p(z,Q):(H=Fn(z),H.c(),H.m(p,null)):H&&(H.d(1),H=null),J===(J=ee(z))&&L?L.p(z,Q):(L.d(1),L=J(z),L&&(L.c(),L.m(T,null))),z[10].length>0?D?(D.p(z,Q),Q[0]&1024&&j(D,1)):(D=qn(z),D.c(),j(D,1),D.m(O.parentNode,O)):D&&(Fe(),B(D,1,1,()=>{D=null}),Ke())},i(z){N||(j(D),N=!0)},o(z){B(D),N=!1},d(z){z&&S(e),E&&E.d(),H&&H.d(),z&&S(w),z&&S($),L.d(),z&&S(F),D&&D.d(z),z&&S(O)}}}function Hn(l){let e,t=l[1].description+"",n;return{c(){e=f("p"),n=P(t),c(e,"class","content")},m(o,a){R(o,e,a),r(e,n)},p(o,a){a[0]&2&&t!==(t=o[1].description+"")&&ve(n,t)},d(o){o&&S(e)}}}function Fn(l){let e,t=l[1].tags,n=[];for(let o=0;o<t.length;o+=1)n[o]=Kn(Mn(l,t,o));return{c(){for(let o=0;o<n.length;o+=1)n[o].c();e=ut()},m(o,a){for(let s=0;s<n.length;s+=1)n[s]&&n[s].m(o,a);R(o,e,a)},p(o,a){if(a[0]&2){t=o[1].tags;let s;for(s=0;s<t.length;s+=1){const u=Mn(o,t,s);n[s]?n[s].p(u,a):(n[s]=Kn(u),n[s].c(),n[s].m(e.parentNode,e))}for(;s<n.length;s+=1)n[s].d(1);n.length=t.length}},d(o){tt(n,o),o&&S(e)}}}function Kn(l){let e,t=l[39]+"",n;return{c(){e=f("span"),n=P(t),c(e,"class","tag svelte-48g63o")},m(o,a){R(o,e,a),r(e,n)},p(o,a){a[0]&2&&t!==(t=o[39]+"")&&ve(n,t)},d(o){o&&S(e)}}}function Ii(l){let e,t,n,o,a,s,u,i,d;return{c(){e=f("div"),t=f("p"),t.innerHTML="<strong>No atomic servers available</strong>",n=h(),o=f("p"),a=P('Your current role "'),s=P(l[12]),u=P(`" doesn't have any writable atomic server configurations.`),i=h(),d=f("p"),d.textContent="Please configure an atomic server haystack in your role settings.",c(e,"class","notification is-warning")},m(p,m){R(p,e,m),r(e,t),r(e,n),r(e,o),r(o,a),r(o,s),r(o,u),r(e,i),r(e,d)},p(p,m){m[0]&4096&&ve(s,p[12])},d(p){p&&S(e)}}}function Ni(l){let e,t,n,o,a,s,u=l[10],i=[];for(let d=0;d<u.length;d+=1)i[d]=Gn(Pn(l,u,d));return{c(){e=f("div"),t=f("select");for(let d=0;d<i.length;d+=1)i[d].c();n=h(),o=f("p"),o.textContent=`Select the atomic server from your current role configuration.
              🔐 = Authenticated, ⚠️ = Anonymous access`,c(t,"id","atomic-server-select"),t.disabled=l[2],l[11]===void 0&&mt(()=>l[18].call(t)),c(e,"class","select is-fullwidth"),c(o,"class","help svelte-48g63o")},m(d,p){R(d,e,p),r(e,t);for(let m=0;m<i.length;m+=1)i[m]&&i[m].m(t,null);Je(t,l[11],!0),R(d,n,p),R(d,o,p),a||(s=se(t,"change",l[18]),a=!0)},p(d,p){if(p[0]&1024){u=d[10];let m;for(m=0;m<u.length;m+=1){const _=Pn(d,u,m);i[m]?i[m].p(_,p):(i[m]=Gn(_),i[m].c(),i[m].m(t,null))}for(;m<i.length;m+=1)i[m].d(1);i.length=u.length}p[0]&4&&(t.disabled=d[2]),p[0]&3072&&Je(t,d[11])},d(d){d&&S(e),tt(i,d),d&&S(n),d&&S(o),a=!1,s()}}}function Oi(l){let e;return{c(){e=f("span"),e.textContent="⚠️ No Auth",c(e,"class","has-text-warning")},m(t,n){R(t,e,n)},d(t){t&&S(e)}}}function Pi(l){let e;return{c(){e=f("span"),e.textContent="🔐",c(e,"class","has-text-success")},m(t,n){R(t,e,n)},d(t){t&&S(e)}}}function Gn(l){let e,t=l[36].location+"",n,o,a,s;function u(p,m){return p[36].atomic_server_secret?Pi:Oi}let i=u(l),d=i(l);return{c(){e=f("option"),n=P(t),o=h(),d.c(),a=h(),e.__value=s=l[36].location,e.value=e.__value},m(p,m){R(p,e,m),r(e,n),r(e,o),d.m(e,null),r(e,a)},p(p,m){m[0]&1024&&t!==(t=p[36].location+"")&&ve(n,t),i!==(i=u(p))&&(d.d(1),d=i(p),d&&(d.c(),d.m(e,a))),m[0]&1024&&s!==(s=p[36].location)&&(e.__value=s,e.value=e.__value)},d(p){p&&S(e),d.d()}}}function qn(l){var G,te;let e,t,n,o,a,s,u,i,d,p,m,_,g,b,v,w,$,C,k,T,F,O,N,E,H,ee,J,L,D,ne,W,oe,le,z,Q,I,U,y,A,M,Z,V,X,Y=(l[8]||"Untitled")+"",re,pe,ie,ae,be,K=(((te=(G=l[1])==null?void 0:G.body)==null?void 0:te.length)||0)+"",x,ce,me,ke,Te,Xe,Be=l[14]()+"",Ne,Pe,fe,Se,Me,xe=l[15]()+"",et,ye,ze,Ge,qe;function Le(q){l[19](q)}let De={id:"article-title",placeholder:"Enter article title",disabled:l[2],required:!0};l[8]!==void 0&&(De.value=l[8]),a=new Vt({props:De}),lt.push(()=>st(a,"value",Le));const it=[ji,Mi],Oe=[];function We(q,ue){return q[7]?1:0}return ee=We(l),J=Oe[ee]=it[ee](l),W=new Kt({props:{type:"is-primary",loading:l[2],disabled:l[2]||!l[8].trim()||!l[11],$$slots:{default:[Ui]},$$scope:{ctx:l}}}),W.$on("click",l[16]),z=new Kt({props:{type:"is-light",disabled:l[2],$$slots:{default:[zi]},$$scope:{ctx:l}}}),z.$on("click",l[17]),ze=ir(l[22][0]),{c(){e=f("div"),t=f("label"),t.textContent="Article Title",n=h(),o=f("div"),_e(a.$$.fragment),u=h(),i=f("div"),d=f("label"),d.textContent="Description",p=h(),m=f("div"),_=f("textarea"),g=h(),b=f("div"),v=f("label"),v.textContent="Parent Collection",w=h(),$=f("div"),C=f("label"),k=f("input"),T=P(`
              Use predefined collection`),F=h(),O=f("label"),N=f("input"),E=P(`
              Custom parent URL/path`),H=h(),J.c(),L=h(),D=f("div"),ne=f("div"),_e(W.$$.fragment),oe=h(),le=f("div"),_e(z.$$.fragment),Q=h(),I=f("div"),U=f("div"),y=f("p"),y.innerHTML="<strong>What will be saved:</strong>",A=h(),M=f("ul"),Z=f("li"),V=f("strong"),V.textContent="Title:",X=h(),re=P(Y),pe=h(),ie=f("li"),ae=f("strong"),ae.textContent="Body:",be=P(" Original document content ("),x=P(K),ce=P(" characters)"),me=h(),ke=f("li"),Te=f("strong"),Te.textContent="Parent:",Xe=h(),Ne=P(Be),Pe=h(),fe=f("li"),Se=f("strong"),Se.textContent="Subject URL:",Me=h(),et=P(xe),c(t,"class","label"),c(t,"for","article-title"),c(o,"class","control"),c(e,"class","field"),c(d,"class","label"),c(d,"for","article-description"),c(_,"id","article-description"),c(_,"class","textarea"),c(_,"placeholder","Brief description of the article"),_.disabled=l[2],c(_,"rows","3"),c(m,"class","control"),c(i,"class","field"),c(v,"class","label"),c(k,"type","radio"),k.__value=!1,k.value=k.__value,k.disabled=l[2],c(C,"class","radio svelte-48g63o"),c(N,"type","radio"),N.__value=!0,N.value=N.__value,N.disabled=l[2],c(O,"class","radio svelte-48g63o"),c($,"class","control"),c(b,"class","field"),c(ne,"class","control"),c(le,"class","control"),c(D,"class","field is-grouped"),c(Z,"class","svelte-48g63o"),c(ie,"class","svelte-48g63o"),c(ke,"class","svelte-48g63o"),c(fe,"class","svelte-48g63o"),c(M,"class","svelte-48g63o"),c(U,"class","notification is-info is-light svelte-48g63o"),c(I,"class","field"),ze.p(k,N)},m(q,ue){R(q,e,ue),r(e,t),r(e,n),r(e,o),ge(a,o,null),R(q,u,ue),R(q,i,ue),r(i,d),r(i,p),r(i,m),r(m,_),Ie(_,l[9]),R(q,g,ue),R(q,b,ue),r(b,v),r(b,w),r(b,$),r($,C),r(C,k),k.checked=k.__value===l[7],r(C,T),r($,F),r($,O),r(O,N),N.checked=N.__value===l[7],r(O,E),R(q,H,ue),Oe[ee].m(q,ue),R(q,L,ue),R(q,D,ue),r(D,ne),ge(W,ne,null),r(D,oe),r(D,le),ge(z,le,null),R(q,Q,ue),R(q,I,ue),r(I,U),r(U,y),r(U,A),r(U,M),r(M,Z),r(Z,V),r(Z,X),r(Z,re),r(M,pe),r(M,ie),r(ie,ae),r(ie,be),r(ie,x),r(ie,ce),r(M,me),r(M,ke),r(ke,Te),r(ke,Xe),r(ke,Ne),r(M,Pe),r(M,fe),r(fe,Se),r(fe,Me),r(fe,et),ye=!0,Ge||(qe=[se(_,"input",l[20]),se(k,"change",l[21]),se(N,"change",l[23])],Ge=!0)},p(q,ue){var de,Ae;const Ce={};ue[0]&4&&(Ce.disabled=q[2]),!s&&ue[0]&256&&(s=!0,Ce.value=q[8],rt(()=>s=!1)),a.$set(Ce),(!ye||ue[0]&4)&&(_.disabled=q[2]),ue[0]&512&&Ie(_,q[9]),(!ye||ue[0]&4)&&(k.disabled=q[2]),ue[0]&128&&(k.checked=k.__value===q[7]),(!ye||ue[0]&4)&&(N.disabled=q[2]),ue[0]&128&&(N.checked=N.__value===q[7]);let $e=ee;ee=We(q),ee===$e?Oe[ee].p(q,ue):(Fe(),B(Oe[$e],1,1,()=>{Oe[$e]=null}),Ke(),J=Oe[ee],J?J.p(q,ue):(J=Oe[ee]=it[ee](q),J.c()),j(J,1),J.m(L.parentNode,L));const Qe={};ue[0]&4&&(Qe.loading=q[2]),ue[0]&2308&&(Qe.disabled=q[2]||!q[8].trim()||!q[11]),ue[1]&2048&&(Qe.$$scope={dirty:ue,ctx:q}),W.$set(Qe);const nt={};ue[0]&4&&(nt.disabled=q[2]),ue[1]&2048&&(nt.$$scope={dirty:ue,ctx:q}),z.$set(nt),(!ye||ue[0]&256)&&Y!==(Y=(q[8]||"Untitled")+"")&&ve(re,Y),(!ye||ue[0]&2)&&K!==(K=(((Ae=(de=q[1])==null?void 0:de.body)==null?void 0:Ae.length)||0)+"")&&ve(x,K)},i(q){ye||(j(a.$$.fragment,q),j(J),j(W.$$.fragment,q),j(z.$$.fragment,q),ye=!0)},o(q){B(a.$$.fragment,q),B(J),B(W.$$.fragment,q),B(z.$$.fragment,q),ye=!1},d(q){q&&S(e),he(a),q&&S(u),q&&S(i),q&&S(g),q&&S(b),q&&S(H),Oe[ee].d(q),q&&S(L),q&&S(D),he(W),he(z),q&&S(Q),q&&S(I),ze.r(),Ge=!1,Ze(qe)}}}function Mi(l){let e,t,n,o,a,s,u;function i(p){l[25](p)}let d={placeholder:"e.g., my-collection or http://server/custom-parent",disabled:l[2]};return l[6]!==void 0&&(d.value=l[6]),n=new Vt({props:d}),lt.push(()=>st(n,"value",i)),{c(){e=f("div"),t=f("div"),_e(n.$$.fragment),a=h(),s=f("p"),s.textContent=`Enter a collection name (e.g., "my-articles") or full URL.
              If the collection doesn't exist, it will be created.`,c(t,"class","control"),c(s,"class","help svelte-48g63o"),c(e,"class","field")},m(p,m){R(p,e,m),r(e,t),ge(n,t,null),r(e,a),r(e,s),u=!0},p(p,m){const _={};m[0]&4&&(_.disabled=p[2]),!o&&m[0]&64&&(o=!0,_.value=p[6],rt(()=>o=!1)),n.$set(_)},i(p){u||(j(n.$$.fragment,p),u=!0)},o(p){B(n.$$.fragment,p),u=!1},d(p){p&&S(e),he(n)}}}function ji(l){let e,t,n,o,a,s,u=l[13],i=[];for(let d=0;d<u.length;d+=1)i[d]=Wn(On(l,u,d));return{c(){e=f("div"),t=f("div"),n=f("div"),o=f("select");for(let d=0;d<i.length;d+=1)i[d].c();o.disabled=l[2],l[5]===void 0&&mt(()=>l[24].call(o)),c(n,"class","select is-fullwidth"),c(t,"class","control"),c(e,"class","field")},m(d,p){R(d,e,p),r(e,t),r(t,n),r(n,o);for(let m=0;m<i.length;m+=1)i[m]&&i[m].m(o,null);Je(o,l[5],!0),a||(s=se(o,"change",l[24]),a=!0)},p(d,p){if(p[0]&8192){u=d[13];let m;for(m=0;m<u.length;m+=1){const _=On(d,u,m);i[m]?i[m].p(_,p):(i[m]=Wn(_),i[m].c(),i[m].m(o,null))}for(;m<i.length;m+=1)i[m].d(1);i.length=u.length}p[0]&4&&(o.disabled=d[2]),p[0]&8224&&Je(o,d[5])},i:Re,o:Re,d(d){d&&S(e),tt(i,d),a=!1,s()}}}function Wn(l){let e,t=l[33].label+"",n;return{c(){e=f("option"),n=P(t),e.__value=l[33].value,e.value=e.__value},m(o,a){R(o,e,a),r(e,n)},p:Re,d(o){o&&S(e)}}}function Ui(l){let e,t,n;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-cloud-upload-alt"></i>',t=h(),n=f("span"),n.textContent="Save to Atomic Server",c(e,"class","icon")},m(o,a){R(o,e,a),R(o,t,a),R(o,n,a)},p:Re,d(o){o&&S(e),o&&S(t),o&&S(n)}}}function zi(l){let e;return{c(){e=P("Cancel")},m(t,n){R(t,e,n)},d(t){t&&S(e)}}}function Hi(l){let e,t,n,o,a,s,u,i,d,p,m,_,g,b=l[4]&&jn(l),v=l[3]&&Un(l),w=!l[4]&&zn(l);return{c(){e=f("div"),t=f("div"),n=f("div"),n.innerHTML=`<div class="level-item"><h3 class="title is-4"><span class="icon"><i class="fas fa-save"></i></span>
            Save to Atomic Server</h3></div>`,o=h(),a=f("div"),s=f("div"),u=f("button"),i=h(),b&&b.c(),d=h(),v&&v.c(),p=h(),w&&w.c(),c(n,"class","level-left"),c(u,"class","delete is-large"),u.disabled=l[2],c(u,"aria-label","close"),c(s,"class","level-item"),c(a,"class","level-right"),c(t,"class","level svelte-48g63o"),c(e,"class","box")},m($,C){R($,e,C),r(e,t),r(t,n),r(t,o),r(t,a),r(a,s),r(s,u),r(e,i),b&&b.m(e,null),r(e,d),v&&v.m(e,null),r(e,p),w&&w.m(e,null),m=!0,_||(g=se(u,"click",l[17]),_=!0)},p($,C){(!m||C[0]&4)&&(u.disabled=$[2]),$[4]?b?C[0]&16&&j(b,1):(b=jn($),b.c(),j(b,1),b.m(e,d)):b&&(Fe(),B(b,1,1,()=>{b=null}),Ke()),$[3]?v?(v.p($,C),C[0]&8&&j(v,1)):(v=Un($),v.c(),j(v,1),v.m(e,p)):v&&(Fe(),B(v,1,1,()=>{v=null}),Ke()),$[4]?w&&(Fe(),B(w,1,1,()=>{w=null}),Ke()):w?(w.p($,C),C[0]&16&&j(w,1)):(w=zn($),w.c(),j(w,1),w.m(e,null))},i($){m||(j(b),j(v),j(w),m=!0)},o($){B(b),B(v),B(w),m=!1},d($){$&&S(e),b&&b.d(),v&&v.d(),w&&w.d(),_=!1,g()}}}function Fi(l){let e,t,n;function o(s){l[26](s)}let a={$$slots:{default:[Hi]},$$scope:{ctx:l}};return l[0]!==void 0&&(a.active=l[0]),e=new kl({props:a}),lt.push(()=>st(e,"active",o)),e.$on("close",l[17]),{c(){_e(e.$$.fragment)},m(s,u){ge(e,s,u),n=!0},p(s,u){const i={};u[0]&8190|u[1]&2048&&(i.$$scope={dirty:u,ctx:s}),!t&&u[0]&1&&(t=!0,i.active=s[0],rt(()=>t=!1)),e.$set(i)},i(s){n||(j(e.$$.fragment,s),n=!0)},o(s){B(e.$$.fragment,s),n=!1},d(s){he(e,s)}}}function Ki(l,e,t){let n,o,a;Ue(l,ct,I=>t(27,n=I)),Ue(l,Lt,I=>t(28,o=I)),Ue(l,At,I=>t(12,a=I));let{active:s=!1}=e,{document:u}=e,i=!1,d=null,p=!1,m="",_="",g=!1,b="",v="",w=[],$="";const C=[{label:"Root (Server Root)",value:""},{label:"Articles Collection",value:"articles"},{label:"Documents Collection",value:"documents"},{label:"Knowledge Base",value:"knowledge-base"},{label:"Research",value:"research"},{label:"Projects",value:"projects"}];function k(){t(2,i=!1),t(3,d=null),t(4,p=!1),t(5,m=""),t(6,_=""),t(7,g=!1),t(8,b=(u==null?void 0:u.title)||""),t(9,v=(u==null?void 0:u.description)||`Article saved from Terraphim search: ${u==null?void 0:u.title}`),t(10,w=[]),t(11,$="")}function T(){var A;const I=a,U=o;if(!(U!=null&&U.roles)||!I){console.warn("No role configuration found");return}let y=null;try{for(const[M,Z]of Object.entries(U.roles)){const V=Z,X=typeof V.name=="object"?V.name.original:String(V.name);if(M===I||X===I){y=V;break}}}catch(M){console.warn("Error checking role configuration:",M);return}if(!y){console.warn(`Role "${I}" not found in configuration`);return}t(10,w=((A=y.haystacks)==null?void 0:A.filter(M=>M.service==="Atomic"&&M.location&&!M.read_only))||[]),w.length>0&&t(11,$=w[0].location),console.log("Loaded atomic servers:",w)}function F(){const I=w.find(U=>U.location===$);return I==null?void 0:I.atomic_server_secret}function O(){const I=$.replace(/\/$/,"");if(g&&_.trim()){const U=_.trim();return U.startsWith("http://")||U.startsWith("https://")?U:`${I}/${U.replace(/^\//,"")}`}else return m?`${I}/${m}`:I}function N(){return b.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,50)}function E(){const I=$.replace(/\/$/,""),U=N(),y=Date.now();return`${I}/${U}-${y}`}async function H(){if(!$||!b.trim()){t(3,d="Please select an atomic server and provide a title");return}t(2,i=!0),t(3,d=null);try{const I=E(),U=O(),y=F();console.log("🔄 Saving article to atomic server:",{subject:I,parent:U,server:$,hasSecret:!!y});const A={subject:I,title:b.trim(),description:v.trim(),body:u.body,parent:U,shortname:N(),original_id:u.id,original_url:u.url,original_rank:u.rank,tags:u.tags||[]};if(n)await je("save_article_to_atomic",{article:A,serverUrl:$,atomicSecret:y});else{const M=await fetch(`${Ve.ServerURL}/atomic/save`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({article:A,server_url:$,atomic_secret:y})});if(!M.ok){const Z=await M.json().catch(()=>({error:M.statusText}));throw new Error(Z.error||`HTTP ${M.status}: ${M.statusText}`)}}t(4,p=!0),console.log("✅ Article saved successfully to atomic server"),setTimeout(()=>{t(0,s=!1)},2e3)}catch(I){console.error("❌ Failed to save article to atomic server:",I),t(3,d=I.message||"Failed to save article to atomic server")}finally{t(2,i=!1)}}function ee(){i||t(0,s=!1)}const J=[[]];function L(){$=St(this),t(11,$),t(10,w)}function D(I){b=I,t(8,b)}function ne(){v=this.value,t(9,v)}function W(){g=this.__value,t(7,g)}function oe(){g=this.__value,t(7,g)}function le(){m=St(this),t(5,m),t(13,C)}function z(I){_=I,t(6,_)}function Q(I){s=I,t(0,s)}return l.$$set=I=>{"active"in I&&t(0,s=I.active),"document"in I&&t(1,u=I.document)},l.$$.update=()=>{l.$$.dirty[0]&3&&s&&u&&(k(),T())},[s,u,i,d,p,m,_,g,b,v,w,$,a,C,O,E,H,ee,L,D,ne,W,J,oe,le,z,Q]}class Gi extends _t{constructor(e){super(),gt(this,e,Ki,Fi,pt,{active:0,document:1},null,[-1,-1])}}async function Zl(l){return je("tauri",l)}async function qi(l,e){return Zl({__tauriModule:"Event",message:{cmd:"unlisten",event:l,eventId:e}})}async function Wi(l,e,t){return Zl({__tauriModule:"Event",message:{cmd:"listen",event:l,windowLabel:e,handler:Gl(t)}}).then(n=>async()=>qi(l,n))}var Bn;(function(l){l.WINDOW_RESIZED="tauri://resize",l.WINDOW_MOVED="tauri://move",l.WINDOW_CLOSE_REQUESTED="tauri://close-requested",l.WINDOW_CREATED="tauri://window-created",l.WINDOW_DESTROYED="tauri://destroyed",l.WINDOW_FOCUS="tauri://focus",l.WINDOW_BLUR="tauri://blur",l.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",l.WINDOW_THEME_CHANGED="tauri://theme-changed",l.WINDOW_FILE_DROP="tauri://file-drop",l.WINDOW_FILE_DROP_HOVER="tauri://file-drop-hover",l.WINDOW_FILE_DROP_CANCELLED="tauri://file-drop-cancelled",l.MENU="tauri://menu",l.CHECK_UPDATE="tauri://update",l.UPDATE_AVAILABLE="tauri://update-available",l.INSTALL_UPDATE="tauri://update-install",l.STATUS_UPDATE="tauri://update-status",l.DOWNLOAD_PROGRESS="tauri://update-download-progress"})(Bn||(Bn={}));async function Bi(l,e){return Wi(l,null,e)}function Jn(l,e,t){const n=l.slice();return n[9]=e[t],n}function Vn(l){let e,t=l[9].name+"",n,o;return{c(){e=f("option"),n=P(t),e.__value=o=l[9].name,e.value=e.__value},m(a,s){R(a,e,s),r(e,n)},p(a,s){s&1&&t!==(t=a[9].name+"")&&ve(n,t),s&1&&o!==(o=a[9].name)&&(e.__value=o,e.value=e.__value)},d(a){a&&S(e)}}}function Ji(l){let e,t,n,o,a,s,u=l[0],i=[];for(let d=0;d<u.length;d+=1)i[d]=Vn(Jn(l,u,d));return{c(){e=f("div"),t=f("div"),n=f("div"),o=f("select");for(let d=0;d<i.length;d+=1)i[d].c();c(n,"class","select"),c(t,"class","control"),c(e,"class","field is-grouped is-grouped-right")},m(d,p){R(d,e,p),r(e,t),r(t,n),r(n,o);for(let m=0;m<i.length;m+=1)i[m]&&i[m].m(o,null);Je(o,l[1]),a||(s=se(o,"change",l[2]),a=!0)},p(d,[p]){if(p&1){u=d[0];let m;for(m=0;m<u.length;m+=1){const _=Jn(d,u,m);i[m]?i[m].p(_,p):(i[m]=Vn(_),i[m].c(),i[m].m(o,null))}for(;m<i.length;m+=1)i[m].d(1);i.length=u.length}p&3&&Je(o,d[1])},i:Re,o:Re,d(d){d&&S(e),tt(i,d),a=!1,s()}}}function Vi(l,e,t){let n,o,a,s;Ue(l,Lt,_=>t(5,n=_)),Ue(l,ct,_=>t(6,o=_)),Ue(l,$n,_=>t(0,a=_)),Ue(l,At,_=>t(1,s=_));let u="";async function i(){try{ct.set(window.__TAURI__!==void 0),o?(console.log("Loading config from Tauri"),je("get_config").then(_=>{console.log("get_config response",_),_&&_.status==="success"&&d(_.config)}).catch(_=>console.error("Error fetching config in Tauri:",_))):(console.log("Loading config from server"),u=`${Ve.ServerURL}/config/`,fetch(u).then(_=>_.json()).then(_=>{console.log("Config received",_),_&&_.status==="success"&&d(_.config)}).catch(_=>console.error("Error fetching config:",_)))}catch(_){console.error("Unhandled error in loadConfig:",_)}}function d(_){var w;console.log("Updating stores from config:",_);const g={default_role:_.selected_role,..._};Lt.set(g);const b=Object.entries(_.roles).map(([$,C])=>({name:$,...C}));$n.set(b),At.set(_.selected_role);const v=_.roles[_.selected_role];if(console.log("Selected role settings:",v),v){const $=v.theme||"spacelab";console.log("Setting theme to:",$),bl.set($),(w=v.kg)!=null&&w.publish?o?je("publish_thesaurus",{roleName:_.selected_role}).then(C=>{console.log("publish_thesaurus response",C),vl.set(C),Tt.set(!0)}).catch(C=>{console.error("Error publishing thesaurus:",C),Tt.set(!1)}):(console.log("Fetching thesaurus from HTTP endpoint for role",_.selected_role),fetch(`${Ve.ServerURL}/thesaurus/${encodeURIComponent(_.selected_role)}`).then(C=>C.json()).then(C=>{console.log("thesaurus HTTP response",C),C&&C.status==="success"&&C.thesaurus?(vl.set(C.thesaurus),Tt.set(!0)):(console.error("Failed to fetch thesaurus:",C),Tt.set(!1))}).catch(C=>{console.error("Error fetching thesaurus:",C),Tt.set(!1)})):Tt.set(!1)}else console.warn("No role settings found for:",_.selected_role),bl.set("spacelab")}typeof window<"u"&&window.__TAURI__&&Bi("role_changed",_=>{console.log("Role changed event received from backend:",_.payload),d(_.payload)});async function p(){await i()}p(),console.log("Using Terraphim Server URL:",Ve.ServerURL);function m(_){var $,C;const b=_.currentTarget.value;console.log("Role change requested:",b),At.set(b);const v=a.find(k=>k.name===b);if(!v){console.error(`No role settings found for role: ${b}.`);return}const w=v.theme||"spacelab";bl.set(w),console.log(`Theme changed to ${w}`),Lt.update(k=>(k.selected_role=b,k)),o?(je("select_role",{roleName:b}).catch(k=>console.error("Error selecting role:",k)),($=v.kg)!=null&&$.publish?(console.log("Publishing thesaurus for role",b),je("publish_thesaurus",{roleName:b}).then(k=>{vl.set(k),Tt.set(!0)})):Tt.set(!1)):(fetch(`${Ve.ServerURL}/config/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).catch(k=>console.error("Error updating config on server:",k)),(C=v.kg)!=null&&C.publish?(console.log("Fetching thesaurus from HTTP endpoint for role",b),fetch(`${Ve.ServerURL}/thesaurus/${encodeURIComponent(b)}`).then(k=>k.json()).then(k=>{console.log("thesaurus HTTP response",k),k&&k.status==="success"&&k.thesaurus?(vl.set(k.thesaurus),Tt.set(!0)):(console.error("Failed to fetch thesaurus:",k),Tt.set(!1))}).catch(k=>{console.error("Error fetching thesaurus:",k),Tt.set(!1)})):Tt.set(!1))}return[a,s,m,i]}class Ml extends _t{constructor(e){super(),gt(this,e,Vi,Ji,pt,{loadConfig:3})}get loadConfig(){return this.$$.ctx[3]}}function Qn(l,e,t){const n=l.slice();return n[41]=e[t],n}function Yn(l,e,t){const n=l.slice();return n[44]=e[t],n}function Zn(l){let e,t;return e=new Jl({props:{$$slots:{default:[Yi]},$$scope:{ctx:l}}}),{c(){_e(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},p(n,o){const a={};o[0]&129|o[1]&65536&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function Qi(l){let e=l[44]+"",t;return{c(){t=P(e)},m(n,o){R(n,t,o)},p(n,o){o[0]&1&&e!==(e=n[44]+"")&&ve(t,e)},d(n){n&&S(t)}}}function Xn(l){let e,t,n,o,a,s;t=new Gt({props:{rounded:!0,$$slots:{default:[Qi]},$$scope:{ctx:l}}});function u(){return l[19](l[44])}return{c(){e=f("button"),_e(t.$$.fragment),n=h(),c(e,"class","tag-button svelte-2smypa"),e.disabled=l[7],c(e,"title","Click to view knowledge graph document")},m(i,d){R(i,e,d),ge(t,e,null),r(e,n),o=!0,a||(s=se(e,"click",u),a=!0)},p(i,d){l=i;const p={};d[0]&1|d[1]&65536&&(p.$$scope={dirty:d,ctx:l}),t.$set(p),(!o||d[0]&128)&&(e.disabled=l[7])},i(i){o||(j(t.$$.fragment,i),o=!0)},o(i){B(t.$$.fragment,i),o=!1},d(i){i&&S(e),he(t),a=!1,s()}}}function Yi(l){let e,t,n=l[0].tags,o=[];for(let s=0;s<n.length;s+=1)o[s]=Xn(Yn(l,n,s));const a=s=>B(o[s],1,1,()=>{o[s]=null});return{c(){for(let s=0;s<o.length;s+=1)o[s].c();e=ut()},m(s,u){for(let i=0;i<o.length;i+=1)o[i]&&o[i].m(s,u);R(s,e,u),t=!0},p(s,u){if(u[0]&131201){n=s[0].tags;let i;for(i=0;i<n.length;i+=1){const d=Yn(s,n,i);o[i]?(o[i].p(d,u),j(o[i],1)):(o[i]=Xn(d),o[i].c(),j(o[i],1),o[i].m(e.parentNode,e))}for(Fe(),i=n.length;i<o.length;i+=1)a(i);Ke()}},i(s){if(!t){for(let u=0;u<n.length;u+=1)j(o[u]);t=!0}},o(s){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)B(o[u]);t=!1},d(s){tt(o,s),s&&S(e)}}}function Zi(l){let e,t=(l[0].rank||0)+"",n;return{c(){e=P("Rank "),n=P(t)},m(o,a){R(o,e,a),R(o,n,a)},p(o,a){a[0]&1&&t!==(t=(o[0].rank||0)+"")&&ve(n,t)},d(o){o&&S(e),o&&S(n)}}}function Xi(l){let e,t;return e=new Gt({props:{rounded:!0,$$slots:{default:[Zi]},$$scope:{ctx:l}}}),{c(){_e(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},p(n,o){const a={};o[0]&1|o[1]&65536&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function xi(l){let e;return{c(){e=f("small"),e.textContent="No description available",c(e,"class","no-description svelte-2smypa")},m(t,n){R(t,e,n)},p:Re,i:Re,o:Re,d(t){t&&S(e)}}}function ea(l){let e,t;return e=new Ul({props:{source:l[0].description}}),{c(){_e(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},p(n,o){const a={};o[0]&1&&(a.source=n[0].description),e.$set(a)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function xn(l){let e,t,n,o,a,s;return{c(){e=f("button"),t=f("span"),t.innerHTML='<i class="fas fa-magic" aria-hidden="true"></i>',n=h(),o=f("span"),o.textContent="AI Summary",c(t,"class","icon is-small"),c(e,"class","button is-small is-info is-outlined ai-summary-button svelte-2smypa"),e.disabled=l[9],c(e,"title","Generate AI-powered summary using OpenRouter")},m(u,i){R(u,e,i),r(e,t),r(e,n),r(e,o),a||(s=se(e,"click",l[18]),a=!0)},p(u,i){i[0]&512&&(e.disabled=u[9])},d(u){u&&S(e),a=!1,s()}}}function eo(l){let e;return{c(){e=f("div"),e.innerHTML=`<span class="icon"><i class="fas fa-spinner fa-spin" aria-hidden="true"></i></span> 
                <small>Generating AI summary...</small>`,c(e,"class","ai-summary-loading svelte-2smypa")},m(t,n){R(t,e,n)},d(t){t&&S(e)}}}function to(l){let e,t,n,o,a,s,u,i,d,p;return{c(){e=f("div"),t=f("span"),t.innerHTML='<i class="fas fa-exclamation-triangle" aria-hidden="true"></i>',n=h(),o=f("small"),a=P("Summary error: "),s=P(l[10]),u=h(),i=f("button"),i.textContent="Retry",c(t,"class","icon has-text-danger"),c(o,"class","has-text-danger"),c(i,"class","button is-small is-text svelte-2smypa"),c(i,"title","Retry generating summary"),c(e,"class","ai-summary-error svelte-2smypa")},m(m,_){R(m,e,_),r(e,t),r(e,n),r(e,o),r(o,a),r(o,s),r(e,u),r(e,i),d||(p=se(i,"click",l[20]),d=!0)},p(m,_){_[0]&1024&&ve(s,m[10])},d(m){m&&S(e),d=!1,p()}}}function lo(l){let e,t,n,o,a,s,u,i,d,p,m,_,g,b,v,w,$,C,k,T;function F(E,H){return E[12]?la:ta}let O=F(l),N=O(l);return p=new Ul({props:{source:l[8]}}),{c(){e=f("div"),t=f("div"),n=f("small"),o=f("span"),o.innerHTML='<i class="fas fa-robot" aria-hidden="true"></i>',a=P(`
                    AI Summary
                    `),N.c(),s=h(),u=f("button"),u.innerHTML='<span class="icon is-small"><i class="fas fa-times" aria-hidden="true"></i></span>',i=h(),d=f("div"),_e(p.$$.fragment),m=h(),_=f("div"),g=f("button"),b=f("span"),b.innerHTML='<i class="fas fa-redo" aria-hidden="true"></i>',v=h(),w=f("span"),w.textContent="Regenerate",c(o,"class","icon is-small"),c(n,"class","ai-summary-label svelte-2smypa"),c(u,"class","button is-small is-text svelte-2smypa"),c(u,"title","Hide AI summary"),c(t,"class","ai-summary-header svelte-2smypa"),c(d,"class","ai-summary-content svelte-2smypa"),c(b,"class","icon is-small"),c(g,"class","button is-small is-text svelte-2smypa"),g.disabled=l[9],c(g,"title","Regenerate summary"),c(_,"class","ai-summary-actions svelte-2smypa"),c(e,"class","ai-summary svelte-2smypa")},m(E,H){R(E,e,H),r(e,t),r(t,n),r(n,o),r(n,a),N.m(n,null),r(t,s),r(t,u),r(e,i),r(e,d),ge(p,d,null),r(e,m),r(e,_),r(_,g),r(g,b),r(g,v),r(g,w),C=!0,k||(T=[se(u,"click",l[21]),se(g,"click",l[22])],k=!0)},p(E,H){O!==(O=F(E))&&(N.d(1),N=O(E),N&&(N.c(),N.m(n,null)));const ee={};H[0]&256&&(ee.source=E[8]),p.$set(ee),(!C||H[0]&512)&&(g.disabled=E[9])},i(E){C||(j(p.$$.fragment,E),mt(()=>{C&&($||($=pl(e,ml,{},!0)),$.run(1))}),C=!0)},o(E){B(p.$$.fragment,E),$||($=pl(e,ml,{},!1)),$.run(0),C=!1},d(E){E&&S(e),N.d(),he(p),E&&$&&$.end(),k=!1,Ze(T)}}}function ta(l){let e;return{c(){e=f("span"),e.textContent="fresh",c(e,"class","tag is-small is-success")},m(t,n){R(t,e,n)},d(t){t&&S(e)}}}function la(l){let e;return{c(){e=f("span"),e.textContent="cached",c(e,"class","tag is-small is-light")},m(t,n){R(t,e,n)},d(t){t&&S(e)}}}function no(l){let e;function t(a,s){return a[41].disabled?sa:a[41].isLink?oa:na}let n=t(l),o=n(l);return{c(){o.c(),e=ut()},m(a,s){o.m(a,s),R(a,e,s)},p(a,s){n===(n=t(a))&&o?o.p(a,s):(o.d(1),o=n(a),o&&(o.c(),o.m(e.parentNode,e)))},d(a){o.d(a),a&&S(e)}}}function na(l){let e,t,n,o,a,s,u,i,d,p;return{c(){var m,_,g;e=f("button"),t=f("span"),n=f("i"),a=h(),c(n,"class",o=Pt(l[41].icon)+" svelte-2smypa"),c(t,"class","icon is-medium"),dt(t,"has-text-primary",(m=l[41].className)==null?void 0:m.includes("primary")),dt(t,"has-text-success",(_=l[41].className)==null?void 0:_.includes("success")),dt(t,"has-text-danger",(g=l[41].className)==null?void 0:g.includes("danger")),c(e,"type","button"),c(e,"class","level-item button is-ghost svelte-2smypa"),c(e,"aria-label",s=l[41].title),c(e,"title",u=l[41].title),c(e,"data-testid",i=l[41].testId||"")},m(m,_){R(m,e,_),r(e,t),r(t,n),r(e,a),d||(p=se(e,"click",function(){Vl(l[41].action)&&l[41].action.apply(this,arguments)}),d=!0)},p(m,_){var g,b,v;l=m,_[0]&32768&&o!==(o=Pt(l[41].icon)+" svelte-2smypa")&&c(n,"class",o),_[0]&32768&&dt(t,"has-text-primary",(g=l[41].className)==null?void 0:g.includes("primary")),_[0]&32768&&dt(t,"has-text-success",(b=l[41].className)==null?void 0:b.includes("success")),_[0]&32768&&dt(t,"has-text-danger",(v=l[41].className)==null?void 0:v.includes("danger")),_[0]&32768&&s!==(s=l[41].title)&&c(e,"aria-label",s),_[0]&32768&&u!==(u=l[41].title)&&c(e,"title",u),_[0]&32768&&i!==(i=l[41].testId||"")&&c(e,"data-testid",i)},d(m){m&&S(e),d=!1,p()}}}function oa(l){let e,t,n,o,a,s,u,i;return{c(){e=f("a"),t=f("span"),n=f("i"),a=h(),c(n,"class",o=Pt(l[41].icon)+" svelte-2smypa"),c(t,"class","icon is-medium"),dt(t,"has-text-primary",l[41].className),c(e,"href",s=l[41].href),c(e,"target","_blank"),c(e,"class","level-item"),c(e,"aria-label",u=l[41].title),c(e,"title",i=l[41].title)},m(d,p){R(d,e,p),r(e,t),r(t,n),r(e,a)},p(d,p){p[0]&32768&&o!==(o=Pt(d[41].icon)+" svelte-2smypa")&&c(n,"class",o),p[0]&32768&&dt(t,"has-text-primary",d[41].className),p[0]&32768&&s!==(s=d[41].href)&&c(e,"href",s),p[0]&32768&&u!==(u=d[41].title)&&c(e,"aria-label",u),p[0]&32768&&i!==(i=d[41].title)&&c(e,"title",i)},d(d){d&&S(e)}}}function sa(l){let e,t,n,o,a,s,u;return{c(){e=f("button"),t=f("span"),n=f("i"),a=h(),c(n,"class",o=Pt(l[41].icon)+" svelte-2smypa"),c(t,"class","icon is-medium"),dt(t,"has-text-primary",l[41].className),c(e,"type","button"),c(e,"class","level-item button is-ghost svelte-2smypa"),c(e,"aria-label",s=l[41].title),c(e,"title",u=l[41].title),e.disabled=!0},m(i,d){R(i,e,d),r(e,t),r(t,n),r(e,a)},p(i,d){d[0]&32768&&o!==(o=Pt(i[41].icon)+" svelte-2smypa")&&c(n,"class",o),d[0]&32768&&dt(t,"has-text-primary",i[41].className),d[0]&32768&&s!==(s=i[41].title)&&c(e,"aria-label",s),d[0]&32768&&u!==(u=i[41].title)&&c(e,"title",u)},d(i){i&&S(e)}}}function oo(l){let e,t=l[41].visible&&no(l);return{c(){t&&t.c(),e=ut()},m(n,o){t&&t.m(n,o),R(n,e,o)},p(n,o){n[41].visible?t?t.p(n,o):(t=no(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(n){t&&t.d(n),n&&S(e)}}}function so(l){let e,t,n,o,a,s;return{c(){e=f("div"),t=f("button"),n=h(),o=P(l[13]),c(t,"class","delete svelte-2smypa"),c(e,"class","notification is-danger is-light mt-2")},m(u,i){R(u,e,i),r(e,t),r(e,n),r(e,o),a||(s=se(t,"click",l[23]),a=!0)},p(u,i){i[0]&8192&&ve(o,u[13])},d(u){u&&S(e),a=!1,s()}}}function ro(l){let e,t,n;function o(s){l[25](s)}let a={item:l[4],kgTerm:l[5],kgRank:l[6]};return l[2]!==void 0&&(a.active=l[2]),e=new Yl({props:a}),lt.push(()=>st(e,"active",o)),{c(){_e(e.$$.fragment)},m(s,u){ge(e,s,u),n=!0},p(s,u){const i={};u[0]&16&&(i.item=s[4]),u[0]&32&&(i.kgTerm=s[5]),u[0]&64&&(i.kgRank=s[6]),!t&&u[0]&4&&(t=!0,i.active=s[2],rt(()=>t=!1)),e.$set(i)},i(s){n||(j(e.$$.fragment,s),n=!0)},o(s){B(e.$$.fragment,s),n=!1},d(s){he(e,s)}}}function io(l){let e,t,n;function o(s){l[26](s)}let a={document:l[0]};return l[3]!==void 0&&(a.active=l[3]),e=new Gi({props:a}),lt.push(()=>st(e,"active",o)),{c(){_e(e.$$.fragment)},m(s,u){ge(e,s,u),n=!0},p(s,u){const i={};u[0]&1&&(i.document=s[0]),!t&&u[0]&8&&(t=!0,i.active=s[3],rt(()=>t=!1)),e.$set(i)},i(s){n||(j(e.$$.fragment,s),n=!0)},o(s){B(e.$$.fragment,s),n=!1},d(s){he(e,s)}}}function ra(l){let e,t,n,o,a,s,u,i,d,p,m,_,g=l[0].title+"",b,v,w,$,C,k,T,F,O,N,E,H,ee,J,L,D,ne,W,oe,le,z,Q,I,U,y,A,M,Z,V,X,Y,re=l[0].tags&&Zn(l);i=new Jl({props:{$$slots:{default:[Xi]},$$scope:{ctx:l}}});const pe=[ea,xi],ie=[];function ae(fe,Se){return fe[0].description?0:1}T=ae(l),F=ie[T]=pe[T](l);let be=!l[11]&&!l[9]&&!l[10]&&xn(l),K=l[9]&&eo(),x=l[10]&&to(l),ce=l[11]&&l[8]&&lo(l),me=l[15],ke=[];for(let fe=0;fe<me.length;fe+=1)ke[fe]=oo(Qn(l,me,fe));let Te=l[13]&&so(l);function Xe(fe){l[24](fe)}let Be={item:l[0]};l[1]!==void 0&&(Be.active=l[1]),U=new Yl({props:Be}),lt.push(()=>st(U,"active",Xe));let Ne=l[4]&&ro(l),Pe=l[14]&&io(l);return{c(){e=f("div"),t=f("article"),n=f("div"),o=f("div"),a=f("div"),re&&re.c(),s=h(),u=f("div"),_e(i.$$.fragment),d=h(),p=f("div"),m=f("button"),_=f("h2"),b=P(g),v=h(),w=f("div"),$=f("small"),$.textContent="Description:",C=h(),k=f("div"),F.c(),O=h(),N=f("div"),be&&be.c(),E=h(),K&&K.c(),H=h(),x&&x.c(),ee=h(),ce&&ce.c(),J=h(),L=f("br"),ne=h(),W=f("div"),oe=f("nav"),le=f("div");for(let fe=0;fe<ke.length;fe+=1)ke[fe].c();Q=h(),Te&&Te.c(),I=h(),_e(U.$$.fragment),A=h(),Ne&&Ne.c(),M=h(),Pe&&Pe.c(),Z=ut(),c(a,"class","level-right"),c(u,"class","level-right"),c(_,"class","title svelte-2smypa"),c(m,"class","svelte-2smypa"),c($,"class","description-label svelte-2smypa"),c(k,"class","description-content svelte-2smypa"),c(w,"class","description svelte-2smypa"),c(N,"class","ai-summary-section svelte-2smypa"),c(o,"class","content"),c(le,"class","level-right"),c(oe,"class","level is-mobile"),c(W,"class","level-right"),c(n,"class","media-content"),c(t,"class","media"),c(e,"class","box")},m(fe,Se){R(fe,e,Se),r(e,t),r(t,n),r(n,o),r(o,a),re&&re.m(a,null),r(o,s),r(o,u),ge(i,u,null),r(o,d),r(o,p),r(p,m),r(m,_),r(_,b),r(p,v),r(p,w),r(w,$),r(w,C),r(w,k),ie[T].m(k,null),r(p,O),r(p,N),be&&be.m(N,null),r(N,E),K&&K.m(N,null),r(N,H),x&&x.m(N,null),r(N,ee),ce&&ce.m(N,null),r(p,J),r(p,L),r(n,ne),r(n,W),r(W,oe),r(oe,le);for(let Me=0;Me<ke.length;Me+=1)ke[Me]&&ke[Me].m(le,null);r(e,Q),Te&&Te.m(e,null),R(fe,I,Se),ge(U,fe,Se),R(fe,A,Se),Ne&&Ne.m(fe,Se),R(fe,M,Se),Pe&&Pe.m(fe,Se),R(fe,Z,Se),V=!0,X||(Y=se(m,"click",l[16]),X=!0)},p(fe,Se){fe[0].tags?re?(re.p(fe,Se),Se[0]&1&&j(re,1)):(re=Zn(fe),re.c(),j(re,1),re.m(a,null)):re&&(Fe(),B(re,1,1,()=>{re=null}),Ke());const Me={};Se[0]&1|Se[1]&65536&&(Me.$$scope={dirty:Se,ctx:fe}),i.$set(Me),(!V||Se[0]&1)&&g!==(g=fe[0].title+"")&&ve(b,g);let xe=T;if(T=ae(fe),T===xe?ie[T].p(fe,Se):(Fe(),B(ie[xe],1,1,()=>{ie[xe]=null}),Ke(),F=ie[T],F?F.p(fe,Se):(F=ie[T]=pe[T](fe),F.c()),j(F,1),F.m(k,null)),!fe[11]&&!fe[9]&&!fe[10]?be?be.p(fe,Se):(be=xn(fe),be.c(),be.m(N,E)):be&&(be.d(1),be=null),fe[9]?K||(K=eo(),K.c(),K.m(N,H)):K&&(K.d(1),K=null),fe[10]?x?x.p(fe,Se):(x=to(fe),x.c(),x.m(N,ee)):x&&(x.d(1),x=null),fe[11]&&fe[8]?ce?(ce.p(fe,Se),Se[0]&2304&&j(ce,1)):(ce=lo(fe),ce.c(),j(ce,1),ce.m(N,null)):ce&&(Fe(),B(ce,1,1,()=>{ce=null}),Ke()),Se[0]&32768){me=fe[15];let ye;for(ye=0;ye<me.length;ye+=1){const ze=Qn(fe,me,ye);ke[ye]?ke[ye].p(ze,Se):(ke[ye]=oo(ze),ke[ye].c(),ke[ye].m(le,null))}for(;ye<ke.length;ye+=1)ke[ye].d(1);ke.length=me.length}fe[13]?Te?Te.p(fe,Se):(Te=so(fe),Te.c(),Te.m(e,null)):Te&&(Te.d(1),Te=null);const et={};Se[0]&1&&(et.item=fe[0]),!y&&Se[0]&2&&(y=!0,et.active=fe[1],rt(()=>y=!1)),U.$set(et),fe[4]?Ne?(Ne.p(fe,Se),Se[0]&16&&j(Ne,1)):(Ne=ro(fe),Ne.c(),j(Ne,1),Ne.m(M.parentNode,M)):Ne&&(Fe(),B(Ne,1,1,()=>{Ne=null}),Ke()),fe[14]?Pe?(Pe.p(fe,Se),Se[0]&16384&&j(Pe,1)):(Pe=io(fe),Pe.c(),j(Pe,1),Pe.m(Z.parentNode,Z)):Pe&&(Fe(),B(Pe,1,1,()=>{Pe=null}),Ke())},i(fe){V||(j(re),j(i.$$.fragment,fe),j(F),j(ce),mt(()=>{V&&(D||(D=pl(p,ml,{},!0)),D.run(1))}),mt(()=>{V&&(z||(z=pl(oe,ml,{},!0)),z.run(1))}),j(U.$$.fragment,fe),j(Ne),j(Pe),V=!0)},o(fe){B(re),B(i.$$.fragment,fe),B(F),B(ce),D||(D=pl(p,ml,{},!1)),D.run(0),z||(z=pl(oe,ml,{},!1)),z.run(0),B(U.$$.fragment,fe),B(Ne),B(Pe),V=!1},d(fe){fe&&S(e),re&&re.d(),he(i),ie[T].d(),be&&be.d(),K&&K.d(),x&&x.d(),ce&&ce.d(),fe&&D&&D.end(),tt(ke,fe),fe&&z&&z.end(),Te&&Te.d(),fe&&S(I),he(U,fe),fe&&S(A),Ne&&Ne.d(fe),fe&&S(M),Pe&&Pe.d(fe),fe&&S(Z),X=!1,Y()}}}function ia(l,e,t){let n,o,a,s,u;Ue(l,At,Y=>t(31,a=Y)),Ue(l,ct,Y=>t(32,s=Y)),Ue(l,Lt,Y=>t(33,u=Y));let{document:i}=e,d=!1,p=!1,m=!1,_=null,g=null,b=null,v=!1,w=null,$=!1,C=null,k=!1,T=!1,F=!1,O=!1,N=null,E=!1,H=!1;function ee(){const Y=[];return Y.push({id:"download-markdown",label:"Download to Markdown",icon:"fas fa-download",action:()=>oe(),visible:!0,title:"Download document as markdown file"}),n&&Y.push({id:"save-atomic",label:"Save to Atomic Server",icon:"fas fa-cloud-upload-alt",action:()=>D(),visible:!0,title:"Save article to Atomic Server",className:"has-text-primary"}),i.url&&Y.push({id:"external-url",label:"Open URL",icon:"fas fa-link",action:()=>window.open(i.url,"_blank"),visible:!0,title:"Open original URL in new tab",isLink:!0,href:i.url}),Y.push({id:"open-vscode",label:"Open in VSCode",icon:"fas fa-code",action:()=>le(),visible:!0,title:"Open document in VSCode",isLink:!0,href:`vscode://${encodeURIComponent(i.title)}.md?${encodeURIComponent(i.body)}`}),Y.push({id:"add-context",label:O?"Added to Context ✓":F?"Adding...":"Add to Context",icon:O?"fas fa-check-circle":F?"fas fa-spinner fa-spin":"fas fa-plus-circle",action:()=>z(),visible:!0,title:O?"Document successfully added to chat context. Go to Chat tab to see it.":"Add document to LLM conversation context",disabled:F||O,className:O?"has-text-success":N?"has-text-danger":"",testId:"add-to-context-button"}),Y.push({id:"chat-with-document",label:H?"Opening Chat...":E?"Adding to Chat...":"Chat with Document",icon:H?"fas fa-external-link-alt":E?"fas fa-spinner fa-spin":"fas fa-comment-dots",action:()=>Q(),visible:!0,title:H?"Opening chat with this document":"Add document to context and open chat",disabled:E||H||F,className:H?"has-text-info":N?"has-text-danger":"has-text-primary",testId:"chat-with-document-button"}),Y}function J(){var ae;const Y=a,re=u;if(!(re!=null&&re.roles)||!Y)return!1;let pe=null;try{for(const[be,K]of Object.entries(re.roles)){const x=K,ce=typeof x.name=="object"?x.name.original:String(x.name);if(be===Y||ce===Y){pe=x;break}}}catch(be){return console.warn("Error checking role configuration:",be),!1}return pe?(((ae=pe.haystacks)==null?void 0:ae.filter(be=>be.service==="Atomic"&&be.location&&!be.read_only))||[]).length>0:!1}const L=()=>{t(1,d=!0)},D=()=>{console.log("🔄 Opening atomic save modal for document:",i.title),t(3,m=!0)};async function ne(Y){var re,pe,ie,ae,be;t(7,v=!0),t(5,g=Y),console.log("🔍 KG Search Debug Info:"),console.log("  Tag clicked:",Y),console.log("  Current role:",a),console.log("  Is Tauri mode:",s);try{if(s){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:a,term:Y});const K=await je("find_documents_for_kg_term",{roleName:a,term:Y});console.log("  📥 Tauri response received:"),console.log("    Status:",K.status),console.log("    Results count:",((re=K.results)==null?void 0:re.length)||0),console.log("    Total:",K.total||0),console.log("    Full response:",JSON.stringify(K,null,2)),K.status==="success"&&K.results&&K.results.length>0?(t(4,_=K.results[0]),t(6,b=_.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",_.title),console.log("    Rank:",b),console.log("    Body length:",((pe=_.body)==null?void 0:pe.length)||0,"characters"),t(2,p=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${Y}" in role: "${a}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const K=Ve.ServerURL,x=encodeURIComponent(a),ce=encodeURIComponent(Y),me=`${K}/roles/${x}/kg_search?term=${ce}`;console.log("  📤 HTTP Request details:"),console.log("    Base URL:",K),console.log("    Role (encoded):",x),console.log("    Term (encoded):",ce),console.log("    Full URL:",me);const ke=await fetch(me);if(console.log("  📥 HTTP Response received:"),console.log("    Status code:",ke.status),console.log("    Status text:",ke.statusText),console.log("    Headers:",Object.fromEntries(ke.headers.entries())),!ke.ok)throw new Error(`HTTP error! Status: ${ke.status} - ${ke.statusText}`);const Te=await ke.json();console.log("  📄 Response data:"),console.log("    Status:",Te.status),console.log("    Results count:",((ie=Te.results)==null?void 0:ie.length)||0),console.log("    Total:",Te.total||0),console.log("    Full response:",JSON.stringify(Te,null,2)),Te.status==="success"&&Te.results&&Te.results.length>0?(t(4,_=Te.results[0]),t(6,b=_.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",_.title),console.log("    Rank:",b),console.log("    Body length:",((ae=_.body)==null?void 0:ae.length)||0,"characters"),t(2,p=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${Y}" in role: "${a}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",me))}}catch(K){console.error("❌ Error fetching KG document:"),console.error("  Error type:",K.constructor.name),console.error("  Error message:",K.message||K),console.error("  Request details:",{tag:Y,role:a,isTauri:s,timestamp:new Date().toISOString()}),!s&&((be=K.message)!=null&&be.includes("Failed to fetch"))&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{t(7,v=!1)}}async function W(){var Y;if(!($||!i.id||!a)){t(9,$=!0),t(10,C=null),console.log("🤖 AI Summary Debug Info:"),console.log("  Document ID:",i.id),console.log("  Current role:",a),console.log("  Is Tauri mode:",s);try{const re={document_id:i.id,role:a,max_length:250,force_regenerate:!1};console.log("  📤 Summarization request:",re);let pe;if(s){const be=`${Ve.ServerURL}/documents/summarize`;pe=await fetch(be,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(re)})}else{const be=`${Ve.ServerURL}/documents/summarize`;pe=await fetch(be,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(re)})}if(console.log("  📥 Summary response received:"),console.log("    Status code:",pe.status),console.log("    Status text:",pe.statusText),!pe.ok)throw new Error(`HTTP error! Status: ${pe.status} - ${pe.statusText}`);const ie=await pe.json();console.log("  📄 Summary response data:",ie),ie.status==="success"&&ie.summary?(t(8,w=ie.summary),t(12,T=ie.from_cache||!1),t(11,k=!0),console.log("  ✅ Summary generated successfully"),console.log("    Summary length:",w.length,"characters"),console.log("    From cache:",T),console.log("    Model used:",ie.model_used)):(t(10,C=ie.error||"Failed to generate summary"),console.error("  ❌ Summary generation failed:",C))}catch(re){console.error("❌ Error generating summary:"),console.error("  Error type:",re.constructor.name),console.error("  Error message:",re.message||re),console.error("  Request details:",{document_id:i.id,role:a,isTauri:s,timestamp:new Date().toISOString()}),t(10,C=re.message||"Network error occurred"),(Y=re.message)!=null&&Y.includes("Failed to fetch")&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Verify OpenRouter is enabled for this role"),console.error("    3. Check OPENROUTER_KEY environment variable"),console.error("    4. Verify server URL in CONFIG.ServerURL"))}finally{t(9,$=!1)}}}function oe(){console.log("📥 Downloading document as markdown:",i.title);let Y=`# ${i.title}

`;Y+=`**Source:** Terraphim Search
`,Y+=`**Rank:** ${i.rank||"N/A"}
`,i.url&&(Y+=`**URL:** ${i.url}
`),i.tags&&i.tags.length>0&&(Y+=`**Tags:** ${i.tags.join(", ")}
`),Y+=`**Downloaded:** ${new Date().toISOString()}

`,i.description&&(Y+=`## Description

${i.description}

`),Y+=`## Content

${i.body}
`;const re=`${i.title.replace(/[^a-z0-9]/gi,"_").toLowerCase()}_${Date.now()}.md`,pe=new Blob([Y],{type:"text/markdown"}),ie=URL.createObjectURL(pe),ae=window.document.createElement("a");ae.href=ie,ae.download=re,window.document.body.appendChild(ae),ae.click(),window.document.body.removeChild(ae),URL.revokeObjectURL(ie),console.log("✅ Markdown file downloaded:",re)}function le(){const Y=`vscode://${encodeURIComponent(i.title)}.md?${encodeURIComponent(i.body)}`;window.open(Y,"_blank")}async function z(){console.log("📝 Adding document to LLM context:",i.title),F=!0,O=!1,t(13,N=null);try{let Y=null;if(s){try{const ae=await je("list_conversations");if(console.log("📋 Available conversations:",ae),ae!=null&&ae.conversations&&ae.conversations.length>0)Y=ae.conversations[0].id,console.log("🎯 Using existing conversation:",Y);else{const be=await je("create_conversation",{title:"Search Context",role:a||"default"});if(be.status==="success"&&be.conversation_id)Y=be.conversation_id,console.log("🆕 Created new conversation:",Y);else throw new Error("Failed to create conversation: "+(be.error||"Unknown error"))}}catch(ae){throw console.error("❌ Failed to manage conversations:",ae),new Error("Could not create or find conversation: "+ae.message)}const pe={source_type:"document",document_id:i.id};i.url&&(pe.url=i.url),i.tags&&i.tags.length>0&&(pe.tags=i.tags.join(", ")),i.rank!==void 0&&(pe.rank=i.rank.toString());const ie=await je("add_context_to_conversation",{conversationId:Y,contextType:"document",title:i.title,content:i.body,metadata:pe});console.log("✅ Document added to context via Tauri:",ie)}else{const pe=Ve.ServerURL;try{const K=await fetch(`${pe}/conversations`);if(K.ok){const x=await K.json();if(x.conversations&&x.conversations.length>0)Y=x.conversations[0].id,console.log("🎯 Using existing conversation:",Y);else{const ce=await fetch(`${pe}/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"Search Context",role:a||"default"})});if(ce.ok){const me=await ce.json();if(me.status==="success"&&me.conversation_id)Y=me.conversation_id,console.log("🆕 Created new conversation:",Y);else throw new Error("Failed to create conversation: "+(me.error||"Unknown error"))}else throw new Error(`Failed to create conversation: ${ce.status} ${ce.statusText}`)}}else throw new Error(`Failed to list conversations: ${K.status} ${K.statusText}`)}catch(K){throw console.error("❌ Failed to manage conversations:",K),new Error("Could not create or find conversation: "+K.message)}const ie=`${pe}/conversations/${Y}/context`,ae=await fetch(ie,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context_type:"document",title:i.title,content:i.body,metadata:{source_type:"document",document_id:i.id,url:i.url||"",tags:i.tags?i.tags.join(", "):"",rank:i.rank?i.rank.toString():"0"}})});if(!ae.ok)throw new Error(`HTTP error! Status: ${ae.status} - ${ae.statusText}`);const be=await ae.json();console.log("✅ Document added to context via HTTP:",be)}console.log("✅ Successfully added document to LLM context"),O=!0;const re=window.document.createElement("div");re.className="notification is-success is-light",re.innerHTML=`
        <button class="delete" onclick="this.parentElement.remove()"></button>
        <strong>✓ Added to Chat Context</strong><br>
        <small>Document added successfully. <a href="/chat" class="has-text-success has-text-weight-bold">Go to Chat →</a> to see it in the context panel.</small>
      `,re.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(re),setTimeout(()=>{re.remove()},8e3),setTimeout(()=>{O=!1},5e3)}catch(Y){console.error("❌ Error adding document to context:",Y),t(13,N=Y.message||"Failed to add document to context");const re=window.document.createElement("div");re.className="notification is-danger is-light",re.innerHTML=`
        <button class="delete" onclick="this.parentElement.remove()"></button>
        <strong>✗ Failed to Add Context</strong><br>
        <small>${N}</small>
      `,re.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(re),setTimeout(()=>{re.remove()},8e3),setTimeout(()=>{t(13,N=null)},5e3)}finally{F=!1}}async function Q(){console.log("💬 Adding document to context and opening chat:",i.title),E=!0,H=!1,t(13,N=null);try{let Y=null;if(s){try{const ae=await je("list_conversations");if(console.log("📋 Available conversations:",ae),ae!=null&&ae.conversations&&ae.conversations.length>0)Y=ae.conversations[0].id,console.log("🎯 Using existing conversation:",Y);else{const be=await je("create_conversation",{title:"Chat with Documents",role:a||"default"});if(be.status==="success"&&be.conversation_id)Y=be.conversation_id,console.log("🆕 Created new conversation:",Y);else throw new Error("Failed to create conversation: "+(be.error||"Unknown error"))}}catch(ae){throw console.error("❌ Failed to manage conversations:",ae),new Error("Could not create or find conversation: "+ae.message)}const pe={source_type:"document",document_id:i.id};i.url&&(pe.url=i.url),i.tags&&i.tags.length>0&&(pe.tags=i.tags.join(", ")),i.rank!==void 0&&(pe.rank=i.rank.toString());const ie=await je("add_context_to_conversation",{conversationId:Y,contextType:"document",title:i.title,content:i.body,metadata:pe});console.log("✅ Document added to context via Tauri:",ie)}else{const pe=Ve.ServerURL;try{const K=await fetch(`${pe}/conversations`);if(K.ok){const x=await K.json();if(x.conversations&&x.conversations.length>0)Y=x.conversations[0].id,console.log("🎯 Using existing conversation:",Y);else{const ce=await fetch(`${pe}/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"Chat with Documents",role:a||"default"})});if(ce.ok){const me=await ce.json();if(me.status==="success"&&me.conversation_id)Y=me.conversation_id,console.log("🆕 Created new conversation:",Y);else throw new Error("Failed to create conversation: "+(me.error||"Unknown error"))}else throw new Error(`Failed to create conversation: ${ce.status} ${ce.statusText}`)}}else throw new Error(`Failed to list conversations: ${K.status} ${K.statusText}`)}catch(K){throw console.error("❌ Failed to manage conversations:",K),new Error("Could not create or find conversation: "+K.message)}const ie=`${pe}/conversations/${Y}/context`,ae=await fetch(ie,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context_type:"document",title:i.title,content:i.body,metadata:{source_type:"document",document_id:i.id,url:i.url||"",tags:i.tags?i.tags.join(", "):"",rank:i.rank?i.rank.toString():"0"}})});if(!ae.ok)throw new Error(`HTTP error! Status: ${ae.status} - ${ae.statusText}`);const be=await ae.json();console.log("✅ Document added to context via HTTP:",be)}console.log("✅ Successfully added document to chat context, navigating to chat..."),H=!0;const re=window.document.createElement("div");re.className="notification is-success is-light",re.innerHTML=`
        <strong>💬 Opening Chat with Document</strong><br>
        <small>Context added successfully. Redirecting to chat...</small>
      `,re.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(re),setTimeout(()=>{re.remove(),mr.goto("/chat")},1500),setTimeout(()=>{H=!1},2e3)}catch(Y){console.error("❌ Error adding document to context and opening chat:",Y),t(13,N=Y.message||"Failed to add document to context");const re=window.document.createElement("div");re.className="notification is-danger is-light",re.innerHTML=`
        <button class="delete" onclick="this.parentElement.remove()"></button>
        <strong>✗ Failed to Open Chat with Document</strong><br>
        <small>${N}</small>
      `,re.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(re),setTimeout(()=>{re.remove()},8e3),setTimeout(()=>{t(13,N=null)},5e3)}finally{E=!1}}Ml[a]!==void 0&&(console.log("Have attribute",Ml[a]),Ml[a].hasOwnProperty("enableLogseq")?console.log("enable logseq True"):console.log("Didn't make it"));const I=Y=>ne(Y),U=()=>{t(10,C=null),W()},y=()=>t(11,k=!1),A=()=>{W()},M=()=>t(13,N=null);function Z(Y){d=Y,t(1,d)}function V(Y){p=Y,t(2,p)}function X(Y){m=Y,t(3,m)}return l.$$set=Y=>{"document"in Y&&t(0,i=Y.document)},t(14,n=J()),t(15,o=ee()),[i,d,p,m,_,g,b,v,w,$,C,k,T,N,n,o,L,ne,W,I,U,y,A,M,Z,V,X]}class aa extends _t{constructor(e){super(),gt(this,e,ia,ra,pt,{document:0},null,[-1,-1])}}const ca="/assets/terraphim_gray.png";function Pl(l){const e=l.trim();if(!e)return{hasOperator:!1,operator:null,terms:[l],originalQuery:l};const t=/\b(AND)\b/,n=/\b(OR)\b/,o=/\b(and)\b/i,a=/\b(or)\b/i,s=t.test(e),u=n.test(e),i=o.test(e)&&!s,d=a.test(e)&&!u;if(s&&!u)return{hasOperator:!0,operator:"AND",terms:e.split(t).filter((m,_)=>_%2===0).map(m=>m.trim()).filter(m=>m.length>0),originalQuery:l};if(u&&!s)return{hasOperator:!0,operator:"OR",terms:e.split(n).filter((m,_)=>_%2===0).map(m=>m.trim()).filter(m=>m.length>0),originalQuery:l};if(s&&u){const p=e.indexOf(" AND "),m=e.indexOf(" OR ");if(p!==-1&&(m===-1||p<m))return{hasOperator:!0,operator:"AND",terms:e.split(/\s+(?:AND|OR)\s+/i).map(g=>g.trim()).filter(g=>g.length>0),originalQuery:l};if(m!==-1)return{hasOperator:!0,operator:"OR",terms:e.split(/\s+(?:AND|OR)\s+/i).map(g=>g.trim()).filter(g=>g.length>0),originalQuery:l}}if(i&&!d)return{hasOperator:!0,operator:"AND",terms:e.split(o).filter((m,_)=>_%2===0).map(m=>m.trim()).filter(m=>m.length>0),originalQuery:l};if(d&&!i)return{hasOperator:!0,operator:"OR",terms:e.split(a).filter((m,_)=>_%2===0).map(m=>m.trim()).filter(m=>m.length>0),originalQuery:l};if(i&&d){const p=e.toLowerCase().indexOf(" and "),m=e.toLowerCase().indexOf(" or ");if(p!==-1&&(m===-1||p<m))return{hasOperator:!0,operator:"AND",terms:e.split(/\s+(?:and|or)\s+/i).map(g=>g.trim()).filter(g=>g.length>0),originalQuery:l};if(m!==-1)return{hasOperator:!0,operator:"OR",terms:e.split(/\s+(?:and|or)\s+/i).map(g=>g.trim()).filter(g=>g.length>0),originalQuery:l}}return{hasOperator:!1,operator:null,terms:[e],originalQuery:l}}function ua(l,e){var n,o;if(l.hasOperator&&l.terms.length>1){const a=l.terms.filter(s=>s.trim().length>0);if(a.length>1)return{search_term:a[0],search_terms:a,operator:(n=l.operator)==null?void 0:n.toLowerCase(),skip:0,limit:50,role:e||null}}return{search_term:((o=l.terms[0])==null?void 0:o.trim())||"",search_terms:void 0,operator:void 0,skip:0,limit:50,role:e||null}}function ao(l,e,t){const n=l.slice();return n[35]=e[t],n}function co(l,e,t){const n=l.slice();return n[38]=e[t],n[40]=t,n}function uo(l,e,t){const n=l.slice();return n[41]=e[t],n[40]=t,n}function fo(l){let e,t=l[3],n=[];for(let o=0;o<t.length;o+=1)n[o]=po(uo(l,t,o));return{c(){e=f("ul");for(let o=0;o<n.length;o+=1)n[o].c();c(e,"class","suggestions svelte-sfnt4t")},m(o,a){R(o,e,a);for(let s=0;s<n.length;s+=1)n[s]&&n[s].m(e,null)},p(o,a){if(a[0]&4120){t=o[3];let s;for(s=0;s<t.length;s+=1){const u=uo(o,t,s);n[s]?n[s].p(u,a):(n[s]=po(u),n[s].c(),n[s].m(e,null))}for(;s<n.length;s+=1)n[s].d(1);n.length=t.length}},d(o){o&&S(e),tt(n,o)}}}function po(l){let e,t=l[41]+"",n,o,a,s,u,i;function d(){return l[20](l[41])}function p(...m){return l[21](l[41],...m)}return{c(){e=f("li"),n=P(t),o=h(),c(e,"tabindex","0"),c(e,"role","option"),c(e,"aria-selected",a=l[40]===l[4]),c(e,"aria-label",s=`Apply suggestion: ${l[41]}`),c(e,"class","svelte-sfnt4t"),dt(e,"active",l[40]===l[4])},m(m,_){R(m,e,_),r(e,n),r(e,o),u||(i=[se(e,"click",d),se(e,"keydown",p)],u=!0)},p(m,_){l=m,_[0]&8&&t!==(t=l[41]+"")&&ve(n,t),_[0]&16&&a!==(a=l[40]===l[4])&&c(e,"aria-selected",a),_[0]&8&&s!==(s=`Apply suggestion: ${l[41]}`)&&c(e,"aria-label",s),_[0]&16&&dt(e,"active",l[40]===l[4])},d(m){m&&S(e),u=!1,Ze(i)}}}function mo(l){let e,t,n,o,a,s,u;return t=new Jl({props:{$$slots:{default:[pa]},$$scope:{ctx:l}}}),{c(){e=f("div"),_e(t.$$.fragment),n=h(),o=f("button"),o.textContent="Clear all",c(o,"type","button"),c(o,"class","clear-terms-btn svelte-sfnt4t"),c(e,"class","selected-terms-section svelte-sfnt4t")},m(i,d){R(i,e,d),ge(t,e,null),r(e,n),r(e,o),a=!0,s||(u=se(o,"click",l[14]),s=!0)},p(i,d){const p={};d[0]&96|d[1]&4096&&(p.$$scope={dirty:d,ctx:i}),t.$set(p)},i(i){a||(j(t.$$.fragment,i),a=!0)},o(i){B(t.$$.fragment,i),a=!1},d(i){i&&S(e),he(t),s=!1,u()}}}function fa(l){let e=l[38].value+"",t,n,o,a,s,u,i;function d(){return l[22](l[38])}return{c(){t=P(e),n=h(),o=f("button"),a=P("×"),c(o,"class","remove-tag-btn svelte-sfnt4t"),c(o,"aria-label",s=`Remove term: ${l[38].value}`)},m(p,m){R(p,t,m),R(p,n,m),R(p,o,m),r(o,a),u||(i=se(o,"click",ur(d)),u=!0)},p(p,m){l=p,m[0]&32&&e!==(e=l[38].value+"")&&ve(t,e),m[0]&32&&s!==(s=`Remove term: ${l[38].value}`)&&c(o,"aria-label",s)},d(p){p&&S(t),p&&S(n),p&&S(o),u=!1,i()}}}function _o(l){let e,t,n,o;return t=new Gt({props:{class:"operator-tag",rounded:!0,$$slots:{default:[da]},$$scope:{ctx:l}}}),{c(){e=f("div"),_e(t.$$.fragment),n=h(),c(e,"class","operator-tag-wrapper svelte-sfnt4t")},m(a,s){R(a,e,s),ge(t,e,null),r(e,n),o=!0},p(a,s){const u={};s[0]&64|s[1]&4096&&(u.$$scope={dirty:s,ctx:a}),t.$set(u)},i(a){o||(j(t.$$.fragment,a),o=!0)},o(a){B(t.$$.fragment,a),o=!1},d(a){a&&S(e),he(t)}}}function da(l){let e=(l[6]||"AND")+"",t;return{c(){t=P(e)},m(n,o){R(n,t,o)},p(n,o){o[0]&64&&e!==(e=(n[6]||"AND")+"")&&ve(t,e)},d(n){n&&S(t)}}}function go(l){let e,t,n,o,a;function s(){return l[23](l[38])}t=new Gt({props:{rounded:!0,title:"Click to remove term",$$slots:{default:[fa]},$$scope:{ctx:l}}}),t.$on("click",s);let u=l[40]<l[5].length-1&&_o(l);return{c(){e=f("div"),_e(t.$$.fragment),n=h(),u&&u.c(),o=ut(),c(e,"class","term-tag-wrapper svelte-sfnt4t"),dt(e,"from-kg",l[38].isFromKG)},m(i,d){R(i,e,d),ge(t,e,null),R(i,n,d),u&&u.m(i,d),R(i,o,d),a=!0},p(i,d){l=i;const p={};d[0]&32|d[1]&4096&&(p.$$scope={dirty:d,ctx:l}),t.$set(p),(!a||d[0]&32)&&dt(e,"from-kg",l[38].isFromKG),l[40]<l[5].length-1?u?(u.p(l,d),d[0]&32&&j(u,1)):(u=_o(l),u.c(),j(u,1),u.m(o.parentNode,o)):u&&(Fe(),B(u,1,1,()=>{u=null}),Ke())},i(i){a||(j(t.$$.fragment,i),j(u),a=!0)},o(i){B(t.$$.fragment,i),B(u),a=!1},d(i){i&&S(e),he(t),i&&S(n),u&&u.d(i),i&&S(o)}}}function pa(l){let e,t,n=l[5],o=[];for(let s=0;s<n.length;s+=1)o[s]=go(co(l,n,s));const a=s=>B(o[s],1,1,()=>{o[s]=null});return{c(){for(let s=0;s<o.length;s+=1)o[s].c();e=ut()},m(s,u){for(let i=0;i<o.length;i+=1)o[i]&&o[i].m(s,u);R(s,e,u),t=!0},p(s,u){if(u[0]&8288){n=s[5];let i;for(i=0;i<n.length;i+=1){const d=co(s,n,i);o[i]?(o[i].p(d,u),j(o[i],1)):(o[i]=go(d),o[i].c(),j(o[i],1),o[i].m(e.parentNode,e))}for(Fe(),i=n.length;i<o.length;i+=1)a(i);Ke()}},i(s){if(!t){for(let u=0;u<n.length;u+=1)j(o[u]);t=!0}},o(s){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)B(o[u]);t=!1},d(s){tt(o,s),s&&S(e)}}}function ho(l){let e,t,n,o;return{c(){e=f("div"),t=f("button"),t.textContent="Parse Terms",c(t,"type","button"),c(t,"class","button is-small is-info"),c(e,"class","search-hint-container svelte-sfnt4t")},m(a,s){R(a,e,s),r(e,t),n||(o=se(t,"click",l[24]),n=!0)},p:Re,d(a){a&&S(e),n=!1,o()}}}function ma(l){let e,t,n,o,a,s,u,i=l[0]&&(l[0].includes(" AND ")||l[0].includes(" OR "))&&l[5].length===0,d;function p(v){l[19](v)}let m={type:"search",placeholder:l[8]?`Search over Knowledge graph for ${l[7]}`:"Search",icon:"search",expanded:!0,autofocus:!0};l[0]!==void 0&&(m.value=l[0]),n=new Vt({props:m}),lt.push(()=>st(n,"value",p)),n.$on("click",l[15]),n.$on("submit",l[15]),n.$on("keydown",l[11]),n.$on("input",l[10]);let _=l[3].length>0&&fo(l),g=l[5].length>0&&mo(l),b=i&&ho(l);return{c(){e=f("div"),t=f("div"),_e(n.$$.fragment),a=h(),_&&_.c(),s=h(),g&&g.c(),u=h(),b&&b.c(),c(t,"class","input-wrapper svelte-sfnt4t"),c(e,"class","search-row svelte-sfnt4t")},m(v,w){R(v,e,w),r(e,t),ge(n,t,null),r(t,a),_&&_.m(t,null),r(e,s),g&&g.m(e,null),r(e,u),b&&b.m(e,null),d=!0},p(v,w){const $={};w[0]&384&&($.placeholder=v[8]?`Search over Knowledge graph for ${v[7]}`:"Search"),!o&&w[0]&1&&(o=!0,$.value=v[0],rt(()=>o=!1)),n.$set($),v[3].length>0?_?_.p(v,w):(_=fo(v),_.c(),_.m(t,null)):_&&(_.d(1),_=null),v[5].length>0?g?(g.p(v,w),w[0]&32&&j(g,1)):(g=mo(v),g.c(),j(g,1),g.m(e,u)):g&&(Fe(),B(g,1,1,()=>{g=null}),Ke()),w[0]&33&&(i=v[0]&&(v[0].includes(" AND ")||v[0].includes(" OR "))&&v[5].length===0),i?b?b.p(v,w):(b=ho(v),b.c(),b.m(e,null)):b&&(b.d(1),b=null)},i(v){d||(j(n.$$.fragment,v),j(g),d=!0)},o(v){B(n.$$.fragment,v),B(g),d=!1},d(v){v&&S(e),he(n),_&&_.d(),g&&g.d(),b&&b.d()}}}function _a(l){let e,t,n,o,a,s,u,i,d,p;return{c(){e=f("section"),t=f("div"),n=f("img"),a=h(),s=f("p"),s.textContent="I am Terraphim, your personal assistant.",u=h(),i=f("button"),i.innerHTML=`<span class="icon"><i class="fas fa-magic"></i></span> 
        <span>Configuration Wizard</span>`,cr(n.src,o=ca)||c(n,"src",o),c(n,"alt","Terraphim Logo"),c(n,"class","svelte-sfnt4t"),c(i,"class","button is-primary"),c(i,"data-testid","wizard-start"),c(t,"class","content has-text-grey has-text-centered svelte-sfnt4t"),c(e,"class","section")},m(m,_){R(m,e,_),r(e,t),r(t,n),r(t,a),r(t,s),r(t,u),r(t,i),d||(p=se(i,"click",l[25]),d=!0)},p:Re,i:Re,o:Re,d(m){m&&S(e),d=!1,p()}}}function ga(l){let e,t,n=l[1],o=[];for(let s=0;s<n.length;s+=1)o[s]=vo(ao(l,n,s));const a=s=>B(o[s],1,1,()=>{o[s]=null});return{c(){for(let s=0;s<o.length;s+=1)o[s].c();e=ut()},m(s,u){for(let i=0;i<o.length;i+=1)o[i]&&o[i].m(s,u);R(s,e,u),t=!0},p(s,u){if(u[0]&2){n=s[1];let i;for(i=0;i<n.length;i+=1){const d=ao(s,n,i);o[i]?(o[i].p(d,u),j(o[i],1)):(o[i]=vo(d),o[i].c(),j(o[i],1),o[i].m(e.parentNode,e))}for(Fe(),i=n.length;i<o.length;i+=1)a(i);Ke()}},i(s){if(!t){for(let u=0;u<n.length;u+=1)j(o[u]);t=!0}},o(s){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)B(o[u]);t=!1},d(s){tt(o,s),s&&S(e)}}}function ha(l){let e,t;return{c(){e=f("p"),t=P(l[2]),c(e,"class","error svelte-sfnt4t")},m(n,o){R(n,e,o),r(e,t)},p(n,o){o[0]&4&&ve(t,n[2])},i:Re,o:Re,d(n){n&&S(e)}}}function vo(l){let e,t;return e=new aa({props:{document:l[35]}}),{c(){_e(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},p(n,o){const a={};o[0]&2&&(a.document=n[35]),e.$set(a)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function va(l){let e,t,n,o,a,s,u,i,d,p,m;e=new _l({props:{fallbackPath:"/"}}),o=new Ft({props:{$$slots:{default:[ma]},$$scope:{ctx:l}}});const _=[ha,ga,_a],g=[];function b(v,w){return v[2]?0:v[1].length?1:2}return s=b(l),u=g[s]=_[s](l),{c(){_e(e.$$.fragment),t=h(),n=f("form"),_e(o.$$.fragment),a=h(),u.c(),i=ut()},m(v,w){ge(e,v,w),R(v,t,w),R(v,n,w),ge(o,n,null),R(v,a,w),g[s].m(v,w),R(v,i,w),d=!0,p||(m=se(n,"submit",ar(l[15])),p=!0)},p(v,w){const $={};w[0]&505|w[1]&4096&&($.$$scope={dirty:w,ctx:v}),o.$set($);let C=s;s=b(v),s===C?g[s].p(v,w):(Fe(),B(g[C],1,1,()=>{g[C]=null}),Ke(),u=g[s],u?u.p(v,w):(u=g[s]=_[s](v),u.c()),j(u,1),u.m(i.parentNode,i))},i(v){d||(j(e.$$.fragment,v),j(o.$$.fragment,v),j(u),d=!0)},o(v){B(e.$$.fragment,v),B(o.$$.fragment,v),B(u),d=!1},d(v){he(e,v),v&&S(t),v&&S(n),he(o),v&&S(a),g[s].d(v),v&&S(i),p=!1,m()}}}function ba(l,e,t){let n,o,a,s,u,i,d;Ue(l,Mr,y=>t(27,o=y)),Ue(l,Bt,y=>t(0,a=y)),Ue(l,ct,y=>t(28,s=y)),Ue(l,At,y=>t(7,u=y)),Ue(l,vl,y=>t(18,i=y)),Ue(l,Tt,y=>t(8,d=y));let p=[],m=null,_=[],g=-1,b=[],v=null,w=!1,$=null;Wl(()=>{$&&clearTimeout($)});function C(y){const A=Pl(y);if(A.hasOperator&&A.terms.length>1){const M=A.terms.map(X=>{const Y=n.some(([re])=>re.toLowerCase()===X.toLowerCase());return{value:X,isFromKG:Y}}),Z=b.map(X=>X.value),V=M.map(X=>X.value);(JSON.stringify(Z)!==JSON.stringify(V)||v!==A.operator)&&(t(5,b=M),t(6,v=A.operator))}else A.terms.length===1&&b.length>0?(t(5,b=[]),t(6,v=null)):A.terms.length===0&&(t(5,b=[]),t(6,v=null))}async function k(y){try{if(s){const A=await je("get_autocomplete_suggestions",{query:y,roleName:u,limit:8});if(A.status==="success"&&A.suggestions)return A.suggestions.map(M=>M.term)}else{const A=await fetch(`${o.replace("/documents/search","")}/autocomplete/${encodeURIComponent(u)}/${encodeURIComponent(y)}`);if(A.ok){const M=await A.json();if(M.status==="success"&&M.suggestions)return M.suggestions.map(Z=>Z.term)}}return n.filter(([A])=>A.toLowerCase().includes(y.toLowerCase())).map(([A])=>A).slice(0,8)}catch(A){return console.warn("Error fetching term suggestions:",A),[]}}async function T(y){const A=y.trim();if(A.length===0)return[];const Z=Pl(A),V=A.split(/\s+/),X=V[V.length-1].toLowerCase();if(Z.hasOperator&&Z.terms.length>0){const re=Z.terms[Z.terms.length-1];return re&&re.length>=2?k(re):[]}if(V.length>1){const re=[];if("and".startsWith(X)&&re.push("AND"),"or".startsWith(X)&&re.push("OR"),re.length>0)return re}const Y=A.toLowerCase();if(Y.includes(" and ")||Y.includes(" or ")||Y.includes(" AND ")||Y.includes(" OR ")){const re=X;return re.length<2?[]:k(re)}try{return(await k(A)).slice(0,7)}catch(re){return console.warn("Error fetching autocomplete suggestions:",re),n.filter(([ie])=>ie.toLowerCase().includes(A.toLowerCase())).map(([ie])=>ie).slice(0,5).slice(0,7)}}async function F(y){const A=y.target;if(!A||A.selectionStart==null)return;const M=A.selectionStart,V=a.slice(0,M).split(/\s+/),X=V[V.length-1];if(X.toLowerCase()==="a"||X.toLowerCase()==="an")t(3,_=["AND"]);else if(X.toLowerCase()==="o"||X.toLowerCase()==="or")t(3,_=["OR"]);else if(X.length>=2)try{const Y=await T(X);t(3,_=Y)}catch(Y){console.warn("Failed to get suggestions:",Y),t(3,_=[])}else t(3,_=[]);t(4,g=-1)}function O(y){_.length>0?y.key==="ArrowDown"?(y.preventDefault(),t(4,g=(g+1)%_.length)):y.key==="ArrowUp"?(y.preventDefault(),t(4,g=(g-1+_.length)%_.length)):(y.key==="Enter"||y.key==="Tab")&&g!==-1?(y.preventDefault(),E(_[g])):y.key==="Escape"&&(y.preventDefault(),t(3,_=[]),t(4,g=-1)):y.key==="Enter"&&(y.preventDefault(),N())}function N(){C(a),ne()}function E(y){if(y==="AND"||y==="OR"){t(6,v=y);const A=Pl(a);A.terms.length>0&&!b.some(M=>M.value===A.terms[A.terms.length-1])&&ee(A.terms[A.terms.length-1]),Ht(Bt,a=a+` ${y} `,a)}else{const A=a.trim().split(/\s+/),M=A[A.length-1];y.toLowerCase().startsWith(M.toLowerCase())?(A[A.length-1]=y,Ht(Bt,a=A.join(" "),a)):ee(y,v)}t(3,_=[]),t(4,g=-1)}function H(){const y=a.trim();if(!y)return null;const A=Pl(y);return{...ua(A,u),skip:0,limit:10}}function ee(y,A=null){const M=n.some(([Z])=>Z.toLowerCase()===y.toLowerCase());b.some(Z=>Z.value.toLowerCase()===y.toLowerCase())||(t(5,b=[...b,{value:y,isFromKG:M}]),A&&b.length>1&&t(6,v=A),L())}function J(y){t(5,b=b.filter(A=>A.value!==y)),L()}function L(){if(t(16,w=!0),b.length===0)Ht(Bt,a="",a),t(6,v=null);else if(b.length===1)Ht(Bt,a=b[0].value,a),t(6,v=null);else{const y=v||"AND";Ht(Bt,a=b.map(A=>A.value).join(` ${y} `),a)}setTimeout(()=>{t(16,w=!1)},10)}function D(){t(5,b=[]),t(6,v=null),Ht(Bt,a="",a)}async function ne(){if(t(2,m=null),s){if(!a.trim())return;try{const y=H();if(!y)return;const A=await je("search",{searchQuery:y});A.status==="success"?(t(1,p=A.results),console.log("Response results"),console.log(p)):(t(2,m=`Search failed: ${A.status}`),console.error("Search failed:",A))}catch(y){t(2,m=`Error in Tauri search: ${y}`),console.error("Error in Tauri search:",y)}}else{if(!a.trim())return;const y=H();if(!y)return;const A=JSON.stringify(y);try{const M=await fetch(o,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:A}),Z=await M.json();if(!M.ok)throw new Error(`HTTP error! Status: ${M.status}`);t(1,p=Z.results)}catch(M){console.error("Error fetching data:",M),t(2,m=`Error fetching data: ${M}`)}}}function W(y){a=y,Bt.set(a)}const oe=y=>E(y),le=(y,A)=>{(A.key==="Enter"||A.key===" ")&&(A.preventDefault(),E(y))},z=y=>J(y.value),Q=y=>J(y.value),I=()=>C(a),U=()=>window.location.href="/config/wizard";return l.$$.update=()=>{l.$$.dirty[0]&262144&&(n=Object.entries(i)),l.$$.dirty[0]&196609&&a&&!w&&(a.includes(" AND ")||a.includes(" OR ")||a.includes(" and ")||a.includes(" or "))&&($&&clearTimeout($),t(17,$=setTimeout(()=>{C(a),t(17,$=null)},300)))},[a,p,m,_,g,b,v,u,d,C,F,O,E,J,D,ne,w,$,i,W,oe,le,z,Q,I,U]}class ka extends _t{constructor(e){super(),gt(this,e,ba,va,pt,{},null,[-1,-1])}}async function bo(l={}){return typeof l=="object"&&Object.freeze(l),Zl({__tauriModule:"Dialog",message:{cmd:"openDialog",options:l}})}function ko(l,e,t){const n=l.slice();return n[71]=e[t],n[79]=t,n}function wo(l,e,t){const n=l.slice();return n[77]=e[t],n[78]=e,n[79]=t,n}function yo(l,e,t){const n=l.slice();return n[80]=e[t],n}function $o(l,e,t){const n=l.slice();return n[80]=e[t],n}function Co(l,e,t){const n=l.slice();return n[85]=e[t],n[86]=e,n[87]=t,n}function To(l,e,t){const n=l.slice();return n[88]=e[t][0],n[89]=e[t][1],n[90]=e,n[91]=t,n}function So(l,e,t){const n=l.slice();return n[74]=e[t],n}function Ro(l,e,t){const n=l.slice();return n[71]=e[t],n}function Ao(l,e,t){const n=l.slice();return n[74]=e[t],n}function Eo(l){let e,t,n,o,a;return{c(){e=f("div"),t=f("button"),n=P(`
      Configuration saved successfully!`),c(t,"class","delete"),c(e,"class","notification is-success"),c(e,"data-testid","wizard-success")},m(s,u){R(s,e,u),r(e,t),r(e,n),o||(a=se(t,"click",l[20]),o=!0)},p:Re,d(s){s&&S(e),o=!1,a()}}}function Lo(l){let e,t,n,o,a;return{c(){e=f("div"),t=f("button"),n=P(`
      Failed to save configuration. Please try again.`),c(t,"class","delete"),c(e,"class","notification is-danger"),c(e,"data-testid","wizard-error")},m(s,u){R(s,e,u),r(e,t),r(e,n),o||(a=se(t,"click",l[21]),o=!0)},p:Re,d(s){s&&S(e),o=!1,a()}}}function wa(l){let e,t,n,o,a,s,u,i,d,p=l[3].id+"",m,_,g,b,v,w=l[3].global_shortcut+"",$,C,k,T,F,O=l[3].default_theme+"",N,E,H,ee,J,L=l[3].default_role+"",D,ne,W,oe,le,z,Q=JSON.stringify(l[3],null,2)+"",I,U=l[3].roles,y=[];for(let A=0;A<U.length;A+=1)y[A]=Do(ko(l,U,A));return{c(){e=f("h4"),e.textContent="Review",t=h(),n=f("div"),o=f("h5"),o.textContent="Configuration Summary:",a=h(),s=f("ul"),u=f("li"),i=f("strong"),i.textContent="Configuration ID:",d=h(),m=P(p),_=h(),g=f("li"),b=f("strong"),b.textContent="Global Shortcut:",v=h(),$=P(w),C=h(),k=f("li"),T=f("strong"),T.textContent="Default Theme:",F=h(),N=P(O),E=h(),H=f("li"),ee=f("strong"),ee.textContent="Default Role:",J=h(),D=P(L),ne=h(),W=f("h5"),W.textContent="Roles:",oe=h();for(let A=0;A<y.length;A+=1)y[A].c();le=h(),z=f("pre"),I=P(Q),c(e,"class","title is-5"),c(n,"class","content"),we(z,"max-height","300px"),we(z,"overflow","auto")},m(A,M){R(A,e,M),R(A,t,M),R(A,n,M),r(n,o),r(n,a),r(n,s),r(s,u),r(u,i),r(u,d),r(u,m),r(s,_),r(s,g),r(g,b),r(g,v),r(g,$),r(s,C),r(s,k),r(k,T),r(k,F),r(k,N),r(s,E),r(s,H),r(H,ee),r(H,J),r(H,D),r(n,ne),r(n,W),r(n,oe);for(let Z=0;Z<y.length;Z+=1)y[Z]&&y[Z].m(n,null);R(A,le,M),R(A,z,M),r(z,I)},p(A,M){if(M[0]&8&&p!==(p=A[3].id+"")&&ve(m,p),M[0]&8&&w!==(w=A[3].global_shortcut+"")&&ve($,w),M[0]&8&&O!==(O=A[3].default_theme+"")&&ve(N,O),M[0]&8&&L!==(L=A[3].default_role+"")&&ve(D,L),M[0]&10){U=A[3].roles;let Z;for(Z=0;Z<U.length;Z+=1){const V=ko(A,U,Z);y[Z]?y[Z].p(V,M):(y[Z]=Do(V),y[Z].c(),y[Z].m(n,null))}for(;Z<y.length;Z+=1)y[Z].d(1);y.length=U.length}M[0]&8&&Q!==(Q=JSON.stringify(A[3],null,2)+"")&&ve(I,Q)},d(A){A&&S(e),A&&S(t),A&&S(n),tt(y,A),A&&S(le),A&&S(z)}}}function ya(l){let e,t,n=[],o=new Map,a,s,u,i,d=l[3].roles;const p=m=>m[77].name;for(let m=0;m<d.length;m+=1){let _=wo(l,d,m),g=p(_);o.set(g,n[m]=Bo(g,_))}return{c(){e=f("h4"),e.textContent="Roles",t=h();for(let m=0;m<n.length;m+=1)n[m].c();a=h(),s=f("button"),s.textContent="Add Role",c(e,"class","title is-5"),c(s,"class","button is-link is-light"),c(s,"data-testid","add-role")},m(m,_){R(m,e,_),R(m,t,_);for(let g=0;g<n.length;g+=1)n[g]&&n[g].m(m,_);R(m,a,_),R(m,s,_),u||(i=se(s,"click",l[12]),u=!0)},p(m,_){_[0]&516985&&(d=m[3].roles,n=fr(n,_,p,1,m,d,o,a.parentNode,dr,Bo,a,wo))},d(m){m&&S(e),m&&S(t);for(let _=0;_<n.length;_+=1)n[_].d(m);m&&S(a),m&&S(s),u=!1,i()}}}function $a(l){let e,t,n,o,a,s,u,i,d,p,m,_,g,b,v,w,$,C,k,T,F,O,N,E,H,ee,J,L,D,ne,W,oe=l[8],le=[];for(let I=0;I<oe.length;I+=1)le[I]=Jo(Ao(l,oe,I));let z=l[3].roles,Q=[];for(let I=0;I<z.length;I+=1)Q[I]=Vo(Ro(l,z,I));return{c(){e=f("div"),t=f("label"),t.textContent="Configuration ID",n=h(),o=f("div"),a=f("div"),s=f("select"),u=f("option"),u.textContent="Desktop",i=f("option"),i.textContent="Server",d=f("option"),d.textContent="Embedded",p=h(),m=f("div"),_=f("label"),_.textContent="Global shortcut",g=h(),b=f("div"),v=f("input"),w=h(),$=f("div"),C=f("label"),C.textContent="Default theme",k=h(),T=f("div"),F=f("div"),O=f("select");for(let I=0;I<le.length;I+=1)le[I].c();N=h(),E=f("div"),H=f("label"),H.textContent="Default Role",ee=h(),J=f("div"),L=f("div"),D=f("select");for(let I=0;I<Q.length;I+=1)Q[I].c();c(t,"class","label"),c(t,"for","config-id"),u.__value="Desktop",u.value=u.__value,i.__value="Server",i.value=i.__value,d.__value="Embedded",d.value=d.__value,c(s,"id","config-id"),l[3].id===void 0&&mt(()=>l[22].call(s)),c(a,"class","select"),c(o,"class","control"),c(e,"class","field"),c(_,"class","label"),c(_,"for","global-shortcut"),c(v,"class","input"),c(v,"id","global-shortcut"),c(v,"type","text"),c(b,"class","control"),c(m,"class","field"),c(C,"class","label"),c(C,"for","default-theme"),c(O,"id","default-theme"),l[3].default_theme===void 0&&mt(()=>l[24].call(O)),c(F,"class","select is-fullwidth"),c(T,"class","control"),c($,"class","field"),c(H,"class","label"),c(H,"for","default-role"),c(D,"id","default-role"),l[3].default_role===void 0&&mt(()=>l[25].call(D)),c(L,"class","select"),c(J,"class","control"),c(E,"class","field")},m(I,U){R(I,e,U),r(e,t),r(e,n),r(e,o),r(o,a),r(a,s),r(s,u),r(s,i),r(s,d),Je(s,l[3].id,!0),R(I,p,U),R(I,m,U),r(m,_),r(m,g),r(m,b),r(b,v),Ie(v,l[3].global_shortcut),R(I,w,U),R(I,$,U),r($,C),r($,k),r($,T),r(T,F),r(F,O);for(let y=0;y<le.length;y+=1)le[y]&&le[y].m(O,null);Je(O,l[3].default_theme,!0),R(I,N,U),R(I,E,U),r(E,H),r(E,ee),r(E,J),r(J,L),r(L,D);for(let y=0;y<Q.length;y+=1)Q[y]&&Q[y].m(D,null);Je(D,l[3].default_role,!0),ne||(W=[se(s,"change",l[22]),se(v,"input",l[23]),se(O,"change",l[24]),se(D,"change",l[25])],ne=!0)},p(I,U){if(U[0]&264&&Je(s,I[3].id),U[0]&264&&v.value!==I[3].global_shortcut&&Ie(v,I[3].global_shortcut),U[0]&256){oe=I[8];let y;for(y=0;y<oe.length;y+=1){const A=Ao(I,oe,y);le[y]?le[y].p(A,U):(le[y]=Jo(A),le[y].c(),le[y].m(O,null))}for(;y<le.length;y+=1)le[y].d(1);le.length=oe.length}if(U[0]&264&&Je(O,I[3].default_theme),U[0]&8){z=I[3].roles;let y;for(y=0;y<z.length;y+=1){const A=Ro(I,z,y);Q[y]?Q[y].p(A,U):(Q[y]=Vo(A),Q[y].c(),Q[y].m(D,null))}for(;y<Q.length;y+=1)Q[y].d(1);Q.length=z.length}U[0]&264&&Je(D,I[3].default_role)},d(I){I&&S(e),I&&S(p),I&&S(m),I&&S(w),I&&S($),tt(le,I),I&&S(N),I&&S(E),tt(Q,I),ne=!1,Ze(W)}}}function Do(l){let e,t,n=l[71].name+"",o,a,s,u,i,d=l[71].shortname+"",p,m,_,g,b,v=l[71].theme+"",w,$,C,k,T,F=l[71].relevance_function+"",O,N,E,H,ee,J;return{c(){e=f("div"),t=f("h6"),o=P(n),a=h(),s=f("p"),u=f("strong"),u.textContent="Shortname:",i=h(),p=P(d),m=h(),_=f("p"),g=f("strong"),g.textContent="Theme:",b=h(),w=P(v),$=h(),C=f("p"),k=f("strong"),k.textContent="Relevance Function:",T=h(),O=P(F),N=h(),E=f("button"),E.textContent="Edit Role",H=h(),c(t,"data-testid","review-role-name-"+l[79]),c(E,"class","button is-small"),c(E,"data-testid","edit-role-"+l[79]),c(e,"class","box")},m(L,D){R(L,e,D),r(e,t),r(t,o),r(e,a),r(e,s),r(s,u),r(s,i),r(s,p),r(e,m),r(e,_),r(_,g),r(_,b),r(_,w),r(e,$),r(e,C),r(C,k),r(C,T),r(C,O),r(e,N),r(e,E),r(e,H),ee||(J=se(E,"click",l[68]),ee=!0)},p(L,D){D[0]&8&&n!==(n=L[71].name+"")&&ve(o,n),D[0]&8&&d!==(d=L[71].shortname+"")&&ve(p,d),D[0]&8&&v!==(v=L[71].theme+"")&&ve(w,v),D[0]&8&&F!==(F=L[71].relevance_function+"")&&ve(O,F)},d(L){L&&S(e),ee=!1,J()}}}function Io(l){let e,t=l[74]+"",n;return{c(){e=f("option"),n=P(t),e.__value=l[74],e.value=e.__value},m(o,a){R(o,e,a),r(e,n)},p:Re,d(o){o&&S(e)}}}function Ca(l){let e;return{c(){e=P("Directory Path")},m(t,n){R(t,e,n)},d(t){t&&S(e)}}}function Ta(l){let e;return{c(){e=P("Server URL")},m(t,n){R(t,e,n)},d(t){t&&S(e)}}}function No(l){let e;return{c(){e=f("p"),e.textContent="Click to select directory",c(e,"class","help")},m(t,n){R(t,e,n)},d(t){t&&S(e)}}}function Oo(l){let e,t,n,o,a,s,u,i,d,p,m,_;function g(){l[34].call(u,l[79],l[87])}return{c(){e=f("div"),t=f("label"),n=P("Atomic Server Secret"),a=h(),s=f("div"),u=f("input"),d=h(),p=f("p"),p.textContent="Leave empty for anonymous access",c(t,"class","label"),c(t,"for",o=`haystack-secret-${l[79]}-${l[87]}`),c(u,"class","input"),c(u,"id",i=`haystack-secret-${l[79]}-${l[87]}`),c(u,"type","password"),c(u,"placeholder","Base64 encoded secret (optional)"),c(s,"class","control"),c(p,"class","help"),c(e,"class","field")},m(b,v){R(b,e,v),r(e,t),r(t,n),r(e,a),r(e,s),r(s,u),Ie(u,l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret),r(e,d),r(e,p),m||(_=se(u,"input",g),m=!0)},p(b,v){l=b,v[0]&264&&o!==(o=`haystack-secret-${l[79]}-${l[87]}`)&&c(t,"for",o),v[0]&264&&i!==(i=`haystack-secret-${l[79]}-${l[87]}`)&&c(u,"id",i),v[0]&264&&u.value!==l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret&&Ie(u,l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret)},d(b){b&&S(e),m=!1,_()}}}function Po(l){let e,t,n,o,a,s,u,i,d,p,m,_,g,b,v,w,$,C,k,T,F,O,N,E,H,ee,J,L,D,ne,W,oe,le,z,Q,I,U,y,A,M,Z,V,X;function Y(){l[35].call(p,l[79],l[87])}function re(...x){return l[36](l[79],l[87],...x)}let pe=Object.entries(l[3].roles[l[79]].haystacks[l[87]].extra_parameters||{}),ie=[];for(let x=0;x<pe.length;x+=1)ie[x]=Mo(To(l,pe,x));function ae(){return l[40](l[79],l[87])}function be(){return l[41](l[79],l[87])}function K(){return l[42](l[79],l[87])}return{c(){e=f("div"),t=f("label"),t.textContent="Extra Parameters (for filtering)",n=h(),o=f("div"),a=f("div"),s=f("label"),u=P("Hashtag"),d=h(),p=f("input"),_=h(),g=f("div"),b=f("div"),v=f("label"),w=P("Presets"),C=h(),k=f("div"),T=f("select"),F=f("option"),F.textContent="(choose)",O=f("option"),O.textContent="#rust",N=f("option"),N.textContent="#docs",E=f("option"),E.textContent="#test",H=f("option"),H.textContent="#todo",J=h(),L=f("p"),L.innerHTML="When set, searches will enforce the hashtag alongside your query (AND), e.g. <code>-e &quot;search&quot; -e &quot;#rust&quot;</code>.",D=h();for(let x=0;x<ie.length;x+=1)ie[x].c();ne=h(),W=f("div"),oe=f("div"),le=f("button"),le.textContent="+ Tag Filter",z=h(),Q=f("div"),I=f("button"),I.textContent="+ Max Results",U=h(),y=f("div"),A=f("button"),A.textContent="+ Custom Parameter",M=h(),Z=f("p"),Z.innerHTML=`Common parameters: <code>tag</code> (e.g., &quot;#rust&quot;), <code>glob</code> (e.g., &quot;*.md&quot;),
                  <code>max_count</code> (e.g., &quot;10&quot;), <code>context</code> (e.g., &quot;5&quot;)`,c(t,"class","label"),c(s,"class","label"),c(s,"for",i=`ripgrep-hashtag-${l[79]}-${l[87]}`),c(p,"class","input"),c(p,"id",m=`ripgrep-hashtag-${l[79]}-${l[87]}`),c(p,"type","text"),c(p,"placeholder","#rust"),c(a,"class","control"),c(o,"class","field is-grouped"),c(v,"class","label"),c(v,"for",$=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`),F.__value="",F.value=F.__value,O.__value="#rust",O.value=O.__value,N.__value="#docs",N.value=N.__value,E.__value="#test",E.value=E.__value,H.__value="#todo",H.value=H.__value,c(T,"id",ee=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`),c(k,"class","select is-small"),c(b,"class","control"),c(g,"class","field is-grouped"),we(g,"margin-bottom",".5rem"),c(L,"class","help"),c(le,"class","button is-small is-link is-light"),c(oe,"class","control"),c(I,"class","button is-small is-link is-light"),c(Q,"class","control"),c(A,"class","button is-small is-link is-light"),c(y,"class","control"),c(W,"class","field is-grouped"),c(Z,"class","help"),c(e,"class","field")},m(x,ce){R(x,e,ce),r(e,t),r(e,n),r(e,o),r(o,a),r(a,s),r(s,u),r(a,d),r(a,p),Ie(p,l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag),r(e,_),r(e,g),r(g,b),r(b,v),r(v,w),r(b,C),r(b,k),r(k,T),r(T,F),r(T,O),r(T,N),r(T,E),r(T,H),r(e,J),r(e,L),r(e,D);for(let me=0;me<ie.length;me+=1)ie[me]&&ie[me].m(e,null);r(e,ne),r(e,W),r(W,oe),r(oe,le),r(W,z),r(W,Q),r(Q,I),r(W,U),r(W,y),r(y,A),r(e,M),r(e,Z),V||(X=[se(p,"input",Y),se(T,"change",re),se(le,"click",ae),se(I,"click",be),se(A,"click",K)],V=!0)},p(x,ce){if(l=x,ce[0]&264&&i!==(i=`ripgrep-hashtag-${l[79]}-${l[87]}`)&&c(s,"for",i),ce[0]&264&&m!==(m=`ripgrep-hashtag-${l[79]}-${l[87]}`)&&c(p,"id",m),ce[0]&264&&p.value!==l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag&&Ie(p,l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag),ce[0]&264&&$!==($=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`)&&c(v,"for",$),ce[0]&264&&ee!==(ee=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`)&&c(T,"id",ee),ce[0]&393224){pe=Object.entries(l[3].roles[l[79]].haystacks[l[87]].extra_parameters||{});let me;for(me=0;me<pe.length;me+=1){const ke=To(l,pe,me);ie[me]?ie[me].p(ke,ce):(ie[me]=Mo(ke),ie[me].c(),ie[me].m(e,ne))}for(;me<ie.length;me+=1)ie[me].d(1);ie.length=pe.length}},d(x){x&&S(e),tt(ie,x),V=!1,Ze(X)}}}function Mo(l){let e,t,n,o,a,s,u,i,d,p,m,_,g;function b(...$){return l[37](l[79],l[87],l[88],...$)}function v(){l[38].call(u,l[79],l[87],l[88])}function w(){return l[39](l[79],l[87],l[88])}return{c(){e=f("div"),t=f("div"),n=f("input"),a=h(),s=f("div"),u=f("input"),i=h(),d=f("div"),p=f("button"),p.textContent="×",m=h(),c(n,"class","input"),c(n,"type","text"),c(n,"placeholder","Parameter name"),n.value=o=l[88],c(t,"class","control"),c(u,"class","input"),c(u,"type","text"),c(u,"placeholder","Parameter value"),c(s,"class","control is-expanded"),c(p,"class","button is-small is-danger"),c(d,"class","control"),c(e,"class","field is-grouped")},m($,C){R($,e,C),r(e,t),r(t,n),r(e,a),r(e,s),r(s,u),Ie(u,l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]]),r(e,i),r(e,d),r(d,p),r(e,m),_||(g=[se(n,"blur",b),se(u,"input",v),se(p,"click",w)],_=!0)},p($,C){l=$,C[0]&264&&o!==(o=l[88])&&n.value!==o&&(n.value=o),C[0]&264&&u.value!==l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]]&&Ie(u,l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]])},d($){$&&S(e),_=!1,Ze(g)}}}function jo(l){let e,t,n,o,a,s,u,i,d,p,m,_,g,b,v,w,$,C,k,T,F,O,N,E,H,ee,J,L,D,ne,W,oe,le,z,Q,I,U,y,A;function M(){l[31].call(d,l[79],l[87])}function Z(x,ce){return x[3].roles[x[79]].haystacks[x[87]].service==="Atomic"?Ta:Ca}let V=Z(l),X=V(l);function Y(){l[32].call(k,l[79],l[87])}function re(){return l[33](l[79],l[87])}let pe=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"&&No(),ie=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"&&Oo(l),ae=l[3].roles[l[79]].haystacks[l[87]].service==="Ripgrep"&&Po(l);function be(){l[43].call(D,l[79],l[87])}function K(){return l[44](l[79],l[87])}return{c(){e=f("div"),t=f("div"),n=f("label"),o=P("Service Type"),s=h(),u=f("div"),i=f("div"),d=f("select"),p=f("option"),p.textContent="Ripgrep (File Search)",m=f("option"),m.textContent="Atomic Server",g=h(),b=f("div"),v=f("label"),X.c(),$=h(),C=f("div"),k=f("input"),N=h(),pe&&pe.c(),E=h(),ie&&ie.c(),H=h(),ae&&ae.c(),ee=h(),J=f("div"),L=f("label"),D=f("input"),W=P(`
                 Read-only`),le=h(),z=f("div"),Q=f("button"),I=P("Remove Haystack"),c(n,"class","label"),c(n,"for",a=`haystack-service-${l[79]}-${l[87]}`),p.__value="Ripgrep",p.value=p.__value,m.__value="Atomic",m.value=m.__value,c(d,"id",_=`haystack-service-${l[79]}-${l[87]}`),l[3].roles[l[79]].haystacks[l[87]].service===void 0&&mt(M),c(i,"class","select"),c(u,"class","control"),c(t,"class","field"),c(v,"class","label"),c(v,"for",w=`haystack-path-${l[79]}-${l[87]}`),c(k,"class","input"),c(k,"id",T=`haystack-path-${l[79]}-${l[87]}`),c(k,"type","text"),c(k,"placeholder",F=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?"https://localhost:9883":"/path/to/documents"),k.readOnly=O=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic",c(C,"class","control"),c(b,"class","field"),c(D,"id",ne=`haystack-readonly-${l[79]}-${l[87]}`),c(D,"type","checkbox"),c(L,"class","checkbox"),c(L,"for",oe=`haystack-readonly-${l[79]}-${l[87]}`),c(J,"class","field"),c(Q,"class","button is-small is-danger"),c(Q,"data-testid",U="remove-haystack-"+l[79]+"-"+l[87]),c(z,"class","field"),c(e,"class","box is-light")},m(x,ce){R(x,e,ce),r(e,t),r(t,n),r(n,o),r(t,s),r(t,u),r(u,i),r(i,d),r(d,p),r(d,m),Je(d,l[3].roles[l[79]].haystacks[l[87]].service,!0),r(e,g),r(e,b),r(b,v),X.m(v,null),r(b,$),r(b,C),r(C,k),Ie(k,l[3].roles[l[79]].haystacks[l[87]].path),r(C,N),pe&&pe.m(C,null),r(e,E),ie&&ie.m(e,null),r(e,H),ae&&ae.m(e,null),r(e,ee),r(e,J),r(J,L),r(L,D),D.checked=l[3].roles[l[79]].haystacks[l[87]].read_only,r(L,W),r(e,le),r(e,z),r(z,Q),r(Q,I),y||(A=[se(d,"change",M),se(k,"input",Y),se(k,"click",function(){Vl(l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?re:void 0)&&(l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?re:void 0).apply(this,arguments)}),se(D,"change",be),se(Q,"click",K)],y=!0)},p(x,ce){l=x,ce[0]&264&&a!==(a=`haystack-service-${l[79]}-${l[87]}`)&&c(n,"for",a),ce[0]&264&&_!==(_=`haystack-service-${l[79]}-${l[87]}`)&&c(d,"id",_),ce[0]&264&&Je(d,l[3].roles[l[79]].haystacks[l[87]].service),V!==(V=Z(l))&&(X.d(1),X=V(l),X&&(X.c(),X.m(v,null))),ce[0]&264&&w!==(w=`haystack-path-${l[79]}-${l[87]}`)&&c(v,"for",w),ce[0]&264&&T!==(T=`haystack-path-${l[79]}-${l[87]}`)&&c(k,"id",T),ce[0]&264&&F!==(F=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?"https://localhost:9883":"/path/to/documents")&&c(k,"placeholder",F),ce[0]&280&&O!==(O=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic")&&(k.readOnly=O),ce[0]&264&&k.value!==l[3].roles[l[79]].haystacks[l[87]].path&&Ie(k,l[3].roles[l[79]].haystacks[l[87]].path),l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?pe||(pe=No(),pe.c(),pe.m(C,null)):pe&&(pe.d(1),pe=null),l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?ie?ie.p(l,ce):(ie=Oo(l),ie.c(),ie.m(e,H)):ie&&(ie.d(1),ie=null),l[3].roles[l[79]].haystacks[l[87]].service==="Ripgrep"?ae?ae.p(l,ce):(ae=Po(l),ae.c(),ae.m(e,ee)):ae&&(ae.d(1),ae=null),ce[0]&264&&ne!==(ne=`haystack-readonly-${l[79]}-${l[87]}`)&&c(D,"id",ne),ce[0]&264&&(D.checked=l[3].roles[l[79]].haystacks[l[87]].read_only),ce[0]&264&&oe!==(oe=`haystack-readonly-${l[79]}-${l[87]}`)&&c(L,"for",oe),ce[0]&264&&U!==(U="remove-haystack-"+l[79]+"-"+l[87])&&c(Q,"data-testid",U)},d(x){x&&S(e),X.d(),pe&&pe.d(),ie&&ie.d(),ae&&ae.d(),y=!1,Ze(A)}}}function Uo(l){var Q;let e,t,n,o,a,s,u,i,d,p,m,_,g,b,v,w,$,C,k,T,F,O,N,E,H,ee,J,L,D;function ne(){l[47].call(u,l[79])}function W(){return l[48](l[79])}let oe=((Q=l[0][l[79]])==null?void 0:Q.length)&&zo(l);function le(){l[50].call(k,l[79])}function z(){l[51].call(E,l[79])}return{c(){e=f("div"),t=f("label"),n=P("Model"),a=h(),s=f("div"),u=f("input"),d=h(),p=f("button"),p.textContent="Fetch models",m=h(),oe&&oe.c(),_=h(),g=f("div"),b=f("label"),v=P("Base URL"),$=h(),C=f("div"),k=f("input"),F=h(),O=f("div"),N=f("label"),E=f("input"),ee=P(`
               Automatically summarize search results`),c(t,"class","label"),c(t,"for",o=`llm-model-${l[79]}`),c(u,"class","input"),c(u,"id",i=`llm-model-${l[79]}`),c(u,"type","text"),c(u,"placeholder","llama3.1"),c(s,"class","control"),c(p,"class","button is-small"),c(e,"class","field"),c(b,"class","label"),c(b,"for",w=`llm-base-url-${l[79]}`),c(k,"class","input"),c(k,"id",T=`llm-base-url-${l[79]}`),c(k,"type","text"),c(k,"placeholder","http://127.0.0.1:11434"),c(C,"class","control"),c(g,"class","field"),c(E,"id",H=`llm-auto-summarize-${l[79]}`),c(E,"type","checkbox"),c(N,"class","checkbox"),c(N,"for",J=`llm-auto-summarize-${l[79]}`),c(O,"class","field")},m(I,U){R(I,e,U),r(e,t),r(t,n),r(e,a),r(e,s),r(s,u),Ie(u,l[3].roles[l[79]].llm_model),r(e,d),r(e,p),r(e,m),oe&&oe.m(e,null),R(I,_,U),R(I,g,U),r(g,b),r(b,v),r(g,$),r(g,C),r(C,k),Ie(k,l[3].roles[l[79]].llm_base_url),R(I,F,U),R(I,O,U),r(O,N),r(N,E),E.checked=l[3].roles[l[79]].llm_auto_summarize,r(N,ee),L||(D=[se(u,"input",ne),se(p,"click",W),se(k,"input",le),se(E,"change",z)],L=!0)},p(I,U){var y;l=I,U[0]&264&&o!==(o=`llm-model-${l[79]}`)&&c(t,"for",o),U[0]&264&&i!==(i=`llm-model-${l[79]}`)&&c(u,"id",i),U[0]&264&&u.value!==l[3].roles[l[79]].llm_model&&Ie(u,l[3].roles[l[79]].llm_model),(y=l[0][l[79]])!=null&&y.length?oe?oe.p(l,U):(oe=zo(l),oe.c(),oe.m(e,null)):oe&&(oe.d(1),oe=null),U[0]&264&&w!==(w=`llm-base-url-${l[79]}`)&&c(b,"for",w),U[0]&264&&T!==(T=`llm-base-url-${l[79]}`)&&c(k,"id",T),U[0]&264&&k.value!==l[3].roles[l[79]].llm_base_url&&Ie(k,l[3].roles[l[79]].llm_base_url),U[0]&264&&H!==(H=`llm-auto-summarize-${l[79]}`)&&c(E,"id",H),U[0]&264&&(E.checked=l[3].roles[l[79]].llm_auto_summarize),U[0]&264&&J!==(J=`llm-auto-summarize-${l[79]}`)&&c(N,"for",J)},d(I){I&&S(e),oe&&oe.d(),I&&S(_),I&&S(g),I&&S(F),I&&S(O),L=!1,Ze(D)}}}function zo(l){let e,t,n,o,a=l[0][l[79]],s=[];for(let i=0;i<a.length;i+=1)s[i]=Ho($o(l,a,i));function u(...i){return l[49](l[79],...i)}return{c(){e=f("div"),t=f("select");for(let i=0;i<s.length;i+=1)s[i].c();c(e,"class","select is-fullwidth"),we(e,"margin-top","0.5rem")},m(i,d){R(i,e,d),r(e,t);for(let p=0;p<s.length;p+=1)s[p]&&s[p].m(t,null);n||(o=se(t,"change",u),n=!0)},p(i,d){if(l=i,d[0]&9){a=l[0][l[79]];let p;for(p=0;p<a.length;p+=1){const m=$o(l,a,p);s[p]?s[p].p(m,d):(s[p]=Ho(m),s[p].c(),s[p].m(t,null))}for(;p<s.length;p+=1)s[p].d(1);s.length=a.length}},d(i){i&&S(e),tt(s,i),n=!1,o()}}}function Ho(l){let e,t=l[80]+"",n,o;return{c(){e=f("option"),n=P(t),e.__value=o=l[80],e.value=e.__value},m(a,s){R(a,e,s),r(e,n)},p(a,s){s[0]&9&&t!==(t=a[80]+"")&&ve(n,t),s[0]&265&&o!==(o=a[80])&&(e.__value=o,e.value=e.__value)},d(a){a&&S(e)}}}function Fo(l){var ce;let e,t,n,o,a,s,u,i,d,p,m,_,g,b,v,w,$,C,k,T,F,O,N,E,H,ee,J,L,D,ne,W,oe,le,z,Q,I,U,y,A,M,Z,V,X,Y;function re(){l[53].call(u,l[79])}function pe(){l[54].call(C,l[79])}function ie(){return l[55](l[79])}let ae=((ce=l[0][l[79]])==null?void 0:ce.length)&&Ko(l);function be(){l[57].call(L,l[79])}function K(){l[58].call(U,l[79])}let x=l[3].roles[l[79]].openrouter_chat_enabled&&qo(l);return{c(){e=f("div"),t=f("label"),n=P("OpenRouter API Key"),a=h(),s=f("div"),u=f("input"),d=h(),p=f("p"),p.innerHTML='Get your API key from <a href="https://openrouter.ai" target="_blank" rel="noopener">OpenRouter</a>',m=h(),_=f("div"),g=f("label"),b=P("Model"),w=h(),$=f("div"),C=f("input"),T=h(),F=f("button"),F.textContent="Fetch models",O=h(),ae&&ae.c(),N=h(),E=f("p"),E.textContent="Choose the language model for generating summaries. Different models offer different speed/quality tradeoffs.",H=h(),ee=f("div"),J=f("label"),L=f("input"),ne=P(`
               Automatically summarize search results`),oe=h(),le=f("p"),le.textContent="When enabled, summaries will be generated and shown in search results.",z=h(),Q=f("div"),I=f("label"),U=f("input"),A=P(`
               Enable Chat interface (OpenRouter)`),Z=h(),x&&x.c(),V=ut(),c(t,"class","label"),c(t,"for",o=`openrouter-api-key-${l[79]}`),c(u,"class","input"),c(u,"id",i=`openrouter-api-key-${l[79]}`),c(u,"type","password"),c(u,"placeholder","sk-or-v1-..."),c(s,"class","control"),c(p,"class","help"),c(e,"class","field"),c(g,"class","label"),c(g,"for",v=`openrouter-model-${l[79]}`),c(C,"class","input"),c(C,"id",k=`openrouter-model-${l[79]}`),c(C,"type","text"),c(C,"placeholder","openai/gpt-4-turbo"),c($,"class","control"),c(F,"class","button is-small"),c(E,"class","help"),c(_,"class","field"),c(L,"id",D=`openrouter-auto-summarize-${l[79]}`),c(L,"type","checkbox"),c(J,"class","checkbox"),c(J,"for",W=`openrouter-auto-summarize-${l[79]}`),c(le,"class","help"),c(ee,"class","field"),c(U,"id",y=`openrouter-chat-enabled-${l[79]}`),c(U,"type","checkbox"),c(I,"class","checkbox"),c(I,"for",M=`openrouter-chat-enabled-${l[79]}`),c(Q,"class","field")},m(me,ke){R(me,e,ke),r(e,t),r(t,n),r(e,a),r(e,s),r(s,u),Ie(u,l[3].roles[l[79]].openrouter_api_key),r(e,d),r(e,p),R(me,m,ke),R(me,_,ke),r(_,g),r(g,b),r(_,w),r(_,$),r($,C),Ie(C,l[3].roles[l[79]].openrouter_model),r(_,T),r(_,F),r(_,O),ae&&ae.m(_,null),r(_,N),r(_,E),R(me,H,ke),R(me,ee,ke),r(ee,J),r(J,L),L.checked=l[3].roles[l[79]].openrouter_auto_summarize,r(J,ne),r(ee,oe),r(ee,le),R(me,z,ke),R(me,Q,ke),r(Q,I),r(I,U),U.checked=l[3].roles[l[79]].openrouter_chat_enabled,r(I,A),R(me,Z,ke),x&&x.m(me,ke),R(me,V,ke),X||(Y=[se(u,"input",re),se(C,"input",pe),se(F,"click",ie),se(L,"change",be),se(U,"change",K)],X=!0)},p(me,ke){var Te;l=me,ke[0]&264&&o!==(o=`openrouter-api-key-${l[79]}`)&&c(t,"for",o),ke[0]&264&&i!==(i=`openrouter-api-key-${l[79]}`)&&c(u,"id",i),ke[0]&264&&u.value!==l[3].roles[l[79]].openrouter_api_key&&Ie(u,l[3].roles[l[79]].openrouter_api_key),ke[0]&264&&v!==(v=`openrouter-model-${l[79]}`)&&c(g,"for",v),ke[0]&264&&k!==(k=`openrouter-model-${l[79]}`)&&c(C,"id",k),ke[0]&264&&C.value!==l[3].roles[l[79]].openrouter_model&&Ie(C,l[3].roles[l[79]].openrouter_model),(Te=l[0][l[79]])!=null&&Te.length?ae?ae.p(l,ke):(ae=Ko(l),ae.c(),ae.m(_,N)):ae&&(ae.d(1),ae=null),ke[0]&264&&D!==(D=`openrouter-auto-summarize-${l[79]}`)&&c(L,"id",D),ke[0]&264&&(L.checked=l[3].roles[l[79]].openrouter_auto_summarize),ke[0]&264&&W!==(W=`openrouter-auto-summarize-${l[79]}`)&&c(J,"for",W),ke[0]&264&&y!==(y=`openrouter-chat-enabled-${l[79]}`)&&c(U,"id",y),ke[0]&264&&(U.checked=l[3].roles[l[79]].openrouter_chat_enabled),ke[0]&264&&M!==(M=`openrouter-chat-enabled-${l[79]}`)&&c(I,"for",M),l[3].roles[l[79]].openrouter_chat_enabled?x?x.p(l,ke):(x=qo(l),x.c(),x.m(V.parentNode,V)):x&&(x.d(1),x=null)},d(me){me&&S(e),me&&S(m),me&&S(_),ae&&ae.d(),me&&S(H),me&&S(ee),me&&S(z),me&&S(Q),me&&S(Z),x&&x.d(me),me&&S(V),X=!1,Ze(Y)}}}function Ko(l){let e,t,n,o,a=l[0][l[79]],s=[];for(let i=0;i<a.length;i+=1)s[i]=Go(yo(l,a,i));function u(...i){return l[56](l[79],...i)}return{c(){e=f("div"),t=f("select");for(let i=0;i<s.length;i+=1)s[i].c();c(e,"class","select is-fullwidth"),we(e,"margin-top","0.5rem")},m(i,d){R(i,e,d),r(e,t);for(let p=0;p<s.length;p+=1)s[p]&&s[p].m(t,null);n||(o=se(t,"change",u),n=!0)},p(i,d){if(l=i,d[0]&9){a=l[0][l[79]];let p;for(p=0;p<a.length;p+=1){const m=yo(l,a,p);s[p]?s[p].p(m,d):(s[p]=Go(m),s[p].c(),s[p].m(t,null))}for(;p<s.length;p+=1)s[p].d(1);s.length=a.length}},d(i){i&&S(e),tt(s,i),n=!1,o()}}}function Go(l){let e,t=l[80]+"",n,o;return{c(){e=f("option"),n=P(t),e.__value=o=l[80],e.value=e.__value},m(a,s){R(a,e,s),r(e,n)},p(a,s){s[0]&9&&t!==(t=a[80]+"")&&ve(n,t),s[0]&265&&o!==(o=a[80])&&(e.__value=o,e.value=e.__value)},d(a){a&&S(e)}}}function qo(l){let e,t,n,o,a,s,u,i,d,p,m,_,g,b,v,w,$,C,k,T,F,O,N,E,H;function ee(){l[59].call(i,l[79])}function J(){l[60].call(O,l[79])}return{c(){e=f("div"),t=f("label"),n=P("Chat Model"),a=h(),s=f("div"),u=f("div"),i=f("select"),d=f("option"),d.textContent="GPT-3.5 Turbo",p=f("option"),p.textContent="GPT-4",m=f("option"),m.textContent="Claude 3 Sonnet",_=f("option"),_.textContent="Claude 3 Haiku",g=f("option"),g.textContent="Mixtral 8x7B",v=h(),w=f("div"),$=f("label"),C=P("System Prompt (optional)"),T=h(),F=f("div"),O=f("textarea"),c(t,"class","label"),c(t,"for",o=`openrouter-chat-model-${l[79]}`),d.__value="openai/gpt-3.5-turbo",d.value=d.__value,p.__value="openai/gpt-4",p.value=p.__value,m.__value="anthropic/claude-3-sonnet",m.value=m.__value,_.__value="anthropic/claude-3-haiku",_.value=_.__value,g.__value="mistralai/mixtral-8x7b-instruct",g.value=g.__value,c(i,"id",b=`openrouter-chat-model-${l[79]}`),l[3].roles[l[79]].openrouter_chat_model===void 0&&mt(ee),c(u,"class","select is-fullwidth"),c(s,"class","control"),c(e,"class","field"),c($,"class","label"),c($,"for",k=`openrouter-chat-system-${l[79]}`),c(O,"class","textarea"),c(O,"id",N=`openrouter-chat-system-${l[79]}`),c(O,"rows","3"),c(O,"placeholder","You are a helpful Rust engineer assistant..."),c(F,"class","control"),c(w,"class","field")},m(L,D){R(L,e,D),r(e,t),r(t,n),r(e,a),r(e,s),r(s,u),r(u,i),r(i,d),r(i,p),r(i,m),r(i,_),r(i,g),Je(i,l[3].roles[l[79]].openrouter_chat_model,!0),R(L,v,D),R(L,w,D),r(w,$),r($,C),r(w,T),r(w,F),r(F,O),Ie(O,l[3].roles[l[79]].openrouter_chat_system_prompt),E||(H=[se(i,"change",ee),se(O,"input",J)],E=!0)},p(L,D){l=L,D[0]&264&&o!==(o=`openrouter-chat-model-${l[79]}`)&&c(t,"for",o),D[0]&264&&b!==(b=`openrouter-chat-model-${l[79]}`)&&c(i,"id",b),D[0]&264&&Je(i,l[3].roles[l[79]].openrouter_chat_model),D[0]&264&&k!==(k=`openrouter-chat-system-${l[79]}`)&&c($,"for",k),D[0]&264&&N!==(N=`openrouter-chat-system-${l[79]}`)&&c(O,"id",N),D[0]&264&&Ie(O,l[3].roles[l[79]].openrouter_chat_system_prompt)},d(L){L&&S(e),L&&S(v),L&&S(w),E=!1,Ze(H)}}}function Wo(l){let e;return{c(){e=f("p"),e.textContent="Click to select directory",c(e,"class","help")},m(t,n){R(t,e,n)},d(t){t&&S(e)}}}function Bo(l,e){let t,n,o,a,s,u,i,d,p,m,_,g,b,v,w,$,C,k,T,F,O,N,E,H,ee,J,L,D,ne,W,oe,le,z,Q,I,U,y,A,M,Z,V,X,Y,re,pe,ie,ae,be,K,x,ce,me,ke,Te,Xe,Be,Ne,Pe,fe,Se,Me,xe,et,ye,ze,Ge,qe,Le,De,it,Oe,We,G,te,q,ue,Ce,$e,Qe,nt,de,Ae,ot,ft,Mt,at,qt,ll,Yt,gl,jt,yt,Xl,wl,xl,yl,Et,$l,en,nl,ol,tn,Cl,ln,Zt,ht,Tl,nn,on,Sl,sl,rl,sn,Rl,rn,Al,It,il,al,El,an,cl,Wt,Ut,Ll,cn,Dl,un,Xt,zt,Il,fn,Nl,dn,pn,mn,xt,_n,Ol,zl,gn;function Js(){e[26].call(d,e[79])}function Vs(){e[27].call(C,e[79])}let ul=e[8],vt=[];for(let Ye=0;Ye<ul.length;Ye+=1)vt[Ye]=Io(So(e,ul,Ye));function hn(){e[28].call(L,e[79])}function vn(){e[29].call(y,e[79])}function Qs(){e[30].call(ae,e[79])}let fl=e[77].haystacks,bt=[];for(let Ye=0;Ye<fl.length;Ye+=1)bt[Ye]=jo(Co(e,fl,Ye));function Ys(){return e[45](e[79])}function bn(){e[46].call(Le,e[79])}let kt=e[3].roles[e[79]].llm_provider==="ollama"&&Uo(e);function Zs(){e[52].call(de,e[79])}let wt=e[3].roles[e[79]].openrouter_enabled&&Fo(e);function Xs(){e[61].call(Et,e[79])}function xs(){e[62].call(ht,e[79])}function kn(){return e[63](e[79])}let $t=e[4]&&Wo();function wn(){e[64].call(It,e[79])}function er(){e[65].call(Ut,e[79])}function tr(){e[66].call(zt,e[79])}function lr(){return e[67](e[79])}return{key:l,first:null,c(){t=f("div"),n=f("div"),o=f("label"),a=P("Role name"),u=h(),i=f("div"),d=f("input"),m=h(),_=f("div"),g=f("label"),b=P("Short name"),w=h(),$=f("div"),C=f("input"),T=h(),F=f("div"),O=f("label"),N=P("Theme"),H=h(),ee=f("div"),J=f("div"),L=f("select");for(let Ye=0;Ye<vt.length;Ye+=1)vt[Ye].c();ne=h(),W=f("div"),oe=f("label"),le=P("Relevance function"),Q=h(),I=f("div"),U=f("div"),y=f("select"),A=f("option"),A.textContent="title-scorer",M=f("option"),M.textContent="terraphim-graph",Z=f("option"),Z.textContent="bm25",V=f("option"),V.textContent="bm25f",X=f("option"),X.textContent="bm25plus",re=h(),pe=f("div"),ie=f("label"),ae=f("input"),K=P(`
            Enable Terraphim IT features (KG preprocessing, auto-linking)`),ce=h(),me=f("h5"),me.textContent="Haystacks",ke=h();for(let Ye=0;Ye<bt.length;Ye+=1)bt[Ye].c();Te=h(),Xe=f("button"),Be=P("Add Haystack"),Pe=h(),fe=f("h5"),fe.textContent="AI-Enhanced Summaries (LLM Provider)",Se=h(),Me=f("div"),xe=f("label"),et=P("Provider"),ze=h(),Ge=f("div"),qe=f("div"),Le=f("select"),De=f("option"),De.textContent="(none)",it=f("option"),it.textContent="OpenRouter",Oe=f("option"),Oe.textContent="Ollama (local)",G=h(),te=f("p"),te.textContent="Choose a provider. OpenRouter uses API key; Ollama runs locally.",q=h(),kt&&kt.c(),ue=h(),Ce=f("h5"),Ce.textContent="AI-Enhanced Summaries (OpenRouter)",$e=h(),Qe=f("div"),nt=f("label"),de=f("input"),ot=P(`
             Enable AI-generated article summaries`),Mt=h(),at=f("p"),at.textContent="Generate intelligent summaries using OpenRouter's language models",qt=h(),wt&&wt.c(),ll=h(),Yt=f("h5"),Yt.textContent="Knowledge Graph",gl=h(),jt=f("div"),yt=f("label"),Xl=P("Remote automata URL"),xl=h(),yl=f("div"),Et=f("input"),en=h(),nl=f("div"),ol=f("label"),tn=P("Local KG path"),ln=h(),Zt=f("div"),ht=f("input"),nn=h(),$t&&$t.c(),on=h(),Sl=f("div"),sl=f("div"),rl=f("label"),sn=P("Local KG type"),rn=h(),Al=f("div"),It=f("select"),il=f("option"),il.textContent="markdown",al=f("option"),al.textContent="json",an=h(),cl=f("div"),Wt=f("label"),Ut=f("input"),cn=P(`
             Public`),un=h(),Xt=f("label"),zt=f("input"),fn=P(`
             Publish`),dn=h(),pn=f("hr"),mn=h(),xt=f("button"),_n=P("Remove Role"),c(o,"class","label"),c(o,"for",s=`role-name-${e[79]}`),c(d,"class","input"),c(d,"id",p=`role-name-${e[79]}`),c(d,"type","text"),c(i,"class","control"),c(n,"class","field"),c(g,"class","label"),c(g,"for",v=`role-shortname-${e[79]}`),c(C,"class","input"),c(C,"id",k=`role-shortname-${e[79]}`),c(C,"type","text"),c($,"class","control"),c(_,"class","field"),c(O,"class","label"),c(O,"for",E=`role-theme-${e[79]}`),c(L,"id",D=`role-theme-${e[79]}`),e[3].roles[e[79]].theme===void 0&&mt(hn),c(J,"class","select is-fullwidth"),c(ee,"class","control"),c(F,"class","field"),c(oe,"class","label"),c(oe,"for",z=`role-relevance-${e[79]}`),A.__value="title-scorer",A.value=A.__value,M.__value="terraphim-graph",M.value=M.__value,Z.__value="bm25",Z.value=Z.__value,V.__value="bm25f",V.value=V.__value,X.__value="bm25plus",X.value=X.__value,c(y,"id",Y=`role-relevance-${e[79]}`),e[3].roles[e[79]].relevance_function===void 0&&mt(vn),c(U,"class","select is-fullwidth"),c(I,"class","control"),c(W,"class","field"),c(ae,"class","checkbox"),c(ae,"id",be=`role-terraphim-it-${e[79]}`),c(ae,"type","checkbox"),c(ie,"class","label"),c(ie,"for",x=`role-terraphim-it-${e[79]}`),c(pe,"class","field"),c(me,"class","title is-6"),c(Xe,"class","button is-small"),c(Xe,"data-testid",Ne="add-haystack-"+e[79]),c(fe,"class","title is-6"),c(xe,"class","label"),c(xe,"for",ye=`llm-provider-${e[79]}`),De.__value="",De.value=De.__value,it.__value="openrouter",it.value=it.__value,Oe.__value="ollama",Oe.value=Oe.__value,c(Le,"id",We=`llm-provider-${e[79]}`),e[3].roles[e[79]].llm_provider===void 0&&mt(bn),c(qe,"class","select"),c(Ge,"class","control"),c(te,"class","help"),c(Me,"class","field"),c(Ce,"class","title is-6"),c(de,"id",Ae=`openrouter-enabled-${e[79]}`),c(de,"type","checkbox"),c(nt,"class","checkbox"),c(nt,"for",ft=`openrouter-enabled-${e[79]}`),c(at,"class","help"),c(Qe,"class","field"),c(Yt,"class","title is-6"),c(yt,"class","label"),c(yt,"for",wl=`kg-url-${e[79]}`),c(Et,"class","input"),c(Et,"id",$l=`kg-url-${e[79]}`),c(Et,"type","text"),c(Et,"placeholder","https://example.com/thesaurus.json"),c(yl,"class","control"),c(jt,"class","field"),c(ol,"class","label"),c(ol,"for",Cl=`kg-local-path-${e[79]}`),c(ht,"class","input"),c(ht,"id",Tl=`kg-local-path-${e[79]}`),c(ht,"type","text"),c(ht,"placeholder","/path/to/markdown"),ht.readOnly=e[4],c(Zt,"class","control"),c(nl,"class","field"),c(rl,"class","label"),c(rl,"for",Rl=`kg-local-type-${e[79]}`),il.__value="markdown",il.value=il.__value,al.__value="json",al.value=al.__value,c(It,"id",El=`kg-local-type-${e[79]}`),e[3].roles[e[79]].kg.local_type===void 0&&mt(wn),c(Al,"class","select"),c(sl,"class","control"),c(Sl,"class","field is-grouped"),c(Ut,"id",Ll=`kg-public-${e[79]}`),c(Ut,"type","checkbox"),c(Wt,"class","checkbox"),c(Wt,"for",Dl=`kg-public-${e[79]}`),we(Wt,"margin-right","1rem"),c(zt,"id",Il=`kg-publish-${e[79]}`),c(zt,"type","checkbox"),c(Xt,"class","checkbox"),c(Xt,"for",Nl=`kg-publish-${e[79]}`),c(cl,"class","field is-grouped"),c(xt,"class","button is-small is-danger"),c(xt,"data-testid",Ol="remove-role-"+e[79]),c(t,"class","box"),this.first=t},m(Ye,Ee){R(Ye,t,Ee),r(t,n),r(n,o),r(o,a),r(n,u),r(n,i),r(i,d),Ie(d,e[3].roles[e[79]].name),r(t,m),r(t,_),r(_,g),r(g,b),r(_,w),r(_,$),r($,C),Ie(C,e[3].roles[e[79]].shortname),r(t,T),r(t,F),r(F,O),r(O,N),r(F,H),r(F,ee),r(ee,J),r(J,L);for(let He=0;He<vt.length;He+=1)vt[He]&&vt[He].m(L,null);Je(L,e[3].roles[e[79]].theme,!0),r(t,ne),r(t,W),r(W,oe),r(oe,le),r(W,Q),r(W,I),r(I,U),r(U,y),r(y,A),r(y,M),r(y,Z),r(y,V),r(y,X),Je(y,e[3].roles[e[79]].relevance_function,!0),r(t,re),r(t,pe),r(pe,ie),r(ie,ae),ae.checked=e[3].roles[e[79]].terraphim_it,r(ie,K),r(t,ce),r(t,me),r(t,ke);for(let He=0;He<bt.length;He+=1)bt[He]&&bt[He].m(t,null);r(t,Te),r(t,Xe),r(Xe,Be),r(t,Pe),r(t,fe),r(t,Se),r(t,Me),r(Me,xe),r(xe,et),r(Me,ze),r(Me,Ge),r(Ge,qe),r(qe,Le),r(Le,De),r(Le,it),r(Le,Oe),Je(Le,e[3].roles[e[79]].llm_provider,!0),r(Me,G),r(Me,te),r(t,q),kt&&kt.m(t,null),r(t,ue),r(t,Ce),r(t,$e),r(t,Qe),r(Qe,nt),r(nt,de),de.checked=e[3].roles[e[79]].openrouter_enabled,r(nt,ot),r(Qe,Mt),r(Qe,at),r(t,qt),wt&&wt.m(t,null),r(t,ll),r(t,Yt),r(t,gl),r(t,jt),r(jt,yt),r(yt,Xl),r(jt,xl),r(jt,yl),r(yl,Et),Ie(Et,e[3].roles[e[79]].kg.url),r(t,en),r(t,nl),r(nl,ol),r(ol,tn),r(nl,ln),r(nl,Zt),r(Zt,ht),Ie(ht,e[3].roles[e[79]].kg.local_path),r(Zt,nn),$t&&$t.m(Zt,null),r(t,on),r(t,Sl),r(Sl,sl),r(sl,rl),r(rl,sn),r(sl,rn),r(sl,Al),r(Al,It),r(It,il),r(It,al),Je(It,e[3].roles[e[79]].kg.local_type,!0),r(t,an),r(t,cl),r(cl,Wt),r(Wt,Ut),Ut.checked=e[3].roles[e[79]].kg.public,r(Wt,cn),r(cl,un),r(cl,Xt),r(Xt,zt),zt.checked=e[3].roles[e[79]].kg.publish,r(Xt,fn),r(t,dn),r(t,pn),r(t,mn),r(t,xt),r(xt,_n),zl||(gn=[se(d,"input",Js),se(C,"input",Vs),se(L,"change",hn),se(y,"change",vn),se(ae,"change",Qs),se(Xe,"click",Ys),se(Le,"change",bn),se(de,"change",Zs),se(Et,"input",Xs),se(ht,"input",xs),se(ht,"click",function(){Vl(e[4]?kn:void 0)&&(e[4]?kn:void 0).apply(this,arguments)}),se(It,"change",wn),se(Ut,"change",er),se(zt,"change",tr),se(xt,"click",lr)],zl=!0)},p(Ye,Ee){if(e=Ye,Ee[0]&264&&s!==(s=`role-name-${e[79]}`)&&c(o,"for",s),Ee[0]&264&&p!==(p=`role-name-${e[79]}`)&&c(d,"id",p),Ee[0]&264&&d.value!==e[3].roles[e[79]].name&&Ie(d,e[3].roles[e[79]].name),Ee[0]&264&&v!==(v=`role-shortname-${e[79]}`)&&c(g,"for",v),Ee[0]&264&&k!==(k=`role-shortname-${e[79]}`)&&c(C,"id",k),Ee[0]&264&&C.value!==e[3].roles[e[79]].shortname&&Ie(C,e[3].roles[e[79]].shortname),Ee[0]&264&&E!==(E=`role-theme-${e[79]}`)&&c(O,"for",E),Ee[0]&256){ul=e[8];let He;for(He=0;He<ul.length;He+=1){const hl=So(e,ul,He);vt[He]?vt[He].p(hl,Ee):(vt[He]=Io(hl),vt[He].c(),vt[He].m(L,null))}for(;He<vt.length;He+=1)vt[He].d(1);vt.length=ul.length}if(Ee[0]&264&&D!==(D=`role-theme-${e[79]}`)&&c(L,"id",D),Ee[0]&264&&Je(L,e[3].roles[e[79]].theme),Ee[0]&264&&z!==(z=`role-relevance-${e[79]}`)&&c(oe,"for",z),Ee[0]&264&&Y!==(Y=`role-relevance-${e[79]}`)&&c(y,"id",Y),Ee[0]&264&&Je(y,e[3].roles[e[79]].relevance_function),Ee[0]&264&&be!==(be=`role-terraphim-it-${e[79]}`)&&c(ae,"id",be),Ee[0]&264&&(ae.checked=e[3].roles[e[79]].terraphim_it),Ee[0]&264&&x!==(x=`role-terraphim-it-${e[79]}`)&&c(ie,"for",x),Ee[0]&491576){fl=e[77].haystacks;let He;for(He=0;He<fl.length;He+=1){const hl=Co(e,fl,He);bt[He]?bt[He].p(hl,Ee):(bt[He]=jo(hl),bt[He].c(),bt[He].m(t,Te))}for(;He<bt.length;He+=1)bt[He].d(1);bt.length=fl.length}Ee[0]&264&&Ne!==(Ne="add-haystack-"+e[79])&&c(Xe,"data-testid",Ne),Ee[0]&264&&ye!==(ye=`llm-provider-${e[79]}`)&&c(xe,"for",ye),Ee[0]&264&&We!==(We=`llm-provider-${e[79]}`)&&c(Le,"id",We),Ee[0]&264&&Je(Le,e[3].roles[e[79]].llm_provider),e[3].roles[e[79]].llm_provider==="ollama"?kt?kt.p(e,Ee):(kt=Uo(e),kt.c(),kt.m(t,ue)):kt&&(kt.d(1),kt=null),Ee[0]&264&&Ae!==(Ae=`openrouter-enabled-${e[79]}`)&&c(de,"id",Ae),Ee[0]&264&&(de.checked=e[3].roles[e[79]].openrouter_enabled),Ee[0]&264&&ft!==(ft=`openrouter-enabled-${e[79]}`)&&c(nt,"for",ft),e[3].roles[e[79]].openrouter_enabled?wt?wt.p(e,Ee):(wt=Fo(e),wt.c(),wt.m(t,ll)):wt&&(wt.d(1),wt=null),Ee[0]&264&&wl!==(wl=`kg-url-${e[79]}`)&&c(yt,"for",wl),Ee[0]&264&&$l!==($l=`kg-url-${e[79]}`)&&c(Et,"id",$l),Ee[0]&264&&Et.value!==e[3].roles[e[79]].kg.url&&Ie(Et,e[3].roles[e[79]].kg.url),Ee[0]&264&&Cl!==(Cl=`kg-local-path-${e[79]}`)&&c(ol,"for",Cl),Ee[0]&264&&Tl!==(Tl=`kg-local-path-${e[79]}`)&&c(ht,"id",Tl),Ee[0]&16&&(ht.readOnly=e[4]),Ee[0]&264&&ht.value!==e[3].roles[e[79]].kg.local_path&&Ie(ht,e[3].roles[e[79]].kg.local_path),e[4]?$t||($t=Wo(),$t.c(),$t.m(Zt,null)):$t&&($t.d(1),$t=null),Ee[0]&264&&Rl!==(Rl=`kg-local-type-${e[79]}`)&&c(rl,"for",Rl),Ee[0]&264&&El!==(El=`kg-local-type-${e[79]}`)&&c(It,"id",El),Ee[0]&264&&Je(It,e[3].roles[e[79]].kg.local_type),Ee[0]&264&&Ll!==(Ll=`kg-public-${e[79]}`)&&c(Ut,"id",Ll),Ee[0]&264&&(Ut.checked=e[3].roles[e[79]].kg.public),Ee[0]&264&&Dl!==(Dl=`kg-public-${e[79]}`)&&c(Wt,"for",Dl),Ee[0]&264&&Il!==(Il=`kg-publish-${e[79]}`)&&c(zt,"id",Il),Ee[0]&264&&(zt.checked=e[3].roles[e[79]].kg.publish),Ee[0]&264&&Nl!==(Nl=`kg-publish-${e[79]}`)&&c(Xt,"for",Nl),Ee[0]&264&&Ol!==(Ol="remove-role-"+e[79])&&c(xt,"data-testid",Ol)},d(Ye){Ye&&S(t),tt(vt,Ye),tt(bt,Ye),kt&&kt.d(),wt&&wt.d(),$t&&$t.d(),zl=!1,Ze(gn)}}}function Jo(l){let e,t=l[74]+"",n;return{c(){e=f("option"),n=P(t),e.__value=l[74],e.value=e.__value},m(o,a){R(o,e,a),r(e,n)},p:Re,d(o){o&&S(e)}}}function Vo(l){let e,t=l[71].name+"",n,o;return{c(){e=f("option"),n=P(t),e.__value=o=l[71].name,e.value=e.__value},m(a,s){R(a,e,s),r(e,n)},p(a,s){s[0]&8&&t!==(t=a[71].name+"")&&ve(n,t),s[0]&264&&o!==(o=a[71].name)&&(e.__value=o,e.value=e.__value)},d(a){a&&S(e)}}}function Qo(l){let e,t,n;return{c(){e=f("button"),e.textContent="Back",c(e,"class","button"),c(e,"data-testid","wizard-back")},m(o,a){R(o,e,a),t||(n=se(e,"click",l[11]),t=!0)},p:Re,d(o){o&&S(e),t=!1,n()}}}function Sa(l){let e,t,n;return{c(){e=f("button"),e.textContent="Save",c(e,"class","button is-success"),c(e,"data-testid","wizard-save")},m(o,a){R(o,e,a),t||(n=se(e,"click",l[19]),t=!0)},p:Re,d(o){o&&S(e),t=!1,n()}}}function Ra(l){let e,t,n;return{c(){e=f("button"),e.textContent="Next",c(e,"class","button is-primary"),c(e,"data-testid","wizard-next")},m(o,a){R(o,e,a),t||(n=se(e,"click",l[10]),t=!0)},p:Re,d(o){o&&S(e),t=!1,n()}}}function Aa(l){let e,t,n,o,a,s,u,i,d,p,m,_,g,b,v,w,$,C;e=new _l({props:{fallbackPath:"/"}});let k=l[2]==="success"&&Eo(l),T=l[2]==="error"&&Lo(l);function F(L,D){return L[1]===1?$a:L[1]===2?ya:wa}let O=F(l),N=O(l),E=l[1]>1&&Qo(l);function H(L,D){return L[1]<Bs?Ra:Sa}let ee=H(l),J=ee(l);return{c(){_e(e.$$.fragment),t=h(),n=f("div"),o=f("div"),a=f("h3"),a.textContent="Configuration Wizard",s=h(),u=f("button"),u.textContent="Close",i=h(),k&&k.c(),d=h(),T&&T.c(),p=h(),N.c(),m=h(),_=f("nav"),g=f("div"),E&&E.c(),b=h(),v=f("div"),J.c(),c(a,"class","title is-4"),we(a,"margin-bottom","0"),c(u,"class","button is-small is-light"),c(u,"aria-label","Close configuration wizard"),c(o,"class","is-flex is-justify-content-space-between is-align-items-center"),we(o,"gap",".5rem"),c(g,"class","level-left"),c(v,"class","level-right"),c(_,"class","level"),c(n,"class","box")},m(L,D){ge(e,L,D),R(L,t,D),R(L,n,D),r(n,o),r(o,a),r(o,s),r(o,u),r(n,i),k&&k.m(n,null),r(n,d),T&&T.m(n,null),r(n,p),N.m(n,null),r(n,m),r(n,_),r(_,g),E&&E.m(g,null),r(_,b),r(_,v),J.m(v,null),w=!0,$||(C=se(u,"click",Ea),$=!0)},p(L,D){L[2]==="success"?k?k.p(L,D):(k=Eo(L),k.c(),k.m(n,d)):k&&(k.d(1),k=null),L[2]==="error"?T?T.p(L,D):(T=Lo(L),T.c(),T.m(n,p)):T&&(T.d(1),T=null),O===(O=F(L))&&N?N.p(L,D):(N.d(1),N=O(L),N&&(N.c(),N.m(n,m))),L[1]>1?E?E.p(L,D):(E=Qo(L),E.c(),E.m(g,null)):E&&(E.d(1),E=null),ee===(ee=H(L))&&J?J.p(L,D):(J.d(1),J=ee(L),J&&(J.c(),J.m(v,null)))},i(L){w||(j(e.$$.fragment,L),w=!0)},o(L){B(e.$$.fragment,L),w=!1},d(L){he(e,L),L&&S(t),L&&S(n),k&&k.d(),T&&T.d(),N.d(),E&&E.d(),J.d(),$=!1,C()}}}const Bs=3;function Ea(){typeof window<"u"&&window.history.back()}function La(l,e,t){let n,o;Ue(l,ct,G=>t(4,o=G));const a=Dt(null);async function s(G,te){if(Rt(ct))try{const q=await bo({directory:!0,multiple:!1});q&&typeof q=="string"&&i.update(ue=>(ue.roles[G].haystacks[te].path=q,ue))}catch(q){console.error("Failed to open folder selector:",q)}}async function u(G){if(Rt(ct))try{const te=await bo({directory:!0,multiple:!1});te&&typeof te=="string"&&i.update(q=>(q.roles[G].kg.local_path=te,q))}catch(te){console.error("Failed to open folder selector:",te)}}const i=Dt({id:"Desktop",global_shortcut:"Ctrl+X",default_theme:"spacelab",default_role:"Default",roles:[]});Ue(l,i,G=>t(3,n=G));const d=["default","darkly","cerulean","cosmo","cyborg","flatly","journal","litera","lumen","lux","materia","minty","nuclear","pulse","sandstone","simplex","slate","solar","spacelab","superhero","united","yeti"];tl(async()=>{try{let G;Rt(ct)?G=await je("get_config_schema"):G=await(await fetch("/config/schema")).json(),a.set(G);const te=Rt(Lt);te&&te.id&&i.update(q=>{var ue;return{...q,id:te.id,global_shortcut:te.global_shortcut,default_theme:((ue=te.roles[te.default_role])==null?void 0:ue.theme)??"spacelab",default_role:te.default_role,roles:Object.values(te.roles).map(Ce=>{var de,Ae,ot,ft,Mt,at,qt,ll,Yt,gl,jt;const $e=(de=Ce.kg)==null?void 0:de.automata_path,Qe=($e==null?void 0:$e.Remote)??"",nt=((ot=(Ae=Ce.kg)==null?void 0:Ae.knowledge_graph_local)==null?void 0:ot.path)??"";return{name:Ce.name,shortname:Ce.shortname,relevance_function:Ce.relevance_function,terraphim_it:Ce.terraphim_it??!1,theme:Ce.theme,haystacks:(Ce.haystacks??[]).map(yt=>({path:yt.location||yt.path||"",read_only:yt.read_only??!1,service:yt.service||"Ripgrep",atomic_server_secret:yt.atomic_server_secret||"",extra_parameters:yt.extra_parameters||{}})),kg:{url:Qe,local_path:nt,local_type:((Mt=(ft=Ce.kg)==null?void 0:ft.knowledge_graph_local)==null?void 0:Mt.input_type)??"markdown",public:((at=Ce.kg)==null?void 0:at.public)??!1,publish:((qt=Ce.kg)==null?void 0:qt.publish)??!1},openrouter_enabled:Ce.openrouter_enabled??!1,openrouter_api_key:Ce.openrouter_api_key??"",openrouter_model:Ce.openrouter_model??"openai/gpt-3.5-turbo",openrouter_auto_summarize:Ce.openrouter_auto_summarize??!1,openrouter_chat_enabled:Ce.openrouter_chat_enabled??!1,openrouter_chat_model:Ce.openrouter_chat_model??Ce.openrouter_model??"openai/gpt-3.5-turbo",openrouter_chat_system_prompt:Ce.openrouter_chat_system_prompt??"",llm_provider:((ll=Ce.extra)==null?void 0:ll.llm_provider)??"",llm_model:((Yt=Ce.extra)==null?void 0:Yt.llm_model)??"",llm_base_url:((gl=Ce.extra)==null?void 0:gl.llm_base_url)??"",llm_auto_summarize:((jt=Ce.extra)==null?void 0:jt.llm_auto_summarize)??!1}})}})}catch(G){console.error("Failed to load schema",G)}}),tl(()=>{const G=te=>{te.key==="Escape"&&typeof window<"u"&&window.history.back()};return window.addEventListener("keydown",G),()=>window.removeEventListener("keydown",G)});let p={};async function m(G){var $e;const q=Rt(i).roles[G],ue=q.llm_provider||(q.openrouter_enabled?"openrouter":""),Ce=[];try{if(ue==="ollama"){const Qe=(q.llm_base_url||"http://127.0.0.1:11434").replace(/\/$/,""),de=await(await fetch(`${Qe}/api/tags`)).json();if(Array.isArray(de==null?void 0:de.models))for(const Ae of de.models)Ae!=null&&Ae.name&&Ce.push(Ae.name)}else if(ue==="openrouter"){const Qe=($e=q.openrouter_api_key)==null?void 0:$e.trim();if(!Qe)throw new Error("OpenRouter API key required");const de=await(await fetch("https://openrouter.ai/api/v1/models",{headers:{Authorization:`Bearer ${Qe}`,"HTTP-Referer":"https://terraphim.ai","X-Title":"Terraphim Desktop"}})).json(),Ae=Array.isArray(de==null?void 0:de.data)?de.data:[];for(const ot of Ae)ot!=null&&ot.id&&Ce.push(ot.id)}}catch(Qe){console.error("Failed to fetch models",Qe)}t(0,p={...p,[G]:Ce})}let _=1,g="";function b(){_<Bs&&t(1,_+=1)}function v(){_>1&&t(1,_-=1)}function w(){i.update(G=>({...G,roles:[...G.roles,{name:"New Role",shortname:"new",relevance_function:"title-scorer",terraphim_it:!1,theme:"spacelab",haystacks:[],kg:{url:"",local_path:"",local_type:"markdown",public:!1,publish:!1},openrouter_enabled:!1,openrouter_api_key:"",openrouter_model:"openai/gpt-3.5-turbo",openrouter_auto_summarize:!1,openrouter_chat_enabled:!1,openrouter_chat_model:"openai/gpt-3.5-turbo",openrouter_chat_system_prompt:"",llm_provider:"",llm_model:"",llm_base_url:"",llm_auto_summarize:!1}]}))}function $(G){i.update(te=>({...te,roles:te.roles.filter((q,ue)=>ue!==G)}))}function C(G){i.update(te=>(te.roles[G].haystacks.push({path:"",read_only:!1,service:"Ripgrep",atomic_server_secret:"",extra_parameters:{}}),te))}function k(G,te){i.update(q=>(q.roles[G].haystacks=q.roles[G].haystacks.filter((ue,Ce)=>Ce!==te),q))}function T(G,te,q="",ue=""){i.update(Ce=>{Ce.roles[G].haystacks[te].extra_parameters||(Ce.roles[G].haystacks[te].extra_parameters={});const $e=q||`param_${Date.now()}`;return Ce.roles[G].haystacks[te].extra_parameters[$e]=ue,Ce})}function F(G,te,q){i.update(ue=>(delete ue.roles[G].haystacks[te].extra_parameters[q],ue))}function O(G,te,q,ue){i.update(Ce=>{const $e=Ce.roles[G].haystacks[te].extra_parameters;return $e[q]!==void 0&&q!==ue&&($e[ue]=$e[q],delete $e[q]),Ce})}function N(G,te,q,ue){const Ce=ue.target.value;O(G,te,q,Ce)}async function E(){var Ce;const G=Rt(i),te=Rt(Lt);let q={...te};q.id=G.id,q.global_shortcut=G.global_shortcut,q.default_role=G.default_role;const ue={};G.roles.forEach($e=>{var Ae,ot;const Qe=$e.name,nt=Qe.replace(/^"|"$/g,"");ue[nt]={extra:((ot=(Ae=te.roles)==null?void 0:Ae[Qe])==null?void 0:ot.extra)??{},name:$e.name,shortname:$e.shortname,theme:$e.theme,relevance_function:$e.relevance_function,terraphim_it:$e.terraphim_it??!1,haystacks:$e.haystacks.map(ft=>({location:ft.path,service:ft.service,read_only:ft.read_only,atomic_server_secret:ft.service==="Atomic"?ft.atomic_server_secret:void 0,extra_parameters:ft.extra_parameters||{}})),kg:$e.kg.url||$e.kg.local_path?{automata_path:$e.kg.url?{Remote:$e.kg.url}:null,knowledge_graph_local:$e.kg.local_path?{input_type:$e.kg.local_type,path:$e.kg.local_path}:null,public:$e.kg.public,publish:$e.kg.publish}:null,...$e.openrouter_enabled&&{openrouter_enabled:$e.openrouter_enabled,openrouter_api_key:$e.openrouter_api_key,openrouter_model:$e.openrouter_model,openrouter_auto_summarize:$e.openrouter_auto_summarize??!1,openrouter_chat_enabled:$e.openrouter_chat_enabled??!1,openrouter_chat_model:$e.openrouter_chat_model??$e.openrouter_model,openrouter_chat_system_prompt:$e.openrouter_chat_system_prompt??""}};const de={};$e.llm_provider&&(de.llm_provider=$e.llm_provider),$e.llm_model&&(de.llm_model=$e.llm_model),$e.llm_base_url&&(de.llm_base_url=$e.llm_base_url),typeof $e.llm_auto_summarize=="boolean"&&(de.llm_auto_summarize=$e.llm_auto_summarize),ue[nt].extra={...ue[nt].extra||{},...de}}),q.roles=ue,(!q.default_role||!ue[q.default_role])&&(q.default_role=((Ce=G.roles[0])==null?void 0:Ce.name)??"Default"),q.selected_role=q.default_role;try{if(Rt(ct))await je("update_config",{configNew:q});else{const $e=await fetch("/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(q)});if(!$e.ok)throw new Error(`HTTP ${$e.status}: ${$e.statusText}`)}Lt.set(q),t(2,g="success"),setTimeout(()=>{t(2,g="")},3e3)}catch($e){console.error($e),t(2,g="error"),setTimeout(()=>{t(2,g="")},3e3)}}const H=()=>t(2,g=""),ee=()=>t(2,g="");function J(){n.id=St(this),i.set(n),t(8,d)}function L(){n.global_shortcut=this.value,i.set(n),t(8,d)}function D(){n.default_theme=St(this),i.set(n),t(8,d)}function ne(){n.default_role=St(this),i.set(n),t(8,d)}function W(G){n.roles[G].name=this.value,i.set(n),t(8,d)}function oe(G){n.roles[G].shortname=this.value,i.set(n),t(8,d)}function le(G){n.roles[G].theme=St(this),i.set(n),t(8,d)}function z(G){n.roles[G].relevance_function=St(this),i.set(n),t(8,d)}function Q(G){n.roles[G].terraphim_it=this.checked,i.set(n),t(8,d)}function I(G,te){n.roles[G].haystacks[te].service=St(this),i.set(n),t(8,d)}function U(G,te){n.roles[G].haystacks[te].path=this.value,i.set(n),t(8,d)}const y=(G,te)=>s(G,te);function A(G,te){n.roles[G].haystacks[te].atomic_server_secret=this.value,i.set(n),t(8,d)}function M(G,te){n.roles[G].haystacks[te].extra_parameters.tag=this.value,i.set(n),t(8,d)}const Z=(G,te,q)=>{const ue=q.currentTarget.value;ue&&Ht(i,n.roles[G].haystacks[te].extra_parameters.tag=ue,n)},V=(G,te,q,ue)=>N(G,te,q,ue);function X(G,te,q){n.roles[G].haystacks[te].extra_parameters[q]=this.value,i.set(n),t(8,d)}const Y=(G,te,q)=>F(G,te,q),re=(G,te)=>T(G,te,"tag","#rust"),pe=(G,te)=>T(G,te,"max_count","10"),ie=(G,te)=>T(G,te,"","");function ae(G,te){n.roles[G].haystacks[te].read_only=this.checked,i.set(n),t(8,d)}const be=(G,te)=>k(G,te),K=G=>C(G);function x(G){n.roles[G].llm_provider=St(this),i.set(n),t(8,d)}function ce(G){n.roles[G].llm_model=this.value,i.set(n),t(8,d)}const me=G=>m(G),ke=(G,te)=>{Ht(i,n.roles[G].llm_model=te.currentTarget.value,n)};function Te(G){n.roles[G].llm_base_url=this.value,i.set(n),t(8,d)}function Xe(G){n.roles[G].llm_auto_summarize=this.checked,i.set(n),t(8,d)}function Be(G){n.roles[G].openrouter_enabled=this.checked,i.set(n),t(8,d)}function Ne(G){n.roles[G].openrouter_api_key=this.value,i.set(n),t(8,d)}function Pe(G){n.roles[G].openrouter_model=this.value,i.set(n),t(8,d)}const fe=G=>m(G),Se=(G,te)=>{Ht(i,n.roles[G].openrouter_model=te.currentTarget.value,n)};function Me(G){n.roles[G].openrouter_auto_summarize=this.checked,i.set(n),t(8,d)}function xe(G){n.roles[G].openrouter_chat_enabled=this.checked,i.set(n),t(8,d)}function et(G){n.roles[G].openrouter_chat_model=St(this),i.set(n),t(8,d)}function ye(G){n.roles[G].openrouter_chat_system_prompt=this.value,i.set(n),t(8,d)}function ze(G){n.roles[G].kg.url=this.value,i.set(n),t(8,d)}function Ge(G){n.roles[G].kg.local_path=this.value,i.set(n),t(8,d)}const qe=G=>u(G);function Le(G){n.roles[G].kg.local_type=St(this),i.set(n),t(8,d)}function De(G){n.roles[G].kg.public=this.checked,i.set(n),t(8,d)}function it(G){n.roles[G].kg.publish=this.checked,i.set(n),t(8,d)}return[p,_,g,n,o,s,u,i,d,m,b,v,w,$,C,k,T,F,N,E,H,ee,J,L,D,ne,W,oe,le,z,Q,I,U,y,A,M,Z,V,X,Y,re,pe,ie,ae,be,K,x,ce,me,ke,Te,Xe,Be,Ne,Pe,fe,Se,Me,xe,et,ye,ze,Ge,qe,Le,De,it,G=>$(G),()=>{t(1,_=2)}]}class Da extends _t{constructor(e){super(),gt(this,e,La,Aa,pt,{},null,[-1,-1,-1,-1])}}function Ia(l){let e,t,n,o,a,s,u,i;return e=new _l({props:{fallbackPath:"/"}}),u=new Ks({props:{content:l[0],onChange:l[1]}}),{c(){_e(e.$$.fragment),t=h(),n=f("div"),o=f("p"),o.innerHTML="<i>The best editing experience is to configure Atomic Server, in the meantime use editor below. You will need to refresh page via Command R or Ctrl-R to see changes</i>",a=h(),s=f("div"),_e(u.$$.fragment),c(s,"class","editor"),c(n,"class","box")},m(d,p){ge(e,d,p),R(d,t,p),R(d,n,p),r(n,o),r(n,a),r(n,s),ge(u,s,null),i=!0},p(d,[p]){const m={};p&1&&(m.content=d[0]),u.$set(m)},i(d){i||(j(e.$$.fragment,d),j(u.$$.fragment,d),i=!0)},o(d){B(e.$$.fragment,d),B(u.$$.fragment,d),i=!1},d(d){he(e,d),d&&S(t),d&&S(n),he(u)}}}function Na(l,e,t){let n,o;Ue(l,Lt,u=>t(2,n=u)),Ue(l,ct,u=>t(3,o=u));let a={json:n};function s(u){if(console.log("contents changed:",u),console.log("is tauri",o),Lt.update(i=>(i=u.json,i)),Rt(ct))console.log("Updating config on server"),je("update_config",{configNew:u.json}).then(i=>{console.log(`Message: ${i}`)}).catch(i=>console.error(i));else{let i=`${Ve.ServerURL}/config/`;fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u.json)})}t(0,a=u)}return tl(()=>{t(0,a={json:n})}),[a,s]}class Oa extends _t{constructor(e){super(),gt(this,e,Na,Ia,pt,{})}}const{window:ql}=pr;function Pa(l){let e,t,n,o,a,s,u,i,d,p;return{c(){e=f("div"),t=f("div"),n=f("h3"),n.textContent="Error loading graph",o=h(),a=f("p"),s=P(l[3]),u=h(),i=f("button"),i.textContent="Retry",c(i,"class","button is-primary"),c(t,"class","error-content svelte-1ry9pkl"),c(e,"class","error-overlay svelte-1ry9pkl")},m(m,_){R(m,e,_),r(e,t),r(t,n),r(t,o),r(t,a),r(a,s),r(t,u),r(t,i),d||(p=se(i,"click",l[11]),d=!0)},p(m,_){_&8&&ve(s,m[3])},d(m){m&&S(e),d=!1,p()}}}function Ma(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="loading-content svelte-1ry9pkl"><div class="loader svelte-1ry9pkl"></div> 
        <p>Loading knowledge graph...</p></div>`,c(e,"class","loading-overlay svelte-1ry9pkl")},m(t,n){R(t,e,n)},p:Re,d(t){t&&S(e)}}}function Yo(l){let e,t,n;return{c(){e=f("button"),e.innerHTML='<i class="fas fa-times svelte-1ry9pkl"></i>',c(e,"class","close-button svelte-1ry9pkl"),c(e,"title","Close Graph")},m(o,a){R(o,e,a),t||(n=se(e,"click",l[17]),t=!0)},p:Re,d(o){o&&S(e),t=!1,n()}}}function Zo(l){let e;return{c(){e=f("div"),e.innerHTML="<span><strong>Left-click:</strong> View node • <strong>Right-click:</strong> Edit node • <strong>Drag:</strong> Move • <strong>Scroll:</strong> Zoom</span>",c(e,"class","controls-info svelte-1ry9pkl")},m(t,n){R(t,e,n)},d(t){t&&S(e)}}}function Xo(l){let e,t;return{c(){e=f("div"),t=P(l[8]),c(e,"class","debug-message svelte-1ry9pkl")},m(n,o){R(n,e,o),r(e,t)},p(n,o){o&256&&ve(t,n[8])},d(n){n&&S(e)}}}function xo(l){let e=l[5].id,t,n,o=es(l);return{c(){o.c(),t=ut()},m(a,s){o.m(a,s),R(a,t,s),n=!0},p(a,s){s&32&&pt(e,e=a[5].id)?(Fe(),B(o,1,1,Re),Ke(),o=es(a),o.c(),j(o,1),o.m(t.parentNode,t)):o.p(a,s)},i(a){n||(j(o),n=!0)},o(a){B(o),n=!1},d(a){a&&S(t),o.d(a)}}}function es(l){let e,t,n;function o(s){l[18](s)}let a={item:l[5],initialEdit:l[7]};return l[6]!==void 0&&(a.active=l[6]),e=new Yl({props:a}),lt.push(()=>st(e,"active",o)),e.$on("close",l[12]),e.$on("save",l[13]),{c(){_e(e.$$.fragment)},m(s,u){ge(e,s,u),n=!0},p(s,u){const i={};u&32&&(i.item=s[5]),u&128&&(i.initialEdit=s[7]),!t&&u&64&&(t=!0,i.active=s[6],rt(()=>t=!1)),e.$set(i)},i(s){n||(j(e.$$.fragment,s),n=!0)},o(s){B(e.$$.fragment,s),n=!1},d(s){he(e,s)}}}function ja(l){let e,t,n,o,a,s,u,i,d,p,m;mt(l[15]),e=new _l({props:{fallbackPath:"/"}});function _(k,T){if(k[2])return Ma;if(k[3])return Pa}let g=_(l),b=g&&g(l),v=l[0]&&Yo(l),w=!l[2]&&!l[3]&&l[4].length>0&&Zo(),$=l[8]&&Xo(l),C=l[5]&&xo(l);return{c(){_e(e.$$.fragment),t=h(),n=f("div"),b&&b.c(),o=h(),v&&v.c(),a=h(),w&&w.c(),s=h(),$&&$.c(),u=h(),C&&C.c(),i=ut(),c(n,"class","graph-container svelte-1ry9pkl"),we(n,"width",l[0]?"100vw":"600px"),we(n,"height",l[0]?"100vh":"400px"),dt(n,"fullscreen",l[0])},m(k,T){ge(e,k,T),R(k,t,T),R(k,n,T),b&&b.m(n,null),l[16](n),R(k,o,T),v&&v.m(k,T),R(k,a,T),w&&w.m(k,T),R(k,s,T),$&&$.m(k,T),R(k,u,T),C&&C.m(k,T),R(k,i,T),d=!0,p||(m=se(ql,"resize",l[15]),p=!0)},p(k,[T]){g===(g=_(k))&&b?b.p(k,T):(b&&b.d(1),b=g&&g(k),b&&(b.c(),b.m(n,null))),(!d||T&1)&&we(n,"width",k[0]?"100vw":"600px"),(!d||T&1)&&we(n,"height",k[0]?"100vh":"400px"),(!d||T&1)&&dt(n,"fullscreen",k[0]),k[0]?v?v.p(k,T):(v=Yo(k),v.c(),v.m(a.parentNode,a)):v&&(v.d(1),v=null),!k[2]&&!k[3]&&k[4].length>0?w||(w=Zo(),w.c(),w.m(s.parentNode,s)):w&&(w.d(1),w=null),k[8]?$?$.p(k,T):($=Xo(k),$.c(),$.m(u.parentNode,u)):$&&($.d(1),$=null),k[5]?C?(C.p(k,T),T&32&&j(C,1)):(C=xo(k),C.c(),j(C,1),C.m(i.parentNode,i)):C&&(Fe(),B(C,1,1,()=>{C=null}),Ke())},i(k){d||(j(e.$$.fragment,k),j(C),d=!0)},o(k){B(e.$$.fragment,k),B(C),d=!1},d(k){he(e,k),k&&S(t),k&&S(n),b&&b.d(),l[16](null),k&&S(o),v&&v.d(k),k&&S(a),w&&w.d(k),k&&S(s),$&&$.d(k),k&&S(u),C&&C.d(k),k&&S(i),p=!1,m()}}}function ts(l){return{id:`kg-node-${l.id}`,url:`#/graph/node/${l.id}`,title:l.label,body:`# ${l.label}

**Knowledge Graph Node**

ID: ${l.id}
Rank: ${l.rank}

This is a concept node from the knowledge graph. You can edit this content to add more information about "${l.label}".`,description:`Knowledge graph concept: ${l.label}`,tags:["knowledge-graph","concept"],rank:l.rank,stub:`Knowledge graph concept: ${l.label}`}}function Ua(l,e,t){let n,o;Ue(l,At,D=>t(20,n=D)),Ue(l,ct,D=>t(21,o=D));let{apiUrl:a="/rolegraph"}=e,{fullscreen:s=!0}=e,u,i=!0,d=null,p=[],m=[],_=null,g=!1,b=!1,v="",w=window.innerWidth,$=window.innerHeight;function C(){t(9,w=window.innerWidth),t(10,$=window.innerHeight),!i&&!d&&E()}async function k(){t(2,i=!0),t(3,d=null);try{if(o){console.log("Loading rolegraph from Tauri");const D=await je("get_rolegraph",{role_name:n||void 0});if(D&&D.status==="success")t(4,p=D.nodes),m=D.edges;else throw new Error(`Tauri rolegraph fetch failed: ${(D==null?void 0:D.status)||"unknown error"}`)}else{console.log("Loading rolegraph from server");const D=n?`${a}?role=${encodeURIComponent(n)}`:a,ne=await fetch(D);if(!ne.ok)throw new Error(`Failed to fetch: ${ne.status}`);const W=await ne.json();t(4,p=W.nodes),m=W.edges}}catch(D){t(3,d=D.message),console.error("Error fetching rolegraph:",D)}finally{t(2,i=!1)}}function T(D,ne){D.stopPropagation(),console.log("Node clicked:",ne.label),t(5,_=ts(ne)),t(7,b=!1),t(6,g=!0)}function F(D,ne){D.preventDefault(),D.stopPropagation(),console.log("Node right-clicked:",ne.label),t(8,v=`Right-clicked: ${ne.label}`),t(5,_=ts(ne)),t(7,b=!0),t(6,g=!0),setTimeout(()=>{t(8,v="")},2e3)}function O(){t(6,g=!1),t(5,_=null),t(7,b=!1)}async function N(){if(_)try{const D=await fetch("/documents",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(_)});D.ok?console.log("Successfully saved KG record:",_.id):console.error("Failed to save KG record:",D.statusText)}catch(D){console.error("Error saving KG record:",D)}finally{t(6,g=!1),t(5,_=null),t(7,b=!1)}}function E(){if(!u)return;t(1,u.innerHTML="",u);const D=Kl(u).append("svg").attr("width",w).attr("height",$),ne=Rr().scaleExtent([.1,10]).on("zoom",A=>{W.attr("transform",A.transform)});D.call(ne);const W=D.append("g"),oe=Ar(p).force("link",Er(m).id(A=>A.id).distance(100)).force("charge",Lr().strength(-200)).force("center",Dr(w/2,$/2)).force("collision",Ir().radius(20)),le=W.append("g").attr("class","links").selectAll("line").data(m).enter().append("line").attr("stroke","#666").attr("stroke-opacity",.7).attr("stroke-width",A=>{const M=A.weight||A.rank||1;return Math.max(1,Math.min(8,M*2))}),z=W.append("g").attr("class","nodes").selectAll("circle").data(p).enter().append("circle").attr("r",A=>{const M=A.rank||1;return Math.max(6,Math.min(20,M*2))}).attr("fill",A=>{const M=A.rank||1,Z=Math.min(M/10,1);return Nr(.2+Z*.6)}).attr("stroke","#fff").attr("stroke-width",2).style("cursor","pointer").on("click",(A,M)=>T(A,M)).on("contextmenu",(A,M)=>F(A,M)).on("mouseover",function(A,M){Kl(this).transition().duration(150).attr("stroke-width",3).attr("r",Z=>{const V=Z.rank||1;return Math.max(8,Math.min(24,V*2.5))})}).on("mouseout",function(A,M){Kl(this).transition().duration(150).attr("stroke-width",2).attr("r",Z=>{const V=Z.rank||1;return Math.max(6,Math.min(20,V*2))})}).call(Or().on("start",I).on("drag",U).on("end",y)),Q=W.append("g").attr("class","labels").selectAll("text").data(p).enter().append("text").attr("text-anchor","middle").attr("dy",".35em").attr("font-size","11px").attr("font-family","Arial, sans-serif").attr("fill","#333").attr("pointer-events","none").text(A=>A.label.length>12?A.label.substring(0,12)+"...":A.label);oe.on("tick",()=>{le.attr("x1",A=>A.source.x).attr("y1",A=>A.source.y).attr("x2",A=>A.target.x).attr("y2",A=>A.target.y),z.attr("cx",A=>A.x).attr("cy",A=>A.y),Q.attr("x",A=>A.x).attr("y",A=>A.y)});function I(A,M){A.active||oe.alphaTarget(.3).restart(),M.fx=M.x,M.fy=M.y}function U(A,M){M.fx=A.x,M.fy=A.y}function y(A,M){A.active||oe.alphaTarget(0),M.fx=null,M.fy=null}}tl(()=>{k().then(()=>{d||E()});const D=ne=>{ne.preventDefault()};return u&&u.addEventListener("contextmenu",D),window.addEventListener("resize",C),()=>{u&&u.removeEventListener("contextmenu",D),window.removeEventListener("resize",C)}});function H(){t(9,w=ql.innerWidth),t(10,$=ql.innerHeight)}function ee(D){lt[D?"unshift":"push"](()=>{u=D,t(1,u)})}const J=()=>history.back();function L(D){g=D,t(6,g)}return l.$$set=D=>{"apiUrl"in D&&t(14,a=D.apiUrl),"fullscreen"in D&&t(0,s=D.fullscreen)},[s,u,i,d,p,_,g,b,v,w,$,k,O,N,a,H,ee,J,L]}class za extends _t{constructor(e){super(),gt(this,e,Ua,ja,pt,{apiUrl:14,fullscreen:0})}}function ls(l,e,t){const n=l.slice();return n[19]=e[t][0],n[20]=e[t][1],n[21]=e,n[22]=t,n}function ns(l,e,t){const n=l.slice();return n[23]=e[t],n}function os(l){let e,t,n,o,a,s,u,i,d,p,m,_,g,b,v=l[2].title.trim()==="",w,$,C,k,T,F,O,N,E,H,ee,J,L,D,ne,W=l[2].content.trim()==="",oe,le,z,Q,I,U,y,A,M,Z,V,X,Y,re,pe,ie,ae,be,K,x,ce,me=l[1]==="edit"?"Save Changes":"Add Context",ke,Te,Xe,Be,Ne,Pe,fe,Se,Me,xe,et=l[4],ye=[];for(let te=0;te<et.length;te+=1)ye[te]=ss(ns(l,et,te));let ze=v&&rs();function Ge(te,q){return te[2].summary?Fa:Ha}let qe=Ge(l),Le=qe(l),De=W&&is();function it(te,q){return q&4&&(V=null),V==null&&(V=Object.keys(te[2].metadata).length===0),V?Ga:Ka}let Oe=it(l,-1),We=Oe(l),G=l[1]==="edit"&&cs(l);return{c(){e=f("section"),t=f("div"),n=f("label"),n.textContent="Type",o=h(),a=f("div"),s=f("div"),u=f("select");for(let te=0;te<ye.length;te+=1)ye[te].c();i=h(),d=f("div"),p=f("label"),p.textContent="Title *",m=h(),_=f("div"),g=f("input"),b=h(),ze&&ze.c(),w=h(),$=f("div"),C=f("label"),C.textContent="Summary",k=h(),T=f("div"),F=f("textarea"),O=h(),N=f("p"),Le.c(),E=h(),H=f("div"),ee=f("label"),ee.textContent="Content *",J=h(),L=f("div"),D=f("textarea"),ne=h(),De&&De.c(),oe=h(),le=f("details"),z=f("summary"),z.innerHTML=`<span class="icon-text"><span class="icon"><i class="fas fa-cog"></i></span> 
              <span>Advanced Options</span></span>`,Q=h(),I=f("div"),U=f("label"),U.textContent="Metadata",y=h(),A=f("div"),M=f("p"),M.textContent="Additional key-value pairs for this context item",Z=h(),We.c(),X=h(),Y=f("button"),Y.innerHTML=`<span class="icon"><i class="fas fa-plus"></i></span> 
                <span>Add Metadata</span>`,re=h(),pe=f("footer"),ie=f("div"),ae=f("div"),be=f("button"),K=f("span"),K.innerHTML='<i class="fas fa-save"></i>',x=h(),ce=f("span"),ke=P(me),Xe=h(),Be=f("div"),Ne=f("button"),Ne.innerHTML="<span>Cancel</span>",Pe=h(),G&&G.c(),fe=h(),Se=f("div"),Se.innerHTML=`<strong>Keyboard shortcuts:</strong>
          Ctrl/Cmd + Enter to save, Escape to close`,c(n,"class","label"),c(n,"for","context-type"),c(u,"id","context-type"),c(u,"data-testid","context-type-select"),l[2].context_type===void 0&&mt(()=>l[10].call(u)),c(s,"class","select is-fullwidth"),c(a,"class","control"),c(t,"class","field"),c(p,"class","label"),c(p,"for","context-title"),c(g,"id","context-title"),c(g,"class","input"),c(g,"type","text"),c(g,"placeholder","Enter title..."),c(g,"data-testid","context-title-input"),g.required=!0,c(_,"class","control"),c(d,"class","field"),c(C,"class","label"),c(C,"for","context-summary"),c(F,"id","context-summary"),c(F,"class","textarea svelte-1oesbw7"),c(F,"placeholder","Brief summary of the content (optional)..."),c(F,"data-testid","context-summary-textarea"),c(F,"rows","3"),c(F,"maxlength","500"),c(T,"class","control"),c(N,"class","help svelte-1oesbw7"),c($,"class","field"),c(ee,"class","label"),c(ee,"for","context-content"),c(D,"id","context-content"),c(D,"class","textarea svelte-1oesbw7"),c(D,"placeholder","Enter the full content..."),c(D,"data-testid","context-content-textarea"),c(D,"rows","8"),D.required=!0,c(L,"class","control"),c(H,"class","field"),c(z,"class","summary svelte-1oesbw7"),c(U,"class","label"),c(M,"class","help svelte-1oesbw7"),c(Y,"class","button is-small is-light"),c(A,"class","content"),c(I,"class","field mt-4"),c(le,"class","details svelte-1oesbw7"),c(e,"class","modal-card-body svelte-1oesbw7"),c(K,"class","icon"),c(be,"class","button is-primary"),be.disabled=Te=!l[3],c(be,"data-testid","save-context-button"),c(ae,"class","control"),c(Ne,"class","button is-light"),c(Ne,"data-testid","cancel-context-button"),c(Be,"class","control"),c(ie,"class","field is-grouped"),c(Se,"class","help svelte-1oesbw7"),c(pe,"class","modal-card-foot")},m(te,q){R(te,e,q),r(e,t),r(t,n),r(t,o),r(t,a),r(a,s),r(s,u);for(let ue=0;ue<ye.length;ue+=1)ye[ue]&&ye[ue].m(u,null);Je(u,l[2].context_type,!0),r(e,i),r(e,d),r(d,p),r(d,m),r(d,_),r(_,g),Ie(g,l[2].title),r(d,b),ze&&ze.m(d,null),r(e,w),r(e,$),r($,C),r($,k),r($,T),r(T,F),Ie(F,l[2].summary),r($,O),r($,N),Le.m(N,null),r(e,E),r(e,H),r(H,ee),r(H,J),r(H,L),r(L,D),Ie(D,l[2].content),r(H,ne),De&&De.m(H,null),r(e,oe),r(e,le),r(le,z),r(le,Q),r(le,I),r(I,U),r(I,y),r(I,A),r(A,M),r(A,Z),We.m(A,null),r(A,X),r(A,Y),R(te,re,q),R(te,pe,q),r(pe,ie),r(ie,ae),r(ae,be),r(be,K),r(be,x),r(be,ce),r(ce,ke),r(ie,Xe),r(ie,Be),r(Be,Ne),r(ie,Pe),G&&G.m(ie,null),r(pe,fe),r(pe,Se),Me||(xe=[se(u,"change",l[10]),se(g,"input",l[11]),se(F,"input",l[12]),se(D,"input",l[13]),se(Y,"click",l[17]),se(be,"click",l[6]),se(Ne,"click",l[5])],Me=!0)},p(te,q){if(q&16){et=te[4];let ue;for(ue=0;ue<et.length;ue+=1){const Ce=ns(te,et,ue);ye[ue]?ye[ue].p(Ce,q):(ye[ue]=ss(Ce),ye[ue].c(),ye[ue].m(u,null))}for(;ue<ye.length;ue+=1)ye[ue].d(1);ye.length=et.length}q&20&&Je(u,te[2].context_type),q&20&&g.value!==te[2].title&&Ie(g,te[2].title),q&4&&(v=te[2].title.trim()===""),v?ze||(ze=rs(),ze.c(),ze.m(d,null)):ze&&(ze.d(1),ze=null),q&20&&Ie(F,te[2].summary),qe===(qe=Ge(te))&&Le?Le.p(te,q):(Le.d(1),Le=qe(te),Le&&(Le.c(),Le.m(N,null))),q&20&&Ie(D,te[2].content),q&4&&(W=te[2].content.trim()===""),W?De||(De=is(),De.c(),De.m(H,null)):De&&(De.d(1),De=null),Oe===(Oe=it(te,q))&&We?We.p(te,q):(We.d(1),We=Oe(te),We&&(We.c(),We.m(A,X))),q&2&&me!==(me=te[1]==="edit"?"Save Changes":"Add Context")&&ve(ke,me),q&8&&Te!==(Te=!te[3])&&(be.disabled=Te),te[1]==="edit"?G?G.p(te,q):(G=cs(te),G.c(),G.m(ie,null)):G&&(G.d(1),G=null)},d(te){te&&S(e),tt(ye,te),ze&&ze.d(),Le.d(),De&&De.d(),We.d(),te&&S(re),te&&S(pe),G&&G.d(),Me=!1,Ze(xe)}}}function ss(l){let e,t=l[23].label+"",n;return{c(){e=f("option"),n=P(t),e.__value=l[23].value,e.value=e.__value},m(o,a){R(o,e,a),r(e,n)},p:Re,d(o){o&&S(e)}}}function rs(l){let e;return{c(){e=f("p"),e.textContent="Title is required",c(e,"class","help is-danger svelte-1oesbw7")},m(t,n){R(t,e,n)},d(t){t&&S(e)}}}function Ha(l){let e;return{c(){e=P("Optional brief summary (up to 500 characters)")},m(t,n){R(t,e,n)},p:Re,d(t){t&&S(e)}}}function Fa(l){let e=l[2].summary.length+"",t,n;return{c(){t=P(e),n=P("/500 characters")},m(o,a){R(o,t,a),R(o,n,a)},p(o,a){a&4&&e!==(e=o[2].summary.length+"")&&ve(t,e)},d(o){o&&S(t),o&&S(n)}}}function is(l){let e;return{c(){e=f("p"),e.textContent="Content is required",c(e,"class","help is-danger svelte-1oesbw7")},m(t,n){R(t,e,n)},d(t){t&&S(e)}}}function Ka(l){let e,t=Object.entries(l[2].metadata),n=[];for(let o=0;o<t.length;o+=1)n[o]=as(ls(l,t,o));return{c(){for(let o=0;o<n.length;o+=1)n[o].c();e=ut()},m(o,a){for(let s=0;s<n.length;s+=1)n[s]&&n[s].m(o,a);R(o,e,a)},p(o,a){if(a&4){t=Object.entries(o[2].metadata);let s;for(s=0;s<t.length;s+=1){const u=ls(o,t,s);n[s]?n[s].p(u,a):(n[s]=as(u),n[s].c(),n[s].m(e.parentNode,e))}for(;s<n.length;s+=1)n[s].d(1);n.length=t.length}},d(o){tt(n,o),o&&S(e)}}}function Ga(l){let e;return{c(){e=f("p"),e.textContent="No metadata defined",c(e,"class","has-text-grey-light")},m(t,n){R(t,e,n)},p:Re,d(t){t&&S(e)}}}function as(l){let e,t,n,o,a,s,u,i,d,p,m,_,g;function b(...$){return l[14](l[19],l[20],...$)}function v(){l[15].call(u,l[19])}function w(){return l[16](l[19])}return{c(){e=f("div"),t=f("div"),n=f("input"),a=h(),s=f("div"),u=f("input"),i=h(),d=f("div"),p=f("button"),p.innerHTML='<span class="icon"><i class="fas fa-times"></i></span>',m=h(),c(n,"class","input is-small"),c(n,"type","text"),c(n,"placeholder","Key"),n.value=o=l[19],c(t,"class","control is-expanded"),c(u,"class","input is-small"),c(u,"type","text"),c(u,"placeholder","Value"),c(s,"class","control is-expanded"),c(p,"class","button is-small is-danger is-outlined"),c(d,"class","control"),c(e,"class","field is-grouped")},m($,C){R($,e,C),r(e,t),r(t,n),r(e,a),r(e,s),r(s,u),Ie(u,l[2].metadata[l[19]]),r(e,i),r(e,d),r(d,p),r(e,m),_||(g=[se(n,"input",b),se(u,"input",v),se(p,"click",w)],_=!0)},p($,C){l=$,C&20&&o!==(o=l[19])&&n.value!==o&&(n.value=o),C&20&&u.value!==l[2].metadata[l[19]]&&Ie(u,l[2].metadata[l[19]])},d($){$&&S(e),_=!1,Ze(g)}}}function cs(l){let e,t,n,o,a,s;return{c(){e=f("div"),t=h(),n=f("div"),o=f("button"),o.innerHTML=`<span class="icon"><i class="fas fa-trash"></i></span> 
                <span>Delete</span>`,c(e,"class","control is-expanded"),c(o,"class","button is-danger is-outlined"),c(o,"data-testid","delete-context-button"),c(n,"class","control")},m(u,i){R(u,e,i),R(u,t,i),R(u,n,i),r(n,o),a||(s=se(o,"click",l[7]),a=!0)},p:Re,d(u){u&&S(e),u&&S(t),u&&S(n),a=!1,s()}}}function qa(l){let e,t,n,o=l[1]==="edit"?"Edit Context Item":"Add Context Item",a,s,u,i,d,p,m=l[2]&&os(l);return{c(){e=f("div"),t=f("header"),n=f("p"),a=P(o),s=h(),u=f("button"),i=h(),m&&m.c(),c(n,"class","modal-card-title"),c(u,"class","delete"),c(u,"aria-label","close"),c(t,"class","modal-card-head"),c(e,"class","modal-card")},m(_,g){R(_,e,g),r(e,t),r(t,n),r(n,a),r(t,s),r(t,u),r(e,i),m&&m.m(e,null),d||(p=se(u,"click",l[5]),d=!0)},p(_,g){g&2&&o!==(o=_[1]==="edit"?"Edit Context Item":"Add Context Item")&&ve(a,o),_[2]?m?m.p(_,g):(m=os(_),m.c(),m.m(e,null)):m&&(m.d(1),m=null)},d(_){_&&S(e),m&&m.d(),d=!1,p()}}}function Wa(l){let e,t,n,o;return e=new kl({props:{active:l[0],$$slots:{default:[qa]},$$scope:{ctx:l}}}),e.$on("close",l[5]),{c(){_e(e.$$.fragment)},m(a,s){ge(e,a,s),t=!0,n||(o=se(window,"keydown",l[8]),n=!0)},p(a,[s]){const u={};s&1&&(u.active=a[0]),s&67108878&&(u.$$scope={dirty:s,ctx:a}),e.$set(u)},i(a){t||(j(e.$$.fragment,a),t=!0)},o(a){B(e.$$.fragment,a),t=!1},d(a){he(e,a),n=!1,o()}}}function Ba(l,e,t){let n,{active:o=!1}=e,{context:a=null}=e,{mode:s="edit"}=e;const u=Ql();let i=null,d=[{value:"Document",label:"Document"},{value:"SearchResult",label:"Search Result"},{value:"UserInput",label:"User Input"},{value:"System",label:"System"},{value:"External",label:"External"}];function p(){t(0,o=!1),t(2,i=null),u("close")}function m(){!n||!i||(u(s==="edit"?"update":"create",i),p())}function _(){s==="edit"&&a&&(u("delete",a.id),p())}function g(O){O.key==="Escape"?p():O.key==="Enter"&&(O.ctrlKey||O.metaKey)&&m()}function b(){i.context_type=St(this),t(2,i),t(0,o),t(9,a),t(1,s),t(4,d)}function v(){i.title=this.value,t(2,i),t(0,o),t(9,a),t(1,s),t(4,d)}function w(){i.summary=this.value,t(2,i),t(0,o),t(9,a),t(1,s),t(4,d)}function $(){i.content=this.value,t(2,i),t(0,o),t(9,a),t(1,s),t(4,d)}const C=(O,N,E)=>{const H={...i.metadata};delete H[O],H[E.target.value]=N,t(2,i.metadata=H,i)};function k(O){i.metadata[O]=this.value,t(2,i),t(0,o),t(9,a),t(1,s),t(4,d)}const T=O=>{const N={...i.metadata};delete N[O],t(2,i.metadata=N,i)},F=()=>{t(2,i.metadata={...i.metadata,[`key_${Date.now()}`]:""},i)};return l.$$set=O=>{"active"in O&&t(0,o=O.active),"context"in O&&t(9,a=O.context),"mode"in O&&t(1,s=O.mode)},l.$$.update=()=>{l.$$.dirty&515&&(o&&a?t(2,i={...a,metadata:{...a.metadata}}):o&&s==="create"&&t(2,i={id:"",context_type:"UserInput",title:"",summary:"",content:"",metadata:{},created_at:new Date().toISOString(),relevance_score:null})),l.$$.dirty&4&&t(3,n=i&&i.title.trim()!==""&&i.content.trim()!=="")},[o,s,i,n,d,p,m,_,g,a,b,v,w,$,C,k,T,F]}class Ja extends _t{constructor(e){super(),gt(this,e,Ba,Wa,pt,{active:0,context:9,mode:1})}}function us(l,e,t){const n=l.slice();return n[35]=e[t],n}function fs(l,e,t){const n=l.slice();return n[38]=e[t],n[40]=t,n}function ds(l){let e,t=l[7],n=[];for(let o=0;o<t.length;o+=1)n[o]=ps(fs(l,t,o));return{c(){e=f("ul");for(let o=0;o<n.length;o+=1)n[o].c();c(e,"class","suggestions svelte-k0eopx"),c(e,"data-testid","kg-typeahead-list")},m(o,a){R(o,e,a);for(let s=0;s<n.length;s+=1)n[s]&&n[s].m(e,null)},p(o,a){if(a[0]&4480){t=o[7];let s;for(s=0;s<t.length;s+=1){const u=fs(o,t,s);n[s]?n[s].p(u,a):(n[s]=ps(u),n[s].c(),n[s].m(e,null))}for(;s<n.length;s+=1)n[s].d(1);n.length=t.length}},d(o){o&&S(e),tt(n,o)}}}function ps(l){let e,t=l[38]+"",n,o,a,s,u,i;function d(){return l[24](l[38])}function p(...m){return l[25](l[38],...m)}return{c(){e=f("li"),n=P(t),o=h(),c(e,"tabindex","0"),c(e,"role","option"),c(e,"aria-selected",a=l[40]===l[8]),c(e,"aria-label",s=`Apply suggestion: ${l[38]}`),c(e,"data-testid","kg-typeahead-item"),c(e,"class","svelte-k0eopx"),dt(e,"active",l[40]===l[8])},m(m,_){R(m,e,_),r(e,n),r(e,o),u||(i=[se(e,"click",d),se(e,"keydown",p)],u=!0)},p(m,_){l=m,_[0]&128&&t!==(t=l[38]+"")&&ve(n,t),_[0]&256&&a!==(a=l[40]===l[8])&&c(e,"aria-selected",a),_[0]&128&&s!==(s=`Apply suggestion: ${l[38]}`)&&c(e,"aria-label",s),_[0]&256&&dt(e,"active",l[40]===l[8])},d(m){m&&S(e),u=!1,Ze(i)}}}function Va(l){let e,t,n,o,a,s;function u(m){l[21](m)}function i(m){l[22](m)}let d={placeholder:"Search knowledge graph terms...",type:"search",disabled:l[4],icon:"search",expanded:!0,autofocus:!0,"data-testid":"kg-search-input"};l[2]!==void 0&&(d.element=l[2]),l[1]!==void 0&&(d.value=l[1]),t=new Vt({props:d}),lt.push(()=>st(t,"element",u)),lt.push(()=>st(t,"value",i)),t.$on("input",l[23]),t.$on("keydown",l[13]);let p=l[7].length>0&&ds(l);return{c(){e=f("div"),_e(t.$$.fragment),a=h(),p&&p.c(),c(e,"class","input-wrapper svelte-k0eopx")},m(m,_){R(m,e,_),ge(t,e,null),r(e,a),p&&p.m(e,null),s=!0},p(m,_){const g={};_[0]&16&&(g.disabled=m[4]),!n&&_[0]&4&&(n=!0,g.element=m[2],rt(()=>n=!1)),!o&&_[0]&2&&(o=!0,g.value=m[1],rt(()=>o=!1)),t.$set(g),m[7].length>0?p?p.p(m,_):(p=ds(m),p.c(),p.m(e,null)):p&&(p.d(1),p=null)},i(m){s||(j(t.$$.fragment,m),s=!0)},o(m){B(t.$$.fragment,m),s=!1},d(m){m&&S(e),he(t),p&&p.d()}}}function ms(l){let e,t;return e=new Bl({props:{type:"is-danger","data-testid":"kg-search-error",$$slots:{default:[Qa]},$$scope:{ctx:l}}}),{c(){_e(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},p(n,o){const a={};o[0]&32|o[1]&1024&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function Qa(l){let e;return{c(){e=P(l[5])},m(t,n){R(t,e,n)},p(t,n){n[0]&32&&ve(e,t[5])},d(t){t&&S(e)}}}function Ya(l){let e,t,n,o,a,s,u;return{c(){e=f("div"),t=f("p"),t.textContent="Enter at least 2 characters to search the knowledge graph",n=h(),o=f("p"),a=P('This will search terms from the knowledge graph for role "'),s=P(l[9]),u=P('"'),c(t,"class","has-text-centered"),c(o,"class","has-text-centered is-size-7 mt-2"),c(e,"class","notification is-info is-light")},m(i,d){R(i,e,d),r(e,t),r(e,n),r(e,o),r(o,a),r(o,s),r(o,u)},p(i,d){d[0]&512&&ve(s,i[9])},d(i){i&&S(e)}}}function Za(l){let e,t,n,o,a,s,u,i,d,p,m;return{c(){e=f("div"),t=f("p"),n=P('No knowledge graph terms found for "'),o=f("strong"),a=P(l[1]),s=P('"'),u=h(),i=f("p"),d=P('Try different keywords or check if the role "'),p=P(l[9]),m=P('" has a knowledge graph enabled.'),c(t,"class","has-text-centered"),c(i,"class","has-text-centered is-size-7 has-text-grey mt-2"),c(e,"class","notification is-light"),c(e,"data-testid","kg-search-empty")},m(_,g){R(_,e,g),r(e,t),r(t,n),r(t,o),r(o,a),r(t,s),r(e,u),r(e,i),r(i,d),r(i,p),r(i,m)},p(_,g){g[0]&2&&ve(a,_[1]),g[0]&512&&ve(p,_[9])},d(_){_&&S(e)}}}function Xa(l){let e,t=l[3],n=[];for(let o=0;o<t.length;o+=1)n[o]=vs(us(l,t,o));return{c(){e=f("div");for(let o=0;o<n.length;o+=1)n[o].c();c(e,"class","suggestions-container svelte-k0eopx"),c(e,"data-testid","kg-suggestions-list")},m(o,a){R(o,e,a);for(let s=0;s<n.length;s+=1)n[s]&&n[s].m(e,null)},p(o,a){if(a[0]&16456){t=o[3];let s;for(s=0;s<t.length;s+=1){const u=us(o,t,s);n[s]?n[s].p(u,a):(n[s]=vs(u),n[s].c(),n[s].m(e,null))}for(;s<n.length;s+=1)n[s].d(1);n.length=t.length}},d(o){o&&S(e),tt(n,o)}}}function xa(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="progress-container svelte-k0eopx"><div class="progress-bar svelte-k0eopx"><div class="progress-fill svelte-k0eopx"></div></div></div> 
          <p>Searching knowledge graph...</p>`,c(e,"class","empty-state svelte-k0eopx"),c(e,"data-testid","kg-search-loading")},m(t,n){R(t,e,n)},p:Re,d(t){t&&S(e)}}}function _s(l){let e,t,n=l[35].normalized_term+"",o;return{c(){e=f("span"),t=P("→ "),o=P(n),c(e,"class","has-text-grey")},m(a,s){R(a,e,s),r(e,t),r(e,o)},p(a,s){s[0]&8&&n!==(n=a[35].normalized_term+"")&&ve(o,n)},d(a){a&&S(e)}}}function gs(l){let e,t=l[35].suggestion_type+"",n;return{c(){e=f("span"),n=P(t),c(e,"class","tag is-small is-light")},m(o,a){R(o,e,a),r(e,n)},p(o,a){a[0]&8&&t!==(t=o[35].suggestion_type+"")&&ve(n,t)},d(o){o&&S(e)}}}function hs(l){let e,t=l[35].url+"",n;return{c(){e=f("div"),n=P(t),c(e,"class","suggestion-url svelte-k0eopx")},m(o,a){R(o,e,a),r(e,n)},p(o,a){a[0]&8&&t!==(t=o[35].url+"")&&ve(n,t)},d(o){o&&S(e)}}}function vs(l){let e,t,n=l[35].term+"",o,a,s,u,i=(l[35].score*100).toFixed(0)+"",d,p,m,_,g,b,v,w,$,C=l[35].normalized_term&&l[35].normalized_term!==l[35].term&&_s(l),k=l[35].suggestion_type&&gs(l),T=l[35].url&&hs(l);function F(){return l[26](l[35])}function O(...N){return l[27](l[35],...N)}return{c(){var N;e=f("button"),t=f("div"),o=P(n),a=h(),s=f("div"),u=f("span"),d=P(i),p=P("%"),m=h(),C&&C.c(),_=h(),k&&k.c(),g=h(),T&&T.c(),b=h(),c(t,"class","suggestion-term svelte-k0eopx"),c(u,"class","tag is-info is-small"),c(s,"class","suggestion-meta svelte-k0eopx"),c(e,"class",v="suggestion-item "+(((N=l[6])==null?void 0:N.term)===l[35].term?"is-active":"")+" svelte-k0eopx"),c(e,"type","button"),c(e,"data-testid","kg-suggestion-item")},m(N,E){R(N,e,E),r(e,t),r(t,o),r(e,a),r(e,s),r(s,u),r(u,d),r(u,p),r(s,m),C&&C.m(s,null),r(s,_),k&&k.m(s,null),r(e,g),T&&T.m(e,null),r(e,b),w||($=[se(e,"click",F),se(e,"keydown",O)],w=!0)},p(N,E){var H;l=N,E[0]&8&&n!==(n=l[35].term+"")&&ve(o,n),E[0]&8&&i!==(i=(l[35].score*100).toFixed(0)+"")&&ve(d,i),l[35].normalized_term&&l[35].normalized_term!==l[35].term?C?C.p(l,E):(C=_s(l),C.c(),C.m(s,_)):C&&(C.d(1),C=null),l[35].suggestion_type?k?k.p(l,E):(k=gs(l),k.c(),k.m(s,null)):k&&(k.d(1),k=null),l[35].url?T?T.p(l,E):(T=hs(l),T.c(),T.m(e,b)):T&&(T.d(1),T=null),E[0]&72&&v!==(v="suggestion-item "+(((H=l[6])==null?void 0:H.term)===l[35].term?"is-active":"")+" svelte-k0eopx")&&c(e,"class",v)},d(N){N&&S(e),C&&C.d(),k&&k.d(),T&&T.d(),w=!1,Ze($)}}}function ec(l){let e;return{c(){e=P("Cancel")},m(t,n){R(t,e,n)},d(t){t&&S(e)}}}function bs(l){let e,t;return e=new Kt({props:{type:"is-primary",disabled:!l[6],"data-testid":"kg-add-term-button",$$slots:{default:[tc]},$$scope:{ctx:l}}}),e.$on("click",l[15]),{c(){_e(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},p(n,o){const a={};o[0]&64&&(a.disabled=!n[6]),o[0]&64|o[1]&1024&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function tc(l){let e,t=l[6].term+"",n,o;return{c(){e=P('Add "'),n=P(t),o=P('" to Context')},m(a,s){R(a,e,s),R(a,n,s),R(a,o,s)},p(a,s){s[0]&64&&t!==(t=a[6].term+"")&&ve(n,t)},d(a){a&&S(e),a&&S(n),a&&S(o)}}}function lc(l){let e;return{c(){e=P("Add Complete Thesaurus to Context")},m(t,n){R(t,e,n)},d(t){t&&S(e)}}}function nc(l){let e,t,n,o,a,s,u,i,d,p,m,_,g,b,v,w,$,C,k,T,F,O,N,E,H,ee,J,L,D;i=new Ft({props:{$$slots:{default:[Va]},$$scope:{ctx:l}}});let ne=l[5]&&ms(l);function W(Q,I){return I[0]&2&&(m=null),Q[4]?xa:Q[3].length>0?Xa:(m==null&&(m=Q[1].trim().length>=2),m?Za:Ya)}let oe=W(l,[-1,-1]),le=oe(l);v=new Kt({props:{$$slots:{default:[ec]},$$scope:{ctx:l}}}),v.$on("click",l[17]);let z=l[6]&&bs(l);return ee=new Kt({props:{type:"is-link",size:"is-small",style:"width: 100%;","data-testid":"kg-add-index-button",$$slots:{default:[lc]},$$scope:{ctx:l}}}),ee.$on("click",l[16]),{c(){e=f("div"),t=f("div"),n=f("button"),o=h(),a=f("div"),a.innerHTML=`<div class="modal-title svelte-k0eopx"><h3 class="svelte-k0eopx">Knowledge Graph Search</h3> 
          <p class="svelte-k0eopx">Search and add terms from the knowledge graph to your context</p></div>`,s=h(),u=f("div"),_e(i.$$.fragment),d=h(),ne&&ne.c(),p=h(),le.c(),_=h(),g=f("div"),b=f("div"),_e(v.$$.fragment),w=h(),z&&z.c(),$=h(),C=f("div"),k=f("div"),T=f("p"),F=f("strong"),F.textContent="Alternative:",O=P(' Add the complete thesaurus for role "'),N=P(l[9]),E=P('". This includes all domain-specific terms and their normalized mappings in JSON format for comprehensive vocabulary context.'),H=h(),_e(ee.$$.fragment),c(n,"class","delete is-large modal-close-btn svelte-k0eopx"),c(n,"aria-label","close"),c(a,"class","modal-header svelte-k0eopx"),c(u,"class","search-section svelte-k0eopx"),c(b,"class","action-buttons svelte-k0eopx"),c(g,"class","modal-actions svelte-k0eopx"),c(T,"class","svelte-k0eopx"),c(k,"class","alternative-content svelte-k0eopx"),c(C,"class","alternative-section svelte-k0eopx"),c(t,"class","kg-search-container svelte-k0eopx"),c(e,"class","box wrapper svelte-k0eopx"),c(e,"data-testid","kg-search-modal")},m(Q,I){R(Q,e,I),r(e,t),r(t,n),r(t,o),r(t,a),r(t,s),r(t,u),ge(i,u,null),r(t,d),ne&&ne.m(t,null),r(t,p),le.m(t,null),r(t,_),r(t,g),r(g,b),ge(v,b,null),r(b,w),z&&z.m(b,null),r(t,$),r(t,C),r(C,k),r(k,T),r(T,F),r(T,O),r(T,N),r(T,E),r(C,H),ge(ee,C,null),J=!0,L||(D=[se(n,"click",l[17]),se(t,"keydown",l[18])],L=!0)},p(Q,I){const U={};I[0]&406|I[1]&1024&&(U.$$scope={dirty:I,ctx:Q}),i.$set(U),Q[5]?ne?(ne.p(Q,I),I[0]&32&&j(ne,1)):(ne=ms(Q),ne.c(),j(ne,1),ne.m(t,p)):ne&&(Fe(),B(ne,1,1,()=>{ne=null}),Ke()),oe===(oe=W(Q,I))&&le?le.p(Q,I):(le.d(1),le=oe(Q),le&&(le.c(),le.m(t,_)));const y={};I[1]&1024&&(y.$$scope={dirty:I,ctx:Q}),v.$set(y),Q[6]?z?(z.p(Q,I),I[0]&64&&j(z,1)):(z=bs(Q),z.c(),j(z,1),z.m(b,null)):z&&(Fe(),B(z,1,1,()=>{z=null}),Ke()),(!J||I[0]&512)&&ve(N,Q[9]);const A={};I[1]&1024&&(A.$$scope={dirty:I,ctx:Q}),ee.$set(A)},i(Q){J||(j(i.$$.fragment,Q),j(ne),j(v.$$.fragment,Q),j(z),j(ee.$$.fragment,Q),J=!0)},o(Q){B(i.$$.fragment,Q),B(ne),B(v.$$.fragment,Q),B(z),B(ee.$$.fragment,Q),J=!1},d(Q){Q&&S(e),he(i),ne&&ne.d(),le.d(),he(v),z&&z.d(),he(ee),L=!1,Ze(D)}}}function oc(l){let e,t,n;function o(s){l[28](s)}let a={$$slots:{default:[nc]},$$scope:{ctx:l}};return l[0]!==void 0&&(a.active=l[0]),e=new kl({props:a}),lt.push(()=>st(e,"active",o)),e.$on("close",l[17]),{c(){_e(e.$$.fragment)},m(s,u){ge(e,s,u),n=!0},p(s,u){const i={};u[0]&1022|u[1]&1024&&(i.$$scope={dirty:u,ctx:s}),!t&&u[0]&1&&(t=!0,i.active=s[0],rt(()=>t=!1)),e.$set(i)},i(s){n||(j(e.$$.fragment,s),n=!0)},o(s){B(e.$$.fragment,s),n=!1},d(s){he(e,s)}}}function sc(l,e,t){let n,o;Ue(l,At,y=>t(9,n=y)),Ue(l,ct,y=>t(30,o=y));let{active:a=!1}=e,{initialQuery:s=""}=e,{conversationId:u=null}=e;const i=Ql();let d="",p=[],m=!1,_=null,g=null,b=null,v=[],w=-1,$;function C(){b&&clearTimeout(b),b=setTimeout(()=>{d.trim().length>=2?N():(t(3,p=[]),t(6,g=null))},300)}async function k(y){const A=y.trim();if(!A)return[];try{if(o){const M=await je("get_autocomplete_suggestions",{query:A,roleName:n,limit:8});if((M==null?void 0:M.status)==="success"&&Array.isArray(M.suggestions))return M.suggestions.map(Z=>Z.term)}else{const M=await fetch(`${Ve.ServerURL}/autocomplete/${encodeURIComponent(n)}/${encodeURIComponent(A)}`);if(M.ok){const Z=await M.json();if((Z==null?void 0:Z.status)==="success"&&Array.isArray(Z.suggestions))return Z.suggestions.map(V=>V.term)}}}catch(M){console.warn("KG typeahead failed",M)}return[]}async function T(){if(d.trim().length<1){t(7,v=[]),t(8,w=-1);return}t(7,v=await k(d)),t(8,w=-1)}async function F(y){t(6,g={term:y,score:1}),t(7,v=[]),t(8,w=-1),await H()}function O(y){v.length>0&&(y.key==="ArrowDown"?(y.preventDefault(),t(8,w=(w+1)%v.length)):y.key==="ArrowUp"?(y.preventDefault(),t(8,w=(w-1+v.length)%v.length)):(y.key==="Enter"||y.key==="Tab")&&w!==-1?(y.preventDefault(),F(v[w])):y.key==="Escape"&&(t(7,v=[]),t(8,w=-1)))}async function N(){if(!d.trim()||d.trim().length<2){t(3,p=[]);return}t(4,m=!0),t(5,_=null);try{if(o){const y=await je("search_kg_terms",{request:{query:d.trim(),role_name:n,limit:20,min_similarity:.6}});y.status==="success"?(t(3,p=y.suggestions||[]),p.length>0&&!g&&t(6,g=p[0])):(t(5,_=y.error||"Search failed"),t(3,p=[]))}else{if(!u){t(5,_="No active conversation. Please start a conversation first."),t(3,p=[]);return}const y=await fetch(`${Ve.ServerURL}/conversations/${u}/context/kg/search?query=${encodeURIComponent(d.trim())}&role=${encodeURIComponent(n)}`);if(y.ok){const A=await y.json();A.status==="success"?(t(3,p=A.suggestions||[]),p.length>0&&!g&&t(6,g=p[0])):(t(5,_=A.error||"Search failed"),t(3,p=[]))}else t(5,_=`HTTP ${y.status}: ${y.statusText}`),t(3,p=[])}}catch(y){console.error("KG search error:",y),t(5,_=`Search failed: ${y}`),t(3,p=[])}finally{t(4,m=!1)}}function E(y){t(6,g=y)}async function H(){if(g){if(!u){t(5,_="No active conversation. Please start a conversation first.");return}try{if(o)await je("add_kg_term_context",{request:{conversation_id:u,term:g.term,role_name:n}}),i("termAdded",{term:g.term,suggestion:g}),J();else{const y=await fetch(`${Ve.ServerURL}/conversations/${u}/context/kg/term`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({term:g.term,role:n})});if(y.ok){const A=await y.json();A.status==="success"?(i("termAdded",{term:g.term,suggestion:g}),J()):t(5,_=A.error||"Failed to add term to context")}else t(5,_=`HTTP ${y.status}: ${y.statusText}`)}}catch(y){console.error("Error adding term to context:",y),t(5,_=`Failed to add term to context: ${y}`)}}}async function ee(){if(!u){t(5,_="No active conversation. Please start a conversation first.");return}try{if(o)await je("add_kg_index_context",{request:{conversation_id:u,role_name:n}}),i("kgIndexAdded",{role:n}),J();else{const y=await fetch(`${Ve.ServerURL}/conversations/${u}/context/kg/index`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({role:n})});if(y.ok){const A=await y.json();A.status==="success"?(i("kgIndexAdded",{role:n}),J()):t(5,_=A.error||"Failed to add KG index to context")}else t(5,_=`HTTP ${y.status}: ${y.statusText}`)}}catch(y){console.error("Error adding KG index to context:",y),t(5,_=`Failed to add KG index to context: ${y}`)}}function J(){t(0,a=!1),t(1,d=""),t(3,p=[]),t(6,g=null),t(5,_=null),t(4,m=!1),b&&(clearTimeout(b),b=null)}function L(y){switch(y.key){case"Escape":J();break;case"ArrowDown":y.preventDefault(),D(1);break;case"ArrowUp":y.preventDefault(),D(-1);break;case"Enter":y.preventDefault(),g&&H();break}}function D(y){if(p.length===0)return;let M=(g?p.findIndex(Z=>Z.term===(g==null?void 0:g.term)):-1)+y;M<0?M=p.length-1:M>=p.length&&(M=0),t(6,g=p[M])}Wl(()=>{b&&clearTimeout(b)});function ne(y){$=y,t(2,$)}function W(y){d=y,t(1,d),t(0,a),t(19,s)}const oe=()=>{C(),T()},le=y=>F(y),z=(y,A)=>{(A.key==="Enter"||A.key===" ")&&(A.preventDefault(),F(y))},Q=y=>E(y),I=(y,A)=>A.key==="Enter"&&E(y);function U(y){a=y,t(0,a)}return l.$$set=y=>{"active"in y&&t(0,a=y.active),"initialQuery"in y&&t(19,s=y.initialQuery),"conversationId"in y&&t(20,u=y.conversationId)},l.$$.update=()=>{l.$$.dirty[0]&524291&&a&&s!==d&&(t(1,d=s),d.trim()&&N()),l.$$.dirty[0]&5&&a&&$&&setTimeout(()=>{$==null||$.focus(),t(5,_=null)},100)},[a,d,$,p,m,_,g,v,w,n,C,T,F,O,E,H,ee,J,L,s,u,ne,W,oe,le,z,Q,I,U]}class rc extends _t{constructor(e){super(),gt(this,e,sc,oc,pt,{active:0,initialQuery:19,conversationId:20},null,[-1,-1])}}function ic(l){const e=l.slice(),t=e[0].kg_index_info;return e[9]=t,e}function ac(l){const e=l.slice(),t=e[0].kg_term_definition;return e[8]=t,e}function cc(l){let e=l[0].context_type==="KGTermDefinition"?"KG Term":"KG Index",t;return{c(){t=P(e)},m(n,o){R(n,t,o)},p(n,o){o&1&&e!==(e=n[0].context_type==="KGTermDefinition"?"KG Term":"KG Index")&&ve(t,e)},d(n){n&&S(t)}}}function uc(l){let e,t;return e=new Qt({props:{icon:"fas fa-eye",size:"is-small"}}),{c(){_e(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},p:Re,i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function ks(l){let e,t;return e=new Kt({props:{size:"is-small",type:"is-ghost",title:"Remove from context",$$slots:{default:[fc]},$$scope:{ctx:l}}}),e.$on("click",l[5]),{c(){_e(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},p(n,o){const a={};o&1024&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function fc(l){let e,t;return e=new Qt({props:{icon:"fas fa-times",size:"is-small"}}),{c(){_e(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},p:Re,i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function dc(l){let e,t,n,o=dl(l[9].total_terms)+"",a,s,u,i,d,p,m,_=dl(l[9].total_nodes)+"",g,b,v,w,$,C,k,T=dl(l[9].total_edges)+"",F,O,N,E,H,ee,J,L=(l[9].version||"N/A")+"",D,ne,W,oe,le,z,Q,I=!l[2]&&ws();return{c(){e=f("div"),t=f("div"),n=f("div"),a=P(o),u=h(),i=f("div"),i.textContent="Terms",d=h(),p=f("div"),m=f("div"),g=P(_),v=h(),w=f("div"),w.textContent="Nodes",$=h(),C=f("div"),k=f("div"),F=P(T),N=h(),E=f("div"),E.textContent="Edges",H=h(),ee=f("div"),J=f("div"),D=P(L),W=h(),oe=f("div"),oe.textContent="Version",z=h(),I&&I.c(),Q=ut(),c(n,"class",s="stat-value "+(l[2]?"compact":"")+" svelte-lkmjyw"),c(i,"class","stat-label svelte-lkmjyw"),c(t,"class","stat-item svelte-lkmjyw"),c(m,"class",b="stat-value "+(l[2]?"compact":"")+" svelte-lkmjyw"),c(w,"class","stat-label svelte-lkmjyw"),c(p,"class","stat-item svelte-lkmjyw"),c(k,"class",O="stat-value "+(l[2]?"compact":"")+" svelte-lkmjyw"),c(E,"class","stat-label svelte-lkmjyw"),c(C,"class","stat-item svelte-lkmjyw"),c(J,"class",ne="stat-value "+(l[2]?"compact":"")+" svelte-lkmjyw"),c(oe,"class","stat-label svelte-lkmjyw"),c(ee,"class","stat-item svelte-lkmjyw"),c(e,"class",le="kg-index-stats "+(l[2]?"compact":"")+" svelte-lkmjyw")},m(U,y){R(U,e,y),r(e,t),r(t,n),r(n,a),r(t,u),r(t,i),r(e,d),r(e,p),r(p,m),r(m,g),r(p,v),r(p,w),r(e,$),r(e,C),r(C,k),r(k,F),r(C,N),r(C,E),r(e,H),r(e,ee),r(ee,J),r(J,D),r(ee,W),r(ee,oe),R(U,z,y),I&&I.m(U,y),R(U,Q,y)},p(U,y){y&1&&o!==(o=dl(U[9].total_terms)+"")&&ve(a,o),y&4&&s!==(s="stat-value "+(U[2]?"compact":"")+" svelte-lkmjyw")&&c(n,"class",s),y&1&&_!==(_=dl(U[9].total_nodes)+"")&&ve(g,_),y&4&&b!==(b="stat-value "+(U[2]?"compact":"")+" svelte-lkmjyw")&&c(m,"class",b),y&1&&T!==(T=dl(U[9].total_edges)+"")&&ve(F,T),y&4&&O!==(O="stat-value "+(U[2]?"compact":"")+" svelte-lkmjyw")&&c(k,"class",O),y&1&&L!==(L=(U[9].version||"N/A")+"")&&ve(D,L),y&4&&ne!==(ne="stat-value "+(U[2]?"compact":"")+" svelte-lkmjyw")&&c(J,"class",ne),y&4&&le!==(le="kg-index-stats "+(U[2]?"compact":"")+" svelte-lkmjyw")&&c(e,"class",le),U[2]?I&&(I.d(1),I=null):I||(I=ws(),I.c(),I.m(Q.parentNode,Q))},i:Re,o:Re,d(U){U&&S(e),U&&S(z),I&&I.d(U),U&&S(Q)}}}function pc(l){let e,t,n,o,a,s,u,i,d,p=l[8].definition&&ys(l),m=l[8].synonyms.length>0&&$s(l),_=l[8].related_terms.length>0&&Cs(l),g=l[8].usage_examples.length>0&&Ts(l),b=l[8].url&&Ss(l);return{c(){e=f("div"),p&&p.c(),t=h(),n=f("div"),m&&m.c(),o=h(),_&&_.c(),a=h(),g&&g.c(),s=h(),b&&b.c(),c(n,"class",u="term-metadata "+(l[2]?"compact":"")+" svelte-lkmjyw"),c(e,"class",i="term-definition "+(l[2]?"compact":"")+" svelte-lkmjyw")},m(v,w){R(v,e,w),p&&p.m(e,null),r(e,t),r(e,n),m&&m.m(n,null),r(n,o),_&&_.m(n,null),r(n,a),g&&g.m(n,null),r(n,s),b&&b.m(n,null),d=!0},p(v,w){v[8].definition?p?p.p(v,w):(p=ys(v),p.c(),p.m(e,t)):p&&(p.d(1),p=null),v[8].synonyms.length>0?m?(m.p(v,w),w&1&&j(m,1)):(m=$s(v),m.c(),j(m,1),m.m(n,o)):m&&(Fe(),B(m,1,1,()=>{m=null}),Ke()),v[8].related_terms.length>0?_?(_.p(v,w),w&1&&j(_,1)):(_=Cs(v),_.c(),j(_,1),_.m(n,a)):_&&(Fe(),B(_,1,1,()=>{_=null}),Ke()),v[8].usage_examples.length>0?g?(g.p(v,w),w&1&&j(g,1)):(g=Ts(v),g.c(),j(g,1),g.m(n,s)):g&&(Fe(),B(g,1,1,()=>{g=null}),Ke()),v[8].url?b?w&1&&j(b,1):(b=Ss(v),b.c(),j(b,1),b.m(n,null)):b&&(Fe(),B(b,1,1,()=>{b=null}),Ke()),(!d||w&4&&u!==(u="term-metadata "+(v[2]?"compact":"")+" svelte-lkmjyw"))&&c(n,"class",u),(!d||w&4&&i!==(i="term-definition "+(v[2]?"compact":"")+" svelte-lkmjyw"))&&c(e,"class",i)},i(v){d||(j(m),j(_),j(g),j(b),d=!0)},o(v){B(m),B(_),B(g),B(b),d=!1},d(v){v&&S(e),p&&p.d(),m&&m.d(),_&&_.d(),g&&g.d(),b&&b.d()}}}function ws(l){let e;return{c(){e=f("div"),e.innerHTML='<p class="is-size-7"><strong>Thesaurus Data:</strong> This context item contains the complete thesaurus as JSON, providing all domain-specific vocabulary and term mappings for comprehensive AI understanding.</p>',c(e,"class","notification is-success is-light mt-3")},m(t,n){R(t,e,n)},d(t){t&&S(e)}}}function ys(l){let e,t=l[8].definition+"",n,o;return{c(){e=f("div"),n=P(t),c(e,"class",o="definition-text "+(l[2]?"compact":"")+" svelte-lkmjyw")},m(a,s){R(a,e,s),r(e,n)},p(a,s){s&1&&t!==(t=a[8].definition+"")&&ve(n,t),s&4&&o!==(o="definition-text "+(a[2]?"compact":"")+" svelte-lkmjyw")&&c(e,"class",o)},d(a){a&&S(e)}}}function $s(l){let e,t;return e=new Gt({props:{type:"is-light",size:"is-small",title:"Synonyms",$$slots:{default:[mc]},$$scope:{ctx:l}}}),{c(){_e(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},p(n,o){const a={};o&1025&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function mc(l){let e,t,n,o=l[8].synonyms.length+"",a,s,u=l[8].synonyms.length!==1?"s":"",i,d;return e=new Qt({props:{icon:"fas fa-equals",size:"is-small"}}),{c(){_e(e.$$.fragment),t=h(),n=f("span"),a=P(o),s=P(" synonym"),i=P(u)},m(p,m){ge(e,p,m),R(p,t,m),R(p,n,m),r(n,a),r(n,s),r(n,i),d=!0},p(p,m){(!d||m&1)&&o!==(o=p[8].synonyms.length+"")&&ve(a,o),(!d||m&1)&&u!==(u=p[8].synonyms.length!==1?"s":"")&&ve(i,u)},i(p){d||(j(e.$$.fragment,p),d=!0)},o(p){B(e.$$.fragment,p),d=!1},d(p){he(e,p),p&&S(t),p&&S(n)}}}function Cs(l){let e,t;return e=new Gt({props:{type:"is-light",size:"is-small",title:"Related Terms",$$slots:{default:[_c]},$$scope:{ctx:l}}}),{c(){_e(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},p(n,o){const a={};o&1025&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function _c(l){let e,t,n,o=l[8].related_terms.length+"",a,s,u;return e=new Qt({props:{icon:"fas fa-link",size:"is-small"}}),{c(){_e(e.$$.fragment),t=h(),n=f("span"),a=P(o),s=P(" related")},m(i,d){ge(e,i,d),R(i,t,d),R(i,n,d),r(n,a),r(n,s),u=!0},p(i,d){(!u||d&1)&&o!==(o=i[8].related_terms.length+"")&&ve(a,o)},i(i){u||(j(e.$$.fragment,i),u=!0)},o(i){B(e.$$.fragment,i),u=!1},d(i){he(e,i),i&&S(t),i&&S(n)}}}function Ts(l){let e,t;return e=new Gt({props:{type:"is-light",size:"is-small",title:"Usage Examples",$$slots:{default:[gc]},$$scope:{ctx:l}}}),{c(){_e(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},p(n,o){const a={};o&1025&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function gc(l){let e,t,n,o=l[8].usage_examples.length+"",a,s,u=l[8].usage_examples.length!==1?"s":"",i,d;return e=new Qt({props:{icon:"fas fa-quote-left",size:"is-small"}}),{c(){_e(e.$$.fragment),t=h(),n=f("span"),a=P(o),s=P(" example"),i=P(u)},m(p,m){ge(e,p,m),R(p,t,m),R(p,n,m),r(n,a),r(n,s),r(n,i),d=!0},p(p,m){(!d||m&1)&&o!==(o=p[8].usage_examples.length+"")&&ve(a,o),(!d||m&1)&&u!==(u=p[8].usage_examples.length!==1?"s":"")&&ve(i,u)},i(p){d||(j(e.$$.fragment,p),d=!0)},o(p){B(e.$$.fragment,p),d=!1},d(p){he(e,p),p&&S(t),p&&S(n)}}}function Ss(l){let e,t;return e=new Gt({props:{type:"is-link",size:"is-small",$$slots:{default:[hc]},$$scope:{ctx:l}}}),{c(){_e(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function hc(l){let e,t,n,o;return e=new Qt({props:{icon:"fas fa-external-link-alt",size:"is-small"}}),{c(){_e(e.$$.fragment),t=h(),n=f("span"),n.textContent="Source"},m(a,s){ge(e,a,s),R(a,t,s),R(a,n,s),o=!0},p:Re,i(a){o||(j(e.$$.fragment,a),o=!0)},o(a){B(e.$$.fragment,a),o=!1},d(a){he(e,a),a&&S(t),a&&S(n)}}}function Rs(l){let e,t=l[0].summary+"",n;return{c(){e=f("div"),n=P(t),c(e,"class","context-summary svelte-lkmjyw")},m(o,a){R(o,e,a),r(e,n)},p(o,a){a&1&&t!==(t=o[0].summary+"")&&ve(n,t)},d(o){o&&S(e)}}}function As(l){let e,t,n=(l[0].relevance_score*100).toFixed(0)+"",o,a;return{c(){e=f("span"),t=P("Relevance: "),o=P(n),a=P("%"),c(e,"class","relevance-score svelte-lkmjyw")},m(s,u){R(s,e,u),r(e,t),r(e,o),r(e,a)},p(s,u){u&1&&n!==(n=(s[0].relevance_score*100).toFixed(0)+"")&&ve(o,n)},d(s){s&&S(e)}}}function Es(l){let e,t,n,o=(l[0].metadata.document_title||l[0].metadata.source_document)+"",a,s;return t=new Qt({props:{icon:"fas fa-file-alt",size:"is-small"}}),{c(){e=f("span"),_e(t.$$.fragment),n=h(),a=P(o),c(e,"title","Source Document")},m(u,i){R(u,e,i),ge(t,e,null),r(e,n),r(e,a),s=!0},p(u,i){(!s||i&1)&&o!==(o=(u[0].metadata.document_title||u[0].metadata.source_document)+"")&&ve(a,o)},i(u){s||(j(t.$$.fragment,u),s=!0)},o(u){B(t.$$.fragment,u),s=!1},d(u){u&&S(e),he(t)}}}function vc(l){let e,t,n,o,a,s,u=l[0].title+"",i,d,p,m,_,g,b,v,w,$,C,k,T,F,O,N,E,H,ee,J=Ls(l[0].created_at)+"",L,D,ne,W,oe,le;o=new Qt({props:{icon:l[4],size:"is-small"}}),m=new Gt({props:{type:l[3],size:"is-small",$$slots:{default:[cc]},$$scope:{ctx:l}}}),b=new Kt({props:{size:"is-small",type:"is-ghost",title:"View details",$$slots:{default:[uc]},$$scope:{ctx:l}}}),b.$on("click",l[6]);let z=l[1]&&ks(l);const Q=[pc,dc],I=[];function U(V,X){return V[0].context_type==="KGTermDefinition"&&V[0].kg_term_definition?0:V[0].context_type==="KGIndex"&&V[0].kg_index_info?1:-1}function y(V,X){if(X===0)return ac(V);if(X===1)return ic(V)}~(k=U(l))&&(T=I[k]=Q[k](y(l,k)));let A=l[0].summary&&!l[2]&&Rs(l),M=l[0].relevance_score&&As(l),Z=l[0].metadata.source_document&&Es(l);return{c(){e=f("div"),t=f("div"),n=f("div"),_e(o.$$.fragment),a=h(),s=f("span"),i=P(u),p=h(),_e(m.$$.fragment),_=h(),g=f("div"),_e(b.$$.fragment),v=h(),z&&z.c(),$=h(),C=f("div"),T&&T.c(),F=h(),A&&A.c(),N=h(),E=f("div"),H=f("span"),ee=P("Added "),L=P(J),D=h(),M&&M.c(),ne=h(),Z&&Z.c(),c(s,"class",d="context-title-text "+(l[2]?"compact":"")+" svelte-lkmjyw"),c(n,"class","context-title svelte-lkmjyw"),c(g,"class","context-actions svelte-lkmjyw"),c(t,"class",w="context-header "+(l[2]?"compact":"")+" svelte-lkmjyw"),c(C,"class",O="context-content "+(l[2]?"compact":"")+" svelte-lkmjyw"),c(E,"class",W="context-meta "+(l[2]?"compact":"")+" svelte-lkmjyw"),c(e,"class",oe="kg-context-item "+(l[2]?"compact":"")+" svelte-lkmjyw")},m(V,X){R(V,e,X),r(e,t),r(t,n),ge(o,n,null),r(n,a),r(n,s),r(s,i),r(n,p),ge(m,n,null),r(t,_),r(t,g),ge(b,g,null),r(g,v),z&&z.m(g,null),r(e,$),r(e,C),~k&&I[k].m(C,null),r(C,F),A&&A.m(C,null),r(e,N),r(e,E),r(E,H),r(H,ee),r(H,L),r(E,D),M&&M.m(E,null),r(E,ne),Z&&Z.m(E,null),le=!0},p(V,[X]){const Y={};X&16&&(Y.icon=V[4]),o.$set(Y),(!le||X&1)&&u!==(u=V[0].title+"")&&ve(i,u),(!le||X&4&&d!==(d="context-title-text "+(V[2]?"compact":"")+" svelte-lkmjyw"))&&c(s,"class",d);const re={};X&8&&(re.type=V[3]),X&1025&&(re.$$scope={dirty:X,ctx:V}),m.$set(re);const pe={};X&1024&&(pe.$$scope={dirty:X,ctx:V}),b.$set(pe),V[1]?z?(z.p(V,X),X&2&&j(z,1)):(z=ks(V),z.c(),j(z,1),z.m(g,null)):z&&(Fe(),B(z,1,1,()=>{z=null}),Ke()),(!le||X&4&&w!==(w="context-header "+(V[2]?"compact":"")+" svelte-lkmjyw"))&&c(t,"class",w);let ie=k;k=U(V),k===ie?~k&&I[k].p(y(V,k),X):(T&&(Fe(),B(I[ie],1,1,()=>{I[ie]=null}),Ke()),~k?(T=I[k],T?T.p(y(V,k),X):(T=I[k]=Q[k](y(V,k)),T.c()),j(T,1),T.m(C,F)):T=null),V[0].summary&&!V[2]?A?A.p(V,X):(A=Rs(V),A.c(),A.m(C,null)):A&&(A.d(1),A=null),(!le||X&4&&O!==(O="context-content "+(V[2]?"compact":"")+" svelte-lkmjyw"))&&c(C,"class",O),(!le||X&1)&&J!==(J=Ls(V[0].created_at)+"")&&ve(L,J),V[0].relevance_score?M?M.p(V,X):(M=As(V),M.c(),M.m(E,ne)):M&&(M.d(1),M=null),V[0].metadata.source_document?Z?(Z.p(V,X),X&1&&j(Z,1)):(Z=Es(V),Z.c(),j(Z,1),Z.m(E,null)):Z&&(Fe(),B(Z,1,1,()=>{Z=null}),Ke()),(!le||X&4&&W!==(W="context-meta "+(V[2]?"compact":"")+" svelte-lkmjyw"))&&c(E,"class",W),(!le||X&4&&oe!==(oe="kg-context-item "+(V[2]?"compact":"")+" svelte-lkmjyw"))&&c(e,"class",oe)},i(V){le||(j(o.$$.fragment,V),j(m.$$.fragment,V),j(b.$$.fragment,V),j(z),j(T),j(Z),le=!0)},o(V){B(o.$$.fragment,V),B(m.$$.fragment,V),B(b.$$.fragment,V),B(z),B(T),B(Z),le=!1},d(V){V&&S(e),he(o),he(m),he(b),z&&z.d(),~k&&I[k].d(),A&&A.d(),M&&M.d(),Z&&Z.d()}}}function dl(l){return new Intl.NumberFormat().format(l)}function Ls(l){try{return new Date(l).toLocaleDateString()}catch{return l}}function bc(l,e,t){let n,o,{contextItem:a}=e,{removable:s=!0}=e,{compact:u=!1}=e;const i=Ql();function d(){i("remove",{contextId:a.id})}function p(){i("viewDetails",{contextItem:a})}return l.$$set=m=>{"contextItem"in m&&t(0,a=m.contextItem),"removable"in m&&t(1,s=m.removable),"compact"in m&&t(2,u=m.compact)},l.$$.update=()=>{l.$$.dirty&1&&t(4,n=a.context_type==="KGTermDefinition"?"fas fa-tag":"fas fa-sitemap"),l.$$.dirty&1&&t(3,o=a.context_type==="KGTermDefinition"?"is-info":"is-primary")},[a,s,u,o,n,d,p]}class kc extends _t{constructor(e){super(),gt(this,e,bc,vc,pt,{contextItem:0,removable:1,compact:2})}}function Ds(l,e,t){const n=l.slice();return n[47]=e[t],n[49]=t,n}function Is(l,e,t){const n=l.slice();return n[50]=e[t],n[52]=t,n}function Ns(l){let e,t,n;return{c(){e=f("p"),t=P("Conversation ID: "),n=P(l[5]),c(e,"class","is-size-7 has-text-grey")},m(o,a){R(o,e,a),r(e,t),r(e,n)},p(o,a){a[0]&32&&ve(n,o[5])},d(o){o&&S(e)}}}function Os(l){let e,t,n,o=l[50].content+"",a,s;return{c(){e=f("div"),t=f("div"),n=f("pre"),a=P(o),c(n,"class","svelte-rbq0zi"),c(t,"class","bubble svelte-rbq0zi"),c(e,"class",s=Pt(`msg ${l[50].role}`)+" svelte-rbq0zi")},m(u,i){R(u,e,i),r(e,t),r(t,n),r(n,a)},p(u,i){i[0]&1&&o!==(o=u[50].content+"")&&ve(a,o),i[0]&1&&s!==(s=Pt(`msg ${u[50].role}`)+" svelte-rbq0zi")&&c(e,"class",s)},d(u){u&&S(e)}}}function Ps(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="bubble loading svelte-rbq0zi"><span class="icon is-small"><i class="fas fa-spinner fa-spin"></i></span> 
            <span>Thinking...</span></div>`,c(e,"class","msg assistant svelte-rbq0zi")},m(t,n){R(t,e,n)},d(t){t&&S(e)}}}function Ms(l){let e,t,n;return{c(){e=f("p"),t=P("Model: "),n=P(l[4]),c(e,"class","is-size-7 has-text-grey")},m(o,a){R(o,e,a),r(e,t),r(e,n)},p(o,a){a[0]&16&&ve(n,o[4])},d(o){o&&S(e)}}}function js(l){let e,t;return{c(){e=f("p"),t=P(l[3]),c(e,"class","has-text-danger is-size-7")},m(n,o){R(n,e,o),r(e,t)},p(n,o){o[0]&8&&ve(t,n[3])},d(n){n&&S(e)}}}function wc(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-refresh"></i>',c(e,"class","icon is-small")},m(t,n){R(t,e,n)},d(t){t&&S(e)}}}function yc(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-spinner fa-spin"></i>',c(e,"class","icon is-small")},m(t,n){R(t,e,n)},d(t){t&&S(e)}}}function Us(l){let e,t,n,o,a,s,u,i,d,p,m,_,g,b,v,w,$,C,k,T,F,O,N,E,H,ee,J,L,D,ne,W,oe,le,z,Q,I,U,y;function A(V,X){return V[12]?Cc:$c}let M=A(l),Z=M(l);return{c(){e=f("div"),t=f("div"),n=f("label"),n.textContent="Context Type",o=h(),a=f("div"),s=f("div"),u=f("select"),i=f("option"),i.textContent="Document",d=f("option"),d.textContent="Search Result",p=f("option"),p.textContent="User Input",m=f("option"),m.textContent="Note",_=h(),g=f("div"),b=f("label"),b.textContent="Title",v=h(),w=f("div"),$=f("input"),C=h(),k=f("div"),T=f("label"),T.textContent="Content",F=h(),O=f("div"),N=f("textarea"),E=h(),H=f("div"),ee=f("div"),J=f("button"),Z.c(),L=h(),D=f("span"),D.textContent="Save Context",W=h(),oe=f("div"),le=f("button"),z=f("span"),z.innerHTML='<i class="fas fa-times"></i>',Q=h(),I=f("span"),I.textContent="Cancel",c(n,"class","label is-small"),i.__value="document",i.value=i.__value,d.__value="search_result",d.value=d.__value,p.__value="user_input",p.value=p.__value,m.__value="note",m.value=m.__value,c(u,"data-testid","context-type-select"),l[11]===void 0&&mt(()=>l[30].call(u)),c(s,"class","select is-small is-fullwidth"),c(a,"class","control"),c(t,"class","field"),c(b,"class","label is-small"),c($,"class","input is-small"),c($,"type","text"),c($,"placeholder","Enter context title"),c($,"data-testid","context-title-input"),c(w,"class","control"),c(g,"class","field"),c(T,"class","label is-small"),c(N,"class","textarea is-small"),c(N,"rows","4"),c(N,"placeholder","Enter context content"),c(N,"data-testid","context-content-textarea"),c(O,"class","control"),c(k,"class","field"),c(J,"class","button is-primary is-small"),J.disabled=ne=l[12]||!l[9].trim()||!l[10].trim(),c(J,"data-testid","add-context-submit-button"),c(ee,"class","control"),c(z,"class","icon is-small"),c(le,"class","button is-light is-small"),le.disabled=l[12],c(oe,"class","control"),c(H,"class","field is-grouped"),c(e,"class","box has-background-light mb-4"),c(e,"data-testid","add-context-form")},m(V,X){R(V,e,X),r(e,t),r(t,n),r(t,o),r(t,a),r(a,s),r(s,u),r(u,i),r(u,d),r(u,p),r(u,m),Je(u,l[11],!0),r(e,_),r(e,g),r(g,b),r(g,v),r(g,w),r(w,$),Ie($,l[9]),r(e,C),r(e,k),r(k,T),r(k,F),r(k,O),r(O,N),Ie(N,l[10]),r(e,E),r(e,H),r(H,ee),r(ee,J),Z.m(J,null),r(J,L),r(J,D),r(H,W),r(H,oe),r(oe,le),r(le,z),r(le,Q),r(le,I),U||(y=[se(u,"change",l[30]),se($,"input",l[31]),se(N,"input",l[32]),se(J,"click",l[19]),se(le,"click",l[18])],U=!0)},p(V,X){X[0]&2048&&Je(u,V[11]),X[0]&512&&$.value!==V[9]&&Ie($,V[9]),X[0]&1024&&Ie(N,V[10]),M!==(M=A(V))&&(Z.d(1),Z=M(V),Z&&(Z.c(),Z.m(J,L))),X[0]&5632&&ne!==(ne=V[12]||!V[9].trim()||!V[10].trim())&&(J.disabled=ne),X[0]&4096&&(le.disabled=V[12])},d(V){V&&S(e),Z.d(),U=!1,Ze(y)}}}function $c(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-save"></i>',c(e,"class","icon is-small")},m(t,n){R(t,e,n)},d(t){t&&S(e)}}}function Cc(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-spinner fa-spin"></i>',c(e,"class","icon is-small")},m(t,n){R(t,e,n)},d(t){t&&S(e)}}}function Tc(l){let e,t,n=l[6],o=[];for(let s=0;s<n.length;s+=1)o[s]=Fs(Ds(l,n,s));const a=s=>B(o[s],1,1,()=>{o[s]=null});return{c(){e=f("div");for(let s=0;s<o.length;s+=1)o[s].c();c(e,"class","context-items svelte-rbq0zi"),c(e,"data-testid","conversation-context")},m(s,u){R(s,e,u);for(let i=0;i<o.length;i+=1)o[i]&&o[i].m(e,null);t=!0},p(s,u){if(u[0]&7340096){n=s[6];let i;for(i=0;i<n.length;i+=1){const d=Ds(s,n,i);o[i]?(o[i].p(d,u),j(o[i],1)):(o[i]=Fs(d),o[i].c(),j(o[i],1),o[i].m(e,null))}for(Fe(),i=n.length;i<o.length;i+=1)a(i);Ke()}},i(s){if(!t){for(let u=0;u<n.length;u+=1)j(o[u]);t=!0}},o(s){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)B(o[u]);t=!1},d(s){s&&S(e),tt(o,s)}}}function Sc(l){let e;return{c(){e=f("div"),e.innerHTML=`<span class="icon is-large"><i class="fas fa-inbox fa-2x"></i></span> 
              <p class="is-size-6">No context items yet</p> 
              <p class="is-size-7">Add documents from search results to provide context for your chat.</p>`,c(e,"class","has-text-centered has-text-grey-light"),c(e,"data-testid","empty-context-message")},m(t,n){R(t,e,n)},p:Re,i:Re,o:Re,d(t){t&&S(e)}}}function Rc(l){let e,t,n,o,a,s=l[47].context_type.replace(/([A-Z])/g," $1").trim()+"",u,i,d,p,m,_,g,b,v,w,$,C,k,T,F,O=l[47].title+"",N,E,H,ee,J,L,D=new Date(l[47].created_at).toLocaleString()+"",ne,W,oe,le,z,Q=l[47].relevance_score&&zs(l);function I(){return l[35](l[47])}function U(){return l[36](l[47])}function y(Z,V){return Z[47].summary?Lc:Ec}let A=y(l),M=A(l);return{c(){e=f("div"),t=f("div"),n=f("div"),o=f("div"),a=f("span"),u=P(s),d=h(),p=f("div"),m=f("div"),Q&&Q.c(),_=h(),g=f("div"),b=f("div"),v=f("div"),w=f("button"),w.innerHTML='<span class="icon is-small"><i class="fas fa-edit"></i></span>',$=h(),C=f("div"),k=f("button"),k.innerHTML='<span class="icon is-small"><i class="fas fa-trash"></i></span>',T=h(),F=f("h6"),N=P(O),E=h(),H=f("div"),M.c(),ee=h(),J=f("div"),L=P("Added: "),ne=P(D),c(a,"class",i="tag is-small "+(l[47].context_type==="Document"?"is-info":l[47].context_type==="SearchResult"?"is-primary":l[47].context_type==="UserInput"?"is-warning":"is-light")),c(a,"data-testid",`context-type-${l[49]}`),c(o,"class","level-item"),c(n,"class","level-left"),c(m,"class","level-item"),c(w,"class","button is-small is-light"),c(w,"data-testid",`edit-context-${l[49]}`),c(w,"title","Edit context"),c(v,"class","control"),c(k,"class","button is-small is-light is-danger"),c(k,"data-testid",`delete-context-${l[49]}`),c(k,"title","Delete context"),c(C,"class","control"),c(b,"class","field is-grouped"),c(g,"class","level-item context-actions svelte-rbq0zi"),c(p,"class","level-right"),c(t,"class","level is-mobile"),c(F,"class","title is-6 has-text-dark"),c(F,"data-testid",`context-title-${l[49]}`),c(H,"class","content is-small"),c(J,"class","is-size-7 has-text-grey"),c(e,"class","context-item svelte-rbq0zi"),c(e,"data-context-id",W=l[47].id),c(e,"data-testid",`context-item-${l[49]}`),c(e,"data-context-type",oe=l[47].context_type)},m(Z,V){R(Z,e,V),r(e,t),r(t,n),r(n,o),r(o,a),r(a,u),r(t,d),r(t,p),r(p,m),Q&&Q.m(m,null),r(p,_),r(p,g),r(g,b),r(b,v),r(v,w),r(b,$),r(b,C),r(C,k),r(e,T),r(e,F),r(F,N),r(e,E),r(e,H),M.m(H,null),r(e,ee),r(e,J),r(J,L),r(J,ne),le||(z=[se(w,"click",I),se(k,"click",U)],le=!0)},p(Z,V){l=Z,V[0]&64&&s!==(s=l[47].context_type.replace(/([A-Z])/g," $1").trim()+"")&&ve(u,s),V[0]&64&&i!==(i="tag is-small "+(l[47].context_type==="Document"?"is-info":l[47].context_type==="SearchResult"?"is-primary":l[47].context_type==="UserInput"?"is-warning":"is-light"))&&c(a,"class",i),l[47].relevance_score?Q?Q.p(l,V):(Q=zs(l),Q.c(),Q.m(m,null)):Q&&(Q.d(1),Q=null),V[0]&64&&O!==(O=l[47].title+"")&&ve(N,O),A===(A=y(l))&&M?M.p(l,V):(M.d(1),M=A(l),M&&(M.c(),M.m(H,null))),V[0]&64&&D!==(D=new Date(l[47].created_at).toLocaleString()+"")&&ve(ne,D),V[0]&64&&W!==(W=l[47].id)&&c(e,"data-context-id",W),V[0]&64&&oe!==(oe=l[47].context_type)&&c(e,"data-context-type",oe)},i:Re,o:Re,d(Z){Z&&S(e),Q&&Q.d(),M.d(),le=!1,Ze(z)}}}function Ac(l){let e,t;return e=new kc({props:{contextItem:l[47],compact:!0}}),e.$on("remove",l[33]),e.$on("viewDetails",l[34]),{c(){_e(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},p(n,o){const a={};o[0]&64&&(a.contextItem=n[47]),e.$set(a)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function zs(l){let e,t=l[47].relevance_score.toFixed(1)+"",n;return{c(){e=f("span"),n=P(t),c(e,"class","tag is-light is-small")},m(o,a){R(o,e,a),r(e,n)},p(o,a){a[0]&64&&t!==(t=o[47].relevance_score.toFixed(1)+"")&&ve(n,t)},d(o){o&&S(e)}}}function Ec(l){let e,t=l[47].content.substring(0,150)+"",n,o=l[47].content.length>150?"...":"",a;return{c(){e=f("p"),n=P(t),a=P(o),c(e,"class","context-preview svelte-rbq0zi"),c(e,"data-testid",`context-content-${l[49]}`)},m(s,u){R(s,e,u),r(e,n),r(e,a)},p(s,u){u[0]&64&&t!==(t=s[47].content.substring(0,150)+"")&&ve(n,t),u[0]&64&&o!==(o=s[47].content.length>150?"...":"")&&ve(a,o)},d(s){s&&S(e)}}}function Lc(l){let e,t=l[47].summary+"",n;return{c(){e=f("p"),n=P(t),c(e,"class","context-summary svelte-rbq0zi"),c(e,"data-testid",`context-summary-${l[49]}`)},m(o,a){R(o,e,a),r(e,n)},p(o,a){a[0]&64&&t!==(t=o[47].summary+"")&&ve(n,t)},d(o){o&&S(e)}}}function Hs(l){let e;return{c(){e=f("hr"),c(e,"class","context-divider svelte-rbq0zi")},m(t,n){R(t,e,n)},d(t){t&&S(e)}}}function Fs(l){let e,t,n,o,a;const s=[Ac,Rc],u=[];function i(p,m){return p[47].context_type==="KGTermDefinition"||p[47].context_type==="KGIndex"?0:1}e=i(l),t=u[e]=s[e](l);let d=l[49]<l[6].length-1&&Hs();return{c(){t.c(),n=h(),d&&d.c(),o=ut()},m(p,m){u[e].m(p,m),R(p,n,m),d&&d.m(p,m),R(p,o,m),a=!0},p(p,m){let _=e;e=i(p),e===_?u[e].p(p,m):(Fe(),B(u[_],1,1,()=>{u[_]=null}),Ke(),t=u[e],t?t.p(p,m):(t=u[e]=s[e](p),t.c()),j(t,1),t.m(n.parentNode,n)),p[49]<p[6].length-1?d||(d=Hs(),d.c(),d.m(o.parentNode,o)):d&&(d.d(1),d=null)},i(p){a||(j(t),a=!0)},o(p){B(t),a=!1},d(p){u[e].d(p),p&&S(n),d&&d.d(p),p&&S(o)}}}function Dc(l){let e,t,n,o,a,s,u,i,d,p,m,_,g,b,v,w,$,C,k,T,F,O,N,E,H,ee,J,L,D,ne,W,oe,le,z,Q,I,U,y,A,M,Z,V,X,Y,re,pe,ie,ae,be,K,x=l[6].length+"",ce,me,ke,Te,Xe,Be,Ne,Pe,fe,Se,Me,xe,et;e=new _l({props:{fallbackPath:"/"}});let ye=l[5]&&Ns(l),ze=l[0],Ge=[];for(let de=0;de<ze.length;de+=1)Ge[de]=Os(Is(l,ze,de));let qe=l[2]&&Ps(),Le=l[4]&&Ms(l),De=l[3]&&js(l);function it(de,Ae){return de[7]?yc:wc}let Oe=it(l),We=Oe(l),G=l[8]&&Us(l);const te=[Sc,Tc],q=[];function ue(de,Ae){return de[6].length===0?0:1}X=ue(l),Y=q[X]=te[X](l);function Ce(de){l[37](de)}let $e={context:l[14],mode:l[15]};l[13]!==void 0&&($e.active=l[13]),Be=new Ja({props:$e}),lt.push(()=>st(Be,"active",Ce)),Be.$on("update",l[38]),Be.$on("delete",l[39]),Be.$on("close",l[40]);function Qe(de){l[41](de)}let nt={conversationId:l[5]};return l[16]!==void 0&&(nt.active=l[16]),fe=new rc({props:nt}),lt.push(()=>st(fe,"active",Qe)),fe.$on("termAdded",l[27]),fe.$on("kgIndexAdded",l[28]),{c(){_e(e.$$.fragment),t=h(),n=f("section"),o=f("div"),a=f("div"),s=f("div"),u=f("h2"),u.textContent="Chat",i=h(),d=f("p"),d.textContent=`Role: ${Rt(At)}`,p=h(),ye&&ye.c(),m=h(),_=f("div");for(let de=0;de<Ge.length;de+=1)Ge[de].c();g=h(),qe&&qe.c(),b=h(),Le&&Le.c(),v=h(),De&&De.c(),w=h(),$=f("div"),C=f("div"),k=f("textarea"),T=h(),F=f("div"),O=f("button"),N=f("span"),N.innerHTML='<i class="fas fa-paper-plane"></i>',H=h(),ee=f("div"),J=f("div"),L=f("div"),D=f("div"),ne=f("div"),W=f("h4"),W.textContent="Context",oe=h(),le=f("div"),z=f("button"),z.innerHTML=`<span class="icon is-small"><i class="fas fa-plus"></i></span> 
                    <span>Add</span>`,Q=h(),I=f("button"),I.innerHTML=`<span class="icon is-small"><i class="fas fa-sitemap"></i></span> 
                    <span>KG Search</span>`,U=h(),y=f("div"),A=f("div"),M=f("button"),We.c(),Z=h(),G&&G.c(),V=h(),Y.c(),re=h(),pe=f("div"),ie=f("div"),ae=f("div"),be=f("div"),K=f("span"),ce=P(x),me=P(" context items"),ke=h(),Te=f("div"),Te.innerHTML='<div class="level-item"><span class="is-size-7 has-text-grey">Context is automatically included in your chat</span></div>',Xe=h(),_e(Be.$$.fragment),Pe=h(),_e(fe.$$.fragment),c(u,"class","title is-4"),c(d,"class","subtitle is-6"),c(_,"class","chat-window svelte-rbq0zi"),c(_,"data-testid","chat-messages"),c(k,"class","textarea"),c(k,"rows","3"),c(k,"placeholder","Type your message and press Enter..."),c(k,"data-testid","chat-input"),c(C,"class","control is-expanded"),c(N,"class","icon"),c(O,"class","button is-primary"),O.disabled=E=l[2]||!l[1].trim(),c(O,"data-testid","send-message-button"),c(F,"class","control"),c($,"class","field has-addons chat-input svelte-rbq0zi"),c(s,"class","column is-8"),c(W,"class","title is-5"),c(z,"class","button is-small is-primary"),c(z,"data-testid","show-add-context-button"),c(I,"class","button is-small is-info"),c(I,"data-testid","kg-search-button"),c(le,"class","buttons has-addons"),c(ne,"class","level-item"),c(D,"class","level-left"),c(M,"class","button is-small is-light"),M.disabled=l[7],c(M,"data-testid","refresh-context-button"),c(A,"class","level-item"),c(y,"class","level-right"),c(L,"class","level is-mobile"),c(K,"class","tag is-light is-small"),c(K,"data-testid","context-summary"),c(be,"class","level-item"),c(ae,"class","level-left"),c(Te,"class","level-right"),c(ie,"class","level is-mobile"),c(pe,"class","mt-4"),c(J,"class","box context-panel svelte-rbq0zi"),c(J,"data-testid","context-panel"),c(ee,"class","column is-4"),c(a,"class","columns svelte-rbq0zi"),c(o,"class","container"),c(n,"class","section"),c(n,"data-testid","chat-interface")},m(de,Ae){ge(e,de,Ae),R(de,t,Ae),R(de,n,Ae),r(n,o),r(o,a),r(a,s),r(s,u),r(s,i),r(s,d),r(s,p),ye&&ye.m(s,null),r(s,m),r(s,_);for(let ot=0;ot<Ge.length;ot+=1)Ge[ot]&&Ge[ot].m(_,null);r(_,g),qe&&qe.m(_,null),r(s,b),Le&&Le.m(s,null),r(s,v),De&&De.m(s,null),r(s,w),r(s,$),r($,C),r(C,k),Ie(k,l[1]),r($,T),r($,F),r(F,O),r(O,N),r(a,H),r(a,ee),r(ee,J),r(J,L),r(L,D),r(D,ne),r(ne,W),r(ne,oe),r(ne,le),r(le,z),r(le,Q),r(le,I),r(L,U),r(L,y),r(y,A),r(A,M),We.m(M,null),r(J,Z),G&&G.m(J,null),r(J,V),q[X].m(J,null),r(J,re),r(J,pe),r(pe,ie),r(ie,ae),r(ae,be),r(be,K),r(K,ce),r(K,me),r(ie,ke),r(ie,Te),R(de,Xe,Ae),ge(Be,de,Ae),R(de,Pe,Ae),ge(fe,de,Ae),Me=!0,xe||(et=[se(k,"input",l[29]),se(k,"keydown",l[25]),se(O,"click",l[24]),se(z,"click",l[18]),se(I,"click",l[26]),se(M,"click",l[17])],xe=!0)},p(de,Ae){if(de[5]?ye?ye.p(de,Ae):(ye=Ns(de),ye.c(),ye.m(s,m)):ye&&(ye.d(1),ye=null),Ae[0]&1){ze=de[0];let at;for(at=0;at<ze.length;at+=1){const qt=Is(de,ze,at);Ge[at]?Ge[at].p(qt,Ae):(Ge[at]=Os(qt),Ge[at].c(),Ge[at].m(_,g))}for(;at<Ge.length;at+=1)Ge[at].d(1);Ge.length=ze.length}de[2]?qe||(qe=Ps(),qe.c(),qe.m(_,null)):qe&&(qe.d(1),qe=null),de[4]?Le?Le.p(de,Ae):(Le=Ms(de),Le.c(),Le.m(s,v)):Le&&(Le.d(1),Le=null),de[3]?De?De.p(de,Ae):(De=js(de),De.c(),De.m(s,w)):De&&(De.d(1),De=null),Ae[0]&2&&Ie(k,de[1]),(!Me||Ae[0]&6&&E!==(E=de[2]||!de[1].trim()))&&(O.disabled=E),Oe!==(Oe=it(de))&&(We.d(1),We=Oe(de),We&&(We.c(),We.m(M,null))),(!Me||Ae[0]&128)&&(M.disabled=de[7]),de[8]?G?G.p(de,Ae):(G=Us(de),G.c(),G.m(J,V)):G&&(G.d(1),G=null);let ot=X;X=ue(de),X===ot?q[X].p(de,Ae):(Fe(),B(q[ot],1,1,()=>{q[ot]=null}),Ke(),Y=q[X],Y?Y.p(de,Ae):(Y=q[X]=te[X](de),Y.c()),j(Y,1),Y.m(J,re)),(!Me||Ae[0]&64)&&x!==(x=de[6].length+"")&&ve(ce,x);const ft={};Ae[0]&16384&&(ft.context=de[14]),Ae[0]&32768&&(ft.mode=de[15]),!Ne&&Ae[0]&8192&&(Ne=!0,ft.active=de[13],rt(()=>Ne=!1)),Be.$set(ft);const Mt={};Ae[0]&32&&(Mt.conversationId=de[5]),!Se&&Ae[0]&65536&&(Se=!0,Mt.active=de[16],rt(()=>Se=!1)),fe.$set(Mt)},i(de){Me||(j(e.$$.fragment,de),j(Y),j(Be.$$.fragment,de),j(fe.$$.fragment,de),Me=!0)},o(de){B(e.$$.fragment,de),B(Y),B(Be.$$.fragment,de),B(fe.$$.fragment,de),Me=!1},d(de){he(e,de),de&&S(t),de&&S(n),ye&&ye.d(),tt(Ge,de),qe&&qe.d(),Le&&Le.d(),De&&De.d(),We.d(),G&&G.d(),q[X].d(),de&&S(Xe),he(Be,de),de&&S(Pe),he(fe,de),xe=!1,Ze(et)}}}function Ic(l,e,t){let n;Ue(l,ct,K=>t(43,n=K));let o=[],a="",s=!1,u=null,i=null,d=null,p=[],m=!1,_=!1,g="",b="",v="document",w=!1,$=!1,C=null,k="edit",T=null,F=!1;function O(K){t(0,o=[...o,{role:"user",content:K}])}async function N(){try{if(n){const K=await je("list_conversations");K!=null&&K.conversations&&K.conversations.length>0?(t(5,d=K.conversations[0].id),console.log("🎯 Using existing conversation:",d),await H()):await E()}else{const K=await fetch(`${Ve.ServerURL}/conversations`);if(K.ok){const x=await K.json();x.conversations&&x.conversations.length>0?(t(5,d=x.conversations[0].id),console.log("🎯 Using existing conversation:",d),await H()):await E()}else await E()}}catch(K){console.error("❌ Error initializing conversation:",K)}}async function E(){try{const K=Rt(At);if(n){const x=await je("create_conversation",{title:"Chat Conversation",role:K});x.status==="success"&&x.conversation_id&&(t(5,d=x.conversation_id),console.log("🆕 Created new conversation:",d))}else{const x=await fetch(`${Ve.ServerURL}/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"Chat Conversation",role:K})});if(x.ok){const ce=await x.json();ce.status==="Success"&&ce.conversation_id&&(t(5,d=ce.conversation_id),console.log("🆕 Created new conversation:",d))}}}catch(K){console.error("❌ Error creating conversation:",K)}}async function H(){if(!d){console.warn("⚠️ Cannot load context: no conversation ID available");return}t(7,m=!0),console.log("🔄 Loading conversation context for:",d);try{if(n){console.log("📱 Loading context via Tauri...");const K=await je("get_conversation",{conversationId:d});if(console.log("📥 Tauri response:",K),K.status==="success"&&K.conversation){const x=K.conversation.global_context||[];t(6,p=x),console.log(`✅ Loaded ${x.length} context items via Tauri`)}else console.error("❌ Failed to get conversation via Tauri:",K.error||"Unknown error"),t(6,p=[])}else{console.log("🌐 Loading context via HTTP...");const K=await fetch(`${Ve.ServerURL}/conversations/${d}`);if(console.log("📥 HTTP response status:",K.status,K.statusText),K.ok){const x=await K.json();if(console.log("📄 HTTP response data:",x),x.status==="success"&&x.conversation){const ce=x.conversation.global_context||[];t(6,p=ce),console.log(`✅ Loaded ${ce.length} context items via HTTP`)}else console.error("❌ Failed to get conversation via HTTP:",x.error||"Unknown error"),t(6,p=[])}else console.error("❌ HTTP request failed:",K.status,K.statusText),t(6,p=[])}}catch(K){console.error("❌ Error loading conversation context:",{error:K.message||K,conversationId:d,isTauri:n,timestamp:new Date().toISOString()}),t(6,p=[])}finally{t(7,m=!1),console.log("🏁 Context loading completed. Items count:",p.length)}}function ee(){t(8,_=!_),_||(t(9,g=""),t(10,b=""),t(11,v="document"))}async function J(){if(!(!d||!g.trim()||!b.trim())){t(12,w=!0);try{const K={title:g.trim(),summary:null,content:b.trim(),context_type:v};if(n){const x=await je("add_context_to_conversation",{conversationId:d,contextData:K});x.status==="success"?(await H(),ee(),console.log("✅ Context added successfully via Tauri")):console.error("❌ Failed to add context via Tauri:",x.error)}else{const x=await fetch(`${Ve.ServerURL}/conversations/${d}/context`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(K)});if(x.ok){const ce=await x.json();ce.status==="success"?(await H(),ee(),console.log("✅ Context added successfully via HTTP")):console.error("❌ Failed to add context via HTTP:",ce.error)}else console.error("❌ HTTP request failed:",x.status,x.statusText)}}catch(K){console.error("❌ Error adding manual context:",K)}finally{t(12,w=!1)}}}function L(K){t(14,C=K),t(15,k="edit"),t(13,$=!0)}function D(K){confirm(`Are you sure you want to delete "${K.title}"?`)&&ne(K.id)}async function ne(K){if(!(!d||T)){T=K,console.log("🗑️ Deleting context:",K);try{if(n){const x=await je("delete_context",{conversationId:d,contextId:K});(x==null?void 0:x.status)==="success"?(console.log("✅ Context deleted successfully via Tauri"),await H()):console.error("❌ Failed to delete context via Tauri:",x==null?void 0:x.error)}else{const x=await fetch(`${Ve.ServerURL}/conversations/${d}/context/${K}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(x.ok){const ce=await x.json();ce.status==="success"?(console.log("✅ Context deleted successfully via HTTP"),await H()):console.error("❌ Failed to delete context via HTTP:",ce.error)}else console.error("❌ HTTP delete request failed:",x.status)}}catch(x){console.error("❌ Error deleting context:",x)}finally{T=null}}}async function W(K){if(d){console.log("📝 Updating context:",K.id);try{const x={context_type:K.context_type,title:K.title,summary:K.summary,content:K.content,metadata:K.metadata};if(n){const ce=await je("update_context",{conversationId:d,contextId:K.id,request:x});(ce==null?void 0:ce.status)==="success"?(console.log("✅ Context updated successfully via Tauri"),await H()):console.error("❌ Failed to update context via Tauri:",ce==null?void 0:ce.error)}else{const ce=await fetch(`${Ve.ServerURL}/conversations/${d}/context/${K.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(x)});if(ce.ok){const me=await ce.json();me.status==="success"?(console.log("✅ Context updated successfully via HTTP"),await H()):console.error("❌ Failed to update context via HTTP:",me.error)}else console.error("❌ HTTP update request failed:",ce.status)}}catch(x){console.error("❌ Error updating context:",x)}}}async function oe(){var ce;if(!a.trim()||s)return;t(3,u=null);const K=Rt(At),x=a.trim();t(1,a=""),d||await N(),O(x),t(2,s=!0);try{const me={role:K,messages:o};d&&(me.conversation_id=d);let ke;if(n)ke=await je("chat",{request:me});else{const Te=await fetch(`${Ve.ServerURL}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(me)});if(!Te.ok)throw new Error(`HTTP ${Te.status}`);ke=await Te.json()}t(4,i=ke.model_used??null),((ce=ke.status)==null?void 0:ce.toLowerCase())==="success"&&ke.message?t(0,o=[...o,{role:"assistant",content:ke.message}]):t(3,u=ke.error||"Chat failed")}catch(me){t(3,u=(me==null?void 0:me.message)||String(me))}finally{t(2,s=!1)}}function le(K){(K.key==="Enter"||K.key==="Return")&&!K.shiftKey&&(K.preventDefault(),oe())}function z(){t(16,F=!0)}function Q(K){console.log("✅ KG term added to context:",K.detail.term),H()}function I(K){console.log("✅ KG index added to context for role:",K.detail.role),H()}tl(()=>{if(t(0,o=[{role:"assistant",content:"Hi! How can I help you? Ask me anything about your search results or documents."}]),N(),typeof window<"u"){const K=()=>{d&&H()};return window.addEventListener("focus",K),()=>{window.removeEventListener("focus",K)}}});function U(){a=this.value,t(1,a)}function y(){v=St(this),t(11,v)}function A(){g=this.value,t(9,g)}function M(){b=this.value,t(10,b)}const Z=K=>ne(K.detail.contextId),V=K=>L(K.detail.contextItem),X=K=>L(K),Y=K=>D(K);function re(K){$=K,t(13,$)}const pe=K=>W(K.detail),ie=K=>ne(K.detail),ae=()=>{t(13,$=!1),t(14,C=null)};function be(K){F=K,t(16,F)}return[o,a,s,u,i,d,p,m,_,g,b,v,w,$,C,k,F,H,ee,J,L,D,ne,W,oe,le,z,Q,I,U,y,A,M,Z,V,X,Y,re,pe,ie,ae,be]}class Nc extends _t{constructor(e){super(),gt(this,e,Ic,Dc,pt,{},null,[-1,-1])}}function Oc(l){let e,t;return e=new ka({}),{c(){_e(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function Pc(l){let e,t;return e=new Nc({}),{c(){_e(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function Mc(l){let e,t;return e=new za({}),{c(){_e(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function jc(l){let e,t;return e=new ri({}),{c(){_e(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function Uc(l){let e,t;return e=new Da({}),{c(){_e(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function zc(l){let e,t;return e=new Oa({}),{c(){_e(e.$$.fragment)},m(n,o){ge(e,n,o),t=!0},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function Hc(l){let e;return{c(){e=f("nav"),e.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
            <a class="navbar-item" href="/config/wizard">Wizard</a> 
            <a class="navbar-item" href="/config/json">JSON Editor</a> 
            <a class="navbar-item" href="/graph">Graph</a> 
            <a class="navbar-item" href="/chat">Chat</a></div>`,c(e,"class","navbar")},m(t,n){R(t,e,n)},p:Re,d(t){t&&S(e)}}}function Fc(l){let e,t,n,o,a,s,u,i,d,p,m,_,g,b,v,w,$,C,k,T,F,O,N,E,H,ee,J,L,D,ne,W,oe,le,z,Q,I,U,y,A,M,Z,V;return k=new Ml({}),O=new Nt({props:{path:"/",$$slots:{default:[Oc]},$$scope:{ctx:l}}}),E=new Nt({props:{path:"/chat",$$slots:{default:[Pc]},$$scope:{ctx:l}}}),ee=new Nt({props:{path:"/graph",$$slots:{default:[Mc]},$$scope:{ctx:l}}}),ne=new Nt({props:{path:"/fetch/*",$$slots:{default:[jc]},$$scope:{ctx:l}}}),oe=new Nt({props:{path:"/config/wizard",$$slots:{default:[Uc]},$$scope:{ctx:l}}}),z=new Nt({props:{path:"/config/json",$$slots:{default:[zc]},$$scope:{ctx:l}}}),y=new Nt({props:{path:"/",$$slots:{default:[Hc]},$$scope:{ctx:l}}}),{c(){e=f("meta"),t=h(),n=f("div"),o=f("main"),a=f("div"),s=f("div"),u=f("div"),i=f("ul"),d=f("li"),p=f("a"),p.innerHTML=`<span class="icon is-small"><i class="fas fa-search"></i></span> 
                <span>Search</span>`,m=h(),_=f("li"),g=f("a"),g.innerHTML=`<span class="icon is-small"><i class="fas fa-comments"></i></span> 
                <span>Chat</span>`,b=h(),v=f("li"),w=f("a"),w.innerHTML=`<span class="icon is-small"><i class="fas fa-project-diagram"></i></span> 
                <span>Graph</span>`,$=h(),C=f("div"),_e(k.$$.fragment),T=h(),F=f("div"),_e(O.$$.fragment),N=h(),_e(E.$$.fragment),H=h(),_e(ee.$$.fragment),J=h(),L=f("br"),D=h(),_e(ne.$$.fragment),W=h(),_e(oe.$$.fragment),le=h(),_e(z.$$.fragment),Q=h(),I=f("footer"),U=f("div"),_e(y.$$.fragment),c(e,"name","color-scheme"),c(e,"content",l[1]),document.title="Terraphim",c(p,"href","/"),c(p,"data-exact",""),c(p,"data-testid","search-tab"),c(d,"class","svelte-1nmgbjk"),c(g,"href","/chat"),c(g,"data-testid","chat-tab"),c(_,"class","svelte-1nmgbjk"),c(w,"href","/graph"),c(w,"data-testid","graph-tab"),c(v,"class","svelte-1nmgbjk"),c(u,"class","tabs is-boxed svelte-1nmgbjk"),c(s,"class","main-navigation svelte-1nmgbjk"),c(C,"class","role-selector svelte-1nmgbjk"),c(a,"class","top-controls svelte-1nmgbjk"),c(F,"class","main-area svelte-1nmgbjk"),c(o,"class","main-content svelte-1nmgbjk"),c(U,"class",A=Pt(l[0])+" svelte-1nmgbjk"),c(I,"class","svelte-1nmgbjk"),c(n,"class","is-full-height svelte-1nmgbjk")},m(X,Y){r(document.head,e),R(X,t,Y),R(X,n,Y),r(n,o),r(o,a),r(a,s),r(s,u),r(u,i),r(i,d),r(d,p),r(i,m),r(i,_),r(_,g),r(i,b),r(i,v),r(v,w),r(a,$),r(a,C),ge(k,C,null),r(o,T),r(o,F),ge(O,F,null),r(F,N),ge(E,F,null),r(F,H),ge(ee,F,null),r(o,J),r(o,L),r(o,D),ge(ne,o,null),r(o,W),ge(oe,o,null),r(o,le),ge(z,o,null),r(n,Q),r(n,I),r(I,U),ge(y,U,null),M=!0,Z||(V=[Hl(Fl.call(null,p)),Hl(Fl.call(null,g)),Hl(Fl.call(null,w)),se(I,"mouseover",l[2]),se(I,"focus",l[2])],Z=!0)},p(X,[Y]){(!M||Y&2)&&c(e,"content",X[1]);const re={};Y&16&&(re.$$scope={dirty:Y,ctx:X}),O.$set(re);const pe={};Y&16&&(pe.$$scope={dirty:Y,ctx:X}),E.$set(pe);const ie={};Y&16&&(ie.$$scope={dirty:Y,ctx:X}),ee.$set(ie);const ae={};Y&16&&(ae.$$scope={dirty:Y,ctx:X}),ne.$set(ae);const be={};Y&16&&(be.$$scope={dirty:Y,ctx:X}),oe.$set(be);const K={};Y&16&&(K.$$scope={dirty:Y,ctx:X}),z.$set(K);const x={};Y&16&&(x.$$scope={dirty:Y,ctx:X}),y.$set(x),(!M||Y&1&&A!==(A=Pt(X[0])+" svelte-1nmgbjk"))&&c(U,"class",A)},i(X){M||(j(k.$$.fragment,X),j(O.$$.fragment,X),j(E.$$.fragment,X),j(ee.$$.fragment,X),j(ne.$$.fragment,X),j(oe.$$.fragment,X),j(z.$$.fragment,X),j(y.$$.fragment,X),M=!0)},o(X){B(k.$$.fragment,X),B(O.$$.fragment,X),B(E.$$.fragment,X),B(ee.$$.fragment,X),B(ne.$$.fragment,X),B(oe.$$.fragment,X),B(z.$$.fragment,X),B(y.$$.fragment,X),M=!1},d(X){S(e),X&&S(t),X&&S(n),he(k),he(O),he(E),he(ee),he(ne),he(oe),he(z),he(y),Z=!1,Ze(V)}}}function Kc(l,e,t){let n;Ue(l,bl,s=>t(1,n=s));let o="is-hidden";function a(){t(0,o="")}return[o,n,a]}class Gc extends _t{constructor(e){super(),gt(this,e,Kc,Fc,pt,{})}}const qc=new $r;Cr(qc);new Gc({target:document.getElementById("app")});
