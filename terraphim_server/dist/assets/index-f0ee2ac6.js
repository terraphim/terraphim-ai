var us=Object.defineProperty;var cs=(l,e,t)=>e in l?us(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var wt=(l,e,t)=>(cs(l,typeof e!="symbol"?e+"":e,t),t);import{aa as Lt,S as mt,i as _t,s as at,q as f,Y as F,b as L,y as s,Z as _e,I as ye,j as R,ak as Re,F as ut,m as qt,a as g,v as a,l as Z,E as Je,au as Ht,r as ae,z as ue,t as B,d as Q,B as ce,av as fs,aw as Jt,H as Qe,U as xe,V as et,ax as El,ay as ds,g as Ke,e as Ge,O as Ye,af as Ze,o as ps,W as ie,az as Ml,aA as Rt,aB as Bn,aC as qn,a1 as Ae,C as it,aD as Ie,aE as Jn,D as nl,G as sl,aF as Vn,w as Nt,x as Ut,A as jl,a2 as ms,aG as dl,ac as _s,a7 as hs,a9 as gs,n as bs}from"./vendor-ui-cd3d2b6a.js";import{R as Pt,S as Ol}from"./vendor-utils-1b347ea1.js";import{J as Qn,_ as vs,E as ks,d as ws,o as co}from"./vendor-editor-992829d3.js";import{P as Yn,T as Pl,u as Zn,y as ys,A as $s,S as Cs,q as Ss}from"./vendor-atomic-1ea13e29.js";import{t as Ts,S as Rs,E as As}from"./novel-editor-c665f5c2.js";import{s as Ul,z as Ls,a as Es,l as Ps,m as Os,c as Ns,b as Us,B as Ds,d as Is}from"./vendor-charts-e6a4a6c9.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const u of n)if(u.type==="childList")for(const r of u.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function t(n){const u={};return n.integrity&&(u.integrity=n.integrity),n.referrerPolicy&&(u.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?u.credentials="include":n.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function o(n){if(n.ep)return;n.ep=!0;const u=t(n);fetch(n.href,u)}})();const rt={ServerURL:location.protocol+"//"+window.location.host||"/"},fl=Lt([]),Ms={id:"Desktop",global_shortcut:"",roles:{},default_role:{original:"",lowercase:""},selected_role:{original:"",lowercase:""}},pl=Lt("spacelab"),At=Lt("selected"),je=Lt(!1),js=Lt(`${rt.ServerURL}/documents/search`),Ct=Lt(Ms),fo=Lt([]);let Al=Lt("");const $t=Lt(!1);let Bt=null;function Hs(l){if(typeof document>"u")return;const e=`/assets/bulmaswatch/${l}/bulmaswatch.min.css`;if(Bt!=null&&Bt.href.endsWith(e))return;const t=document.createElement("link");t.rel="stylesheet",t.href=e,t.id="bulma-theme",t.onload=()=>{Bt&&Bt!==t&&Bt.remove(),Bt=t},document.head.appendChild(t);const o=document.head.querySelector('meta[name="color-scheme"]');o&&o.setAttribute("content",l)}pl.subscribe(Hs);function zs(l){let e,t;return{c(){e=f("option"),t=F(l[1]),e.__value=l[0],e.value=e.__value},m(o,n){L(o,e,n),s(e,t)},p(o,[n]){n&2&&_e(t,o[1]),n&1&&(e.__value=o[0],e.value=e.__value)},i:ye,o:ye,d(o){o&&R(e)}}}function Fs(l,e,t){let o,{subject:n}=e;const u=Yn(n),r=Pl(u,Zn.properties.name);return Re(l,r,c=>t(1,o=c)),Pl(u,"http://localhost:9883/property/theme"),l.$$set=c=>{"subject"in c&&t(0,n=c.subject)},[n,o,r]}class Ws extends mt{constructor(e){super(),_t(this,e,Fs,zs,at,{subject:0})}}function po(l){let e,t,o,n,u,r,c=l[0]&&mo();return{c(){e=f("button"),t=f("span"),t.innerHTML='<i class="fas fa-arrow-left"></i>',o=g(),c&&c.c(),a(t,"class","icon svelte-rnsqpo"),a(e,"class",n="button is-light back-button "+l[1]+" svelte-rnsqpo"),a(e,"title","Go back"),a(e,"aria-label","Go back")},m(i,d){L(i,e,d),s(e,t),s(e,o),c&&c.m(e,null),u||(r=[Z(e,"click",l[3]),Z(e,"keydown",l[6])],u=!0)},p(i,d){i[0]?c||(c=mo(),c.c(),c.m(e,null)):c&&(c.d(1),c=null),d&2&&n!==(n="button is-light back-button "+i[1]+" svelte-rnsqpo")&&a(e,"class",n)},d(i){i&&R(e),c&&c.d(),u=!1,Je(r)}}}function mo(l){let e;return{c(){e=f("span"),e.textContent="Back",a(e,"class","back-text svelte-rnsqpo")},m(t,o){L(t,e,o)},d(t){t&&R(e)}}}function Ks(l){let e,t=l[2]&&po(l);return{c(){t&&t.c(),e=ut()},m(o,n){t&&t.m(o,n),L(o,e,n)},p(o,[n]){o[2]?t?t.p(o,n):(t=po(o),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:ye,o:ye,d(o){t&&t.d(o),o&&R(e)}}}function Gs(l,e,t){let{fallbackPath:o="/"}=e,{showText:n=!0}=e,{customClass:u=""}=e,{hideOnPaths:r=["/"]}=e,c=!0;function i(){var m;try{const _=((m=window.location)==null?void 0:m.pathname)||"/";t(2,c=!r.includes(_))}catch{t(2,c=!0)}}function d(){window.history.length>1?window.history.back():window.location.href=o}qt(()=>(i(),window.addEventListener("popstate",i),window.addEventListener("hashchange",i),()=>{window.removeEventListener("popstate",i),window.removeEventListener("hashchange",i)}));const p=m=>{(m.key==="Enter"||m.key===" ")&&(m.preventDefault(),d())};return l.$$set=m=>{"fallbackPath"in m&&t(4,o=m.fallbackPath),"showText"in m&&t(0,n=m.showText),"customClass"in m&&t(1,u=m.customClass),"hideOnPaths"in m&&t(5,r=m.hideOnPaths)},[n,u,c,d,o,r,p]}class rl extends mt{constructor(e){super(),_t(this,e,Gs,Ks,at,{fallbackPath:4,showText:0,customClass:1,hideOnPaths:5})}}function Bs(){return window.crypto.getRandomValues(new Uint32Array(1))[0]}function Dl(l,e=!1){const t=Bs(),o=`_${t}`;return Object.defineProperty(window,o,{value:n=>(e&&Reflect.deleteProperty(window,o),l==null?void 0:l(n)),writable:!1,configurable:!0}),t}async function He(l,e={}){return new Promise((t,o)=>{const n=Dl(r=>{t(r),Reflect.deleteProperty(window,`_${u}`)},!0),u=Dl(r=>{o(r),Reflect.deleteProperty(window,`_${n}`)},!0);window.__TAURI_IPC__({cmd:l,callback:n,error:u,...e})})}function _o(l,e,t){const o=l.slice();return o[25]=e[t],o}function qs(l){let e,t,o;function n(r){l[13](r)}let u={};return l[5]!==void 0&&(u.value=l[5]),e=new Jt({props:u}),Qe.push(()=>xe(e,"value",n)),{c(){ae(e.$$.fragment)},m(r,c){ue(e,r,c),o=!0},p(r,c){const i={};!t&&c&32&&(t=!0,i.value=r[5],et(()=>t=!1)),e.$set(i)},i(r){o||(B(e.$$.fragment,r),o=!0)},o(r){Q(e.$$.fragment,r),o=!1},d(r){ce(e,r)}}}function Js(l){let e,t,o;function n(r){l[14](r)}let u={type:"password",placeholder:"secret",icon:"fas fa-lock",expanded:!0};return l[6]!==void 0&&(u.value=l[6]),e=new Jt({props:u}),Qe.push(()=>xe(e,"value",n)),{c(){ae(e.$$.fragment)},m(r,c){ue(e,r,c),o=!0},p(r,c){const i={};!t&&c&64&&(t=!0,i.value=r[6],et(()=>t=!1)),e.$set(i)},i(r){o||(B(e.$$.fragment,r),o=!0)},o(r){Q(e.$$.fragment,r),o=!1},d(r){ce(e,r)}}}function Vs(l){let e;return{c(){e=F("Save")},m(t,o){L(t,e,o)},d(t){t&&R(e)}}}function Qs(l){let e,t;return e=new El({props:{type:"is-success",class:"is-right",iconPack:"fa",iconLeft:"check",$$slots:{default:[Vs]},$$scope:{ctx:l}}}),e.$on("click",l[8]),e.$on("submit",l[8]),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},p(o,n){const u={};n&268435456&&(u.$$scope={dirty:n,ctx:o}),e.$set(u)},i(o){t||(B(e.$$.fragment,o),t=!0)},o(o){Q(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function Ys(l){let e,t,o,n,u,r;return e=new Ht({props:{$$slots:{default:[qs]},$$scope:{ctx:l}}}),o=new Ht({props:{grouped:!0,$$slots:{default:[Js]},$$scope:{ctx:l}}}),u=new Ht({props:{grouped:!0,$$slots:{default:[Qs]},$$scope:{ctx:l}}}),{c(){ae(e.$$.fragment),t=g(),ae(o.$$.fragment),n=g(),ae(u.$$.fragment)},m(c,i){ue(e,c,i),L(c,t,i),ue(o,c,i),L(c,n,i),ue(u,c,i),r=!0},p(c,i){const d={};i&268435488&&(d.$$scope={dirty:i,ctx:c}),e.$set(d);const p={};i&268435520&&(p.$$scope={dirty:i,ctx:c}),o.$set(p);const m={};i&268435456&&(m.$$scope={dirty:i,ctx:c}),u.$set(m)},i(c){r||(B(e.$$.fragment,c),B(o.$$.fragment,c),B(u.$$.fragment,c),r=!0)},o(c){Q(e.$$.fragment,c),Q(o.$$.fragment,c),Q(u.$$.fragment,c),r=!1},d(c){ce(e,c),c&&R(t),ce(o,c),c&&R(n),ce(u,c)}}}function Zs(l){let e,t,o;function n(r){l[15](r)}let u={type:"search",placeholder:"Fetch JSON",icon:"search"};return l[3]!==void 0&&(u.value=l[3]),e=new Jt({props:u}),Qe.push(()=>xe(e,"value",n)),{c(){ae(e.$$.fragment)},m(r,c){ue(e,r,c),o=!0},p(r,c){const i={};!t&&c&8&&(t=!0,i.value=r[3],et(()=>t=!1)),e.$set(i)},i(r){o||(B(e.$$.fragment,r),o=!0)},o(r){Q(e.$$.fragment,r),o=!1},d(r){ce(e,r)}}}function Xs(l){let e;return{c(){e=F("WikiPage")},m(t,o){L(t,e,o)},d(t){t&&R(e)}}}function xs(l){let e,t,o,n,u,r;function c(m){l[16](m)}let i={type:"search",placeholder:"Post JSON",icon:"search"};l[4]!==void 0&&(i.value=l[4]),e=new Jt({props:i}),Qe.push(()=>xe(e,"value",c));function d(m){l[17](m)}let p={$$slots:{default:[Xs]},$$scope:{ctx:l}};return l[2]!==void 0&&(p.checked=l[2]),n=new ds({props:p}),Qe.push(()=>xe(n,"checked",d)),{c(){ae(e.$$.fragment),o=g(),ae(n.$$.fragment)},m(m,_){ue(e,m,_),L(m,o,_),ue(n,m,_),r=!0},p(m,_){const y={};!t&&_&16&&(t=!0,y.value=m[4],et(()=>t=!1)),e.$set(y);const h={};_&268435456&&(h.$$scope={dirty:_,ctx:m}),!u&&_&4&&(u=!0,h.checked=m[2],et(()=>u=!1)),n.$set(h)},i(m){r||(B(e.$$.fragment,m),B(n.$$.fragment,m),r=!0)},o(m){Q(e.$$.fragment,m),Q(n.$$.fragment,m),r=!1},d(m){ce(e,m),m&&R(o),ce(n,m)}}}function er(l){let e;return{c(){e=F("Fetch")},m(t,o){L(t,e,o)},d(t){t&&R(e)}}}function tr(l){let e,t;return e=new El({props:{type:"is-primary",$$slots:{default:[er]},$$scope:{ctx:l}}}),e.$on("click",l[9]),e.$on("submit",l[9]),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},p(o,n){const u={};n&268435456&&(u.$$scope={dirty:n,ctx:o}),e.$set(u)},i(o){t||(B(e.$$.fragment,o),t=!0)},o(o){Q(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function lr(l){let e,t,o,n,u,r;return e=new Ht({props:{grouped:!0,$$slots:{default:[Zs]},$$scope:{ctx:l}}}),o=new Ht({props:{grouped:!0,$$slots:{default:[xs]},$$scope:{ctx:l}}}),u=new Ht({props:{grouped:!0,$$slots:{default:[tr]},$$scope:{ctx:l}}}),{c(){ae(e.$$.fragment),t=g(),ae(o.$$.fragment),n=g(),ae(u.$$.fragment)},m(c,i){ue(e,c,i),L(c,t,i),ue(o,c,i),L(c,n,i),ue(u,c,i),r=!0},p(c,i){const d={};i&268435464&&(d.$$scope={dirty:i,ctx:c}),e.$set(d);const p={};i&268435476&&(p.$$scope={dirty:i,ctx:c}),o.$set(p);const m={};i&268435456&&(m.$$scope={dirty:i,ctx:c}),u.$set(m)},i(c){r||(B(e.$$.fragment,c),B(o.$$.fragment,c),B(u.$$.fragment,c),r=!0)},o(c){Q(e.$$.fragment,c),Q(o.$$.fragment,c),Q(u.$$.fragment,c),r=!1},d(c){ce(e,c),c&&R(t),ce(o,c),c&&R(n),ce(u,c)}}}function or(l){let e,t,o,n,u;return n=new Qn({props:{content:l[1],onChange:l[7]}}),{c(){e=f("p"),e.innerHTML=`<i>The best editing experience is to configure Atomic Server, in the
        meantime use editor below. You will need to refresh page via Command R
        or Ctrl-R to see changes</i>`,t=g(),o=f("div"),ae(n.$$.fragment),a(o,"class","editor")},m(r,c){L(r,e,c),L(r,t,c),L(r,o,c),ue(n,o,null),u=!0},p(r,c){const i={};c&2&&(i.content=r[1]),n.$set(i)},i(r){u||(B(n.$$.fragment,r),u=!0)},o(r){Q(n.$$.fragment,r),u=!1},d(r){r&&R(e),r&&R(t),r&&R(o),ce(n)}}}function ho(l){let e,t;return e=new Ws({props:{subject:l[25]}}),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},p(o,n){const u={};n&1&&(u.subject=o[25]),e.$set(u)},i(o){t||(B(e.$$.fragment,o),t=!0)},o(o){Q(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function nr(l){let e,t,o=l[0]??[],n=[];for(let r=0;r<o.length;r+=1)n[r]=ho(_o(l,o,r));const u=r=>Q(n[r],1,1,()=>{n[r]=null});return{c(){for(let r=0;r<n.length;r+=1)n[r].c();e=ut()},m(r,c){for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(r,c);L(r,e,c),t=!0},p(r,c){if(c&1){o=r[0]??[];let i;for(i=0;i<o.length;i+=1){const d=_o(r,o,i);n[i]?(n[i].p(d,c),B(n[i],1)):(n[i]=ho(d),n[i].c(),B(n[i],1),n[i].m(e.parentNode,e))}for(Ke(),i=o.length;i<n.length;i+=1)u(i);Ge()}},i(r){if(!t){for(let c=0;c<o.length;c+=1)B(n[c]);t=!0}},o(r){n=n.filter(Boolean);for(let c=0;c<n.length;c+=1)Q(n[c]);t=!1},d(r){Ye(n,r),r&&R(e)}}}function sr(l){let e,t;return e=new fs({props:{$$slots:{default:[nr]},$$scope:{ctx:l}}}),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},p(o,n){const u={};n&268435457&&(u.$$scope={dirty:n,ctx:o}),e.$set(u)},i(o){t||(B(e.$$.fragment,o),t=!0)},o(o){Q(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function rr(l){let e,t,o,n,u,r,c,i,d,p,m,_,y,h,b;return e=new rl({props:{fallbackPath:"/"}}),n=new Pt({props:{path:"/atomic",$$slots:{default:[Ys]},$$scope:{ctx:l}}}),r=new Pt({props:{path:"/json",$$slots:{default:[lr]},$$scope:{ctx:l}}}),i=new Pt({props:{path:"/editor",$$slots:{default:[or]},$$scope:{ctx:l}}}),_=new Ht({props:{grouped:!0,position:"is-right",$$slots:{default:[sr]},$$scope:{ctx:l}}}),{c(){ae(e.$$.fragment),t=g(),o=f("div"),ae(n.$$.fragment),u=g(),ae(r.$$.fragment),c=g(),ae(i.$$.fragment),d=g(),p=f("hr"),m=g(),ae(_.$$.fragment),y=g(),h=f("nav"),h.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
    <a class="navbar-item" href="/fetch/json">Fetch JSON Data</a> 
    <a class="navbar-item" href="/fetch/atomic">Set Atomic Server</a> 
    <a class="navbar-item" href="/fetch/editor">Edit JSON config</a></div>`,a(o,"class","box"),a(h,"class","navbar")},m(k,C){ue(e,k,C),L(k,t,C),L(k,o,C),ue(n,o,null),s(o,u),ue(r,o,null),s(o,c),ue(i,o,null),L(k,d,C),L(k,p,C),L(k,m,C),ue(_,k,C),L(k,y,C),L(k,h,C),b=!0},p(k,[C]){const v={};C&268435552&&(v.$$scope={dirty:C,ctx:k}),n.$set(v);const w={};C&268435484&&(w.$$scope={dirty:C,ctx:k}),r.$set(w);const S={};C&268435458&&(S.$$scope={dirty:C,ctx:k}),i.$set(S);const V={};C&268435457&&(V.$$scope={dirty:C,ctx:k}),_.$set(V)},i(k){b||(B(e.$$.fragment,k),B(n.$$.fragment,k),B(r.$$.fragment,k),B(i.$$.fragment,k),B(_.$$.fragment,k),b=!0)},o(k){Q(e.$$.fragment,k),Q(n.$$.fragment,k),Q(r.$$.fragment,k),Q(i.$$.fragment,k),Q(_.$$.fragment,k),b=!1},d(k){ce(e,k),k&&R(t),k&&R(o),ce(n),ce(r),ce(i),k&&R(d),k&&R(p),k&&R(m),ce(_,k),k&&R(y),k&&R(h)}}}function ir(l,e,t){let o,n,u,r,c;Re(l,ys,T=>t(19,u=T)),Re(l,je,T=>t(20,r=T)),Re(l,Ct,T=>t(21,c=T));let i={json:c};function d(T){if(console.log("contents changed:",T),console.log("is tauri",r),Ct.update(A=>(A=T.json,A)),je)console.log("Updating config on server"),He("update_config",{configNew:T.json}).then(A=>{console.log(`Message: ${A}`)}).catch(A=>console.error(A));else{let A=`${rt.ServerURL}/config/`;fetch(A,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(T.json)})}t(1,i=T)}let p=!1,m="https://raw.githubusercontent.com/terraphim/terraphim-cloud-fastapi/main/data/ref_arch.json",_="http://localhost:8000/documents/",y="http://localhost:9883/",h;const b=async()=>{console.log("Updating atomic server configuration");const T=$s.fromSecret(h);u.setServerUrl(y),console.log("Server set.Setting agent"),u.setAgent(T)},k=async()=>{w()},C=({data:{msg:T,data:A}})=>{console.log(T,A)};let v;const w=async()=>{const T=await vs(()=>import("./fetcher.worker-7e58969a.js"),[]);v=new T.default,v.onmessage=C;const A={msg:"fetcher",data:{url:m,postUrl:_,isWiki:p}};v.postMessage(A)},S=Yn("http://localhost:9883/config/y3zx5wtm0bq"),V=Pl(S,Zn.properties.name);Re(l,V,T=>t(12,n=T));const I=Pl(S,"http://localhost:9883/property/role");Re(l,I,T=>t(0,o=T));function H(T){y=T,t(5,y)}function P(T){h=T,t(6,h)}function J(T){m=T,t(3,m)}function K(T){_=T,t(4,_)}function W(T){p=T,t(2,p)}return l.$$.update=()=>{l.$$.dirty&4096&&console.log("Print name",n),l.$$.dirty&1&&console.log("Print roles",o)},[o,i,p,m,_,y,h,d,b,k,V,I,n,H,P,J,K,W]}class ar extends mt{constructor(e){super(),_t(this,e,ir,rr,at,{})}}class ur{constructor(){wt(this,"baseUrl");wt(this,"autocompleteIndexBuilt",!1);wt(this,"sessionId");wt(this,"currentRole","Default");wt(this,"connectionRetries",0);wt(this,"maxRetries",3);wt(this,"retryDelay",1e3);wt(this,"isConnecting",!1);this.baseUrl=typeof window<"u"?(window.location.protocol==="https:"?"https://":"http://")+window.location.hostname+":8001":"http://localhost:8001",this.sessionId=`novel-${Date.now()}`,this.detectServerPort()}setRole(e){this.currentRole=e,this.autocompleteIndexBuilt=!1}async detectServerPort(){if(Ze(je))return;const e=[8001,3e3,8e3,8080];for(const t of e)try{const o=typeof window<"u"?(window.location.protocol==="https:"?"https://":"http://")+window.location.hostname+":"+t:"http://localhost:"+t,n=await fetch(`${o}/message?sessionId=health-check`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:0,method:"ping",params:{}}),signal:AbortSignal.timeout(2e3)});if(n.ok||n.status===404){this.baseUrl=o,console.log(`NovelAutocompleteService: Detected server at ${o}`);return}}catch{continue}console.warn("NovelAutocompleteService: Could not detect running server, using default:",this.baseUrl)}async buildAutocompleteIndex(){if(this.isConnecting)return await new Promise(e=>setTimeout(e,1e3)),this.autocompleteIndexBuilt;this.isConnecting=!0;try{if(Ze(je)){console.log("Using Tauri autocomplete - testing connection");const e=await He("get_autocomplete_suggestions",{query:"test",roleName:this.currentRole,limit:1});return e&&e.status==="success"?(this.autocompleteIndexBuilt=!0,this.connectionRetries=0,console.log("Tauri autocomplete connection verified"),!0):(console.warn("Tauri autocomplete test failed:",e),!1)}else return await this.buildMCPIndex()}catch(e){return console.error("Error building Novel autocomplete index:",e),!1}finally{this.isConnecting=!1}}async buildMCPIndex(){for(let e=0;e<=this.maxRetries;e++)try{const t=await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:Date.now(),method:"tools/call",params:{name:"build_autocomplete_index",arguments:{}}}),signal:AbortSignal.timeout(1e4)});if(t.ok){const o=await t.json();if(console.log(`MCP build index response (attempt ${e+1}):`,o),o.result&&!o.result.is_error)return this.autocompleteIndexBuilt=!0,this.connectionRetries=0,console.log("MCP autocomplete index built successfully"),!0}else if(t.status>=500&&e<this.maxRetries){console.warn(`MCP server error ${t.status}, retrying in ${this.retryDelay}ms...`),await new Promise(o=>setTimeout(o,this.retryDelay*(e+1)));continue}console.warn(`MCP build index failed (attempt ${e+1}):`,t.status,t.statusText)}catch(t){t instanceof Error&&t.name==="AbortError"?console.warn(`MCP request timeout (attempt ${e+1})`):console.warn(`MCP connection error (attempt ${e+1}):`,t),e<this.maxRetries&&await new Promise(o=>setTimeout(o,this.retryDelay*(e+1)))}return console.error("Failed to build MCP autocomplete index after all retries"),!1}async getCompletion(e){if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return{text:""};try{const t=this.extractLastWord(e.prompt);if(!t||t.length<1)return{text:""};const o=await this.getSuggestionsWithSnippets(t,5);if(o.length===0)return{text:""};let u=o[0].text;u.toLowerCase().startsWith(t.toLowerCase())&&(u=u.substring(t.length));const r=e.prompt.length/4,c=u.length/4;return{text:u,usage:{promptTokens:Math.round(r),completionTokens:Math.round(c),totalTokens:Math.round(r+c)}}}catch(t){return console.error("Error getting Novel autocomplete completion:",t),{text:""}}}async getSuggestions(e,t=10){if(!e||e.trim().length===0)return[];if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return console.warn("Autocomplete index not built, returning empty suggestions"),[];try{return Ze(je)?await this.getTauriSuggestions(e,t):await this.getMCPSuggestions(e,t,"autocomplete_terms")}catch(o){return console.error("Error getting autocomplete suggestions:",o),[]}}async getTauriSuggestions(e,t){const o=await He("get_autocomplete_suggestions",{query:e.trim(),roleName:this.currentRole,limit:t});return console.log("Tauri autocomplete response:",o),o&&o.status==="success"&&o.suggestions?o.suggestions.map(n=>({text:n.term||n.text||"",snippet:n.url||n.snippet||"",score:n.score||1})).filter(n=>n.text.length>0):(o&&o.error&&console.error("Tauri autocomplete error:",o.error),[])}async getMCPSuggestions(e,t,o){const n=Date.now(),u=await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:n,method:"tools/call",params:{name:o,arguments:{query:e.trim(),limit:t,role:this.currentRole}}}),signal:AbortSignal.timeout(5e3)});if(!u.ok)return console.error(`MCP ${o} request failed:`,u.status,u.statusText),[];const r=await u.json();return console.log(`MCP ${o} response:`,r),r.result&&!r.result.is_error&&r.result.content?o==="autocomplete_with_snippets"?this.parseAutocompleteWithSnippetsContent(r.result.content):this.parseAutocompleteContent(r.result.content):(r.error&&console.error(`MCP ${o} error:`,r.error),[])}async getSuggestionsWithSnippets(e,t=10){if(!e||e.trim().length===0)return[];if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return console.warn("Autocomplete index not built, returning empty suggestions with snippets"),[];try{return Ze(je)?await this.getTauriSuggestions(e,t):await this.getMCPSuggestions(e,t,"autocomplete_with_snippets")}catch(o){return console.error("Error getting autocomplete suggestions with snippets:",o),[]}}extractLastWord(e){const t=e.trim().split(/\s+/);return t[t.length-1]||""}parseAutocompleteContent(e){const t=[];for(const o of e)if(o.type==="text"&&o.text){if(!o.text.startsWith("Found")&&!o.text.startsWith("•"))t.push({text:o.text.trim()});else if(o.text.startsWith("•")){const n=o.text.replace("•","").trim();n&&t.push({text:n})}}return t}parseAutocompleteWithSnippetsContent(e){const t=[];for(const o of e)if(o.type==="text"&&o.text){if(!o.text.startsWith("Found")&&!o.text.startsWith("•")){const n=o.text.split(" — ");n.length===2?t.push({text:n[0].trim(),snippet:n[1].trim()}):t.push({text:o.text.trim()})}else if(o.text.startsWith("•")){const n=o.text.replace("•","").trim();n&&t.push({text:n})}}return t}isReady(){return this.autocompleteIndexBuilt}getStatus(){return{ready:this.autocompleteIndexBuilt,baseUrl:this.baseUrl,sessionId:this.sessionId,usingTauri:Ze(je),currentRole:this.currentRole,connectionRetries:this.connectionRetries,isConnecting:this.isConnecting}}async refreshIndex(){return this.autocompleteIndexBuilt=!1,this.connectionRetries=0,await this.buildAutocompleteIndex()}async testConnection(){try{if(Ze(je)){const e=await He("get_config");return e&&e.status==="success"}else return(await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:Date.now(),method:"tools/list",params:{}}),signal:AbortSignal.timeout(3e3)})).ok}catch(e){return console.warn("Connection test failed:",e),!1}}}const Ot=new ur,go=ks.create({name:"terraphimSuggestion",addOptions(){return{trigger:"/",pluginKey:new ws("terraphimSuggestion"),allowSpaces:!1,limit:8,minLength:1,debounce:300}},addCommands(){return{insertSuggestion:l=>({commands:e,chain:t})=>t().insertContent(l.text).run()}},addProseMirrorPlugins(){const l={editor:this.editor,char:this.options.trigger,pluginKey:this.options.pluginKey,allowSpaces:this.options.allowSpaces,startOfLine:!1,command:({editor:e,range:t,props:o})=>{const n=o;e.chain().focus().insertContentAt(t,n.text+" ").run()},items:async({query:e,editor:t})=>new Promise(o=>{setTimeout(async()=>{if(e.length<this.options.minLength){o([]);return}try{const n=await Ot.getSuggestionsWithSnippets(e,this.options.limit);console.log(`TerraphimSuggestion: Found ${n.length} suggestions for "${e}"`),o(n)}catch(n){console.error("TerraphimSuggestion: Error getting suggestions:",n),o([])}},this.options.debounce)}),render:()=>{let e,t;return{onStart:o=>{e=new cr({items:o.items,command:o.command}),o.clientRect&&(t=Ts("body",{getReferenceClientRect:o.clientRect,appendTo:()=>document.body,content:e.element,showOnCreate:!0,interactive:!0,trigger:"manual",placement:"bottom-start",theme:"terraphim-suggestion",maxWidth:"none"})[0])},onUpdate(o){e==null||e.updateItems(o.items),o.clientRect&&(t==null||t.setProps({getReferenceClientRect:o.clientRect}))},onKeyDown(o){return o.event.key==="Escape"?(t==null||t.hide(),!0):(e==null?void 0:e.onKeyDown(o))??!1},onExit(){t==null||t.destroy(),e==null||e.destroy()}}}};return[Rs(l)]}});class cr{constructor(e){wt(this,"element");wt(this,"items",[]);wt(this,"selectedIndex",0);wt(this,"command");this.items=e.items,this.command=e.command,this.element=document.createElement("div"),this.element.className="terraphim-suggestion-dropdown",this.render()}updateItems(e){this.items=e,this.selectedIndex=0,this.render()}onKeyDown({event:e}){return e.key==="ArrowUp"?(this.selectPrevious(),!0):e.key==="ArrowDown"?(this.selectNext(),!0):e.key==="Enter"||e.key==="Tab"?(this.selectItem(this.selectedIndex),!0):!1}selectPrevious(){this.selectedIndex=Math.max(0,this.selectedIndex-1),this.render()}selectNext(){this.selectedIndex=Math.min(this.items.length-1,this.selectedIndex+1),this.render()}selectItem(e){const t=this.items[e];t&&this.command(t)}render(){if(this.element.innerHTML="",this.items.length===0){this.element.innerHTML=`
        <div class="terraphim-suggestion-item terraphim-suggestion-empty">
          <div class="terraphim-suggestion-text">No suggestions found</div>
          <div class="terraphim-suggestion-hint">Try a different search term</div>
        </div>
      `;return}const e=document.createElement("div");e.className="terraphim-suggestion-header",e.innerHTML=`
      <div class="terraphim-suggestion-count">${this.items.length} suggestions</div>
      <div class="terraphim-suggestion-hint">↑↓ Navigate • Tab/Enter Select • Esc Cancel</div>
    `,this.element.appendChild(e),this.items.forEach((t,o)=>{const n=document.createElement("div");n.className=`terraphim-suggestion-item ${o===this.selectedIndex?"terraphim-suggestion-selected":""}`,n.innerHTML=`
        <div class="terraphim-suggestion-main">
          <div class="terraphim-suggestion-text">${this.escapeHtml(t.text)}</div>
          ${t.snippet?`<div class="terraphim-suggestion-snippet">${this.escapeHtml(t.snippet)}</div>`:""}
        </div>
        ${t.score?`<div class="terraphim-suggestion-score">${Math.round(t.score*100)}%</div>`:""}
      `,n.addEventListener("click",()=>this.selectItem(o)),n.addEventListener("mouseenter",()=>{this.selectedIndex=o,this.render()}),this.element.appendChild(n)})}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}destroy(){this.element.remove()}}const fr=`
.terraphim-suggestion-dropdown {
  background: white;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  box-shadow: 0 10px 38px -10px rgba(22, 23, 24, 0.35), 0 10px 20px -15px rgba(22, 23, 24, 0.2);
  max-height: 300px;
  min-width: 300px;
  overflow-y: auto;
  z-index: 1000;
}

.terraphim-suggestion-header {
  padding: 8px 12px;
  border-bottom: 1px solid #f1f5f9;
  background: #f8fafc;
  font-size: 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.terraphim-suggestion-count {
  font-weight: 600;
  color: #475569;
}

.terraphim-suggestion-hint {
  color: #64748b;
}

.terraphim-suggestion-item {
  padding: 8px 12px;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  border-bottom: 1px solid #f1f5f9;
}

.terraphim-suggestion-item:hover {
  background: #f8fafc;
}

.terraphim-suggestion-selected {
  background: #eff6ff !important;
  border-left: 3px solid #3b82f6;
}

.terraphim-suggestion-empty {
  color: #64748b;
  font-style: italic;
  text-align: center;
  cursor: default;
}

.terraphim-suggestion-main {
  flex: 1;
}

.terraphim-suggestion-text {
  font-weight: 500;
  color: #1e293b;
  margin-bottom: 2px;
}

.terraphim-suggestion-snippet {
  font-size: 12px;
  color: #64748b;
  line-height: 1.3;
}

.terraphim-suggestion-score {
  font-size: 11px;
  color: #10b981;
  font-weight: 600;
  background: #ecfdf5;
  padding: 2px 6px;
  border-radius: 4px;
  margin-left: 8px;
}

/* Dark theme support */
@media (prefers-color-scheme: dark) {
  .terraphim-suggestion-dropdown {
    background: #1e293b;
    border-color: #334155;
  }

  .terraphim-suggestion-header {
    background: #0f172a;
    border-color: #334155;
  }

  .terraphim-suggestion-item:hover {
    background: #334155;
  }

  .terraphim-suggestion-selected {
    background: #1e40af !important;
  }

  .terraphim-suggestion-text {
    color: #f1f5f9;
  }

  .terraphim-suggestion-snippet {
    color: #94a3b8;
  }
}

/* Tippy.js theme */
.tippy-box[data-theme~='terraphim-suggestion'] {
  background: transparent;
  box-shadow: none;
}

.tippy-box[data-theme~='terraphim-suggestion'] > .tippy-backdrop {
  background: transparent;
}

.tippy-box[data-theme~='terraphim-suggestion'] > .tippy-arrow {
  display: none;
}
`;function bo(l){let e,t,o,n,u,r,c,i,d,p,m,_,y,h,b,k,C,v,w,S,V,I,H,P,J,K,W=l[12]?"Tauri (native)":`MCP Server (${Ot.getStatus().baseUrl})`,T,A,U,$,z,ee,q,Y,O,E,N,D,G,X,oe,pe,me,Le,ge,fe,ne=l[6]!==1?"s":"",Se,Te,se,be,re,ke,Be,Ce,Oe,le,we,De,Xe,ze,Ne,ht,Fe,St,tt=l[3]?"Enabled":"Disabled",gt,Ve,lt,ct,Ee=l[11]&&!l[8]&&vo(l);function Tt(j,te){if(j[8])return _r;if(j[11])return mr}let M=Tt(l),x=M&&M(l);return{c(){e=f("div"),t=f("div"),o=f("strong"),o.textContent="Local Autocomplete Status:",n=g(),u=f("div"),r=f("button"),c=F("Test"),d=g(),p=f("button"),p.textContent="Rebuild Index",m=g(),_=f("button"),y=F("Demo"),b=g(),k=f("div"),C=F(l[10]),v=g(),Ee&&Ee.c(),w=g(),S=f("div"),V=f("strong"),V.textContent="Configuration:",I=g(),H=f("br"),P=F("• "),J=f("strong"),J.textContent="Backend:",K=g(),T=F(W),A=g(),U=f("br"),$=F("• "),z=f("strong"),z.textContent="Role:",ee=g(),q=F(l[9]),Y=g(),O=f("br"),E=F("• "),N=f("strong"),N.textContent="Trigger:",D=F(' "'),G=F(l[4]),X=F(`" + text
      `),oe=f("br"),pe=F("• "),me=f("strong"),me.textContent="Min Length:",Le=g(),ge=F(l[6]),fe=F(" character"),Se=F(ne),Te=g(),se=f("br"),be=F("• "),re=f("strong"),re.textContent="Max Results:",ke=g(),Be=F(l[5]),Ce=g(),Oe=f("br"),le=F("• "),we=f("strong"),we.textContent="Debounce:",De=g(),Xe=F(l[7]),ze=F(`ms
      `),Ne=f("br"),ht=F("• "),Fe=f("strong"),Fe.textContent="Snippets:",St=g(),gt=F(tt),Ve=g(),x&&x.c(),ie(o,"color","#495057"),ie(r,"padding","4px 8px"),ie(r,"background","#007bff"),ie(r,"color","white"),ie(r,"border","none"),ie(r,"border-radius","4px"),ie(r,"cursor","pointer"),ie(r,"font-size","12px"),r.disabled=i=!l[8],ie(p,"padding","4px 8px"),ie(p,"background","#28a745"),ie(p,"color","white"),ie(p,"border","none"),ie(p,"border-radius","4px"),ie(p,"cursor","pointer"),ie(p,"font-size","12px"),ie(_,"padding","4px 8px"),ie(_,"background","#ffc107"),ie(_,"color","#212529"),ie(_,"border","none"),ie(_,"border-radius","4px"),ie(_,"cursor","pointer"),ie(_,"font-size","12px"),_.disabled=h=!l[8],ie(u,"display","flex"),ie(u,"gap","8px"),ie(t,"display","flex"),ie(t,"justify-content","space-between"),ie(t,"align-items","center"),ie(t,"margin-bottom","8px"),ie(k,"font-size","13px"),ie(k,"color","#6c757d"),ie(k,"margin-bottom","8px"),ie(k,"font-family","monospace"),ie(S,"font-size","12px"),ie(S,"color","#6c757d"),ie(e,"margin-top","10px"),ie(e,"padding","12px"),ie(e,"background","#f8f9fa"),ie(e,"border-radius","6px"),ie(e,"border","1px solid #e9ecef")},m(j,te){L(j,e,te),s(e,t),s(t,o),s(t,n),s(t,u),s(u,r),s(r,c),s(u,d),s(u,p),s(u,m),s(u,_),s(_,y),s(e,b),s(e,k),s(k,C),s(e,v),Ee&&Ee.m(e,null),s(e,w),s(e,S),s(S,V),s(S,I),s(S,H),s(S,P),s(S,J),s(S,K),s(S,T),s(S,A),s(S,U),s(S,$),s(S,z),s(S,ee),s(S,q),s(S,Y),s(S,O),s(S,E),s(S,N),s(S,D),s(S,G),s(S,X),s(S,oe),s(S,pe),s(S,me),s(S,Le),s(S,ge),s(S,fe),s(S,Se),s(S,Te),s(S,se),s(S,be),s(S,re),s(S,ke),s(S,Be),s(S,Ce),s(S,Oe),s(S,le),s(S,we),s(S,De),s(S,Xe),s(S,ze),s(S,Ne),s(S,ht),s(S,Fe),s(S,St),s(S,gt),s(e,Ve),x&&x.m(e,null),lt||(ct=[Z(r,"click",l[14]),Z(p,"click",l[15]),Z(_,"click",l[16])],lt=!0)},p(j,te){te&256&&i!==(i=!j[8])&&(r.disabled=i),te&256&&h!==(h=!j[8])&&(_.disabled=h),te&1024&&_e(C,j[10]),j[11]&&!j[8]?Ee?Ee.p(j,te):(Ee=vo(j),Ee.c(),Ee.m(e,w)):Ee&&(Ee.d(1),Ee=null),te&4096&&W!==(W=j[12]?"Tauri (native)":`MCP Server (${Ot.getStatus().baseUrl})`)&&_e(T,W),te&512&&_e(q,j[9]),te&16&&_e(G,j[4]),te&64&&_e(ge,j[6]),te&64&&ne!==(ne=j[6]!==1?"s":"")&&_e(Se,ne),te&32&&_e(Be,j[5]),te&128&&_e(Xe,j[7]),te&8&&tt!==(tt=j[3]?"Enabled":"Disabled")&&_e(gt,tt),M===(M=Tt(j))&&x?x.p(j,te):(x&&x.d(1),x=M&&M(j),x&&(x.c(),x.m(e,null)))},d(j){j&&R(e),Ee&&Ee.d(),x&&x.d(),lt=!1,Je(ct)}}}function vo(l){let e,t,o,n;function u(i,d){return i[12]?pr:dr}let r=u(l),c=r(l);return{c(){e=f("div"),t=f("strong"),t.textContent="⚠️ Autocomplete Not Available",o=f("br"),n=g(),c.c(),ie(e,"font-size","12px"),ie(e,"color","#dc3545"),ie(e,"margin-bottom","8px"),ie(e,"padding","6px"),ie(e,"background","#f8d7da"),ie(e,"border-radius","4px")},m(i,d){L(i,e,d),s(e,t),s(e,o),s(e,n),c.m(e,null)},p(i,d){r===(r=u(i))&&c?c.p(i,d):(c.d(1),c=r(i),c&&(c.c(),c.m(e,null)))},d(i){i&&R(e),c.d()}}}function dr(l){let e,t=Ot.getStatus().baseUrl+"",o;return{c(){e=F("MCP server not responding. Ensure the server is running on "),o=F(t)},m(n,u){L(n,e,u),L(n,o,u)},p:ye,d(n){n&&R(e),n&&R(o)}}}function pr(l){let e;return{c(){e=F("Tauri backend connection failed. Ensure the application has proper permissions.")},m(t,o){L(t,e,o)},p:ye,d(t){t&&R(e)}}}function mr(l){let e;return{c(){e=f("div"),e.innerHTML=`<strong>❌ Autocomplete Unavailable</strong> 
        <div style="font-size: 11px; margin-top: 4px; color: #721c24;">Click &quot;Rebuild Index&quot; to retry or check server/backend status.</div>`,ie(e,"margin-top","8px"),ie(e,"padding","8px"),ie(e,"background","#f8d7da"),ie(e,"border","1px solid #f5c6cb"),ie(e,"border-radius","4px")},m(t,o){L(t,e,o)},p:ye,d(t){t&&R(e)}}}function _r(l){let e,t,o,n,u,r,c,i,d,p,m,_,y,h,b,k,C;return{c(){e=f("div"),t=f("strong"),t.textContent="🎯 Autocomplete Active",o=g(),n=f("div"),u=F("Type "),r=f("code"),c=F(l[4]),i=F(" in the editor above to trigger suggestions."),d=f("br"),p=F(`
          Example: `),m=f("code"),_=F(l[4]),y=F("terraphim"),h=F(" or "),b=f("code"),k=F(l[4]),C=F("graph"),ie(n,"font-size","11px"),ie(n,"margin-top","4px"),ie(n,"color","#0056b3"),ie(e,"margin-top","8px"),ie(e,"padding","8px"),ie(e,"background","#d1edff"),ie(e,"border","1px solid #b3d9ff"),ie(e,"border-radius","4px")},m(v,w){L(v,e,w),s(e,t),s(e,o),s(e,n),s(n,u),s(n,r),s(r,c),s(n,i),s(n,d),s(n,p),s(n,m),s(m,_),s(m,y),s(n,h),s(n,b),s(b,k),s(b,C)},p(v,w){w&16&&_e(c,v[4]),w&16&&_e(_,v[4]),w&16&&_e(k,v[4])},d(v){v&&R(e)}}}function hr(l){let e,t,o,n;e=new As({props:{defaultValue:l[0],isEditable:!l[1],disableLocalStorage:!0,onUpdate:l[13],extensions:[co,...l[2]?[go.configure({trigger:l[4],allowSpaces:!1,limit:l[5],minLength:l[6],debounce:l[7]})]:[]]}});let u=l[2]&&bo(l);return{c(){ae(e.$$.fragment),t=g(),u&&u.c(),o=ut()},m(r,c){ue(e,r,c),L(r,t,c),u&&u.m(r,c),L(r,o,c),n=!0},p(r,[c]){const i={};c&1&&(i.defaultValue=r[0]),c&2&&(i.isEditable=!r[1]),c&244&&(i.extensions=[co,...r[2]?[go.configure({trigger:r[4],allowSpaces:!1,limit:r[5],minLength:r[6],debounce:r[7]})]:[]]),e.$set(i),r[2]?u?u.p(r,c):(u=bo(r),u.c(),u.m(o.parentNode,o)):u&&(u.d(1),u=null)},i(r){n||(B(e.$$.fragment,r),n=!0)},o(r){Q(e.$$.fragment,r),n=!1},d(r){ce(e,r),r&&R(t),u&&u.d(r),r&&R(o)}}}function gr(l,e,t){let o,n;Re(l,At,P=>t(9,o=P)),Re(l,je,P=>t(12,n=P));let{html:u=""}=e,{readOnly:r=!1}=e,{outputFormat:c="html"}=e,{enableAutocomplete:i=!0}=e,{showSnippets:d=!0}=e,{suggestionTrigger:p="/"}=e,{maxSuggestions:m=8}=e,{minQueryLength:_=1}=e,{debounceDelay:y=300}=e,h=null,b="⏳ Initializing...",k=!1,C=!1,v=null;qt(async()=>{i&&await w(),typeof document<"u"&&(v=document.createElement("style"),v.textContent=fr,document.head.appendChild(v))}),ps(()=>{v&&v.parentNode&&v.parentNode.removeChild(v)});async function w(){t(10,b="⏳ Initializing autocomplete..."),t(8,k=!1),t(11,C=!1);try{Ot.setRole(o),t(10,b="🔗 Testing connection...");const P=await Ot.testConnection();t(11,C=!0),P?(t(10,b="🔨 Building autocomplete index..."),await Ot.buildAutocompleteIndex()?(n?t(10,b="✅ Ready - Using Tauri backend"):t(10,b="✅ Ready - Using MCP server backend"),t(8,k=!0)):t(10,b="❌ Failed to build autocomplete index")):n?t(10,b="❌ Tauri backend not available"):t(10,b="❌ MCP server not responding")}catch(P){console.error("Error initializing autocomplete:",P),t(10,b="❌ Autocomplete initialization error")}}const S=P=>{h=P,c==="markdown"?t(0,u=P.storage.markdown.getMarkdown()):t(0,u=P.getHTML())},V=async()=>{if(!C){alert("Please wait for connection test to complete");return}if(!k){alert("Autocomplete service not ready. Check the status above.");return}try{t(10,b="🧪 Testing autocomplete...");const P="terraphim",J=await Ot.getSuggestions(P,5);if(console.log("Autocomplete test results:",J),J.length>0){const K=J.map((W,T)=>`${T+1}. ${W.text}${W.snippet?` (${W.snippet})`:""}`).join(`
`);alert(`✅ Found ${J.length} suggestions for '${P}':

${K}`),n?t(10,b="✅ Ready - Using Tauri backend"):t(10,b="✅ Ready - Using MCP server backend")}else alert(`⚠️ No suggestions found for '${P}'. This might be normal if the term isn't in your knowledge graph.`)}catch(P){console.error("Autocomplete test failed:",P),alert(`❌ Autocomplete test failed: ${P.message}`),t(10,b="❌ Test failed - check console for details")}},I=async()=>{t(10,b="⏳ Rebuilding index..."),t(8,k=!1);try{await Ot.refreshIndex()?(n?t(10,b="✅ Ready - Tauri index rebuilt successfully"):t(10,b="✅ Ready - MCP server index rebuilt successfully"),t(8,k=!0)):t(10,b="❌ Failed to rebuild index")}catch(P){console.error("Error rebuilding index:",P),t(10,b="❌ Index rebuild failed - check console for details")}},H=()=>{if(!h){alert("Editor not ready yet");return}const P=`# Terraphim Autocomplete Demo

This is a demonstration of the integrated Terraphim autocomplete system.

## How to Use:
1. Type "${p}" to trigger autocomplete
2. Start typing any term (e.g., "${p}terraphim", "${p}graph")
3. Use ↑↓ arrows to navigate suggestions
4. Press Tab or Enter to select
5. Press Esc to cancel

## Try these queries:
- ${p}terraphim
- ${p}graph
- ${p}service
- ${p}automata
- ${p}role

The autocomplete system uses your local knowledge graph to provide intelligent suggestions based on your selected role: **${o}**.

---

Start typing below:`;h.commands.setContent(P),setTimeout(()=>{h.commands.focus("end")},100),alert(`Demo content inserted!

Type "${p}" followed by any term to see autocomplete suggestions.

Example: "${p}terraphim"`)};return l.$$set=P=>{"html"in P&&t(0,u=P.html),"readOnly"in P&&t(1,r=P.readOnly),"outputFormat"in P&&t(17,c=P.outputFormat),"enableAutocomplete"in P&&t(2,i=P.enableAutocomplete),"showSnippets"in P&&t(3,d=P.showSnippets),"suggestionTrigger"in P&&t(4,p=P.suggestionTrigger),"maxSuggestions"in P&&t(5,m=P.maxSuggestions),"minQueryLength"in P&&t(6,_=P.minQueryLength),"debounceDelay"in P&&t(7,y=P.debounceDelay)},l.$$.update=()=>{l.$$.dirty&772&&o&&i&&k&&(Ot.setRole(o),w())},[u,r,i,d,p,m,_,y,k,o,b,C,n,S,V,I,H,c]}class br extends mt{constructor(e){super(),_t(this,e,gr,hr,at,{html:0,readOnly:1,outputFormat:17,enableAutocomplete:2,showSnippets:3,suggestionTrigger:4,maxSuggestions:5,minQueryLength:6,debounceDelay:7})}}function ko(l){let e,t,o,n,u,r,c,i,d,p,m;return{c(){e=f("div"),t=f("h3"),o=f("span"),o.textContent="Knowledge Graph",n=F(`
          Term: `),u=f("strong"),r=F(l[2]),c=F(" | Rank: "),i=f("strong"),d=F(l[3]),p=g(),m=f("hr"),a(o,"class","tag is-info svelte-329px1"),a(t,"class","subtitle is-6 svelte-329px1"),a(m,"class","svelte-329px1"),a(e,"class","kg-context svelte-329px1")},m(_,y){L(_,e,y),s(e,t),s(t,o),s(t,n),s(t,u),s(u,r),s(t,c),s(t,i),s(i,d),s(e,p),s(e,m)},p(_,y){y&4&&_e(r,_[2]),y&8&&_e(d,_[3])},d(_){_&&R(e)}}}function vr(l){let e,t,o,n,u,r,c,i;const d=[yr,wr],p=[];function m(_,y){return _[5]?0:1}return t=m(l),o=p[t]=d[t](l),{c(){e=f("div"),o.c(),n=g(),u=f("div"),u.innerHTML='<span class="hint-text svelte-329px1">Double-click to edit • Ctrl+E to edit • Ctrl+S to save • Click KG links to explore</span>',a(u,"class","edit-hint svelte-329px1"),a(e,"class","content-viewer svelte-329px1"),a(e,"tabindex","0"),a(e,"role","button"),a(e,"aria-label","Double-click to edit article content")},m(_,y){L(_,e,y),p[t].m(e,null),s(e,n),s(e,u),l[20](e),r=!0,c||(i=[Z(e,"dblclick",l[14]),Z(e,"keydown",l[15]),Z(e,"click",l[13])],c=!0)},p(_,y){let h=t;t=m(_),t===h?p[t].p(_,y):(Ke(),Q(p[h],1,1,()=>{p[h]=null}),Ge(),o=p[t],o?o.p(_,y):(o=p[t]=d[t](_),o.c()),B(o,1),o.m(e,n))},i(_){r||(B(o),r=!0)},o(_){Q(o),r=!1},d(_){_&&R(e),p[t].d(),l[20](null),c=!1,Je(i)}}}function kr(l){let e,t,o,n,u,r,c,i,d,p;function m(y){l[18](y)}let _={outputFormat:l[11]};return l[1].body!==void 0&&(_.html=l[1].body),e=new br({props:_}),Qe.push(()=>xe(e,"html",m)),{c(){ae(e.$$.fragment),o=g(),n=f("div"),u=f("button"),u.textContent="Save",r=g(),c=f("button"),c.textContent="Cancel",a(u,"class","button is-primary"),a(c,"class","button is-light"),a(n,"class","edit-controls svelte-329px1")},m(y,h){ue(e,y,h),L(y,o,h),L(y,n,h),s(n,u),s(n,r),s(n,c),i=!0,d||(p=[Z(u,"click",l[12]),Z(c,"click",l[19])],d=!0)},p(y,h){const b={};h&2048&&(b.outputFormat=y[11]),!t&&h&2&&(t=!0,b.html=y[1].body,et(()=>t=!1)),e.$set(b)},i(y){i||(B(e.$$.fragment,y),i=!0)},o(y){Q(e.$$.fragment,y),i=!1},d(y){ce(e,y),y&&R(o),y&&R(n),d=!1,Je(p)}}}function wr(l){let e,t,o;return t=new Ol({props:{source:l[1].body}}),{c(){e=f("div"),ae(t.$$.fragment),a(e,"class","markdown-content svelte-329px1")},m(n,u){L(n,e,u),ue(t,e,null),o=!0},p(n,u){const r={};u&2&&(r.source=n[1].body),t.$set(r)},i(n){o||(B(t.$$.fragment,n),o=!0)},o(n){Q(t.$$.fragment,n),o=!1},d(n){n&&R(e),ce(t)}}}function yr(l){let e,t=l[1].body+"";return{c(){e=f("div"),a(e,"class","prose svelte-329px1")},m(o,n){L(o,e,n),e.innerHTML=t},p(o,n){n&2&&t!==(t=o[1].body+"")&&(e.innerHTML=t)},i:ye,o:ye,d(o){o&&R(e)}}}function $r(l){let e,t,o,n,u,r=l[1].title+"",c,i,d,p,m,_,y,h=l[2]&&l[3]!==null&&ko(l);const b=[kr,vr],k=[];function C(v,w){return v[4]?0:1}return d=C(l),p=k[d]=b[d](l),{c(){e=f("div"),t=f("button"),o=g(),h&&h.c(),n=g(),u=f("h2"),c=F(r),i=g(),p.c(),a(t,"class","delete is-large modal-close-btn svelte-329px1"),a(t,"aria-label","close"),a(u,"class","svelte-329px1"),a(e,"class","box wrapper svelte-329px1")},m(v,w){L(v,e,w),s(e,t),s(e,o),h&&h.m(e,null),s(e,n),s(e,u),s(u,c),s(e,i),k[d].m(e,null),m=!0,_||(y=Z(t,"click",l[17]),_=!0)},p(v,w){v[2]&&v[3]!==null?h?h.p(v,w):(h=ko(v),h.c(),h.m(e,n)):h&&(h.d(1),h=null),(!m||w&2)&&r!==(r=v[1].title+"")&&_e(c,r);let S=d;d=C(v),d===S?k[d].p(v,w):(Ke(),Q(k[S],1,1,()=>{k[S]=null}),Ge(),p=k[d],p?p.p(v,w):(p=k[d]=b[d](v),p.c()),B(p,1),p.m(e,null))},i(v){m||(B(p),m=!0)},o(v){Q(p),m=!1},d(v){v&&R(e),h&&h.d(),k[d].d(),_=!1,y()}}}function wo(l){let e,t,o;function n(r){l[23](r)}let u={$$slots:{default:[Tr]},$$scope:{ctx:l}};return l[7]!==void 0&&(u.active=l[7]),e=new Ml({props:u}),Qe.push(()=>xe(e,"active",n)),{c(){ae(e.$$.fragment)},m(r,c){ue(e,r,c),o=!0},p(r,c){const i={};c&536872832&&(i.$$scope={dirty:c,ctx:r}),!t&&c&128&&(t=!0,i.active=r[7],et(()=>t=!1)),e.$set(i)},i(r){o||(B(e.$$.fragment,r),o=!0)},o(r){Q(e.$$.fragment,r),o=!1},d(r){ce(e,r)}}}function yo(l){let e,t,o,n,u,r,c,i,d,p,m;return{c(){e=f("div"),t=f("h3"),o=f("span"),o.textContent="Knowledge Graph",n=F(`
            Term: `),u=f("strong"),r=F(l[9]),c=F(" | Rank: "),i=f("strong"),d=F(l[10]),p=g(),m=f("hr"),a(o,"class","tag is-info svelte-329px1"),a(t,"class","subtitle is-6 svelte-329px1"),a(m,"class","svelte-329px1"),a(e,"class","kg-context svelte-329px1")},m(_,y){L(_,e,y),s(e,t),s(t,o),s(t,n),s(t,u),s(u,r),s(t,c),s(t,i),s(i,d),s(e,p),s(e,m)},p(_,y){y&512&&_e(r,_[9]),y&1024&&_e(d,_[10])},d(_){_&&R(e)}}}function Cr(l){let e,t,o;return t=new Ol({props:{source:l[8].body}}),{c(){e=f("div"),ae(t.$$.fragment),a(e,"class","markdown-content svelte-329px1")},m(n,u){L(n,e,u),ue(t,e,null),o=!0},p(n,u){const r={};u&256&&(r.source=n[8].body),t.$set(r)},i(n){o||(B(t.$$.fragment,n),o=!0)},o(n){Q(t.$$.fragment,n),o=!1},d(n){n&&R(e),ce(t)}}}function Sr(l){let e,t=l[8].body+"";return{c(){e=f("div"),a(e,"class","prose svelte-329px1")},m(o,n){L(o,e,n),e.innerHTML=t},p(o,n){n&256&&t!==(t=o[8].body+"")&&(e.innerHTML=t)},i:ye,o:ye,d(o){o&&R(e)}}}function Tr(l){let e,t,o,n,u,r=l[8].title+"",c,i,d,p,m,_,y,h,b,k,C,v=l[9]&&l[10]!==null&&yo(l);const w=[Sr,Cr],S=[];function V(I,H){return H&256&&(p=null),p==null&&(p=!!(I[8].body&&(/<html/i.test(I[8].body)||/<body/i.test(I[8].body)||/<head/i.test(I[8].body)))),p?0:1}return m=V(l,-1),_=S[m]=w[m](l),{c(){e=f("div"),t=f("button"),o=g(),v&&v.c(),n=g(),u=f("h2"),c=F(r),i=g(),d=f("div"),_.c(),y=g(),h=f("div"),h.innerHTML='<span class="hint-text svelte-329px1">Knowledge Graph document • Click KG links to explore further</span>',a(t,"class","delete is-large modal-close-btn svelte-329px1"),a(t,"aria-label","close"),a(u,"class","svelte-329px1"),a(h,"class","edit-hint svelte-329px1"),a(d,"class","content-viewer svelte-329px1"),a(d,"tabindex","0"),a(d,"role","button"),a(d,"aria-label","KG document content - click KG links to explore further"),a(e,"class","box wrapper svelte-329px1")},m(I,H){L(I,e,H),s(e,t),s(e,o),v&&v.m(e,null),s(e,n),s(e,u),s(u,c),s(e,i),s(e,d),S[m].m(d,null),s(d,y),s(d,h),b=!0,k||(C=[Z(t,"click",l[22]),Z(d,"click",l[13])],k=!0)},p(I,H){I[9]&&I[10]!==null?v?v.p(I,H):(v=yo(I),v.c(),v.m(e,n)):v&&(v.d(1),v=null),(!b||H&256)&&r!==(r=I[8].title+"")&&_e(c,r);let P=m;m=V(I,H),m===P?S[m].p(I,H):(Ke(),Q(S[P],1,1,()=>{S[P]=null}),Ge(),_=S[m],_?_.p(I,H):(_=S[m]=w[m](I),_.c()),B(_,1),_.m(d,y))},i(I){b||(B(_),b=!0)},o(I){Q(_),b=!1},d(I){I&&R(e),v&&v.d(),S[m].d(),k=!1,Je(C)}}}function Rr(l){let e,t,o,n,u;function r(d){l[21](d)}let c={$$slots:{default:[$r]},$$scope:{ctx:l}};l[0]!==void 0&&(c.active=l[0]),e=new Ml({props:c}),Qe.push(()=>xe(e,"active",r));let i=l[8]&&wo(l);return{c(){ae(e.$$.fragment),o=g(),i&&i.c(),n=ut()},m(d,p){ue(e,d,p),L(d,o,p),i&&i.m(d,p),L(d,n,p),u=!0},p(d,[p]){const m={};p&536873087&&(m.$$scope={dirty:p,ctx:d}),!t&&p&1&&(t=!0,m.active=d[0],et(()=>t=!1)),e.$set(m),d[8]?i?(i.p(d,p),p&256&&B(i,1)):(i=wo(d),i.c(),B(i,1),i.m(n.parentNode,n)):i&&(Ke(),Q(i,1,1,()=>{i=null}),Ge())},i(d){u||(B(e.$$.fragment,d),B(i),u=!0)},o(d){Q(e.$$.fragment,d),Q(i),u=!1},d(d){ce(e,d),d&&R(o),i&&i.d(d),d&&R(n)}}}function Ar(l,e,t){let o,n,u,r;Re(l,je,$=>t(25,u=$)),Re(l,At,$=>t(26,r=$));let{active:c=!1}=e,{item:i}=e,{initialEdit:d=!1}=e,{kgTerm:p=null}=e,{kgRank:m=null}=e,_=!1,y,h=!1,b=null,k=null,C=null;async function v(){if(u)try{const $=await He("get_document",{documentId:i.id});$!=null&&$.document&&t(1,i=$.document)}catch($){console.error("Failed to load document",$)}}async function w(){if(!u){t(4,_=!1);return}try{await He("create_document",{document:i}),t(4,_=!1)}catch($){console.error("Failed to save document",$)}}async function S($){var z,ee,q,Y,O;t(9,k=$),console.log("🔍 KG Link Click Debug Info:"),console.log("  Term clicked:",$),console.log("  Current role:",r),console.log("  Is Tauri mode:",u);try{if(u){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:r,term:$});const E=await He("find_documents_for_kg_term",{roleName:r,term:$});console.log("  📥 Tauri response received:"),console.log("    Status:",E.status),console.log("    Results count:",((z=E.results)==null?void 0:z.length)||0),console.log("    Total:",E.total||0),console.log("    Full response:",JSON.stringify(E,null,2)),E.status==="success"&&E.results&&E.results.length>0?(t(8,b=E.results[0]),t(10,C=b.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",b.title),console.log("    Rank:",C),console.log("    Body length:",((ee=b.body)==null?void 0:ee.length)||0,"characters"),t(7,h=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${$}" in role: "${r}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const E=rt.ServerURL,N=encodeURIComponent(r),D=encodeURIComponent($),G=`${E}/roles/${N}/kg_search?term=${D}`;console.log("  📤 HTTP Request details:"),console.log("    Base URL:",E),console.log("    Role (encoded):",N),console.log("    Term (encoded):",D),console.log("    Full URL:",G);const X=await fetch(G);if(console.log("  📥 HTTP Response received:"),console.log("    Status code:",X.status),console.log("    Status text:",X.statusText),console.log("    Headers:",Object.fromEntries(X.headers.entries())),!X.ok)throw new Error(`HTTP error! Status: ${X.status} - ${X.statusText}`);const oe=await X.json();console.log("  📄 Response data:"),console.log("    Status:",oe.status),console.log("    Results count:",((q=oe.results)==null?void 0:q.length)||0),console.log("    Total:",oe.total||0),console.log("    Full response:",JSON.stringify(oe,null,2)),oe.status==="success"&&oe.results&&oe.results.length>0?(t(8,b=oe.results[0]),t(10,C=b.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",b.title),console.log("    Rank:",C),console.log("    Body length:",((Y=b.body)==null?void 0:Y.length)||0,"characters"),t(7,h=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${$}" in role: "${r}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",G))}}catch(E){console.error("❌ Error fetching KG document:"),console.error("  Error type:",E.constructor.name),console.error("  Error message:",E.message||E),console.error("  Request details:",{term:$,role:r,isTauri:u,timestamp:new Date().toISOString()}),!u&&((O=E.message)!=null&&O.includes("Failed to fetch"))&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{}}function V($){const z=$.target;if(z.tagName==="A"){const ee=z.getAttribute("href");if(ee&&ee.startsWith("kg:")){$.preventDefault();const q=ee.substring(3);S(q)}}}function I(){t(4,_=!0)}function H($){$.type!=="dblclick"&&(($.ctrlKey||$.metaKey)&&$.key==="e"&&($.preventDefault(),t(4,_=!0)),_&&($.ctrlKey||$.metaKey)&&$.key==="s"&&($.preventDefault(),w()),$.key==="Escape"&&($.preventDefault(),_?t(4,_=!1):t(0,c=!1)))}const P=()=>t(0,c=!1);function J($){l.$$.not_equal(i.body,$)&&(i.body=$,t(1,i))}const K=()=>t(4,_=!1);function W($){Qe[$?"unshift":"push"](()=>{y=$,t(6,y)})}function T($){c=$,t(0,c)}const A=()=>t(7,h=!1);function U($){h=$,t(7,h)}return l.$$set=$=>{"active"in $&&t(0,c=$.active),"item"in $&&t(1,i=$.item),"initialEdit"in $&&t(16,d=$.initialEdit),"kgTerm"in $&&t(2,p=$.kgTerm),"kgRank"in $&&t(3,m=$.kgRank)},l.$$.update=()=>{l.$$.dirty&65537&&c&&d&&t(4,_=!0),l.$$.dirty&19&&c&&i&&!_&&v(),l.$$.dirty&2&&t(5,o=i!=null&&i.body?/<html/i.test(i.body)||/<body/i.test(i.body)||/<head/i.test(i.body)||/^\s*<(!DOCTYPE|html|head|body|div|p|span)/i.test(i.body.trim()):!1),l.$$.dirty&32&&t(11,n=o?"html":"markdown")},[c,i,p,m,_,o,y,h,b,k,C,n,w,V,I,H,d,P,J,K,W,T,A,U]}class Hl extends mt{constructor(e){super(),_t(this,e,Ar,Rr,at,{active:0,item:1,initialEdit:16,kgTerm:2,kgRank:3})}}function $o(l,e,t){const o=l.slice();return o[33]=e[t],o}function Co(l,e,t){const o=l.slice();return o[36]=e[t],o}function So(l,e,t){const o=l.slice();return o[39]=e[t],o}function To(l){let e,t;return e=new Bn({props:{type:"is-success",$$slots:{default:[Lr]},$$scope:{ctx:l}}}),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},i(o){t||(B(e.$$.fragment,o),t=!0)},o(o){Q(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function Lr(l){let e,t,o;return{c(){e=f("p"),e.innerHTML="<strong>Success!</strong> Article saved to atomic server successfully.",t=g(),o=f("p"),o.textContent="The modal will close automatically..."},m(n,u){L(n,e,u),L(n,t,u),L(n,o,u)},p:ye,d(n){n&&R(e),n&&R(t),n&&R(o)}}}function Ro(l){let e,t;return e=new Bn({props:{type:"is-danger",$$slots:{default:[Er]},$$scope:{ctx:l}}}),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},p(o,n){const u={};n[0]&8|n[1]&2048&&(u.$$scope={dirty:n,ctx:o}),e.$set(u)},i(o){t||(B(e.$$.fragment,o),t=!0)},o(o){Q(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function Er(l){let e,t,o,n;return{c(){e=f("p"),t=f("strong"),t.textContent="Error:",o=g(),n=F(l[3])},m(u,r){L(u,e,r),s(e,t),s(e,o),s(e,n)},p(u,r){r[0]&8&&_e(n,u[3])},d(u){u&&R(e)}}}function Ao(l){var U,$,z,ee;let e,t,o,n,u,r=(((U=l[1])==null?void 0:U.title)||"Untitled")+"",c,i,d,p,m,_,y=((($=l[1])==null?void 0:$.rank)||0)+"",h,b,k,C,v,w,S,V,I,H,P=((z=l[1])==null?void 0:z.description)&&Lo(l),J=((ee=l[1])==null?void 0:ee.tags)&&Eo(l);function K(q,Y){return q[10].length>0?Or:Pr}let W=K(l),T=W(l),A=l[10].length>0&&No(l);return{c(){e=f("div"),t=f("label"),t.textContent="Document to Save",o=g(),n=f("div"),u=f("h5"),c=F(r),i=g(),P&&P.c(),d=g(),p=f("div"),m=f("span"),_=F("Rank: "),h=F(y),b=g(),J&&J.c(),k=g(),C=f("div"),v=f("label"),v.textContent="Atomic Server",w=g(),S=f("div"),T.c(),V=g(),A&&A.c(),I=ut(),a(t,"class","label"),a(u,"class","title is-6"),a(m,"class","tag is-info svelte-48g63o"),a(p,"class","tags svelte-48g63o"),a(n,"class","box document-preview svelte-48g63o"),a(e,"class","field"),a(v,"class","label"),a(v,"for","atomic-server-select"),a(S,"class","control"),a(C,"class","field")},m(q,Y){L(q,e,Y),s(e,t),s(e,o),s(e,n),s(n,u),s(u,c),s(n,i),P&&P.m(n,null),s(n,d),s(n,p),s(p,m),s(m,_),s(m,h),s(p,b),J&&J.m(p,null),L(q,k,Y),L(q,C,Y),s(C,v),s(C,w),s(C,S),T.m(S,null),L(q,V,Y),A&&A.m(q,Y),L(q,I,Y),H=!0},p(q,Y){var O,E,N,D;(!H||Y[0]&2)&&r!==(r=(((O=q[1])==null?void 0:O.title)||"Untitled")+"")&&_e(c,r),(E=q[1])!=null&&E.description?P?P.p(q,Y):(P=Lo(q),P.c(),P.m(n,d)):P&&(P.d(1),P=null),(!H||Y[0]&2)&&y!==(y=(((N=q[1])==null?void 0:N.rank)||0)+"")&&_e(h,y),(D=q[1])!=null&&D.tags?J?J.p(q,Y):(J=Eo(q),J.c(),J.m(p,null)):J&&(J.d(1),J=null),W===(W=K(q))&&T?T.p(q,Y):(T.d(1),T=W(q),T&&(T.c(),T.m(S,null))),q[10].length>0?A?(A.p(q,Y),Y[0]&1024&&B(A,1)):(A=No(q),A.c(),B(A,1),A.m(I.parentNode,I)):A&&(Ke(),Q(A,1,1,()=>{A=null}),Ge())},i(q){H||(B(A),H=!0)},o(q){Q(A),H=!1},d(q){q&&R(e),P&&P.d(),J&&J.d(),q&&R(k),q&&R(C),T.d(),q&&R(V),A&&A.d(q),q&&R(I)}}}function Lo(l){let e,t=l[1].description+"",o;return{c(){e=f("p"),o=F(t),a(e,"class","content")},m(n,u){L(n,e,u),s(e,o)},p(n,u){u[0]&2&&t!==(t=n[1].description+"")&&_e(o,t)},d(n){n&&R(e)}}}function Eo(l){let e,t=l[1].tags,o=[];for(let n=0;n<t.length;n+=1)o[n]=Po(So(l,t,n));return{c(){for(let n=0;n<o.length;n+=1)o[n].c();e=ut()},m(n,u){for(let r=0;r<o.length;r+=1)o[r]&&o[r].m(n,u);L(n,e,u)},p(n,u){if(u[0]&2){t=n[1].tags;let r;for(r=0;r<t.length;r+=1){const c=So(n,t,r);o[r]?o[r].p(c,u):(o[r]=Po(c),o[r].c(),o[r].m(e.parentNode,e))}for(;r<o.length;r+=1)o[r].d(1);o.length=t.length}},d(n){Ye(o,n),n&&R(e)}}}function Po(l){let e,t=l[39]+"",o;return{c(){e=f("span"),o=F(t),a(e,"class","tag svelte-48g63o")},m(n,u){L(n,e,u),s(e,o)},p(n,u){u[0]&2&&t!==(t=n[39]+"")&&_e(o,t)},d(n){n&&R(e)}}}function Pr(l){let e,t,o,n,u,r,c,i,d;return{c(){e=f("div"),t=f("p"),t.innerHTML="<strong>No atomic servers available</strong>",o=g(),n=f("p"),u=F('Your current role "'),r=F(l[12]),c=F(`" doesn't have any writable atomic server configurations.`),i=g(),d=f("p"),d.textContent="Please configure an atomic server haystack in your role settings.",a(e,"class","notification is-warning")},m(p,m){L(p,e,m),s(e,t),s(e,o),s(e,n),s(n,u),s(n,r),s(n,c),s(e,i),s(e,d)},p(p,m){m[0]&4096&&_e(r,p[12])},d(p){p&&R(e)}}}function Or(l){let e,t,o,n,u,r,c=l[10],i=[];for(let d=0;d<c.length;d+=1)i[d]=Oo(Co(l,c,d));return{c(){e=f("div"),t=f("select");for(let d=0;d<i.length;d+=1)i[d].c();o=g(),n=f("p"),n.textContent=`Select the atomic server from your current role configuration.
              🔐 = Authenticated, ⚠️ = Anonymous access`,a(t,"id","atomic-server-select"),t.disabled=l[2],l[11]===void 0&&it(()=>l[18].call(t)),a(e,"class","select is-fullwidth"),a(n,"class","help svelte-48g63o")},m(d,p){L(d,e,p),s(e,t);for(let m=0;m<i.length;m+=1)i[m]&&i[m].m(t,null);Ie(t,l[11],!0),L(d,o,p),L(d,n,p),u||(r=Z(t,"change",l[18]),u=!0)},p(d,p){if(p[0]&1024){c=d[10];let m;for(m=0;m<c.length;m+=1){const _=Co(d,c,m);i[m]?i[m].p(_,p):(i[m]=Oo(_),i[m].c(),i[m].m(t,null))}for(;m<i.length;m+=1)i[m].d(1);i.length=c.length}p[0]&4&&(t.disabled=d[2]),p[0]&3072&&Ie(t,d[11])},d(d){d&&R(e),Ye(i,d),d&&R(o),d&&R(n),u=!1,r()}}}function Nr(l){let e;return{c(){e=f("span"),e.textContent="⚠️ No Auth",a(e,"class","has-text-warning")},m(t,o){L(t,e,o)},d(t){t&&R(e)}}}function Ur(l){let e;return{c(){e=f("span"),e.textContent="🔐",a(e,"class","has-text-success")},m(t,o){L(t,e,o)},d(t){t&&R(e)}}}function Oo(l){let e,t=l[36].location+"",o,n,u,r;function c(p,m){return p[36].atomic_server_secret?Ur:Nr}let i=c(l),d=i(l);return{c(){e=f("option"),o=F(t),n=g(),d.c(),u=g(),e.__value=r=l[36].location,e.value=e.__value},m(p,m){L(p,e,m),s(e,o),s(e,n),d.m(e,null),s(e,u)},p(p,m){m[0]&1024&&t!==(t=p[36].location+"")&&_e(o,t),i!==(i=c(p))&&(d.d(1),d=i(p),d&&(d.c(),d.m(e,u))),m[0]&1024&&r!==(r=p[36].location)&&(e.__value=r,e.value=e.__value)},d(p){p&&R(e),d.d()}}}function No(l){var M,x;let e,t,o,n,u,r,c,i,d,p,m,_,y,h,b,k,C,v,w,S,V,I,H,P,J,K,W,T,A,U,$,z,ee,q,Y,O,E,N,D,G,X,oe,pe,me=(l[8]||"Untitled")+"",Le,ge,fe,ne,Se,Te=(((x=(M=l[1])==null?void 0:M.body)==null?void 0:x.length)||0)+"",se,be,re,ke,Be,Ce,Oe=l[14]()+"",le,we,De,Xe,ze,Ne=l[15]()+"",ht,Fe,St,tt,gt;function Ve(j){l[19](j)}let lt={id:"article-title",placeholder:"Enter article title",disabled:l[2],required:!0};l[8]!==void 0&&(lt.value=l[8]),u=new Jt({props:lt}),Qe.push(()=>xe(u,"value",Ve));const ct=[Ir,Dr],Ee=[];function Tt(j,te){return j[7]?1:0}return K=Tt(l),W=Ee[K]=ct[K](l),$=new El({props:{type:"is-primary",loading:l[2],disabled:l[2]||!l[8].trim()||!l[11],$$slots:{default:[Mr]},$$scope:{ctx:l}}}),$.$on("click",l[16]),q=new El({props:{type:"is-light",disabled:l[2],$$slots:{default:[jr]},$$scope:{ctx:l}}}),q.$on("click",l[17]),St=qn(l[22][0]),{c(){e=f("div"),t=f("label"),t.textContent="Article Title",o=g(),n=f("div"),ae(u.$$.fragment),c=g(),i=f("div"),d=f("label"),d.textContent="Description",p=g(),m=f("div"),_=f("textarea"),y=g(),h=f("div"),b=f("label"),b.textContent="Parent Collection",k=g(),C=f("div"),v=f("label"),w=f("input"),S=F(`
              Use predefined collection`),V=g(),I=f("label"),H=f("input"),P=F(`
              Custom parent URL/path`),J=g(),W.c(),T=g(),A=f("div"),U=f("div"),ae($.$$.fragment),z=g(),ee=f("div"),ae(q.$$.fragment),Y=g(),O=f("div"),E=f("div"),N=f("p"),N.innerHTML="<strong>What will be saved:</strong>",D=g(),G=f("ul"),X=f("li"),oe=f("strong"),oe.textContent="Title:",pe=g(),Le=F(me),ge=g(),fe=f("li"),ne=f("strong"),ne.textContent="Body:",Se=F(" Original document content ("),se=F(Te),be=F(" characters)"),re=g(),ke=f("li"),Be=f("strong"),Be.textContent="Parent:",Ce=g(),le=F(Oe),we=g(),De=f("li"),Xe=f("strong"),Xe.textContent="Subject URL:",ze=g(),ht=F(Ne),a(t,"class","label"),a(t,"for","article-title"),a(n,"class","control"),a(e,"class","field"),a(d,"class","label"),a(d,"for","article-description"),a(_,"id","article-description"),a(_,"class","textarea"),a(_,"placeholder","Brief description of the article"),_.disabled=l[2],a(_,"rows","3"),a(m,"class","control"),a(i,"class","field"),a(b,"class","label"),a(w,"type","radio"),w.__value=!1,w.value=w.__value,w.disabled=l[2],a(v,"class","radio svelte-48g63o"),a(H,"type","radio"),H.__value=!0,H.value=H.__value,H.disabled=l[2],a(I,"class","radio svelte-48g63o"),a(C,"class","control"),a(h,"class","field"),a(U,"class","control"),a(ee,"class","control"),a(A,"class","field is-grouped"),a(X,"class","svelte-48g63o"),a(fe,"class","svelte-48g63o"),a(ke,"class","svelte-48g63o"),a(De,"class","svelte-48g63o"),a(G,"class","svelte-48g63o"),a(E,"class","notification is-info is-light svelte-48g63o"),a(O,"class","field"),St.p(w,H)},m(j,te){L(j,e,te),s(e,t),s(e,o),s(e,n),ue(u,n,null),L(j,c,te),L(j,i,te),s(i,d),s(i,p),s(i,m),s(m,_),Ae(_,l[9]),L(j,y,te),L(j,h,te),s(h,b),s(h,k),s(h,C),s(C,v),s(v,w),w.checked=w.__value===l[7],s(v,S),s(C,V),s(C,I),s(I,H),H.checked=H.__value===l[7],s(I,P),L(j,J,te),Ee[K].m(j,te),L(j,T,te),L(j,A,te),s(A,U),ue($,U,null),s(A,z),s(A,ee),ue(q,ee,null),L(j,Y,te),L(j,O,te),s(O,E),s(E,N),s(E,D),s(E,G),s(G,X),s(X,oe),s(X,pe),s(X,Le),s(G,ge),s(G,fe),s(fe,ne),s(fe,Se),s(fe,se),s(fe,be),s(G,re),s(G,ke),s(ke,Be),s(ke,Ce),s(ke,le),s(G,we),s(G,De),s(De,Xe),s(De,ze),s(De,ht),Fe=!0,tt||(gt=[Z(_,"input",l[20]),Z(w,"change",l[21]),Z(H,"change",l[23])],tt=!0)},p(j,te){var Pe,We;const he={};te[0]&4&&(he.disabled=j[2]),!r&&te[0]&256&&(r=!0,he.value=j[8],et(()=>r=!1)),u.$set(he),(!Fe||te[0]&4)&&(_.disabled=j[2]),te[0]&512&&Ae(_,j[9]),(!Fe||te[0]&4)&&(w.disabled=j[2]),te[0]&128&&(w.checked=w.__value===j[7]),(!Fe||te[0]&4)&&(H.disabled=j[2]),te[0]&128&&(H.checked=H.__value===j[7]);let de=K;K=Tt(j),K===de?Ee[K].p(j,te):(Ke(),Q(Ee[de],1,1,()=>{Ee[de]=null}),Ge(),W=Ee[K],W?W.p(j,te):(W=Ee[K]=ct[K](j),W.c()),B(W,1),W.m(T.parentNode,T));const Me={};te[0]&4&&(Me.loading=j[2]),te[0]&2308&&(Me.disabled=j[2]||!j[8].trim()||!j[11]),te[1]&2048&&(Me.$$scope={dirty:te,ctx:j}),$.$set(Me);const qe={};te[0]&4&&(qe.disabled=j[2]),te[1]&2048&&(qe.$$scope={dirty:te,ctx:j}),q.$set(qe),(!Fe||te[0]&256)&&me!==(me=(j[8]||"Untitled")+"")&&_e(Le,me),(!Fe||te[0]&2)&&Te!==(Te=(((We=(Pe=j[1])==null?void 0:Pe.body)==null?void 0:We.length)||0)+"")&&_e(se,Te)},i(j){Fe||(B(u.$$.fragment,j),B(W),B($.$$.fragment,j),B(q.$$.fragment,j),Fe=!0)},o(j){Q(u.$$.fragment,j),Q(W),Q($.$$.fragment,j),Q(q.$$.fragment,j),Fe=!1},d(j){j&&R(e),ce(u),j&&R(c),j&&R(i),j&&R(y),j&&R(h),j&&R(J),Ee[K].d(j),j&&R(T),j&&R(A),ce($),ce(q),j&&R(Y),j&&R(O),St.r(),tt=!1,Je(gt)}}}function Dr(l){let e,t,o,n,u,r,c;function i(p){l[25](p)}let d={placeholder:"e.g., my-collection or http://server/custom-parent",disabled:l[2]};return l[6]!==void 0&&(d.value=l[6]),o=new Jt({props:d}),Qe.push(()=>xe(o,"value",i)),{c(){e=f("div"),t=f("div"),ae(o.$$.fragment),u=g(),r=f("p"),r.textContent=`Enter a collection name (e.g., "my-articles") or full URL.
              If the collection doesn't exist, it will be created.`,a(t,"class","control"),a(r,"class","help svelte-48g63o"),a(e,"class","field")},m(p,m){L(p,e,m),s(e,t),ue(o,t,null),s(e,u),s(e,r),c=!0},p(p,m){const _={};m[0]&4&&(_.disabled=p[2]),!n&&m[0]&64&&(n=!0,_.value=p[6],et(()=>n=!1)),o.$set(_)},i(p){c||(B(o.$$.fragment,p),c=!0)},o(p){Q(o.$$.fragment,p),c=!1},d(p){p&&R(e),ce(o)}}}function Ir(l){let e,t,o,n,u,r,c=l[13],i=[];for(let d=0;d<c.length;d+=1)i[d]=Uo($o(l,c,d));return{c(){e=f("div"),t=f("div"),o=f("div"),n=f("select");for(let d=0;d<i.length;d+=1)i[d].c();n.disabled=l[2],l[5]===void 0&&it(()=>l[24].call(n)),a(o,"class","select is-fullwidth"),a(t,"class","control"),a(e,"class","field")},m(d,p){L(d,e,p),s(e,t),s(t,o),s(o,n);for(let m=0;m<i.length;m+=1)i[m]&&i[m].m(n,null);Ie(n,l[5],!0),u||(r=Z(n,"change",l[24]),u=!0)},p(d,p){if(p[0]&8192){c=d[13];let m;for(m=0;m<c.length;m+=1){const _=$o(d,c,m);i[m]?i[m].p(_,p):(i[m]=Uo(_),i[m].c(),i[m].m(n,null))}for(;m<i.length;m+=1)i[m].d(1);i.length=c.length}p[0]&4&&(n.disabled=d[2]),p[0]&8224&&Ie(n,d[5])},i:ye,o:ye,d(d){d&&R(e),Ye(i,d),u=!1,r()}}}function Uo(l){let e,t=l[33].label+"",o;return{c(){e=f("option"),o=F(t),e.__value=l[33].value,e.value=e.__value},m(n,u){L(n,e,u),s(e,o)},p:ye,d(n){n&&R(e)}}}function Mr(l){let e,t,o;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-cloud-upload-alt"></i>',t=g(),o=f("span"),o.textContent="Save to Atomic Server",a(e,"class","icon")},m(n,u){L(n,e,u),L(n,t,u),L(n,o,u)},p:ye,d(n){n&&R(e),n&&R(t),n&&R(o)}}}function jr(l){let e;return{c(){e=F("Cancel")},m(t,o){L(t,e,o)},d(t){t&&R(e)}}}function Hr(l){let e,t,o,n,u,r,c,i,d,p,m,_,y,h=l[4]&&To(l),b=l[3]&&Ro(l),k=!l[4]&&Ao(l);return{c(){e=f("div"),t=f("div"),o=f("div"),o.innerHTML=`<div class="level-item"><h3 class="title is-4"><span class="icon"><i class="fas fa-save"></i></span>
            Save to Atomic Server</h3></div>`,n=g(),u=f("div"),r=f("div"),c=f("button"),i=g(),h&&h.c(),d=g(),b&&b.c(),p=g(),k&&k.c(),a(o,"class","level-left"),a(c,"class","delete is-large"),c.disabled=l[2],a(c,"aria-label","close"),a(r,"class","level-item"),a(u,"class","level-right"),a(t,"class","level svelte-48g63o"),a(e,"class","box")},m(C,v){L(C,e,v),s(e,t),s(t,o),s(t,n),s(t,u),s(u,r),s(r,c),s(e,i),h&&h.m(e,null),s(e,d),b&&b.m(e,null),s(e,p),k&&k.m(e,null),m=!0,_||(y=Z(c,"click",l[17]),_=!0)},p(C,v){(!m||v[0]&4)&&(c.disabled=C[2]),C[4]?h?v[0]&16&&B(h,1):(h=To(C),h.c(),B(h,1),h.m(e,d)):h&&(Ke(),Q(h,1,1,()=>{h=null}),Ge()),C[3]?b?(b.p(C,v),v[0]&8&&B(b,1)):(b=Ro(C),b.c(),B(b,1),b.m(e,p)):b&&(Ke(),Q(b,1,1,()=>{b=null}),Ge()),C[4]?k&&(Ke(),Q(k,1,1,()=>{k=null}),Ge()):k?(k.p(C,v),v[0]&16&&B(k,1)):(k=Ao(C),k.c(),B(k,1),k.m(e,null))},i(C){m||(B(h),B(b),B(k),m=!0)},o(C){Q(h),Q(b),Q(k),m=!1},d(C){C&&R(e),h&&h.d(),b&&b.d(),k&&k.d(),_=!1,y()}}}function zr(l){let e,t,o;function n(r){l[26](r)}let u={$$slots:{default:[Hr]},$$scope:{ctx:l}};return l[0]!==void 0&&(u.active=l[0]),e=new Ml({props:u}),Qe.push(()=>xe(e,"active",n)),e.$on("close",l[17]),{c(){ae(e.$$.fragment)},m(r,c){ue(e,r,c),o=!0},p(r,c){const i={};c[0]&8190|c[1]&2048&&(i.$$scope={dirty:c,ctx:r}),!t&&c[0]&1&&(t=!0,i.active=r[0],et(()=>t=!1)),e.$set(i)},i(r){o||(B(e.$$.fragment,r),o=!0)},o(r){Q(e.$$.fragment,r),o=!1},d(r){ce(e,r)}}}function Fr(l,e,t){let o,n,u;Re(l,je,O=>t(27,o=O)),Re(l,Ct,O=>t(28,n=O)),Re(l,At,O=>t(12,u=O));let{active:r=!1}=e,{document:c}=e,i=!1,d=null,p=!1,m="",_="",y=!1,h="",b="",k=[],C="";const v=[{label:"Root (Server Root)",value:""},{label:"Articles Collection",value:"articles"},{label:"Documents Collection",value:"documents"},{label:"Knowledge Base",value:"knowledge-base"},{label:"Research",value:"research"},{label:"Projects",value:"projects"}];function w(){t(2,i=!1),t(3,d=null),t(4,p=!1),t(5,m=""),t(6,_=""),t(7,y=!1),t(8,h=(c==null?void 0:c.title)||""),t(9,b=(c==null?void 0:c.description)||`Article saved from Terraphim search: ${c==null?void 0:c.title}`),t(10,k=[]),t(11,C="")}function S(){var D;const O=u,E=n;if(!(E!=null&&E.roles)||!O){console.warn("No role configuration found");return}let N=null;try{for(const[G,X]of Object.entries(E.roles)){const oe=X,pe=typeof oe.name=="object"?oe.name.original:String(oe.name);if(G===O||pe===O){N=oe;break}}}catch(G){console.warn("Error checking role configuration:",G);return}if(!N){console.warn(`Role "${O}" not found in configuration`);return}t(10,k=((D=N.haystacks)==null?void 0:D.filter(G=>G.service==="Atomic"&&G.location&&!G.read_only))||[]),k.length>0&&t(11,C=k[0].location),console.log("Loaded atomic servers:",k)}function V(){const O=k.find(E=>E.location===C);return O==null?void 0:O.atomic_server_secret}function I(){const O=C.replace(/\/$/,"");if(y&&_.trim()){const E=_.trim();return E.startsWith("http://")||E.startsWith("https://")?E:`${O}/${E.replace(/^\//,"")}`}else return m?`${O}/${m}`:O}function H(){return h.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,50)}function P(){const O=C.replace(/\/$/,""),E=H(),N=Date.now();return`${O}/${E}-${N}`}async function J(){if(!C||!h.trim()){t(3,d="Please select an atomic server and provide a title");return}t(2,i=!0),t(3,d=null);try{const O=P(),E=I(),N=V();console.log("🔄 Saving article to atomic server:",{subject:O,parent:E,server:C,hasSecret:!!N});const D={subject:O,title:h.trim(),description:b.trim(),body:c.body,parent:E,shortname:H(),original_id:c.id,original_url:c.url,original_rank:c.rank,tags:c.tags||[]};if(o)await He("save_article_to_atomic",{article:D,serverUrl:C,atomicSecret:N});else{const G=await fetch(`${rt.ServerURL}/atomic/save`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({article:D,server_url:C,atomic_secret:N})});if(!G.ok){const X=await G.json().catch(()=>({error:G.statusText}));throw new Error(X.error||`HTTP ${G.status}: ${G.statusText}`)}}t(4,p=!0),console.log("✅ Article saved successfully to atomic server"),setTimeout(()=>{t(0,r=!1)},2e3)}catch(O){console.error("❌ Failed to save article to atomic server:",O),t(3,d=O.message||"Failed to save article to atomic server")}finally{t(2,i=!1)}}function K(){i||t(0,r=!1)}const W=[[]];function T(){C=Rt(this),t(11,C),t(10,k)}function A(O){h=O,t(8,h)}function U(){b=this.value,t(9,b)}function $(){y=this.__value,t(7,y)}function z(){y=this.__value,t(7,y)}function ee(){m=Rt(this),t(5,m),t(13,v)}function q(O){_=O,t(6,_)}function Y(O){r=O,t(0,r)}return l.$$set=O=>{"active"in O&&t(0,r=O.active),"document"in O&&t(1,c=O.document)},l.$$.update=()=>{l.$$.dirty[0]&3&&r&&c&&(w(),S())},[r,c,i,d,p,m,_,y,h,b,k,C,u,v,I,P,J,K,T,A,U,$,W,z,ee,q,Y]}class Wr extends mt{constructor(e){super(),_t(this,e,Fr,zr,at,{active:0,document:1},null,[-1,-1])}}async function zl(l){return He("tauri",l)}async function Kr(l,e){return zl({__tauriModule:"Event",message:{cmd:"unlisten",event:l,eventId:e}})}async function Gr(l,e,t){return zl({__tauriModule:"Event",message:{cmd:"listen",event:l,windowLabel:e,handler:Dl(t)}}).then(o=>async()=>Kr(l,o))}var Do;(function(l){l.WINDOW_RESIZED="tauri://resize",l.WINDOW_MOVED="tauri://move",l.WINDOW_CLOSE_REQUESTED="tauri://close-requested",l.WINDOW_CREATED="tauri://window-created",l.WINDOW_DESTROYED="tauri://destroyed",l.WINDOW_FOCUS="tauri://focus",l.WINDOW_BLUR="tauri://blur",l.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",l.WINDOW_THEME_CHANGED="tauri://theme-changed",l.WINDOW_FILE_DROP="tauri://file-drop",l.WINDOW_FILE_DROP_HOVER="tauri://file-drop-hover",l.WINDOW_FILE_DROP_CANCELLED="tauri://file-drop-cancelled",l.MENU="tauri://menu",l.CHECK_UPDATE="tauri://update",l.UPDATE_AVAILABLE="tauri://update-available",l.INSTALL_UPDATE="tauri://update-install",l.STATUS_UPDATE="tauri://update-status",l.DOWNLOAD_PROGRESS="tauri://update-download-progress"})(Do||(Do={}));async function Br(l,e){return Gr(l,null,e)}function Io(l,e,t){const o=l.slice();return o[9]=e[t],o}function Mo(l){let e,t=l[9].name+"",o,n;return{c(){e=f("option"),o=F(t),e.__value=n=l[9].name,e.value=e.__value},m(u,r){L(u,e,r),s(e,o)},p(u,r){r&1&&t!==(t=u[9].name+"")&&_e(o,t),r&1&&n!==(n=u[9].name)&&(e.__value=n,e.value=e.__value)},d(u){u&&R(e)}}}function qr(l){let e,t,o,n,u,r,c=l[0],i=[];for(let d=0;d<c.length;d+=1)i[d]=Mo(Io(l,c,d));return{c(){e=f("div"),t=f("div"),o=f("div"),n=f("select");for(let d=0;d<i.length;d+=1)i[d].c();a(o,"class","select"),a(t,"class","control"),a(e,"class","field is-grouped is-grouped-right")},m(d,p){L(d,e,p),s(e,t),s(t,o),s(o,n);for(let m=0;m<i.length;m+=1)i[m]&&i[m].m(n,null);Ie(n,l[1]),u||(r=Z(n,"change",l[2]),u=!0)},p(d,[p]){if(p&1){c=d[0];let m;for(m=0;m<c.length;m+=1){const _=Io(d,c,m);i[m]?i[m].p(_,p):(i[m]=Mo(_),i[m].c(),i[m].m(n,null))}for(;m<i.length;m+=1)i[m].d(1);i.length=c.length}p&3&&Ie(n,d[1])},i:ye,o:ye,d(d){d&&R(e),Ye(i,d),u=!1,r()}}}function Jr(l,e,t){let o,n,u,r;Re(l,Ct,_=>t(5,o=_)),Re(l,je,_=>t(6,n=_)),Re(l,fo,_=>t(0,u=_)),Re(l,At,_=>t(1,r=_));let c="";async function i(){try{je.set(window.__TAURI__!==void 0),n?(console.log("Loading config from Tauri"),He("get_config").then(_=>{console.log("get_config response",_),_&&_.status==="success"&&d(_.config)}).catch(_=>console.error("Error fetching config in Tauri:",_))):(console.log("Loading config from server"),c=`${rt.ServerURL}/config/`,fetch(c).then(_=>_.json()).then(_=>{console.log("Config received",_),_&&_.status==="success"&&d(_.config)}).catch(_=>console.error("Error fetching config:",_)))}catch(_){console.error("Unhandled error in loadConfig:",_)}}function d(_){var k;console.log("Updating stores from config:",_);const y={default_role:_.selected_role,..._};Ct.set(y);const h=Object.entries(_.roles).map(([C,v])=>({name:C,...v}));fo.set(h),At.set(_.selected_role);const b=_.roles[_.selected_role];if(console.log("Selected role settings:",b),b){const C=b.theme||"spacelab";console.log("Setting theme to:",C),pl.set(C),(k=b.kg)!=null&&k.publish?n?He("publish_thesaurus",{roleName:_.selected_role}).then(v=>{console.log("publish_thesaurus response",v),fl.set(v),$t.set(!0)}):(console.log("Fetching thesaurus from HTTP endpoint for role",_.selected_role),fetch(`${rt.ServerURL}/thesaurus/${encodeURIComponent(_.selected_role)}`).then(v=>v.json()).then(v=>{console.log("thesaurus HTTP response",v),v&&v.status==="success"&&v.thesaurus?(fl.set(v.thesaurus),$t.set(!0)):(console.error("Failed to fetch thesaurus:",v),$t.set(!1))}).catch(v=>{console.error("Error fetching thesaurus:",v),$t.set(!1)})):$t.set(!1)}else console.warn("No role settings found for:",_.selected_role),pl.set("spacelab")}typeof window<"u"&&window.__TAURI__&&Br("role_changed",_=>{console.log("Role changed event received from backend:",_.payload),d(_.payload)});async function p(){await i()}p(),console.log("Using Terraphim Server URL:",rt.ServerURL);function m(_){var C,v;const h=_.currentTarget.value;console.log("Role change requested:",h),At.set(h);const b=u.find(w=>w.name===h);if(!b){console.error(`No role settings found for role: ${h}.`);return}const k=b.theme||"spacelab";pl.set(k),console.log(`Theme changed to ${k}`),Ct.update(w=>(w.selected_role=h,w)),n?(He("select_role",{roleName:h}).catch(w=>console.error("Error selecting role:",w)),(C=b.kg)!=null&&C.publish?(console.log("Publishing thesaurus for role",h),He("publish_thesaurus",{roleName:h}).then(w=>{fl.set(w),$t.set(!0)})):$t.set(!1)):(fetch(`${rt.ServerURL}/config/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).catch(w=>console.error("Error updating config on server:",w)),(v=b.kg)!=null&&v.publish?(console.log("Fetching thesaurus from HTTP endpoint for role",h),fetch(`${rt.ServerURL}/thesaurus/${encodeURIComponent(h)}`).then(w=>w.json()).then(w=>{console.log("thesaurus HTTP response",w),w&&w.status==="success"&&w.thesaurus?(fl.set(w.thesaurus),$t.set(!0)):(console.error("Failed to fetch thesaurus:",w),$t.set(!1))}).catch(w=>{console.error("Error fetching thesaurus:",w),$t.set(!1)})):$t.set(!1))}return[u,r,m,i]}class Ll extends mt{constructor(e){super(),_t(this,e,Jr,qr,at,{loadConfig:3})}get loadConfig(){return this.$$.ctx[3]}}function jo(l,e,t){const o=l.slice();return o[34]=e[t],o}function Ho(l,e,t){const o=l.slice();return o[37]=e[t],o}function zo(l){let e,t;return e=new Jn({props:{$$slots:{default:[Qr]},$$scope:{ctx:l}}}),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},p(o,n){const u={};n[0]&129|n[1]&512&&(u.$$scope={dirty:n,ctx:o}),e.$set(u)},i(o){t||(B(e.$$.fragment,o),t=!0)},o(o){Q(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function Vr(l){let e=l[37]+"",t;return{c(){t=F(e)},m(o,n){L(o,t,n)},p(o,n){n[0]&1&&e!==(e=o[37]+"")&&_e(t,e)},d(o){o&&R(t)}}}function Fo(l){let e,t,o,n,u,r;t=new Vn({props:{rounded:!0,$$slots:{default:[Vr]},$$scope:{ctx:l}}});function c(){return l[18](l[37])}return{c(){e=f("button"),ae(t.$$.fragment),o=g(),a(e,"class","tag-button svelte-2smypa"),e.disabled=l[7],a(e,"title","Click to view knowledge graph document")},m(i,d){L(i,e,d),ue(t,e,null),s(e,o),n=!0,u||(r=Z(e,"click",c),u=!0)},p(i,d){l=i;const p={};d[0]&1|d[1]&512&&(p.$$scope={dirty:d,ctx:l}),t.$set(p),(!n||d[0]&128)&&(e.disabled=l[7])},i(i){n||(B(t.$$.fragment,i),n=!0)},o(i){Q(t.$$.fragment,i),n=!1},d(i){i&&R(e),ce(t),u=!1,r()}}}function Qr(l){let e,t,o=l[0].tags,n=[];for(let r=0;r<o.length;r+=1)n[r]=Fo(Ho(l,o,r));const u=r=>Q(n[r],1,1,()=>{n[r]=null});return{c(){for(let r=0;r<n.length;r+=1)n[r].c();e=ut()},m(r,c){for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(r,c);L(r,e,c),t=!0},p(r,c){if(c[0]&65665){o=r[0].tags;let i;for(i=0;i<o.length;i+=1){const d=Ho(r,o,i);n[i]?(n[i].p(d,c),B(n[i],1)):(n[i]=Fo(d),n[i].c(),B(n[i],1),n[i].m(e.parentNode,e))}for(Ke(),i=o.length;i<n.length;i+=1)u(i);Ge()}},i(r){if(!t){for(let c=0;c<o.length;c+=1)B(n[c]);t=!0}},o(r){n=n.filter(Boolean);for(let c=0;c<n.length;c+=1)Q(n[c]);t=!1},d(r){Ye(n,r),r&&R(e)}}}function Yr(l){let e,t=(l[0].rank||0)+"",o;return{c(){e=F("Rank "),o=F(t)},m(n,u){L(n,e,u),L(n,o,u)},p(n,u){u[0]&1&&t!==(t=(n[0].rank||0)+"")&&_e(o,t)},d(n){n&&R(e),n&&R(o)}}}function Zr(l){let e,t;return e=new Vn({props:{rounded:!0,$$slots:{default:[Yr]},$$scope:{ctx:l}}}),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},p(o,n){const u={};n[0]&1|n[1]&512&&(u.$$scope={dirty:n,ctx:o}),e.$set(u)},i(o){t||(B(e.$$.fragment,o),t=!0)},o(o){Q(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function Xr(l){let e;return{c(){e=f("small"),e.textContent="No description available",a(e,"class","no-description svelte-2smypa")},m(t,o){L(t,e,o)},p:ye,i:ye,o:ye,d(t){t&&R(e)}}}function xr(l){let e,t;return e=new Ol({props:{source:l[0].description}}),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},p(o,n){const u={};n[0]&1&&(u.source=o[0].description),e.$set(u)},i(o){t||(B(e.$$.fragment,o),t=!0)},o(o){Q(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function Wo(l){let e,t,o,n,u,r;return{c(){e=f("button"),t=f("span"),t.innerHTML='<i class="fas fa-magic" aria-hidden="true"></i>',o=g(),n=f("span"),n.textContent="AI Summary",a(t,"class","icon is-small"),a(e,"class","button is-small is-info is-outlined ai-summary-button svelte-2smypa"),e.disabled=l[9],a(e,"title","Generate AI-powered summary using OpenRouter")},m(c,i){L(c,e,i),s(e,t),s(e,o),s(e,n),u||(r=Z(e,"click",l[17]),u=!0)},p(c,i){i[0]&512&&(e.disabled=c[9])},d(c){c&&R(e),u=!1,r()}}}function Ko(l){let e;return{c(){e=f("div"),e.innerHTML=`<span class="icon"><i class="fas fa-spinner fa-spin" aria-hidden="true"></i></span> 
                <small>Generating AI summary...</small>`,a(e,"class","ai-summary-loading svelte-2smypa")},m(t,o){L(t,e,o)},d(t){t&&R(e)}}}function Go(l){let e,t,o,n,u,r,c,i,d,p;return{c(){e=f("div"),t=f("span"),t.innerHTML='<i class="fas fa-exclamation-triangle" aria-hidden="true"></i>',o=g(),n=f("small"),u=F("Summary error: "),r=F(l[10]),c=g(),i=f("button"),i.textContent="Retry",a(t,"class","icon has-text-danger"),a(n,"class","has-text-danger"),a(i,"class","button is-small is-text svelte-2smypa"),a(i,"title","Retry generating summary"),a(e,"class","ai-summary-error svelte-2smypa")},m(m,_){L(m,e,_),s(e,t),s(e,o),s(e,n),s(n,u),s(n,r),s(e,c),s(e,i),d||(p=Z(i,"click",l[19]),d=!0)},p(m,_){_[0]&1024&&_e(r,m[10])},d(m){m&&R(e),d=!1,p()}}}function Bo(l){let e,t,o,n,u,r,c,i,d,p,m,_,y,h,b,k,C,v,w,S;function V(P,J){return P[12]?ti:ei}let I=V(l),H=I(l);return p=new Ol({props:{source:l[8]}}),{c(){e=f("div"),t=f("div"),o=f("small"),n=f("span"),n.innerHTML='<i class="fas fa-robot" aria-hidden="true"></i>',u=F(`
                    AI Summary
                    `),H.c(),r=g(),c=f("button"),c.innerHTML='<span class="icon is-small"><i class="fas fa-times" aria-hidden="true"></i></span>',i=g(),d=f("div"),ae(p.$$.fragment),m=g(),_=f("div"),y=f("button"),h=f("span"),h.innerHTML='<i class="fas fa-redo" aria-hidden="true"></i>',b=g(),k=f("span"),k.textContent="Regenerate",a(n,"class","icon is-small"),a(o,"class","ai-summary-label svelte-2smypa"),a(c,"class","button is-small is-text svelte-2smypa"),a(c,"title","Hide AI summary"),a(t,"class","ai-summary-header svelte-2smypa"),a(d,"class","ai-summary-content svelte-2smypa"),a(h,"class","icon is-small"),a(y,"class","button is-small is-text svelte-2smypa"),y.disabled=l[9],a(y,"title","Regenerate summary"),a(_,"class","ai-summary-actions svelte-2smypa"),a(e,"class","ai-summary svelte-2smypa")},m(P,J){L(P,e,J),s(e,t),s(t,o),s(o,n),s(o,u),H.m(o,null),s(t,r),s(t,c),s(e,i),s(e,d),ue(p,d,null),s(e,m),s(e,_),s(_,y),s(y,h),s(y,b),s(y,k),v=!0,w||(S=[Z(c,"click",l[20]),Z(y,"click",l[21])],w=!0)},p(P,J){I!==(I=V(P))&&(H.d(1),H=I(P),H&&(H.c(),H.m(o,null)));const K={};J[0]&256&&(K.source=P[8]),p.$set(K),(!v||J[0]&512)&&(y.disabled=P[9])},i(P){v||(B(p.$$.fragment,P),it(()=>{v&&(C||(C=nl(e,sl,{},!0)),C.run(1))}),v=!0)},o(P){Q(p.$$.fragment,P),C||(C=nl(e,sl,{},!1)),C.run(0),v=!1},d(P){P&&R(e),H.d(),ce(p),P&&C&&C.end(),w=!1,Je(S)}}}function ei(l){let e;return{c(){e=f("span"),e.textContent="fresh",a(e,"class","tag is-small is-success")},m(t,o){L(t,e,o)},d(t){t&&R(e)}}}function ti(l){let e;return{c(){e=f("span"),e.textContent="cached",a(e,"class","tag is-small is-light")},m(t,o){L(t,e,o)},d(t){t&&R(e)}}}function qo(l){let e;function t(u,r){return u[34].disabled?ni:u[34].isLink?oi:li}let o=t(l),n=o(l);return{c(){n.c(),e=ut()},m(u,r){n.m(u,r),L(u,e,r)},p(u,r){o===(o=t(u))&&n?n.p(u,r):(n.d(1),n=o(u),n&&(n.c(),n.m(e.parentNode,e)))},d(u){n.d(u),u&&R(e)}}}function li(l){let e,t,o,n,u,r,c,i,d;return{c(){e=f("button"),t=f("span"),o=f("i"),u=g(),a(o,"class",n=Nt(l[34].icon)+" svelte-2smypa"),a(t,"class","icon is-medium"),Ut(t,"has-text-primary",l[34].className),a(e,"type","button"),a(e,"class","level-item button is-ghost svelte-2smypa"),a(e,"aria-label",r=l[34].title),a(e,"title",c=l[34].title)},m(p,m){L(p,e,m),s(e,t),s(t,o),s(e,u),i||(d=Z(e,"click",function(){jl(l[34].action)&&l[34].action.apply(this,arguments)}),i=!0)},p(p,m){l=p,m[0]&16384&&n!==(n=Nt(l[34].icon)+" svelte-2smypa")&&a(o,"class",n),m[0]&16384&&Ut(t,"has-text-primary",l[34].className),m[0]&16384&&r!==(r=l[34].title)&&a(e,"aria-label",r),m[0]&16384&&c!==(c=l[34].title)&&a(e,"title",c)},d(p){p&&R(e),i=!1,d()}}}function oi(l){let e,t,o,n,u,r,c,i;return{c(){e=f("a"),t=f("span"),o=f("i"),u=g(),a(o,"class",n=Nt(l[34].icon)+" svelte-2smypa"),a(t,"class","icon is-medium"),Ut(t,"has-text-primary",l[34].className),a(e,"href",r=l[34].href),a(e,"target","_blank"),a(e,"class","level-item"),a(e,"aria-label",c=l[34].title),a(e,"title",i=l[34].title)},m(d,p){L(d,e,p),s(e,t),s(t,o),s(e,u)},p(d,p){p[0]&16384&&n!==(n=Nt(d[34].icon)+" svelte-2smypa")&&a(o,"class",n),p[0]&16384&&Ut(t,"has-text-primary",d[34].className),p[0]&16384&&r!==(r=d[34].href)&&a(e,"href",r),p[0]&16384&&c!==(c=d[34].title)&&a(e,"aria-label",c),p[0]&16384&&i!==(i=d[34].title)&&a(e,"title",i)},d(d){d&&R(e)}}}function ni(l){let e,t,o,n,u,r,c;return{c(){e=f("button"),t=f("span"),o=f("i"),u=g(),a(o,"class",n=Nt(l[34].icon)+" svelte-2smypa"),a(t,"class","icon is-medium"),Ut(t,"has-text-primary",l[34].className),a(e,"type","button"),a(e,"class","level-item button is-ghost svelte-2smypa"),a(e,"aria-label",r=l[34].title),a(e,"title",c=l[34].title),e.disabled=!0},m(i,d){L(i,e,d),s(e,t),s(t,o),s(e,u)},p(i,d){d[0]&16384&&n!==(n=Nt(i[34].icon)+" svelte-2smypa")&&a(o,"class",n),d[0]&16384&&Ut(t,"has-text-primary",i[34].className),d[0]&16384&&r!==(r=i[34].title)&&a(e,"aria-label",r),d[0]&16384&&c!==(c=i[34].title)&&a(e,"title",c)},d(i){i&&R(e)}}}function Jo(l){let e,t=l[34].visible&&qo(l);return{c(){t&&t.c(),e=ut()},m(o,n){t&&t.m(o,n),L(o,e,n)},p(o,n){o[34].visible?t?t.p(o,n):(t=qo(o),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(o){t&&t.d(o),o&&R(e)}}}function Vo(l){let e,t,o;function n(r){l[23](r)}let u={item:l[4],kgTerm:l[5],kgRank:l[6]};return l[2]!==void 0&&(u.active=l[2]),e=new Hl({props:u}),Qe.push(()=>xe(e,"active",n)),{c(){ae(e.$$.fragment)},m(r,c){ue(e,r,c),o=!0},p(r,c){const i={};c[0]&16&&(i.item=r[4]),c[0]&32&&(i.kgTerm=r[5]),c[0]&64&&(i.kgRank=r[6]),!t&&c[0]&4&&(t=!0,i.active=r[2],et(()=>t=!1)),e.$set(i)},i(r){o||(B(e.$$.fragment,r),o=!0)},o(r){Q(e.$$.fragment,r),o=!1},d(r){ce(e,r)}}}function Qo(l){let e,t,o;function n(r){l[24](r)}let u={document:l[0]};return l[3]!==void 0&&(u.active=l[3]),e=new Wr({props:u}),Qe.push(()=>xe(e,"active",n)),{c(){ae(e.$$.fragment)},m(r,c){ue(e,r,c),o=!0},p(r,c){const i={};c[0]&1&&(i.document=r[0]),!t&&c[0]&8&&(t=!0,i.active=r[3],et(()=>t=!1)),e.$set(i)},i(r){o||(B(e.$$.fragment,r),o=!0)},o(r){Q(e.$$.fragment,r),o=!1},d(r){ce(e,r)}}}function si(l){let e,t,o,n,u,r,c,i,d,p,m,_,y=l[0].title+"",h,b,k,C,v,w,S,V,I,H,P,J,K,W,T,A,U,$,z,ee,q,Y,O,E,N,D,G,X,oe,pe,me=l[0].tags&&zo(l);i=new Jn({props:{$$slots:{default:[Zr]},$$scope:{ctx:l}}});const Le=[xr,Xr],ge=[];function fe(le,we){return le[0].description?0:1}S=fe(l),V=ge[S]=Le[S](l);let ne=!l[11]&&!l[9]&&!l[10]&&Wo(l),Se=l[9]&&Ko(),Te=l[10]&&Go(l),se=l[11]&&l[8]&&Bo(l),be=l[14],re=[];for(let le=0;le<be.length;le+=1)re[le]=Jo(jo(l,be,le));function ke(le){l[22](le)}let Be={item:l[0]};l[1]!==void 0&&(Be.active=l[1]),O=new Hl({props:Be}),Qe.push(()=>xe(O,"active",ke));let Ce=l[4]&&Vo(l),Oe=l[13]&&Qo(l);return{c(){e=f("div"),t=f("article"),o=f("div"),n=f("div"),u=f("div"),me&&me.c(),r=g(),c=f("div"),ae(i.$$.fragment),d=g(),p=f("div"),m=f("button"),_=f("h2"),h=F(y),b=g(),k=f("div"),C=f("small"),C.textContent="Description:",v=g(),w=f("div"),V.c(),I=g(),H=f("div"),ne&&ne.c(),P=g(),Se&&Se.c(),J=g(),Te&&Te.c(),K=g(),se&&se.c(),W=g(),T=f("br"),U=g(),$=f("div"),z=f("nav"),ee=f("div");for(let le=0;le<re.length;le+=1)re[le].c();Y=g(),ae(O.$$.fragment),N=g(),Ce&&Ce.c(),D=g(),Oe&&Oe.c(),G=ut(),a(u,"class","level-right"),a(c,"class","level-right"),a(_,"class","title svelte-2smypa"),a(m,"class","svelte-2smypa"),a(C,"class","description-label svelte-2smypa"),a(w,"class","description-content svelte-2smypa"),a(k,"class","description svelte-2smypa"),a(H,"class","ai-summary-section svelte-2smypa"),a(n,"class","content"),a(ee,"class","level-right"),a(z,"class","level is-mobile"),a($,"class","level-right"),a(o,"class","media-content"),a(t,"class","media"),a(e,"class","box")},m(le,we){L(le,e,we),s(e,t),s(t,o),s(o,n),s(n,u),me&&me.m(u,null),s(n,r),s(n,c),ue(i,c,null),s(n,d),s(n,p),s(p,m),s(m,_),s(_,h),s(p,b),s(p,k),s(k,C),s(k,v),s(k,w),ge[S].m(w,null),s(p,I),s(p,H),ne&&ne.m(H,null),s(H,P),Se&&Se.m(H,null),s(H,J),Te&&Te.m(H,null),s(H,K),se&&se.m(H,null),s(p,W),s(p,T),s(o,U),s(o,$),s($,z),s(z,ee);for(let De=0;De<re.length;De+=1)re[De]&&re[De].m(ee,null);L(le,Y,we),ue(O,le,we),L(le,N,we),Ce&&Ce.m(le,we),L(le,D,we),Oe&&Oe.m(le,we),L(le,G,we),X=!0,oe||(pe=Z(m,"click",l[15]),oe=!0)},p(le,we){le[0].tags?me?(me.p(le,we),we[0]&1&&B(me,1)):(me=zo(le),me.c(),B(me,1),me.m(u,null)):me&&(Ke(),Q(me,1,1,()=>{me=null}),Ge());const De={};we[0]&1|we[1]&512&&(De.$$scope={dirty:we,ctx:le}),i.$set(De),(!X||we[0]&1)&&y!==(y=le[0].title+"")&&_e(h,y);let Xe=S;if(S=fe(le),S===Xe?ge[S].p(le,we):(Ke(),Q(ge[Xe],1,1,()=>{ge[Xe]=null}),Ge(),V=ge[S],V?V.p(le,we):(V=ge[S]=Le[S](le),V.c()),B(V,1),V.m(w,null)),!le[11]&&!le[9]&&!le[10]?ne?ne.p(le,we):(ne=Wo(le),ne.c(),ne.m(H,P)):ne&&(ne.d(1),ne=null),le[9]?Se||(Se=Ko(),Se.c(),Se.m(H,J)):Se&&(Se.d(1),Se=null),le[10]?Te?Te.p(le,we):(Te=Go(le),Te.c(),Te.m(H,K)):Te&&(Te.d(1),Te=null),le[11]&&le[8]?se?(se.p(le,we),we[0]&2304&&B(se,1)):(se=Bo(le),se.c(),B(se,1),se.m(H,null)):se&&(Ke(),Q(se,1,1,()=>{se=null}),Ge()),we[0]&16384){be=le[14];let Ne;for(Ne=0;Ne<be.length;Ne+=1){const ht=jo(le,be,Ne);re[Ne]?re[Ne].p(ht,we):(re[Ne]=Jo(ht),re[Ne].c(),re[Ne].m(ee,null))}for(;Ne<re.length;Ne+=1)re[Ne].d(1);re.length=be.length}const ze={};we[0]&1&&(ze.item=le[0]),!E&&we[0]&2&&(E=!0,ze.active=le[1],et(()=>E=!1)),O.$set(ze),le[4]?Ce?(Ce.p(le,we),we[0]&16&&B(Ce,1)):(Ce=Vo(le),Ce.c(),B(Ce,1),Ce.m(D.parentNode,D)):Ce&&(Ke(),Q(Ce,1,1,()=>{Ce=null}),Ge()),le[13]?Oe?(Oe.p(le,we),we[0]&8192&&B(Oe,1)):(Oe=Qo(le),Oe.c(),B(Oe,1),Oe.m(G.parentNode,G)):Oe&&(Ke(),Q(Oe,1,1,()=>{Oe=null}),Ge())},i(le){X||(B(me),B(i.$$.fragment,le),B(V),B(se),it(()=>{X&&(A||(A=nl(p,sl,{},!0)),A.run(1))}),it(()=>{X&&(q||(q=nl(z,sl,{},!0)),q.run(1))}),B(O.$$.fragment,le),B(Ce),B(Oe),X=!0)},o(le){Q(me),Q(i.$$.fragment,le),Q(V),Q(se),A||(A=nl(p,sl,{},!1)),A.run(0),q||(q=nl(z,sl,{},!1)),q.run(0),Q(O.$$.fragment,le),Q(Ce),Q(Oe),X=!1},d(le){le&&R(e),me&&me.d(),ce(i),ge[S].d(),ne&&ne.d(),Se&&Se.d(),Te&&Te.d(),se&&se.d(),le&&A&&A.end(),Ye(re,le),le&&q&&q.end(),le&&R(Y),ce(O,le),le&&R(N),Ce&&Ce.d(le),le&&R(D),Oe&&Oe.d(le),le&&R(G),oe=!1,pe()}}}function ri(l,e,t){let o,n,u,r,c;Re(l,At,E=>t(25,u=E)),Re(l,je,E=>t(26,r=E)),Re(l,Ct,E=>t(27,c=E));let{document:i}=e,d=!1,p=!1,m=!1,_=null,y=null,h=null,b=!1,k=null,C=!1,v=null,w=!1,S=!1;function V(){const E=[];return E.push({id:"download-markdown",label:"Download to Markdown",icon:"fas fa-download",action:()=>W(),visible:!0,title:"Download document as markdown file"}),o&&E.push({id:"save-atomic",label:"Save to Atomic Server",icon:"fas fa-cloud-upload-alt",action:()=>P(),visible:!0,title:"Save article to Atomic Server",className:"has-text-primary"}),i.url&&E.push({id:"external-url",label:"Open URL",icon:"fas fa-link",action:()=>window.open(i.url,"_blank"),visible:!0,title:"Open original URL in new tab",isLink:!0,href:i.url}),E.push({id:"open-vscode",label:"Open in VSCode",icon:"fas fa-code",action:()=>T(),visible:!0,title:"Open document in VSCode",isLink:!0,href:`vscode://${encodeURIComponent(i.title)}.md?${encodeURIComponent(i.body)}`}),E.push({id:"add-context",label:"Add to Context",icon:"fas fa-plus",action:()=>A(),visible:!0,title:"Add document to LLM conversation context",disabled:!1}),E}function I(){var X;const E=u,N=c;if(!(N!=null&&N.roles)||!E)return!1;let D=null;try{for(const[oe,pe]of Object.entries(N.roles)){const me=pe,Le=typeof me.name=="object"?me.name.original:String(me.name);if(oe===E||Le===E){D=me;break}}}catch(oe){return console.warn("Error checking role configuration:",oe),!1}return D?(((X=D.haystacks)==null?void 0:X.filter(oe=>oe.service==="Atomic"&&oe.location&&!oe.read_only))||[]).length>0:!1}const H=()=>{t(1,d=!0)},P=()=>{console.log("🔄 Opening atomic save modal for document:",i.title),t(3,m=!0)};async function J(E){var N,D,G,X,oe;t(7,b=!0),t(5,y=E),console.log("🔍 KG Search Debug Info:"),console.log("  Tag clicked:",E),console.log("  Current role:",u),console.log("  Is Tauri mode:",r);try{if(r){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:u,term:E});const pe=await He("find_documents_for_kg_term",{roleName:u,term:E});console.log("  📥 Tauri response received:"),console.log("    Status:",pe.status),console.log("    Results count:",((N=pe.results)==null?void 0:N.length)||0),console.log("    Total:",pe.total||0),console.log("    Full response:",JSON.stringify(pe,null,2)),pe.status==="success"&&pe.results&&pe.results.length>0?(t(4,_=pe.results[0]),t(6,h=_.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",_.title),console.log("    Rank:",h),console.log("    Body length:",((D=_.body)==null?void 0:D.length)||0,"characters"),t(2,p=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${E}" in role: "${u}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const pe=rt.ServerURL,me=encodeURIComponent(u),Le=encodeURIComponent(E),ge=`${pe}/roles/${me}/kg_search?term=${Le}`;console.log("  📤 HTTP Request details:"),console.log("    Base URL:",pe),console.log("    Role (encoded):",me),console.log("    Term (encoded):",Le),console.log("    Full URL:",ge);const fe=await fetch(ge);if(console.log("  📥 HTTP Response received:"),console.log("    Status code:",fe.status),console.log("    Status text:",fe.statusText),console.log("    Headers:",Object.fromEntries(fe.headers.entries())),!fe.ok)throw new Error(`HTTP error! Status: ${fe.status} - ${fe.statusText}`);const ne=await fe.json();console.log("  📄 Response data:"),console.log("    Status:",ne.status),console.log("    Results count:",((G=ne.results)==null?void 0:G.length)||0),console.log("    Total:",ne.total||0),console.log("    Full response:",JSON.stringify(ne,null,2)),ne.status==="success"&&ne.results&&ne.results.length>0?(t(4,_=ne.results[0]),t(6,h=_.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",_.title),console.log("    Rank:",h),console.log("    Body length:",((X=_.body)==null?void 0:X.length)||0,"characters"),t(2,p=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${E}" in role: "${u}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",ge))}}catch(pe){console.error("❌ Error fetching KG document:"),console.error("  Error type:",pe.constructor.name),console.error("  Error message:",pe.message||pe),console.error("  Request details:",{tag:E,role:u,isTauri:r,timestamp:new Date().toISOString()}),!r&&((oe=pe.message)!=null&&oe.includes("Failed to fetch"))&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{t(7,b=!1)}}async function K(){var E;if(!(C||!i.id||!u)){t(9,C=!0),t(10,v=null),console.log("🤖 AI Summary Debug Info:"),console.log("  Document ID:",i.id),console.log("  Current role:",u),console.log("  Is Tauri mode:",r);try{const N={document_id:i.id,role:u,max_length:250,force_regenerate:!1};console.log("  📤 Summarization request:",N);let D;if(r){const oe=`${rt.ServerURL}/documents/summarize`;D=await fetch(oe,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(N)})}else{const oe=`${rt.ServerURL}/documents/summarize`;D=await fetch(oe,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(N)})}if(console.log("  📥 Summary response received:"),console.log("    Status code:",D.status),console.log("    Status text:",D.statusText),!D.ok)throw new Error(`HTTP error! Status: ${D.status} - ${D.statusText}`);const G=await D.json();console.log("  📄 Summary response data:",G),G.status==="Success"&&G.summary?(t(8,k=G.summary),t(12,S=G.from_cache||!1),t(11,w=!0),console.log("  ✅ Summary generated successfully"),console.log("    Summary length:",k.length,"characters"),console.log("    From cache:",S),console.log("    Model used:",G.model_used)):(t(10,v=G.error||"Failed to generate summary"),console.error("  ❌ Summary generation failed:",v))}catch(N){console.error("❌ Error generating summary:"),console.error("  Error type:",N.constructor.name),console.error("  Error message:",N.message||N),console.error("  Request details:",{document_id:i.id,role:u,isTauri:r,timestamp:new Date().toISOString()}),t(10,v=N.message||"Network error occurred"),(E=N.message)!=null&&E.includes("Failed to fetch")&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Verify OpenRouter is enabled for this role"),console.error("    3. Check OPENROUTER_KEY environment variable"),console.error("    4. Verify server URL in CONFIG.ServerURL"))}finally{t(9,C=!1)}}}function W(){console.log("📥 Downloading document as markdown:",i.title);let E=`# ${i.title}

`;E+=`**Source:** Terraphim Search
`,E+=`**Rank:** ${i.rank||"N/A"}
`,i.url&&(E+=`**URL:** ${i.url}
`),i.tags&&i.tags.length>0&&(E+=`**Tags:** ${i.tags.join(", ")}
`),E+=`**Downloaded:** ${new Date().toISOString()}

`,i.description&&(E+=`## Description

${i.description}

`),E+=`## Content

${i.body}
`;const N=`${i.title.replace(/[^a-z0-9]/gi,"_").toLowerCase()}_${Date.now()}.md`,D=new Blob([E],{type:"text/markdown"}),G=URL.createObjectURL(D),X=window.document.createElement("a");X.href=G,X.download=N,window.document.body.appendChild(X),X.click(),window.document.body.removeChild(X),URL.revokeObjectURL(G),console.log("✅ Markdown file downloaded:",N)}function T(){const E=`vscode://${encodeURIComponent(i.title)}.md?${encodeURIComponent(i.body)}`;window.open(E,"_blank")}async function A(){console.log("📝 Adding document to LLM context:",i.title);try{let E=null;if(r){try{const G=await He("list_conversations");if(console.log("📋 Available conversations:",G),G!=null&&G.conversations&&G.conversations.length>0)E=G.conversations[0].id,console.log("🎯 Using existing conversation:",E);else{const X=await He("create_conversation",{title:"Search Context",role:u||"default"});if(X.status==="Success"&&X.conversationId)E=X.conversationId,console.log("🆕 Created new conversation:",E);else throw new Error("Failed to create conversation: "+(X.error||"Unknown error"))}}catch(G){throw console.error("❌ Failed to manage conversations:",G),new Error("Could not create or find conversation: "+G.message)}const N={source_type:"document",document_id:i.id};i.url&&(N.url=i.url),i.tags&&i.tags.length>0&&(N.tags=i.tags.join(", ")),i.rank!==void 0&&(N.rank=i.rank.toString());const D=await He("add_context_to_conversation",{conversationId:E,contextType:"document",title:i.title,content:i.body,metadata:N});console.log("✅ Document added to context via Tauri:",D)}else{const N=rt.ServerURL;try{const oe=await fetch(`${N}/conversations`);if(oe.ok){const pe=await oe.json();if(pe.conversations&&pe.conversations.length>0)E=pe.conversations[0].id,console.log("🎯 Using existing conversation:",E);else{const me=await fetch(`${N}/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"Search Context",role:u||"default"})});if(me.ok){const Le=await me.json();if(Le.status==="Success"&&Le.conversation_id)E=Le.conversation_id,console.log("🆕 Created new conversation:",E);else throw new Error("Failed to create conversation: "+(Le.error||"Unknown error"))}else throw new Error(`Failed to create conversation: ${me.status} ${me.statusText}`)}}else throw new Error(`Failed to list conversations: ${oe.status} ${oe.statusText}`)}catch(oe){throw console.error("❌ Failed to manage conversations:",oe),new Error("Could not create or find conversation: "+oe.message)}const D=`${N}/conversations/${E}/context`,G=await fetch(D,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context_item:{id:"",context_type:"Document",title:i.title,content:i.body,metadata:{source_type:"document",document_id:i.id,url:i.url||"",tags:i.tags?i.tags.join(", "):"",rank:i.rank?i.rank.toString():"0"},created_at:new Date().toISOString(),relevance_score:i.rank}})});if(!G.ok)throw new Error(`HTTP error! Status: ${G.status} - ${G.statusText}`);const X=await G.json();console.log("✅ Document added to context via HTTP:",X)}console.log("✅ Successfully added document to LLM context")}catch(E){console.error("❌ Error adding document to context:"),console.error("  Error type:",E.constructor.name),console.error("  Error message:",E.message||E),console.error("  Document details:",{id:i.id,title:i.title,isTauri:r,timestamp:new Date().toISOString()})}}Ll[u]!==void 0&&(console.log("Have attribute",Ll[u]),Ll[u].hasOwnProperty("enableLogseq")?console.log("enable logseq True"):console.log("Didn't make it"));const U=E=>J(E),$=()=>{t(10,v=null),K()},z=()=>t(11,w=!1),ee=()=>{K()};function q(E){d=E,t(1,d)}function Y(E){p=E,t(2,p)}function O(E){m=E,t(3,m)}return l.$$set=E=>{"document"in E&&t(0,i=E.document)},t(13,o=I()),t(14,n=V()),[i,d,p,m,_,y,h,b,k,C,v,w,S,o,n,H,J,K,U,$,z,ee,q,Y,O]}class ii extends mt{constructor(e){super(),_t(this,e,ri,si,at,{document:0},null,[-1,-1])}}const ai="/assets/terraphim_gray.png";function ui(l){const e=l.trim();if(!e)return{hasOperator:!1,operator:null,terms:[l],originalQuery:l};const t=/\b(and)\b/i,o=/\b(or)\b/i,n=t.test(e),u=o.test(e);if(n&&!u)return{hasOperator:!0,operator:"AND",terms:e.split(t).filter((c,i)=>i%2===0).map(c=>c.trim()).filter(c=>c.length>0),originalQuery:l};if(u&&!n)return{hasOperator:!0,operator:"OR",terms:e.split(o).filter((c,i)=>i%2===0).map(c=>c.trim()).filter(c=>c.length>0),originalQuery:l};if(n&&u){const r=e.toLowerCase().indexOf(" and "),c=e.toLowerCase().indexOf(" or ");if(r!==-1&&(c===-1||r<c))return{hasOperator:!0,operator:"AND",terms:e.split(t).filter((d,p)=>p%2===0).map(d=>d.trim()).filter(d=>d.length>0),originalQuery:l};if(c!==-1)return{hasOperator:!0,operator:"OR",terms:e.split(o).filter((d,p)=>p%2===0).map(d=>d.trim()).filter(d=>d.length>0),originalQuery:l}}return{hasOperator:!1,operator:null,terms:[e],originalQuery:l}}function Yo(l,e){var o,n;if(l.hasOperator&&l.terms.length>1){const u=l.terms.filter(r=>r.trim().length>0);if(u.length>1)return{search_term:u[0],search_terms:u,operator:(o=l.operator)==null?void 0:o.toLowerCase(),skip:0,limit:50,role:e||null}}return{search_term:((n=l.terms[0])==null?void 0:n.trim())||"",search_terms:void 0,operator:void 0,skip:0,limit:50,role:e||null}}function Zo(l,e,t){const o=l.slice();return o[27]=e[t],o}function Xo(l,e,t){const o=l.slice();return o[30]=e[t],o[32]=t,o}function xo(l){let e,t=l[2],o=[];for(let n=0;n<t.length;n+=1)o[n]=en(Xo(l,t,n));return{c(){e=f("ul");for(let n=0;n<o.length;n+=1)o[n].c();a(e,"class","suggestions svelte-e76e8j")},m(n,u){L(n,e,u);for(let r=0;r<o.length;r+=1)o[r]&&o[r].m(e,null)},p(n,u){if(u[0]&1036){t=n[2];let r;for(r=0;r<t.length;r+=1){const c=Xo(n,t,r);o[r]?o[r].p(c,u):(o[r]=en(c),o[r].c(),o[r].m(e,null))}for(;r<o.length;r+=1)o[r].d(1);o.length=t.length}},d(n){n&&R(e),Ye(o,n)}}}function en(l){let e,t=l[30]+"",o,n,u,r,c,i;function d(){return l[14](l[30])}function p(...m){return l[15](l[30],...m)}return{c(){e=f("li"),o=F(t),n=g(),a(e,"tabindex","0"),a(e,"role","option"),a(e,"aria-selected",u=l[32]===l[3]),a(e,"aria-label",r=`Apply suggestion: ${l[30]}`),a(e,"class","svelte-e76e8j"),Ut(e,"active",l[32]===l[3])},m(m,_){L(m,e,_),s(e,o),s(e,n),c||(i=[Z(e,"click",d),Z(e,"keydown",p)],c=!0)},p(m,_){l=m,_[0]&4&&t!==(t=l[30]+"")&&_e(o,t),_[0]&8&&u!==(u=l[32]===l[3])&&a(e,"aria-selected",u),_[0]&4&&r!==(r=`Apply suggestion: ${l[30]}`)&&a(e,"aria-label",r),_[0]&8&&Ut(e,"active",l[32]===l[3])},d(m){m&&R(e),c=!1,Je(i)}}}function ci(l){let e,t,o,n,u,r,c,i,d,p,m,_,y,h,b,k,C,v,w,S,V,I,H;function P(W){l[13](W)}let J={type:"search",placeholder:l[7]?`Search over Knowledge graph for ${l[6]}`:"Search",icon:"search",expanded:!0,autofocus:!0};l[5]!==void 0&&(J.value=l[5]),o=new Jt({props:J}),Qe.push(()=>xe(o,"value",P)),o.$on("click",l[11]),o.$on("submit",l[11]),o.$on("keydown",l[9]),o.$on("input",l[8]);let K=l[2].length>0&&xo(l);return V=qn(l[17][0]),{c(){e=f("div"),t=f("div"),ae(o.$$.fragment),u=g(),K&&K.c(),r=g(),c=f("div"),i=f("div"),d=f("label"),p=f("input"),m=F(`
            Exact`),_=g(),y=f("label"),h=f("input"),b=F(`
            All (AND)`),k=g(),C=f("label"),v=f("input"),w=F(`
            Any (OR)`),a(t,"class","input-wrapper svelte-e76e8j"),a(p,"type","radio"),p.__value="none",p.value=p.__value,a(p,"class","svelte-e76e8j"),a(d,"class","radio svelte-e76e8j"),a(h,"type","radio"),h.__value="and",h.value=h.__value,a(h,"class","svelte-e76e8j"),a(y,"class","radio svelte-e76e8j"),a(v,"type","radio"),v.__value="or",v.value=v.__value,a(v,"class","svelte-e76e8j"),a(C,"class","radio svelte-e76e8j"),a(i,"class","control svelte-e76e8j"),a(c,"class","operator-controls svelte-e76e8j"),a(e,"class","search-row svelte-e76e8j"),V.p(p,h,v)},m(W,T){L(W,e,T),s(e,t),ue(o,t,null),s(t,u),K&&K.m(t,null),s(e,r),s(e,c),s(c,i),s(i,d),s(d,p),p.checked=p.__value===l[4],s(d,m),s(i,_),s(i,y),s(y,h),h.checked=h.__value===l[4],s(y,b),s(i,k),s(i,C),s(C,v),v.checked=v.__value===l[4],s(C,w),S=!0,I||(H=[Z(p,"change",l[16]),Z(h,"change",l[18]),Z(v,"change",l[19])],I=!0)},p(W,T){const A={};T[0]&192&&(A.placeholder=W[7]?`Search over Knowledge graph for ${W[6]}`:"Search"),!n&&T[0]&32&&(n=!0,A.value=W[5],et(()=>n=!1)),o.$set(A),W[2].length>0?K?K.p(W,T):(K=xo(W),K.c(),K.m(t,null)):K&&(K.d(1),K=null),T[0]&16&&(p.checked=p.__value===W[4]),T[0]&16&&(h.checked=h.__value===W[4]),T[0]&16&&(v.checked=v.__value===W[4])},i(W){S||(B(o.$$.fragment,W),S=!0)},o(W){Q(o.$$.fragment,W),S=!1},d(W){W&&R(e),ce(o),K&&K.d(),V.r(),I=!1,Je(H)}}}function fi(l){let e,t,o,n,u,r,c,i,d,p;return{c(){e=f("section"),t=f("div"),o=f("img"),u=g(),r=f("p"),r.textContent="I am Terraphim, your personal assistant.",c=g(),i=f("button"),i.innerHTML=`<span class="icon"><i class="fas fa-magic"></i></span> 
        <span>Configuration Wizard</span>`,_s(o.src,n=ai)||a(o,"src",n),a(o,"alt","Terraphim Logo"),a(o,"class","svelte-e76e8j"),a(i,"class","button is-primary"),a(i,"data-testid","wizard-start"),a(t,"class","content has-text-grey has-text-centered svelte-e76e8j"),a(e,"class","section")},m(m,_){L(m,e,_),s(e,t),s(t,o),s(t,u),s(t,r),s(t,c),s(t,i),d||(p=Z(i,"click",l[20]),d=!0)},p:ye,i:ye,o:ye,d(m){m&&R(e),d=!1,p()}}}function di(l){let e,t,o=l[0],n=[];for(let r=0;r<o.length;r+=1)n[r]=tn(Zo(l,o,r));const u=r=>Q(n[r],1,1,()=>{n[r]=null});return{c(){for(let r=0;r<n.length;r+=1)n[r].c();e=ut()},m(r,c){for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(r,c);L(r,e,c),t=!0},p(r,c){if(c[0]&1){o=r[0];let i;for(i=0;i<o.length;i+=1){const d=Zo(r,o,i);n[i]?(n[i].p(d,c),B(n[i],1)):(n[i]=tn(d),n[i].c(),B(n[i],1),n[i].m(e.parentNode,e))}for(Ke(),i=o.length;i<n.length;i+=1)u(i);Ge()}},i(r){if(!t){for(let c=0;c<o.length;c+=1)B(n[c]);t=!0}},o(r){n=n.filter(Boolean);for(let c=0;c<n.length;c+=1)Q(n[c]);t=!1},d(r){Ye(n,r),r&&R(e)}}}function pi(l){let e,t;return{c(){e=f("p"),t=F(l[1]),a(e,"class","error svelte-e76e8j")},m(o,n){L(o,e,n),s(e,t)},p(o,n){n[0]&2&&_e(t,o[1])},i:ye,o:ye,d(o){o&&R(e)}}}function tn(l){let e,t;return e=new ii({props:{document:l[27]}}),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},p(o,n){const u={};n[0]&1&&(u.document=o[27]),e.$set(u)},i(o){t||(B(e.$$.fragment,o),t=!0)},o(o){Q(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function mi(l){let e,t,o,n,u,r,c,i,d,p,m;e=new rl({props:{fallbackPath:"/"}}),n=new Ht({props:{$$slots:{default:[ci]},$$scope:{ctx:l}}});const _=[pi,di,fi],y=[];function h(b,k){return b[1]?0:b[0].length?1:2}return r=h(l),c=y[r]=_[r](l),{c(){ae(e.$$.fragment),t=g(),o=f("form"),ae(n.$$.fragment),u=g(),c.c(),i=ut()},m(b,k){ue(e,b,k),L(b,t,k),L(b,o,k),ue(n,o,null),L(b,u,k),y[r].m(b,k),L(b,i,k),d=!0,p||(m=Z(o,"submit",ms(l[11])),p=!0)},p(b,k){const C={};k[0]&252|k[1]&4&&(C.$$scope={dirty:k,ctx:b}),n.$set(C);let v=r;r=h(b),r===v?y[r].p(b,k):(Ke(),Q(y[v],1,1,()=>{y[v]=null}),Ge(),c=y[r],c?c.p(b,k):(c=y[r]=_[r](b),c.c()),B(c,1),c.m(i.parentNode,i))},i(b){d||(B(e.$$.fragment,b),B(n.$$.fragment,b),B(c),d=!0)},o(b){Q(e.$$.fragment,b),Q(n.$$.fragment,b),Q(c),d=!1},d(b){ce(e,b),b&&R(t),b&&R(o),ce(n),b&&R(u),y[r].d(b),b&&R(i),p=!1,m()}}}function _i(l,e,t){let o,n,u,r,c,i,d;Re(l,js,U=>t(22,n=U)),Re(l,Al,U=>t(5,u=U)),Re(l,je,U=>t(23,r=U)),Re(l,At,U=>t(6,c=U)),Re(l,fl,U=>t(12,i=U)),Re(l,$t,U=>t(7,d=U));let p=[],m=null,_=[],y=-1,h="none";async function b(U){try{if(r){const $=await He("get_autocomplete_suggestions",{query:U,roleName:c,limit:8});if($.status==="success"&&$.suggestions)return $.suggestions.map(z=>z.term)}else{const $=await fetch(`${n.replace("/documents/search","")}/autocomplete/${encodeURIComponent(c)}/${encodeURIComponent(U)}`);if($.ok){const z=await $.json();if(z.status==="success"&&z.suggestions)return z.suggestions.map(ee=>ee.term)}}return o.filter(([$])=>$.toLowerCase().includes(U.toLowerCase())).map(([$])=>$).slice(0,8)}catch($){return console.warn("Error fetching term suggestions:",$),[]}}async function k(U){const $=U.trim();if($.length===0)return[];if(h!=="none"){const O=$.split(/\s+/),E=O[O.length-1].toLowerCase();return E.length<2?[]:b(E)}const ee=$.split(/\s+/),q=ee[ee.length-1].toLowerCase();if(ee.length>1&&h==="none"){const O=[];if("and".startsWith(q)&&O.push("AND"),"or".startsWith(q)&&O.push("OR"),O.length>0)return O}const Y=$.toLowerCase();if(Y.includes(" and ")||Y.includes(" or ")){const O=q;return O.length<2?[]:b(O)}try{const O=await b($);return ee.length===1&&ee[0].length>2&&h==="none"?[...O.slice(0,6),"AND","OR"]:O}catch(O){console.warn("Error fetching autocomplete suggestions:",O);const E=o.filter(([N])=>N.toLowerCase().includes($.toLowerCase())).map(([N])=>N).slice(0,6);return ee.length===1&&ee[0].length>2&&h==="none"?[...E,"AND","OR"]:E}}async function C(U){const $=U.target;if(!$||$.selectionStart==null)return;const z=$.selectionStart,q=u.slice(0,z).split(/\s+/),Y=q[q.length-1];if(Y.length>=2)try{t(2,_=await k(Y))}catch(O){console.warn("Failed to get suggestions:",O),t(2,_=[])}else t(2,_=[]);t(3,y=-1)}function v(U){_.length!==0&&(U.key==="ArrowDown"?(U.preventDefault(),t(3,y=(y+1)%_.length)):U.key==="ArrowUp"?(U.preventDefault(),t(3,y=(y-1+_.length)%_.length)):(U.key==="Enter"||U.key==="Tab")&&y!==-1&&(U.preventDefault(),w(_[y])))}function w(U){var O,E;const $=document.querySelector('input[type="search"]'),z=($==null?void 0:$.selectionStart)??0,ee=u.slice(0,z),q=u.slice(z),Y=ee.split(/\s+/);if(U==="AND"||U==="OR"){Y[Y.length-1]=U,dl(Al,u=[...Y,"",q].join(" "),u);const N=z+U.length+1;(O=$==null?void 0:$.setSelectionRange)==null||O.call($,N,N)}else{Y[Y.length-1]=U,dl(Al,u=[...Y,q].join(" "),u);const N=z+U.length;(E=$==null?void 0:$.setSelectionRange)==null||E.call($,N,N)}t(2,_=[]),t(3,y=-1)}function S(){const U=u.trim();if(!U)return null;if(h!=="none"){const ee=U.split(/\s+/).filter(q=>q.length>0);return ee.length>1?{...Yo({hasOperator:!0,operator:h==="and"?"AND":"OR",terms:ee,originalQuery:U},c),skip:0,limit:10}:{search_term:U,skip:0,limit:10,role:c}}const $=ui(U);return{...Yo($,c),skip:0,limit:10}}async function V(){if(t(1,m=null),r){if(!u.trim())return;try{const U=S();if(!U)return;const $=await He("search",{searchQuery:U});$.status==="success"?(t(0,p=$.results),console.log("Response results"),console.log(p)):(t(1,m=`Search failed: ${$.status}`),console.error("Search failed:",$))}catch(U){t(1,m=`Error in Tauri search: ${U}`),console.error("Error in Tauri search:",U)}}else{if(!u.trim())return;const U=S();if(!U)return;const $=JSON.stringify(U);try{const z=await fetch(n,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:$}),ee=await z.json();if(!z.ok)throw new Error(`HTTP error! Status: ${z.status}`);t(0,p=ee.results)}catch(z){console.error("Error fetching data:",z),t(1,m=`Error fetching data: ${z}`)}}}const I=[[]];function H(U){u=U,Al.set(u)}const P=U=>w(U),J=(U,$)=>{($.key==="Enter"||$.key===" ")&&($.preventDefault(),w(U))};function K(){h=this.__value,t(4,h)}function W(){h=this.__value,t(4,h)}function T(){h=this.__value,t(4,h)}const A=()=>window.location.href="/config/wizard";return l.$$.update=()=>{l.$$.dirty[0]&4096&&(o=Object.entries(i))},[p,m,_,y,h,u,c,d,C,v,w,V,i,H,P,J,K,I,W,T,A]}class hi extends mt{constructor(e){super(),_t(this,e,_i,mi,at,{},null,[-1,-1])}}async function ln(l={}){return typeof l=="object"&&Object.freeze(l),zl({__tauriModule:"Dialog",message:{cmd:"openDialog",options:l}})}function on(l,e,t){const o=l.slice();return o[71]=e[t],o[79]=t,o}function nn(l,e,t){const o=l.slice();return o[77]=e[t],o[78]=e,o[79]=t,o}function sn(l,e,t){const o=l.slice();return o[80]=e[t],o}function rn(l,e,t){const o=l.slice();return o[80]=e[t],o}function an(l,e,t){const o=l.slice();return o[85]=e[t],o[86]=e,o[87]=t,o}function un(l,e,t){const o=l.slice();return o[88]=e[t][0],o[89]=e[t][1],o[90]=e,o[91]=t,o}function cn(l,e,t){const o=l.slice();return o[74]=e[t],o}function fn(l,e,t){const o=l.slice();return o[71]=e[t],o}function dn(l,e,t){const o=l.slice();return o[74]=e[t],o}function pn(l){let e,t,o,n,u;return{c(){e=f("div"),t=f("button"),o=F(`
      Configuration saved successfully!`),a(t,"class","delete"),a(e,"class","notification is-success"),a(e,"data-testid","wizard-success")},m(r,c){L(r,e,c),s(e,t),s(e,o),n||(u=Z(t,"click",l[20]),n=!0)},p:ye,d(r){r&&R(e),n=!1,u()}}}function mn(l){let e,t,o,n,u;return{c(){e=f("div"),t=f("button"),o=F(`
      Failed to save configuration. Please try again.`),a(t,"class","delete"),a(e,"class","notification is-danger"),a(e,"data-testid","wizard-error")},m(r,c){L(r,e,c),s(e,t),s(e,o),n||(u=Z(t,"click",l[21]),n=!0)},p:ye,d(r){r&&R(e),n=!1,u()}}}function gi(l){let e,t,o,n,u,r,c,i,d,p=l[3].id+"",m,_,y,h,b,k=l[3].global_shortcut+"",C,v,w,S,V,I=l[3].default_theme+"",H,P,J,K,W,T=l[3].default_role+"",A,U,$,z,ee,q,Y=JSON.stringify(l[3],null,2)+"",O,E=l[3].roles,N=[];for(let D=0;D<E.length;D+=1)N[D]=_n(on(l,E,D));return{c(){e=f("h4"),e.textContent="Review",t=g(),o=f("div"),n=f("h5"),n.textContent="Configuration Summary:",u=g(),r=f("ul"),c=f("li"),i=f("strong"),i.textContent="Configuration ID:",d=g(),m=F(p),_=g(),y=f("li"),h=f("strong"),h.textContent="Global Shortcut:",b=g(),C=F(k),v=g(),w=f("li"),S=f("strong"),S.textContent="Default Theme:",V=g(),H=F(I),P=g(),J=f("li"),K=f("strong"),K.textContent="Default Role:",W=g(),A=F(T),U=g(),$=f("h5"),$.textContent="Roles:",z=g();for(let D=0;D<N.length;D+=1)N[D].c();ee=g(),q=f("pre"),O=F(Y),a(e,"class","title is-5"),a(o,"class","content"),ie(q,"max-height","300px"),ie(q,"overflow","auto")},m(D,G){L(D,e,G),L(D,t,G),L(D,o,G),s(o,n),s(o,u),s(o,r),s(r,c),s(c,i),s(c,d),s(c,m),s(r,_),s(r,y),s(y,h),s(y,b),s(y,C),s(r,v),s(r,w),s(w,S),s(w,V),s(w,H),s(r,P),s(r,J),s(J,K),s(J,W),s(J,A),s(o,U),s(o,$),s(o,z);for(let X=0;X<N.length;X+=1)N[X]&&N[X].m(o,null);L(D,ee,G),L(D,q,G),s(q,O)},p(D,G){if(G[0]&8&&p!==(p=D[3].id+"")&&_e(m,p),G[0]&8&&k!==(k=D[3].global_shortcut+"")&&_e(C,k),G[0]&8&&I!==(I=D[3].default_theme+"")&&_e(H,I),G[0]&8&&T!==(T=D[3].default_role+"")&&_e(A,T),G[0]&10){E=D[3].roles;let X;for(X=0;X<E.length;X+=1){const oe=on(D,E,X);N[X]?N[X].p(oe,G):(N[X]=_n(oe),N[X].c(),N[X].m(o,null))}for(;X<N.length;X+=1)N[X].d(1);N.length=E.length}G[0]&8&&Y!==(Y=JSON.stringify(D[3],null,2)+"")&&_e(O,Y)},d(D){D&&R(e),D&&R(t),D&&R(o),Ye(N,D),D&&R(ee),D&&R(q)}}}function bi(l){let e,t,o=[],n=new Map,u,r,c,i,d=l[3].roles;const p=m=>m[77].name;for(let m=0;m<d.length;m+=1){let _=nn(l,d,m),y=p(_);n.set(y,o[m]=En(y,_))}return{c(){e=f("h4"),e.textContent="Roles",t=g();for(let m=0;m<o.length;m+=1)o[m].c();u=g(),r=f("button"),r.textContent="Add Role",a(e,"class","title is-5"),a(r,"class","button is-link is-light"),a(r,"data-testid","add-role")},m(m,_){L(m,e,_),L(m,t,_);for(let y=0;y<o.length;y+=1)o[y]&&o[y].m(m,_);L(m,u,_),L(m,r,_),c||(i=Z(r,"click",l[12]),c=!0)},p(m,_){_[0]&516985&&(d=m[3].roles,o=hs(o,_,p,1,m,d,n,u.parentNode,gs,En,u,nn))},d(m){m&&R(e),m&&R(t);for(let _=0;_<o.length;_+=1)o[_].d(m);m&&R(u),m&&R(r),c=!1,i()}}}function vi(l){let e,t,o,n,u,r,c,i,d,p,m,_,y,h,b,k,C,v,w,S,V,I,H,P,J,K,W,T,A,U,$,z=l[8],ee=[];for(let O=0;O<z.length;O+=1)ee[O]=Pn(dn(l,z,O));let q=l[3].roles,Y=[];for(let O=0;O<q.length;O+=1)Y[O]=On(fn(l,q,O));return{c(){e=f("div"),t=f("label"),t.textContent="Configuration ID",o=g(),n=f("div"),u=f("div"),r=f("select"),c=f("option"),c.textContent="Desktop",i=f("option"),i.textContent="Server",d=f("option"),d.textContent="Embedded",p=g(),m=f("div"),_=f("label"),_.textContent="Global shortcut",y=g(),h=f("div"),b=f("input"),k=g(),C=f("div"),v=f("label"),v.textContent="Default theme",w=g(),S=f("div"),V=f("div"),I=f("select");for(let O=0;O<ee.length;O+=1)ee[O].c();H=g(),P=f("div"),J=f("label"),J.textContent="Default Role",K=g(),W=f("div"),T=f("div"),A=f("select");for(let O=0;O<Y.length;O+=1)Y[O].c();a(t,"class","label"),a(t,"for","config-id"),c.__value="Desktop",c.value=c.__value,i.__value="Server",i.value=i.__value,d.__value="Embedded",d.value=d.__value,a(r,"id","config-id"),l[3].id===void 0&&it(()=>l[22].call(r)),a(u,"class","select"),a(n,"class","control"),a(e,"class","field"),a(_,"class","label"),a(_,"for","global-shortcut"),a(b,"class","input"),a(b,"id","global-shortcut"),a(b,"type","text"),a(h,"class","control"),a(m,"class","field"),a(v,"class","label"),a(v,"for","default-theme"),a(I,"id","default-theme"),l[3].default_theme===void 0&&it(()=>l[24].call(I)),a(V,"class","select is-fullwidth"),a(S,"class","control"),a(C,"class","field"),a(J,"class","label"),a(J,"for","default-role"),a(A,"id","default-role"),l[3].default_role===void 0&&it(()=>l[25].call(A)),a(T,"class","select"),a(W,"class","control"),a(P,"class","field")},m(O,E){L(O,e,E),s(e,t),s(e,o),s(e,n),s(n,u),s(u,r),s(r,c),s(r,i),s(r,d),Ie(r,l[3].id,!0),L(O,p,E),L(O,m,E),s(m,_),s(m,y),s(m,h),s(h,b),Ae(b,l[3].global_shortcut),L(O,k,E),L(O,C,E),s(C,v),s(C,w),s(C,S),s(S,V),s(V,I);for(let N=0;N<ee.length;N+=1)ee[N]&&ee[N].m(I,null);Ie(I,l[3].default_theme,!0),L(O,H,E),L(O,P,E),s(P,J),s(P,K),s(P,W),s(W,T),s(T,A);for(let N=0;N<Y.length;N+=1)Y[N]&&Y[N].m(A,null);Ie(A,l[3].default_role,!0),U||($=[Z(r,"change",l[22]),Z(b,"input",l[23]),Z(I,"change",l[24]),Z(A,"change",l[25])],U=!0)},p(O,E){if(E[0]&264&&Ie(r,O[3].id),E[0]&264&&b.value!==O[3].global_shortcut&&Ae(b,O[3].global_shortcut),E[0]&256){z=O[8];let N;for(N=0;N<z.length;N+=1){const D=dn(O,z,N);ee[N]?ee[N].p(D,E):(ee[N]=Pn(D),ee[N].c(),ee[N].m(I,null))}for(;N<ee.length;N+=1)ee[N].d(1);ee.length=z.length}if(E[0]&264&&Ie(I,O[3].default_theme),E[0]&8){q=O[3].roles;let N;for(N=0;N<q.length;N+=1){const D=fn(O,q,N);Y[N]?Y[N].p(D,E):(Y[N]=On(D),Y[N].c(),Y[N].m(A,null))}for(;N<Y.length;N+=1)Y[N].d(1);Y.length=q.length}E[0]&264&&Ie(A,O[3].default_role)},d(O){O&&R(e),O&&R(p),O&&R(m),O&&R(k),O&&R(C),Ye(ee,O),O&&R(H),O&&R(P),Ye(Y,O),U=!1,Je($)}}}function _n(l){let e,t,o=l[71].name+"",n,u,r,c,i,d=l[71].shortname+"",p,m,_,y,h,b=l[71].theme+"",k,C,v,w,S,V=l[71].relevance_function+"",I,H,P,J,K,W;return{c(){e=f("div"),t=f("h6"),n=F(o),u=g(),r=f("p"),c=f("strong"),c.textContent="Shortname:",i=g(),p=F(d),m=g(),_=f("p"),y=f("strong"),y.textContent="Theme:",h=g(),k=F(b),C=g(),v=f("p"),w=f("strong"),w.textContent="Relevance Function:",S=g(),I=F(V),H=g(),P=f("button"),P.textContent="Edit Role",J=g(),a(t,"data-testid","review-role-name-"+l[79]),a(P,"class","button is-small"),a(P,"data-testid","edit-role-"+l[79]),a(e,"class","box")},m(T,A){L(T,e,A),s(e,t),s(t,n),s(e,u),s(e,r),s(r,c),s(r,i),s(r,p),s(e,m),s(e,_),s(_,y),s(_,h),s(_,k),s(e,C),s(e,v),s(v,w),s(v,S),s(v,I),s(e,H),s(e,P),s(e,J),K||(W=Z(P,"click",l[68]),K=!0)},p(T,A){A[0]&8&&o!==(o=T[71].name+"")&&_e(n,o),A[0]&8&&d!==(d=T[71].shortname+"")&&_e(p,d),A[0]&8&&b!==(b=T[71].theme+"")&&_e(k,b),A[0]&8&&V!==(V=T[71].relevance_function+"")&&_e(I,V)},d(T){T&&R(e),K=!1,W()}}}function hn(l){let e,t=l[74]+"",o;return{c(){e=f("option"),o=F(t),e.__value=l[74],e.value=e.__value},m(n,u){L(n,e,u),s(e,o)},p:ye,d(n){n&&R(e)}}}function ki(l){let e;return{c(){e=F("Directory Path")},m(t,o){L(t,e,o)},d(t){t&&R(e)}}}function wi(l){let e;return{c(){e=F("Server URL")},m(t,o){L(t,e,o)},d(t){t&&R(e)}}}function gn(l){let e;return{c(){e=f("p"),e.textContent="Click to select directory",a(e,"class","help")},m(t,o){L(t,e,o)},d(t){t&&R(e)}}}function bn(l){let e,t,o,n,u,r,c,i,d,p,m,_;function y(){l[34].call(c,l[79],l[87])}return{c(){e=f("div"),t=f("label"),o=F("Atomic Server Secret"),u=g(),r=f("div"),c=f("input"),d=g(),p=f("p"),p.textContent="Leave empty for anonymous access",a(t,"class","label"),a(t,"for",n=`haystack-secret-${l[79]}-${l[87]}`),a(c,"class","input"),a(c,"id",i=`haystack-secret-${l[79]}-${l[87]}`),a(c,"type","password"),a(c,"placeholder","Base64 encoded secret (optional)"),a(r,"class","control"),a(p,"class","help"),a(e,"class","field")},m(h,b){L(h,e,b),s(e,t),s(t,o),s(e,u),s(e,r),s(r,c),Ae(c,l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret),s(e,d),s(e,p),m||(_=Z(c,"input",y),m=!0)},p(h,b){l=h,b[0]&264&&n!==(n=`haystack-secret-${l[79]}-${l[87]}`)&&a(t,"for",n),b[0]&264&&i!==(i=`haystack-secret-${l[79]}-${l[87]}`)&&a(c,"id",i),b[0]&264&&c.value!==l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret&&Ae(c,l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret)},d(h){h&&R(e),m=!1,_()}}}function vn(l){let e,t,o,n,u,r,c,i,d,p,m,_,y,h,b,k,C,v,w,S,V,I,H,P,J,K,W,T,A,U,$,z,ee,q,Y,O,E,N,D,G,X,oe,pe;function me(){l[35].call(p,l[79],l[87])}function Le(...se){return l[36](l[79],l[87],...se)}let ge=Object.entries(l[3].roles[l[79]].haystacks[l[87]].extra_parameters||{}),fe=[];for(let se=0;se<ge.length;se+=1)fe[se]=kn(un(l,ge,se));function ne(){return l[40](l[79],l[87])}function Se(){return l[41](l[79],l[87])}function Te(){return l[42](l[79],l[87])}return{c(){e=f("div"),t=f("label"),t.textContent="Extra Parameters (for filtering)",o=g(),n=f("div"),u=f("div"),r=f("label"),c=F("Hashtag"),d=g(),p=f("input"),_=g(),y=f("div"),h=f("div"),b=f("label"),k=F("Presets"),v=g(),w=f("div"),S=f("select"),V=f("option"),V.textContent="(choose)",I=f("option"),I.textContent="#rust",H=f("option"),H.textContent="#docs",P=f("option"),P.textContent="#test",J=f("option"),J.textContent="#todo",W=g(),T=f("p"),T.innerHTML="When set, searches will enforce the hashtag alongside your query (AND), e.g. <code>-e &quot;search&quot; -e &quot;#rust&quot;</code>.",A=g();for(let se=0;se<fe.length;se+=1)fe[se].c();U=g(),$=f("div"),z=f("div"),ee=f("button"),ee.textContent="+ Tag Filter",q=g(),Y=f("div"),O=f("button"),O.textContent="+ Max Results",E=g(),N=f("div"),D=f("button"),D.textContent="+ Custom Parameter",G=g(),X=f("p"),X.innerHTML=`Common parameters: <code>tag</code> (e.g., &quot;#rust&quot;), <code>glob</code> (e.g., &quot;*.md&quot;),
                  <code>max_count</code> (e.g., &quot;10&quot;), <code>context</code> (e.g., &quot;5&quot;)`,a(t,"class","label"),a(r,"class","label"),a(r,"for",i=`ripgrep-hashtag-${l[79]}-${l[87]}`),a(p,"class","input"),a(p,"id",m=`ripgrep-hashtag-${l[79]}-${l[87]}`),a(p,"type","text"),a(p,"placeholder","#rust"),a(u,"class","control"),a(n,"class","field is-grouped"),a(b,"class","label"),a(b,"for",C=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`),V.__value="",V.value=V.__value,I.__value="#rust",I.value=I.__value,H.__value="#docs",H.value=H.__value,P.__value="#test",P.value=P.__value,J.__value="#todo",J.value=J.__value,a(S,"id",K=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`),a(w,"class","select is-small"),a(h,"class","control"),a(y,"class","field is-grouped"),ie(y,"margin-bottom",".5rem"),a(T,"class","help"),a(ee,"class","button is-small is-link is-light"),a(z,"class","control"),a(O,"class","button is-small is-link is-light"),a(Y,"class","control"),a(D,"class","button is-small is-link is-light"),a(N,"class","control"),a($,"class","field is-grouped"),a(X,"class","help"),a(e,"class","field")},m(se,be){L(se,e,be),s(e,t),s(e,o),s(e,n),s(n,u),s(u,r),s(r,c),s(u,d),s(u,p),Ae(p,l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag),s(e,_),s(e,y),s(y,h),s(h,b),s(b,k),s(h,v),s(h,w),s(w,S),s(S,V),s(S,I),s(S,H),s(S,P),s(S,J),s(e,W),s(e,T),s(e,A);for(let re=0;re<fe.length;re+=1)fe[re]&&fe[re].m(e,null);s(e,U),s(e,$),s($,z),s(z,ee),s($,q),s($,Y),s(Y,O),s($,E),s($,N),s(N,D),s(e,G),s(e,X),oe||(pe=[Z(p,"input",me),Z(S,"change",Le),Z(ee,"click",ne),Z(O,"click",Se),Z(D,"click",Te)],oe=!0)},p(se,be){if(l=se,be[0]&264&&i!==(i=`ripgrep-hashtag-${l[79]}-${l[87]}`)&&a(r,"for",i),be[0]&264&&m!==(m=`ripgrep-hashtag-${l[79]}-${l[87]}`)&&a(p,"id",m),be[0]&264&&p.value!==l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag&&Ae(p,l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag),be[0]&264&&C!==(C=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`)&&a(b,"for",C),be[0]&264&&K!==(K=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`)&&a(S,"id",K),be[0]&393224){ge=Object.entries(l[3].roles[l[79]].haystacks[l[87]].extra_parameters||{});let re;for(re=0;re<ge.length;re+=1){const ke=un(l,ge,re);fe[re]?fe[re].p(ke,be):(fe[re]=kn(ke),fe[re].c(),fe[re].m(e,U))}for(;re<fe.length;re+=1)fe[re].d(1);fe.length=ge.length}},d(se){se&&R(e),Ye(fe,se),oe=!1,Je(pe)}}}function kn(l){let e,t,o,n,u,r,c,i,d,p,m,_,y;function h(...C){return l[37](l[79],l[87],l[88],...C)}function b(){l[38].call(c,l[79],l[87],l[88])}function k(){return l[39](l[79],l[87],l[88])}return{c(){e=f("div"),t=f("div"),o=f("input"),u=g(),r=f("div"),c=f("input"),i=g(),d=f("div"),p=f("button"),p.textContent="×",m=g(),a(o,"class","input"),a(o,"type","text"),a(o,"placeholder","Parameter name"),o.value=n=l[88],a(t,"class","control"),a(c,"class","input"),a(c,"type","text"),a(c,"placeholder","Parameter value"),a(r,"class","control is-expanded"),a(p,"class","button is-small is-danger"),a(d,"class","control"),a(e,"class","field is-grouped")},m(C,v){L(C,e,v),s(e,t),s(t,o),s(e,u),s(e,r),s(r,c),Ae(c,l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]]),s(e,i),s(e,d),s(d,p),s(e,m),_||(y=[Z(o,"blur",h),Z(c,"input",b),Z(p,"click",k)],_=!0)},p(C,v){l=C,v[0]&264&&n!==(n=l[88])&&o.value!==n&&(o.value=n),v[0]&264&&c.value!==l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]]&&Ae(c,l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]])},d(C){C&&R(e),_=!1,Je(y)}}}function wn(l){let e,t,o,n,u,r,c,i,d,p,m,_,y,h,b,k,C,v,w,S,V,I,H,P,J,K,W,T,A,U,$,z,ee,q,Y,O,E,N,D;function G(){l[31].call(d,l[79],l[87])}function X(se,be){return se[3].roles[se[79]].haystacks[se[87]].service==="Atomic"?wi:ki}let oe=X(l),pe=oe(l);function me(){l[32].call(w,l[79],l[87])}function Le(){return l[33](l[79],l[87])}let ge=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"&&gn(),fe=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"&&bn(l),ne=l[3].roles[l[79]].haystacks[l[87]].service==="Ripgrep"&&vn(l);function Se(){l[43].call(A,l[79],l[87])}function Te(){return l[44](l[79],l[87])}return{c(){e=f("div"),t=f("div"),o=f("label"),n=F("Service Type"),r=g(),c=f("div"),i=f("div"),d=f("select"),p=f("option"),p.textContent="Ripgrep (File Search)",m=f("option"),m.textContent="Atomic Server",y=g(),h=f("div"),b=f("label"),pe.c(),C=g(),v=f("div"),w=f("input"),H=g(),ge&&ge.c(),P=g(),fe&&fe.c(),J=g(),ne&&ne.c(),K=g(),W=f("div"),T=f("label"),A=f("input"),$=F(`
                 Read-only`),ee=g(),q=f("div"),Y=f("button"),O=F("Remove Haystack"),a(o,"class","label"),a(o,"for",u=`haystack-service-${l[79]}-${l[87]}`),p.__value="Ripgrep",p.value=p.__value,m.__value="Atomic",m.value=m.__value,a(d,"id",_=`haystack-service-${l[79]}-${l[87]}`),l[3].roles[l[79]].haystacks[l[87]].service===void 0&&it(G),a(i,"class","select"),a(c,"class","control"),a(t,"class","field"),a(b,"class","label"),a(b,"for",k=`haystack-path-${l[79]}-${l[87]}`),a(w,"class","input"),a(w,"id",S=`haystack-path-${l[79]}-${l[87]}`),a(w,"type","text"),a(w,"placeholder",V=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?"https://localhost:9883":"/path/to/documents"),w.readOnly=I=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic",a(v,"class","control"),a(h,"class","field"),a(A,"id",U=`haystack-readonly-${l[79]}-${l[87]}`),a(A,"type","checkbox"),a(T,"class","checkbox"),a(T,"for",z=`haystack-readonly-${l[79]}-${l[87]}`),a(W,"class","field"),a(Y,"class","button is-small is-danger"),a(Y,"data-testid",E="remove-haystack-"+l[79]+"-"+l[87]),a(q,"class","field"),a(e,"class","box is-light")},m(se,be){L(se,e,be),s(e,t),s(t,o),s(o,n),s(t,r),s(t,c),s(c,i),s(i,d),s(d,p),s(d,m),Ie(d,l[3].roles[l[79]].haystacks[l[87]].service,!0),s(e,y),s(e,h),s(h,b),pe.m(b,null),s(h,C),s(h,v),s(v,w),Ae(w,l[3].roles[l[79]].haystacks[l[87]].path),s(v,H),ge&&ge.m(v,null),s(e,P),fe&&fe.m(e,null),s(e,J),ne&&ne.m(e,null),s(e,K),s(e,W),s(W,T),s(T,A),A.checked=l[3].roles[l[79]].haystacks[l[87]].read_only,s(T,$),s(e,ee),s(e,q),s(q,Y),s(Y,O),N||(D=[Z(d,"change",G),Z(w,"input",me),Z(w,"click",function(){jl(l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?Le:void 0)&&(l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?Le:void 0).apply(this,arguments)}),Z(A,"change",Se),Z(Y,"click",Te)],N=!0)},p(se,be){l=se,be[0]&264&&u!==(u=`haystack-service-${l[79]}-${l[87]}`)&&a(o,"for",u),be[0]&264&&_!==(_=`haystack-service-${l[79]}-${l[87]}`)&&a(d,"id",_),be[0]&264&&Ie(d,l[3].roles[l[79]].haystacks[l[87]].service),oe!==(oe=X(l))&&(pe.d(1),pe=oe(l),pe&&(pe.c(),pe.m(b,null))),be[0]&264&&k!==(k=`haystack-path-${l[79]}-${l[87]}`)&&a(b,"for",k),be[0]&264&&S!==(S=`haystack-path-${l[79]}-${l[87]}`)&&a(w,"id",S),be[0]&264&&V!==(V=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?"https://localhost:9883":"/path/to/documents")&&a(w,"placeholder",V),be[0]&280&&I!==(I=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic")&&(w.readOnly=I),be[0]&264&&w.value!==l[3].roles[l[79]].haystacks[l[87]].path&&Ae(w,l[3].roles[l[79]].haystacks[l[87]].path),l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?ge||(ge=gn(),ge.c(),ge.m(v,null)):ge&&(ge.d(1),ge=null),l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?fe?fe.p(l,be):(fe=bn(l),fe.c(),fe.m(e,J)):fe&&(fe.d(1),fe=null),l[3].roles[l[79]].haystacks[l[87]].service==="Ripgrep"?ne?ne.p(l,be):(ne=vn(l),ne.c(),ne.m(e,K)):ne&&(ne.d(1),ne=null),be[0]&264&&U!==(U=`haystack-readonly-${l[79]}-${l[87]}`)&&a(A,"id",U),be[0]&264&&(A.checked=l[3].roles[l[79]].haystacks[l[87]].read_only),be[0]&264&&z!==(z=`haystack-readonly-${l[79]}-${l[87]}`)&&a(T,"for",z),be[0]&264&&E!==(E="remove-haystack-"+l[79]+"-"+l[87])&&a(Y,"data-testid",E)},d(se){se&&R(e),pe.d(),ge&&ge.d(),fe&&fe.d(),ne&&ne.d(),N=!1,Je(D)}}}function yn(l){var Y;let e,t,o,n,u,r,c,i,d,p,m,_,y,h,b,k,C,v,w,S,V,I,H,P,J,K,W,T,A;function U(){l[47].call(c,l[79])}function $(){return l[48](l[79])}let z=((Y=l[0][l[79]])==null?void 0:Y.length)&&$n(l);function ee(){l[50].call(w,l[79])}function q(){l[51].call(P,l[79])}return{c(){e=f("div"),t=f("label"),o=F("Model"),u=g(),r=f("div"),c=f("input"),d=g(),p=f("button"),p.textContent="Fetch models",m=g(),z&&z.c(),_=g(),y=f("div"),h=f("label"),b=F("Base URL"),C=g(),v=f("div"),w=f("input"),V=g(),I=f("div"),H=f("label"),P=f("input"),K=F(`
               Automatically summarize search results`),a(t,"class","label"),a(t,"for",n=`llm-model-${l[79]}`),a(c,"class","input"),a(c,"id",i=`llm-model-${l[79]}`),a(c,"type","text"),a(c,"placeholder","llama3.1"),a(r,"class","control"),a(p,"class","button is-small"),a(e,"class","field"),a(h,"class","label"),a(h,"for",k=`llm-base-url-${l[79]}`),a(w,"class","input"),a(w,"id",S=`llm-base-url-${l[79]}`),a(w,"type","text"),a(w,"placeholder","http://127.0.0.1:11434"),a(v,"class","control"),a(y,"class","field"),a(P,"id",J=`llm-auto-summarize-${l[79]}`),a(P,"type","checkbox"),a(H,"class","checkbox"),a(H,"for",W=`llm-auto-summarize-${l[79]}`),a(I,"class","field")},m(O,E){L(O,e,E),s(e,t),s(t,o),s(e,u),s(e,r),s(r,c),Ae(c,l[3].roles[l[79]].llm_model),s(e,d),s(e,p),s(e,m),z&&z.m(e,null),L(O,_,E),L(O,y,E),s(y,h),s(h,b),s(y,C),s(y,v),s(v,w),Ae(w,l[3].roles[l[79]].llm_base_url),L(O,V,E),L(O,I,E),s(I,H),s(H,P),P.checked=l[3].roles[l[79]].llm_auto_summarize,s(H,K),T||(A=[Z(c,"input",U),Z(p,"click",$),Z(w,"input",ee),Z(P,"change",q)],T=!0)},p(O,E){var N;l=O,E[0]&264&&n!==(n=`llm-model-${l[79]}`)&&a(t,"for",n),E[0]&264&&i!==(i=`llm-model-${l[79]}`)&&a(c,"id",i),E[0]&264&&c.value!==l[3].roles[l[79]].llm_model&&Ae(c,l[3].roles[l[79]].llm_model),(N=l[0][l[79]])!=null&&N.length?z?z.p(l,E):(z=$n(l),z.c(),z.m(e,null)):z&&(z.d(1),z=null),E[0]&264&&k!==(k=`llm-base-url-${l[79]}`)&&a(h,"for",k),E[0]&264&&S!==(S=`llm-base-url-${l[79]}`)&&a(w,"id",S),E[0]&264&&w.value!==l[3].roles[l[79]].llm_base_url&&Ae(w,l[3].roles[l[79]].llm_base_url),E[0]&264&&J!==(J=`llm-auto-summarize-${l[79]}`)&&a(P,"id",J),E[0]&264&&(P.checked=l[3].roles[l[79]].llm_auto_summarize),E[0]&264&&W!==(W=`llm-auto-summarize-${l[79]}`)&&a(H,"for",W)},d(O){O&&R(e),z&&z.d(),O&&R(_),O&&R(y),O&&R(V),O&&R(I),T=!1,Je(A)}}}function $n(l){let e,t,o,n,u=l[0][l[79]],r=[];for(let i=0;i<u.length;i+=1)r[i]=Cn(rn(l,u,i));function c(...i){return l[49](l[79],...i)}return{c(){e=f("div"),t=f("select");for(let i=0;i<r.length;i+=1)r[i].c();a(e,"class","select is-fullwidth"),ie(e,"margin-top","0.5rem")},m(i,d){L(i,e,d),s(e,t);for(let p=0;p<r.length;p+=1)r[p]&&r[p].m(t,null);o||(n=Z(t,"change",c),o=!0)},p(i,d){if(l=i,d[0]&9){u=l[0][l[79]];let p;for(p=0;p<u.length;p+=1){const m=rn(l,u,p);r[p]?r[p].p(m,d):(r[p]=Cn(m),r[p].c(),r[p].m(t,null))}for(;p<r.length;p+=1)r[p].d(1);r.length=u.length}},d(i){i&&R(e),Ye(r,i),o=!1,n()}}}function Cn(l){let e,t=l[80]+"",o,n;return{c(){e=f("option"),o=F(t),e.__value=n=l[80],e.value=e.__value},m(u,r){L(u,e,r),s(e,o)},p(u,r){r[0]&9&&t!==(t=u[80]+"")&&_e(o,t),r[0]&265&&n!==(n=u[80])&&(e.__value=n,e.value=e.__value)},d(u){u&&R(e)}}}function Sn(l){var be;let e,t,o,n,u,r,c,i,d,p,m,_,y,h,b,k,C,v,w,S,V,I,H,P,J,K,W,T,A,U,$,z,ee,q,Y,O,E,N,D,G,X,oe,pe,me;function Le(){l[53].call(c,l[79])}function ge(){l[54].call(v,l[79])}function fe(){return l[55](l[79])}let ne=((be=l[0][l[79]])==null?void 0:be.length)&&Tn(l);function Se(){l[57].call(T,l[79])}function Te(){l[58].call(E,l[79])}let se=l[3].roles[l[79]].openrouter_chat_enabled&&An(l);return{c(){e=f("div"),t=f("label"),o=F("OpenRouter API Key"),u=g(),r=f("div"),c=f("input"),d=g(),p=f("p"),p.innerHTML='Get your API key from <a href="https://openrouter.ai" target="_blank" rel="noopener">OpenRouter</a>',m=g(),_=f("div"),y=f("label"),h=F("Model"),k=g(),C=f("div"),v=f("input"),S=g(),V=f("button"),V.textContent="Fetch models",I=g(),ne&&ne.c(),H=g(),P=f("p"),P.textContent="Choose the language model for generating summaries. Different models offer different speed/quality tradeoffs.",J=g(),K=f("div"),W=f("label"),T=f("input"),U=F(`
               Automatically summarize search results`),z=g(),ee=f("p"),ee.textContent="When enabled, summaries will be generated and shown in search results.",q=g(),Y=f("div"),O=f("label"),E=f("input"),D=F(`
               Enable Chat interface (OpenRouter)`),X=g(),se&&se.c(),oe=ut(),a(t,"class","label"),a(t,"for",n=`openrouter-api-key-${l[79]}`),a(c,"class","input"),a(c,"id",i=`openrouter-api-key-${l[79]}`),a(c,"type","password"),a(c,"placeholder","sk-or-v1-..."),a(r,"class","control"),a(p,"class","help"),a(e,"class","field"),a(y,"class","label"),a(y,"for",b=`openrouter-model-${l[79]}`),a(v,"class","input"),a(v,"id",w=`openrouter-model-${l[79]}`),a(v,"type","text"),a(v,"placeholder","openai/gpt-4-turbo"),a(C,"class","control"),a(V,"class","button is-small"),a(P,"class","help"),a(_,"class","field"),a(T,"id",A=`openrouter-auto-summarize-${l[79]}`),a(T,"type","checkbox"),a(W,"class","checkbox"),a(W,"for",$=`openrouter-auto-summarize-${l[79]}`),a(ee,"class","help"),a(K,"class","field"),a(E,"id",N=`openrouter-chat-enabled-${l[79]}`),a(E,"type","checkbox"),a(O,"class","checkbox"),a(O,"for",G=`openrouter-chat-enabled-${l[79]}`),a(Y,"class","field")},m(re,ke){L(re,e,ke),s(e,t),s(t,o),s(e,u),s(e,r),s(r,c),Ae(c,l[3].roles[l[79]].openrouter_api_key),s(e,d),s(e,p),L(re,m,ke),L(re,_,ke),s(_,y),s(y,h),s(_,k),s(_,C),s(C,v),Ae(v,l[3].roles[l[79]].openrouter_model),s(_,S),s(_,V),s(_,I),ne&&ne.m(_,null),s(_,H),s(_,P),L(re,J,ke),L(re,K,ke),s(K,W),s(W,T),T.checked=l[3].roles[l[79]].openrouter_auto_summarize,s(W,U),s(K,z),s(K,ee),L(re,q,ke),L(re,Y,ke),s(Y,O),s(O,E),E.checked=l[3].roles[l[79]].openrouter_chat_enabled,s(O,D),L(re,X,ke),se&&se.m(re,ke),L(re,oe,ke),pe||(me=[Z(c,"input",Le),Z(v,"input",ge),Z(V,"click",fe),Z(T,"change",Se),Z(E,"change",Te)],pe=!0)},p(re,ke){var Be;l=re,ke[0]&264&&n!==(n=`openrouter-api-key-${l[79]}`)&&a(t,"for",n),ke[0]&264&&i!==(i=`openrouter-api-key-${l[79]}`)&&a(c,"id",i),ke[0]&264&&c.value!==l[3].roles[l[79]].openrouter_api_key&&Ae(c,l[3].roles[l[79]].openrouter_api_key),ke[0]&264&&b!==(b=`openrouter-model-${l[79]}`)&&a(y,"for",b),ke[0]&264&&w!==(w=`openrouter-model-${l[79]}`)&&a(v,"id",w),ke[0]&264&&v.value!==l[3].roles[l[79]].openrouter_model&&Ae(v,l[3].roles[l[79]].openrouter_model),(Be=l[0][l[79]])!=null&&Be.length?ne?ne.p(l,ke):(ne=Tn(l),ne.c(),ne.m(_,H)):ne&&(ne.d(1),ne=null),ke[0]&264&&A!==(A=`openrouter-auto-summarize-${l[79]}`)&&a(T,"id",A),ke[0]&264&&(T.checked=l[3].roles[l[79]].openrouter_auto_summarize),ke[0]&264&&$!==($=`openrouter-auto-summarize-${l[79]}`)&&a(W,"for",$),ke[0]&264&&N!==(N=`openrouter-chat-enabled-${l[79]}`)&&a(E,"id",N),ke[0]&264&&(E.checked=l[3].roles[l[79]].openrouter_chat_enabled),ke[0]&264&&G!==(G=`openrouter-chat-enabled-${l[79]}`)&&a(O,"for",G),l[3].roles[l[79]].openrouter_chat_enabled?se?se.p(l,ke):(se=An(l),se.c(),se.m(oe.parentNode,oe)):se&&(se.d(1),se=null)},d(re){re&&R(e),re&&R(m),re&&R(_),ne&&ne.d(),re&&R(J),re&&R(K),re&&R(q),re&&R(Y),re&&R(X),se&&se.d(re),re&&R(oe),pe=!1,Je(me)}}}function Tn(l){let e,t,o,n,u=l[0][l[79]],r=[];for(let i=0;i<u.length;i+=1)r[i]=Rn(sn(l,u,i));function c(...i){return l[56](l[79],...i)}return{c(){e=f("div"),t=f("select");for(let i=0;i<r.length;i+=1)r[i].c();a(e,"class","select is-fullwidth"),ie(e,"margin-top","0.5rem")},m(i,d){L(i,e,d),s(e,t);for(let p=0;p<r.length;p+=1)r[p]&&r[p].m(t,null);o||(n=Z(t,"change",c),o=!0)},p(i,d){if(l=i,d[0]&9){u=l[0][l[79]];let p;for(p=0;p<u.length;p+=1){const m=sn(l,u,p);r[p]?r[p].p(m,d):(r[p]=Rn(m),r[p].c(),r[p].m(t,null))}for(;p<r.length;p+=1)r[p].d(1);r.length=u.length}},d(i){i&&R(e),Ye(r,i),o=!1,n()}}}function Rn(l){let e,t=l[80]+"",o,n;return{c(){e=f("option"),o=F(t),e.__value=n=l[80],e.value=e.__value},m(u,r){L(u,e,r),s(e,o)},p(u,r){r[0]&9&&t!==(t=u[80]+"")&&_e(o,t),r[0]&265&&n!==(n=u[80])&&(e.__value=n,e.value=e.__value)},d(u){u&&R(e)}}}function An(l){let e,t,o,n,u,r,c,i,d,p,m,_,y,h,b,k,C,v,w,S,V,I,H,P,J;function K(){l[59].call(i,l[79])}function W(){l[60].call(I,l[79])}return{c(){e=f("div"),t=f("label"),o=F("Chat Model"),u=g(),r=f("div"),c=f("div"),i=f("select"),d=f("option"),d.textContent="GPT-3.5 Turbo",p=f("option"),p.textContent="GPT-4",m=f("option"),m.textContent="Claude 3 Sonnet",_=f("option"),_.textContent="Claude 3 Haiku",y=f("option"),y.textContent="Mixtral 8x7B",b=g(),k=f("div"),C=f("label"),v=F("System Prompt (optional)"),S=g(),V=f("div"),I=f("textarea"),a(t,"class","label"),a(t,"for",n=`openrouter-chat-model-${l[79]}`),d.__value="openai/gpt-3.5-turbo",d.value=d.__value,p.__value="openai/gpt-4",p.value=p.__value,m.__value="anthropic/claude-3-sonnet",m.value=m.__value,_.__value="anthropic/claude-3-haiku",_.value=_.__value,y.__value="mistralai/mixtral-8x7b-instruct",y.value=y.__value,a(i,"id",h=`openrouter-chat-model-${l[79]}`),l[3].roles[l[79]].openrouter_chat_model===void 0&&it(K),a(c,"class","select is-fullwidth"),a(r,"class","control"),a(e,"class","field"),a(C,"class","label"),a(C,"for",w=`openrouter-chat-system-${l[79]}`),a(I,"class","textarea"),a(I,"id",H=`openrouter-chat-system-${l[79]}`),a(I,"rows","3"),a(I,"placeholder","You are a helpful Rust engineer assistant..."),a(V,"class","control"),a(k,"class","field")},m(T,A){L(T,e,A),s(e,t),s(t,o),s(e,u),s(e,r),s(r,c),s(c,i),s(i,d),s(i,p),s(i,m),s(i,_),s(i,y),Ie(i,l[3].roles[l[79]].openrouter_chat_model,!0),L(T,b,A),L(T,k,A),s(k,C),s(C,v),s(k,S),s(k,V),s(V,I),Ae(I,l[3].roles[l[79]].openrouter_chat_system_prompt),P||(J=[Z(i,"change",K),Z(I,"input",W)],P=!0)},p(T,A){l=T,A[0]&264&&n!==(n=`openrouter-chat-model-${l[79]}`)&&a(t,"for",n),A[0]&264&&h!==(h=`openrouter-chat-model-${l[79]}`)&&a(i,"id",h),A[0]&264&&Ie(i,l[3].roles[l[79]].openrouter_chat_model),A[0]&264&&w!==(w=`openrouter-chat-system-${l[79]}`)&&a(C,"for",w),A[0]&264&&H!==(H=`openrouter-chat-system-${l[79]}`)&&a(I,"id",H),A[0]&264&&Ae(I,l[3].roles[l[79]].openrouter_chat_system_prompt)},d(T){T&&R(e),T&&R(b),T&&R(k),P=!1,Je(J)}}}function Ln(l){let e;return{c(){e=f("p"),e.textContent="Click to select directory",a(e,"class","help")},m(t,o){L(t,e,o)},d(t){t&&R(e)}}}function En(l,e){let t,o,n,u,r,c,i,d,p,m,_,y,h,b,k,C,v,w,S,V,I,H,P,J,K,W,T,A,U,$,z,ee,q,Y,O,E,N,D,G,X,oe,pe,me,Le,ge,fe,ne,Se,Te,se,be,re,ke,Be,Ce,Oe,le,we,De,Xe,ze,Ne,ht,Fe,St,tt,gt,Ve,lt,ct,Ee,Tt,M,x,j,te,he,de,Me,qe,Pe,We,bt,ft,il,zt,al,Vt,Ft,ul,Dt,vt,Fl,ml,Wl,_l,yt,hl,Kl,Qt,Yt,Gl,gl,Bl,Wt,ot,bl,ql,Jl,vl,Zt,Xt,Vl,kl,Ql,wl,Et,xt,el,yl,Yl,tl,jt,It,$l,Zl,Cl,Xl,Kt,Mt,Sl,xl,Tl,eo,to,lo,Gt,oo,Rl,Nl,no;function xn(){e[26].call(d,e[79])}function es(){e[27].call(v,e[79])}let ll=e[8],nt=[];for(let Ue=0;Ue<ll.length;Ue+=1)nt[Ue]=hn(cn(e,ll,Ue));function so(){e[28].call(T,e[79])}function ro(){e[29].call(N,e[79])}function ts(){e[30].call(ne,e[79])}let ol=e[77].haystacks,st=[];for(let Ue=0;Ue<ol.length;Ue+=1)st[Ue]=wn(an(e,ol,Ue));function ls(){return e[45](e[79])}function io(){e[46].call(Ve,e[79])}let dt=e[3].roles[e[79]].llm_provider==="ollama"&&yn(e);function os(){e[52].call(Pe,e[79])}let pt=e[3].roles[e[79]].openrouter_enabled&&Sn(e);function ns(){e[61].call(yt,e[79])}function ss(){e[62].call(ot,e[79])}function ao(){return e[63](e[79])}let kt=e[4]&&Ln();function uo(){e[64].call(Et,e[79])}function rs(){e[65].call(It,e[79])}function is(){e[66].call(Mt,e[79])}function as(){return e[67](e[79])}return{key:l,first:null,c(){t=f("div"),o=f("div"),n=f("label"),u=F("Role name"),c=g(),i=f("div"),d=f("input"),m=g(),_=f("div"),y=f("label"),h=F("Short name"),k=g(),C=f("div"),v=f("input"),S=g(),V=f("div"),I=f("label"),H=F("Theme"),J=g(),K=f("div"),W=f("div"),T=f("select");for(let Ue=0;Ue<nt.length;Ue+=1)nt[Ue].c();U=g(),$=f("div"),z=f("label"),ee=F("Relevance function"),Y=g(),O=f("div"),E=f("div"),N=f("select"),D=f("option"),D.textContent="title-scorer",G=f("option"),G.textContent="terraphim-graph",X=f("option"),X.textContent="bm25",oe=f("option"),oe.textContent="bm25f",pe=f("option"),pe.textContent="bm25plus",Le=g(),ge=f("div"),fe=f("label"),ne=f("input"),Te=F(`
            Enable Terraphim IT features (KG preprocessing, auto-linking)`),be=g(),re=f("h5"),re.textContent="Haystacks",ke=g();for(let Ue=0;Ue<st.length;Ue+=1)st[Ue].c();Be=g(),Ce=f("button"),Oe=F("Add Haystack"),we=g(),De=f("h5"),De.textContent="AI-Enhanced Summaries (LLM Provider)",Xe=g(),ze=f("div"),Ne=f("label"),ht=F("Provider"),St=g(),tt=f("div"),gt=f("div"),Ve=f("select"),lt=f("option"),lt.textContent="(none)",ct=f("option"),ct.textContent="OpenRouter",Ee=f("option"),Ee.textContent="Ollama (local)",M=g(),x=f("p"),x.textContent="Choose a provider. OpenRouter uses API key; Ollama runs locally.",j=g(),dt&&dt.c(),te=g(),he=f("h5"),he.textContent="AI-Enhanced Summaries (OpenRouter)",de=g(),Me=f("div"),qe=f("label"),Pe=f("input"),bt=F(`
             Enable AI-generated article summaries`),il=g(),zt=f("p"),zt.textContent="Generate intelligent summaries using OpenRouter's language models",al=g(),pt&&pt.c(),Vt=g(),Ft=f("h5"),Ft.textContent="Knowledge Graph",ul=g(),Dt=f("div"),vt=f("label"),Fl=F("Remote automata URL"),Wl=g(),_l=f("div"),yt=f("input"),Kl=g(),Qt=f("div"),Yt=f("label"),Gl=F("Local KG path"),Bl=g(),Wt=f("div"),ot=f("input"),ql=g(),kt&&kt.c(),Jl=g(),vl=f("div"),Zt=f("div"),Xt=f("label"),Vl=F("Local KG type"),Ql=g(),wl=f("div"),Et=f("select"),xt=f("option"),xt.textContent="markdown",el=f("option"),el.textContent="json",Yl=g(),tl=f("div"),jt=f("label"),It=f("input"),Zl=F(`
             Public`),Xl=g(),Kt=f("label"),Mt=f("input"),xl=F(`
             Publish`),eo=g(),to=f("hr"),lo=g(),Gt=f("button"),oo=F("Remove Role"),a(n,"class","label"),a(n,"for",r=`role-name-${e[79]}`),a(d,"class","input"),a(d,"id",p=`role-name-${e[79]}`),a(d,"type","text"),a(i,"class","control"),a(o,"class","field"),a(y,"class","label"),a(y,"for",b=`role-shortname-${e[79]}`),a(v,"class","input"),a(v,"id",w=`role-shortname-${e[79]}`),a(v,"type","text"),a(C,"class","control"),a(_,"class","field"),a(I,"class","label"),a(I,"for",P=`role-theme-${e[79]}`),a(T,"id",A=`role-theme-${e[79]}`),e[3].roles[e[79]].theme===void 0&&it(so),a(W,"class","select is-fullwidth"),a(K,"class","control"),a(V,"class","field"),a(z,"class","label"),a(z,"for",q=`role-relevance-${e[79]}`),D.__value="title-scorer",D.value=D.__value,G.__value="terraphim-graph",G.value=G.__value,X.__value="bm25",X.value=X.__value,oe.__value="bm25f",oe.value=oe.__value,pe.__value="bm25plus",pe.value=pe.__value,a(N,"id",me=`role-relevance-${e[79]}`),e[3].roles[e[79]].relevance_function===void 0&&it(ro),a(E,"class","select is-fullwidth"),a(O,"class","control"),a($,"class","field"),a(ne,"class","checkbox"),a(ne,"id",Se=`role-terraphim-it-${e[79]}`),a(ne,"type","checkbox"),a(fe,"class","label"),a(fe,"for",se=`role-terraphim-it-${e[79]}`),a(ge,"class","field"),a(re,"class","title is-6"),a(Ce,"class","button is-small"),a(Ce,"data-testid",le="add-haystack-"+e[79]),a(De,"class","title is-6"),a(Ne,"class","label"),a(Ne,"for",Fe=`llm-provider-${e[79]}`),lt.__value="",lt.value=lt.__value,ct.__value="openrouter",ct.value=ct.__value,Ee.__value="ollama",Ee.value=Ee.__value,a(Ve,"id",Tt=`llm-provider-${e[79]}`),e[3].roles[e[79]].llm_provider===void 0&&it(io),a(gt,"class","select"),a(tt,"class","control"),a(x,"class","help"),a(ze,"class","field"),a(he,"class","title is-6"),a(Pe,"id",We=`openrouter-enabled-${e[79]}`),a(Pe,"type","checkbox"),a(qe,"class","checkbox"),a(qe,"for",ft=`openrouter-enabled-${e[79]}`),a(zt,"class","help"),a(Me,"class","field"),a(Ft,"class","title is-6"),a(vt,"class","label"),a(vt,"for",ml=`kg-url-${e[79]}`),a(yt,"class","input"),a(yt,"id",hl=`kg-url-${e[79]}`),a(yt,"type","text"),a(yt,"placeholder","https://example.com/thesaurus.json"),a(_l,"class","control"),a(Dt,"class","field"),a(Yt,"class","label"),a(Yt,"for",gl=`kg-local-path-${e[79]}`),a(ot,"class","input"),a(ot,"id",bl=`kg-local-path-${e[79]}`),a(ot,"type","text"),a(ot,"placeholder","/path/to/markdown"),ot.readOnly=e[4],a(Wt,"class","control"),a(Qt,"class","field"),a(Xt,"class","label"),a(Xt,"for",kl=`kg-local-type-${e[79]}`),xt.__value="markdown",xt.value=xt.__value,el.__value="json",el.value=el.__value,a(Et,"id",yl=`kg-local-type-${e[79]}`),e[3].roles[e[79]].kg.local_type===void 0&&it(uo),a(wl,"class","select"),a(Zt,"class","control"),a(vl,"class","field is-grouped"),a(It,"id",$l=`kg-public-${e[79]}`),a(It,"type","checkbox"),a(jt,"class","checkbox"),a(jt,"for",Cl=`kg-public-${e[79]}`),ie(jt,"margin-right","1rem"),a(Mt,"id",Sl=`kg-publish-${e[79]}`),a(Mt,"type","checkbox"),a(Kt,"class","checkbox"),a(Kt,"for",Tl=`kg-publish-${e[79]}`),a(tl,"class","field is-grouped"),a(Gt,"class","button is-small is-danger"),a(Gt,"data-testid",Rl="remove-role-"+e[79]),a(t,"class","box"),this.first=t},m(Ue,ve){L(Ue,t,ve),s(t,o),s(o,n),s(n,u),s(o,c),s(o,i),s(i,d),Ae(d,e[3].roles[e[79]].name),s(t,m),s(t,_),s(_,y),s(y,h),s(_,k),s(_,C),s(C,v),Ae(v,e[3].roles[e[79]].shortname),s(t,S),s(t,V),s(V,I),s(I,H),s(V,J),s(V,K),s(K,W),s(W,T);for(let $e=0;$e<nt.length;$e+=1)nt[$e]&&nt[$e].m(T,null);Ie(T,e[3].roles[e[79]].theme,!0),s(t,U),s(t,$),s($,z),s(z,ee),s($,Y),s($,O),s(O,E),s(E,N),s(N,D),s(N,G),s(N,X),s(N,oe),s(N,pe),Ie(N,e[3].roles[e[79]].relevance_function,!0),s(t,Le),s(t,ge),s(ge,fe),s(fe,ne),ne.checked=e[3].roles[e[79]].terraphim_it,s(fe,Te),s(t,be),s(t,re),s(t,ke);for(let $e=0;$e<st.length;$e+=1)st[$e]&&st[$e].m(t,null);s(t,Be),s(t,Ce),s(Ce,Oe),s(t,we),s(t,De),s(t,Xe),s(t,ze),s(ze,Ne),s(Ne,ht),s(ze,St),s(ze,tt),s(tt,gt),s(gt,Ve),s(Ve,lt),s(Ve,ct),s(Ve,Ee),Ie(Ve,e[3].roles[e[79]].llm_provider,!0),s(ze,M),s(ze,x),s(t,j),dt&&dt.m(t,null),s(t,te),s(t,he),s(t,de),s(t,Me),s(Me,qe),s(qe,Pe),Pe.checked=e[3].roles[e[79]].openrouter_enabled,s(qe,bt),s(Me,il),s(Me,zt),s(t,al),pt&&pt.m(t,null),s(t,Vt),s(t,Ft),s(t,ul),s(t,Dt),s(Dt,vt),s(vt,Fl),s(Dt,Wl),s(Dt,_l),s(_l,yt),Ae(yt,e[3].roles[e[79]].kg.url),s(t,Kl),s(t,Qt),s(Qt,Yt),s(Yt,Gl),s(Qt,Bl),s(Qt,Wt),s(Wt,ot),Ae(ot,e[3].roles[e[79]].kg.local_path),s(Wt,ql),kt&&kt.m(Wt,null),s(t,Jl),s(t,vl),s(vl,Zt),s(Zt,Xt),s(Xt,Vl),s(Zt,Ql),s(Zt,wl),s(wl,Et),s(Et,xt),s(Et,el),Ie(Et,e[3].roles[e[79]].kg.local_type,!0),s(t,Yl),s(t,tl),s(tl,jt),s(jt,It),It.checked=e[3].roles[e[79]].kg.public,s(jt,Zl),s(tl,Xl),s(tl,Kt),s(Kt,Mt),Mt.checked=e[3].roles[e[79]].kg.publish,s(Kt,xl),s(t,eo),s(t,to),s(t,lo),s(t,Gt),s(Gt,oo),Nl||(no=[Z(d,"input",xn),Z(v,"input",es),Z(T,"change",so),Z(N,"change",ro),Z(ne,"change",ts),Z(Ce,"click",ls),Z(Ve,"change",io),Z(Pe,"change",os),Z(yt,"input",ns),Z(ot,"input",ss),Z(ot,"click",function(){jl(e[4]?ao:void 0)&&(e[4]?ao:void 0).apply(this,arguments)}),Z(Et,"change",uo),Z(It,"change",rs),Z(Mt,"change",is),Z(Gt,"click",as)],Nl=!0)},p(Ue,ve){if(e=Ue,ve[0]&264&&r!==(r=`role-name-${e[79]}`)&&a(n,"for",r),ve[0]&264&&p!==(p=`role-name-${e[79]}`)&&a(d,"id",p),ve[0]&264&&d.value!==e[3].roles[e[79]].name&&Ae(d,e[3].roles[e[79]].name),ve[0]&264&&b!==(b=`role-shortname-${e[79]}`)&&a(y,"for",b),ve[0]&264&&w!==(w=`role-shortname-${e[79]}`)&&a(v,"id",w),ve[0]&264&&v.value!==e[3].roles[e[79]].shortname&&Ae(v,e[3].roles[e[79]].shortname),ve[0]&264&&P!==(P=`role-theme-${e[79]}`)&&a(I,"for",P),ve[0]&256){ll=e[8];let $e;for($e=0;$e<ll.length;$e+=1){const cl=cn(e,ll,$e);nt[$e]?nt[$e].p(cl,ve):(nt[$e]=hn(cl),nt[$e].c(),nt[$e].m(T,null))}for(;$e<nt.length;$e+=1)nt[$e].d(1);nt.length=ll.length}if(ve[0]&264&&A!==(A=`role-theme-${e[79]}`)&&a(T,"id",A),ve[0]&264&&Ie(T,e[3].roles[e[79]].theme),ve[0]&264&&q!==(q=`role-relevance-${e[79]}`)&&a(z,"for",q),ve[0]&264&&me!==(me=`role-relevance-${e[79]}`)&&a(N,"id",me),ve[0]&264&&Ie(N,e[3].roles[e[79]].relevance_function),ve[0]&264&&Se!==(Se=`role-terraphim-it-${e[79]}`)&&a(ne,"id",Se),ve[0]&264&&(ne.checked=e[3].roles[e[79]].terraphim_it),ve[0]&264&&se!==(se=`role-terraphim-it-${e[79]}`)&&a(fe,"for",se),ve[0]&491576){ol=e[77].haystacks;let $e;for($e=0;$e<ol.length;$e+=1){const cl=an(e,ol,$e);st[$e]?st[$e].p(cl,ve):(st[$e]=wn(cl),st[$e].c(),st[$e].m(t,Be))}for(;$e<st.length;$e+=1)st[$e].d(1);st.length=ol.length}ve[0]&264&&le!==(le="add-haystack-"+e[79])&&a(Ce,"data-testid",le),ve[0]&264&&Fe!==(Fe=`llm-provider-${e[79]}`)&&a(Ne,"for",Fe),ve[0]&264&&Tt!==(Tt=`llm-provider-${e[79]}`)&&a(Ve,"id",Tt),ve[0]&264&&Ie(Ve,e[3].roles[e[79]].llm_provider),e[3].roles[e[79]].llm_provider==="ollama"?dt?dt.p(e,ve):(dt=yn(e),dt.c(),dt.m(t,te)):dt&&(dt.d(1),dt=null),ve[0]&264&&We!==(We=`openrouter-enabled-${e[79]}`)&&a(Pe,"id",We),ve[0]&264&&(Pe.checked=e[3].roles[e[79]].openrouter_enabled),ve[0]&264&&ft!==(ft=`openrouter-enabled-${e[79]}`)&&a(qe,"for",ft),e[3].roles[e[79]].openrouter_enabled?pt?pt.p(e,ve):(pt=Sn(e),pt.c(),pt.m(t,Vt)):pt&&(pt.d(1),pt=null),ve[0]&264&&ml!==(ml=`kg-url-${e[79]}`)&&a(vt,"for",ml),ve[0]&264&&hl!==(hl=`kg-url-${e[79]}`)&&a(yt,"id",hl),ve[0]&264&&yt.value!==e[3].roles[e[79]].kg.url&&Ae(yt,e[3].roles[e[79]].kg.url),ve[0]&264&&gl!==(gl=`kg-local-path-${e[79]}`)&&a(Yt,"for",gl),ve[0]&264&&bl!==(bl=`kg-local-path-${e[79]}`)&&a(ot,"id",bl),ve[0]&16&&(ot.readOnly=e[4]),ve[0]&264&&ot.value!==e[3].roles[e[79]].kg.local_path&&Ae(ot,e[3].roles[e[79]].kg.local_path),e[4]?kt||(kt=Ln(),kt.c(),kt.m(Wt,null)):kt&&(kt.d(1),kt=null),ve[0]&264&&kl!==(kl=`kg-local-type-${e[79]}`)&&a(Xt,"for",kl),ve[0]&264&&yl!==(yl=`kg-local-type-${e[79]}`)&&a(Et,"id",yl),ve[0]&264&&Ie(Et,e[3].roles[e[79]].kg.local_type),ve[0]&264&&$l!==($l=`kg-public-${e[79]}`)&&a(It,"id",$l),ve[0]&264&&(It.checked=e[3].roles[e[79]].kg.public),ve[0]&264&&Cl!==(Cl=`kg-public-${e[79]}`)&&a(jt,"for",Cl),ve[0]&264&&Sl!==(Sl=`kg-publish-${e[79]}`)&&a(Mt,"id",Sl),ve[0]&264&&(Mt.checked=e[3].roles[e[79]].kg.publish),ve[0]&264&&Tl!==(Tl=`kg-publish-${e[79]}`)&&a(Kt,"for",Tl),ve[0]&264&&Rl!==(Rl="remove-role-"+e[79])&&a(Gt,"data-testid",Rl)},d(Ue){Ue&&R(t),Ye(nt,Ue),Ye(st,Ue),dt&&dt.d(),pt&&pt.d(),kt&&kt.d(),Nl=!1,Je(no)}}}function Pn(l){let e,t=l[74]+"",o;return{c(){e=f("option"),o=F(t),e.__value=l[74],e.value=e.__value},m(n,u){L(n,e,u),s(e,o)},p:ye,d(n){n&&R(e)}}}function On(l){let e,t=l[71].name+"",o,n;return{c(){e=f("option"),o=F(t),e.__value=n=l[71].name,e.value=e.__value},m(u,r){L(u,e,r),s(e,o)},p(u,r){r[0]&8&&t!==(t=u[71].name+"")&&_e(o,t),r[0]&264&&n!==(n=u[71].name)&&(e.__value=n,e.value=e.__value)},d(u){u&&R(e)}}}function Nn(l){let e,t,o;return{c(){e=f("button"),e.textContent="Back",a(e,"class","button"),a(e,"data-testid","wizard-back")},m(n,u){L(n,e,u),t||(o=Z(e,"click",l[11]),t=!0)},p:ye,d(n){n&&R(e),t=!1,o()}}}function yi(l){let e,t,o;return{c(){e=f("button"),e.textContent="Save",a(e,"class","button is-success"),a(e,"data-testid","wizard-save")},m(n,u){L(n,e,u),t||(o=Z(e,"click",l[19]),t=!0)},p:ye,d(n){n&&R(e),t=!1,o()}}}function $i(l){let e,t,o;return{c(){e=f("button"),e.textContent="Next",a(e,"class","button is-primary"),a(e,"data-testid","wizard-next")},m(n,u){L(n,e,u),t||(o=Z(e,"click",l[10]),t=!0)},p:ye,d(n){n&&R(e),t=!1,o()}}}function Ci(l){let e,t,o,n,u,r,c,i,d,p,m,_,y,h,b,k,C,v;e=new rl({props:{fallbackPath:"/"}});let w=l[2]==="success"&&pn(l),S=l[2]==="error"&&mn(l);function V(T,A){return T[1]===1?vi:T[1]===2?bi:gi}let I=V(l),H=I(l),P=l[1]>1&&Nn(l);function J(T,A){return T[1]<Xn?$i:yi}let K=J(l),W=K(l);return{c(){ae(e.$$.fragment),t=g(),o=f("div"),n=f("div"),u=f("h3"),u.textContent="Configuration Wizard",r=g(),c=f("button"),c.textContent="Close",i=g(),w&&w.c(),d=g(),S&&S.c(),p=g(),H.c(),m=g(),_=f("nav"),y=f("div"),P&&P.c(),h=g(),b=f("div"),W.c(),a(u,"class","title is-4"),ie(u,"margin-bottom","0"),a(c,"class","button is-small is-light"),a(c,"aria-label","Close configuration wizard"),a(n,"class","is-flex is-justify-content-space-between is-align-items-center"),ie(n,"gap",".5rem"),a(y,"class","level-left"),a(b,"class","level-right"),a(_,"class","level"),a(o,"class","box")},m(T,A){ue(e,T,A),L(T,t,A),L(T,o,A),s(o,n),s(n,u),s(n,r),s(n,c),s(o,i),w&&w.m(o,null),s(o,d),S&&S.m(o,null),s(o,p),H.m(o,null),s(o,m),s(o,_),s(_,y),P&&P.m(y,null),s(_,h),s(_,b),W.m(b,null),k=!0,C||(v=Z(c,"click",Si),C=!0)},p(T,A){T[2]==="success"?w?w.p(T,A):(w=pn(T),w.c(),w.m(o,d)):w&&(w.d(1),w=null),T[2]==="error"?S?S.p(T,A):(S=mn(T),S.c(),S.m(o,p)):S&&(S.d(1),S=null),I===(I=V(T))&&H?H.p(T,A):(H.d(1),H=I(T),H&&(H.c(),H.m(o,m))),T[1]>1?P?P.p(T,A):(P=Nn(T),P.c(),P.m(y,null)):P&&(P.d(1),P=null),K===(K=J(T))&&W?W.p(T,A):(W.d(1),W=K(T),W&&(W.c(),W.m(b,null)))},i(T){k||(B(e.$$.fragment,T),k=!0)},o(T){Q(e.$$.fragment,T),k=!1},d(T){ce(e,T),T&&R(t),T&&R(o),w&&w.d(),S&&S.d(),H.d(),P&&P.d(),W.d(),C=!1,v()}}}const Xn=3;function Si(){typeof window<"u"&&window.history.back()}function Ti(l,e,t){let o,n;Re(l,je,M=>t(4,n=M));const u=Lt(null);async function r(M,x){if(Ze(je))try{const j=await ln({directory:!0,multiple:!1});j&&typeof j=="string"&&i.update(te=>(te.roles[M].haystacks[x].path=j,te))}catch(j){console.error("Failed to open folder selector:",j)}}async function c(M){if(Ze(je))try{const x=await ln({directory:!0,multiple:!1});x&&typeof x=="string"&&i.update(j=>(j.roles[M].kg.local_path=x,j))}catch(x){console.error("Failed to open folder selector:",x)}}const i=Lt({id:"Desktop",global_shortcut:"Ctrl+X",default_theme:"spacelab",default_role:"Default",roles:[]});Re(l,i,M=>t(3,o=M));const d=["default","darkly","cerulean","cosmo","cyborg","flatly","journal","litera","lumen","lux","materia","minty","nuclear","pulse","sandstone","simplex","slate","solar","spacelab","superhero","united","yeti"];qt(async()=>{try{let M;Ze(je)?M=await He("get_config_schema"):M=await(await fetch("/config/schema")).json(),u.set(M);const x=Ze(Ct);x&&x.id&&i.update(j=>{var te;return{...j,id:x.id,global_shortcut:x.global_shortcut,default_theme:((te=x.roles[x.default_role])==null?void 0:te.theme)??"spacelab",default_role:x.default_role,roles:Object.values(x.roles).map(he=>{var Pe,We,bt,ft,il,zt,al,Vt,Ft,ul,Dt;const de=(Pe=he.kg)==null?void 0:Pe.automata_path,Me=(de==null?void 0:de.Remote)??"",qe=((bt=(We=he.kg)==null?void 0:We.knowledge_graph_local)==null?void 0:bt.path)??"";return{name:he.name,shortname:he.shortname,relevance_function:he.relevance_function,terraphim_it:he.terraphim_it??!1,theme:he.theme,haystacks:(he.haystacks??[]).map(vt=>({path:vt.location||vt.path||"",read_only:vt.read_only??!1,service:vt.service||"Ripgrep",atomic_server_secret:vt.atomic_server_secret||"",extra_parameters:vt.extra_parameters||{}})),kg:{url:Me,local_path:qe,local_type:((il=(ft=he.kg)==null?void 0:ft.knowledge_graph_local)==null?void 0:il.input_type)??"markdown",public:((zt=he.kg)==null?void 0:zt.public)??!1,publish:((al=he.kg)==null?void 0:al.publish)??!1},openrouter_enabled:he.openrouter_enabled??!1,openrouter_api_key:he.openrouter_api_key??"",openrouter_model:he.openrouter_model??"openai/gpt-3.5-turbo",openrouter_auto_summarize:he.openrouter_auto_summarize??!1,openrouter_chat_enabled:he.openrouter_chat_enabled??!1,openrouter_chat_model:he.openrouter_chat_model??he.openrouter_model??"openai/gpt-3.5-turbo",openrouter_chat_system_prompt:he.openrouter_chat_system_prompt??"",llm_provider:((Vt=he.extra)==null?void 0:Vt.llm_provider)??"",llm_model:((Ft=he.extra)==null?void 0:Ft.llm_model)??"",llm_base_url:((ul=he.extra)==null?void 0:ul.llm_base_url)??"",llm_auto_summarize:((Dt=he.extra)==null?void 0:Dt.llm_auto_summarize)??!1}})}})}catch(M){console.error("Failed to load schema",M)}}),qt(()=>{const M=x=>{x.key==="Escape"&&typeof window<"u"&&window.history.back()};return window.addEventListener("keydown",M),()=>window.removeEventListener("keydown",M)});let p={};async function m(M){var de;const j=Ze(i).roles[M],te=j.llm_provider||(j.openrouter_enabled?"openrouter":""),he=[];try{if(te==="ollama"){const Me=(j.llm_base_url||"http://127.0.0.1:11434").replace(/\/$/,""),Pe=await(await fetch(`${Me}/api/tags`)).json();if(Array.isArray(Pe==null?void 0:Pe.models))for(const We of Pe.models)We!=null&&We.name&&he.push(We.name)}else if(te==="openrouter"){const Me=(de=j.openrouter_api_key)==null?void 0:de.trim();if(!Me)throw new Error("OpenRouter API key required");const Pe=await(await fetch("https://openrouter.ai/api/v1/models",{headers:{Authorization:`Bearer ${Me}`,"HTTP-Referer":"https://terraphim.ai","X-Title":"Terraphim Desktop"}})).json(),We=Array.isArray(Pe==null?void 0:Pe.data)?Pe.data:[];for(const bt of We)bt!=null&&bt.id&&he.push(bt.id)}}catch(Me){console.error("Failed to fetch models",Me)}t(0,p={...p,[M]:he})}let _=1,y="";function h(){_<Xn&&t(1,_+=1)}function b(){_>1&&t(1,_-=1)}function k(){i.update(M=>({...M,roles:[...M.roles,{name:"New Role",shortname:"new",relevance_function:"title-scorer",terraphim_it:!1,theme:"spacelab",haystacks:[],kg:{url:"",local_path:"",local_type:"markdown",public:!1,publish:!1},openrouter_enabled:!1,openrouter_api_key:"",openrouter_model:"openai/gpt-3.5-turbo",openrouter_auto_summarize:!1,openrouter_chat_enabled:!1,openrouter_chat_model:"openai/gpt-3.5-turbo",openrouter_chat_system_prompt:"",llm_provider:"",llm_model:"",llm_base_url:"",llm_auto_summarize:!1}]}))}function C(M){i.update(x=>({...x,roles:x.roles.filter((j,te)=>te!==M)}))}function v(M){i.update(x=>(x.roles[M].haystacks.push({path:"",read_only:!1,service:"Ripgrep",atomic_server_secret:"",extra_parameters:{}}),x))}function w(M,x){i.update(j=>(j.roles[M].haystacks=j.roles[M].haystacks.filter((te,he)=>he!==x),j))}function S(M,x,j="",te=""){i.update(he=>{he.roles[M].haystacks[x].extra_parameters||(he.roles[M].haystacks[x].extra_parameters={});const de=j||`param_${Date.now()}`;return he.roles[M].haystacks[x].extra_parameters[de]=te,he})}function V(M,x,j){i.update(te=>(delete te.roles[M].haystacks[x].extra_parameters[j],te))}function I(M,x,j,te){i.update(he=>{const de=he.roles[M].haystacks[x].extra_parameters;return de[j]!==void 0&&j!==te&&(de[te]=de[j],delete de[j]),he})}function H(M,x,j,te){const he=te.target.value;I(M,x,j,he)}async function P(){var he;const M=Ze(i),x=Ze(Ct);let j={...x};j.id=M.id,j.global_shortcut=M.global_shortcut,j.default_role=M.default_role;const te={};M.roles.forEach(de=>{var We,bt;const Me=de.name,qe=Me.replace(/^"|"$/g,"");te[qe]={extra:((bt=(We=x.roles)==null?void 0:We[Me])==null?void 0:bt.extra)??{},name:de.name,shortname:de.shortname,theme:de.theme,relevance_function:de.relevance_function,terraphim_it:de.terraphim_it??!1,haystacks:de.haystacks.map(ft=>({location:ft.path,service:ft.service,read_only:ft.read_only,atomic_server_secret:ft.service==="Atomic"?ft.atomic_server_secret:void 0,extra_parameters:ft.extra_parameters||{}})),kg:de.kg.url||de.kg.local_path?{automata_path:de.kg.url?{Remote:de.kg.url}:null,knowledge_graph_local:de.kg.local_path?{input_type:de.kg.local_type,path:de.kg.local_path}:null,public:de.kg.public,publish:de.kg.publish}:null,...de.openrouter_enabled&&{openrouter_enabled:de.openrouter_enabled,openrouter_api_key:de.openrouter_api_key,openrouter_model:de.openrouter_model,openrouter_auto_summarize:de.openrouter_auto_summarize??!1,openrouter_chat_enabled:de.openrouter_chat_enabled??!1,openrouter_chat_model:de.openrouter_chat_model??de.openrouter_model,openrouter_chat_system_prompt:de.openrouter_chat_system_prompt??""}};const Pe={};de.llm_provider&&(Pe.llm_provider=de.llm_provider),de.llm_model&&(Pe.llm_model=de.llm_model),de.llm_base_url&&(Pe.llm_base_url=de.llm_base_url),typeof de.llm_auto_summarize=="boolean"&&(Pe.llm_auto_summarize=de.llm_auto_summarize),te[qe].extra={...te[qe].extra||{},...Pe}}),j.roles=te,(!j.default_role||!te[j.default_role])&&(j.default_role=((he=M.roles[0])==null?void 0:he.name)??"Default"),j.selected_role=j.default_role;try{if(Ze(je))await He("update_config",{configNew:j});else{const de=await fetch("/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(j)});if(!de.ok)throw new Error(`HTTP ${de.status}: ${de.statusText}`)}Ct.set(j),t(2,y="success"),setTimeout(()=>{t(2,y="")},3e3)}catch(de){console.error(de),t(2,y="error"),setTimeout(()=>{t(2,y="")},3e3)}}const J=()=>t(2,y=""),K=()=>t(2,y="");function W(){o.id=Rt(this),i.set(o),t(8,d)}function T(){o.global_shortcut=this.value,i.set(o),t(8,d)}function A(){o.default_theme=Rt(this),i.set(o),t(8,d)}function U(){o.default_role=Rt(this),i.set(o),t(8,d)}function $(M){o.roles[M].name=this.value,i.set(o),t(8,d)}function z(M){o.roles[M].shortname=this.value,i.set(o),t(8,d)}function ee(M){o.roles[M].theme=Rt(this),i.set(o),t(8,d)}function q(M){o.roles[M].relevance_function=Rt(this),i.set(o),t(8,d)}function Y(M){o.roles[M].terraphim_it=this.checked,i.set(o),t(8,d)}function O(M,x){o.roles[M].haystacks[x].service=Rt(this),i.set(o),t(8,d)}function E(M,x){o.roles[M].haystacks[x].path=this.value,i.set(o),t(8,d)}const N=(M,x)=>r(M,x);function D(M,x){o.roles[M].haystacks[x].atomic_server_secret=this.value,i.set(o),t(8,d)}function G(M,x){o.roles[M].haystacks[x].extra_parameters.tag=this.value,i.set(o),t(8,d)}const X=(M,x,j)=>{const te=j.currentTarget.value;te&&dl(i,o.roles[M].haystacks[x].extra_parameters.tag=te,o)},oe=(M,x,j,te)=>H(M,x,j,te);function pe(M,x,j){o.roles[M].haystacks[x].extra_parameters[j]=this.value,i.set(o),t(8,d)}const me=(M,x,j)=>V(M,x,j),Le=(M,x)=>S(M,x,"tag","#rust"),ge=(M,x)=>S(M,x,"max_count","10"),fe=(M,x)=>S(M,x,"","");function ne(M,x){o.roles[M].haystacks[x].read_only=this.checked,i.set(o),t(8,d)}const Se=(M,x)=>w(M,x),Te=M=>v(M);function se(M){o.roles[M].llm_provider=Rt(this),i.set(o),t(8,d)}function be(M){o.roles[M].llm_model=this.value,i.set(o),t(8,d)}const re=M=>m(M),ke=(M,x)=>{dl(i,o.roles[M].llm_model=x.currentTarget.value,o)};function Be(M){o.roles[M].llm_base_url=this.value,i.set(o),t(8,d)}function Ce(M){o.roles[M].llm_auto_summarize=this.checked,i.set(o),t(8,d)}function Oe(M){o.roles[M].openrouter_enabled=this.checked,i.set(o),t(8,d)}function le(M){o.roles[M].openrouter_api_key=this.value,i.set(o),t(8,d)}function we(M){o.roles[M].openrouter_model=this.value,i.set(o),t(8,d)}const De=M=>m(M),Xe=(M,x)=>{dl(i,o.roles[M].openrouter_model=x.currentTarget.value,o)};function ze(M){o.roles[M].openrouter_auto_summarize=this.checked,i.set(o),t(8,d)}function Ne(M){o.roles[M].openrouter_chat_enabled=this.checked,i.set(o),t(8,d)}function ht(M){o.roles[M].openrouter_chat_model=Rt(this),i.set(o),t(8,d)}function Fe(M){o.roles[M].openrouter_chat_system_prompt=this.value,i.set(o),t(8,d)}function St(M){o.roles[M].kg.url=this.value,i.set(o),t(8,d)}function tt(M){o.roles[M].kg.local_path=this.value,i.set(o),t(8,d)}const gt=M=>c(M);function Ve(M){o.roles[M].kg.local_type=Rt(this),i.set(o),t(8,d)}function lt(M){o.roles[M].kg.public=this.checked,i.set(o),t(8,d)}function ct(M){o.roles[M].kg.publish=this.checked,i.set(o),t(8,d)}return[p,_,y,o,n,r,c,i,d,m,h,b,k,C,v,w,S,V,H,P,J,K,W,T,A,U,$,z,ee,q,Y,O,E,N,D,G,X,oe,pe,me,Le,ge,fe,ne,Se,Te,se,be,re,ke,Be,Ce,Oe,le,we,De,Xe,ze,Ne,ht,Fe,St,tt,gt,Ve,lt,ct,M=>C(M),()=>{t(1,_=2)}]}class Ri extends mt{constructor(e){super(),_t(this,e,Ti,Ci,at,{},null,[-1,-1,-1,-1])}}function Ai(l){let e,t,o,n,u,r,c,i;return e=new rl({props:{fallbackPath:"/"}}),c=new Qn({props:{content:l[0],onChange:l[1]}}),{c(){ae(e.$$.fragment),t=g(),o=f("div"),n=f("p"),n.innerHTML="<i>The best editing experience is to configure Atomic Server, in the meantime use editor below. You will need to refresh page via Command R or Ctrl-R to see changes</i>",u=g(),r=f("div"),ae(c.$$.fragment),a(r,"class","editor"),a(o,"class","box")},m(d,p){ue(e,d,p),L(d,t,p),L(d,o,p),s(o,n),s(o,u),s(o,r),ue(c,r,null),i=!0},p(d,[p]){const m={};p&1&&(m.content=d[0]),c.$set(m)},i(d){i||(B(e.$$.fragment,d),B(c.$$.fragment,d),i=!0)},o(d){Q(e.$$.fragment,d),Q(c.$$.fragment,d),i=!1},d(d){ce(e,d),d&&R(t),d&&R(o),ce(c)}}}function Li(l,e,t){let o,n;Re(l,Ct,c=>t(2,o=c)),Re(l,je,c=>t(3,n=c));let u={json:o};function r(c){if(console.log("contents changed:",c),console.log("is tauri",n),Ct.update(i=>(i=c.json,i)),Ze(je))console.log("Updating config on server"),He("update_config",{configNew:c.json}).then(i=>{console.log(`Message: ${i}`)}).catch(i=>console.error(i));else{let i=`${rt.ServerURL}/config/`;fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c.json)})}t(0,u=c)}return qt(()=>{t(0,u={json:o})}),[u,r]}class Ei extends mt{constructor(e){super(),_t(this,e,Li,Ai,at,{})}}const{window:Il}=bs;function Pi(l){let e,t,o,n,u,r,c,i,d,p;return{c(){e=f("div"),t=f("div"),o=f("h3"),o.textContent="Error loading graph",n=g(),u=f("p"),r=F(l[3]),c=g(),i=f("button"),i.textContent="Retry",a(i,"class","button is-primary"),a(t,"class","error-content svelte-1ry9pkl"),a(e,"class","error-overlay svelte-1ry9pkl")},m(m,_){L(m,e,_),s(e,t),s(t,o),s(t,n),s(t,u),s(u,r),s(t,c),s(t,i),d||(p=Z(i,"click",l[11]),d=!0)},p(m,_){_&8&&_e(r,m[3])},d(m){m&&R(e),d=!1,p()}}}function Oi(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="loading-content svelte-1ry9pkl"><div class="loader svelte-1ry9pkl"></div> 
        <p>Loading knowledge graph...</p></div>`,a(e,"class","loading-overlay svelte-1ry9pkl")},m(t,o){L(t,e,o)},p:ye,d(t){t&&R(e)}}}function Un(l){let e,t,o;return{c(){e=f("button"),e.innerHTML='<i class="fas fa-times svelte-1ry9pkl"></i>',a(e,"class","close-button svelte-1ry9pkl"),a(e,"title","Close Graph")},m(n,u){L(n,e,u),t||(o=Z(e,"click",l[17]),t=!0)},p:ye,d(n){n&&R(e),t=!1,o()}}}function Dn(l){let e;return{c(){e=f("div"),e.innerHTML="<span><strong>Left-click:</strong> View node • <strong>Right-click:</strong> Edit node • <strong>Drag:</strong> Move • <strong>Scroll:</strong> Zoom</span>",a(e,"class","controls-info svelte-1ry9pkl")},m(t,o){L(t,e,o)},d(t){t&&R(e)}}}function In(l){let e,t;return{c(){e=f("div"),t=F(l[8]),a(e,"class","debug-message svelte-1ry9pkl")},m(o,n){L(o,e,n),s(e,t)},p(o,n){n&256&&_e(t,o[8])},d(o){o&&R(e)}}}function Mn(l){let e=l[5].id,t,o,n=jn(l);return{c(){n.c(),t=ut()},m(u,r){n.m(u,r),L(u,t,r),o=!0},p(u,r){r&32&&at(e,e=u[5].id)?(Ke(),Q(n,1,1,ye),Ge(),n=jn(u),n.c(),B(n,1),n.m(t.parentNode,t)):n.p(u,r)},i(u){o||(B(n),o=!0)},o(u){Q(n),o=!1},d(u){u&&R(t),n.d(u)}}}function jn(l){let e,t,o;function n(r){l[18](r)}let u={item:l[5],initialEdit:l[7]};return l[6]!==void 0&&(u.active=l[6]),e=new Hl({props:u}),Qe.push(()=>xe(e,"active",n)),e.$on("close",l[12]),e.$on("save",l[13]),{c(){ae(e.$$.fragment)},m(r,c){ue(e,r,c),o=!0},p(r,c){const i={};c&32&&(i.item=r[5]),c&128&&(i.initialEdit=r[7]),!t&&c&64&&(t=!0,i.active=r[6],et(()=>t=!1)),e.$set(i)},i(r){o||(B(e.$$.fragment,r),o=!0)},o(r){Q(e.$$.fragment,r),o=!1},d(r){ce(e,r)}}}function Ni(l){let e,t,o,n,u,r,c,i,d,p,m;it(l[15]),e=new rl({props:{fallbackPath:"/"}});function _(w,S){if(w[2])return Oi;if(w[3])return Pi}let y=_(l),h=y&&y(l),b=l[0]&&Un(l),k=!l[2]&&!l[3]&&l[4].length>0&&Dn(),C=l[8]&&In(l),v=l[5]&&Mn(l);return{c(){ae(e.$$.fragment),t=g(),o=f("div"),h&&h.c(),n=g(),b&&b.c(),u=g(),k&&k.c(),r=g(),C&&C.c(),c=g(),v&&v.c(),i=ut(),a(o,"class","graph-container svelte-1ry9pkl"),ie(o,"width",l[0]?"100vw":"600px"),ie(o,"height",l[0]?"100vh":"400px"),Ut(o,"fullscreen",l[0])},m(w,S){ue(e,w,S),L(w,t,S),L(w,o,S),h&&h.m(o,null),l[16](o),L(w,n,S),b&&b.m(w,S),L(w,u,S),k&&k.m(w,S),L(w,r,S),C&&C.m(w,S),L(w,c,S),v&&v.m(w,S),L(w,i,S),d=!0,p||(m=Z(Il,"resize",l[15]),p=!0)},p(w,[S]){y===(y=_(w))&&h?h.p(w,S):(h&&h.d(1),h=y&&y(w),h&&(h.c(),h.m(o,null))),(!d||S&1)&&ie(o,"width",w[0]?"100vw":"600px"),(!d||S&1)&&ie(o,"height",w[0]?"100vh":"400px"),(!d||S&1)&&Ut(o,"fullscreen",w[0]),w[0]?b?b.p(w,S):(b=Un(w),b.c(),b.m(u.parentNode,u)):b&&(b.d(1),b=null),!w[2]&&!w[3]&&w[4].length>0?k||(k=Dn(),k.c(),k.m(r.parentNode,r)):k&&(k.d(1),k=null),w[8]?C?C.p(w,S):(C=In(w),C.c(),C.m(c.parentNode,c)):C&&(C.d(1),C=null),w[5]?v?(v.p(w,S),S&32&&B(v,1)):(v=Mn(w),v.c(),B(v,1),v.m(i.parentNode,i)):v&&(Ke(),Q(v,1,1,()=>{v=null}),Ge())},i(w){d||(B(e.$$.fragment,w),B(v),d=!0)},o(w){Q(e.$$.fragment,w),Q(v),d=!1},d(w){ce(e,w),w&&R(t),w&&R(o),h&&h.d(),l[16](null),w&&R(n),b&&b.d(w),w&&R(u),k&&k.d(w),w&&R(r),C&&C.d(w),w&&R(c),v&&v.d(w),w&&R(i),p=!1,m()}}}function Hn(l){return{id:`kg-node-${l.id}`,url:`#/graph/node/${l.id}`,title:l.label,body:`# ${l.label}

**Knowledge Graph Node**

ID: ${l.id}
Rank: ${l.rank}

This is a concept node from the knowledge graph. You can edit this content to add more information about "${l.label}".`,description:`Knowledge graph concept: ${l.label}`,tags:["knowledge-graph","concept"],rank:l.rank,stub:`Knowledge graph concept: ${l.label}`}}function Ui(l,e,t){let o,n;Re(l,At,A=>t(20,o=A)),Re(l,je,A=>t(21,n=A));let{apiUrl:u="/rolegraph"}=e,{fullscreen:r=!0}=e,c,i=!0,d=null,p=[],m=[],_=null,y=!1,h=!1,b="",k=window.innerWidth,C=window.innerHeight;function v(){t(9,k=window.innerWidth),t(10,C=window.innerHeight),!i&&!d&&P()}async function w(){t(2,i=!0),t(3,d=null);try{if(n){console.log("Loading rolegraph from Tauri");const A=await He("get_rolegraph",{role_name:o||void 0});if(A&&A.status==="success")t(4,p=A.nodes),m=A.edges;else throw new Error(`Tauri rolegraph fetch failed: ${(A==null?void 0:A.status)||"unknown error"}`)}else{console.log("Loading rolegraph from server");const A=o?`${u}?role=${encodeURIComponent(o)}`:u,U=await fetch(A);if(!U.ok)throw new Error(`Failed to fetch: ${U.status}`);const $=await U.json();t(4,p=$.nodes),m=$.edges}}catch(A){t(3,d=A.message),console.error("Error fetching rolegraph:",A)}finally{t(2,i=!1)}}function S(A,U){A.stopPropagation(),console.log("Node clicked:",U.label),t(5,_=Hn(U)),t(7,h=!1),t(6,y=!0)}function V(A,U){A.preventDefault(),A.stopPropagation(),console.log("Node right-clicked:",U.label),t(8,b=`Right-clicked: ${U.label}`),t(5,_=Hn(U)),t(7,h=!0),t(6,y=!0),setTimeout(()=>{t(8,b="")},2e3)}function I(){t(6,y=!1),t(5,_=null),t(7,h=!1)}async function H(){if(_)try{const A=await fetch("/documents",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(_)});A.ok?console.log("Successfully saved KG record:",_.id):console.error("Failed to save KG record:",A.statusText)}catch(A){console.error("Error saving KG record:",A)}finally{t(6,y=!1),t(5,_=null),t(7,h=!1)}}function P(){if(!c)return;t(1,c.innerHTML="",c);const A=Ul(c).append("svg").attr("width",k).attr("height",C),U=Ls().scaleExtent([.1,10]).on("zoom",D=>{$.attr("transform",D.transform)});A.call(U);const $=A.append("g"),z=Es(p).force("link",Ps(m).id(D=>D.id).distance(100)).force("charge",Os().strength(-200)).force("center",Ns(k/2,C/2)).force("collision",Us().radius(20)),ee=$.append("g").attr("class","links").selectAll("line").data(m).enter().append("line").attr("stroke","#666").attr("stroke-opacity",.7).attr("stroke-width",D=>{const G=D.weight||D.rank||1;return Math.max(1,Math.min(8,G*2))}),q=$.append("g").attr("class","nodes").selectAll("circle").data(p).enter().append("circle").attr("r",D=>{const G=D.rank||1;return Math.max(6,Math.min(20,G*2))}).attr("fill",D=>{const G=D.rank||1,X=Math.min(G/10,1);return Ds(.2+X*.6)}).attr("stroke","#fff").attr("stroke-width",2).style("cursor","pointer").on("click",(D,G)=>S(D,G)).on("contextmenu",(D,G)=>V(D,G)).on("mouseover",function(D,G){Ul(this).transition().duration(150).attr("stroke-width",3).attr("r",X=>{const oe=X.rank||1;return Math.max(8,Math.min(24,oe*2.5))})}).on("mouseout",function(D,G){Ul(this).transition().duration(150).attr("stroke-width",2).attr("r",X=>{const oe=X.rank||1;return Math.max(6,Math.min(20,oe*2))})}).call(Is().on("start",O).on("drag",E).on("end",N)),Y=$.append("g").attr("class","labels").selectAll("text").data(p).enter().append("text").attr("text-anchor","middle").attr("dy",".35em").attr("font-size","11px").attr("font-family","Arial, sans-serif").attr("fill","#333").attr("pointer-events","none").text(D=>D.label.length>12?D.label.substring(0,12)+"...":D.label);z.on("tick",()=>{ee.attr("x1",D=>D.source.x).attr("y1",D=>D.source.y).attr("x2",D=>D.target.x).attr("y2",D=>D.target.y),q.attr("cx",D=>D.x).attr("cy",D=>D.y),Y.attr("x",D=>D.x).attr("y",D=>D.y)});function O(D,G){D.active||z.alphaTarget(.3).restart(),G.fx=G.x,G.fy=G.y}function E(D,G){G.fx=D.x,G.fy=D.y}function N(D,G){D.active||z.alphaTarget(0),G.fx=null,G.fy=null}}qt(()=>{w().then(()=>{d||P()});const A=U=>{U.preventDefault()};return c&&c.addEventListener("contextmenu",A),window.addEventListener("resize",v),()=>{c&&c.removeEventListener("contextmenu",A),window.removeEventListener("resize",v)}});function J(){t(9,k=Il.innerWidth),t(10,C=Il.innerHeight)}function K(A){Qe[A?"unshift":"push"](()=>{c=A,t(1,c)})}const W=()=>history.back();function T(A){y=A,t(6,y)}return l.$$set=A=>{"apiUrl"in A&&t(14,u=A.apiUrl),"fullscreen"in A&&t(0,r=A.fullscreen)},[r,c,i,d,p,_,y,h,b,k,C,w,I,H,u,J,K,W,T]}class Di extends mt{constructor(e){super(),_t(this,e,Ui,Ni,at,{apiUrl:14,fullscreen:0})}}function zn(l,e,t){const o=l.slice();return o[9]=e[t],o[11]=t,o}function Fn(l){let e,t,o,n=l[9].content+"",u,r;return{c(){e=f("div"),t=f("div"),o=f("pre"),u=F(n),a(o,"class","svelte-tu8ic4"),a(t,"class","bubble svelte-tu8ic4"),a(e,"class",r=Nt(`msg ${l[9].role}`)+" svelte-tu8ic4")},m(c,i){L(c,e,i),s(e,t),s(t,o),s(o,u)},p(c,i){i&1&&n!==(n=c[9].content+"")&&_e(u,n),i&1&&r!==(r=Nt(`msg ${c[9].role}`)+" svelte-tu8ic4")&&a(e,"class",r)},d(c){c&&R(e)}}}function Wn(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="bubble loading svelte-tu8ic4"><span class="icon is-small"><i class="fas fa-spinner fa-spin"></i></span> 
            <span>Thinking...</span></div>`,a(e,"class","msg assistant svelte-tu8ic4")},m(t,o){L(t,e,o)},d(t){t&&R(e)}}}function Kn(l){let e,t,o;return{c(){e=f("p"),t=F("Model: "),o=F(l[4]),a(e,"class","is-size-7 has-text-grey")},m(n,u){L(n,e,u),s(e,t),s(e,o)},p(n,u){u&16&&_e(o,n[4])},d(n){n&&R(e)}}}function Gn(l){let e,t;return{c(){e=f("p"),t=F(l[3]),a(e,"class","has-text-danger is-size-7")},m(o,n){L(o,e,n),s(e,t)},p(o,n){n&8&&_e(t,o[3])},d(o){o&&R(e)}}}function Ii(l){let e,t,o,n,u,r,c,i,d,p,m,_,y,h,b,k,C,v,w,S,V,I,H,P;e=new rl({props:{fallbackPath:"/"}});let J=l[0],K=[];for(let U=0;U<J.length;U+=1)K[U]=Fn(zn(l,J,U));let W=l[2]&&Wn(),T=l[4]&&Kn(l),A=l[3]&&Gn(l);return{c(){ae(e.$$.fragment),t=g(),o=f("section"),n=f("div"),u=f("h2"),u.textContent="Chat",r=g(),c=f("p"),c.textContent=`Role: ${Ze(At)}`,i=g(),d=f("div");for(let U=0;U<K.length;U+=1)K[U].c();p=g(),W&&W.c(),m=g(),T&&T.c(),_=g(),A&&A.c(),y=g(),h=f("div"),b=f("div"),k=f("textarea"),C=g(),v=f("div"),w=f("button"),S=f("span"),S.innerHTML='<i class="fas fa-paper-plane"></i>',a(u,"class","title is-4"),a(c,"class","subtitle is-6"),a(d,"class","chat-window svelte-tu8ic4"),a(k,"class","textarea"),a(k,"rows","3"),a(k,"placeholder","Type your message and press Enter..."),a(b,"class","control is-expanded"),a(S,"class","icon"),a(w,"class","button is-primary"),w.disabled=V=l[2]||!l[1].trim(),a(v,"class","control"),a(h,"class","field has-addons chat-input svelte-tu8ic4"),a(n,"class","container"),a(o,"class","section")},m(U,$){ue(e,U,$),L(U,t,$),L(U,o,$),s(o,n),s(n,u),s(n,r),s(n,c),s(n,i),s(n,d);for(let z=0;z<K.length;z+=1)K[z]&&K[z].m(d,null);s(d,p),W&&W.m(d,null),s(n,m),T&&T.m(n,null),s(n,_),A&&A.m(n,null),s(n,y),s(n,h),s(h,b),s(b,k),Ae(k,l[1]),s(h,C),s(h,v),s(v,w),s(w,S),I=!0,H||(P=[Z(k,"input",l[7]),Z(k,"keydown",l[6]),Z(w,"click",l[5])],H=!0)},p(U,[$]){if($&1){J=U[0];let z;for(z=0;z<J.length;z+=1){const ee=zn(U,J,z);K[z]?K[z].p(ee,$):(K[z]=Fn(ee),K[z].c(),K[z].m(d,p))}for(;z<K.length;z+=1)K[z].d(1);K.length=J.length}U[2]?W||(W=Wn(),W.c(),W.m(d,null)):W&&(W.d(1),W=null),U[4]?T?T.p(U,$):(T=Kn(U),T.c(),T.m(n,_)):T&&(T.d(1),T=null),U[3]?A?A.p(U,$):(A=Gn(U),A.c(),A.m(n,y)):A&&(A.d(1),A=null),$&2&&Ae(k,U[1]),(!I||$&6&&V!==(V=U[2]||!U[1].trim()))&&(w.disabled=V)},i(U){I||(B(e.$$.fragment,U),I=!0)},o(U){Q(e.$$.fragment,U),I=!1},d(U){ce(e,U),U&&R(t),U&&R(o),Ye(K,U),W&&W.d(),T&&T.d(),A&&A.d(),H=!1,Je(P)}}}function Mi(l,e,t){let o=[],n="",u=!1,r=null,c=null;function i(_){t(0,o=[...o,{role:"user",content:_}])}async function d(){var h;if(!n.trim()||u)return;t(3,r=null);const _=Ze(At),y=n.trim();t(1,n=""),i(y),t(2,u=!0);try{const b=await fetch(`${rt.ServerURL}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({role:_,messages:o})});if(!b.ok)throw new Error(`HTTP ${b.status}`);const k=await b.json();t(4,c=k.model_used??null),((h=k.status)==null?void 0:h.toLowerCase())==="success"&&k.message?t(0,o=[...o,{role:"assistant",content:k.message}]):t(3,r=k.error||"Chat failed")}catch(b){t(3,r=(b==null?void 0:b.message)||String(b))}finally{t(2,u=!1)}}function p(_){(_.key==="Enter"||_.key==="Return")&&!_.shiftKey&&(_.preventDefault(),d())}qt(()=>{t(0,o=[{role:"assistant",content:"Hi! How can I help you? Ask me anything about your search results or documents."}])});function m(){n=this.value,t(1,n)}return[o,n,u,r,c,d,p,m]}class ji extends mt{constructor(e){super(),_t(this,e,Mi,Ii,at,{})}}function Hi(l){let e,t;return e=new hi({}),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},i(o){t||(B(e.$$.fragment,o),t=!0)},o(o){Q(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function zi(l){let e,t;return e=new ar({}),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},i(o){t||(B(e.$$.fragment,o),t=!0)},o(o){Q(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function Fi(l){let e,t;return e=new Ri({}),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},i(o){t||(B(e.$$.fragment,o),t=!0)},o(o){Q(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function Wi(l){let e,t;return e=new Ei({}),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},i(o){t||(B(e.$$.fragment,o),t=!0)},o(o){Q(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function Ki(l){let e,t;return e=new Di({}),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},i(o){t||(B(e.$$.fragment,o),t=!0)},o(o){Q(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function Gi(l){let e,t;return e=new ji({}),{c(){ae(e.$$.fragment)},m(o,n){ue(e,o,n),t=!0},i(o){t||(B(e.$$.fragment,o),t=!0)},o(o){Q(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function Bi(l){let e;return{c(){e=f("nav"),e.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
            <a class="navbar-item" href="/config/wizard">Wizard</a> 
            <a class="navbar-item" href="/config/json">JSON Editor</a> 
            <a class="navbar-item" href="/graph">Graph</a> 
            <a class="navbar-item" href="/chat">Chat</a></div>`,a(e,"class","navbar")},m(t,o){L(t,e,o)},p:ye,d(t){t&&R(e)}}}function qi(l){let e,t,o,n,u,r,c,i,d,p,m,_,y,h,b,k,C,v,w,S,V,I,H,P,J,K,W,T,A,U;return c=new Ll({}),p=new Pt({props:{path:"/",$$slots:{default:[Hi]},$$scope:{ctx:l}}}),h=new Pt({props:{path:"/fetch/*",$$slots:{default:[zi]},$$scope:{ctx:l}}}),k=new Pt({props:{path:"/config/wizard",$$slots:{default:[Fi]},$$scope:{ctx:l}}}),v=new Pt({props:{path:"/config/json",$$slots:{default:[Wi]},$$scope:{ctx:l}}}),S=new Pt({props:{path:"/graph",$$slots:{default:[Ki]},$$scope:{ctx:l}}}),I=new Pt({props:{path:"/chat",$$slots:{default:[Gi]},$$scope:{ctx:l}}}),K=new Pt({props:{path:"/",$$slots:{default:[Bi]},$$scope:{ctx:l}}}),{c(){e=f("meta"),t=g(),o=f("div"),n=f("main"),u=f("div"),r=f("div"),ae(c.$$.fragment),i=g(),d=f("div"),ae(p.$$.fragment),m=g(),_=f("br"),y=g(),ae(h.$$.fragment),b=g(),ae(k.$$.fragment),C=g(),ae(v.$$.fragment),w=g(),ae(S.$$.fragment),V=g(),ae(I.$$.fragment),H=g(),P=f("footer"),J=f("div"),ae(K.$$.fragment),a(e,"name","color-scheme"),a(e,"content",l[1]),document.title="Terraphim",a(r,"class","role-selector svelte-1bfpta4"),a(u,"class","top-controls svelte-1bfpta4"),a(d,"class","search-area svelte-1bfpta4"),a(n,"class","main-content svelte-1bfpta4"),a(J,"class",W=Nt(l[0])+" svelte-1bfpta4"),a(P,"class","svelte-1bfpta4"),a(o,"class","is-full-height svelte-1bfpta4")},m($,z){s(document.head,e),L($,t,z),L($,o,z),s(o,n),s(n,u),s(u,r),ue(c,r,null),s(n,i),s(n,d),ue(p,d,null),s(n,m),s(n,_),s(n,y),ue(h,n,null),s(n,b),ue(k,n,null),s(n,C),ue(v,n,null),s(n,w),ue(S,n,null),s(n,V),ue(I,n,null),s(o,H),s(o,P),s(P,J),ue(K,J,null),T=!0,A||(U=[Z(P,"mouseover",l[2]),Z(P,"focus",l[2])],A=!0)},p($,[z]){(!T||z&2)&&a(e,"content",$[1]);const ee={};z&8&&(ee.$$scope={dirty:z,ctx:$}),p.$set(ee);const q={};z&8&&(q.$$scope={dirty:z,ctx:$}),h.$set(q);const Y={};z&8&&(Y.$$scope={dirty:z,ctx:$}),k.$set(Y);const O={};z&8&&(O.$$scope={dirty:z,ctx:$}),v.$set(O);const E={};z&8&&(E.$$scope={dirty:z,ctx:$}),S.$set(E);const N={};z&8&&(N.$$scope={dirty:z,ctx:$}),I.$set(N);const D={};z&8&&(D.$$scope={dirty:z,ctx:$}),K.$set(D),(!T||z&1&&W!==(W=Nt($[0])+" svelte-1bfpta4"))&&a(J,"class",W)},i($){T||(B(c.$$.fragment,$),B(p.$$.fragment,$),B(h.$$.fragment,$),B(k.$$.fragment,$),B(v.$$.fragment,$),B(S.$$.fragment,$),B(I.$$.fragment,$),B(K.$$.fragment,$),T=!0)},o($){Q(c.$$.fragment,$),Q(p.$$.fragment,$),Q(h.$$.fragment,$),Q(k.$$.fragment,$),Q(v.$$.fragment,$),Q(S.$$.fragment,$),Q(I.$$.fragment,$),Q(K.$$.fragment,$),T=!1},d($){R(e),$&&R(t),$&&R(o),ce(c),ce(p),ce(h),ce(k),ce(v),ce(S),ce(I),ce(K),A=!1,Je(U)}}}function Ji(l,e,t){let o;Re(l,pl,r=>t(1,o=r));let n="is-hidden";function u(){t(0,n="")}return[n,o,u]}class Vi extends mt{constructor(e){super(),_t(this,e,Ji,qi,at,{})}}const Qi=new Cs;Ss(Qi);new Vi({target:document.getElementById("app")});
