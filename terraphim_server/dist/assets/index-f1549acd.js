var Ms=Object.defineProperty;var Is=(l,e,t)=>e in l?Ms(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var Ct=(l,e,t)=>(Is(l,typeof e!="symbol"?e+"":e,t),t);import{aa as Lt,S as _t,i as ht,s as ft,q as f,Y as K,b as E,y as s,Z as we,I as Pe,j as R,ak as Ue,F as rt,m as Qt,a as h,v as i,l as le,E as Ze,au as qt,r as ge,z as ve,t as Y,d as oe,B as be,av as Us,aw as Yt,H as st,U as at,V as ct,ax as Nl,ay as js,g as Qe,e as Ye,O as xe,af as St,o as gs,W as ke,az as Pl,aA as $t,aB as vs,aC as bs,a1 as Oe,C as it,aD as qe,aE as Kl,D as il,G as al,aF as Ml,w as Pt,x as ut,A as Wl,a2 as Hs,aG as jt,ac as zs,a5 as Fs,a7 as qs,a9 as Ks,n as Ws,k as Gs,_ as jl}from"./vendor-ui-cd3d2b6a.js";import{R as Nt,S as Il,f as Bs,Y as Hl}from"./vendor-utils-740e9743.js";import{J as ks,_ as Js,d as ws,P as Vs,k as Qs,D as Ys,l as Zs,E as Xs,o as gn}from"./vendor-editor-992829d3.js";import{P as ys,T as Dl,u as Cs,y as xs,A as er,S as tr,q as lr}from"./vendor-atomic-1ea13e29.js";import{t as nr,E as or}from"./novel-editor-becefd2f.js";import{s as zl,z as sr,a as rr,l as ir,m as ar,c as cr,b as ur,B as fr,d as dr}from"./vendor-charts-e6a4a6c9.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const r of c.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function t(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(o){if(o.ep)return;o.ep=!0;const c=t(o);fetch(o.href,c)}})();const Xe={ServerURL:location.protocol+"//"+window.location.host||"/"},_l=Lt([]),pr={id:"Desktop",global_shortcut:"",roles:{},default_role:{original:"",lowercase:""},selected_role:{original:"",lowercase:""}},hl=Lt("spacelab"),Et=Lt("selected"),ot=Lt(!1),mr=Lt(`${Xe.ServerURL}/documents/search`),At=Lt(pr),vn=Lt([]);let zt=Lt("");const Tt=Lt(!1);let Vt=null;function _r(l){if(typeof document>"u")return;const e=`/assets/bulmaswatch/${l}/bulmaswatch.min.css`;if(Vt!=null&&Vt.href.endsWith(e))return;const t=document.createElement("link");t.rel="stylesheet",t.href=e,t.id="bulma-theme",t.onload=()=>{Vt&&Vt!==t&&Vt.remove(),Vt=t},document.head.appendChild(t);const n=document.head.querySelector('meta[name="color-scheme"]');n&&n.setAttribute("content",l)}hl.subscribe(_r);function hr(l){let e,t;return{c(){e=f("option"),t=K(l[1]),e.__value=l[0],e.value=e.__value},m(n,o){E(n,e,o),s(e,t)},p(n,[o]){o&2&&we(t,n[1]),o&1&&(e.__value=n[0],e.value=e.__value)},i:Pe,o:Pe,d(n){n&&R(e)}}}function gr(l,e,t){let n,{subject:o}=e;const c=ys(o),r=Dl(c,Cs.properties.name);return Ue(l,r,u=>t(1,n=u)),Dl(c,"http://localhost:9883/property/theme"),l.$$set=u=>{"subject"in u&&t(0,o=u.subject)},[o,n,r]}class vr extends _t{constructor(e){super(),ht(this,e,gr,hr,ft,{subject:0})}}function bn(l){let e,t,n,o,c,r,u=l[0]&&kn();return{c(){e=f("button"),t=f("span"),t.innerHTML='<i class="fas fa-arrow-left"></i>',n=h(),u&&u.c(),i(t,"class","icon svelte-rnsqpo"),i(e,"class",o="button is-light back-button "+l[1]+" svelte-rnsqpo"),i(e,"title","Go back"),i(e,"aria-label","Go back")},m(a,d){E(a,e,d),s(e,t),s(e,n),u&&u.m(e,null),c||(r=[le(e,"click",l[3]),le(e,"keydown",l[6])],c=!0)},p(a,d){a[0]?u||(u=kn(),u.c(),u.m(e,null)):u&&(u.d(1),u=null),d&2&&o!==(o="button is-light back-button "+a[1]+" svelte-rnsqpo")&&i(e,"class",o)},d(a){a&&R(e),u&&u.d(),c=!1,Ze(r)}}}function kn(l){let e;return{c(){e=f("span"),e.textContent="Back",i(e,"class","back-text svelte-rnsqpo")},m(t,n){E(t,e,n)},d(t){t&&R(e)}}}function br(l){let e,t=l[2]&&bn(l);return{c(){t&&t.c(),e=rt()},m(n,o){t&&t.m(n,o),E(n,e,o)},p(n,[o]){n[2]?t?t.p(n,o):(t=bn(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Pe,o:Pe,d(n){t&&t.d(n),n&&R(e)}}}function kr(l,e,t){let{fallbackPath:n="/"}=e,{showText:o=!0}=e,{customClass:c=""}=e,{hideOnPaths:r=["/"]}=e,u=!0;function a(){var p;try{const _=((p=window.location)==null?void 0:p.pathname)||"/";t(2,u=!r.includes(_))}catch{t(2,u=!0)}}function d(){window.history.length>1?window.history.back():window.location.href=n}Qt(()=>(a(),window.addEventListener("popstate",a),window.addEventListener("hashchange",a),()=>{window.removeEventListener("popstate",a),window.removeEventListener("hashchange",a)}));const m=p=>{(p.key==="Enter"||p.key===" ")&&(p.preventDefault(),d())};return l.$$set=p=>{"fallbackPath"in p&&t(4,n=p.fallbackPath),"showText"in p&&t(0,o=p.showText),"customClass"in p&&t(1,c=p.customClass),"hideOnPaths"in p&&t(5,r=p.hideOnPaths)},[o,c,u,d,n,r,m]}class cl extends _t{constructor(e){super(),ht(this,e,kr,br,ft,{fallbackPath:4,showText:0,customClass:1,hideOnPaths:5})}}function wr(){return window.crypto.getRandomValues(new Uint32Array(1))[0]}function Fl(l,e=!1){const t=wr(),n=`_${t}`;return Object.defineProperty(window,n,{value:o=>(e&&Reflect.deleteProperty(window,n),l==null?void 0:l(o)),writable:!1,configurable:!0}),t}async function Fe(l,e={}){return new Promise((t,n)=>{const o=Fl(r=>{t(r),Reflect.deleteProperty(window,`_${c}`)},!0),c=Fl(r=>{n(r),Reflect.deleteProperty(window,`_${o}`)},!0);window.__TAURI_IPC__({cmd:l,callback:o,error:c,...e})})}function wn(l,e,t){const n=l.slice();return n[25]=e[t],n}function yr(l){let e,t,n;function o(r){l[13](r)}let c={};return l[5]!==void 0&&(c.value=l[5]),e=new Yt({props:c}),st.push(()=>at(e,"value",o)),{c(){ge(e.$$.fragment)},m(r,u){ve(e,r,u),n=!0},p(r,u){const a={};!t&&u&32&&(t=!0,a.value=r[5],ct(()=>t=!1)),e.$set(a)},i(r){n||(Y(e.$$.fragment,r),n=!0)},o(r){oe(e.$$.fragment,r),n=!1},d(r){be(e,r)}}}function Cr(l){let e,t,n;function o(r){l[14](r)}let c={type:"password",placeholder:"secret",icon:"fas fa-lock",expanded:!0};return l[6]!==void 0&&(c.value=l[6]),e=new Yt({props:c}),st.push(()=>at(e,"value",o)),{c(){ge(e.$$.fragment)},m(r,u){ve(e,r,u),n=!0},p(r,u){const a={};!t&&u&64&&(t=!0,a.value=r[6],ct(()=>t=!1)),e.$set(a)},i(r){n||(Y(e.$$.fragment,r),n=!0)},o(r){oe(e.$$.fragment,r),n=!1},d(r){be(e,r)}}}function Tr(l){let e;return{c(){e=K("Save")},m(t,n){E(t,e,n)},d(t){t&&R(e)}}}function $r(l){let e,t;return e=new Nl({props:{type:"is-success",class:"is-right",iconPack:"fa",iconLeft:"check",$$slots:{default:[Tr]},$$scope:{ctx:l}}}),e.$on("click",l[8]),e.$on("submit",l[8]),{c(){ge(e.$$.fragment)},m(n,o){ve(e,n,o),t=!0},p(n,o){const c={};o&268435456&&(c.$$scope={dirty:o,ctx:n}),e.$set(c)},i(n){t||(Y(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){be(e,n)}}}function Sr(l){let e,t,n,o,c,r;return e=new qt({props:{$$slots:{default:[yr]},$$scope:{ctx:l}}}),n=new qt({props:{grouped:!0,$$slots:{default:[Cr]},$$scope:{ctx:l}}}),c=new qt({props:{grouped:!0,$$slots:{default:[$r]},$$scope:{ctx:l}}}),{c(){ge(e.$$.fragment),t=h(),ge(n.$$.fragment),o=h(),ge(c.$$.fragment)},m(u,a){ve(e,u,a),E(u,t,a),ve(n,u,a),E(u,o,a),ve(c,u,a),r=!0},p(u,a){const d={};a&268435488&&(d.$$scope={dirty:a,ctx:u}),e.$set(d);const m={};a&268435520&&(m.$$scope={dirty:a,ctx:u}),n.$set(m);const p={};a&268435456&&(p.$$scope={dirty:a,ctx:u}),c.$set(p)},i(u){r||(Y(e.$$.fragment,u),Y(n.$$.fragment,u),Y(c.$$.fragment,u),r=!0)},o(u){oe(e.$$.fragment,u),oe(n.$$.fragment,u),oe(c.$$.fragment,u),r=!1},d(u){be(e,u),u&&R(t),be(n,u),u&&R(o),be(c,u)}}}function Rr(l){let e,t,n;function o(r){l[15](r)}let c={type:"search",placeholder:"Fetch JSON",icon:"search"};return l[3]!==void 0&&(c.value=l[3]),e=new Yt({props:c}),st.push(()=>at(e,"value",o)),{c(){ge(e.$$.fragment)},m(r,u){ve(e,r,u),n=!0},p(r,u){const a={};!t&&u&8&&(t=!0,a.value=r[3],ct(()=>t=!1)),e.$set(a)},i(r){n||(Y(e.$$.fragment,r),n=!0)},o(r){oe(e.$$.fragment,r),n=!1},d(r){be(e,r)}}}function Er(l){let e;return{c(){e=K("WikiPage")},m(t,n){E(t,e,n)},d(t){t&&R(e)}}}function Ar(l){let e,t,n,o,c,r;function u(p){l[16](p)}let a={type:"search",placeholder:"Post JSON",icon:"search"};l[4]!==void 0&&(a.value=l[4]),e=new Yt({props:a}),st.push(()=>at(e,"value",u));function d(p){l[17](p)}let m={$$slots:{default:[Er]},$$scope:{ctx:l}};return l[2]!==void 0&&(m.checked=l[2]),o=new js({props:m}),st.push(()=>at(o,"checked",d)),{c(){ge(e.$$.fragment),n=h(),ge(o.$$.fragment)},m(p,_){ve(e,p,_),E(p,n,_),ve(o,p,_),r=!0},p(p,_){const v={};!t&&_&16&&(t=!0,v.value=p[4],ct(()=>t=!1)),e.$set(v);const y={};_&268435456&&(y.$$scope={dirty:_,ctx:p}),!c&&_&4&&(c=!0,y.checked=p[2],ct(()=>c=!1)),o.$set(y)},i(p){r||(Y(e.$$.fragment,p),Y(o.$$.fragment,p),r=!0)},o(p){oe(e.$$.fragment,p),oe(o.$$.fragment,p),r=!1},d(p){be(e,p),p&&R(n),be(o,p)}}}function Lr(l){let e;return{c(){e=K("Fetch")},m(t,n){E(t,e,n)},d(t){t&&R(e)}}}function Or(l){let e,t;return e=new Nl({props:{type:"is-primary",$$slots:{default:[Lr]},$$scope:{ctx:l}}}),e.$on("click",l[9]),e.$on("submit",l[9]),{c(){ge(e.$$.fragment)},m(n,o){ve(e,n,o),t=!0},p(n,o){const c={};o&268435456&&(c.$$scope={dirty:o,ctx:n}),e.$set(c)},i(n){t||(Y(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){be(e,n)}}}function Nr(l){let e,t,n,o,c,r;return e=new qt({props:{grouped:!0,$$slots:{default:[Rr]},$$scope:{ctx:l}}}),n=new qt({props:{grouped:!0,$$slots:{default:[Ar]},$$scope:{ctx:l}}}),c=new qt({props:{grouped:!0,$$slots:{default:[Or]},$$scope:{ctx:l}}}),{c(){ge(e.$$.fragment),t=h(),ge(n.$$.fragment),o=h(),ge(c.$$.fragment)},m(u,a){ve(e,u,a),E(u,t,a),ve(n,u,a),E(u,o,a),ve(c,u,a),r=!0},p(u,a){const d={};a&268435464&&(d.$$scope={dirty:a,ctx:u}),e.$set(d);const m={};a&268435476&&(m.$$scope={dirty:a,ctx:u}),n.$set(m);const p={};a&268435456&&(p.$$scope={dirty:a,ctx:u}),c.$set(p)},i(u){r||(Y(e.$$.fragment,u),Y(n.$$.fragment,u),Y(c.$$.fragment,u),r=!0)},o(u){oe(e.$$.fragment,u),oe(n.$$.fragment,u),oe(c.$$.fragment,u),r=!1},d(u){be(e,u),u&&R(t),be(n,u),u&&R(o),be(c,u)}}}function Dr(l){let e,t,n,o,c;return o=new ks({props:{content:l[1],onChange:l[7]}}),{c(){e=f("p"),e.innerHTML=`<i>The best editing experience is to configure Atomic Server, in the
        meantime use editor below. You will need to refresh page via Command R
        or Ctrl-R to see changes</i>`,t=h(),n=f("div"),ge(o.$$.fragment),i(n,"class","editor")},m(r,u){E(r,e,u),E(r,t,u),E(r,n,u),ve(o,n,null),c=!0},p(r,u){const a={};u&2&&(a.content=r[1]),o.$set(a)},i(r){c||(Y(o.$$.fragment,r),c=!0)},o(r){oe(o.$$.fragment,r),c=!1},d(r){r&&R(e),r&&R(t),r&&R(n),be(o)}}}function yn(l){let e,t;return e=new vr({props:{subject:l[25]}}),{c(){ge(e.$$.fragment)},m(n,o){ve(e,n,o),t=!0},p(n,o){const c={};o&1&&(c.subject=n[25]),e.$set(c)},i(n){t||(Y(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){be(e,n)}}}function Pr(l){let e,t,n=l[0]??[],o=[];for(let r=0;r<n.length;r+=1)o[r]=yn(wn(l,n,r));const c=r=>oe(o[r],1,1,()=>{o[r]=null});return{c(){for(let r=0;r<o.length;r+=1)o[r].c();e=rt()},m(r,u){for(let a=0;a<o.length;a+=1)o[a]&&o[a].m(r,u);E(r,e,u),t=!0},p(r,u){if(u&1){n=r[0]??[];let a;for(a=0;a<n.length;a+=1){const d=wn(r,n,a);o[a]?(o[a].p(d,u),Y(o[a],1)):(o[a]=yn(d),o[a].c(),Y(o[a],1),o[a].m(e.parentNode,e))}for(Qe(),a=n.length;a<o.length;a+=1)c(a);Ye()}},i(r){if(!t){for(let u=0;u<n.length;u+=1)Y(o[u]);t=!0}},o(r){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)oe(o[u]);t=!1},d(r){xe(o,r),r&&R(e)}}}function Mr(l){let e,t;return e=new Us({props:{$$slots:{default:[Pr]},$$scope:{ctx:l}}}),{c(){ge(e.$$.fragment)},m(n,o){ve(e,n,o),t=!0},p(n,o){const c={};o&268435457&&(c.$$scope={dirty:o,ctx:n}),e.$set(c)},i(n){t||(Y(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){be(e,n)}}}function Ir(l){let e,t,n,o,c,r,u,a,d,m,p,_,v,y,b;return e=new cl({props:{fallbackPath:"/"}}),o=new Nt({props:{path:"/atomic",$$slots:{default:[Sr]},$$scope:{ctx:l}}}),r=new Nt({props:{path:"/json",$$slots:{default:[Nr]},$$scope:{ctx:l}}}),a=new Nt({props:{path:"/editor",$$slots:{default:[Dr]},$$scope:{ctx:l}}}),_=new qt({props:{grouped:!0,position:"is-right",$$slots:{default:[Mr]},$$scope:{ctx:l}}}),{c(){ge(e.$$.fragment),t=h(),n=f("div"),ge(o.$$.fragment),c=h(),ge(r.$$.fragment),u=h(),ge(a.$$.fragment),d=h(),m=f("hr"),p=h(),ge(_.$$.fragment),v=h(),y=f("nav"),y.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
    <a class="navbar-item" href="/fetch/json">Fetch JSON Data</a> 
    <a class="navbar-item" href="/fetch/atomic">Set Atomic Server</a> 
    <a class="navbar-item" href="/fetch/editor">Edit JSON config</a></div>`,i(n,"class","box"),i(y,"class","navbar")},m(k,w){ve(e,k,w),E(k,t,w),E(k,n,w),ve(o,n,null),s(n,c),ve(r,n,null),s(n,u),ve(a,n,null),E(k,d,w),E(k,m,w),E(k,p,w),ve(_,k,w),E(k,v,w),E(k,y,w),b=!0},p(k,[w]){const C={};w&268435552&&(C.$$scope={dirty:w,ctx:k}),o.$set(C);const g={};w&268435484&&(g.$$scope={dirty:w,ctx:k}),r.$set(g);const S={};w&268435458&&(S.$$scope={dirty:w,ctx:k}),a.$set(S);const z={};w&268435457&&(z.$$scope={dirty:w,ctx:k}),_.$set(z)},i(k){b||(Y(e.$$.fragment,k),Y(o.$$.fragment,k),Y(r.$$.fragment,k),Y(a.$$.fragment,k),Y(_.$$.fragment,k),b=!0)},o(k){oe(e.$$.fragment,k),oe(o.$$.fragment,k),oe(r.$$.fragment,k),oe(a.$$.fragment,k),oe(_.$$.fragment,k),b=!1},d(k){be(e,k),k&&R(t),k&&R(n),be(o),be(r),be(a),k&&R(d),k&&R(m),k&&R(p),be(_,k),k&&R(v),k&&R(y)}}}function Ur(l,e,t){let n,o,c,r,u;Ue(l,xs,O=>t(19,c=O)),Ue(l,ot,O=>t(20,r=O)),Ue(l,At,O=>t(21,u=O));let a={json:u};function d(O){if(console.log("contents changed:",O),console.log("is tauri",r),At.update(A=>(A=O.json,A)),ot)console.log("Updating config on server"),Fe("update_config",{configNew:O.json}).then(A=>{console.log(`Message: ${A}`)}).catch(A=>console.error(A));else{let A=`${Xe.ServerURL}/config/`;fetch(A,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(O.json)})}t(1,a=O)}let m=!1,p="https://raw.githubusercontent.com/terraphim/terraphim-cloud-fastapi/main/data/ref_arch.json",_="http://localhost:8000/documents/",v="http://localhost:9883/",y;const b=async()=>{console.log("Updating atomic server configuration");const O=er.fromSecret(y);c.setServerUrl(v),console.log("Server set.Setting agent"),c.setAgent(O)},k=async()=>{g()},w=({data:{msg:O,data:A}})=>{console.log(O,A)};let C;const g=async()=>{const O=await Js(()=>import("./fetcher.worker-7e58969a.js"),[]);C=new O.default,C.onmessage=w;const A={msg:"fetcher",data:{url:p,postUrl:_,isWiki:m}};C.postMessage(A)},S=ys("http://localhost:9883/config/y3zx5wtm0bq"),z=Dl(S,Cs.properties.name);Ue(l,z,O=>t(12,o=O));const N=Dl(S,"http://localhost:9883/property/role");Ue(l,N,O=>t(0,n=O));function D(O){v=O,t(5,v)}function L(O){y=O,t(6,y)}function q(O){p=O,t(3,p)}function X(O){_=O,t(4,_)}function G(O){m=O,t(2,m)}return l.$$.update=()=>{l.$$.dirty&4096&&console.log("Print name",o),l.$$.dirty&1&&console.log("Print roles",n)},[n,a,m,p,_,v,y,d,b,k,z,N,o,D,L,q,X,G]}class jr extends _t{constructor(e){super(),ht(this,e,Ur,Ir,ft,{})}}function Ft(){return St(ot)||typeof window<"u"&&window.__TAURI__!==void 0}class Hr{constructor(){Ct(this,"baseUrl");Ct(this,"autocompleteIndexBuilt",!1);Ct(this,"sessionId");Ct(this,"currentRole","Default");Ct(this,"connectionRetries",0);Ct(this,"maxRetries",3);Ct(this,"retryDelay",1e3);Ct(this,"isConnecting",!1);this.baseUrl=typeof window<"u"?(window.location.protocol==="https:"?"https://":"http://")+window.location.hostname+":8001":"http://localhost:8001",this.sessionId=`novel-${Date.now()}`,typeof window<"u"&&!Ft()&&this.shouldPerformHealthCheck()?this.detectServerPort():typeof window<"u"&&!Ft()&&console.log("NovelAutocompleteService: Skipping server detection - not needed for current page")}setRole(e){this.currentRole=e,this.autocompleteIndexBuilt=!1}async detectServerPort(){if(Ft())return;if(!this.shouldPerformHealthCheck()){console.log("NovelAutocompleteService: Skipping health check - service not needed");return}const t=[8001,3e3];for(const n of t)try{const o=typeof window<"u"?(window.location.protocol==="https:"?"https://":"http://")+window.location.hostname+":"+n:"http://localhost:"+n,c=await fetch(`${o}/message?sessionId=health-check`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:0,method:"ping",params:{}}),signal:AbortSignal.timeout(1e3)});if(c.ok||c.status===404){this.baseUrl=o,console.log(`NovelAutocompleteService: Detected server at ${o}`);return}}catch{continue}console.warn("NovelAutocompleteService: Could not detect running server, using default:",this.baseUrl)}shouldPerformHealthCheck(){return!(typeof window<"u"&&(!window.location.pathname.startsWith("/chat")||!(document.querySelector('[contenteditable="true"]')||document.querySelector("textarea")||document.querySelector('input[type="text"]'))))}async buildAutocompleteIndex(){if(this.isConnecting)return await new Promise(e=>setTimeout(e,1e3)),this.autocompleteIndexBuilt;this.isConnecting=!0;try{return Ft()?(console.log("Using Tauri backend - no index building required"),this.autocompleteIndexBuilt=!0,this.connectionRetries=0,console.log("Tauri autocomplete ready"),!0):await this.buildMCPIndex()}catch(e){return console.error("Error building Novel autocomplete index:",e),!1}finally{this.isConnecting=!1}}async buildMCPIndex(){for(let e=0;e<=this.maxRetries;e++)try{const t=await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:Date.now(),method:"tools/call",params:{name:"build_autocomplete_index",arguments:{}}}),signal:AbortSignal.timeout(1e4)});if(t.ok){const n=await t.json();if(console.log(`MCP build index response (attempt ${e+1}):`,n),n.result&&!n.result.is_error)return this.autocompleteIndexBuilt=!0,this.connectionRetries=0,console.log("MCP autocomplete index built successfully"),!0}else if(t.status>=500&&e<this.maxRetries){console.warn(`MCP server error ${t.status}, retrying in ${this.retryDelay}ms...`),await new Promise(n=>setTimeout(n,this.retryDelay*(e+1)));continue}console.warn(`MCP build index failed (attempt ${e+1}):`,t.status,t.statusText)}catch(t){t instanceof Error&&t.name==="AbortError"?console.warn(`MCP request timeout (attempt ${e+1})`):console.warn(`MCP connection error (attempt ${e+1}):`,t),e<this.maxRetries&&await new Promise(n=>setTimeout(n,this.retryDelay*(e+1)))}return console.error("Failed to build MCP autocomplete index after all retries"),!1}async getCompletion(e){if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return{text:""};try{const t=this.extractLastWord(e.prompt);if(!t||t.length<1)return{text:""};const n=await this.getSuggestionsWithSnippets(t,5);if(n.length===0)return{text:""};let c=n[0].text;c.toLowerCase().startsWith(t.toLowerCase())&&(c=c.substring(t.length));const r=e.prompt.length/4,u=c.length/4;return{text:c,usage:{promptTokens:Math.round(r),completionTokens:Math.round(u),totalTokens:Math.round(r+u)}}}catch(t){return console.error("Error getting Novel autocomplete completion:",t),{text:""}}}async getSuggestions(e,t=10){if(!e||e.trim().length===0)return[];if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return console.warn("Autocomplete index not built, returning empty suggestions"),[];try{return Ft()?await this.getTauriSuggestions(e,t):await this.getMCPSuggestions(e,t,"autocomplete_terms")}catch(n){return console.error("Error getting autocomplete suggestions:",n),[]}}async getTauriSuggestions(e,t){const n=await Fe("get_autocomplete_suggestions",{query:e.trim(),role_name:this.currentRole,limit:t});return console.log("Tauri autocomplete response:",n),n&&n.status==="success"&&n.suggestions?n.suggestions.map(o=>({text:o.term||o.text||"",snippet:o.url||o.snippet||"",score:o.score||1})).filter(o=>o.text.length>0):(n&&n.error&&console.error("Tauri autocomplete error:",n.error),[])}async getMCPSuggestions(e,t,n){const o=Date.now(),c=await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:o,method:"tools/call",params:{name:n,arguments:{query:e.trim(),limit:t,role:this.currentRole}}}),signal:AbortSignal.timeout(5e3)});if(!c.ok)return console.error(`MCP ${n} request failed:`,c.status,c.statusText),[];const r=await c.json();return console.log(`MCP ${n} response:`,r),r.result&&!r.result.is_error&&r.result.content?n==="autocomplete_with_snippets"?this.parseAutocompleteWithSnippetsContent(r.result.content):this.parseAutocompleteContent(r.result.content):(r.error&&console.error(`MCP ${n} error:`,r.error),[])}async getSuggestionsWithSnippets(e,t=10){if(!e||e.trim().length===0)return[];if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return console.warn("Autocomplete index not built, returning empty suggestions with snippets"),[];try{return Ft()?await this.getTauriSuggestions(e,t):await this.getMCPSuggestions(e,t,"autocomplete_with_snippets")}catch(n){return console.error("Error getting autocomplete suggestions with snippets:",n),[]}}extractLastWord(e){const t=e.trim().split(/\s+/);return t[t.length-1]||""}parseAutocompleteContent(e){const t=[];for(const n of e)if(n.type==="text"&&n.text){if(!n.text.startsWith("Found")&&!n.text.startsWith("•"))t.push({text:n.text.trim()});else if(n.text.startsWith("•")){const o=n.text.replace("•","").trim();o&&t.push({text:o})}}return t}parseAutocompleteWithSnippetsContent(e){const t=[];for(const n of e)if(n.type==="text"&&n.text){if(!n.text.startsWith("Found")&&!n.text.startsWith("•")){const o=n.text.split(" — ");o.length===2?t.push({text:o[0].trim(),snippet:o[1].trim()}):t.push({text:n.text.trim()})}else if(n.text.startsWith("•")){const o=n.text.replace("•","").trim();o&&t.push({text:o})}}return t}isReady(){return this.autocompleteIndexBuilt}getStatus(){return{ready:this.autocompleteIndexBuilt,baseUrl:this.baseUrl,sessionId:this.sessionId,usingTauri:Ft(),currentRole:this.currentRole,connectionRetries:this.connectionRetries,isConnecting:this.isConnecting}}async refreshIndex(){return this.autocompleteIndexBuilt=!1,this.connectionRetries=0,await this.buildAutocompleteIndex()}async testConnection(){try{if(Ft()){const e=await Fe("get_autocomplete_suggestions",{query:"test",role_name:this.currentRole,limit:1});return e&&(e.status==="success"||e.status==="error")}else return(await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:Date.now(),method:"tools/list",params:{}}),signal:AbortSignal.timeout(3e3)})).ok}catch(e){return console.warn("Connection test failed:",e),!1}}}const Dt=new Hr;function zr(l){var e;const{char:t,allowSpaces:n,allowToIncludeChar:o,allowedPrefixes:c,startOfLine:r,$position:u}=l,a=n&&!o,d=Zs(t),m=new RegExp(`\\s${d}$`),p=r?"^":"",_=o?"":d,v=a?new RegExp(`${p}${d}.*?(?=\\s${_}|$)`,"gm"):new RegExp(`${p}(?:^)?${d}[^\\s${_}]*`,"gm"),y=((e=u.nodeBefore)===null||e===void 0?void 0:e.isText)&&u.nodeBefore.text;if(!y)return null;const b=u.pos-y.length,k=Array.from(y.matchAll(v)).pop();if(!k||k.input===void 0||k.index===void 0)return null;const w=k.input.slice(Math.max(0,k.index-1),k.index),C=new RegExp(`^[${c==null?void 0:c.join("")}\0]?$`).test(w);if(c!==null&&!C)return null;const g=b+k.index;let S=g+k[0].length;return a&&m.test(y.slice(S-1,S+1))&&(k[0]+=" ",S+=1),g<u.pos&&S>=u.pos?{range:{from:g,to:S},query:k[0].slice(t.length),text:k[0]}:null}const Fr=new ws("suggestion");function qr({pluginKey:l=Fr,editor:e,char:t="@",allowSpaces:n=!1,allowToIncludeChar:o=!1,allowedPrefixes:c=[" "],startOfLine:r=!1,decorationTag:u="span",decorationClass:a="suggestion",decorationContent:d="",decorationEmptyClass:m="is-empty",command:p=()=>null,items:_=()=>[],render:v=()=>({}),allow:y=()=>!0,findSuggestionMatch:b=zr}){let k;const w=v==null?void 0:v(),C=new Vs({key:l,view(){return{update:async(g,S)=>{var z,N,D,L,q,X,G;const O=(z=this.key)===null||z===void 0?void 0:z.getState(S),A=(N=this.key)===null||N===void 0?void 0:N.getState(g.state),ne=O.active&&A.active&&O.range.from!==A.range.from,I=!O.active&&A.active,Q=O.active&&!A.active,te=!I&&!Q&&O.query!==A.query,J=I||ne&&te,se=te||ne,P=Q||ne&&te;if(!J&&!se&&!P)return;const M=P&&!J?O:A,B=g.dom.querySelector(`[data-decoration-id="${M.decorationId}"]`);k={editor:e,range:M.range,query:M.query,text:M.text,items:[],command:F=>p({editor:e,range:M.range,props:F}),decorationNode:B,clientRect:B?()=>{var F;const{decorationId:Z}=(F=this.key)===null||F===void 0?void 0:F.getState(e.state),ie=g.dom.querySelector(`[data-decoration-id="${Z}"]`);return(ie==null?void 0:ie.getBoundingClientRect())||null}:null},J&&((D=w==null?void 0:w.onBeforeStart)===null||D===void 0||D.call(w,k)),se&&((L=w==null?void 0:w.onBeforeUpdate)===null||L===void 0||L.call(w,k)),(se||J)&&(k.items=await _({editor:e,query:M.query})),P&&((q=w==null?void 0:w.onExit)===null||q===void 0||q.call(w,k)),se&&((X=w==null?void 0:w.onUpdate)===null||X===void 0||X.call(w,k)),J&&((G=w==null?void 0:w.onStart)===null||G===void 0||G.call(w,k))},destroy:()=>{var g;k&&((g=w==null?void 0:w.onExit)===null||g===void 0||g.call(w,k))}}},state:{init(){return{active:!1,range:{from:0,to:0},query:null,text:null,composing:!1}},apply(g,S,z,N){const{isEditable:D}=e,{composing:L}=e.view,{selection:q}=g,{empty:X,from:G}=q,O={...S};if(O.composing=L,D&&(X||e.view.composing)){(G<S.range.from||G>S.range.to)&&!L&&!S.composing&&(O.active=!1);const A=b({char:t,allowSpaces:n,allowToIncludeChar:o,allowedPrefixes:c,startOfLine:r,$position:q.$from}),ne=`id_${Math.floor(Math.random()*4294967295)}`;A&&y({editor:e,state:N,range:A.range,isActive:S.active})?(O.active=!0,O.decorationId=S.decorationId?S.decorationId:ne,O.range=A.range,O.query=A.query,O.text=A.text):O.active=!1}else O.active=!1;return O.active||(O.decorationId=null,O.range={from:0,to:0},O.query=null,O.text=null),O}},props:{handleKeyDown(g,S){var z;const{active:N,range:D}=C.getState(g.state);return N&&((z=w==null?void 0:w.onKeyDown)===null||z===void 0?void 0:z.call(w,{view:g,event:S,range:D}))||!1},decorations(g){const{active:S,range:z,decorationId:N,query:D}=C.getState(g);if(!S)return null;const L=!(D!=null&&D.length),q=[a];return L&&q.push(m),Qs.create(g.doc,[Ys.inline(z.from,z.to,{nodeName:u,class:q.join(" "),"data-decoration-id":N,"data-decoration-content":d})])}}});return C}const Cn=Xs.create({name:"terraphimSuggestion",addOptions(){return{trigger:"++",pluginKey:new ws("terraphimSuggestion"),allowSpaces:!1,limit:8,minLength:1,debounce:300}},addCommands(){return{insertSuggestion:l=>({commands:e,chain:t})=>t().insertContent(l.text).run()}},addProseMirrorPlugins(){const l={editor:this.editor,char:this.options.trigger,pluginKey:this.options.pluginKey,allowSpaces:this.options.allowSpaces,startOfLine:!1,command:({editor:e,range:t,props:n})=>{const o=n;e.chain().focus().insertContentAt(t,o.text+" ").run()},items:async({query:e,editor:t})=>new Promise(n=>{setTimeout(async()=>{if(e.length<this.options.minLength){n([]);return}try{const o=await Dt.getSuggestionsWithSnippets(e,this.options.limit);console.log(`TerraphimSuggestion: Found ${o.length} suggestions for "${e}"`),n(o)}catch(o){console.error("TerraphimSuggestion: Error getting suggestions:",o),n([])}},this.options.debounce)}),render:()=>{let e,t;return{onStart:n=>{e=new Kr({items:n.items,command:n.command}),n.clientRect&&(t=nr("body",{getReferenceClientRect:n.clientRect,appendTo:()=>document.body,content:e.element,showOnCreate:!0,interactive:!0,trigger:"manual",placement:"bottom-start",theme:"terraphim-suggestion",maxWidth:"none"})[0])},onUpdate(n){e==null||e.updateItems(n.items),n.clientRect&&(t==null||t.setProps({getReferenceClientRect:n.clientRect}))},onKeyDown(n){return n.event.key==="Escape"?(t==null||t.hide(),!0):(e==null?void 0:e.onKeyDown(n))??!1},onExit(){t==null||t.destroy(),e==null||e.destroy()}}}};return[qr(l)]}});class Kr{constructor(e){Ct(this,"element");Ct(this,"items",[]);Ct(this,"selectedIndex",0);Ct(this,"command");this.items=e.items,this.command=e.command,this.element=document.createElement("div"),this.element.className="terraphim-suggestion-dropdown",this.render()}updateItems(e){this.items=e,this.selectedIndex=0,this.render()}onKeyDown({event:e}){return e.key==="ArrowUp"?(this.selectPrevious(),!0):e.key==="ArrowDown"?(this.selectNext(),!0):e.key==="Enter"||e.key==="Tab"?(this.selectItem(this.selectedIndex),!0):!1}selectPrevious(){this.selectedIndex=Math.max(0,this.selectedIndex-1),this.render()}selectNext(){this.selectedIndex=Math.min(this.items.length-1,this.selectedIndex+1),this.render()}selectItem(e){const t=this.items[e];t&&this.command({id:t.text,...t})}render(){if(this.element.innerHTML="",this.items.length===0){this.element.innerHTML=`
        <div class="terraphim-suggestion-item terraphim-suggestion-empty">
          <div class="terraphim-suggestion-text">No suggestions found</div>
          <div class="terraphim-suggestion-hint">Try a different search term</div>
        </div>
      `;return}const e=document.createElement("div");e.className="terraphim-suggestion-header",e.innerHTML=`
      <div class="terraphim-suggestion-count">${this.items.length} suggestions</div>
      <div class="terraphim-suggestion-hint">↑↓ Navigate • Tab/Enter Select • Esc Cancel</div>
    `,this.element.appendChild(e),this.items.forEach((t,n)=>{const o=document.createElement("div");o.className=`terraphim-suggestion-item ${n===this.selectedIndex?"terraphim-suggestion-selected":""}`,o.innerHTML=`
        <div class="terraphim-suggestion-main">
          <div class="terraphim-suggestion-text">${this.escapeHtml(t.text)}</div>
          ${t.snippet?`<div class="terraphim-suggestion-snippet">${this.escapeHtml(t.snippet)}</div>`:""}
        </div>
        ${t.score?`<div class="terraphim-suggestion-score">${Math.round(t.score*100)}%</div>`:""}
      `,o.addEventListener("click",()=>this.selectItem(n)),o.addEventListener("mouseenter",()=>{this.selectedIndex=n,this.render()}),this.element.appendChild(o)})}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}destroy(){this.element.remove()}}const Wr=`
.terraphim-suggestion-dropdown {
  background: white;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  box-shadow: 0 10px 38px -10px rgba(22, 23, 24, 0.35), 0 10px 20px -15px rgba(22, 23, 24, 0.2);
  max-height: 300px;
  min-width: 300px;
  overflow-y: auto;
  z-index: 1000;
}

.terraphim-suggestion-header {
  padding: 8px 12px;
  border-bottom: 1px solid #f1f5f9;
  background: #f8fafc;
  font-size: 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.terraphim-suggestion-count {
  font-weight: 600;
  color: #475569;
}

.terraphim-suggestion-hint {
  color: #64748b;
}

.terraphim-suggestion-item {
  padding: 8px 12px;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  border-bottom: 1px solid #f1f5f9;
}

.terraphim-suggestion-item:hover {
  background: #f8fafc;
}

.terraphim-suggestion-selected {
  background: #eff6ff !important;
  border-left: 3px solid #3b82f6;
}

.terraphim-suggestion-empty {
  color: #64748b;
  font-style: italic;
  text-align: center;
  cursor: default;
}

.terraphim-suggestion-main {
  flex: 1;
}

.terraphim-suggestion-text {
  font-weight: 500;
  color: #1e293b;
  margin-bottom: 2px;
}

.terraphim-suggestion-snippet {
  font-size: 12px;
  color: #64748b;
  line-height: 1.3;
}

.terraphim-suggestion-score {
  font-size: 11px;
  color: #10b981;
  font-weight: 600;
  background: #ecfdf5;
  padding: 2px 6px;
  border-radius: 4px;
  margin-left: 8px;
}

/* Dark theme support */
@media (prefers-color-scheme: dark) {
  .terraphim-suggestion-dropdown {
    background: #1e293b;
    border-color: #334155;
  }

  .terraphim-suggestion-header {
    background: #0f172a;
    border-color: #334155;
  }

  .terraphim-suggestion-item:hover {
    background: #334155;
  }

  .terraphim-suggestion-selected {
    background: #1e40af !important;
  }

  .terraphim-suggestion-text {
    color: #f1f5f9;
  }

  .terraphim-suggestion-snippet {
    color: #94a3b8;
  }
}

/* Tippy.js theme */
.tippy-box[data-theme~='terraphim-suggestion'] {
  background: transparent;
  box-shadow: none;
}

.tippy-box[data-theme~='terraphim-suggestion'] > .tippy-backdrop {
  background: transparent;
}

.tippy-box[data-theme~='terraphim-suggestion'] > .tippy-arrow {
  display: none;
}
`;function Tn(l){let e,t,n,o,c,r,u,a,d,m,p,_,v,y,b,k,w,C,g,S,z,N,D,L,q,X,G=l[12]?"Tauri (native)":`MCP Server (${Dt.getStatus().baseUrl})`,O,A,ne,I,Q,te,J,se,P,M,B,F,Z,ie,ae,$,T,H,x,ee,V=l[6]!==1?"s":"",me,fe,ue,pe,_e,he,Se,Ge,je,Ae,Re,re,ye,Ne,Be,Ke,Te,De,et=l[3]?"Enabled":"Disabled",Je,Me,He,tt,de=l[11]&&!l[8]&&$n(l);function Le(j,ce){if(j[8])return Vr;if(j[11])return Jr}let U=Le(l),W=U&&U(l);return{c(){e=f("div"),t=f("div"),n=f("strong"),n.textContent="Local Autocomplete Status:",o=h(),c=f("div"),r=f("button"),u=K("Test"),d=h(),m=f("button"),m.textContent="Rebuild Index",p=h(),_=f("button"),v=K("Demo"),b=h(),k=f("div"),w=K(l[10]),C=h(),de&&de.c(),g=h(),S=f("div"),z=f("strong"),z.textContent="Configuration:",N=h(),D=f("br"),L=K("• "),q=f("strong"),q.textContent="Backend:",X=h(),O=K(G),A=h(),ne=f("br"),I=K("• "),Q=f("strong"),Q.textContent="Role:",te=h(),J=K(l[9]),se=h(),P=f("br"),M=K("• "),B=f("strong"),B.textContent="Trigger:",F=K(' "'),Z=K(l[4]),ie=K(`" + text
      `),ae=f("br"),$=K("• "),T=f("strong"),T.textContent="Min Length:",H=h(),x=K(l[6]),ee=K(" character"),me=K(V),fe=h(),ue=f("br"),pe=K("• "),_e=f("strong"),_e.textContent="Max Results:",he=h(),Se=K(l[5]),Ge=h(),je=f("br"),Ae=K("• "),Re=f("strong"),Re.textContent="Debounce:",re=h(),ye=K(l[7]),Ne=K(`ms
      `),Be=f("br"),Ke=K("• "),Te=f("strong"),Te.textContent="Snippets:",De=h(),Je=K(et),Me=h(),W&&W.c(),ke(n,"color","#495057"),ke(r,"padding","4px 8px"),ke(r,"background","#007bff"),ke(r,"color","white"),ke(r,"border","none"),ke(r,"border-radius","4px"),ke(r,"cursor","pointer"),ke(r,"font-size","12px"),r.disabled=a=!l[8],ke(m,"padding","4px 8px"),ke(m,"background","#28a745"),ke(m,"color","white"),ke(m,"border","none"),ke(m,"border-radius","4px"),ke(m,"cursor","pointer"),ke(m,"font-size","12px"),ke(_,"padding","4px 8px"),ke(_,"background","#ffc107"),ke(_,"color","#212529"),ke(_,"border","none"),ke(_,"border-radius","4px"),ke(_,"cursor","pointer"),ke(_,"font-size","12px"),_.disabled=y=!l[8],ke(c,"display","flex"),ke(c,"gap","8px"),ke(t,"display","flex"),ke(t,"justify-content","space-between"),ke(t,"align-items","center"),ke(t,"margin-bottom","8px"),ke(k,"font-size","13px"),ke(k,"color","#6c757d"),ke(k,"margin-bottom","8px"),ke(k,"font-family","monospace"),ke(S,"font-size","12px"),ke(S,"color","#6c757d"),ke(e,"margin-top","10px"),ke(e,"padding","12px"),ke(e,"background","#f8f9fa"),ke(e,"border-radius","6px"),ke(e,"border","1px solid #e9ecef")},m(j,ce){E(j,e,ce),s(e,t),s(t,n),s(t,o),s(t,c),s(c,r),s(r,u),s(c,d),s(c,m),s(c,p),s(c,_),s(_,v),s(e,b),s(e,k),s(k,w),s(e,C),de&&de.m(e,null),s(e,g),s(e,S),s(S,z),s(S,N),s(S,D),s(S,L),s(S,q),s(S,X),s(S,O),s(S,A),s(S,ne),s(S,I),s(S,Q),s(S,te),s(S,J),s(S,se),s(S,P),s(S,M),s(S,B),s(S,F),s(S,Z),s(S,ie),s(S,ae),s(S,$),s(S,T),s(S,H),s(S,x),s(S,ee),s(S,me),s(S,fe),s(S,ue),s(S,pe),s(S,_e),s(S,he),s(S,Se),s(S,Ge),s(S,je),s(S,Ae),s(S,Re),s(S,re),s(S,ye),s(S,Ne),s(S,Be),s(S,Ke),s(S,Te),s(S,De),s(S,Je),s(e,Me),W&&W.m(e,null),He||(tt=[le(r,"click",l[14]),le(m,"click",l[15]),le(_,"click",l[16])],He=!0)},p(j,ce){ce&256&&a!==(a=!j[8])&&(r.disabled=a),ce&256&&y!==(y=!j[8])&&(_.disabled=y),ce&1024&&we(w,j[10]),j[11]&&!j[8]?de?de.p(j,ce):(de=$n(j),de.c(),de.m(e,g)):de&&(de.d(1),de=null),ce&4096&&G!==(G=j[12]?"Tauri (native)":`MCP Server (${Dt.getStatus().baseUrl})`)&&we(O,G),ce&512&&we(J,j[9]),ce&16&&we(Z,j[4]),ce&64&&we(x,j[6]),ce&64&&V!==(V=j[6]!==1?"s":"")&&we(me,V),ce&32&&we(Se,j[5]),ce&128&&we(ye,j[7]),ce&8&&et!==(et=j[3]?"Enabled":"Disabled")&&we(Je,et),U===(U=Le(j))&&W?W.p(j,ce):(W&&W.d(1),W=U&&U(j),W&&(W.c(),W.m(e,null)))},d(j){j&&R(e),de&&de.d(),W&&W.d(),He=!1,Ze(tt)}}}function $n(l){let e,t,n,o;function c(a,d){return a[12]?Br:Gr}let r=c(l),u=r(l);return{c(){e=f("div"),t=f("strong"),t.textContent="⚠️ Autocomplete Not Available",n=f("br"),o=h(),u.c(),ke(e,"font-size","12px"),ke(e,"color","#dc3545"),ke(e,"margin-bottom","8px"),ke(e,"padding","6px"),ke(e,"background","#f8d7da"),ke(e,"border-radius","4px")},m(a,d){E(a,e,d),s(e,t),s(e,n),s(e,o),u.m(e,null)},p(a,d){r===(r=c(a))&&u?u.p(a,d):(u.d(1),u=r(a),u&&(u.c(),u.m(e,null)))},d(a){a&&R(e),u.d()}}}function Gr(l){let e,t=Dt.getStatus().baseUrl+"",n;return{c(){e=K("MCP server not responding. Ensure the server is running on "),n=K(t)},m(o,c){E(o,e,c),E(o,n,c)},p:Pe,d(o){o&&R(e),o&&R(n)}}}function Br(l){let e;return{c(){e=K("Tauri backend connection failed. Ensure the application has proper permissions.")},m(t,n){E(t,e,n)},p:Pe,d(t){t&&R(e)}}}function Jr(l){let e;return{c(){e=f("div"),e.innerHTML=`<strong>❌ Autocomplete Unavailable</strong> 
        <div style="font-size: 11px; margin-top: 4px; color: #721c24;">Click &quot;Rebuild Index&quot; to retry or check server/backend status.</div>`,ke(e,"margin-top","8px"),ke(e,"padding","8px"),ke(e,"background","#f8d7da"),ke(e,"border","1px solid #f5c6cb"),ke(e,"border-radius","4px")},m(t,n){E(t,e,n)},p:Pe,d(t){t&&R(e)}}}function Vr(l){let e,t,n,o,c,r,u,a,d,m,p,_,v,y,b,k,w;return{c(){e=f("div"),t=f("strong"),t.textContent="🎯 Autocomplete Active",n=h(),o=f("div"),c=K("Type "),r=f("code"),u=K(l[4]),a=K(" in the editor above to trigger suggestions."),d=f("br"),m=K(`
          Example: `),p=f("code"),_=K(l[4]),v=K("terraphim"),y=K(" or "),b=f("code"),k=K(l[4]),w=K("graph"),ke(o,"font-size","11px"),ke(o,"margin-top","4px"),ke(o,"color","#0056b3"),ke(e,"margin-top","8px"),ke(e,"padding","8px"),ke(e,"background","#d1edff"),ke(e,"border","1px solid #b3d9ff"),ke(e,"border-radius","4px")},m(C,g){E(C,e,g),s(e,t),s(e,n),s(e,o),s(o,c),s(o,r),s(r,u),s(o,a),s(o,d),s(o,m),s(o,p),s(p,_),s(p,v),s(o,y),s(o,b),s(b,k),s(b,w)},p(C,g){g&16&&we(u,C[4]),g&16&&we(_,C[4]),g&16&&we(k,C[4])},d(C){C&&R(e)}}}function Qr(l){let e,t,n,o;e=new or({props:{defaultValue:l[0],isEditable:!l[1],disableLocalStorage:!0,onUpdate:l[13],extensions:[gn,...l[2]?[Cn.configure({trigger:l[4],allowSpaces:!1,limit:l[5],minLength:l[6],debounce:l[7]})]:[]]}});let c=l[2]&&Tn(l);return{c(){ge(e.$$.fragment),t=h(),c&&c.c(),n=rt()},m(r,u){ve(e,r,u),E(r,t,u),c&&c.m(r,u),E(r,n,u),o=!0},p(r,[u]){const a={};u&1&&(a.defaultValue=r[0]),u&2&&(a.isEditable=!r[1]),u&244&&(a.extensions=[gn,...r[2]?[Cn.configure({trigger:r[4],allowSpaces:!1,limit:r[5],minLength:r[6],debounce:r[7]})]:[]]),e.$set(a),r[2]?c?c.p(r,u):(c=Tn(r),c.c(),c.m(n.parentNode,n)):c&&(c.d(1),c=null)},i(r){o||(Y(e.$$.fragment,r),o=!0)},o(r){oe(e.$$.fragment,r),o=!1},d(r){be(e,r),r&&R(t),c&&c.d(r),r&&R(n)}}}function Yr(l,e,t){let n,o;Ue(l,Et,L=>t(9,n=L)),Ue(l,ot,L=>t(12,o=L));let{html:c=""}=e,{readOnly:r=!1}=e,{outputFormat:u="html"}=e,{enableAutocomplete:a=!0}=e,{showSnippets:d=!0}=e,{suggestionTrigger:m="++"}=e,{maxSuggestions:p=8}=e,{minQueryLength:_=1}=e,{debounceDelay:v=300}=e,y=null,b="⏳ Initializing...",k=!1,w=!1,C=null;Qt(async()=>{a&&await g(),typeof document<"u"&&(C=document.createElement("style"),C.textContent=Wr,document.head.appendChild(C))}),gs(()=>{C&&C.parentNode&&C.parentNode.removeChild(C)});async function g(){t(10,b="⏳ Initializing autocomplete..."),t(8,k=!1),t(11,w=!1);try{Dt.setRole(n),t(10,b="🔗 Testing connection...");const L=await Dt.testConnection();t(11,w=!0),L?(t(10,b="🔨 Building autocomplete index..."),await Dt.buildAutocompleteIndex()?(o?t(10,b="✅ Ready - Using Tauri backend"):t(10,b="✅ Ready - Using MCP server backend"),t(8,k=!0)):t(10,b="❌ Failed to build autocomplete index")):o?t(10,b="❌ Tauri backend not available"):t(10,b="❌ MCP server not responding")}catch(L){console.error("Error initializing autocomplete:",L),t(10,b="❌ Autocomplete initialization error")}}const S=L=>{y=L,u==="markdown"?t(0,c=L.storage.markdown.getMarkdown()):t(0,c=L.getHTML())},z=async()=>{if(!w){alert("Please wait for connection test to complete");return}if(!k){alert("Autocomplete service not ready. Check the status above.");return}try{t(10,b="🧪 Testing autocomplete...");const L="terraphim",q=await Dt.getSuggestions(L,5);if(console.log("Autocomplete test results:",q),q.length>0){const X=q.map((G,O)=>`${O+1}. ${G.text}${G.snippet?` (${G.snippet})`:""}`).join(`
`);alert(`✅ Found ${q.length} suggestions for '${L}':

${X}`),o?t(10,b="✅ Ready - Using Tauri backend"):t(10,b="✅ Ready - Using MCP server backend")}else alert(`⚠️ No suggestions found for '${L}'. This might be normal if the term isn't in your knowledge graph.`)}catch(L){console.error("Autocomplete test failed:",L),alert(`❌ Autocomplete test failed: ${L.message}`),t(10,b="❌ Test failed - check console for details")}},N=async()=>{t(10,b="⏳ Rebuilding index..."),t(8,k=!1);try{await Dt.refreshIndex()?(o?t(10,b="✅ Ready - Tauri index rebuilt successfully"):t(10,b="✅ Ready - MCP server index rebuilt successfully"),t(8,k=!0)):t(10,b="❌ Failed to rebuild index")}catch(L){console.error("Error rebuilding index:",L),t(10,b="❌ Index rebuild failed - check console for details")}},D=()=>{if(!y){alert("Editor not ready yet");return}const L=`# Terraphim Autocomplete Demo

This is a demonstration of the integrated Terraphim autocomplete system.

## How to Use:
1. Type "${m}" to trigger autocomplete
2. Start typing any term (e.g., "${m}terraphim", "${m}graph")
3. Use ↑↓ arrows to navigate suggestions
4. Press Tab or Enter to select
5. Press Esc to cancel

## Try these queries:
- ${m}terraphim
- ${m}graph
- ${m}service
- ${m}automata
- ${m}role

The autocomplete system uses your local knowledge graph to provide intelligent suggestions based on your selected role: **${n}**.

---

Start typing below:`;y.commands.setContent(L),setTimeout(()=>{y.commands.focus("end")},100),alert(`Demo content inserted!

Type "${m}" followed by any term to see autocomplete suggestions.

Example: "${m}terraphim"`)};return l.$$set=L=>{"html"in L&&t(0,c=L.html),"readOnly"in L&&t(1,r=L.readOnly),"outputFormat"in L&&t(17,u=L.outputFormat),"enableAutocomplete"in L&&t(2,a=L.enableAutocomplete),"showSnippets"in L&&t(3,d=L.showSnippets),"suggestionTrigger"in L&&t(4,m=L.suggestionTrigger),"maxSuggestions"in L&&t(5,p=L.maxSuggestions),"minQueryLength"in L&&t(6,_=L.minQueryLength),"debounceDelay"in L&&t(7,v=L.debounceDelay)},l.$$.update=()=>{l.$$.dirty&772&&n&&a&&k&&(Dt.setRole(n),g())},[c,r,a,d,m,p,_,v,k,n,b,w,o,S,z,N,D,u]}class Zr extends _t{constructor(e){super(),ht(this,e,Yr,Qr,ft,{html:0,readOnly:1,outputFormat:17,enableAutocomplete:2,showSnippets:3,suggestionTrigger:4,maxSuggestions:5,minQueryLength:6,debounceDelay:7})}}function Sn(l){let e,t,n,o,c,r,u,a,d,m,p;return{c(){e=f("div"),t=f("h3"),n=f("span"),n.textContent="Knowledge Graph",o=K(`
          Term: `),c=f("strong"),r=K(l[2]),u=K(" | Rank: "),a=f("strong"),d=K(l[3]),m=h(),p=f("hr"),i(n,"class","tag is-info svelte-329px1"),i(t,"class","subtitle is-6 svelte-329px1"),i(p,"class","svelte-329px1"),i(e,"class","kg-context svelte-329px1")},m(_,v){E(_,e,v),s(e,t),s(t,n),s(t,o),s(t,c),s(c,r),s(t,u),s(t,a),s(a,d),s(e,m),s(e,p)},p(_,v){v&4&&we(r,_[2]),v&8&&we(d,_[3])},d(_){_&&R(e)}}}function Xr(l){let e,t,n,o,c,r,u,a;const d=[ti,ei],m=[];function p(_,v){return _[5]?0:1}return t=p(l),n=m[t]=d[t](l),{c(){e=f("div"),n.c(),o=h(),c=f("div"),c.innerHTML='<span class="hint-text svelte-329px1">Double-click to edit • Ctrl+E to edit • Ctrl+S to save • Click KG links to explore</span>',i(c,"class","edit-hint svelte-329px1"),i(e,"class","content-viewer svelte-329px1"),i(e,"tabindex","0"),i(e,"role","button"),i(e,"aria-label","Double-click to edit article content")},m(_,v){E(_,e,v),m[t].m(e,null),s(e,o),s(e,c),l[20](e),r=!0,u||(a=[le(e,"dblclick",l[14]),le(e,"keydown",l[15]),le(e,"click",l[13])],u=!0)},p(_,v){let y=t;t=p(_),t===y?m[t].p(_,v):(Qe(),oe(m[y],1,1,()=>{m[y]=null}),Ye(),n=m[t],n?n.p(_,v):(n=m[t]=d[t](_),n.c()),Y(n,1),n.m(e,o))},i(_){r||(Y(n),r=!0)},o(_){oe(n),r=!1},d(_){_&&R(e),m[t].d(),l[20](null),u=!1,Ze(a)}}}function xr(l){let e,t,n,o,c,r,u,a,d,m;function p(v){l[18](v)}let _={outputFormat:l[11]};return l[1].body!==void 0&&(_.html=l[1].body),e=new Zr({props:_}),st.push(()=>at(e,"html",p)),{c(){ge(e.$$.fragment),n=h(),o=f("div"),c=f("button"),c.textContent="Save",r=h(),u=f("button"),u.textContent="Cancel",i(c,"class","button is-primary"),i(u,"class","button is-light"),i(o,"class","edit-controls svelte-329px1")},m(v,y){ve(e,v,y),E(v,n,y),E(v,o,y),s(o,c),s(o,r),s(o,u),a=!0,d||(m=[le(c,"click",l[12]),le(u,"click",l[19])],d=!0)},p(v,y){const b={};y&2048&&(b.outputFormat=v[11]),!t&&y&2&&(t=!0,b.html=v[1].body,ct(()=>t=!1)),e.$set(b)},i(v){a||(Y(e.$$.fragment,v),a=!0)},o(v){oe(e.$$.fragment,v),a=!1},d(v){be(e,v),v&&R(n),v&&R(o),d=!1,Ze(m)}}}function ei(l){let e,t,n;return t=new Il({props:{source:l[1].body}}),{c(){e=f("div"),ge(t.$$.fragment),i(e,"class","markdown-content svelte-329px1")},m(o,c){E(o,e,c),ve(t,e,null),n=!0},p(o,c){const r={};c&2&&(r.source=o[1].body),t.$set(r)},i(o){n||(Y(t.$$.fragment,o),n=!0)},o(o){oe(t.$$.fragment,o),n=!1},d(o){o&&R(e),be(t)}}}function ti(l){let e,t=l[1].body+"";return{c(){e=f("div"),i(e,"class","prose svelte-329px1")},m(n,o){E(n,e,o),e.innerHTML=t},p(n,o){o&2&&t!==(t=n[1].body+"")&&(e.innerHTML=t)},i:Pe,o:Pe,d(n){n&&R(e)}}}function li(l){let e,t,n,o,c,r=l[1].title+"",u,a,d,m,p,_,v,y=l[2]&&l[3]!==null&&Sn(l);const b=[xr,Xr],k=[];function w(C,g){return C[4]?0:1}return d=w(l),m=k[d]=b[d](l),{c(){e=f("div"),t=f("button"),n=h(),y&&y.c(),o=h(),c=f("h2"),u=K(r),a=h(),m.c(),i(t,"class","delete is-large modal-close-btn svelte-329px1"),i(t,"aria-label","close"),i(c,"class","svelte-329px1"),i(e,"class","box wrapper svelte-329px1")},m(C,g){E(C,e,g),s(e,t),s(e,n),y&&y.m(e,null),s(e,o),s(e,c),s(c,u),s(e,a),k[d].m(e,null),p=!0,_||(v=le(t,"click",l[17]),_=!0)},p(C,g){C[2]&&C[3]!==null?y?y.p(C,g):(y=Sn(C),y.c(),y.m(e,o)):y&&(y.d(1),y=null),(!p||g&2)&&r!==(r=C[1].title+"")&&we(u,r);let S=d;d=w(C),d===S?k[d].p(C,g):(Qe(),oe(k[S],1,1,()=>{k[S]=null}),Ye(),m=k[d],m?m.p(C,g):(m=k[d]=b[d](C),m.c()),Y(m,1),m.m(e,null))},i(C){p||(Y(m),p=!0)},o(C){oe(m),p=!1},d(C){C&&R(e),y&&y.d(),k[d].d(),_=!1,v()}}}function Rn(l){let e,t,n;function o(r){l[23](r)}let c={$$slots:{default:[si]},$$scope:{ctx:l}};return l[7]!==void 0&&(c.active=l[7]),e=new Pl({props:c}),st.push(()=>at(e,"active",o)),{c(){ge(e.$$.fragment)},m(r,u){ve(e,r,u),n=!0},p(r,u){const a={};u&536872832&&(a.$$scope={dirty:u,ctx:r}),!t&&u&128&&(t=!0,a.active=r[7],ct(()=>t=!1)),e.$set(a)},i(r){n||(Y(e.$$.fragment,r),n=!0)},o(r){oe(e.$$.fragment,r),n=!1},d(r){be(e,r)}}}function En(l){let e,t,n,o,c,r,u,a,d,m,p;return{c(){e=f("div"),t=f("h3"),n=f("span"),n.textContent="Knowledge Graph",o=K(`
            Term: `),c=f("strong"),r=K(l[9]),u=K(" | Rank: "),a=f("strong"),d=K(l[10]),m=h(),p=f("hr"),i(n,"class","tag is-info svelte-329px1"),i(t,"class","subtitle is-6 svelte-329px1"),i(p,"class","svelte-329px1"),i(e,"class","kg-context svelte-329px1")},m(_,v){E(_,e,v),s(e,t),s(t,n),s(t,o),s(t,c),s(c,r),s(t,u),s(t,a),s(a,d),s(e,m),s(e,p)},p(_,v){v&512&&we(r,_[9]),v&1024&&we(d,_[10])},d(_){_&&R(e)}}}function ni(l){let e,t,n;return t=new Il({props:{source:l[8].body}}),{c(){e=f("div"),ge(t.$$.fragment),i(e,"class","markdown-content svelte-329px1")},m(o,c){E(o,e,c),ve(t,e,null),n=!0},p(o,c){const r={};c&256&&(r.source=o[8].body),t.$set(r)},i(o){n||(Y(t.$$.fragment,o),n=!0)},o(o){oe(t.$$.fragment,o),n=!1},d(o){o&&R(e),be(t)}}}function oi(l){let e,t=l[8].body+"";return{c(){e=f("div"),i(e,"class","prose svelte-329px1")},m(n,o){E(n,e,o),e.innerHTML=t},p(n,o){o&256&&t!==(t=n[8].body+"")&&(e.innerHTML=t)},i:Pe,o:Pe,d(n){n&&R(e)}}}function si(l){let e,t,n,o,c,r=l[8].title+"",u,a,d,m,p,_,v,y,b,k,w,C=l[9]&&l[10]!==null&&En(l);const g=[oi,ni],S=[];function z(N,D){return D&256&&(m=null),m==null&&(m=!!(N[8].body&&(/<html/i.test(N[8].body)||/<body/i.test(N[8].body)||/<head/i.test(N[8].body)))),m?0:1}return p=z(l,-1),_=S[p]=g[p](l),{c(){e=f("div"),t=f("button"),n=h(),C&&C.c(),o=h(),c=f("h2"),u=K(r),a=h(),d=f("div"),_.c(),v=h(),y=f("div"),y.innerHTML='<span class="hint-text svelte-329px1">Knowledge Graph document • Click KG links to explore further</span>',i(t,"class","delete is-large modal-close-btn svelte-329px1"),i(t,"aria-label","close"),i(c,"class","svelte-329px1"),i(y,"class","edit-hint svelte-329px1"),i(d,"class","content-viewer svelte-329px1"),i(d,"tabindex","0"),i(d,"role","button"),i(d,"aria-label","KG document content - click KG links to explore further"),i(e,"class","box wrapper svelte-329px1")},m(N,D){E(N,e,D),s(e,t),s(e,n),C&&C.m(e,null),s(e,o),s(e,c),s(c,u),s(e,a),s(e,d),S[p].m(d,null),s(d,v),s(d,y),b=!0,k||(w=[le(t,"click",l[22]),le(d,"click",l[13])],k=!0)},p(N,D){N[9]&&N[10]!==null?C?C.p(N,D):(C=En(N),C.c(),C.m(e,o)):C&&(C.d(1),C=null),(!b||D&256)&&r!==(r=N[8].title+"")&&we(u,r);let L=p;p=z(N,D),p===L?S[p].p(N,D):(Qe(),oe(S[L],1,1,()=>{S[L]=null}),Ye(),_=S[p],_?_.p(N,D):(_=S[p]=g[p](N),_.c()),Y(_,1),_.m(d,v))},i(N){b||(Y(_),b=!0)},o(N){oe(_),b=!1},d(N){N&&R(e),C&&C.d(),S[p].d(),k=!1,Ze(w)}}}function ri(l){let e,t,n,o,c;function r(d){l[21](d)}let u={$$slots:{default:[li]},$$scope:{ctx:l}};l[0]!==void 0&&(u.active=l[0]),e=new Pl({props:u}),st.push(()=>at(e,"active",r));let a=l[8]&&Rn(l);return{c(){ge(e.$$.fragment),n=h(),a&&a.c(),o=rt()},m(d,m){ve(e,d,m),E(d,n,m),a&&a.m(d,m),E(d,o,m),c=!0},p(d,[m]){const p={};m&536873087&&(p.$$scope={dirty:m,ctx:d}),!t&&m&1&&(t=!0,p.active=d[0],ct(()=>t=!1)),e.$set(p),d[8]?a?(a.p(d,m),m&256&&Y(a,1)):(a=Rn(d),a.c(),Y(a,1),a.m(o.parentNode,o)):a&&(Qe(),oe(a,1,1,()=>{a=null}),Ye())},i(d){c||(Y(e.$$.fragment,d),Y(a),c=!0)},o(d){oe(e.$$.fragment,d),oe(a),c=!1},d(d){be(e,d),d&&R(n),a&&a.d(d),d&&R(o)}}}function ii(l,e,t){let n,o,c,r;Ue(l,ot,I=>t(25,c=I)),Ue(l,Et,I=>t(26,r=I));let{active:u=!1}=e,{item:a}=e,{initialEdit:d=!1}=e,{kgTerm:m=null}=e,{kgRank:p=null}=e,_=!1,v,y=!1,b=null,k=null,w=null;async function C(){if(c)try{const I=await Fe("get_document",{documentId:a.id});I!=null&&I.document&&t(1,a=I.document)}catch(I){console.error("Failed to load document",I)}}async function g(){if(!c){t(4,_=!1);return}try{await Fe("create_document",{document:a}),t(4,_=!1)}catch(I){console.error("Failed to save document",I)}}async function S(I){var Q,te,J,se,P;t(9,k=I),console.log("🔍 KG Link Click Debug Info:"),console.log("  Term clicked:",I),console.log("  Current role:",r),console.log("  Is Tauri mode:",c);try{if(c){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:r,term:I});const M=await Fe("find_documents_for_kg_term",{roleName:r,term:I});console.log("  📥 Tauri response received:"),console.log("    Status:",M.status),console.log("    Results count:",((Q=M.results)==null?void 0:Q.length)||0),console.log("    Total:",M.total||0),console.log("    Full response:",JSON.stringify(M,null,2)),M.status==="success"&&M.results&&M.results.length>0?(t(8,b=M.results[0]),t(10,w=b.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",b.title),console.log("    Rank:",w),console.log("    Body length:",((te=b.body)==null?void 0:te.length)||0,"characters"),t(7,y=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${I}" in role: "${r}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const M=Xe.ServerURL,B=encodeURIComponent(r),F=encodeURIComponent(I),Z=`${M}/roles/${B}/kg_search?term=${F}`;console.log("  📤 HTTP Request details:"),console.log("    Base URL:",M),console.log("    Role (encoded):",B),console.log("    Term (encoded):",F),console.log("    Full URL:",Z);const ie=await fetch(Z);if(console.log("  📥 HTTP Response received:"),console.log("    Status code:",ie.status),console.log("    Status text:",ie.statusText),console.log("    Headers:",Object.fromEntries(ie.headers.entries())),!ie.ok)throw new Error(`HTTP error! Status: ${ie.status} - ${ie.statusText}`);const ae=await ie.json();console.log("  📄 Response data:"),console.log("    Status:",ae.status),console.log("    Results count:",((J=ae.results)==null?void 0:J.length)||0),console.log("    Total:",ae.total||0),console.log("    Full response:",JSON.stringify(ae,null,2)),ae.status==="success"&&ae.results&&ae.results.length>0?(t(8,b=ae.results[0]),t(10,w=b.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",b.title),console.log("    Rank:",w),console.log("    Body length:",((se=b.body)==null?void 0:se.length)||0,"characters"),t(7,y=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${I}" in role: "${r}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",Z))}}catch(M){console.error("❌ Error fetching KG document:"),console.error("  Error type:",M.constructor.name),console.error("  Error message:",M.message||M),console.error("  Request details:",{term:I,role:r,isTauri:c,timestamp:new Date().toISOString()}),!c&&((P=M.message)!=null&&P.includes("Failed to fetch"))&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{}}function z(I){const Q=I.target;if(Q.tagName==="A"){const te=Q.getAttribute("href");if(te&&te.startsWith("kg:")){I.preventDefault();const J=te.substring(3);S(J)}}}function N(){t(4,_=!0)}function D(I){I.type!=="dblclick"&&((I.ctrlKey||I.metaKey)&&I.key==="e"&&(I.preventDefault(),t(4,_=!0)),_&&(I.ctrlKey||I.metaKey)&&I.key==="s"&&(I.preventDefault(),g()),I.key==="Escape"&&(I.preventDefault(),_?t(4,_=!1):t(0,u=!1)))}const L=()=>t(0,u=!1);function q(I){l.$$.not_equal(a.body,I)&&(a.body=I,t(1,a))}const X=()=>t(4,_=!1);function G(I){st[I?"unshift":"push"](()=>{v=I,t(6,v)})}function O(I){u=I,t(0,u)}const A=()=>t(7,y=!1);function ne(I){y=I,t(7,y)}return l.$$set=I=>{"active"in I&&t(0,u=I.active),"item"in I&&t(1,a=I.item),"initialEdit"in I&&t(16,d=I.initialEdit),"kgTerm"in I&&t(2,m=I.kgTerm),"kgRank"in I&&t(3,p=I.kgRank)},l.$$.update=()=>{l.$$.dirty&65537&&u&&d&&t(4,_=!0),l.$$.dirty&19&&u&&a&&!_&&C(),l.$$.dirty&2&&t(5,n=a!=null&&a.body?/<html/i.test(a.body)||/<body/i.test(a.body)||/<head/i.test(a.body)||/^\s*<(!DOCTYPE|html|head|body|div|p|span)/i.test(a.body.trim()):!1),l.$$.dirty&32&&t(11,o=n?"html":"markdown")},[u,a,m,p,_,n,v,y,b,k,w,o,g,z,N,D,d,L,q,X,G,O,A,ne]}class Gl extends _t{constructor(e){super(),ht(this,e,ii,ri,ft,{active:0,item:1,initialEdit:16,kgTerm:2,kgRank:3})}}function An(l,e,t){const n=l.slice();return n[33]=e[t],n}function Ln(l,e,t){const n=l.slice();return n[36]=e[t],n}function On(l,e,t){const n=l.slice();return n[39]=e[t],n}function Nn(l){let e,t;return e=new vs({props:{type:"is-success",$$slots:{default:[ai]},$$scope:{ctx:l}}}),{c(){ge(e.$$.fragment)},m(n,o){ve(e,n,o),t=!0},i(n){t||(Y(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){be(e,n)}}}function ai(l){let e,t,n;return{c(){e=f("p"),e.innerHTML="<strong>Success!</strong> Article saved to atomic server successfully.",t=h(),n=f("p"),n.textContent="The modal will close automatically..."},m(o,c){E(o,e,c),E(o,t,c),E(o,n,c)},p:Pe,d(o){o&&R(e),o&&R(t),o&&R(n)}}}function Dn(l){let e,t;return e=new vs({props:{type:"is-danger",$$slots:{default:[ci]},$$scope:{ctx:l}}}),{c(){ge(e.$$.fragment)},m(n,o){ve(e,n,o),t=!0},p(n,o){const c={};o[0]&8|o[1]&2048&&(c.$$scope={dirty:o,ctx:n}),e.$set(c)},i(n){t||(Y(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){be(e,n)}}}function ci(l){let e,t,n,o;return{c(){e=f("p"),t=f("strong"),t.textContent="Error:",n=h(),o=K(l[3])},m(c,r){E(c,e,r),s(e,t),s(e,n),s(e,o)},p(c,r){r[0]&8&&we(o,c[3])},d(c){c&&R(e)}}}function Pn(l){var ne,I,Q,te;let e,t,n,o,c,r=(((ne=l[1])==null?void 0:ne.title)||"Untitled")+"",u,a,d,m,p,_,v=(((I=l[1])==null?void 0:I.rank)||0)+"",y,b,k,w,C,g,S,z,N,D,L=((Q=l[1])==null?void 0:Q.description)&&Mn(l),q=((te=l[1])==null?void 0:te.tags)&&In(l);function X(J,se){return J[10].length>0?fi:ui}let G=X(l),O=G(l),A=l[10].length>0&&Hn(l);return{c(){e=f("div"),t=f("label"),t.textContent="Document to Save",n=h(),o=f("div"),c=f("h5"),u=K(r),a=h(),L&&L.c(),d=h(),m=f("div"),p=f("span"),_=K("Rank: "),y=K(v),b=h(),q&&q.c(),k=h(),w=f("div"),C=f("label"),C.textContent="Atomic Server",g=h(),S=f("div"),O.c(),z=h(),A&&A.c(),N=rt(),i(t,"class","label"),i(c,"class","title is-6"),i(p,"class","tag is-info svelte-48g63o"),i(m,"class","tags svelte-48g63o"),i(o,"class","box document-preview svelte-48g63o"),i(e,"class","field"),i(C,"class","label"),i(C,"for","atomic-server-select"),i(S,"class","control"),i(w,"class","field")},m(J,se){E(J,e,se),s(e,t),s(e,n),s(e,o),s(o,c),s(c,u),s(o,a),L&&L.m(o,null),s(o,d),s(o,m),s(m,p),s(p,_),s(p,y),s(m,b),q&&q.m(m,null),E(J,k,se),E(J,w,se),s(w,C),s(w,g),s(w,S),O.m(S,null),E(J,z,se),A&&A.m(J,se),E(J,N,se),D=!0},p(J,se){var P,M,B,F;(!D||se[0]&2)&&r!==(r=(((P=J[1])==null?void 0:P.title)||"Untitled")+"")&&we(u,r),(M=J[1])!=null&&M.description?L?L.p(J,se):(L=Mn(J),L.c(),L.m(o,d)):L&&(L.d(1),L=null),(!D||se[0]&2)&&v!==(v=(((B=J[1])==null?void 0:B.rank)||0)+"")&&we(y,v),(F=J[1])!=null&&F.tags?q?q.p(J,se):(q=In(J),q.c(),q.m(m,null)):q&&(q.d(1),q=null),G===(G=X(J))&&O?O.p(J,se):(O.d(1),O=G(J),O&&(O.c(),O.m(S,null))),J[10].length>0?A?(A.p(J,se),se[0]&1024&&Y(A,1)):(A=Hn(J),A.c(),Y(A,1),A.m(N.parentNode,N)):A&&(Qe(),oe(A,1,1,()=>{A=null}),Ye())},i(J){D||(Y(A),D=!0)},o(J){oe(A),D=!1},d(J){J&&R(e),L&&L.d(),q&&q.d(),J&&R(k),J&&R(w),O.d(),J&&R(z),A&&A.d(J),J&&R(N)}}}function Mn(l){let e,t=l[1].description+"",n;return{c(){e=f("p"),n=K(t),i(e,"class","content")},m(o,c){E(o,e,c),s(e,n)},p(o,c){c[0]&2&&t!==(t=o[1].description+"")&&we(n,t)},d(o){o&&R(e)}}}function In(l){let e,t=l[1].tags,n=[];for(let o=0;o<t.length;o+=1)n[o]=Un(On(l,t,o));return{c(){for(let o=0;o<n.length;o+=1)n[o].c();e=rt()},m(o,c){for(let r=0;r<n.length;r+=1)n[r]&&n[r].m(o,c);E(o,e,c)},p(o,c){if(c[0]&2){t=o[1].tags;let r;for(r=0;r<t.length;r+=1){const u=On(o,t,r);n[r]?n[r].p(u,c):(n[r]=Un(u),n[r].c(),n[r].m(e.parentNode,e))}for(;r<n.length;r+=1)n[r].d(1);n.length=t.length}},d(o){xe(n,o),o&&R(e)}}}function Un(l){let e,t=l[39]+"",n;return{c(){e=f("span"),n=K(t),i(e,"class","tag svelte-48g63o")},m(o,c){E(o,e,c),s(e,n)},p(o,c){c[0]&2&&t!==(t=o[39]+"")&&we(n,t)},d(o){o&&R(e)}}}function ui(l){let e,t,n,o,c,r,u,a,d;return{c(){e=f("div"),t=f("p"),t.innerHTML="<strong>No atomic servers available</strong>",n=h(),o=f("p"),c=K('Your current role "'),r=K(l[12]),u=K(`" doesn't have any writable atomic server configurations.`),a=h(),d=f("p"),d.textContent="Please configure an atomic server haystack in your role settings.",i(e,"class","notification is-warning")},m(m,p){E(m,e,p),s(e,t),s(e,n),s(e,o),s(o,c),s(o,r),s(o,u),s(e,a),s(e,d)},p(m,p){p[0]&4096&&we(r,m[12])},d(m){m&&R(e)}}}function fi(l){let e,t,n,o,c,r,u=l[10],a=[];for(let d=0;d<u.length;d+=1)a[d]=jn(Ln(l,u,d));return{c(){e=f("div"),t=f("select");for(let d=0;d<a.length;d+=1)a[d].c();n=h(),o=f("p"),o.textContent=`Select the atomic server from your current role configuration.
              🔐 = Authenticated, ⚠️ = Anonymous access`,i(t,"id","atomic-server-select"),t.disabled=l[2],l[11]===void 0&&it(()=>l[18].call(t)),i(e,"class","select is-fullwidth"),i(o,"class","help svelte-48g63o")},m(d,m){E(d,e,m),s(e,t);for(let p=0;p<a.length;p+=1)a[p]&&a[p].m(t,null);qe(t,l[11],!0),E(d,n,m),E(d,o,m),c||(r=le(t,"change",l[18]),c=!0)},p(d,m){if(m[0]&1024){u=d[10];let p;for(p=0;p<u.length;p+=1){const _=Ln(d,u,p);a[p]?a[p].p(_,m):(a[p]=jn(_),a[p].c(),a[p].m(t,null))}for(;p<a.length;p+=1)a[p].d(1);a.length=u.length}m[0]&4&&(t.disabled=d[2]),m[0]&3072&&qe(t,d[11])},d(d){d&&R(e),xe(a,d),d&&R(n),d&&R(o),c=!1,r()}}}function di(l){let e;return{c(){e=f("span"),e.textContent="⚠️ No Auth",i(e,"class","has-text-warning")},m(t,n){E(t,e,n)},d(t){t&&R(e)}}}function pi(l){let e;return{c(){e=f("span"),e.textContent="🔐",i(e,"class","has-text-success")},m(t,n){E(t,e,n)},d(t){t&&R(e)}}}function jn(l){let e,t=l[36].location+"",n,o,c,r;function u(m,p){return m[36].atomic_server_secret?pi:di}let a=u(l),d=a(l);return{c(){e=f("option"),n=K(t),o=h(),d.c(),c=h(),e.__value=r=l[36].location,e.value=e.__value},m(m,p){E(m,e,p),s(e,n),s(e,o),d.m(e,null),s(e,c)},p(m,p){p[0]&1024&&t!==(t=m[36].location+"")&&we(n,t),a!==(a=u(m))&&(d.d(1),d=a(m),d&&(d.c(),d.m(e,c))),p[0]&1024&&r!==(r=m[36].location)&&(e.__value=r,e.value=e.__value)},d(m){m&&R(e),d.d()}}}function Hn(l){var U,W;let e,t,n,o,c,r,u,a,d,m,p,_,v,y,b,k,w,C,g,S,z,N,D,L,q,X,G,O,A,ne,I,Q,te,J,se,P,M,B,F,Z,ie,ae,$,T=(l[8]||"Untitled")+"",H,x,ee,V,me,fe=(((W=(U=l[1])==null?void 0:U.body)==null?void 0:W.length)||0)+"",ue,pe,_e,he,Se,Ge,je=l[14]()+"",Ae,Re,re,ye,Ne,Be=l[15]()+"",Ke,Te,De,et,Je;function Me(j){l[19](j)}let He={id:"article-title",placeholder:"Enter article title",disabled:l[2],required:!0};l[8]!==void 0&&(He.value=l[8]),c=new Yt({props:He}),st.push(()=>at(c,"value",Me));const tt=[_i,mi],de=[];function Le(j,ce){return j[7]?1:0}return X=Le(l),G=de[X]=tt[X](l),I=new Nl({props:{type:"is-primary",loading:l[2],disabled:l[2]||!l[8].trim()||!l[11],$$slots:{default:[hi]},$$scope:{ctx:l}}}),I.$on("click",l[16]),J=new Nl({props:{type:"is-light",disabled:l[2],$$slots:{default:[gi]},$$scope:{ctx:l}}}),J.$on("click",l[17]),De=bs(l[22][0]),{c(){e=f("div"),t=f("label"),t.textContent="Article Title",n=h(),o=f("div"),ge(c.$$.fragment),u=h(),a=f("div"),d=f("label"),d.textContent="Description",m=h(),p=f("div"),_=f("textarea"),v=h(),y=f("div"),b=f("label"),b.textContent="Parent Collection",k=h(),w=f("div"),C=f("label"),g=f("input"),S=K(`
              Use predefined collection`),z=h(),N=f("label"),D=f("input"),L=K(`
              Custom parent URL/path`),q=h(),G.c(),O=h(),A=f("div"),ne=f("div"),ge(I.$$.fragment),Q=h(),te=f("div"),ge(J.$$.fragment),se=h(),P=f("div"),M=f("div"),B=f("p"),B.innerHTML="<strong>What will be saved:</strong>",F=h(),Z=f("ul"),ie=f("li"),ae=f("strong"),ae.textContent="Title:",$=h(),H=K(T),x=h(),ee=f("li"),V=f("strong"),V.textContent="Body:",me=K(" Original document content ("),ue=K(fe),pe=K(" characters)"),_e=h(),he=f("li"),Se=f("strong"),Se.textContent="Parent:",Ge=h(),Ae=K(je),Re=h(),re=f("li"),ye=f("strong"),ye.textContent="Subject URL:",Ne=h(),Ke=K(Be),i(t,"class","label"),i(t,"for","article-title"),i(o,"class","control"),i(e,"class","field"),i(d,"class","label"),i(d,"for","article-description"),i(_,"id","article-description"),i(_,"class","textarea"),i(_,"placeholder","Brief description of the article"),_.disabled=l[2],i(_,"rows","3"),i(p,"class","control"),i(a,"class","field"),i(b,"class","label"),i(g,"type","radio"),g.__value=!1,g.value=g.__value,g.disabled=l[2],i(C,"class","radio svelte-48g63o"),i(D,"type","radio"),D.__value=!0,D.value=D.__value,D.disabled=l[2],i(N,"class","radio svelte-48g63o"),i(w,"class","control"),i(y,"class","field"),i(ne,"class","control"),i(te,"class","control"),i(A,"class","field is-grouped"),i(ie,"class","svelte-48g63o"),i(ee,"class","svelte-48g63o"),i(he,"class","svelte-48g63o"),i(re,"class","svelte-48g63o"),i(Z,"class","svelte-48g63o"),i(M,"class","notification is-info is-light svelte-48g63o"),i(P,"class","field"),De.p(g,D)},m(j,ce){E(j,e,ce),s(e,t),s(e,n),s(e,o),ve(c,o,null),E(j,u,ce),E(j,a,ce),s(a,d),s(a,m),s(a,p),s(p,_),Oe(_,l[9]),E(j,v,ce),E(j,y,ce),s(y,b),s(y,k),s(y,w),s(w,C),s(C,g),g.checked=g.__value===l[7],s(C,S),s(w,z),s(w,N),s(N,D),D.checked=D.__value===l[7],s(N,L),E(j,q,ce),de[X].m(j,ce),E(j,O,ce),E(j,A,ce),s(A,ne),ve(I,ne,null),s(A,Q),s(A,te),ve(J,te,null),E(j,se,ce),E(j,P,ce),s(P,M),s(M,B),s(M,F),s(M,Z),s(Z,ie),s(ie,ae),s(ie,$),s(ie,H),s(Z,x),s(Z,ee),s(ee,V),s(ee,me),s(ee,ue),s(ee,pe),s(Z,_e),s(Z,he),s(he,Se),s(he,Ge),s(he,Ae),s(Z,Re),s(Z,re),s(re,ye),s(re,Ne),s(re,Ke),Te=!0,et||(Je=[le(_,"input",l[20]),le(g,"change",l[21]),le(D,"change",l[23])],et=!0)},p(j,ce){var ze,lt;const $e={};ce[0]&4&&($e.disabled=j[2]),!r&&ce[0]&256&&(r=!0,$e.value=j[8],ct(()=>r=!1)),c.$set($e),(!Te||ce[0]&4)&&(_.disabled=j[2]),ce[0]&512&&Oe(_,j[9]),(!Te||ce[0]&4)&&(g.disabled=j[2]),ce[0]&128&&(g.checked=g.__value===j[7]),(!Te||ce[0]&4)&&(D.disabled=j[2]),ce[0]&128&&(D.checked=D.__value===j[7]);let Ce=X;X=Le(j),X===Ce?de[X].p(j,ce):(Qe(),oe(de[Ce],1,1,()=>{de[Ce]=null}),Ye(),G=de[X],G?G.p(j,ce):(G=de[X]=tt[X](j),G.c()),Y(G,1),G.m(O.parentNode,O));const Ve={};ce[0]&4&&(Ve.loading=j[2]),ce[0]&2308&&(Ve.disabled=j[2]||!j[8].trim()||!j[11]),ce[1]&2048&&(Ve.$$scope={dirty:ce,ctx:j}),I.$set(Ve);const nt={};ce[0]&4&&(nt.disabled=j[2]),ce[1]&2048&&(nt.$$scope={dirty:ce,ctx:j}),J.$set(nt),(!Te||ce[0]&256)&&T!==(T=(j[8]||"Untitled")+"")&&we(H,T),(!Te||ce[0]&2)&&fe!==(fe=(((lt=(ze=j[1])==null?void 0:ze.body)==null?void 0:lt.length)||0)+"")&&we(ue,fe)},i(j){Te||(Y(c.$$.fragment,j),Y(G),Y(I.$$.fragment,j),Y(J.$$.fragment,j),Te=!0)},o(j){oe(c.$$.fragment,j),oe(G),oe(I.$$.fragment,j),oe(J.$$.fragment,j),Te=!1},d(j){j&&R(e),be(c),j&&R(u),j&&R(a),j&&R(v),j&&R(y),j&&R(q),de[X].d(j),j&&R(O),j&&R(A),be(I),be(J),j&&R(se),j&&R(P),De.r(),et=!1,Ze(Je)}}}function mi(l){let e,t,n,o,c,r,u;function a(m){l[25](m)}let d={placeholder:"e.g., my-collection or http://server/custom-parent",disabled:l[2]};return l[6]!==void 0&&(d.value=l[6]),n=new Yt({props:d}),st.push(()=>at(n,"value",a)),{c(){e=f("div"),t=f("div"),ge(n.$$.fragment),c=h(),r=f("p"),r.textContent=`Enter a collection name (e.g., "my-articles") or full URL.
              If the collection doesn't exist, it will be created.`,i(t,"class","control"),i(r,"class","help svelte-48g63o"),i(e,"class","field")},m(m,p){E(m,e,p),s(e,t),ve(n,t,null),s(e,c),s(e,r),u=!0},p(m,p){const _={};p[0]&4&&(_.disabled=m[2]),!o&&p[0]&64&&(o=!0,_.value=m[6],ct(()=>o=!1)),n.$set(_)},i(m){u||(Y(n.$$.fragment,m),u=!0)},o(m){oe(n.$$.fragment,m),u=!1},d(m){m&&R(e),be(n)}}}function _i(l){let e,t,n,o,c,r,u=l[13],a=[];for(let d=0;d<u.length;d+=1)a[d]=zn(An(l,u,d));return{c(){e=f("div"),t=f("div"),n=f("div"),o=f("select");for(let d=0;d<a.length;d+=1)a[d].c();o.disabled=l[2],l[5]===void 0&&it(()=>l[24].call(o)),i(n,"class","select is-fullwidth"),i(t,"class","control"),i(e,"class","field")},m(d,m){E(d,e,m),s(e,t),s(t,n),s(n,o);for(let p=0;p<a.length;p+=1)a[p]&&a[p].m(o,null);qe(o,l[5],!0),c||(r=le(o,"change",l[24]),c=!0)},p(d,m){if(m[0]&8192){u=d[13];let p;for(p=0;p<u.length;p+=1){const _=An(d,u,p);a[p]?a[p].p(_,m):(a[p]=zn(_),a[p].c(),a[p].m(o,null))}for(;p<a.length;p+=1)a[p].d(1);a.length=u.length}m[0]&4&&(o.disabled=d[2]),m[0]&8224&&qe(o,d[5])},i:Pe,o:Pe,d(d){d&&R(e),xe(a,d),c=!1,r()}}}function zn(l){let e,t=l[33].label+"",n;return{c(){e=f("option"),n=K(t),e.__value=l[33].value,e.value=e.__value},m(o,c){E(o,e,c),s(e,n)},p:Pe,d(o){o&&R(e)}}}function hi(l){let e,t,n;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-cloud-upload-alt"></i>',t=h(),n=f("span"),n.textContent="Save to Atomic Server",i(e,"class","icon")},m(o,c){E(o,e,c),E(o,t,c),E(o,n,c)},p:Pe,d(o){o&&R(e),o&&R(t),o&&R(n)}}}function gi(l){let e;return{c(){e=K("Cancel")},m(t,n){E(t,e,n)},d(t){t&&R(e)}}}function vi(l){let e,t,n,o,c,r,u,a,d,m,p,_,v,y=l[4]&&Nn(l),b=l[3]&&Dn(l),k=!l[4]&&Pn(l);return{c(){e=f("div"),t=f("div"),n=f("div"),n.innerHTML=`<div class="level-item"><h3 class="title is-4"><span class="icon"><i class="fas fa-save"></i></span>
            Save to Atomic Server</h3></div>`,o=h(),c=f("div"),r=f("div"),u=f("button"),a=h(),y&&y.c(),d=h(),b&&b.c(),m=h(),k&&k.c(),i(n,"class","level-left"),i(u,"class","delete is-large"),u.disabled=l[2],i(u,"aria-label","close"),i(r,"class","level-item"),i(c,"class","level-right"),i(t,"class","level svelte-48g63o"),i(e,"class","box")},m(w,C){E(w,e,C),s(e,t),s(t,n),s(t,o),s(t,c),s(c,r),s(r,u),s(e,a),y&&y.m(e,null),s(e,d),b&&b.m(e,null),s(e,m),k&&k.m(e,null),p=!0,_||(v=le(u,"click",l[17]),_=!0)},p(w,C){(!p||C[0]&4)&&(u.disabled=w[2]),w[4]?y?C[0]&16&&Y(y,1):(y=Nn(w),y.c(),Y(y,1),y.m(e,d)):y&&(Qe(),oe(y,1,1,()=>{y=null}),Ye()),w[3]?b?(b.p(w,C),C[0]&8&&Y(b,1)):(b=Dn(w),b.c(),Y(b,1),b.m(e,m)):b&&(Qe(),oe(b,1,1,()=>{b=null}),Ye()),w[4]?k&&(Qe(),oe(k,1,1,()=>{k=null}),Ye()):k?(k.p(w,C),C[0]&16&&Y(k,1)):(k=Pn(w),k.c(),Y(k,1),k.m(e,null))},i(w){p||(Y(y),Y(b),Y(k),p=!0)},o(w){oe(y),oe(b),oe(k),p=!1},d(w){w&&R(e),y&&y.d(),b&&b.d(),k&&k.d(),_=!1,v()}}}function bi(l){let e,t,n;function o(r){l[26](r)}let c={$$slots:{default:[vi]},$$scope:{ctx:l}};return l[0]!==void 0&&(c.active=l[0]),e=new Pl({props:c}),st.push(()=>at(e,"active",o)),e.$on("close",l[17]),{c(){ge(e.$$.fragment)},m(r,u){ve(e,r,u),n=!0},p(r,u){const a={};u[0]&8190|u[1]&2048&&(a.$$scope={dirty:u,ctx:r}),!t&&u[0]&1&&(t=!0,a.active=r[0],ct(()=>t=!1)),e.$set(a)},i(r){n||(Y(e.$$.fragment,r),n=!0)},o(r){oe(e.$$.fragment,r),n=!1},d(r){be(e,r)}}}function ki(l,e,t){let n,o,c;Ue(l,ot,P=>t(27,n=P)),Ue(l,At,P=>t(28,o=P)),Ue(l,Et,P=>t(12,c=P));let{active:r=!1}=e,{document:u}=e,a=!1,d=null,m=!1,p="",_="",v=!1,y="",b="",k=[],w="";const C=[{label:"Root (Server Root)",value:""},{label:"Articles Collection",value:"articles"},{label:"Documents Collection",value:"documents"},{label:"Knowledge Base",value:"knowledge-base"},{label:"Research",value:"research"},{label:"Projects",value:"projects"}];function g(){t(2,a=!1),t(3,d=null),t(4,m=!1),t(5,p=""),t(6,_=""),t(7,v=!1),t(8,y=(u==null?void 0:u.title)||""),t(9,b=(u==null?void 0:u.description)||`Article saved from Terraphim search: ${u==null?void 0:u.title}`),t(10,k=[]),t(11,w="")}function S(){var F;const P=c,M=o;if(!(M!=null&&M.roles)||!P){console.warn("No role configuration found");return}let B=null;try{for(const[Z,ie]of Object.entries(M.roles)){const ae=ie,$=typeof ae.name=="object"?ae.name.original:String(ae.name);if(Z===P||$===P){B=ae;break}}}catch(Z){console.warn("Error checking role configuration:",Z);return}if(!B){console.warn(`Role "${P}" not found in configuration`);return}t(10,k=((F=B.haystacks)==null?void 0:F.filter(Z=>Z.service==="Atomic"&&Z.location&&!Z.read_only))||[]),k.length>0&&t(11,w=k[0].location),console.log("Loaded atomic servers:",k)}function z(){const P=k.find(M=>M.location===w);return P==null?void 0:P.atomic_server_secret}function N(){const P=w.replace(/\/$/,"");if(v&&_.trim()){const M=_.trim();return M.startsWith("http://")||M.startsWith("https://")?M:`${P}/${M.replace(/^\//,"")}`}else return p?`${P}/${p}`:P}function D(){return y.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,50)}function L(){const P=w.replace(/\/$/,""),M=D(),B=Date.now();return`${P}/${M}-${B}`}async function q(){if(!w||!y.trim()){t(3,d="Please select an atomic server and provide a title");return}t(2,a=!0),t(3,d=null);try{const P=L(),M=N(),B=z();console.log("🔄 Saving article to atomic server:",{subject:P,parent:M,server:w,hasSecret:!!B});const F={subject:P,title:y.trim(),description:b.trim(),body:u.body,parent:M,shortname:D(),original_id:u.id,original_url:u.url,original_rank:u.rank,tags:u.tags||[]};if(n)await Fe("save_article_to_atomic",{article:F,serverUrl:w,atomicSecret:B});else{const Z=await fetch(`${Xe.ServerURL}/atomic/save`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({article:F,server_url:w,atomic_secret:B})});if(!Z.ok){const ie=await Z.json().catch(()=>({error:Z.statusText}));throw new Error(ie.error||`HTTP ${Z.status}: ${Z.statusText}`)}}t(4,m=!0),console.log("✅ Article saved successfully to atomic server"),setTimeout(()=>{t(0,r=!1)},2e3)}catch(P){console.error("❌ Failed to save article to atomic server:",P),t(3,d=P.message||"Failed to save article to atomic server")}finally{t(2,a=!1)}}function X(){a||t(0,r=!1)}const G=[[]];function O(){w=$t(this),t(11,w),t(10,k)}function A(P){y=P,t(8,y)}function ne(){b=this.value,t(9,b)}function I(){v=this.__value,t(7,v)}function Q(){v=this.__value,t(7,v)}function te(){p=$t(this),t(5,p),t(13,C)}function J(P){_=P,t(6,_)}function se(P){r=P,t(0,r)}return l.$$set=P=>{"active"in P&&t(0,r=P.active),"document"in P&&t(1,u=P.document)},l.$$.update=()=>{l.$$.dirty[0]&3&&r&&u&&(g(),S())},[r,u,a,d,m,p,_,v,y,b,k,w,c,C,N,L,q,X,O,A,ne,I,G,Q,te,J,se]}class wi extends _t{constructor(e){super(),ht(this,e,ki,bi,ft,{active:0,document:1},null,[-1,-1])}}async function Bl(l){return Fe("tauri",l)}async function yi(l,e){return Bl({__tauriModule:"Event",message:{cmd:"unlisten",event:l,eventId:e}})}async function Ci(l,e,t){return Bl({__tauriModule:"Event",message:{cmd:"listen",event:l,windowLabel:e,handler:Fl(t)}}).then(n=>async()=>yi(l,n))}var Fn;(function(l){l.WINDOW_RESIZED="tauri://resize",l.WINDOW_MOVED="tauri://move",l.WINDOW_CLOSE_REQUESTED="tauri://close-requested",l.WINDOW_CREATED="tauri://window-created",l.WINDOW_DESTROYED="tauri://destroyed",l.WINDOW_FOCUS="tauri://focus",l.WINDOW_BLUR="tauri://blur",l.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",l.WINDOW_THEME_CHANGED="tauri://theme-changed",l.WINDOW_FILE_DROP="tauri://file-drop",l.WINDOW_FILE_DROP_HOVER="tauri://file-drop-hover",l.WINDOW_FILE_DROP_CANCELLED="tauri://file-drop-cancelled",l.MENU="tauri://menu",l.CHECK_UPDATE="tauri://update",l.UPDATE_AVAILABLE="tauri://update-available",l.INSTALL_UPDATE="tauri://update-install",l.STATUS_UPDATE="tauri://update-status",l.DOWNLOAD_PROGRESS="tauri://update-download-progress"})(Fn||(Fn={}));async function Ti(l,e){return Ci(l,null,e)}function qn(l,e,t){const n=l.slice();return n[9]=e[t],n}function Kn(l){let e,t=l[9].name+"",n,o;return{c(){e=f("option"),n=K(t),e.__value=o=l[9].name,e.value=e.__value},m(c,r){E(c,e,r),s(e,n)},p(c,r){r&1&&t!==(t=c[9].name+"")&&we(n,t),r&1&&o!==(o=c[9].name)&&(e.__value=o,e.value=e.__value)},d(c){c&&R(e)}}}function $i(l){let e,t,n,o,c,r,u=l[0],a=[];for(let d=0;d<u.length;d+=1)a[d]=Kn(qn(l,u,d));return{c(){e=f("div"),t=f("div"),n=f("div"),o=f("select");for(let d=0;d<a.length;d+=1)a[d].c();i(n,"class","select"),i(t,"class","control"),i(e,"class","field is-grouped is-grouped-right")},m(d,m){E(d,e,m),s(e,t),s(t,n),s(n,o);for(let p=0;p<a.length;p+=1)a[p]&&a[p].m(o,null);qe(o,l[1]),c||(r=le(o,"change",l[2]),c=!0)},p(d,[m]){if(m&1){u=d[0];let p;for(p=0;p<u.length;p+=1){const _=qn(d,u,p);a[p]?a[p].p(_,m):(a[p]=Kn(_),a[p].c(),a[p].m(o,null))}for(;p<a.length;p+=1)a[p].d(1);a.length=u.length}m&3&&qe(o,d[1])},i:Pe,o:Pe,d(d){d&&R(e),xe(a,d),c=!1,r()}}}function Si(l,e,t){let n,o,c,r;Ue(l,At,_=>t(5,n=_)),Ue(l,ot,_=>t(6,o=_)),Ue(l,vn,_=>t(0,c=_)),Ue(l,Et,_=>t(1,r=_));let u="";async function a(){try{ot.set(window.__TAURI__!==void 0),o?(console.log("Loading config from Tauri"),Fe("get_config").then(_=>{console.log("get_config response",_),_&&_.status==="success"&&d(_.config)}).catch(_=>console.error("Error fetching config in Tauri:",_))):(console.log("Loading config from server"),u=`${Xe.ServerURL}/config/`,fetch(u).then(_=>_.json()).then(_=>{console.log("Config received",_),_&&_.status==="success"&&d(_.config)}).catch(_=>console.error("Error fetching config:",_)))}catch(_){console.error("Unhandled error in loadConfig:",_)}}function d(_){var k;console.log("Updating stores from config:",_);const v={default_role:_.selected_role,..._};At.set(v);const y=Object.entries(_.roles).map(([w,C])=>({name:w,...C}));vn.set(y),Et.set(_.selected_role);const b=_.roles[_.selected_role];if(console.log("Selected role settings:",b),b){const w=b.theme||"spacelab";console.log("Setting theme to:",w),hl.set(w),(k=b.kg)!=null&&k.publish?o?Fe("publish_thesaurus",{roleName:_.selected_role}).then(C=>{console.log("publish_thesaurus response",C),_l.set(C),Tt.set(!0)}).catch(C=>{console.error("Error publishing thesaurus:",C),Tt.set(!1)}):(console.log("Fetching thesaurus from HTTP endpoint for role",_.selected_role),fetch(`${Xe.ServerURL}/thesaurus/${encodeURIComponent(_.selected_role)}`).then(C=>C.json()).then(C=>{console.log("thesaurus HTTP response",C),C&&C.status==="success"&&C.thesaurus?(_l.set(C.thesaurus),Tt.set(!0)):(console.error("Failed to fetch thesaurus:",C),Tt.set(!1))}).catch(C=>{console.error("Error fetching thesaurus:",C),Tt.set(!1)})):Tt.set(!1)}else console.warn("No role settings found for:",_.selected_role),hl.set("spacelab")}typeof window<"u"&&window.__TAURI__&&Ti("role_changed",_=>{console.log("Role changed event received from backend:",_.payload),d(_.payload)});async function m(){await a()}m(),console.log("Using Terraphim Server URL:",Xe.ServerURL);function p(_){var w,C;const y=_.currentTarget.value;console.log("Role change requested:",y),Et.set(y);const b=c.find(g=>g.name===y);if(!b){console.error(`No role settings found for role: ${y}.`);return}const k=b.theme||"spacelab";hl.set(k),console.log(`Theme changed to ${k}`),At.update(g=>(g.selected_role=y,g)),o?(Fe("select_role",{roleName:y}).catch(g=>console.error("Error selecting role:",g)),(w=b.kg)!=null&&w.publish?(console.log("Publishing thesaurus for role",y),Fe("publish_thesaurus",{roleName:y}).then(g=>{_l.set(g),Tt.set(!0)})):Tt.set(!1)):(fetch(`${Xe.ServerURL}/config/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).catch(g=>console.error("Error updating config on server:",g)),(C=b.kg)!=null&&C.publish?(console.log("Fetching thesaurus from HTTP endpoint for role",y),fetch(`${Xe.ServerURL}/thesaurus/${encodeURIComponent(y)}`).then(g=>g.json()).then(g=>{console.log("thesaurus HTTP response",g),g&&g.status==="success"&&g.thesaurus?(_l.set(g.thesaurus),Tt.set(!0)):(console.error("Failed to fetch thesaurus:",g),Tt.set(!1))}).catch(g=>{console.error("Error fetching thesaurus:",g),Tt.set(!1)})):Tt.set(!1))}return[c,r,p,a]}class Ol extends _t{constructor(e){super(),ht(this,e,Si,$i,ft,{loadConfig:3})}get loadConfig(){return this.$$.ctx[3]}}function Wn(l,e,t){const n=l.slice();return n[41]=e[t],n}function Gn(l,e,t){const n=l.slice();return n[44]=e[t],n}function Bn(l){let e,t;return e=new Kl({props:{$$slots:{default:[Ei]},$$scope:{ctx:l}}}),{c(){ge(e.$$.fragment)},m(n,o){ve(e,n,o),t=!0},p(n,o){const c={};o[0]&129|o[1]&65536&&(c.$$scope={dirty:o,ctx:n}),e.$set(c)},i(n){t||(Y(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){be(e,n)}}}function Ri(l){let e=l[44]+"",t;return{c(){t=K(e)},m(n,o){E(n,t,o)},p(n,o){o[0]&1&&e!==(e=n[44]+"")&&we(t,e)},d(n){n&&R(t)}}}function Jn(l){let e,t,n,o,c,r;t=new Ml({props:{rounded:!0,$$slots:{default:[Ri]},$$scope:{ctx:l}}});function u(){return l[19](l[44])}return{c(){e=f("button"),ge(t.$$.fragment),n=h(),i(e,"class","tag-button svelte-2smypa"),e.disabled=l[7],i(e,"title","Click to view knowledge graph document")},m(a,d){E(a,e,d),ve(t,e,null),s(e,n),o=!0,c||(r=le(e,"click",u),c=!0)},p(a,d){l=a;const m={};d[0]&1|d[1]&65536&&(m.$$scope={dirty:d,ctx:l}),t.$set(m),(!o||d[0]&128)&&(e.disabled=l[7])},i(a){o||(Y(t.$$.fragment,a),o=!0)},o(a){oe(t.$$.fragment,a),o=!1},d(a){a&&R(e),be(t),c=!1,r()}}}function Ei(l){let e,t,n=l[0].tags,o=[];for(let r=0;r<n.length;r+=1)o[r]=Jn(Gn(l,n,r));const c=r=>oe(o[r],1,1,()=>{o[r]=null});return{c(){for(let r=0;r<o.length;r+=1)o[r].c();e=rt()},m(r,u){for(let a=0;a<o.length;a+=1)o[a]&&o[a].m(r,u);E(r,e,u),t=!0},p(r,u){if(u[0]&131201){n=r[0].tags;let a;for(a=0;a<n.length;a+=1){const d=Gn(r,n,a);o[a]?(o[a].p(d,u),Y(o[a],1)):(o[a]=Jn(d),o[a].c(),Y(o[a],1),o[a].m(e.parentNode,e))}for(Qe(),a=n.length;a<o.length;a+=1)c(a);Ye()}},i(r){if(!t){for(let u=0;u<n.length;u+=1)Y(o[u]);t=!0}},o(r){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)oe(o[u]);t=!1},d(r){xe(o,r),r&&R(e)}}}function Ai(l){let e,t=(l[0].rank||0)+"",n;return{c(){e=K("Rank "),n=K(t)},m(o,c){E(o,e,c),E(o,n,c)},p(o,c){c[0]&1&&t!==(t=(o[0].rank||0)+"")&&we(n,t)},d(o){o&&R(e),o&&R(n)}}}function Li(l){let e,t;return e=new Ml({props:{rounded:!0,$$slots:{default:[Ai]},$$scope:{ctx:l}}}),{c(){ge(e.$$.fragment)},m(n,o){ve(e,n,o),t=!0},p(n,o){const c={};o[0]&1|o[1]&65536&&(c.$$scope={dirty:o,ctx:n}),e.$set(c)},i(n){t||(Y(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){be(e,n)}}}function Oi(l){let e;return{c(){e=f("small"),e.textContent="No description available",i(e,"class","no-description svelte-2smypa")},m(t,n){E(t,e,n)},p:Pe,i:Pe,o:Pe,d(t){t&&R(e)}}}function Ni(l){let e,t;return e=new Il({props:{source:l[0].description}}),{c(){ge(e.$$.fragment)},m(n,o){ve(e,n,o),t=!0},p(n,o){const c={};o[0]&1&&(c.source=n[0].description),e.$set(c)},i(n){t||(Y(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){be(e,n)}}}function Vn(l){let e,t,n,o,c,r;return{c(){e=f("button"),t=f("span"),t.innerHTML='<i class="fas fa-magic" aria-hidden="true"></i>',n=h(),o=f("span"),o.textContent="AI Summary",i(t,"class","icon is-small"),i(e,"class","button is-small is-info is-outlined ai-summary-button svelte-2smypa"),e.disabled=l[9],i(e,"title","Generate AI-powered summary using OpenRouter")},m(u,a){E(u,e,a),s(e,t),s(e,n),s(e,o),c||(r=le(e,"click",l[18]),c=!0)},p(u,a){a[0]&512&&(e.disabled=u[9])},d(u){u&&R(e),c=!1,r()}}}function Qn(l){let e;return{c(){e=f("div"),e.innerHTML=`<span class="icon"><i class="fas fa-spinner fa-spin" aria-hidden="true"></i></span> 
                <small>Generating AI summary...</small>`,i(e,"class","ai-summary-loading svelte-2smypa")},m(t,n){E(t,e,n)},d(t){t&&R(e)}}}function Yn(l){let e,t,n,o,c,r,u,a,d,m;return{c(){e=f("div"),t=f("span"),t.innerHTML='<i class="fas fa-exclamation-triangle" aria-hidden="true"></i>',n=h(),o=f("small"),c=K("Summary error: "),r=K(l[10]),u=h(),a=f("button"),a.textContent="Retry",i(t,"class","icon has-text-danger"),i(o,"class","has-text-danger"),i(a,"class","button is-small is-text svelte-2smypa"),i(a,"title","Retry generating summary"),i(e,"class","ai-summary-error svelte-2smypa")},m(p,_){E(p,e,_),s(e,t),s(e,n),s(e,o),s(o,c),s(o,r),s(e,u),s(e,a),d||(m=le(a,"click",l[20]),d=!0)},p(p,_){_[0]&1024&&we(r,p[10])},d(p){p&&R(e),d=!1,m()}}}function Zn(l){let e,t,n,o,c,r,u,a,d,m,p,_,v,y,b,k,w,C,g,S;function z(L,q){return L[12]?Pi:Di}let N=z(l),D=N(l);return m=new Il({props:{source:l[8]}}),{c(){e=f("div"),t=f("div"),n=f("small"),o=f("span"),o.innerHTML='<i class="fas fa-robot" aria-hidden="true"></i>',c=K(`
                    AI Summary
                    `),D.c(),r=h(),u=f("button"),u.innerHTML='<span class="icon is-small"><i class="fas fa-times" aria-hidden="true"></i></span>',a=h(),d=f("div"),ge(m.$$.fragment),p=h(),_=f("div"),v=f("button"),y=f("span"),y.innerHTML='<i class="fas fa-redo" aria-hidden="true"></i>',b=h(),k=f("span"),k.textContent="Regenerate",i(o,"class","icon is-small"),i(n,"class","ai-summary-label svelte-2smypa"),i(u,"class","button is-small is-text svelte-2smypa"),i(u,"title","Hide AI summary"),i(t,"class","ai-summary-header svelte-2smypa"),i(d,"class","ai-summary-content svelte-2smypa"),i(y,"class","icon is-small"),i(v,"class","button is-small is-text svelte-2smypa"),v.disabled=l[9],i(v,"title","Regenerate summary"),i(_,"class","ai-summary-actions svelte-2smypa"),i(e,"class","ai-summary svelte-2smypa")},m(L,q){E(L,e,q),s(e,t),s(t,n),s(n,o),s(n,c),D.m(n,null),s(t,r),s(t,u),s(e,a),s(e,d),ve(m,d,null),s(e,p),s(e,_),s(_,v),s(v,y),s(v,b),s(v,k),C=!0,g||(S=[le(u,"click",l[21]),le(v,"click",l[22])],g=!0)},p(L,q){N!==(N=z(L))&&(D.d(1),D=N(L),D&&(D.c(),D.m(n,null)));const X={};q[0]&256&&(X.source=L[8]),m.$set(X),(!C||q[0]&512)&&(v.disabled=L[9])},i(L){C||(Y(m.$$.fragment,L),it(()=>{C&&(w||(w=il(e,al,{},!0)),w.run(1))}),C=!0)},o(L){oe(m.$$.fragment,L),w||(w=il(e,al,{},!1)),w.run(0),C=!1},d(L){L&&R(e),D.d(),be(m),L&&w&&w.end(),g=!1,Ze(S)}}}function Di(l){let e;return{c(){e=f("span"),e.textContent="fresh",i(e,"class","tag is-small is-success")},m(t,n){E(t,e,n)},d(t){t&&R(e)}}}function Pi(l){let e;return{c(){e=f("span"),e.textContent="cached",i(e,"class","tag is-small is-light")},m(t,n){E(t,e,n)},d(t){t&&R(e)}}}function Xn(l){let e;function t(c,r){return c[41].disabled?Ui:c[41].isLink?Ii:Mi}let n=t(l),o=n(l);return{c(){o.c(),e=rt()},m(c,r){o.m(c,r),E(c,e,r)},p(c,r){n===(n=t(c))&&o?o.p(c,r):(o.d(1),o=n(c),o&&(o.c(),o.m(e.parentNode,e)))},d(c){o.d(c),c&&R(e)}}}function Mi(l){let e,t,n,o,c,r,u,a,d,m;return{c(){var p,_,v;e=f("button"),t=f("span"),n=f("i"),c=h(),i(n,"class",o=Pt(l[41].icon)+" svelte-2smypa"),i(t,"class","icon is-medium"),ut(t,"has-text-primary",(p=l[41].className)==null?void 0:p.includes("primary")),ut(t,"has-text-success",(_=l[41].className)==null?void 0:_.includes("success")),ut(t,"has-text-danger",(v=l[41].className)==null?void 0:v.includes("danger")),i(e,"type","button"),i(e,"class","level-item button is-ghost svelte-2smypa"),i(e,"aria-label",r=l[41].title),i(e,"title",u=l[41].title),i(e,"data-testid",a=l[41].testId||"")},m(p,_){E(p,e,_),s(e,t),s(t,n),s(e,c),d||(m=le(e,"click",function(){Wl(l[41].action)&&l[41].action.apply(this,arguments)}),d=!0)},p(p,_){var v,y,b;l=p,_[0]&32768&&o!==(o=Pt(l[41].icon)+" svelte-2smypa")&&i(n,"class",o),_[0]&32768&&ut(t,"has-text-primary",(v=l[41].className)==null?void 0:v.includes("primary")),_[0]&32768&&ut(t,"has-text-success",(y=l[41].className)==null?void 0:y.includes("success")),_[0]&32768&&ut(t,"has-text-danger",(b=l[41].className)==null?void 0:b.includes("danger")),_[0]&32768&&r!==(r=l[41].title)&&i(e,"aria-label",r),_[0]&32768&&u!==(u=l[41].title)&&i(e,"title",u),_[0]&32768&&a!==(a=l[41].testId||"")&&i(e,"data-testid",a)},d(p){p&&R(e),d=!1,m()}}}function Ii(l){let e,t,n,o,c,r,u,a;return{c(){e=f("a"),t=f("span"),n=f("i"),c=h(),i(n,"class",o=Pt(l[41].icon)+" svelte-2smypa"),i(t,"class","icon is-medium"),ut(t,"has-text-primary",l[41].className),i(e,"href",r=l[41].href),i(e,"target","_blank"),i(e,"class","level-item"),i(e,"aria-label",u=l[41].title),i(e,"title",a=l[41].title)},m(d,m){E(d,e,m),s(e,t),s(t,n),s(e,c)},p(d,m){m[0]&32768&&o!==(o=Pt(d[41].icon)+" svelte-2smypa")&&i(n,"class",o),m[0]&32768&&ut(t,"has-text-primary",d[41].className),m[0]&32768&&r!==(r=d[41].href)&&i(e,"href",r),m[0]&32768&&u!==(u=d[41].title)&&i(e,"aria-label",u),m[0]&32768&&a!==(a=d[41].title)&&i(e,"title",a)},d(d){d&&R(e)}}}function Ui(l){let e,t,n,o,c,r,u;return{c(){e=f("button"),t=f("span"),n=f("i"),c=h(),i(n,"class",o=Pt(l[41].icon)+" svelte-2smypa"),i(t,"class","icon is-medium"),ut(t,"has-text-primary",l[41].className),i(e,"type","button"),i(e,"class","level-item button is-ghost svelte-2smypa"),i(e,"aria-label",r=l[41].title),i(e,"title",u=l[41].title),e.disabled=!0},m(a,d){E(a,e,d),s(e,t),s(t,n),s(e,c)},p(a,d){d[0]&32768&&o!==(o=Pt(a[41].icon)+" svelte-2smypa")&&i(n,"class",o),d[0]&32768&&ut(t,"has-text-primary",a[41].className),d[0]&32768&&r!==(r=a[41].title)&&i(e,"aria-label",r),d[0]&32768&&u!==(u=a[41].title)&&i(e,"title",u)},d(a){a&&R(e)}}}function xn(l){let e,t=l[41].visible&&Xn(l);return{c(){t&&t.c(),e=rt()},m(n,o){t&&t.m(n,o),E(n,e,o)},p(n,o){n[41].visible?t?t.p(n,o):(t=Xn(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(n){t&&t.d(n),n&&R(e)}}}function eo(l){let e,t,n,o,c,r;return{c(){e=f("div"),t=f("button"),n=h(),o=K(l[13]),i(t,"class","delete svelte-2smypa"),i(e,"class","notification is-danger is-light mt-2")},m(u,a){E(u,e,a),s(e,t),s(e,n),s(e,o),c||(r=le(t,"click",l[23]),c=!0)},p(u,a){a[0]&8192&&we(o,u[13])},d(u){u&&R(e),c=!1,r()}}}function to(l){let e,t,n;function o(r){l[25](r)}let c={item:l[4],kgTerm:l[5],kgRank:l[6]};return l[2]!==void 0&&(c.active=l[2]),e=new Gl({props:c}),st.push(()=>at(e,"active",o)),{c(){ge(e.$$.fragment)},m(r,u){ve(e,r,u),n=!0},p(r,u){const a={};u[0]&16&&(a.item=r[4]),u[0]&32&&(a.kgTerm=r[5]),u[0]&64&&(a.kgRank=r[6]),!t&&u[0]&4&&(t=!0,a.active=r[2],ct(()=>t=!1)),e.$set(a)},i(r){n||(Y(e.$$.fragment,r),n=!0)},o(r){oe(e.$$.fragment,r),n=!1},d(r){be(e,r)}}}function lo(l){let e,t,n;function o(r){l[26](r)}let c={document:l[0]};return l[3]!==void 0&&(c.active=l[3]),e=new wi({props:c}),st.push(()=>at(e,"active",o)),{c(){ge(e.$$.fragment)},m(r,u){ve(e,r,u),n=!0},p(r,u){const a={};u[0]&1&&(a.document=r[0]),!t&&u[0]&8&&(t=!0,a.active=r[3],ct(()=>t=!1)),e.$set(a)},i(r){n||(Y(e.$$.fragment,r),n=!0)},o(r){oe(e.$$.fragment,r),n=!1},d(r){be(e,r)}}}function ji(l){let e,t,n,o,c,r,u,a,d,m,p,_,v=l[0].title+"",y,b,k,w,C,g,S,z,N,D,L,q,X,G,O,A,ne,I,Q,te,J,se,P,M,B,F,Z,ie,ae,$,T,H=l[0].tags&&Bn(l);a=new Kl({props:{$$slots:{default:[Li]},$$scope:{ctx:l}}});const x=[Ni,Oi],ee=[];function V(re,ye){return re[0].description?0:1}S=V(l),z=ee[S]=x[S](l);let me=!l[11]&&!l[9]&&!l[10]&&Vn(l),fe=l[9]&&Qn(),ue=l[10]&&Yn(l),pe=l[11]&&l[8]&&Zn(l),_e=l[15],he=[];for(let re=0;re<_e.length;re+=1)he[re]=xn(Wn(l,_e,re));let Se=l[13]&&eo(l);function Ge(re){l[24](re)}let je={item:l[0]};l[1]!==void 0&&(je.active=l[1]),M=new Gl({props:je}),st.push(()=>at(M,"active",Ge));let Ae=l[4]&&to(l),Re=l[14]&&lo(l);return{c(){e=f("div"),t=f("article"),n=f("div"),o=f("div"),c=f("div"),H&&H.c(),r=h(),u=f("div"),ge(a.$$.fragment),d=h(),m=f("div"),p=f("button"),_=f("h2"),y=K(v),b=h(),k=f("div"),w=f("small"),w.textContent="Description:",C=h(),g=f("div"),z.c(),N=h(),D=f("div"),me&&me.c(),L=h(),fe&&fe.c(),q=h(),ue&&ue.c(),X=h(),pe&&pe.c(),G=h(),O=f("br"),ne=h(),I=f("div"),Q=f("nav"),te=f("div");for(let re=0;re<he.length;re+=1)he[re].c();se=h(),Se&&Se.c(),P=h(),ge(M.$$.fragment),F=h(),Ae&&Ae.c(),Z=h(),Re&&Re.c(),ie=rt(),i(c,"class","level-right"),i(u,"class","level-right"),i(_,"class","title svelte-2smypa"),i(p,"class","svelte-2smypa"),i(w,"class","description-label svelte-2smypa"),i(g,"class","description-content svelte-2smypa"),i(k,"class","description svelte-2smypa"),i(D,"class","ai-summary-section svelte-2smypa"),i(o,"class","content"),i(te,"class","level-right"),i(Q,"class","level is-mobile"),i(I,"class","level-right"),i(n,"class","media-content"),i(t,"class","media"),i(e,"class","box")},m(re,ye){E(re,e,ye),s(e,t),s(t,n),s(n,o),s(o,c),H&&H.m(c,null),s(o,r),s(o,u),ve(a,u,null),s(o,d),s(o,m),s(m,p),s(p,_),s(_,y),s(m,b),s(m,k),s(k,w),s(k,C),s(k,g),ee[S].m(g,null),s(m,N),s(m,D),me&&me.m(D,null),s(D,L),fe&&fe.m(D,null),s(D,q),ue&&ue.m(D,null),s(D,X),pe&&pe.m(D,null),s(m,G),s(m,O),s(n,ne),s(n,I),s(I,Q),s(Q,te);for(let Ne=0;Ne<he.length;Ne+=1)he[Ne]&&he[Ne].m(te,null);s(e,se),Se&&Se.m(e,null),E(re,P,ye),ve(M,re,ye),E(re,F,ye),Ae&&Ae.m(re,ye),E(re,Z,ye),Re&&Re.m(re,ye),E(re,ie,ye),ae=!0,$||(T=le(p,"click",l[16]),$=!0)},p(re,ye){re[0].tags?H?(H.p(re,ye),ye[0]&1&&Y(H,1)):(H=Bn(re),H.c(),Y(H,1),H.m(c,null)):H&&(Qe(),oe(H,1,1,()=>{H=null}),Ye());const Ne={};ye[0]&1|ye[1]&65536&&(Ne.$$scope={dirty:ye,ctx:re}),a.$set(Ne),(!ae||ye[0]&1)&&v!==(v=re[0].title+"")&&we(y,v);let Be=S;if(S=V(re),S===Be?ee[S].p(re,ye):(Qe(),oe(ee[Be],1,1,()=>{ee[Be]=null}),Ye(),z=ee[S],z?z.p(re,ye):(z=ee[S]=x[S](re),z.c()),Y(z,1),z.m(g,null)),!re[11]&&!re[9]&&!re[10]?me?me.p(re,ye):(me=Vn(re),me.c(),me.m(D,L)):me&&(me.d(1),me=null),re[9]?fe||(fe=Qn(),fe.c(),fe.m(D,q)):fe&&(fe.d(1),fe=null),re[10]?ue?ue.p(re,ye):(ue=Yn(re),ue.c(),ue.m(D,X)):ue&&(ue.d(1),ue=null),re[11]&&re[8]?pe?(pe.p(re,ye),ye[0]&2304&&Y(pe,1)):(pe=Zn(re),pe.c(),Y(pe,1),pe.m(D,null)):pe&&(Qe(),oe(pe,1,1,()=>{pe=null}),Ye()),ye[0]&32768){_e=re[15];let Te;for(Te=0;Te<_e.length;Te+=1){const De=Wn(re,_e,Te);he[Te]?he[Te].p(De,ye):(he[Te]=xn(De),he[Te].c(),he[Te].m(te,null))}for(;Te<he.length;Te+=1)he[Te].d(1);he.length=_e.length}re[13]?Se?Se.p(re,ye):(Se=eo(re),Se.c(),Se.m(e,null)):Se&&(Se.d(1),Se=null);const Ke={};ye[0]&1&&(Ke.item=re[0]),!B&&ye[0]&2&&(B=!0,Ke.active=re[1],ct(()=>B=!1)),M.$set(Ke),re[4]?Ae?(Ae.p(re,ye),ye[0]&16&&Y(Ae,1)):(Ae=to(re),Ae.c(),Y(Ae,1),Ae.m(Z.parentNode,Z)):Ae&&(Qe(),oe(Ae,1,1,()=>{Ae=null}),Ye()),re[14]?Re?(Re.p(re,ye),ye[0]&16384&&Y(Re,1)):(Re=lo(re),Re.c(),Y(Re,1),Re.m(ie.parentNode,ie)):Re&&(Qe(),oe(Re,1,1,()=>{Re=null}),Ye())},i(re){ae||(Y(H),Y(a.$$.fragment,re),Y(z),Y(pe),it(()=>{ae&&(A||(A=il(m,al,{},!0)),A.run(1))}),it(()=>{ae&&(J||(J=il(Q,al,{},!0)),J.run(1))}),Y(M.$$.fragment,re),Y(Ae),Y(Re),ae=!0)},o(re){oe(H),oe(a.$$.fragment,re),oe(z),oe(pe),A||(A=il(m,al,{},!1)),A.run(0),J||(J=il(Q,al,{},!1)),J.run(0),oe(M.$$.fragment,re),oe(Ae),oe(Re),ae=!1},d(re){re&&R(e),H&&H.d(),be(a),ee[S].d(),me&&me.d(),fe&&fe.d(),ue&&ue.d(),pe&&pe.d(),re&&A&&A.end(),xe(he,re),re&&J&&J.end(),Se&&Se.d(),re&&R(P),be(M,re),re&&R(F),Ae&&Ae.d(re),re&&R(Z),Re&&Re.d(re),re&&R(ie),$=!1,T()}}}function Hi(l,e,t){let n,o,c,r,u;Ue(l,Et,T=>t(31,c=T)),Ue(l,ot,T=>t(32,r=T)),Ue(l,At,T=>t(33,u=T));let{document:a}=e,d=!1,m=!1,p=!1,_=null,v=null,y=null,b=!1,k=null,w=!1,C=null,g=!1,S=!1,z=!1,N=!1,D=null,L=!1,q=!1;function X(){const T=[];return T.push({id:"download-markdown",label:"Download to Markdown",icon:"fas fa-download",action:()=>Q(),visible:!0,title:"Download document as markdown file"}),n&&T.push({id:"save-atomic",label:"Save to Atomic Server",icon:"fas fa-cloud-upload-alt",action:()=>A(),visible:!0,title:"Save article to Atomic Server",className:"has-text-primary"}),a.url&&T.push({id:"external-url",label:"Open URL",icon:"fas fa-link",action:()=>window.open(a.url,"_blank"),visible:!0,title:"Open original URL in new tab",isLink:!0,href:a.url}),T.push({id:"open-vscode",label:"Open in VSCode",icon:"fas fa-code",action:()=>te(),visible:!0,title:"Open document in VSCode",isLink:!0,href:`vscode://${encodeURIComponent(a.title)}.md?${encodeURIComponent(a.body)}`}),T.push({id:"add-context",label:N?"Added to Context ✓":z?"Adding...":"Add to Context",icon:N?"fas fa-check-circle":z?"fas fa-spinner fa-spin":"fas fa-plus-circle",action:()=>J(),visible:!0,title:N?"Document successfully added to chat context. Go to Chat tab to see it.":"Add document to LLM conversation context",disabled:z||N,className:N?"has-text-success":D?"has-text-danger":"",testId:"add-to-context-button"}),T.push({id:"chat-with-document",label:q?"Opening Chat...":L?"Adding to Chat...":"Chat with Document",icon:q?"fas fa-external-link-alt":L?"fas fa-spinner fa-spin":"fas fa-comment-dots",action:()=>se(),visible:!0,title:q?"Opening chat with this document":"Add document to context and open chat",disabled:L||q||z,className:q?"has-text-info":D?"has-text-danger":"has-text-primary",testId:"chat-with-document-button"}),T}function G(){var V;const T=c,H=u;if(!(H!=null&&H.roles)||!T)return!1;let x=null;try{for(const[me,fe]of Object.entries(H.roles)){const ue=fe,pe=typeof ue.name=="object"?ue.name.original:String(ue.name);if(me===T||pe===T){x=ue;break}}}catch(me){return console.warn("Error checking role configuration:",me),!1}return x?(((V=x.haystacks)==null?void 0:V.filter(me=>me.service==="Atomic"&&me.location&&!me.read_only))||[]).length>0:!1}const O=()=>{t(1,d=!0)},A=()=>{console.log("🔄 Opening atomic save modal for document:",a.title),t(3,p=!0)};async function ne(T){var H,x,ee,V,me;t(7,b=!0),t(5,v=T),console.log("🔍 KG Search Debug Info:"),console.log("  Tag clicked:",T),console.log("  Current role:",c),console.log("  Is Tauri mode:",r);try{if(r){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:c,term:T});const fe=await Fe("find_documents_for_kg_term",{roleName:c,term:T});console.log("  📥 Tauri response received:"),console.log("    Status:",fe.status),console.log("    Results count:",((H=fe.results)==null?void 0:H.length)||0),console.log("    Total:",fe.total||0),console.log("    Full response:",JSON.stringify(fe,null,2)),fe.status==="success"&&fe.results&&fe.results.length>0?(t(4,_=fe.results[0]),t(6,y=_.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",_.title),console.log("    Rank:",y),console.log("    Body length:",((x=_.body)==null?void 0:x.length)||0,"characters"),t(2,m=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${T}" in role: "${c}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const fe=Xe.ServerURL,ue=encodeURIComponent(c),pe=encodeURIComponent(T),_e=`${fe}/roles/${ue}/kg_search?term=${pe}`;console.log("  📤 HTTP Request details:"),console.log("    Base URL:",fe),console.log("    Role (encoded):",ue),console.log("    Term (encoded):",pe),console.log("    Full URL:",_e);const he=await fetch(_e);if(console.log("  📥 HTTP Response received:"),console.log("    Status code:",he.status),console.log("    Status text:",he.statusText),console.log("    Headers:",Object.fromEntries(he.headers.entries())),!he.ok)throw new Error(`HTTP error! Status: ${he.status} - ${he.statusText}`);const Se=await he.json();console.log("  📄 Response data:"),console.log("    Status:",Se.status),console.log("    Results count:",((ee=Se.results)==null?void 0:ee.length)||0),console.log("    Total:",Se.total||0),console.log("    Full response:",JSON.stringify(Se,null,2)),Se.status==="success"&&Se.results&&Se.results.length>0?(t(4,_=Se.results[0]),t(6,y=_.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",_.title),console.log("    Rank:",y),console.log("    Body length:",((V=_.body)==null?void 0:V.length)||0,"characters"),t(2,m=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${T}" in role: "${c}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",_e))}}catch(fe){console.error("❌ Error fetching KG document:"),console.error("  Error type:",fe.constructor.name),console.error("  Error message:",fe.message||fe),console.error("  Request details:",{tag:T,role:c,isTauri:r,timestamp:new Date().toISOString()}),!r&&((me=fe.message)!=null&&me.includes("Failed to fetch"))&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{t(7,b=!1)}}async function I(){var T;if(!(w||!a.id||!c)){t(9,w=!0),t(10,C=null),console.log("🤖 AI Summary Debug Info:"),console.log("  Document ID:",a.id),console.log("  Current role:",c),console.log("  Is Tauri mode:",r);try{const H={document_id:a.id,role:c,max_length:250,force_regenerate:!1};console.log("  📤 Summarization request:",H);let x;if(r){const me=`${Xe.ServerURL}/documents/summarize`;x=await fetch(me,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(H)})}else{const me=`${Xe.ServerURL}/documents/summarize`;x=await fetch(me,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(H)})}if(console.log("  📥 Summary response received:"),console.log("    Status code:",x.status),console.log("    Status text:",x.statusText),!x.ok)throw new Error(`HTTP error! Status: ${x.status} - ${x.statusText}`);const ee=await x.json();console.log("  📄 Summary response data:",ee),ee.status==="success"&&ee.summary?(t(8,k=ee.summary),t(12,S=ee.from_cache||!1),t(11,g=!0),console.log("  ✅ Summary generated successfully"),console.log("    Summary length:",k.length,"characters"),console.log("    From cache:",S),console.log("    Model used:",ee.model_used)):(t(10,C=ee.error||"Failed to generate summary"),console.error("  ❌ Summary generation failed:",C))}catch(H){console.error("❌ Error generating summary:"),console.error("  Error type:",H.constructor.name),console.error("  Error message:",H.message||H),console.error("  Request details:",{document_id:a.id,role:c,isTauri:r,timestamp:new Date().toISOString()}),t(10,C=H.message||"Network error occurred"),(T=H.message)!=null&&T.includes("Failed to fetch")&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Verify OpenRouter is enabled for this role"),console.error("    3. Check OPENROUTER_KEY environment variable"),console.error("    4. Verify server URL in CONFIG.ServerURL"))}finally{t(9,w=!1)}}}function Q(){console.log("📥 Downloading document as markdown:",a.title);let T=`# ${a.title}

`;T+=`**Source:** Terraphim Search
`,T+=`**Rank:** ${a.rank||"N/A"}
`,a.url&&(T+=`**URL:** ${a.url}
`),a.tags&&a.tags.length>0&&(T+=`**Tags:** ${a.tags.join(", ")}
`),T+=`**Downloaded:** ${new Date().toISOString()}

`,a.description&&(T+=`## Description

${a.description}

`),T+=`## Content

${a.body}
`;const H=`${a.title.replace(/[^a-z0-9]/gi,"_").toLowerCase()}_${Date.now()}.md`,x=new Blob([T],{type:"text/markdown"}),ee=URL.createObjectURL(x),V=window.document.createElement("a");V.href=ee,V.download=H,window.document.body.appendChild(V),V.click(),window.document.body.removeChild(V),URL.revokeObjectURL(ee),console.log("✅ Markdown file downloaded:",H)}function te(){const T=`vscode://${encodeURIComponent(a.title)}.md?${encodeURIComponent(a.body)}`;window.open(T,"_blank")}async function J(){console.log("📝 Adding document to LLM context:",a.title),z=!0,N=!1,t(13,D=null);try{let T=null;if(r){try{const V=await Fe("list_conversations");if(console.log("📋 Available conversations:",V),V!=null&&V.conversations&&V.conversations.length>0)T=V.conversations[0].id,console.log("🎯 Using existing conversation:",T);else{const me=await Fe("create_conversation",{title:"Search Context",role:c||"default"});if(me.status==="success"&&me.conversation_id)T=me.conversation_id,console.log("🆕 Created new conversation:",T);else throw new Error("Failed to create conversation: "+(me.error||"Unknown error"))}}catch(V){throw console.error("❌ Failed to manage conversations:",V),new Error("Could not create or find conversation: "+V.message)}const x={source_type:"document",document_id:a.id};a.url&&(x.url=a.url),a.tags&&a.tags.length>0&&(x.tags=a.tags.join(", ")),a.rank!==void 0&&(x.rank=a.rank.toString());const ee=await Fe("add_context_to_conversation",{conversationId:T,contextType:"document",title:a.title,content:a.body,metadata:x});console.log("✅ Document added to context via Tauri:",ee)}else{const x=Xe.ServerURL;try{const fe=await fetch(`${x}/conversations`);if(fe.ok){const ue=await fe.json();if(ue.conversations&&ue.conversations.length>0)T=ue.conversations[0].id,console.log("🎯 Using existing conversation:",T);else{const pe=await fetch(`${x}/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"Search Context",role:c||"default"})});if(pe.ok){const _e=await pe.json();if(_e.status==="success"&&_e.conversation_id)T=_e.conversation_id,console.log("🆕 Created new conversation:",T);else throw new Error("Failed to create conversation: "+(_e.error||"Unknown error"))}else throw new Error(`Failed to create conversation: ${pe.status} ${pe.statusText}`)}}else throw new Error(`Failed to list conversations: ${fe.status} ${fe.statusText}`)}catch(fe){throw console.error("❌ Failed to manage conversations:",fe),new Error("Could not create or find conversation: "+fe.message)}const ee=`${x}/conversations/${T}/context`,V=await fetch(ee,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context_type:"document",title:a.title,content:a.body,metadata:{source_type:"document",document_id:a.id,url:a.url||"",tags:a.tags?a.tags.join(", "):"",rank:a.rank?a.rank.toString():"0"}})});if(!V.ok)throw new Error(`HTTP error! Status: ${V.status} - ${V.statusText}`);const me=await V.json();console.log("✅ Document added to context via HTTP:",me)}console.log("✅ Successfully added document to LLM context"),N=!0;const H=window.document.createElement("div");H.className="notification is-success is-light",H.innerHTML=`
        <button class="delete" onclick="this.parentElement.remove()"></button>
        <strong>✓ Added to Chat Context</strong><br>
        <small>Document added successfully. <a href="/chat" class="has-text-success has-text-weight-bold">Go to Chat →</a> to see it in the context panel.</small>
      `,H.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(H),setTimeout(()=>{H.remove()},8e3),setTimeout(()=>{N=!1},5e3)}catch(T){console.error("❌ Error adding document to context:",T),t(13,D=T.message||"Failed to add document to context");const H=window.document.createElement("div");H.className="notification is-danger is-light",H.innerHTML=`
        <button class="delete" onclick="this.parentElement.remove()"></button>
        <strong>✗ Failed to Add Context</strong><br>
        <small>${D}</small>
      `,H.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(H),setTimeout(()=>{H.remove()},8e3),setTimeout(()=>{t(13,D=null)},5e3)}finally{z=!1}}async function se(){console.log("💬 Adding document to context and opening chat:",a.title),L=!0,q=!1,t(13,D=null);try{let T=null;if(r){try{const V=await Fe("list_conversations");if(console.log("📋 Available conversations:",V),V!=null&&V.conversations&&V.conversations.length>0)T=V.conversations[0].id,console.log("🎯 Using existing conversation:",T);else{const me=await Fe("create_conversation",{title:"Chat with Documents",role:c||"default"});if(me.status==="success"&&me.conversation_id)T=me.conversation_id,console.log("🆕 Created new conversation:",T);else throw new Error("Failed to create conversation: "+(me.error||"Unknown error"))}}catch(V){throw console.error("❌ Failed to manage conversations:",V),new Error("Could not create or find conversation: "+V.message)}const x={source_type:"document",document_id:a.id};a.url&&(x.url=a.url),a.tags&&a.tags.length>0&&(x.tags=a.tags.join(", ")),a.rank!==void 0&&(x.rank=a.rank.toString());const ee=await Fe("add_context_to_conversation",{conversationId:T,contextType:"document",title:a.title,content:a.body,metadata:x});console.log("✅ Document added to context via Tauri:",ee)}else{const x=Xe.ServerURL;try{const fe=await fetch(`${x}/conversations`);if(fe.ok){const ue=await fe.json();if(ue.conversations&&ue.conversations.length>0)T=ue.conversations[0].id,console.log("🎯 Using existing conversation:",T);else{const pe=await fetch(`${x}/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"Chat with Documents",role:c||"default"})});if(pe.ok){const _e=await pe.json();if(_e.status==="success"&&_e.conversation_id)T=_e.conversation_id,console.log("🆕 Created new conversation:",T);else throw new Error("Failed to create conversation: "+(_e.error||"Unknown error"))}else throw new Error(`Failed to create conversation: ${pe.status} ${pe.statusText}`)}}else throw new Error(`Failed to list conversations: ${fe.status} ${fe.statusText}`)}catch(fe){throw console.error("❌ Failed to manage conversations:",fe),new Error("Could not create or find conversation: "+fe.message)}const ee=`${x}/conversations/${T}/context`,V=await fetch(ee,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context_type:"document",title:a.title,content:a.body,metadata:{source_type:"document",document_id:a.id,url:a.url||"",tags:a.tags?a.tags.join(", "):"",rank:a.rank?a.rank.toString():"0"}})});if(!V.ok)throw new Error(`HTTP error! Status: ${V.status} - ${V.statusText}`);const me=await V.json();console.log("✅ Document added to context via HTTP:",me)}console.log("✅ Successfully added document to chat context, navigating to chat..."),q=!0;const H=window.document.createElement("div");H.className="notification is-success is-light",H.innerHTML=`
        <strong>💬 Opening Chat with Document</strong><br>
        <small>Context added successfully. Redirecting to chat...</small>
      `,H.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(H),setTimeout(()=>{H.remove(),Bs.goto("/chat")},1500),setTimeout(()=>{q=!1},2e3)}catch(T){console.error("❌ Error adding document to context and opening chat:",T),t(13,D=T.message||"Failed to add document to context");const H=window.document.createElement("div");H.className="notification is-danger is-light",H.innerHTML=`
        <button class="delete" onclick="this.parentElement.remove()"></button>
        <strong>✗ Failed to Open Chat with Document</strong><br>
        <small>${D}</small>
      `,H.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(H),setTimeout(()=>{H.remove()},8e3),setTimeout(()=>{t(13,D=null)},5e3)}finally{L=!1}}Ol[c]!==void 0&&(console.log("Have attribute",Ol[c]),Ol[c].hasOwnProperty("enableLogseq")?console.log("enable logseq True"):console.log("Didn't make it"));const P=T=>ne(T),M=()=>{t(10,C=null),I()},B=()=>t(11,g=!1),F=()=>{I()},Z=()=>t(13,D=null);function ie(T){d=T,t(1,d)}function ae(T){m=T,t(2,m)}function $(T){p=T,t(3,p)}return l.$$set=T=>{"document"in T&&t(0,a=T.document)},t(14,n=G()),t(15,o=X()),[a,d,m,p,_,v,y,b,k,w,C,g,S,D,n,o,O,ne,I,P,M,B,F,Z,ie,ae,$]}class zi extends _t{constructor(e){super(),ht(this,e,Hi,ji,ft,{document:0},null,[-1,-1])}}const Fi="/assets/terraphim_gray.png";function ml(l){const e=l.trim();if(!e)return{hasOperator:!1,operator:null,terms:[l],originalQuery:l};const t=/\b(AND)\b/,n=/\b(OR)\b/,o=/\b(and)\b/i,c=/\b(or)\b/i,r=t.test(e),u=n.test(e),a=o.test(e)&&!r,d=c.test(e)&&!u;if(r&&!u)return{hasOperator:!0,operator:"AND",terms:e.split(t).filter((p,_)=>_%2===0).map(p=>p.trim()).filter(p=>p.length>0),originalQuery:l};if(u&&!r)return{hasOperator:!0,operator:"OR",terms:e.split(n).filter((p,_)=>_%2===0).map(p=>p.trim()).filter(p=>p.length>0),originalQuery:l};if(r&&u){const m=e.indexOf(" AND "),p=e.indexOf(" OR ");if(m!==-1&&(p===-1||m<p))return{hasOperator:!0,operator:"AND",terms:e.split(/\s+(?:AND|OR)\s+/i).map(v=>v.trim()).filter(v=>v.length>0),originalQuery:l};if(p!==-1)return{hasOperator:!0,operator:"OR",terms:e.split(/\s+(?:AND|OR)\s+/i).map(v=>v.trim()).filter(v=>v.length>0),originalQuery:l}}if(a&&!d)return{hasOperator:!0,operator:"AND",terms:e.split(o).filter((p,_)=>_%2===0).map(p=>p.trim()).filter(p=>p.length>0),originalQuery:l};if(d&&!a)return{hasOperator:!0,operator:"OR",terms:e.split(c).filter((p,_)=>_%2===0).map(p=>p.trim()).filter(p=>p.length>0),originalQuery:l};if(a&&d){const m=e.toLowerCase().indexOf(" and "),p=e.toLowerCase().indexOf(" or ");if(m!==-1&&(p===-1||m<p))return{hasOperator:!0,operator:"AND",terms:e.split(/\s+(?:and|or)\s+/i).map(v=>v.trim()).filter(v=>v.length>0),originalQuery:l};if(p!==-1)return{hasOperator:!0,operator:"OR",terms:e.split(/\s+(?:and|or)\s+/i).map(v=>v.trim()).filter(v=>v.length>0),originalQuery:l}}return{hasOperator:!1,operator:null,terms:[e],originalQuery:l}}function no(l,e){var n,o;if(l.hasOperator&&l.terms.length>1){const c=l.terms.filter(r=>r.trim().length>0);if(c.length>1)return{search_term:c[0],search_terms:c,operator:(n=l.operator)==null?void 0:n.toLowerCase(),skip:0,limit:50,role:e||null}}return{search_term:((o=l.terms[0])==null?void 0:o.trim())||"",search_terms:void 0,operator:void 0,skip:0,limit:50,role:e||null}}function oo(l,e,t){const n=l.slice();return n[40]=e[t],n}function so(l,e,t){const n=l.slice();return n[43]=e[t],n[45]=t,n}function ro(l,e,t){const n=l.slice();return n[46]=e[t],n[45]=t,n}function io(l){let e,t=l[3],n=[];for(let o=0;o<t.length;o+=1)n[o]=ao(ro(l,t,o));return{c(){e=f("ul");for(let o=0;o<n.length;o+=1)n[o].c();i(e,"class","suggestions svelte-1pq1n28")},m(o,c){E(o,e,c);for(let r=0;r<n.length;r+=1)n[r]&&n[r].m(e,null)},p(o,c){if(c[0]&8216){t=o[3];let r;for(r=0;r<t.length;r+=1){const u=ro(o,t,r);n[r]?n[r].p(u,c):(n[r]=ao(u),n[r].c(),n[r].m(e,null))}for(;r<n.length;r+=1)n[r].d(1);n.length=t.length}},d(o){o&&R(e),xe(n,o)}}}function ao(l){let e,t=l[46]+"",n,o,c,r,u,a;function d(){return l[21](l[46])}function m(...p){return l[22](l[46],...p)}return{c(){e=f("li"),n=K(t),o=h(),i(e,"tabindex","0"),i(e,"role","option"),i(e,"aria-selected",c=l[45]===l[4]),i(e,"aria-label",r=`Apply suggestion: ${l[46]}`),i(e,"class","svelte-1pq1n28"),ut(e,"active",l[45]===l[4])},m(p,_){E(p,e,_),s(e,n),s(e,o),u||(a=[le(e,"click",d),le(e,"keydown",m)],u=!0)},p(p,_){l=p,_[0]&8&&t!==(t=l[46]+"")&&we(n,t),_[0]&16&&c!==(c=l[45]===l[4])&&i(e,"aria-selected",c),_[0]&8&&r!==(r=`Apply suggestion: ${l[46]}`)&&i(e,"aria-label",r),_[0]&16&&ut(e,"active",l[45]===l[4])},d(p){p&&R(e),u=!1,Ze(a)}}}function co(l){let e,t,n,o,c,r,u;return t=new Kl({props:{$$slots:{default:[Wi]},$$scope:{ctx:l}}}),{c(){e=f("div"),ge(t.$$.fragment),n=h(),o=f("button"),o.textContent="Clear all",i(o,"type","button"),i(o,"class","clear-terms-btn svelte-1pq1n28"),i(e,"class","selected-terms-section svelte-1pq1n28")},m(a,d){E(a,e,d),ve(t,e,null),s(e,n),s(e,o),c=!0,r||(u=le(o,"click",l[15]),r=!0)},p(a,d){const m={};d[0]&192|d[1]&131072&&(m.$$scope={dirty:d,ctx:a}),t.$set(m)},i(a){c||(Y(t.$$.fragment,a),c=!0)},o(a){oe(t.$$.fragment,a),c=!1},d(a){a&&R(e),be(t),r=!1,u()}}}function qi(l){let e=l[43].value+"",t,n,o,c,r,u,a;function d(){return l[23](l[43])}return{c(){t=K(e),n=h(),o=f("button"),c=K("×"),i(o,"class","remove-tag-btn svelte-1pq1n28"),i(o,"aria-label",r=`Remove term: ${l[43].value}`)},m(m,p){E(m,t,p),E(m,n,p),E(m,o,p),s(o,c),u||(a=le(o,"click",Fs(d)),u=!0)},p(m,p){l=m,p[0]&64&&e!==(e=l[43].value+"")&&we(t,e),p[0]&64&&r!==(r=`Remove term: ${l[43].value}`)&&i(o,"aria-label",r)},d(m){m&&R(t),m&&R(n),m&&R(o),u=!1,a()}}}function uo(l){let e,t,n,o;return t=new Ml({props:{class:"operator-tag",rounded:!0,$$slots:{default:[Ki]},$$scope:{ctx:l}}}),{c(){e=f("div"),ge(t.$$.fragment),n=h(),i(e,"class","operator-tag-wrapper svelte-1pq1n28")},m(c,r){E(c,e,r),ve(t,e,null),s(e,n),o=!0},p(c,r){const u={};r[0]&128|r[1]&131072&&(u.$$scope={dirty:r,ctx:c}),t.$set(u)},i(c){o||(Y(t.$$.fragment,c),o=!0)},o(c){oe(t.$$.fragment,c),o=!1},d(c){c&&R(e),be(t)}}}function Ki(l){let e=(l[7]||"AND")+"",t;return{c(){t=K(e)},m(n,o){E(n,t,o)},p(n,o){o[0]&128&&e!==(e=(n[7]||"AND")+"")&&we(t,e)},d(n){n&&R(t)}}}function fo(l){let e,t,n,o,c;function r(){return l[24](l[43])}t=new Ml({props:{rounded:!0,title:"Click to remove term",$$slots:{default:[qi]},$$scope:{ctx:l}}}),t.$on("click",r);let u=l[45]<l[6].length-1&&uo(l);return{c(){e=f("div"),ge(t.$$.fragment),n=h(),u&&u.c(),o=rt(),i(e,"class","term-tag-wrapper svelte-1pq1n28"),ut(e,"from-kg",l[43].isFromKG)},m(a,d){E(a,e,d),ve(t,e,null),E(a,n,d),u&&u.m(a,d),E(a,o,d),c=!0},p(a,d){l=a;const m={};d[0]&64|d[1]&131072&&(m.$$scope={dirty:d,ctx:l}),t.$set(m),(!c||d[0]&64)&&ut(e,"from-kg",l[43].isFromKG),l[45]<l[6].length-1?u?(u.p(l,d),d[0]&64&&Y(u,1)):(u=uo(l),u.c(),Y(u,1),u.m(o.parentNode,o)):u&&(Qe(),oe(u,1,1,()=>{u=null}),Ye())},i(a){c||(Y(t.$$.fragment,a),Y(u),c=!0)},o(a){oe(t.$$.fragment,a),oe(u),c=!1},d(a){a&&R(e),be(t),a&&R(n),u&&u.d(a),a&&R(o)}}}function Wi(l){let e,t,n=l[6],o=[];for(let r=0;r<n.length;r+=1)o[r]=fo(so(l,n,r));const c=r=>oe(o[r],1,1,()=>{o[r]=null});return{c(){for(let r=0;r<o.length;r+=1)o[r].c();e=rt()},m(r,u){for(let a=0;a<o.length;a+=1)o[a]&&o[a].m(r,u);E(r,e,u),t=!0},p(r,u){if(u[0]&16576){n=r[6];let a;for(a=0;a<n.length;a+=1){const d=so(r,n,a);o[a]?(o[a].p(d,u),Y(o[a],1)):(o[a]=fo(d),o[a].c(),Y(o[a],1),o[a].m(e.parentNode,e))}for(Qe(),a=n.length;a<o.length;a+=1)c(a);Ye()}},i(r){if(!t){for(let u=0;u<n.length;u+=1)Y(o[u]);t=!0}},o(r){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)oe(o[u]);t=!1},d(r){xe(o,r),r&&R(e)}}}function po(l){let e,t,n;return{c(){e=f("button"),e.textContent="Parse Terms",i(e,"type","button"),i(e,"class","button is-small is-info")},m(o,c){E(o,e,c),t||(n=le(e,"click",l[29]),t=!0)},p:Pe,d(o){o&&R(e),t=!1,n()}}}function Gi(l){let e,t,n,o,c,r,u,a,d,m,p,_,v,y,b,k,w,C,g,S,z,N=l[0]&&(l[0].includes(" AND ")||l[0].includes(" OR "))&&l[6].length===0,D,L,q,X;function G(Q){l[20](Q)}let O={type:"search",placeholder:l[9]?`Search over Knowledge graph for ${l[8]}`:"Search",icon:"search",expanded:!0,autofocus:!0};l[0]!==void 0&&(O.value=l[0]),n=new Yt({props:O}),st.push(()=>at(n,"value",G)),n.$on("click",l[16]),n.$on("submit",l[16]),n.$on("keydown",l[12]),n.$on("input",l[11]);let A=l[3].length>0&&io(l),ne=l[6].length>0&&co(l),I=N&&po(l);return L=bs(l[26][0]),{c(){e=f("div"),t=f("div"),ge(n.$$.fragment),c=h(),A&&A.c(),r=h(),ne&&ne.c(),u=h(),a=f("div"),d=f("div"),m=f("label"),p=f("input"),_=K(`
            Exact`),v=h(),y=f("label"),b=f("input"),k=K(`
            All (AND)`),w=h(),C=f("label"),g=f("input"),S=K(`
            Any (OR)`),z=h(),I&&I.c(),i(t,"class","input-wrapper svelte-1pq1n28"),i(p,"type","radio"),p.__value="none",p.value=p.__value,i(p,"class","svelte-1pq1n28"),i(m,"class","radio svelte-1pq1n28"),i(b,"type","radio"),b.__value="and",b.value=b.__value,i(b,"class","svelte-1pq1n28"),i(y,"class","radio svelte-1pq1n28"),i(g,"type","radio"),g.__value="or",g.value=g.__value,i(g,"class","svelte-1pq1n28"),i(C,"class","radio svelte-1pq1n28"),i(d,"class","control svelte-1pq1n28"),i(a,"class","operator-controls svelte-1pq1n28"),i(e,"class","search-row svelte-1pq1n28"),L.p(p,b,g)},m(Q,te){E(Q,e,te),s(e,t),ve(n,t,null),s(t,c),A&&A.m(t,null),s(e,r),ne&&ne.m(e,null),s(e,u),s(e,a),s(a,d),s(d,m),s(m,p),p.checked=p.__value===l[5],s(m,_),s(d,v),s(d,y),s(y,b),b.checked=b.__value===l[5],s(y,k),s(d,w),s(d,C),s(C,g),g.checked=g.__value===l[5],s(C,S),s(a,z),I&&I.m(a,null),D=!0,q||(X=[le(p,"change",l[25]),le(b,"change",l[27]),le(g,"change",l[28])],q=!0)},p(Q,te){const J={};te[0]&768&&(J.placeholder=Q[9]?`Search over Knowledge graph for ${Q[8]}`:"Search"),!o&&te[0]&1&&(o=!0,J.value=Q[0],ct(()=>o=!1)),n.$set(J),Q[3].length>0?A?A.p(Q,te):(A=io(Q),A.c(),A.m(t,null)):A&&(A.d(1),A=null),Q[6].length>0?ne?(ne.p(Q,te),te[0]&64&&Y(ne,1)):(ne=co(Q),ne.c(),Y(ne,1),ne.m(e,u)):ne&&(Qe(),oe(ne,1,1,()=>{ne=null}),Ye()),te[0]&32&&(p.checked=p.__value===Q[5]),te[0]&32&&(b.checked=b.__value===Q[5]),te[0]&32&&(g.checked=g.__value===Q[5]),te[0]&65&&(N=Q[0]&&(Q[0].includes(" AND ")||Q[0].includes(" OR "))&&Q[6].length===0),N?I?I.p(Q,te):(I=po(Q),I.c(),I.m(a,null)):I&&(I.d(1),I=null)},i(Q){D||(Y(n.$$.fragment,Q),Y(ne),D=!0)},o(Q){oe(n.$$.fragment,Q),oe(ne),D=!1},d(Q){Q&&R(e),be(n),A&&A.d(),ne&&ne.d(),I&&I.d(),L.r(),q=!1,Ze(X)}}}function Bi(l){let e,t,n,o,c,r,u,a,d,m;return{c(){e=f("section"),t=f("div"),n=f("img"),c=h(),r=f("p"),r.textContent="I am Terraphim, your personal assistant.",u=h(),a=f("button"),a.innerHTML=`<span class="icon"><i class="fas fa-magic"></i></span> 
        <span>Configuration Wizard</span>`,zs(n.src,o=Fi)||i(n,"src",o),i(n,"alt","Terraphim Logo"),i(n,"class","svelte-1pq1n28"),i(a,"class","button is-primary"),i(a,"data-testid","wizard-start"),i(t,"class","content has-text-grey has-text-centered svelte-1pq1n28"),i(e,"class","section")},m(p,_){E(p,e,_),s(e,t),s(t,n),s(t,c),s(t,r),s(t,u),s(t,a),d||(m=le(a,"click",l[30]),d=!0)},p:Pe,i:Pe,o:Pe,d(p){p&&R(e),d=!1,m()}}}function Ji(l){let e,t,n=l[1],o=[];for(let r=0;r<n.length;r+=1)o[r]=mo(oo(l,n,r));const c=r=>oe(o[r],1,1,()=>{o[r]=null});return{c(){for(let r=0;r<o.length;r+=1)o[r].c();e=rt()},m(r,u){for(let a=0;a<o.length;a+=1)o[a]&&o[a].m(r,u);E(r,e,u),t=!0},p(r,u){if(u[0]&2){n=r[1];let a;for(a=0;a<n.length;a+=1){const d=oo(r,n,a);o[a]?(o[a].p(d,u),Y(o[a],1)):(o[a]=mo(d),o[a].c(),Y(o[a],1),o[a].m(e.parentNode,e))}for(Qe(),a=n.length;a<o.length;a+=1)c(a);Ye()}},i(r){if(!t){for(let u=0;u<n.length;u+=1)Y(o[u]);t=!0}},o(r){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)oe(o[u]);t=!1},d(r){xe(o,r),r&&R(e)}}}function Vi(l){let e,t;return{c(){e=f("p"),t=K(l[2]),i(e,"class","error svelte-1pq1n28")},m(n,o){E(n,e,o),s(e,t)},p(n,o){o[0]&4&&we(t,n[2])},i:Pe,o:Pe,d(n){n&&R(e)}}}function mo(l){let e,t;return e=new zi({props:{document:l[40]}}),{c(){ge(e.$$.fragment)},m(n,o){ve(e,n,o),t=!0},p(n,o){const c={};o[0]&2&&(c.document=n[40]),e.$set(c)},i(n){t||(Y(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){be(e,n)}}}function Qi(l){let e,t,n,o,c,r,u,a,d,m,p;e=new cl({props:{fallbackPath:"/"}}),o=new qt({props:{$$slots:{default:[Gi]},$$scope:{ctx:l}}});const _=[Vi,Ji,Bi],v=[];function y(b,k){return b[2]?0:b[1].length?1:2}return r=y(l),u=v[r]=_[r](l),{c(){ge(e.$$.fragment),t=h(),n=f("form"),ge(o.$$.fragment),c=h(),u.c(),a=rt()},m(b,k){ve(e,b,k),E(b,t,k),E(b,n,k),ve(o,n,null),E(b,c,k),v[r].m(b,k),E(b,a,k),d=!0,m||(p=le(n,"submit",Hs(l[16])),m=!0)},p(b,k){const w={};k[0]&1017|k[1]&131072&&(w.$$scope={dirty:k,ctx:b}),o.$set(w);let C=r;r=y(b),r===C?v[r].p(b,k):(Qe(),oe(v[C],1,1,()=>{v[C]=null}),Ye(),u=v[r],u?u.p(b,k):(u=v[r]=_[r](b),u.c()),Y(u,1),u.m(a.parentNode,a))},i(b){d||(Y(e.$$.fragment,b),Y(o.$$.fragment,b),Y(u),d=!0)},o(b){oe(e.$$.fragment,b),oe(o.$$.fragment,b),oe(u),d=!1},d(b){be(e,b),b&&R(t),b&&R(n),be(o),b&&R(c),v[r].d(b),b&&R(a),m=!1,p()}}}function Yi(l,e,t){let n,o,c,r,u,a,d;Ue(l,mr,$=>t(32,o=$)),Ue(l,zt,$=>t(0,c=$)),Ue(l,ot,$=>t(33,r=$)),Ue(l,Et,$=>t(8,u=$)),Ue(l,_l,$=>t(19,a=$)),Ue(l,Tt,$=>t(9,d=$));let m=[],p=null,_=[],v=-1,y="none",b=[],k=null,w=!1,C=null;gs(()=>{C&&clearTimeout(C)});function g($){const T=ml($);if(T.hasOperator&&T.terms.length>1){const H=T.terms.map(V=>{const me=n.some(([fe])=>fe.toLowerCase()===V.toLowerCase());return{value:V,isFromKG:me}}),x=b.map(V=>V.value),ee=H.map(V=>V.value);(JSON.stringify(x)!==JSON.stringify(ee)||k!==T.operator)&&(t(6,b=H),t(7,k=T.operator))}else T.terms.length===1&&b.length>0?(t(6,b=[]),t(7,k=null)):T.terms.length===0&&(t(6,b=[]),t(7,k=null))}async function S($){try{if(r){const T=await Fe("get_autocomplete_suggestions",{query:$,roleName:u,limit:8});if(T.status==="success"&&T.suggestions)return T.suggestions.map(H=>H.term)}else{const T=await fetch(`${o.replace("/documents/search","")}/autocomplete/${encodeURIComponent(u)}/${encodeURIComponent($)}`);if(T.ok){const H=await T.json();if(H.status==="success"&&H.suggestions)return H.suggestions.map(x=>x.term)}}return n.filter(([T])=>T.toLowerCase().includes($.toLowerCase())).map(([T])=>T).slice(0,8)}catch(T){return console.warn("Error fetching term suggestions:",T),[]}}async function z($){const T=$.trim();if(T.length===0)return[];const x=ml(T),ee=T.split(/\s+/),V=ee[ee.length-1].toLowerCase();if(y!=="none")return V.length<2?[]:S(V);if(x.hasOperator&&x.terms.length>0){const fe=x.terms[x.terms.length-1];return fe&&fe.length>=2?S(fe):[]}if(ee.length>1&&y==="none"){const fe=[];if("and".startsWith(V)&&fe.push("AND"),"or".startsWith(V)&&fe.push("OR"),fe.length>0)return fe}const me=T.toLowerCase();if(me.includes(" and ")||me.includes(" or ")||me.includes(" AND ")||me.includes(" OR ")){const fe=V;return fe.length<2?[]:S(fe)}try{const fe=await S(T);return ee.length===1&&ee[0].length>2&&y==="none"?[...fe.slice(0,5),"AND","OR"]:fe}catch(fe){console.warn("Error fetching autocomplete suggestions:",fe);const ue=n.filter(([pe])=>pe.toLowerCase().includes(T.toLowerCase())).map(([pe])=>pe).slice(0,5);return ee.length===1&&ee[0].length>2&&y==="none"?[...ue,"AND","OR"]:ue}}async function N($){const T=$.target;if(!T||T.selectionStart==null)return;const H=T.selectionStart,x=c.slice(0,H),ee=x.split(/\s+/),V=ee[ee.length-1];if(V.toLowerCase()==="a"||V.toLowerCase()==="an")t(3,_=["AND"]);else if(V.toLowerCase()==="o"||V.toLowerCase()==="or")t(3,_=["OR"]);else if(V.length>=2)try{const me=await z(V);ee.length>1&&!x.includes(" AND ")&&!x.includes(" OR ")?t(3,_=[...me,"AND","OR"]):t(3,_=me)}catch(me){console.warn("Failed to get suggestions:",me),t(3,_=[])}else t(3,_=[]);t(4,v=-1)}function D($){_.length>0?$.key==="ArrowDown"?($.preventDefault(),t(4,v=(v+1)%_.length)):$.key==="ArrowUp"?($.preventDefault(),t(4,v=(v-1+_.length)%_.length)):($.key==="Enter"||$.key==="Tab")&&v!==-1?($.preventDefault(),q(_[v])):$.key==="Escape"&&($.preventDefault(),t(3,_=[]),t(4,v=-1)):$.key==="Enter"&&($.preventDefault(),L())}function L(){g(c),I()}function q($){if($==="AND"||$==="OR"){t(7,k=$);const T=ml(c);T.terms.length>0&&!b.some(H=>H.value===T.terms[T.terms.length-1])&&G(T.terms[T.terms.length-1]),jt(zt,c=c+` ${$} `,c)}else{const T=c.trim().split(/\s+/),H=T[T.length-1];$.toLowerCase().startsWith(H.toLowerCase())?(T[T.length-1]=$,jt(zt,c=T.join(" "),c)):G($,k)}t(3,_=[]),t(4,v=-1)}function X(){const $=c.trim();if(!$)return null;if(y!=="none"){const x=ml($),ee=x.hasOperator?x.terms:$.split(/\s+/).filter(V=>V.length>0);return ee.length>1?{...no({hasOperator:!0,operator:y==="and"?"AND":"OR",terms:ee,originalQuery:$},u),skip:0,limit:10}:{search_term:$,skip:0,limit:10,role:u}}const T=ml($);return{...no(T,u),skip:0,limit:10}}function G($,T=null){const H=n.some(([x])=>x.toLowerCase()===$.toLowerCase());b.some(x=>x.value.toLowerCase()===$.toLowerCase())||(t(6,b=[...b,{value:$,isFromKG:H}]),T&&b.length>1&&t(7,k=T),A())}function O($){t(6,b=b.filter(T=>T.value!==$)),A()}function A(){if(t(17,w=!0),b.length===0)jt(zt,c="",c),t(7,k=null);else if(b.length===1)jt(zt,c=b[0].value,c),t(7,k=null);else{const $=k||"AND";jt(zt,c=b.map(T=>T.value).join(` ${$} `),c)}setTimeout(()=>{t(17,w=!1)},10)}function ne(){t(6,b=[]),t(7,k=null),jt(zt,c="",c)}async function I(){if(t(2,p=null),r){if(!c.trim())return;try{const $=X();if(!$)return;const T=await Fe("search",{searchQuery:$});T.status==="success"?(t(1,m=T.results),console.log("Response results"),console.log(m)):(t(2,p=`Search failed: ${T.status}`),console.error("Search failed:",T))}catch($){t(2,p=`Error in Tauri search: ${$}`),console.error("Error in Tauri search:",$)}}else{if(!c.trim())return;const $=X();if(!$)return;const T=JSON.stringify($);try{const H=await fetch(o,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:T}),x=await H.json();if(!H.ok)throw new Error(`HTTP error! Status: ${H.status}`);t(1,m=x.results)}catch(H){console.error("Error fetching data:",H),t(2,p=`Error fetching data: ${H}`)}}}const Q=[[]];function te($){c=$,zt.set(c)}const J=$=>q($),se=($,T)=>{(T.key==="Enter"||T.key===" ")&&(T.preventDefault(),q($))},P=$=>O($.value),M=$=>O($.value);function B(){y=this.__value,t(5,y)}function F(){y=this.__value,t(5,y)}function Z(){y=this.__value,t(5,y)}const ie=()=>g(c),ae=()=>window.location.href="/config/wizard";return l.$$.update=()=>{l.$$.dirty[0]&524288&&(n=Object.entries(a)),l.$$.dirty[0]&393217&&c&&!w&&(c.includes(" AND ")||c.includes(" OR ")||c.includes(" and ")||c.includes(" or "))&&(C&&clearTimeout(C),t(18,C=setTimeout(()=>{g(c),t(18,C=null)},300)))},[c,m,p,_,v,y,b,k,u,d,g,N,D,q,O,ne,I,w,C,a,te,J,se,P,M,B,Q,F,Z,ie,ae]}class Zi extends _t{constructor(e){super(),ht(this,e,Yi,Qi,ft,{},null,[-1,-1])}}async function _o(l={}){return typeof l=="object"&&Object.freeze(l),Bl({__tauriModule:"Dialog",message:{cmd:"openDialog",options:l}})}function ho(l,e,t){const n=l.slice();return n[71]=e[t],n[79]=t,n}function go(l,e,t){const n=l.slice();return n[77]=e[t],n[78]=e,n[79]=t,n}function vo(l,e,t){const n=l.slice();return n[80]=e[t],n}function bo(l,e,t){const n=l.slice();return n[80]=e[t],n}function ko(l,e,t){const n=l.slice();return n[85]=e[t],n[86]=e,n[87]=t,n}function wo(l,e,t){const n=l.slice();return n[88]=e[t][0],n[89]=e[t][1],n[90]=e,n[91]=t,n}function yo(l,e,t){const n=l.slice();return n[74]=e[t],n}function Co(l,e,t){const n=l.slice();return n[71]=e[t],n}function To(l,e,t){const n=l.slice();return n[74]=e[t],n}function $o(l){let e,t,n,o,c;return{c(){e=f("div"),t=f("button"),n=K(`
      Configuration saved successfully!`),i(t,"class","delete"),i(e,"class","notification is-success"),i(e,"data-testid","wizard-success")},m(r,u){E(r,e,u),s(e,t),s(e,n),o||(c=le(t,"click",l[20]),o=!0)},p:Pe,d(r){r&&R(e),o=!1,c()}}}function So(l){let e,t,n,o,c;return{c(){e=f("div"),t=f("button"),n=K(`
      Failed to save configuration. Please try again.`),i(t,"class","delete"),i(e,"class","notification is-danger"),i(e,"data-testid","wizard-error")},m(r,u){E(r,e,u),s(e,t),s(e,n),o||(c=le(t,"click",l[21]),o=!0)},p:Pe,d(r){r&&R(e),o=!1,c()}}}function Xi(l){let e,t,n,o,c,r,u,a,d,m=l[3].id+"",p,_,v,y,b,k=l[3].global_shortcut+"",w,C,g,S,z,N=l[3].default_theme+"",D,L,q,X,G,O=l[3].default_role+"",A,ne,I,Q,te,J,se=JSON.stringify(l[3],null,2)+"",P,M=l[3].roles,B=[];for(let F=0;F<M.length;F+=1)B[F]=Ro(ho(l,M,F));return{c(){e=f("h4"),e.textContent="Review",t=h(),n=f("div"),o=f("h5"),o.textContent="Configuration Summary:",c=h(),r=f("ul"),u=f("li"),a=f("strong"),a.textContent="Configuration ID:",d=h(),p=K(m),_=h(),v=f("li"),y=f("strong"),y.textContent="Global Shortcut:",b=h(),w=K(k),C=h(),g=f("li"),S=f("strong"),S.textContent="Default Theme:",z=h(),D=K(N),L=h(),q=f("li"),X=f("strong"),X.textContent="Default Role:",G=h(),A=K(O),ne=h(),I=f("h5"),I.textContent="Roles:",Q=h();for(let F=0;F<B.length;F+=1)B[F].c();te=h(),J=f("pre"),P=K(se),i(e,"class","title is-5"),i(n,"class","content"),ke(J,"max-height","300px"),ke(J,"overflow","auto")},m(F,Z){E(F,e,Z),E(F,t,Z),E(F,n,Z),s(n,o),s(n,c),s(n,r),s(r,u),s(u,a),s(u,d),s(u,p),s(r,_),s(r,v),s(v,y),s(v,b),s(v,w),s(r,C),s(r,g),s(g,S),s(g,z),s(g,D),s(r,L),s(r,q),s(q,X),s(q,G),s(q,A),s(n,ne),s(n,I),s(n,Q);for(let ie=0;ie<B.length;ie+=1)B[ie]&&B[ie].m(n,null);E(F,te,Z),E(F,J,Z),s(J,P)},p(F,Z){if(Z[0]&8&&m!==(m=F[3].id+"")&&we(p,m),Z[0]&8&&k!==(k=F[3].global_shortcut+"")&&we(w,k),Z[0]&8&&N!==(N=F[3].default_theme+"")&&we(D,N),Z[0]&8&&O!==(O=F[3].default_role+"")&&we(A,O),Z[0]&10){M=F[3].roles;let ie;for(ie=0;ie<M.length;ie+=1){const ae=ho(F,M,ie);B[ie]?B[ie].p(ae,Z):(B[ie]=Ro(ae),B[ie].c(),B[ie].m(n,null))}for(;ie<B.length;ie+=1)B[ie].d(1);B.length=M.length}Z[0]&8&&se!==(se=JSON.stringify(F[3],null,2)+"")&&we(P,se)},d(F){F&&R(e),F&&R(t),F&&R(n),xe(B,F),F&&R(te),F&&R(J)}}}function xi(l){let e,t,n=[],o=new Map,c,r,u,a,d=l[3].roles;const m=p=>p[77].name;for(let p=0;p<d.length;p+=1){let _=go(l,d,p),v=m(_);o.set(v,n[p]=qo(v,_))}return{c(){e=f("h4"),e.textContent="Roles",t=h();for(let p=0;p<n.length;p+=1)n[p].c();c=h(),r=f("button"),r.textContent="Add Role",i(e,"class","title is-5"),i(r,"class","button is-link is-light"),i(r,"data-testid","add-role")},m(p,_){E(p,e,_),E(p,t,_);for(let v=0;v<n.length;v+=1)n[v]&&n[v].m(p,_);E(p,c,_),E(p,r,_),u||(a=le(r,"click",l[12]),u=!0)},p(p,_){_[0]&516985&&(d=p[3].roles,n=qs(n,_,m,1,p,d,o,c.parentNode,Ks,qo,c,go))},d(p){p&&R(e),p&&R(t);for(let _=0;_<n.length;_+=1)n[_].d(p);p&&R(c),p&&R(r),u=!1,a()}}}function ea(l){let e,t,n,o,c,r,u,a,d,m,p,_,v,y,b,k,w,C,g,S,z,N,D,L,q,X,G,O,A,ne,I,Q=l[8],te=[];for(let P=0;P<Q.length;P+=1)te[P]=Ko(To(l,Q,P));let J=l[3].roles,se=[];for(let P=0;P<J.length;P+=1)se[P]=Wo(Co(l,J,P));return{c(){e=f("div"),t=f("label"),t.textContent="Configuration ID",n=h(),o=f("div"),c=f("div"),r=f("select"),u=f("option"),u.textContent="Desktop",a=f("option"),a.textContent="Server",d=f("option"),d.textContent="Embedded",m=h(),p=f("div"),_=f("label"),_.textContent="Global shortcut",v=h(),y=f("div"),b=f("input"),k=h(),w=f("div"),C=f("label"),C.textContent="Default theme",g=h(),S=f("div"),z=f("div"),N=f("select");for(let P=0;P<te.length;P+=1)te[P].c();D=h(),L=f("div"),q=f("label"),q.textContent="Default Role",X=h(),G=f("div"),O=f("div"),A=f("select");for(let P=0;P<se.length;P+=1)se[P].c();i(t,"class","label"),i(t,"for","config-id"),u.__value="Desktop",u.value=u.__value,a.__value="Server",a.value=a.__value,d.__value="Embedded",d.value=d.__value,i(r,"id","config-id"),l[3].id===void 0&&it(()=>l[22].call(r)),i(c,"class","select"),i(o,"class","control"),i(e,"class","field"),i(_,"class","label"),i(_,"for","global-shortcut"),i(b,"class","input"),i(b,"id","global-shortcut"),i(b,"type","text"),i(y,"class","control"),i(p,"class","field"),i(C,"class","label"),i(C,"for","default-theme"),i(N,"id","default-theme"),l[3].default_theme===void 0&&it(()=>l[24].call(N)),i(z,"class","select is-fullwidth"),i(S,"class","control"),i(w,"class","field"),i(q,"class","label"),i(q,"for","default-role"),i(A,"id","default-role"),l[3].default_role===void 0&&it(()=>l[25].call(A)),i(O,"class","select"),i(G,"class","control"),i(L,"class","field")},m(P,M){E(P,e,M),s(e,t),s(e,n),s(e,o),s(o,c),s(c,r),s(r,u),s(r,a),s(r,d),qe(r,l[3].id,!0),E(P,m,M),E(P,p,M),s(p,_),s(p,v),s(p,y),s(y,b),Oe(b,l[3].global_shortcut),E(P,k,M),E(P,w,M),s(w,C),s(w,g),s(w,S),s(S,z),s(z,N);for(let B=0;B<te.length;B+=1)te[B]&&te[B].m(N,null);qe(N,l[3].default_theme,!0),E(P,D,M),E(P,L,M),s(L,q),s(L,X),s(L,G),s(G,O),s(O,A);for(let B=0;B<se.length;B+=1)se[B]&&se[B].m(A,null);qe(A,l[3].default_role,!0),ne||(I=[le(r,"change",l[22]),le(b,"input",l[23]),le(N,"change",l[24]),le(A,"change",l[25])],ne=!0)},p(P,M){if(M[0]&264&&qe(r,P[3].id),M[0]&264&&b.value!==P[3].global_shortcut&&Oe(b,P[3].global_shortcut),M[0]&256){Q=P[8];let B;for(B=0;B<Q.length;B+=1){const F=To(P,Q,B);te[B]?te[B].p(F,M):(te[B]=Ko(F),te[B].c(),te[B].m(N,null))}for(;B<te.length;B+=1)te[B].d(1);te.length=Q.length}if(M[0]&264&&qe(N,P[3].default_theme),M[0]&8){J=P[3].roles;let B;for(B=0;B<J.length;B+=1){const F=Co(P,J,B);se[B]?se[B].p(F,M):(se[B]=Wo(F),se[B].c(),se[B].m(A,null))}for(;B<se.length;B+=1)se[B].d(1);se.length=J.length}M[0]&264&&qe(A,P[3].default_role)},d(P){P&&R(e),P&&R(m),P&&R(p),P&&R(k),P&&R(w),xe(te,P),P&&R(D),P&&R(L),xe(se,P),ne=!1,Ze(I)}}}function Ro(l){let e,t,n=l[71].name+"",o,c,r,u,a,d=l[71].shortname+"",m,p,_,v,y,b=l[71].theme+"",k,w,C,g,S,z=l[71].relevance_function+"",N,D,L,q,X,G;return{c(){e=f("div"),t=f("h6"),o=K(n),c=h(),r=f("p"),u=f("strong"),u.textContent="Shortname:",a=h(),m=K(d),p=h(),_=f("p"),v=f("strong"),v.textContent="Theme:",y=h(),k=K(b),w=h(),C=f("p"),g=f("strong"),g.textContent="Relevance Function:",S=h(),N=K(z),D=h(),L=f("button"),L.textContent="Edit Role",q=h(),i(t,"data-testid","review-role-name-"+l[79]),i(L,"class","button is-small"),i(L,"data-testid","edit-role-"+l[79]),i(e,"class","box")},m(O,A){E(O,e,A),s(e,t),s(t,o),s(e,c),s(e,r),s(r,u),s(r,a),s(r,m),s(e,p),s(e,_),s(_,v),s(_,y),s(_,k),s(e,w),s(e,C),s(C,g),s(C,S),s(C,N),s(e,D),s(e,L),s(e,q),X||(G=le(L,"click",l[68]),X=!0)},p(O,A){A[0]&8&&n!==(n=O[71].name+"")&&we(o,n),A[0]&8&&d!==(d=O[71].shortname+"")&&we(m,d),A[0]&8&&b!==(b=O[71].theme+"")&&we(k,b),A[0]&8&&z!==(z=O[71].relevance_function+"")&&we(N,z)},d(O){O&&R(e),X=!1,G()}}}function Eo(l){let e,t=l[74]+"",n;return{c(){e=f("option"),n=K(t),e.__value=l[74],e.value=e.__value},m(o,c){E(o,e,c),s(e,n)},p:Pe,d(o){o&&R(e)}}}function ta(l){let e;return{c(){e=K("Directory Path")},m(t,n){E(t,e,n)},d(t){t&&R(e)}}}function la(l){let e;return{c(){e=K("Server URL")},m(t,n){E(t,e,n)},d(t){t&&R(e)}}}function Ao(l){let e;return{c(){e=f("p"),e.textContent="Click to select directory",i(e,"class","help")},m(t,n){E(t,e,n)},d(t){t&&R(e)}}}function Lo(l){let e,t,n,o,c,r,u,a,d,m,p,_;function v(){l[34].call(u,l[79],l[87])}return{c(){e=f("div"),t=f("label"),n=K("Atomic Server Secret"),c=h(),r=f("div"),u=f("input"),d=h(),m=f("p"),m.textContent="Leave empty for anonymous access",i(t,"class","label"),i(t,"for",o=`haystack-secret-${l[79]}-${l[87]}`),i(u,"class","input"),i(u,"id",a=`haystack-secret-${l[79]}-${l[87]}`),i(u,"type","password"),i(u,"placeholder","Base64 encoded secret (optional)"),i(r,"class","control"),i(m,"class","help"),i(e,"class","field")},m(y,b){E(y,e,b),s(e,t),s(t,n),s(e,c),s(e,r),s(r,u),Oe(u,l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret),s(e,d),s(e,m),p||(_=le(u,"input",v),p=!0)},p(y,b){l=y,b[0]&264&&o!==(o=`haystack-secret-${l[79]}-${l[87]}`)&&i(t,"for",o),b[0]&264&&a!==(a=`haystack-secret-${l[79]}-${l[87]}`)&&i(u,"id",a),b[0]&264&&u.value!==l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret&&Oe(u,l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret)},d(y){y&&R(e),p=!1,_()}}}function Oo(l){let e,t,n,o,c,r,u,a,d,m,p,_,v,y,b,k,w,C,g,S,z,N,D,L,q,X,G,O,A,ne,I,Q,te,J,se,P,M,B,F,Z,ie,ae,$;function T(){l[35].call(m,l[79],l[87])}function H(...ue){return l[36](l[79],l[87],...ue)}let x=Object.entries(l[3].roles[l[79]].haystacks[l[87]].extra_parameters||{}),ee=[];for(let ue=0;ue<x.length;ue+=1)ee[ue]=No(wo(l,x,ue));function V(){return l[40](l[79],l[87])}function me(){return l[41](l[79],l[87])}function fe(){return l[42](l[79],l[87])}return{c(){e=f("div"),t=f("label"),t.textContent="Extra Parameters (for filtering)",n=h(),o=f("div"),c=f("div"),r=f("label"),u=K("Hashtag"),d=h(),m=f("input"),_=h(),v=f("div"),y=f("div"),b=f("label"),k=K("Presets"),C=h(),g=f("div"),S=f("select"),z=f("option"),z.textContent="(choose)",N=f("option"),N.textContent="#rust",D=f("option"),D.textContent="#docs",L=f("option"),L.textContent="#test",q=f("option"),q.textContent="#todo",G=h(),O=f("p"),O.innerHTML="When set, searches will enforce the hashtag alongside your query (AND), e.g. <code>-e &quot;search&quot; -e &quot;#rust&quot;</code>.",A=h();for(let ue=0;ue<ee.length;ue+=1)ee[ue].c();ne=h(),I=f("div"),Q=f("div"),te=f("button"),te.textContent="+ Tag Filter",J=h(),se=f("div"),P=f("button"),P.textContent="+ Max Results",M=h(),B=f("div"),F=f("button"),F.textContent="+ Custom Parameter",Z=h(),ie=f("p"),ie.innerHTML=`Common parameters: <code>tag</code> (e.g., &quot;#rust&quot;), <code>glob</code> (e.g., &quot;*.md&quot;),
                  <code>max_count</code> (e.g., &quot;10&quot;), <code>context</code> (e.g., &quot;5&quot;)`,i(t,"class","label"),i(r,"class","label"),i(r,"for",a=`ripgrep-hashtag-${l[79]}-${l[87]}`),i(m,"class","input"),i(m,"id",p=`ripgrep-hashtag-${l[79]}-${l[87]}`),i(m,"type","text"),i(m,"placeholder","#rust"),i(c,"class","control"),i(o,"class","field is-grouped"),i(b,"class","label"),i(b,"for",w=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`),z.__value="",z.value=z.__value,N.__value="#rust",N.value=N.__value,D.__value="#docs",D.value=D.__value,L.__value="#test",L.value=L.__value,q.__value="#todo",q.value=q.__value,i(S,"id",X=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`),i(g,"class","select is-small"),i(y,"class","control"),i(v,"class","field is-grouped"),ke(v,"margin-bottom",".5rem"),i(O,"class","help"),i(te,"class","button is-small is-link is-light"),i(Q,"class","control"),i(P,"class","button is-small is-link is-light"),i(se,"class","control"),i(F,"class","button is-small is-link is-light"),i(B,"class","control"),i(I,"class","field is-grouped"),i(ie,"class","help"),i(e,"class","field")},m(ue,pe){E(ue,e,pe),s(e,t),s(e,n),s(e,o),s(o,c),s(c,r),s(r,u),s(c,d),s(c,m),Oe(m,l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag),s(e,_),s(e,v),s(v,y),s(y,b),s(b,k),s(y,C),s(y,g),s(g,S),s(S,z),s(S,N),s(S,D),s(S,L),s(S,q),s(e,G),s(e,O),s(e,A);for(let _e=0;_e<ee.length;_e+=1)ee[_e]&&ee[_e].m(e,null);s(e,ne),s(e,I),s(I,Q),s(Q,te),s(I,J),s(I,se),s(se,P),s(I,M),s(I,B),s(B,F),s(e,Z),s(e,ie),ae||($=[le(m,"input",T),le(S,"change",H),le(te,"click",V),le(P,"click",me),le(F,"click",fe)],ae=!0)},p(ue,pe){if(l=ue,pe[0]&264&&a!==(a=`ripgrep-hashtag-${l[79]}-${l[87]}`)&&i(r,"for",a),pe[0]&264&&p!==(p=`ripgrep-hashtag-${l[79]}-${l[87]}`)&&i(m,"id",p),pe[0]&264&&m.value!==l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag&&Oe(m,l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag),pe[0]&264&&w!==(w=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`)&&i(b,"for",w),pe[0]&264&&X!==(X=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`)&&i(S,"id",X),pe[0]&393224){x=Object.entries(l[3].roles[l[79]].haystacks[l[87]].extra_parameters||{});let _e;for(_e=0;_e<x.length;_e+=1){const he=wo(l,x,_e);ee[_e]?ee[_e].p(he,pe):(ee[_e]=No(he),ee[_e].c(),ee[_e].m(e,ne))}for(;_e<ee.length;_e+=1)ee[_e].d(1);ee.length=x.length}},d(ue){ue&&R(e),xe(ee,ue),ae=!1,Ze($)}}}function No(l){let e,t,n,o,c,r,u,a,d,m,p,_,v;function y(...w){return l[37](l[79],l[87],l[88],...w)}function b(){l[38].call(u,l[79],l[87],l[88])}function k(){return l[39](l[79],l[87],l[88])}return{c(){e=f("div"),t=f("div"),n=f("input"),c=h(),r=f("div"),u=f("input"),a=h(),d=f("div"),m=f("button"),m.textContent="×",p=h(),i(n,"class","input"),i(n,"type","text"),i(n,"placeholder","Parameter name"),n.value=o=l[88],i(t,"class","control"),i(u,"class","input"),i(u,"type","text"),i(u,"placeholder","Parameter value"),i(r,"class","control is-expanded"),i(m,"class","button is-small is-danger"),i(d,"class","control"),i(e,"class","field is-grouped")},m(w,C){E(w,e,C),s(e,t),s(t,n),s(e,c),s(e,r),s(r,u),Oe(u,l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]]),s(e,a),s(e,d),s(d,m),s(e,p),_||(v=[le(n,"blur",y),le(u,"input",b),le(m,"click",k)],_=!0)},p(w,C){l=w,C[0]&264&&o!==(o=l[88])&&n.value!==o&&(n.value=o),C[0]&264&&u.value!==l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]]&&Oe(u,l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]])},d(w){w&&R(e),_=!1,Ze(v)}}}function Do(l){let e,t,n,o,c,r,u,a,d,m,p,_,v,y,b,k,w,C,g,S,z,N,D,L,q,X,G,O,A,ne,I,Q,te,J,se,P,M,B,F;function Z(){l[31].call(d,l[79],l[87])}function ie(ue,pe){return ue[3].roles[ue[79]].haystacks[ue[87]].service==="Atomic"?la:ta}let ae=ie(l),$=ae(l);function T(){l[32].call(g,l[79],l[87])}function H(){return l[33](l[79],l[87])}let x=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"&&Ao(),ee=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"&&Lo(l),V=l[3].roles[l[79]].haystacks[l[87]].service==="Ripgrep"&&Oo(l);function me(){l[43].call(A,l[79],l[87])}function fe(){return l[44](l[79],l[87])}return{c(){e=f("div"),t=f("div"),n=f("label"),o=K("Service Type"),r=h(),u=f("div"),a=f("div"),d=f("select"),m=f("option"),m.textContent="Ripgrep (File Search)",p=f("option"),p.textContent="Atomic Server",v=h(),y=f("div"),b=f("label"),$.c(),w=h(),C=f("div"),g=f("input"),D=h(),x&&x.c(),L=h(),ee&&ee.c(),q=h(),V&&V.c(),X=h(),G=f("div"),O=f("label"),A=f("input"),I=K(`
                 Read-only`),te=h(),J=f("div"),se=f("button"),P=K("Remove Haystack"),i(n,"class","label"),i(n,"for",c=`haystack-service-${l[79]}-${l[87]}`),m.__value="Ripgrep",m.value=m.__value,p.__value="Atomic",p.value=p.__value,i(d,"id",_=`haystack-service-${l[79]}-${l[87]}`),l[3].roles[l[79]].haystacks[l[87]].service===void 0&&it(Z),i(a,"class","select"),i(u,"class","control"),i(t,"class","field"),i(b,"class","label"),i(b,"for",k=`haystack-path-${l[79]}-${l[87]}`),i(g,"class","input"),i(g,"id",S=`haystack-path-${l[79]}-${l[87]}`),i(g,"type","text"),i(g,"placeholder",z=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?"https://localhost:9883":"/path/to/documents"),g.readOnly=N=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic",i(C,"class","control"),i(y,"class","field"),i(A,"id",ne=`haystack-readonly-${l[79]}-${l[87]}`),i(A,"type","checkbox"),i(O,"class","checkbox"),i(O,"for",Q=`haystack-readonly-${l[79]}-${l[87]}`),i(G,"class","field"),i(se,"class","button is-small is-danger"),i(se,"data-testid",M="remove-haystack-"+l[79]+"-"+l[87]),i(J,"class","field"),i(e,"class","box is-light")},m(ue,pe){E(ue,e,pe),s(e,t),s(t,n),s(n,o),s(t,r),s(t,u),s(u,a),s(a,d),s(d,m),s(d,p),qe(d,l[3].roles[l[79]].haystacks[l[87]].service,!0),s(e,v),s(e,y),s(y,b),$.m(b,null),s(y,w),s(y,C),s(C,g),Oe(g,l[3].roles[l[79]].haystacks[l[87]].path),s(C,D),x&&x.m(C,null),s(e,L),ee&&ee.m(e,null),s(e,q),V&&V.m(e,null),s(e,X),s(e,G),s(G,O),s(O,A),A.checked=l[3].roles[l[79]].haystacks[l[87]].read_only,s(O,I),s(e,te),s(e,J),s(J,se),s(se,P),B||(F=[le(d,"change",Z),le(g,"input",T),le(g,"click",function(){Wl(l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?H:void 0)&&(l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?H:void 0).apply(this,arguments)}),le(A,"change",me),le(se,"click",fe)],B=!0)},p(ue,pe){l=ue,pe[0]&264&&c!==(c=`haystack-service-${l[79]}-${l[87]}`)&&i(n,"for",c),pe[0]&264&&_!==(_=`haystack-service-${l[79]}-${l[87]}`)&&i(d,"id",_),pe[0]&264&&qe(d,l[3].roles[l[79]].haystacks[l[87]].service),ae!==(ae=ie(l))&&($.d(1),$=ae(l),$&&($.c(),$.m(b,null))),pe[0]&264&&k!==(k=`haystack-path-${l[79]}-${l[87]}`)&&i(b,"for",k),pe[0]&264&&S!==(S=`haystack-path-${l[79]}-${l[87]}`)&&i(g,"id",S),pe[0]&264&&z!==(z=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?"https://localhost:9883":"/path/to/documents")&&i(g,"placeholder",z),pe[0]&280&&N!==(N=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic")&&(g.readOnly=N),pe[0]&264&&g.value!==l[3].roles[l[79]].haystacks[l[87]].path&&Oe(g,l[3].roles[l[79]].haystacks[l[87]].path),l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?x||(x=Ao(),x.c(),x.m(C,null)):x&&(x.d(1),x=null),l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?ee?ee.p(l,pe):(ee=Lo(l),ee.c(),ee.m(e,q)):ee&&(ee.d(1),ee=null),l[3].roles[l[79]].haystacks[l[87]].service==="Ripgrep"?V?V.p(l,pe):(V=Oo(l),V.c(),V.m(e,X)):V&&(V.d(1),V=null),pe[0]&264&&ne!==(ne=`haystack-readonly-${l[79]}-${l[87]}`)&&i(A,"id",ne),pe[0]&264&&(A.checked=l[3].roles[l[79]].haystacks[l[87]].read_only),pe[0]&264&&Q!==(Q=`haystack-readonly-${l[79]}-${l[87]}`)&&i(O,"for",Q),pe[0]&264&&M!==(M="remove-haystack-"+l[79]+"-"+l[87])&&i(se,"data-testid",M)},d(ue){ue&&R(e),$.d(),x&&x.d(),ee&&ee.d(),V&&V.d(),B=!1,Ze(F)}}}function Po(l){var se;let e,t,n,o,c,r,u,a,d,m,p,_,v,y,b,k,w,C,g,S,z,N,D,L,q,X,G,O,A;function ne(){l[47].call(u,l[79])}function I(){return l[48](l[79])}let Q=((se=l[0][l[79]])==null?void 0:se.length)&&Mo(l);function te(){l[50].call(g,l[79])}function J(){l[51].call(L,l[79])}return{c(){e=f("div"),t=f("label"),n=K("Model"),c=h(),r=f("div"),u=f("input"),d=h(),m=f("button"),m.textContent="Fetch models",p=h(),Q&&Q.c(),_=h(),v=f("div"),y=f("label"),b=K("Base URL"),w=h(),C=f("div"),g=f("input"),z=h(),N=f("div"),D=f("label"),L=f("input"),X=K(`
               Automatically summarize search results`),i(t,"class","label"),i(t,"for",o=`llm-model-${l[79]}`),i(u,"class","input"),i(u,"id",a=`llm-model-${l[79]}`),i(u,"type","text"),i(u,"placeholder","llama3.1"),i(r,"class","control"),i(m,"class","button is-small"),i(e,"class","field"),i(y,"class","label"),i(y,"for",k=`llm-base-url-${l[79]}`),i(g,"class","input"),i(g,"id",S=`llm-base-url-${l[79]}`),i(g,"type","text"),i(g,"placeholder","http://127.0.0.1:11434"),i(C,"class","control"),i(v,"class","field"),i(L,"id",q=`llm-auto-summarize-${l[79]}`),i(L,"type","checkbox"),i(D,"class","checkbox"),i(D,"for",G=`llm-auto-summarize-${l[79]}`),i(N,"class","field")},m(P,M){E(P,e,M),s(e,t),s(t,n),s(e,c),s(e,r),s(r,u),Oe(u,l[3].roles[l[79]].llm_model),s(e,d),s(e,m),s(e,p),Q&&Q.m(e,null),E(P,_,M),E(P,v,M),s(v,y),s(y,b),s(v,w),s(v,C),s(C,g),Oe(g,l[3].roles[l[79]].llm_base_url),E(P,z,M),E(P,N,M),s(N,D),s(D,L),L.checked=l[3].roles[l[79]].llm_auto_summarize,s(D,X),O||(A=[le(u,"input",ne),le(m,"click",I),le(g,"input",te),le(L,"change",J)],O=!0)},p(P,M){var B;l=P,M[0]&264&&o!==(o=`llm-model-${l[79]}`)&&i(t,"for",o),M[0]&264&&a!==(a=`llm-model-${l[79]}`)&&i(u,"id",a),M[0]&264&&u.value!==l[3].roles[l[79]].llm_model&&Oe(u,l[3].roles[l[79]].llm_model),(B=l[0][l[79]])!=null&&B.length?Q?Q.p(l,M):(Q=Mo(l),Q.c(),Q.m(e,null)):Q&&(Q.d(1),Q=null),M[0]&264&&k!==(k=`llm-base-url-${l[79]}`)&&i(y,"for",k),M[0]&264&&S!==(S=`llm-base-url-${l[79]}`)&&i(g,"id",S),M[0]&264&&g.value!==l[3].roles[l[79]].llm_base_url&&Oe(g,l[3].roles[l[79]].llm_base_url),M[0]&264&&q!==(q=`llm-auto-summarize-${l[79]}`)&&i(L,"id",q),M[0]&264&&(L.checked=l[3].roles[l[79]].llm_auto_summarize),M[0]&264&&G!==(G=`llm-auto-summarize-${l[79]}`)&&i(D,"for",G)},d(P){P&&R(e),Q&&Q.d(),P&&R(_),P&&R(v),P&&R(z),P&&R(N),O=!1,Ze(A)}}}function Mo(l){let e,t,n,o,c=l[0][l[79]],r=[];for(let a=0;a<c.length;a+=1)r[a]=Io(bo(l,c,a));function u(...a){return l[49](l[79],...a)}return{c(){e=f("div"),t=f("select");for(let a=0;a<r.length;a+=1)r[a].c();i(e,"class","select is-fullwidth"),ke(e,"margin-top","0.5rem")},m(a,d){E(a,e,d),s(e,t);for(let m=0;m<r.length;m+=1)r[m]&&r[m].m(t,null);n||(o=le(t,"change",u),n=!0)},p(a,d){if(l=a,d[0]&9){c=l[0][l[79]];let m;for(m=0;m<c.length;m+=1){const p=bo(l,c,m);r[m]?r[m].p(p,d):(r[m]=Io(p),r[m].c(),r[m].m(t,null))}for(;m<r.length;m+=1)r[m].d(1);r.length=c.length}},d(a){a&&R(e),xe(r,a),n=!1,o()}}}function Io(l){let e,t=l[80]+"",n,o;return{c(){e=f("option"),n=K(t),e.__value=o=l[80],e.value=e.__value},m(c,r){E(c,e,r),s(e,n)},p(c,r){r[0]&9&&t!==(t=c[80]+"")&&we(n,t),r[0]&265&&o!==(o=c[80])&&(e.__value=o,e.value=e.__value)},d(c){c&&R(e)}}}function Uo(l){var pe;let e,t,n,o,c,r,u,a,d,m,p,_,v,y,b,k,w,C,g,S,z,N,D,L,q,X,G,O,A,ne,I,Q,te,J,se,P,M,B,F,Z,ie,ae,$,T;function H(){l[53].call(u,l[79])}function x(){l[54].call(C,l[79])}function ee(){return l[55](l[79])}let V=((pe=l[0][l[79]])==null?void 0:pe.length)&&jo(l);function me(){l[57].call(O,l[79])}function fe(){l[58].call(M,l[79])}let ue=l[3].roles[l[79]].openrouter_chat_enabled&&zo(l);return{c(){e=f("div"),t=f("label"),n=K("OpenRouter API Key"),c=h(),r=f("div"),u=f("input"),d=h(),m=f("p"),m.innerHTML='Get your API key from <a href="https://openrouter.ai" target="_blank" rel="noopener">OpenRouter</a>',p=h(),_=f("div"),v=f("label"),y=K("Model"),k=h(),w=f("div"),C=f("input"),S=h(),z=f("button"),z.textContent="Fetch models",N=h(),V&&V.c(),D=h(),L=f("p"),L.textContent="Choose the language model for generating summaries. Different models offer different speed/quality tradeoffs.",q=h(),X=f("div"),G=f("label"),O=f("input"),ne=K(`
               Automatically summarize search results`),Q=h(),te=f("p"),te.textContent="When enabled, summaries will be generated and shown in search results.",J=h(),se=f("div"),P=f("label"),M=f("input"),F=K(`
               Enable Chat interface (OpenRouter)`),ie=h(),ue&&ue.c(),ae=rt(),i(t,"class","label"),i(t,"for",o=`openrouter-api-key-${l[79]}`),i(u,"class","input"),i(u,"id",a=`openrouter-api-key-${l[79]}`),i(u,"type","password"),i(u,"placeholder","sk-or-v1-..."),i(r,"class","control"),i(m,"class","help"),i(e,"class","field"),i(v,"class","label"),i(v,"for",b=`openrouter-model-${l[79]}`),i(C,"class","input"),i(C,"id",g=`openrouter-model-${l[79]}`),i(C,"type","text"),i(C,"placeholder","openai/gpt-4-turbo"),i(w,"class","control"),i(z,"class","button is-small"),i(L,"class","help"),i(_,"class","field"),i(O,"id",A=`openrouter-auto-summarize-${l[79]}`),i(O,"type","checkbox"),i(G,"class","checkbox"),i(G,"for",I=`openrouter-auto-summarize-${l[79]}`),i(te,"class","help"),i(X,"class","field"),i(M,"id",B=`openrouter-chat-enabled-${l[79]}`),i(M,"type","checkbox"),i(P,"class","checkbox"),i(P,"for",Z=`openrouter-chat-enabled-${l[79]}`),i(se,"class","field")},m(_e,he){E(_e,e,he),s(e,t),s(t,n),s(e,c),s(e,r),s(r,u),Oe(u,l[3].roles[l[79]].openrouter_api_key),s(e,d),s(e,m),E(_e,p,he),E(_e,_,he),s(_,v),s(v,y),s(_,k),s(_,w),s(w,C),Oe(C,l[3].roles[l[79]].openrouter_model),s(_,S),s(_,z),s(_,N),V&&V.m(_,null),s(_,D),s(_,L),E(_e,q,he),E(_e,X,he),s(X,G),s(G,O),O.checked=l[3].roles[l[79]].openrouter_auto_summarize,s(G,ne),s(X,Q),s(X,te),E(_e,J,he),E(_e,se,he),s(se,P),s(P,M),M.checked=l[3].roles[l[79]].openrouter_chat_enabled,s(P,F),E(_e,ie,he),ue&&ue.m(_e,he),E(_e,ae,he),$||(T=[le(u,"input",H),le(C,"input",x),le(z,"click",ee),le(O,"change",me),le(M,"change",fe)],$=!0)},p(_e,he){var Se;l=_e,he[0]&264&&o!==(o=`openrouter-api-key-${l[79]}`)&&i(t,"for",o),he[0]&264&&a!==(a=`openrouter-api-key-${l[79]}`)&&i(u,"id",a),he[0]&264&&u.value!==l[3].roles[l[79]].openrouter_api_key&&Oe(u,l[3].roles[l[79]].openrouter_api_key),he[0]&264&&b!==(b=`openrouter-model-${l[79]}`)&&i(v,"for",b),he[0]&264&&g!==(g=`openrouter-model-${l[79]}`)&&i(C,"id",g),he[0]&264&&C.value!==l[3].roles[l[79]].openrouter_model&&Oe(C,l[3].roles[l[79]].openrouter_model),(Se=l[0][l[79]])!=null&&Se.length?V?V.p(l,he):(V=jo(l),V.c(),V.m(_,D)):V&&(V.d(1),V=null),he[0]&264&&A!==(A=`openrouter-auto-summarize-${l[79]}`)&&i(O,"id",A),he[0]&264&&(O.checked=l[3].roles[l[79]].openrouter_auto_summarize),he[0]&264&&I!==(I=`openrouter-auto-summarize-${l[79]}`)&&i(G,"for",I),he[0]&264&&B!==(B=`openrouter-chat-enabled-${l[79]}`)&&i(M,"id",B),he[0]&264&&(M.checked=l[3].roles[l[79]].openrouter_chat_enabled),he[0]&264&&Z!==(Z=`openrouter-chat-enabled-${l[79]}`)&&i(P,"for",Z),l[3].roles[l[79]].openrouter_chat_enabled?ue?ue.p(l,he):(ue=zo(l),ue.c(),ue.m(ae.parentNode,ae)):ue&&(ue.d(1),ue=null)},d(_e){_e&&R(e),_e&&R(p),_e&&R(_),V&&V.d(),_e&&R(q),_e&&R(X),_e&&R(J),_e&&R(se),_e&&R(ie),ue&&ue.d(_e),_e&&R(ae),$=!1,Ze(T)}}}function jo(l){let e,t,n,o,c=l[0][l[79]],r=[];for(let a=0;a<c.length;a+=1)r[a]=Ho(vo(l,c,a));function u(...a){return l[56](l[79],...a)}return{c(){e=f("div"),t=f("select");for(let a=0;a<r.length;a+=1)r[a].c();i(e,"class","select is-fullwidth"),ke(e,"margin-top","0.5rem")},m(a,d){E(a,e,d),s(e,t);for(let m=0;m<r.length;m+=1)r[m]&&r[m].m(t,null);n||(o=le(t,"change",u),n=!0)},p(a,d){if(l=a,d[0]&9){c=l[0][l[79]];let m;for(m=0;m<c.length;m+=1){const p=vo(l,c,m);r[m]?r[m].p(p,d):(r[m]=Ho(p),r[m].c(),r[m].m(t,null))}for(;m<r.length;m+=1)r[m].d(1);r.length=c.length}},d(a){a&&R(e),xe(r,a),n=!1,o()}}}function Ho(l){let e,t=l[80]+"",n,o;return{c(){e=f("option"),n=K(t),e.__value=o=l[80],e.value=e.__value},m(c,r){E(c,e,r),s(e,n)},p(c,r){r[0]&9&&t!==(t=c[80]+"")&&we(n,t),r[0]&265&&o!==(o=c[80])&&(e.__value=o,e.value=e.__value)},d(c){c&&R(e)}}}function zo(l){let e,t,n,o,c,r,u,a,d,m,p,_,v,y,b,k,w,C,g,S,z,N,D,L,q;function X(){l[59].call(a,l[79])}function G(){l[60].call(N,l[79])}return{c(){e=f("div"),t=f("label"),n=K("Chat Model"),c=h(),r=f("div"),u=f("div"),a=f("select"),d=f("option"),d.textContent="GPT-3.5 Turbo",m=f("option"),m.textContent="GPT-4",p=f("option"),p.textContent="Claude 3 Sonnet",_=f("option"),_.textContent="Claude 3 Haiku",v=f("option"),v.textContent="Mixtral 8x7B",b=h(),k=f("div"),w=f("label"),C=K("System Prompt (optional)"),S=h(),z=f("div"),N=f("textarea"),i(t,"class","label"),i(t,"for",o=`openrouter-chat-model-${l[79]}`),d.__value="openai/gpt-3.5-turbo",d.value=d.__value,m.__value="openai/gpt-4",m.value=m.__value,p.__value="anthropic/claude-3-sonnet",p.value=p.__value,_.__value="anthropic/claude-3-haiku",_.value=_.__value,v.__value="mistralai/mixtral-8x7b-instruct",v.value=v.__value,i(a,"id",y=`openrouter-chat-model-${l[79]}`),l[3].roles[l[79]].openrouter_chat_model===void 0&&it(X),i(u,"class","select is-fullwidth"),i(r,"class","control"),i(e,"class","field"),i(w,"class","label"),i(w,"for",g=`openrouter-chat-system-${l[79]}`),i(N,"class","textarea"),i(N,"id",D=`openrouter-chat-system-${l[79]}`),i(N,"rows","3"),i(N,"placeholder","You are a helpful Rust engineer assistant..."),i(z,"class","control"),i(k,"class","field")},m(O,A){E(O,e,A),s(e,t),s(t,n),s(e,c),s(e,r),s(r,u),s(u,a),s(a,d),s(a,m),s(a,p),s(a,_),s(a,v),qe(a,l[3].roles[l[79]].openrouter_chat_model,!0),E(O,b,A),E(O,k,A),s(k,w),s(w,C),s(k,S),s(k,z),s(z,N),Oe(N,l[3].roles[l[79]].openrouter_chat_system_prompt),L||(q=[le(a,"change",X),le(N,"input",G)],L=!0)},p(O,A){l=O,A[0]&264&&o!==(o=`openrouter-chat-model-${l[79]}`)&&i(t,"for",o),A[0]&264&&y!==(y=`openrouter-chat-model-${l[79]}`)&&i(a,"id",y),A[0]&264&&qe(a,l[3].roles[l[79]].openrouter_chat_model),A[0]&264&&g!==(g=`openrouter-chat-system-${l[79]}`)&&i(w,"for",g),A[0]&264&&D!==(D=`openrouter-chat-system-${l[79]}`)&&i(N,"id",D),A[0]&264&&Oe(N,l[3].roles[l[79]].openrouter_chat_system_prompt)},d(O){O&&R(e),O&&R(b),O&&R(k),L=!1,Ze(q)}}}function Fo(l){let e;return{c(){e=f("p"),e.textContent="Click to select directory",i(e,"class","help")},m(t,n){E(t,e,n)},d(t){t&&R(e)}}}function qo(l,e){let t,n,o,c,r,u,a,d,m,p,_,v,y,b,k,w,C,g,S,z,N,D,L,q,X,G,O,A,ne,I,Q,te,J,se,P,M,B,F,Z,ie,ae,$,T,H,x,ee,V,me,fe,ue,pe,_e,he,Se,Ge,je,Ae,Re,re,ye,Ne,Be,Ke,Te,De,et,Je,Me,He,tt,de,Le,U,W,j,ce,$e,Ce,Ve,nt,ze,lt,kt,gt,ul,Kt,fl,Zt,Wt,dl,Mt,wt,Jl,gl,Vl,vl,Rt,bl,Ql,Xt,xt,Yl,kl,Zl,Gt,dt,wl,Xl,xl,yl,el,tl,en,Cl,tn,Tl,Ot,ll,nl,$l,ln,ol,Ht,It,Sl,nn,Rl,on,Bt,Ut,El,sn,Al,rn,an,cn,Jt,un,Ll,Ul,fn;function $s(){e[26].call(d,e[79])}function Ss(){e[27].call(C,e[79])}let sl=e[8],pt=[];for(let We=0;We<sl.length;We+=1)pt[We]=Eo(yo(e,sl,We));function dn(){e[28].call(O,e[79])}function pn(){e[29].call(B,e[79])}function Rs(){e[30].call(V,e[79])}let rl=e[77].haystacks,mt=[];for(let We=0;We<rl.length;We+=1)mt[We]=Do(ko(e,rl,We));function Es(){return e[45](e[79])}function mn(){e[46].call(Me,e[79])}let vt=e[3].roles[e[79]].llm_provider==="ollama"&&Po(e);function As(){e[52].call(ze,e[79])}let bt=e[3].roles[e[79]].openrouter_enabled&&Uo(e);function Ls(){e[61].call(Rt,e[79])}function Os(){e[62].call(dt,e[79])}function _n(){return e[63](e[79])}let yt=e[4]&&Fo();function hn(){e[64].call(Ot,e[79])}function Ns(){e[65].call(It,e[79])}function Ds(){e[66].call(Ut,e[79])}function Ps(){return e[67](e[79])}return{key:l,first:null,c(){t=f("div"),n=f("div"),o=f("label"),c=K("Role name"),u=h(),a=f("div"),d=f("input"),p=h(),_=f("div"),v=f("label"),y=K("Short name"),k=h(),w=f("div"),C=f("input"),S=h(),z=f("div"),N=f("label"),D=K("Theme"),q=h(),X=f("div"),G=f("div"),O=f("select");for(let We=0;We<pt.length;We+=1)pt[We].c();ne=h(),I=f("div"),Q=f("label"),te=K("Relevance function"),se=h(),P=f("div"),M=f("div"),B=f("select"),F=f("option"),F.textContent="title-scorer",Z=f("option"),Z.textContent="terraphim-graph",ie=f("option"),ie.textContent="bm25",ae=f("option"),ae.textContent="bm25f",$=f("option"),$.textContent="bm25plus",H=h(),x=f("div"),ee=f("label"),V=f("input"),fe=K(`
            Enable Terraphim IT features (KG preprocessing, auto-linking)`),pe=h(),_e=f("h5"),_e.textContent="Haystacks",he=h();for(let We=0;We<mt.length;We+=1)mt[We].c();Se=h(),Ge=f("button"),je=K("Add Haystack"),Re=h(),re=f("h5"),re.textContent="AI-Enhanced Summaries (LLM Provider)",ye=h(),Ne=f("div"),Be=f("label"),Ke=K("Provider"),De=h(),et=f("div"),Je=f("div"),Me=f("select"),He=f("option"),He.textContent="(none)",tt=f("option"),tt.textContent="OpenRouter",de=f("option"),de.textContent="Ollama (local)",U=h(),W=f("p"),W.textContent="Choose a provider. OpenRouter uses API key; Ollama runs locally.",j=h(),vt&&vt.c(),ce=h(),$e=f("h5"),$e.textContent="AI-Enhanced Summaries (OpenRouter)",Ce=h(),Ve=f("div"),nt=f("label"),ze=f("input"),kt=K(`
             Enable AI-generated article summaries`),ul=h(),Kt=f("p"),Kt.textContent="Generate intelligent summaries using OpenRouter's language models",fl=h(),bt&&bt.c(),Zt=h(),Wt=f("h5"),Wt.textContent="Knowledge Graph",dl=h(),Mt=f("div"),wt=f("label"),Jl=K("Remote automata URL"),Vl=h(),vl=f("div"),Rt=f("input"),Ql=h(),Xt=f("div"),xt=f("label"),Yl=K("Local KG path"),Zl=h(),Gt=f("div"),dt=f("input"),Xl=h(),yt&&yt.c(),xl=h(),yl=f("div"),el=f("div"),tl=f("label"),en=K("Local KG type"),tn=h(),Tl=f("div"),Ot=f("select"),ll=f("option"),ll.textContent="markdown",nl=f("option"),nl.textContent="json",ln=h(),ol=f("div"),Ht=f("label"),It=f("input"),nn=K(`
             Public`),on=h(),Bt=f("label"),Ut=f("input"),sn=K(`
             Publish`),rn=h(),an=f("hr"),cn=h(),Jt=f("button"),un=K("Remove Role"),i(o,"class","label"),i(o,"for",r=`role-name-${e[79]}`),i(d,"class","input"),i(d,"id",m=`role-name-${e[79]}`),i(d,"type","text"),i(a,"class","control"),i(n,"class","field"),i(v,"class","label"),i(v,"for",b=`role-shortname-${e[79]}`),i(C,"class","input"),i(C,"id",g=`role-shortname-${e[79]}`),i(C,"type","text"),i(w,"class","control"),i(_,"class","field"),i(N,"class","label"),i(N,"for",L=`role-theme-${e[79]}`),i(O,"id",A=`role-theme-${e[79]}`),e[3].roles[e[79]].theme===void 0&&it(dn),i(G,"class","select is-fullwidth"),i(X,"class","control"),i(z,"class","field"),i(Q,"class","label"),i(Q,"for",J=`role-relevance-${e[79]}`),F.__value="title-scorer",F.value=F.__value,Z.__value="terraphim-graph",Z.value=Z.__value,ie.__value="bm25",ie.value=ie.__value,ae.__value="bm25f",ae.value=ae.__value,$.__value="bm25plus",$.value=$.__value,i(B,"id",T=`role-relevance-${e[79]}`),e[3].roles[e[79]].relevance_function===void 0&&it(pn),i(M,"class","select is-fullwidth"),i(P,"class","control"),i(I,"class","field"),i(V,"class","checkbox"),i(V,"id",me=`role-terraphim-it-${e[79]}`),i(V,"type","checkbox"),i(ee,"class","label"),i(ee,"for",ue=`role-terraphim-it-${e[79]}`),i(x,"class","field"),i(_e,"class","title is-6"),i(Ge,"class","button is-small"),i(Ge,"data-testid",Ae="add-haystack-"+e[79]),i(re,"class","title is-6"),i(Be,"class","label"),i(Be,"for",Te=`llm-provider-${e[79]}`),He.__value="",He.value=He.__value,tt.__value="openrouter",tt.value=tt.__value,de.__value="ollama",de.value=de.__value,i(Me,"id",Le=`llm-provider-${e[79]}`),e[3].roles[e[79]].llm_provider===void 0&&it(mn),i(Je,"class","select"),i(et,"class","control"),i(W,"class","help"),i(Ne,"class","field"),i($e,"class","title is-6"),i(ze,"id",lt=`openrouter-enabled-${e[79]}`),i(ze,"type","checkbox"),i(nt,"class","checkbox"),i(nt,"for",gt=`openrouter-enabled-${e[79]}`),i(Kt,"class","help"),i(Ve,"class","field"),i(Wt,"class","title is-6"),i(wt,"class","label"),i(wt,"for",gl=`kg-url-${e[79]}`),i(Rt,"class","input"),i(Rt,"id",bl=`kg-url-${e[79]}`),i(Rt,"type","text"),i(Rt,"placeholder","https://example.com/thesaurus.json"),i(vl,"class","control"),i(Mt,"class","field"),i(xt,"class","label"),i(xt,"for",kl=`kg-local-path-${e[79]}`),i(dt,"class","input"),i(dt,"id",wl=`kg-local-path-${e[79]}`),i(dt,"type","text"),i(dt,"placeholder","/path/to/markdown"),dt.readOnly=e[4],i(Gt,"class","control"),i(Xt,"class","field"),i(tl,"class","label"),i(tl,"for",Cl=`kg-local-type-${e[79]}`),ll.__value="markdown",ll.value=ll.__value,nl.__value="json",nl.value=nl.__value,i(Ot,"id",$l=`kg-local-type-${e[79]}`),e[3].roles[e[79]].kg.local_type===void 0&&it(hn),i(Tl,"class","select"),i(el,"class","control"),i(yl,"class","field is-grouped"),i(It,"id",Sl=`kg-public-${e[79]}`),i(It,"type","checkbox"),i(Ht,"class","checkbox"),i(Ht,"for",Rl=`kg-public-${e[79]}`),ke(Ht,"margin-right","1rem"),i(Ut,"id",El=`kg-publish-${e[79]}`),i(Ut,"type","checkbox"),i(Bt,"class","checkbox"),i(Bt,"for",Al=`kg-publish-${e[79]}`),i(ol,"class","field is-grouped"),i(Jt,"class","button is-small is-danger"),i(Jt,"data-testid",Ll="remove-role-"+e[79]),i(t,"class","box"),this.first=t},m(We,Ee){E(We,t,Ee),s(t,n),s(n,o),s(o,c),s(n,u),s(n,a),s(a,d),Oe(d,e[3].roles[e[79]].name),s(t,p),s(t,_),s(_,v),s(v,y),s(_,k),s(_,w),s(w,C),Oe(C,e[3].roles[e[79]].shortname),s(t,S),s(t,z),s(z,N),s(N,D),s(z,q),s(z,X),s(X,G),s(G,O);for(let Ie=0;Ie<pt.length;Ie+=1)pt[Ie]&&pt[Ie].m(O,null);qe(O,e[3].roles[e[79]].theme,!0),s(t,ne),s(t,I),s(I,Q),s(Q,te),s(I,se),s(I,P),s(P,M),s(M,B),s(B,F),s(B,Z),s(B,ie),s(B,ae),s(B,$),qe(B,e[3].roles[e[79]].relevance_function,!0),s(t,H),s(t,x),s(x,ee),s(ee,V),V.checked=e[3].roles[e[79]].terraphim_it,s(ee,fe),s(t,pe),s(t,_e),s(t,he);for(let Ie=0;Ie<mt.length;Ie+=1)mt[Ie]&&mt[Ie].m(t,null);s(t,Se),s(t,Ge),s(Ge,je),s(t,Re),s(t,re),s(t,ye),s(t,Ne),s(Ne,Be),s(Be,Ke),s(Ne,De),s(Ne,et),s(et,Je),s(Je,Me),s(Me,He),s(Me,tt),s(Me,de),qe(Me,e[3].roles[e[79]].llm_provider,!0),s(Ne,U),s(Ne,W),s(t,j),vt&&vt.m(t,null),s(t,ce),s(t,$e),s(t,Ce),s(t,Ve),s(Ve,nt),s(nt,ze),ze.checked=e[3].roles[e[79]].openrouter_enabled,s(nt,kt),s(Ve,ul),s(Ve,Kt),s(t,fl),bt&&bt.m(t,null),s(t,Zt),s(t,Wt),s(t,dl),s(t,Mt),s(Mt,wt),s(wt,Jl),s(Mt,Vl),s(Mt,vl),s(vl,Rt),Oe(Rt,e[3].roles[e[79]].kg.url),s(t,Ql),s(t,Xt),s(Xt,xt),s(xt,Yl),s(Xt,Zl),s(Xt,Gt),s(Gt,dt),Oe(dt,e[3].roles[e[79]].kg.local_path),s(Gt,Xl),yt&&yt.m(Gt,null),s(t,xl),s(t,yl),s(yl,el),s(el,tl),s(tl,en),s(el,tn),s(el,Tl),s(Tl,Ot),s(Ot,ll),s(Ot,nl),qe(Ot,e[3].roles[e[79]].kg.local_type,!0),s(t,ln),s(t,ol),s(ol,Ht),s(Ht,It),It.checked=e[3].roles[e[79]].kg.public,s(Ht,nn),s(ol,on),s(ol,Bt),s(Bt,Ut),Ut.checked=e[3].roles[e[79]].kg.publish,s(Bt,sn),s(t,rn),s(t,an),s(t,cn),s(t,Jt),s(Jt,un),Ul||(fn=[le(d,"input",$s),le(C,"input",Ss),le(O,"change",dn),le(B,"change",pn),le(V,"change",Rs),le(Ge,"click",Es),le(Me,"change",mn),le(ze,"change",As),le(Rt,"input",Ls),le(dt,"input",Os),le(dt,"click",function(){Wl(e[4]?_n:void 0)&&(e[4]?_n:void 0).apply(this,arguments)}),le(Ot,"change",hn),le(It,"change",Ns),le(Ut,"change",Ds),le(Jt,"click",Ps)],Ul=!0)},p(We,Ee){if(e=We,Ee[0]&264&&r!==(r=`role-name-${e[79]}`)&&i(o,"for",r),Ee[0]&264&&m!==(m=`role-name-${e[79]}`)&&i(d,"id",m),Ee[0]&264&&d.value!==e[3].roles[e[79]].name&&Oe(d,e[3].roles[e[79]].name),Ee[0]&264&&b!==(b=`role-shortname-${e[79]}`)&&i(v,"for",b),Ee[0]&264&&g!==(g=`role-shortname-${e[79]}`)&&i(C,"id",g),Ee[0]&264&&C.value!==e[3].roles[e[79]].shortname&&Oe(C,e[3].roles[e[79]].shortname),Ee[0]&264&&L!==(L=`role-theme-${e[79]}`)&&i(N,"for",L),Ee[0]&256){sl=e[8];let Ie;for(Ie=0;Ie<sl.length;Ie+=1){const pl=yo(e,sl,Ie);pt[Ie]?pt[Ie].p(pl,Ee):(pt[Ie]=Eo(pl),pt[Ie].c(),pt[Ie].m(O,null))}for(;Ie<pt.length;Ie+=1)pt[Ie].d(1);pt.length=sl.length}if(Ee[0]&264&&A!==(A=`role-theme-${e[79]}`)&&i(O,"id",A),Ee[0]&264&&qe(O,e[3].roles[e[79]].theme),Ee[0]&264&&J!==(J=`role-relevance-${e[79]}`)&&i(Q,"for",J),Ee[0]&264&&T!==(T=`role-relevance-${e[79]}`)&&i(B,"id",T),Ee[0]&264&&qe(B,e[3].roles[e[79]].relevance_function),Ee[0]&264&&me!==(me=`role-terraphim-it-${e[79]}`)&&i(V,"id",me),Ee[0]&264&&(V.checked=e[3].roles[e[79]].terraphim_it),Ee[0]&264&&ue!==(ue=`role-terraphim-it-${e[79]}`)&&i(ee,"for",ue),Ee[0]&491576){rl=e[77].haystacks;let Ie;for(Ie=0;Ie<rl.length;Ie+=1){const pl=ko(e,rl,Ie);mt[Ie]?mt[Ie].p(pl,Ee):(mt[Ie]=Do(pl),mt[Ie].c(),mt[Ie].m(t,Se))}for(;Ie<mt.length;Ie+=1)mt[Ie].d(1);mt.length=rl.length}Ee[0]&264&&Ae!==(Ae="add-haystack-"+e[79])&&i(Ge,"data-testid",Ae),Ee[0]&264&&Te!==(Te=`llm-provider-${e[79]}`)&&i(Be,"for",Te),Ee[0]&264&&Le!==(Le=`llm-provider-${e[79]}`)&&i(Me,"id",Le),Ee[0]&264&&qe(Me,e[3].roles[e[79]].llm_provider),e[3].roles[e[79]].llm_provider==="ollama"?vt?vt.p(e,Ee):(vt=Po(e),vt.c(),vt.m(t,ce)):vt&&(vt.d(1),vt=null),Ee[0]&264&&lt!==(lt=`openrouter-enabled-${e[79]}`)&&i(ze,"id",lt),Ee[0]&264&&(ze.checked=e[3].roles[e[79]].openrouter_enabled),Ee[0]&264&&gt!==(gt=`openrouter-enabled-${e[79]}`)&&i(nt,"for",gt),e[3].roles[e[79]].openrouter_enabled?bt?bt.p(e,Ee):(bt=Uo(e),bt.c(),bt.m(t,Zt)):bt&&(bt.d(1),bt=null),Ee[0]&264&&gl!==(gl=`kg-url-${e[79]}`)&&i(wt,"for",gl),Ee[0]&264&&bl!==(bl=`kg-url-${e[79]}`)&&i(Rt,"id",bl),Ee[0]&264&&Rt.value!==e[3].roles[e[79]].kg.url&&Oe(Rt,e[3].roles[e[79]].kg.url),Ee[0]&264&&kl!==(kl=`kg-local-path-${e[79]}`)&&i(xt,"for",kl),Ee[0]&264&&wl!==(wl=`kg-local-path-${e[79]}`)&&i(dt,"id",wl),Ee[0]&16&&(dt.readOnly=e[4]),Ee[0]&264&&dt.value!==e[3].roles[e[79]].kg.local_path&&Oe(dt,e[3].roles[e[79]].kg.local_path),e[4]?yt||(yt=Fo(),yt.c(),yt.m(Gt,null)):yt&&(yt.d(1),yt=null),Ee[0]&264&&Cl!==(Cl=`kg-local-type-${e[79]}`)&&i(tl,"for",Cl),Ee[0]&264&&$l!==($l=`kg-local-type-${e[79]}`)&&i(Ot,"id",$l),Ee[0]&264&&qe(Ot,e[3].roles[e[79]].kg.local_type),Ee[0]&264&&Sl!==(Sl=`kg-public-${e[79]}`)&&i(It,"id",Sl),Ee[0]&264&&(It.checked=e[3].roles[e[79]].kg.public),Ee[0]&264&&Rl!==(Rl=`kg-public-${e[79]}`)&&i(Ht,"for",Rl),Ee[0]&264&&El!==(El=`kg-publish-${e[79]}`)&&i(Ut,"id",El),Ee[0]&264&&(Ut.checked=e[3].roles[e[79]].kg.publish),Ee[0]&264&&Al!==(Al=`kg-publish-${e[79]}`)&&i(Bt,"for",Al),Ee[0]&264&&Ll!==(Ll="remove-role-"+e[79])&&i(Jt,"data-testid",Ll)},d(We){We&&R(t),xe(pt,We),xe(mt,We),vt&&vt.d(),bt&&bt.d(),yt&&yt.d(),Ul=!1,Ze(fn)}}}function Ko(l){let e,t=l[74]+"",n;return{c(){e=f("option"),n=K(t),e.__value=l[74],e.value=e.__value},m(o,c){E(o,e,c),s(e,n)},p:Pe,d(o){o&&R(e)}}}function Wo(l){let e,t=l[71].name+"",n,o;return{c(){e=f("option"),n=K(t),e.__value=o=l[71].name,e.value=e.__value},m(c,r){E(c,e,r),s(e,n)},p(c,r){r[0]&8&&t!==(t=c[71].name+"")&&we(n,t),r[0]&264&&o!==(o=c[71].name)&&(e.__value=o,e.value=e.__value)},d(c){c&&R(e)}}}function Go(l){let e,t,n;return{c(){e=f("button"),e.textContent="Back",i(e,"class","button"),i(e,"data-testid","wizard-back")},m(o,c){E(o,e,c),t||(n=le(e,"click",l[11]),t=!0)},p:Pe,d(o){o&&R(e),t=!1,n()}}}function na(l){let e,t,n;return{c(){e=f("button"),e.textContent="Save",i(e,"class","button is-success"),i(e,"data-testid","wizard-save")},m(o,c){E(o,e,c),t||(n=le(e,"click",l[19]),t=!0)},p:Pe,d(o){o&&R(e),t=!1,n()}}}function oa(l){let e,t,n;return{c(){e=f("button"),e.textContent="Next",i(e,"class","button is-primary"),i(e,"data-testid","wizard-next")},m(o,c){E(o,e,c),t||(n=le(e,"click",l[10]),t=!0)},p:Pe,d(o){o&&R(e),t=!1,n()}}}function sa(l){let e,t,n,o,c,r,u,a,d,m,p,_,v,y,b,k,w,C;e=new cl({props:{fallbackPath:"/"}});let g=l[2]==="success"&&$o(l),S=l[2]==="error"&&So(l);function z(O,A){return O[1]===1?ea:O[1]===2?xi:Xi}let N=z(l),D=N(l),L=l[1]>1&&Go(l);function q(O,A){return O[1]<Ts?oa:na}let X=q(l),G=X(l);return{c(){ge(e.$$.fragment),t=h(),n=f("div"),o=f("div"),c=f("h3"),c.textContent="Configuration Wizard",r=h(),u=f("button"),u.textContent="Close",a=h(),g&&g.c(),d=h(),S&&S.c(),m=h(),D.c(),p=h(),_=f("nav"),v=f("div"),L&&L.c(),y=h(),b=f("div"),G.c(),i(c,"class","title is-4"),ke(c,"margin-bottom","0"),i(u,"class","button is-small is-light"),i(u,"aria-label","Close configuration wizard"),i(o,"class","is-flex is-justify-content-space-between is-align-items-center"),ke(o,"gap",".5rem"),i(v,"class","level-left"),i(b,"class","level-right"),i(_,"class","level"),i(n,"class","box")},m(O,A){ve(e,O,A),E(O,t,A),E(O,n,A),s(n,o),s(o,c),s(o,r),s(o,u),s(n,a),g&&g.m(n,null),s(n,d),S&&S.m(n,null),s(n,m),D.m(n,null),s(n,p),s(n,_),s(_,v),L&&L.m(v,null),s(_,y),s(_,b),G.m(b,null),k=!0,w||(C=le(u,"click",ra),w=!0)},p(O,A){O[2]==="success"?g?g.p(O,A):(g=$o(O),g.c(),g.m(n,d)):g&&(g.d(1),g=null),O[2]==="error"?S?S.p(O,A):(S=So(O),S.c(),S.m(n,m)):S&&(S.d(1),S=null),N===(N=z(O))&&D?D.p(O,A):(D.d(1),D=N(O),D&&(D.c(),D.m(n,p))),O[1]>1?L?L.p(O,A):(L=Go(O),L.c(),L.m(v,null)):L&&(L.d(1),L=null),X===(X=q(O))&&G?G.p(O,A):(G.d(1),G=X(O),G&&(G.c(),G.m(b,null)))},i(O){k||(Y(e.$$.fragment,O),k=!0)},o(O){oe(e.$$.fragment,O),k=!1},d(O){be(e,O),O&&R(t),O&&R(n),g&&g.d(),S&&S.d(),D.d(),L&&L.d(),G.d(),w=!1,C()}}}const Ts=3;function ra(){typeof window<"u"&&window.history.back()}function ia(l,e,t){let n,o;Ue(l,ot,U=>t(4,o=U));const c=Lt(null);async function r(U,W){if(St(ot))try{const j=await _o({directory:!0,multiple:!1});j&&typeof j=="string"&&a.update(ce=>(ce.roles[U].haystacks[W].path=j,ce))}catch(j){console.error("Failed to open folder selector:",j)}}async function u(U){if(St(ot))try{const W=await _o({directory:!0,multiple:!1});W&&typeof W=="string"&&a.update(j=>(j.roles[U].kg.local_path=W,j))}catch(W){console.error("Failed to open folder selector:",W)}}const a=Lt({id:"Desktop",global_shortcut:"Ctrl+X",default_theme:"spacelab",default_role:"Default",roles:[]});Ue(l,a,U=>t(3,n=U));const d=["default","darkly","cerulean","cosmo","cyborg","flatly","journal","litera","lumen","lux","materia","minty","nuclear","pulse","sandstone","simplex","slate","solar","spacelab","superhero","united","yeti"];Qt(async()=>{try{let U;St(ot)?U=await Fe("get_config_schema"):U=await(await fetch("/config/schema")).json(),c.set(U);const W=St(At);W&&W.id&&a.update(j=>{var ce;return{...j,id:W.id,global_shortcut:W.global_shortcut,default_theme:((ce=W.roles[W.default_role])==null?void 0:ce.theme)??"spacelab",default_role:W.default_role,roles:Object.values(W.roles).map($e=>{var ze,lt,kt,gt,ul,Kt,fl,Zt,Wt,dl,Mt;const Ce=(ze=$e.kg)==null?void 0:ze.automata_path,Ve=(Ce==null?void 0:Ce.Remote)??"",nt=((kt=(lt=$e.kg)==null?void 0:lt.knowledge_graph_local)==null?void 0:kt.path)??"";return{name:$e.name,shortname:$e.shortname,relevance_function:$e.relevance_function,terraphim_it:$e.terraphim_it??!1,theme:$e.theme,haystacks:($e.haystacks??[]).map(wt=>({path:wt.location||wt.path||"",read_only:wt.read_only??!1,service:wt.service||"Ripgrep",atomic_server_secret:wt.atomic_server_secret||"",extra_parameters:wt.extra_parameters||{}})),kg:{url:Ve,local_path:nt,local_type:((ul=(gt=$e.kg)==null?void 0:gt.knowledge_graph_local)==null?void 0:ul.input_type)??"markdown",public:((Kt=$e.kg)==null?void 0:Kt.public)??!1,publish:((fl=$e.kg)==null?void 0:fl.publish)??!1},openrouter_enabled:$e.openrouter_enabled??!1,openrouter_api_key:$e.openrouter_api_key??"",openrouter_model:$e.openrouter_model??"openai/gpt-3.5-turbo",openrouter_auto_summarize:$e.openrouter_auto_summarize??!1,openrouter_chat_enabled:$e.openrouter_chat_enabled??!1,openrouter_chat_model:$e.openrouter_chat_model??$e.openrouter_model??"openai/gpt-3.5-turbo",openrouter_chat_system_prompt:$e.openrouter_chat_system_prompt??"",llm_provider:((Zt=$e.extra)==null?void 0:Zt.llm_provider)??"",llm_model:((Wt=$e.extra)==null?void 0:Wt.llm_model)??"",llm_base_url:((dl=$e.extra)==null?void 0:dl.llm_base_url)??"",llm_auto_summarize:((Mt=$e.extra)==null?void 0:Mt.llm_auto_summarize)??!1}})}})}catch(U){console.error("Failed to load schema",U)}}),Qt(()=>{const U=W=>{W.key==="Escape"&&typeof window<"u"&&window.history.back()};return window.addEventListener("keydown",U),()=>window.removeEventListener("keydown",U)});let m={};async function p(U){var Ce;const j=St(a).roles[U],ce=j.llm_provider||(j.openrouter_enabled?"openrouter":""),$e=[];try{if(ce==="ollama"){const Ve=(j.llm_base_url||"http://127.0.0.1:11434").replace(/\/$/,""),ze=await(await fetch(`${Ve}/api/tags`)).json();if(Array.isArray(ze==null?void 0:ze.models))for(const lt of ze.models)lt!=null&&lt.name&&$e.push(lt.name)}else if(ce==="openrouter"){const Ve=(Ce=j.openrouter_api_key)==null?void 0:Ce.trim();if(!Ve)throw new Error("OpenRouter API key required");const ze=await(await fetch("https://openrouter.ai/api/v1/models",{headers:{Authorization:`Bearer ${Ve}`,"HTTP-Referer":"https://terraphim.ai","X-Title":"Terraphim Desktop"}})).json(),lt=Array.isArray(ze==null?void 0:ze.data)?ze.data:[];for(const kt of lt)kt!=null&&kt.id&&$e.push(kt.id)}}catch(Ve){console.error("Failed to fetch models",Ve)}t(0,m={...m,[U]:$e})}let _=1,v="";function y(){_<Ts&&t(1,_+=1)}function b(){_>1&&t(1,_-=1)}function k(){a.update(U=>({...U,roles:[...U.roles,{name:"New Role",shortname:"new",relevance_function:"title-scorer",terraphim_it:!1,theme:"spacelab",haystacks:[],kg:{url:"",local_path:"",local_type:"markdown",public:!1,publish:!1},openrouter_enabled:!1,openrouter_api_key:"",openrouter_model:"openai/gpt-3.5-turbo",openrouter_auto_summarize:!1,openrouter_chat_enabled:!1,openrouter_chat_model:"openai/gpt-3.5-turbo",openrouter_chat_system_prompt:"",llm_provider:"",llm_model:"",llm_base_url:"",llm_auto_summarize:!1}]}))}function w(U){a.update(W=>({...W,roles:W.roles.filter((j,ce)=>ce!==U)}))}function C(U){a.update(W=>(W.roles[U].haystacks.push({path:"",read_only:!1,service:"Ripgrep",atomic_server_secret:"",extra_parameters:{}}),W))}function g(U,W){a.update(j=>(j.roles[U].haystacks=j.roles[U].haystacks.filter((ce,$e)=>$e!==W),j))}function S(U,W,j="",ce=""){a.update($e=>{$e.roles[U].haystacks[W].extra_parameters||($e.roles[U].haystacks[W].extra_parameters={});const Ce=j||`param_${Date.now()}`;return $e.roles[U].haystacks[W].extra_parameters[Ce]=ce,$e})}function z(U,W,j){a.update(ce=>(delete ce.roles[U].haystacks[W].extra_parameters[j],ce))}function N(U,W,j,ce){a.update($e=>{const Ce=$e.roles[U].haystacks[W].extra_parameters;return Ce[j]!==void 0&&j!==ce&&(Ce[ce]=Ce[j],delete Ce[j]),$e})}function D(U,W,j,ce){const $e=ce.target.value;N(U,W,j,$e)}async function L(){var $e;const U=St(a),W=St(At);let j={...W};j.id=U.id,j.global_shortcut=U.global_shortcut,j.default_role=U.default_role;const ce={};U.roles.forEach(Ce=>{var lt,kt;const Ve=Ce.name,nt=Ve.replace(/^"|"$/g,"");ce[nt]={extra:((kt=(lt=W.roles)==null?void 0:lt[Ve])==null?void 0:kt.extra)??{},name:Ce.name,shortname:Ce.shortname,theme:Ce.theme,relevance_function:Ce.relevance_function,terraphim_it:Ce.terraphim_it??!1,haystacks:Ce.haystacks.map(gt=>({location:gt.path,service:gt.service,read_only:gt.read_only,atomic_server_secret:gt.service==="Atomic"?gt.atomic_server_secret:void 0,extra_parameters:gt.extra_parameters||{}})),kg:Ce.kg.url||Ce.kg.local_path?{automata_path:Ce.kg.url?{Remote:Ce.kg.url}:null,knowledge_graph_local:Ce.kg.local_path?{input_type:Ce.kg.local_type,path:Ce.kg.local_path}:null,public:Ce.kg.public,publish:Ce.kg.publish}:null,...Ce.openrouter_enabled&&{openrouter_enabled:Ce.openrouter_enabled,openrouter_api_key:Ce.openrouter_api_key,openrouter_model:Ce.openrouter_model,openrouter_auto_summarize:Ce.openrouter_auto_summarize??!1,openrouter_chat_enabled:Ce.openrouter_chat_enabled??!1,openrouter_chat_model:Ce.openrouter_chat_model??Ce.openrouter_model,openrouter_chat_system_prompt:Ce.openrouter_chat_system_prompt??""}};const ze={};Ce.llm_provider&&(ze.llm_provider=Ce.llm_provider),Ce.llm_model&&(ze.llm_model=Ce.llm_model),Ce.llm_base_url&&(ze.llm_base_url=Ce.llm_base_url),typeof Ce.llm_auto_summarize=="boolean"&&(ze.llm_auto_summarize=Ce.llm_auto_summarize),ce[nt].extra={...ce[nt].extra||{},...ze}}),j.roles=ce,(!j.default_role||!ce[j.default_role])&&(j.default_role=(($e=U.roles[0])==null?void 0:$e.name)??"Default"),j.selected_role=j.default_role;try{if(St(ot))await Fe("update_config",{configNew:j});else{const Ce=await fetch("/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(j)});if(!Ce.ok)throw new Error(`HTTP ${Ce.status}: ${Ce.statusText}`)}At.set(j),t(2,v="success"),setTimeout(()=>{t(2,v="")},3e3)}catch(Ce){console.error(Ce),t(2,v="error"),setTimeout(()=>{t(2,v="")},3e3)}}const q=()=>t(2,v=""),X=()=>t(2,v="");function G(){n.id=$t(this),a.set(n),t(8,d)}function O(){n.global_shortcut=this.value,a.set(n),t(8,d)}function A(){n.default_theme=$t(this),a.set(n),t(8,d)}function ne(){n.default_role=$t(this),a.set(n),t(8,d)}function I(U){n.roles[U].name=this.value,a.set(n),t(8,d)}function Q(U){n.roles[U].shortname=this.value,a.set(n),t(8,d)}function te(U){n.roles[U].theme=$t(this),a.set(n),t(8,d)}function J(U){n.roles[U].relevance_function=$t(this),a.set(n),t(8,d)}function se(U){n.roles[U].terraphim_it=this.checked,a.set(n),t(8,d)}function P(U,W){n.roles[U].haystacks[W].service=$t(this),a.set(n),t(8,d)}function M(U,W){n.roles[U].haystacks[W].path=this.value,a.set(n),t(8,d)}const B=(U,W)=>r(U,W);function F(U,W){n.roles[U].haystacks[W].atomic_server_secret=this.value,a.set(n),t(8,d)}function Z(U,W){n.roles[U].haystacks[W].extra_parameters.tag=this.value,a.set(n),t(8,d)}const ie=(U,W,j)=>{const ce=j.currentTarget.value;ce&&jt(a,n.roles[U].haystacks[W].extra_parameters.tag=ce,n)},ae=(U,W,j,ce)=>D(U,W,j,ce);function $(U,W,j){n.roles[U].haystacks[W].extra_parameters[j]=this.value,a.set(n),t(8,d)}const T=(U,W,j)=>z(U,W,j),H=(U,W)=>S(U,W,"tag","#rust"),x=(U,W)=>S(U,W,"max_count","10"),ee=(U,W)=>S(U,W,"","");function V(U,W){n.roles[U].haystacks[W].read_only=this.checked,a.set(n),t(8,d)}const me=(U,W)=>g(U,W),fe=U=>C(U);function ue(U){n.roles[U].llm_provider=$t(this),a.set(n),t(8,d)}function pe(U){n.roles[U].llm_model=this.value,a.set(n),t(8,d)}const _e=U=>p(U),he=(U,W)=>{jt(a,n.roles[U].llm_model=W.currentTarget.value,n)};function Se(U){n.roles[U].llm_base_url=this.value,a.set(n),t(8,d)}function Ge(U){n.roles[U].llm_auto_summarize=this.checked,a.set(n),t(8,d)}function je(U){n.roles[U].openrouter_enabled=this.checked,a.set(n),t(8,d)}function Ae(U){n.roles[U].openrouter_api_key=this.value,a.set(n),t(8,d)}function Re(U){n.roles[U].openrouter_model=this.value,a.set(n),t(8,d)}const re=U=>p(U),ye=(U,W)=>{jt(a,n.roles[U].openrouter_model=W.currentTarget.value,n)};function Ne(U){n.roles[U].openrouter_auto_summarize=this.checked,a.set(n),t(8,d)}function Be(U){n.roles[U].openrouter_chat_enabled=this.checked,a.set(n),t(8,d)}function Ke(U){n.roles[U].openrouter_chat_model=$t(this),a.set(n),t(8,d)}function Te(U){n.roles[U].openrouter_chat_system_prompt=this.value,a.set(n),t(8,d)}function De(U){n.roles[U].kg.url=this.value,a.set(n),t(8,d)}function et(U){n.roles[U].kg.local_path=this.value,a.set(n),t(8,d)}const Je=U=>u(U);function Me(U){n.roles[U].kg.local_type=$t(this),a.set(n),t(8,d)}function He(U){n.roles[U].kg.public=this.checked,a.set(n),t(8,d)}function tt(U){n.roles[U].kg.publish=this.checked,a.set(n),t(8,d)}return[m,_,v,n,o,r,u,a,d,p,y,b,k,w,C,g,S,z,D,L,q,X,G,O,A,ne,I,Q,te,J,se,P,M,B,F,Z,ie,ae,$,T,H,x,ee,V,me,fe,ue,pe,_e,he,Se,Ge,je,Ae,Re,re,ye,Ne,Be,Ke,Te,De,et,Je,Me,He,tt,U=>w(U),()=>{t(1,_=2)}]}class aa extends _t{constructor(e){super(),ht(this,e,ia,sa,ft,{},null,[-1,-1,-1,-1])}}function ca(l){let e,t,n,o,c,r,u,a;return e=new cl({props:{fallbackPath:"/"}}),u=new ks({props:{content:l[0],onChange:l[1]}}),{c(){ge(e.$$.fragment),t=h(),n=f("div"),o=f("p"),o.innerHTML="<i>The best editing experience is to configure Atomic Server, in the meantime use editor below. You will need to refresh page via Command R or Ctrl-R to see changes</i>",c=h(),r=f("div"),ge(u.$$.fragment),i(r,"class","editor"),i(n,"class","box")},m(d,m){ve(e,d,m),E(d,t,m),E(d,n,m),s(n,o),s(n,c),s(n,r),ve(u,r,null),a=!0},p(d,[m]){const p={};m&1&&(p.content=d[0]),u.$set(p)},i(d){a||(Y(e.$$.fragment,d),Y(u.$$.fragment,d),a=!0)},o(d){oe(e.$$.fragment,d),oe(u.$$.fragment,d),a=!1},d(d){be(e,d),d&&R(t),d&&R(n),be(u)}}}function ua(l,e,t){let n,o;Ue(l,At,u=>t(2,n=u)),Ue(l,ot,u=>t(3,o=u));let c={json:n};function r(u){if(console.log("contents changed:",u),console.log("is tauri",o),At.update(a=>(a=u.json,a)),St(ot))console.log("Updating config on server"),Fe("update_config",{configNew:u.json}).then(a=>{console.log(`Message: ${a}`)}).catch(a=>console.error(a));else{let a=`${Xe.ServerURL}/config/`;fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u.json)})}t(0,c=u)}return Qt(()=>{t(0,c={json:n})}),[c,r]}class fa extends _t{constructor(e){super(),ht(this,e,ua,ca,ft,{})}}const{window:ql}=Ws;function da(l){let e,t,n,o,c,r,u,a,d,m;return{c(){e=f("div"),t=f("div"),n=f("h3"),n.textContent="Error loading graph",o=h(),c=f("p"),r=K(l[3]),u=h(),a=f("button"),a.textContent="Retry",i(a,"class","button is-primary"),i(t,"class","error-content svelte-1ry9pkl"),i(e,"class","error-overlay svelte-1ry9pkl")},m(p,_){E(p,e,_),s(e,t),s(t,n),s(t,o),s(t,c),s(c,r),s(t,u),s(t,a),d||(m=le(a,"click",l[11]),d=!0)},p(p,_){_&8&&we(r,p[3])},d(p){p&&R(e),d=!1,m()}}}function pa(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="loading-content svelte-1ry9pkl"><div class="loader svelte-1ry9pkl"></div> 
        <p>Loading knowledge graph...</p></div>`,i(e,"class","loading-overlay svelte-1ry9pkl")},m(t,n){E(t,e,n)},p:Pe,d(t){t&&R(e)}}}function Bo(l){let e,t,n;return{c(){e=f("button"),e.innerHTML='<i class="fas fa-times svelte-1ry9pkl"></i>',i(e,"class","close-button svelte-1ry9pkl"),i(e,"title","Close Graph")},m(o,c){E(o,e,c),t||(n=le(e,"click",l[17]),t=!0)},p:Pe,d(o){o&&R(e),t=!1,n()}}}function Jo(l){let e;return{c(){e=f("div"),e.innerHTML="<span><strong>Left-click:</strong> View node • <strong>Right-click:</strong> Edit node • <strong>Drag:</strong> Move • <strong>Scroll:</strong> Zoom</span>",i(e,"class","controls-info svelte-1ry9pkl")},m(t,n){E(t,e,n)},d(t){t&&R(e)}}}function Vo(l){let e,t;return{c(){e=f("div"),t=K(l[8]),i(e,"class","debug-message svelte-1ry9pkl")},m(n,o){E(n,e,o),s(e,t)},p(n,o){o&256&&we(t,n[8])},d(n){n&&R(e)}}}function Qo(l){let e=l[5].id,t,n,o=Yo(l);return{c(){o.c(),t=rt()},m(c,r){o.m(c,r),E(c,t,r),n=!0},p(c,r){r&32&&ft(e,e=c[5].id)?(Qe(),oe(o,1,1,Pe),Ye(),o=Yo(c),o.c(),Y(o,1),o.m(t.parentNode,t)):o.p(c,r)},i(c){n||(Y(o),n=!0)},o(c){oe(o),n=!1},d(c){c&&R(t),o.d(c)}}}function Yo(l){let e,t,n;function o(r){l[18](r)}let c={item:l[5],initialEdit:l[7]};return l[6]!==void 0&&(c.active=l[6]),e=new Gl({props:c}),st.push(()=>at(e,"active",o)),e.$on("close",l[12]),e.$on("save",l[13]),{c(){ge(e.$$.fragment)},m(r,u){ve(e,r,u),n=!0},p(r,u){const a={};u&32&&(a.item=r[5]),u&128&&(a.initialEdit=r[7]),!t&&u&64&&(t=!0,a.active=r[6],ct(()=>t=!1)),e.$set(a)},i(r){n||(Y(e.$$.fragment,r),n=!0)},o(r){oe(e.$$.fragment,r),n=!1},d(r){be(e,r)}}}function ma(l){let e,t,n,o,c,r,u,a,d,m,p;it(l[15]),e=new cl({props:{fallbackPath:"/"}});function _(g,S){if(g[2])return pa;if(g[3])return da}let v=_(l),y=v&&v(l),b=l[0]&&Bo(l),k=!l[2]&&!l[3]&&l[4].length>0&&Jo(),w=l[8]&&Vo(l),C=l[5]&&Qo(l);return{c(){ge(e.$$.fragment),t=h(),n=f("div"),y&&y.c(),o=h(),b&&b.c(),c=h(),k&&k.c(),r=h(),w&&w.c(),u=h(),C&&C.c(),a=rt(),i(n,"class","graph-container svelte-1ry9pkl"),ke(n,"width",l[0]?"100vw":"600px"),ke(n,"height",l[0]?"100vh":"400px"),ut(n,"fullscreen",l[0])},m(g,S){ve(e,g,S),E(g,t,S),E(g,n,S),y&&y.m(n,null),l[16](n),E(g,o,S),b&&b.m(g,S),E(g,c,S),k&&k.m(g,S),E(g,r,S),w&&w.m(g,S),E(g,u,S),C&&C.m(g,S),E(g,a,S),d=!0,m||(p=le(ql,"resize",l[15]),m=!0)},p(g,[S]){v===(v=_(g))&&y?y.p(g,S):(y&&y.d(1),y=v&&v(g),y&&(y.c(),y.m(n,null))),(!d||S&1)&&ke(n,"width",g[0]?"100vw":"600px"),(!d||S&1)&&ke(n,"height",g[0]?"100vh":"400px"),(!d||S&1)&&ut(n,"fullscreen",g[0]),g[0]?b?b.p(g,S):(b=Bo(g),b.c(),b.m(c.parentNode,c)):b&&(b.d(1),b=null),!g[2]&&!g[3]&&g[4].length>0?k||(k=Jo(),k.c(),k.m(r.parentNode,r)):k&&(k.d(1),k=null),g[8]?w?w.p(g,S):(w=Vo(g),w.c(),w.m(u.parentNode,u)):w&&(w.d(1),w=null),g[5]?C?(C.p(g,S),S&32&&Y(C,1)):(C=Qo(g),C.c(),Y(C,1),C.m(a.parentNode,a)):C&&(Qe(),oe(C,1,1,()=>{C=null}),Ye())},i(g){d||(Y(e.$$.fragment,g),Y(C),d=!0)},o(g){oe(e.$$.fragment,g),oe(C),d=!1},d(g){be(e,g),g&&R(t),g&&R(n),y&&y.d(),l[16](null),g&&R(o),b&&b.d(g),g&&R(c),k&&k.d(g),g&&R(r),w&&w.d(g),g&&R(u),C&&C.d(g),g&&R(a),m=!1,p()}}}function Zo(l){return{id:`kg-node-${l.id}`,url:`#/graph/node/${l.id}`,title:l.label,body:`# ${l.label}

**Knowledge Graph Node**

ID: ${l.id}
Rank: ${l.rank}

This is a concept node from the knowledge graph. You can edit this content to add more information about "${l.label}".`,description:`Knowledge graph concept: ${l.label}`,tags:["knowledge-graph","concept"],rank:l.rank,stub:`Knowledge graph concept: ${l.label}`}}function _a(l,e,t){let n,o;Ue(l,Et,A=>t(20,n=A)),Ue(l,ot,A=>t(21,o=A));let{apiUrl:c="/rolegraph"}=e,{fullscreen:r=!0}=e,u,a=!0,d=null,m=[],p=[],_=null,v=!1,y=!1,b="",k=window.innerWidth,w=window.innerHeight;function C(){t(9,k=window.innerWidth),t(10,w=window.innerHeight),!a&&!d&&L()}async function g(){t(2,a=!0),t(3,d=null);try{if(o){console.log("Loading rolegraph from Tauri");const A=await Fe("get_rolegraph",{role_name:n||void 0});if(A&&A.status==="success")t(4,m=A.nodes),p=A.edges;else throw new Error(`Tauri rolegraph fetch failed: ${(A==null?void 0:A.status)||"unknown error"}`)}else{console.log("Loading rolegraph from server");const A=n?`${c}?role=${encodeURIComponent(n)}`:c,ne=await fetch(A);if(!ne.ok)throw new Error(`Failed to fetch: ${ne.status}`);const I=await ne.json();t(4,m=I.nodes),p=I.edges}}catch(A){t(3,d=A.message),console.error("Error fetching rolegraph:",A)}finally{t(2,a=!1)}}function S(A,ne){A.stopPropagation(),console.log("Node clicked:",ne.label),t(5,_=Zo(ne)),t(7,y=!1),t(6,v=!0)}function z(A,ne){A.preventDefault(),A.stopPropagation(),console.log("Node right-clicked:",ne.label),t(8,b=`Right-clicked: ${ne.label}`),t(5,_=Zo(ne)),t(7,y=!0),t(6,v=!0),setTimeout(()=>{t(8,b="")},2e3)}function N(){t(6,v=!1),t(5,_=null),t(7,y=!1)}async function D(){if(_)try{const A=await fetch("/documents",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(_)});A.ok?console.log("Successfully saved KG record:",_.id):console.error("Failed to save KG record:",A.statusText)}catch(A){console.error("Error saving KG record:",A)}finally{t(6,v=!1),t(5,_=null),t(7,y=!1)}}function L(){if(!u)return;t(1,u.innerHTML="",u);const A=zl(u).append("svg").attr("width",k).attr("height",w),ne=sr().scaleExtent([.1,10]).on("zoom",F=>{I.attr("transform",F.transform)});A.call(ne);const I=A.append("g"),Q=rr(m).force("link",ir(p).id(F=>F.id).distance(100)).force("charge",ar().strength(-200)).force("center",cr(k/2,w/2)).force("collision",ur().radius(20)),te=I.append("g").attr("class","links").selectAll("line").data(p).enter().append("line").attr("stroke","#666").attr("stroke-opacity",.7).attr("stroke-width",F=>{const Z=F.weight||F.rank||1;return Math.max(1,Math.min(8,Z*2))}),J=I.append("g").attr("class","nodes").selectAll("circle").data(m).enter().append("circle").attr("r",F=>{const Z=F.rank||1;return Math.max(6,Math.min(20,Z*2))}).attr("fill",F=>{const Z=F.rank||1,ie=Math.min(Z/10,1);return fr(.2+ie*.6)}).attr("stroke","#fff").attr("stroke-width",2).style("cursor","pointer").on("click",(F,Z)=>S(F,Z)).on("contextmenu",(F,Z)=>z(F,Z)).on("mouseover",function(F,Z){zl(this).transition().duration(150).attr("stroke-width",3).attr("r",ie=>{const ae=ie.rank||1;return Math.max(8,Math.min(24,ae*2.5))})}).on("mouseout",function(F,Z){zl(this).transition().duration(150).attr("stroke-width",2).attr("r",ie=>{const ae=ie.rank||1;return Math.max(6,Math.min(20,ae*2))})}).call(dr().on("start",P).on("drag",M).on("end",B)),se=I.append("g").attr("class","labels").selectAll("text").data(m).enter().append("text").attr("text-anchor","middle").attr("dy",".35em").attr("font-size","11px").attr("font-family","Arial, sans-serif").attr("fill","#333").attr("pointer-events","none").text(F=>F.label.length>12?F.label.substring(0,12)+"...":F.label);Q.on("tick",()=>{te.attr("x1",F=>F.source.x).attr("y1",F=>F.source.y).attr("x2",F=>F.target.x).attr("y2",F=>F.target.y),J.attr("cx",F=>F.x).attr("cy",F=>F.y),se.attr("x",F=>F.x).attr("y",F=>F.y)});function P(F,Z){F.active||Q.alphaTarget(.3).restart(),Z.fx=Z.x,Z.fy=Z.y}function M(F,Z){Z.fx=F.x,Z.fy=F.y}function B(F,Z){F.active||Q.alphaTarget(0),Z.fx=null,Z.fy=null}}Qt(()=>{g().then(()=>{d||L()});const A=ne=>{ne.preventDefault()};return u&&u.addEventListener("contextmenu",A),window.addEventListener("resize",C),()=>{u&&u.removeEventListener("contextmenu",A),window.removeEventListener("resize",C)}});function q(){t(9,k=ql.innerWidth),t(10,w=ql.innerHeight)}function X(A){st[A?"unshift":"push"](()=>{u=A,t(1,u)})}const G=()=>history.back();function O(A){v=A,t(6,v)}return l.$$set=A=>{"apiUrl"in A&&t(14,c=A.apiUrl),"fullscreen"in A&&t(0,r=A.fullscreen)},[r,u,a,d,m,_,v,y,b,k,w,g,N,D,c,q,X,G,O]}class ha extends _t{constructor(e){super(),ht(this,e,_a,ma,ft,{apiUrl:14,fullscreen:0})}}function Xo(l,e,t){const n=l.slice();return n[19]=e[t][0],n[20]=e[t][1],n[21]=e,n[22]=t,n}function xo(l,e,t){const n=l.slice();return n[23]=e[t],n}function es(l){let e,t,n,o,c,r,u,a,d,m,p,_,v,y,b=l[2].title.trim()==="",k,w,C,g,S,z,N,D,L,q,X,G,O,A,ne,I=l[2].content.trim()==="",Q,te,J,se,P,M,B,F,Z,ie,ae,$,T,H,x,ee,V,me,fe,ue,pe,_e=l[1]==="edit"?"Save Changes":"Add Context",he,Se,Ge,je,Ae,Re,re,ye,Ne,Be,Ke=l[4],Te=[];for(let W=0;W<Ke.length;W+=1)Te[W]=ts(xo(l,Ke,W));let De=b&&ls();function et(W,j){return W[2].summary?va:ga}let Je=et(l),Me=Je(l),He=I&&ns();function tt(W,j){return j&4&&(ae=null),ae==null&&(ae=Object.keys(W[2].metadata).length===0),ae?ka:ba}let de=tt(l,-1),Le=de(l),U=l[1]==="edit"&&ss(l);return{c(){e=f("section"),t=f("div"),n=f("label"),n.textContent="Type",o=h(),c=f("div"),r=f("div"),u=f("select");for(let W=0;W<Te.length;W+=1)Te[W].c();a=h(),d=f("div"),m=f("label"),m.textContent="Title *",p=h(),_=f("div"),v=f("input"),y=h(),De&&De.c(),k=h(),w=f("div"),C=f("label"),C.textContent="Summary",g=h(),S=f("div"),z=f("textarea"),N=h(),D=f("p"),Me.c(),L=h(),q=f("div"),X=f("label"),X.textContent="Content *",G=h(),O=f("div"),A=f("textarea"),ne=h(),He&&He.c(),Q=h(),te=f("details"),J=f("summary"),J.innerHTML=`<span class="icon-text"><span class="icon"><i class="fas fa-cog"></i></span> 
              <span>Advanced Options</span></span>`,se=h(),P=f("div"),M=f("label"),M.textContent="Metadata",B=h(),F=f("div"),Z=f("p"),Z.textContent="Additional key-value pairs for this context item",ie=h(),Le.c(),$=h(),T=f("button"),T.innerHTML=`<span class="icon"><i class="fas fa-plus"></i></span> 
                <span>Add Metadata</span>`,H=h(),x=f("footer"),ee=f("div"),V=f("div"),me=f("button"),fe=f("span"),fe.innerHTML='<i class="fas fa-save"></i>',ue=h(),pe=f("span"),he=K(_e),Ge=h(),je=f("div"),Ae=f("button"),Ae.innerHTML="<span>Cancel</span>",Re=h(),U&&U.c(),re=h(),ye=f("div"),ye.innerHTML=`<strong>Keyboard shortcuts:</strong>
          Ctrl/Cmd + Enter to save, Escape to close`,i(n,"class","label"),i(n,"for","context-type"),i(u,"id","context-type"),i(u,"data-testid","context-type-select"),l[2].context_type===void 0&&it(()=>l[10].call(u)),i(r,"class","select is-fullwidth"),i(c,"class","control"),i(t,"class","field"),i(m,"class","label"),i(m,"for","context-title"),i(v,"id","context-title"),i(v,"class","input"),i(v,"type","text"),i(v,"placeholder","Enter title..."),i(v,"data-testid","context-title-input"),v.required=!0,i(_,"class","control"),i(d,"class","field"),i(C,"class","label"),i(C,"for","context-summary"),i(z,"id","context-summary"),i(z,"class","textarea svelte-1oesbw7"),i(z,"placeholder","Brief summary of the content (optional)..."),i(z,"data-testid","context-summary-textarea"),i(z,"rows","3"),i(z,"maxlength","500"),i(S,"class","control"),i(D,"class","help svelte-1oesbw7"),i(w,"class","field"),i(X,"class","label"),i(X,"for","context-content"),i(A,"id","context-content"),i(A,"class","textarea svelte-1oesbw7"),i(A,"placeholder","Enter the full content..."),i(A,"data-testid","context-content-textarea"),i(A,"rows","8"),A.required=!0,i(O,"class","control"),i(q,"class","field"),i(J,"class","summary svelte-1oesbw7"),i(M,"class","label"),i(Z,"class","help svelte-1oesbw7"),i(T,"class","button is-small is-light"),i(F,"class","content"),i(P,"class","field mt-4"),i(te,"class","details svelte-1oesbw7"),i(e,"class","modal-card-body svelte-1oesbw7"),i(fe,"class","icon"),i(me,"class","button is-primary"),me.disabled=Se=!l[3],i(me,"data-testid","save-context-button"),i(V,"class","control"),i(Ae,"class","button is-light"),i(Ae,"data-testid","cancel-context-button"),i(je,"class","control"),i(ee,"class","field is-grouped"),i(ye,"class","help svelte-1oesbw7"),i(x,"class","modal-card-foot")},m(W,j){E(W,e,j),s(e,t),s(t,n),s(t,o),s(t,c),s(c,r),s(r,u);for(let ce=0;ce<Te.length;ce+=1)Te[ce]&&Te[ce].m(u,null);qe(u,l[2].context_type,!0),s(e,a),s(e,d),s(d,m),s(d,p),s(d,_),s(_,v),Oe(v,l[2].title),s(d,y),De&&De.m(d,null),s(e,k),s(e,w),s(w,C),s(w,g),s(w,S),s(S,z),Oe(z,l[2].summary),s(w,N),s(w,D),Me.m(D,null),s(e,L),s(e,q),s(q,X),s(q,G),s(q,O),s(O,A),Oe(A,l[2].content),s(q,ne),He&&He.m(q,null),s(e,Q),s(e,te),s(te,J),s(te,se),s(te,P),s(P,M),s(P,B),s(P,F),s(F,Z),s(F,ie),Le.m(F,null),s(F,$),s(F,T),E(W,H,j),E(W,x,j),s(x,ee),s(ee,V),s(V,me),s(me,fe),s(me,ue),s(me,pe),s(pe,he),s(ee,Ge),s(ee,je),s(je,Ae),s(ee,Re),U&&U.m(ee,null),s(x,re),s(x,ye),Ne||(Be=[le(u,"change",l[10]),le(v,"input",l[11]),le(z,"input",l[12]),le(A,"input",l[13]),le(T,"click",l[17]),le(me,"click",l[6]),le(Ae,"click",l[5])],Ne=!0)},p(W,j){if(j&16){Ke=W[4];let ce;for(ce=0;ce<Ke.length;ce+=1){const $e=xo(W,Ke,ce);Te[ce]?Te[ce].p($e,j):(Te[ce]=ts($e),Te[ce].c(),Te[ce].m(u,null))}for(;ce<Te.length;ce+=1)Te[ce].d(1);Te.length=Ke.length}j&20&&qe(u,W[2].context_type),j&20&&v.value!==W[2].title&&Oe(v,W[2].title),j&4&&(b=W[2].title.trim()===""),b?De||(De=ls(),De.c(),De.m(d,null)):De&&(De.d(1),De=null),j&20&&Oe(z,W[2].summary),Je===(Je=et(W))&&Me?Me.p(W,j):(Me.d(1),Me=Je(W),Me&&(Me.c(),Me.m(D,null))),j&20&&Oe(A,W[2].content),j&4&&(I=W[2].content.trim()===""),I?He||(He=ns(),He.c(),He.m(q,null)):He&&(He.d(1),He=null),de===(de=tt(W,j))&&Le?Le.p(W,j):(Le.d(1),Le=de(W),Le&&(Le.c(),Le.m(F,$))),j&2&&_e!==(_e=W[1]==="edit"?"Save Changes":"Add Context")&&we(he,_e),j&8&&Se!==(Se=!W[3])&&(me.disabled=Se),W[1]==="edit"?U?U.p(W,j):(U=ss(W),U.c(),U.m(ee,null)):U&&(U.d(1),U=null)},d(W){W&&R(e),xe(Te,W),De&&De.d(),Me.d(),He&&He.d(),Le.d(),W&&R(H),W&&R(x),U&&U.d(),Ne=!1,Ze(Be)}}}function ts(l){let e,t=l[23].label+"",n;return{c(){e=f("option"),n=K(t),e.__value=l[23].value,e.value=e.__value},m(o,c){E(o,e,c),s(e,n)},p:Pe,d(o){o&&R(e)}}}function ls(l){let e;return{c(){e=f("p"),e.textContent="Title is required",i(e,"class","help is-danger svelte-1oesbw7")},m(t,n){E(t,e,n)},d(t){t&&R(e)}}}function ga(l){let e;return{c(){e=K("Optional brief summary (up to 500 characters)")},m(t,n){E(t,e,n)},p:Pe,d(t){t&&R(e)}}}function va(l){let e=l[2].summary.length+"",t,n;return{c(){t=K(e),n=K("/500 characters")},m(o,c){E(o,t,c),E(o,n,c)},p(o,c){c&4&&e!==(e=o[2].summary.length+"")&&we(t,e)},d(o){o&&R(t),o&&R(n)}}}function ns(l){let e;return{c(){e=f("p"),e.textContent="Content is required",i(e,"class","help is-danger svelte-1oesbw7")},m(t,n){E(t,e,n)},d(t){t&&R(e)}}}function ba(l){let e,t=Object.entries(l[2].metadata),n=[];for(let o=0;o<t.length;o+=1)n[o]=os(Xo(l,t,o));return{c(){for(let o=0;o<n.length;o+=1)n[o].c();e=rt()},m(o,c){for(let r=0;r<n.length;r+=1)n[r]&&n[r].m(o,c);E(o,e,c)},p(o,c){if(c&4){t=Object.entries(o[2].metadata);let r;for(r=0;r<t.length;r+=1){const u=Xo(o,t,r);n[r]?n[r].p(u,c):(n[r]=os(u),n[r].c(),n[r].m(e.parentNode,e))}for(;r<n.length;r+=1)n[r].d(1);n.length=t.length}},d(o){xe(n,o),o&&R(e)}}}function ka(l){let e;return{c(){e=f("p"),e.textContent="No metadata defined",i(e,"class","has-text-grey-light")},m(t,n){E(t,e,n)},p:Pe,d(t){t&&R(e)}}}function os(l){let e,t,n,o,c,r,u,a,d,m,p,_,v;function y(...w){return l[14](l[19],l[20],...w)}function b(){l[15].call(u,l[19])}function k(){return l[16](l[19])}return{c(){e=f("div"),t=f("div"),n=f("input"),c=h(),r=f("div"),u=f("input"),a=h(),d=f("div"),m=f("button"),m.innerHTML='<span class="icon"><i class="fas fa-times"></i></span>',p=h(),i(n,"class","input is-small"),i(n,"type","text"),i(n,"placeholder","Key"),n.value=o=l[19],i(t,"class","control is-expanded"),i(u,"class","input is-small"),i(u,"type","text"),i(u,"placeholder","Value"),i(r,"class","control is-expanded"),i(m,"class","button is-small is-danger is-outlined"),i(d,"class","control"),i(e,"class","field is-grouped")},m(w,C){E(w,e,C),s(e,t),s(t,n),s(e,c),s(e,r),s(r,u),Oe(u,l[2].metadata[l[19]]),s(e,a),s(e,d),s(d,m),s(e,p),_||(v=[le(n,"input",y),le(u,"input",b),le(m,"click",k)],_=!0)},p(w,C){l=w,C&20&&o!==(o=l[19])&&n.value!==o&&(n.value=o),C&20&&u.value!==l[2].metadata[l[19]]&&Oe(u,l[2].metadata[l[19]])},d(w){w&&R(e),_=!1,Ze(v)}}}function ss(l){let e,t,n,o,c,r;return{c(){e=f("div"),t=h(),n=f("div"),o=f("button"),o.innerHTML=`<span class="icon"><i class="fas fa-trash"></i></span> 
                <span>Delete</span>`,i(e,"class","control is-expanded"),i(o,"class","button is-danger is-outlined"),i(o,"data-testid","delete-context-button"),i(n,"class","control")},m(u,a){E(u,e,a),E(u,t,a),E(u,n,a),s(n,o),c||(r=le(o,"click",l[7]),c=!0)},p:Pe,d(u){u&&R(e),u&&R(t),u&&R(n),c=!1,r()}}}function wa(l){let e,t,n,o=l[1]==="edit"?"Edit Context Item":"Add Context Item",c,r,u,a,d,m,p=l[2]&&es(l);return{c(){e=f("div"),t=f("header"),n=f("p"),c=K(o),r=h(),u=f("button"),a=h(),p&&p.c(),i(n,"class","modal-card-title"),i(u,"class","delete"),i(u,"aria-label","close"),i(t,"class","modal-card-head"),i(e,"class","modal-card")},m(_,v){E(_,e,v),s(e,t),s(t,n),s(n,c),s(t,r),s(t,u),s(e,a),p&&p.m(e,null),d||(m=le(u,"click",l[5]),d=!0)},p(_,v){v&2&&o!==(o=_[1]==="edit"?"Edit Context Item":"Add Context Item")&&we(c,o),_[2]?p?p.p(_,v):(p=es(_),p.c(),p.m(e,null)):p&&(p.d(1),p=null)},d(_){_&&R(e),p&&p.d(),d=!1,m()}}}function ya(l){let e,t,n,o;return e=new Pl({props:{active:l[0],$$slots:{default:[wa]},$$scope:{ctx:l}}}),e.$on("close",l[5]),{c(){ge(e.$$.fragment)},m(c,r){ve(e,c,r),t=!0,n||(o=le(window,"keydown",l[8]),n=!0)},p(c,[r]){const u={};r&1&&(u.active=c[0]),r&67108878&&(u.$$scope={dirty:r,ctx:c}),e.$set(u)},i(c){t||(Y(e.$$.fragment,c),t=!0)},o(c){oe(e.$$.fragment,c),t=!1},d(c){be(e,c),n=!1,o()}}}function Ca(l,e,t){let n,{active:o=!1}=e,{context:c=null}=e,{mode:r="edit"}=e;const u=Gs();let a=null,d=[{value:"Document",label:"Document"},{value:"SearchResult",label:"Search Result"},{value:"UserInput",label:"User Input"},{value:"System",label:"System"},{value:"External",label:"External"}];function m(){t(0,o=!1),t(2,a=null),u("close")}function p(){!n||!a||(u(r==="edit"?"update":"create",a),m())}function _(){r==="edit"&&c&&(u("delete",c.id),m())}function v(N){N.key==="Escape"?m():N.key==="Enter"&&(N.ctrlKey||N.metaKey)&&p()}function y(){a.context_type=$t(this),t(2,a),t(0,o),t(9,c),t(1,r),t(4,d)}function b(){a.title=this.value,t(2,a),t(0,o),t(9,c),t(1,r),t(4,d)}function k(){a.summary=this.value,t(2,a),t(0,o),t(9,c),t(1,r),t(4,d)}function w(){a.content=this.value,t(2,a),t(0,o),t(9,c),t(1,r),t(4,d)}const C=(N,D,L)=>{const q={...a.metadata};delete q[N],q[L.target.value]=D,t(2,a.metadata=q,a)};function g(N){a.metadata[N]=this.value,t(2,a),t(0,o),t(9,c),t(1,r),t(4,d)}const S=N=>{const D={...a.metadata};delete D[N],t(2,a.metadata=D,a)},z=()=>{t(2,a.metadata={...a.metadata,[`key_${Date.now()}`]:""},a)};return l.$$set=N=>{"active"in N&&t(0,o=N.active),"context"in N&&t(9,c=N.context),"mode"in N&&t(1,r=N.mode)},l.$$.update=()=>{l.$$.dirty&515&&(o&&c?t(2,a={...c,metadata:{...c.metadata}}):o&&r==="create"&&t(2,a={id:"",context_type:"UserInput",title:"",summary:"",content:"",metadata:{},created_at:new Date().toISOString(),relevance_score:null})),l.$$.dirty&4&&t(3,n=a&&a.title.trim()!==""&&a.content.trim()!=="")},[o,r,a,n,d,m,p,_,v,c,y,b,k,w,C,g,S,z]}class Ta extends _t{constructor(e){super(),ht(this,e,Ca,ya,ft,{active:0,context:9,mode:1})}}function rs(l,e,t){const n=l.slice();return n[40]=e[t],n[42]=t,n}function is(l,e,t){const n=l.slice();return n[43]=e[t],n[45]=t,n}function as(l){let e,t,n;return{c(){e=f("p"),t=K("Conversation ID: "),n=K(l[5]),i(e,"class","is-size-7 has-text-grey")},m(o,c){E(o,e,c),s(e,t),s(e,n)},p(o,c){c[0]&32&&we(n,o[5])},d(o){o&&R(e)}}}function cs(l){let e,t,n,o=l[43].content+"",c,r;return{c(){e=f("div"),t=f("div"),n=f("pre"),c=K(o),i(n,"class","svelte-rbq0zi"),i(t,"class","bubble svelte-rbq0zi"),i(e,"class",r=Pt(`msg ${l[43].role}`)+" svelte-rbq0zi")},m(u,a){E(u,e,a),s(e,t),s(t,n),s(n,c)},p(u,a){a[0]&1&&o!==(o=u[43].content+"")&&we(c,o),a[0]&1&&r!==(r=Pt(`msg ${u[43].role}`)+" svelte-rbq0zi")&&i(e,"class",r)},d(u){u&&R(e)}}}function us(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="bubble loading svelte-rbq0zi"><span class="icon is-small"><i class="fas fa-spinner fa-spin"></i></span> 
            <span>Thinking...</span></div>`,i(e,"class","msg assistant svelte-rbq0zi")},m(t,n){E(t,e,n)},d(t){t&&R(e)}}}function fs(l){let e,t,n;return{c(){e=f("p"),t=K("Model: "),n=K(l[4]),i(e,"class","is-size-7 has-text-grey")},m(o,c){E(o,e,c),s(e,t),s(e,n)},p(o,c){c[0]&16&&we(n,o[4])},d(o){o&&R(e)}}}function ds(l){let e,t;return{c(){e=f("p"),t=K(l[3]),i(e,"class","has-text-danger is-size-7")},m(n,o){E(n,e,o),s(e,t)},p(n,o){o[0]&8&&we(t,n[3])},d(n){n&&R(e)}}}function $a(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-refresh"></i>',i(e,"class","icon is-small")},m(t,n){E(t,e,n)},d(t){t&&R(e)}}}function Sa(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-spinner fa-spin"></i>',i(e,"class","icon is-small")},m(t,n){E(t,e,n)},d(t){t&&R(e)}}}function ps(l){let e,t,n,o,c,r,u,a,d,m,p,_,v,y,b,k,w,C,g,S,z,N,D,L,q,X,G,O,A,ne,I,Q,te,J,se,P,M,B;function F(ae,$){return ae[12]?Ea:Ra}let Z=F(l),ie=Z(l);return{c(){e=f("div"),t=f("div"),n=f("label"),n.textContent="Context Type",o=h(),c=f("div"),r=f("div"),u=f("select"),a=f("option"),a.textContent="Document",d=f("option"),d.textContent="Search Result",m=f("option"),m.textContent="User Input",p=f("option"),p.textContent="Note",_=h(),v=f("div"),y=f("label"),y.textContent="Title",b=h(),k=f("div"),w=f("input"),C=h(),g=f("div"),S=f("label"),S.textContent="Content",z=h(),N=f("div"),D=f("textarea"),L=h(),q=f("div"),X=f("div"),G=f("button"),ie.c(),O=h(),A=f("span"),A.textContent="Save Context",I=h(),Q=f("div"),te=f("button"),J=f("span"),J.innerHTML='<i class="fas fa-times"></i>',se=h(),P=f("span"),P.textContent="Cancel",i(n,"class","label is-small"),a.__value="document",a.value=a.__value,d.__value="search_result",d.value=d.__value,m.__value="user_input",m.value=m.__value,p.__value="note",p.value=p.__value,i(u,"data-testid","context-type-select"),l[11]===void 0&&it(()=>l[26].call(u)),i(r,"class","select is-small is-fullwidth"),i(c,"class","control"),i(t,"class","field"),i(y,"class","label is-small"),i(w,"class","input is-small"),i(w,"type","text"),i(w,"placeholder","Enter context title"),i(w,"data-testid","context-title-input"),i(k,"class","control"),i(v,"class","field"),i(S,"class","label is-small"),i(D,"class","textarea is-small"),i(D,"rows","4"),i(D,"placeholder","Enter context content"),i(D,"data-testid","context-content-textarea"),i(N,"class","control"),i(g,"class","field"),i(G,"class","button is-primary is-small"),G.disabled=ne=l[12]||!l[9].trim()||!l[10].trim(),i(G,"data-testid","add-context-submit-button"),i(X,"class","control"),i(J,"class","icon is-small"),i(te,"class","button is-light is-small"),te.disabled=l[12],i(Q,"class","control"),i(q,"class","field is-grouped"),i(e,"class","box has-background-light mb-4"),i(e,"data-testid","add-context-form")},m(ae,$){E(ae,e,$),s(e,t),s(t,n),s(t,o),s(t,c),s(c,r),s(r,u),s(u,a),s(u,d),s(u,m),s(u,p),qe(u,l[11],!0),s(e,_),s(e,v),s(v,y),s(v,b),s(v,k),s(k,w),Oe(w,l[9]),s(e,C),s(e,g),s(g,S),s(g,z),s(g,N),s(N,D),Oe(D,l[10]),s(e,L),s(e,q),s(q,X),s(X,G),ie.m(G,null),s(G,O),s(G,A),s(q,I),s(q,Q),s(Q,te),s(te,J),s(te,se),s(te,P),M||(B=[le(u,"change",l[26]),le(w,"input",l[27]),le(D,"input",l[28]),le(G,"click",l[18]),le(te,"click",l[17])],M=!0)},p(ae,$){$[0]&2048&&qe(u,ae[11]),$[0]&512&&w.value!==ae[9]&&Oe(w,ae[9]),$[0]&1024&&Oe(D,ae[10]),Z!==(Z=F(ae))&&(ie.d(1),ie=Z(ae),ie&&(ie.c(),ie.m(G,O))),$[0]&5632&&ne!==(ne=ae[12]||!ae[9].trim()||!ae[10].trim())&&(G.disabled=ne),$[0]&4096&&(te.disabled=ae[12])},d(ae){ae&&R(e),ie.d(),M=!1,Ze(B)}}}function Ra(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-save"></i>',i(e,"class","icon is-small")},m(t,n){E(t,e,n)},d(t){t&&R(e)}}}function Ea(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-spinner fa-spin"></i>',i(e,"class","icon is-small")},m(t,n){E(t,e,n)},d(t){t&&R(e)}}}function Aa(l){let e,t=l[6],n=[];for(let o=0;o<t.length;o+=1)n[o]=hs(rs(l,t,o));return{c(){e=f("div");for(let o=0;o<n.length;o+=1)n[o].c();i(e,"class","context-items svelte-rbq0zi"),i(e,"data-testid","conversation-context")},m(o,c){E(o,e,c);for(let r=0;r<n.length;r+=1)n[r]&&n[r].m(e,null)},p(o,c){if(c[0]&1572928){t=o[6];let r;for(r=0;r<t.length;r+=1){const u=rs(o,t,r);n[r]?n[r].p(u,c):(n[r]=hs(u),n[r].c(),n[r].m(e,null))}for(;r<n.length;r+=1)n[r].d(1);n.length=t.length}},d(o){o&&R(e),xe(n,o)}}}function La(l){let e;return{c(){e=f("div"),e.innerHTML=`<span class="icon is-large"><i class="fas fa-inbox fa-2x"></i></span> 
              <p class="is-size-6">No context items yet</p> 
              <p class="is-size-7">Add documents from search results to provide context for your chat.</p>`,i(e,"class","has-text-centered has-text-grey-light"),i(e,"data-testid","empty-context-message")},m(t,n){E(t,e,n)},p:Pe,d(t){t&&R(e)}}}function ms(l){let e,t=l[40].relevance_score.toFixed(1)+"",n;return{c(){e=f("span"),n=K(t),i(e,"class","tag is-light is-small")},m(o,c){E(o,e,c),s(e,n)},p(o,c){c[0]&64&&t!==(t=o[40].relevance_score.toFixed(1)+"")&&we(n,t)},d(o){o&&R(e)}}}function Oa(l){let e,t=l[40].content.substring(0,150)+"",n,o=l[40].content.length>150?"...":"",c;return{c(){e=f("p"),n=K(t),c=K(o),i(e,"class","context-preview svelte-rbq0zi"),i(e,"data-testid",`context-content-${l[42]}`)},m(r,u){E(r,e,u),s(e,n),s(e,c)},p(r,u){u[0]&64&&t!==(t=r[40].content.substring(0,150)+"")&&we(n,t),u[0]&64&&o!==(o=r[40].content.length>150?"...":"")&&we(c,o)},d(r){r&&R(e)}}}function Na(l){let e,t=l[40].summary+"",n;return{c(){e=f("p"),n=K(t),i(e,"class","context-summary svelte-rbq0zi"),i(e,"data-testid",`context-summary-${l[42]}`)},m(o,c){E(o,e,c),s(e,n)},p(o,c){c[0]&64&&t!==(t=o[40].summary+"")&&we(n,t)},d(o){o&&R(e)}}}function _s(l){let e;return{c(){e=f("hr"),i(e,"class","context-divider svelte-rbq0zi")},m(t,n){E(t,e,n)},d(t){t&&R(e)}}}function hs(l){let e,t,n,o,c,r=l[40].context_type.replace(/([A-Z])/g," $1").trim()+"",u,a,d,m,p,_,v,y,b,k,w,C,g,S,z,N=l[40].title+"",D,L,q,X,G,O,A=new Date(l[40].created_at).toLocaleString()+"",ne,I,Q,te,J,se,P,M=l[40].relevance_score&&ms(l);function B(){return l[29](l[40])}function F(){return l[30](l[40])}function Z(T,H){return T[40].summary?Na:Oa}let ie=Z(l),ae=ie(l),$=l[42]<l[6].length-1&&_s();return{c(){e=f("div"),t=f("div"),n=f("div"),o=f("div"),c=f("span"),u=K(r),d=h(),m=f("div"),p=f("div"),M&&M.c(),_=h(),v=f("div"),y=f("div"),b=f("div"),k=f("button"),k.innerHTML='<span class="icon is-small"><i class="fas fa-edit"></i></span>',w=h(),C=f("div"),g=f("button"),g.innerHTML='<span class="icon is-small"><i class="fas fa-trash"></i></span>',S=h(),z=f("h6"),D=K(N),L=h(),q=f("div"),ae.c(),X=h(),G=f("div"),O=K("Added: "),ne=K(A),te=h(),$&&$.c(),J=rt(),i(c,"class",a="tag is-small "+(l[40].context_type==="Document"?"is-info":l[40].context_type==="SearchResult"?"is-primary":l[40].context_type==="UserInput"?"is-warning":"is-light")),i(c,"data-testid",`context-type-${l[42]}`),i(o,"class","level-item"),i(n,"class","level-left"),i(p,"class","level-item"),i(k,"class","button is-small is-light"),i(k,"data-testid",`edit-context-${l[42]}`),i(k,"title","Edit context"),i(b,"class","control"),i(g,"class","button is-small is-light is-danger"),i(g,"data-testid",`delete-context-${l[42]}`),i(g,"title","Delete context"),i(C,"class","control"),i(y,"class","field is-grouped"),i(v,"class","level-item context-actions svelte-rbq0zi"),i(m,"class","level-right"),i(t,"class","level is-mobile"),i(z,"class","title is-6 has-text-dark"),i(z,"data-testid",`context-title-${l[42]}`),i(q,"class","content is-small"),i(G,"class","is-size-7 has-text-grey"),i(e,"class","context-item svelte-rbq0zi"),i(e,"data-context-id",I=l[40].id),i(e,"data-testid",`context-item-${l[42]}`),i(e,"data-context-type",Q=l[40].context_type)},m(T,H){E(T,e,H),s(e,t),s(t,n),s(n,o),s(o,c),s(c,u),s(t,d),s(t,m),s(m,p),M&&M.m(p,null),s(m,_),s(m,v),s(v,y),s(y,b),s(b,k),s(y,w),s(y,C),s(C,g),s(e,S),s(e,z),s(z,D),s(e,L),s(e,q),ae.m(q,null),s(e,X),s(e,G),s(G,O),s(G,ne),E(T,te,H),$&&$.m(T,H),E(T,J,H),se||(P=[le(k,"click",B),le(g,"click",F)],se=!0)},p(T,H){l=T,H[0]&64&&r!==(r=l[40].context_type.replace(/([A-Z])/g," $1").trim()+"")&&we(u,r),H[0]&64&&a!==(a="tag is-small "+(l[40].context_type==="Document"?"is-info":l[40].context_type==="SearchResult"?"is-primary":l[40].context_type==="UserInput"?"is-warning":"is-light"))&&i(c,"class",a),l[40].relevance_score?M?M.p(l,H):(M=ms(l),M.c(),M.m(p,null)):M&&(M.d(1),M=null),H[0]&64&&N!==(N=l[40].title+"")&&we(D,N),ie===(ie=Z(l))&&ae?ae.p(l,H):(ae.d(1),ae=ie(l),ae&&(ae.c(),ae.m(q,null))),H[0]&64&&A!==(A=new Date(l[40].created_at).toLocaleString()+"")&&we(ne,A),H[0]&64&&I!==(I=l[40].id)&&i(e,"data-context-id",I),H[0]&64&&Q!==(Q=l[40].context_type)&&i(e,"data-context-type",Q),l[42]<l[6].length-1?$||($=_s(),$.c(),$.m(J.parentNode,J)):$&&($.d(1),$=null)},d(T){T&&R(e),M&&M.d(),ae.d(),T&&R(te),$&&$.d(T),T&&R(J),se=!1,Ze(P)}}}function Da(l){let e,t,n,o,c,r,u,a,d,m,p,_,v,y,b,k,w,C,g,S,z,N,D,L,q,X,G,O,A,ne,I,Q,te,J,se,P,M,B,F,Z,ie,ae,$,T,H,x=l[6].length+"",ee,V,me,fe,ue,pe,_e,he,Se,Ge;e=new cl({props:{fallbackPath:"/"}});let je=l[5]&&as(l),Ae=l[0],Re=[];for(let de=0;de<Ae.length;de+=1)Re[de]=cs(is(l,Ae,de));let re=l[2]&&us(),ye=l[4]&&fs(l),Ne=l[3]&&ds(l);function Be(de,Le){return de[7]?Sa:$a}let Ke=Be(l),Te=Ke(l),De=l[8]&&ps(l);function et(de,Le){return de[6].length===0?La:Aa}let Je=et(l),Me=Je(l);function He(de){l[31](de)}let tt={context:l[14],mode:l[15]};return l[13]!==void 0&&(tt.active=l[13]),pe=new Ta({props:tt}),st.push(()=>at(pe,"active",He)),pe.$on("update",l[32]),pe.$on("delete",l[33]),pe.$on("close",l[34]),{c(){ge(e.$$.fragment),t=h(),n=f("section"),o=f("div"),c=f("div"),r=f("div"),u=f("h2"),u.textContent="Chat",a=h(),d=f("p"),d.textContent=`Role: ${St(Et)}`,m=h(),je&&je.c(),p=h(),_=f("div");for(let de=0;de<Re.length;de+=1)Re[de].c();v=h(),re&&re.c(),y=h(),ye&&ye.c(),b=h(),Ne&&Ne.c(),k=h(),w=f("div"),C=f("div"),g=f("textarea"),S=h(),z=f("div"),N=f("button"),D=f("span"),D.innerHTML='<i class="fas fa-paper-plane"></i>',q=h(),X=f("div"),G=f("div"),O=f("div"),A=f("div"),ne=f("div"),I=f("h4"),I.textContent="Context",Q=h(),te=f("button"),te.innerHTML=`<span class="icon is-small"><i class="fas fa-plus"></i></span> 
                  <span>Add Context</span>`,J=h(),se=f("div"),P=f("div"),M=f("button"),Te.c(),B=h(),De&&De.c(),F=h(),Me.c(),Z=h(),ie=f("div"),ae=f("div"),$=f("div"),T=f("div"),H=f("span"),ee=K(x),V=K(" context items"),me=h(),fe=f("div"),fe.innerHTML='<div class="level-item"><span class="is-size-7 has-text-grey">Context is automatically included in your chat</span></div>',ue=h(),ge(pe.$$.fragment),i(u,"class","title is-4"),i(d,"class","subtitle is-6"),i(_,"class","chat-window svelte-rbq0zi"),i(_,"data-testid","chat-messages"),i(g,"class","textarea"),i(g,"rows","3"),i(g,"placeholder","Type your message and press Enter..."),i(g,"data-testid","chat-input"),i(C,"class","control is-expanded"),i(D,"class","icon"),i(N,"class","button is-primary"),N.disabled=L=l[2]||!l[1].trim(),i(N,"data-testid","send-message-button"),i(z,"class","control"),i(w,"class","field has-addons chat-input svelte-rbq0zi"),i(r,"class","column is-8"),i(I,"class","title is-5"),i(te,"class","button is-small is-primary"),i(te,"data-testid","show-add-context-button"),i(ne,"class","level-item"),i(A,"class","level-left"),i(M,"class","button is-small is-light"),M.disabled=l[7],i(M,"data-testid","refresh-context-button"),i(P,"class","level-item"),i(se,"class","level-right"),i(O,"class","level is-mobile"),i(H,"class","tag is-light is-small"),i(H,"data-testid","context-summary"),i(T,"class","level-item"),i($,"class","level-left"),i(fe,"class","level-right"),i(ae,"class","level is-mobile"),i(ie,"class","mt-4"),i(G,"class","box context-panel svelte-rbq0zi"),i(G,"data-testid","context-panel"),i(X,"class","column is-4"),i(c,"class","columns svelte-rbq0zi"),i(o,"class","container"),i(n,"class","section"),i(n,"data-testid","chat-interface")},m(de,Le){ve(e,de,Le),E(de,t,Le),E(de,n,Le),s(n,o),s(o,c),s(c,r),s(r,u),s(r,a),s(r,d),s(r,m),je&&je.m(r,null),s(r,p),s(r,_);for(let U=0;U<Re.length;U+=1)Re[U]&&Re[U].m(_,null);s(_,v),re&&re.m(_,null),s(r,y),ye&&ye.m(r,null),s(r,b),Ne&&Ne.m(r,null),s(r,k),s(r,w),s(w,C),s(C,g),Oe(g,l[1]),s(w,S),s(w,z),s(z,N),s(N,D),s(c,q),s(c,X),s(X,G),s(G,O),s(O,A),s(A,ne),s(ne,I),s(ne,Q),s(ne,te),s(O,J),s(O,se),s(se,P),s(P,M),Te.m(M,null),s(G,B),De&&De.m(G,null),s(G,F),Me.m(G,null),s(G,Z),s(G,ie),s(ie,ae),s(ae,$),s($,T),s(T,H),s(H,ee),s(H,V),s(ae,me),s(ae,fe),E(de,ue,Le),ve(pe,de,Le),he=!0,Se||(Ge=[le(g,"input",l[25]),le(g,"keydown",l[24]),le(N,"click",l[23]),le(te,"click",l[17]),le(M,"click",l[16])],Se=!0)},p(de,Le){if(de[5]?je?je.p(de,Le):(je=as(de),je.c(),je.m(r,p)):je&&(je.d(1),je=null),Le[0]&1){Ae=de[0];let W;for(W=0;W<Ae.length;W+=1){const j=is(de,Ae,W);Re[W]?Re[W].p(j,Le):(Re[W]=cs(j),Re[W].c(),Re[W].m(_,v))}for(;W<Re.length;W+=1)Re[W].d(1);Re.length=Ae.length}de[2]?re||(re=us(),re.c(),re.m(_,null)):re&&(re.d(1),re=null),de[4]?ye?ye.p(de,Le):(ye=fs(de),ye.c(),ye.m(r,b)):ye&&(ye.d(1),ye=null),de[3]?Ne?Ne.p(de,Le):(Ne=ds(de),Ne.c(),Ne.m(r,k)):Ne&&(Ne.d(1),Ne=null),Le[0]&2&&Oe(g,de[1]),(!he||Le[0]&6&&L!==(L=de[2]||!de[1].trim()))&&(N.disabled=L),Ke!==(Ke=Be(de))&&(Te.d(1),Te=Ke(de),Te&&(Te.c(),Te.m(M,null))),(!he||Le[0]&128)&&(M.disabled=de[7]),de[8]?De?De.p(de,Le):(De=ps(de),De.c(),De.m(G,F)):De&&(De.d(1),De=null),Je===(Je=et(de))&&Me?Me.p(de,Le):(Me.d(1),Me=Je(de),Me&&(Me.c(),Me.m(G,Z))),(!he||Le[0]&64)&&x!==(x=de[6].length+"")&&we(ee,x);const U={};Le[0]&16384&&(U.context=de[14]),Le[0]&32768&&(U.mode=de[15]),!_e&&Le[0]&8192&&(_e=!0,U.active=de[13],ct(()=>_e=!1)),pe.$set(U)},i(de){he||(Y(e.$$.fragment,de),Y(pe.$$.fragment,de),he=!0)},o(de){oe(e.$$.fragment,de),oe(pe.$$.fragment,de),he=!1},d(de){be(e,de),de&&R(t),de&&R(n),je&&je.d(),xe(Re,de),re&&re.d(),ye&&ye.d(),Ne&&Ne.d(),Te.d(),De&&De.d(),Me.d(),de&&R(ue),be(pe,de),Se=!1,Ze(Ge)}}}function Pa(l,e,t){let n;Ue(l,ot,$=>t(36,n=$));let o=[],c="",r=!1,u=null,a=null,d=null,m=[],p=!1,_=!1,v="",y="",b="document",k=!1,w=!1,C=null,g="edit",S=null;function z($){t(0,o=[...o,{role:"user",content:$}])}async function N(){try{if(n){const $=await Fe("list_conversations");$!=null&&$.conversations&&$.conversations.length>0?(t(5,d=$.conversations[0].id),console.log("🎯 Using existing conversation:",d),await L()):await D()}else{const $=await fetch(`${Xe.ServerURL}/conversations`);if($.ok){const T=await $.json();T.conversations&&T.conversations.length>0?(t(5,d=T.conversations[0].id),console.log("🎯 Using existing conversation:",d),await L()):await D()}else await D()}}catch($){console.error("❌ Error initializing conversation:",$)}}async function D(){try{const $=St(Et);if(n){const T=await Fe("create_conversation",{title:"Chat Conversation",role:$});T.status==="success"&&T.conversation_id&&(t(5,d=T.conversation_id),console.log("🆕 Created new conversation:",d))}else{const T=await fetch(`${Xe.ServerURL}/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"Chat Conversation",role:$})});if(T.ok){const H=await T.json();H.status==="Success"&&H.conversation_id&&(t(5,d=H.conversation_id),console.log("🆕 Created new conversation:",d))}}}catch($){console.error("❌ Error creating conversation:",$)}}async function L(){if(!d){console.warn("⚠️ Cannot load context: no conversation ID available");return}t(7,p=!0),console.log("🔄 Loading conversation context for:",d);try{if(n){console.log("📱 Loading context via Tauri...");const $=await Fe("get_conversation",{conversationId:d});if(console.log("📥 Tauri response:",$),$.status==="success"&&$.conversation){const T=$.conversation.global_context||[];t(6,m=T),console.log(`✅ Loaded ${T.length} context items via Tauri`)}else console.error("❌ Failed to get conversation via Tauri:",$.error||"Unknown error"),t(6,m=[])}else{console.log("🌐 Loading context via HTTP...");const $=await fetch(`${Xe.ServerURL}/conversations/${d}`);if(console.log("📥 HTTP response status:",$.status,$.statusText),$.ok){const T=await $.json();if(console.log("📄 HTTP response data:",T),T.status==="success"&&T.conversation){const H=T.conversation.global_context||[];t(6,m=H),console.log(`✅ Loaded ${H.length} context items via HTTP`)}else console.error("❌ Failed to get conversation via HTTP:",T.error||"Unknown error"),t(6,m=[])}else console.error("❌ HTTP request failed:",$.status,$.statusText),t(6,m=[])}}catch($){console.error("❌ Error loading conversation context:",{error:$.message||$,conversationId:d,isTauri:n,timestamp:new Date().toISOString()}),t(6,m=[])}finally{t(7,p=!1),console.log("🏁 Context loading completed. Items count:",m.length)}}function q(){t(8,_=!_),_||(t(9,v=""),t(10,y=""),t(11,b="document"))}async function X(){if(!(!d||!v.trim()||!y.trim())){t(12,k=!0);try{const $={title:v.trim(),summary:null,content:y.trim(),context_type:b};if(n){const T=await Fe("add_context_to_conversation",{conversationId:d,contextData:$});T.status==="success"?(await L(),q(),console.log("✅ Context added successfully via Tauri")):console.error("❌ Failed to add context via Tauri:",T.error)}else{const T=await fetch(`${Xe.ServerURL}/conversations/${d}/context`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify($)});if(T.ok){const H=await T.json();H.status==="success"?(await L(),q(),console.log("✅ Context added successfully via HTTP")):console.error("❌ Failed to add context via HTTP:",H.error)}else console.error("❌ HTTP request failed:",T.status,T.statusText)}}catch($){console.error("❌ Error adding manual context:",$)}finally{t(12,k=!1)}}}function G($){t(14,C=$),t(15,g="edit"),t(13,w=!0)}function O($){confirm(`Are you sure you want to delete "${$.title}"?`)&&A($.id)}async function A($){if(!(!d||S)){S=$,console.log("🗑️ Deleting context:",$);try{if(n){const T=await Fe("delete_context",{conversationId:d,contextId:$});(T==null?void 0:T.status)==="success"?(console.log("✅ Context deleted successfully via Tauri"),await L()):console.error("❌ Failed to delete context via Tauri:",T==null?void 0:T.error)}else{const T=await fetch(`${Xe.ServerURL}/conversations/${d}/context/${$}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(T.ok){const H=await T.json();H.status==="Success"?(console.log("✅ Context deleted successfully via HTTP"),await L()):console.error("❌ Failed to delete context via HTTP:",H.error)}else console.error("❌ HTTP delete request failed:",T.status)}}catch(T){console.error("❌ Error deleting context:",T)}finally{S=null}}}async function ne($){if(d){console.log("📝 Updating context:",$.id);try{const T={context_type:$.context_type,title:$.title,summary:$.summary,content:$.content,metadata:$.metadata};if(n){const H=await Fe("update_context",{conversationId:d,contextId:$.id,request:T});(H==null?void 0:H.status)==="success"?(console.log("✅ Context updated successfully via Tauri"),await L()):console.error("❌ Failed to update context via Tauri:",H==null?void 0:H.error)}else{const H=await fetch(`${Xe.ServerURL}/conversations/${d}/context/${$.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(T)});if(H.ok){const x=await H.json();x.status==="Success"?(console.log("✅ Context updated successfully via HTTP"),await L()):console.error("❌ Failed to update context via HTTP:",x.error)}else console.error("❌ HTTP update request failed:",H.status)}}catch(T){console.error("❌ Error updating context:",T)}}}async function I(){var H;if(!c.trim()||r)return;t(3,u=null);const $=St(Et),T=c.trim();t(1,c=""),d||await N(),z(T),t(2,r=!0);try{const x={role:$,messages:o};d&&(x.conversation_id=d);const ee=await fetch(`${Xe.ServerURL}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(x)});if(!ee.ok)throw new Error(`HTTP ${ee.status}`);const V=await ee.json();t(4,a=V.model_used??null),((H=V.status)==null?void 0:H.toLowerCase())==="success"&&V.message?t(0,o=[...o,{role:"assistant",content:V.message}]):t(3,u=V.error||"Chat failed")}catch(x){t(3,u=(x==null?void 0:x.message)||String(x))}finally{t(2,r=!1)}}function Q($){($.key==="Enter"||$.key==="Return")&&!$.shiftKey&&($.preventDefault(),I())}Qt(()=>{if(t(0,o=[{role:"assistant",content:"Hi! How can I help you? Ask me anything about your search results or documents."}]),N(),typeof window<"u"){const $=()=>{d&&L()};return window.addEventListener("focus",$),()=>{window.removeEventListener("focus",$)}}});function te(){c=this.value,t(1,c)}function J(){b=$t(this),t(11,b)}function se(){v=this.value,t(9,v)}function P(){y=this.value,t(10,y)}const M=$=>G($),B=$=>O($);function F($){w=$,t(13,w)}return[o,c,r,u,a,d,m,p,_,v,y,b,k,w,C,g,L,q,X,G,O,A,ne,I,Q,te,J,se,P,M,B,F,$=>ne($.detail),$=>A($.detail),()=>{t(13,w=!1),t(14,C=null)}]}class Ma extends _t{constructor(e){super(),ht(this,e,Pa,Da,ft,{},null,[-1,-1])}}function Ia(l){let e,t;return e=new Zi({}),{c(){ge(e.$$.fragment)},m(n,o){ve(e,n,o),t=!0},i(n){t||(Y(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){be(e,n)}}}function Ua(l){let e,t;return e=new Ma({}),{c(){ge(e.$$.fragment)},m(n,o){ve(e,n,o),t=!0},i(n){t||(Y(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){be(e,n)}}}function ja(l){let e,t;return e=new ha({}),{c(){ge(e.$$.fragment)},m(n,o){ve(e,n,o),t=!0},i(n){t||(Y(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){be(e,n)}}}function Ha(l){let e,t;return e=new jr({}),{c(){ge(e.$$.fragment)},m(n,o){ve(e,n,o),t=!0},i(n){t||(Y(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){be(e,n)}}}function za(l){let e,t;return e=new aa({}),{c(){ge(e.$$.fragment)},m(n,o){ve(e,n,o),t=!0},i(n){t||(Y(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){be(e,n)}}}function Fa(l){let e,t;return e=new fa({}),{c(){ge(e.$$.fragment)},m(n,o){ve(e,n,o),t=!0},i(n){t||(Y(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){be(e,n)}}}function qa(l){let e;return{c(){e=f("nav"),e.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
            <a class="navbar-item" href="/config/wizard">Wizard</a> 
            <a class="navbar-item" href="/config/json">JSON Editor</a> 
            <a class="navbar-item" href="/graph">Graph</a> 
            <a class="navbar-item" href="/chat">Chat</a></div>`,i(e,"class","navbar")},m(t,n){E(t,e,n)},p:Pe,d(t){t&&R(e)}}}function Ka(l){let e,t,n,o,c,r,u,a,d,m,p,_,v,y,b,k,w,C,g,S,z,N,D,L,q,X,G,O,A,ne,I,Q,te,J,se,P,M,B,F,Z,ie,ae;return g=new Ol({}),N=new Nt({props:{path:"/",$$slots:{default:[Ia]},$$scope:{ctx:l}}}),L=new Nt({props:{path:"/chat",$$slots:{default:[Ua]},$$scope:{ctx:l}}}),X=new Nt({props:{path:"/graph",$$slots:{default:[ja]},$$scope:{ctx:l}}}),ne=new Nt({props:{path:"/fetch/*",$$slots:{default:[Ha]},$$scope:{ctx:l}}}),Q=new Nt({props:{path:"/config/wizard",$$slots:{default:[za]},$$scope:{ctx:l}}}),J=new Nt({props:{path:"/config/json",$$slots:{default:[Fa]},$$scope:{ctx:l}}}),B=new Nt({props:{path:"/",$$slots:{default:[qa]},$$scope:{ctx:l}}}),{c(){e=f("meta"),t=h(),n=f("div"),o=f("main"),c=f("div"),r=f("div"),u=f("div"),a=f("ul"),d=f("li"),m=f("a"),m.innerHTML=`<span class="icon is-small"><i class="fas fa-search"></i></span> 
                <span>Search</span>`,p=h(),_=f("li"),v=f("a"),v.innerHTML=`<span class="icon is-small"><i class="fas fa-comments"></i></span> 
                <span>Chat</span>`,y=h(),b=f("li"),k=f("a"),k.innerHTML=`<span class="icon is-small"><i class="fas fa-project-diagram"></i></span> 
                <span>Graph</span>`,w=h(),C=f("div"),ge(g.$$.fragment),S=h(),z=f("div"),ge(N.$$.fragment),D=h(),ge(L.$$.fragment),q=h(),ge(X.$$.fragment),G=h(),O=f("br"),A=h(),ge(ne.$$.fragment),I=h(),ge(Q.$$.fragment),te=h(),ge(J.$$.fragment),se=h(),P=f("footer"),M=f("div"),ge(B.$$.fragment),i(e,"name","color-scheme"),i(e,"content",l[1]),document.title="Terraphim",i(m,"href","/"),i(m,"data-exact",""),i(m,"data-testid","search-tab"),i(d,"class","svelte-1nmgbjk"),i(v,"href","/chat"),i(v,"data-testid","chat-tab"),i(_,"class","svelte-1nmgbjk"),i(k,"href","/graph"),i(k,"data-testid","graph-tab"),i(b,"class","svelte-1nmgbjk"),i(u,"class","tabs is-boxed svelte-1nmgbjk"),i(r,"class","main-navigation svelte-1nmgbjk"),i(C,"class","role-selector svelte-1nmgbjk"),i(c,"class","top-controls svelte-1nmgbjk"),i(z,"class","main-area svelte-1nmgbjk"),i(o,"class","main-content svelte-1nmgbjk"),i(M,"class",F=Pt(l[0])+" svelte-1nmgbjk"),i(P,"class","svelte-1nmgbjk"),i(n,"class","is-full-height svelte-1nmgbjk")},m($,T){s(document.head,e),E($,t,T),E($,n,T),s(n,o),s(o,c),s(c,r),s(r,u),s(u,a),s(a,d),s(d,m),s(a,p),s(a,_),s(_,v),s(a,y),s(a,b),s(b,k),s(c,w),s(c,C),ve(g,C,null),s(o,S),s(o,z),ve(N,z,null),s(z,D),ve(L,z,null),s(z,q),ve(X,z,null),s(o,G),s(o,O),s(o,A),ve(ne,o,null),s(o,I),ve(Q,o,null),s(o,te),ve(J,o,null),s(n,se),s(n,P),s(P,M),ve(B,M,null),Z=!0,ie||(ae=[jl(Hl.call(null,m)),jl(Hl.call(null,v)),jl(Hl.call(null,k)),le(P,"mouseover",l[2]),le(P,"focus",l[2])],ie=!0)},p($,[T]){(!Z||T&2)&&i(e,"content",$[1]);const H={};T&16&&(H.$$scope={dirty:T,ctx:$}),N.$set(H);const x={};T&16&&(x.$$scope={dirty:T,ctx:$}),L.$set(x);const ee={};T&16&&(ee.$$scope={dirty:T,ctx:$}),X.$set(ee);const V={};T&16&&(V.$$scope={dirty:T,ctx:$}),ne.$set(V);const me={};T&16&&(me.$$scope={dirty:T,ctx:$}),Q.$set(me);const fe={};T&16&&(fe.$$scope={dirty:T,ctx:$}),J.$set(fe);const ue={};T&16&&(ue.$$scope={dirty:T,ctx:$}),B.$set(ue),(!Z||T&1&&F!==(F=Pt($[0])+" svelte-1nmgbjk"))&&i(M,"class",F)},i($){Z||(Y(g.$$.fragment,$),Y(N.$$.fragment,$),Y(L.$$.fragment,$),Y(X.$$.fragment,$),Y(ne.$$.fragment,$),Y(Q.$$.fragment,$),Y(J.$$.fragment,$),Y(B.$$.fragment,$),Z=!0)},o($){oe(g.$$.fragment,$),oe(N.$$.fragment,$),oe(L.$$.fragment,$),oe(X.$$.fragment,$),oe(ne.$$.fragment,$),oe(Q.$$.fragment,$),oe(J.$$.fragment,$),oe(B.$$.fragment,$),Z=!1},d($){R(e),$&&R(t),$&&R(n),be(g),be(N),be(L),be(X),be(ne),be(Q),be(J),be(B),ie=!1,Ze(ae)}}}function Wa(l,e,t){let n;Ue(l,hl,r=>t(1,n=r));let o="is-hidden";function c(){t(0,o="")}return[o,n,c]}class Ga extends _t{constructor(e){super(),ht(this,e,Wa,Ka,ft,{})}}const Ba=new tr;lr(Ba);new Ga({target:document.getElementById("app")});
