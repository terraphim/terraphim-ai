var Li=Object.defineProperty;var Ei=(l,e,t)=>e in l?Li(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var Vt=(l,e,t)=>(Ei(l,typeof e!="symbol"?e+"":e,t),t);import{aa as Zt,S as Pt,i as Ut,s as Ot,q as f,Y as M,b as T,y as s,Z as ae,I as Le,j as S,ak as Ge,au as ml,r as be,a as b,v as a,z as ke,t as J,d as x,B as we,av as Ai,aw as yl,H as mt,U as bt,V as kt,ax as _l,ay as Di,F as Ct,g as qe,e as We,O as _t,af as $t,m as wl,o as an,W as Ce,l as ee,E as lt,az as jl,aA as Wt,aB as cn,aC as Ni,a1 as je,C as It,aD as nt,aE as un,D as Dl,G as Nl,aF as gl,w as rl,x as pt,A as Hl,a2 as Ii,aG as ol,ac as ii,a5 as Yl,aH as ri,a7 as ai,a9 as ci,n as Oi,k as fn,_ as en}from"./vendor-ui-ec1c326c.js";import{R as sl,S as Fl,f as ui,Y as tn}from"./vendor-utils-8620e3e4.js";import{J as fi,_ as Ul,c as di,P as Mi,i as Pi,D as Ui,j as ji,E as Hi,k as Tn}from"./vendor-editor-5741781d.js";import{P as pi,T as Zl,b as mi,y as Fi,A as zi}from"./vendor-atomic-ec100559.js";import{t as Ki,E as Gi}from"./novel-editor-ff46bbca.js";import{s as ln,z as qi,a as Wi,l as Ji,m as Bi,c as Qi,b as Vi,B as Yi,d as Zi}from"./vendor-charts-e6a4a6c9.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(o){if(o.ep)return;o.ep=!0;const r=t(o);fetch(o.href,r)}})();const at={ServerURL:location.protocol+"//"+window.location.host||"/"},Ml=Zt([]),Xi={id:"Desktop",global_shortcut:"",roles:{},default_role:{original:"",lowercase:""},selected_role:{original:"",lowercase:""}},Pl=Zt("spacelab"),Nt=Zt("selected"),vt=Zt(!1),xi=Zt(`${at.ServerURL}/documents/search`),Jt=Zt(Xi),$n=Zt([]);let pl=Zt("");const Yt=Zt(!1),Bl=Zt(null),Rn=Zt(!1);let $l=null;function er(l){if(typeof document>"u")return;const e=`/assets/bulmaswatch/${l}/bulmaswatch.min.css`;if($l!=null&&$l.href.endsWith(e))return;const t=document.createElement("link");t.rel="stylesheet",t.href=e,t.id="bulma-theme",t.onload=()=>{$l&&$l!==t&&$l.remove(),$l=t},document.head.appendChild(t);const n=document.head.querySelector('meta[name="color-scheme"]');n&&n.setAttribute("content",l)}Pl.subscribe(er);function tr(l){let e,t;return{c(){e=f("option"),t=M(l[1]),e.__value=l[0],e.value=e.__value},m(n,o){T(n,e,o),s(e,t)},p(n,[o]){o&2&&ae(t,n[1]),o&1&&(e.__value=n[0],e.value=e.__value)},i:Le,o:Le,d(n){n&&S(e)}}}function lr(l,e,t){let n,{subject:o}=e;const r=pi(o),i=Zl(r,mi.properties.name);return Ge(l,i,u=>t(1,n=u)),Zl(r,"http://localhost:9883/property/theme"),l.$$set=u=>{"subject"in u&&t(0,o=u.subject)},[o,n,i]}class nr extends Pt{constructor(e){super(),Ut(this,e,lr,tr,Ot,{subject:0})}}function or(){return window.crypto.getRandomValues(new Uint32Array(1))[0]}function on(l,e=!1){const t=or(),n=`_${t}`;return Object.defineProperty(window,n,{value:o=>(e&&Reflect.deleteProperty(window,n),l==null?void 0:l(o)),writable:!1,configurable:!0}),t}async function ze(l,e={}){return new Promise((t,n)=>{const o=on(i=>{t(i),Reflect.deleteProperty(window,`_${r}`)},!0),r=on(i=>{n(i),Reflect.deleteProperty(window,`_${o}`)},!0);window.__TAURI_IPC__({cmd:l,callback:o,error:r,...e})})}function Ln(l,e,t){const n=l.slice();return n[25]=e[t],n}function sr(l){let e,t,n;function o(i){l[13](i)}let r={};return l[5]!==void 0&&(r.value=l[5]),e=new yl({props:r}),mt.push(()=>bt(e,"value",o)),{c(){be(e.$$.fragment)},m(i,u){ke(e,i,u),n=!0},p(i,u){const c={};!t&&u&32&&(t=!0,c.value=i[5],kt(()=>t=!1)),e.$set(c)},i(i){n||(J(e.$$.fragment,i),n=!0)},o(i){x(e.$$.fragment,i),n=!1},d(i){we(e,i)}}}function ir(l){let e,t,n;function o(i){l[14](i)}let r={type:"password",placeholder:"secret",icon:"fas fa-lock",expanded:!0};return l[6]!==void 0&&(r.value=l[6]),e=new yl({props:r}),mt.push(()=>bt(e,"value",o)),{c(){be(e.$$.fragment)},m(i,u){ke(e,i,u),n=!0},p(i,u){const c={};!t&&u&64&&(t=!0,c.value=i[6],kt(()=>t=!1)),e.$set(c)},i(i){n||(J(e.$$.fragment,i),n=!0)},o(i){x(e.$$.fragment,i),n=!1},d(i){we(e,i)}}}function rr(l){let e;return{c(){e=M("Save")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function ar(l){let e,t;return e=new _l({props:{type:"is-success",class:"is-right",iconPack:"fa",iconLeft:"check",$$slots:{default:[rr]},$$scope:{ctx:l}}}),e.$on("click",l[8]),e.$on("submit",l[8]),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},p(n,o){const r={};o&268435456&&(r.$$scope={dirty:o,ctx:n}),e.$set(r)},i(n){t||(J(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function cr(l){let e,t,n,o,r,i;return e=new ml({props:{$$slots:{default:[sr]},$$scope:{ctx:l}}}),n=new ml({props:{grouped:!0,$$slots:{default:[ir]},$$scope:{ctx:l}}}),r=new ml({props:{grouped:!0,$$slots:{default:[ar]},$$scope:{ctx:l}}}),{c(){be(e.$$.fragment),t=b(),be(n.$$.fragment),o=b(),be(r.$$.fragment)},m(u,c){ke(e,u,c),T(u,t,c),ke(n,u,c),T(u,o,c),ke(r,u,c),i=!0},p(u,c){const p={};c&268435488&&(p.$$scope={dirty:c,ctx:u}),e.$set(p);const d={};c&268435520&&(d.$$scope={dirty:c,ctx:u}),n.$set(d);const m={};c&268435456&&(m.$$scope={dirty:c,ctx:u}),r.$set(m)},i(u){i||(J(e.$$.fragment,u),J(n.$$.fragment,u),J(r.$$.fragment,u),i=!0)},o(u){x(e.$$.fragment,u),x(n.$$.fragment,u),x(r.$$.fragment,u),i=!1},d(u){we(e,u),u&&S(t),we(n,u),u&&S(o),we(r,u)}}}function ur(l){let e,t,n;function o(i){l[15](i)}let r={type:"search",placeholder:"Fetch JSON",icon:"search"};return l[3]!==void 0&&(r.value=l[3]),e=new yl({props:r}),mt.push(()=>bt(e,"value",o)),{c(){be(e.$$.fragment)},m(i,u){ke(e,i,u),n=!0},p(i,u){const c={};!t&&u&8&&(t=!0,c.value=i[3],kt(()=>t=!1)),e.$set(c)},i(i){n||(J(e.$$.fragment,i),n=!0)},o(i){x(e.$$.fragment,i),n=!1},d(i){we(e,i)}}}function fr(l){let e;return{c(){e=M("WikiPage")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function dr(l){let e,t,n,o,r,i;function u(m){l[16](m)}let c={type:"search",placeholder:"Post JSON",icon:"search"};l[4]!==void 0&&(c.value=l[4]),e=new yl({props:c}),mt.push(()=>bt(e,"value",u));function p(m){l[17](m)}let d={$$slots:{default:[fr]},$$scope:{ctx:l}};return l[2]!==void 0&&(d.checked=l[2]),o=new Di({props:d}),mt.push(()=>bt(o,"checked",p)),{c(){be(e.$$.fragment),n=b(),be(o.$$.fragment)},m(m,_){ke(e,m,_),T(m,n,_),ke(o,m,_),i=!0},p(m,_){const g={};!t&&_&16&&(t=!0,g.value=m[4],kt(()=>t=!1)),e.$set(g);const h={};_&268435456&&(h.$$scope={dirty:_,ctx:m}),!r&&_&4&&(r=!0,h.checked=m[2],kt(()=>r=!1)),o.$set(h)},i(m){i||(J(e.$$.fragment,m),J(o.$$.fragment,m),i=!0)},o(m){x(e.$$.fragment,m),x(o.$$.fragment,m),i=!1},d(m){we(e,m),m&&S(n),we(o,m)}}}function pr(l){let e;return{c(){e=M("Fetch")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function mr(l){let e,t;return e=new _l({props:{type:"is-primary",$$slots:{default:[pr]},$$scope:{ctx:l}}}),e.$on("click",l[9]),e.$on("submit",l[9]),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},p(n,o){const r={};o&268435456&&(r.$$scope={dirty:o,ctx:n}),e.$set(r)},i(n){t||(J(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function _r(l){let e,t,n,o,r,i;return e=new ml({props:{grouped:!0,$$slots:{default:[ur]},$$scope:{ctx:l}}}),n=new ml({props:{grouped:!0,$$slots:{default:[dr]},$$scope:{ctx:l}}}),r=new ml({props:{grouped:!0,$$slots:{default:[mr]},$$scope:{ctx:l}}}),{c(){be(e.$$.fragment),t=b(),be(n.$$.fragment),o=b(),be(r.$$.fragment)},m(u,c){ke(e,u,c),T(u,t,c),ke(n,u,c),T(u,o,c),ke(r,u,c),i=!0},p(u,c){const p={};c&268435464&&(p.$$scope={dirty:c,ctx:u}),e.$set(p);const d={};c&268435476&&(d.$$scope={dirty:c,ctx:u}),n.$set(d);const m={};c&268435456&&(m.$$scope={dirty:c,ctx:u}),r.$set(m)},i(u){i||(J(e.$$.fragment,u),J(n.$$.fragment,u),J(r.$$.fragment,u),i=!0)},o(u){x(e.$$.fragment,u),x(n.$$.fragment,u),x(r.$$.fragment,u),i=!1},d(u){we(e,u),u&&S(t),we(n,u),u&&S(o),we(r,u)}}}function gr(l){let e,t,n,o,r;return o=new fi({props:{content:l[1],onChange:l[7]}}),{c(){e=f("p"),e.innerHTML=`<i>The best editing experience is to configure Atomic Server, in the
        meantime use editor below. You will need to refresh page via Command R
        or Ctrl-R to see changes</i>`,t=b(),n=f("div"),be(o.$$.fragment),a(n,"class","editor")},m(i,u){T(i,e,u),T(i,t,u),T(i,n,u),ke(o,n,null),r=!0},p(i,u){const c={};u&2&&(c.content=i[1]),o.$set(c)},i(i){r||(J(o.$$.fragment,i),r=!0)},o(i){x(o.$$.fragment,i),r=!1},d(i){i&&S(e),i&&S(t),i&&S(n),we(o)}}}function En(l){let e,t;return e=new nr({props:{subject:l[25]}}),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},p(n,o){const r={};o&1&&(r.subject=n[25]),e.$set(r)},i(n){t||(J(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function hr(l){let e,t,n=l[0]??[],o=[];for(let i=0;i<n.length;i+=1)o[i]=En(Ln(l,n,i));const r=i=>x(o[i],1,1,()=>{o[i]=null});return{c(){for(let i=0;i<o.length;i+=1)o[i].c();e=Ct()},m(i,u){for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(i,u);T(i,e,u),t=!0},p(i,u){if(u&1){n=i[0]??[];let c;for(c=0;c<n.length;c+=1){const p=Ln(i,n,c);o[c]?(o[c].p(p,u),J(o[c],1)):(o[c]=En(p),o[c].c(),J(o[c],1),o[c].m(e.parentNode,e))}for(qe(),c=n.length;c<o.length;c+=1)r(c);We()}},i(i){if(!t){for(let u=0;u<n.length;u+=1)J(o[u]);t=!0}},o(i){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)x(o[u]);t=!1},d(i){_t(o,i),i&&S(e)}}}function vr(l){let e,t;return e=new Ai({props:{$$slots:{default:[hr]},$$scope:{ctx:l}}}),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},p(n,o){const r={};o&268435457&&(r.$$scope={dirty:o,ctx:n}),e.$set(r)},i(n){t||(J(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function br(l){let e,t,n,o,r,i,u,c,p,d,m,_,g;return t=new sl({props:{path:"/atomic",$$slots:{default:[cr]},$$scope:{ctx:l}}}),o=new sl({props:{path:"/json",$$slots:{default:[_r]},$$scope:{ctx:l}}}),i=new sl({props:{path:"/editor",$$slots:{default:[gr]},$$scope:{ctx:l}}}),d=new ml({props:{grouped:!0,position:"is-right",$$slots:{default:[vr]},$$scope:{ctx:l}}}),{c(){e=f("div"),be(t.$$.fragment),n=b(),be(o.$$.fragment),r=b(),be(i.$$.fragment),u=b(),c=f("hr"),p=b(),be(d.$$.fragment),m=b(),_=f("nav"),_.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
    <a class="navbar-item" href="/fetch/json">Fetch JSON Data</a> 
    <a class="navbar-item" href="/fetch/atomic">Set Atomic Server</a> 
    <a class="navbar-item" href="/fetch/editor">Edit JSON config</a></div>`,a(e,"class","box"),a(_,"class","navbar")},m(h,v){T(h,e,v),ke(t,e,null),s(e,n),ke(o,e,null),s(e,r),ke(i,e,null),T(h,u,v),T(h,c,v),T(h,p,v),ke(d,h,v),T(h,m,v),T(h,_,v),g=!0},p(h,[v]){const y={};v&268435552&&(y.$$scope={dirty:v,ctx:h}),t.$set(y);const k={};v&268435484&&(k.$$scope={dirty:v,ctx:h}),o.$set(k);const w={};v&268435458&&(w.$$scope={dirty:v,ctx:h}),i.$set(w);const $={};v&268435457&&($.$$scope={dirty:v,ctx:h}),d.$set($)},i(h){g||(J(t.$$.fragment,h),J(o.$$.fragment,h),J(i.$$.fragment,h),J(d.$$.fragment,h),g=!0)},o(h){x(t.$$.fragment,h),x(o.$$.fragment,h),x(i.$$.fragment,h),x(d.$$.fragment,h),g=!1},d(h){h&&S(e),we(t),we(o),we(i),h&&S(u),h&&S(c),h&&S(p),we(d,h),h&&S(m),h&&S(_)}}}function kr(l,e,t){let n,o,r,i,u;Ge(l,Fi,D=>t(19,r=D)),Ge(l,vt,D=>t(20,i=D)),Ge(l,Jt,D=>t(21,u=D));let c={json:u};function p(D){if(console.log("contents changed:",D),console.log("is tauri",i),Jt.update(A=>(A=D.json,A)),vt)console.log("Updating config on server"),ze("update_config",{configNew:D.json}).then(A=>{console.log(`Message: ${A}`)}).catch(A=>console.error(A));else{let A=`${at.ServerURL}/config/`;fetch(A,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(D.json)})}t(1,c=D)}let d=!1,m="https://raw.githubusercontent.com/terraphim/terraphim-cloud-fastapi/main/data/ref_arch.json",_="http://localhost:8000/documents/",g="http://localhost:9883/",h;const v=async()=>{console.log("Updating atomic server configuration");const D=zi.fromSecret(h);r.setServerUrl(g),console.log("Server set.Setting agent"),r.setAgent(D)},y=async()=>{$()},k=({data:{msg:D,data:A}})=>{console.log(D,A)};let w;const $=async()=>{const D=await Ul(()=>import("./fetcher.worker-7e58969a.js"),[]);w=new D.default,w.onmessage=k;const A={msg:"fetcher",data:{url:m,postUrl:_,isWiki:d}};w.postMessage(A)},C=pi("http://localhost:9883/config/y3zx5wtm0bq"),L=Zl(C,mi.properties.name);Ge(l,L,D=>t(12,o=D));const I=Zl(C,"http://localhost:9883/property/role");Ge(l,I,D=>t(0,n=D));function N(D){g=D,t(5,g)}function E(D){h=D,t(6,h)}function O(D){m=D,t(3,m)}function Q(D){_=D,t(4,_)}function Z(D){d=D,t(2,d)}return l.$$.update=()=>{l.$$.dirty&4096&&console.log("Print name",o),l.$$.dirty&1&&console.log("Print roles",n)},[n,c,d,m,_,g,h,p,v,y,L,I,o,N,E,O,Q,Z]}class wr extends Pt{constructor(e){super(),Ut(this,e,kr,br,Ot,{})}}function kl(){return $t(vt)||typeof window<"u"&&window.__TAURI__!==void 0}class yr{constructor(){Vt(this,"baseUrl");Vt(this,"autocompleteIndexBuilt",!1);Vt(this,"sessionId");Vt(this,"currentRole","Default");Vt(this,"connectionRetries",0);Vt(this,"maxRetries",3);Vt(this,"retryDelay",1e3);Vt(this,"isConnecting",!1);this.baseUrl=typeof window<"u"?(window.location.protocol==="https:"?"https://":"http://")+window.location.hostname+":8001":"http://localhost:8001",this.sessionId=`novel-${Date.now()}`,typeof window<"u"&&!kl()&&this.shouldPerformHealthCheck()?this.detectServerPort():typeof window<"u"&&!kl()&&console.log("NovelAutocompleteService: Skipping server detection - not needed for current page")}setRole(e){this.currentRole=e,this.autocompleteIndexBuilt=!1}async detectServerPort(){if(kl())return;if(!this.shouldPerformHealthCheck()){console.log("NovelAutocompleteService: Skipping health check - service not needed");return}const t=[8001,3e3];for(const n of t)try{const o=typeof window<"u"?(window.location.protocol==="https:"?"https://":"http://")+window.location.hostname+":"+n:"http://localhost:"+n,r=await fetch(`${o}/message?sessionId=health-check`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:0,method:"ping",params:{}}),signal:AbortSignal.timeout(1e3)});if(r.ok||r.status===404){this.baseUrl=o,console.log(`NovelAutocompleteService: Detected server at ${o}`);return}}catch{continue}console.warn("NovelAutocompleteService: Could not detect running server, using default:",this.baseUrl)}shouldPerformHealthCheck(){return!(typeof window<"u"&&(!window.location.pathname.startsWith("/chat")||!(document.querySelector('[contenteditable="true"]')||document.querySelector("textarea")||document.querySelector('input[type="text"]'))))}async buildAutocompleteIndex(){if(this.isConnecting)return await new Promise(e=>setTimeout(e,1e3)),this.autocompleteIndexBuilt;this.isConnecting=!0;try{return kl()?(console.log("Using Tauri backend - no index building required"),this.autocompleteIndexBuilt=!0,this.connectionRetries=0,console.log("Tauri autocomplete ready"),!0):await this.buildMCPIndex()}catch(e){return console.error("Error building Novel autocomplete index:",e),!1}finally{this.isConnecting=!1}}async buildMCPIndex(){for(let e=0;e<=this.maxRetries;e++)try{const t=await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:Date.now(),method:"tools/call",params:{name:"build_autocomplete_index",arguments:{}}}),signal:AbortSignal.timeout(1e4)});if(t.ok){const n=await t.json();if(console.log(`MCP build index response (attempt ${e+1}):`,n),n.result&&!n.result.is_error)return this.autocompleteIndexBuilt=!0,this.connectionRetries=0,console.log("MCP autocomplete index built successfully"),!0}else if(t.status>=500&&e<this.maxRetries){console.warn(`MCP server error ${t.status}, retrying in ${this.retryDelay}ms...`),await new Promise(n=>setTimeout(n,this.retryDelay*(e+1)));continue}console.warn(`MCP build index failed (attempt ${e+1}):`,t.status,t.statusText)}catch(t){t instanceof Error&&t.name==="AbortError"?console.warn(`MCP request timeout (attempt ${e+1})`):console.warn(`MCP connection error (attempt ${e+1}):`,t),e<this.maxRetries&&await new Promise(n=>setTimeout(n,this.retryDelay*(e+1)))}return console.error("Failed to build MCP autocomplete index after all retries"),!1}async getCompletion(e){if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return{text:""};try{const t=this.extractLastWord(e.prompt);if(!t||t.length<1)return{text:""};const n=await this.getSuggestionsWithSnippets(t,5);if(n.length===0)return{text:""};let r=n[0].text;r.toLowerCase().startsWith(t.toLowerCase())&&(r=r.substring(t.length));const i=e.prompt.length/4,u=r.length/4;return{text:r,usage:{promptTokens:Math.round(i),completionTokens:Math.round(u),totalTokens:Math.round(i+u)}}}catch(t){return console.error("Error getting Novel autocomplete completion:",t),{text:""}}}async getSuggestions(e,t=10){if(!e||e.trim().length===0)return[];if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return console.warn("Autocomplete index not built, returning empty suggestions"),[];try{return kl()?await this.getTauriSuggestions(e,t):await this.getMCPSuggestions(e,t,"autocomplete_terms")}catch(n){return console.error("Error getting autocomplete suggestions:",n),[]}}async getTauriSuggestions(e,t){const n=await ze("get_autocomplete_suggestions",{query:e.trim(),role_name:this.currentRole,limit:t});return console.log("Tauri autocomplete response:",n),n&&n.status==="success"&&n.suggestions?n.suggestions.map(o=>({text:o.term||o.text||"",snippet:o.url||o.snippet||"",score:o.score||1})).filter(o=>o.text.length>0):(n&&n.error&&console.error("Tauri autocomplete error:",n.error),[])}async getMCPSuggestions(e,t,n){const o=Date.now(),r=await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:o,method:"tools/call",params:{name:n,arguments:{query:e.trim(),limit:t,role:this.currentRole}}}),signal:AbortSignal.timeout(5e3)});if(!r.ok)return console.error(`MCP ${n} request failed:`,r.status,r.statusText),[];const i=await r.json();return console.log(`MCP ${n} response:`,i),i.result&&!i.result.is_error&&i.result.content?n==="autocomplete_with_snippets"?this.parseAutocompleteWithSnippetsContent(i.result.content):this.parseAutocompleteContent(i.result.content):(i.error&&console.error(`MCP ${n} error:`,i.error),[])}async getSuggestionsWithSnippets(e,t=10){if(!e||e.trim().length===0)return[];if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return console.warn("Autocomplete index not built, returning empty suggestions with snippets"),[];try{return kl()?await this.getTauriSuggestions(e,t):await this.getMCPSuggestions(e,t,"autocomplete_with_snippets")}catch(n){return console.error("Error getting autocomplete suggestions with snippets:",n),[]}}extractLastWord(e){const t=e.trim().split(/\s+/);return t[t.length-1]||""}parseAutocompleteContent(e){const t=[];for(const n of e)if(n.type==="text"&&n.text){if(!n.text.startsWith("Found")&&!n.text.startsWith("‚Ä¢"))t.push({text:n.text.trim()});else if(n.text.startsWith("‚Ä¢")){const o=n.text.replace("‚Ä¢","").trim();o&&t.push({text:o})}}return t}parseAutocompleteWithSnippetsContent(e){const t=[];for(const n of e)if(n.type==="text"&&n.text){if(!n.text.startsWith("Found")&&!n.text.startsWith("‚Ä¢")){const o=n.text.split(" ‚Äî ");o.length===2?t.push({text:o[0].trim(),snippet:o[1].trim()}):t.push({text:n.text.trim()})}else if(n.text.startsWith("‚Ä¢")){const o=n.text.replace("‚Ä¢","").trim();o&&t.push({text:o})}}return t}isReady(){return this.autocompleteIndexBuilt}getStatus(){return{ready:this.autocompleteIndexBuilt,baseUrl:this.baseUrl,sessionId:this.sessionId,usingTauri:kl(),currentRole:this.currentRole,connectionRetries:this.connectionRetries,isConnecting:this.isConnecting}}async refreshIndex(){return this.autocompleteIndexBuilt=!1,this.connectionRetries=0,await this.buildAutocompleteIndex()}async testConnection(){try{if(kl()){const e=await ze("get_autocomplete_suggestions",{query:"test",role_name:this.currentRole,limit:1});return e&&(e.status==="success"||e.status==="error")}else return(await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:Date.now(),method:"tools/list",params:{}}),signal:AbortSignal.timeout(3e3)})).ok}catch(e){return console.warn("Connection test failed:",e),!1}}}const il=new yr;function Cr(l){var e;const{char:t,allowSpaces:n,allowToIncludeChar:o,allowedPrefixes:r,startOfLine:i,$position:u}=l,c=n&&!o,p=ji(t),d=new RegExp(`\\s${p}$`),m=i?"^":"",_=o?"":p,g=c?new RegExp(`${m}${p}.*?(?=\\s${_}|$)`,"gm"):new RegExp(`${m}(?:^)?${p}[^\\s${_}]*`,"gm"),h=((e=u.nodeBefore)===null||e===void 0?void 0:e.isText)&&u.nodeBefore.text;if(!h)return null;const v=u.pos-h.length,y=Array.from(h.matchAll(g)).pop();if(!y||y.input===void 0||y.index===void 0)return null;const k=y.input.slice(Math.max(0,y.index-1),y.index),w=new RegExp(`^[${r==null?void 0:r.join("")}\0]?$`).test(k);if(r!==null&&!w)return null;const $=v+y.index;let C=$+y[0].length;return c&&d.test(h.slice(C-1,C+1))&&(y[0]+=" ",C+=1),$<u.pos&&C>=u.pos?{range:{from:$,to:C},query:y[0].slice(t.length),text:y[0]}:null}const Sr=new di("suggestion");function Tr({pluginKey:l=Sr,editor:e,char:t="@",allowSpaces:n=!1,allowToIncludeChar:o=!1,allowedPrefixes:r=[" "],startOfLine:i=!1,decorationTag:u="span",decorationClass:c="suggestion",decorationContent:p="",decorationEmptyClass:d="is-empty",command:m=()=>null,items:_=()=>[],render:g=()=>({}),allow:h=()=>!0,findSuggestionMatch:v=Cr}){let y;const k=g==null?void 0:g(),w=new Mi({key:l,view(){return{update:async($,C)=>{var L,I,N,E,O,Q,Z;const D=(L=this.key)===null||L===void 0?void 0:L.getState(C),A=(I=this.key)===null||I===void 0?void 0:I.getState($.state),te=D.active&&A.active&&D.range.from!==A.range.from,q=!D.active&&A.active,ie=D.active&&!A.active,le=!q&&!ie&&D.query!==A.query,H=q||te&&le,j=le||te,P=ie||te&&le;if(!H&&!j&&!P)return;const R=P&&!H?D:A,z=$.dom.querySelector(`[data-decoration-id="${R.decorationId}"]`);y={editor:e,range:R.range,query:R.query,text:R.text,items:[],command:K=>m({editor:e,range:R.range,props:K}),decorationNode:z,clientRect:z?()=>{var K;const{decorationId:B}=(K=this.key)===null||K===void 0?void 0:K.getState(e.state),oe=$.dom.querySelector(`[data-decoration-id="${B}"]`);return(oe==null?void 0:oe.getBoundingClientRect())||null}:null},H&&((N=k==null?void 0:k.onBeforeStart)===null||N===void 0||N.call(k,y)),j&&((E=k==null?void 0:k.onBeforeUpdate)===null||E===void 0||E.call(k,y)),(j||H)&&(y.items=await _({editor:e,query:R.query})),P&&((O=k==null?void 0:k.onExit)===null||O===void 0||O.call(k,y)),j&&((Q=k==null?void 0:k.onUpdate)===null||Q===void 0||Q.call(k,y)),H&&((Z=k==null?void 0:k.onStart)===null||Z===void 0||Z.call(k,y))},destroy:()=>{var $;y&&(($=k==null?void 0:k.onExit)===null||$===void 0||$.call(k,y))}}},state:{init(){return{active:!1,range:{from:0,to:0},query:null,text:null,composing:!1}},apply($,C,L,I){const{isEditable:N}=e,{composing:E}=e.view,{selection:O}=$,{empty:Q,from:Z}=O,D={...C};if(D.composing=E,N&&(Q||e.view.composing)){(Z<C.range.from||Z>C.range.to)&&!E&&!C.composing&&(D.active=!1);const A=v({char:t,allowSpaces:n,allowToIncludeChar:o,allowedPrefixes:r,startOfLine:i,$position:O.$from}),te=`id_${Math.floor(Math.random()*4294967295)}`;A&&h({editor:e,state:I,range:A.range,isActive:C.active})?(D.active=!0,D.decorationId=C.decorationId?C.decorationId:te,D.range=A.range,D.query=A.query,D.text=A.text):D.active=!1}else D.active=!1;return D.active||(D.decorationId=null,D.range={from:0,to:0},D.query=null,D.text=null),D}},props:{handleKeyDown($,C){var L;const{active:I,range:N}=w.getState($.state);return I&&((L=k==null?void 0:k.onKeyDown)===null||L===void 0?void 0:L.call(k,{view:$,event:C,range:N}))||!1},decorations($){const{active:C,range:L,decorationId:I,query:N}=w.getState($);if(!C)return null;const E=!(N!=null&&N.length),O=[c];return E&&O.push(d),Pi.create($.doc,[Ui.inline(L.from,L.to,{nodeName:u,class:O.join(" "),"data-decoration-id":I,"data-decoration-content":p})])}}});return w}const An=Hi.create({name:"terraphimSuggestion",addOptions(){return{trigger:"++",pluginKey:new di("terraphimSuggestion"),allowSpaces:!1,limit:8,minLength:1,debounce:300}},addCommands(){return{insertSuggestion:l=>({commands:e,chain:t})=>t().insertContent(l.text).run()}},addProseMirrorPlugins(){const l={editor:this.editor,char:this.options.trigger,pluginKey:this.options.pluginKey,allowSpaces:this.options.allowSpaces,startOfLine:!1,command:({editor:e,range:t,props:n})=>{const o=n;e.chain().focus().insertContentAt(t,o.text+" ").run()},items:async({query:e,editor:t})=>new Promise(n=>{setTimeout(async()=>{if(e.length<this.options.minLength){n([]);return}try{const o=await il.getSuggestionsWithSnippets(e,this.options.limit);console.log(`TerraphimSuggestion: Found ${o.length} suggestions for "${e}"`),n(o)}catch(o){console.error("TerraphimSuggestion: Error getting suggestions:",o),n([])}},this.options.debounce)}),render:()=>{let e,t;return{onStart:n=>{e=new $r({items:n.items,command:n.command}),n.clientRect&&(t=Ki("body",{getReferenceClientRect:n.clientRect,appendTo:()=>document.body,content:e.element,showOnCreate:!0,interactive:!0,trigger:"manual",placement:"bottom-start",theme:"terraphim-suggestion",maxWidth:"none"})[0])},onUpdate(n){e==null||e.updateItems(n.items),n.clientRect&&(t==null||t.setProps({getReferenceClientRect:n.clientRect}))},onKeyDown(n){return n.event.key==="Escape"?(t==null||t.hide(),!0):(e==null?void 0:e.onKeyDown(n))??!1},onExit(){t==null||t.destroy(),e==null||e.destroy()}}}};return[Tr(l)]}});class $r{constructor(e){Vt(this,"element");Vt(this,"items",[]);Vt(this,"selectedIndex",0);Vt(this,"command");this.items=e.items,this.command=e.command,this.element=document.createElement("div"),this.element.className="terraphim-suggestion-dropdown",this.render()}updateItems(e){this.items=e,this.selectedIndex=0,this.render()}onKeyDown({event:e}){return e.key==="ArrowUp"?(this.selectPrevious(),!0):e.key==="ArrowDown"?(this.selectNext(),!0):e.key==="Enter"||e.key==="Tab"?(this.selectItem(this.selectedIndex),!0):!1}selectPrevious(){this.selectedIndex=Math.max(0,this.selectedIndex-1),this.render()}selectNext(){this.selectedIndex=Math.min(this.items.length-1,this.selectedIndex+1),this.render()}selectItem(e){const t=this.items[e];t&&this.command({id:t.text,...t})}render(){if(this.element.innerHTML="",this.items.length===0){this.element.innerHTML=`
        <div class="terraphim-suggestion-item terraphim-suggestion-empty">
          <div class="terraphim-suggestion-text">No suggestions found</div>
          <div class="terraphim-suggestion-hint">Try a different search term</div>
        </div>
      `;return}const e=document.createElement("div");e.className="terraphim-suggestion-header",e.innerHTML=`
      <div class="terraphim-suggestion-count">${this.items.length} suggestions</div>
      <div class="terraphim-suggestion-hint">‚Üë‚Üì Navigate ‚Ä¢ Tab/Enter Select ‚Ä¢ Esc Cancel</div>
    `,this.element.appendChild(e),this.items.forEach((t,n)=>{const o=document.createElement("div");o.className=`terraphim-suggestion-item ${n===this.selectedIndex?"terraphim-suggestion-selected":""}`,o.innerHTML=`
        <div class="terraphim-suggestion-main">
          <div class="terraphim-suggestion-text">${this.escapeHtml(t.text)}</div>
          ${t.snippet?`<div class="terraphim-suggestion-snippet">${this.escapeHtml(t.snippet)}</div>`:""}
        </div>
        ${t.score?`<div class="terraphim-suggestion-score">${Math.round(t.score*100)}%</div>`:""}
      `,o.addEventListener("click",()=>this.selectItem(n)),o.addEventListener("mouseenter",()=>{this.selectedIndex=n,this.render()}),this.element.appendChild(o)})}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}destroy(){this.element.remove()}}const Rr=`
.terraphim-suggestion-dropdown {
  background: white;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  box-shadow: 0 10px 38px -10px rgba(22, 23, 24, 0.35), 0 10px 20px -15px rgba(22, 23, 24, 0.2);
  max-height: 300px;
  min-width: 300px;
  overflow-y: auto;
  z-index: 1000;
}

.terraphim-suggestion-header {
  padding: 8px 12px;
  border-bottom: 1px solid #f1f5f9;
  background: #f8fafc;
  font-size: 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.terraphim-suggestion-count {
  font-weight: 600;
  color: #475569;
}

.terraphim-suggestion-hint {
  color: #64748b;
}

.terraphim-suggestion-item {
  padding: 8px 12px;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  border-bottom: 1px solid #f1f5f9;
}

.terraphim-suggestion-item:hover {
  background: #f8fafc;
}

.terraphim-suggestion-selected {
  background: #eff6ff !important;
  border-left: 3px solid #3b82f6;
}

.terraphim-suggestion-empty {
  color: #64748b;
  font-style: italic;
  text-align: center;
  cursor: default;
}

.terraphim-suggestion-main {
  flex: 1;
}

.terraphim-suggestion-text {
  font-weight: 500;
  color: #1e293b;
  margin-bottom: 2px;
}

.terraphim-suggestion-snippet {
  font-size: 12px;
  color: #64748b;
  line-height: 1.3;
}

.terraphim-suggestion-score {
  font-size: 11px;
  color: #10b981;
  font-weight: 600;
  background: #ecfdf5;
  padding: 2px 6px;
  border-radius: 4px;
  margin-left: 8px;
}

/* Dark theme support */
@media (prefers-color-scheme: dark) {
  .terraphim-suggestion-dropdown {
    background: #1e293b;
    border-color: #334155;
  }

  .terraphim-suggestion-header {
    background: #0f172a;
    border-color: #334155;
  }

  .terraphim-suggestion-item:hover {
    background: #334155;
  }

  .terraphim-suggestion-selected {
    background: #1e40af !important;
  }

  .terraphim-suggestion-text {
    color: #f1f5f9;
  }

  .terraphim-suggestion-snippet {
    color: #94a3b8;
  }
}

/* Tippy.js theme */
.tippy-box[data-theme~='terraphim-suggestion'] {
  background: transparent;
  box-shadow: none;
}

.tippy-box[data-theme~='terraphim-suggestion'] > .tippy-backdrop {
  background: transparent;
}

.tippy-box[data-theme~='terraphim-suggestion'] > .tippy-arrow {
  display: none;
}
`;function Dn(l){let e,t,n,o,r,i,u,c,p,d,m,_,g,h,v,y,k,w,$,C,L,I,N,E,O,Q,Z=l[12]?"Tauri (native)":`MCP Server (${il.getStatus().baseUrl})`,D,A,te,q,ie,le,H,j,P,R,z,K,B,oe,re,Se,V,ne,_e,G,U=l[6]!==1?"s":"",X,ce,ge,ue,pe,me,Ee,Je,Qe,$e,Ie,he,Ae,Ve,Be,Me,Re,et,ft=l[3]?"Enabled":"Disabled",tt,Ke,Ye,dt,Fe=l[11]&&!l[8]&&Nn(l);function ot(W,se){if(W[8])return Dr;if(W[11])return Ar}let Ze=ot(l),F=Ze&&Ze(l);return{c(){e=f("div"),t=f("div"),n=f("strong"),n.textContent="Local Autocomplete Status:",o=b(),r=f("div"),i=f("button"),u=M("Test"),p=b(),d=f("button"),d.textContent="Rebuild Index",m=b(),_=f("button"),g=M("Demo"),v=b(),y=f("div"),k=M(l[10]),w=b(),Fe&&Fe.c(),$=b(),C=f("div"),L=f("strong"),L.textContent="Configuration:",I=b(),N=f("br"),E=M("‚Ä¢ "),O=f("strong"),O.textContent="Backend:",Q=b(),D=M(Z),A=b(),te=f("br"),q=M("‚Ä¢ "),ie=f("strong"),ie.textContent="Role:",le=b(),H=M(l[9]),j=b(),P=f("br"),R=M("‚Ä¢ "),z=f("strong"),z.textContent="Trigger:",K=M(' "'),B=M(l[4]),oe=M(`" + text
      `),re=f("br"),Se=M("‚Ä¢ "),V=f("strong"),V.textContent="Min Length:",ne=b(),_e=M(l[6]),G=M(" character"),X=M(U),ce=b(),ge=f("br"),ue=M("‚Ä¢ "),pe=f("strong"),pe.textContent="Max Results:",me=b(),Ee=M(l[5]),Je=b(),Qe=f("br"),$e=M("‚Ä¢ "),Ie=f("strong"),Ie.textContent="Debounce:",he=b(),Ae=M(l[7]),Ve=M(`ms
      `),Be=f("br"),Me=M("‚Ä¢ "),Re=f("strong"),Re.textContent="Snippets:",et=b(),tt=M(ft),Ke=b(),F&&F.c(),Ce(n,"color","#495057"),Ce(i,"padding","4px 8px"),Ce(i,"background","#007bff"),Ce(i,"color","white"),Ce(i,"border","none"),Ce(i,"border-radius","4px"),Ce(i,"cursor","pointer"),Ce(i,"font-size","12px"),i.disabled=c=!l[8],Ce(d,"padding","4px 8px"),Ce(d,"background","#28a745"),Ce(d,"color","white"),Ce(d,"border","none"),Ce(d,"border-radius","4px"),Ce(d,"cursor","pointer"),Ce(d,"font-size","12px"),Ce(_,"padding","4px 8px"),Ce(_,"background","#ffc107"),Ce(_,"color","#212529"),Ce(_,"border","none"),Ce(_,"border-radius","4px"),Ce(_,"cursor","pointer"),Ce(_,"font-size","12px"),_.disabled=h=!l[8],Ce(r,"display","flex"),Ce(r,"gap","8px"),Ce(t,"display","flex"),Ce(t,"justify-content","space-between"),Ce(t,"align-items","center"),Ce(t,"margin-bottom","8px"),Ce(y,"font-size","13px"),Ce(y,"color","#6c757d"),Ce(y,"margin-bottom","8px"),Ce(y,"font-family","monospace"),Ce(C,"font-size","12px"),Ce(C,"color","#6c757d"),Ce(e,"margin-top","10px"),Ce(e,"padding","12px"),Ce(e,"background","#f8f9fa"),Ce(e,"border-radius","6px"),Ce(e,"border","1px solid #e9ecef")},m(W,se){T(W,e,se),s(e,t),s(t,n),s(t,o),s(t,r),s(r,i),s(i,u),s(r,p),s(r,d),s(r,m),s(r,_),s(_,g),s(e,v),s(e,y),s(y,k),s(e,w),Fe&&Fe.m(e,null),s(e,$),s(e,C),s(C,L),s(C,I),s(C,N),s(C,E),s(C,O),s(C,Q),s(C,D),s(C,A),s(C,te),s(C,q),s(C,ie),s(C,le),s(C,H),s(C,j),s(C,P),s(C,R),s(C,z),s(C,K),s(C,B),s(C,oe),s(C,re),s(C,Se),s(C,V),s(C,ne),s(C,_e),s(C,G),s(C,X),s(C,ce),s(C,ge),s(C,ue),s(C,pe),s(C,me),s(C,Ee),s(C,Je),s(C,Qe),s(C,$e),s(C,Ie),s(C,he),s(C,Ae),s(C,Ve),s(C,Be),s(C,Me),s(C,Re),s(C,et),s(C,tt),s(e,Ke),F&&F.m(e,null),Ye||(dt=[ee(i,"click",l[14]),ee(d,"click",l[15]),ee(_,"click",l[16])],Ye=!0)},p(W,se){se&256&&c!==(c=!W[8])&&(i.disabled=c),se&256&&h!==(h=!W[8])&&(_.disabled=h),se&1024&&ae(k,W[10]),W[11]&&!W[8]?Fe?Fe.p(W,se):(Fe=Nn(W),Fe.c(),Fe.m(e,$)):Fe&&(Fe.d(1),Fe=null),se&4096&&Z!==(Z=W[12]?"Tauri (native)":`MCP Server (${il.getStatus().baseUrl})`)&&ae(D,Z),se&512&&ae(H,W[9]),se&16&&ae(B,W[4]),se&64&&ae(_e,W[6]),se&64&&U!==(U=W[6]!==1?"s":"")&&ae(X,U),se&32&&ae(Ee,W[5]),se&128&&ae(Ae,W[7]),se&8&&ft!==(ft=W[3]?"Enabled":"Disabled")&&ae(tt,ft),Ze===(Ze=ot(W))&&F?F.p(W,se):(F&&F.d(1),F=Ze&&Ze(W),F&&(F.c(),F.m(e,null)))},d(W){W&&S(e),Fe&&Fe.d(),F&&F.d(),Ye=!1,lt(dt)}}}function Nn(l){let e,t,n,o;function r(c,p){return c[12]?Er:Lr}let i=r(l),u=i(l);return{c(){e=f("div"),t=f("strong"),t.textContent="‚ö†Ô∏è Autocomplete Not Available",n=f("br"),o=b(),u.c(),Ce(e,"font-size","12px"),Ce(e,"color","#dc3545"),Ce(e,"margin-bottom","8px"),Ce(e,"padding","6px"),Ce(e,"background","#f8d7da"),Ce(e,"border-radius","4px")},m(c,p){T(c,e,p),s(e,t),s(e,n),s(e,o),u.m(e,null)},p(c,p){i===(i=r(c))&&u?u.p(c,p):(u.d(1),u=i(c),u&&(u.c(),u.m(e,null)))},d(c){c&&S(e),u.d()}}}function Lr(l){let e,t=il.getStatus().baseUrl+"",n;return{c(){e=M("MCP server not responding. Ensure the server is running on "),n=M(t)},m(o,r){T(o,e,r),T(o,n,r)},p:Le,d(o){o&&S(e),o&&S(n)}}}function Er(l){let e;return{c(){e=M("Tauri backend connection failed. Ensure the application has proper permissions.")},m(t,n){T(t,e,n)},p:Le,d(t){t&&S(e)}}}function Ar(l){let e;return{c(){e=f("div"),e.innerHTML=`<strong>‚ùå Autocomplete Unavailable</strong> 
        <div style="font-size: 11px; margin-top: 4px; color: #721c24;">Click &quot;Rebuild Index&quot; to retry or check server/backend status.</div>`,Ce(e,"margin-top","8px"),Ce(e,"padding","8px"),Ce(e,"background","#f8d7da"),Ce(e,"border","1px solid #f5c6cb"),Ce(e,"border-radius","4px")},m(t,n){T(t,e,n)},p:Le,d(t){t&&S(e)}}}function Dr(l){let e,t,n,o,r,i,u,c,p,d,m,_,g,h,v,y,k;return{c(){e=f("div"),t=f("strong"),t.textContent="üéØ Autocomplete Active",n=b(),o=f("div"),r=M("Type "),i=f("code"),u=M(l[4]),c=M(" in the editor above to trigger suggestions."),p=f("br"),d=M(`
          Example: `),m=f("code"),_=M(l[4]),g=M("terraphim"),h=M(" or "),v=f("code"),y=M(l[4]),k=M("graph"),Ce(o,"font-size","11px"),Ce(o,"margin-top","4px"),Ce(o,"color","#0056b3"),Ce(e,"margin-top","8px"),Ce(e,"padding","8px"),Ce(e,"background","#d1edff"),Ce(e,"border","1px solid #b3d9ff"),Ce(e,"border-radius","4px")},m(w,$){T(w,e,$),s(e,t),s(e,n),s(e,o),s(o,r),s(o,i),s(i,u),s(o,c),s(o,p),s(o,d),s(o,m),s(m,_),s(m,g),s(o,h),s(o,v),s(v,y),s(v,k)},p(w,$){$&16&&ae(u,w[4]),$&16&&ae(_,w[4]),$&16&&ae(y,w[4])},d(w){w&&S(e)}}}function Nr(l){let e,t,n,o;e=new Gi({props:{defaultValue:l[0],isEditable:!l[1],disableLocalStorage:!0,onUpdate:l[13],extensions:[Tn,...l[2]?[An.configure({trigger:l[4],allowSpaces:!1,limit:l[5],minLength:l[6],debounce:l[7]})]:[]]}});let r=l[2]&&Dn(l);return{c(){be(e.$$.fragment),t=b(),r&&r.c(),n=Ct()},m(i,u){ke(e,i,u),T(i,t,u),r&&r.m(i,u),T(i,n,u),o=!0},p(i,[u]){const c={};u&1&&(c.defaultValue=i[0]),u&2&&(c.isEditable=!i[1]),u&244&&(c.extensions=[Tn,...i[2]?[An.configure({trigger:i[4],allowSpaces:!1,limit:i[5],minLength:i[6],debounce:i[7]})]:[]]),e.$set(c),i[2]?r?r.p(i,u):(r=Dn(i),r.c(),r.m(n.parentNode,n)):r&&(r.d(1),r=null)},i(i){o||(J(e.$$.fragment,i),o=!0)},o(i){x(e.$$.fragment,i),o=!1},d(i){we(e,i),i&&S(t),r&&r.d(i),i&&S(n)}}}function Ir(l,e,t){let n,o;Ge(l,Nt,E=>t(9,n=E)),Ge(l,vt,E=>t(12,o=E));let{html:r=""}=e,{readOnly:i=!1}=e,{outputFormat:u="html"}=e,{enableAutocomplete:c=!0}=e,{showSnippets:p=!0}=e,{suggestionTrigger:d="++"}=e,{maxSuggestions:m=8}=e,{minQueryLength:_=1}=e,{debounceDelay:g=300}=e,h=null,v="‚è≥ Initializing...",y=!1,k=!1,w=null;wl(async()=>{c&&await $(),typeof document<"u"&&(w=document.createElement("style"),w.textContent=Rr,document.head.appendChild(w))}),an(()=>{w&&w.parentNode&&w.parentNode.removeChild(w)});async function $(){t(10,v="‚è≥ Initializing autocomplete..."),t(8,y=!1),t(11,k=!1);try{il.setRole(n),t(10,v="üîó Testing connection...");const E=await il.testConnection();t(11,k=!0),E?(t(10,v="üî® Building autocomplete index..."),await il.buildAutocompleteIndex()?(o?t(10,v="‚úÖ Ready - Using Tauri backend"):t(10,v="‚úÖ Ready - Using MCP server backend"),t(8,y=!0)):t(10,v="‚ùå Failed to build autocomplete index")):o?t(10,v="‚ùå Tauri backend not available"):t(10,v="‚ùå MCP server not responding")}catch(E){console.error("Error initializing autocomplete:",E),t(10,v="‚ùå Autocomplete initialization error")}}const C=E=>{h=E,u==="markdown"?t(0,r=E.storage.markdown.getMarkdown()):t(0,r=E.getHTML())},L=async()=>{if(!k){alert("Please wait for connection test to complete");return}if(!y){alert("Autocomplete service not ready. Check the status above.");return}try{t(10,v="üß™ Testing autocomplete...");const E="terraphim",O=await il.getSuggestions(E,5);if(console.log("Autocomplete test results:",O),O.length>0){const Q=O.map((Z,D)=>`${D+1}. ${Z.text}${Z.snippet?` (${Z.snippet})`:""}`).join(`
`);alert(`‚úÖ Found ${O.length} suggestions for '${E}':

${Q}`),o?t(10,v="‚úÖ Ready - Using Tauri backend"):t(10,v="‚úÖ Ready - Using MCP server backend")}else alert(`‚ö†Ô∏è No suggestions found for '${E}'. This might be normal if the term isn't in your knowledge graph.`)}catch(E){console.error("Autocomplete test failed:",E),alert(`‚ùå Autocomplete test failed: ${E.message}`),t(10,v="‚ùå Test failed - check console for details")}},I=async()=>{t(10,v="‚è≥ Rebuilding index..."),t(8,y=!1);try{await il.refreshIndex()?(o?t(10,v="‚úÖ Ready - Tauri index rebuilt successfully"):t(10,v="‚úÖ Ready - MCP server index rebuilt successfully"),t(8,y=!0)):t(10,v="‚ùå Failed to rebuild index")}catch(E){console.error("Error rebuilding index:",E),t(10,v="‚ùå Index rebuild failed - check console for details")}},N=()=>{if(!h){alert("Editor not ready yet");return}const E=`# Terraphim Autocomplete Demo

This is a demonstration of the integrated Terraphim autocomplete system.

## How to Use:
1. Type "${d}" to trigger autocomplete
2. Start typing any term (e.g., "${d}terraphim", "${d}graph")
3. Use ‚Üë‚Üì arrows to navigate suggestions
4. Press Tab or Enter to select
5. Press Esc to cancel

## Try these queries:
- ${d}terraphim
- ${d}graph
- ${d}service
- ${d}automata
- ${d}role

The autocomplete system uses your local knowledge graph to provide intelligent suggestions based on your selected role: **${n}**.

---

Start typing below:`;h.commands.setContent(E),setTimeout(()=>{h.commands.focus("end")},100),alert(`Demo content inserted!

Type "${d}" followed by any term to see autocomplete suggestions.

Example: "${d}terraphim"`)};return l.$$set=E=>{"html"in E&&t(0,r=E.html),"readOnly"in E&&t(1,i=E.readOnly),"outputFormat"in E&&t(17,u=E.outputFormat),"enableAutocomplete"in E&&t(2,c=E.enableAutocomplete),"showSnippets"in E&&t(3,p=E.showSnippets),"suggestionTrigger"in E&&t(4,d=E.suggestionTrigger),"maxSuggestions"in E&&t(5,m=E.maxSuggestions),"minQueryLength"in E&&t(6,_=E.minQueryLength),"debounceDelay"in E&&t(7,g=E.debounceDelay)},l.$$.update=()=>{l.$$.dirty&772&&n&&c&&y&&(il.setRole(n),$())},[r,i,c,p,d,m,_,g,y,n,v,k,o,C,L,I,N,u]}class Or extends Pt{constructor(e){super(),Ut(this,e,Ir,Nr,Ot,{html:0,readOnly:1,outputFormat:17,enableAutocomplete:2,showSnippets:3,suggestionTrigger:4,maxSuggestions:5,minQueryLength:6,debounceDelay:7})}}function In(l){let e,t,n,o,r,i,u,c,p,d,m;return{c(){e=f("div"),t=f("h3"),n=f("span"),n.textContent="Knowledge Graph",o=M(`
          Term: `),r=f("strong"),i=M(l[2]),u=M(" | Rank: "),c=f("strong"),p=M(l[3]),d=b(),m=f("hr"),a(n,"class","tag is-info svelte-329px1"),a(t,"class","subtitle is-6 svelte-329px1"),a(m,"class","svelte-329px1"),a(e,"class","kg-context svelte-329px1")},m(_,g){T(_,e,g),s(e,t),s(t,n),s(t,o),s(t,r),s(r,i),s(t,u),s(t,c),s(c,p),s(e,d),s(e,m)},p(_,g){g&4&&ae(i,_[2]),g&8&&ae(p,_[3])},d(_){_&&S(e)}}}function Mr(l){let e,t,n,o,r,i,u,c;const p=[jr,Ur],d=[];function m(_,g){return _[5]?0:1}return t=m(l),n=d[t]=p[t](l),{c(){e=f("div"),n.c(),o=b(),r=f("div"),r.innerHTML='<span class="hint-text svelte-329px1">Double-click to edit ‚Ä¢ Ctrl+E to edit ‚Ä¢ Ctrl+S to save ‚Ä¢ Click KG links to explore</span>',a(r,"class","edit-hint svelte-329px1"),a(e,"class","content-viewer svelte-329px1"),a(e,"tabindex","0"),a(e,"role","button"),a(e,"aria-label","Double-click to edit article content")},m(_,g){T(_,e,g),d[t].m(e,null),s(e,o),s(e,r),l[20](e),i=!0,u||(c=[ee(e,"dblclick",l[14]),ee(e,"keydown",l[15]),ee(e,"click",l[13])],u=!0)},p(_,g){let h=t;t=m(_),t===h?d[t].p(_,g):(qe(),x(d[h],1,1,()=>{d[h]=null}),We(),n=d[t],n?n.p(_,g):(n=d[t]=p[t](_),n.c()),J(n,1),n.m(e,o))},i(_){i||(J(n),i=!0)},o(_){x(n),i=!1},d(_){_&&S(e),d[t].d(),l[20](null),u=!1,lt(c)}}}function Pr(l){let e,t,n,o,r,i,u,c,p,d;function m(g){l[18](g)}let _={outputFormat:l[11]};return l[1].body!==void 0&&(_.html=l[1].body),e=new Or({props:_}),mt.push(()=>bt(e,"html",m)),{c(){be(e.$$.fragment),n=b(),o=f("div"),r=f("button"),r.textContent="Save",i=b(),u=f("button"),u.textContent="Cancel",a(r,"class","button is-primary"),a(u,"class","button is-light"),a(o,"class","edit-controls svelte-329px1")},m(g,h){ke(e,g,h),T(g,n,h),T(g,o,h),s(o,r),s(o,i),s(o,u),c=!0,p||(d=[ee(r,"click",l[12]),ee(u,"click",l[19])],p=!0)},p(g,h){const v={};h&2048&&(v.outputFormat=g[11]),!t&&h&2&&(t=!0,v.html=g[1].body,kt(()=>t=!1)),e.$set(v)},i(g){c||(J(e.$$.fragment,g),c=!0)},o(g){x(e.$$.fragment,g),c=!1},d(g){we(e,g),g&&S(n),g&&S(o),p=!1,lt(d)}}}function Ur(l){let e,t,n;return t=new Fl({props:{source:l[1].body}}),{c(){e=f("div"),be(t.$$.fragment),a(e,"class","markdown-content svelte-329px1")},m(o,r){T(o,e,r),ke(t,e,null),n=!0},p(o,r){const i={};r&2&&(i.source=o[1].body),t.$set(i)},i(o){n||(J(t.$$.fragment,o),n=!0)},o(o){x(t.$$.fragment,o),n=!1},d(o){o&&S(e),we(t)}}}function jr(l){let e,t=l[1].body+"";return{c(){e=f("div"),a(e,"class","prose svelte-329px1")},m(n,o){T(n,e,o),e.innerHTML=t},p(n,o){o&2&&t!==(t=n[1].body+"")&&(e.innerHTML=t)},i:Le,o:Le,d(n){n&&S(e)}}}function Hr(l){let e,t,n,o,r,i=l[1].title+"",u,c,p,d,m,_,g,h=l[2]&&l[3]!==null&&In(l);const v=[Pr,Mr],y=[];function k(w,$){return w[4]?0:1}return p=k(l),d=y[p]=v[p](l),{c(){e=f("div"),t=f("button"),n=b(),h&&h.c(),o=b(),r=f("h2"),u=M(i),c=b(),d.c(),a(t,"class","delete is-large modal-close-btn svelte-329px1"),a(t,"aria-label","close"),a(r,"class","svelte-329px1"),a(e,"class","box wrapper svelte-329px1")},m(w,$){T(w,e,$),s(e,t),s(e,n),h&&h.m(e,null),s(e,o),s(e,r),s(r,u),s(e,c),y[p].m(e,null),m=!0,_||(g=ee(t,"click",l[17]),_=!0)},p(w,$){w[2]&&w[3]!==null?h?h.p(w,$):(h=In(w),h.c(),h.m(e,o)):h&&(h.d(1),h=null),(!m||$&2)&&i!==(i=w[1].title+"")&&ae(u,i);let C=p;p=k(w),p===C?y[p].p(w,$):(qe(),x(y[C],1,1,()=>{y[C]=null}),We(),d=y[p],d?d.p(w,$):(d=y[p]=v[p](w),d.c()),J(d,1),d.m(e,null))},i(w){m||(J(d),m=!0)},o(w){x(d),m=!1},d(w){w&&S(e),h&&h.d(),y[p].d(),_=!1,g()}}}function On(l){let e,t,n;function o(i){l[23](i)}let r={$$slots:{default:[Kr]},$$scope:{ctx:l}};return l[7]!==void 0&&(r.active=l[7]),e=new jl({props:r}),mt.push(()=>bt(e,"active",o)),{c(){be(e.$$.fragment)},m(i,u){ke(e,i,u),n=!0},p(i,u){const c={};u&536872832&&(c.$$scope={dirty:u,ctx:i}),!t&&u&128&&(t=!0,c.active=i[7],kt(()=>t=!1)),e.$set(c)},i(i){n||(J(e.$$.fragment,i),n=!0)},o(i){x(e.$$.fragment,i),n=!1},d(i){we(e,i)}}}function Mn(l){let e,t,n,o,r,i,u,c,p,d,m;return{c(){e=f("div"),t=f("h3"),n=f("span"),n.textContent="Knowledge Graph",o=M(`
            Term: `),r=f("strong"),i=M(l[9]),u=M(" | Rank: "),c=f("strong"),p=M(l[10]),d=b(),m=f("hr"),a(n,"class","tag is-info svelte-329px1"),a(t,"class","subtitle is-6 svelte-329px1"),a(m,"class","svelte-329px1"),a(e,"class","kg-context svelte-329px1")},m(_,g){T(_,e,g),s(e,t),s(t,n),s(t,o),s(t,r),s(r,i),s(t,u),s(t,c),s(c,p),s(e,d),s(e,m)},p(_,g){g&512&&ae(i,_[9]),g&1024&&ae(p,_[10])},d(_){_&&S(e)}}}function Fr(l){let e,t,n;return t=new Fl({props:{source:l[8].body}}),{c(){e=f("div"),be(t.$$.fragment),a(e,"class","markdown-content svelte-329px1")},m(o,r){T(o,e,r),ke(t,e,null),n=!0},p(o,r){const i={};r&256&&(i.source=o[8].body),t.$set(i)},i(o){n||(J(t.$$.fragment,o),n=!0)},o(o){x(t.$$.fragment,o),n=!1},d(o){o&&S(e),we(t)}}}function zr(l){let e,t=l[8].body+"";return{c(){e=f("div"),a(e,"class","prose svelte-329px1")},m(n,o){T(n,e,o),e.innerHTML=t},p(n,o){o&256&&t!==(t=n[8].body+"")&&(e.innerHTML=t)},i:Le,o:Le,d(n){n&&S(e)}}}function Kr(l){let e,t,n,o,r,i=l[8].title+"",u,c,p,d,m,_,g,h,v,y,k,w=l[9]&&l[10]!==null&&Mn(l);const $=[zr,Fr],C=[];function L(I,N){return N&256&&(d=null),d==null&&(d=!!(I[8].body&&(/<html/i.test(I[8].body)||/<body/i.test(I[8].body)||/<head/i.test(I[8].body)))),d?0:1}return m=L(l,-1),_=C[m]=$[m](l),{c(){e=f("div"),t=f("button"),n=b(),w&&w.c(),o=b(),r=f("h2"),u=M(i),c=b(),p=f("div"),_.c(),g=b(),h=f("div"),h.innerHTML='<span class="hint-text svelte-329px1">Knowledge Graph document ‚Ä¢ Click KG links to explore further</span>',a(t,"class","delete is-large modal-close-btn svelte-329px1"),a(t,"aria-label","close"),a(r,"class","svelte-329px1"),a(h,"class","edit-hint svelte-329px1"),a(p,"class","content-viewer svelte-329px1"),a(p,"tabindex","0"),a(p,"role","button"),a(p,"aria-label","KG document content - click KG links to explore further"),a(e,"class","box wrapper svelte-329px1")},m(I,N){T(I,e,N),s(e,t),s(e,n),w&&w.m(e,null),s(e,o),s(e,r),s(r,u),s(e,c),s(e,p),C[m].m(p,null),s(p,g),s(p,h),v=!0,y||(k=[ee(t,"click",l[22]),ee(p,"click",l[13])],y=!0)},p(I,N){I[9]&&I[10]!==null?w?w.p(I,N):(w=Mn(I),w.c(),w.m(e,o)):w&&(w.d(1),w=null),(!v||N&256)&&i!==(i=I[8].title+"")&&ae(u,i);let E=m;m=L(I,N),m===E?C[m].p(I,N):(qe(),x(C[E],1,1,()=>{C[E]=null}),We(),_=C[m],_?_.p(I,N):(_=C[m]=$[m](I),_.c()),J(_,1),_.m(p,g))},i(I){v||(J(_),v=!0)},o(I){x(_),v=!1},d(I){I&&S(e),w&&w.d(),C[m].d(),y=!1,lt(k)}}}function Gr(l){let e,t,n,o,r;function i(p){l[21](p)}let u={$$slots:{default:[Hr]},$$scope:{ctx:l}};l[0]!==void 0&&(u.active=l[0]),e=new jl({props:u}),mt.push(()=>bt(e,"active",i));let c=l[8]&&On(l);return{c(){be(e.$$.fragment),n=b(),c&&c.c(),o=Ct()},m(p,d){ke(e,p,d),T(p,n,d),c&&c.m(p,d),T(p,o,d),r=!0},p(p,[d]){const m={};d&536873087&&(m.$$scope={dirty:d,ctx:p}),!t&&d&1&&(t=!0,m.active=p[0],kt(()=>t=!1)),e.$set(m),p[8]?c?(c.p(p,d),d&256&&J(c,1)):(c=On(p),c.c(),J(c,1),c.m(o.parentNode,o)):c&&(qe(),x(c,1,1,()=>{c=null}),We())},i(p){r||(J(e.$$.fragment,p),J(c),r=!0)},o(p){x(e.$$.fragment,p),x(c),r=!1},d(p){we(e,p),p&&S(n),c&&c.d(p),p&&S(o)}}}function qr(l,e,t){let n,o,r,i;Ge(l,vt,q=>t(25,r=q)),Ge(l,Nt,q=>t(26,i=q));let{active:u=!1}=e,{item:c}=e,{initialEdit:p=!1}=e,{kgTerm:d=null}=e,{kgRank:m=null}=e,_=!1,g,h=!1,v=null,y=null,k=null;async function w(){if(r)try{const q=await ze("get_document",{documentId:c.id});q!=null&&q.document&&t(1,c=q.document)}catch(q){console.error("Failed to load document",q)}}async function $(){if(!r){t(4,_=!1);return}try{await ze("create_document",{document:c}),t(4,_=!1)}catch(q){console.error("Failed to save document",q)}}async function C(q){var ie,le,H,j,P;t(9,y=q),console.log("üîç KG Link Click Debug Info:"),console.log("  Term clicked:",q),console.log("  Current role:",i),console.log("  Is Tauri mode:",r);try{if(r){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:i,term:q});const R=await ze("find_documents_for_kg_term",{roleName:i,term:q});console.log("  üì• Tauri response received:"),console.log("    Status:",R.status),console.log("    Results count:",((ie=R.results)==null?void 0:ie.length)||0),console.log("    Total:",R.total||0),console.log("    Full response:",JSON.stringify(R,null,2)),R.status==="success"&&R.results&&R.results.length>0?(t(8,v=R.results[0]),t(10,k=v.rank||0),console.log("  ‚úÖ Found KG document:"),console.log("    Title:",v.title),console.log("    Rank:",k),console.log("    Body length:",((le=v.body)==null?void 0:le.length)||0,"characters"),t(7,h=!0)):(console.warn(`  ‚ö†Ô∏è  No KG documents found for term: "${q}" in role: "${i}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const R=at.ServerURL,z=encodeURIComponent(i),K=encodeURIComponent(q),B=`${R}/roles/${z}/kg_search?term=${K}`;console.log("  üì§ HTTP Request details:"),console.log("    Base URL:",R),console.log("    Role (encoded):",z),console.log("    Term (encoded):",K),console.log("    Full URL:",B);const oe=await fetch(B);if(console.log("  üì• HTTP Response received:"),console.log("    Status code:",oe.status),console.log("    Status text:",oe.statusText),console.log("    Headers:",Object.fromEntries(oe.headers.entries())),!oe.ok)throw new Error(`HTTP error! Status: ${oe.status} - ${oe.statusText}`);const re=await oe.json();console.log("  üìÑ Response data:"),console.log("    Status:",re.status),console.log("    Results count:",((H=re.results)==null?void 0:H.length)||0),console.log("    Total:",re.total||0),console.log("    Full response:",JSON.stringify(re,null,2)),re.status==="success"&&re.results&&re.results.length>0?(t(8,v=re.results[0]),t(10,k=v.rank||0),console.log("  ‚úÖ Found KG document:"),console.log("    Title:",v.title),console.log("    Rank:",k),console.log("    Body length:",((j=v.body)==null?void 0:j.length)||0,"characters"),t(7,h=!0)):(console.warn(`  ‚ö†Ô∏è  No KG documents found for term: "${q}" in role: "${i}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",B))}}catch(R){console.error("‚ùå Error fetching KG document:"),console.error("  Error type:",R.constructor.name),console.error("  Error message:",R.message||R),console.error("  Request details:",{term:q,role:i,isTauri:r,timestamp:new Date().toISOString()}),!r&&((P=R.message)!=null&&P.includes("Failed to fetch"))&&(console.error("  üí° Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{}}function L(q){const ie=q.target;if(ie.tagName==="A"){const le=ie.getAttribute("href");if(le&&le.startsWith("kg:")){q.preventDefault();const H=le.substring(3);C(H)}}}function I(){t(4,_=!0)}function N(q){q.type!=="dblclick"&&((q.ctrlKey||q.metaKey)&&q.key==="e"&&(q.preventDefault(),t(4,_=!0)),_&&(q.ctrlKey||q.metaKey)&&q.key==="s"&&(q.preventDefault(),$()),q.key==="Escape"&&(q.preventDefault(),_?t(4,_=!1):t(0,u=!1)))}const E=()=>t(0,u=!1);function O(q){l.$$.not_equal(c.body,q)&&(c.body=q,t(1,c))}const Q=()=>t(4,_=!1);function Z(q){mt[q?"unshift":"push"](()=>{g=q,t(6,g)})}function D(q){u=q,t(0,u)}const A=()=>t(7,h=!1);function te(q){h=q,t(7,h)}return l.$$set=q=>{"active"in q&&t(0,u=q.active),"item"in q&&t(1,c=q.item),"initialEdit"in q&&t(16,p=q.initialEdit),"kgTerm"in q&&t(2,d=q.kgTerm),"kgRank"in q&&t(3,m=q.kgRank)},l.$$.update=()=>{l.$$.dirty&65537&&u&&p&&t(4,_=!0),l.$$.dirty&19&&u&&c&&!_&&w(),l.$$.dirty&2&&t(5,n=c!=null&&c.body?/<html/i.test(c.body)||/<body/i.test(c.body)||/<head/i.test(c.body)||/^\s*<(!DOCTYPE|html|head|body|div|p|span)/i.test(c.body.trim()):!1),l.$$.dirty&32&&t(11,o=n?"html":"markdown")},[u,c,d,m,_,n,g,h,v,y,k,o,$,L,I,N,p,E,O,Q,Z,D,A,te]}class Xl extends Pt{constructor(e){super(),Ut(this,e,qr,Gr,Ot,{active:0,item:1,initialEdit:16,kgTerm:2,kgRank:3})}}function Pn(l,e,t){const n=l.slice();return n[33]=e[t],n}function Un(l,e,t){const n=l.slice();return n[36]=e[t],n}function jn(l,e,t){const n=l.slice();return n[39]=e[t],n}function Hn(l){let e,t;return e=new cn({props:{type:"is-success",$$slots:{default:[Wr]},$$scope:{ctx:l}}}),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},i(n){t||(J(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function Wr(l){let e,t,n;return{c(){e=f("p"),e.innerHTML="<strong>Success!</strong> Article saved to atomic server successfully.",t=b(),n=f("p"),n.textContent="The modal will close automatically..."},m(o,r){T(o,e,r),T(o,t,r),T(o,n,r)},p:Le,d(o){o&&S(e),o&&S(t),o&&S(n)}}}function Fn(l){let e,t;return e=new cn({props:{type:"is-danger",$$slots:{default:[Jr]},$$scope:{ctx:l}}}),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},p(n,o){const r={};o[0]&8|o[1]&2048&&(r.$$scope={dirty:o,ctx:n}),e.$set(r)},i(n){t||(J(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function Jr(l){let e,t,n,o;return{c(){e=f("p"),t=f("strong"),t.textContent="Error:",n=b(),o=M(l[3])},m(r,i){T(r,e,i),s(e,t),s(e,n),s(e,o)},p(r,i){i[0]&8&&ae(o,r[3])},d(r){r&&S(e)}}}function zn(l){var te,q,ie,le;let e,t,n,o,r,i=(((te=l[1])==null?void 0:te.title)||"Untitled")+"",u,c,p,d,m,_,g=(((q=l[1])==null?void 0:q.rank)||0)+"",h,v,y,k,w,$,C,L,I,N,E=((ie=l[1])==null?void 0:ie.description)&&Kn(l),O=((le=l[1])==null?void 0:le.tags)&&Gn(l);function Q(H,j){return H[10].length>0?Qr:Br}let Z=Q(l),D=Z(l),A=l[10].length>0&&Jn(l);return{c(){e=f("div"),t=f("label"),t.textContent="Document to Save",n=b(),o=f("div"),r=f("h5"),u=M(i),c=b(),E&&E.c(),p=b(),d=f("div"),m=f("span"),_=M("Rank: "),h=M(g),v=b(),O&&O.c(),y=b(),k=f("div"),w=f("label"),w.textContent="Atomic Server",$=b(),C=f("div"),D.c(),L=b(),A&&A.c(),I=Ct(),a(t,"class","label"),a(r,"class","title is-6"),a(m,"class","tag is-info svelte-48g63o"),a(d,"class","tags svelte-48g63o"),a(o,"class","box document-preview svelte-48g63o"),a(e,"class","field"),a(w,"class","label"),a(w,"for","atomic-server-select"),a(C,"class","control"),a(k,"class","field")},m(H,j){T(H,e,j),s(e,t),s(e,n),s(e,o),s(o,r),s(r,u),s(o,c),E&&E.m(o,null),s(o,p),s(o,d),s(d,m),s(m,_),s(m,h),s(d,v),O&&O.m(d,null),T(H,y,j),T(H,k,j),s(k,w),s(k,$),s(k,C),D.m(C,null),T(H,L,j),A&&A.m(H,j),T(H,I,j),N=!0},p(H,j){var P,R,z,K;(!N||j[0]&2)&&i!==(i=(((P=H[1])==null?void 0:P.title)||"Untitled")+"")&&ae(u,i),(R=H[1])!=null&&R.description?E?E.p(H,j):(E=Kn(H),E.c(),E.m(o,p)):E&&(E.d(1),E=null),(!N||j[0]&2)&&g!==(g=(((z=H[1])==null?void 0:z.rank)||0)+"")&&ae(h,g),(K=H[1])!=null&&K.tags?O?O.p(H,j):(O=Gn(H),O.c(),O.m(d,null)):O&&(O.d(1),O=null),Z===(Z=Q(H))&&D?D.p(H,j):(D.d(1),D=Z(H),D&&(D.c(),D.m(C,null))),H[10].length>0?A?(A.p(H,j),j[0]&1024&&J(A,1)):(A=Jn(H),A.c(),J(A,1),A.m(I.parentNode,I)):A&&(qe(),x(A,1,1,()=>{A=null}),We())},i(H){N||(J(A),N=!0)},o(H){x(A),N=!1},d(H){H&&S(e),E&&E.d(),O&&O.d(),H&&S(y),H&&S(k),D.d(),H&&S(L),A&&A.d(H),H&&S(I)}}}function Kn(l){let e,t=l[1].description+"",n;return{c(){e=f("p"),n=M(t),a(e,"class","content")},m(o,r){T(o,e,r),s(e,n)},p(o,r){r[0]&2&&t!==(t=o[1].description+"")&&ae(n,t)},d(o){o&&S(e)}}}function Gn(l){let e,t=l[1].tags,n=[];for(let o=0;o<t.length;o+=1)n[o]=qn(jn(l,t,o));return{c(){for(let o=0;o<n.length;o+=1)n[o].c();e=Ct()},m(o,r){for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(o,r);T(o,e,r)},p(o,r){if(r[0]&2){t=o[1].tags;let i;for(i=0;i<t.length;i+=1){const u=jn(o,t,i);n[i]?n[i].p(u,r):(n[i]=qn(u),n[i].c(),n[i].m(e.parentNode,e))}for(;i<n.length;i+=1)n[i].d(1);n.length=t.length}},d(o){_t(n,o),o&&S(e)}}}function qn(l){let e,t=l[39]+"",n;return{c(){e=f("span"),n=M(t),a(e,"class","tag svelte-48g63o")},m(o,r){T(o,e,r),s(e,n)},p(o,r){r[0]&2&&t!==(t=o[39]+"")&&ae(n,t)},d(o){o&&S(e)}}}function Br(l){let e,t,n,o,r,i,u,c,p;return{c(){e=f("div"),t=f("p"),t.innerHTML="<strong>No atomic servers available</strong>",n=b(),o=f("p"),r=M('Your current role "'),i=M(l[12]),u=M(`" doesn't have any writable atomic server configurations.`),c=b(),p=f("p"),p.textContent="Please configure an atomic server haystack in your role settings.",a(e,"class","notification is-warning")},m(d,m){T(d,e,m),s(e,t),s(e,n),s(e,o),s(o,r),s(o,i),s(o,u),s(e,c),s(e,p)},p(d,m){m[0]&4096&&ae(i,d[12])},d(d){d&&S(e)}}}function Qr(l){let e,t,n,o,r,i,u=l[10],c=[];for(let p=0;p<u.length;p+=1)c[p]=Wn(Un(l,u,p));return{c(){e=f("div"),t=f("select");for(let p=0;p<c.length;p+=1)c[p].c();n=b(),o=f("p"),o.textContent=`Select the atomic server from your current role configuration.
              üîê = Authenticated, ‚ö†Ô∏è = Anonymous access`,a(t,"id","atomic-server-select"),t.disabled=l[2],l[11]===void 0&&It(()=>l[18].call(t)),a(e,"class","select is-fullwidth"),a(o,"class","help svelte-48g63o")},m(p,d){T(p,e,d),s(e,t);for(let m=0;m<c.length;m+=1)c[m]&&c[m].m(t,null);nt(t,l[11],!0),T(p,n,d),T(p,o,d),r||(i=ee(t,"change",l[18]),r=!0)},p(p,d){if(d[0]&1024){u=p[10];let m;for(m=0;m<u.length;m+=1){const _=Un(p,u,m);c[m]?c[m].p(_,d):(c[m]=Wn(_),c[m].c(),c[m].m(t,null))}for(;m<c.length;m+=1)c[m].d(1);c.length=u.length}d[0]&4&&(t.disabled=p[2]),d[0]&3072&&nt(t,p[11])},d(p){p&&S(e),_t(c,p),p&&S(n),p&&S(o),r=!1,i()}}}function Vr(l){let e;return{c(){e=f("span"),e.textContent="‚ö†Ô∏è No Auth",a(e,"class","has-text-warning")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function Yr(l){let e;return{c(){e=f("span"),e.textContent="üîê",a(e,"class","has-text-success")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function Wn(l){let e,t=l[36].location+"",n,o,r,i;function u(d,m){return d[36].atomic_server_secret?Yr:Vr}let c=u(l),p=c(l);return{c(){e=f("option"),n=M(t),o=b(),p.c(),r=b(),e.__value=i=l[36].location,e.value=e.__value},m(d,m){T(d,e,m),s(e,n),s(e,o),p.m(e,null),s(e,r)},p(d,m){m[0]&1024&&t!==(t=d[36].location+"")&&ae(n,t),c!==(c=u(d))&&(p.d(1),p=c(d),p&&(p.c(),p.m(e,r))),m[0]&1024&&i!==(i=d[36].location)&&(e.__value=i,e.value=e.__value)},d(d){d&&S(e),p.d()}}}function Jn(l){var Ze,F;let e,t,n,o,r,i,u,c,p,d,m,_,g,h,v,y,k,w,$,C,L,I,N,E,O,Q,Z,D,A,te,q,ie,le,H,j,P,R,z,K,B,oe,re,Se,V=(l[8]||"Untitled")+"",ne,_e,G,U,X,ce=(((F=(Ze=l[1])==null?void 0:Ze.body)==null?void 0:F.length)||0)+"",ge,ue,pe,me,Ee,Je,Qe=l[14]()+"",$e,Ie,he,Ae,Ve,Be=l[15]()+"",Me,Re,et,ft,tt;function Ke(W){l[19](W)}let Ye={id:"article-title",placeholder:"Enter article title",disabled:l[2],required:!0};l[8]!==void 0&&(Ye.value=l[8]),r=new yl({props:Ye}),mt.push(()=>bt(r,"value",Ke));const dt=[Xr,Zr],Fe=[];function ot(W,se){return W[7]?1:0}return Q=ot(l),Z=Fe[Q]=dt[Q](l),q=new _l({props:{type:"is-primary",loading:l[2],disabled:l[2]||!l[8].trim()||!l[11],$$slots:{default:[xr]},$$scope:{ctx:l}}}),q.$on("click",l[16]),H=new _l({props:{type:"is-light",disabled:l[2],$$slots:{default:[ea]},$$scope:{ctx:l}}}),H.$on("click",l[17]),et=Ni(l[22][0]),{c(){e=f("div"),t=f("label"),t.textContent="Article Title",n=b(),o=f("div"),be(r.$$.fragment),u=b(),c=f("div"),p=f("label"),p.textContent="Description",d=b(),m=f("div"),_=f("textarea"),g=b(),h=f("div"),v=f("label"),v.textContent="Parent Collection",y=b(),k=f("div"),w=f("label"),$=f("input"),C=M(`
              Use predefined collection`),L=b(),I=f("label"),N=f("input"),E=M(`
              Custom parent URL/path`),O=b(),Z.c(),D=b(),A=f("div"),te=f("div"),be(q.$$.fragment),ie=b(),le=f("div"),be(H.$$.fragment),j=b(),P=f("div"),R=f("div"),z=f("p"),z.innerHTML="<strong>What will be saved:</strong>",K=b(),B=f("ul"),oe=f("li"),re=f("strong"),re.textContent="Title:",Se=b(),ne=M(V),_e=b(),G=f("li"),U=f("strong"),U.textContent="Body:",X=M(" Original document content ("),ge=M(ce),ue=M(" characters)"),pe=b(),me=f("li"),Ee=f("strong"),Ee.textContent="Parent:",Je=b(),$e=M(Qe),Ie=b(),he=f("li"),Ae=f("strong"),Ae.textContent="Subject URL:",Ve=b(),Me=M(Be),a(t,"class","label"),a(t,"for","article-title"),a(o,"class","control"),a(e,"class","field"),a(p,"class","label"),a(p,"for","article-description"),a(_,"id","article-description"),a(_,"class","textarea"),a(_,"placeholder","Brief description of the article"),_.disabled=l[2],a(_,"rows","3"),a(m,"class","control"),a(c,"class","field"),a(v,"class","label"),a($,"type","radio"),$.__value=!1,$.value=$.__value,$.disabled=l[2],a(w,"class","radio svelte-48g63o"),a(N,"type","radio"),N.__value=!0,N.value=N.__value,N.disabled=l[2],a(I,"class","radio svelte-48g63o"),a(k,"class","control"),a(h,"class","field"),a(te,"class","control"),a(le,"class","control"),a(A,"class","field is-grouped"),a(oe,"class","svelte-48g63o"),a(G,"class","svelte-48g63o"),a(me,"class","svelte-48g63o"),a(he,"class","svelte-48g63o"),a(B,"class","svelte-48g63o"),a(R,"class","notification is-info is-light svelte-48g63o"),a(P,"class","field"),et.p($,N)},m(W,se){T(W,e,se),s(e,t),s(e,n),s(e,o),ke(r,o,null),T(W,u,se),T(W,c,se),s(c,p),s(c,d),s(c,m),s(m,_),je(_,l[9]),T(W,g,se),T(W,h,se),s(h,v),s(h,y),s(h,k),s(k,w),s(w,$),$.checked=$.__value===l[7],s(w,C),s(k,L),s(k,I),s(I,N),N.checked=N.__value===l[7],s(I,E),T(W,O,se),Fe[Q].m(W,se),T(W,D,se),T(W,A,se),s(A,te),ke(q,te,null),s(A,ie),s(A,le),ke(H,le,null),T(W,j,se),T(W,P,se),s(P,R),s(R,z),s(R,K),s(R,B),s(B,oe),s(oe,re),s(oe,Se),s(oe,ne),s(B,_e),s(B,G),s(G,U),s(G,X),s(G,ge),s(G,ue),s(B,pe),s(B,me),s(me,Ee),s(me,Je),s(me,$e),s(B,Ie),s(B,he),s(he,Ae),s(he,Ve),s(he,Me),Re=!0,ft||(tt=[ee(_,"input",l[20]),ee($,"change",l[21]),ee(N,"change",l[23])],ft=!0)},p(W,se){var rt,xe;const Pe={};se[0]&4&&(Pe.disabled=W[2]),!i&&se[0]&256&&(i=!0,Pe.value=W[8],kt(()=>i=!1)),r.$set(Pe),(!Re||se[0]&4)&&(_.disabled=W[2]),se[0]&512&&je(_,W[9]),(!Re||se[0]&4)&&($.disabled=W[2]),se[0]&128&&($.checked=$.__value===W[7]),(!Re||se[0]&4)&&(N.disabled=W[2]),se[0]&128&&(N.checked=N.__value===W[7]);let Oe=Q;Q=ot(W),Q===Oe?Fe[Q].p(W,se):(qe(),x(Fe[Oe],1,1,()=>{Fe[Oe]=null}),We(),Z=Fe[Q],Z?Z.p(W,se):(Z=Fe[Q]=dt[Q](W),Z.c()),J(Z,1),Z.m(D.parentNode,D));const ye={};se[0]&4&&(ye.loading=W[2]),se[0]&2308&&(ye.disabled=W[2]||!W[8].trim()||!W[11]),se[1]&2048&&(ye.$$scope={dirty:se,ctx:W}),q.$set(ye);const st={};se[0]&4&&(st.disabled=W[2]),se[1]&2048&&(st.$$scope={dirty:se,ctx:W}),H.$set(st),(!Re||se[0]&256)&&V!==(V=(W[8]||"Untitled")+"")&&ae(ne,V),(!Re||se[0]&2)&&ce!==(ce=(((xe=(rt=W[1])==null?void 0:rt.body)==null?void 0:xe.length)||0)+"")&&ae(ge,ce)},i(W){Re||(J(r.$$.fragment,W),J(Z),J(q.$$.fragment,W),J(H.$$.fragment,W),Re=!0)},o(W){x(r.$$.fragment,W),x(Z),x(q.$$.fragment,W),x(H.$$.fragment,W),Re=!1},d(W){W&&S(e),we(r),W&&S(u),W&&S(c),W&&S(g),W&&S(h),W&&S(O),Fe[Q].d(W),W&&S(D),W&&S(A),we(q),we(H),W&&S(j),W&&S(P),et.r(),ft=!1,lt(tt)}}}function Zr(l){let e,t,n,o,r,i,u;function c(d){l[25](d)}let p={placeholder:"e.g., my-collection or http://server/custom-parent",disabled:l[2]};return l[6]!==void 0&&(p.value=l[6]),n=new yl({props:p}),mt.push(()=>bt(n,"value",c)),{c(){e=f("div"),t=f("div"),be(n.$$.fragment),r=b(),i=f("p"),i.textContent=`Enter a collection name (e.g., "my-articles") or full URL.
              If the collection doesn't exist, it will be created.`,a(t,"class","control"),a(i,"class","help svelte-48g63o"),a(e,"class","field")},m(d,m){T(d,e,m),s(e,t),ke(n,t,null),s(e,r),s(e,i),u=!0},p(d,m){const _={};m[0]&4&&(_.disabled=d[2]),!o&&m[0]&64&&(o=!0,_.value=d[6],kt(()=>o=!1)),n.$set(_)},i(d){u||(J(n.$$.fragment,d),u=!0)},o(d){x(n.$$.fragment,d),u=!1},d(d){d&&S(e),we(n)}}}function Xr(l){let e,t,n,o,r,i,u=l[13],c=[];for(let p=0;p<u.length;p+=1)c[p]=Bn(Pn(l,u,p));return{c(){e=f("div"),t=f("div"),n=f("div"),o=f("select");for(let p=0;p<c.length;p+=1)c[p].c();o.disabled=l[2],l[5]===void 0&&It(()=>l[24].call(o)),a(n,"class","select is-fullwidth"),a(t,"class","control"),a(e,"class","field")},m(p,d){T(p,e,d),s(e,t),s(t,n),s(n,o);for(let m=0;m<c.length;m+=1)c[m]&&c[m].m(o,null);nt(o,l[5],!0),r||(i=ee(o,"change",l[24]),r=!0)},p(p,d){if(d[0]&8192){u=p[13];let m;for(m=0;m<u.length;m+=1){const _=Pn(p,u,m);c[m]?c[m].p(_,d):(c[m]=Bn(_),c[m].c(),c[m].m(o,null))}for(;m<c.length;m+=1)c[m].d(1);c.length=u.length}d[0]&4&&(o.disabled=p[2]),d[0]&8224&&nt(o,p[5])},i:Le,o:Le,d(p){p&&S(e),_t(c,p),r=!1,i()}}}function Bn(l){let e,t=l[33].label+"",n;return{c(){e=f("option"),n=M(t),e.__value=l[33].value,e.value=e.__value},m(o,r){T(o,e,r),s(e,n)},p:Le,d(o){o&&S(e)}}}function xr(l){let e,t,n;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-cloud-upload-alt"></i>',t=b(),n=f("span"),n.textContent="Save to Atomic Server",a(e,"class","icon")},m(o,r){T(o,e,r),T(o,t,r),T(o,n,r)},p:Le,d(o){o&&S(e),o&&S(t),o&&S(n)}}}function ea(l){let e;return{c(){e=M("Cancel")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function ta(l){let e,t,n,o,r,i,u,c,p,d,m,_,g,h=l[4]&&Hn(l),v=l[3]&&Fn(l),y=!l[4]&&zn(l);return{c(){e=f("div"),t=f("div"),n=f("div"),n.innerHTML=`<div class="level-item"><h3 class="title is-4"><span class="icon"><i class="fas fa-save"></i></span>
            Save to Atomic Server</h3></div>`,o=b(),r=f("div"),i=f("div"),u=f("button"),c=b(),h&&h.c(),p=b(),v&&v.c(),d=b(),y&&y.c(),a(n,"class","level-left"),a(u,"class","delete is-large"),u.disabled=l[2],a(u,"aria-label","close"),a(i,"class","level-item"),a(r,"class","level-right"),a(t,"class","level svelte-48g63o"),a(e,"class","box")},m(k,w){T(k,e,w),s(e,t),s(t,n),s(t,o),s(t,r),s(r,i),s(i,u),s(e,c),h&&h.m(e,null),s(e,p),v&&v.m(e,null),s(e,d),y&&y.m(e,null),m=!0,_||(g=ee(u,"click",l[17]),_=!0)},p(k,w){(!m||w[0]&4)&&(u.disabled=k[2]),k[4]?h?w[0]&16&&J(h,1):(h=Hn(k),h.c(),J(h,1),h.m(e,p)):h&&(qe(),x(h,1,1,()=>{h=null}),We()),k[3]?v?(v.p(k,w),w[0]&8&&J(v,1)):(v=Fn(k),v.c(),J(v,1),v.m(e,d)):v&&(qe(),x(v,1,1,()=>{v=null}),We()),k[4]?y&&(qe(),x(y,1,1,()=>{y=null}),We()):y?(y.p(k,w),w[0]&16&&J(y,1)):(y=zn(k),y.c(),J(y,1),y.m(e,null))},i(k){m||(J(h),J(v),J(y),m=!0)},o(k){x(h),x(v),x(y),m=!1},d(k){k&&S(e),h&&h.d(),v&&v.d(),y&&y.d(),_=!1,g()}}}function la(l){let e,t,n;function o(i){l[26](i)}let r={$$slots:{default:[ta]},$$scope:{ctx:l}};return l[0]!==void 0&&(r.active=l[0]),e=new jl({props:r}),mt.push(()=>bt(e,"active",o)),e.$on("close",l[17]),{c(){be(e.$$.fragment)},m(i,u){ke(e,i,u),n=!0},p(i,u){const c={};u[0]&8190|u[1]&2048&&(c.$$scope={dirty:u,ctx:i}),!t&&u[0]&1&&(t=!0,c.active=i[0],kt(()=>t=!1)),e.$set(c)},i(i){n||(J(e.$$.fragment,i),n=!0)},o(i){x(e.$$.fragment,i),n=!1},d(i){we(e,i)}}}function na(l,e,t){let n,o,r;Ge(l,vt,P=>t(27,n=P)),Ge(l,Jt,P=>t(28,o=P)),Ge(l,Nt,P=>t(12,r=P));let{active:i=!1}=e,{document:u}=e,c=!1,p=null,d=!1,m="",_="",g=!1,h="",v="",y=[],k="";const w=[{label:"Root (Server Root)",value:""},{label:"Articles Collection",value:"articles"},{label:"Documents Collection",value:"documents"},{label:"Knowledge Base",value:"knowledge-base"},{label:"Research",value:"research"},{label:"Projects",value:"projects"}];function $(){t(2,c=!1),t(3,p=null),t(4,d=!1),t(5,m=""),t(6,_=""),t(7,g=!1),t(8,h=(u==null?void 0:u.title)||""),t(9,v=(u==null?void 0:u.description)||`Article saved from Terraphim search: ${u==null?void 0:u.title}`),t(10,y=[]),t(11,k="")}function C(){var K;const P=r,R=o;if(!(R!=null&&R.roles)||!P){console.warn("No role configuration found");return}let z=null;try{for(const[B,oe]of Object.entries(R.roles)){const re=oe,Se=typeof re.name=="object"?re.name.original:String(re.name);if(B===P||Se===P){z=re;break}}}catch(B){console.warn("Error checking role configuration:",B);return}if(!z){console.warn(`Role "${P}" not found in configuration`);return}t(10,y=((K=z.haystacks)==null?void 0:K.filter(B=>B.service==="Atomic"&&B.location&&!B.read_only))||[]),y.length>0&&t(11,k=y[0].location),console.log("Loaded atomic servers:",y)}function L(){const P=y.find(R=>R.location===k);return P==null?void 0:P.atomic_server_secret}function I(){const P=k.replace(/\/$/,"");if(g&&_.trim()){const R=_.trim();return R.startsWith("http://")||R.startsWith("https://")?R:`${P}/${R.replace(/^\//,"")}`}else return m?`${P}/${m}`:P}function N(){return h.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,50)}function E(){const P=k.replace(/\/$/,""),R=N(),z=Date.now();return`${P}/${R}-${z}`}async function O(){if(!k||!h.trim()){t(3,p="Please select an atomic server and provide a title");return}t(2,c=!0),t(3,p=null);try{const P=E(),R=I(),z=L();console.log("üîÑ Saving article to atomic server:",{subject:P,parent:R,server:k,hasSecret:!!z});const K={subject:P,title:h.trim(),description:v.trim(),body:u.body,parent:R,shortname:N(),original_id:u.id,original_url:u.url,original_rank:u.rank,tags:u.tags||[]};if(n)await ze("save_article_to_atomic",{article:K,serverUrl:k,atomicSecret:z});else{const B=await fetch(`${at.ServerURL}/atomic/save`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({article:K,server_url:k,atomic_secret:z})});if(!B.ok){const oe=await B.json().catch(()=>({error:B.statusText}));throw new Error(oe.error||`HTTP ${B.status}: ${B.statusText}`)}}t(4,d=!0),console.log("‚úÖ Article saved successfully to atomic server"),setTimeout(()=>{t(0,i=!1)},2e3)}catch(P){console.error("‚ùå Failed to save article to atomic server:",P),t(3,p=P.message||"Failed to save article to atomic server")}finally{t(2,c=!1)}}function Q(){c||t(0,i=!1)}const Z=[[]];function D(){k=Wt(this),t(11,k),t(10,y)}function A(P){h=P,t(8,h)}function te(){v=this.value,t(9,v)}function q(){g=this.__value,t(7,g)}function ie(){g=this.__value,t(7,g)}function le(){m=Wt(this),t(5,m),t(13,w)}function H(P){_=P,t(6,_)}function j(P){i=P,t(0,i)}return l.$$set=P=>{"active"in P&&t(0,i=P.active),"document"in P&&t(1,u=P.document)},l.$$.update=()=>{l.$$.dirty[0]&3&&i&&u&&($(),C())},[i,u,c,p,d,m,_,g,h,v,y,k,r,w,I,E,O,Q,D,A,te,q,Z,ie,le,H,j]}class oa extends Pt{constructor(e){super(),Ut(this,e,na,la,Ot,{active:0,document:1},null,[-1,-1])}}async function Rl(l){return ze("tauri",l)}async function sa(l,e){return Rl({__tauriModule:"Event",message:{cmd:"unlisten",event:l,eventId:e}})}async function ia(l,e,t){return Rl({__tauriModule:"Event",message:{cmd:"listen",event:l,windowLabel:e,handler:on(t)}}).then(n=>async()=>sa(l,n))}var Qn;(function(l){l.WINDOW_RESIZED="tauri://resize",l.WINDOW_MOVED="tauri://move",l.WINDOW_CLOSE_REQUESTED="tauri://close-requested",l.WINDOW_CREATED="tauri://window-created",l.WINDOW_DESTROYED="tauri://destroyed",l.WINDOW_FOCUS="tauri://focus",l.WINDOW_BLUR="tauri://blur",l.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",l.WINDOW_THEME_CHANGED="tauri://theme-changed",l.WINDOW_FILE_DROP="tauri://file-drop",l.WINDOW_FILE_DROP_HOVER="tauri://file-drop-hover",l.WINDOW_FILE_DROP_CANCELLED="tauri://file-drop-cancelled",l.MENU="tauri://menu",l.CHECK_UPDATE="tauri://update",l.UPDATE_AVAILABLE="tauri://update-available",l.INSTALL_UPDATE="tauri://update-install",l.STATUS_UPDATE="tauri://update-status",l.DOWNLOAD_PROGRESS="tauri://update-download-progress"})(Qn||(Qn={}));async function ra(l,e){return ia(l,null,e)}function Vn(l,e,t){const n=l.slice();return n[9]=e[t],n}function Yn(l){let e,t=l[9].name+"",n,o;return{c(){e=f("option"),n=M(t),e.__value=o=l[9].name,e.value=e.__value},m(r,i){T(r,e,i),s(e,n)},p(r,i){i&1&&t!==(t=r[9].name+"")&&ae(n,t),i&1&&o!==(o=r[9].name)&&(e.__value=o,e.value=e.__value)},d(r){r&&S(e)}}}function aa(l){let e,t,n,o,r,i,u=l[0],c=[];for(let p=0;p<u.length;p+=1)c[p]=Yn(Vn(l,u,p));return{c(){e=f("div"),t=f("div"),n=f("div"),o=f("select");for(let p=0;p<c.length;p+=1)c[p].c();a(n,"class","select"),a(t,"class","control"),a(e,"class","field is-grouped is-grouped-right")},m(p,d){T(p,e,d),s(e,t),s(t,n),s(n,o);for(let m=0;m<c.length;m+=1)c[m]&&c[m].m(o,null);nt(o,l[1]),r||(i=ee(o,"change",l[2]),r=!0)},p(p,[d]){if(d&1){u=p[0];let m;for(m=0;m<u.length;m+=1){const _=Vn(p,u,m);c[m]?c[m].p(_,d):(c[m]=Yn(_),c[m].c(),c[m].m(o,null))}for(;m<c.length;m+=1)c[m].d(1);c.length=u.length}d&3&&nt(o,p[1])},i:Le,o:Le,d(p){p&&S(e),_t(c,p),r=!1,i()}}}function ca(l,e,t){let n,o,r,i;Ge(l,Jt,_=>t(5,n=_)),Ge(l,vt,_=>t(6,o=_)),Ge(l,$n,_=>t(0,r=_)),Ge(l,Nt,_=>t(1,i=_));let u="";async function c(){try{vt.set(window.__TAURI__!==void 0),o?(console.log("Loading config from Tauri"),ze("get_config").then(_=>{console.log("get_config response",_),_&&_.status==="success"&&p(_.config)}).catch(_=>console.error("Error fetching config in Tauri:",_))):(console.log("Loading config from server"),u=`${at.ServerURL}/config/`,fetch(u).then(_=>_.json()).then(_=>{console.log("Config received",_),_&&_.status==="success"&&p(_.config)}).catch(_=>console.error("Error fetching config:",_)))}catch(_){console.error("Unhandled error in loadConfig:",_)}}function p(_){var y;console.log("Updating stores from config:",_);const g={default_role:_.selected_role,..._};Jt.set(g);const h=Object.entries(_.roles).map(([k,w])=>({name:k,...w}));$n.set(h),Nt.set(_.selected_role);const v=_.roles[_.selected_role];if(console.log("Selected role settings:",v),v){const k=v.theme||"spacelab";console.log("Setting theme to:",k),Pl.set(k),(y=v.kg)!=null&&y.publish?o?ze("publish_thesaurus",{roleName:_.selected_role}).then(w=>{console.log("publish_thesaurus response",w),Ml.set(w),Yt.set(!0)}).catch(w=>{console.error("Error publishing thesaurus:",w),Yt.set(!1)}):(console.log("Fetching thesaurus from HTTP endpoint for role",_.selected_role),fetch(`${at.ServerURL}/thesaurus/${encodeURIComponent(_.selected_role)}`).then(w=>w.json()).then(w=>{console.log("thesaurus HTTP response",w),w&&w.status==="success"&&w.thesaurus?(Ml.set(w.thesaurus),Yt.set(!0)):(console.error("Failed to fetch thesaurus:",w),Yt.set(!1))}).catch(w=>{console.error("Error fetching thesaurus:",w),Yt.set(!1)})):Yt.set(!1)}else console.warn("No role settings found for:",_.selected_role),Pl.set("spacelab")}typeof window<"u"&&window.__TAURI__&&ra("role_changed",_=>{console.log("Role changed event received from backend:",_.payload),p(_.payload)});async function d(){await c()}d(),console.log("Using Terraphim Server URL:",at.ServerURL);function m(_){var k,w;const h=_.currentTarget.value;console.log("Role change requested:",h),Nt.set(h);const v=r.find($=>$.name===h);if(!v){console.error(`No role settings found for role: ${h}.`);return}const y=v.theme||"spacelab";Pl.set(y),console.log(`Theme changed to ${y}`),Jt.update($=>($.selected_role=h,$)),o?(ze("select_role",{roleName:h}).catch($=>console.error("Error selecting role:",$)),(k=v.kg)!=null&&k.publish?(console.log("Publishing thesaurus for role",h),ze("publish_thesaurus",{roleName:h}).then($=>{Ml.set($),Yt.set(!0)})):Yt.set(!1)):(fetch(`${at.ServerURL}/config/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).catch($=>console.error("Error updating config on server:",$)),(w=v.kg)!=null&&w.publish?(console.log("Fetching thesaurus from HTTP endpoint for role",h),fetch(`${at.ServerURL}/thesaurus/${encodeURIComponent(h)}`).then($=>$.json()).then($=>{console.log("thesaurus HTTP response",$),$&&$.status==="success"&&$.thesaurus?(Ml.set($.thesaurus),Yt.set(!0)):(console.error("Failed to fetch thesaurus:",$),Yt.set(!1))}).catch($=>{console.error("Error fetching thesaurus:",$),Yt.set(!1)})):Yt.set(!1))}return[r,i,m,c]}class Vl extends Pt{constructor(e){super(),Ut(this,e,ca,aa,Ot,{loadConfig:3})}get loadConfig(){return this.$$.ctx[3]}}function Zn(l,e,t){const n=l.slice();return n[43]=e[t],n}function Xn(l,e,t){const n=l.slice();return n[46]=e[t],n}function xn(l){let e,t;return e=new un({props:{$$slots:{default:[fa]},$$scope:{ctx:l}}}),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},p(n,o){const r={};o[0]&129|o[1]&262144&&(r.$$scope={dirty:o,ctx:n}),e.$set(r)},i(n){t||(J(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function ua(l){let e=l[46]+"",t;return{c(){t=M(e)},m(n,o){T(n,t,o)},p(n,o){o[0]&1&&e!==(e=n[46]+"")&&ae(t,e)},d(n){n&&S(t)}}}function eo(l){let e,t,n,o,r,i;t=new gl({props:{rounded:!0,$$slots:{default:[ua]},$$scope:{ctx:l}}});function u(){return l[19](l[46])}return{c(){e=f("button"),be(t.$$.fragment),n=b(),a(e,"class","tag-button svelte-8px6jr"),e.disabled=l[7],a(e,"title","Click to view knowledge graph document")},m(c,p){T(c,e,p),ke(t,e,null),s(e,n),o=!0,r||(i=ee(e,"click",u),r=!0)},p(c,p){l=c;const d={};p[0]&1|p[1]&262144&&(d.$$scope={dirty:p,ctx:l}),t.$set(d),(!o||p[0]&128)&&(e.disabled=l[7])},i(c){o||(J(t.$$.fragment,c),o=!0)},o(c){x(t.$$.fragment,c),o=!1},d(c){c&&S(e),we(t),r=!1,i()}}}function fa(l){let e,t,n=l[0].tags,o=[];for(let i=0;i<n.length;i+=1)o[i]=eo(Xn(l,n,i));const r=i=>x(o[i],1,1,()=>{o[i]=null});return{c(){for(let i=0;i<o.length;i+=1)o[i].c();e=Ct()},m(i,u){for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(i,u);T(i,e,u),t=!0},p(i,u){if(u[0]&131201){n=i[0].tags;let c;for(c=0;c<n.length;c+=1){const p=Xn(i,n,c);o[c]?(o[c].p(p,u),J(o[c],1)):(o[c]=eo(p),o[c].c(),J(o[c],1),o[c].m(e.parentNode,e))}for(qe(),c=n.length;c<o.length;c+=1)r(c);We()}},i(i){if(!t){for(let u=0;u<n.length;u+=1)J(o[u]);t=!0}},o(i){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)x(o[u]);t=!1},d(i){_t(o,i),i&&S(e)}}}function da(l){let e,t=(l[0].rank||0)+"",n;return{c(){e=M("Rank "),n=M(t)},m(o,r){T(o,e,r),T(o,n,r)},p(o,r){r[0]&1&&t!==(t=(o[0].rank||0)+"")&&ae(n,t)},d(o){o&&S(e),o&&S(n)}}}function pa(l){let e,t;return e=new gl({props:{rounded:!0,$$slots:{default:[da]},$$scope:{ctx:l}}}),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},p(n,o){const r={};o[0]&1|o[1]&262144&&(r.$$scope={dirty:o,ctx:n}),e.$set(r)},i(n){t||(J(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function ma(l){let e;return{c(){e=f("small"),e.textContent="No description available",a(e,"class","no-description svelte-8px6jr")},m(t,n){T(t,e,n)},p:Le,i:Le,o:Le,d(t){t&&S(e)}}}function _a(l){let e,t;return e=new Fl({props:{source:l[0].description}}),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},p(n,o){const r={};o[0]&1&&(r.source=n[0].description),e.$set(r)},i(n){t||(J(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function to(l){let e,t,n,o,r,i;return{c(){e=f("button"),t=f("span"),t.innerHTML='<i class="fas fa-magic" aria-hidden="true"></i>',n=b(),o=f("span"),o.textContent="AI Summary",a(t,"class","icon is-small"),a(e,"class","button is-small is-info is-outlined ai-summary-button svelte-8px6jr"),e.disabled=l[9],a(e,"title","Generate AI-powered summary using OpenRouter")},m(u,c){T(u,e,c),s(e,t),s(e,n),s(e,o),r||(i=ee(e,"click",l[18]),r=!0)},p(u,c){c[0]&512&&(e.disabled=u[9])},d(u){u&&S(e),r=!1,i()}}}function lo(l){let e;return{c(){e=f("div"),e.innerHTML=`<span class="icon"><i class="fas fa-spinner fa-spin" aria-hidden="true"></i></span> 
                <small>Generating AI summary...</small>`,a(e,"class","ai-summary-loading svelte-8px6jr")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function no(l){let e,t,n,o,r,i,u,c,p,d;return{c(){e=f("div"),t=f("span"),t.innerHTML='<i class="fas fa-exclamation-triangle" aria-hidden="true"></i>',n=b(),o=f("small"),r=M("Summary error: "),i=M(l[10]),u=b(),c=f("button"),c.textContent="Retry",a(t,"class","icon has-text-danger"),a(o,"class","has-text-danger"),a(c,"class","button is-small is-text svelte-8px6jr"),a(c,"title","Retry generating summary"),a(e,"class","ai-summary-error svelte-8px6jr")},m(m,_){T(m,e,_),s(e,t),s(e,n),s(e,o),s(o,r),s(o,i),s(e,u),s(e,c),p||(d=ee(c,"click",l[20]),p=!0)},p(m,_){_[0]&1024&&ae(i,m[10])},d(m){m&&S(e),p=!1,d()}}}function oo(l){let e,t,n,o,r,i,u,c,p,d,m,_,g,h,v,y,k,w,$,C;function L(E,O){return E[12]?ha:ga}let I=L(l),N=I(l);return d=new Fl({props:{source:l[8]}}),{c(){e=f("div"),t=f("div"),n=f("small"),o=f("span"),o.innerHTML='<i class="fas fa-robot" aria-hidden="true"></i>',r=M(`
                    AI Summary
                    `),N.c(),i=b(),u=f("button"),u.innerHTML='<span class="icon is-small"><i class="fas fa-times" aria-hidden="true"></i></span>',c=b(),p=f("div"),be(d.$$.fragment),m=b(),_=f("div"),g=f("button"),h=f("span"),h.innerHTML='<i class="fas fa-redo" aria-hidden="true"></i>',v=b(),y=f("span"),y.textContent="Regenerate",a(o,"class","icon is-small"),a(n,"class","ai-summary-label svelte-8px6jr"),a(u,"class","button is-small is-text svelte-8px6jr"),a(u,"title","Hide AI summary"),a(t,"class","ai-summary-header svelte-8px6jr"),a(p,"class","ai-summary-content svelte-8px6jr"),a(h,"class","icon is-small"),a(g,"class","button is-small is-text svelte-8px6jr"),g.disabled=l[9],a(g,"title","Regenerate summary"),a(_,"class","ai-summary-actions svelte-8px6jr"),a(e,"class","ai-summary svelte-8px6jr")},m(E,O){T(E,e,O),s(e,t),s(t,n),s(n,o),s(n,r),N.m(n,null),s(t,i),s(t,u),s(e,c),s(e,p),ke(d,p,null),s(e,m),s(e,_),s(_,g),s(g,h),s(g,v),s(g,y),w=!0,$||(C=[ee(u,"click",l[21]),ee(g,"click",l[22])],$=!0)},p(E,O){I!==(I=L(E))&&(N.d(1),N=I(E),N&&(N.c(),N.m(n,null)));const Q={};O[0]&256&&(Q.source=E[8]),d.$set(Q),(!w||O[0]&512)&&(g.disabled=E[9])},i(E){w||(J(d.$$.fragment,E),It(()=>{w&&(k||(k=Dl(e,Nl,{},!0)),k.run(1))}),w=!0)},o(E){x(d.$$.fragment,E),k||(k=Dl(e,Nl,{},!1)),k.run(0),w=!1},d(E){E&&S(e),N.d(),we(d),E&&k&&k.end(),$=!1,lt(C)}}}function ga(l){let e;return{c(){e=f("span"),e.textContent="fresh",a(e,"class","tag is-small is-success")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function ha(l){let e;return{c(){e=f("span"),e.textContent="cached",a(e,"class","tag is-small is-light")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function so(l){let e;function t(r,i){return r[43].disabled?ka:r[43].isLink?ba:va}let n=t(l),o=n(l);return{c(){o.c(),e=Ct()},m(r,i){o.m(r,i),T(r,e,i)},p(r,i){n===(n=t(r))&&o?o.p(r,i):(o.d(1),o=n(r),o&&(o.c(),o.m(e.parentNode,e)))},d(r){o.d(r),r&&S(e)}}}function va(l){let e,t,n,o,r,i,u,c,p,d;return{c(){var m,_,g;e=f("button"),t=f("span"),n=f("i"),r=b(),a(n,"class",o=rl(l[43].icon)+" svelte-8px6jr"),a(t,"class","icon is-medium"),pt(t,"has-text-primary",(m=l[43].className)==null?void 0:m.includes("primary")),pt(t,"has-text-success",(_=l[43].className)==null?void 0:_.includes("success")),pt(t,"has-text-danger",(g=l[43].className)==null?void 0:g.includes("danger")),a(e,"type","button"),a(e,"class","level-item button is-ghost svelte-8px6jr"),a(e,"aria-label",i=l[43].title),a(e,"title",u=l[43].title),a(e,"data-testid",c=l[43].testId||"")},m(m,_){T(m,e,_),s(e,t),s(t,n),s(e,r),p||(d=ee(e,"click",function(){Hl(l[43].action)&&l[43].action.apply(this,arguments)}),p=!0)},p(m,_){var g,h,v;l=m,_[0]&32768&&o!==(o=rl(l[43].icon)+" svelte-8px6jr")&&a(n,"class",o),_[0]&32768&&pt(t,"has-text-primary",(g=l[43].className)==null?void 0:g.includes("primary")),_[0]&32768&&pt(t,"has-text-success",(h=l[43].className)==null?void 0:h.includes("success")),_[0]&32768&&pt(t,"has-text-danger",(v=l[43].className)==null?void 0:v.includes("danger")),_[0]&32768&&i!==(i=l[43].title)&&a(e,"aria-label",i),_[0]&32768&&u!==(u=l[43].title)&&a(e,"title",u),_[0]&32768&&c!==(c=l[43].testId||"")&&a(e,"data-testid",c)},d(m){m&&S(e),p=!1,d()}}}function ba(l){let e,t,n,o,r,i,u,c;return{c(){e=f("a"),t=f("span"),n=f("i"),r=b(),a(n,"class",o=rl(l[43].icon)+" svelte-8px6jr"),a(t,"class","icon is-medium"),pt(t,"has-text-primary",l[43].className),a(e,"href",i=l[43].href),a(e,"target","_blank"),a(e,"class","level-item"),a(e,"aria-label",u=l[43].title),a(e,"title",c=l[43].title)},m(p,d){T(p,e,d),s(e,t),s(t,n),s(e,r)},p(p,d){d[0]&32768&&o!==(o=rl(p[43].icon)+" svelte-8px6jr")&&a(n,"class",o),d[0]&32768&&pt(t,"has-text-primary",p[43].className),d[0]&32768&&i!==(i=p[43].href)&&a(e,"href",i),d[0]&32768&&u!==(u=p[43].title)&&a(e,"aria-label",u),d[0]&32768&&c!==(c=p[43].title)&&a(e,"title",c)},d(p){p&&S(e)}}}function ka(l){let e,t,n,o,r,i,u;return{c(){e=f("button"),t=f("span"),n=f("i"),r=b(),a(n,"class",o=rl(l[43].icon)+" svelte-8px6jr"),a(t,"class","icon is-medium"),pt(t,"has-text-primary",l[43].className),a(e,"type","button"),a(e,"class","level-item button is-ghost svelte-8px6jr"),a(e,"aria-label",i=l[43].title),a(e,"title",u=l[43].title),e.disabled=!0},m(c,p){T(c,e,p),s(e,t),s(t,n),s(e,r)},p(c,p){p[0]&32768&&o!==(o=rl(c[43].icon)+" svelte-8px6jr")&&a(n,"class",o),p[0]&32768&&pt(t,"has-text-primary",c[43].className),p[0]&32768&&i!==(i=c[43].title)&&a(e,"aria-label",i),p[0]&32768&&u!==(u=c[43].title)&&a(e,"title",u)},d(c){c&&S(e)}}}function io(l){let e,t=l[43].visible&&so(l);return{c(){t&&t.c(),e=Ct()},m(n,o){t&&t.m(n,o),T(n,e,o)},p(n,o){n[43].visible?t?t.p(n,o):(t=so(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(n){t&&t.d(n),n&&S(e)}}}function ro(l){let e,t,n,o,r,i;return{c(){e=f("div"),t=f("button"),n=b(),o=M(l[13]),a(t,"class","delete svelte-8px6jr"),a(e,"class","notification is-danger is-light mt-2")},m(u,c){T(u,e,c),s(e,t),s(e,n),s(e,o),r||(i=ee(t,"click",l[23]),r=!0)},p(u,c){c[0]&8192&&ae(o,u[13])},d(u){u&&S(e),r=!1,i()}}}function ao(l){let e,t,n;function o(i){l[25](i)}let r={item:l[4],kgTerm:l[5],kgRank:l[6]};return l[2]!==void 0&&(r.active=l[2]),e=new Xl({props:r}),mt.push(()=>bt(e,"active",o)),{c(){be(e.$$.fragment)},m(i,u){ke(e,i,u),n=!0},p(i,u){const c={};u[0]&16&&(c.item=i[4]),u[0]&32&&(c.kgTerm=i[5]),u[0]&64&&(c.kgRank=i[6]),!t&&u[0]&4&&(t=!0,c.active=i[2],kt(()=>t=!1)),e.$set(c)},i(i){n||(J(e.$$.fragment,i),n=!0)},o(i){x(e.$$.fragment,i),n=!1},d(i){we(e,i)}}}function co(l){let e,t,n;function o(i){l[26](i)}let r={document:l[0]};return l[3]!==void 0&&(r.active=l[3]),e=new oa({props:r}),mt.push(()=>bt(e,"active",o)),{c(){be(e.$$.fragment)},m(i,u){ke(e,i,u),n=!0},p(i,u){const c={};u[0]&1&&(c.document=i[0]),!t&&u[0]&8&&(t=!0,c.active=i[3],kt(()=>t=!1)),e.$set(c)},i(i){n||(J(e.$$.fragment,i),n=!0)},o(i){x(e.$$.fragment,i),n=!1},d(i){we(e,i)}}}function wa(l){let e,t,n,o,r,i,u,c,p,d,m,_,g=l[0].title+"",h,v,y,k,w,$,C,L,I,N,E,O,Q,Z,D,A,te,q,ie,le,H,j,P,R,z,K,B,oe,re,Se,V,ne=l[0].tags&&xn(l);c=new un({props:{$$slots:{default:[pa]},$$scope:{ctx:l}}});const _e=[_a,ma],G=[];function U(he,Ae){return he[0].description?0:1}C=U(l),L=G[C]=_e[C](l);let X=!l[11]&&!l[9]&&!l[10]&&to(l),ce=l[9]&&lo(),ge=l[10]&&no(l),ue=l[11]&&l[8]&&oo(l),pe=l[15],me=[];for(let he=0;he<pe.length;he+=1)me[he]=io(Zn(l,pe,he));let Ee=l[13]&&ro(l);function Je(he){l[24](he)}let Qe={item:l[0]};l[1]!==void 0&&(Qe.active=l[1]),R=new Xl({props:Qe}),mt.push(()=>bt(R,"active",Je));let $e=l[4]&&ao(l),Ie=l[14]&&co(l);return{c(){e=f("div"),t=f("article"),n=f("div"),o=f("div"),r=f("div"),ne&&ne.c(),i=b(),u=f("div"),be(c.$$.fragment),p=b(),d=f("div"),m=f("button"),_=f("h2"),h=M(g),v=b(),y=f("div"),k=f("small"),k.textContent="Description:",w=b(),$=f("div"),L.c(),I=b(),N=f("div"),X&&X.c(),E=b(),ce&&ce.c(),O=b(),ge&&ge.c(),Q=b(),ue&&ue.c(),Z=b(),D=f("br"),te=b(),q=f("div"),ie=f("nav"),le=f("div");for(let he=0;he<me.length;he+=1)me[he].c();j=b(),Ee&&Ee.c(),P=b(),be(R.$$.fragment),K=b(),$e&&$e.c(),B=b(),Ie&&Ie.c(),oe=Ct(),a(r,"class","level-right"),a(u,"class","level-right"),a(_,"class","title svelte-8px6jr"),a(m,"class","svelte-8px6jr"),a(k,"class","description-label svelte-8px6jr"),a($,"class","description-content svelte-8px6jr"),a(y,"class","description svelte-8px6jr"),a(N,"class","ai-summary-section svelte-8px6jr"),a(o,"class","content"),a(le,"class","level-right svelte-8px6jr"),a(ie,"class","level is-mobile svelte-8px6jr"),a(q,"class","level-right"),a(n,"class","media-content"),a(t,"class","media"),a(e,"class","box")},m(he,Ae){T(he,e,Ae),s(e,t),s(t,n),s(n,o),s(o,r),ne&&ne.m(r,null),s(o,i),s(o,u),ke(c,u,null),s(o,p),s(o,d),s(d,m),s(m,_),s(_,h),s(d,v),s(d,y),s(y,k),s(y,w),s(y,$),G[C].m($,null),s(d,I),s(d,N),X&&X.m(N,null),s(N,E),ce&&ce.m(N,null),s(N,O),ge&&ge.m(N,null),s(N,Q),ue&&ue.m(N,null),s(d,Z),s(d,D),s(n,te),s(n,q),s(q,ie),s(ie,le);for(let Ve=0;Ve<me.length;Ve+=1)me[Ve]&&me[Ve].m(le,null);s(e,j),Ee&&Ee.m(e,null),T(he,P,Ae),ke(R,he,Ae),T(he,K,Ae),$e&&$e.m(he,Ae),T(he,B,Ae),Ie&&Ie.m(he,Ae),T(he,oe,Ae),re=!0,Se||(V=ee(m,"click",l[16]),Se=!0)},p(he,Ae){he[0].tags?ne?(ne.p(he,Ae),Ae[0]&1&&J(ne,1)):(ne=xn(he),ne.c(),J(ne,1),ne.m(r,null)):ne&&(qe(),x(ne,1,1,()=>{ne=null}),We());const Ve={};Ae[0]&1|Ae[1]&262144&&(Ve.$$scope={dirty:Ae,ctx:he}),c.$set(Ve),(!re||Ae[0]&1)&&g!==(g=he[0].title+"")&&ae(h,g);let Be=C;if(C=U(he),C===Be?G[C].p(he,Ae):(qe(),x(G[Be],1,1,()=>{G[Be]=null}),We(),L=G[C],L?L.p(he,Ae):(L=G[C]=_e[C](he),L.c()),J(L,1),L.m($,null)),!he[11]&&!he[9]&&!he[10]?X?X.p(he,Ae):(X=to(he),X.c(),X.m(N,E)):X&&(X.d(1),X=null),he[9]?ce||(ce=lo(),ce.c(),ce.m(N,O)):ce&&(ce.d(1),ce=null),he[10]?ge?ge.p(he,Ae):(ge=no(he),ge.c(),ge.m(N,Q)):ge&&(ge.d(1),ge=null),he[11]&&he[8]?ue?(ue.p(he,Ae),Ae[0]&2304&&J(ue,1)):(ue=oo(he),ue.c(),J(ue,1),ue.m(N,null)):ue&&(qe(),x(ue,1,1,()=>{ue=null}),We()),Ae[0]&32768){pe=he[15];let Re;for(Re=0;Re<pe.length;Re+=1){const et=Zn(he,pe,Re);me[Re]?me[Re].p(et,Ae):(me[Re]=io(et),me[Re].c(),me[Re].m(le,null))}for(;Re<me.length;Re+=1)me[Re].d(1);me.length=pe.length}he[13]?Ee?Ee.p(he,Ae):(Ee=ro(he),Ee.c(),Ee.m(e,null)):Ee&&(Ee.d(1),Ee=null);const Me={};Ae[0]&1&&(Me.item=he[0]),!z&&Ae[0]&2&&(z=!0,Me.active=he[1],kt(()=>z=!1)),R.$set(Me),he[4]?$e?($e.p(he,Ae),Ae[0]&16&&J($e,1)):($e=ao(he),$e.c(),J($e,1),$e.m(B.parentNode,B)):$e&&(qe(),x($e,1,1,()=>{$e=null}),We()),he[14]?Ie?(Ie.p(he,Ae),Ae[0]&16384&&J(Ie,1)):(Ie=co(he),Ie.c(),J(Ie,1),Ie.m(oe.parentNode,oe)):Ie&&(qe(),x(Ie,1,1,()=>{Ie=null}),We())},i(he){re||(J(ne),J(c.$$.fragment,he),J(L),J(ue),It(()=>{re&&(A||(A=Dl(d,Nl,{},!0)),A.run(1))}),It(()=>{re&&(H||(H=Dl(ie,Nl,{},!0)),H.run(1))}),J(R.$$.fragment,he),J($e),J(Ie),re=!0)},o(he){x(ne),x(c.$$.fragment,he),x(L),x(ue),A||(A=Dl(d,Nl,{},!1)),A.run(0),H||(H=Dl(ie,Nl,{},!1)),H.run(0),x(R.$$.fragment,he),x($e),x(Ie),re=!1},d(he){he&&S(e),ne&&ne.d(),we(c),G[C].d(),X&&X.d(),ce&&ce.d(),ge&&ge.d(),ue&&ue.d(),he&&A&&A.end(),_t(me,he),he&&H&&H.end(),Ee&&Ee.d(),he&&S(P),we(R,he),he&&S(K),$e&&$e.d(he),he&&S(B),Ie&&Ie.d(he),he&&S(oe),Se=!1,V()}}}function ya(l,e,t){let n,o,r,i,u;Ge(l,Nt,V=>t(31,r=V)),Ge(l,vt,V=>t(32,i=V)),Ge(l,Jt,V=>t(33,u=V));let{document:c}=e,p=!1,d=!1,m=!1,_=null,g=null,h=null,v=!1,y=null,k=!1,w=null,$=!1,C=!1,L=!1,I=!1,N=null,E=!1,O=!1;function Q(){const V=[];return V.push({id:"download-markdown",label:"Download to Markdown",icon:"fas fa-download",action:()=>ie(),visible:!0,title:"Download document as markdown file"}),n&&V.push({id:"save-atomic",label:"Save to Atomic Server",icon:"fas fa-cloud-upload-alt",action:()=>A(),visible:!0,title:"Save article to Atomic Server",className:"has-text-primary"}),c.url&&V.push({id:"external-url",label:"Open URL",icon:"fas fa-link",action:()=>le(),visible:!0,title:"Open original URL in new tab"}),V.push({id:"add-context",label:I?"Added to Context ‚úì":L?"Adding...":"Add to Context",icon:I?"fas fa-check-circle":L?"fas fa-spinner fa-spin":"fas fa-plus-circle",action:()=>H(),visible:!0,title:I?"Document successfully added to chat context. Go to Chat tab to see it.":"Add document to LLM conversation context",disabled:L||I,className:I?"has-text-success":N?"has-text-danger":"",testId:"add-to-context-button"}),V.push({id:"chat-with-document",label:O?"Opening Chat...":E?"Adding to Chat...":"Chat with Document",icon:O?"fas fa-external-link-alt":E?"fas fa-spinner fa-spin":"fas fa-comment-dots",action:()=>j(),visible:!0,title:O?"Opening chat with this document":"Add document to context and open chat",disabled:E||O||L,className:O?"has-text-info":N?"has-text-danger":"has-text-primary",testId:"chat-with-document-button"}),V}function Z(){var U;const V=r,ne=u;if(!(ne!=null&&ne.roles)||!V)return!1;let _e=null;try{for(const[X,ce]of Object.entries(ne.roles)){const ge=ce,ue=typeof ge.name=="object"?ge.name.original:String(ge.name);if(X===V||ue===V){_e=ge;break}}}catch(X){return console.warn("Error checking role configuration:",X),!1}return _e?(((U=_e.haystacks)==null?void 0:U.filter(X=>X.service==="Atomic"&&X.location&&!X.read_only))||[]).length>0:!1}const D=()=>{t(1,p=!0)},A=()=>{console.log("üîÑ Opening atomic save modal for document:",c.title),t(3,m=!0)};async function te(V){var ne,_e,G,U,X;t(7,v=!0),t(5,g=V),console.log("üîç KG Search Debug Info:"),console.log("  Tag clicked:",V),console.log("  Current role:",r),console.log("  Is Tauri mode:",i);try{if(i){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:r,term:V});const ce=await ze("find_documents_for_kg_term",{roleName:r,term:V});console.log("  üì• Tauri response received:"),console.log("    Status:",ce.status),console.log("    Results count:",((ne=ce.results)==null?void 0:ne.length)||0),console.log("    Total:",ce.total||0),console.log("    Full response:",JSON.stringify(ce,null,2)),ce.status==="success"&&ce.results&&ce.results.length>0?(t(4,_=ce.results[0]),t(6,h=_.rank||0),console.log("  ‚úÖ Found KG document:"),console.log("    Title:",_.title),console.log("    Rank:",h),console.log("    Body length:",((_e=_.body)==null?void 0:_e.length)||0,"characters"),t(2,d=!0)):(console.warn(`  ‚ö†Ô∏è  No KG documents found for term: "${V}" in role: "${r}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const ce=at.ServerURL,ge=encodeURIComponent(r),ue=encodeURIComponent(V),pe=`${ce}/roles/${ge}/kg_search?term=${ue}`;console.log("  üì§ HTTP Request details:"),console.log("    Base URL:",ce),console.log("    Role (encoded):",ge),console.log("    Term (encoded):",ue),console.log("    Full URL:",pe);const me=await fetch(pe);if(console.log("  üì• HTTP Response received:"),console.log("    Status code:",me.status),console.log("    Status text:",me.statusText),console.log("    Headers:",Object.fromEntries(me.headers.entries())),!me.ok)throw new Error(`HTTP error! Status: ${me.status} - ${me.statusText}`);const Ee=await me.json();console.log("  üìÑ Response data:"),console.log("    Status:",Ee.status),console.log("    Results count:",((G=Ee.results)==null?void 0:G.length)||0),console.log("    Total:",Ee.total||0),console.log("    Full response:",JSON.stringify(Ee,null,2)),Ee.status==="success"&&Ee.results&&Ee.results.length>0?(t(4,_=Ee.results[0]),t(6,h=_.rank||0),console.log("  ‚úÖ Found KG document:"),console.log("    Title:",_.title),console.log("    Rank:",h),console.log("    Body length:",((U=_.body)==null?void 0:U.length)||0,"characters"),t(2,d=!0)):(console.warn(`  ‚ö†Ô∏è  No KG documents found for term: "${V}" in role: "${r}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",pe))}}catch(ce){console.error("‚ùå Error fetching KG document:"),console.error("  Error type:",ce.constructor.name),console.error("  Error message:",ce.message||ce),console.error("  Request details:",{tag:V,role:r,isTauri:i,timestamp:new Date().toISOString()}),!i&&((X=ce.message)!=null&&X.includes("Failed to fetch"))&&(console.error("  üí° Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{t(7,v=!1)}}async function q(){var V;if(!(k||!c.id||!r)){t(9,k=!0),t(10,w=null),console.log("ü§ñ AI Summary Debug Info:"),console.log("  Document ID:",c.id),console.log("  Current role:",r),console.log("  Is Tauri mode:",i);try{const ne={document_id:c.id,role:r,max_length:250,force_regenerate:!1};console.log("  üì§ Summarization request:",ne);let _e;if(i){const X=`${at.ServerURL}/documents/summarize`;_e=await fetch(X,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ne)})}else{const X=`${at.ServerURL}/documents/summarize`;_e=await fetch(X,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ne)})}if(console.log("  üì• Summary response received:"),console.log("    Status code:",_e.status),console.log("    Status text:",_e.statusText),!_e.ok)throw new Error(`HTTP error! Status: ${_e.status} - ${_e.statusText}`);const G=await _e.json();console.log("  üìÑ Summary response data:",G),G.status==="success"&&G.summary?(t(8,y=G.summary),t(12,C=G.from_cache||!1),t(11,$=!0),console.log("  ‚úÖ Summary generated successfully"),console.log("    Summary length:",y.length,"characters"),console.log("    From cache:",C),console.log("    Model used:",G.model_used)):(t(10,w=G.error||"Failed to generate summary"),console.error("  ‚ùå Summary generation failed:",w))}catch(ne){console.error("‚ùå Error generating summary:"),console.error("  Error type:",ne.constructor.name),console.error("  Error message:",ne.message||ne),console.error("  Request details:",{document_id:c.id,role:r,isTauri:i,timestamp:new Date().toISOString()}),t(10,w=ne.message||"Network error occurred"),(V=ne.message)!=null&&V.includes("Failed to fetch")&&(console.error("  üí° Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Verify OpenRouter is enabled for this role"),console.error("    3. Check OPENROUTER_KEY environment variable"),console.error("    4. Verify server URL in CONFIG.ServerURL"))}finally{t(9,k=!1)}}}async function ie(){var _e;console.log("üì• Downloading document as markdown:",c.title),console.log("üìÑ Document data:",{title:c.title,bodyLength:(_e=c.body)==null?void 0:_e.length,tags:c.tags}),console.log("üñ•Ô∏è Environment check - is_tauri:",i);let V=`# ${c.title}

`;V+=`**Source:** Terraphim Search
`,V+=`**Rank:** ${c.rank||"N/A"}
`,c.url&&(V+=`**URL:** ${c.url}
`),c.tags&&c.tags.length>0&&(V+=`**Tags:** ${c.tags.join(", ")}
`),V+=`**Downloaded:** ${new Date().toISOString()}

`,c.description&&(V+=`## Description

${c.description}

`),V+=`## Content

${c.body}
`;const ne=`${c.title.replace(/[^a-z0-9]/gi,"_").toLowerCase()}_${Date.now()}.md`;try{if(i){const{save:G}=await Ul(()=>Promise.resolve().then(()=>gi),void 0),{writeTextFile:U}=await Ul(()=>import("./fs-fccecd10.js"),["assets/fs-fccecd10.js","assets/vendor-ui-ec1c326c.js","assets/vendor-ui-5061ae11.css","assets/vendor-utils-8620e3e4.js","assets/vendor-editor-5741781d.js","assets/vendor-editor-461b9769.css","assets/vendor-atomic-ec100559.js","assets/novel-editor-ff46bbca.js","assets/novel-editor-62d29ffc.css","assets/vendor-charts-e6a4a6c9.js"]);console.log("üíæ Using Tauri save dialog...");const X=await G({filters:[{name:"Markdown",extensions:["md"]}],defaultPath:ne});X?(await U(X,V),console.log("‚úÖ File saved via Tauri:",X)):console.log("‚ùå Save dialog cancelled")}else{console.log("üåê Using browser download fallback...");const G=new Blob([V],{type:"text/markdown;charset=utf-8"}),U=URL.createObjectURL(G),X=c.createElement("a");X.href=U,X.download=ne,c.body.appendChild(X),X.click(),c.body.removeChild(X),URL.revokeObjectURL(U),console.log("‚úÖ File downloaded via browser:",ne)}}catch(G){console.error("‚ùå Download failed:",G),console.log("üîÑ Falling back to browser download...");const U=new Blob([V],{type:"text/markdown;charset=utf-8"}),X=URL.createObjectURL(U),ce=c.createElement("a");ce.href=X,ce.download=ne,c.body.appendChild(ce),ce.click(),c.body.removeChild(ce),URL.revokeObjectURL(X),console.log("‚úÖ Fallback download completed:",ne)}}function le(){console.log("üîÑ Opening URL in new tab and article modal..."),c.url&&(console.log("üîó Opening URL in new tab:",c.url),window.open(c.url,"_blank")),setTimeout(()=>{console.log("üìñ Opening article modal..."),D()},100)}async function H(){console.log("üìù Adding document to LLM context:",c.title),L=!0,I=!1,t(13,N=null);try{let V=null;if(i){try{const U=await ze("list_conversations");if(console.log("üìã Available conversations:",U),U!=null&&U.conversations&&U.conversations.length>0)V=U.conversations[0].id,console.log("üéØ Using existing conversation:",V);else{const X=await ze("create_conversation",{title:"Search Context",role:r||"default"});if(X.status==="success"&&X.conversation_id)V=X.conversation_id,console.log("üÜï Created new conversation:",V);else throw new Error("Failed to create conversation: "+(X.error||"Unknown error"))}}catch(U){throw console.error("‚ùå Failed to manage conversations:",U),new Error("Could not create or find conversation: "+U.message)}const _e={source_type:"document",document_id:c.id};c.url&&(_e.url=c.url),c.tags&&c.tags.length>0&&(_e.tags=c.tags.join(", ")),c.rank!==void 0&&(_e.rank=c.rank.toString());const G=await ze("add_context_to_conversation",{conversationId:V,contextType:"document",title:c.title,content:c.body,metadata:_e});console.log("‚úÖ Document added to context via Tauri:",G)}else{const _e=at.ServerURL;try{const ce=await fetch(`${_e}/conversations`);if(ce.ok){const ge=await ce.json();if(ge.conversations&&ge.conversations.length>0)V=ge.conversations[0].id,console.log("üéØ Using existing conversation:",V);else{const ue=await fetch(`${_e}/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"Search Context",role:r||"default"})});if(ue.ok){const pe=await ue.json();if(pe.status==="success"&&pe.conversation_id)V=pe.conversation_id,console.log("üÜï Created new conversation:",V);else throw new Error("Failed to create conversation: "+(pe.error||"Unknown error"))}else throw new Error(`Failed to create conversation: ${ue.status} ${ue.statusText}`)}}else throw new Error(`Failed to list conversations: ${ce.status} ${ce.statusText}`)}catch(ce){throw console.error("‚ùå Failed to manage conversations:",ce),new Error("Could not create or find conversation: "+ce.message)}const G=`${_e}/conversations/${V}/context`,U=await fetch(G,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context_type:"document",title:c.title,content:c.body,metadata:{source_type:"document",document_id:c.id,url:c.url||"",tags:c.tags?c.tags.join(", "):"",rank:c.rank?c.rank.toString():"0"}})});if(!U.ok)throw new Error(`HTTP error! Status: ${U.status} - ${U.statusText}`);const X=await U.json();console.log("‚úÖ Document added to context via HTTP:",X)}console.log("‚úÖ Successfully added document to LLM context"),I=!0;const ne=window.document.createElement("div");ne.className="notification is-success is-light",ne.innerHTML=`
        <button class="delete" onclick="this.parentElement.remove()"></button>
        <strong>‚úì Added to Chat Context</strong><br>
        <small>Document added successfully. <a href="/chat" class="has-text-success has-text-weight-bold">Go to Chat ‚Üí</a> to see it in the context panel.</small>
      `,ne.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(ne),setTimeout(()=>{ne.remove()},8e3),setTimeout(()=>{I=!1},5e3)}catch(V){console.error("‚ùå Error adding document to context:",V),t(13,N=V.message||"Failed to add document to context");const ne=window.document.createElement("div");ne.className="notification is-danger is-light",ne.innerHTML=`
        <button class="delete" onclick="this.parentElement.remove()"></button>
        <strong>‚úó Failed to Add Context</strong><br>
        <small>${N}</small>
      `,ne.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(ne),setTimeout(()=>{ne.remove()},8e3),setTimeout(()=>{t(13,N=null)},5e3)}finally{L=!1}}async function j(){console.log("üí¨ Adding document to context and opening chat:",c.title),E=!0,O=!1,t(13,N=null);try{let V=null;if(i){try{const U=await ze("list_conversations");if(console.log("üìã Available conversations:",U),U!=null&&U.conversations&&U.conversations.length>0)V=U.conversations[0].id,console.log("üéØ Using existing conversation:",V);else{const X=await ze("create_conversation",{title:"Chat with Documents",role:r||"default"});if(X.status==="success"&&X.conversation_id)V=X.conversation_id,console.log("üÜï Created new conversation:",V);else throw new Error("Failed to create conversation: "+(X.error||"Unknown error"))}}catch(U){throw console.error("‚ùå Failed to manage conversations:",U),new Error("Could not create or find conversation: "+U.message)}const _e={source_type:"document",document_id:c.id};c.url&&(_e.url=c.url),c.tags&&c.tags.length>0&&(_e.tags=c.tags.join(", ")),c.rank!==void 0&&(_e.rank=c.rank.toString());const G=await ze("add_context_to_conversation",{conversationId:V,contextType:"document",title:c.title,content:c.body,metadata:_e});console.log("‚úÖ Document added to context via Tauri:",G)}else{const _e=at.ServerURL;try{const ce=await fetch(`${_e}/conversations`);if(ce.ok){const ge=await ce.json();if(ge.conversations&&ge.conversations.length>0)V=ge.conversations[0].id,console.log("üéØ Using existing conversation:",V);else{const ue=await fetch(`${_e}/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"Chat with Documents",role:r||"default"})});if(ue.ok){const pe=await ue.json();if(pe.status==="success"&&pe.conversation_id)V=pe.conversation_id,console.log("üÜï Created new conversation:",V);else throw new Error("Failed to create conversation: "+(pe.error||"Unknown error"))}else throw new Error(`Failed to create conversation: ${ue.status} ${ue.statusText}`)}}else throw new Error(`Failed to list conversations: ${ce.status} ${ce.statusText}`)}catch(ce){throw console.error("‚ùå Failed to manage conversations:",ce),new Error("Could not create or find conversation: "+ce.message)}const G=`${_e}/conversations/${V}/context`,U=await fetch(G,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context_type:"document",title:c.title,content:c.body,metadata:{source_type:"document",document_id:c.id,url:c.url||"",tags:c.tags?c.tags.join(", "):"",rank:c.rank?c.rank.toString():"0"}})});if(!U.ok)throw new Error(`HTTP error! Status: ${U.status} - ${U.statusText}`);const X=await U.json();console.log("‚úÖ Document added to context via HTTP:",X)}console.log("‚úÖ Successfully added document to chat context, navigating to chat..."),O=!0;const ne=window.document.createElement("div");ne.className="notification is-success is-light",ne.innerHTML=`
        <strong>üí¨ Opening Chat with Document</strong><br>
        <small>Context added successfully. Redirecting to chat...</small>
      `,ne.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(ne),setTimeout(()=>{ne.remove(),ui.goto("/chat")},1500),setTimeout(()=>{O=!1},2e3)}catch(V){console.error("‚ùå Error adding document to context and opening chat:",V),t(13,N=V.message||"Failed to add document to context");const ne=window.document.createElement("div");ne.className="notification is-danger is-light",ne.innerHTML=`
        <button class="delete" onclick="this.parentElement.remove()"></button>
        <strong>‚úó Failed to Open Chat with Document</strong><br>
        <small>${N}</small>
      `,ne.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(ne),setTimeout(()=>{ne.remove()},8e3),setTimeout(()=>{t(13,N=null)},5e3)}finally{E=!1}}Vl[r]!==void 0&&(console.log("Have attribute",Vl[r]),Vl[r].hasOwnProperty("enableLogseq")?console.log("enable logseq True"):console.log("Didn't make it"));const P=V=>te(V),R=()=>{t(10,w=null),q()},z=()=>t(11,$=!1),K=()=>{q()},B=()=>t(13,N=null);function oe(V){p=V,t(1,p)}function re(V){d=V,t(2,d)}function Se(V){m=V,t(3,m)}return l.$$set=V=>{"document"in V&&t(0,c=V.document)},t(14,n=Z()),t(15,o=Q()),[c,p,d,m,_,g,h,v,y,k,w,$,C,N,n,o,D,te,q,P,R,z,K,B,oe,re,Se]}class Ca extends Pt{constructor(e){super(),Ut(this,e,ya,wa,Ot,{document:0},null,[-1,-1])}}const _i="/assets/terraphim_gray.png";function Ql(l){const e=l.trim();if(!e)return{hasOperator:!1,operator:null,terms:[l],originalQuery:l};const t=/\b(AND)\b/,n=/\b(OR)\b/,o=/\b(and)\b/i,r=/\b(or)\b/i,i=t.test(e),u=n.test(e),c=o.test(e)&&!i,p=r.test(e)&&!u;if(i&&!u)return{hasOperator:!0,operator:"AND",terms:e.split(t).filter((m,_)=>_%2===0).map(m=>m.trim()).filter(m=>m.length>0),originalQuery:l};if(u&&!i)return{hasOperator:!0,operator:"OR",terms:e.split(n).filter((m,_)=>_%2===0).map(m=>m.trim()).filter(m=>m.length>0),originalQuery:l};if(i&&u){const d=e.indexOf(" AND "),m=e.indexOf(" OR ");if(d!==-1&&(m===-1||d<m))return{hasOperator:!0,operator:"AND",terms:e.split(/\s+(?:AND|OR)\s+/i).map(g=>g.trim()).filter(g=>g.length>0),originalQuery:l};if(m!==-1)return{hasOperator:!0,operator:"OR",terms:e.split(/\s+(?:AND|OR)\s+/i).map(g=>g.trim()).filter(g=>g.length>0),originalQuery:l}}if(c&&!p)return{hasOperator:!0,operator:"AND",terms:e.split(o).filter((m,_)=>_%2===0).map(m=>m.trim()).filter(m=>m.length>0),originalQuery:l};if(p&&!c)return{hasOperator:!0,operator:"OR",terms:e.split(r).filter((m,_)=>_%2===0).map(m=>m.trim()).filter(m=>m.length>0),originalQuery:l};if(c&&p){const d=e.toLowerCase().indexOf(" and "),m=e.toLowerCase().indexOf(" or ");if(d!==-1&&(m===-1||d<m))return{hasOperator:!0,operator:"AND",terms:e.split(/\s+(?:and|or)\s+/i).map(g=>g.trim()).filter(g=>g.length>0),originalQuery:l};if(m!==-1)return{hasOperator:!0,operator:"OR",terms:e.split(/\s+(?:and|or)\s+/i).map(g=>g.trim()).filter(g=>g.length>0),originalQuery:l}}return{hasOperator:!1,operator:null,terms:[e],originalQuery:l}}function Sa(l,e){var n,o;if(l.hasOperator&&l.terms.length>1){const r=l.terms.filter(i=>i.trim().length>0);if(r.length>1)return{search_term:r[0],search_terms:r,operator:(n=l.operator)==null?void 0:n.toLowerCase(),skip:0,limit:50,role:e||null}}return{search_term:((o=l.terms[0])==null?void 0:o.trim())||"",search_terms:void 0,operator:void 0,skip:0,limit:50,role:e||null}}function uo(l,e,t){const n=l.slice();return n[46]=e[t],n}function fo(l,e,t){const n=l.slice();return n[49]=e[t],n[51]=t,n}function po(l,e,t){const n=l.slice();return n[52]=e[t],n[51]=t,n}function mo(l){let e,t=l[3],n=[];for(let o=0;o<t.length;o+=1)n[o]=_o(po(l,t,o));return{c(){e=f("ul");for(let o=0;o<n.length;o+=1)n[o].c();a(e,"class","suggestions svelte-sfnt4t")},m(o,r){T(o,e,r);for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(e,null)},p(o,r){if(r[0]&4120){t=o[3];let i;for(i=0;i<t.length;i+=1){const u=po(o,t,i);n[i]?n[i].p(u,r):(n[i]=_o(u),n[i].c(),n[i].m(e,null))}for(;i<n.length;i+=1)n[i].d(1);n.length=t.length}},d(o){o&&S(e),_t(n,o)}}}function _o(l){let e,t=l[52]+"",n,o,r,i,u,c;function p(){return l[20](l[52])}function d(...m){return l[21](l[52],...m)}return{c(){e=f("li"),n=M(t),o=b(),a(e,"tabindex","0"),a(e,"role","option"),a(e,"aria-selected",r=l[51]===l[4]),a(e,"aria-label",i=`Apply suggestion: ${l[52]}`),a(e,"class","svelte-sfnt4t"),pt(e,"active",l[51]===l[4])},m(m,_){T(m,e,_),s(e,n),s(e,o),u||(c=[ee(e,"click",p),ee(e,"keydown",d)],u=!0)},p(m,_){l=m,_[0]&8&&t!==(t=l[52]+"")&&ae(n,t),_[0]&16&&r!==(r=l[51]===l[4])&&a(e,"aria-selected",r),_[0]&8&&i!==(i=`Apply suggestion: ${l[52]}`)&&a(e,"aria-label",i),_[0]&16&&pt(e,"active",l[51]===l[4])},d(m){m&&S(e),u=!1,lt(c)}}}function go(l){let e,t,n,o,r,i,u;return t=new un({props:{$$slots:{default:[Ra]},$$scope:{ctx:l}}}),{c(){e=f("div"),be(t.$$.fragment),n=b(),o=f("button"),o.textContent="Clear all",a(o,"type","button"),a(o,"class","clear-terms-btn svelte-sfnt4t"),a(e,"class","selected-terms-section svelte-sfnt4t")},m(c,p){T(c,e,p),ke(t,e,null),s(e,n),s(e,o),r=!0,i||(u=ee(o,"click",l[14]),i=!0)},p(c,p){const d={};p[0]&96|p[1]&8388608&&(d.$$scope={dirty:p,ctx:c}),t.$set(d)},i(c){r||(J(t.$$.fragment,c),r=!0)},o(c){x(t.$$.fragment,c),r=!1},d(c){c&&S(e),we(t),i=!1,u()}}}function Ta(l){let e=l[49].value+"",t,n,o,r,i,u,c;function p(){return l[22](l[49])}return{c(){t=M(e),n=b(),o=f("button"),r=M("√ó"),a(o,"class","remove-tag-btn svelte-sfnt4t"),a(o,"aria-label",i=`Remove term: ${l[49].value}`)},m(d,m){T(d,t,m),T(d,n,m),T(d,o,m),s(o,r),u||(c=ee(o,"click",Yl(p)),u=!0)},p(d,m){l=d,m[0]&32&&e!==(e=l[49].value+"")&&ae(t,e),m[0]&32&&i!==(i=`Remove term: ${l[49].value}`)&&a(o,"aria-label",i)},d(d){d&&S(t),d&&S(n),d&&S(o),u=!1,c()}}}function ho(l){let e,t,n,o;return t=new gl({props:{class:"operator-tag",rounded:!0,$$slots:{default:[$a]},$$scope:{ctx:l}}}),{c(){e=f("div"),be(t.$$.fragment),n=b(),a(e,"class","operator-tag-wrapper svelte-sfnt4t")},m(r,i){T(r,e,i),ke(t,e,null),s(e,n),o=!0},p(r,i){const u={};i[0]&64|i[1]&8388608&&(u.$$scope={dirty:i,ctx:r}),t.$set(u)},i(r){o||(J(t.$$.fragment,r),o=!0)},o(r){x(t.$$.fragment,r),o=!1},d(r){r&&S(e),we(t)}}}function $a(l){let e=(l[6]||"AND")+"",t;return{c(){t=M(e)},m(n,o){T(n,t,o)},p(n,o){o[0]&64&&e!==(e=(n[6]||"AND")+"")&&ae(t,e)},d(n){n&&S(t)}}}function vo(l){let e,t,n,o,r;function i(){return l[23](l[49])}t=new gl({props:{rounded:!0,title:"Click to remove term",$$slots:{default:[Ta]},$$scope:{ctx:l}}}),t.$on("click",i);let u=l[51]<l[5].length-1&&ho(l);return{c(){e=f("div"),be(t.$$.fragment),n=b(),u&&u.c(),o=Ct(),a(e,"class","term-tag-wrapper svelte-sfnt4t"),pt(e,"from-kg",l[49].isFromKG)},m(c,p){T(c,e,p),ke(t,e,null),T(c,n,p),u&&u.m(c,p),T(c,o,p),r=!0},p(c,p){l=c;const d={};p[0]&32|p[1]&8388608&&(d.$$scope={dirty:p,ctx:l}),t.$set(d),(!r||p[0]&32)&&pt(e,"from-kg",l[49].isFromKG),l[51]<l[5].length-1?u?(u.p(l,p),p[0]&32&&J(u,1)):(u=ho(l),u.c(),J(u,1),u.m(o.parentNode,o)):u&&(qe(),x(u,1,1,()=>{u=null}),We())},i(c){r||(J(t.$$.fragment,c),J(u),r=!0)},o(c){x(t.$$.fragment,c),x(u),r=!1},d(c){c&&S(e),we(t),c&&S(n),u&&u.d(c),c&&S(o)}}}function Ra(l){let e,t,n=l[5],o=[];for(let i=0;i<n.length;i+=1)o[i]=vo(fo(l,n,i));const r=i=>x(o[i],1,1,()=>{o[i]=null});return{c(){for(let i=0;i<o.length;i+=1)o[i].c();e=Ct()},m(i,u){for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(i,u);T(i,e,u),t=!0},p(i,u){if(u[0]&8288){n=i[5];let c;for(c=0;c<n.length;c+=1){const p=fo(i,n,c);o[c]?(o[c].p(p,u),J(o[c],1)):(o[c]=vo(p),o[c].c(),J(o[c],1),o[c].m(e.parentNode,e))}for(qe(),c=n.length;c<o.length;c+=1)r(c);We()}},i(i){if(!t){for(let u=0;u<n.length;u+=1)J(o[u]);t=!0}},o(i){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)x(o[u]);t=!1},d(i){_t(o,i),i&&S(e)}}}function bo(l){let e,t,n,o;return{c(){e=f("div"),t=f("button"),t.textContent="Parse Terms",a(t,"type","button"),a(t,"class","button is-small is-info"),a(e,"class","search-hint-container svelte-sfnt4t")},m(r,i){T(r,e,i),s(e,t),n||(o=ee(t,"click",l[24]),n=!0)},p:Le,d(r){r&&S(e),n=!1,o()}}}function La(l){let e,t,n,o,r,i,u,c=l[0]&&(l[0].includes(" AND ")||l[0].includes(" OR "))&&l[5].length===0,p;function d(v){l[19](v)}let m={type:"search",placeholder:l[8]?`Search over Knowledge graph for ${l[7]}`:"Search",icon:"search",expanded:!0,autofocus:!0};l[0]!==void 0&&(m.value=l[0]),n=new yl({props:m}),mt.push(()=>bt(n,"value",d)),n.$on("click",l[15]),n.$on("submit",l[15]),n.$on("keydown",l[11]),n.$on("input",l[10]);let _=l[3].length>0&&mo(l),g=l[5].length>0&&go(l),h=c&&bo(l);return{c(){e=f("div"),t=f("div"),be(n.$$.fragment),r=b(),_&&_.c(),i=b(),g&&g.c(),u=b(),h&&h.c(),a(t,"class","input-wrapper svelte-sfnt4t"),a(e,"class","search-row svelte-sfnt4t")},m(v,y){T(v,e,y),s(e,t),ke(n,t,null),s(t,r),_&&_.m(t,null),s(e,i),g&&g.m(e,null),s(e,u),h&&h.m(e,null),p=!0},p(v,y){const k={};y[0]&384&&(k.placeholder=v[8]?`Search over Knowledge graph for ${v[7]}`:"Search"),!o&&y[0]&1&&(o=!0,k.value=v[0],kt(()=>o=!1)),n.$set(k),v[3].length>0?_?_.p(v,y):(_=mo(v),_.c(),_.m(t,null)):_&&(_.d(1),_=null),v[5].length>0?g?(g.p(v,y),y[0]&32&&J(g,1)):(g=go(v),g.c(),J(g,1),g.m(e,u)):g&&(qe(),x(g,1,1,()=>{g=null}),We()),y[0]&33&&(c=v[0]&&(v[0].includes(" AND ")||v[0].includes(" OR "))&&v[5].length===0),c?h?h.p(v,y):(h=bo(v),h.c(),h.m(e,null)):h&&(h.d(1),h=null)},i(v){p||(J(n.$$.fragment,v),J(g),p=!0)},o(v){x(n.$$.fragment,v),x(g),p=!1},d(v){v&&S(e),we(n),_&&_.d(),g&&g.d(),h&&h.d()}}}function Ea(l){let e,t,n,o,r,i,u,c,p,d;return{c(){e=f("section"),t=f("div"),n=f("img"),r=b(),i=f("p"),i.textContent="I am Terraphim, your personal assistant.",u=b(),c=f("button"),c.innerHTML=`<span class="icon"><i class="fas fa-magic"></i></span> 
        <span>Configuration Wizard</span>`,ii(n.src,o=_i)||a(n,"src",o),a(n,"alt","Terraphim Logo"),a(n,"class","svelte-sfnt4t"),a(c,"class","button is-primary"),a(c,"data-testid","wizard-start"),a(t,"class","content has-text-grey has-text-centered svelte-sfnt4t"),a(e,"class","section")},m(m,_){T(m,e,_),s(e,t),s(t,n),s(t,r),s(t,i),s(t,u),s(t,c),p||(d=ee(c,"click",l[25]),p=!0)},p:Le,i:Le,o:Le,d(m){m&&S(e),p=!1,d()}}}function Aa(l){let e,t,n=l[1],o=[];for(let i=0;i<n.length;i+=1)o[i]=ko(uo(l,n,i));const r=i=>x(o[i],1,1,()=>{o[i]=null});return{c(){for(let i=0;i<o.length;i+=1)o[i].c();e=Ct()},m(i,u){for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(i,u);T(i,e,u),t=!0},p(i,u){if(u[0]&2){n=i[1];let c;for(c=0;c<n.length;c+=1){const p=uo(i,n,c);o[c]?(o[c].p(p,u),J(o[c],1)):(o[c]=ko(p),o[c].c(),J(o[c],1),o[c].m(e.parentNode,e))}for(qe(),c=n.length;c<o.length;c+=1)r(c);We()}},i(i){if(!t){for(let u=0;u<n.length;u+=1)J(o[u]);t=!0}},o(i){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)x(o[u]);t=!1},d(i){_t(o,i),i&&S(e)}}}function Da(l){let e,t;return{c(){e=f("p"),t=M(l[2]),a(e,"class","error svelte-sfnt4t")},m(n,o){T(n,e,o),s(e,t)},p(n,o){o[0]&4&&ae(t,n[2])},i:Le,o:Le,d(n){n&&S(e)}}}function ko(l){let e,t;return e=new Ca({props:{document:l[46]}}),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},p(n,o){const r={};o[0]&2&&(r.document=n[46]),e.$set(r)},i(n){t||(J(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function Na(l){let e,t,n,o,r,i,u,c,p;t=new ml({props:{$$slots:{default:[La]},$$scope:{ctx:l}}});const d=[Da,Aa,Ea],m=[];function _(g,h){return g[2]?0:g[1].length?1:2}return o=_(l),r=m[o]=d[o](l),{c(){e=f("form"),be(t.$$.fragment),n=b(),r.c(),i=Ct()},m(g,h){T(g,e,h),ke(t,e,null),T(g,n,h),m[o].m(g,h),T(g,i,h),u=!0,c||(p=ee(e,"submit",Ii(l[15])),c=!0)},p(g,h){const v={};h[0]&505|h[1]&8388608&&(v.$$scope={dirty:h,ctx:g}),t.$set(v);let y=o;o=_(g),o===y?m[o].p(g,h):(qe(),x(m[y],1,1,()=>{m[y]=null}),We(),r=m[o],r?r.p(g,h):(r=m[o]=d[o](g),r.c()),J(r,1),r.m(i.parentNode,i))},i(g){u||(J(t.$$.fragment,g),J(r),u=!0)},o(g){x(t.$$.fragment,g),x(r),u=!1},d(g){g&&S(e),we(t),g&&S(n),m[o].d(g),g&&S(i),c=!1,p()}}}function Ia(l,e,t){let n,o,r,i,u,c,p;Ge(l,xi,G=>t(29,o=G)),Ge(l,pl,G=>t(0,r=G)),Ge(l,vt,G=>t(30,i=G)),Ge(l,Nt,G=>t(7,u=G)),Ge(l,Ml,G=>t(18,c=G)),Ge(l,Yt,G=>t(8,p=G));let d=[],m=null,_=[],g=-1,h=null,v=[],y=null,k=!1;function w(){return`terraphim:searchState:${u}`}function $(){try{if(typeof window>"u")return;const G=localStorage.getItem(w());if(!G)return;const U=JSON.parse(G);typeof U.input=="string"&&ol(pl,r=U.input,r),Array.isArray(U.results)&&t(1,d=U.results)}catch(G){console.warn("Failed to load search state:",G)}}function C(){try{if(typeof window>"u")return;const G={input:r,results:d};localStorage.setItem(w(),JSON.stringify(G))}catch(G){console.warn("Failed to save search state:",G)}}let L=null;wl(()=>{$()}),an(()=>{L&&clearTimeout(L),h&&(h.close(),h=null),O()});function I(){if(i){E();return}h&&h.close();const U=`${o.replace("/documents/search","")}/summarization/stream`;try{h=new EventSource(U),h.onopen=()=>{console.log("SSE connection opened for summarization updates")},h.onmessage=X=>{try{const ce=JSON.parse(X.data);console.log("SSE received:",ce),ce.task_id&&ce.status==="completed"&&ce.summary&&Q(ce.task_id,ce.summary)}catch(ce){console.warn("Failed to parse SSE message:",ce)}},h.onerror=X=>{console.warn("SSE connection error:",X),setTimeout(()=>{h&&I()},5e3)}}catch(X){console.error("Failed to create SSE connection:",X)}}let N=null;function E(){console.log("Starting polling for summary updates (Tauri mode)"),N&&clearInterval(N),N=setInterval(async()=>{if(d.length!==0)try{const G=H();if(!G)return;const U=await ze("search",{searchQuery:G});if(U.status==="success"){const X=U.results;let ce=!1;for(let ue=0;ue<Math.min(d.length,X.length);ue++)!d[ue].summarization&&X[ue].summarization&&(ce=!0,console.log(`New AI summary found for document: ${X[ue].title}`));ce&&(t(1,d=X),console.log("Updated results with new AI summaries"),C()),d.filter(ue=>!ue.summarization&&ue.body&&ue.body.length>500).length===0&&(console.log("All summaries complete, stopping polling"),O())}}catch(G){console.error("Error during summary polling:",G)}},2e3),setTimeout(()=>{N&&(console.log("Stopping summary polling after timeout"),O())},3e4)}function O(){N&&(clearInterval(N),N=null)}function Q(G,U){t(1,d=d.map(X=>!X.summarization&&X.body&&X.body.length>500?{...X,summarization:U}:X)),console.log(`Updated document summary for task ${G}:`,U),C()}function Z(G){const U=Ql(G);if(U.hasOperator&&U.terms.length>1){const X=U.terms.map(ue=>{const pe=n.some(([me])=>me.toLowerCase()===ue.toLowerCase());return{value:ue,isFromKG:pe}}),ce=v.map(ue=>ue.value),ge=X.map(ue=>ue.value);(JSON.stringify(ce)!==JSON.stringify(ge)||y!==U.operator)&&(t(5,v=X),t(6,y=U.operator))}else U.terms.length===1&&v.length>0?(t(5,v=[]),t(6,y=null)):U.terms.length===0&&(t(5,v=[]),t(6,y=null))}async function D(G){try{if(i){const U=await ze("get_autocomplete_suggestions",{query:G,roleName:u,limit:8});if(U.status==="success"&&U.suggestions)return U.suggestions.map(X=>X.term)}else{const U=await fetch(`${o.replace("/documents/search","")}/autocomplete/${encodeURIComponent(u)}/${encodeURIComponent(G)}`);if(U.ok){const X=await U.json();if(X.status==="success"&&X.suggestions)return X.suggestions.map(ce=>ce.term)}}return n.filter(([U])=>U.toLowerCase().includes(G.toLowerCase())).map(([U])=>U).slice(0,8)}catch(U){return console.warn("Error fetching term suggestions:",U),[]}}async function A(G){const U=G.trim();if(U.length===0)return[];const ce=Ql(U),ge=U.split(/\s+/),ue=ge[ge.length-1].toLowerCase();if(ce.hasOperator&&ce.terms.length>0){const me=ce.terms[ce.terms.length-1];return me&&me.length>=2?D(me):[]}if(ge.length>1){const me=[];if("and".startsWith(ue)&&me.push("AND"),"or".startsWith(ue)&&me.push("OR"),me.length>0)return me}const pe=U.toLowerCase();if(pe.includes(" and ")||pe.includes(" or ")||pe.includes(" AND ")||pe.includes(" OR ")){const me=ue;return me.length<2?[]:D(me)}try{return(await D(U)).slice(0,7)}catch(me){return console.warn("Error fetching autocomplete suggestions:",me),n.filter(([Je])=>Je.toLowerCase().includes(U.toLowerCase())).map(([Je])=>Je).slice(0,5).slice(0,7)}}async function te(G){const U=G.target;if(!U||U.selectionStart==null)return;const X=U.selectionStart,ge=r.slice(0,X).split(/\s+/),ue=ge[ge.length-1];if(ue.toLowerCase()==="a"||ue.toLowerCase()==="an")t(3,_=["AND"]);else if(ue.toLowerCase()==="o"||ue.toLowerCase()==="or")t(3,_=["OR"]);else if(ue.length>=2)try{const pe=await A(ue);t(3,_=pe)}catch(pe){console.warn("Failed to get suggestions:",pe),t(3,_=[])}else t(3,_=[]);t(4,g=-1)}function q(G){_.length>0?G.key==="ArrowDown"?(G.preventDefault(),t(4,g=(g+1)%_.length)):G.key==="ArrowUp"?(G.preventDefault(),t(4,g=(g-1+_.length)%_.length)):(G.key==="Enter"||G.key==="Tab")&&g!==-1?(G.preventDefault(),le(_[g])):G.key==="Escape"&&(G.preventDefault(),t(3,_=[]),t(4,g=-1)):G.key==="Enter"&&(G.preventDefault(),ie())}function ie(){Z(r),K()}function le(G){if(G==="AND"||G==="OR"){t(6,y=G);const U=Ql(r);U.terms.length>0&&!v.some(X=>X.value===U.terms[U.terms.length-1])&&j(U.terms[U.terms.length-1]),ol(pl,r=r+` ${G} `,r)}else{const U=r.trim().split(/\s+/),X=U[U.length-1];G.toLowerCase().startsWith(X.toLowerCase())?(U[U.length-1]=G,ol(pl,r=U.join(" "),r)):j(G,y)}t(3,_=[]),t(4,g=-1)}function H(){const G=r.trim();if(!G)return null;const U=Ql(G);return{...Sa(U,u),skip:0,limit:10}}function j(G,U=null){const X=n.some(([ce])=>ce.toLowerCase()===G.toLowerCase());v.some(ce=>ce.value.toLowerCase()===G.toLowerCase())||(t(5,v=[...v,{value:G,isFromKG:X}]),U&&v.length>1&&t(6,y=U),R(),C())}function P(G){t(5,v=v.filter(U=>U.value!==G)),R(),C()}function R(){if(t(16,k=!0),v.length===0)ol(pl,r="",r),t(6,y=null);else if(v.length===1)ol(pl,r=v[0].value,r),t(6,y=null);else{const G=y||"AND";ol(pl,r=v.map(U=>U.value).join(` ${G} `),r)}setTimeout(()=>{t(16,k=!1)},10)}function z(){t(5,v=[]),t(6,y=null),ol(pl,r="",r),C()}async function K(){if(t(2,m=null),i){if(!r.trim())return;try{const G=H();if(!G)return;const U=await ze("search",{searchQuery:G});U.status==="success"?(t(1,d=U.results),console.log("Response results"),console.log(d),C()):(t(2,m=`Search failed: ${U.status}`),console.error("Search failed:",U))}catch(G){t(2,m=`Error in Tauri search: ${G}`),console.error("Error in Tauri search:",G)}}else{if(!r.trim())return;const G=H();if(!G)return;const U=JSON.stringify(G);try{const X=await fetch(o,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:U}),ce=await X.json();if(!X.ok)throw new Error(`HTTP error! Status: ${X.status}`);t(1,d=ce.results),C(),I()}catch(X){console.error("Error fetching data:",X),t(2,m=`Error fetching data: ${X}`)}}}function B(G){r=G,pl.set(r)}const oe=G=>le(G),re=(G,U)=>{(U.key==="Enter"||U.key===" ")&&(U.preventDefault(),le(G))},Se=G=>P(G.value),V=G=>P(G.value),ne=()=>Z(r),_e=()=>window.location.href="/config/wizard";return l.$$.update=()=>{l.$$.dirty[0]&262144&&(n=Object.entries(c)),l.$$.dirty[0]&196609&&r&&!k&&(r.includes(" AND ")||r.includes(" OR ")||r.includes(" and ")||r.includes(" or "))&&(L&&clearTimeout(L),t(17,L=setTimeout(()=>{Z(r),t(17,L=null)},300)))},[r,d,m,_,g,v,y,u,p,Z,te,q,le,P,z,K,k,L,c,B,oe,re,Se,V,ne,_e]}class Oa extends Pt{constructor(e){super(),Ut(this,e,Ia,Na,Ot,{},null,[-1,-1])}}async function sn(l={}){return typeof l=="object"&&Object.freeze(l),Rl({__tauriModule:"Dialog",message:{cmd:"openDialog",options:l}})}async function Ma(l={}){return typeof l=="object"&&Object.freeze(l),Rl({__tauriModule:"Dialog",message:{cmd:"saveDialog",options:l}})}async function Pa(l,e){var t,n;const o=typeof e=="string"?{title:e}:e;return Rl({__tauriModule:"Dialog",message:{cmd:"messageDialog",message:l.toString(),title:(t=o==null?void 0:o.title)===null||t===void 0?void 0:t.toString(),type:o==null?void 0:o.type,buttonLabel:(n=o==null?void 0:o.okLabel)===null||n===void 0?void 0:n.toString()}})}async function Ua(l,e){var t,n,o,r,i;const u=typeof e=="string"?{title:e}:e;return Rl({__tauriModule:"Dialog",message:{cmd:"askDialog",message:l.toString(),title:(t=u==null?void 0:u.title)===null||t===void 0?void 0:t.toString(),type:u==null?void 0:u.type,buttonLabels:[(o=(n=u==null?void 0:u.okLabel)===null||n===void 0?void 0:n.toString())!==null&&o!==void 0?o:"Yes",(i=(r=u==null?void 0:u.cancelLabel)===null||r===void 0?void 0:r.toString())!==null&&i!==void 0?i:"No"]}})}async function ja(l,e){var t,n,o,r,i;const u=typeof e=="string"?{title:e}:e;return Rl({__tauriModule:"Dialog",message:{cmd:"confirmDialog",message:l.toString(),title:(t=u==null?void 0:u.title)===null||t===void 0?void 0:t.toString(),type:u==null?void 0:u.type,buttonLabels:[(o=(n=u==null?void 0:u.okLabel)===null||n===void 0?void 0:n.toString())!==null&&o!==void 0?o:"Ok",(i=(r=u==null?void 0:u.cancelLabel)===null||r===void 0?void 0:r.toString())!==null&&i!==void 0?i:"Cancel"]}})}const gi=Object.freeze(Object.defineProperty({__proto__:null,ask:Ua,confirm:ja,message:Pa,open:sn,save:Ma},Symbol.toStringTag,{value:"Module"}));function wo(l,e,t){const n=l.slice();return n[72]=e[t],n[80]=t,n}function yo(l,e,t){const n=l.slice();return n[78]=e[t],n[79]=e,n[80]=t,n}function Co(l,e,t){const n=l.slice();return n[81]=e[t],n}function So(l,e,t){const n=l.slice();return n[81]=e[t],n}function To(l,e,t){const n=l.slice();return n[86]=e[t],n[87]=e,n[88]=t,n}function $o(l,e,t){const n=l.slice();return n[89]=e[t][0],n[90]=e[t][1],n[91]=e,n[92]=t,n}function Ro(l,e,t){const n=l.slice();return n[75]=e[t],n}function Lo(l,e,t){const n=l.slice();return n[72]=e[t],n}function Eo(l,e,t){const n=l.slice();return n[75]=e[t],n}function Ao(l){let e,t,n,o,r;return{c(){e=f("div"),t=f("button"),n=M(`
      Configuration saved successfully!`),a(t,"class","delete"),a(e,"class","notification is-success"),a(e,"data-testid","wizard-success")},m(i,u){T(i,e,u),s(e,t),s(e,n),o||(r=ee(t,"click",l[20]),o=!0)},p:Le,d(i){i&&S(e),o=!1,r()}}}function Do(l){let e,t,n,o,r;return{c(){e=f("div"),t=f("button"),n=M(`
      Failed to save configuration. Please try again.`),a(t,"class","delete"),a(e,"class","notification is-danger"),a(e,"data-testid","wizard-error")},m(i,u){T(i,e,u),s(e,t),s(e,n),o||(r=ee(t,"click",l[21]),o=!0)},p:Le,d(i){i&&S(e),o=!1,r()}}}function Ha(l){let e,t,n,o,r,i,u,c,p,d=l[3].id+"",m,_,g,h,v,y=l[3].global_shortcut+"",k,w,$,C,L,I=l[3].default_theme+"",N,E,O,Q,Z,D=l[3].default_role+"",A,te,q,ie,le,H,j=JSON.stringify(l[3],null,2)+"",P,R=l[3].roles,z=[];for(let K=0;K<R.length;K+=1)z[K]=No(wo(l,R,K));return{c(){e=f("h4"),e.textContent="Review",t=b(),n=f("div"),o=f("h5"),o.textContent="Configuration Summary:",r=b(),i=f("ul"),u=f("li"),c=f("strong"),c.textContent="Configuration ID:",p=b(),m=M(d),_=b(),g=f("li"),h=f("strong"),h.textContent="Global Shortcut:",v=b(),k=M(y),w=b(),$=f("li"),C=f("strong"),C.textContent="Default Theme:",L=b(),N=M(I),E=b(),O=f("li"),Q=f("strong"),Q.textContent="Default Role:",Z=b(),A=M(D),te=b(),q=f("h5"),q.textContent="Roles:",ie=b();for(let K=0;K<z.length;K+=1)z[K].c();le=b(),H=f("pre"),P=M(j),a(e,"class","title is-5"),a(n,"class","content"),Ce(H,"max-height","300px"),Ce(H,"overflow","auto")},m(K,B){T(K,e,B),T(K,t,B),T(K,n,B),s(n,o),s(n,r),s(n,i),s(i,u),s(u,c),s(u,p),s(u,m),s(i,_),s(i,g),s(g,h),s(g,v),s(g,k),s(i,w),s(i,$),s($,C),s($,L),s($,N),s(i,E),s(i,O),s(O,Q),s(O,Z),s(O,A),s(n,te),s(n,q),s(n,ie);for(let oe=0;oe<z.length;oe+=1)z[oe]&&z[oe].m(n,null);T(K,le,B),T(K,H,B),s(H,P)},p(K,B){if(B[0]&8&&d!==(d=K[3].id+"")&&ae(m,d),B[0]&8&&y!==(y=K[3].global_shortcut+"")&&ae(k,y),B[0]&8&&I!==(I=K[3].default_theme+"")&&ae(N,I),B[0]&8&&D!==(D=K[3].default_role+"")&&ae(A,D),B[0]&10){R=K[3].roles;let oe;for(oe=0;oe<R.length;oe+=1){const re=wo(K,R,oe);z[oe]?z[oe].p(re,B):(z[oe]=No(re),z[oe].c(),z[oe].m(n,null))}for(;oe<z.length;oe+=1)z[oe].d(1);z.length=R.length}B[0]&8&&j!==(j=JSON.stringify(K[3],null,2)+"")&&ae(P,j)},d(K){K&&S(e),K&&S(t),K&&S(n),_t(z,K),K&&S(le),K&&S(H)}}}function Fa(l){let e,t,n=[],o=new Map,r,i,u,c,p=l[3].roles;const d=m=>m[78].name;for(let m=0;m<p.length;m+=1){let _=yo(l,p,m),g=d(_);o.set(g,n[m]=Bo(g,_))}return{c(){e=f("h4"),e.textContent="Roles",t=b();for(let m=0;m<n.length;m+=1)n[m].c();r=b(),i=f("button"),i.textContent="Add Role",a(e,"class","title is-5"),a(i,"class","button is-link is-light"),a(i,"data-testid","add-role")},m(m,_){T(m,e,_),T(m,t,_);for(let g=0;g<n.length;g+=1)n[g]&&n[g].m(m,_);T(m,r,_),T(m,i,_),u||(c=ee(i,"click",l[12]),u=!0)},p(m,_){_[0]&516985&&(p=m[3].roles,n=ai(n,_,d,1,m,p,o,r.parentNode,ci,Bo,r,yo))},d(m){m&&S(e),m&&S(t);for(let _=0;_<n.length;_+=1)n[_].d(m);m&&S(r),m&&S(i),u=!1,c()}}}function za(l){let e,t,n,o,r,i,u,c,p,d,m,_,g,h,v,y,k,w,$,C,L,I,N,E,O,Q,Z,D,A,te,q,ie=l[8],le=[];for(let P=0;P<ie.length;P+=1)le[P]=Qo(Eo(l,ie,P));let H=l[3].roles,j=[];for(let P=0;P<H.length;P+=1)j[P]=Vo(Lo(l,H,P));return{c(){e=f("div"),t=f("label"),t.textContent="Configuration ID",n=b(),o=f("div"),r=f("div"),i=f("select"),u=f("option"),u.textContent="Desktop",c=f("option"),c.textContent="Server",p=f("option"),p.textContent="Embedded",d=b(),m=f("div"),_=f("label"),_.textContent="Global shortcut",g=b(),h=f("div"),v=f("input"),y=b(),k=f("div"),w=f("label"),w.textContent="Default theme",$=b(),C=f("div"),L=f("div"),I=f("select");for(let P=0;P<le.length;P+=1)le[P].c();N=b(),E=f("div"),O=f("label"),O.textContent="Default Role",Q=b(),Z=f("div"),D=f("div"),A=f("select");for(let P=0;P<j.length;P+=1)j[P].c();a(t,"class","label"),a(t,"for","config-id"),u.__value="Desktop",u.value=u.__value,c.__value="Server",c.value=c.__value,p.__value="Embedded",p.value=p.__value,a(i,"id","config-id"),l[3].id===void 0&&It(()=>l[22].call(i)),a(r,"class","select"),a(o,"class","control"),a(e,"class","field"),a(_,"class","label"),a(_,"for","global-shortcut"),a(v,"class","input"),a(v,"id","global-shortcut"),a(v,"type","text"),a(h,"class","control"),a(m,"class","field"),a(w,"class","label"),a(w,"for","default-theme"),a(I,"id","default-theme"),l[3].default_theme===void 0&&It(()=>l[24].call(I)),a(L,"class","select is-fullwidth"),a(C,"class","control"),a(k,"class","field"),a(O,"class","label"),a(O,"for","default-role"),a(A,"id","default-role"),l[3].default_role===void 0&&It(()=>l[25].call(A)),a(D,"class","select"),a(Z,"class","control"),a(E,"class","field")},m(P,R){T(P,e,R),s(e,t),s(e,n),s(e,o),s(o,r),s(r,i),s(i,u),s(i,c),s(i,p),nt(i,l[3].id,!0),T(P,d,R),T(P,m,R),s(m,_),s(m,g),s(m,h),s(h,v),je(v,l[3].global_shortcut),T(P,y,R),T(P,k,R),s(k,w),s(k,$),s(k,C),s(C,L),s(L,I);for(let z=0;z<le.length;z+=1)le[z]&&le[z].m(I,null);nt(I,l[3].default_theme,!0),T(P,N,R),T(P,E,R),s(E,O),s(E,Q),s(E,Z),s(Z,D),s(D,A);for(let z=0;z<j.length;z+=1)j[z]&&j[z].m(A,null);nt(A,l[3].default_role,!0),te||(q=[ee(i,"change",l[22]),ee(v,"input",l[23]),ee(I,"change",l[24]),ee(A,"change",l[25])],te=!0)},p(P,R){if(R[0]&264&&nt(i,P[3].id),R[0]&264&&v.value!==P[3].global_shortcut&&je(v,P[3].global_shortcut),R[0]&256){ie=P[8];let z;for(z=0;z<ie.length;z+=1){const K=Eo(P,ie,z);le[z]?le[z].p(K,R):(le[z]=Qo(K),le[z].c(),le[z].m(I,null))}for(;z<le.length;z+=1)le[z].d(1);le.length=ie.length}if(R[0]&264&&nt(I,P[3].default_theme),R[0]&8){H=P[3].roles;let z;for(z=0;z<H.length;z+=1){const K=Lo(P,H,z);j[z]?j[z].p(K,R):(j[z]=Vo(K),j[z].c(),j[z].m(A,null))}for(;z<j.length;z+=1)j[z].d(1);j.length=H.length}R[0]&264&&nt(A,P[3].default_role)},d(P){P&&S(e),P&&S(d),P&&S(m),P&&S(y),P&&S(k),_t(le,P),P&&S(N),P&&S(E),_t(j,P),te=!1,lt(q)}}}function No(l){let e,t,n=l[72].name+"",o,r,i,u,c,p=l[72].shortname+"",d,m,_,g,h,v=l[72].theme+"",y,k,w,$,C,L=l[72].relevance_function+"",I,N,E,O,Q,Z;return{c(){e=f("div"),t=f("h6"),o=M(n),r=b(),i=f("p"),u=f("strong"),u.textContent="Shortname:",c=b(),d=M(p),m=b(),_=f("p"),g=f("strong"),g.textContent="Theme:",h=b(),y=M(v),k=b(),w=f("p"),$=f("strong"),$.textContent="Relevance Function:",C=b(),I=M(L),N=b(),E=f("button"),E.textContent="Edit Role",O=b(),a(t,"data-testid","review-role-name-"+l[80]),a(E,"class","button is-small"),a(E,"data-testid","edit-role-"+l[80]),a(e,"class","box")},m(D,A){T(D,e,A),s(e,t),s(t,o),s(e,r),s(e,i),s(i,u),s(i,c),s(i,d),s(e,m),s(e,_),s(_,g),s(_,h),s(_,y),s(e,k),s(e,w),s(w,$),s(w,C),s(w,I),s(e,N),s(e,E),s(e,O),Q||(Z=ee(E,"click",l[69]),Q=!0)},p(D,A){A[0]&8&&n!==(n=D[72].name+"")&&ae(o,n),A[0]&8&&p!==(p=D[72].shortname+"")&&ae(d,p),A[0]&8&&v!==(v=D[72].theme+"")&&ae(y,v),A[0]&8&&L!==(L=D[72].relevance_function+"")&&ae(I,L)},d(D){D&&S(e),Q=!1,Z()}}}function Io(l){let e,t=l[75]+"",n;return{c(){e=f("option"),n=M(t),e.__value=l[75],e.value=e.__value},m(o,r){T(o,e,r),s(e,n)},p:Le,d(o){o&&S(e)}}}function Ka(l){let e;return{c(){e=M("Directory Path")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function Ga(l){let e;return{c(){e=M("Server URL")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function Oo(l){let e;return{c(){e=f("p"),e.textContent="Click to select directory",a(e,"class","help")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function Mo(l){let e,t,n,o,r,i,u,c,p,d,m,_;function g(){l[34].call(u,l[80],l[88])}return{c(){e=f("div"),t=f("label"),n=M("Atomic Server Secret"),r=b(),i=f("div"),u=f("input"),p=b(),d=f("p"),d.textContent="Leave empty for anonymous access",a(t,"class","label"),a(t,"for",o=`haystack-secret-${l[80]}-${l[88]}`),a(u,"class","input"),a(u,"id",c=`haystack-secret-${l[80]}-${l[88]}`),a(u,"type","password"),a(u,"placeholder","Base64 encoded secret (optional)"),a(i,"class","control"),a(d,"class","help"),a(e,"class","field")},m(h,v){T(h,e,v),s(e,t),s(t,n),s(e,r),s(e,i),s(i,u),je(u,l[3].roles[l[80]].haystacks[l[88]].atomic_server_secret),s(e,p),s(e,d),m||(_=ee(u,"input",g),m=!0)},p(h,v){l=h,v[0]&264&&o!==(o=`haystack-secret-${l[80]}-${l[88]}`)&&a(t,"for",o),v[0]&264&&c!==(c=`haystack-secret-${l[80]}-${l[88]}`)&&a(u,"id",c),v[0]&264&&u.value!==l[3].roles[l[80]].haystacks[l[88]].atomic_server_secret&&je(u,l[3].roles[l[80]].haystacks[l[88]].atomic_server_secret)},d(h){h&&S(e),m=!1,_()}}}function Po(l){let e,t,n,o,r,i,u,c,p,d,m,_,g,h,v,y,k,w,$,C,L,I,N,E,O,Q,Z,D,A,te,q,ie,le,H,j,P,R,z,K,B,oe,re,Se;function V(){l[35].call(d,l[80],l[88])}function ne(...ge){return l[36](l[80],l[88],...ge)}let _e=Object.entries(l[3].roles[l[80]].haystacks[l[88]].extra_parameters||{}),G=[];for(let ge=0;ge<_e.length;ge+=1)G[ge]=Uo($o(l,_e,ge));function U(){return l[40](l[80],l[88])}function X(){return l[41](l[80],l[88])}function ce(){return l[42](l[80],l[88])}return{c(){e=f("div"),t=f("label"),t.textContent="Extra Parameters (for filtering)",n=b(),o=f("div"),r=f("div"),i=f("label"),u=M("Hashtag"),p=b(),d=f("input"),_=b(),g=f("div"),h=f("div"),v=f("label"),y=M("Presets"),w=b(),$=f("div"),C=f("select"),L=f("option"),L.textContent="(choose)",I=f("option"),I.textContent="#rust",N=f("option"),N.textContent="#docs",E=f("option"),E.textContent="#test",O=f("option"),O.textContent="#todo",Z=b(),D=f("p"),D.innerHTML="When set, searches will enforce the hashtag alongside your query (AND), e.g. <code>-e &quot;search&quot; -e &quot;#rust&quot;</code>.",A=b();for(let ge=0;ge<G.length;ge+=1)G[ge].c();te=b(),q=f("div"),ie=f("div"),le=f("button"),le.textContent="+ Tag Filter",H=b(),j=f("div"),P=f("button"),P.textContent="+ Max Results",R=b(),z=f("div"),K=f("button"),K.textContent="+ Custom Parameter",B=b(),oe=f("p"),oe.innerHTML=`Common parameters: <code>tag</code> (e.g., &quot;#rust&quot;), <code>glob</code> (e.g., &quot;*.md&quot;),
                  <code>max_count</code> (e.g., &quot;10&quot;), <code>context</code> (e.g., &quot;5&quot;)`,a(t,"class","label"),a(i,"class","label"),a(i,"for",c=`ripgrep-hashtag-${l[80]}-${l[88]}`),a(d,"class","input"),a(d,"id",m=`ripgrep-hashtag-${l[80]}-${l[88]}`),a(d,"type","text"),a(d,"placeholder","#rust"),a(r,"class","control"),a(o,"class","field is-grouped"),a(v,"class","label"),a(v,"for",k=`ripgrep-hashtag-preset-${l[80]}-${l[88]}`),L.__value="",L.value=L.__value,I.__value="#rust",I.value=I.__value,N.__value="#docs",N.value=N.__value,E.__value="#test",E.value=E.__value,O.__value="#todo",O.value=O.__value,a(C,"id",Q=`ripgrep-hashtag-preset-${l[80]}-${l[88]}`),a($,"class","select is-small"),a(h,"class","control"),a(g,"class","field is-grouped"),Ce(g,"margin-bottom",".5rem"),a(D,"class","help"),a(le,"class","button is-small is-link is-light"),a(ie,"class","control"),a(P,"class","button is-small is-link is-light"),a(j,"class","control"),a(K,"class","button is-small is-link is-light"),a(z,"class","control"),a(q,"class","field is-grouped"),a(oe,"class","help"),a(e,"class","field")},m(ge,ue){T(ge,e,ue),s(e,t),s(e,n),s(e,o),s(o,r),s(r,i),s(i,u),s(r,p),s(r,d),je(d,l[3].roles[l[80]].haystacks[l[88]].extra_parameters.tag),s(e,_),s(e,g),s(g,h),s(h,v),s(v,y),s(h,w),s(h,$),s($,C),s(C,L),s(C,I),s(C,N),s(C,E),s(C,O),s(e,Z),s(e,D),s(e,A);for(let pe=0;pe<G.length;pe+=1)G[pe]&&G[pe].m(e,null);s(e,te),s(e,q),s(q,ie),s(ie,le),s(q,H),s(q,j),s(j,P),s(q,R),s(q,z),s(z,K),s(e,B),s(e,oe),re||(Se=[ee(d,"input",V),ee(C,"change",ne),ee(le,"click",U),ee(P,"click",X),ee(K,"click",ce)],re=!0)},p(ge,ue){if(l=ge,ue[0]&264&&c!==(c=`ripgrep-hashtag-${l[80]}-${l[88]}`)&&a(i,"for",c),ue[0]&264&&m!==(m=`ripgrep-hashtag-${l[80]}-${l[88]}`)&&a(d,"id",m),ue[0]&264&&d.value!==l[3].roles[l[80]].haystacks[l[88]].extra_parameters.tag&&je(d,l[3].roles[l[80]].haystacks[l[88]].extra_parameters.tag),ue[0]&264&&k!==(k=`ripgrep-hashtag-preset-${l[80]}-${l[88]}`)&&a(v,"for",k),ue[0]&264&&Q!==(Q=`ripgrep-hashtag-preset-${l[80]}-${l[88]}`)&&a(C,"id",Q),ue[0]&393224){_e=Object.entries(l[3].roles[l[80]].haystacks[l[88]].extra_parameters||{});let pe;for(pe=0;pe<_e.length;pe+=1){const me=$o(l,_e,pe);G[pe]?G[pe].p(me,ue):(G[pe]=Uo(me),G[pe].c(),G[pe].m(e,te))}for(;pe<G.length;pe+=1)G[pe].d(1);G.length=_e.length}},d(ge){ge&&S(e),_t(G,ge),re=!1,lt(Se)}}}function Uo(l){let e,t,n,o,r,i,u,c,p,d,m,_,g;function h(...k){return l[37](l[80],l[88],l[89],...k)}function v(){l[38].call(u,l[80],l[88],l[89])}function y(){return l[39](l[80],l[88],l[89])}return{c(){e=f("div"),t=f("div"),n=f("input"),r=b(),i=f("div"),u=f("input"),c=b(),p=f("div"),d=f("button"),d.textContent="√ó",m=b(),a(n,"class","input"),a(n,"type","text"),a(n,"placeholder","Parameter name"),n.value=o=l[89],a(t,"class","control"),a(u,"class","input"),a(u,"type","text"),a(u,"placeholder","Parameter value"),a(i,"class","control is-expanded"),a(d,"class","button is-small is-danger"),a(p,"class","control"),a(e,"class","field is-grouped")},m(k,w){T(k,e,w),s(e,t),s(t,n),s(e,r),s(e,i),s(i,u),je(u,l[3].roles[l[80]].haystacks[l[88]].extra_parameters[l[89]]),s(e,c),s(e,p),s(p,d),s(e,m),_||(g=[ee(n,"blur",h),ee(u,"input",v),ee(d,"click",y)],_=!0)},p(k,w){l=k,w[0]&264&&o!==(o=l[89])&&n.value!==o&&(n.value=o),w[0]&264&&u.value!==l[3].roles[l[80]].haystacks[l[88]].extra_parameters[l[89]]&&je(u,l[3].roles[l[80]].haystacks[l[88]].extra_parameters[l[89]])},d(k){k&&S(e),_=!1,lt(g)}}}function jo(l){let e,t,n,o,r,i,u,c,p,d,m,_,g,h,v,y,k,w,$,C,L,I,N,E,O,Q,Z,D,A,te,q,ie,le,H,j,P,R,z,K,B,oe,re,Se,V,ne,_e,G,U,X,ce;function ge(){l[31].call(p,l[80],l[88])}function ue(Be,Me){return Be[3].roles[Be[80]].haystacks[Be[88]].service==="Atomic"?Ga:Ka}let pe=ue(l),me=pe(l);function Ee(){l[32].call($,l[80],l[88])}function Je(){return l[33](l[80],l[88])}let Qe=l[4]&&l[3].roles[l[80]].haystacks[l[88]].service!=="Atomic"&&Oo(),$e=l[3].roles[l[80]].haystacks[l[88]].service==="Atomic"&&Mo(l),Ie=l[3].roles[l[80]].haystacks[l[88]].service==="Ripgrep"&&Po(l);function he(){l[43].call(A,l[80],l[88])}function Ae(){l[44].call(B,l[80],l[88])}function Ve(){return l[45](l[80],l[88])}return{c(){e=f("div"),t=f("div"),n=f("label"),o=M("Service Type"),i=b(),u=f("div"),c=f("div"),p=f("select"),d=f("option"),d.textContent="Ripgrep (File Search)",m=f("option"),m.textContent="Atomic Server",g=b(),h=f("div"),v=f("label"),me.c(),k=b(),w=f("div"),$=f("input"),N=b(),Qe&&Qe.c(),E=b(),$e&&$e.c(),O=b(),Ie&&Ie.c(),Q=b(),Z=f("div"),D=f("label"),A=f("input"),q=M(`
                ¬†Read-only`),le=b(),H=f("div"),j=f("label"),P=M("Ranking Weight"),z=b(),K=f("div"),B=f("input"),re=b(),Se=f("p"),Se.textContent="Weight for ranking results (1.0 = normal, >1.0 = higher priority, <1.0 = lower priority)",V=b(),ne=f("div"),_e=f("button"),G=M("Remove Haystack"),a(n,"class","label"),a(n,"for",r=`haystack-service-${l[80]}-${l[88]}`),d.__value="Ripgrep",d.value=d.__value,m.__value="Atomic",m.value=m.__value,a(p,"id",_=`haystack-service-${l[80]}-${l[88]}`),l[3].roles[l[80]].haystacks[l[88]].service===void 0&&It(ge),a(c,"class","select"),a(u,"class","control"),a(t,"class","field"),a(v,"class","label"),a(v,"for",y=`haystack-path-${l[80]}-${l[88]}`),a($,"class","input"),a($,"id",C=`haystack-path-${l[80]}-${l[88]}`),a($,"type","text"),a($,"placeholder",L=l[3].roles[l[80]].haystacks[l[88]].service==="Atomic"?"https://localhost:9883":"/path/to/documents"),$.readOnly=I=l[4]&&l[3].roles[l[80]].haystacks[l[88]].service!=="Atomic",a(w,"class","control"),a(h,"class","field"),a(A,"id",te=`haystack-readonly-${l[80]}-${l[88]}`),a(A,"type","checkbox"),a(D,"class","checkbox"),a(D,"for",ie=`haystack-readonly-${l[80]}-${l[88]}`),a(Z,"class","field"),a(j,"class","label"),a(j,"for",R=`haystack-weight-${l[80]}-${l[88]}`),a(B,"class","input"),a(B,"id",oe=`haystack-weight-${l[80]}-${l[88]}`),a(B,"type","number"),a(B,"min","0"),a(B,"max","10"),a(B,"step","0.1"),a(B,"placeholder","1.0"),a(K,"class","control"),a(Se,"class","help"),a(H,"class","field"),a(_e,"class","button is-small is-danger"),a(_e,"data-testid",U="remove-haystack-"+l[80]+"-"+l[88]),a(ne,"class","field"),a(e,"class","box is-light")},m(Be,Me){T(Be,e,Me),s(e,t),s(t,n),s(n,o),s(t,i),s(t,u),s(u,c),s(c,p),s(p,d),s(p,m),nt(p,l[3].roles[l[80]].haystacks[l[88]].service,!0),s(e,g),s(e,h),s(h,v),me.m(v,null),s(h,k),s(h,w),s(w,$),je($,l[3].roles[l[80]].haystacks[l[88]].path),s(w,N),Qe&&Qe.m(w,null),s(e,E),$e&&$e.m(e,null),s(e,O),Ie&&Ie.m(e,null),s(e,Q),s(e,Z),s(Z,D),s(D,A),A.checked=l[3].roles[l[80]].haystacks[l[88]].read_only,s(D,q),s(e,le),s(e,H),s(H,j),s(j,P),s(H,z),s(H,K),s(K,B),je(B,l[3].roles[l[80]].haystacks[l[88]].weight),s(H,re),s(H,Se),s(e,V),s(e,ne),s(ne,_e),s(_e,G),X||(ce=[ee(p,"change",ge),ee($,"input",Ee),ee($,"click",function(){Hl(l[4]&&l[3].roles[l[80]].haystacks[l[88]].service!=="Atomic"?Je:void 0)&&(l[4]&&l[3].roles[l[80]].haystacks[l[88]].service!=="Atomic"?Je:void 0).apply(this,arguments)}),ee(A,"change",he),ee(B,"input",Ae),ee(_e,"click",Ve)],X=!0)},p(Be,Me){l=Be,Me[0]&264&&r!==(r=`haystack-service-${l[80]}-${l[88]}`)&&a(n,"for",r),Me[0]&264&&_!==(_=`haystack-service-${l[80]}-${l[88]}`)&&a(p,"id",_),Me[0]&264&&nt(p,l[3].roles[l[80]].haystacks[l[88]].service),pe!==(pe=ue(l))&&(me.d(1),me=pe(l),me&&(me.c(),me.m(v,null))),Me[0]&264&&y!==(y=`haystack-path-${l[80]}-${l[88]}`)&&a(v,"for",y),Me[0]&264&&C!==(C=`haystack-path-${l[80]}-${l[88]}`)&&a($,"id",C),Me[0]&264&&L!==(L=l[3].roles[l[80]].haystacks[l[88]].service==="Atomic"?"https://localhost:9883":"/path/to/documents")&&a($,"placeholder",L),Me[0]&280&&I!==(I=l[4]&&l[3].roles[l[80]].haystacks[l[88]].service!=="Atomic")&&($.readOnly=I),Me[0]&264&&$.value!==l[3].roles[l[80]].haystacks[l[88]].path&&je($,l[3].roles[l[80]].haystacks[l[88]].path),l[4]&&l[3].roles[l[80]].haystacks[l[88]].service!=="Atomic"?Qe||(Qe=Oo(),Qe.c(),Qe.m(w,null)):Qe&&(Qe.d(1),Qe=null),l[3].roles[l[80]].haystacks[l[88]].service==="Atomic"?$e?$e.p(l,Me):($e=Mo(l),$e.c(),$e.m(e,O)):$e&&($e.d(1),$e=null),l[3].roles[l[80]].haystacks[l[88]].service==="Ripgrep"?Ie?Ie.p(l,Me):(Ie=Po(l),Ie.c(),Ie.m(e,Q)):Ie&&(Ie.d(1),Ie=null),Me[0]&264&&te!==(te=`haystack-readonly-${l[80]}-${l[88]}`)&&a(A,"id",te),Me[0]&264&&(A.checked=l[3].roles[l[80]].haystacks[l[88]].read_only),Me[0]&264&&ie!==(ie=`haystack-readonly-${l[80]}-${l[88]}`)&&a(D,"for",ie),Me[0]&264&&R!==(R=`haystack-weight-${l[80]}-${l[88]}`)&&a(j,"for",R),Me[0]&264&&oe!==(oe=`haystack-weight-${l[80]}-${l[88]}`)&&a(B,"id",oe),Me[0]&264&&ri(B.value)!==l[3].roles[l[80]].haystacks[l[88]].weight&&je(B,l[3].roles[l[80]].haystacks[l[88]].weight),Me[0]&264&&U!==(U="remove-haystack-"+l[80]+"-"+l[88])&&a(_e,"data-testid",U)},d(Be){Be&&S(e),me.d(),Qe&&Qe.d(),$e&&$e.d(),Ie&&Ie.d(),X=!1,lt(ce)}}}function Ho(l){var j;let e,t,n,o,r,i,u,c,p,d,m,_,g,h,v,y,k,w,$,C,L,I,N,E,O,Q,Z,D,A;function te(){l[48].call(u,l[80])}function q(){return l[49](l[80])}let ie=((j=l[0][l[80]])==null?void 0:j.length)&&Fo(l);function le(){l[51].call($,l[80])}function H(){l[52].call(E,l[80])}return{c(){e=f("div"),t=f("label"),n=M("Model"),r=b(),i=f("div"),u=f("input"),p=b(),d=f("button"),d.textContent="Fetch models",m=b(),ie&&ie.c(),_=b(),g=f("div"),h=f("label"),v=M("Base URL"),k=b(),w=f("div"),$=f("input"),L=b(),I=f("div"),N=f("label"),E=f("input"),Q=M(`
              ¬†Automatically summarize search results`),a(t,"class","label"),a(t,"for",o=`llm-model-${l[80]}`),a(u,"class","input"),a(u,"id",c=`llm-model-${l[80]}`),a(u,"type","text"),a(u,"placeholder","llama3.1"),a(i,"class","control"),a(d,"class","button is-small"),a(e,"class","field"),a(h,"class","label"),a(h,"for",y=`llm-base-url-${l[80]}`),a($,"class","input"),a($,"id",C=`llm-base-url-${l[80]}`),a($,"type","text"),a($,"placeholder","http://127.0.0.1:11434"),a(w,"class","control"),a(g,"class","field"),a(E,"id",O=`llm-auto-summarize-${l[80]}`),a(E,"type","checkbox"),a(N,"class","checkbox"),a(N,"for",Z=`llm-auto-summarize-${l[80]}`),a(I,"class","field")},m(P,R){T(P,e,R),s(e,t),s(t,n),s(e,r),s(e,i),s(i,u),je(u,l[3].roles[l[80]].llm_model),s(e,p),s(e,d),s(e,m),ie&&ie.m(e,null),T(P,_,R),T(P,g,R),s(g,h),s(h,v),s(g,k),s(g,w),s(w,$),je($,l[3].roles[l[80]].llm_base_url),T(P,L,R),T(P,I,R),s(I,N),s(N,E),E.checked=l[3].roles[l[80]].llm_auto_summarize,s(N,Q),D||(A=[ee(u,"input",te),ee(d,"click",q),ee($,"input",le),ee(E,"change",H)],D=!0)},p(P,R){var z;l=P,R[0]&264&&o!==(o=`llm-model-${l[80]}`)&&a(t,"for",o),R[0]&264&&c!==(c=`llm-model-${l[80]}`)&&a(u,"id",c),R[0]&264&&u.value!==l[3].roles[l[80]].llm_model&&je(u,l[3].roles[l[80]].llm_model),(z=l[0][l[80]])!=null&&z.length?ie?ie.p(l,R):(ie=Fo(l),ie.c(),ie.m(e,null)):ie&&(ie.d(1),ie=null),R[0]&264&&y!==(y=`llm-base-url-${l[80]}`)&&a(h,"for",y),R[0]&264&&C!==(C=`llm-base-url-${l[80]}`)&&a($,"id",C),R[0]&264&&$.value!==l[3].roles[l[80]].llm_base_url&&je($,l[3].roles[l[80]].llm_base_url),R[0]&264&&O!==(O=`llm-auto-summarize-${l[80]}`)&&a(E,"id",O),R[0]&264&&(E.checked=l[3].roles[l[80]].llm_auto_summarize),R[0]&264&&Z!==(Z=`llm-auto-summarize-${l[80]}`)&&a(N,"for",Z)},d(P){P&&S(e),ie&&ie.d(),P&&S(_),P&&S(g),P&&S(L),P&&S(I),D=!1,lt(A)}}}function Fo(l){let e,t,n,o,r=l[0][l[80]],i=[];for(let c=0;c<r.length;c+=1)i[c]=zo(So(l,r,c));function u(...c){return l[50](l[80],...c)}return{c(){e=f("div"),t=f("select");for(let c=0;c<i.length;c+=1)i[c].c();a(e,"class","select is-fullwidth"),Ce(e,"margin-top","0.5rem")},m(c,p){T(c,e,p),s(e,t);for(let d=0;d<i.length;d+=1)i[d]&&i[d].m(t,null);n||(o=ee(t,"change",u),n=!0)},p(c,p){if(l=c,p[0]&9){r=l[0][l[80]];let d;for(d=0;d<r.length;d+=1){const m=So(l,r,d);i[d]?i[d].p(m,p):(i[d]=zo(m),i[d].c(),i[d].m(t,null))}for(;d<i.length;d+=1)i[d].d(1);i.length=r.length}},d(c){c&&S(e),_t(i,c),n=!1,o()}}}function zo(l){let e,t=l[81]+"",n,o;return{c(){e=f("option"),n=M(t),e.__value=o=l[81],e.value=e.__value},m(r,i){T(r,e,i),s(e,n)},p(r,i){i[0]&9&&t!==(t=r[81]+"")&&ae(n,t),i[0]&265&&o!==(o=r[81])&&(e.__value=o,e.value=e.__value)},d(r){r&&S(e)}}}function Ko(l){var ue;let e,t,n,o,r,i,u,c,p,d,m,_,g,h,v,y,k,w,$,C,L,I,N,E,O,Q,Z,D,A,te,q,ie,le,H,j,P,R,z,K,B,oe,re,Se,V;function ne(){l[54].call(u,l[80])}function _e(){l[55].call(w,l[80])}function G(){return l[56](l[80])}let U=((ue=l[0][l[80]])==null?void 0:ue.length)&&Go(l);function X(){l[58].call(D,l[80])}function ce(){l[59].call(R,l[80])}let ge=l[3].roles[l[80]].openrouter_chat_enabled&&Wo(l);return{c(){e=f("div"),t=f("label"),n=M("OpenRouter API Key"),r=b(),i=f("div"),u=f("input"),p=b(),d=f("p"),d.innerHTML='Get your API key from <a href="https://openrouter.ai" target="_blank" rel="noopener">OpenRouter</a>',m=b(),_=f("div"),g=f("label"),h=M("Model"),y=b(),k=f("div"),w=f("input"),C=b(),L=f("button"),L.textContent="Fetch models",I=b(),U&&U.c(),N=b(),E=f("p"),E.textContent="Choose the language model for generating summaries. Different models offer different speed/quality tradeoffs.",O=b(),Q=f("div"),Z=f("label"),D=f("input"),te=M(`
              ¬†Automatically summarize search results`),ie=b(),le=f("p"),le.textContent="When enabled, summaries will be generated and shown in search results.",H=b(),j=f("div"),P=f("label"),R=f("input"),K=M(`
              ¬†Enable Chat interface (OpenRouter)`),oe=b(),ge&&ge.c(),re=Ct(),a(t,"class","label"),a(t,"for",o=`openrouter-api-key-${l[80]}`),a(u,"class","input"),a(u,"id",c=`openrouter-api-key-${l[80]}`),a(u,"type","password"),a(u,"placeholder","sk-or-v1-..."),a(i,"class","control"),a(d,"class","help"),a(e,"class","field"),a(g,"class","label"),a(g,"for",v=`openrouter-model-${l[80]}`),a(w,"class","input"),a(w,"id",$=`openrouter-model-${l[80]}`),a(w,"type","text"),a(w,"placeholder","openai/gpt-4-turbo"),a(k,"class","control"),a(L,"class","button is-small"),a(E,"class","help"),a(_,"class","field"),a(D,"id",A=`openrouter-auto-summarize-${l[80]}`),a(D,"type","checkbox"),a(Z,"class","checkbox"),a(Z,"for",q=`openrouter-auto-summarize-${l[80]}`),a(le,"class","help"),a(Q,"class","field"),a(R,"id",z=`openrouter-chat-enabled-${l[80]}`),a(R,"type","checkbox"),a(P,"class","checkbox"),a(P,"for",B=`openrouter-chat-enabled-${l[80]}`),a(j,"class","field")},m(pe,me){T(pe,e,me),s(e,t),s(t,n),s(e,r),s(e,i),s(i,u),je(u,l[3].roles[l[80]].openrouter_api_key),s(e,p),s(e,d),T(pe,m,me),T(pe,_,me),s(_,g),s(g,h),s(_,y),s(_,k),s(k,w),je(w,l[3].roles[l[80]].openrouter_model),s(_,C),s(_,L),s(_,I),U&&U.m(_,null),s(_,N),s(_,E),T(pe,O,me),T(pe,Q,me),s(Q,Z),s(Z,D),D.checked=l[3].roles[l[80]].openrouter_auto_summarize,s(Z,te),s(Q,ie),s(Q,le),T(pe,H,me),T(pe,j,me),s(j,P),s(P,R),R.checked=l[3].roles[l[80]].openrouter_chat_enabled,s(P,K),T(pe,oe,me),ge&&ge.m(pe,me),T(pe,re,me),Se||(V=[ee(u,"input",ne),ee(w,"input",_e),ee(L,"click",G),ee(D,"change",X),ee(R,"change",ce)],Se=!0)},p(pe,me){var Ee;l=pe,me[0]&264&&o!==(o=`openrouter-api-key-${l[80]}`)&&a(t,"for",o),me[0]&264&&c!==(c=`openrouter-api-key-${l[80]}`)&&a(u,"id",c),me[0]&264&&u.value!==l[3].roles[l[80]].openrouter_api_key&&je(u,l[3].roles[l[80]].openrouter_api_key),me[0]&264&&v!==(v=`openrouter-model-${l[80]}`)&&a(g,"for",v),me[0]&264&&$!==($=`openrouter-model-${l[80]}`)&&a(w,"id",$),me[0]&264&&w.value!==l[3].roles[l[80]].openrouter_model&&je(w,l[3].roles[l[80]].openrouter_model),(Ee=l[0][l[80]])!=null&&Ee.length?U?U.p(l,me):(U=Go(l),U.c(),U.m(_,N)):U&&(U.d(1),U=null),me[0]&264&&A!==(A=`openrouter-auto-summarize-${l[80]}`)&&a(D,"id",A),me[0]&264&&(D.checked=l[3].roles[l[80]].openrouter_auto_summarize),me[0]&264&&q!==(q=`openrouter-auto-summarize-${l[80]}`)&&a(Z,"for",q),me[0]&264&&z!==(z=`openrouter-chat-enabled-${l[80]}`)&&a(R,"id",z),me[0]&264&&(R.checked=l[3].roles[l[80]].openrouter_chat_enabled),me[0]&264&&B!==(B=`openrouter-chat-enabled-${l[80]}`)&&a(P,"for",B),l[3].roles[l[80]].openrouter_chat_enabled?ge?ge.p(l,me):(ge=Wo(l),ge.c(),ge.m(re.parentNode,re)):ge&&(ge.d(1),ge=null)},d(pe){pe&&S(e),pe&&S(m),pe&&S(_),U&&U.d(),pe&&S(O),pe&&S(Q),pe&&S(H),pe&&S(j),pe&&S(oe),ge&&ge.d(pe),pe&&S(re),Se=!1,lt(V)}}}function Go(l){let e,t,n,o,r=l[0][l[80]],i=[];for(let c=0;c<r.length;c+=1)i[c]=qo(Co(l,r,c));function u(...c){return l[57](l[80],...c)}return{c(){e=f("div"),t=f("select");for(let c=0;c<i.length;c+=1)i[c].c();a(e,"class","select is-fullwidth"),Ce(e,"margin-top","0.5rem")},m(c,p){T(c,e,p),s(e,t);for(let d=0;d<i.length;d+=1)i[d]&&i[d].m(t,null);n||(o=ee(t,"change",u),n=!0)},p(c,p){if(l=c,p[0]&9){r=l[0][l[80]];let d;for(d=0;d<r.length;d+=1){const m=Co(l,r,d);i[d]?i[d].p(m,p):(i[d]=qo(m),i[d].c(),i[d].m(t,null))}for(;d<i.length;d+=1)i[d].d(1);i.length=r.length}},d(c){c&&S(e),_t(i,c),n=!1,o()}}}function qo(l){let e,t=l[81]+"",n,o;return{c(){e=f("option"),n=M(t),e.__value=o=l[81],e.value=e.__value},m(r,i){T(r,e,i),s(e,n)},p(r,i){i[0]&9&&t!==(t=r[81]+"")&&ae(n,t),i[0]&265&&o!==(o=r[81])&&(e.__value=o,e.value=e.__value)},d(r){r&&S(e)}}}function Wo(l){let e,t,n,o,r,i,u,c,p,d,m,_,g,h,v,y,k,w,$,C,L,I,N,E,O;function Q(){l[60].call(c,l[80])}function Z(){l[61].call(I,l[80])}return{c(){e=f("div"),t=f("label"),n=M("Chat Model"),r=b(),i=f("div"),u=f("div"),c=f("select"),p=f("option"),p.textContent="GPT-3.5 Turbo",d=f("option"),d.textContent="GPT-4",m=f("option"),m.textContent="Claude 3 Sonnet",_=f("option"),_.textContent="Claude 3 Haiku",g=f("option"),g.textContent="Mixtral 8x7B",v=b(),y=f("div"),k=f("label"),w=M("System Prompt (optional)"),C=b(),L=f("div"),I=f("textarea"),a(t,"class","label"),a(t,"for",o=`openrouter-chat-model-${l[80]}`),p.__value="openai/gpt-3.5-turbo",p.value=p.__value,d.__value="openai/gpt-4",d.value=d.__value,m.__value="anthropic/claude-3-sonnet",m.value=m.__value,_.__value="anthropic/claude-3-haiku",_.value=_.__value,g.__value="mistralai/mixtral-8x7b-instruct",g.value=g.__value,a(c,"id",h=`openrouter-chat-model-${l[80]}`),l[3].roles[l[80]].openrouter_chat_model===void 0&&It(Q),a(u,"class","select is-fullwidth"),a(i,"class","control"),a(e,"class","field"),a(k,"class","label"),a(k,"for",$=`openrouter-chat-system-${l[80]}`),a(I,"class","textarea"),a(I,"id",N=`openrouter-chat-system-${l[80]}`),a(I,"rows","3"),a(I,"placeholder","You are a helpful Rust engineer assistant..."),a(L,"class","control"),a(y,"class","field")},m(D,A){T(D,e,A),s(e,t),s(t,n),s(e,r),s(e,i),s(i,u),s(u,c),s(c,p),s(c,d),s(c,m),s(c,_),s(c,g),nt(c,l[3].roles[l[80]].openrouter_chat_model,!0),T(D,v,A),T(D,y,A),s(y,k),s(k,w),s(y,C),s(y,L),s(L,I),je(I,l[3].roles[l[80]].openrouter_chat_system_prompt),E||(O=[ee(c,"change",Q),ee(I,"input",Z)],E=!0)},p(D,A){l=D,A[0]&264&&o!==(o=`openrouter-chat-model-${l[80]}`)&&a(t,"for",o),A[0]&264&&h!==(h=`openrouter-chat-model-${l[80]}`)&&a(c,"id",h),A[0]&264&&nt(c,l[3].roles[l[80]].openrouter_chat_model),A[0]&264&&$!==($=`openrouter-chat-system-${l[80]}`)&&a(k,"for",$),A[0]&264&&N!==(N=`openrouter-chat-system-${l[80]}`)&&a(I,"id",N),A[0]&264&&je(I,l[3].roles[l[80]].openrouter_chat_system_prompt)},d(D){D&&S(e),D&&S(v),D&&S(y),E=!1,lt(O)}}}function Jo(l){let e;return{c(){e=f("p"),e.textContent="Click to select directory",a(e,"class","help")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function Bo(l,e){let t,n,o,r,i,u,c,p,d,m,_,g,h,v,y,k,w,$,C,L,I,N,E,O,Q,Z,D,A,te,q,ie,le,H,j,P,R,z,K,B,oe,re,Se,V,ne,_e,G,U,X,ce,ge,ue,pe,me,Ee,Je,Qe,$e,Ie,he,Ae,Ve,Be,Me,Re,et,ft,tt,Ke,Ye,dt,Fe,ot,Ze,F,W,se,Pe,Oe,ye,st,rt,xe,it,wt,Rt,St,tl,Xt,jt,Tt,Ht,Y,fe,ve,Ne,Ue,De,xt,Et,gt,ct,el,al,ll,ht,At,Bt,Il,Mt,Lt,hl,cl,zl,Cl,yt,de,Te,Ft,nl,vl,Dt,ul,bl,fl,Kl,dn,Gl,pn,Sl,dl,ql,mn,Wl,_n,gn,hn,Tl,vn,Jl,xl,bn;function vi(){e[26].call(p,e[80])}function bi(){e[27].call(w,e[80])}let Ll=e[8],zt=[];for(let ut=0;ut<Ll.length;ut+=1)zt[ut]=Io(Ro(e,Ll,ut));function kn(){e[28].call(D,e[80])}function wn(){e[29].call(z,e[80])}function ki(){e[30].call(U,e[80])}let El=e[78].haystacks,Kt=[];for(let ut=0;ut<El.length;ut+=1)Kt[ut]=jo(To(e,El,ut));function wi(){return e[46](e[80])}function yn(){e[47].call(Ke,e[80])}let Gt=e[3].roles[e[80]].llm_provider==="ollama"&&Ho(e);function yi(){e[53].call(rt,e[80])}let qt=e[3].roles[e[80]].openrouter_enabled&&Ko(e);function Ci(){e[62].call(De,e[80])}function Si(){e[63].call(At,e[80])}function Cn(){return e[64](e[80])}let Qt=e[4]&&Jo();function Sn(){e[65].call(Te,e[80])}function Ti(){e[66].call(fl,e[80])}function $i(){e[67].call(dl,e[80])}function Ri(){return e[68](e[80])}return{key:l,first:null,c(){t=f("div"),n=f("div"),o=f("label"),r=M("Role name"),u=b(),c=f("div"),p=f("input"),m=b(),_=f("div"),g=f("label"),h=M("Short name"),y=b(),k=f("div"),w=f("input"),C=b(),L=f("div"),I=f("label"),N=M("Theme"),O=b(),Q=f("div"),Z=f("div"),D=f("select");for(let ut=0;ut<zt.length;ut+=1)zt[ut].c();te=b(),q=f("div"),ie=f("label"),le=M("Relevance function"),j=b(),P=f("div"),R=f("div"),z=f("select"),K=f("option"),K.textContent="title-scorer",B=f("option"),B.textContent="terraphim-graph",oe=f("option"),oe.textContent="bm25",re=f("option"),re.textContent="bm25f",Se=f("option"),Se.textContent="bm25plus",ne=b(),_e=f("div"),G=f("label"),U=f("input"),ce=M(`
            Enable Terraphim IT features (KG preprocessing, auto-linking)`),ue=b(),pe=f("h5"),pe.textContent="Haystacks",me=b();for(let ut=0;ut<Kt.length;ut+=1)Kt[ut].c();Ee=b(),Je=f("button"),Qe=M("Add Haystack"),Ie=b(),he=f("h5"),he.textContent="AI-Enhanced Summaries (LLM Provider)",Ae=b(),Ve=f("div"),Be=f("label"),Me=M("Provider"),et=b(),ft=f("div"),tt=f("div"),Ke=f("select"),Ye=f("option"),Ye.textContent="(none)",dt=f("option"),dt.textContent="OpenRouter",Fe=f("option"),Fe.textContent="Ollama (local)",Ze=b(),F=f("p"),F.textContent="Choose a provider. OpenRouter uses API key; Ollama runs locally.",W=b(),Gt&&Gt.c(),se=b(),Pe=f("h5"),Pe.textContent="AI-Enhanced Summaries (OpenRouter)",Oe=b(),ye=f("div"),st=f("label"),rt=f("input"),it=M(`
            ¬†Enable AI-generated article summaries`),Rt=b(),St=f("p"),St.textContent="Generate intelligent summaries using OpenRouter's language models",tl=b(),qt&&qt.c(),Xt=b(),jt=f("h5"),jt.textContent="Knowledge Graph",Tt=b(),Ht=f("div"),Y=f("label"),fe=M("Remote automata URL"),Ne=b(),Ue=f("div"),De=f("input"),Et=b(),gt=f("div"),ct=f("label"),el=M("Local KG path"),ll=b(),ht=f("div"),At=f("input"),Il=b(),Qt&&Qt.c(),Mt=b(),Lt=f("div"),hl=f("div"),cl=f("label"),zl=M("Local KG type"),yt=b(),de=f("div"),Te=f("select"),Ft=f("option"),Ft.textContent="markdown",nl=f("option"),nl.textContent="json",Dt=b(),ul=f("div"),bl=f("label"),fl=f("input"),dn=M(`
            ¬†Public`),pn=b(),Sl=f("label"),dl=f("input"),mn=M(`
            ¬†Publish`),_n=b(),gn=f("hr"),hn=b(),Tl=f("button"),vn=M("Remove Role"),a(o,"class","label"),a(o,"for",i=`role-name-${e[80]}`),a(p,"class","input"),a(p,"id",d=`role-name-${e[80]}`),a(p,"type","text"),a(c,"class","control"),a(n,"class","field"),a(g,"class","label"),a(g,"for",v=`role-shortname-${e[80]}`),a(w,"class","input"),a(w,"id",$=`role-shortname-${e[80]}`),a(w,"type","text"),a(k,"class","control"),a(_,"class","field"),a(I,"class","label"),a(I,"for",E=`role-theme-${e[80]}`),a(D,"id",A=`role-theme-${e[80]}`),e[3].roles[e[80]].theme===void 0&&It(kn),a(Z,"class","select is-fullwidth"),a(Q,"class","control"),a(L,"class","field"),a(ie,"class","label"),a(ie,"for",H=`role-relevance-${e[80]}`),K.__value="title-scorer",K.value=K.__value,B.__value="terraphim-graph",B.value=B.__value,oe.__value="bm25",oe.value=oe.__value,re.__value="bm25f",re.value=re.__value,Se.__value="bm25plus",Se.value=Se.__value,a(z,"id",V=`role-relevance-${e[80]}`),e[3].roles[e[80]].relevance_function===void 0&&It(wn),a(R,"class","select is-fullwidth"),a(P,"class","control"),a(q,"class","field"),a(U,"class","checkbox"),a(U,"id",X=`role-terraphim-it-${e[80]}`),a(U,"type","checkbox"),a(G,"class","label"),a(G,"for",ge=`role-terraphim-it-${e[80]}`),a(_e,"class","field"),a(pe,"class","title is-6"),a(Je,"class","button is-small"),a(Je,"data-testid",$e="add-haystack-"+e[80]),a(he,"class","title is-6"),a(Be,"class","label"),a(Be,"for",Re=`llm-provider-${e[80]}`),Ye.__value="",Ye.value=Ye.__value,dt.__value="openrouter",dt.value=dt.__value,Fe.__value="ollama",Fe.value=Fe.__value,a(Ke,"id",ot=`llm-provider-${e[80]}`),e[3].roles[e[80]].llm_provider===void 0&&It(yn),a(tt,"class","select"),a(ft,"class","control"),a(F,"class","help"),a(Ve,"class","field"),a(Pe,"class","title is-6"),a(rt,"id",xe=`openrouter-enabled-${e[80]}`),a(rt,"type","checkbox"),a(st,"class","checkbox"),a(st,"for",wt=`openrouter-enabled-${e[80]}`),a(St,"class","help"),a(ye,"class","field"),a(jt,"class","title is-6"),a(Y,"class","label"),a(Y,"for",ve=`kg-url-${e[80]}`),a(De,"class","input"),a(De,"id",xt=`kg-url-${e[80]}`),a(De,"type","text"),a(De,"placeholder","https://example.com/thesaurus.json"),a(Ue,"class","control"),a(Ht,"class","field"),a(ct,"class","label"),a(ct,"for",al=`kg-local-path-${e[80]}`),a(At,"class","input"),a(At,"id",Bt=`kg-local-path-${e[80]}`),a(At,"type","text"),a(At,"placeholder","/path/to/markdown"),At.readOnly=e[4],a(ht,"class","control"),a(gt,"class","field"),a(cl,"class","label"),a(cl,"for",Cl=`kg-local-type-${e[80]}`),Ft.__value="markdown",Ft.value=Ft.__value,nl.__value="json",nl.value=nl.__value,a(Te,"id",vl=`kg-local-type-${e[80]}`),e[3].roles[e[80]].kg.local_type===void 0&&It(Sn),a(de,"class","select"),a(hl,"class","control"),a(Lt,"class","field is-grouped"),a(fl,"id",Kl=`kg-public-${e[80]}`),a(fl,"type","checkbox"),a(bl,"class","checkbox"),a(bl,"for",Gl=`kg-public-${e[80]}`),Ce(bl,"margin-right","1rem"),a(dl,"id",ql=`kg-publish-${e[80]}`),a(dl,"type","checkbox"),a(Sl,"class","checkbox"),a(Sl,"for",Wl=`kg-publish-${e[80]}`),a(ul,"class","field is-grouped"),a(Tl,"class","button is-small is-danger"),a(Tl,"data-testid",Jl="remove-role-"+e[80]),a(t,"class","box"),this.first=t},m(ut,He){T(ut,t,He),s(t,n),s(n,o),s(o,r),s(n,u),s(n,c),s(c,p),je(p,e[3].roles[e[80]].name),s(t,m),s(t,_),s(_,g),s(g,h),s(_,y),s(_,k),s(k,w),je(w,e[3].roles[e[80]].shortname),s(t,C),s(t,L),s(L,I),s(I,N),s(L,O),s(L,Q),s(Q,Z),s(Z,D);for(let Xe=0;Xe<zt.length;Xe+=1)zt[Xe]&&zt[Xe].m(D,null);nt(D,e[3].roles[e[80]].theme,!0),s(t,te),s(t,q),s(q,ie),s(ie,le),s(q,j),s(q,P),s(P,R),s(R,z),s(z,K),s(z,B),s(z,oe),s(z,re),s(z,Se),nt(z,e[3].roles[e[80]].relevance_function,!0),s(t,ne),s(t,_e),s(_e,G),s(G,U),U.checked=e[3].roles[e[80]].terraphim_it,s(G,ce),s(t,ue),s(t,pe),s(t,me);for(let Xe=0;Xe<Kt.length;Xe+=1)Kt[Xe]&&Kt[Xe].m(t,null);s(t,Ee),s(t,Je),s(Je,Qe),s(t,Ie),s(t,he),s(t,Ae),s(t,Ve),s(Ve,Be),s(Be,Me),s(Ve,et),s(Ve,ft),s(ft,tt),s(tt,Ke),s(Ke,Ye),s(Ke,dt),s(Ke,Fe),nt(Ke,e[3].roles[e[80]].llm_provider,!0),s(Ve,Ze),s(Ve,F),s(t,W),Gt&&Gt.m(t,null),s(t,se),s(t,Pe),s(t,Oe),s(t,ye),s(ye,st),s(st,rt),rt.checked=e[3].roles[e[80]].openrouter_enabled,s(st,it),s(ye,Rt),s(ye,St),s(t,tl),qt&&qt.m(t,null),s(t,Xt),s(t,jt),s(t,Tt),s(t,Ht),s(Ht,Y),s(Y,fe),s(Ht,Ne),s(Ht,Ue),s(Ue,De),je(De,e[3].roles[e[80]].kg.url),s(t,Et),s(t,gt),s(gt,ct),s(ct,el),s(gt,ll),s(gt,ht),s(ht,At),je(At,e[3].roles[e[80]].kg.local_path),s(ht,Il),Qt&&Qt.m(ht,null),s(t,Mt),s(t,Lt),s(Lt,hl),s(hl,cl),s(cl,zl),s(hl,yt),s(hl,de),s(de,Te),s(Te,Ft),s(Te,nl),nt(Te,e[3].roles[e[80]].kg.local_type,!0),s(t,Dt),s(t,ul),s(ul,bl),s(bl,fl),fl.checked=e[3].roles[e[80]].kg.public,s(bl,dn),s(ul,pn),s(ul,Sl),s(Sl,dl),dl.checked=e[3].roles[e[80]].kg.publish,s(Sl,mn),s(t,_n),s(t,gn),s(t,hn),s(t,Tl),s(Tl,vn),xl||(bn=[ee(p,"input",vi),ee(w,"input",bi),ee(D,"change",kn),ee(z,"change",wn),ee(U,"change",ki),ee(Je,"click",wi),ee(Ke,"change",yn),ee(rt,"change",yi),ee(De,"input",Ci),ee(At,"input",Si),ee(At,"click",function(){Hl(e[4]?Cn:void 0)&&(e[4]?Cn:void 0).apply(this,arguments)}),ee(Te,"change",Sn),ee(fl,"change",Ti),ee(dl,"change",$i),ee(Tl,"click",Ri)],xl=!0)},p(ut,He){if(e=ut,He[0]&264&&i!==(i=`role-name-${e[80]}`)&&a(o,"for",i),He[0]&264&&d!==(d=`role-name-${e[80]}`)&&a(p,"id",d),He[0]&264&&p.value!==e[3].roles[e[80]].name&&je(p,e[3].roles[e[80]].name),He[0]&264&&v!==(v=`role-shortname-${e[80]}`)&&a(g,"for",v),He[0]&264&&$!==($=`role-shortname-${e[80]}`)&&a(w,"id",$),He[0]&264&&w.value!==e[3].roles[e[80]].shortname&&je(w,e[3].roles[e[80]].shortname),He[0]&264&&E!==(E=`role-theme-${e[80]}`)&&a(I,"for",E),He[0]&256){Ll=e[8];let Xe;for(Xe=0;Xe<Ll.length;Xe+=1){const Ol=Ro(e,Ll,Xe);zt[Xe]?zt[Xe].p(Ol,He):(zt[Xe]=Io(Ol),zt[Xe].c(),zt[Xe].m(D,null))}for(;Xe<zt.length;Xe+=1)zt[Xe].d(1);zt.length=Ll.length}if(He[0]&264&&A!==(A=`role-theme-${e[80]}`)&&a(D,"id",A),He[0]&264&&nt(D,e[3].roles[e[80]].theme),He[0]&264&&H!==(H=`role-relevance-${e[80]}`)&&a(ie,"for",H),He[0]&264&&V!==(V=`role-relevance-${e[80]}`)&&a(z,"id",V),He[0]&264&&nt(z,e[3].roles[e[80]].relevance_function),He[0]&264&&X!==(X=`role-terraphim-it-${e[80]}`)&&a(U,"id",X),He[0]&264&&(U.checked=e[3].roles[e[80]].terraphim_it),He[0]&264&&ge!==(ge=`role-terraphim-it-${e[80]}`)&&a(G,"for",ge),He[0]&491576){El=e[78].haystacks;let Xe;for(Xe=0;Xe<El.length;Xe+=1){const Ol=To(e,El,Xe);Kt[Xe]?Kt[Xe].p(Ol,He):(Kt[Xe]=jo(Ol),Kt[Xe].c(),Kt[Xe].m(t,Ee))}for(;Xe<Kt.length;Xe+=1)Kt[Xe].d(1);Kt.length=El.length}He[0]&264&&$e!==($e="add-haystack-"+e[80])&&a(Je,"data-testid",$e),He[0]&264&&Re!==(Re=`llm-provider-${e[80]}`)&&a(Be,"for",Re),He[0]&264&&ot!==(ot=`llm-provider-${e[80]}`)&&a(Ke,"id",ot),He[0]&264&&nt(Ke,e[3].roles[e[80]].llm_provider),e[3].roles[e[80]].llm_provider==="ollama"?Gt?Gt.p(e,He):(Gt=Ho(e),Gt.c(),Gt.m(t,se)):Gt&&(Gt.d(1),Gt=null),He[0]&264&&xe!==(xe=`openrouter-enabled-${e[80]}`)&&a(rt,"id",xe),He[0]&264&&(rt.checked=e[3].roles[e[80]].openrouter_enabled),He[0]&264&&wt!==(wt=`openrouter-enabled-${e[80]}`)&&a(st,"for",wt),e[3].roles[e[80]].openrouter_enabled?qt?qt.p(e,He):(qt=Ko(e),qt.c(),qt.m(t,Xt)):qt&&(qt.d(1),qt=null),He[0]&264&&ve!==(ve=`kg-url-${e[80]}`)&&a(Y,"for",ve),He[0]&264&&xt!==(xt=`kg-url-${e[80]}`)&&a(De,"id",xt),He[0]&264&&De.value!==e[3].roles[e[80]].kg.url&&je(De,e[3].roles[e[80]].kg.url),He[0]&264&&al!==(al=`kg-local-path-${e[80]}`)&&a(ct,"for",al),He[0]&264&&Bt!==(Bt=`kg-local-path-${e[80]}`)&&a(At,"id",Bt),He[0]&16&&(At.readOnly=e[4]),He[0]&264&&At.value!==e[3].roles[e[80]].kg.local_path&&je(At,e[3].roles[e[80]].kg.local_path),e[4]?Qt||(Qt=Jo(),Qt.c(),Qt.m(ht,null)):Qt&&(Qt.d(1),Qt=null),He[0]&264&&Cl!==(Cl=`kg-local-type-${e[80]}`)&&a(cl,"for",Cl),He[0]&264&&vl!==(vl=`kg-local-type-${e[80]}`)&&a(Te,"id",vl),He[0]&264&&nt(Te,e[3].roles[e[80]].kg.local_type),He[0]&264&&Kl!==(Kl=`kg-public-${e[80]}`)&&a(fl,"id",Kl),He[0]&264&&(fl.checked=e[3].roles[e[80]].kg.public),He[0]&264&&Gl!==(Gl=`kg-public-${e[80]}`)&&a(bl,"for",Gl),He[0]&264&&ql!==(ql=`kg-publish-${e[80]}`)&&a(dl,"id",ql),He[0]&264&&(dl.checked=e[3].roles[e[80]].kg.publish),He[0]&264&&Wl!==(Wl=`kg-publish-${e[80]}`)&&a(Sl,"for",Wl),He[0]&264&&Jl!==(Jl="remove-role-"+e[80])&&a(Tl,"data-testid",Jl)},d(ut){ut&&S(t),_t(zt,ut),_t(Kt,ut),Gt&&Gt.d(),qt&&qt.d(),Qt&&Qt.d(),xl=!1,lt(bn)}}}function Qo(l){let e,t=l[75]+"",n;return{c(){e=f("option"),n=M(t),e.__value=l[75],e.value=e.__value},m(o,r){T(o,e,r),s(e,n)},p:Le,d(o){o&&S(e)}}}function Vo(l){let e,t=l[72].name+"",n,o;return{c(){e=f("option"),n=M(t),e.__value=o=l[72].name,e.value=e.__value},m(r,i){T(r,e,i),s(e,n)},p(r,i){i[0]&8&&t!==(t=r[72].name+"")&&ae(n,t),i[0]&264&&o!==(o=r[72].name)&&(e.__value=o,e.value=e.__value)},d(r){r&&S(e)}}}function Yo(l){let e,t,n;return{c(){e=f("button"),e.textContent="Back",a(e,"class","button"),a(e,"data-testid","wizard-back")},m(o,r){T(o,e,r),t||(n=ee(e,"click",l[11]),t=!0)},p:Le,d(o){o&&S(e),t=!1,n()}}}function qa(l){let e,t,n;return{c(){e=f("button"),e.textContent="Save",a(e,"class","button is-success"),a(e,"data-testid","wizard-save")},m(o,r){T(o,e,r),t||(n=ee(e,"click",l[19]),t=!0)},p:Le,d(o){o&&S(e),t=!1,n()}}}function Wa(l){let e,t,n;return{c(){e=f("button"),e.textContent="Next",a(e,"class","button is-primary"),a(e,"data-testid","wizard-next")},m(o,r){T(o,e,r),t||(n=ee(e,"click",l[10]),t=!0)},p:Le,d(o){o&&S(e),t=!1,n()}}}function Ja(l){let e,t,n,o,r,i,u,c,p,d,m,_,g,h,v,y=l[2]==="success"&&Ao(l),k=l[2]==="error"&&Do(l);function w(O,Q){return O[1]===1?za:O[1]===2?Fa:Ha}let $=w(l),C=$(l),L=l[1]>1&&Yo(l);function I(O,Q){return O[1]<hi?Wa:qa}let N=I(l),E=N(l);return{c(){e=f("div"),t=f("div"),n=f("h3"),n.textContent="Configuration Wizard",o=b(),r=f("button"),r.textContent="Close",i=b(),y&&y.c(),u=b(),k&&k.c(),c=b(),C.c(),p=b(),d=f("nav"),m=f("div"),L&&L.c(),_=b(),g=f("div"),E.c(),a(n,"class","title is-4"),Ce(n,"margin-bottom","0"),a(r,"class","button is-small is-light"),a(r,"aria-label","Close configuration wizard"),a(t,"class","is-flex is-justify-content-space-between is-align-items-center"),Ce(t,"gap",".5rem"),a(m,"class","level-left"),a(g,"class","level-right"),a(d,"class","level"),a(e,"class","box")},m(O,Q){T(O,e,Q),s(e,t),s(t,n),s(t,o),s(t,r),s(e,i),y&&y.m(e,null),s(e,u),k&&k.m(e,null),s(e,c),C.m(e,null),s(e,p),s(e,d),s(d,m),L&&L.m(m,null),s(d,_),s(d,g),E.m(g,null),h||(v=ee(r,"click",Ba),h=!0)},p(O,Q){O[2]==="success"?y?y.p(O,Q):(y=Ao(O),y.c(),y.m(e,u)):y&&(y.d(1),y=null),O[2]==="error"?k?k.p(O,Q):(k=Do(O),k.c(),k.m(e,c)):k&&(k.d(1),k=null),$===($=w(O))&&C?C.p(O,Q):(C.d(1),C=$(O),C&&(C.c(),C.m(e,p))),O[1]>1?L?L.p(O,Q):(L=Yo(O),L.c(),L.m(m,null)):L&&(L.d(1),L=null),N===(N=I(O))&&E?E.p(O,Q):(E.d(1),E=N(O),E&&(E.c(),E.m(g,null)))},i:Le,o:Le,d(O){O&&S(e),y&&y.d(),k&&k.d(),C.d(),L&&L.d(),E.d(),h=!1,v()}}}const hi=3;function Ba(){typeof window<"u"&&window.history.back()}function Qa(l,e,t){let n,o;Ge(l,vt,F=>t(4,o=F));const r=Zt(null);async function i(F,W){if($t(vt))try{const se=await sn({directory:!0,multiple:!1});se&&typeof se=="string"&&c.update(Pe=>(Pe.roles[F].haystacks[W].path=se,Pe))}catch(se){console.error("Failed to open folder selector:",se)}}async function u(F){if($t(vt))try{const W=await sn({directory:!0,multiple:!1});W&&typeof W=="string"&&c.update(se=>(se.roles[F].kg.local_path=W,se))}catch(W){console.error("Failed to open folder selector:",W)}}const c=Zt({id:"Desktop",global_shortcut:"Ctrl+X",default_theme:"spacelab",default_role:"Default",roles:[]});Ge(l,c,F=>t(3,n=F));const p=["default","darkly","cerulean","cosmo","cyborg","flatly","journal","litera","lumen","lux","materia","minty","nuclear","pulse","sandstone","simplex","slate","solar","spacelab","superhero","united","yeti"];wl(async()=>{try{let F;$t(vt)?F=await ze("get_config_schema"):F=await(await fetch("/config/schema")).json(),r.set(F);const W=$t(Jt);W&&W.id&&c.update(se=>{var Pe;return{...se,id:W.id,global_shortcut:W.global_shortcut,default_theme:((Pe=W.roles[W.default_role])==null?void 0:Pe.theme)??"spacelab",default_role:W.default_role,roles:Object.values(W.roles).map(Oe=>{var xe,it,wt,Rt,St,tl,Xt,jt,Tt,Ht,Y;const ye=(xe=Oe.kg)==null?void 0:xe.automata_path,st=(ye==null?void 0:ye.Remote)??"",rt=((wt=(it=Oe.kg)==null?void 0:it.knowledge_graph_local)==null?void 0:wt.path)??"";return{name:Oe.name,shortname:Oe.shortname,relevance_function:Oe.relevance_function,terraphim_it:Oe.terraphim_it??!1,theme:Oe.theme,haystacks:(Oe.haystacks??[]).map(fe=>({path:fe.location||fe.path||"",read_only:fe.read_only??!1,service:fe.service||"Ripgrep",atomic_server_secret:fe.atomic_server_secret||"",extra_parameters:fe.extra_parameters||{},weight:fe.weight??1})),kg:{url:st,local_path:rt,local_type:((St=(Rt=Oe.kg)==null?void 0:Rt.knowledge_graph_local)==null?void 0:St.input_type)??"markdown",public:((tl=Oe.kg)==null?void 0:tl.public)??!1,publish:((Xt=Oe.kg)==null?void 0:Xt.publish)??!1},openrouter_enabled:Oe.openrouter_enabled??!1,openrouter_api_key:Oe.openrouter_api_key??"",openrouter_model:Oe.openrouter_model??"openai/gpt-3.5-turbo",openrouter_auto_summarize:Oe.openrouter_auto_summarize??!1,openrouter_chat_enabled:Oe.openrouter_chat_enabled??!1,openrouter_chat_model:Oe.openrouter_chat_model??Oe.openrouter_model??"openai/gpt-3.5-turbo",openrouter_chat_system_prompt:Oe.openrouter_chat_system_prompt??"",llm_provider:((jt=Oe.extra)==null?void 0:jt.llm_provider)??"",llm_model:((Tt=Oe.extra)==null?void 0:Tt.llm_model)??"",llm_base_url:((Ht=Oe.extra)==null?void 0:Ht.llm_base_url)??"",llm_auto_summarize:((Y=Oe.extra)==null?void 0:Y.llm_auto_summarize)??!1}})}})}catch(F){console.error("Failed to load schema",F)}}),wl(()=>{const F=W=>{W.key==="Escape"&&typeof window<"u"&&window.history.back()};return window.addEventListener("keydown",F),()=>window.removeEventListener("keydown",F)});let d={};async function m(F){var ye;const se=$t(c).roles[F],Pe=se.llm_provider||(se.openrouter_enabled?"openrouter":""),Oe=[];try{if(Pe==="ollama"){const st=(se.llm_base_url||"http://127.0.0.1:11434").replace(/\/$/,""),xe=await(await fetch(`${st}/api/tags`)).json();if(Array.isArray(xe==null?void 0:xe.models))for(const it of xe.models)it!=null&&it.name&&Oe.push(it.name)}else if(Pe==="openrouter"){const st=(ye=se.openrouter_api_key)==null?void 0:ye.trim();if(!st)throw new Error("OpenRouter API key required");const xe=await(await fetch("https://openrouter.ai/api/v1/models",{headers:{Authorization:`Bearer ${st}`,"HTTP-Referer":"https://terraphim.ai","X-Title":"Terraphim Desktop"}})).json(),it=Array.isArray(xe==null?void 0:xe.data)?xe.data:[];for(const wt of it)wt!=null&&wt.id&&Oe.push(wt.id)}}catch(st){console.error("Failed to fetch models",st)}t(0,d={...d,[F]:Oe})}let _=1,g="";function h(){_<hi&&t(1,_+=1)}function v(){_>1&&t(1,_-=1)}function y(){c.update(F=>({...F,roles:[...F.roles,{name:"New Role",shortname:"new",relevance_function:"title-scorer",terraphim_it:!1,theme:"spacelab",haystacks:[],kg:{url:"",local_path:"",local_type:"markdown",public:!1,publish:!1},openrouter_enabled:!1,openrouter_api_key:"",openrouter_model:"openai/gpt-3.5-turbo",openrouter_auto_summarize:!1,openrouter_chat_enabled:!1,openrouter_chat_model:"openai/gpt-3.5-turbo",openrouter_chat_system_prompt:"",llm_provider:"",llm_model:"",llm_base_url:"",llm_auto_summarize:!1}]}))}function k(F){c.update(W=>({...W,roles:W.roles.filter((se,Pe)=>Pe!==F)}))}function w(F){c.update(W=>(W.roles[F].haystacks.push({path:"",read_only:!1,service:"Ripgrep",atomic_server_secret:"",extra_parameters:{},weight:1}),W))}function $(F,W){c.update(se=>(se.roles[F].haystacks=se.roles[F].haystacks.filter((Pe,Oe)=>Oe!==W),se))}function C(F,W,se="",Pe=""){c.update(Oe=>{Oe.roles[F].haystacks[W].extra_parameters||(Oe.roles[F].haystacks[W].extra_parameters={});const ye=se||`param_${Date.now()}`;return Oe.roles[F].haystacks[W].extra_parameters[ye]=Pe,Oe})}function L(F,W,se){c.update(Pe=>(delete Pe.roles[F].haystacks[W].extra_parameters[se],Pe))}function I(F,W,se,Pe){c.update(Oe=>{const ye=Oe.roles[F].haystacks[W].extra_parameters;return ye[se]!==void 0&&se!==Pe&&(ye[Pe]=ye[se],delete ye[se]),Oe})}function N(F,W,se,Pe){const Oe=Pe.target.value;I(F,W,se,Oe)}async function E(){var Oe;const F=$t(c),W=$t(Jt);let se={...W};se.id=F.id,se.global_shortcut=F.global_shortcut,se.default_role=F.default_role;const Pe={};F.roles.forEach(ye=>{var it,wt;const st=ye.name,rt=st.replace(/^"|"$/g,"");Pe[rt]={extra:((wt=(it=W.roles)==null?void 0:it[st])==null?void 0:wt.extra)??{},name:ye.name,shortname:ye.shortname,theme:ye.theme,relevance_function:ye.relevance_function,terraphim_it:ye.terraphim_it??!1,haystacks:ye.haystacks.map(Rt=>({location:Rt.path,service:Rt.service,read_only:Rt.read_only,atomic_server_secret:Rt.service==="Atomic"?Rt.atomic_server_secret:void 0,extra_parameters:Rt.extra_parameters||{},weight:Rt.weight??1})),kg:ye.kg.url||ye.kg.local_path?{automata_path:ye.kg.url?{Remote:ye.kg.url}:null,knowledge_graph_local:ye.kg.local_path?{input_type:ye.kg.local_type,path:ye.kg.local_path}:null,public:ye.kg.public,publish:ye.kg.publish}:null,...ye.openrouter_enabled&&{openrouter_enabled:ye.openrouter_enabled,openrouter_api_key:ye.openrouter_api_key,openrouter_model:ye.openrouter_model,openrouter_auto_summarize:ye.openrouter_auto_summarize??!1,openrouter_chat_enabled:ye.openrouter_chat_enabled??!1,openrouter_chat_model:ye.openrouter_chat_model??ye.openrouter_model,openrouter_chat_system_prompt:ye.openrouter_chat_system_prompt??""}};const xe={};ye.llm_provider&&(xe.llm_provider=ye.llm_provider),ye.llm_model&&(xe.llm_model=ye.llm_model),ye.llm_base_url&&(xe.llm_base_url=ye.llm_base_url),typeof ye.llm_auto_summarize=="boolean"&&(xe.llm_auto_summarize=ye.llm_auto_summarize),Pe[rt].extra={...Pe[rt].extra||{},...xe}}),se.roles=Pe,(!se.default_role||!Pe[se.default_role])&&(se.default_role=((Oe=F.roles[0])==null?void 0:Oe.name)??"Default"),se.selected_role=se.default_role;try{if($t(vt))await ze("update_config",{configNew:se});else{const ye=await fetch("/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(se)});if(!ye.ok)throw new Error(`HTTP ${ye.status}: ${ye.statusText}`)}Jt.set(se),t(2,g="success"),setTimeout(()=>{t(2,g="")},3e3)}catch(ye){console.error(ye),t(2,g="error"),setTimeout(()=>{t(2,g="")},3e3)}}const O=()=>t(2,g=""),Q=()=>t(2,g="");function Z(){n.id=Wt(this),c.set(n),t(8,p)}function D(){n.global_shortcut=this.value,c.set(n),t(8,p)}function A(){n.default_theme=Wt(this),c.set(n),t(8,p)}function te(){n.default_role=Wt(this),c.set(n),t(8,p)}function q(F){n.roles[F].name=this.value,c.set(n),t(8,p)}function ie(F){n.roles[F].shortname=this.value,c.set(n),t(8,p)}function le(F){n.roles[F].theme=Wt(this),c.set(n),t(8,p)}function H(F){n.roles[F].relevance_function=Wt(this),c.set(n),t(8,p)}function j(F){n.roles[F].terraphim_it=this.checked,c.set(n),t(8,p)}function P(F,W){n.roles[F].haystacks[W].service=Wt(this),c.set(n),t(8,p)}function R(F,W){n.roles[F].haystacks[W].path=this.value,c.set(n),t(8,p)}const z=(F,W)=>i(F,W);function K(F,W){n.roles[F].haystacks[W].atomic_server_secret=this.value,c.set(n),t(8,p)}function B(F,W){n.roles[F].haystacks[W].extra_parameters.tag=this.value,c.set(n),t(8,p)}const oe=(F,W,se)=>{const Pe=se.currentTarget.value;Pe&&ol(c,n.roles[F].haystacks[W].extra_parameters.tag=Pe,n)},re=(F,W,se,Pe)=>N(F,W,se,Pe);function Se(F,W,se){n.roles[F].haystacks[W].extra_parameters[se]=this.value,c.set(n),t(8,p)}const V=(F,W,se)=>L(F,W,se),ne=(F,W)=>C(F,W,"tag","#rust"),_e=(F,W)=>C(F,W,"max_count","10"),G=(F,W)=>C(F,W,"","");function U(F,W){n.roles[F].haystacks[W].read_only=this.checked,c.set(n),t(8,p)}function X(F,W){n.roles[F].haystacks[W].weight=ri(this.value),c.set(n),t(8,p)}const ce=(F,W)=>$(F,W),ge=F=>w(F);function ue(F){n.roles[F].llm_provider=Wt(this),c.set(n),t(8,p)}function pe(F){n.roles[F].llm_model=this.value,c.set(n),t(8,p)}const me=F=>m(F),Ee=(F,W)=>{ol(c,n.roles[F].llm_model=W.currentTarget.value,n)};function Je(F){n.roles[F].llm_base_url=this.value,c.set(n),t(8,p)}function Qe(F){n.roles[F].llm_auto_summarize=this.checked,c.set(n),t(8,p)}function $e(F){n.roles[F].openrouter_enabled=this.checked,c.set(n),t(8,p)}function Ie(F){n.roles[F].openrouter_api_key=this.value,c.set(n),t(8,p)}function he(F){n.roles[F].openrouter_model=this.value,c.set(n),t(8,p)}const Ae=F=>m(F),Ve=(F,W)=>{ol(c,n.roles[F].openrouter_model=W.currentTarget.value,n)};function Be(F){n.roles[F].openrouter_auto_summarize=this.checked,c.set(n),t(8,p)}function Me(F){n.roles[F].openrouter_chat_enabled=this.checked,c.set(n),t(8,p)}function Re(F){n.roles[F].openrouter_chat_model=Wt(this),c.set(n),t(8,p)}function et(F){n.roles[F].openrouter_chat_system_prompt=this.value,c.set(n),t(8,p)}function ft(F){n.roles[F].kg.url=this.value,c.set(n),t(8,p)}function tt(F){n.roles[F].kg.local_path=this.value,c.set(n),t(8,p)}const Ke=F=>u(F);function Ye(F){n.roles[F].kg.local_type=Wt(this),c.set(n),t(8,p)}function dt(F){n.roles[F].kg.public=this.checked,c.set(n),t(8,p)}function Fe(F){n.roles[F].kg.publish=this.checked,c.set(n),t(8,p)}return[d,_,g,n,o,i,u,c,p,m,h,v,y,k,w,$,C,L,N,E,O,Q,Z,D,A,te,q,ie,le,H,j,P,R,z,K,B,oe,re,Se,V,ne,_e,G,U,X,ce,ge,ue,pe,me,Ee,Je,Qe,$e,Ie,he,Ae,Ve,Be,Me,Re,et,ft,tt,Ke,Ye,dt,Fe,F=>k(F),()=>{t(1,_=2)}]}class Va extends Pt{constructor(e){super(),Ut(this,e,Qa,Ja,Ot,{},null,[-1,-1,-1,-1])}}function Ya(l){let e,t,n,o,r,i;return r=new fi({props:{content:l[0],onChange:l[1]}}),{c(){e=f("div"),t=f("p"),t.innerHTML="<i>The best editing experience is to configure Atomic Server, in the meantime use editor below. You will need to refresh page via Command R or Ctrl-R to see changes</i>",n=b(),o=f("div"),be(r.$$.fragment),a(o,"class","editor"),a(e,"class","box")},m(u,c){T(u,e,c),s(e,t),s(e,n),s(e,o),ke(r,o,null),i=!0},p(u,[c]){const p={};c&1&&(p.content=u[0]),r.$set(p)},i(u){i||(J(r.$$.fragment,u),i=!0)},o(u){x(r.$$.fragment,u),i=!1},d(u){u&&S(e),we(r)}}}function Za(l,e,t){let n,o;Ge(l,Jt,u=>t(2,n=u)),Ge(l,vt,u=>t(3,o=u));let r={json:n};function i(u){if(console.log("contents changed:",u),console.log("is tauri",o),Jt.update(c=>(c=u.json,c)),$t(vt))console.log("Updating config on server"),ze("update_config",{configNew:u.json}).then(c=>{console.log(`Message: ${c}`)}).catch(c=>console.error(c));else{let c=`${at.ServerURL}/config/`;fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u.json)})}t(0,r=u)}return wl(()=>{t(0,r={json:n})}),[r,i]}class Xa extends Pt{constructor(e){super(),Ut(this,e,Za,Ya,Ot,{})}}const{window:rn}=Oi;function xa(l){let e,t,n,o,r,i,u,c,p,d;return{c(){e=f("div"),t=f("div"),n=f("h3"),n.textContent="Error loading graph",o=b(),r=f("p"),i=M(l[3]),u=b(),c=f("button"),c.textContent="Retry",a(c,"class","button is-primary"),a(t,"class","error-content svelte-1ry9pkl"),a(e,"class","error-overlay svelte-1ry9pkl")},m(m,_){T(m,e,_),s(e,t),s(t,n),s(t,o),s(t,r),s(r,i),s(t,u),s(t,c),p||(d=ee(c,"click",l[11]),p=!0)},p(m,_){_&8&&ae(i,m[3])},d(m){m&&S(e),p=!1,d()}}}function ec(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="loading-content svelte-1ry9pkl"><div class="loader svelte-1ry9pkl"></div> 
        <p>Loading knowledge graph...</p></div>`,a(e,"class","loading-overlay svelte-1ry9pkl")},m(t,n){T(t,e,n)},p:Le,d(t){t&&S(e)}}}function Zo(l){let e,t,n;return{c(){e=f("button"),e.innerHTML='<i class="fas fa-times svelte-1ry9pkl"></i>',a(e,"class","close-button svelte-1ry9pkl"),a(e,"title","Close Graph")},m(o,r){T(o,e,r),t||(n=ee(e,"click",l[17]),t=!0)},p:Le,d(o){o&&S(e),t=!1,n()}}}function Xo(l){let e;return{c(){e=f("div"),e.innerHTML="<span><strong>Left-click:</strong> View node ‚Ä¢ <strong>Right-click:</strong> Edit node ‚Ä¢ <strong>Drag:</strong> Move ‚Ä¢ <strong>Scroll:</strong> Zoom</span>",a(e,"class","controls-info svelte-1ry9pkl")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function xo(l){let e,t;return{c(){e=f("div"),t=M(l[8]),a(e,"class","debug-message svelte-1ry9pkl")},m(n,o){T(n,e,o),s(e,t)},p(n,o){o&256&&ae(t,n[8])},d(n){n&&S(e)}}}function es(l){let e=l[5].id,t,n,o=ts(l);return{c(){o.c(),t=Ct()},m(r,i){o.m(r,i),T(r,t,i),n=!0},p(r,i){i&32&&Ot(e,e=r[5].id)?(qe(),x(o,1,1,Le),We(),o=ts(r),o.c(),J(o,1),o.m(t.parentNode,t)):o.p(r,i)},i(r){n||(J(o),n=!0)},o(r){x(o),n=!1},d(r){r&&S(t),o.d(r)}}}function ts(l){let e,t,n;function o(i){l[18](i)}let r={item:l[5],initialEdit:l[7]};return l[6]!==void 0&&(r.active=l[6]),e=new Xl({props:r}),mt.push(()=>bt(e,"active",o)),e.$on("close",l[12]),e.$on("save",l[13]),{c(){be(e.$$.fragment)},m(i,u){ke(e,i,u),n=!0},p(i,u){const c={};u&32&&(c.item=i[5]),u&128&&(c.initialEdit=i[7]),!t&&u&64&&(t=!0,c.active=i[6],kt(()=>t=!1)),e.$set(c)},i(i){n||(J(e.$$.fragment,i),n=!0)},o(i){x(e.$$.fragment,i),n=!1},d(i){we(e,i)}}}function tc(l){let e,t,n,o,r,i,u,c,p;It(l[15]);function d(k,w){if(k[2])return ec;if(k[3])return xa}let m=d(l),_=m&&m(l),g=l[0]&&Zo(l),h=!l[2]&&!l[3]&&l[4].length>0&&Xo(),v=l[8]&&xo(l),y=l[5]&&es(l);return{c(){e=f("div"),_&&_.c(),t=b(),g&&g.c(),n=b(),h&&h.c(),o=b(),v&&v.c(),r=b(),y&&y.c(),i=Ct(),a(e,"class","graph-container svelte-1ry9pkl"),Ce(e,"width",l[0]?"100vw":"600px"),Ce(e,"height",l[0]?"100vh":"400px"),pt(e,"fullscreen",l[0])},m(k,w){T(k,e,w),_&&_.m(e,null),l[16](e),T(k,t,w),g&&g.m(k,w),T(k,n,w),h&&h.m(k,w),T(k,o,w),v&&v.m(k,w),T(k,r,w),y&&y.m(k,w),T(k,i,w),u=!0,c||(p=ee(rn,"resize",l[15]),c=!0)},p(k,[w]){m===(m=d(k))&&_?_.p(k,w):(_&&_.d(1),_=m&&m(k),_&&(_.c(),_.m(e,null))),(!u||w&1)&&Ce(e,"width",k[0]?"100vw":"600px"),(!u||w&1)&&Ce(e,"height",k[0]?"100vh":"400px"),(!u||w&1)&&pt(e,"fullscreen",k[0]),k[0]?g?g.p(k,w):(g=Zo(k),g.c(),g.m(n.parentNode,n)):g&&(g.d(1),g=null),!k[2]&&!k[3]&&k[4].length>0?h||(h=Xo(),h.c(),h.m(o.parentNode,o)):h&&(h.d(1),h=null),k[8]?v?v.p(k,w):(v=xo(k),v.c(),v.m(r.parentNode,r)):v&&(v.d(1),v=null),k[5]?y?(y.p(k,w),w&32&&J(y,1)):(y=es(k),y.c(),J(y,1),y.m(i.parentNode,i)):y&&(qe(),x(y,1,1,()=>{y=null}),We())},i(k){u||(J(y),u=!0)},o(k){x(y),u=!1},d(k){k&&S(e),_&&_.d(),l[16](null),k&&S(t),g&&g.d(k),k&&S(n),h&&h.d(k),k&&S(o),v&&v.d(k),k&&S(r),y&&y.d(k),k&&S(i),c=!1,p()}}}function ls(l){return{id:`kg-node-${l.id}`,url:`#/graph/node/${l.id}`,title:l.label,body:`# ${l.label}

**Knowledge Graph Node**

ID: ${l.id}
Rank: ${l.rank}

This is a concept node from the knowledge graph. You can edit this content to add more information about "${l.label}".`,description:`Knowledge graph concept: ${l.label}`,tags:["knowledge-graph","concept"],rank:l.rank,stub:`Knowledge graph concept: ${l.label}`}}function lc(l,e,t){let n,o;Ge(l,Nt,A=>t(20,n=A)),Ge(l,vt,A=>t(21,o=A));let{apiUrl:r="/rolegraph"}=e,{fullscreen:i=!0}=e,u,c=!0,p=null,d=[],m=[],_=null,g=!1,h=!1,v="",y=window.innerWidth,k=window.innerHeight;function w(){t(9,y=window.innerWidth),t(10,k=window.innerHeight),!c&&!p&&E()}async function $(){t(2,c=!0),t(3,p=null);try{if(o){console.log("Loading rolegraph from Tauri");const A=await ze("get_rolegraph",{role_name:n||void 0});if(A&&A.status==="success")t(4,d=A.nodes),m=A.edges;else throw new Error(`Tauri rolegraph fetch failed: ${(A==null?void 0:A.status)||"unknown error"}`)}else{console.log("Loading rolegraph from server");const A=n?`${r}?role=${encodeURIComponent(n)}`:r,te=await fetch(A);if(!te.ok)throw new Error(`Failed to fetch: ${te.status}`);const q=await te.json();t(4,d=q.nodes),m=q.edges}}catch(A){t(3,p=A.message),console.error("Error fetching rolegraph:",A)}finally{t(2,c=!1)}}function C(A,te){A.stopPropagation(),console.log("Node clicked:",te.label),t(5,_=ls(te)),t(7,h=!1),t(6,g=!0)}function L(A,te){A.preventDefault(),A.stopPropagation(),console.log("Node right-clicked:",te.label),t(8,v=`Right-clicked: ${te.label}`),t(5,_=ls(te)),t(7,h=!0),t(6,g=!0),setTimeout(()=>{t(8,v="")},2e3)}function I(){t(6,g=!1),t(5,_=null),t(7,h=!1)}async function N(){if(_)try{const A=await fetch("/documents",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(_)});A.ok?console.log("Successfully saved KG record:",_.id):console.error("Failed to save KG record:",A.statusText)}catch(A){console.error("Error saving KG record:",A)}finally{t(6,g=!1),t(5,_=null),t(7,h=!1)}}function E(){if(!u)return;t(1,u.innerHTML="",u);const A=ln(u).append("svg").attr("width",y).attr("height",k),te=qi().scaleExtent([.1,10]).on("zoom",K=>{q.attr("transform",K.transform)});A.call(te);const q=A.append("g"),ie=Wi(d).force("link",Ji(m).id(K=>K.id).distance(100)).force("charge",Bi().strength(-200)).force("center",Qi(y/2,k/2)).force("collision",Vi().radius(20)),le=q.append("g").attr("class","links").selectAll("line").data(m).enter().append("line").attr("stroke","#666").attr("stroke-opacity",.7).attr("stroke-width",K=>{const B=K.weight||K.rank||1;return Math.max(1,Math.min(8,B*2))}),H=q.append("g").attr("class","nodes").selectAll("circle").data(d).enter().append("circle").attr("r",K=>{const B=K.rank||1;return Math.max(6,Math.min(20,B*2))}).attr("fill",K=>{const B=K.rank||1,oe=Math.min(B/10,1);return Yi(.2+oe*.6)}).attr("stroke","#fff").attr("stroke-width",2).style("cursor","pointer").on("click",(K,B)=>C(K,B)).on("contextmenu",(K,B)=>L(K,B)).on("mouseover",function(K,B){ln(this).transition().duration(150).attr("stroke-width",3).attr("r",oe=>{const re=oe.rank||1;return Math.max(8,Math.min(24,re*2.5))})}).on("mouseout",function(K,B){ln(this).transition().duration(150).attr("stroke-width",2).attr("r",oe=>{const re=oe.rank||1;return Math.max(6,Math.min(20,re*2))})}).call(Zi().on("start",P).on("drag",R).on("end",z)),j=q.append("g").attr("class","labels").selectAll("text").data(d).enter().append("text").attr("text-anchor","middle").attr("dy",".35em").attr("font-size","11px").attr("font-family","Arial, sans-serif").attr("fill","#333").attr("pointer-events","none").text(K=>K.label.length>12?K.label.substring(0,12)+"...":K.label);ie.on("tick",()=>{le.attr("x1",K=>K.source.x).attr("y1",K=>K.source.y).attr("x2",K=>K.target.x).attr("y2",K=>K.target.y),H.attr("cx",K=>K.x).attr("cy",K=>K.y),j.attr("x",K=>K.x).attr("y",K=>K.y)});function P(K,B){K.active||ie.alphaTarget(.3).restart(),B.fx=B.x,B.fy=B.y}function R(K,B){B.fx=K.x,B.fy=K.y}function z(K,B){K.active||ie.alphaTarget(0),B.fx=null,B.fy=null}}wl(()=>{$().then(()=>{p||E()});const A=te=>{te.preventDefault()};return u&&u.addEventListener("contextmenu",A),window.addEventListener("resize",w),()=>{u&&u.removeEventListener("contextmenu",A),window.removeEventListener("resize",w)}});function O(){t(9,y=rn.innerWidth),t(10,k=rn.innerHeight)}function Q(A){mt[A?"unshift":"push"](()=>{u=A,t(1,u)})}const Z=()=>history.back();function D(A){g=A,t(6,g)}return l.$$set=A=>{"apiUrl"in A&&t(14,r=A.apiUrl),"fullscreen"in A&&t(0,i=A.fullscreen)},[i,u,c,p,d,_,g,h,v,y,k,$,I,N,r,O,Q,Z,D]}class nc extends Pt{constructor(e){super(),Ut(this,e,lc,tc,Ot,{apiUrl:14,fullscreen:0})}}function ns(l,e,t){const n=l.slice();return n[19]=e[t][0],n[20]=e[t][1],n[21]=e,n[22]=t,n}function os(l,e,t){const n=l.slice();return n[23]=e[t],n}function ss(l){let e,t,n,o,r,i,u,c,p,d,m,_,g,h,v=l[2].title.trim()==="",y,k,w,$,C,L,I,N,E,O,Q,Z,D,A,te,q=l[2].content.trim()==="",ie,le,H,j,P,R,z,K,B,oe,re,Se,V,ne,_e,G,U,X,ce,ge,ue,pe=l[1]==="edit"?"Save Changes":"Add Context",me,Ee,Je,Qe,$e,Ie,he,Ae,Ve,Be,Me=l[4],Re=[];for(let F=0;F<Me.length;F+=1)Re[F]=is(os(l,Me,F));let et=v&&rs();function ft(F,W){return F[2].summary?sc:oc}let tt=ft(l),Ke=tt(l),Ye=q&&as();function dt(F,W){return W&4&&(re=null),re==null&&(re=Object.keys(F[2].metadata).length===0),re?rc:ic}let Fe=dt(l,-1),ot=Fe(l),Ze=l[1]==="edit"&&us(l);return{c(){e=f("section"),t=f("div"),n=f("label"),n.textContent="Type",o=b(),r=f("div"),i=f("div"),u=f("select");for(let F=0;F<Re.length;F+=1)Re[F].c();c=b(),p=f("div"),d=f("label"),d.textContent="Title *",m=b(),_=f("div"),g=f("input"),h=b(),et&&et.c(),y=b(),k=f("div"),w=f("label"),w.textContent="Summary",$=b(),C=f("div"),L=f("textarea"),I=b(),N=f("p"),Ke.c(),E=b(),O=f("div"),Q=f("label"),Q.textContent="Content *",Z=b(),D=f("div"),A=f("textarea"),te=b(),Ye&&Ye.c(),ie=b(),le=f("details"),H=f("summary"),H.innerHTML=`<span class="icon-text"><span class="icon"><i class="fas fa-cog"></i></span> 
              <span>Advanced Options</span></span>`,j=b(),P=f("div"),R=f("label"),R.textContent="Metadata",z=b(),K=f("div"),B=f("p"),B.textContent="Additional key-value pairs for this context item",oe=b(),ot.c(),Se=b(),V=f("button"),V.innerHTML=`<span class="icon"><i class="fas fa-plus"></i></span> 
                <span>Add Metadata</span>`,ne=b(),_e=f("footer"),G=f("div"),U=f("div"),X=f("button"),ce=f("span"),ce.innerHTML='<i class="fas fa-save"></i>',ge=b(),ue=f("span"),me=M(pe),Je=b(),Qe=f("div"),$e=f("button"),$e.innerHTML="<span>Cancel</span>",Ie=b(),Ze&&Ze.c(),he=b(),Ae=f("div"),Ae.innerHTML=`<strong>Keyboard shortcuts:</strong>
          Ctrl/Cmd + Enter to save, Escape to close`,a(n,"class","label"),a(n,"for","context-type"),a(u,"id","context-type"),a(u,"data-testid","context-type-select"),l[2].context_type===void 0&&It(()=>l[10].call(u)),a(i,"class","select is-fullwidth"),a(r,"class","control"),a(t,"class","field"),a(d,"class","label"),a(d,"for","context-title"),a(g,"id","context-title"),a(g,"class","input"),a(g,"type","text"),a(g,"placeholder","Enter title..."),a(g,"data-testid","context-title-input"),g.required=!0,a(_,"class","control"),a(p,"class","field"),a(w,"class","label"),a(w,"for","context-summary"),a(L,"id","context-summary"),a(L,"class","textarea svelte-1oesbw7"),a(L,"placeholder","Brief summary of the content (optional)..."),a(L,"data-testid","context-summary-textarea"),a(L,"rows","3"),a(L,"maxlength","500"),a(C,"class","control"),a(N,"class","help svelte-1oesbw7"),a(k,"class","field"),a(Q,"class","label"),a(Q,"for","context-content"),a(A,"id","context-content"),a(A,"class","textarea svelte-1oesbw7"),a(A,"placeholder","Enter the full content..."),a(A,"data-testid","context-content-textarea"),a(A,"rows","8"),A.required=!0,a(D,"class","control"),a(O,"class","field"),a(H,"class","summary svelte-1oesbw7"),a(R,"class","label"),a(B,"class","help svelte-1oesbw7"),a(V,"class","button is-small is-light"),a(K,"class","content"),a(P,"class","field mt-4"),a(le,"class","details svelte-1oesbw7"),a(e,"class","modal-card-body svelte-1oesbw7"),a(ce,"class","icon"),a(X,"class","button is-primary"),X.disabled=Ee=!l[3],a(X,"data-testid","save-context-button"),a(U,"class","control"),a($e,"class","button is-light"),a($e,"data-testid","cancel-context-button"),a(Qe,"class","control"),a(G,"class","field is-grouped"),a(Ae,"class","help svelte-1oesbw7"),a(_e,"class","modal-card-foot")},m(F,W){T(F,e,W),s(e,t),s(t,n),s(t,o),s(t,r),s(r,i),s(i,u);for(let se=0;se<Re.length;se+=1)Re[se]&&Re[se].m(u,null);nt(u,l[2].context_type,!0),s(e,c),s(e,p),s(p,d),s(p,m),s(p,_),s(_,g),je(g,l[2].title),s(p,h),et&&et.m(p,null),s(e,y),s(e,k),s(k,w),s(k,$),s(k,C),s(C,L),je(L,l[2].summary),s(k,I),s(k,N),Ke.m(N,null),s(e,E),s(e,O),s(O,Q),s(O,Z),s(O,D),s(D,A),je(A,l[2].content),s(O,te),Ye&&Ye.m(O,null),s(e,ie),s(e,le),s(le,H),s(le,j),s(le,P),s(P,R),s(P,z),s(P,K),s(K,B),s(K,oe),ot.m(K,null),s(K,Se),s(K,V),T(F,ne,W),T(F,_e,W),s(_e,G),s(G,U),s(U,X),s(X,ce),s(X,ge),s(X,ue),s(ue,me),s(G,Je),s(G,Qe),s(Qe,$e),s(G,Ie),Ze&&Ze.m(G,null),s(_e,he),s(_e,Ae),Ve||(Be=[ee(u,"change",l[10]),ee(g,"input",l[11]),ee(L,"input",l[12]),ee(A,"input",l[13]),ee(V,"click",l[17]),ee(X,"click",l[6]),ee($e,"click",l[5])],Ve=!0)},p(F,W){if(W&16){Me=F[4];let se;for(se=0;se<Me.length;se+=1){const Pe=os(F,Me,se);Re[se]?Re[se].p(Pe,W):(Re[se]=is(Pe),Re[se].c(),Re[se].m(u,null))}for(;se<Re.length;se+=1)Re[se].d(1);Re.length=Me.length}W&20&&nt(u,F[2].context_type),W&20&&g.value!==F[2].title&&je(g,F[2].title),W&4&&(v=F[2].title.trim()===""),v?et||(et=rs(),et.c(),et.m(p,null)):et&&(et.d(1),et=null),W&20&&je(L,F[2].summary),tt===(tt=ft(F))&&Ke?Ke.p(F,W):(Ke.d(1),Ke=tt(F),Ke&&(Ke.c(),Ke.m(N,null))),W&20&&je(A,F[2].content),W&4&&(q=F[2].content.trim()===""),q?Ye||(Ye=as(),Ye.c(),Ye.m(O,null)):Ye&&(Ye.d(1),Ye=null),Fe===(Fe=dt(F,W))&&ot?ot.p(F,W):(ot.d(1),ot=Fe(F),ot&&(ot.c(),ot.m(K,Se))),W&2&&pe!==(pe=F[1]==="edit"?"Save Changes":"Add Context")&&ae(me,pe),W&8&&Ee!==(Ee=!F[3])&&(X.disabled=Ee),F[1]==="edit"?Ze?Ze.p(F,W):(Ze=us(F),Ze.c(),Ze.m(G,null)):Ze&&(Ze.d(1),Ze=null)},d(F){F&&S(e),_t(Re,F),et&&et.d(),Ke.d(),Ye&&Ye.d(),ot.d(),F&&S(ne),F&&S(_e),Ze&&Ze.d(),Ve=!1,lt(Be)}}}function is(l){let e,t=l[23].label+"",n;return{c(){e=f("option"),n=M(t),e.__value=l[23].value,e.value=e.__value},m(o,r){T(o,e,r),s(e,n)},p:Le,d(o){o&&S(e)}}}function rs(l){let e;return{c(){e=f("p"),e.textContent="Title is required",a(e,"class","help is-danger svelte-1oesbw7")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function oc(l){let e;return{c(){e=M("Optional brief summary (up to 500 characters)")},m(t,n){T(t,e,n)},p:Le,d(t){t&&S(e)}}}function sc(l){let e=l[2].summary.length+"",t,n;return{c(){t=M(e),n=M("/500 characters")},m(o,r){T(o,t,r),T(o,n,r)},p(o,r){r&4&&e!==(e=o[2].summary.length+"")&&ae(t,e)},d(o){o&&S(t),o&&S(n)}}}function as(l){let e;return{c(){e=f("p"),e.textContent="Content is required",a(e,"class","help is-danger svelte-1oesbw7")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function ic(l){let e,t=Object.entries(l[2].metadata),n=[];for(let o=0;o<t.length;o+=1)n[o]=cs(ns(l,t,o));return{c(){for(let o=0;o<n.length;o+=1)n[o].c();e=Ct()},m(o,r){for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(o,r);T(o,e,r)},p(o,r){if(r&4){t=Object.entries(o[2].metadata);let i;for(i=0;i<t.length;i+=1){const u=ns(o,t,i);n[i]?n[i].p(u,r):(n[i]=cs(u),n[i].c(),n[i].m(e.parentNode,e))}for(;i<n.length;i+=1)n[i].d(1);n.length=t.length}},d(o){_t(n,o),o&&S(e)}}}function rc(l){let e;return{c(){e=f("p"),e.textContent="No metadata defined",a(e,"class","has-text-grey-light")},m(t,n){T(t,e,n)},p:Le,d(t){t&&S(e)}}}function cs(l){let e,t,n,o,r,i,u,c,p,d,m,_,g;function h(...k){return l[14](l[19],l[20],...k)}function v(){l[15].call(u,l[19])}function y(){return l[16](l[19])}return{c(){e=f("div"),t=f("div"),n=f("input"),r=b(),i=f("div"),u=f("input"),c=b(),p=f("div"),d=f("button"),d.innerHTML='<span class="icon"><i class="fas fa-times"></i></span>',m=b(),a(n,"class","input is-small"),a(n,"type","text"),a(n,"placeholder","Key"),n.value=o=l[19],a(t,"class","control is-expanded"),a(u,"class","input is-small"),a(u,"type","text"),a(u,"placeholder","Value"),a(i,"class","control is-expanded"),a(d,"class","button is-small is-danger is-outlined"),a(p,"class","control"),a(e,"class","field is-grouped")},m(k,w){T(k,e,w),s(e,t),s(t,n),s(e,r),s(e,i),s(i,u),je(u,l[2].metadata[l[19]]),s(e,c),s(e,p),s(p,d),s(e,m),_||(g=[ee(n,"input",h),ee(u,"input",v),ee(d,"click",y)],_=!0)},p(k,w){l=k,w&20&&o!==(o=l[19])&&n.value!==o&&(n.value=o),w&20&&u.value!==l[2].metadata[l[19]]&&je(u,l[2].metadata[l[19]])},d(k){k&&S(e),_=!1,lt(g)}}}function us(l){let e,t,n,o,r,i;return{c(){e=f("div"),t=b(),n=f("div"),o=f("button"),o.innerHTML=`<span class="icon"><i class="fas fa-trash"></i></span> 
                <span>Delete</span>`,a(e,"class","control is-expanded"),a(o,"class","button is-danger is-outlined"),a(o,"data-testid","delete-context-button"),a(n,"class","control")},m(u,c){T(u,e,c),T(u,t,c),T(u,n,c),s(n,o),r||(i=ee(o,"click",l[7]),r=!0)},p:Le,d(u){u&&S(e),u&&S(t),u&&S(n),r=!1,i()}}}function ac(l){let e,t,n,o=l[1]==="edit"?"Edit Context Item":"Add Context Item",r,i,u,c,p,d,m=l[2]&&ss(l);return{c(){e=f("div"),t=f("header"),n=f("p"),r=M(o),i=b(),u=f("button"),c=b(),m&&m.c(),a(n,"class","modal-card-title"),a(u,"class","delete"),a(u,"aria-label","close"),a(t,"class","modal-card-head"),a(e,"class","modal-card")},m(_,g){T(_,e,g),s(e,t),s(t,n),s(n,r),s(t,i),s(t,u),s(e,c),m&&m.m(e,null),p||(d=ee(u,"click",l[5]),p=!0)},p(_,g){g&2&&o!==(o=_[1]==="edit"?"Edit Context Item":"Add Context Item")&&ae(r,o),_[2]?m?m.p(_,g):(m=ss(_),m.c(),m.m(e,null)):m&&(m.d(1),m=null)},d(_){_&&S(e),m&&m.d(),p=!1,d()}}}function cc(l){let e,t,n,o;return e=new jl({props:{active:l[0],$$slots:{default:[ac]},$$scope:{ctx:l}}}),e.$on("close",l[5]),{c(){be(e.$$.fragment)},m(r,i){ke(e,r,i),t=!0,n||(o=ee(window,"keydown",l[8]),n=!0)},p(r,[i]){const u={};i&1&&(u.active=r[0]),i&67108878&&(u.$$scope={dirty:i,ctx:r}),e.$set(u)},i(r){t||(J(e.$$.fragment,r),t=!0)},o(r){x(e.$$.fragment,r),t=!1},d(r){we(e,r),n=!1,o()}}}function uc(l,e,t){let n,{active:o=!1}=e,{context:r=null}=e,{mode:i="edit"}=e;const u=fn();let c=null,p=[{value:"Document",label:"Document"},{value:"SearchResult",label:"Search Result"},{value:"UserInput",label:"User Input"},{value:"System",label:"System"},{value:"External",label:"External"}];function d(){t(0,o=!1),t(2,c=null),u("close")}function m(){!n||!c||(u(i==="edit"?"update":"create",c),d())}function _(){i==="edit"&&r&&(u("delete",r.id),d())}function g(I){I.key==="Escape"?d():I.key==="Enter"&&(I.ctrlKey||I.metaKey)&&m()}function h(){c.context_type=Wt(this),t(2,c),t(0,o),t(9,r),t(1,i),t(4,p)}function v(){c.title=this.value,t(2,c),t(0,o),t(9,r),t(1,i),t(4,p)}function y(){c.summary=this.value,t(2,c),t(0,o),t(9,r),t(1,i),t(4,p)}function k(){c.content=this.value,t(2,c),t(0,o),t(9,r),t(1,i),t(4,p)}const w=(I,N,E)=>{const O={...c.metadata};delete O[I],O[E.target.value]=N,t(2,c.metadata=O,c)};function $(I){c.metadata[I]=this.value,t(2,c),t(0,o),t(9,r),t(1,i),t(4,p)}const C=I=>{const N={...c.metadata};delete N[I],t(2,c.metadata=N,c)},L=()=>{t(2,c.metadata={...c.metadata,[`key_${Date.now()}`]:""},c)};return l.$$set=I=>{"active"in I&&t(0,o=I.active),"context"in I&&t(9,r=I.context),"mode"in I&&t(1,i=I.mode)},l.$$.update=()=>{l.$$.dirty&515&&(o&&r?t(2,c={...r,metadata:{...r.metadata}}):o&&i==="create"&&t(2,c={id:"",context_type:"UserInput",title:"",summary:"",content:"",metadata:{},created_at:new Date().toISOString(),relevance_score:null})),l.$$.dirty&4&&t(3,n=c&&c.title.trim()!==""&&c.content.trim()!=="")},[o,i,c,n,p,d,m,_,g,r,h,v,y,k,w,$,C,L]}class fc extends Pt{constructor(e){super(),Ut(this,e,uc,cc,Ot,{active:0,context:9,mode:1})}}function fs(l,e,t){const n=l.slice();return n[34]=e[t],n}function ds(l,e,t){const n=l.slice();return n[34]=e[t],n[38]=t,n}function ps(l){let e,t=l[7],n=[];for(let o=0;o<t.length;o+=1)n[o]=ms(ds(l,t,o));return{c(){e=f("ul");for(let o=0;o<n.length;o+=1)n[o].c();a(e,"class","suggestions svelte-k0eopx"),a(e,"data-testid","kg-autocomplete-list")},m(o,r){T(o,e,r);for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(e,null)},p(o,r){if(r[0]&1408){t=o[7];let i;for(i=0;i<t.length;i+=1){const u=ds(o,t,i);n[i]?n[i].p(u,r):(n[i]=ms(u),n[i].c(),n[i].m(e,null))}for(;i<n.length;i+=1)n[i].d(1);n.length=t.length}},d(o){o&&S(e),_t(n,o)}}}function ms(l){let e,t=l[34]+"",n,o,r,i,u,c;function p(){return l[22](l[34])}function d(...m){return l[23](l[34],...m)}return{c(){e=f("li"),n=M(t),o=b(),a(e,"tabindex","0"),a(e,"role","option"),a(e,"aria-selected",r=l[38]===l[8]),a(e,"aria-label",i=`Apply suggestion: ${l[34]}`),a(e,"data-testid","kg-autocomplete-item"),a(e,"class","svelte-k0eopx"),pt(e,"active",l[38]===l[8])},m(m,_){T(m,e,_),s(e,n),s(e,o),u||(c=[ee(e,"click",p),ee(e,"keydown",d)],u=!0)},p(m,_){l=m,_[0]&128&&t!==(t=l[34]+"")&&ae(n,t),_[0]&256&&r!==(r=l[38]===l[8])&&a(e,"aria-selected",r),_[0]&128&&i!==(i=`Apply suggestion: ${l[34]}`)&&a(e,"aria-label",i),_[0]&256&&pt(e,"active",l[38]===l[8])},d(m){m&&S(e),u=!1,lt(c)}}}function dc(l){let e,t,n,o,r,i;function u(m){l[20](m)}function c(m){l[21](m)}let p={placeholder:"Search knowledge graph terms...",type:"search",disabled:l[4],icon:"search",expanded:!0,autofocus:!0,"data-testid":"kg-search-input"};l[2]!==void 0&&(p.element=l[2]),l[1]!==void 0&&(p.value=l[1]),t=new yl({props:p}),mt.push(()=>bt(t,"element",u)),mt.push(()=>bt(t,"value",c)),t.$on("input",l[11]),t.$on("keydown",l[12]);let d=l[7].length>0&&ps(l);return{c(){e=f("div"),be(t.$$.fragment),r=b(),d&&d.c(),a(e,"class","input-wrapper svelte-k0eopx")},m(m,_){T(m,e,_),ke(t,e,null),s(e,r),d&&d.m(e,null),i=!0},p(m,_){const g={};_[0]&16&&(g.disabled=m[4]),!n&&_[0]&4&&(n=!0,g.element=m[2],kt(()=>n=!1)),!o&&_[0]&2&&(o=!0,g.value=m[1],kt(()=>o=!1)),t.$set(g),m[7].length>0?d?d.p(m,_):(d=ps(m),d.c(),d.m(e,null)):d&&(d.d(1),d=null)},i(m){i||(J(t.$$.fragment,m),i=!0)},o(m){x(t.$$.fragment,m),i=!1},d(m){m&&S(e),we(t),d&&d.d()}}}function _s(l){let e,t;return e=new cn({props:{type:"is-danger","data-testid":"kg-search-error",$$slots:{default:[pc]},$$scope:{ctx:l}}}),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},p(n,o){const r={};o[0]&32|o[1]&256&&(r.$$scope={dirty:o,ctx:n}),e.$set(r)},i(n){t||(J(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function pc(l){let e;return{c(){e=M(l[5])},m(t,n){T(t,e,n)},p(t,n){n[0]&32&&ae(e,t[5])},d(t){t&&S(e)}}}function mc(l){let e,t,n,o,r,i,u;return{c(){e=f("div"),t=f("p"),t.textContent="Enter at least 2 characters to search the knowledge graph",n=b(),o=f("p"),r=M('This will search terms from the knowledge graph for role "'),i=M(l[9]),u=M('"'),a(t,"class","has-text-centered"),a(o,"class","has-text-centered is-size-7 mt-2"),a(e,"class","notification is-info is-light")},m(c,p){T(c,e,p),s(e,t),s(e,n),s(e,o),s(o,r),s(o,i),s(o,u)},p(c,p){p[0]&512&&ae(i,c[9])},d(c){c&&S(e)}}}function _c(l){let e,t,n,o,r,i,u,c,p,d,m;return{c(){e=f("div"),t=f("p"),n=M('No knowledge graph terms found for "'),o=f("strong"),r=M(l[1]),i=M('"'),u=b(),c=f("p"),p=M('Try different keywords or check if the role "'),d=M(l[9]),m=M('" has a knowledge graph enabled.'),a(t,"class","has-text-centered"),a(c,"class","has-text-centered is-size-7 has-text-grey mt-2"),a(e,"class","notification is-light"),a(e,"data-testid","kg-search-empty")},m(_,g){T(_,e,g),s(e,t),s(t,n),s(t,o),s(o,r),s(t,i),s(e,u),s(e,c),s(c,p),s(c,d),s(c,m)},p(_,g){g[0]&2&&ae(r,_[1]),g[0]&512&&ae(d,_[9])},d(_){_&&S(e)}}}function gc(l){let e,t=l[3],n=[];for(let o=0;o<t.length;o+=1)n[o]=bs(fs(l,t,o));return{c(){e=f("div");for(let o=0;o<n.length;o+=1)n[o].c();a(e,"class","suggestions-container svelte-k0eopx"),a(e,"data-testid","kg-suggestions-list")},m(o,r){T(o,e,r);for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(e,null)},p(o,r){if(r[0]&8264){t=o[3];let i;for(i=0;i<t.length;i+=1){const u=fs(o,t,i);n[i]?n[i].p(u,r):(n[i]=bs(u),n[i].c(),n[i].m(e,null))}for(;i<n.length;i+=1)n[i].d(1);n.length=t.length}},d(o){o&&S(e),_t(n,o)}}}function hc(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="progress-container svelte-k0eopx"><div class="progress-bar svelte-k0eopx"><div class="progress-fill svelte-k0eopx"></div></div></div> 
          <p>Searching knowledge graph...</p>`,a(e,"class","empty-state svelte-k0eopx"),a(e,"data-testid","kg-search-loading")},m(t,n){T(t,e,n)},p:Le,d(t){t&&S(e)}}}function gs(l){let e,t,n=l[34].normalized_term+"",o;return{c(){e=f("span"),t=M("‚Üí "),o=M(n),a(e,"class","has-text-grey")},m(r,i){T(r,e,i),s(e,t),s(e,o)},p(r,i){i[0]&8&&n!==(n=r[34].normalized_term+"")&&ae(o,n)},d(r){r&&S(e)}}}function hs(l){let e,t=l[34].suggestion_type+"",n;return{c(){e=f("span"),n=M(t),a(e,"class","tag is-small is-light")},m(o,r){T(o,e,r),s(e,n)},p(o,r){r[0]&8&&t!==(t=o[34].suggestion_type+"")&&ae(n,t)},d(o){o&&S(e)}}}function vs(l){let e,t=l[34].url+"",n;return{c(){e=f("div"),n=M(t),a(e,"class","suggestion-url svelte-k0eopx")},m(o,r){T(o,e,r),s(e,n)},p(o,r){r[0]&8&&t!==(t=o[34].url+"")&&ae(n,t)},d(o){o&&S(e)}}}function bs(l){let e,t,n=l[34].term+"",o,r,i,u,c=(l[34].score*100).toFixed(0)+"",p,d,m,_,g,h,v,y,k,w=l[34].normalized_term&&l[34].normalized_term!==l[34].term&&gs(l),$=l[34].suggestion_type&&hs(l),C=l[34].url&&vs(l);function L(){return l[24](l[34])}function I(...N){return l[25](l[34],...N)}return{c(){var N;e=f("button"),t=f("div"),o=M(n),r=b(),i=f("div"),u=f("span"),p=M(c),d=M("%"),m=b(),w&&w.c(),_=b(),$&&$.c(),g=b(),C&&C.c(),h=b(),a(t,"class","suggestion-term svelte-k0eopx"),a(u,"class","tag is-info is-small"),a(i,"class","suggestion-meta svelte-k0eopx"),a(e,"class",v="suggestion-item "+(((N=l[6])==null?void 0:N.term)===l[34].term?"is-active":"")+" svelte-k0eopx"),a(e,"type","button"),a(e,"data-testid","kg-suggestion-item")},m(N,E){T(N,e,E),s(e,t),s(t,o),s(e,r),s(e,i),s(i,u),s(u,p),s(u,d),s(i,m),w&&w.m(i,null),s(i,_),$&&$.m(i,null),s(e,g),C&&C.m(e,null),s(e,h),y||(k=[ee(e,"click",L),ee(e,"keydown",I)],y=!0)},p(N,E){var O;l=N,E[0]&8&&n!==(n=l[34].term+"")&&ae(o,n),E[0]&8&&c!==(c=(l[34].score*100).toFixed(0)+"")&&ae(p,c),l[34].normalized_term&&l[34].normalized_term!==l[34].term?w?w.p(l,E):(w=gs(l),w.c(),w.m(i,_)):w&&(w.d(1),w=null),l[34].suggestion_type?$?$.p(l,E):($=hs(l),$.c(),$.m(i,null)):$&&($.d(1),$=null),l[34].url?C?C.p(l,E):(C=vs(l),C.c(),C.m(e,h)):C&&(C.d(1),C=null),E[0]&72&&v!==(v="suggestion-item "+(((O=l[6])==null?void 0:O.term)===l[34].term?"is-active":"")+" svelte-k0eopx")&&a(e,"class",v)},d(N){N&&S(e),w&&w.d(),$&&$.d(),C&&C.d(),y=!1,lt(k)}}}function vc(l){let e;return{c(){e=M("Cancel")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function ks(l){let e,t;return e=new _l({props:{type:"is-primary",disabled:!l[6],"data-testid":"kg-add-term-button",$$slots:{default:[bc]},$$scope:{ctx:l}}}),e.$on("click",l[14]),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},p(n,o){const r={};o[0]&64&&(r.disabled=!n[6]),o[0]&64|o[1]&256&&(r.$$scope={dirty:o,ctx:n}),e.$set(r)},i(n){t||(J(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function bc(l){let e,t=l[6].term+"",n,o;return{c(){e=M('Add "'),n=M(t),o=M('" to Context')},m(r,i){T(r,e,i),T(r,n,i),T(r,o,i)},p(r,i){i[0]&64&&t!==(t=r[6].term+"")&&ae(n,t)},d(r){r&&S(e),r&&S(n),r&&S(o)}}}function kc(l){let e;return{c(){e=M("Add Complete Thesaurus to Context")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function wc(l){let e,t,n,o,r,i,u,c,p,d,m,_,g,h,v,y,k,w,$,C,L,I,N,E,O,Q,Z,D,A;c=new ml({props:{$$slots:{default:[dc]},$$scope:{ctx:l}}});let te=l[5]&&_s(l);function q(j,P){return P[0]&2&&(m=null),j[4]?hc:j[3].length>0?gc:(m==null&&(m=j[1].trim().length>=2),m?_c:mc)}let ie=q(l,[-1,-1]),le=ie(l);v=new _l({props:{$$slots:{default:[vc]},$$scope:{ctx:l}}}),v.$on("click",l[16]);let H=l[6]&&ks(l);return Q=new _l({props:{type:"is-link",size:"is-small",style:"width: 100%;","data-testid":"kg-add-index-button",$$slots:{default:[kc]},$$scope:{ctx:l}}}),Q.$on("click",l[15]),{c(){e=f("div"),t=f("div"),n=f("button"),o=b(),r=f("div"),r.innerHTML=`<div class="modal-title svelte-k0eopx"><h3 class="svelte-k0eopx">Knowledge Graph Search</h3> 
          <p class="svelte-k0eopx">Search and add terms from the knowledge graph to your context</p></div>`,i=b(),u=f("div"),be(c.$$.fragment),p=b(),te&&te.c(),d=b(),le.c(),_=b(),g=f("div"),h=f("div"),be(v.$$.fragment),y=b(),H&&H.c(),k=b(),w=f("div"),$=f("div"),C=f("p"),L=f("strong"),L.textContent="Alternative:",I=M(' Add the complete thesaurus for role "'),N=M(l[9]),E=M('". This includes all domain-specific terms and their normalized mappings in JSON format for comprehensive vocabulary context.'),O=b(),be(Q.$$.fragment),a(n,"class","delete is-large modal-close-btn svelte-k0eopx"),a(n,"aria-label","close"),a(r,"class","modal-header svelte-k0eopx"),a(u,"class","search-section svelte-k0eopx"),a(h,"class","action-buttons svelte-k0eopx"),a(g,"class","modal-actions svelte-k0eopx"),a(C,"class","svelte-k0eopx"),a($,"class","alternative-content svelte-k0eopx"),a(w,"class","alternative-section svelte-k0eopx"),a(t,"class","kg-search-container svelte-k0eopx"),a(e,"class","box wrapper svelte-k0eopx"),a(e,"data-testid","kg-search-modal")},m(j,P){T(j,e,P),s(e,t),s(t,n),s(t,o),s(t,r),s(t,i),s(t,u),ke(c,u,null),s(t,p),te&&te.m(t,null),s(t,d),le.m(t,null),s(t,_),s(t,g),s(g,h),ke(v,h,null),s(h,y),H&&H.m(h,null),s(t,k),s(t,w),s(w,$),s($,C),s(C,L),s(C,I),s(C,N),s(C,E),s(w,O),ke(Q,w,null),Z=!0,D||(A=[ee(n,"click",l[16]),ee(t,"keydown",l[12])],D=!0)},p(j,P){const R={};P[0]&406|P[1]&256&&(R.$$scope={dirty:P,ctx:j}),c.$set(R),j[5]?te?(te.p(j,P),P[0]&32&&J(te,1)):(te=_s(j),te.c(),J(te,1),te.m(t,d)):te&&(qe(),x(te,1,1,()=>{te=null}),We()),ie===(ie=q(j,P))&&le?le.p(j,P):(le.d(1),le=ie(j),le&&(le.c(),le.m(t,_)));const z={};P[1]&256&&(z.$$scope={dirty:P,ctx:j}),v.$set(z),j[6]?H?(H.p(j,P),P[0]&64&&J(H,1)):(H=ks(j),H.c(),J(H,1),H.m(h,null)):H&&(qe(),x(H,1,1,()=>{H=null}),We()),(!Z||P[0]&512)&&ae(N,j[9]);const K={};P[1]&256&&(K.$$scope={dirty:P,ctx:j}),Q.$set(K)},i(j){Z||(J(c.$$.fragment,j),J(te),J(v.$$.fragment,j),J(H),J(Q.$$.fragment,j),Z=!0)},o(j){x(c.$$.fragment,j),x(te),x(v.$$.fragment,j),x(H),x(Q.$$.fragment,j),Z=!1},d(j){j&&S(e),we(c),te&&te.d(),le.d(),we(v),H&&H.d(),we(Q),D=!1,lt(A)}}}function yc(l){let e,t,n;function o(i){l[26](i)}let r={$$slots:{default:[wc]},$$scope:{ctx:l}};return l[0]!==void 0&&(r.active=l[0]),e=new jl({props:r}),mt.push(()=>bt(e,"active",o)),e.$on("close",l[16]),{c(){be(e.$$.fragment)},m(i,u){ke(e,i,u),n=!0},p(i,u){const c={};u[0]&1022|u[1]&256&&(c.$$scope={dirty:u,ctx:i}),!t&&u[0]&1&&(t=!0,c.active=i[0],kt(()=>t=!1)),e.$set(c)},i(i){n||(J(e.$$.fragment,i),n=!0)},o(i){x(e.$$.fragment,i),n=!1},d(i){we(e,i)}}}function Cc(l,e,t){let n,o;Ge(l,Nt,R=>t(9,n=R)),Ge(l,vt,R=>t(28,o=R));let{active:r=!1}=e,{initialQuery:i=""}=e,{conversationId:u=null}=e;const c=fn();let p="",d=[],m=!1,_=null,g=null,h=null,v=[],y=-1,k,w=!1;function $(){h&&clearTimeout(h),h=setTimeout(()=>{p.trim().length>=2?O():(t(3,d=[]),t(6,g=null))},300)}async function C(R){const z=R.trim();if(!z||z.length<2)return[];try{if(o){const K=await ze("get_autocomplete_suggestions",{query:z,roleName:n,limit:8});if((K==null?void 0:K.status)==="success"&&Array.isArray(K.suggestions))return K.suggestions.map(B=>B.term)}else{const K=await fetch(`${at.ServerURL}/autocomplete/${encodeURIComponent(n)}/${encodeURIComponent(z)}`);if(K.ok){const B=await K.json();if((B==null?void 0:B.status)==="success"&&Array.isArray(B.suggestions))return B.suggestions.map(oe=>oe.term)}}}catch(K){console.warn("KG autocomplete failed",K)}return[]}async function L(){const R=p.trim();if(R.length<2){t(7,v=[]),t(8,y=-1);return}try{const z=await C(R);t(7,v=z),t(8,y=-1)}catch(z){console.warn("Failed to get autocomplete suggestions:",z),t(7,v=[]),t(8,y=-1)}}function I(R){t(1,p=R),t(7,v=[]),t(8,y=-1),p.trim().length>=2&&O()}async function N(R){$(),await L()}function E(R){v.length>0?R.key==="ArrowDown"?(R.preventDefault(),t(8,y=(y+1)%v.length)):R.key==="ArrowUp"?(R.preventDefault(),t(8,y=(y-1+v.length)%v.length)):(R.key==="Enter"||R.key==="Tab")&&y!==-1?(R.preventDefault(),I(v[y])):R.key==="Escape"&&(R.preventDefault(),t(7,v=[]),t(8,y=-1)):R.key==="Enter"?(R.preventDefault(),g&&Z()):R.key==="Escape"&&A()}async function O(){if(!p.trim()||p.trim().length<2){t(3,d=[]);return}t(4,m=!0),t(5,_=null);try{if(o){const R=await ze("search_kg_terms",{request:{query:p.trim(),role_name:n,limit:20,min_similarity:.6}});R.status==="success"?(t(3,d=R.suggestions||[]),d.length>0&&!g&&t(6,g=d[0])):(t(5,_=R.error||"Search failed"),t(3,d=[]))}else{if(!u){t(5,_="No active conversation. Please start a conversation first."),t(3,d=[]);return}const R=await fetch(`${at.ServerURL}/conversations/${u}/context/kg/search?query=${encodeURIComponent(p.trim())}&role=${encodeURIComponent(n)}`);if(R.ok){const z=await R.json();z.status==="success"?(t(3,d=z.suggestions||[]),d.length>0&&!g&&t(6,g=d[0])):(t(5,_=z.error||"Search failed"),t(3,d=[]))}else t(5,_=`HTTP ${R.status}: ${R.statusText}`),t(3,d=[])}}catch(R){console.error("KG search error:",R),t(5,_=`Search failed: ${R}`),t(3,d=[])}finally{t(4,m=!1)}}function Q(R){t(6,g=R)}async function Z(){if(g){if(!u){t(5,_="No active conversation. Please start a conversation first.");return}try{if(o)await ze("add_kg_term_context",{request:{conversation_id:u,term:g.term,role_name:n}}),c("termAdded",{term:g.term,suggestion:g}),A();else{const R=await fetch(`${at.ServerURL}/conversations/${u}/context/kg/term`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({term:g.term,role:n})});if(R.ok){const z=await R.json();z.status==="success"?(c("termAdded",{term:g.term,suggestion:g}),A()):t(5,_=z.error||"Failed to add term to context")}else t(5,_=`HTTP ${R.status}: ${R.statusText}`)}}catch(R){console.error("Error adding term to context:",R),t(5,_=`Failed to add term to context: ${R}`)}}}async function D(){if(!u){t(5,_="No active conversation. Please start a conversation first.");return}try{if(o)await ze("add_kg_index_context",{request:{conversation_id:u,role_name:n}}),c("kgIndexAdded",{role:n}),A();else{const R=await fetch(`${at.ServerURL}/conversations/${u}/context/kg/index`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({role:n})});if(R.ok){const z=await R.json();z.status==="success"?(c("kgIndexAdded",{role:n}),A()):t(5,_=z.error||"Failed to add KG index to context")}else t(5,_=`HTTP ${R.status}: ${R.statusText}`)}}catch(R){console.error("Error adding KG index to context:",R),t(5,_=`Failed to add KG index to context: ${R}`)}}function A(){t(0,r=!1),t(1,p=""),t(3,d=[]),t(6,g=null),t(5,_=null),t(4,m=!1),t(7,v=[]),t(8,y=-1),h&&(clearTimeout(h),h=null)}an(()=>{h&&clearTimeout(h)});function te(R){k=R,t(2,k)}function q(R){p=R,t(1,p),t(0,r),t(19,w),t(17,i)}const ie=R=>I(R),le=(R,z)=>{(z.key==="Enter"||z.key===" ")&&(z.preventDefault(),I(R))},H=R=>Q(R),j=(R,z)=>z.key==="Enter"&&Q(R);function P(R){r=R,t(0,r)}return l.$$set=R=>{"active"in R&&t(0,r=R.active),"initialQuery"in R&&t(17,i=R.initialQuery),"conversationId"in R&&t(18,u=R.conversationId)},l.$$.update=()=>{l.$$.dirty[0]&655363&&r&&!w&&(t(1,p=i),t(19,w=!0),p.trim()&&O()),l.$$.dirty[0]&1&&(r||t(19,w=!1)),l.$$.dirty[0]&5&&r&&k&&setTimeout(()=>{k==null||k.focus(),t(5,_=null)},100)},[r,p,k,d,m,_,g,v,y,n,I,N,E,Q,Z,D,A,i,u,w,te,q,ie,le,H,j,P]}class Sc extends Pt{constructor(e){super(),Ut(this,e,Cc,yc,Ot,{active:0,initialQuery:17,conversationId:18},null,[-1,-1])}}function Tc(l){const e=l.slice(),t=e[0].kg_index_info;return e[9]=t,e}function $c(l){const e=l.slice(),t=e[0].kg_term_definition;return e[8]=t,e}function Rc(l){let e=l[0].context_type==="KGTermDefinition"?"KG Term":"KG Index",t;return{c(){t=M(e)},m(n,o){T(n,t,o)},p(n,o){o&1&&e!==(e=n[0].context_type==="KGTermDefinition"?"KG Term":"KG Index")&&ae(t,e)},d(n){n&&S(t)}}}function Lc(l){let e;return{c(){e=M("üëÅÔ∏è")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function ws(l){let e,t;return e=new _l({props:{type:"is-ghost",title:"Remove from context",$$slots:{default:[Ec]},$$scope:{ctx:l}}}),e.$on("click",l[5]),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},p(n,o){const r={};o&1024&&(r.$$scope={dirty:o,ctx:n}),e.$set(r)},i(n){t||(J(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function Ec(l){let e;return{c(){e=M("‚ùå")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function Ac(l){let e,t,n,o=Al(l[9].total_terms)+"",r,i,u,c,p,d,m,_=Al(l[9].total_nodes)+"",g,h,v,y,k,w,$,C=Al(l[9].total_edges)+"",L,I,N,E,O,Q,Z,D=(l[9].version||"N/A")+"",A,te,q,ie,le,H,j,P=!l[2]&&ys();return{c(){e=f("div"),t=f("div"),n=f("div"),r=M(o),u=b(),c=f("div"),c.textContent="Terms",p=b(),d=f("div"),m=f("div"),g=M(_),v=b(),y=f("div"),y.textContent="Nodes",k=b(),w=f("div"),$=f("div"),L=M(C),N=b(),E=f("div"),E.textContent="Edges",O=b(),Q=f("div"),Z=f("div"),A=M(D),q=b(),ie=f("div"),ie.textContent="Version",H=b(),P&&P.c(),j=Ct(),a(n,"class",i="stat-value "+(l[2]?"compact":"")+" svelte-tet355"),a(c,"class","stat-label svelte-tet355"),a(t,"class","stat-item svelte-tet355"),a(m,"class",h="stat-value "+(l[2]?"compact":"")+" svelte-tet355"),a(y,"class","stat-label svelte-tet355"),a(d,"class","stat-item svelte-tet355"),a($,"class",I="stat-value "+(l[2]?"compact":"")+" svelte-tet355"),a(E,"class","stat-label svelte-tet355"),a(w,"class","stat-item svelte-tet355"),a(Z,"class",te="stat-value "+(l[2]?"compact":"")+" svelte-tet355"),a(ie,"class","stat-label svelte-tet355"),a(Q,"class","stat-item svelte-tet355"),a(e,"class",le="kg-index-stats "+(l[2]?"compact":"")+" svelte-tet355")},m(R,z){T(R,e,z),s(e,t),s(t,n),s(n,r),s(t,u),s(t,c),s(e,p),s(e,d),s(d,m),s(m,g),s(d,v),s(d,y),s(e,k),s(e,w),s(w,$),s($,L),s(w,N),s(w,E),s(e,O),s(e,Q),s(Q,Z),s(Z,A),s(Q,q),s(Q,ie),T(R,H,z),P&&P.m(R,z),T(R,j,z)},p(R,z){z&1&&o!==(o=Al(R[9].total_terms)+"")&&ae(r,o),z&4&&i!==(i="stat-value "+(R[2]?"compact":"")+" svelte-tet355")&&a(n,"class",i),z&1&&_!==(_=Al(R[9].total_nodes)+"")&&ae(g,_),z&4&&h!==(h="stat-value "+(R[2]?"compact":"")+" svelte-tet355")&&a(m,"class",h),z&1&&C!==(C=Al(R[9].total_edges)+"")&&ae(L,C),z&4&&I!==(I="stat-value "+(R[2]?"compact":"")+" svelte-tet355")&&a($,"class",I),z&1&&D!==(D=(R[9].version||"N/A")+"")&&ae(A,D),z&4&&te!==(te="stat-value "+(R[2]?"compact":"")+" svelte-tet355")&&a(Z,"class",te),z&4&&le!==(le="kg-index-stats "+(R[2]?"compact":"")+" svelte-tet355")&&a(e,"class",le),R[2]?P&&(P.d(1),P=null):P||(P=ys(),P.c(),P.m(j.parentNode,j))},i:Le,o:Le,d(R){R&&S(e),R&&S(H),P&&P.d(R),R&&S(j)}}}function Dc(l){let e,t,n,o,r,i,u,c,p,d=l[8].definition&&Cs(l),m=l[8].synonyms&&l[8].synonyms.length>0&&Ss(l),_=l[8].related_terms&&l[8].related_terms.length>0&&Ts(l),g=l[8].usage_examples&&l[8].usage_examples.length>0&&$s(l),h=l[8].url&&Rs(l);return{c(){e=f("div"),d&&d.c(),t=b(),n=f("div"),m&&m.c(),o=b(),_&&_.c(),r=b(),g&&g.c(),i=b(),h&&h.c(),a(n,"class",u="term-metadata "+(l[2]?"compact":"")+" svelte-tet355"),a(e,"class",c="term-definition "+(l[2]?"compact":"")+" svelte-tet355")},m(v,y){T(v,e,y),d&&d.m(e,null),s(e,t),s(e,n),m&&m.m(n,null),s(n,o),_&&_.m(n,null),s(n,r),g&&g.m(n,null),s(n,i),h&&h.m(n,null),p=!0},p(v,y){v[8].definition?d?d.p(v,y):(d=Cs(v),d.c(),d.m(e,t)):d&&(d.d(1),d=null),v[8].synonyms&&v[8].synonyms.length>0?m?(m.p(v,y),y&1&&J(m,1)):(m=Ss(v),m.c(),J(m,1),m.m(n,o)):m&&(qe(),x(m,1,1,()=>{m=null}),We()),v[8].related_terms&&v[8].related_terms.length>0?_?(_.p(v,y),y&1&&J(_,1)):(_=Ts(v),_.c(),J(_,1),_.m(n,r)):_&&(qe(),x(_,1,1,()=>{_=null}),We()),v[8].usage_examples&&v[8].usage_examples.length>0?g?(g.p(v,y),y&1&&J(g,1)):(g=$s(v),g.c(),J(g,1),g.m(n,i)):g&&(qe(),x(g,1,1,()=>{g=null}),We()),v[8].url?h?y&1&&J(h,1):(h=Rs(v),h.c(),J(h,1),h.m(n,null)):h&&(qe(),x(h,1,1,()=>{h=null}),We()),(!p||y&4&&u!==(u="term-metadata "+(v[2]?"compact":"")+" svelte-tet355"))&&a(n,"class",u),(!p||y&4&&c!==(c="term-definition "+(v[2]?"compact":"")+" svelte-tet355"))&&a(e,"class",c)},i(v){p||(J(m),J(_),J(g),J(h),p=!0)},o(v){x(m),x(_),x(g),x(h),p=!1},d(v){v&&S(e),d&&d.d(),m&&m.d(),_&&_.d(),g&&g.d(),h&&h.d()}}}function ys(l){let e;return{c(){e=f("div"),e.innerHTML='<p class="is-size-7"><strong>Thesaurus Data:</strong> This context item contains the complete thesaurus as JSON, providing all domain-specific vocabulary and term mappings for comprehensive AI understanding.</p>',a(e,"class","notification is-success is-light mt-3")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function Cs(l){let e,t=l[8].definition+"",n,o;return{c(){e=f("div"),n=M(t),a(e,"class",o="definition-text "+(l[2]?"compact":"")+" svelte-tet355")},m(r,i){T(r,e,i),s(e,n)},p(r,i){i&1&&t!==(t=r[8].definition+"")&&ae(n,t),i&4&&o!==(o="definition-text "+(r[2]?"compact":"")+" svelte-tet355")&&a(e,"class",o)},d(r){r&&S(e)}}}function Ss(l){let e,t;return e=new gl({props:{type:"is-light",rounded:!0,title:"Synonyms",$$slots:{default:[Nc]},$$scope:{ctx:l}}}),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},p(n,o){const r={};o&1025&&(r.$$scope={dirty:o,ctx:n}),e.$set(r)},i(n){t||(J(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function Nc(l){let e,t=l[8].synonyms.length+"",n,o,r=l[8].synonyms.length!==1?"s":"",i;return{c(){e=M("‚âà "),n=M(t),o=M(" synonym"),i=M(r)},m(u,c){T(u,e,c),T(u,n,c),T(u,o,c),T(u,i,c)},p(u,c){c&1&&t!==(t=u[8].synonyms.length+"")&&ae(n,t),c&1&&r!==(r=u[8].synonyms.length!==1?"s":"")&&ae(i,r)},d(u){u&&S(e),u&&S(n),u&&S(o),u&&S(i)}}}function Ts(l){let e,t;return e=new gl({props:{type:"is-light",rounded:!0,title:"Related Terms",$$slots:{default:[Ic]},$$scope:{ctx:l}}}),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},p(n,o){const r={};o&1025&&(r.$$scope={dirty:o,ctx:n}),e.$set(r)},i(n){t||(J(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function Ic(l){let e,t=l[8].related_terms.length+"",n,o;return{c(){e=M("üîó "),n=M(t),o=M(" related")},m(r,i){T(r,e,i),T(r,n,i),T(r,o,i)},p(r,i){i&1&&t!==(t=r[8].related_terms.length+"")&&ae(n,t)},d(r){r&&S(e),r&&S(n),r&&S(o)}}}function $s(l){let e,t;return e=new gl({props:{type:"is-light",rounded:!0,title:"Usage Examples",$$slots:{default:[Oc]},$$scope:{ctx:l}}}),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},p(n,o){const r={};o&1025&&(r.$$scope={dirty:o,ctx:n}),e.$set(r)},i(n){t||(J(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function Oc(l){let e,t=l[8].usage_examples.length+"",n,o,r=l[8].usage_examples.length!==1?"s":"",i;return{c(){e=M("üí¨ "),n=M(t),o=M(" example"),i=M(r)},m(u,c){T(u,e,c),T(u,n,c),T(u,o,c),T(u,i,c)},p(u,c){c&1&&t!==(t=u[8].usage_examples.length+"")&&ae(n,t),c&1&&r!==(r=u[8].usage_examples.length!==1?"s":"")&&ae(i,r)},d(u){u&&S(e),u&&S(n),u&&S(o),u&&S(i)}}}function Rs(l){let e,t;return e=new gl({props:{type:"is-link",rounded:!0,$$slots:{default:[Mc]},$$scope:{ctx:l}}}),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},i(n){t||(J(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function Mc(l){let e;return{c(){e=M("üîó Source")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function Ls(l){let e,t=l[0].summary+"",n;return{c(){e=f("div"),n=M(t),a(e,"class","context-summary svelte-tet355")},m(o,r){T(o,e,r),s(e,n)},p(o,r){r&1&&t!==(t=o[0].summary+"")&&ae(n,t)},d(o){o&&S(e)}}}function Es(l){let e,t,n=(l[0].relevance_score*100).toFixed(0)+"",o,r;return{c(){e=f("span"),t=M("Relevance: "),o=M(n),r=M("%"),a(e,"class","relevance-score svelte-tet355")},m(i,u){T(i,e,u),s(e,t),s(e,o),s(e,r)},p(i,u){u&1&&n!==(n=(i[0].relevance_score*100).toFixed(0)+"")&&ae(o,n)},d(i){i&&S(e)}}}function As(l){let e,t,n=(l[0].metadata.document_title||l[0].metadata.source_document)+"",o;return{c(){e=f("span"),t=M("üìÑ "),o=M(n),a(e,"title","Source Document")},m(r,i){T(r,e,i),s(e,t),s(e,o)},p(r,i){i&1&&n!==(n=(r[0].metadata.document_title||r[0].metadata.source_document)+"")&&ae(o,n)},d(r){r&&S(e)}}}function Pc(l){var Se;let e,t,n,o,r,i,u,c=l[0].title+"",p,d,m,_,g,h,v,y,k,w,$,C,L,I,N,E,O,Q,Z,D=Ds(l[0].created_at)+"",A,te,q,ie,le,H;_=new gl({props:{type:l[3],rounded:!0,$$slots:{default:[Rc]},$$scope:{ctx:l}}}),v=new _l({props:{type:"is-ghost",title:"View details",$$slots:{default:[Lc]},$$scope:{ctx:l}}}),v.$on("click",l[6]);let j=l[1]&&ws(l);const P=[Dc,Ac],R=[];function z(V,ne){return V[0].context_type==="KGTermDefinition"&&V[0].kg_term_definition?0:V[0].context_type==="KGIndex"&&V[0].kg_index_info?1:-1}function K(V,ne){if(ne===0)return $c(V);if(ne===1)return Tc(V)}~(C=z(l))&&(L=R[C]=P[C](K(l,C)));let B=l[0].summary&&!l[2]&&Ls(l),oe=l[0].relevance_score&&Es(l),re=((Se=l[0].metadata)==null?void 0:Se.source_document)&&As(l);return{c(){e=f("div"),t=f("div"),n=f("div"),o=f("span"),r=M(l[4]),i=b(),u=f("span"),p=M(c),m=b(),be(_.$$.fragment),g=b(),h=f("div"),be(v.$$.fragment),y=b(),j&&j.c(),w=b(),$=f("div"),L&&L.c(),I=b(),B&&B.c(),E=b(),O=f("div"),Q=f("span"),Z=M("Added "),A=M(D),te=b(),oe&&oe.c(),q=b(),re&&re.c(),a(o,"class","context-icon svelte-tet355"),a(u,"class",d="context-title-text "+(l[2]?"compact":"")+" svelte-tet355"),a(n,"class","context-title svelte-tet355"),a(h,"class","context-actions svelte-tet355"),a(t,"class",k="context-header "+(l[2]?"compact":"")+" svelte-tet355"),a($,"class",N="context-content "+(l[2]?"compact":"")+" svelte-tet355"),a(O,"class",ie="context-meta "+(l[2]?"compact":"")+" svelte-tet355"),a(e,"class",le="kg-context-item "+(l[2]?"compact":"")+" svelte-tet355")},m(V,ne){T(V,e,ne),s(e,t),s(t,n),s(n,o),s(o,r),s(n,i),s(n,u),s(u,p),s(n,m),ke(_,n,null),s(t,g),s(t,h),ke(v,h,null),s(h,y),j&&j.m(h,null),s(e,w),s(e,$),~C&&R[C].m($,null),s($,I),B&&B.m($,null),s(e,E),s(e,O),s(O,Q),s(Q,Z),s(Q,A),s(O,te),oe&&oe.m(O,null),s(O,q),re&&re.m(O,null),H=!0},p(V,[ne]){var X;(!H||ne&16)&&ae(r,V[4]),(!H||ne&1)&&c!==(c=V[0].title+"")&&ae(p,c),(!H||ne&4&&d!==(d="context-title-text "+(V[2]?"compact":"")+" svelte-tet355"))&&a(u,"class",d);const _e={};ne&8&&(_e.type=V[3]),ne&1025&&(_e.$$scope={dirty:ne,ctx:V}),_.$set(_e);const G={};ne&1024&&(G.$$scope={dirty:ne,ctx:V}),v.$set(G),V[1]?j?(j.p(V,ne),ne&2&&J(j,1)):(j=ws(V),j.c(),J(j,1),j.m(h,null)):j&&(qe(),x(j,1,1,()=>{j=null}),We()),(!H||ne&4&&k!==(k="context-header "+(V[2]?"compact":"")+" svelte-tet355"))&&a(t,"class",k);let U=C;C=z(V),C===U?~C&&R[C].p(K(V,C),ne):(L&&(qe(),x(R[U],1,1,()=>{R[U]=null}),We()),~C?(L=R[C],L?L.p(K(V,C),ne):(L=R[C]=P[C](K(V,C)),L.c()),J(L,1),L.m($,I)):L=null),V[0].summary&&!V[2]?B?B.p(V,ne):(B=Ls(V),B.c(),B.m($,null)):B&&(B.d(1),B=null),(!H||ne&4&&N!==(N="context-content "+(V[2]?"compact":"")+" svelte-tet355"))&&a($,"class",N),(!H||ne&1)&&D!==(D=Ds(V[0].created_at)+"")&&ae(A,D),V[0].relevance_score?oe?oe.p(V,ne):(oe=Es(V),oe.c(),oe.m(O,q)):oe&&(oe.d(1),oe=null),(X=V[0].metadata)!=null&&X.source_document?re?re.p(V,ne):(re=As(V),re.c(),re.m(O,null)):re&&(re.d(1),re=null),(!H||ne&4&&ie!==(ie="context-meta "+(V[2]?"compact":"")+" svelte-tet355"))&&a(O,"class",ie),(!H||ne&4&&le!==(le="kg-context-item "+(V[2]?"compact":"")+" svelte-tet355"))&&a(e,"class",le)},i(V){H||(J(_.$$.fragment,V),J(v.$$.fragment,V),J(j),J(L),H=!0)},o(V){x(_.$$.fragment,V),x(v.$$.fragment,V),x(j),x(L),H=!1},d(V){V&&S(e),we(_),we(v),j&&j.d(),~C&&R[C].d(),B&&B.d(),oe&&oe.d(),re&&re.d()}}}function Al(l){return new Intl.NumberFormat().format(l)}function Ds(l){try{return new Date(l).toLocaleDateString()}catch{return l}}function Uc(l,e,t){let n,o,{contextItem:r}=e,{removable:i=!0}=e,{compact:u=!1}=e;const c=fn();function p(){c("remove",{contextId:r.id})}function d(){var _;let m=null;(_=r.kg_term_definition)!=null&&_.term&&(m=r.kg_term_definition.term),c("viewDetails",{contextItem:r,term:m})}return l.$$set=m=>{"contextItem"in m&&t(0,r=m.contextItem),"removable"in m&&t(1,i=m.removable),"compact"in m&&t(2,u=m.compact)},l.$$.update=()=>{l.$$.dirty&1&&t(4,n=r.context_type==="KGTermDefinition"?"üè∑Ô∏è":"üó∫Ô∏è"),l.$$.dirty&1&&t(3,o=r.context_type==="KGTermDefinition"?"is-info":"is-primary")},[r,i,u,o,n,p,d]}class jc extends Pt{constructor(e){super(),Ut(this,e,Uc,Pc,Ot,{contextItem:0,removable:1,compact:2})}}function Ns(l,e,t){const n=l.slice();return n[25]=e[t],n}function Is(l){let e,t,n,o,r,i;return{c(){e=f("div"),t=M(l[6]),n=b(),o=f("button"),a(o,"type","button"),a(o,"class","btn-close btn-close-sm svelte-1kckmc0"),a(e,"class","alert alert-danger alert-sm svelte-1kckmc0"),a(e,"role","alert")},m(u,c){T(u,e,c),s(e,t),s(e,n),s(e,o),r||(i=ee(o,"click",l[18]),r=!0)},p(u,c){c&64&&ae(t,u[6])},d(u){u&&S(e),r=!1,i()}}}function Os(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="spinner-border spinner-border-sm" role="status"><span class="visually-hidden">Loading...</span></div> 
      <span>Loading conversations...</span>`,a(e,"class","loading-state svelte-1kckmc0")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function Hc(l){let e=[],t=new Map,n,o=l[9];const r=i=>i[25].id;for(let i=0;i<o.length;i+=1){let u=Ns(l,o,i),c=r(u);t.set(c,e[i]=Ps(c,u))}return{c(){for(let i=0;i<e.length;i+=1)e[i].c();n=Ct()},m(i,u){for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(i,u);T(i,n,u)},p(i,u){u&4995&&(o=i[9],e=ai(e,u,r,1,i,o,t,n.parentNode,ci,Ps,n,Ns))},d(i){for(let u=0;u<e.length;u+=1)e[u].d(i);i&&S(n)}}}function Fc(l){let e,t,n,o,r,i,u,c;return{c(){e=f("div"),t=f("i"),n=b(),o=f("p"),o.textContent="No conversations yet",r=b(),i=f("button"),i.textContent="Start your first chat",a(t,"class","bi bi-chat-dots svelte-1kckmc0"),a(o,"class","svelte-1kckmc0"),a(i,"class","btn btn-sm btn-outline-primary"),a(e,"class","empty-state svelte-1kckmc0")},m(p,d){T(p,e,d),s(e,t),s(e,n),s(e,o),s(e,r),s(e,i),u||(c=ee(i,"click",function(){Hl(l[2])&&l[2].apply(this,arguments)}),u=!0)},p(p,d){l=p},d(p){p&&S(e),u=!1,c()}}}function zc(l){let e,t,n;function o(){return l[21](l[25])}return{c(){e=f("button"),e.innerHTML='<i class="bi bi-trash"></i>',a(e,"class","btn btn-sm btn-ghost svelte-1kckmc0"),a(e,"title","Delete conversation")},m(r,i){T(r,e,i),t||(n=ee(e,"click",Yl(o)),t=!0)},p(r,i){l=r},d(r){r&&S(e),t=!1,n()}}}function Kc(l){let e,t,n,o,r,i,u;function c(){return l[19](l[25])}return{c(){e=f("button"),t=f("i"),n=b(),o=f("button"),r=f("i"),a(t,"class","bi bi-check-lg"),a(e,"class","btn btn-sm btn-danger"),e.disabled=l[8],a(e,"title","Confirm delete"),a(r,"class","bi bi-x-lg"),a(o,"class","btn btn-sm btn-secondary"),o.disabled=l[8],a(o,"title","Cancel")},m(p,d){T(p,e,d),s(e,t),T(p,n,d),T(p,o,d),s(o,r),i||(u=[ee(e,"click",Yl(c)),ee(o,"click",Yl(l[20]))],i=!0)},p(p,d){l=p,d&256&&(e.disabled=l[8]),d&256&&(o.disabled=l[8])},d(p){p&&S(e),p&&S(n),p&&S(o),i=!1,lt(u)}}}function Ms(l){let e,t=l[25].preview+"",n;return{c(){e=f("p"),n=M(t),a(e,"class","conversation-preview svelte-1kckmc0")},m(o,r){T(o,e,r),s(e,n)},p(o,r){r&512&&t!==(t=o[25].preview+"")&&ae(n,t)},d(o){o&&S(e)}}}function Ps(l,e){let t,n,o,r=e[25].title+"",i,u,c,p,d,m,_=e[25].role+"",g,h,v,y,k,w=e[25].message_count+"",$,C,L,I=Us(e[25].updated_at)+"",N,E,O,Q,Z;function D(H,j){return H[7]===H[25].id?Kc:zc}let A=D(e),te=A(e),q=e[25].preview&&Ms(e);function ie(){return e[22](e[25])}function le(...H){return e[23](e[25],...H)}return{key:l,first:null,c(){t=f("div"),n=f("div"),o=f("h4"),i=M(r),u=b(),c=f("div"),te.c(),p=b(),d=f("div"),m=f("span"),g=M(_),h=b(),v=f("span"),y=f("i"),k=b(),$=M(w),C=b(),L=f("span"),N=M(I),E=b(),q&&q.c(),O=b(),a(o,"class","conversation-title svelte-1kckmc0"),a(c,"class","conversation-actions svelte-1kckmc0"),a(n,"class","conversation-header svelte-1kckmc0"),a(m,"class","badge bg-secondary"),a(y,"class","bi bi-chat-left-text"),a(v,"class","message-count svelte-1kckmc0"),a(L,"class","timestamp svelte-1kckmc0"),a(d,"class","conversation-meta svelte-1kckmc0"),a(t,"class","conversation-item svelte-1kckmc0"),a(t,"role","button"),a(t,"tabindex","0"),pt(t,"active",e[0]===e[25].id),this.first=t},m(H,j){T(H,t,j),s(t,n),s(n,o),s(o,i),s(n,u),s(n,c),te.m(c,null),s(t,p),s(t,d),s(d,m),s(m,g),s(d,h),s(d,v),s(v,y),s(v,k),s(v,$),s(d,C),s(d,L),s(L,N),s(t,E),q&&q.m(t,null),s(t,O),Q||(Z=[ee(t,"click",ie),ee(t,"keydown",le)],Q=!0)},p(H,j){e=H,j&512&&r!==(r=e[25].title+"")&&ae(i,r),A===(A=D(e))&&te?te.p(e,j):(te.d(1),te=A(e),te&&(te.c(),te.m(c,null))),j&512&&_!==(_=e[25].role+"")&&ae(g,_),j&512&&w!==(w=e[25].message_count+"")&&ae($,w),j&512&&I!==(I=Us(e[25].updated_at)+"")&&ae(N,I),e[25].preview?q?q.p(e,j):(q=Ms(e),q.c(),q.m(t,O)):q&&(q.d(1),q=null),j&513&&pt(t,"active",e[0]===e[25].id)},d(H){H&&S(t),te.d(),q&&q.d(),Q=!1,lt(Z)}}}function Gc(l){let e,t,n,o,r,i,u,c,p,d,m,_,g,h,v,y,k,w,$,C,L,I,N,E,O=l[9].length+"",Q,Z,D=l[9].length!==1?"s":"",A,te,q,ie,le,H=l[6]&&Is(l),j=l[5]&&Os();function P(K,B){return!K[5]&&K[9].length===0?Fc:Hc}let R=P(l),z=R(l);return{c(){e=f("div"),t=f("div"),n=f("h3"),n.textContent="Chat History",o=b(),r=f("button"),r.innerHTML='<i class="bi bi-plus-lg"></i> New Chat',i=b(),u=f("div"),c=f("div"),p=f("input"),d=b(),m=f("i"),_=b(),g=f("div"),h=f("select"),v=f("option"),v.textContent="All Roles",y=f("option"),k=M(l[10]),w=b(),H&&H.c(),$=b(),j&&j.c(),C=b(),L=f("div"),z.c(),I=b(),N=f("div"),E=f("small"),Q=M(O),Z=M(" conversation"),A=M(D),te=b(),q=f("button"),q.innerHTML='<i class="bi bi-arrow-clockwise"></i>',a(n,"class","svelte-1kckmc0"),a(r,"class","btn btn-sm btn-primary new-chat-btn svelte-1kckmc0"),a(r,"title","Start new conversation"),a(t,"class","session-list-header svelte-1kckmc0"),a(p,"type","text"),a(p,"class","form-control form-control-sm svelte-1kckmc0"),a(p,"placeholder","Search conversations..."),a(m,"class","bi bi-search search-icon svelte-1kckmc0"),a(c,"class","search-box svelte-1kckmc0"),v.__value=null,v.value=v.__value,y.__value=l[10],y.value=y.__value,a(h,"class","form-select form-select-sm"),l[4]===void 0&&It(()=>l[17].call(h)),a(g,"class","filter-box"),a(u,"class","session-list-controls svelte-1kckmc0"),a(L,"class","conversation-list svelte-1kckmc0"),a(E,"class","text-muted"),a(q,"class","btn btn-sm btn-ghost svelte-1kckmc0"),a(q,"title","Refresh"),a(N,"class","session-list-footer svelte-1kckmc0"),a(e,"class","session-list svelte-1kckmc0")},m(K,B){T(K,e,B),s(e,t),s(t,n),s(t,o),s(t,r),s(e,i),s(e,u),s(u,c),s(c,p),je(p,l[3]),s(c,d),s(c,m),s(u,_),s(u,g),s(g,h),s(h,v),s(h,y),s(y,k),nt(h,l[4],!0),s(e,w),H&&H.m(e,null),s(e,$),j&&j.m(e,null),s(e,C),s(e,L),z.m(L,null),s(e,I),s(e,N),s(N,E),s(E,Q),s(E,Z),s(E,A),s(N,te),s(N,q),ie||(le=[ee(r,"click",function(){Hl(l[2])&&l[2].apply(this,arguments)}),ee(p,"input",l[16]),ee(p,"input",l[13]),ee(h,"change",l[17]),ee(h,"change",l[14]),ee(q,"click",l[11])],ie=!0)},p(K,[B]){l=K,B&8&&p.value!==l[3]&&je(p,l[3]),B&1024&&ae(k,l[10]),B&1024&&(y.__value=l[10],y.value=y.__value),B&1040&&nt(h,l[4]),l[6]?H?H.p(l,B):(H=Is(l),H.c(),H.m(e,$)):H&&(H.d(1),H=null),l[5]?j||(j=Os(),j.c(),j.m(e,C)):j&&(j.d(1),j=null),R===(R=P(l))&&z?z.p(l,B):(z.d(1),z=R(l),z&&(z.c(),z.m(L,null))),B&512&&O!==(O=l[9].length+"")&&ae(Q,O),B&512&&D!==(D=l[9].length!==1?"s":"")&&ae(A,D)},i:Le,o:Le,d(K){K&&S(e),H&&H.d(),j&&j.d(),z.d(),ie=!1,lt(le)}}}function Us(l){const e=new Date(l),n=new Date().getTime()-e.getTime(),o=Math.floor(n/6e4),r=Math.floor(n/36e5),i=Math.floor(n/864e5);return o<1?"Just now":o<60?`${o}m ago`:r<24?`${r}h ago`:i<7?`${i}d ago`:e.toLocaleDateString()}function qc(l,e,t){let n,o;Ge(l,Nt,D=>t(10,o=D));let{currentConversationId:r=null}=e,{onSelectConversation:i=()=>{}}=e,{onNewConversation:u=()=>{}}=e,c=[],p=!1,d=null,m="",_=null,g=null,h=!1;wl(()=>{v()});async function v(){t(5,p=!0),t(6,d=null);try{const D=await ze("list_persistent_conversations",{role:_,limit:100});D.status==="success"?t(15,c=D.conversations):t(6,d=D.error||"Failed to load conversations")}catch(D){console.error("Failed to load conversations:",D),t(6,d=String(D))}finally{t(5,p=!1)}}async function y(){if(!m.trim()){await v();return}t(5,p=!0),t(6,d=null);try{const D=await ze("search_persistent_conversations",{query:m});D.status==="success"?t(15,c=D.conversations):t(6,d=D.error||"Search failed")}catch(D){console.error("Search failed:",D),t(6,d=String(D))}finally{t(5,p=!1)}}async function k(D){t(8,h=!0),t(6,d=null);try{const A=await ze("delete_persistent_conversation",{conversationId:D});A.status==="success"?(t(15,c=c.filter(te=>te.id!==D)),t(7,g=null),r===D&&u()):t(6,d=A.error||"Failed to delete conversation")}catch(A){console.error("Failed to delete conversation:",A),t(6,d=String(A))}finally{t(8,h=!1)}}function w(){m.trim()?y():v()}function $(){v()}function C(){m=this.value,t(3,m)}function L(){_=Wt(this),t(4,_)}const I=()=>t(6,d=null),N=D=>k(D.id),E=()=>t(7,g=null),O=D=>t(7,g=D.id),Q=D=>i(D.id),Z=(D,A)=>A.key==="Enter"&&i(D.id);return l.$$set=D=>{"currentConversationId"in D&&t(0,r=D.currentConversationId),"onSelectConversation"in D&&t(1,i=D.onSelectConversation),"onNewConversation"in D&&t(2,u=D.onNewConversation)},l.$$.update=()=>{l.$$.dirty&32792&&t(9,n=c.filter(D=>{const A=!m||D.title.toLowerCase().includes(m.toLowerCase())||D.preview&&D.preview.toLowerCase().includes(m.toLowerCase()),te=!_||D.role===_;return A&&te}))},[r,i,u,m,_,p,d,g,h,n,o,v,k,w,$,c,C,L,I,N,E,O,Q,Z]}class Wc extends Pt{constructor(e){super(),Ut(this,e,qc,Gc,Ot,{currentConversationId:0,onSelectConversation:1,onNewConversation:2})}}function js(l,e,t){const n=l.slice();return n[90]=e[t],n[92]=t,n}function Hs(l,e,t){const n=l.slice();return n[93]=e[t],n[95]=t,n}function Fs(l){let e,t,n;return t=new Wc({props:{currentConversationId:l[28],onSelectConversation:l[44],onNewConversation:l[45]}}),{c(){e=f("div"),be(t.$$.fragment),a(e,"class","column is-3 session-list-column svelte-a08hxb")},m(o,r){T(o,e,r),ke(t,e,null),n=!0},p(o,r){const i={};r[0]&268435456&&(i.currentConversationId=o[28]),t.$set(i)},i(o){n||(J(t.$$.fragment,o),n=!0)},o(o){x(t.$$.fragment,o),n=!1},d(o){o&&S(e),we(t)}}}function zs(l){let e,t,n;return{c(){e=f("p"),t=M("Conversation ID: "),n=M(l[11]),a(e,"class","is-size-7 has-text-grey")},m(o,r){T(o,e,r),s(e,t),s(e,n)},p(o,r){r[0]&2048&&ae(n,o[11])},d(o){o&&S(e)}}}function Ks(l){let e,t,n;return{c(){e=f("button"),e.innerHTML=`<span class="icon is-small"><i class="fas fa-save"></i></span> 
                <span>Save</span>`,a(e,"class","button is-small is-success"),a(e,"title","Save this conversation")},m(o,r){T(o,e,r),t||(n=ee(e,"click",l[43]),t=!0)},p:Le,d(o){o&&S(e),t=!1,n()}}}function Jc(l){let e,t=l[93].content+"",n;return{c(){e=f("pre"),n=M(t),a(e,"class","svelte-a08hxb")},m(o,r){T(o,e,r),s(e,n)},p(o,r){r[0]&1&&t!==(t=o[93].content+"")&&ae(n,t)},i:Le,o:Le,d(o){o&&S(e)}}}function Bc(l){let e,t,n,o,r,i,u,c,p,d,m;const _=[Vc,Qc],g=[];function h(w,$){return w[5]?0:1}e=h(l),t=g[e]=_[e](l);function v(){return l[50](l[93])}function y(){return l[51](l[93])}let k=l[6]&&l[95]===l[0].length-1&&Gs(l);return{c(){t.c(),n=b(),o=f("div"),r=f("button"),r.innerHTML='<span class="icon is-small"><i class="fas fa-copy"></i></span>',i=b(),u=f("button"),u.innerHTML='<span class="icon is-small"><i class="fas fa-save"></i></span>',c=b(),k&&k.c(),a(r,"class","button is-small is-light"),a(r,"title","Copy as markdown"),a(u,"class","button is-small is-light"),a(u,"title","Save as markdown"),a(o,"class","msg-actions svelte-a08hxb")},m(w,$){g[e].m(w,$),T(w,n,$),T(w,o,$),s(o,r),s(o,i),s(o,u),s(o,c),k&&k.m(o,null),p=!0,d||(m=[ee(r,"click",v),ee(u,"click",y)],d=!0)},p(w,$){l=w;let C=e;e=h(l),e===C?g[e].p(l,$):(qe(),x(g[C],1,1,()=>{g[C]=null}),We(),t=g[e],t?t.p(l,$):(t=g[e]=_[e](l),t.c()),J(t,1),t.m(n.parentNode,n)),l[6]&&l[95]===l[0].length-1?k?k.p(l,$):(k=Gs(l),k.c(),k.m(o,null)):k&&(k.d(1),k=null)},i(w){p||(J(t),p=!0)},o(w){x(t),p=!1},d(w){g[e].d(w),w&&S(n),w&&S(o),k&&k.d(),d=!1,lt(m)}}}function Qc(l){let e,t=l[93].content+"",n;return{c(){e=f("pre"),n=M(t),a(e,"class","svelte-a08hxb")},m(o,r){T(o,e,r),s(e,n)},p(o,r){r[0]&1&&t!==(t=o[93].content+"")&&ae(n,t)},i:Le,o:Le,d(o){o&&S(e)}}}function Vc(l){let e,t,n;return t=new Fl({props:{source:l[93].content}}),{c(){e=f("div"),be(t.$$.fragment),a(e,"class","markdown-body svelte-a08hxb")},m(o,r){T(o,e,r),ke(t,e,null),n=!0},p(o,r){const i={};r[0]&1&&(i.source=o[93].content),t.$set(i)},i(o){n||(J(t.$$.fragment,o),n=!0)},o(o){x(t.$$.fragment,o),n=!1},d(o){o&&S(e),we(t)}}}function Gs(l){let e,t,n,o,r,i,u,c,p,d,m,_,g;return{c(){e=f("button"),t=f("span"),t.innerHTML='<i class="fas fa-bug"></i>',n=b(),o=f("span"),o.textContent="REQ",i=b(),u=f("button"),c=f("span"),c.innerHTML='<i class="fas fa-code"></i>',p=b(),d=f("span"),d.textContent="RES",a(t,"class","icon is-small"),a(o,"class","is-size-7"),a(e,"class","button is-small is-warning"),a(e,"title","Show debug request (sent to LLM)"),e.disabled=r=!l[7],a(c,"class","icon is-small"),a(d,"class","is-size-7"),a(u,"class","button is-small is-info"),a(u,"title","Show debug response (from LLM)"),u.disabled=m=!l[8]},m(h,v){T(h,e,v),s(e,t),s(e,n),s(e,o),T(h,i,v),T(h,u,v),s(u,c),s(u,p),s(u,d),_||(g=[ee(e,"click",l[52]),ee(u,"click",l[53])],_=!0)},p(h,v){v[0]&128&&r!==(r=!h[7])&&(e.disabled=r),v[0]&256&&m!==(m=!h[8])&&(u.disabled=m)},d(h){h&&S(e),h&&S(i),h&&S(u),_=!1,lt(g)}}}function qs(l){let e,t,n,o,r,i;const u=[Bc,Jc],c=[];function p(d,m){return d[93].role==="assistant"?0:1}return n=p(l),o=c[n]=u[n](l),{c(){e=f("div"),t=f("div"),o.c(),a(t,"class","bubble svelte-a08hxb"),a(e,"class",r=rl(`msg ${l[93].role}`)+" svelte-a08hxb")},m(d,m){T(d,e,m),s(e,t),c[n].m(t,null),i=!0},p(d,m){let _=n;n=p(d),n===_?c[n].p(d,m):(qe(),x(c[_],1,1,()=>{c[_]=null}),We(),o=c[n],o?o.p(d,m):(o=c[n]=u[n](d),o.c()),J(o,1),o.m(t,null)),(!i||m[0]&1&&r!==(r=rl(`msg ${d[93].role}`)+" svelte-a08hxb"))&&a(e,"class",r)},i(d){i||(J(o),i=!0)},o(d){x(o),i=!1},d(d){d&&S(e),c[n].d()}}}function Ws(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="bubble loading svelte-a08hxb"><span class="icon is-small"><i class="fas fa-spinner fa-spin"></i></span> 
            <span>Thinking...</span></div>`,a(e,"class","msg assistant svelte-a08hxb")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function Js(l){let e,t;return{c(){e=f("p"),t=M(l[4]),a(e,"class","is-size-7 has-text-grey")},m(n,o){T(n,e,o),s(e,t)},p(n,o){o[0]&16&&ae(t,n[4])},d(n){n&&S(e)}}}function Bs(l){let e,t;return{c(){e=f("p"),t=M(l[3]),a(e,"class","has-text-danger is-size-7")},m(n,o){T(n,e,o),s(e,t)},p(n,o){o[0]&8&&ae(t,n[3])},d(n){n&&S(e)}}}function Yc(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-refresh"></i>',a(e,"class","icon is-small")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function Zc(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-spinner fa-spin"></i>',a(e,"class","icon is-small")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function Qs(l){let e,t,n,o,r,i,u,c,p,d,m,_,g,h,v,y,k,w,$,C,L,I,N,E,O,Q,Z,D,A,te,q,ie,le,H,j,P,R,z;function K(re,Se){return re[18]?xc:Xc}let B=K(l),oe=B(l);return{c(){e=f("div"),t=f("div"),n=f("label"),n.textContent="Context Type",o=b(),r=f("div"),i=f("div"),u=f("select"),c=f("option"),c.textContent="Document",p=f("option"),p.textContent="Search Result",d=f("option"),d.textContent="User Input",m=f("option"),m.textContent="Note",_=b(),g=f("div"),h=f("label"),h.textContent="Title",v=b(),y=f("div"),k=f("input"),w=b(),$=f("div"),C=f("label"),C.textContent="Content",L=b(),I=f("div"),N=f("textarea"),E=b(),O=f("div"),Q=f("div"),Z=f("button"),oe.c(),D=b(),A=f("span"),A.textContent="Save Context",q=b(),ie=f("div"),le=f("button"),H=f("span"),H.innerHTML='<i class="fas fa-times"></i>',j=b(),P=f("span"),P.textContent="Cancel",a(n,"class","label is-small"),c.__value="document",c.value=c.__value,p.__value="search_result",p.value=p.__value,d.__value="user_input",d.value=d.__value,m.__value="note",m.value=m.__value,a(u,"data-testid","context-type-select"),l[17]===void 0&&It(()=>l[55].call(u)),a(i,"class","select is-small is-fullwidth"),a(r,"class","control"),a(t,"class","field"),a(h,"class","label is-small"),a(k,"class","input is-small"),a(k,"type","text"),a(k,"placeholder","Enter context title"),a(k,"data-testid","context-title-input"),a(y,"class","control"),a(g,"class","field"),a(C,"class","label is-small"),a(N,"class","textarea is-small"),a(N,"rows","4"),a(N,"placeholder","Enter context content"),a(N,"data-testid","context-content-textarea"),a(I,"class","control"),a($,"class","field"),a(Z,"class","button is-primary is-small"),Z.disabled=te=l[18]||!l[15].trim()||!l[16].trim(),a(Z,"data-testid","add-context-submit-button"),a(Q,"class","control"),a(H,"class","icon is-small"),a(le,"class","button is-light is-small"),le.disabled=l[18],a(ie,"class","control"),a(O,"class","field is-grouped"),a(e,"class","box has-background-light mb-4"),a(e,"data-testid","add-context-form")},m(re,Se){T(re,e,Se),s(e,t),s(t,n),s(t,o),s(t,r),s(r,i),s(i,u),s(u,c),s(u,p),s(u,d),s(u,m),nt(u,l[17],!0),s(e,_),s(e,g),s(g,h),s(g,v),s(g,y),s(y,k),je(k,l[15]),s(e,w),s(e,$),s($,C),s($,L),s($,I),s(I,N),je(N,l[16]),s(e,E),s(e,O),s(O,Q),s(Q,Z),oe.m(Z,null),s(Z,D),s(Z,A),s(O,q),s(O,ie),s(ie,le),s(le,H),s(le,j),s(le,P),R||(z=[ee(u,"change",l[55]),ee(k,"input",l[56]),ee(N,"input",l[57]),ee(Z,"click",l[32]),ee(le,"click",l[31])],R=!0)},p(re,Se){Se[0]&131072&&nt(u,re[17]),Se[0]&32768&&k.value!==re[15]&&je(k,re[15]),Se[0]&65536&&je(N,re[16]),B!==(B=K(re))&&(oe.d(1),oe=B(re),oe&&(oe.c(),oe.m(Z,D))),Se[0]&360448&&te!==(te=re[18]||!re[15].trim()||!re[16].trim())&&(Z.disabled=te),Se[0]&262144&&(le.disabled=re[18])},d(re){re&&S(e),oe.d(),R=!1,lt(z)}}}function Xc(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-save"></i>',a(e,"class","icon is-small")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function xc(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-spinner fa-spin"></i>',a(e,"class","icon is-small")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function eu(l){let e,t,n=l[12],o=[];for(let i=0;i<n.length;i+=1)o[i]=Zs(js(l,n,i));const r=i=>x(o[i],1,1,()=>{o[i]=null});return{c(){e=f("div");for(let i=0;i<o.length;i+=1)o[i].c();a(e,"class","context-items svelte-a08hxb"),a(e,"data-testid","conversation-context")},m(i,u){T(i,e,u);for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(e,null);t=!0},p(i,u){if(u[0]&4096|u[1]&28){n=i[12];let c;for(c=0;c<n.length;c+=1){const p=js(i,n,c);o[c]?(o[c].p(p,u),J(o[c],1)):(o[c]=Zs(p),o[c].c(),J(o[c],1),o[c].m(e,null))}for(qe(),c=n.length;c<o.length;c+=1)r(c);We()}},i(i){if(!t){for(let u=0;u<n.length;u+=1)J(o[u]);t=!0}},o(i){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)x(o[u]);t=!1},d(i){i&&S(e),_t(o,i)}}}function tu(l){let e;return{c(){e=f("div"),e.innerHTML=`<span class="icon is-large"><i class="fas fa-inbox fa-2x"></i></span> 
              <p class="is-size-6">No context items yet</p> 
              <p class="is-size-7">Add documents from search results to provide context for your chat.</p>`,a(e,"class","has-text-centered has-text-grey-light"),a(e,"data-testid","empty-context-message")},m(t,n){T(t,e,n)},p:Le,i:Le,o:Le,d(t){t&&S(e)}}}function lu(l){let e,t,n,o,r,i=l[90].context_type.replace(/([A-Z])/g," $1").trim()+"",u,c,p,d,m,_,g,h,v,y,k,w,$,C,L,I=l[90].title+"",N,E,O,Q,Z,D,A=new Date(l[90].created_at).toLocaleString()+"",te,q,ie,le,H,j=l[90].relevance_score&&Vs(l);function P(){return l[60](l[90])}function R(){return l[61](l[90])}function z(oe,re){return oe[90].summary?su:ou}let K=z(l),B=K(l);return{c(){e=f("div"),t=f("div"),n=f("div"),o=f("div"),r=f("span"),u=M(i),p=b(),d=f("div"),m=f("div"),j&&j.c(),_=b(),g=f("div"),h=f("div"),v=f("div"),y=f("button"),y.innerHTML='<span class="icon is-small"><i class="fas fa-edit"></i></span>',k=b(),w=f("div"),$=f("button"),$.innerHTML='<span class="icon is-small"><i class="fas fa-trash"></i></span>',C=b(),L=f("h6"),N=M(I),E=b(),O=f("div"),B.c(),Q=b(),Z=f("div"),D=M("Added: "),te=M(A),a(r,"class",c="tag is-small "+(l[90].context_type==="Document"?"is-info":l[90].context_type==="SearchResult"?"is-primary":l[90].context_type==="UserInput"?"is-warning":"is-light")),a(r,"data-testid",`context-type-${l[92]}`),a(o,"class","level-item"),a(n,"class","level-left"),a(m,"class","level-item"),a(y,"class","button is-small is-light"),a(y,"data-testid",`edit-context-${l[92]}`),a(y,"title","Edit context"),a(v,"class","control"),a($,"class","button is-small is-light is-danger"),a($,"data-testid",`delete-context-${l[92]}`),a($,"title","Delete context"),a(w,"class","control"),a(h,"class","field is-grouped"),a(g,"class","level-item context-actions svelte-a08hxb"),a(d,"class","level-right"),a(t,"class","level is-mobile"),a(L,"class","title is-6 has-text-dark"),a(L,"data-testid",`context-title-${l[92]}`),a(O,"class","content is-small"),a(Z,"class","is-size-7 has-text-grey"),a(e,"class","context-item svelte-a08hxb"),a(e,"data-context-id",q=l[90].id),a(e,"data-testid",`context-item-${l[92]}`),a(e,"data-context-type",ie=l[90].context_type)},m(oe,re){T(oe,e,re),s(e,t),s(t,n),s(n,o),s(o,r),s(r,u),s(t,p),s(t,d),s(d,m),j&&j.m(m,null),s(d,_),s(d,g),s(g,h),s(h,v),s(v,y),s(h,k),s(h,w),s(w,$),s(e,C),s(e,L),s(L,N),s(e,E),s(e,O),B.m(O,null),s(e,Q),s(e,Z),s(Z,D),s(Z,te),le||(H=[ee(y,"click",P),ee($,"click",R)],le=!0)},p(oe,re){l=oe,re[0]&4096&&i!==(i=l[90].context_type.replace(/([A-Z])/g," $1").trim()+"")&&ae(u,i),re[0]&4096&&c!==(c="tag is-small "+(l[90].context_type==="Document"?"is-info":l[90].context_type==="SearchResult"?"is-primary":l[90].context_type==="UserInput"?"is-warning":"is-light"))&&a(r,"class",c),l[90].relevance_score?j?j.p(l,re):(j=Vs(l),j.c(),j.m(m,null)):j&&(j.d(1),j=null),re[0]&4096&&I!==(I=l[90].title+"")&&ae(N,I),K===(K=z(l))&&B?B.p(l,re):(B.d(1),B=K(l),B&&(B.c(),B.m(O,null))),re[0]&4096&&A!==(A=new Date(l[90].created_at).toLocaleString()+"")&&ae(te,A),re[0]&4096&&q!==(q=l[90].id)&&a(e,"data-context-id",q),re[0]&4096&&ie!==(ie=l[90].context_type)&&a(e,"data-context-type",ie)},i:Le,o:Le,d(oe){oe&&S(e),j&&j.d(),B.d(),le=!1,lt(H)}}}function nu(l){let e,t;return e=new jc({props:{contextItem:l[90],compact:!0}}),e.$on("remove",l[58]),e.$on("viewDetails",l[59]),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},p(n,o){const r={};o[0]&4096&&(r.contextItem=n[90]),e.$set(r)},i(n){t||(J(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function Vs(l){let e,t=l[90].relevance_score.toFixed(1)+"",n;return{c(){e=f("span"),n=M(t),a(e,"class","tag is-light is-small")},m(o,r){T(o,e,r),s(e,n)},p(o,r){r[0]&4096&&t!==(t=o[90].relevance_score.toFixed(1)+"")&&ae(n,t)},d(o){o&&S(e)}}}function ou(l){let e,t=l[90].content.substring(0,150)+"",n,o=l[90].content.length>150?"...":"",r;return{c(){e=f("p"),n=M(t),r=M(o),a(e,"class","context-preview svelte-a08hxb"),a(e,"data-testid",`context-content-${l[92]}`)},m(i,u){T(i,e,u),s(e,n),s(e,r)},p(i,u){u[0]&4096&&t!==(t=i[90].content.substring(0,150)+"")&&ae(n,t),u[0]&4096&&o!==(o=i[90].content.length>150?"...":"")&&ae(r,o)},d(i){i&&S(e)}}}function su(l){let e,t=l[90].summary+"",n;return{c(){e=f("p"),n=M(t),a(e,"class","context-summary svelte-a08hxb"),a(e,"data-testid",`context-summary-${l[92]}`)},m(o,r){T(o,e,r),s(e,n)},p(o,r){r[0]&4096&&t!==(t=o[90].summary+"")&&ae(n,t)},d(o){o&&S(e)}}}function Ys(l){let e;return{c(){e=f("hr"),a(e,"class","context-divider svelte-a08hxb")},m(t,n){T(t,e,n)},d(t){t&&S(e)}}}function Zs(l){let e,t,n,o,r;const i=[nu,lu],u=[];function c(d,m){return d[90].context_type==="KGTermDefinition"||d[90].context_type==="KGIndex"?0:1}e=c(l),t=u[e]=i[e](l);let p=l[92]<l[12].length-1&&Ys();return{c(){t.c(),n=b(),p&&p.c(),o=Ct()},m(d,m){u[e].m(d,m),T(d,n,m),p&&p.m(d,m),T(d,o,m),r=!0},p(d,m){let _=e;e=c(d),e===_?u[e].p(d,m):(qe(),x(u[_],1,1,()=>{u[_]=null}),We(),t=u[e],t?t.p(d,m):(t=u[e]=i[e](d),t.c()),J(t,1),t.m(n.parentNode,n)),d[92]<d[12].length-1?p||(p=Ys(),p.c(),p.m(o.parentNode,o)):p&&(p.d(1),p=null)},i(d){r||(J(t),r=!0)},o(d){x(t),r=!1},d(d){u[e].d(d),d&&S(n),p&&p.d(d),d&&S(o)}}}function Xs(l){let e,t,n,o,r,i,u,c,p,d,m,_,g,h,v,y;function k(L,I){return L[7]?ru:iu}let w=k(l),$=w(l),C=l[7]&&xs(l);return{c(){e=f("div"),t=f("div"),n=b(),o=f("div"),r=f("header"),i=f("p"),i.innerHTML=`<span class="icon"><i class="fas fa-bug"></i></span>
          Debug Request (Sent to LLM)`,u=b(),c=f("button"),p=b(),d=f("section"),$.c(),m=b(),_=f("footer"),g=f("button"),g.textContent="Close",h=b(),C&&C.c(),a(t,"class","modal-background"),a(i,"class","modal-card-title"),a(c,"class","delete"),a(c,"aria-label","close"),a(r,"class","modal-card-head"),a(d,"class","modal-card-body"),a(g,"class","button"),a(_,"class","modal-card-foot"),a(o,"class","modal-card"),a(e,"class","modal is-active")},m(L,I){T(L,e,I),s(e,t),s(e,n),s(e,o),s(o,r),s(r,i),s(r,u),s(r,c),s(o,p),s(o,d),$.m(d,null),s(o,m),s(o,_),s(_,g),s(_,h),C&&C.m(_,null),v||(y=[ee(t,"click",l[62]),ee(c,"click",l[63]),ee(g,"click",l[64])],v=!0)},p(L,I){w===(w=k(L))&&$?$.p(L,I):($.d(1),$=w(L),$&&($.c(),$.m(d,null))),L[7]?C?C.p(L,I):(C=xs(L),C.c(),C.m(_,null)):C&&(C.d(1),C=null)},d(L){L&&S(e),$.d(),C&&C.d(),v=!1,lt(y)}}}function iu(l){let e;return{c(){e=f("p"),e.textContent="No request data available",a(e,"class","has-text-grey")},m(t,n){T(t,e,n)},p:Le,d(t){t&&S(e)}}}function ru(l){let e,t,n,o,r,i,u=l[7].method+"",c,p,d,m,_=new Date(l[7].timestamp).toLocaleTimeString()+"",g,h,v,y,k=l[7].context_items_count+"",w,$,C,L,I,N,E=JSON.stringify(l[7],null,2)+"",O;return{c(){e=f("div"),t=f("p"),t.textContent="Request Details:",n=b(),o=f("div"),r=f("span"),i=M("Method: "),c=M(u),p=b(),d=f("span"),m=M("Time: "),g=M(_),h=b(),v=f("span"),y=M("Context Items: "),w=M(k),$=b(),C=f("p"),C.textContent="Full Request JSON:",L=b(),I=f("pre"),N=f("code"),O=M(E),a(t,"class","has-text-weight-semibold"),a(r,"class","tag is-info"),a(d,"class","tag is-primary"),a(v,"class","tag is-success"),a(o,"class","tags are-medium"),a(C,"class","has-text-weight-semibold mt-4"),a(N,"class","svelte-a08hxb"),a(I,"class","debug-json svelte-a08hxb"),a(e,"class","content")},m(Q,Z){T(Q,e,Z),s(e,t),s(e,n),s(e,o),s(o,r),s(r,i),s(r,c),s(o,p),s(o,d),s(d,m),s(d,g),s(o,h),s(o,v),s(v,y),s(v,w),s(e,$),s(e,C),s(e,L),s(e,I),s(I,N),s(N,O)},p(Q,Z){Z[0]&128&&u!==(u=Q[7].method+"")&&ae(c,u),Z[0]&128&&_!==(_=new Date(Q[7].timestamp).toLocaleTimeString()+"")&&ae(g,_),Z[0]&128&&k!==(k=Q[7].context_items_count+"")&&ae(w,k),Z[0]&128&&E!==(E=JSON.stringify(Q[7],null,2)+"")&&ae(O,E)},d(Q){Q&&S(e)}}}function xs(l){let e,t,n;return{c(){e=f("button"),e.innerHTML=`<span class="icon"><i class="fas fa-copy"></i></span> 
            <span>Copy JSON</span>`,a(e,"class","button is-primary")},m(o,r){T(o,e,r),t||(n=ee(e,"click",l[65]),t=!0)},p:Le,d(o){o&&S(e),t=!1,n()}}}function ei(l){let e,t,n,o,r,i,u,c,p,d,m,_,g,h,v,y;function k(L,I){return L[8]?cu:au}let w=k(l),$=w(l),C=l[8]&&ni(l);return{c(){e=f("div"),t=f("div"),n=b(),o=f("div"),r=f("header"),i=f("p"),i.innerHTML=`<span class="icon"><i class="fas fa-code"></i></span>
          Debug Response (From LLM)`,u=b(),c=f("button"),p=b(),d=f("section"),$.c(),m=b(),_=f("footer"),g=f("button"),g.textContent="Close",h=b(),C&&C.c(),a(t,"class","modal-background"),a(i,"class","modal-card-title"),a(c,"class","delete"),a(c,"aria-label","close"),a(r,"class","modal-card-head"),a(d,"class","modal-card-body"),a(g,"class","button"),a(_,"class","modal-card-foot"),a(o,"class","modal-card"),a(e,"class","modal is-active")},m(L,I){T(L,e,I),s(e,t),s(e,n),s(e,o),s(o,r),s(r,i),s(r,u),s(r,c),s(o,p),s(o,d),$.m(d,null),s(o,m),s(o,_),s(_,g),s(_,h),C&&C.m(_,null),v||(y=[ee(t,"click",l[66]),ee(c,"click",l[67]),ee(g,"click",l[68])],v=!0)},p(L,I){w===(w=k(L))&&$?$.p(L,I):($.d(1),$=w(L),$&&($.c(),$.m(d,null))),L[8]?C?C.p(L,I):(C=ni(L),C.c(),C.m(_,null)):C&&(C.d(1),C=null)},d(L){L&&S(e),$.d(),C&&C.d(),v=!1,lt(y)}}}function au(l){let e;return{c(){e=f("p"),e.textContent="No response data available",a(e,"class","has-text-grey")},m(t,n){T(t,e,n)},p:Le,d(t){t&&S(e)}}}function cu(l){let e,t,n,o,r,i,u=l[8].status+"",c,p,d,m,_=new Date(l[8].timestamp).toLocaleTimeString()+"",g,h,v,y,k,w,$,C,L=JSON.stringify(l[8],null,2)+"",I,N=l[8].model_used&&ti(l),E=l[8].message_length&&li(l);return{c(){e=f("div"),t=f("p"),t.textContent="Response Details:",n=b(),o=f("div"),r=f("span"),i=M("Status: "),c=M(u),p=b(),d=f("span"),m=M("Time: "),g=M(_),h=b(),N&&N.c(),v=b(),E&&E.c(),y=b(),k=f("p"),k.textContent="Full Response JSON:",w=b(),$=f("pre"),C=f("code"),I=M(L),a(t,"class","has-text-weight-semibold"),a(r,"class","tag is-info"),a(d,"class","tag is-primary"),a(o,"class","tags are-medium"),a(k,"class","has-text-weight-semibold mt-4"),a(C,"class","svelte-a08hxb"),a($,"class","debug-json svelte-a08hxb"),a(e,"class","content")},m(O,Q){T(O,e,Q),s(e,t),s(e,n),s(e,o),s(o,r),s(r,i),s(r,c),s(o,p),s(o,d),s(d,m),s(d,g),s(o,h),N&&N.m(o,null),s(o,v),E&&E.m(o,null),s(e,y),s(e,k),s(e,w),s(e,$),s($,C),s(C,I)},p(O,Q){Q[0]&256&&u!==(u=O[8].status+"")&&ae(c,u),Q[0]&256&&_!==(_=new Date(O[8].timestamp).toLocaleTimeString()+"")&&ae(g,_),O[8].model_used?N?N.p(O,Q):(N=ti(O),N.c(),N.m(o,v)):N&&(N.d(1),N=null),O[8].message_length?E?E.p(O,Q):(E=li(O),E.c(),E.m(o,null)):E&&(E.d(1),E=null),Q[0]&256&&L!==(L=JSON.stringify(O[8],null,2)+"")&&ae(I,L)},d(O){O&&S(e),N&&N.d(),E&&E.d()}}}function ti(l){let e,t,n=l[8].model_used+"",o;return{c(){e=f("span"),t=M("Model: "),o=M(n),a(e,"class","tag is-success")},m(r,i){T(r,e,i),s(e,t),s(e,o)},p(r,i){i[0]&256&&n!==(n=r[8].model_used+"")&&ae(o,n)},d(r){r&&S(e)}}}function li(l){let e,t,n=l[8].message_length+"",o,r;return{c(){e=f("span"),t=M("Length: "),o=M(n),r=M(" chars"),a(e,"class","tag is-warning")},m(i,u){T(i,e,u),s(e,t),s(e,o),s(e,r)},p(i,u){u[0]&256&&n!==(n=i[8].message_length+"")&&ae(o,n)},d(i){i&&S(e)}}}function ni(l){let e,t,n;return{c(){e=f("button"),e.innerHTML=`<span class="icon"><i class="fas fa-copy"></i></span> 
            <span>Copy JSON</span>`,a(e,"class","button is-primary")},m(o,r){T(o,e,r),t||(n=ee(e,"click",l[69]),t=!0)},p:Le,d(o){o&&S(e),t=!1,n()}}}function oi(l){let e,t,n;function o(i){l[75](i)}let r={item:l[24],kgTerm:l[25],kgRank:l[26]};return l[23]!==void 0&&(r.active=l[23]),e=new Xl({props:r}),mt.push(()=>bt(e,"active",o)),{c(){be(e.$$.fragment)},m(i,u){ke(e,i,u),n=!0},p(i,u){const c={};u[0]&16777216&&(c.item=i[24]),u[0]&33554432&&(c.kgTerm=i[25]),u[0]&67108864&&(c.kgRank=i[26]),!t&&u[0]&8388608&&(t=!0,c.active=i[23],kt(()=>t=!1)),e.$set(c)},i(i){n||(J(e.$$.fragment,i),n=!0)},o(i){x(e.$$.fragment,i),n=!1},d(i){we(e,i)}}}function uu(l){let e,t,n,o,r,i,u,c,p,d,m,_,g,h,v,y,k,w,$,C=l[27]?"Hide":"History",L,I,N,E,O,Q,Z,D,A,te,q,ie,le,H,j,P,R,z,K,B,oe,re,Se,V,ne,_e,G,U,X,ce,ge,ue,pe,me,Ee,Je,Qe,$e,Ie,he,Ae,Ve,Be,Me,Re,et,ft,tt,Ke,Ye,dt,Fe,ot,Ze,F,W=l[12].length+"",se,Pe,Oe,ye,st,rt,xe,it,wt,Rt,St,tl,Xt,jt,Tt,Ht,Y,fe=l[27]&&Fs(l),ve=l[11]&&zs(l),Ne=l[11]&&!l[28]&&Ks(l),Ue=l[0],De=[];for(let de=0;de<Ue.length;de+=1)De[de]=qs(Hs(l,Ue,de));const xt=de=>x(De[de],1,1,()=>{De[de]=null});let Et=l[2]&&Ws(),gt=l[4]&&Js(l),ct=l[3]&&Bs(l);function el(de,Te){return de[13]?Zc:Yc}let al=el(l),ll=al(l),ht=l[14]&&Qs(l);const At=[tu,eu],Bt=[];function Il(de,Te){return de[12].length===0?0:1}tt=Il(l),Ke=Bt[tt]=At[tt](l);let Mt=l[9]&&Xs(l),Lt=l[10]&&ei(l);function hl(de){l[70](de)}let cl={context:l[20],mode:l[21]};l[19]!==void 0&&(cl.active=l[19]),it=new fc({props:cl}),mt.push(()=>bt(it,"active",hl)),it.$on("update",l[71]),it.$on("delete",l[72]),it.$on("close",l[73]);function zl(de){l[74](de)}let Cl={conversationId:l[11]};l[22]!==void 0&&(Cl.active=l[22]),St=new Sc({props:Cl}),mt.push(()=>bt(St,"active",zl)),St.$on("termAdded",l[40]),St.$on("kgIndexAdded",l[41]);let yt=l[24]&&oi(l);return{c(){e=f("section"),t=f("div"),n=f("div"),fe&&fe.c(),o=b(),r=f("div"),i=f("div"),u=f("div"),c=f("h2"),c.textContent="Chat",p=b(),d=f("p"),d.textContent=`Role: ${$t(Nt)}`,m=b(),ve&&ve.c(),_=b(),g=f("div"),h=f("button"),v=f("span"),y=f("i"),w=b(),$=f("span"),L=M(C),N=b(),Ne&&Ne.c(),E=b(),O=f("div"),Q=f("div"),Z=f("div"),D=f("div"),A=f("label"),te=f("input"),q=M(`
              Render markdown`),ie=b(),le=f("div"),H=f("label"),j=f("input"),P=M(`
              Debug mode`),R=b();for(let de=0;de<De.length;de+=1)De[de].c();z=b(),Et&&Et.c(),K=b(),gt&&gt.c(),B=b(),ct&&ct.c(),oe=b(),re=f("div"),Se=f("div"),V=f("textarea"),ne=b(),_e=f("div"),G=f("button"),U=f("span"),U.innerHTML='<i class="fas fa-paper-plane"></i>',ce=b(),ge=f("div"),ue=f("div"),pe=f("div"),me=f("div"),Ee=f("div"),Je=f("h4"),Je.textContent="Context",Qe=b(),$e=f("div"),Ie=f("button"),Ie.innerHTML=`<span class="icon is-small"><i class="fas fa-plus"></i></span> 
                    <span>Add</span>`,he=b(),Ae=f("button"),Ae.innerHTML=`<span class="icon is-small"><i class="fas fa-sitemap"></i></span> 
                    <span>KG Search</span>`,Ve=b(),Be=f("div"),Me=f("div"),Re=f("button"),ll.c(),et=b(),ht&&ht.c(),ft=b(),Ke.c(),Ye=b(),dt=f("div"),Fe=f("div"),ot=f("div"),Ze=f("div"),F=f("span"),se=M(W),Pe=M(" context items"),Oe=b(),ye=f("div"),ye.innerHTML='<div class="level-item"><span class="is-size-7 has-text-grey">Context is automatically included in your chat</span></div>',st=b(),Mt&&Mt.c(),rt=b(),Lt&&Lt.c(),xe=b(),be(it.$$.fragment),Rt=b(),be(St.$$.fragment),Xt=b(),yt&&yt.c(),jt=Ct(),a(c,"class","title is-4"),a(d,"class","subtitle is-6"),a(y,"class",k="fas fa-"+(l[27]?"angle-left":"bars")),a(v,"class","icon is-small"),a(h,"class","button is-small"),a(h,"title",I=l[27]?"Hide session list":"Show session list"),a(g,"class","chat-header-actions svelte-a08hxb"),a(i,"class","chat-header svelte-a08hxb"),a(te,"type","checkbox"),a(A,"class","checkbox is-size-7"),a(D,"class","control"),a(j,"type","checkbox"),a(H,"class","checkbox is-size-7"),a(le,"class","control"),a(Z,"class","field is-grouped"),a(Q,"class","chat-toolbar svelte-a08hxb"),a(O,"class","chat-window svelte-a08hxb"),a(O,"data-testid","chat-messages"),a(V,"class","textarea"),a(V,"rows","3"),a(V,"placeholder","Type your message and press Enter..."),a(V,"data-testid","chat-input"),a(Se,"class","control is-expanded"),a(U,"class","icon"),a(G,"class","button is-primary"),G.disabled=X=l[2]||!l[1].trim(),a(G,"data-testid","send-message-button"),a(_e,"class","control"),a(re,"class","field has-addons chat-input svelte-a08hxb"),a(r,"class","column"),pt(r,"is-8",!l[27]),pt(r,"is-12",l[27]),a(Je,"class","title is-5"),a(Ie,"class","button is-small is-primary"),a(Ie,"data-testid","show-add-context-button"),a(Ae,"class","button is-small is-info"),a(Ae,"data-testid","kg-search-button"),a($e,"class","buttons has-addons"),a(Ee,"class","level-item"),a(me,"class","level-left"),a(Re,"class","button is-small is-light"),Re.disabled=l[13],a(Re,"data-testid","refresh-context-button"),a(Me,"class","level-item"),a(Be,"class","level-right"),a(pe,"class","level is-mobile"),a(F,"class","tag is-light is-small"),a(F,"data-testid","context-summary"),a(Ze,"class","level-item"),a(ot,"class","level-left"),a(ye,"class","level-right"),a(Fe,"class","level is-mobile"),a(dt,"class","mt-4"),a(ue,"class","box context-panel svelte-a08hxb"),a(ue,"data-testid","context-panel"),a(ge,"class","column is-4"),a(n,"class","columns svelte-a08hxb"),a(t,"class","container"),a(e,"class","section"),a(e,"data-testid","chat-interface")},m(de,Te){T(de,e,Te),s(e,t),s(t,n),fe&&fe.m(n,null),s(n,o),s(n,r),s(r,i),s(i,u),s(u,c),s(u,p),s(u,d),s(u,m),ve&&ve.m(u,null),s(i,_),s(i,g),s(g,h),s(h,v),s(v,y),s(h,w),s(h,$),s($,L),s(g,N),Ne&&Ne.m(g,null),s(r,E),s(r,O),s(O,Q),s(Q,Z),s(Z,D),s(D,A),s(A,te),te.checked=l[5],s(A,q),s(Z,ie),s(Z,le),s(le,H),s(H,j),j.checked=l[6],s(H,P),s(O,R);for(let Ft=0;Ft<De.length;Ft+=1)De[Ft]&&De[Ft].m(O,null);s(O,z),Et&&Et.m(O,null),s(r,K),gt&&gt.m(r,null),s(r,B),ct&&ct.m(r,null),s(r,oe),s(r,re),s(re,Se),s(Se,V),je(V,l[1]),s(re,ne),s(re,_e),s(_e,G),s(G,U),s(n,ce),s(n,ge),s(ge,ue),s(ue,pe),s(pe,me),s(me,Ee),s(Ee,Je),s(Ee,Qe),s(Ee,$e),s($e,Ie),s($e,he),s($e,Ae),s(pe,Ve),s(pe,Be),s(Be,Me),s(Me,Re),ll.m(Re,null),s(ue,et),ht&&ht.m(ue,null),s(ue,ft),Bt[tt].m(ue,null),s(ue,Ye),s(ue,dt),s(dt,Fe),s(Fe,ot),s(ot,Ze),s(Ze,F),s(F,se),s(F,Pe),s(Fe,Oe),s(Fe,ye),T(de,st,Te),Mt&&Mt.m(de,Te),T(de,rt,Te),Lt&&Lt.m(de,Te),T(de,xe,Te),ke(it,de,Te),T(de,Rt,Te),ke(St,de,Te),T(de,Xt,Te),yt&&yt.m(de,Te),T(de,jt,Te),Tt=!0,Ht||(Y=[ee(h,"click",l[46]),ee(te,"change",l[48]),ee(te,"change",l[29]),ee(j,"change",l[49]),ee(V,"input",l[54]),ee(V,"keydown",l[38]),ee(G,"click",l[37]),ee(Ie,"click",l[31]),ee(Ae,"click",l[39]),ee(Re,"click",l[30])],Ht=!0)},p(de,Te){if(de[27]?fe?(fe.p(de,Te),Te[0]&134217728&&J(fe,1)):(fe=Fs(de),fe.c(),J(fe,1),fe.m(n,o)):fe&&(qe(),x(fe,1,1,()=>{fe=null}),We()),de[11]?ve?ve.p(de,Te):(ve=zs(de),ve.c(),ve.m(u,null)):ve&&(ve.d(1),ve=null),(!Tt||Te[0]&134217728&&k!==(k="fas fa-"+(de[27]?"angle-left":"bars")))&&a(y,"class",k),(!Tt||Te[0]&134217728)&&C!==(C=de[27]?"Hide":"History")&&ae(L,C),(!Tt||Te[0]&134217728&&I!==(I=de[27]?"Hide session list":"Show session list"))&&a(h,"title",I),de[11]&&!de[28]?Ne?Ne.p(de,Te):(Ne=Ks(de),Ne.c(),Ne.m(g,null)):Ne&&(Ne.d(1),Ne=null),Te[0]&32&&(te.checked=de[5]),Te[0]&64&&(j.checked=de[6]),Te[0]&2017|Te[1]&2048){Ue=de[0];let Dt;for(Dt=0;Dt<Ue.length;Dt+=1){const ul=Hs(de,Ue,Dt);De[Dt]?(De[Dt].p(ul,Te),J(De[Dt],1)):(De[Dt]=qs(ul),De[Dt].c(),J(De[Dt],1),De[Dt].m(O,z))}for(qe(),Dt=Ue.length;Dt<De.length;Dt+=1)xt(Dt);We()}de[2]?Et||(Et=Ws(),Et.c(),Et.m(O,null)):Et&&(Et.d(1),Et=null),de[4]?gt?gt.p(de,Te):(gt=Js(de),gt.c(),gt.m(r,B)):gt&&(gt.d(1),gt=null),de[3]?ct?ct.p(de,Te):(ct=Bs(de),ct.c(),ct.m(r,oe)):ct&&(ct.d(1),ct=null),Te[0]&2&&je(V,de[1]),(!Tt||Te[0]&6&&X!==(X=de[2]||!de[1].trim()))&&(G.disabled=X),(!Tt||Te[0]&134217728)&&pt(r,"is-8",!de[27]),(!Tt||Te[0]&134217728)&&pt(r,"is-12",de[27]),al!==(al=el(de))&&(ll.d(1),ll=al(de),ll&&(ll.c(),ll.m(Re,null))),(!Tt||Te[0]&8192)&&(Re.disabled=de[13]),de[14]?ht?ht.p(de,Te):(ht=Qs(de),ht.c(),ht.m(ue,ft)):ht&&(ht.d(1),ht=null);let Ft=tt;tt=Il(de),tt===Ft?Bt[tt].p(de,Te):(qe(),x(Bt[Ft],1,1,()=>{Bt[Ft]=null}),We(),Ke=Bt[tt],Ke?Ke.p(de,Te):(Ke=Bt[tt]=At[tt](de),Ke.c()),J(Ke,1),Ke.m(ue,Ye)),(!Tt||Te[0]&4096)&&W!==(W=de[12].length+"")&&ae(se,W),de[9]?Mt?Mt.p(de,Te):(Mt=Xs(de),Mt.c(),Mt.m(rt.parentNode,rt)):Mt&&(Mt.d(1),Mt=null),de[10]?Lt?Lt.p(de,Te):(Lt=ei(de),Lt.c(),Lt.m(xe.parentNode,xe)):Lt&&(Lt.d(1),Lt=null);const nl={};Te[0]&1048576&&(nl.context=de[20]),Te[0]&2097152&&(nl.mode=de[21]),!wt&&Te[0]&524288&&(wt=!0,nl.active=de[19],kt(()=>wt=!1)),it.$set(nl);const vl={};Te[0]&2048&&(vl.conversationId=de[11]),!tl&&Te[0]&4194304&&(tl=!0,vl.active=de[22],kt(()=>tl=!1)),St.$set(vl),de[24]?yt?(yt.p(de,Te),Te[0]&16777216&&J(yt,1)):(yt=oi(de),yt.c(),J(yt,1),yt.m(jt.parentNode,jt)):yt&&(qe(),x(yt,1,1,()=>{yt=null}),We())},i(de){if(!Tt){J(fe);for(let Te=0;Te<Ue.length;Te+=1)J(De[Te]);J(Ke),J(it.$$.fragment,de),J(St.$$.fragment,de),J(yt),Tt=!0}},o(de){x(fe),De=De.filter(Boolean);for(let Te=0;Te<De.length;Te+=1)x(De[Te]);x(Ke),x(it.$$.fragment,de),x(St.$$.fragment,de),x(yt),Tt=!1},d(de){de&&S(e),fe&&fe.d(),ve&&ve.d(),Ne&&Ne.d(),_t(De,de),Et&&Et.d(),gt&&gt.d(),ct&&ct.d(),ll.d(),ht&&ht.d(),Bt[tt].d(),de&&S(st),Mt&&Mt.d(de),de&&S(rt),Lt&&Lt.d(de),de&&S(xe),we(it,de),de&&S(Rt),we(St,de),de&&S(Xt),yt&&yt.d(de),de&&S(jt),Ht=!1,lt(Y)}}}function si(){return"terraphim:chatMarkdown"}async function nn(l){try{await navigator.clipboard.writeText(l)}catch(e){console.warn("Clipboard write failed",e)}}function fu(l,e,t){let n,o,r,i;Ge(l,vt,Y=>t(79,n=Y)),Ge(l,Nt,Y=>t(80,o=Y)),Ge(l,Rn,Y=>t(27,r=Y)),Ge(l,Bl,Y=>t(28,i=Y));let u=null,c=null,p=[],d="",m=!1,_=null,g=null,h="",v=!1,y=!1,k=null,w=null,$=!1,C=!1,L=null,I=[],N=!1,E=!1,O="",Q="",Z="document",D=!1,A=!1,te=null,q="edit",ie=null,le=!1,H=!1,j=null,P=null,R=null;function z(){return`terraphim:chatState:${$t(Nt)}`}function K(){try{if(typeof window>"u")return;const Y=localStorage.getItem(z());if(!Y)return;const fe=JSON.parse(Y);Array.isArray(fe.messages)&&t(0,p=fe.messages),typeof fe.conversationId=="string"&&t(11,L=fe.conversationId)}catch(Y){console.warn("Failed to load chat state:",Y)}}function B(){try{if(typeof window>"u")return;const Y={messages:p,conversationId:L};localStorage.setItem(z(),JSON.stringify(Y))}catch(Y){console.warn("Failed to save chat state:",Y)}}function oe(){try{const Y=localStorage.getItem(si());Y!=null&&t(5,v=Y==="true")}catch{}}function re(){try{localStorage.setItem(si(),v?"true":"false")}catch{}}function Se(Y){t(0,p=[...p,{role:"user",content:Y}]),B()}async function V(){try{if(n){const Y=await ze("list_conversations");Y!=null&&Y.conversations&&Y.conversations.length>0?(t(11,L=Y.conversations[0].id),console.log("üéØ Using existing conversation:",L),await _e()):await ne()}else{const Y=await fetch(`${at.ServerURL}/conversations`);if(Y.ok){const fe=await Y.json();fe.conversations&&fe.conversations.length>0?(t(11,L=fe.conversations[0].id),console.log("üéØ Using existing conversation:",L),await _e()):await ne()}else await ne()}}catch(Y){console.error("‚ùå Error initializing conversation:",Y)}}async function ne(){try{const Y=$t(Nt);if(n){const fe=await ze("create_conversation",{title:"Chat Conversation",role:Y});fe.status==="success"&&fe.conversation_id&&(t(11,L=fe.conversation_id),console.log("üÜï Created new conversation:",L),B())}else{const fe=await fetch(`${at.ServerURL}/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"Chat Conversation",role:Y})});if(fe.ok){const ve=await fe.json();ve.status==="Success"&&ve.conversation_id&&(t(11,L=ve.conversation_id),console.log("üÜï Created new conversation:",L),B())}}}catch(Y){console.error("‚ùå Error creating conversation:",Y)}}async function _e(){if(!L){console.warn("‚ö†Ô∏è Cannot load context: no conversation ID available");return}t(13,N=!0),console.log("üîÑ Loading conversation context for:",L);try{if(n){console.log("üì± Loading context via Tauri...");const Y=await ze("get_conversation",{conversationId:L});if(console.log("üì• Tauri response:",Y),Y.status==="success"&&Y.conversation){const fe=Y.conversation.global_context||[];t(12,I=fe),console.log(`‚úÖ Loaded ${fe.length} context items via Tauri`)}else console.error("‚ùå Failed to get conversation via Tauri:",Y.error||"Unknown error"),t(12,I=[])}else{console.log("üåê Loading context via HTTP...");const Y=await fetch(`${at.ServerURL}/conversations/${L}`);if(console.log("üì• HTTP response status:",Y.status,Y.statusText),Y.ok){const fe=await Y.json();if(console.log("üìÑ HTTP response data:",fe),fe.status==="success"&&fe.conversation){const ve=fe.conversation.global_context||[];t(12,I=ve),console.log(`‚úÖ Loaded ${ve.length} context items via HTTP`)}else console.error("‚ùå Failed to get conversation via HTTP:",fe.error||"Unknown error"),t(12,I=[])}else console.error("‚ùå HTTP request failed:",Y.status,Y.statusText),t(12,I=[])}}catch(Y){console.error("‚ùå Error loading conversation context:",{error:Y.message||Y,conversationId:L,isTauri:n,timestamp:new Date().toISOString()}),t(12,I=[])}finally{t(13,N=!1),console.log("üèÅ Context loading completed. Items count:",I.length)}}function G(){t(14,E=!E),E||(t(15,O=""),t(16,Q=""),t(17,Z="document"))}async function U(){if(!(!L||!O.trim()||!Q.trim())){t(18,D=!0);try{const Y={title:O.trim(),summary:null,content:Q.trim(),context_type:Z};if(n){const fe=await ze("add_context_to_conversation",{conversationId:L,contextData:Y});fe.status==="success"?(await _e(),G(),console.log("‚úÖ Context added successfully via Tauri")):console.error("‚ùå Failed to add context via Tauri:",fe.error)}else{const fe=await fetch(`${at.ServerURL}/conversations/${L}/context`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Y)});if(fe.ok){const ve=await fe.json();ve.status==="success"?(await _e(),G(),console.log("‚úÖ Context added successfully via HTTP")):console.error("‚ùå Failed to add context via HTTP:",ve.error)}else console.error("‚ùå HTTP request failed:",fe.status,fe.statusText)}}catch(Y){console.error("‚ùå Error adding manual context:",Y)}finally{t(18,D=!1)}}}async function X(Y,fe){var ve,Ne;if(Y.context_type==="KGTermDefinition"){let Ue=fe||null;(ve=Y.kg_term_definition)!=null&&ve.term?Ue=Y.kg_term_definition.term:Y.title.startsWith("KG Term: ")?Ue=Y.title.replace("KG Term: ",""):(Ne=Y.metadata)!=null&&Ne.normalized_term&&(Ue=Y.metadata.normalized_term),Ue?await ce(Ue):(console.warn("Could not extract term from KG context item:",Y),t(20,te=Y),t(21,q="edit"),t(19,A=!0))}else t(20,te=Y),t(21,q="edit"),t(19,A=!0)}async function ce(Y){var fe,ve,Ne,Ue;console.log(`üîç Finding KG documents for term: "${Y}" in role: "${o}"`);try{if(n){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:o,term:Y});const De=await ze("find_documents_for_kg_term",{roleName:o,term:Y});console.log("  üì• Tauri response received:"),console.log("    Status:",De.status),console.log("    Results count:",((fe=De.results)==null?void 0:fe.length)||0),console.log("    Total:",De.total||0),De.status==="success"&&De.results&&De.results.length>0?(t(24,j=De.results[0]),t(26,R=j.rank||0),t(25,P=Y),console.log("  ‚úÖ Found KG document:",j.title),console.log("  üìÑ Document content preview:",((ve=j.body)==null?void 0:ve.substring(0,200))+"..."),t(23,H=!0)):console.warn(`  ‚ö†Ô∏è  No KG documents found for term: "${Y}" in role: "${o}"`)}else{console.log("  Making HTTP fetch call...");const De=at.ServerURL,xt=encodeURIComponent(o),Et=encodeURIComponent(Y),gt=`${De}/roles/${xt}/kg_search?term=${Et}`,ct=await fetch(gt);if(!ct.ok)throw new Error(`HTTP error! Status: ${ct.status} - ${ct.statusText}`);const el=await ct.json();console.log("  üìÑ Response data:",el.status,"Results:",((Ne=el.results)==null?void 0:Ne.length)||0),el.status==="success"&&el.results&&el.results.length>0?(t(24,j=el.results[0]),t(26,R=j.rank||0),t(25,P=Y),console.log("  ‚úÖ Found KG document:",j.title),console.log("  üìÑ Document content preview:",((Ue=j.body)==null?void 0:Ue.substring(0,200))+"..."),t(23,H=!0)):console.warn(`  ‚ö†Ô∏è  No KG documents found for term: "${Y}" in role: "${o}"`)}}catch(De){console.error("‚ùå Error fetching KG document:",De)}}function ge(Y){confirm(`Are you sure you want to delete "${Y.title}"?`)&&ue(Y.id)}async function ue(Y){if(!(!L||ie)){ie=Y,console.log("üóëÔ∏è Deleting context:",Y);try{if(n){const fe=await ze("delete_context",{conversationId:L,contextId:Y});(fe==null?void 0:fe.status)==="success"?(console.log("‚úÖ Context deleted successfully via Tauri"),await _e()):console.error("‚ùå Failed to delete context via Tauri:",fe==null?void 0:fe.error)}else{const fe=await fetch(`${at.ServerURL}/conversations/${L}/context/${Y}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(fe.ok){const ve=await fe.json();ve.status==="success"?(console.log("‚úÖ Context deleted successfully via HTTP"),await _e()):console.error("‚ùå Failed to delete context via HTTP:",ve.error)}else console.error("‚ùå HTTP delete request failed:",fe.status)}}catch(fe){console.error("‚ùå Error deleting context:",fe)}finally{ie=null}}}async function pe(Y){if(L){console.log("üìù Updating context:",Y.id);try{const fe={context_type:Y.context_type,title:Y.title,summary:Y.summary,content:Y.content,metadata:Y.metadata};if(n){const ve=await ze("update_context",{conversationId:L,contextId:Y.id,request:fe});(ve==null?void 0:ve.status)==="success"?(console.log("‚úÖ Context updated successfully via Tauri"),await _e()):console.error("‚ùå Failed to update context via Tauri:",ve==null?void 0:ve.error)}else{const ve=await fetch(`${at.ServerURL}/conversations/${L}/context/${Y.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(fe)});if(ve.ok){const Ne=await ve.json();Ne.status==="success"?(console.log("‚úÖ Context updated successfully via HTTP"),await _e()):console.error("‚ùå Failed to update context via HTTP:",Ne.error)}else console.error("‚ùå HTTP update request failed:",ve.status)}}catch(fe){console.error("‚ùå Error updating context:",fe)}}}async function me(){var ve,Ne;if(!d.trim()||m)return;t(3,_=null);const Y=$t(Nt),fe=d.trim();t(1,d=""),L||await V(),Se(fe),t(2,m=!0);try{const Ue={role:Y,messages:p};L&&(Ue.conversation_id=L),t(7,k={timestamp:new Date().toISOString(),method:n?"TAURI_INVOKE":"HTTP_POST",endpoint:n?"chat":`${at.ServerURL}/chat`,body:JSON.parse(JSON.stringify(Ue)),context_items_count:I.length,conversation_id:L});let De;if(n)De=await ze("chat",{request:Ue});else{const xt=await fetch(`${at.ServerURL}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Ue)});if(!xt.ok)throw new Error(`HTTP ${xt.status}`);De=await xt.json()}t(8,w={timestamp:new Date().toISOString(),status:De.status,model_used:De.model_used,message_length:((ve=De.message)==null?void 0:ve.length)||0,full_response:JSON.parse(JSON.stringify(De)),error:De.error||null}),t(47,g=De.model_used??null),((Ne=De.status)==null?void 0:Ne.toLowerCase())==="success"&&De.message?(t(0,p=[...p,{role:"assistant",content:De.message}]),B()):t(3,_=De.error||"Chat failed")}catch(Ue){t(3,_=(Ue==null?void 0:Ue.message)||String(Ue)),t(8,w={timestamp:new Date().toISOString(),status:"error",error:(Ue==null?void 0:Ue.message)||String(Ue),full_response:null})}finally{t(2,m=!1)}}function Ee(Y){(Y.key==="Enter"||Y.key==="Return")&&!Y.shiftKey&&(Y.preventDefault(),me())}function Je(){t(22,le=!0)}function Qe(Y){console.log("‚úÖ KG term added to context:",Y.detail.term),_e()}function $e(Y){console.log("‚úÖ KG index added to context for role:",Y.detail.role),_e()}wl(()=>{if(oe(),K(),p.length===0&&(t(0,p=[{role:"assistant",content:"Hi! How can I help you? Ask me anything about your search results or documents."}]),B()),$t(vt)&&(Ul(()=>Promise.resolve().then(()=>gi),void 0).then(Y=>u=Y).catch(()=>{}),Ul(()=>import("./fs-fccecd10.js"),["assets/fs-fccecd10.js","assets/vendor-ui-ec1c326c.js","assets/vendor-ui-5061ae11.css","assets/vendor-utils-8620e3e4.js","assets/vendor-editor-5741781d.js","assets/vendor-editor-461b9769.css","assets/vendor-atomic-ec100559.js","assets/novel-editor-ff46bbca.js","assets/novel-editor-62d29ffc.css","assets/vendor-charts-e6a4a6c9.js"]).then(Y=>c=Y).catch(()=>{})),V(),typeof window<"u"){const Y=()=>{L&&_e()};return window.addEventListener("focus",Y),()=>{window.removeEventListener("focus",Y)}}});async function Ie(Y){try{if($t(vt)&&u&&c){const fe=await u.save({filters:[{name:"Markdown",extensions:["md"]}]});fe&&await c.writeTextFile(fe,Y)}else{const fe=new Blob([Y],{type:"text/markdown;charset=utf-8"}),ve=URL.createObjectURL(fe),Ne=document.createElement("a");Ne.href=ve,Ne.download="chat.md",document.body.appendChild(Ne),Ne.click(),document.body.removeChild(Ne),URL.revokeObjectURL(ve)}}catch(fe){console.warn("Save markdown failed",fe)}}async function he(Y){try{if(n){const fe=await ze("get_persistent_conversation",{conversationId:Y});if(fe.status==="success"&&fe.conversation){const ve=fe.conversation;t(11,L=ve.id),Bl.set(ve.id),t(0,p=ve.messages||[]),t(12,I=ve.global_context||[]),t(3,_=null),console.log("‚úÖ Loaded persistent conversation:",ve.title),B()}else t(3,_=fe.error||"Failed to load conversation"),console.error("‚ùå Failed to load persistent conversation:",_)}}catch(fe){console.error("‚ùå Error loading persistent conversation:",fe),t(3,_=String(fe))}}async function Ae(){if(!L){console.warn("‚ö†Ô∏è No conversation ID to save");return}try{if(n){const Y=await ze("get_conversation",{conversationId:L});if(Y.status==="success"&&Y.conversation){const fe=Y.conversation,ve=await ze("create_persistent_conversation",{title:fe.title||"Chat Conversation",role:fe.role});if(ve.status==="success"&&ve.conversation){const Ne=ve.conversation;(await ze("update_persistent_conversation",{conversation:{...Ne,messages:fe.messages,global_context:fe.global_context}})).status==="success"&&(Bl.set(Ne.id),console.log("‚úÖ Saved persistent conversation:",Ne.id))}}}}catch(Y){console.error("‚ùå Error saving persistent conversation:",Y)}}function Ve(Y){he(Y)}function Be(){t(0,p=[]),t(12,I=[]),t(11,L=null),Bl.set(null),t(3,_=null),ne(),console.log("üÜï Started new conversation")}function Me(){Rn.update(Y=>!Y)}function Re(){v=this.checked,t(5,v)}function et(){y=this.checked,t(6,y)}const ft=Y=>nn(Y.content),tt=Y=>Ie(Y.content),Ke=()=>t(9,$=!0),Ye=()=>t(10,C=!0);function dt(){d=this.value,t(1,d)}function Fe(){Z=Wt(this),t(17,Z)}function ot(){O=this.value,t(15,O)}function Ze(){Q=this.value,t(16,Q)}const F=Y=>ue(Y.detail.contextId),W=Y=>X(Y.detail.contextItem,Y.detail.term),se=Y=>X(Y),Pe=Y=>ge(Y),Oe=()=>t(9,$=!1),ye=()=>t(9,$=!1),st=()=>t(9,$=!1),rt=()=>nn(JSON.stringify(k,null,2)),xe=()=>t(10,C=!1),it=()=>t(10,C=!1),wt=()=>t(10,C=!1),Rt=()=>nn(JSON.stringify(w,null,2));function St(Y){A=Y,t(19,A)}const tl=Y=>pe(Y.detail),Xt=Y=>ue(Y.detail),jt=()=>{t(19,A=!1),t(20,te=null)};function Tt(Y){le=Y,t(22,le)}function Ht(Y){H=Y,t(23,H)}return l.$$.update=()=>{if(l.$$.dirty[1]&65536)try{if(g)if(["ollama","openrouter","anthropic","openai","groq"].includes(g.toLowerCase())){const fe=$t(Jt),ve=$t(Nt),Ne=fe!=null&&fe.roles?fe.roles[ve]:null;let Ue="";g.toLowerCase()==="ollama"?Ue=(Ne==null?void 0:Ne.ollama_model)||(Ne==null?void 0:Ne.llm_chat_model)||"":g.toLowerCase()==="openrouter"&&(Ue=(Ne==null?void 0:Ne.openrouter_chat_model)||(Ne==null?void 0:Ne.openrouter_model)||""),t(4,h=`Provider: ${g}${Ue?` model: ${Ue}`:""}`)}else t(4,h=`Model: ${g}`);else{const Y=$t(Jt),fe=$t(Nt),ve=Y!=null&&Y.roles?Y.roles[fe]:null;let Ne="",Ue="";ve!=null&&ve.openrouter_enabled||ve!=null&&ve.openrouter_chat_model||ve!=null&&ve.openrouter_model?(Ne="openrouter",Ue=(ve==null?void 0:ve.openrouter_chat_model)||(ve==null?void 0:ve.openrouter_model)||""):ve!=null&&ve.ollama_model||(ve==null?void 0:ve.llm_provider)==="ollama"?(Ne="ollama",Ue=(ve==null?void 0:ve.ollama_model)||(ve==null?void 0:ve.llm_chat_model)||""):ve!=null&&ve.llm_provider?(Ne=ve.llm_provider,Ue=(ve==null?void 0:ve.llm_chat_model)||""):Y!=null&&Y.default_model_provider&&(Ne=Y.default_model_provider,Ue=(Y==null?void 0:Y.default_chat_model)||""),Ne?t(4,h=`Provider: ${Ne}${Ue?` model: ${Ue}`:""}`):t(4,h="")}}catch{t(4,h=g?`Model: ${g}`:"")}},[p,d,m,_,h,v,y,k,w,$,C,L,I,N,E,O,Q,Z,D,A,te,q,le,H,j,P,R,r,i,re,_e,G,U,X,ge,ue,pe,me,Ee,Je,Qe,$e,Ie,Ae,Ve,Be,Me,g,Re,et,ft,tt,Ke,Ye,dt,Fe,ot,Ze,F,W,se,Pe,Oe,ye,st,rt,xe,it,wt,Rt,St,tl,Xt,jt,Tt,Ht]}class du extends Pt{constructor(e){super(),Ut(this,e,fu,uu,Ot,{},null,[-1,-1,-1,-1])}}function pu(l){let e,t;return e=new Oa({}),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},i(n){t||(J(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function mu(l){let e,t;return e=new du({}),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},i(n){t||(J(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function _u(l){let e,t;return e=new nc({}),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},i(n){t||(J(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function gu(l){let e,t;return e=new wr({}),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},i(n){t||(J(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function hu(l){let e,t;return e=new Va({}),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},i(n){t||(J(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function vu(l){let e,t;return e=new Xa({}),{c(){be(e.$$.fragment)},m(n,o){ke(e,n,o),t=!0},i(n){t||(J(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function bu(l){let e;return{c(){e=f("nav"),e.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
            <a class="navbar-item" href="/config/wizard">Wizard</a> 
            <a class="navbar-item" href="/config/json">JSON¬†Editor</a> 
            <a class="navbar-item" href="/graph">Graph</a> 
            <a class="navbar-item" href="/chat">Chat</a></div>`,a(e,"class","navbar")},m(t,n){T(t,e,n)},p:Le,d(t){t&&S(e)}}}function ku(l){let e,t,n,o,r,i,u,c,p,d,m,_,g,h,v,y,k,w,$,C,L,I,N,E,O,Q,Z,D,A,te,q,ie,le,H,j,P,R,z,K,B,oe,re,Se,V,ne,_e,G;return E=new Vl({}),Z=new sl({props:{path:"/",$$slots:{default:[pu]},$$scope:{ctx:l}}}),A=new sl({props:{path:"/chat",$$slots:{default:[mu]},$$scope:{ctx:l}}}),q=new sl({props:{path:"/graph",$$slots:{default:[_u]},$$scope:{ctx:l}}}),j=new sl({props:{path:"/fetch/*",$$slots:{default:[gu]},$$scope:{ctx:l}}}),R=new sl({props:{path:"/config/wizard",$$slots:{default:[hu]},$$scope:{ctx:l}}}),K=new sl({props:{path:"/config/json",$$slots:{default:[vu]},$$scope:{ctx:l}}}),Se=new sl({props:{path:"/",$$slots:{default:[bu]},$$scope:{ctx:l}}}),{c(){e=f("meta"),t=b(),n=f("div"),o=f("main"),r=f("div"),i=f("div"),u=f("div"),c=f("button"),p=f("img"),m=b(),_=f("div"),g=f("ul"),h=f("li"),v=f("a"),v.innerHTML=`<span class="icon is-small"><i class="fas fa-search"></i></span> 
                  <span>Search</span>`,y=b(),k=f("li"),w=f("a"),w.innerHTML=`<span class="icon is-small"><i class="fas fa-comments"></i></span> 
                  <span>Chat</span>`,$=b(),C=f("li"),L=f("a"),L.innerHTML=`<span class="icon is-small"><i class="fas fa-project-diagram"></i></span> 
                  <span>Graph</span>`,I=b(),N=f("div"),be(E.$$.fragment),O=b(),Q=f("div"),be(Z.$$.fragment),D=b(),be(A.$$.fragment),te=b(),be(q.$$.fragment),ie=b(),le=f("br"),H=b(),be(j.$$.fragment),P=b(),be(R.$$.fragment),z=b(),be(K.$$.fragment),B=b(),oe=f("footer"),re=f("div"),be(Se.$$.fragment),a(e,"name","color-scheme"),a(e,"content",l[1]),document.title="Terraphim",ii(p.src,d=_i)||a(p,"src",d),a(p,"alt","Terraphim"),a(p,"class","logo-image svelte-16j63mf"),a(c,"class","logo-back-button svelte-16j63mf"),a(c,"title","Go back"),a(c,"aria-label","Go back"),a(v,"href","/"),a(v,"data-exact",""),a(v,"data-testid","search-tab"),a(h,"class","svelte-16j63mf"),a(w,"href","/chat"),a(w,"data-testid","chat-tab"),a(k,"class","svelte-16j63mf"),a(L,"href","/graph"),a(L,"data-testid","graph-tab"),a(C,"class","svelte-16j63mf"),a(_,"class","tabs is-boxed svelte-16j63mf"),a(u,"class","navigation-row svelte-16j63mf"),a(i,"class","main-navigation svelte-16j63mf"),a(N,"class","role-selector svelte-16j63mf"),a(r,"class","top-controls svelte-16j63mf"),a(Q,"class","main-area svelte-16j63mf"),a(o,"class","main-content svelte-16j63mf"),a(re,"class",V=rl(l[0])+" svelte-16j63mf"),a(oe,"class","svelte-16j63mf"),a(n,"class","is-full-height svelte-16j63mf")},m(U,X){s(document.head,e),T(U,t,X),T(U,n,X),s(n,o),s(o,r),s(r,i),s(i,u),s(u,c),s(c,p),s(u,m),s(u,_),s(_,g),s(g,h),s(h,v),s(g,y),s(g,k),s(k,w),s(g,$),s(g,C),s(C,L),s(r,I),s(r,N),ke(E,N,null),s(o,O),s(o,Q),ke(Z,Q,null),s(Q,D),ke(A,Q,null),s(Q,te),ke(q,Q,null),s(o,ie),s(o,le),s(o,H),ke(j,o,null),s(o,P),ke(R,o,null),s(o,z),ke(K,o,null),s(n,B),s(n,oe),s(oe,re),ke(Se,re,null),ne=!0,_e||(G=[ee(c,"click",l[3]),ee(c,"keydown",l[4]),en(tn.call(null,v)),en(tn.call(null,w)),en(tn.call(null,L)),ee(oe,"mouseover",l[2]),ee(oe,"focus",l[2])],_e=!0)},p(U,[X]){(!ne||X&2)&&a(e,"content",U[1]);const ce={};X&64&&(ce.$$scope={dirty:X,ctx:U}),Z.$set(ce);const ge={};X&64&&(ge.$$scope={dirty:X,ctx:U}),A.$set(ge);const ue={};X&64&&(ue.$$scope={dirty:X,ctx:U}),q.$set(ue);const pe={};X&64&&(pe.$$scope={dirty:X,ctx:U}),j.$set(pe);const me={};X&64&&(me.$$scope={dirty:X,ctx:U}),R.$set(me);const Ee={};X&64&&(Ee.$$scope={dirty:X,ctx:U}),K.$set(Ee);const Je={};X&64&&(Je.$$scope={dirty:X,ctx:U}),Se.$set(Je),(!ne||X&1&&V!==(V=rl(U[0])+" svelte-16j63mf"))&&a(re,"class",V)},i(U){ne||(J(E.$$.fragment,U),J(Z.$$.fragment,U),J(A.$$.fragment,U),J(q.$$.fragment,U),J(j.$$.fragment,U),J(R.$$.fragment,U),J(K.$$.fragment,U),J(Se.$$.fragment,U),ne=!0)},o(U){x(E.$$.fragment,U),x(Z.$$.fragment,U),x(A.$$.fragment,U),x(q.$$.fragment,U),x(j.$$.fragment,U),x(R.$$.fragment,U),x(K.$$.fragment,U),x(Se.$$.fragment,U),ne=!1},d(U){S(e),U&&S(t),U&&S(n),we(E),we(Z),we(A),we(q),we(j),we(R),we(K),we(Se),_e=!1,lt(G)}}}function wu(l,e,t){let n;Ge(l,Pl,c=>t(1,n=c));let o="is-hidden";function r(){t(0,o="")}function i(){window.history.length>1?window.history.back():ui.goto("/")}return[o,n,r,i,c=>{(c.key==="Enter"||c.key===" ")&&(c.preventDefault(),i())}]}class yu extends Pt{constructor(e){super(),Ut(this,e,wu,ku,Ot,{})}}new yu({target:document.getElementById("app")});export{Rl as i};
