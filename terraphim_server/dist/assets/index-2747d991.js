import{aa as Ee,S as De,i as Ue,s as Re,q as p,Y as te,b as T,y as u,Z as ke,I as fe,j as R,ak as ue,au as ze,r as G,a as S,v as c,z,t as O,d as D,B,av as Zl,aw as dt,H as ye,U as Ne,V as Oe,ax as Ol,ay as Ql,F as xe,g as Te,e as Le,O as Be,az as Xl,l as V,E as Ie,aA as Pe,aB as Dl,C as Xe,D as yt,G as St,aC as Ul,a2 as xl,aD as en,x as Tt,ac as tn,m as Mt,af as rt,aE as Ct,W as Ze,a7 as ln,a9 as nn,a1 as de,n as on,w as Zt}from"./vendor-ui-9d42ca49.js";import{R as Ke,S as Al}from"./vendor-utils-9430c5aa.js";import{J as Ml,_ as sn,o as rn}from"./vendor-editor-1278af61.js";import{P as Pl,T as Lt,u as jl,y as an,A as cn,S as un,q as fn}from"./vendor-atomic-756de3e6.js";import{E as dn}from"./novel-editor-7c40b83e.js";import{s as Nt,z as pn,a as _n,l as mn,m as hn,c as gn,b as vn,B as bn,d as kn}from"./vendor-charts-e6a4a6c9.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&l(s)}).observe(document,{childList:!0,subtree:!0});function t(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function l(o){if(o.ep)return;o.ep=!0;const a=t(o);fetch(o.href,a)}})();const Qe={ServerURL:location.protocol+"//"+window.location.host||"/"},Dt=Ee([]),$n={id:"Desktop",global_shortcut:"",roles:{},default_role:{original:"",lowercase:""},selected_role:{original:"",lowercase:""}},ft=Ee("spacelab"),at=Ee("selected"),Ce=Ee(!1),wn=Ee(`${Qe.ServerURL}/documents/search`),je=Ee($n),Qt=Ee([]);let Ot=Ee("");const ut=Ee(!1);let Ye=null;function yn(n){if(typeof document>"u")return;const e=`/assets/bulmaswatch/${n}/bulmaswatch.min.css`;if(Ye!=null&&Ye.href.endsWith(e))return;const t=document.createElement("link");t.rel="stylesheet",t.href=e,t.id="bulma-theme",t.onload=()=>{Ye&&Ye!==t&&Ye.remove(),Ye=t},document.head.appendChild(t);const l=document.head.querySelector('meta[name="color-scheme"]');l&&l.setAttribute("content",n)}ft.subscribe(yn);function Sn(n){let e,t;return{c(){e=p("option"),t=te(n[1]),e.__value=n[0],e.value=e.__value},m(l,o){T(l,e,o),u(e,t)},p(l,[o]){o&2&&ke(t,l[1]),o&1&&(e.__value=l[0],e.value=e.__value)},i:fe,o:fe,d(l){l&&R(e)}}}function Cn(n,e,t){let l,{subject:o}=e;const a=Pl(o),s=Lt(a,jl.properties.name);return ue(n,s,r=>t(1,l=r)),Lt(a,"http://localhost:9883/property/theme"),n.$$set=r=>{"subject"in r&&t(0,o=r.subject)},[o,l,s]}class Rn extends De{constructor(e){super(),Ue(this,e,Cn,Sn,Re,{subject:0})}}function Tn(){return window.crypto.getRandomValues(new Uint32Array(1))[0]}function Ut(n,e=!1){const t=Tn(),l=`_${t}`;return Object.defineProperty(window,l,{value:o=>(e&&Reflect.deleteProperty(window,l),n==null?void 0:n(o)),writable:!1,configurable:!0}),t}async function be(n,e={}){return new Promise((t,l)=>{const o=Ut(s=>{t(s),Reflect.deleteProperty(window,`_${a}`)},!0),a=Ut(s=>{l(s),Reflect.deleteProperty(window,`_${o}`)},!0);window.__TAURI_IPC__({cmd:n,callback:o,error:a,...e})})}function Xt(n,e,t){const l=n.slice();return l[25]=e[t],l}function Ln(n){let e,t,l;function o(s){n[13](s)}let a={};return n[5]!==void 0&&(a.value=n[5]),e=new dt({props:a}),ye.push(()=>Ne(e,"value",o)),{c(){G(e.$$.fragment)},m(s,r){z(e,s,r),l=!0},p(s,r){const i={};!t&&r&32&&(t=!0,i.value=s[5],Oe(()=>t=!1)),e.$set(i)},i(s){l||(O(e.$$.fragment,s),l=!0)},o(s){D(e.$$.fragment,s),l=!1},d(s){B(e,s)}}}function En(n){let e,t,l;function o(s){n[14](s)}let a={type:"password",placeholder:"secret",icon:"fas fa-lock",expanded:!0};return n[6]!==void 0&&(a.value=n[6]),e=new dt({props:a}),ye.push(()=>Ne(e,"value",o)),{c(){G(e.$$.fragment)},m(s,r){z(e,s,r),l=!0},p(s,r){const i={};!t&&r&64&&(t=!0,i.value=s[6],Oe(()=>t=!1)),e.$set(i)},i(s){l||(O(e.$$.fragment,s),l=!0)},o(s){D(e.$$.fragment,s),l=!1},d(s){B(e,s)}}}function Nn(n){let e;return{c(){e=te("Save")},m(t,l){T(t,e,l)},d(t){t&&R(e)}}}function On(n){let e,t;return e=new Ol({props:{type:"is-success",class:"is-right",iconPack:"fa",iconLeft:"check",$$slots:{default:[Nn]},$$scope:{ctx:n}}}),e.$on("click",n[8]),e.$on("submit",n[8]),{c(){G(e.$$.fragment)},m(l,o){z(e,l,o),t=!0},p(l,o){const a={};o&268435456&&(a.$$scope={dirty:o,ctx:l}),e.$set(a)},i(l){t||(O(e.$$.fragment,l),t=!0)},o(l){D(e.$$.fragment,l),t=!1},d(l){B(e,l)}}}function Dn(n){let e,t,l,o,a,s;return e=new ze({props:{$$slots:{default:[Ln]},$$scope:{ctx:n}}}),l=new ze({props:{grouped:!0,$$slots:{default:[En]},$$scope:{ctx:n}}}),a=new ze({props:{grouped:!0,$$slots:{default:[On]},$$scope:{ctx:n}}}),{c(){G(e.$$.fragment),t=S(),G(l.$$.fragment),o=S(),G(a.$$.fragment)},m(r,i){z(e,r,i),T(r,t,i),z(l,r,i),T(r,o,i),z(a,r,i),s=!0},p(r,i){const _={};i&268435488&&(_.$$scope={dirty:i,ctx:r}),e.$set(_);const h={};i&268435520&&(h.$$scope={dirty:i,ctx:r}),l.$set(h);const d={};i&268435456&&(d.$$scope={dirty:i,ctx:r}),a.$set(d)},i(r){s||(O(e.$$.fragment,r),O(l.$$.fragment,r),O(a.$$.fragment,r),s=!0)},o(r){D(e.$$.fragment,r),D(l.$$.fragment,r),D(a.$$.fragment,r),s=!1},d(r){B(e,r),r&&R(t),B(l,r),r&&R(o),B(a,r)}}}function Un(n){let e,t,l;function o(s){n[15](s)}let a={type:"search",placeholder:"Fetch JSON",icon:"search"};return n[3]!==void 0&&(a.value=n[3]),e=new dt({props:a}),ye.push(()=>Ne(e,"value",o)),{c(){G(e.$$.fragment)},m(s,r){z(e,s,r),l=!0},p(s,r){const i={};!t&&r&8&&(t=!0,i.value=s[3],Oe(()=>t=!1)),e.$set(i)},i(s){l||(O(e.$$.fragment,s),l=!0)},o(s){D(e.$$.fragment,s),l=!1},d(s){B(e,s)}}}function An(n){let e;return{c(){e=te("WikiPage")},m(t,l){T(t,e,l)},d(t){t&&R(e)}}}function Mn(n){let e,t,l,o,a,s;function r(d){n[16](d)}let i={type:"search",placeholder:"Post JSON",icon:"search"};n[4]!==void 0&&(i.value=n[4]),e=new dt({props:i}),ye.push(()=>Ne(e,"value",r));function _(d){n[17](d)}let h={$$slots:{default:[An]},$$scope:{ctx:n}};return n[2]!==void 0&&(h.checked=n[2]),o=new Ql({props:h}),ye.push(()=>Ne(o,"checked",_)),{c(){G(e.$$.fragment),l=S(),G(o.$$.fragment)},m(d,f){z(e,d,f),T(d,l,f),z(o,d,f),s=!0},p(d,f){const g={};!t&&f&16&&(t=!0,g.value=d[4],Oe(()=>t=!1)),e.$set(g);const m={};f&268435456&&(m.$$scope={dirty:f,ctx:d}),!a&&f&4&&(a=!0,m.checked=d[2],Oe(()=>a=!1)),o.$set(m)},i(d){s||(O(e.$$.fragment,d),O(o.$$.fragment,d),s=!0)},o(d){D(e.$$.fragment,d),D(o.$$.fragment,d),s=!1},d(d){B(e,d),d&&R(l),B(o,d)}}}function Pn(n){let e;return{c(){e=te("Fetch")},m(t,l){T(t,e,l)},d(t){t&&R(e)}}}function jn(n){let e,t;return e=new Ol({props:{type:"is-primary",$$slots:{default:[Pn]},$$scope:{ctx:n}}}),e.$on("click",n[9]),e.$on("submit",n[9]),{c(){G(e.$$.fragment)},m(l,o){z(e,l,o),t=!0},p(l,o){const a={};o&268435456&&(a.$$scope={dirty:o,ctx:l}),e.$set(a)},i(l){t||(O(e.$$.fragment,l),t=!0)},o(l){D(e.$$.fragment,l),t=!1},d(l){B(e,l)}}}function In(n){let e,t,l,o,a,s;return e=new ze({props:{grouped:!0,$$slots:{default:[Un]},$$scope:{ctx:n}}}),l=new ze({props:{grouped:!0,$$slots:{default:[Mn]},$$scope:{ctx:n}}}),a=new ze({props:{grouped:!0,$$slots:{default:[jn]},$$scope:{ctx:n}}}),{c(){G(e.$$.fragment),t=S(),G(l.$$.fragment),o=S(),G(a.$$.fragment)},m(r,i){z(e,r,i),T(r,t,i),z(l,r,i),T(r,o,i),z(a,r,i),s=!0},p(r,i){const _={};i&268435464&&(_.$$scope={dirty:i,ctx:r}),e.$set(_);const h={};i&268435476&&(h.$$scope={dirty:i,ctx:r}),l.$set(h);const d={};i&268435456&&(d.$$scope={dirty:i,ctx:r}),a.$set(d)},i(r){s||(O(e.$$.fragment,r),O(l.$$.fragment,r),O(a.$$.fragment,r),s=!0)},o(r){D(e.$$.fragment,r),D(l.$$.fragment,r),D(a.$$.fragment,r),s=!1},d(r){B(e,r),r&&R(t),B(l,r),r&&R(o),B(a,r)}}}function Wn(n){let e,t,l,o,a;return o=new Ml({props:{content:n[1],onChange:n[7]}}),{c(){e=p("p"),e.innerHTML=`<i>The best editing experience is to configure Atomic Server, in the
        meantime use editor below. You will need to refresh page via Command R
        or Ctrl-R to see changes</i>`,t=S(),l=p("div"),G(o.$$.fragment),c(l,"class","editor")},m(s,r){T(s,e,r),T(s,t,r),T(s,l,r),z(o,l,null),a=!0},p(s,r){const i={};r&2&&(i.content=s[1]),o.$set(i)},i(s){a||(O(o.$$.fragment,s),a=!0)},o(s){D(o.$$.fragment,s),a=!1},d(s){s&&R(e),s&&R(t),s&&R(l),B(o)}}}function xt(n){let e,t;return e=new Rn({props:{subject:n[25]}}),{c(){G(e.$$.fragment)},m(l,o){z(e,l,o),t=!0},p(l,o){const a={};o&1&&(a.subject=l[25]),e.$set(a)},i(l){t||(O(e.$$.fragment,l),t=!0)},o(l){D(e.$$.fragment,l),t=!1},d(l){B(e,l)}}}function Hn(n){let e,t,l=n[0]??[],o=[];for(let s=0;s<l.length;s+=1)o[s]=xt(Xt(n,l,s));const a=s=>D(o[s],1,1,()=>{o[s]=null});return{c(){for(let s=0;s<o.length;s+=1)o[s].c();e=xe()},m(s,r){for(let i=0;i<o.length;i+=1)o[i]&&o[i].m(s,r);T(s,e,r),t=!0},p(s,r){if(r&1){l=s[0]??[];let i;for(i=0;i<l.length;i+=1){const _=Xt(s,l,i);o[i]?(o[i].p(_,r),O(o[i],1)):(o[i]=xt(_),o[i].c(),O(o[i],1),o[i].m(e.parentNode,e))}for(Te(),i=l.length;i<o.length;i+=1)a(i);Le()}},i(s){if(!t){for(let r=0;r<l.length;r+=1)O(o[r]);t=!0}},o(s){o=o.filter(Boolean);for(let r=0;r<o.length;r+=1)D(o[r]);t=!1},d(s){Be(o,s),s&&R(e)}}}function Fn(n){let e,t;return e=new Zl({props:{$$slots:{default:[Hn]},$$scope:{ctx:n}}}),{c(){G(e.$$.fragment)},m(l,o){z(e,l,o),t=!0},p(l,o){const a={};o&268435457&&(a.$$scope={dirty:o,ctx:l}),e.$set(a)},i(l){t||(O(e.$$.fragment,l),t=!0)},o(l){D(e.$$.fragment,l),t=!1},d(l){B(e,l)}}}function Kn(n){let e,t,l,o,a,s,r,i,_,h,d,f,g;return t=new Ke({props:{path:"/atomic",$$slots:{default:[Dn]},$$scope:{ctx:n}}}),o=new Ke({props:{path:"/json",$$slots:{default:[In]},$$scope:{ctx:n}}}),s=new Ke({props:{path:"/editor",$$slots:{default:[Wn]},$$scope:{ctx:n}}}),h=new ze({props:{grouped:!0,position:"is-right",$$slots:{default:[Fn]},$$scope:{ctx:n}}}),{c(){e=p("div"),G(t.$$.fragment),l=S(),G(o.$$.fragment),a=S(),G(s.$$.fragment),r=S(),i=p("hr"),_=S(),G(h.$$.fragment),d=S(),f=p("nav"),f.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
    <a class="navbar-item" href="/fetch/json">Fetch JSON Data</a> 
    <a class="navbar-item" href="/fetch/atomic">Set Atomic Server</a> 
    <a class="navbar-item" href="/fetch/editor">Edit JSON config</a></div>`,c(e,"class","box"),c(f,"class","navbar")},m(m,b){T(m,e,b),z(t,e,null),u(e,l),z(o,e,null),u(e,a),z(s,e,null),T(m,r,b),T(m,i,b),T(m,_,b),z(h,m,b),T(m,d,b),T(m,f,b),g=!0},p(m,[b]){const k={};b&268435552&&(k.$$scope={dirty:b,ctx:m}),t.$set(k);const v={};b&268435484&&(v.$$scope={dirty:b,ctx:m}),o.$set(v);const y={};b&268435458&&(y.$$scope={dirty:b,ctx:m}),s.$set(y);const P={};b&268435457&&(P.$$scope={dirty:b,ctx:m}),h.$set(P)},i(m){g||(O(t.$$.fragment,m),O(o.$$.fragment,m),O(s.$$.fragment,m),O(h.$$.fragment,m),g=!0)},o(m){D(t.$$.fragment,m),D(o.$$.fragment,m),D(s.$$.fragment,m),D(h.$$.fragment,m),g=!1},d(m){m&&R(e),B(t),B(o),B(s),m&&R(r),m&&R(i),m&&R(_),B(h,m),m&&R(d),m&&R(f)}}}function qn(n,e,t){let l,o,a,s,r;ue(n,an,E=>t(19,a=E)),ue(n,Ce,E=>t(20,s=E)),ue(n,je,E=>t(21,r=E));let i={json:r};function _(E){if(console.log("contents changed:",E),console.log("is tauri",s),je.update(w=>(w=E.json,w)),Ce)console.log("Updating config on server"),be("update_config",{configNew:E.json}).then(w=>{console.log(`Message: ${w}`)}).catch(w=>console.error(w));else{let w=`${Qe.ServerURL}/config/`;fetch(w,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(E.json)})}t(1,i=E)}let h=!1,d="https://raw.githubusercontent.com/terraphim/terraphim-cloud-fastapi/main/data/ref_arch.json",f="http://localhost:8000/documents/",g="http://localhost:9883/",m;const b=async()=>{console.log("Updating atomic server configuration");const E=cn.fromSecret(m);a.setServerUrl(g),console.log("Server set.Setting agent"),a.setAgent(E)},k=async()=>{P()},v=({data:{msg:E,data:w}})=>{console.log(E,w)};let y;const P=async()=>{const E=await sn(()=>import("./fetcher.worker-7e58969a.js"),[]);y=new E.default,y.onmessage=v;const w={msg:"fetcher",data:{url:d,postUrl:f,isWiki:h}};y.postMessage(w)},q=Pl("http://localhost:9883/config/y3zx5wtm0bq"),C=Lt(q,jl.properties.name);ue(n,C,E=>t(12,o=E));const N=Lt(q,"http://localhost:9883/property/role");ue(n,N,E=>t(0,l=E));function L(E){g=E,t(5,g)}function F(E){m=E,t(6,m)}function K(E){d=E,t(3,d)}function J(E){f=E,t(4,f)}function I(E){h=E,t(2,h)}return n.$$.update=()=>{n.$$.dirty&4096&&console.log("Print name",o),n.$$.dirty&1&&console.log("Print roles",l)},[l,i,h,d,f,g,m,_,b,k,C,N,o,L,F,K,J,I]}class Gn extends De{constructor(e){super(),Ue(this,e,qn,Kn,Re,{})}}function zn(n){let e,t;return e=new dn({props:{defaultValue:n[0],isEditable:!n[1],disableLocalStorage:!0,onUpdate:n[2],extensions:[rn]}}),{c(){G(e.$$.fragment)},m(l,o){z(e,l,o),t=!0},p(l,[o]){const a={};o&1&&(a.defaultValue=l[0]),o&2&&(a.isEditable=!l[1]),e.$set(a)},i(l){t||(O(e.$$.fragment,l),t=!0)},o(l){D(e.$$.fragment,l),t=!1},d(l){B(e,l)}}}function Bn(n,e,t){let{html:l=""}=e,{readOnly:o=!1}=e,{outputFormat:a="html"}=e;const s=r=>{a==="markdown"?t(0,l=r.storage.markdown.getMarkdown()):t(0,l=r.getHTML())};return n.$$set=r=>{"html"in r&&t(0,l=r.html),"readOnly"in r&&t(1,o=r.readOnly),"outputFormat"in r&&t(3,a=r.outputFormat)},[l,o,s,a]}class Jn extends De{constructor(e){super(),Ue(this,e,Bn,zn,Re,{html:0,readOnly:1,outputFormat:3})}}function el(n){let e,t,l,o,a,s,r,i,_,h,d;return{c(){e=p("div"),t=p("h3"),l=p("span"),l.textContent="Knowledge Graph",o=te(`
          Term: `),a=p("strong"),s=te(n[2]),r=te(" | Rank: "),i=p("strong"),_=te(n[3]),h=S(),d=p("hr"),c(l,"class","tag is-info"),c(t,"class","subtitle is-6"),c(e,"class","kg-context")},m(f,g){T(f,e,g),u(e,t),u(t,l),u(t,o),u(t,a),u(a,s),u(t,r),u(t,i),u(i,_),u(e,h),u(e,d)},p(f,g){g&4&&ke(s,f[2]),g&8&&ke(_,f[3])},d(f){f&&R(e)}}}function Vn(n){let e,t,l,o,a,s,r,i;const _=[Qn,Zn],h=[];function d(f,g){return f[5]?0:1}return t=d(n),l=h[t]=_[t](n),{c(){e=p("div"),l.c(),o=S(),a=p("div"),a.innerHTML='<span class="hint-text svelte-58qxbo">Double-click to edit • Ctrl+E to edit • Ctrl+S to save</span>',c(a,"class","edit-hint svelte-58qxbo"),c(e,"class","content-viewer svelte-58qxbo"),c(e,"tabindex","0"),c(e,"role","button"),c(e,"aria-label","Double-click to edit article content")},m(f,g){T(f,e,g),h[t].m(e,null),u(e,o),u(e,a),n[14](e),s=!0,r||(i=[V(e,"dblclick",n[9]),V(e,"keydown",n[10])],r=!0)},p(f,g){let m=t;t=d(f),t===m?h[t].p(f,g):(Te(),D(h[m],1,1,()=>{h[m]=null}),Le(),l=h[t],l?l.p(f,g):(l=h[t]=_[t](f),l.c()),O(l,1),l.m(e,o))},i(f){s||(O(l),s=!0)},o(f){D(l),s=!1},d(f){f&&R(e),h[t].d(),n[14](null),r=!1,Ie(i)}}}function Yn(n){let e,t,l,o,a,s,r,i,_,h;function d(g){n[12](g)}let f={outputFormat:n[7]};return n[1].body!==void 0&&(f.html=n[1].body),e=new Jn({props:f}),ye.push(()=>Ne(e,"html",d)),{c(){G(e.$$.fragment),l=S(),o=p("div"),a=p("button"),a.textContent="Save",s=S(),r=p("button"),r.textContent="Cancel",c(a,"class","button is-primary"),c(r,"class","button is-light"),c(o,"class","edit-controls svelte-58qxbo")},m(g,m){z(e,g,m),T(g,l,m),T(g,o,m),u(o,a),u(o,s),u(o,r),i=!0,_||(h=[V(a,"click",n[8]),V(r,"click",n[13])],_=!0)},p(g,m){const b={};m&128&&(b.outputFormat=g[7]),!t&&m&2&&(t=!0,b.html=g[1].body,Oe(()=>t=!1)),e.$set(b)},i(g){i||(O(e.$$.fragment,g),i=!0)},o(g){D(e.$$.fragment,g),i=!1},d(g){B(e,g),g&&R(l),g&&R(o),_=!1,Ie(h)}}}function Zn(n){let e,t,l;return t=new Al({props:{source:n[1].body}}),{c(){e=p("div"),G(t.$$.fragment),c(e,"class","markdown-content svelte-58qxbo")},m(o,a){T(o,e,a),z(t,e,null),l=!0},p(o,a){const s={};a&2&&(s.source=o[1].body),t.$set(s)},i(o){l||(O(t.$$.fragment,o),l=!0)},o(o){D(t.$$.fragment,o),l=!1},d(o){o&&R(e),B(t)}}}function Qn(n){let e,t=n[1].body+"";return{c(){e=p("div"),c(e,"class","prose")},m(l,o){T(l,e,o),e.innerHTML=t},p(l,o){o&2&&t!==(t=l[1].body+"")&&(e.innerHTML=t)},i:fe,o:fe,d(l){l&&R(e)}}}function Xn(n){let e,t,l,o=n[1].title+"",a,s,r,i,_,h=n[2]&&n[3]!==null&&el(n);const d=[Yn,Vn],f=[];function g(m,b){return m[4]?0:1}return r=g(n),i=f[r]=d[r](n),{c(){e=p("div"),h&&h.c(),t=S(),l=p("h2"),a=te(o),s=S(),i.c(),c(l,"class","svelte-58qxbo"),c(e,"class","box wrapper svelte-58qxbo")},m(m,b){T(m,e,b),h&&h.m(e,null),u(e,t),u(e,l),u(l,a),u(e,s),f[r].m(e,null),_=!0},p(m,b){m[2]&&m[3]!==null?h?h.p(m,b):(h=el(m),h.c(),h.m(e,t)):h&&(h.d(1),h=null),(!_||b&2)&&o!==(o=m[1].title+"")&&ke(a,o);let k=r;r=g(m),r===k?f[r].p(m,b):(Te(),D(f[k],1,1,()=>{f[k]=null}),Le(),i=f[r],i?i.p(m,b):(i=f[r]=d[r](m),i.c()),O(i,1),i.m(e,null))},i(m){_||(O(i),_=!0)},o(m){D(i),_=!1},d(m){m&&R(e),h&&h.d(),f[r].d()}}}function xn(n){let e,t,l;function o(s){n[15](s)}let a={$$slots:{default:[Xn]},$$scope:{ctx:n}};return n[0]!==void 0&&(a.active=n[0]),e=new Xl({props:a}),ye.push(()=>Ne(e,"active",o)),{c(){G(e.$$.fragment)},m(s,r){z(e,s,r),l=!0},p(s,[r]){const i={};r&262398&&(i.$$scope={dirty:r,ctx:s}),!t&&r&1&&(t=!0,i.active=s[0],Oe(()=>t=!1)),e.$set(i)},i(s){l||(O(e.$$.fragment,s),l=!0)},o(s){D(e.$$.fragment,s),l=!1},d(s){B(e,s)}}}function eo(n,e,t){let l,o,a;ue(n,Ce,C=>t(16,a=C));let{active:s=!1}=e,{item:r}=e,{initialEdit:i=!1}=e,{kgTerm:_=null}=e,{kgRank:h=null}=e,d=!1,f;async function g(){if(a)try{const C=await be("get_document",{document_id:r.id});C!=null&&C.document&&t(1,r=C.document)}catch(C){console.error("Failed to load document",C)}}async function m(){if(!a){t(4,d=!1);return}try{await be("create_document",{document:r}),t(4,d=!1)}catch(C){console.error("Failed to save document",C)}}function b(){t(4,d=!0)}function k(C){C.type!=="dblclick"&&((C.ctrlKey||C.metaKey)&&C.key==="e"&&(C.preventDefault(),t(4,d=!0)),d&&(C.ctrlKey||C.metaKey)&&C.key==="s"&&(C.preventDefault(),m()),d&&C.key==="Escape"&&(C.preventDefault(),t(4,d=!1)))}function v(C){n.$$.not_equal(r.body,C)&&(r.body=C,t(1,r))}const y=()=>t(4,d=!1);function P(C){ye[C?"unshift":"push"](()=>{f=C,t(6,f)})}function q(C){s=C,t(0,s)}return n.$$set=C=>{"active"in C&&t(0,s=C.active),"item"in C&&t(1,r=C.item),"initialEdit"in C&&t(11,i=C.initialEdit),"kgTerm"in C&&t(2,_=C.kgTerm),"kgRank"in C&&t(3,h=C.kgRank)},n.$$.update=()=>{n.$$.dirty&2049&&s&&i&&t(4,d=!0),n.$$.dirty&19&&s&&r&&!d&&g(),n.$$.dirty&2&&t(5,l=r!=null&&r.body?/<html/i.test(r.body)||/<body/i.test(r.body)||/<head/i.test(r.body)||/^\s*<(!DOCTYPE|html|head|body|div|p|span)/i.test(r.body.trim()):!1),n.$$.dirty&32&&t(7,o=l?"html":"markdown")},[s,r,_,h,d,l,f,o,m,b,k,i,v,y,P,q]}class Pt extends De{constructor(e){super(),Ue(this,e,eo,xn,Re,{active:0,item:1,initialEdit:11,kgTerm:2,kgRank:3})}}async function Il(n){return be("tauri",n)}async function to(n,e){return Il({__tauriModule:"Event",message:{cmd:"unlisten",event:n,eventId:e}})}async function lo(n,e,t){return Il({__tauriModule:"Event",message:{cmd:"listen",event:n,windowLabel:e,handler:Ut(t)}}).then(l=>async()=>to(n,l))}var tl;(function(n){n.WINDOW_RESIZED="tauri://resize",n.WINDOW_MOVED="tauri://move",n.WINDOW_CLOSE_REQUESTED="tauri://close-requested",n.WINDOW_CREATED="tauri://window-created",n.WINDOW_DESTROYED="tauri://destroyed",n.WINDOW_FOCUS="tauri://focus",n.WINDOW_BLUR="tauri://blur",n.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",n.WINDOW_THEME_CHANGED="tauri://theme-changed",n.WINDOW_FILE_DROP="tauri://file-drop",n.WINDOW_FILE_DROP_HOVER="tauri://file-drop-hover",n.WINDOW_FILE_DROP_CANCELLED="tauri://file-drop-cancelled",n.MENU="tauri://menu",n.CHECK_UPDATE="tauri://update",n.UPDATE_AVAILABLE="tauri://update-available",n.INSTALL_UPDATE="tauri://update-install",n.STATUS_UPDATE="tauri://update-status",n.DOWNLOAD_PROGRESS="tauri://update-download-progress"})(tl||(tl={}));async function no(n,e){return lo(n,null,e)}function ll(n,e,t){const l=n.slice();return l[9]=e[t],l}function nl(n){let e,t=n[9].name+"",l,o;return{c(){e=p("option"),l=te(t),e.__value=o=n[9].name,e.value=e.__value},m(a,s){T(a,e,s),u(e,l)},p(a,s){s&1&&t!==(t=a[9].name+"")&&ke(l,t),s&1&&o!==(o=a[9].name)&&(e.__value=o,e.value=e.__value)},d(a){a&&R(e)}}}function oo(n){let e,t,l,o,a,s,r=n[0],i=[];for(let _=0;_<r.length;_+=1)i[_]=nl(ll(n,r,_));return{c(){e=p("div"),t=p("div"),l=p("div"),o=p("select");for(let _=0;_<i.length;_+=1)i[_].c();c(l,"class","select"),c(t,"class","control"),c(e,"class","field is-grouped is-grouped-right")},m(_,h){T(_,e,h),u(e,t),u(t,l),u(l,o);for(let d=0;d<i.length;d+=1)i[d]&&i[d].m(o,null);Pe(o,n[1]),a||(s=V(o,"change",n[2]),a=!0)},p(_,[h]){if(h&1){r=_[0];let d;for(d=0;d<r.length;d+=1){const f=ll(_,r,d);i[d]?i[d].p(f,h):(i[d]=nl(f),i[d].c(),i[d].m(o,null))}for(;d<i.length;d+=1)i[d].d(1);i.length=r.length}h&3&&Pe(o,_[1])},i:fe,o:fe,d(_){_&&R(e),Be(i,_),a=!1,s()}}}function so(n,e,t){let l,o,a,s;ue(n,je,f=>t(5,l=f)),ue(n,Ce,f=>t(6,o=f)),ue(n,Qt,f=>t(0,a=f)),ue(n,at,f=>t(1,s=f));let r="";async function i(){try{Ce.set(window.__TAURI__!==void 0),o?(console.log("Loading config from Tauri"),be("get_config").then(f=>{console.log("get_config response",f),f&&f.status==="success"&&_(f.config)}).catch(f=>console.error("Error fetching config in Tauri:",f))):(console.log("Loading config from server"),r=`${Qe.ServerURL}/config/`,fetch(r).then(f=>f.json()).then(f=>{console.log("Config received",f),f&&f.status==="success"&&_(f.config)}).catch(f=>console.error("Error fetching config:",f)))}catch(f){console.error("Unhandled error in loadConfig:",f)}}function _(f){var k;console.log("Updating stores from config:",f);const g={default_role:f.selected_role,...f};je.set(g);const m=Object.entries(f.roles).map(([v,y])=>({name:v,...y}));Qt.set(m),at.set(f.selected_role);const b=f.roles[f.selected_role];if(console.log("Selected role settings:",b),b){const v=b.theme||"spacelab";console.log("Setting theme to:",v),ft.set(v),(k=b.kg)!=null&&k.publish?o&&be("publish_thesaurus",{roleName:f.selected_role}).then(y=>{console.log("publish_thesaurus response",y),Dt.set(y),ut.set(!0)}):ut.set(!1)}else console.warn("No role settings found for:",f.selected_role),ft.set("spacelab")}typeof window<"u"&&window.__TAURI__&&no("role_changed",f=>{console.log("Role changed event received from backend:",f.payload),_(f.payload)});async function h(){await i()}h(),console.log("Using Terraphim Server URL:",Qe.ServerURL);function d(f){var v;const m=f.target.value;console.log("Role change requested:",m),at.set(m);const b=a.find(y=>y.name===m);if(!b){console.error(`No role settings found for role: ${m}.`);return}const k=b.theme||"spacelab";ft.set(k),console.log(`Theme changed to ${k}`),je.update(y=>(y.selected_role=m,y)),o?(be("select_role",{roleName:m}).catch(y=>console.error("Error selecting role:",y)),(v=b.kg)!=null&&v.publish?(console.log("Publishing thesaurus for role",m),be("publish_thesaurus",{roleName:m}).then(y=>{Dt.set(y),ut.set(!0)})):ut.set(!1)):fetch(`${Qe.ServerURL}/config/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}).catch(y=>console.error("Error updating config on server:",y))}return[a,s,d,i]}class Rt extends De{constructor(e){super(),Ue(this,e,so,oo,Re,{loadConfig:3})}get loadConfig(){return this.$$.ctx[3]}}function ol(n,e,t){const l=n.slice();return l[14]=e[t],l}function sl(n){let e,t;return e=new Dl({props:{$$slots:{default:[ao]},$$scope:{ctx:n}}}),{c(){G(e.$$.fragment)},m(l,o){z(e,l,o),t=!0},p(l,o){const a={};o&131137&&(a.$$scope={dirty:o,ctx:l}),e.$set(a)},i(l){t||(O(e.$$.fragment,l),t=!0)},o(l){D(e.$$.fragment,l),t=!1},d(l){B(e,l)}}}function ro(n){let e=n[14]+"",t;return{c(){t=te(e)},m(l,o){T(l,t,o)},p(l,o){o&1&&e!==(e=l[14]+"")&&ke(t,e)},d(l){l&&R(t)}}}function rl(n){let e,t,l,o,a,s;t=new Ul({props:{rounded:!0,$$slots:{default:[ro]},$$scope:{ctx:n}}});function r(){return n[9](n[14])}return{c(){e=p("button"),G(t.$$.fragment),l=S(),c(e,"class","tag-button svelte-1m2cvhr"),e.disabled=n[6],c(e,"title","Click to view knowledge graph document")},m(i,_){T(i,e,_),z(t,e,null),u(e,l),o=!0,a||(s=V(e,"click",r),a=!0)},p(i,_){n=i;const h={};_&131073&&(h.$$scope={dirty:_,ctx:n}),t.$set(h),(!o||_&64)&&(e.disabled=n[6])},i(i){o||(O(t.$$.fragment,i),o=!0)},o(i){D(t.$$.fragment,i),o=!1},d(i){i&&R(e),B(t),a=!1,s()}}}function ao(n){let e,t,l=n[0].tags,o=[];for(let s=0;s<l.length;s+=1)o[s]=rl(ol(n,l,s));const a=s=>D(o[s],1,1,()=>{o[s]=null});return{c(){for(let s=0;s<o.length;s+=1)o[s].c();e=xe()},m(s,r){for(let i=0;i<o.length;i+=1)o[i]&&o[i].m(s,r);T(s,e,r),t=!0},p(s,r){if(r&321){l=s[0].tags;let i;for(i=0;i<l.length;i+=1){const _=ol(s,l,i);o[i]?(o[i].p(_,r),O(o[i],1)):(o[i]=rl(_),o[i].c(),O(o[i],1),o[i].m(e.parentNode,e))}for(Te(),i=l.length;i<o.length;i+=1)a(i);Le()}},i(s){if(!t){for(let r=0;r<l.length;r+=1)O(o[r]);t=!0}},o(s){o=o.filter(Boolean);for(let r=0;r<o.length;r+=1)D(o[r]);t=!1},d(s){Be(o,s),s&&R(e)}}}function io(n){let e,t=n[0].rank+"",l;return{c(){e=te("Rank "),l=te(t)},m(o,a){T(o,e,a),T(o,l,a)},p(o,a){a&1&&t!==(t=o[0].rank+"")&&ke(l,t)},d(o){o&&R(e),o&&R(l)}}}function co(n){let e,t;return e=new Ul({props:{rounded:!0,$$slots:{default:[io]},$$scope:{ctx:n}}}),{c(){G(e.$$.fragment)},m(l,o){z(e,l,o),t=!0},p(l,o){const a={};o&131073&&(a.$$scope={dirty:o,ctx:l}),e.$set(a)},i(l){t||(O(e.$$.fragment,l),t=!0)},o(l){D(e.$$.fragment,l),t=!1},d(l){B(e,l)}}}function uo(n){let e;return{c(){e=p("small"),e.textContent="No description available",c(e,"class","no-description svelte-1m2cvhr")},m(t,l){T(t,e,l)},p:fe,i:fe,o:fe,d(t){t&&R(e)}}}function fo(n){let e,t;return e=new Al({props:{source:n[0].description}}),{c(){G(e.$$.fragment)},m(l,o){z(e,l,o),t=!0},p(l,o){const a={};o&1&&(a.source=l[0].description),e.$set(a)},i(l){t||(O(e.$$.fragment,l),t=!0)},o(l){D(e.$$.fragment,l),t=!1},d(l){B(e,l)}}}function al(n){let e,t,l;return{c(){e=p("a"),t=p("span"),t.innerHTML='<i class="fas fa-link"></i>',c(t,"class","icon is-medium"),c(e,"href",l=n[0].url),c(e,"target","_blank"),c(e,"class","level-item"),c(e,"aria-label","URL")},m(o,a){T(o,e,a),u(e,t)},p(o,a){a&1&&l!==(l=o[0].url)&&c(e,"href",l)},d(o){o&&R(e)}}}function il(n){let e,t,l;function o(s){n[11](s)}let a={item:n[3],kgTerm:n[4],kgRank:n[5]};return n[2]!==void 0&&(a.active=n[2]),e=new Pt({props:a}),ye.push(()=>Ne(e,"active",o)),{c(){G(e.$$.fragment)},m(s,r){z(e,s,r),l=!0},p(s,r){const i={};r&8&&(i.item=s[3]),r&16&&(i.kgTerm=s[4]),r&32&&(i.kgRank=s[5]),!t&&r&4&&(t=!0,i.active=s[2],Oe(()=>t=!1)),e.$set(i)},i(s){l||(O(e.$$.fragment,s),l=!0)},o(s){D(e.$$.fragment,s),l=!1},d(s){B(e,s)}}}function po(n){let e,t,l,o,a,s,r,i,_,h,d,f,g=n[0].title+"",m,b,k,v,y,P,q,C,N,L,F,K,J,I,E,w,W,ne,Q,H,le,Z,ie,pe,me,j,X,x,ae,qe,$=n[0].tags&&sl(n);i=new Dl({props:{$$slots:{default:[co]},$$scope:{ctx:n}}});const A=[fo,uo],U=[];function se(M,oe){return M[0].description?0:1}q=se(n),C=U[q]=A[q](n);let Y="url"in n[0]&&al(n);function ee(M){n[10](M)}let Ae={item:n[0]};n[1]!==void 0&&(Ae.active=n[1]),pe=new Pt({props:Ae}),ye.push(()=>Ne(pe,"active",ee));let ce=n[3]&&il(n);return{c(){e=p("div"),t=p("article"),l=p("div"),o=p("div"),a=p("div"),$&&$.c(),s=S(),r=p("div"),G(i.$$.fragment),_=S(),h=p("div"),d=p("button"),f=p("h2"),m=te(g),b=S(),k=p("div"),v=p("small"),v.textContent="Description:",y=S(),P=p("div"),C.c(),N=S(),L=p("br"),K=S(),J=p("div"),I=p("nav"),E=p("div"),Y&&Y.c(),w=S(),W=p("button"),W.innerHTML='<span class="icon is-medium"><i class="fas fa-plus" aria-hidden="true"></i></span>',ne=S(),Q=p("a"),H=p("span"),H.innerHTML='<i class="fas fa-code" aria-hidden="true"></i>',ie=S(),G(pe.$$.fragment),j=S(),ce&&ce.c(),X=xe(),c(a,"class","level-right"),c(r,"class","level-right"),c(f,"class","title svelte-1m2cvhr"),c(d,"class","svelte-1m2cvhr"),c(v,"class","description-label svelte-1m2cvhr"),c(P,"class","description-content svelte-1m2cvhr"),c(k,"class","description svelte-1m2cvhr"),c(o,"class","content"),c(W,"type","button"),c(W,"class","level-item button is-ghost svelte-1m2cvhr"),c(W,"aria-label","Add to favorites"),c(H,"class","icon is-medium"),c(Q,"href",le=`vscode://${encodeURIComponent(n[0].title)}.md?${encodeURIComponent(n[0].body)}`),c(Q,"class","level-item"),c(Q,"aria-label","Open in VSCode"),c(E,"class","level-right"),c(I,"class","level is-mobile"),c(J,"class","level-right"),c(l,"class","media-content"),c(t,"class","media"),c(e,"class","box")},m(M,oe){T(M,e,oe),u(e,t),u(t,l),u(l,o),u(o,a),$&&$.m(a,null),u(o,s),u(o,r),z(i,r,null),u(o,_),u(o,h),u(h,d),u(d,f),u(f,m),u(h,b),u(h,k),u(k,v),u(k,y),u(k,P),U[q].m(P,null),u(h,N),u(h,L),u(l,K),u(l,J),u(J,I),u(I,E),Y&&Y.m(E,null),u(E,w),u(E,W),u(E,ne),u(E,Q),u(Q,H),T(M,ie,oe),z(pe,M,oe),T(M,j,oe),ce&&ce.m(M,oe),T(M,X,oe),x=!0,ae||(qe=[V(d,"click",n[7]),V(W,"click",_o)],ae=!0)},p(M,[oe]){M[0].tags?$?($.p(M,oe),oe&1&&O($,1)):($=sl(M),$.c(),O($,1),$.m(a,null)):$&&(Te(),D($,1,1,()=>{$=null}),Le());const he={};oe&131073&&(he.$$scope={dirty:oe,ctx:M}),i.$set(he),(!x||oe&1)&&g!==(g=M[0].title+"")&&ke(m,g);let $e=q;q=se(M),q===$e?U[q].p(M,oe):(Te(),D(U[$e],1,1,()=>{U[$e]=null}),Le(),C=U[q],C?C.p(M,oe):(C=U[q]=A[q](M),C.c()),O(C,1),C.m(P,null)),"url"in M[0]?Y?Y.p(M,oe):(Y=al(M),Y.c(),Y.m(E,w)):Y&&(Y.d(1),Y=null),(!x||oe&1&&le!==(le=`vscode://${encodeURIComponent(M[0].title)}.md?${encodeURIComponent(M[0].body)}`))&&c(Q,"href",le);const we={};oe&1&&(we.item=M[0]),!me&&oe&2&&(me=!0,we.active=M[1],Oe(()=>me=!1)),pe.$set(we),M[3]?ce?(ce.p(M,oe),oe&8&&O(ce,1)):(ce=il(M),ce.c(),O(ce,1),ce.m(X.parentNode,X)):ce&&(Te(),D(ce,1,1,()=>{ce=null}),Le())},i(M){x||(O($),O(i.$$.fragment,M),O(C),Xe(()=>{x&&(F||(F=yt(h,St,{},!0)),F.run(1))}),Xe(()=>{x&&(Z||(Z=yt(I,St,{},!0)),Z.run(1))}),O(pe.$$.fragment,M),O(ce),x=!0)},o(M){D($),D(i.$$.fragment,M),D(C),F||(F=yt(h,St,{},!1)),F.run(0),Z||(Z=yt(I,St,{},!1)),Z.run(0),D(pe.$$.fragment,M),D(ce),x=!1},d(M){M&&R(e),$&&$.d(),B(i),U[q].d(),M&&F&&F.end(),Y&&Y.d(),M&&Z&&Z.end(),M&&R(ie),B(pe,M),M&&R(j),ce&&ce.d(M),M&&R(X),ae=!1,Ie(qe)}}}const _o=()=>{};function mo(n,e,t){let l,o;ue(n,at,v=>t(12,l=v)),ue(n,Ce,v=>t(13,o=v));let{document:a}=e,s=!1,r=!1,i=null,_=null,h=null,d=!1;const f=()=>{t(1,s=!0)};async function g(v){var y,P,q,C,N;t(6,d=!0),t(4,_=v),console.log("🔍 KG Search Debug Info:"),console.log("  Tag clicked:",v),console.log("  Current role:",l),console.log("  Is Tauri mode:",o);try{if(o){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:l,term:v});const L=await be("find_documents_for_kg_term",{roleName:l,term:v});console.log("  📥 Tauri response received:"),console.log("    Status:",L.status),console.log("    Results count:",((y=L.results)==null?void 0:y.length)||0),console.log("    Total:",L.total||0),console.log("    Full response:",JSON.stringify(L,null,2)),L.status==="success"&&L.results&&L.results.length>0?(t(3,i=L.results[0]),t(5,h=i.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",i.title),console.log("    Rank:",h),console.log("    Body length:",((P=i.body)==null?void 0:P.length)||0,"characters"),t(2,r=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${v}" in role: "${l}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const L=Qe.ServerURL,F=encodeURIComponent(l),K=encodeURIComponent(v),J=`${L}/roles/${F}/kg_search?term=${K}`;console.log("  📤 HTTP Request details:"),console.log("    Base URL:",L),console.log("    Role (encoded):",F),console.log("    Term (encoded):",K),console.log("    Full URL:",J);const I=await fetch(J);if(console.log("  📥 HTTP Response received:"),console.log("    Status code:",I.status),console.log("    Status text:",I.statusText),console.log("    Headers:",Object.fromEntries(I.headers.entries())),!I.ok)throw new Error(`HTTP error! Status: ${I.status} - ${I.statusText}`);const E=await I.json();console.log("  📄 Response data:"),console.log("    Status:",E.status),console.log("    Results count:",((q=E.results)==null?void 0:q.length)||0),console.log("    Total:",E.total||0),console.log("    Full response:",JSON.stringify(E,null,2)),E.status==="success"&&E.results&&E.results.length>0?(t(3,i=E.results[0]),t(5,h=i.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",i.title),console.log("    Rank:",h),console.log("    Body length:",((C=i.body)==null?void 0:C.length)||0,"characters"),t(2,r=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${v}" in role: "${l}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",J))}}catch(L){console.error("❌ Error fetching KG document:"),console.error("  Error type:",L.constructor.name),console.error("  Error message:",L.message||L),console.error("  Request details:",{tag:v,role:l,isTauri:o,timestamp:new Date().toISOString()}),!o&&((N=L.message)!=null&&N.includes("Failed to fetch"))&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{t(6,d=!1)}}Rt[l]!==void 0&&(console.log("Have attribute",Rt[l]),Rt[l].hasOwnProperty("enableLogseq")?console.log("enable logseq True"):console.log("Didn't make it"));const m=v=>g(v);function b(v){s=v,t(1,s)}function k(v){r=v,t(2,r)}return n.$$set=v=>{"document"in v&&t(0,a=v.document)},[a,s,r,i,_,h,d,f,g,m,b,k]}class ho extends De{constructor(e){super(),Ue(this,e,mo,po,Re,{document:0})}}const go="/assets/terraphim_gray.png";function cl(n,e,t){const l=n.slice();return l[19]=e[t],l}function ul(n,e,t){const l=n.slice();return l[22]=e[t],l[24]=t,l}function fl(n){let e,t=n[2],l=[];for(let o=0;o<t.length;o+=1)l[o]=dl(ul(n,t,o));return{c(){e=p("ul");for(let o=0;o<l.length;o+=1)l[o].c();c(e,"class","suggestions svelte-13t09eu")},m(o,a){T(o,e,a);for(let s=0;s<l.length;s+=1)l[s]&&l[s].m(e,null)},p(o,a){if(a&524){t=o[2];let s;for(s=0;s<t.length;s+=1){const r=ul(o,t,s);l[s]?l[s].p(r,a):(l[s]=dl(r),l[s].c(),l[s].m(e,null))}for(;s<l.length;s+=1)l[s].d(1);l.length=t.length}},d(o){o&&R(e),Be(l,o)}}}function dl(n){let e,t=n[22]+"",l,o,a,s,r,i;function _(){return n[13](n[22])}function h(...d){return n[14](n[22],...d)}return{c(){e=p("li"),l=te(t),o=S(),c(e,"tabindex","0"),c(e,"role","option"),c(e,"aria-selected",a=n[24]===n[3]),c(e,"aria-label",s=`Apply suggestion: ${n[22]}`),c(e,"class","svelte-13t09eu"),Tt(e,"active",n[24]===n[3])},m(d,f){T(d,e,f),u(e,l),u(e,o),r||(i=[V(e,"click",_),V(e,"keydown",h)],r=!0)},p(d,f){n=d,f&4&&t!==(t=n[22]+"")&&ke(l,t),f&8&&a!==(a=n[24]===n[3])&&c(e,"aria-selected",a),f&4&&s!==(s=`Apply suggestion: ${n[22]}`)&&c(e,"aria-label",s),f&8&&Tt(e,"active",n[24]===n[3])},d(d){d&&R(e),r=!1,Ie(i)}}}function vo(n){let e,t,l,o,a;function s(_){n[12](_)}let r={type:"search",placeholder:n[6]?`Search over Knowledge graph for ${n[4]}`:"Search",icon:"search",expanded:!0,autofocus:!0};n[5]!==void 0&&(r.value=n[5]),t=new dt({props:r}),ye.push(()=>Ne(t,"value",s)),t.$on("click",n[10]),t.$on("submit",n[10]),t.$on("keydown",n[8]),t.$on("input",n[7]);let i=n[2].length>0&&fl(n);return{c(){e=p("div"),G(t.$$.fragment),o=S(),i&&i.c(),c(e,"class","input-wrapper svelte-13t09eu")},m(_,h){T(_,e,h),z(t,e,null),u(e,o),i&&i.m(e,null),a=!0},p(_,h){const d={};h&80&&(d.placeholder=_[6]?`Search over Knowledge graph for ${_[4]}`:"Search"),!l&&h&32&&(l=!0,d.value=_[5],Oe(()=>l=!1)),t.$set(d),_[2].length>0?i?i.p(_,h):(i=fl(_),i.c(),i.m(e,null)):i&&(i.d(1),i=null)},i(_){a||(O(t.$$.fragment,_),a=!0)},o(_){D(t.$$.fragment,_),a=!1},d(_){_&&R(e),B(t),i&&i.d()}}}function bo(n){let e,t,l,o,a,s;return{c(){e=p("section"),t=p("div"),l=p("img"),a=S(),s=p("p"),s.textContent="I am Terraphim, your personal assistant.",tn(l.src,o=go)||c(l,"src",o),c(l,"alt","Terraphim Logo"),c(l,"class","svelte-13t09eu"),c(t,"class","content has-text-grey has-text-centered svelte-13t09eu"),c(e,"class","section")},m(r,i){T(r,e,i),u(e,t),u(t,l),u(t,a),u(t,s)},p:fe,i:fe,o:fe,d(r){r&&R(e)}}}function ko(n){let e,t,l=n[0],o=[];for(let s=0;s<l.length;s+=1)o[s]=pl(cl(n,l,s));const a=s=>D(o[s],1,1,()=>{o[s]=null});return{c(){for(let s=0;s<o.length;s+=1)o[s].c();e=xe()},m(s,r){for(let i=0;i<o.length;i+=1)o[i]&&o[i].m(s,r);T(s,e,r),t=!0},p(s,r){if(r&1){l=s[0];let i;for(i=0;i<l.length;i+=1){const _=cl(s,l,i);o[i]?(o[i].p(_,r),O(o[i],1)):(o[i]=pl(_),o[i].c(),O(o[i],1),o[i].m(e.parentNode,e))}for(Te(),i=l.length;i<o.length;i+=1)a(i);Le()}},i(s){if(!t){for(let r=0;r<l.length;r+=1)O(o[r]);t=!0}},o(s){o=o.filter(Boolean);for(let r=0;r<o.length;r+=1)D(o[r]);t=!1},d(s){Be(o,s),s&&R(e)}}}function $o(n){let e,t;return{c(){e=p("p"),t=te(n[1]),c(e,"class","error svelte-13t09eu")},m(l,o){T(l,e,o),u(e,t)},p(l,o){o&2&&ke(t,l[1])},i:fe,o:fe,d(l){l&&R(e)}}}function pl(n){let e,t;return e=new ho({props:{document:n[19]}}),{c(){G(e.$$.fragment)},m(l,o){z(e,l,o),t=!0},p(l,o){const a={};o&1&&(a.document=l[19]),e.$set(a)},i(l){t||(O(e.$$.fragment,l),t=!0)},o(l){D(e.$$.fragment,l),t=!1},d(l){B(e,l)}}}function wo(n){let e,t,l,o,a,s,r,i,_;t=new ze({props:{$$slots:{default:[vo]},$$scope:{ctx:n}}});const h=[$o,ko,bo],d=[];function f(g,m){return g[1]?0:g[0].length?1:2}return o=f(n),a=d[o]=h[o](n),{c(){e=p("form"),G(t.$$.fragment),l=S(),a.c(),s=xe()},m(g,m){T(g,e,m),z(t,e,null),T(g,l,m),d[o].m(g,m),T(g,s,m),r=!0,i||(_=V(e,"submit",xl(n[10])),i=!0)},p(g,[m]){const b={};m&33554556&&(b.$$scope={dirty:m,ctx:g}),t.$set(b);let k=o;o=f(g),o===k?d[o].p(g,m):(Te(),D(d[k],1,1,()=>{d[k]=null}),Le(),a=d[o],a?a.p(g,m):(a=d[o]=h[o](g),a.c()),O(a,1),a.m(s.parentNode,s))},i(g){r||(O(t.$$.fragment,g),O(a),r=!0)},o(g){D(t.$$.fragment,g),D(a),r=!1},d(g){g&&R(e),B(t),g&&R(l),d[o].d(g),g&&R(s),i=!1,_()}}}function yo(n,e,t){let l,o,a,s,r,i,_;ue(n,wn,N=>t(16,o=N)),ue(n,at,N=>t(4,a=N)),ue(n,Ot,N=>t(5,s=N)),ue(n,Ce,N=>t(17,r=N)),ue(n,Dt,N=>t(11,i=N)),ue(n,ut,N=>t(6,_=N));let h=[],d=null,f=[],g=-1;function m(N){const L=N.trim().toLowerCase();return L.length===0?[]:l.filter(([K])=>K.toLowerCase().includes(L)).map(([K])=>K).slice(0,5)}function b(N){const L=N.target;if(!L||L.selectionStart==null)return;const F=L.selectionStart,J=s.slice(0,F).split(/\s+/),I=J[J.length-1];t(2,f=m(I)),t(3,g=-1)}function k(N){f.length!==0&&(N.key==="ArrowDown"?(N.preventDefault(),t(3,g=(g+1)%f.length)):N.key==="ArrowUp"?(N.preventDefault(),t(3,g=(g-1+f.length)%f.length)):(N.key==="Enter"||N.key==="Tab")&&g!==-1&&(N.preventDefault(),v(f[g])))}function v(N){var E;const L=document.querySelector('input[type="search"]'),F=(L==null?void 0:L.selectionStart)??0,K=s.slice(0,F),J=s.slice(F),I=K.split(/\s+/);I[I.length-1]=N,en(Ot,s=[...I,J].join(" "),s),(E=L==null?void 0:L.setSelectionRange)==null||E.call(L,F+N.length,F+N.length),t(2,f=[]),t(3,g=-1)}async function y(){if(t(1,d=null),r)try{const N=await be("search",{searchQuery:{search_term:s,skip:0,limit:10,role:a}});N.status==="success"?(t(0,h=N.results),console.log("Response results"),console.log(h)):(t(1,d=`Search failed: ${N.status}`),console.error("Search failed:",N))}catch(N){t(1,d=`Error in Tauri search: ${N}`),console.error("Error in Tauri search:",N)}else{if(!s.trim())return;const N=JSON.stringify({search_term:s,skip:0,limit:10,role:a});try{const L=await fetch(o,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:N}),F=await L.json();if(!L.ok)throw new Error(`HTTP error! Status: ${L.status}`);t(0,h=F.results)}catch(L){console.error("Error fetching data:",L),t(1,d=`Error fetching data: ${L}`)}}}function P(N){s=N,Ot.set(s)}const q=N=>v(N),C=(N,L)=>{(L.key==="Enter"||L.key===" ")&&(L.preventDefault(),v(N))};return n.$$.update=()=>{n.$$.dirty&2048&&(l=Object.entries(i))},[h,d,f,g,a,s,_,b,k,v,y,i,P,q,C]}class So extends De{constructor(e){super(),Ue(this,e,yo,wo,Re,{})}}function _l(n,e,t){const l=n.slice();return l[44]=e[t],l[45]=e,l[46]=t,l}function ml(n,e,t){const l=n.slice();return l[47]=e[t],l[48]=e,l[49]=t,l}function hl(n,e,t){const l=n.slice();return l[50]=e[t][0],l[51]=e[t][1],l[52]=e,l[53]=t,l}function gl(n,e,t){const l=n.slice();return l[41]=e[t],l}function Co(n){let e,t,l,o=JSON.stringify(n[1],null,2)+"",a;return{c(){e=p("h4"),e.textContent="Review",t=S(),l=p("pre"),a=te(o),c(e,"class","title is-5"),Ze(l,"max-height","300px"),Ze(l,"overflow","auto")},m(s,r){T(s,e,r),T(s,t,r),T(s,l,r),u(l,a)},p(s,r){r[0]&2&&o!==(o=JSON.stringify(s[1],null,2)+"")&&ke(a,o)},d(s){s&&R(e),s&&R(t),s&&R(l)}}}function Ro(n){let e,t,l=[],o=new Map,a,s,r,i,_=n[1].roles;const h=d=>d[44].name;for(let d=0;d<_.length;d+=1){let f=_l(n,_,d),g=h(f);o.set(g,l[d]=wl(g,f))}return{c(){e=p("h4"),e.textContent="Roles",t=S();for(let d=0;d<l.length;d+=1)l[d].c();a=S(),s=p("button"),s.textContent="Add Role",c(e,"class","title is-5"),c(s,"class","button is-link is-light")},m(d,f){T(d,e,f),T(d,t,f);for(let g=0;g<l.length;g+=1)l[g]&&l[g].m(d,f);T(d,a,f),T(d,s,f),r||(i=V(s,"click",n[5]),r=!0)},p(d,f){f[0]&4034&&(_=d[1].roles,l=ln(l,f,h,1,d,_,o,a.parentNode,nn,wl,a,_l))},d(d){d&&R(e),d&&R(t);for(let f=0;f<l.length;f+=1)l[f].d(d);d&&R(a),d&&R(s),r=!1,i()}}}function To(n){let e,t,l,o,a,s,r,i,_,h,d,f,g,m,b,k,v,y,P,q,C,N,L,F,K,J,I,E,w,W,ne=n[1].roles,Q=[];for(let H=0;H<ne.length;H+=1)Q[H]=yl(gl(n,ne,H));return{c(){e=p("div"),t=p("label"),t.textContent="Configuration ID",l=S(),o=p("div"),a=p("div"),s=p("select"),r=p("option"),r.textContent="Desktop",i=p("option"),i.textContent="Server",_=p("option"),_.textContent="Embedded",h=S(),d=p("div"),f=p("label"),f.textContent="Global shortcut",g=S(),m=p("div"),b=p("input"),k=S(),v=p("div"),y=p("label"),y.textContent="Default theme",P=S(),q=p("div"),C=p("input"),N=S(),L=p("div"),F=p("label"),F.textContent="Default Role",K=S(),J=p("div"),I=p("div"),E=p("select");for(let H=0;H<Q.length;H+=1)Q[H].c();c(t,"class","label"),c(t,"for","config-id"),r.__value="Desktop",r.value=r.__value,i.__value="Server",i.value=i.__value,_.__value="Embedded",_.value=_.__value,c(s,"id","config-id"),n[1].id===void 0&&Xe(()=>n[13].call(s)),c(a,"class","select"),c(o,"class","control"),c(e,"class","field"),c(f,"class","label"),c(f,"for","global-shortcut"),c(b,"class","input"),c(b,"id","global-shortcut"),c(b,"type","text"),c(m,"class","control"),c(d,"class","field"),c(y,"class","label"),c(y,"for","default-theme"),c(C,"class","input"),c(C,"id","default-theme"),c(C,"type","text"),c(q,"class","control"),c(v,"class","field"),c(F,"class","label"),c(F,"for","default-role"),c(E,"id","default-role"),n[1].default_role===void 0&&Xe(()=>n[16].call(E)),c(I,"class","select"),c(J,"class","control"),c(L,"class","field")},m(H,le){T(H,e,le),u(e,t),u(e,l),u(e,o),u(o,a),u(a,s),u(s,r),u(s,i),u(s,_),Pe(s,n[1].id,!0),T(H,h,le),T(H,d,le),u(d,f),u(d,g),u(d,m),u(m,b),de(b,n[1].global_shortcut),T(H,k,le),T(H,v,le),u(v,y),u(v,P),u(v,q),u(q,C),de(C,n[1].default_theme),T(H,N,le),T(H,L,le),u(L,F),u(L,K),u(L,J),u(J,I),u(I,E);for(let Z=0;Z<Q.length;Z+=1)Q[Z]&&Q[Z].m(E,null);Pe(E,n[1].default_role,!0),w||(W=[V(s,"change",n[13]),V(b,"input",n[14]),V(C,"input",n[15]),V(E,"change",n[16])],w=!0)},p(H,le){if(le[0]&2&&Pe(s,H[1].id),le[0]&2&&b.value!==H[1].global_shortcut&&de(b,H[1].global_shortcut),le[0]&2&&C.value!==H[1].default_theme&&de(C,H[1].default_theme),le[0]&2){ne=H[1].roles;let Z;for(Z=0;Z<ne.length;Z+=1){const ie=gl(H,ne,Z);Q[Z]?Q[Z].p(ie,le):(Q[Z]=yl(ie),Q[Z].c(),Q[Z].m(E,null))}for(;Z<Q.length;Z+=1)Q[Z].d(1);Q.length=ne.length}le[0]&2&&Pe(E,H[1].default_role)},d(H){H&&R(e),H&&R(h),H&&R(d),H&&R(k),H&&R(v),H&&R(N),H&&R(L),Be(Q,H),w=!1,Ie(W)}}}function Lo(n){let e;return{c(){e=te("Directory Path")},m(t,l){T(t,e,l)},d(t){t&&R(e)}}}function Eo(n){let e;return{c(){e=te("Server URL")},m(t,l){T(t,e,l)},d(t){t&&R(e)}}}function vl(n){let e,t,l,o,a,s,r,i,_,h,d,f;function g(){n[23].call(r,n[46],n[49])}return{c(){e=p("div"),t=p("label"),l=te("Atomic Server Secret"),a=S(),s=p("div"),r=p("input"),_=S(),h=p("p"),h.textContent="Leave empty for anonymous access",c(t,"class","label"),c(t,"for",o=`haystack-secret-${n[46]}-${n[49]}`),c(r,"class","input"),c(r,"id",i=`haystack-secret-${n[46]}-${n[49]}`),c(r,"type","password"),c(r,"placeholder","Base64 encoded secret (optional)"),c(s,"class","control"),c(h,"class","help"),c(e,"class","field")},m(m,b){T(m,e,b),u(e,t),u(t,l),u(e,a),u(e,s),u(s,r),de(r,n[1].roles[n[46]].haystacks[n[49]].atomic_server_secret),u(e,_),u(e,h),d||(f=V(r,"input",g),d=!0)},p(m,b){n=m,b[0]&2&&o!==(o=`haystack-secret-${n[46]}-${n[49]}`)&&c(t,"for",o),b[0]&2&&i!==(i=`haystack-secret-${n[46]}-${n[49]}`)&&c(r,"id",i),b[0]&2&&r.value!==n[1].roles[n[46]].haystacks[n[49]].atomic_server_secret&&de(r,n[1].roles[n[46]].haystacks[n[49]].atomic_server_secret)},d(m){m&&R(e),d=!1,f()}}}function bl(n){let e,t,l,o,a,s,r,i,_,h,d,f,g,m,b,k,v,y=Object.entries(n[1].roles[n[46]].haystacks[n[49]].extra_parameters||{}),P=[];for(let L=0;L<y.length;L+=1)P[L]=kl(hl(n,y,L));function q(){return n[27](n[46],n[49])}function C(){return n[28](n[46],n[49])}function N(){return n[29](n[46],n[49])}return{c(){e=p("div"),t=p("label"),t.textContent="Extra Parameters (for filtering)",l=S();for(let L=0;L<P.length;L+=1)P[L].c();o=S(),a=p("div"),s=p("div"),r=p("button"),r.textContent="+ Tag Filter",i=S(),_=p("div"),h=p("button"),h.textContent="+ Max Results",d=S(),f=p("div"),g=p("button"),g.textContent="+ Custom Parameter",m=S(),b=p("p"),b.innerHTML=`Common parameters: <code>tag</code> (e.g., &quot;#rust&quot;), <code>glob</code> (e.g., &quot;*.md&quot;), 
                  <code>max_count</code> (e.g., &quot;10&quot;), <code>context</code> (e.g., &quot;5&quot;)`,c(t,"class","label"),c(r,"class","button is-small is-link is-light"),c(s,"class","control"),c(h,"class","button is-small is-link is-light"),c(_,"class","control"),c(g,"class","button is-small is-link is-light"),c(f,"class","control"),c(a,"class","field is-grouped"),c(b,"class","help"),c(e,"class","field")},m(L,F){T(L,e,F),u(e,t),u(e,l);for(let K=0;K<P.length;K+=1)P[K]&&P[K].m(e,null);u(e,o),u(e,a),u(a,s),u(s,r),u(a,i),u(a,_),u(_,h),u(a,d),u(a,f),u(f,g),u(e,m),u(e,b),k||(v=[V(r,"click",q),V(h,"click",C),V(g,"click",N)],k=!0)},p(L,F){if(n=L,F[0]&3074){y=Object.entries(n[1].roles[n[46]].haystacks[n[49]].extra_parameters||{});let K;for(K=0;K<y.length;K+=1){const J=hl(n,y,K);P[K]?P[K].p(J,F):(P[K]=kl(J),P[K].c(),P[K].m(e,o))}for(;K<P.length;K+=1)P[K].d(1);P.length=y.length}},d(L){L&&R(e),Be(P,L),k=!1,Ie(v)}}}function kl(n){let e,t,l,o,a,s,r,i,_,h,d,f,g;function m(...v){return n[24](n[46],n[49],n[50],...v)}function b(){n[25].call(r,n[46],n[49],n[50])}function k(){return n[26](n[46],n[49],n[50])}return{c(){e=p("div"),t=p("div"),l=p("input"),a=S(),s=p("div"),r=p("input"),i=S(),_=p("div"),h=p("button"),h.textContent="×",d=S(),c(l,"class","input"),c(l,"type","text"),c(l,"placeholder","Parameter name"),l.value=o=n[50],c(t,"class","control"),c(r,"class","input"),c(r,"type","text"),c(r,"placeholder","Parameter value"),c(s,"class","control is-expanded"),c(h,"class","button is-small is-danger"),c(_,"class","control"),c(e,"class","field is-grouped")},m(v,y){T(v,e,y),u(e,t),u(t,l),u(e,a),u(e,s),u(s,r),de(r,n[1].roles[n[46]].haystacks[n[49]].extra_parameters[n[50]]),u(e,i),u(e,_),u(_,h),u(e,d),f||(g=[V(l,"blur",m),V(r,"input",b),V(h,"click",k)],f=!0)},p(v,y){n=v,y[0]&2&&o!==(o=n[50])&&l.value!==o&&(l.value=o),y[0]&2&&r.value!==n[1].roles[n[46]].haystacks[n[49]].extra_parameters[n[50]]&&de(r,n[1].roles[n[46]].haystacks[n[49]].extra_parameters[n[50]])},d(v){v&&R(e),f=!1,Ie(g)}}}function $l(n){let e,t,l,o,a,s,r,i,_,h,d,f,g,m,b,k,v,y,P,q,C,N,L,F,K,J,I,E,w,W,ne,Q,H,le,Z;function ie(){n[21].call(_,n[46],n[49])}function pe(A,U){return A[1].roles[A[46]].haystacks[A[49]].service==="Atomic"?Eo:Lo}let me=pe(n),j=me(n);function X(){n[22].call(P,n[46],n[49])}let x=n[1].roles[n[46]].haystacks[n[49]].service==="Atomic"&&vl(n),ae=n[1].roles[n[46]].haystacks[n[49]].service==="Ripgrep"&&bl(n);function qe(){n[30].call(I,n[46],n[49])}function $(){return n[31](n[46],n[49])}return{c(){e=p("div"),t=p("div"),l=p("label"),o=te("Service Type"),s=S(),r=p("div"),i=p("div"),_=p("select"),h=p("option"),h.textContent="Ripgrep (File Search)",d=p("option"),d.textContent="Atomic Server",g=S(),m=p("div"),b=p("label"),j.c(),v=S(),y=p("div"),P=p("input"),N=S(),x&&x.c(),L=S(),ae&&ae.c(),F=S(),K=p("div"),J=p("label"),I=p("input"),w=te(`
                 Read-only`),ne=S(),Q=p("div"),H=p("button"),H.textContent="Remove Haystack",c(l,"class","label"),c(l,"for",a=`haystack-service-${n[46]}-${n[49]}`),h.__value="Ripgrep",h.value=h.__value,d.__value="Atomic",d.value=d.__value,c(_,"id",f=`haystack-service-${n[46]}-${n[49]}`),n[1].roles[n[46]].haystacks[n[49]].service===void 0&&Xe(ie),c(i,"class","select"),c(r,"class","control"),c(t,"class","field"),c(b,"class","label"),c(b,"for",k=`haystack-path-${n[46]}-${n[49]}`),c(P,"class","input"),c(P,"id",q=`haystack-path-${n[46]}-${n[49]}`),c(P,"type","text"),c(P,"placeholder",C=n[1].roles[n[46]].haystacks[n[49]].service==="Atomic"?"https://localhost:9883":"/path/to/documents"),c(y,"class","control"),c(m,"class","field"),c(I,"id",E=`haystack-readonly-${n[46]}-${n[49]}`),c(I,"type","checkbox"),c(J,"class","checkbox"),c(J,"for",W=`haystack-readonly-${n[46]}-${n[49]}`),c(K,"class","field"),c(H,"class","button is-small is-danger"),c(Q,"class","field"),c(e,"class","box is-light")},m(A,U){T(A,e,U),u(e,t),u(t,l),u(l,o),u(t,s),u(t,r),u(r,i),u(i,_),u(_,h),u(_,d),Pe(_,n[1].roles[n[46]].haystacks[n[49]].service,!0),u(e,g),u(e,m),u(m,b),j.m(b,null),u(m,v),u(m,y),u(y,P),de(P,n[1].roles[n[46]].haystacks[n[49]].path),u(e,N),x&&x.m(e,null),u(e,L),ae&&ae.m(e,null),u(e,F),u(e,K),u(K,J),u(J,I),I.checked=n[1].roles[n[46]].haystacks[n[49]].read_only,u(J,w),u(e,ne),u(e,Q),u(Q,H),le||(Z=[V(_,"change",ie),V(P,"input",X),V(I,"change",qe),V(H,"click",$)],le=!0)},p(A,U){n=A,U[0]&2&&a!==(a=`haystack-service-${n[46]}-${n[49]}`)&&c(l,"for",a),U[0]&2&&f!==(f=`haystack-service-${n[46]}-${n[49]}`)&&c(_,"id",f),U[0]&2&&Pe(_,n[1].roles[n[46]].haystacks[n[49]].service),me!==(me=pe(n))&&(j.d(1),j=me(n),j&&(j.c(),j.m(b,null))),U[0]&2&&k!==(k=`haystack-path-${n[46]}-${n[49]}`)&&c(b,"for",k),U[0]&2&&q!==(q=`haystack-path-${n[46]}-${n[49]}`)&&c(P,"id",q),U[0]&2&&C!==(C=n[1].roles[n[46]].haystacks[n[49]].service==="Atomic"?"https://localhost:9883":"/path/to/documents")&&c(P,"placeholder",C),U[0]&2&&P.value!==n[1].roles[n[46]].haystacks[n[49]].path&&de(P,n[1].roles[n[46]].haystacks[n[49]].path),n[1].roles[n[46]].haystacks[n[49]].service==="Atomic"?x?x.p(n,U):(x=vl(n),x.c(),x.m(e,L)):x&&(x.d(1),x=null),n[1].roles[n[46]].haystacks[n[49]].service==="Ripgrep"?ae?ae.p(n,U):(ae=bl(n),ae.c(),ae.m(e,F)):ae&&(ae.d(1),ae=null),U[0]&2&&E!==(E=`haystack-readonly-${n[46]}-${n[49]}`)&&c(I,"id",E),U[0]&2&&(I.checked=n[1].roles[n[46]].haystacks[n[49]].read_only),U[0]&2&&W!==(W=`haystack-readonly-${n[46]}-${n[49]}`)&&c(J,"for",W)},d(A){A&&R(e),j.d(),x&&x.d(),ae&&ae.d(),le=!1,Ie(Z)}}}function wl(n,e){let t,l,o,a,s,r,i,_,h,d,f,g,m,b,k,v,y,P,q,C,N,L,F,K,J,I,E,w,W,ne,Q,H,le,Z,ie,pe,me,j,X,x,ae,qe,$,A,U,se,Y,ee,Ae,ce,M,oe,he,$e,we,it,Je,We,pt,Se,_t,jt,mt,et,tt,It,ht,Wt,gt,Me,lt,nt,vt,Ht,ot,Ge,He,bt,Ft,kt,Kt,Ve,Fe,$t,qt,wt,Gt,zt,Bt,ct,Et,Jt;function Hl(){e[17].call(_,e[46])}function Fl(){e[18].call(y,e[46])}function Kl(){e[19].call(I,e[46])}function ql(){e[20].call(ie,e[46])}let st=e[44].haystacks,ge=[];for(let ve=0;ve<st.length;ve+=1)ge[ve]=$l(ml(e,st,ve));function Gl(){return e[32](e[46])}function zl(){e[33].call(M,e[46])}function Bl(){e[34].call(Se,e[46])}function Vt(){e[35].call(Me,e[46])}function Jl(){e[36].call(He,e[46])}function Vl(){e[37].call(Fe,e[46])}function Yl(){return e[38](e[46])}return{key:n,first:null,c(){t=p("div"),l=p("div"),o=p("label"),a=te("Role name"),r=S(),i=p("div"),_=p("input"),d=S(),f=p("div"),g=p("label"),m=te("Short name"),k=S(),v=p("div"),y=p("input"),q=S(),C=p("div"),N=p("label"),L=te("Theme"),K=S(),J=p("div"),I=p("input"),w=S(),W=p("div"),ne=p("label"),Q=te("Relevance function"),le=S(),Z=p("div"),ie=p("input"),me=S(),j=p("h5"),j.textContent="Haystacks",X=S();for(let ve=0;ve<ge.length;ve+=1)ge[ve].c();x=S(),ae=p("button"),ae.textContent="Add Haystack",qe=S(),$=p("h5"),$.textContent="Knowledge Graph",A=S(),U=p("div"),se=p("label"),Y=te("Remote automata URL"),Ae=S(),ce=p("div"),M=p("input"),he=S(),$e=p("div"),we=p("label"),it=te("Local KG path"),We=S(),pt=p("div"),Se=p("input"),jt=S(),mt=p("div"),et=p("div"),tt=p("label"),It=te("Local KG type"),Wt=S(),gt=p("div"),Me=p("select"),lt=p("option"),lt.textContent="markdown",nt=p("option"),nt.textContent="json",Ht=S(),ot=p("div"),Ge=p("label"),He=p("input"),Ft=te(`
             Public`),Kt=S(),Ve=p("label"),Fe=p("input"),qt=te(`
             Publish`),Gt=S(),zt=p("hr"),Bt=S(),ct=p("button"),ct.textContent="Remove Role",c(o,"class","label"),c(o,"for",s=`role-name-${e[46]}`),c(_,"class","input"),c(_,"id",h=`role-name-${e[46]}`),c(_,"type","text"),c(i,"class","control"),c(l,"class","field"),c(g,"class","label"),c(g,"for",b=`role-shortname-${e[46]}`),c(y,"class","input"),c(y,"id",P=`role-shortname-${e[46]}`),c(y,"type","text"),c(v,"class","control"),c(f,"class","field"),c(N,"class","label"),c(N,"for",F=`role-theme-${e[46]}`),c(I,"class","input"),c(I,"id",E=`role-theme-${e[46]}`),c(I,"type","text"),c(J,"class","control"),c(C,"class","field"),c(ne,"class","label"),c(ne,"for",H=`role-relevance-${e[46]}`),c(ie,"class","input"),c(ie,"id",pe=`role-relevance-${e[46]}`),c(ie,"type","text"),c(Z,"class","control"),c(W,"class","field"),c(j,"class","title is-6"),c(ae,"class","button is-small"),c($,"class","title is-6"),c(se,"class","label"),c(se,"for",ee=`kg-url-${e[46]}`),c(M,"class","input"),c(M,"id",oe=`kg-url-${e[46]}`),c(M,"type","text"),c(M,"placeholder","https://example.com/thesaurus.json"),c(ce,"class","control"),c(U,"class","field"),c(we,"class","label"),c(we,"for",Je=`kg-local-path-${e[46]}`),c(Se,"class","input"),c(Se,"id",_t=`kg-local-path-${e[46]}`),c(Se,"type","text"),c(Se,"placeholder","/path/to/markdown"),c(pt,"class","control"),c($e,"class","field"),c(tt,"class","label"),c(tt,"for",ht=`kg-local-type-${e[46]}`),lt.__value="markdown",lt.value=lt.__value,nt.__value="json",nt.value=nt.__value,c(Me,"id",vt=`kg-local-type-${e[46]}`),e[1].roles[e[46]].kg.local_type===void 0&&Xe(Vt),c(gt,"class","select"),c(et,"class","control"),c(mt,"class","field is-grouped"),c(He,"id",bt=`kg-public-${e[46]}`),c(He,"type","checkbox"),c(Ge,"class","checkbox"),c(Ge,"for",kt=`kg-public-${e[46]}`),Ze(Ge,"margin-right","1rem"),c(Fe,"id",$t=`kg-publish-${e[46]}`),c(Fe,"type","checkbox"),c(Ve,"class","checkbox"),c(Ve,"for",wt=`kg-publish-${e[46]}`),c(ot,"class","field is-grouped"),c(ct,"class","button is-small is-danger"),c(t,"class","box"),this.first=t},m(ve,re){T(ve,t,re),u(t,l),u(l,o),u(o,a),u(l,r),u(l,i),u(i,_),de(_,e[1].roles[e[46]].name),u(t,d),u(t,f),u(f,g),u(g,m),u(f,k),u(f,v),u(v,y),de(y,e[1].roles[e[46]].shortname),u(t,q),u(t,C),u(C,N),u(N,L),u(C,K),u(C,J),u(J,I),de(I,e[1].roles[e[46]].theme),u(t,w),u(t,W),u(W,ne),u(ne,Q),u(W,le),u(W,Z),u(Z,ie),de(ie,e[1].roles[e[46]].relevance_function),u(t,me),u(t,j),u(t,X);for(let _e=0;_e<ge.length;_e+=1)ge[_e]&&ge[_e].m(t,null);u(t,x),u(t,ae),u(t,qe),u(t,$),u(t,A),u(t,U),u(U,se),u(se,Y),u(U,Ae),u(U,ce),u(ce,M),de(M,e[1].roles[e[46]].kg.url),u(t,he),u(t,$e),u($e,we),u(we,it),u($e,We),u($e,pt),u(pt,Se),de(Se,e[1].roles[e[46]].kg.local_path),u(t,jt),u(t,mt),u(mt,et),u(et,tt),u(tt,It),u(et,Wt),u(et,gt),u(gt,Me),u(Me,lt),u(Me,nt),Pe(Me,e[1].roles[e[46]].kg.local_type,!0),u(t,Ht),u(t,ot),u(ot,Ge),u(Ge,He),He.checked=e[1].roles[e[46]].kg.public,u(Ge,Ft),u(ot,Kt),u(ot,Ve),u(Ve,Fe),Fe.checked=e[1].roles[e[46]].kg.publish,u(Ve,qt),u(t,Gt),u(t,zt),u(t,Bt),u(t,ct),Et||(Jt=[V(_,"input",Hl),V(y,"input",Fl),V(I,"input",Kl),V(ie,"input",ql),V(ae,"click",Gl),V(M,"input",zl),V(Se,"input",Bl),V(Me,"change",Vt),V(He,"change",Jl),V(Fe,"change",Vl),V(ct,"click",Yl)],Et=!0)},p(ve,re){if(e=ve,re[0]&2&&s!==(s=`role-name-${e[46]}`)&&c(o,"for",s),re[0]&2&&h!==(h=`role-name-${e[46]}`)&&c(_,"id",h),re[0]&2&&_.value!==e[1].roles[e[46]].name&&de(_,e[1].roles[e[46]].name),re[0]&2&&b!==(b=`role-shortname-${e[46]}`)&&c(g,"for",b),re[0]&2&&P!==(P=`role-shortname-${e[46]}`)&&c(y,"id",P),re[0]&2&&y.value!==e[1].roles[e[46]].shortname&&de(y,e[1].roles[e[46]].shortname),re[0]&2&&F!==(F=`role-theme-${e[46]}`)&&c(N,"for",F),re[0]&2&&E!==(E=`role-theme-${e[46]}`)&&c(I,"id",E),re[0]&2&&I.value!==e[1].roles[e[46]].theme&&de(I,e[1].roles[e[46]].theme),re[0]&2&&H!==(H=`role-relevance-${e[46]}`)&&c(ne,"for",H),re[0]&2&&pe!==(pe=`role-relevance-${e[46]}`)&&c(ie,"id",pe),re[0]&2&&ie.value!==e[1].roles[e[46]].relevance_function&&de(ie,e[1].roles[e[46]].relevance_function),re[0]&3842){st=e[44].haystacks;let _e;for(_e=0;_e<st.length;_e+=1){const Yt=ml(e,st,_e);ge[_e]?ge[_e].p(Yt,re):(ge[_e]=$l(Yt),ge[_e].c(),ge[_e].m(t,x))}for(;_e<ge.length;_e+=1)ge[_e].d(1);ge.length=st.length}re[0]&2&&ee!==(ee=`kg-url-${e[46]}`)&&c(se,"for",ee),re[0]&2&&oe!==(oe=`kg-url-${e[46]}`)&&c(M,"id",oe),re[0]&2&&M.value!==e[1].roles[e[46]].kg.url&&de(M,e[1].roles[e[46]].kg.url),re[0]&2&&Je!==(Je=`kg-local-path-${e[46]}`)&&c(we,"for",Je),re[0]&2&&_t!==(_t=`kg-local-path-${e[46]}`)&&c(Se,"id",_t),re[0]&2&&Se.value!==e[1].roles[e[46]].kg.local_path&&de(Se,e[1].roles[e[46]].kg.local_path),re[0]&2&&ht!==(ht=`kg-local-type-${e[46]}`)&&c(tt,"for",ht),re[0]&2&&vt!==(vt=`kg-local-type-${e[46]}`)&&c(Me,"id",vt),re[0]&2&&Pe(Me,e[1].roles[e[46]].kg.local_type),re[0]&2&&bt!==(bt=`kg-public-${e[46]}`)&&c(He,"id",bt),re[0]&2&&(He.checked=e[1].roles[e[46]].kg.public),re[0]&2&&kt!==(kt=`kg-public-${e[46]}`)&&c(Ge,"for",kt),re[0]&2&&$t!==($t=`kg-publish-${e[46]}`)&&c(Fe,"id",$t),re[0]&2&&(Fe.checked=e[1].roles[e[46]].kg.publish),re[0]&2&&wt!==(wt=`kg-publish-${e[46]}`)&&c(Ve,"for",wt)},d(ve){ve&&R(t),Be(ge,ve),Et=!1,Ie(Jt)}}}function yl(n){let e,t=n[41].name+"",l,o;return{c(){e=p("option"),l=te(t),e.__value=o=n[41].name,e.value=e.__value},m(a,s){T(a,e,s),u(e,l)},p(a,s){s[0]&2&&t!==(t=a[41].name+"")&&ke(l,t),s[0]&2&&o!==(o=a[41].name)&&(e.__value=o,e.value=e.__value)},d(a){a&&R(e)}}}function Sl(n){let e,t,l;return{c(){e=p("button"),e.textContent="Back",c(e,"class","button")},m(o,a){T(o,e,a),t||(l=V(e,"click",n[4]),t=!0)},p:fe,d(o){o&&R(e),t=!1,l()}}}function No(n){let e,t,l;return{c(){e=p("button"),e.textContent="Save",c(e,"class","button is-success")},m(o,a){T(o,e,a),t||(l=V(e,"click",n[12]),t=!0)},p:fe,d(o){o&&R(e),t=!1,l()}}}function Oo(n){let e,t,l;return{c(){e=p("button"),e.textContent="Next",c(e,"class","button is-primary")},m(o,a){T(o,e,a),t||(l=V(e,"click",n[3]),t=!0)},p:fe,d(o){o&&R(e),t=!1,l()}}}function Do(n){let e,t,l,o,a,s,r,i;function _(k,v){return k[0]===1?To:k[0]===2?Ro:Co}let h=_(n),d=h(n),f=n[0]>1&&Sl(n);function g(k,v){return k[0]<Wl?Oo:No}let m=g(n),b=m(n);return{c(){e=p("div"),t=p("h3"),t.textContent="Configuration Wizard",l=S(),d.c(),o=S(),a=p("nav"),s=p("div"),f&&f.c(),r=S(),i=p("div"),b.c(),c(t,"class","title is-4"),c(s,"class","level-left"),c(i,"class","level-right"),c(a,"class","level"),c(e,"class","box")},m(k,v){T(k,e,v),u(e,t),u(e,l),d.m(e,null),u(e,o),u(e,a),u(a,s),f&&f.m(s,null),u(a,r),u(a,i),b.m(i,null)},p(k,v){h===(h=_(k))&&d?d.p(k,v):(d.d(1),d=h(k),d&&(d.c(),d.m(e,o))),k[0]>1?f?f.p(k,v):(f=Sl(k),f.c(),f.m(s,null)):f&&(f.d(1),f=null),m===(m=g(k))&&b?b.p(k,v):(b.d(1),b=m(k),b&&(b.c(),b.m(i,null)))},i:fe,o:fe,d(k){k&&R(e),d.d(),f&&f.d(),b.d()}}}const Wl=3;function Uo(n,e,t){let l;const o=Ee(null),a=Ee({id:"Desktop",global_shortcut:"Ctrl+X",default_theme:"spacelab",default_role:"Default",roles:[]});ue(n,a,$=>t(1,l=$)),Mt(async()=>{try{let $;rt(Ce)?$=await be("get_config_schema"):$=await(await fetch("/config/schema")).json(),o.set($);const A=rt(je);A&&A.id&&a.update(U=>{var se;return{...U,id:A.id,global_shortcut:A.global_shortcut,default_theme:((se=A.roles[A.default_role])==null?void 0:se.theme)??"spacelab",default_role:A.default_role,roles:Object.values(A.roles).map(Y=>{var M,oe,he,$e,we,it,Je;const ee=(M=Y.kg)==null?void 0:M.automata_path,Ae=(ee==null?void 0:ee.Remote)??"",ce=((he=(oe=Y.kg)==null?void 0:oe.knowledge_graph_local)==null?void 0:he.path)??"";return{name:Y.name,shortname:Y.shortname,relevance_function:Y.relevance_function,theme:Y.theme,haystacks:(Y.haystacks??[]).map(We=>({path:We.location||We.path||"",read_only:We.read_only??!1,service:We.service||"Ripgrep",atomic_server_secret:We.atomic_server_secret||"",extra_parameters:We.extra_parameters||{}})),kg:{url:Ae,local_path:ce,local_type:((we=($e=Y.kg)==null?void 0:$e.knowledge_graph_local)==null?void 0:we.input_type)??"markdown",public:((it=Y.kg)==null?void 0:it.public)??!1,publish:((Je=Y.kg)==null?void 0:Je.publish)??!1}}})}})}catch($){console.error("Failed to load schema",$)}});let s=1;function r(){s<Wl&&t(0,s+=1)}function i(){s>1&&t(0,s-=1)}function _(){a.update($=>({...$,roles:[...$.roles,{name:"New Role",shortname:"new",relevance_function:"title-scorer",theme:"spacelab",haystacks:[],kg:{url:"",local_path:"",local_type:"markdown",public:!1,publish:!1}}]}))}function h($){a.update(A=>({...A,roles:A.roles.filter((U,se)=>se!==$)}))}function d($){a.update(A=>(A.roles[$].haystacks.push({path:"",read_only:!1,service:"Ripgrep",atomic_server_secret:"",extra_parameters:{}}),A))}function f($,A){a.update(U=>(U.roles[$].haystacks=U.roles[$].haystacks.filter((se,Y)=>Y!==A),U))}function g($,A,U="",se=""){a.update(Y=>{Y.roles[$].haystacks[A].extra_parameters||(Y.roles[$].haystacks[A].extra_parameters={});const ee=U||`param_${Date.now()}`;return Y.roles[$].haystacks[A].extra_parameters[ee]=se,Y})}function m($,A,U){a.update(se=>(delete se.roles[$].haystacks[A].extra_parameters[U],se))}function b($,A,U,se){a.update(Y=>{const ee=Y.roles[$].haystacks[A].extra_parameters;return ee[U]!==void 0&&U!==se&&(ee[se]=ee[U],delete ee[U]),Y})}function k($,A,U,se){const Y=se.target.value;b($,A,U,Y)}async function v(){var Y;const $=rt(a),A=rt(je);let U={...A};U.id=$.id,U.global_shortcut=$.global_shortcut,U.default_role=$.default_role;const se={};$.roles.forEach(ee=>{var M,oe;const Ae=ee.name,ce=Ae.replace(/^"|"$/g,"");se[ce]={extra:((oe=(M=A.roles)==null?void 0:M[Ae])==null?void 0:oe.extra)??{},name:ee.name,shortname:ee.shortname,theme:ee.theme,relevance_function:ee.relevance_function,haystacks:ee.haystacks.map(he=>({location:he.path,service:he.service,read_only:he.read_only,atomic_server_secret:he.service==="Atomic"?he.atomic_server_secret:void 0,extra_parameters:he.extra_parameters||{}})),kg:ee.kg.url||ee.kg.local_path?{automata_path:ee.kg.url?{Remote:ee.kg.url}:null,knowledge_graph_local:ee.kg.local_path?{input_type:ee.kg.local_type,path:ee.kg.local_path}:null,public:ee.kg.public,publish:ee.kg.publish}:null}}),U.roles=se,(!U.default_role||!se[U.default_role])&&(U.default_role=((Y=$.roles[0])==null?void 0:Y.name)??"Default"),U.selected_role=U.default_role;try{rt(Ce)?await be("update_config",{configNew:U}):await fetch("/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(U)}),je.set(U),alert("Configuration saved")}catch(ee){console.error(ee),alert("Failed to save config")}}function y(){l.id=Ct(this),a.set(l)}function P(){l.global_shortcut=this.value,a.set(l)}function q(){l.default_theme=this.value,a.set(l)}function C(){l.default_role=Ct(this),a.set(l)}function N($){l.roles[$].name=this.value,a.set(l)}function L($){l.roles[$].shortname=this.value,a.set(l)}function F($){l.roles[$].theme=this.value,a.set(l)}function K($){l.roles[$].relevance_function=this.value,a.set(l)}function J($,A){l.roles[$].haystacks[A].service=Ct(this),a.set(l)}function I($,A){l.roles[$].haystacks[A].path=this.value,a.set(l)}function E($,A){l.roles[$].haystacks[A].atomic_server_secret=this.value,a.set(l)}const w=($,A,U,se)=>k($,A,U,se);function W($,A,U){l.roles[$].haystacks[A].extra_parameters[U]=this.value,a.set(l)}const ne=($,A,U)=>m($,A,U),Q=($,A)=>g($,A,"tag","#rust"),H=($,A)=>g($,A,"max_count","10"),le=($,A)=>g($,A,"","");function Z($,A){l.roles[$].haystacks[A].read_only=this.checked,a.set(l)}const ie=($,A)=>f($,A),pe=$=>d($);function me($){l.roles[$].kg.url=this.value,a.set(l)}function j($){l.roles[$].kg.local_path=this.value,a.set(l)}function X($){l.roles[$].kg.local_type=Ct(this),a.set(l)}function x($){l.roles[$].kg.public=this.checked,a.set(l)}function ae($){l.roles[$].kg.publish=this.checked,a.set(l)}return[s,l,a,r,i,_,h,d,f,g,m,k,v,y,P,q,C,N,L,F,K,J,I,E,w,W,ne,Q,H,le,Z,ie,pe,me,j,X,x,ae,$=>h($)]}class Ao extends De{constructor(e){super(),Ue(this,e,Uo,Do,Re,{},null,[-1,-1])}}function Mo(n){let e,t,l,o,a,s;return a=new Ml({props:{content:n[0],onChange:n[1]}}),{c(){e=p("div"),t=p("p"),t.innerHTML="<i>The best editing experience is to configure Atomic Server, in the meantime use editor below. You will need to refresh page via Command R or Ctrl-R to see changes</i>",l=S(),o=p("div"),G(a.$$.fragment),c(o,"class","editor"),c(e,"class","box")},m(r,i){T(r,e,i),u(e,t),u(e,l),u(e,o),z(a,o,null),s=!0},p(r,[i]){const _={};i&1&&(_.content=r[0]),a.$set(_)},i(r){s||(O(a.$$.fragment,r),s=!0)},o(r){D(a.$$.fragment,r),s=!1},d(r){r&&R(e),B(a)}}}function Po(n,e,t){let l,o;ue(n,je,r=>t(2,l=r)),ue(n,Ce,r=>t(3,o=r));let a={json:l};function s(r){if(console.log("contents changed:",r),console.log("is tauri",o),je.update(i=>(i=r.json,i)),rt(Ce))console.log("Updating config on server"),be("update_config",{configNew:r.json}).then(i=>{console.log(`Message: ${i}`)}).catch(i=>console.error(i));else{let i=`${Qe.ServerURL}/config/`;fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r.json)})}t(0,a=r)}return Mt(()=>{t(0,a={json:l})}),[a,s]}class jo extends De{constructor(e){super(),Ue(this,e,Po,Mo,Re,{})}}const{window:At}=on;function Io(n){let e,t,l,o,a,s,r,i,_,h;return{c(){e=p("div"),t=p("div"),l=p("h3"),l.textContent="Error loading graph",o=S(),a=p("p"),s=te(n[3]),r=S(),i=p("button"),i.textContent="Retry",c(i,"class","button is-primary"),c(t,"class","error-content svelte-1ry9pkl"),c(e,"class","error-overlay svelte-1ry9pkl")},m(d,f){T(d,e,f),u(e,t),u(t,l),u(t,o),u(t,a),u(a,s),u(t,r),u(t,i),_||(h=V(i,"click",n[11]),_=!0)},p(d,f){f&8&&ke(s,d[3])},d(d){d&&R(e),_=!1,h()}}}function Wo(n){let e;return{c(){e=p("div"),e.innerHTML=`<div class="loading-content svelte-1ry9pkl"><div class="loader svelte-1ry9pkl"></div> 
        <p>Loading knowledge graph...</p></div>`,c(e,"class","loading-overlay svelte-1ry9pkl")},m(t,l){T(t,e,l)},p:fe,d(t){t&&R(e)}}}function Cl(n){let e,t,l;return{c(){e=p("button"),e.innerHTML='<i class="fas fa-times svelte-1ry9pkl"></i>',c(e,"class","close-button svelte-1ry9pkl"),c(e,"title","Close Graph")},m(o,a){T(o,e,a),t||(l=V(e,"click",n[17]),t=!0)},p:fe,d(o){o&&R(e),t=!1,l()}}}function Rl(n){let e;return{c(){e=p("div"),e.innerHTML="<span><strong>Left-click:</strong> View node • <strong>Right-click:</strong> Edit node • <strong>Drag:</strong> Move • <strong>Scroll:</strong> Zoom</span>",c(e,"class","controls-info svelte-1ry9pkl")},m(t,l){T(t,e,l)},d(t){t&&R(e)}}}function Tl(n){let e,t;return{c(){e=p("div"),t=te(n[8]),c(e,"class","debug-message svelte-1ry9pkl")},m(l,o){T(l,e,o),u(e,t)},p(l,o){o&256&&ke(t,l[8])},d(l){l&&R(e)}}}function Ll(n){let e=n[5].id,t,l,o=El(n);return{c(){o.c(),t=xe()},m(a,s){o.m(a,s),T(a,t,s),l=!0},p(a,s){s&32&&Re(e,e=a[5].id)?(Te(),D(o,1,1,fe),Le(),o=El(a),o.c(),O(o,1),o.m(t.parentNode,t)):o.p(a,s)},i(a){l||(O(o),l=!0)},o(a){D(o),l=!1},d(a){a&&R(t),o.d(a)}}}function El(n){let e,t,l;function o(s){n[18](s)}let a={item:n[5],initialEdit:n[7]};return n[6]!==void 0&&(a.active=n[6]),e=new Pt({props:a}),ye.push(()=>Ne(e,"active",o)),e.$on("close",n[12]),e.$on("save",n[13]),{c(){G(e.$$.fragment)},m(s,r){z(e,s,r),l=!0},p(s,r){const i={};r&32&&(i.item=s[5]),r&128&&(i.initialEdit=s[7]),!t&&r&64&&(t=!0,i.active=s[6],Oe(()=>t=!1)),e.$set(i)},i(s){l||(O(e.$$.fragment,s),l=!0)},o(s){D(e.$$.fragment,s),l=!1},d(s){B(e,s)}}}function Ho(n){let e,t,l,o,a,s,r,i,_;Xe(n[15]);function h(v,y){if(v[2])return Wo;if(v[3])return Io}let d=h(n),f=d&&d(n),g=n[0]&&Cl(n),m=!n[2]&&!n[3]&&n[4].length>0&&Rl(),b=n[8]&&Tl(n),k=n[5]&&Ll(n);return{c(){e=p("div"),f&&f.c(),t=S(),g&&g.c(),l=S(),m&&m.c(),o=S(),b&&b.c(),a=S(),k&&k.c(),s=xe(),c(e,"class","graph-container svelte-1ry9pkl"),Ze(e,"width",n[0]?"100vw":"600px"),Ze(e,"height",n[0]?"100vh":"400px"),Tt(e,"fullscreen",n[0])},m(v,y){T(v,e,y),f&&f.m(e,null),n[16](e),T(v,t,y),g&&g.m(v,y),T(v,l,y),m&&m.m(v,y),T(v,o,y),b&&b.m(v,y),T(v,a,y),k&&k.m(v,y),T(v,s,y),r=!0,i||(_=V(At,"resize",n[15]),i=!0)},p(v,[y]){d===(d=h(v))&&f?f.p(v,y):(f&&f.d(1),f=d&&d(v),f&&(f.c(),f.m(e,null))),(!r||y&1)&&Ze(e,"width",v[0]?"100vw":"600px"),(!r||y&1)&&Ze(e,"height",v[0]?"100vh":"400px"),(!r||y&1)&&Tt(e,"fullscreen",v[0]),v[0]?g?g.p(v,y):(g=Cl(v),g.c(),g.m(l.parentNode,l)):g&&(g.d(1),g=null),!v[2]&&!v[3]&&v[4].length>0?m||(m=Rl(),m.c(),m.m(o.parentNode,o)):m&&(m.d(1),m=null),v[8]?b?b.p(v,y):(b=Tl(v),b.c(),b.m(a.parentNode,a)):b&&(b.d(1),b=null),v[5]?k?(k.p(v,y),y&32&&O(k,1)):(k=Ll(v),k.c(),O(k,1),k.m(s.parentNode,s)):k&&(Te(),D(k,1,1,()=>{k=null}),Le())},i(v){r||(O(k),r=!0)},o(v){D(k),r=!1},d(v){v&&R(e),f&&f.d(),n[16](null),v&&R(t),g&&g.d(v),v&&R(l),m&&m.d(v),v&&R(o),b&&b.d(v),v&&R(a),k&&k.d(v),v&&R(s),i=!1,_()}}}function Nl(n){return{id:`kg-node-${n.id}`,url:`#/graph/node/${n.id}`,title:n.label,body:`# ${n.label}

**Knowledge Graph Node**

ID: ${n.id}
Rank: ${n.rank}

This is a concept node from the knowledge graph. You can edit this content to add more information about "${n.label}".`,description:`Knowledge graph concept: ${n.label}`,tags:["knowledge-graph","concept"],rank:n.rank,stub:`Knowledge graph concept: ${n.label}`}}function Fo(n,e,t){let l,o;ue(n,at,w=>t(20,l=w)),ue(n,Ce,w=>t(21,o=w));let{apiUrl:a="/rolegraph"}=e,{fullscreen:s=!0}=e,r,i=!0,_=null,h=[],d=[],f=null,g=!1,m=!1,b="",k=window.innerWidth,v=window.innerHeight;function y(){t(9,k=window.innerWidth),t(10,v=window.innerHeight),!i&&!_&&F()}async function P(){t(2,i=!0),t(3,_=null);try{if(o){console.log("Loading rolegraph from Tauri");const w=await be("get_rolegraph",{roleName:l||void 0});if(w&&w.status==="success")t(4,h=w.nodes),d=w.edges;else throw new Error(`Tauri rolegraph fetch failed: ${(w==null?void 0:w.status)||"unknown error"}`)}else{console.log("Loading rolegraph from server");const w=l?`${a}?role=${encodeURIComponent(l)}`:a,W=await fetch(w);if(!W.ok)throw new Error(`Failed to fetch: ${W.status}`);const ne=await W.json();t(4,h=ne.nodes),d=ne.edges}}catch(w){t(3,_=w.message),console.error("Error fetching rolegraph:",w)}finally{t(2,i=!1)}}function q(w,W){w.stopPropagation(),console.log("Node clicked:",W.label),t(5,f=Nl(W)),t(7,m=!1),t(6,g=!0)}function C(w,W){w.preventDefault(),w.stopPropagation(),console.log("Node right-clicked:",W.label),t(8,b=`Right-clicked: ${W.label}`),t(5,f=Nl(W)),t(7,m=!0),t(6,g=!0),setTimeout(()=>{t(8,b="")},2e3)}function N(){t(6,g=!1),t(5,f=null),t(7,m=!1)}async function L(){if(f)try{const w=await fetch("/documents",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)});w.ok?console.log("Successfully saved KG record:",f.id):console.error("Failed to save KG record:",w.statusText)}catch(w){console.error("Error saving KG record:",w)}finally{t(6,g=!1),t(5,f=null),t(7,m=!1)}}function F(){if(!r)return;t(1,r.innerHTML="",r);const w=Nt(r).append("svg").attr("width",k).attr("height",v),W=pn().scaleExtent([.1,10]).on("zoom",j=>{ne.attr("transform",j.transform)});w.call(W);const ne=w.append("g"),Q=_n(h).force("link",mn(d).id(j=>j.id).distance(100)).force("charge",hn().strength(-200)).force("center",gn(k/2,v/2)).force("collision",vn().radius(20)),H=ne.append("g").attr("class","links").selectAll("line").data(d).enter().append("line").attr("stroke","#666").attr("stroke-opacity",.7).attr("stroke-width",j=>{const X=j.weight||j.rank||1;return Math.max(1,Math.min(8,X*2))}),le=ne.append("g").attr("class","nodes").selectAll("circle").data(h).enter().append("circle").attr("r",j=>{const X=j.rank||1;return Math.max(6,Math.min(20,X*2))}).attr("fill",j=>{const X=j.rank||1,x=Math.min(X/10,1);return bn(.2+x*.6)}).attr("stroke","#fff").attr("stroke-width",2).style("cursor","pointer").on("click",(j,X)=>q(j,X)).on("contextmenu",(j,X)=>C(j,X)).on("mouseover",function(j,X){Nt(this).transition().duration(150).attr("stroke-width",3).attr("r",x=>{const ae=x.rank||1;return Math.max(8,Math.min(24,ae*2.5))})}).on("mouseout",function(j,X){Nt(this).transition().duration(150).attr("stroke-width",2).attr("r",x=>{const ae=x.rank||1;return Math.max(6,Math.min(20,ae*2))})}).call(kn().on("start",ie).on("drag",pe).on("end",me)),Z=ne.append("g").attr("class","labels").selectAll("text").data(h).enter().append("text").attr("text-anchor","middle").attr("dy",".35em").attr("font-size","11px").attr("font-family","Arial, sans-serif").attr("fill","#333").attr("pointer-events","none").text(j=>j.label.length>12?j.label.substring(0,12)+"...":j.label);Q.on("tick",()=>{H.attr("x1",j=>j.source.x).attr("y1",j=>j.source.y).attr("x2",j=>j.target.x).attr("y2",j=>j.target.y),le.attr("cx",j=>j.x).attr("cy",j=>j.y),Z.attr("x",j=>j.x).attr("y",j=>j.y)});function ie(j,X){j.active||Q.alphaTarget(.3).restart(),X.fx=X.x,X.fy=X.y}function pe(j,X){X.fx=j.x,X.fy=j.y}function me(j,X){j.active||Q.alphaTarget(0),X.fx=null,X.fy=null}}Mt(()=>{P().then(()=>{_||F()});const w=W=>{W.preventDefault()};return r&&r.addEventListener("contextmenu",w),window.addEventListener("resize",y),()=>{r&&r.removeEventListener("contextmenu",w),window.removeEventListener("resize",y)}});function K(){t(9,k=At.innerWidth),t(10,v=At.innerHeight)}function J(w){ye[w?"unshift":"push"](()=>{r=w,t(1,r)})}const I=()=>history.back();function E(w){g=w,t(6,g)}return n.$$set=w=>{"apiUrl"in w&&t(14,a=w.apiUrl),"fullscreen"in w&&t(0,s=w.fullscreen)},[s,r,i,_,h,f,g,m,b,k,v,P,N,L,a,K,J,I,E]}class Ko extends De{constructor(e){super(),Ue(this,e,Fo,Ho,Re,{apiUrl:14,fullscreen:0})}}function qo(n){let e,t;return e=new So({}),{c(){G(e.$$.fragment)},m(l,o){z(e,l,o),t=!0},i(l){t||(O(e.$$.fragment,l),t=!0)},o(l){D(e.$$.fragment,l),t=!1},d(l){B(e,l)}}}function Go(n){let e,t;return e=new Gn({}),{c(){G(e.$$.fragment)},m(l,o){z(e,l,o),t=!0},i(l){t||(O(e.$$.fragment,l),t=!0)},o(l){D(e.$$.fragment,l),t=!1},d(l){B(e,l)}}}function zo(n){let e,t;return e=new Ao({}),{c(){G(e.$$.fragment)},m(l,o){z(e,l,o),t=!0},i(l){t||(O(e.$$.fragment,l),t=!0)},o(l){D(e.$$.fragment,l),t=!1},d(l){B(e,l)}}}function Bo(n){let e,t;return e=new jo({}),{c(){G(e.$$.fragment)},m(l,o){z(e,l,o),t=!0},i(l){t||(O(e.$$.fragment,l),t=!0)},o(l){D(e.$$.fragment,l),t=!1},d(l){B(e,l)}}}function Jo(n){let e,t;return e=new Ko({}),{c(){G(e.$$.fragment)},m(l,o){z(e,l,o),t=!0},i(l){t||(O(e.$$.fragment,l),t=!0)},o(l){D(e.$$.fragment,l),t=!1},d(l){B(e,l)}}}function Vo(n){let e;return{c(){e=p("nav"),e.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
            <a class="navbar-item" href="/config/wizard">Wizard</a> 
            <a class="navbar-item" href="/config/json">JSON Editor</a> 
            <a class="navbar-item" href="/graph">Graph</a></div>`,c(e,"class","navbar")},m(t,l){T(t,e,l)},p:fe,d(t){t&&R(e)}}}function Yo(n){let e,t,l,o,a,s,r,i,_,h,d,f,g,m,b,k,v,y,P,q,C,N,L,F,K,J,I,E;return r=new Rt({}),h=new Ke({props:{path:"/",$$slots:{default:[qo]},$$scope:{ctx:n}}}),m=new Ke({props:{path:"/fetch/*",$$slots:{default:[Go]},$$scope:{ctx:n}}}),k=new Ke({props:{path:"/config/wizard",$$slots:{default:[zo]},$$scope:{ctx:n}}}),y=new Ke({props:{path:"/config/json",$$slots:{default:[Bo]},$$scope:{ctx:n}}}),q=new Ke({props:{path:"/graph",$$slots:{default:[Jo]},$$scope:{ctx:n}}}),F=new Ke({props:{path:"/",$$slots:{default:[Vo]},$$scope:{ctx:n}}}),{c(){e=p("meta"),t=S(),l=p("div"),o=p("main"),a=p("div"),s=p("div"),G(r.$$.fragment),i=S(),_=p("div"),G(h.$$.fragment),d=S(),f=p("br"),g=S(),G(m.$$.fragment),b=S(),G(k.$$.fragment),v=S(),G(y.$$.fragment),P=S(),G(q.$$.fragment),C=S(),N=p("footer"),L=p("div"),G(F.$$.fragment),c(e,"name","color-scheme"),c(e,"content",n[1]),document.title="Terraphim",c(s,"class","role-selector svelte-1bfpta4"),c(a,"class","top-controls svelte-1bfpta4"),c(_,"class","search-area svelte-1bfpta4"),c(o,"class","main-content svelte-1bfpta4"),c(L,"class",K=Zt(n[0])+" svelte-1bfpta4"),c(N,"class","svelte-1bfpta4"),c(l,"class","is-full-height svelte-1bfpta4")},m(w,W){u(document.head,e),T(w,t,W),T(w,l,W),u(l,o),u(o,a),u(a,s),z(r,s,null),u(o,i),u(o,_),z(h,_,null),u(o,d),u(o,f),u(o,g),z(m,o,null),u(o,b),z(k,o,null),u(o,v),z(y,o,null),u(o,P),z(q,o,null),u(l,C),u(l,N),u(N,L),z(F,L,null),J=!0,I||(E=[V(N,"mouseover",n[2]),V(N,"focus",n[2])],I=!0)},p(w,[W]){(!J||W&2)&&c(e,"content",w[1]);const ne={};W&8&&(ne.$$scope={dirty:W,ctx:w}),h.$set(ne);const Q={};W&8&&(Q.$$scope={dirty:W,ctx:w}),m.$set(Q);const H={};W&8&&(H.$$scope={dirty:W,ctx:w}),k.$set(H);const le={};W&8&&(le.$$scope={dirty:W,ctx:w}),y.$set(le);const Z={};W&8&&(Z.$$scope={dirty:W,ctx:w}),q.$set(Z);const ie={};W&8&&(ie.$$scope={dirty:W,ctx:w}),F.$set(ie),(!J||W&1&&K!==(K=Zt(w[0])+" svelte-1bfpta4"))&&c(L,"class",K)},i(w){J||(O(r.$$.fragment,w),O(h.$$.fragment,w),O(m.$$.fragment,w),O(k.$$.fragment,w),O(y.$$.fragment,w),O(q.$$.fragment,w),O(F.$$.fragment,w),J=!0)},o(w){D(r.$$.fragment,w),D(h.$$.fragment,w),D(m.$$.fragment,w),D(k.$$.fragment,w),D(y.$$.fragment,w),D(q.$$.fragment,w),D(F.$$.fragment,w),J=!1},d(w){R(e),w&&R(t),w&&R(l),B(r),B(h),B(m),B(k),B(y),B(q),B(F),I=!1,Ie(E)}}}function Zo(n,e,t){let l;ue(n,ft,s=>t(1,l=s));let o="is-hidden";function a(){t(0,o="")}return[o,l,a]}class Qo extends De{constructor(e){super(),Ue(this,e,Zo,Yo,Re,{})}}const Xo=new un;fn(Xo);new Qo({target:document.getElementById("app")});
