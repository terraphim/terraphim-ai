import{aa as ve,S as be,i as ke,s as $e,q as d,Y as x,b as R,y as f,Z as pe,I as oe,j as y,ak as le,au as je,r as W,a as L,v as u,z as I,t as E,d as M,B as H,av as Gl,aw as nt,H as ge,U as Se,V as Ce,ax as Sl,ay as Kl,F as Xe,g as Ee,e as De,O as He,az as Jl,l as B,E as Pe,aA as Ue,aB as Cl,C as Qe,D as $t,G as vt,aC as Rl,a2 as Bl,aD as Vl,x as kt,ac as ql,m as Et,af as Ye,aE as St,W as Ae,a7 as Yl,a9 as Zl,a1 as se,n as Ql,w as Yt}from"./vendor-ui-9d76793c.js";import{R as Oe,S as Xl}from"./vendor-utils-fcc8930b.js";import{J as Nl,_ as xl,o as en}from"./vendor-editor-5a401e82.js";import{P as Ll,T as wt,u as Ol,y as tn,A as ln,S as nn,q as on}from"./vendor-atomic-5b44511b.js";import{E as sn}from"./novel-editor-81c1fec3.js";import{s as Ct,z as rn,a as an,l as un,m as cn,c as fn,b as pn,B as dn,d as _n}from"./vendor-charts-e6a4a6c9.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))t(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&t(s)}).observe(document,{childList:!0,subtree:!0});function l(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function t(o){if(o.ep)return;o.ep=!0;const r=l(o);fetch(o.href,r)}})();const Ze={ServerURL:location.protocol+"//"+window.location.host||"/"},Nt=ve([]),hn={id:"",global_shortcut:"",roles:{},default_role:"",selected_role:""},tt=ve("spacelab"),lt=ve("selected"),Re=ve(!1),mn=ve(`${Ze.ServerURL}/documents/search`),ye=ve(hn),Zt=ve([]);let Rt=ve("");const et=ve(!1);let Ie=null;function gn(n){if(typeof document>"u")return;const e=`/assets/bulmaswatch/${n}/bulmaswatch.min.css`;if(Ie!=null&&Ie.href.endsWith(e))return;const l=document.createElement("link");l.rel="stylesheet",l.href=e,l.id="bulma-theme",l.onload=()=>{Ie&&Ie!==l&&Ie.remove(),Ie=l},document.head.appendChild(l);const t=document.head.querySelector('meta[name="color-scheme"]');t&&t.setAttribute("content",n)}tt.subscribe(gn);function $n(n){let e,l;return{c(){e=d("option"),l=x(n[1]),e.__value=n[0],e.value=e.__value},m(t,o){R(t,e,o),f(e,l)},p(t,[o]){o&2&&pe(l,t[1]),o&1&&(e.__value=t[0],e.value=e.__value)},i:oe,o:oe,d(t){t&&y(e)}}}function vn(n,e,l){let t,{subject:o}=e;const r=Ll(o),s=wt(r,Ol.properties.name);return le(n,s,a=>l(1,t=a)),wt(r,"http://localhost:9883/property/theme"),n.$$set=a=>{"subject"in a&&l(0,o=a.subject)},[o,t,s]}class bn extends be{constructor(e){super(),ke(this,e,vn,$n,$e,{subject:0})}}function kn(){return window.crypto.getRandomValues(new Uint32Array(1))[0]}function Lt(n,e=!1){const l=kn(),t=`_${l}`;return Object.defineProperty(window,t,{value:o=>(e&&Reflect.deleteProperty(window,t),n==null?void 0:n(o)),writable:!1,configurable:!0}),l}async function me(n,e={}){return new Promise((l,t)=>{const o=Lt(s=>{l(s),Reflect.deleteProperty(window,`_${r}`)},!0),r=Lt(s=>{t(s),Reflect.deleteProperty(window,`_${o}`)},!0);window.__TAURI_IPC__({cmd:n,callback:o,error:r,...e})})}function Qt(n,e,l){const t=n.slice();return t[25]=e[l],t}function wn(n){let e,l,t;function o(s){n[13](s)}let r={};return n[5]!==void 0&&(r.value=n[5]),e=new nt({props:r}),ge.push(()=>Se(e,"value",o)),{c(){W(e.$$.fragment)},m(s,a){I(e,s,a),t=!0},p(s,a){const i={};!l&&a&32&&(l=!0,i.value=s[5],Ce(()=>l=!1)),e.$set(i)},i(s){t||(E(e.$$.fragment,s),t=!0)},o(s){M(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function yn(n){let e,l,t;function o(s){n[14](s)}let r={type:"password",placeholder:"secret",icon:"fas fa-lock",expanded:!0};return n[6]!==void 0&&(r.value=n[6]),e=new nt({props:r}),ge.push(()=>Se(e,"value",o)),{c(){W(e.$$.fragment)},m(s,a){I(e,s,a),t=!0},p(s,a){const i={};!l&&a&64&&(l=!0,i.value=s[6],Ce(()=>l=!1)),e.$set(i)},i(s){t||(E(e.$$.fragment,s),t=!0)},o(s){M(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function Sn(n){let e;return{c(){e=x("Save")},m(l,t){R(l,e,t)},d(l){l&&y(e)}}}function Cn(n){let e,l;return e=new Sl({props:{type:"is-success",class:"is-right",iconPack:"fa",iconLeft:"check",$$slots:{default:[Sn]},$$scope:{ctx:n}}}),e.$on("click",n[8]),e.$on("submit",n[8]),{c(){W(e.$$.fragment)},m(t,o){I(e,t,o),l=!0},p(t,o){const r={};o&268435456&&(r.$$scope={dirty:o,ctx:t}),e.$set(r)},i(t){l||(E(e.$$.fragment,t),l=!0)},o(t){M(e.$$.fragment,t),l=!1},d(t){H(e,t)}}}function Rn(n){let e,l,t,o,r,s;return e=new je({props:{$$slots:{default:[wn]},$$scope:{ctx:n}}}),t=new je({props:{grouped:!0,$$slots:{default:[yn]},$$scope:{ctx:n}}}),r=new je({props:{grouped:!0,$$slots:{default:[Cn]},$$scope:{ctx:n}}}),{c(){W(e.$$.fragment),l=L(),W(t.$$.fragment),o=L(),W(r.$$.fragment)},m(a,i){I(e,a,i),R(a,l,i),I(t,a,i),R(a,o,i),I(r,a,i),s=!0},p(a,i){const _={};i&268435488&&(_.$$scope={dirty:i,ctx:a}),e.$set(_);const m={};i&268435520&&(m.$$scope={dirty:i,ctx:a}),t.$set(m);const p={};i&268435456&&(p.$$scope={dirty:i,ctx:a}),r.$set(p)},i(a){s||(E(e.$$.fragment,a),E(t.$$.fragment,a),E(r.$$.fragment,a),s=!0)},o(a){M(e.$$.fragment,a),M(t.$$.fragment,a),M(r.$$.fragment,a),s=!1},d(a){H(e,a),a&&y(l),H(t,a),a&&y(o),H(r,a)}}}function Nn(n){let e,l,t;function o(s){n[15](s)}let r={type:"search",placeholder:"Fetch JSON",icon:"search"};return n[3]!==void 0&&(r.value=n[3]),e=new nt({props:r}),ge.push(()=>Se(e,"value",o)),{c(){W(e.$$.fragment)},m(s,a){I(e,s,a),t=!0},p(s,a){const i={};!l&&a&8&&(l=!0,i.value=s[3],Ce(()=>l=!1)),e.$set(i)},i(s){t||(E(e.$$.fragment,s),t=!0)},o(s){M(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function Ln(n){let e;return{c(){e=x("WikiPage")},m(l,t){R(l,e,t)},d(l){l&&y(e)}}}function On(n){let e,l,t,o,r,s;function a(p){n[16](p)}let i={type:"search",placeholder:"Post JSON",icon:"search"};n[4]!==void 0&&(i.value=n[4]),e=new nt({props:i}),ge.push(()=>Se(e,"value",a));function _(p){n[17](p)}let m={$$slots:{default:[Ln]},$$scope:{ctx:n}};return n[2]!==void 0&&(m.checked=n[2]),o=new Kl({props:m}),ge.push(()=>Se(o,"checked",_)),{c(){W(e.$$.fragment),t=L(),W(o.$$.fragment)},m(p,c){I(e,p,c),R(p,t,c),I(o,p,c),s=!0},p(p,c){const h={};!l&&c&16&&(l=!0,h.value=p[4],Ce(()=>l=!1)),e.$set(h);const g={};c&268435456&&(g.$$scope={dirty:c,ctx:p}),!r&&c&4&&(r=!0,g.checked=p[2],Ce(()=>r=!1)),o.$set(g)},i(p){s||(E(e.$$.fragment,p),E(o.$$.fragment,p),s=!0)},o(p){M(e.$$.fragment,p),M(o.$$.fragment,p),s=!1},d(p){H(e,p),p&&y(t),H(o,p)}}}function En(n){let e;return{c(){e=x("Fetch")},m(l,t){R(l,e,t)},d(l){l&&y(e)}}}function Dn(n){let e,l;return e=new Sl({props:{type:"is-primary",$$slots:{default:[En]},$$scope:{ctx:n}}}),e.$on("click",n[9]),e.$on("submit",n[9]),{c(){W(e.$$.fragment)},m(t,o){I(e,t,o),l=!0},p(t,o){const r={};o&268435456&&(r.$$scope={dirty:o,ctx:t}),e.$set(r)},i(t){l||(E(e.$$.fragment,t),l=!0)},o(t){M(e.$$.fragment,t),l=!1},d(t){H(e,t)}}}function Tn(n){let e,l,t,o,r,s;return e=new je({props:{grouped:!0,$$slots:{default:[Nn]},$$scope:{ctx:n}}}),t=new je({props:{grouped:!0,$$slots:{default:[On]},$$scope:{ctx:n}}}),r=new je({props:{grouped:!0,$$slots:{default:[Dn]},$$scope:{ctx:n}}}),{c(){W(e.$$.fragment),l=L(),W(t.$$.fragment),o=L(),W(r.$$.fragment)},m(a,i){I(e,a,i),R(a,l,i),I(t,a,i),R(a,o,i),I(r,a,i),s=!0},p(a,i){const _={};i&268435464&&(_.$$scope={dirty:i,ctx:a}),e.$set(_);const m={};i&268435476&&(m.$$scope={dirty:i,ctx:a}),t.$set(m);const p={};i&268435456&&(p.$$scope={dirty:i,ctx:a}),r.$set(p)},i(a){s||(E(e.$$.fragment,a),E(t.$$.fragment,a),E(r.$$.fragment,a),s=!0)},o(a){M(e.$$.fragment,a),M(t.$$.fragment,a),M(r.$$.fragment,a),s=!1},d(a){H(e,a),a&&y(l),H(t,a),a&&y(o),H(r,a)}}}function Mn(n){let e,l,t,o,r;return o=new Nl({props:{content:n[1],onChange:n[7]}}),{c(){e=d("p"),e.innerHTML=`<i>The best editing experience is to configure Atomic Server, in the
        meantime use editor below. You will need to refresh page via Command R
        or Ctrl-R to see changes</i>`,l=L(),t=d("div"),W(o.$$.fragment),u(t,"class","editor")},m(s,a){R(s,e,a),R(s,l,a),R(s,t,a),I(o,t,null),r=!0},p(s,a){const i={};a&2&&(i.content=s[1]),o.$set(i)},i(s){r||(E(o.$$.fragment,s),r=!0)},o(s){M(o.$$.fragment,s),r=!1},d(s){s&&y(e),s&&y(l),s&&y(t),H(o)}}}function Xt(n){let e,l;return e=new bn({props:{subject:n[25]}}),{c(){W(e.$$.fragment)},m(t,o){I(e,t,o),l=!0},p(t,o){const r={};o&1&&(r.subject=t[25]),e.$set(r)},i(t){l||(E(e.$$.fragment,t),l=!0)},o(t){M(e.$$.fragment,t),l=!1},d(t){H(e,t)}}}function Un(n){let e,l,t=n[0]??[],o=[];for(let s=0;s<t.length;s+=1)o[s]=Xt(Qt(n,t,s));const r=s=>M(o[s],1,1,()=>{o[s]=null});return{c(){for(let s=0;s<o.length;s+=1)o[s].c();e=Xe()},m(s,a){for(let i=0;i<o.length;i+=1)o[i]&&o[i].m(s,a);R(s,e,a),l=!0},p(s,a){if(a&1){t=s[0]??[];let i;for(i=0;i<t.length;i+=1){const _=Qt(s,t,i);o[i]?(o[i].p(_,a),E(o[i],1)):(o[i]=Xt(_),o[i].c(),E(o[i],1),o[i].m(e.parentNode,e))}for(Ee(),i=t.length;i<o.length;i+=1)r(i);De()}},i(s){if(!l){for(let a=0;a<t.length;a+=1)E(o[a]);l=!0}},o(s){o=o.filter(Boolean);for(let a=0;a<o.length;a+=1)M(o[a]);l=!1},d(s){He(o,s),s&&y(e)}}}function An(n){let e,l;return e=new Gl({props:{$$slots:{default:[Un]},$$scope:{ctx:n}}}),{c(){W(e.$$.fragment)},m(t,o){I(e,t,o),l=!0},p(t,o){const r={};o&268435457&&(r.$$scope={dirty:o,ctx:t}),e.$set(r)},i(t){l||(E(e.$$.fragment,t),l=!0)},o(t){M(e.$$.fragment,t),l=!1},d(t){H(e,t)}}}function jn(n){let e,l,t,o,r,s,a,i,_,m,p,c,h;return l=new Oe({props:{path:"/atomic",$$slots:{default:[Rn]},$$scope:{ctx:n}}}),o=new Oe({props:{path:"/json",$$slots:{default:[Tn]},$$scope:{ctx:n}}}),s=new Oe({props:{path:"/editor",$$slots:{default:[Mn]},$$scope:{ctx:n}}}),m=new je({props:{grouped:!0,position:"is-right",$$slots:{default:[An]},$$scope:{ctx:n}}}),{c(){e=d("div"),W(l.$$.fragment),t=L(),W(o.$$.fragment),r=L(),W(s.$$.fragment),a=L(),i=d("hr"),_=L(),W(m.$$.fragment),p=L(),c=d("nav"),c.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
    <a class="navbar-item" href="/fetch/json">Fetch JSON Data</a> 
    <a class="navbar-item" href="/fetch/atomic">Set Atomic Server</a> 
    <a class="navbar-item" href="/fetch/editor">Edit JSON config</a></div>`,u(e,"class","box"),u(c,"class","navbar")},m(g,v){R(g,e,v),I(l,e,null),f(e,t),I(o,e,null),f(e,r),I(s,e,null),R(g,a,v),R(g,i,v),R(g,_,v),I(m,g,v),R(g,p,v),R(g,c,v),h=!0},p(g,[v]){const b={};v&268435552&&(b.$$scope={dirty:v,ctx:g}),l.$set(b);const $={};v&268435484&&($.$$scope={dirty:v,ctx:g}),o.$set($);const k={};v&268435458&&(k.$$scope={dirty:v,ctx:g}),s.$set(k);const T={};v&268435457&&(T.$$scope={dirty:v,ctx:g}),m.$set(T)},i(g){h||(E(l.$$.fragment,g),E(o.$$.fragment,g),E(s.$$.fragment,g),E(m.$$.fragment,g),h=!0)},o(g){M(l.$$.fragment,g),M(o.$$.fragment,g),M(s.$$.fragment,g),M(m.$$.fragment,g),h=!1},d(g){g&&y(e),H(l),H(o),H(s),g&&y(a),g&&y(i),g&&y(_),H(m,g),g&&y(p),g&&y(c)}}}function Pn(n,e,l){let t,o,r,s,a;le(n,tn,O=>l(19,r=O)),le(n,Re,O=>l(20,s=O)),le(n,ye,O=>l(21,a=O));let i={json:a};function _(O){if(console.log("contents changed:",O),console.log("is tauri",s),ye.update(A=>(A=O.json,A)),Re)console.log("Updating config on server"),me("update_config",{configNew:O.json}).then(A=>{console.log(`Message: ${A}`)}).catch(A=>console.error(A));else{let A=`${Ze.ServerURL}/config/`;fetch(A,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(O.json)})}l(1,i=O)}let m=!1,p="https://raw.githubusercontent.com/terraphim/terraphim-cloud-fastapi/main/data/ref_arch.json",c="http://localhost:8000/documents/",h="http://localhost:9883/",g;const v=async()=>{console.log("Updating atomic server configuration");const O=ln.fromSecret(g);r.setServerUrl(h),console.log("Server set.Setting agent"),r.setAgent(O)},b=async()=>{T()},$=({data:{msg:O,data:A}})=>{console.log(O,A)};let k;const T=async()=>{const O=await xl(()=>import("./fetcher.worker-7e58969a.js"),[]);k=new O.default,k.onmessage=$;const A={msg:"fetcher",data:{url:p,postUrl:c,isWiki:m}};k.postMessage(A)},X=Ll("http://localhost:9883/config/y3zx5wtm0bq"),q=wt(X,Ol.properties.name);le(n,q,O=>l(12,o=O));const w=wt(X,"http://localhost:9883/property/role");le(n,w,O=>l(0,t=O));function U(O){h=O,l(5,h)}function z(O){g=O,l(6,g)}function Q(O){p=O,l(3,p)}function J(O){c=O,l(4,c)}function D(O){m=O,l(2,m)}return n.$$.update=()=>{n.$$.dirty&4096&&console.log("Print name",o),n.$$.dirty&1&&console.log("Print roles",t)},[t,i,m,p,c,h,g,_,v,b,q,w,o,U,z,Q,J,D]}class Wn extends be{constructor(e){super(),ke(this,e,Pn,jn,$e,{})}}function In(n){let e,l;return e=new sn({props:{defaultValue:n[0],isEditable:!n[1],disableLocalStorage:!0,onUpdate:n[2],extensions:[en]}}),{c(){W(e.$$.fragment)},m(t,o){I(e,t,o),l=!0},p(t,[o]){const r={};o&1&&(r.defaultValue=t[0]),o&2&&(r.isEditable=!t[1]),e.$set(r)},i(t){l||(E(e.$$.fragment,t),l=!0)},o(t){M(e.$$.fragment,t),l=!1},d(t){H(e,t)}}}function Hn(n,e,l){let{html:t=""}=e,{readOnly:o=!1}=e,{outputFormat:r="html"}=e;const s=a=>{r==="markdown"?l(0,t=a.storage.markdown.getMarkdown()):l(0,t=a.getHTML())};return n.$$set=a=>{"html"in a&&l(0,t=a.html),"readOnly"in a&&l(1,o=a.readOnly),"outputFormat"in a&&l(3,r=a.outputFormat)},[t,o,s,r]}class Fn extends be{constructor(e){super(),ke(this,e,Hn,In,$e,{html:0,readOnly:1,outputFormat:3})}}function zn(n){let e,l,t,o,r,s,a,i;const _=[Jn,Kn],m=[];function p(c,h){return c[3]?0:1}return l=p(n),t=m[l]=_[l](n),{c(){e=d("div"),t.c(),o=L(),r=d("div"),r.innerHTML='<span class="hint-text svelte-1n7y4av">Double-click to edit • Ctrl+E to edit • Ctrl+S to save</span>',u(r,"class","edit-hint svelte-1n7y4av"),u(e,"class","content-viewer svelte-1n7y4av"),u(e,"tabindex","0"),u(e,"role","button"),u(e,"aria-label","Double-click to edit article content")},m(c,h){R(c,e,h),m[l].m(e,null),f(e,o),f(e,r),n[12](e),s=!0,a||(i=[B(e,"dblclick",n[7]),B(e,"keydown",n[8])],a=!0)},p(c,h){let g=l;l=p(c),l===g?m[l].p(c,h):(Ee(),M(m[g],1,1,()=>{m[g]=null}),De(),t=m[l],t?t.p(c,h):(t=m[l]=_[l](c),t.c()),E(t,1),t.m(e,o))},i(c){s||(E(t),s=!0)},o(c){M(t),s=!1},d(c){c&&y(e),m[l].d(),n[12](null),a=!1,Pe(i)}}}function Gn(n){let e,l,t,o,r,s,a,i,_,m;function p(h){n[10](h)}let c={outputFormat:n[5]};return n[1].body!==void 0&&(c.html=n[1].body),e=new Fn({props:c}),ge.push(()=>Se(e,"html",p)),{c(){W(e.$$.fragment),t=L(),o=d("div"),r=d("button"),r.textContent="Save",s=L(),a=d("button"),a.textContent="Cancel",u(r,"class","button is-primary"),u(a,"class","button is-light"),u(o,"class","edit-controls svelte-1n7y4av")},m(h,g){I(e,h,g),R(h,t,g),R(h,o,g),f(o,r),f(o,s),f(o,a),i=!0,_||(m=[B(r,"click",n[6]),B(a,"click",n[11])],_=!0)},p(h,g){const v={};g&32&&(v.outputFormat=h[5]),!l&&g&2&&(l=!0,v.html=h[1].body,Ce(()=>l=!1)),e.$set(v)},i(h){i||(E(e.$$.fragment,h),i=!0)},o(h){M(e.$$.fragment,h),i=!1},d(h){H(e,h),h&&y(t),h&&y(o),_=!1,Pe(m)}}}function Kn(n){let e,l;return e=new Xl({props:{source:n[1].body}}),{c(){W(e.$$.fragment)},m(t,o){I(e,t,o),l=!0},p(t,o){const r={};o&2&&(r.source=t[1].body),e.$set(r)},i(t){l||(E(e.$$.fragment,t),l=!0)},o(t){M(e.$$.fragment,t),l=!1},d(t){H(e,t)}}}function Jn(n){let e,l=n[1].body+"";return{c(){e=d("div"),u(e,"class","prose")},m(t,o){R(t,e,o),e.innerHTML=l},p(t,o){o&2&&l!==(l=t[1].body+"")&&(e.innerHTML=l)},i:oe,o:oe,d(t){t&&y(e)}}}function Bn(n){let e,l,t=n[1].title+"",o,r,s,a,i;const _=[Gn,zn],m=[];function p(c,h){return c[2]?0:1}return s=p(n),a=m[s]=_[s](n),{c(){e=d("div"),l=d("h2"),o=x(t),r=L(),a.c(),u(l,"class","svelte-1n7y4av"),u(e,"class","box wrapper svelte-1n7y4av")},m(c,h){R(c,e,h),f(e,l),f(l,o),f(e,r),m[s].m(e,null),i=!0},p(c,h){(!i||h&2)&&t!==(t=c[1].title+"")&&pe(o,t);let g=s;s=p(c),s===g?m[s].p(c,h):(Ee(),M(m[g],1,1,()=>{m[g]=null}),De(),a=m[s],a?a.p(c,h):(a=m[s]=_[s](c),a.c()),E(a,1),a.m(e,null))},i(c){i||(E(a),i=!0)},o(c){M(a),i=!1},d(c){c&&y(e),m[s].d()}}}function Vn(n){let e,l,t;function o(s){n[13](s)}let r={$$slots:{default:[Bn]},$$scope:{ctx:n}};return n[0]!==void 0&&(r.active=n[0]),e=new Jl({props:r}),ge.push(()=>Se(e,"active",o)),{c(){W(e.$$.fragment)},m(s,a){I(e,s,a),t=!0},p(s,[a]){const i={};a&65598&&(i.$$scope={dirty:a,ctx:s}),!l&&a&1&&(l=!0,i.active=s[0],Ce(()=>l=!1)),e.$set(i)},i(s){t||(E(e.$$.fragment,s),t=!0)},o(s){M(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function qn(n,e,l){let t,o,r;le(n,Re,T=>l(14,r=T));let{active:s=!1}=e,{item:a}=e,{initialEdit:i=!1}=e,_=!1,m;async function p(){if(r)try{const T=await me("get_document",{document_id:a.id});T!=null&&T.document&&l(1,a=T.document)}catch(T){console.error("Failed to load document",T)}}async function c(){if(!r){l(2,_=!1);return}try{await me("create_document",{document:a}),l(2,_=!1)}catch(T){console.error("Failed to save document",T)}}function h(){l(2,_=!0)}function g(T){T.type!=="dblclick"&&((T.ctrlKey||T.metaKey)&&T.key==="e"&&(T.preventDefault(),l(2,_=!0)),_&&(T.ctrlKey||T.metaKey)&&T.key==="s"&&(T.preventDefault(),c()),_&&T.key==="Escape"&&(T.preventDefault(),l(2,_=!1)))}function v(T){n.$$.not_equal(a.body,T)&&(a.body=T,l(1,a))}const b=()=>l(2,_=!1);function $(T){ge[T?"unshift":"push"](()=>{m=T,l(4,m)})}function k(T){s=T,l(0,s)}return n.$$set=T=>{"active"in T&&l(0,s=T.active),"item"in T&&l(1,a=T.item),"initialEdit"in T&&l(9,i=T.initialEdit)},n.$$.update=()=>{n.$$.dirty&513&&s&&i&&l(2,_=!0),n.$$.dirty&7&&s&&a&&!_&&p(),n.$$.dirty&2&&l(3,t=/<\w+/.test((a==null?void 0:a.body)??"")),n.$$.dirty&8&&l(5,o=t?"html":"markdown")},[s,a,_,t,m,o,c,h,g,i,v,b,$,k]}class El extends be{constructor(e){super(),ke(this,e,qn,Vn,$e,{active:0,item:1,initialEdit:9})}}async function Dl(n){return me("tauri",n)}async function Yn(n,e){return Dl({__tauriModule:"Event",message:{cmd:"unlisten",event:n,eventId:e}})}async function Zn(n,e,l){return Dl({__tauriModule:"Event",message:{cmd:"listen",event:n,windowLabel:e,handler:Lt(l)}}).then(t=>async()=>Yn(n,t))}var xt;(function(n){n.WINDOW_RESIZED="tauri://resize",n.WINDOW_MOVED="tauri://move",n.WINDOW_CLOSE_REQUESTED="tauri://close-requested",n.WINDOW_CREATED="tauri://window-created",n.WINDOW_DESTROYED="tauri://destroyed",n.WINDOW_FOCUS="tauri://focus",n.WINDOW_BLUR="tauri://blur",n.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",n.WINDOW_THEME_CHANGED="tauri://theme-changed",n.WINDOW_FILE_DROP="tauri://file-drop",n.WINDOW_FILE_DROP_HOVER="tauri://file-drop-hover",n.WINDOW_FILE_DROP_CANCELLED="tauri://file-drop-cancelled",n.MENU="tauri://menu",n.CHECK_UPDATE="tauri://update",n.UPDATE_AVAILABLE="tauri://update-available",n.INSTALL_UPDATE="tauri://update-install",n.STATUS_UPDATE="tauri://update-status",n.DOWNLOAD_PROGRESS="tauri://update-download-progress"})(xt||(xt={}));async function Qn(n,e){return Zn(n,null,e)}function el(n,e,l){const t=n.slice();return t[9]=e[l],t}function tl(n){let e,l=n[9].name+"",t,o;return{c(){e=d("option"),t=x(l),e.__value=o=n[9].name,e.value=e.__value},m(r,s){R(r,e,s),f(e,t)},p(r,s){s&1&&l!==(l=r[9].name+"")&&pe(t,l),s&1&&o!==(o=r[9].name)&&(e.__value=o,e.value=e.__value)},d(r){r&&y(e)}}}function Xn(n){let e,l,t,o,r,s,a=n[0],i=[];for(let _=0;_<a.length;_+=1)i[_]=tl(el(n,a,_));return{c(){e=d("div"),l=d("div"),t=d("div"),o=d("select");for(let _=0;_<i.length;_+=1)i[_].c();u(t,"class","select"),u(l,"class","control"),u(e,"class","field is-grouped is-grouped-right")},m(_,m){R(_,e,m),f(e,l),f(l,t),f(t,o);for(let p=0;p<i.length;p+=1)i[p]&&i[p].m(o,null);Ue(o,n[1]),r||(s=B(o,"change",n[2]),r=!0)},p(_,[m]){if(m&1){a=_[0];let p;for(p=0;p<a.length;p+=1){const c=el(_,a,p);i[p]?i[p].p(c,m):(i[p]=tl(c),i[p].c(),i[p].m(o,null))}for(;p<i.length;p+=1)i[p].d(1);i.length=a.length}m&3&&Ue(o,_[1])},i:oe,o:oe,d(_){_&&y(e),He(i,_),r=!1,s()}}}function xn(n,e,l){let t,o,r,s;le(n,ye,c=>l(5,t=c)),le(n,Re,c=>l(6,o=c)),le(n,Zt,c=>l(0,r=c)),le(n,lt,c=>l(1,s=c));let a="";async function i(){try{Re.set(window.__TAURI__!==void 0),o?(console.log("Loading config from Tauri"),me("get_config").then(c=>{console.log("get_config response",c),c&&c.status==="success"&&_(c.config)}).catch(c=>console.error("Error fetching config in Tauri:",c))):(console.log("Loading config from server"),a=`${Ze.ServerURL}/config/`,fetch(a).then(c=>c.json()).then(c=>{console.log("Config received",c),c&&c.status==="success"&&_(c.config)}).catch(c=>console.error("Error fetching config:",c)))}catch(c){console.error("Unhandled error in loadConfig:",c)}}function _(c){var b;console.log("Updating stores from config:",c);const h={default_role:c.selected_role,...c};ye.set(h);const g=Object.entries(c.roles).map(([$,k])=>({name:$,...k}));Zt.set(g),lt.set(c.selected_role);const v=c.roles[c.selected_role];if(console.log("Selected role settings:",v),v){const $=v.theme||"spacelab";console.log("Setting theme to:",$),tt.set($),(b=v.kg)!=null&&b.publish?o&&me("publish_thesaurus",{roleName:c.selected_role}).then(k=>{console.log("publish_thesaurus response",k),Nt.set(k),et.set(!0)}):et.set(!1)}else console.warn("No role settings found for:",c.selected_role),tt.set("spacelab")}typeof window<"u"&&window.__TAURI__&&Qn("role_changed",c=>{console.log("Role changed event received from backend:",c.payload),_(c.payload)});async function m(){await i()}m(),console.log("Using Terraphim Server URL:",Ze.ServerURL);function p(c){var $;const g=c.target.value;console.log("Role change requested:",g),lt.set(g);const v=r.find(k=>k.name===g);if(!v){console.error(`No role settings found for role: ${g}.`);return}const b=v.theme||"spacelab";tt.set(b),console.log(`Theme changed to ${b}`),ye.update(k=>(k.selected_role=g,k)),o?(me("select_role",{roleName:g}).catch(k=>console.error("Error selecting role:",k)),($=v.kg)!=null&&$.publish?(console.log("Publishing thesaurus for role",g),me("publish_thesaurus",{roleName:g}).then(k=>{Nt.set(k),et.set(!0)})):et.set(!1)):fetch(`${Ze.ServerURL}/config/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).catch(k=>console.error("Error updating config on server:",k))}return[r,s,p,i]}class bt extends be{constructor(e){super(),ke(this,e,xn,Xn,$e,{loadConfig:3})}get loadConfig(){return this.$$.ctx[3]}}function ll(n,e,l){const t=n.slice();return t[5]=e[l],t}function nl(n){let e,l;return e=new Cl({props:{$$slots:{default:[to]},$$scope:{ctx:n}}}),{c(){W(e.$$.fragment)},m(t,o){I(e,t,o),l=!0},p(t,o){const r={};o&257&&(r.$$scope={dirty:o,ctx:t}),e.$set(r)},i(t){l||(E(e.$$.fragment,t),l=!0)},o(t){M(e.$$.fragment,t),l=!1},d(t){H(e,t)}}}function eo(n){let e=n[5]+"",l;return{c(){l=x(e)},m(t,o){R(t,l,o)},p(t,o){o&1&&e!==(e=t[5]+"")&&pe(l,e)},d(t){t&&y(l)}}}function ol(n){let e,l,t,o;return l=new Rl({props:{rounded:!0,$$slots:{default:[eo]},$$scope:{ctx:n}}}),{c(){e=d("a"),W(l.$$.fragment),u(e,"href",t="https://terraphim.github.io/terraphim-project/#/page/"+n[5]),u(e,"target","_blank")},m(r,s){R(r,e,s),I(l,e,null),o=!0},p(r,s){const a={};s&257&&(a.$$scope={dirty:s,ctx:r}),l.$set(a),(!o||s&1&&t!==(t="https://terraphim.github.io/terraphim-project/#/page/"+r[5]))&&u(e,"href",t)},i(r){o||(E(l.$$.fragment,r),o=!0)},o(r){M(l.$$.fragment,r),o=!1},d(r){r&&y(e),H(l)}}}function to(n){let e,l,t=n[0].tags,o=[];for(let s=0;s<t.length;s+=1)o[s]=ol(ll(n,t,s));const r=s=>M(o[s],1,1,()=>{o[s]=null});return{c(){for(let s=0;s<o.length;s+=1)o[s].c();e=Xe()},m(s,a){for(let i=0;i<o.length;i+=1)o[i]&&o[i].m(s,a);R(s,e,a),l=!0},p(s,a){if(a&1){t=s[0].tags;let i;for(i=0;i<t.length;i+=1){const _=ll(s,t,i);o[i]?(o[i].p(_,a),E(o[i],1)):(o[i]=ol(_),o[i].c(),E(o[i],1),o[i].m(e.parentNode,e))}for(Ee(),i=t.length;i<o.length;i+=1)r(i);De()}},i(s){if(!l){for(let a=0;a<t.length;a+=1)E(o[a]);l=!0}},o(s){o=o.filter(Boolean);for(let a=0;a<o.length;a+=1)M(o[a]);l=!1},d(s){He(o,s),s&&y(e)}}}function lo(n){let e,l=n[0].rank+"",t;return{c(){e=x("Rank "),t=x(l)},m(o,r){R(o,e,r),R(o,t,r)},p(o,r){r&1&&l!==(l=o[0].rank+"")&&pe(t,l)},d(o){o&&y(e),o&&y(t)}}}function no(n){let e,l;return e=new Rl({props:{rounded:!0,$$slots:{default:[lo]},$$scope:{ctx:n}}}),{c(){W(e.$$.fragment)},m(t,o){I(e,t,o),l=!0},p(t,o){const r={};o&257&&(r.$$scope={dirty:o,ctx:t}),e.$set(r)},i(t){l||(E(e.$$.fragment,t),l=!0)},o(t){M(e.$$.fragment,t),l=!1},d(t){H(e,t)}}}function sl(n){let e,l,t;return{c(){e=d("a"),l=d("span"),l.innerHTML='<i class="fas fa-link"></i>',u(l,"class","icon is-medium"),u(e,"href",t=n[0].url),u(e,"target","_blank"),u(e,"class","level-item"),u(e,"aria-label","URL")},m(o,r){R(o,e,r),f(e,l)},p(o,r){r&1&&t!==(t=o[0].url)&&u(e,"href",t)},d(o){o&&y(e)}}}function oo(n){let e,l,t,o,r,s,a,i,_,m,p,c,h=n[0].title+"",g,v,b,$,k=(n[0].description||"No description available")+"",T,X,q,w,U,z,Q,J,D,O,A,F,ee,S,N,j,P,G,C,V,re,Y=n[0].tags&&nl(n);i=new Cl({props:{$$slots:{default:[no]},$$scope:{ctx:n}}});let te="url"in n[0]&&sl(n);function ce(K){n[3](K)}let Te={item:n[0]};return n[1]!==void 0&&(Te.active=n[1]),P=new El({props:Te}),ge.push(()=>Se(P,"active",ce)),{c(){e=d("div"),l=d("article"),t=d("div"),o=d("div"),r=d("div"),Y&&Y.c(),s=L(),a=d("div"),W(i.$$.fragment),_=L(),m=d("div"),p=d("button"),c=d("h2"),g=x(h),v=L(),b=d("small"),$=x("Description: "),T=x(k),X=L(),q=d("br"),U=L(),z=d("div"),Q=d("nav"),J=d("div"),te&&te.c(),D=L(),O=d("button"),O.innerHTML='<span class="icon is-medium"><i class="fas fa-plus" aria-hidden="true"></i></span>',A=L(),F=d("a"),ee=d("span"),ee.innerHTML='<i class="fas fa-code" aria-hidden="true"></i>',j=L(),W(P.$$.fragment),u(r,"class","level-right"),u(a,"class","level-right"),u(c,"class","title svelte-1sikyk6"),u(p,"class","svelte-1sikyk6"),u(o,"class","content"),u(O,"type","button"),u(O,"class","level-item button is-ghost svelte-1sikyk6"),u(O,"aria-label","Add to favorites"),u(ee,"class","icon is-medium"),u(F,"href",S=`vscode://${encodeURIComponent(n[0].title)}.md?${encodeURIComponent(n[0].body)}`),u(F,"class","level-item"),u(F,"aria-label","Open in VSCode"),u(J,"class","level-right"),u(Q,"class","level is-mobile"),u(z,"class","level-right"),u(t,"class","media-content"),u(l,"class","media"),u(e,"class","box")},m(K,ne){R(K,e,ne),f(e,l),f(l,t),f(t,o),f(o,r),Y&&Y.m(r,null),f(o,s),f(o,a),I(i,a,null),f(o,_),f(o,m),f(m,p),f(p,c),f(c,g),f(m,v),f(m,b),f(b,$),f(b,T),f(m,X),f(m,q),f(t,U),f(t,z),f(z,Q),f(Q,J),te&&te.m(J,null),f(J,D),f(J,O),f(J,A),f(J,F),f(F,ee),R(K,j,ne),I(P,K,ne),C=!0,V||(re=[B(p,"click",n[2]),B(O,"click",so)],V=!0)},p(K,[ne]){K[0].tags?Y?(Y.p(K,ne),ne&1&&E(Y,1)):(Y=nl(K),Y.c(),E(Y,1),Y.m(r,null)):Y&&(Ee(),M(Y,1,1,()=>{Y=null}),De());const de={};ne&257&&(de.$$scope={dirty:ne,ctx:K}),i.$set(de),(!C||ne&1)&&h!==(h=K[0].title+"")&&pe(g,h),(!C||ne&1)&&k!==(k=(K[0].description||"No description available")+"")&&pe(T,k),"url"in K[0]?te?te.p(K,ne):(te=sl(K),te.c(),te.m(J,D)):te&&(te.d(1),te=null),(!C||ne&1&&S!==(S=`vscode://${encodeURIComponent(K[0].title)}.md?${encodeURIComponent(K[0].body)}`))&&u(F,"href",S);const fe={};ne&1&&(fe.item=K[0]),!G&&ne&2&&(G=!0,fe.active=K[1],Ce(()=>G=!1)),P.$set(fe)},i(K){C||(E(Y),E(i.$$.fragment,K),Qe(()=>{C&&(w||(w=$t(m,vt,{},!0)),w.run(1))}),Qe(()=>{C&&(N||(N=$t(Q,vt,{},!0)),N.run(1))}),E(P.$$.fragment,K),C=!0)},o(K){M(Y),M(i.$$.fragment,K),w||(w=$t(m,vt,{},!1)),w.run(0),N||(N=$t(Q,vt,{},!1)),N.run(0),M(P.$$.fragment,K),C=!1},d(K){K&&y(e),Y&&Y.d(),H(i),K&&w&&w.end(),te&&te.d(),K&&N&&N.end(),K&&y(j),H(P,K),V=!1,Pe(re)}}}const so=()=>{};function ro(n,e,l){let t;le(n,lt,i=>l(4,t=i));let{document:o}=e,r=!1;const s=()=>{l(1,r=!0)};bt[t]!==void 0&&(console.log("Have attribute",bt[t]),bt[t].hasOwnProperty("enableLogseq")?console.log("enable logseq True"):console.log("Didn't make it"));function a(i){r=i,l(1,r)}return n.$$set=i=>{"document"in i&&l(0,o=i.document)},[o,r,s,a]}class ao extends be{constructor(e){super(),ke(this,e,ro,oo,$e,{document:0})}}const io="/assets/terraphim_gray.png";function rl(n,e,l){const t=n.slice();return t[19]=e[l],t}function al(n,e,l){const t=n.slice();return t[22]=e[l],t[24]=l,t}function il(n){let e,l=n[2],t=[];for(let o=0;o<l.length;o+=1)t[o]=ul(al(n,l,o));return{c(){e=d("ul");for(let o=0;o<t.length;o+=1)t[o].c();u(e,"class","suggestions svelte-13t09eu")},m(o,r){R(o,e,r);for(let s=0;s<t.length;s+=1)t[s]&&t[s].m(e,null)},p(o,r){if(r&524){l=o[2];let s;for(s=0;s<l.length;s+=1){const a=al(o,l,s);t[s]?t[s].p(a,r):(t[s]=ul(a),t[s].c(),t[s].m(e,null))}for(;s<t.length;s+=1)t[s].d(1);t.length=l.length}},d(o){o&&y(e),He(t,o)}}}function ul(n){let e,l=n[22]+"",t,o,r,s,a,i;function _(){return n[13](n[22])}function m(...p){return n[14](n[22],...p)}return{c(){e=d("li"),t=x(l),o=L(),u(e,"tabindex","0"),u(e,"role","option"),u(e,"aria-selected",r=n[24]===n[3]),u(e,"aria-label",s=`Apply suggestion: ${n[22]}`),u(e,"class","svelte-13t09eu"),kt(e,"active",n[24]===n[3])},m(p,c){R(p,e,c),f(e,t),f(e,o),a||(i=[B(e,"click",_),B(e,"keydown",m)],a=!0)},p(p,c){n=p,c&4&&l!==(l=n[22]+"")&&pe(t,l),c&8&&r!==(r=n[24]===n[3])&&u(e,"aria-selected",r),c&4&&s!==(s=`Apply suggestion: ${n[22]}`)&&u(e,"aria-label",s),c&8&&kt(e,"active",n[24]===n[3])},d(p){p&&y(e),a=!1,Pe(i)}}}function uo(n){let e,l,t,o,r;function s(_){n[12](_)}let a={type:"search",placeholder:n[6]?`Search over Knowledge graph for ${n[4]}`:"Search",icon:"search",expanded:!0,autofocus:!0};n[5]!==void 0&&(a.value=n[5]),l=new nt({props:a}),ge.push(()=>Se(l,"value",s)),l.$on("click",n[10]),l.$on("submit",n[10]),l.$on("keydown",n[8]),l.$on("input",n[7]);let i=n[2].length>0&&il(n);return{c(){e=d("div"),W(l.$$.fragment),o=L(),i&&i.c(),u(e,"class","input-wrapper svelte-13t09eu")},m(_,m){R(_,e,m),I(l,e,null),f(e,o),i&&i.m(e,null),r=!0},p(_,m){const p={};m&80&&(p.placeholder=_[6]?`Search over Knowledge graph for ${_[4]}`:"Search"),!t&&m&32&&(t=!0,p.value=_[5],Ce(()=>t=!1)),l.$set(p),_[2].length>0?i?i.p(_,m):(i=il(_),i.c(),i.m(e,null)):i&&(i.d(1),i=null)},i(_){r||(E(l.$$.fragment,_),r=!0)},o(_){M(l.$$.fragment,_),r=!1},d(_){_&&y(e),H(l),i&&i.d()}}}function co(n){let e,l,t,o,r,s;return{c(){e=d("section"),l=d("div"),t=d("img"),r=L(),s=d("p"),s.textContent="I am Terraphim, your personal assistant.",ql(t.src,o=io)||u(t,"src",o),u(t,"alt","Terraphim Logo"),u(t,"class","svelte-13t09eu"),u(l,"class","content has-text-grey has-text-centered svelte-13t09eu"),u(e,"class","section")},m(a,i){R(a,e,i),f(e,l),f(l,t),f(l,r),f(l,s)},p:oe,i:oe,o:oe,d(a){a&&y(e)}}}function fo(n){let e,l,t=n[0],o=[];for(let s=0;s<t.length;s+=1)o[s]=cl(rl(n,t,s));const r=s=>M(o[s],1,1,()=>{o[s]=null});return{c(){for(let s=0;s<o.length;s+=1)o[s].c();e=Xe()},m(s,a){for(let i=0;i<o.length;i+=1)o[i]&&o[i].m(s,a);R(s,e,a),l=!0},p(s,a){if(a&1){t=s[0];let i;for(i=0;i<t.length;i+=1){const _=rl(s,t,i);o[i]?(o[i].p(_,a),E(o[i],1)):(o[i]=cl(_),o[i].c(),E(o[i],1),o[i].m(e.parentNode,e))}for(Ee(),i=t.length;i<o.length;i+=1)r(i);De()}},i(s){if(!l){for(let a=0;a<t.length;a+=1)E(o[a]);l=!0}},o(s){o=o.filter(Boolean);for(let a=0;a<o.length;a+=1)M(o[a]);l=!1},d(s){He(o,s),s&&y(e)}}}function po(n){let e,l;return{c(){e=d("p"),l=x(n[1]),u(e,"class","error svelte-13t09eu")},m(t,o){R(t,e,o),f(e,l)},p(t,o){o&2&&pe(l,t[1])},i:oe,o:oe,d(t){t&&y(e)}}}function cl(n){let e,l;return e=new ao({props:{document:n[19]}}),{c(){W(e.$$.fragment)},m(t,o){I(e,t,o),l=!0},p(t,o){const r={};o&1&&(r.document=t[19]),e.$set(r)},i(t){l||(E(e.$$.fragment,t),l=!0)},o(t){M(e.$$.fragment,t),l=!1},d(t){H(e,t)}}}function _o(n){let e,l,t,o,r,s,a,i,_;l=new je({props:{$$slots:{default:[uo]},$$scope:{ctx:n}}});const m=[po,fo,co],p=[];function c(h,g){return h[1]?0:h[0].length?1:2}return o=c(n),r=p[o]=m[o](n),{c(){e=d("form"),W(l.$$.fragment),t=L(),r.c(),s=Xe()},m(h,g){R(h,e,g),I(l,e,null),R(h,t,g),p[o].m(h,g),R(h,s,g),a=!0,i||(_=B(e,"submit",Bl(n[10])),i=!0)},p(h,[g]){const v={};g&33554556&&(v.$$scope={dirty:g,ctx:h}),l.$set(v);let b=o;o=c(h),o===b?p[o].p(h,g):(Ee(),M(p[b],1,1,()=>{p[b]=null}),De(),r=p[o],r?r.p(h,g):(r=p[o]=m[o](h),r.c()),E(r,1),r.m(s.parentNode,s))},i(h){a||(E(l.$$.fragment,h),E(r),a=!0)},o(h){M(l.$$.fragment,h),M(r),a=!1},d(h){h&&y(e),H(l),h&&y(t),p[o].d(h),h&&y(s),i=!1,_()}}}function ho(n,e,l){let t,o,r,s,a,i,_;le(n,mn,w=>l(16,o=w)),le(n,lt,w=>l(4,r=w)),le(n,Rt,w=>l(5,s=w)),le(n,Re,w=>l(17,a=w)),le(n,Nt,w=>l(11,i=w)),le(n,et,w=>l(6,_=w));let m=[],p=null,c=[],h=-1;function g(w){const U=w.trim().toLowerCase();return U.length===0?[]:t.filter(([Q])=>Q.toLowerCase().includes(U)).map(([Q])=>Q).slice(0,5)}function v(w){const U=w.target;if(!U||U.selectionStart==null)return;const z=U.selectionStart,J=s.slice(0,z).split(/\s+/),D=J[J.length-1];l(2,c=g(D)),l(3,h=-1)}function b(w){c.length!==0&&(w.key==="ArrowDown"?(w.preventDefault(),l(3,h=(h+1)%c.length)):w.key==="ArrowUp"?(w.preventDefault(),l(3,h=(h-1+c.length)%c.length)):(w.key==="Enter"||w.key==="Tab")&&h!==-1&&(w.preventDefault(),$(c[h])))}function $(w){var O;const U=document.querySelector('input[type="search"]'),z=(U==null?void 0:U.selectionStart)??0,Q=s.slice(0,z),J=s.slice(z),D=Q.split(/\s+/);D[D.length-1]=w,Vl(Rt,s=[...D,J].join(" "),s),(O=U==null?void 0:U.setSelectionRange)==null||O.call(U,z+w.length,z+w.length),l(2,c=[]),l(3,h=-1)}async function k(){if(l(1,p=null),a)try{const w=await me("search",{searchQuery:{search_term:s,skip:0,limit:10,role:r}});w.status==="success"?(l(0,m=w.results),console.log("Response results"),console.log(m)):(l(1,p=`Search failed: ${w.status}`),console.error("Search failed:",w))}catch(w){l(1,p=`Error in Tauri search: ${w}`),console.error("Error in Tauri search:",w)}else{if(!s.trim())return;const w=JSON.stringify({search_term:s,skip:0,limit:10,role:r});try{const U=await fetch(o,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:w}),z=await U.json();if(!U.ok)throw new Error(`HTTP error! Status: ${U.status}`);l(0,m=z.results)}catch(U){console.error("Error fetching data:",U),l(1,p=`Error fetching data: ${U}`)}}}function T(w){s=w,Rt.set(s)}const X=w=>$(w),q=(w,U)=>{(U.key==="Enter"||U.key===" ")&&(U.preventDefault(),$(w))};return n.$$.update=()=>{n.$$.dirty&2048&&(t=Object.entries(i))},[m,p,c,h,r,s,_,v,b,$,k,i,T,X,q]}class mo extends be{constructor(e){super(),ke(this,e,ho,_o,$e,{})}}function fl(n,e,l){const t=n.slice();return t[32]=e[l],t[33]=e,t[34]=l,t}function pl(n,e,l){const t=n.slice();return t[35]=e[l],t[36]=e,t[37]=l,t}function dl(n,e,l){const t=n.slice();return t[29]=e[l],t}function go(n){let e,l,t,o=JSON.stringify(n[1],null,2)+"",r;return{c(){e=d("h4"),e.textContent="Review",l=L(),t=d("pre"),r=x(o),u(e,"class","title is-5"),Ae(t,"max-height","300px"),Ae(t,"overflow","auto")},m(s,a){R(s,e,a),R(s,l,a),R(s,t,a),f(t,r)},p(s,a){a[0]&2&&o!==(o=JSON.stringify(s[1],null,2)+"")&&pe(r,o)},d(s){s&&y(e),s&&y(l),s&&y(t)}}}function $o(n){let e,l,t=[],o=new Map,r,s,a,i,_=n[1].roles;const m=p=>p[32].name;for(let p=0;p<_.length;p+=1){let c=fl(n,_,p),h=m(c);o.set(h,t[p]=hl(h,c))}return{c(){e=d("h4"),e.textContent="Roles",l=L();for(let p=0;p<t.length;p+=1)t[p].c();r=L(),s=d("button"),s.textContent="Add Role",u(e,"class","title is-5"),u(s,"class","button is-link is-light")},m(p,c){R(p,e,c),R(p,l,c);for(let h=0;h<t.length;h+=1)t[h]&&t[h].m(p,c);R(p,r,c),R(p,s,c),a||(i=B(s,"click",n[5]),a=!0)},p(p,c){c[0]&450&&(_=p[1].roles,t=Yl(t,c,m,1,p,_,o,r.parentNode,Zl,hl,r,fl))},d(p){p&&y(e),p&&y(l);for(let c=0;c<t.length;c+=1)t[c].d(p);p&&y(r),p&&y(s),a=!1,i()}}}function vo(n){let e,l,t,o,r,s,a,i,_,m,p,c,h,g,v,b,$,k,T,X,q,w,U,z,Q,J,D,O,A,F,ee=n[1].roles,S=[];for(let N=0;N<ee.length;N+=1)S[N]=ml(dl(n,ee,N));return{c(){e=d("div"),l=d("label"),l.textContent="Configuration ID",t=L(),o=d("div"),r=d("div"),s=d("select"),a=d("option"),a.textContent="Desktop",i=d("option"),i.textContent="Server",_=d("option"),_.textContent="Embedded",m=L(),p=d("div"),c=d("label"),c.textContent="Global shortcut",h=L(),g=d("div"),v=d("input"),b=L(),$=d("div"),k=d("label"),k.textContent="Default theme",T=L(),X=d("div"),q=d("input"),w=L(),U=d("div"),z=d("label"),z.textContent="Default Role",Q=L(),J=d("div"),D=d("div"),O=d("select");for(let N=0;N<S.length;N+=1)S[N].c();u(l,"class","label"),u(l,"for","config-id"),a.__value="Desktop",a.value=a.__value,i.__value="Server",i.value=i.__value,_.__value="Embedded",_.value=_.__value,u(s,"id","config-id"),n[1].id===void 0&&Qe(()=>n[10].call(s)),u(r,"class","select"),u(o,"class","control"),u(e,"class","field"),u(c,"class","label"),u(c,"for","global-shortcut"),u(v,"class","input"),u(v,"id","global-shortcut"),u(v,"type","text"),u(g,"class","control"),u(p,"class","field"),u(k,"class","label"),u(k,"for","default-theme"),u(q,"class","input"),u(q,"id","default-theme"),u(q,"type","text"),u(X,"class","control"),u($,"class","field"),u(z,"class","label"),u(z,"for","default-role"),u(O,"id","default-role"),n[1].default_role===void 0&&Qe(()=>n[13].call(O)),u(D,"class","select"),u(J,"class","control"),u(U,"class","field")},m(N,j){R(N,e,j),f(e,l),f(e,t),f(e,o),f(o,r),f(r,s),f(s,a),f(s,i),f(s,_),Ue(s,n[1].id,!0),R(N,m,j),R(N,p,j),f(p,c),f(p,h),f(p,g),f(g,v),se(v,n[1].global_shortcut),R(N,b,j),R(N,$,j),f($,k),f($,T),f($,X),f(X,q),se(q,n[1].default_theme),R(N,w,j),R(N,U,j),f(U,z),f(U,Q),f(U,J),f(J,D),f(D,O);for(let P=0;P<S.length;P+=1)S[P]&&S[P].m(O,null);Ue(O,n[1].default_role,!0),A||(F=[B(s,"change",n[10]),B(v,"input",n[11]),B(q,"input",n[12]),B(O,"change",n[13])],A=!0)},p(N,j){if(j[0]&2&&Ue(s,N[1].id),j[0]&2&&v.value!==N[1].global_shortcut&&se(v,N[1].global_shortcut),j[0]&2&&q.value!==N[1].default_theme&&se(q,N[1].default_theme),j[0]&2){ee=N[1].roles;let P;for(P=0;P<ee.length;P+=1){const G=dl(N,ee,P);S[P]?S[P].p(G,j):(S[P]=ml(G),S[P].c(),S[P].m(O,null))}for(;P<S.length;P+=1)S[P].d(1);S.length=ee.length}j[0]&2&&Ue(O,N[1].default_role)},d(N){N&&y(e),N&&y(m),N&&y(p),N&&y(b),N&&y($),N&&y(w),N&&y(U),He(S,N),A=!1,Pe(F)}}}function _l(n){let e,l,t,o,r,s,a,i,_,m,p,c,h,g,v,b,$,k;function T(){n[18].call(a,n[34],n[37])}function X(){n[19].call(p,n[34],n[37])}function q(){return n[20](n[34],n[37])}return{c(){e=d("div"),l=d("div"),t=d("label"),o=x("Path"),s=L(),a=d("input"),_=L(),m=d("label"),p=d("input"),h=x(`
               Read-only`),v=L(),b=d("button"),b.textContent="-",u(t,"class","label"),u(t,"for",r=`haystack-path-${n[34]}-${n[37]}`),u(a,"class","input"),u(a,"id",i=`haystack-path-${n[34]}-${n[37]}`),u(a,"type","text"),u(a,"placeholder","/path/to/haystack"),u(l,"class","control is-expanded"),u(p,"id",c=`haystack-readonly-${n[34]}-${n[37]}`),u(p,"type","checkbox"),u(m,"class","checkbox"),u(m,"for",g=`haystack-readonly-${n[34]}-${n[37]}`),Ae(m,"margin-right","0.5rem"),u(b,"class","button is-small is-danger"),u(e,"class","field is-grouped")},m(w,U){R(w,e,U),f(e,l),f(l,t),f(t,o),f(l,s),f(l,a),se(a,n[1].roles[n[34]].haystacks[n[37]].path),f(e,_),f(e,m),f(m,p),p.checked=n[1].roles[n[34]].haystacks[n[37]].read_only,f(m,h),f(e,v),f(e,b),$||(k=[B(a,"input",T),B(p,"change",X),B(b,"click",q)],$=!0)},p(w,U){n=w,U[0]&2&&r!==(r=`haystack-path-${n[34]}-${n[37]}`)&&u(t,"for",r),U[0]&2&&i!==(i=`haystack-path-${n[34]}-${n[37]}`)&&u(a,"id",i),U[0]&2&&a.value!==n[1].roles[n[34]].haystacks[n[37]].path&&se(a,n[1].roles[n[34]].haystacks[n[37]].path),U[0]&2&&c!==(c=`haystack-readonly-${n[34]}-${n[37]}`)&&u(p,"id",c),U[0]&2&&(p.checked=n[1].roles[n[34]].haystacks[n[37]].read_only),U[0]&2&&g!==(g=`haystack-readonly-${n[34]}-${n[37]}`)&&u(m,"for",g)},d(w){w&&y(e),$=!1,Pe(k)}}}function hl(n,e){let l,t,o,r,s,a,i,_,m,p,c,h,g,v,b,$,k,T,X,q,w,U,z,Q,J,D,O,A,F,ee,S,N,j,P,G,C,V,re,Y,te,ce,Te,K,ne,de,fe,Dt,ot,Tt,st,_e,rt,Mt,Fe,ze,Ut,at,At,it,he,ut,jt,ct,Ge,Ke,Pt,ft,Wt,pt,we,Je,Be,dt,It,Ve,Me,Ne,_t,Ht,ht,Ft,We,Le,mt,zt,gt,Gt,Kt,Jt,xe,yt,Bt;function Ml(){e[14].call(_,e[34])}function Ul(){e[15].call(k,e[34])}function Al(){e[16].call(D,e[34])}function jl(){e[17].call(G,e[34])}let qe=e[32].haystacks,ie=[];for(let ue=0;ue<qe.length;ue+=1)ie[ue]=_l(pl(e,qe,ue));function Pl(){return e[21](e[34])}function Wl(){e[22].call(_e,e[34])}function Il(){e[23].call(he,e[34])}function Vt(){e[24].call(we,e[34])}function Hl(){e[25].call(Ne,e[34])}function Fl(){e[26].call(Le,e[34])}function zl(){return e[27](e[34])}return{key:n,first:null,c(){l=d("div"),t=d("div"),o=d("label"),r=x("Role name"),a=L(),i=d("div"),_=d("input"),p=L(),c=d("div"),h=d("label"),g=x("Short name"),b=L(),$=d("div"),k=d("input"),X=L(),q=d("div"),w=d("label"),U=x("Theme"),Q=L(),J=d("div"),D=d("input"),A=L(),F=d("div"),ee=d("label"),S=x("Relevance function"),j=L(),P=d("div"),G=d("input"),V=L(),re=d("h5"),re.textContent="Haystacks",Y=L();for(let ue=0;ue<ie.length;ue+=1)ie[ue].c();te=L(),ce=d("button"),ce.textContent="Add Haystack",Te=L(),K=d("h5"),K.textContent="Knowledge Graph",ne=L(),de=d("div"),fe=d("label"),Dt=x("Remote automata URL"),Tt=L(),st=d("div"),_e=d("input"),Mt=L(),Fe=d("div"),ze=d("label"),Ut=x("Local KG path"),At=L(),it=d("div"),he=d("input"),jt=L(),ct=d("div"),Ge=d("div"),Ke=d("label"),Pt=x("Local KG type"),Wt=L(),pt=d("div"),we=d("select"),Je=d("option"),Je.textContent="markdown",Be=d("option"),Be.textContent="json",It=L(),Ve=d("div"),Me=d("label"),Ne=d("input"),Ht=x(`
             Public`),Ft=L(),We=d("label"),Le=d("input"),zt=x(`
             Publish`),Gt=L(),Kt=d("hr"),Jt=L(),xe=d("button"),xe.textContent="Remove Role",u(o,"class","label"),u(o,"for",s=`role-name-${e[34]}`),u(_,"class","input"),u(_,"id",m=`role-name-${e[34]}`),u(_,"type","text"),u(i,"class","control"),u(t,"class","field"),u(h,"class","label"),u(h,"for",v=`role-shortname-${e[34]}`),u(k,"class","input"),u(k,"id",T=`role-shortname-${e[34]}`),u(k,"type","text"),u($,"class","control"),u(c,"class","field"),u(w,"class","label"),u(w,"for",z=`role-theme-${e[34]}`),u(D,"class","input"),u(D,"id",O=`role-theme-${e[34]}`),u(D,"type","text"),u(J,"class","control"),u(q,"class","field"),u(ee,"class","label"),u(ee,"for",N=`role-relevance-${e[34]}`),u(G,"class","input"),u(G,"id",C=`role-relevance-${e[34]}`),u(G,"type","text"),u(P,"class","control"),u(F,"class","field"),u(re,"class","title is-6"),u(ce,"class","button is-small"),u(K,"class","title is-6"),u(fe,"class","label"),u(fe,"for",ot=`kg-url-${e[34]}`),u(_e,"class","input"),u(_e,"id",rt=`kg-url-${e[34]}`),u(_e,"type","text"),u(_e,"placeholder","https://example.com/thesaurus.json"),u(st,"class","control"),u(de,"class","field"),u(ze,"class","label"),u(ze,"for",at=`kg-local-path-${e[34]}`),u(he,"class","input"),u(he,"id",ut=`kg-local-path-${e[34]}`),u(he,"type","text"),u(he,"placeholder","/path/to/markdown"),u(it,"class","control"),u(Fe,"class","field"),u(Ke,"class","label"),u(Ke,"for",ft=`kg-local-type-${e[34]}`),Je.__value="markdown",Je.value=Je.__value,Be.__value="json",Be.value=Be.__value,u(we,"id",dt=`kg-local-type-${e[34]}`),e[1].roles[e[34]].kg.local_type===void 0&&Qe(Vt),u(pt,"class","select"),u(Ge,"class","control"),u(ct,"class","field is-grouped"),u(Ne,"id",_t=`kg-public-${e[34]}`),u(Ne,"type","checkbox"),u(Me,"class","checkbox"),u(Me,"for",ht=`kg-public-${e[34]}`),Ae(Me,"margin-right","1rem"),u(Le,"id",mt=`kg-publish-${e[34]}`),u(Le,"type","checkbox"),u(We,"class","checkbox"),u(We,"for",gt=`kg-publish-${e[34]}`),u(Ve,"class","field is-grouped"),u(xe,"class","button is-small is-danger"),u(l,"class","box"),this.first=l},m(ue,Z){R(ue,l,Z),f(l,t),f(t,o),f(o,r),f(t,a),f(t,i),f(i,_),se(_,e[1].roles[e[34]].name),f(l,p),f(l,c),f(c,h),f(h,g),f(c,b),f(c,$),f($,k),se(k,e[1].roles[e[34]].shortname),f(l,X),f(l,q),f(q,w),f(w,U),f(q,Q),f(q,J),f(J,D),se(D,e[1].roles[e[34]].theme),f(l,A),f(l,F),f(F,ee),f(ee,S),f(F,j),f(F,P),f(P,G),se(G,e[1].roles[e[34]].relevance_function),f(l,V),f(l,re),f(l,Y);for(let ae=0;ae<ie.length;ae+=1)ie[ae]&&ie[ae].m(l,null);f(l,te),f(l,ce),f(l,Te),f(l,K),f(l,ne),f(l,de),f(de,fe),f(fe,Dt),f(de,Tt),f(de,st),f(st,_e),se(_e,e[1].roles[e[34]].kg.url),f(l,Mt),f(l,Fe),f(Fe,ze),f(ze,Ut),f(Fe,At),f(Fe,it),f(it,he),se(he,e[1].roles[e[34]].kg.local_path),f(l,jt),f(l,ct),f(ct,Ge),f(Ge,Ke),f(Ke,Pt),f(Ge,Wt),f(Ge,pt),f(pt,we),f(we,Je),f(we,Be),Ue(we,e[1].roles[e[34]].kg.local_type,!0),f(l,It),f(l,Ve),f(Ve,Me),f(Me,Ne),Ne.checked=e[1].roles[e[34]].kg.public,f(Me,Ht),f(Ve,Ft),f(Ve,We),f(We,Le),Le.checked=e[1].roles[e[34]].kg.publish,f(We,zt),f(l,Gt),f(l,Kt),f(l,Jt),f(l,xe),yt||(Bt=[B(_,"input",Ml),B(k,"input",Ul),B(D,"input",Al),B(G,"input",jl),B(ce,"click",Pl),B(_e,"input",Wl),B(he,"input",Il),B(we,"change",Vt),B(Ne,"change",Hl),B(Le,"change",Fl),B(xe,"click",zl)],yt=!0)},p(ue,Z){if(e=ue,Z[0]&2&&s!==(s=`role-name-${e[34]}`)&&u(o,"for",s),Z[0]&2&&m!==(m=`role-name-${e[34]}`)&&u(_,"id",m),Z[0]&2&&_.value!==e[1].roles[e[34]].name&&se(_,e[1].roles[e[34]].name),Z[0]&2&&v!==(v=`role-shortname-${e[34]}`)&&u(h,"for",v),Z[0]&2&&T!==(T=`role-shortname-${e[34]}`)&&u(k,"id",T),Z[0]&2&&k.value!==e[1].roles[e[34]].shortname&&se(k,e[1].roles[e[34]].shortname),Z[0]&2&&z!==(z=`role-theme-${e[34]}`)&&u(w,"for",z),Z[0]&2&&O!==(O=`role-theme-${e[34]}`)&&u(D,"id",O),Z[0]&2&&D.value!==e[1].roles[e[34]].theme&&se(D,e[1].roles[e[34]].theme),Z[0]&2&&N!==(N=`role-relevance-${e[34]}`)&&u(ee,"for",N),Z[0]&2&&C!==(C=`role-relevance-${e[34]}`)&&u(G,"id",C),Z[0]&2&&G.value!==e[1].roles[e[34]].relevance_function&&se(G,e[1].roles[e[34]].relevance_function),Z[0]&258){qe=e[32].haystacks;let ae;for(ae=0;ae<qe.length;ae+=1){const qt=pl(e,qe,ae);ie[ae]?ie[ae].p(qt,Z):(ie[ae]=_l(qt),ie[ae].c(),ie[ae].m(l,te))}for(;ae<ie.length;ae+=1)ie[ae].d(1);ie.length=qe.length}Z[0]&2&&ot!==(ot=`kg-url-${e[34]}`)&&u(fe,"for",ot),Z[0]&2&&rt!==(rt=`kg-url-${e[34]}`)&&u(_e,"id",rt),Z[0]&2&&_e.value!==e[1].roles[e[34]].kg.url&&se(_e,e[1].roles[e[34]].kg.url),Z[0]&2&&at!==(at=`kg-local-path-${e[34]}`)&&u(ze,"for",at),Z[0]&2&&ut!==(ut=`kg-local-path-${e[34]}`)&&u(he,"id",ut),Z[0]&2&&he.value!==e[1].roles[e[34]].kg.local_path&&se(he,e[1].roles[e[34]].kg.local_path),Z[0]&2&&ft!==(ft=`kg-local-type-${e[34]}`)&&u(Ke,"for",ft),Z[0]&2&&dt!==(dt=`kg-local-type-${e[34]}`)&&u(we,"id",dt),Z[0]&2&&Ue(we,e[1].roles[e[34]].kg.local_type),Z[0]&2&&_t!==(_t=`kg-public-${e[34]}`)&&u(Ne,"id",_t),Z[0]&2&&(Ne.checked=e[1].roles[e[34]].kg.public),Z[0]&2&&ht!==(ht=`kg-public-${e[34]}`)&&u(Me,"for",ht),Z[0]&2&&mt!==(mt=`kg-publish-${e[34]}`)&&u(Le,"id",mt),Z[0]&2&&(Le.checked=e[1].roles[e[34]].kg.publish),Z[0]&2&&gt!==(gt=`kg-publish-${e[34]}`)&&u(We,"for",gt)},d(ue){ue&&y(l),He(ie,ue),yt=!1,Pe(Bt)}}}function ml(n){let e,l=n[29].name+"",t,o;return{c(){e=d("option"),t=x(l),e.__value=o=n[29].name,e.value=e.__value},m(r,s){R(r,e,s),f(e,t)},p(r,s){s[0]&2&&l!==(l=r[29].name+"")&&pe(t,l),s[0]&2&&o!==(o=r[29].name)&&(e.__value=o,e.value=e.__value)},d(r){r&&y(e)}}}function gl(n){let e,l,t;return{c(){e=d("button"),e.textContent="Back",u(e,"class","button")},m(o,r){R(o,e,r),l||(t=B(e,"click",n[4]),l=!0)},p:oe,d(o){o&&y(e),l=!1,t()}}}function bo(n){let e,l,t;return{c(){e=d("button"),e.textContent="Save",u(e,"class","button is-success")},m(o,r){R(o,e,r),l||(t=B(e,"click",n[9]),l=!0)},p:oe,d(o){o&&y(e),l=!1,t()}}}function ko(n){let e,l,t;return{c(){e=d("button"),e.textContent="Next",u(e,"class","button is-primary")},m(o,r){R(o,e,r),l||(t=B(e,"click",n[3]),l=!0)},p:oe,d(o){o&&y(e),l=!1,t()}}}function wo(n){let e,l,t,o,r,s,a,i;function _(b,$){return b[0]===1?vo:b[0]===2?$o:go}let m=_(n),p=m(n),c=n[0]>1&&gl(n);function h(b,$){return b[0]<Tl?ko:bo}let g=h(n),v=g(n);return{c(){e=d("div"),l=d("h3"),l.textContent="Configuration Wizard",t=L(),p.c(),o=L(),r=d("nav"),s=d("div"),c&&c.c(),a=L(),i=d("div"),v.c(),u(l,"class","title is-4"),u(s,"class","level-left"),u(i,"class","level-right"),u(r,"class","level"),u(e,"class","box")},m(b,$){R(b,e,$),f(e,l),f(e,t),p.m(e,null),f(e,o),f(e,r),f(r,s),c&&c.m(s,null),f(r,a),f(r,i),v.m(i,null)},p(b,$){m===(m=_(b))&&p?p.p(b,$):(p.d(1),p=m(b),p&&(p.c(),p.m(e,o))),b[0]>1?c?c.p(b,$):(c=gl(b),c.c(),c.m(s,null)):c&&(c.d(1),c=null),g===(g=h(b))&&v?v.p(b,$):(v.d(1),v=g(b),v&&(v.c(),v.m(i,null)))},i:oe,o:oe,d(b){b&&y(e),p.d(),c&&c.d(),v.d()}}}const Tl=3;function yo(n,e,l){let t;const o=ve(null),r=ve({id:"Desktop",global_shortcut:"Ctrl+X",default_theme:"spacelab",default_role:"Default",roles:[]});le(n,r,S=>l(1,t=S)),Et(async()=>{try{let S;Ye(Re)?S=await me("get_config_schema"):S=await(await fetch("/config/schema")).json(),o.set(S);const N=Ye(ye);N&&N.id&&r.update(j=>{var P;return{...j,id:N.id,global_shortcut:N.global_shortcut,default_theme:((P=N.roles[N.default_role])==null?void 0:P.theme)??"spacelab",default_role:N.default_role,roles:Object.values(N.roles).map(G=>{var Y,te,ce,Te,K,ne,de;const C=(Y=G.kg)==null?void 0:Y.automata_path,V=(C==null?void 0:C.Remote)??"",re=((ce=(te=G.kg)==null?void 0:te.knowledge_graph_local)==null?void 0:ce.path)??"";return{name:G.name,shortname:G.shortname,relevance_function:G.relevance_function,theme:G.theme,haystacks:(G.haystacks??[]).map(fe=>({path:fe.path,read_only:fe.read_only??!1})),kg:{url:V,local_path:re,local_type:((K=(Te=G.kg)==null?void 0:Te.knowledge_graph_local)==null?void 0:K.input_type)??"markdown",public:((ne=G.kg)==null?void 0:ne.public)??!1,publish:((de=G.kg)==null?void 0:de.publish)??!1}}})}})}catch(S){console.error("Failed to load schema",S)}});let s=1;function a(){s<Tl&&l(0,s+=1)}function i(){s>1&&l(0,s-=1)}function _(){r.update(S=>({...S,roles:[...S.roles,{name:"New Role",shortname:"new",relevance_function:"TitleScorer",theme:"spacelab",haystacks:[],kg:{url:"",local_path:"",local_type:"markdown",public:!1,publish:!1}}]}))}function m(S){r.update(N=>({...N,roles:N.roles.filter((j,P)=>P!==S)}))}function p(S){r.update(N=>(N.roles[S].haystacks.push({path:"",read_only:!1}),N))}function c(S,N){r.update(j=>(j.roles[S].haystacks=j.roles[S].haystacks.filter((P,G)=>G!==N),j))}async function h(){var G;const S=Ye(r),N=Ye(ye);let j={...N};j.id=S.id,j.global_shortcut=S.global_shortcut,j.default_role=S.default_role;const P={};S.roles.forEach(C=>{var Y,te;const V=C.name,re=V.replace(/^"|"$/g,"");P[re]={extra:((te=(Y=N.roles)==null?void 0:Y[V])==null?void 0:te.extra)??{},name:C.name,shortname:C.shortname,theme:C.theme,relevance_function:C.relevance_function,haystacks:C.haystacks.map(ce=>({path:ce.path,service:"Ripgrep",read_only:ce.read_only})),kg:C.kg.url||C.kg.local_path?{automata_path:C.kg.url?{Remote:C.kg.url}:null,knowledge_graph_local:C.kg.local_path?{input_type:C.kg.local_type,path:C.kg.local_path}:null,public:C.kg.public,publish:C.kg.publish}:null}}),j.roles=P,(!j.default_role||!P[j.default_role])&&(j.default_role=((G=S.roles[0])==null?void 0:G.name)??"Default"),j.selected_role=j.default_role;try{Ye(Re)?await me("update_config",{configNew:j}):await fetch("/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(j)}),ye.set(j),alert("Configuration saved")}catch(C){console.error(C),alert("Failed to save config")}}function g(){t.id=St(this),r.set(t)}function v(){t.global_shortcut=this.value,r.set(t)}function b(){t.default_theme=this.value,r.set(t)}function $(){t.default_role=St(this),r.set(t)}function k(S){t.roles[S].name=this.value,r.set(t)}function T(S){t.roles[S].shortname=this.value,r.set(t)}function X(S){t.roles[S].theme=this.value,r.set(t)}function q(S){t.roles[S].relevance_function=this.value,r.set(t)}function w(S,N){t.roles[S].haystacks[N].path=this.value,r.set(t)}function U(S,N){t.roles[S].haystacks[N].read_only=this.checked,r.set(t)}const z=(S,N)=>c(S,N),Q=S=>p(S);function J(S){t.roles[S].kg.url=this.value,r.set(t)}function D(S){t.roles[S].kg.local_path=this.value,r.set(t)}function O(S){t.roles[S].kg.local_type=St(this),r.set(t)}function A(S){t.roles[S].kg.public=this.checked,r.set(t)}function F(S){t.roles[S].kg.publish=this.checked,r.set(t)}return[s,t,r,a,i,_,m,p,c,h,g,v,b,$,k,T,X,q,w,U,z,Q,J,D,O,A,F,S=>m(S)]}class So extends be{constructor(e){super(),ke(this,e,yo,wo,$e,{},null,[-1,-1])}}function Co(n){let e,l,t,o,r,s;return r=new Nl({props:{content:n[0],onChange:n[1]}}),{c(){e=d("div"),l=d("p"),l.innerHTML="<i>The best editing experience is to configure Atomic Server, in the meantime use editor below. You will need to refresh page via Command R or Ctrl-R to see changes</i>",t=L(),o=d("div"),W(r.$$.fragment),u(o,"class","editor"),u(e,"class","box")},m(a,i){R(a,e,i),f(e,l),f(e,t),f(e,o),I(r,o,null),s=!0},p(a,[i]){const _={};i&1&&(_.content=a[0]),r.$set(_)},i(a){s||(E(r.$$.fragment,a),s=!0)},o(a){M(r.$$.fragment,a),s=!1},d(a){a&&y(e),H(r)}}}function Ro(n,e,l){let t,o;le(n,ye,a=>l(2,t=a)),le(n,Re,a=>l(3,o=a));let r={json:t};function s(a){if(console.log("contents changed:",a),console.log("is tauri",o),ye.update(i=>(i=a.json,i)),Ye(Re))console.log("Updating config on server"),me("update_config",{configNew:a.json}).then(i=>{console.log(`Message: ${i}`)}).catch(i=>console.error(i));else{let i=`${Ze.ServerURL}/config/`;fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a.json)})}l(0,r=a)}return Et(()=>{l(0,r={json:t})}),[r,s]}class No extends be{constructor(e){super(),ke(this,e,Ro,Co,$e,{})}}const{window:Ot}=Ql;function Lo(n){let e,l,t,o,r,s,a,i,_,m;return{c(){e=d("div"),l=d("div"),t=d("h3"),t.textContent="Error loading graph",o=L(),r=d("p"),s=x(n[3]),a=L(),i=d("button"),i.textContent="Retry",u(i,"class","button is-primary"),u(l,"class","error-content svelte-1ry9pkl"),u(e,"class","error-overlay svelte-1ry9pkl")},m(p,c){R(p,e,c),f(e,l),f(l,t),f(l,o),f(l,r),f(r,s),f(l,a),f(l,i),_||(m=B(i,"click",n[11]),_=!0)},p(p,c){c&8&&pe(s,p[3])},d(p){p&&y(e),_=!1,m()}}}function Oo(n){let e;return{c(){e=d("div"),e.innerHTML=`<div class="loading-content svelte-1ry9pkl"><div class="loader svelte-1ry9pkl"></div> 
        <p>Loading knowledge graph...</p></div>`,u(e,"class","loading-overlay svelte-1ry9pkl")},m(l,t){R(l,e,t)},p:oe,d(l){l&&y(e)}}}function $l(n){let e,l,t;return{c(){e=d("button"),e.innerHTML='<i class="fas fa-times svelte-1ry9pkl"></i>',u(e,"class","close-button svelte-1ry9pkl"),u(e,"title","Close Graph")},m(o,r){R(o,e,r),l||(t=B(e,"click",n[17]),l=!0)},p:oe,d(o){o&&y(e),l=!1,t()}}}function vl(n){let e;return{c(){e=d("div"),e.innerHTML="<span><strong>Left-click:</strong> View node • <strong>Right-click:</strong> Edit node • <strong>Drag:</strong> Move • <strong>Scroll:</strong> Zoom</span>",u(e,"class","controls-info svelte-1ry9pkl")},m(l,t){R(l,e,t)},d(l){l&&y(e)}}}function bl(n){let e,l;return{c(){e=d("div"),l=x(n[8]),u(e,"class","debug-message svelte-1ry9pkl")},m(t,o){R(t,e,o),f(e,l)},p(t,o){o&256&&pe(l,t[8])},d(t){t&&y(e)}}}function kl(n){let e=n[5].id,l,t,o=wl(n);return{c(){o.c(),l=Xe()},m(r,s){o.m(r,s),R(r,l,s),t=!0},p(r,s){s&32&&$e(e,e=r[5].id)?(Ee(),M(o,1,1,oe),De(),o=wl(r),o.c(),E(o,1),o.m(l.parentNode,l)):o.p(r,s)},i(r){t||(E(o),t=!0)},o(r){M(o),t=!1},d(r){r&&y(l),o.d(r)}}}function wl(n){let e,l,t;function o(s){n[18](s)}let r={item:n[5],initialEdit:n[7]};return n[6]!==void 0&&(r.active=n[6]),e=new El({props:r}),ge.push(()=>Se(e,"active",o)),e.$on("close",n[12]),e.$on("save",n[13]),{c(){W(e.$$.fragment)},m(s,a){I(e,s,a),t=!0},p(s,a){const i={};a&32&&(i.item=s[5]),a&128&&(i.initialEdit=s[7]),!l&&a&64&&(l=!0,i.active=s[6],Ce(()=>l=!1)),e.$set(i)},i(s){t||(E(e.$$.fragment,s),t=!0)},o(s){M(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function Eo(n){let e,l,t,o,r,s,a,i,_;Qe(n[15]);function m($,k){if($[2])return Oo;if($[3])return Lo}let p=m(n),c=p&&p(n),h=n[0]&&$l(n),g=!n[2]&&!n[3]&&n[4].length>0&&vl(),v=n[8]&&bl(n),b=n[5]&&kl(n);return{c(){e=d("div"),c&&c.c(),l=L(),h&&h.c(),t=L(),g&&g.c(),o=L(),v&&v.c(),r=L(),b&&b.c(),s=Xe(),u(e,"class","graph-container svelte-1ry9pkl"),Ae(e,"width",n[0]?"100vw":"600px"),Ae(e,"height",n[0]?"100vh":"400px"),kt(e,"fullscreen",n[0])},m($,k){R($,e,k),c&&c.m(e,null),n[16](e),R($,l,k),h&&h.m($,k),R($,t,k),g&&g.m($,k),R($,o,k),v&&v.m($,k),R($,r,k),b&&b.m($,k),R($,s,k),a=!0,i||(_=B(Ot,"resize",n[15]),i=!0)},p($,[k]){p===(p=m($))&&c?c.p($,k):(c&&c.d(1),c=p&&p($),c&&(c.c(),c.m(e,null))),(!a||k&1)&&Ae(e,"width",$[0]?"100vw":"600px"),(!a||k&1)&&Ae(e,"height",$[0]?"100vh":"400px"),(!a||k&1)&&kt(e,"fullscreen",$[0]),$[0]?h?h.p($,k):(h=$l($),h.c(),h.m(t.parentNode,t)):h&&(h.d(1),h=null),!$[2]&&!$[3]&&$[4].length>0?g||(g=vl(),g.c(),g.m(o.parentNode,o)):g&&(g.d(1),g=null),$[8]?v?v.p($,k):(v=bl($),v.c(),v.m(r.parentNode,r)):v&&(v.d(1),v=null),$[5]?b?(b.p($,k),k&32&&E(b,1)):(b=kl($),b.c(),E(b,1),b.m(s.parentNode,s)):b&&(Ee(),M(b,1,1,()=>{b=null}),De())},i($){a||(E(b),a=!0)},o($){M(b),a=!1},d($){$&&y(e),c&&c.d(),n[16](null),$&&y(l),h&&h.d($),$&&y(t),g&&g.d($),$&&y(o),v&&v.d($),$&&y(r),b&&b.d($),$&&y(s),i=!1,_()}}}function yl(n){return{id:`kg-node-${n.id}`,url:`#/graph/node/${n.id}`,title:n.label,body:`# ${n.label}

**Knowledge Graph Node**

ID: ${n.id}
Rank: ${n.rank}

This is a concept node from the knowledge graph. You can edit this content to add more information about "${n.label}".`,description:`Knowledge graph concept: ${n.label}`,tags:["knowledge-graph","concept"],rank:n.rank}}function Do(n,e,l){let{apiUrl:t="/rolegraph"}=e,{fullscreen:o=!0}=e,r,s=!0,a=null,i=[],_=[],m=null,p=!1,c=!1,h="",g=window.innerWidth,v=window.innerHeight;function b(){l(9,g=window.innerWidth),l(10,v=window.innerHeight),!s&&!a&&w()}async function $(){l(2,s=!0),l(3,a=null);try{const D=await fetch(t);if(!D.ok)throw new Error(`Failed to fetch: ${D.status}`);const O=await D.json();l(4,i=O.nodes),_=O.edges}catch(D){l(3,a=D.message)}finally{l(2,s=!1)}}function k(D,O){D.stopPropagation(),console.log("Node clicked:",O.label),l(5,m=yl(O)),l(7,c=!1),l(6,p=!0)}function T(D,O){D.preventDefault(),D.stopPropagation(),console.log("Node right-clicked:",O.label),l(8,h=`Right-clicked: ${O.label}`),l(5,m=yl(O)),l(7,c=!0),l(6,p=!0),setTimeout(()=>{l(8,h="")},2e3)}function X(){l(6,p=!1),l(5,m=null),l(7,c=!1)}async function q(){if(m)try{const D=await fetch("/documents",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)});D.ok?console.log("Successfully saved KG record:",m.id):console.error("Failed to save KG record:",D.statusText)}catch(D){console.error("Error saving KG record:",D)}finally{l(6,p=!1),l(5,m=null),l(7,c=!1)}}function w(){if(!r)return;l(1,r.innerHTML="",r);const D=Ct(r).append("svg").attr("width",g).attr("height",v),O=rn().scaleExtent([.1,10]).on("zoom",C=>{A.attr("transform",C.transform)});D.call(O);const A=D.append("g"),F=an(i).force("link",un(_).id(C=>C.id).distance(100)).force("charge",cn().strength(-200)).force("center",fn(g/2,v/2)).force("collision",pn().radius(20)),ee=A.append("g").attr("class","links").selectAll("line").data(_).enter().append("line").attr("stroke","#666").attr("stroke-opacity",.7).attr("stroke-width",C=>{const V=C.weight||C.rank||1;return Math.max(1,Math.min(8,V*2))}),S=A.append("g").attr("class","nodes").selectAll("circle").data(i).enter().append("circle").attr("r",C=>{const V=C.rank||1;return Math.max(6,Math.min(20,V*2))}).attr("fill",C=>{const V=C.rank||1,re=Math.min(V/10,1);return dn(.2+re*.6)}).attr("stroke","#fff").attr("stroke-width",2).style("cursor","pointer").on("click",(C,V)=>k(C,V)).on("contextmenu",(C,V)=>T(C,V)).on("mouseover",function(C,V){Ct(this).transition().duration(150).attr("stroke-width",3).attr("r",re=>{const Y=re.rank||1;return Math.max(8,Math.min(24,Y*2.5))})}).on("mouseout",function(C,V){Ct(this).transition().duration(150).attr("stroke-width",2).attr("r",re=>{const Y=re.rank||1;return Math.max(6,Math.min(20,Y*2))})}).call(_n().on("start",j).on("drag",P).on("end",G)),N=A.append("g").attr("class","labels").selectAll("text").data(i).enter().append("text").attr("text-anchor","middle").attr("dy",".35em").attr("font-size","11px").attr("font-family","Arial, sans-serif").attr("fill","#333").attr("pointer-events","none").text(C=>C.label.length>12?C.label.substring(0,12)+"...":C.label);F.on("tick",()=>{ee.attr("x1",C=>C.source.x).attr("y1",C=>C.source.y).attr("x2",C=>C.target.x).attr("y2",C=>C.target.y),S.attr("cx",C=>C.x).attr("cy",C=>C.y),N.attr("x",C=>C.x).attr("y",C=>C.y)});function j(C,V){C.active||F.alphaTarget(.3).restart(),V.fx=V.x,V.fy=V.y}function P(C,V){V.fx=C.x,V.fy=C.y}function G(C,V){C.active||F.alphaTarget(0),V.fx=null,V.fy=null}}Et(()=>{$().then(()=>{a||w()});const D=O=>{O.preventDefault()};return r&&r.addEventListener("contextmenu",D),window.addEventListener("resize",b),()=>{r&&r.removeEventListener("contextmenu",D),window.removeEventListener("resize",b)}});function U(){l(9,g=Ot.innerWidth),l(10,v=Ot.innerHeight)}function z(D){ge[D?"unshift":"push"](()=>{r=D,l(1,r)})}const Q=()=>history.back();function J(D){p=D,l(6,p)}return n.$$set=D=>{"apiUrl"in D&&l(14,t=D.apiUrl),"fullscreen"in D&&l(0,o=D.fullscreen)},[o,r,s,a,i,m,p,c,h,g,v,$,X,q,t,U,z,Q,J]}class To extends be{constructor(e){super(),ke(this,e,Do,Eo,$e,{apiUrl:14,fullscreen:0})}}function Mo(n){let e,l;return e=new mo({}),{c(){W(e.$$.fragment)},m(t,o){I(e,t,o),l=!0},i(t){l||(E(e.$$.fragment,t),l=!0)},o(t){M(e.$$.fragment,t),l=!1},d(t){H(e,t)}}}function Uo(n){let e,l;return e=new Wn({}),{c(){W(e.$$.fragment)},m(t,o){I(e,t,o),l=!0},i(t){l||(E(e.$$.fragment,t),l=!0)},o(t){M(e.$$.fragment,t),l=!1},d(t){H(e,t)}}}function Ao(n){let e,l;return e=new So({}),{c(){W(e.$$.fragment)},m(t,o){I(e,t,o),l=!0},i(t){l||(E(e.$$.fragment,t),l=!0)},o(t){M(e.$$.fragment,t),l=!1},d(t){H(e,t)}}}function jo(n){let e,l;return e=new No({}),{c(){W(e.$$.fragment)},m(t,o){I(e,t,o),l=!0},i(t){l||(E(e.$$.fragment,t),l=!0)},o(t){M(e.$$.fragment,t),l=!1},d(t){H(e,t)}}}function Po(n){let e,l;return e=new To({}),{c(){W(e.$$.fragment)},m(t,o){I(e,t,o),l=!0},i(t){l||(E(e.$$.fragment,t),l=!0)},o(t){M(e.$$.fragment,t),l=!1},d(t){H(e,t)}}}function Wo(n){let e;return{c(){e=d("nav"),e.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
            <a class="navbar-item" href="/config/wizard">Wizard</a> 
            <a class="navbar-item" href="/config/json">JSON Editor</a> 
            <a class="navbar-item" href="/graph">Graph</a></div>`,u(e,"class","navbar")},m(l,t){R(l,e,t)},p:oe,d(l){l&&y(e)}}}function Io(n){let e,l,t,o,r,s,a,i,_,m,p,c,h,g,v,b,$,k,T,X,q,w,U,z,Q,J,D,O;return a=new bt({}),m=new Oe({props:{path:"/",$$slots:{default:[Mo]},$$scope:{ctx:n}}}),g=new Oe({props:{path:"/fetch/*",$$slots:{default:[Uo]},$$scope:{ctx:n}}}),b=new Oe({props:{path:"/config/wizard",$$slots:{default:[Ao]},$$scope:{ctx:n}}}),k=new Oe({props:{path:"/config/json",$$slots:{default:[jo]},$$scope:{ctx:n}}}),X=new Oe({props:{path:"/graph",$$slots:{default:[Po]},$$scope:{ctx:n}}}),z=new Oe({props:{path:"/",$$slots:{default:[Wo]},$$scope:{ctx:n}}}),{c(){e=d("meta"),l=L(),t=d("div"),o=d("main"),r=d("div"),s=d("div"),W(a.$$.fragment),i=L(),_=d("div"),W(m.$$.fragment),p=L(),c=d("br"),h=L(),W(g.$$.fragment),v=L(),W(b.$$.fragment),$=L(),W(k.$$.fragment),T=L(),W(X.$$.fragment),q=L(),w=d("footer"),U=d("div"),W(z.$$.fragment),u(e,"name","color-scheme"),u(e,"content",n[1]),document.title="Terraphim",u(s,"class","role-selector svelte-1bfpta4"),u(r,"class","top-controls svelte-1bfpta4"),u(_,"class","search-area svelte-1bfpta4"),u(o,"class","main-content svelte-1bfpta4"),u(U,"class",Q=Yt(n[0])+" svelte-1bfpta4"),u(w,"class","svelte-1bfpta4"),u(t,"class","is-full-height svelte-1bfpta4")},m(A,F){f(document.head,e),R(A,l,F),R(A,t,F),f(t,o),f(o,r),f(r,s),I(a,s,null),f(o,i),f(o,_),I(m,_,null),f(o,p),f(o,c),f(o,h),I(g,o,null),f(o,v),I(b,o,null),f(o,$),I(k,o,null),f(o,T),I(X,o,null),f(t,q),f(t,w),f(w,U),I(z,U,null),J=!0,D||(O=[B(w,"mouseover",n[2]),B(w,"focus",n[2])],D=!0)},p(A,[F]){(!J||F&2)&&u(e,"content",A[1]);const ee={};F&8&&(ee.$$scope={dirty:F,ctx:A}),m.$set(ee);const S={};F&8&&(S.$$scope={dirty:F,ctx:A}),g.$set(S);const N={};F&8&&(N.$$scope={dirty:F,ctx:A}),b.$set(N);const j={};F&8&&(j.$$scope={dirty:F,ctx:A}),k.$set(j);const P={};F&8&&(P.$$scope={dirty:F,ctx:A}),X.$set(P);const G={};F&8&&(G.$$scope={dirty:F,ctx:A}),z.$set(G),(!J||F&1&&Q!==(Q=Yt(A[0])+" svelte-1bfpta4"))&&u(U,"class",Q)},i(A){J||(E(a.$$.fragment,A),E(m.$$.fragment,A),E(g.$$.fragment,A),E(b.$$.fragment,A),E(k.$$.fragment,A),E(X.$$.fragment,A),E(z.$$.fragment,A),J=!0)},o(A){M(a.$$.fragment,A),M(m.$$.fragment,A),M(g.$$.fragment,A),M(b.$$.fragment,A),M(k.$$.fragment,A),M(X.$$.fragment,A),M(z.$$.fragment,A),J=!1},d(A){y(e),A&&y(l),A&&y(t),H(a),H(m),H(g),H(b),H(k),H(X),H(z),D=!1,Pe(O)}}}function Ho(n,e,l){let t;le(n,tt,s=>l(1,t=s));let o="is-hidden";function r(){l(0,o="")}return[o,t,r]}class Fo extends be{constructor(e){super(),ke(this,e,Ho,Io,$e,{})}}const zo=new nn;on(zo);new Fo({target:document.getElementById("app")});
