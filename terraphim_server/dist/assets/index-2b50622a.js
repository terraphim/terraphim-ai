var ms=Object.defineProperty;var hs=(l,e,t)=>e in l?ms(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var yt=(l,e,t)=>(hs(l,typeof e!="symbol"?e+"":e,t),t);import{aa as Lt,S as ht,i as gt,s as ct,q as f,Y as U,b as R,y as s,Z as ve,I as Te,j as T,ak as Oe,F as ot,m as Bt,a as g,v as a,l as ee,E as Qe,au as Ht,r as pe,z as _e,t as J,d as Y,B as me,av as gs,aw as Jt,H as xe,U as tt,V as lt,ax as El,ay as vs,g as qe,e as Be,O as Ve,af as Ze,o as bs,W as de,az as Ml,aA as At,aB as Zn,aC as Xn,a1 as Ue,C as ut,aD as He,aE as xn,D as nl,G as sl,aF as es,w as Nt,x as Ut,A as jl,a2 as ks,aG as dl,ac as ws,a7 as ys,a9 as $s,n as Cs}from"./vendor-ui-cd3d2b6a.js";import{R as Pt,S as Ol}from"./vendor-utils-1b347ea1.js";import{J as ts,_ as Ss,E as Ts,d as Rs,o as co}from"./vendor-editor-992829d3.js";import{P as ls,T as Pl,u as os,y as As,A as Ls,S as Es,q as Ps}from"./vendor-atomic-1ea13e29.js";import{t as Os,S as Ns,E as Us}from"./novel-editor-c665f5c2.js";import{s as Ul,z as Is,a as Ds,l as Ms,m as js,c as Hs,b as zs,B as Fs,d as Ws}from"./vendor-charts-e6a4a6c9.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const u of n)if(u.type==="childList")for(const r of u.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function t(n){const u={};return n.integrity&&(u.integrity=n.integrity),n.referrerPolicy&&(u.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?u.credentials="include":n.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function o(n){if(n.ep)return;n.ep=!0;const u=t(n);fetch(n.href,u)}})();const Xe={ServerURL:location.protocol+"//"+window.location.host||"/"},fl=Lt([]),Ks={id:"Desktop",global_shortcut:"",roles:{},default_role:{original:"",lowercase:""},selected_role:{original:"",lowercase:""}},pl=Lt("spacelab"),St=Lt("selected"),ze=Lt(!1),Gs=Lt(`${Xe.ServerURL}/documents/search`),Tt=Lt(Ks),fo=Lt([]);let Al=Lt("");const Ct=Lt(!1);let qt=null;function qs(l){if(typeof document>"u")return;const e=`/assets/bulmaswatch/${l}/bulmaswatch.min.css`;if(qt!=null&&qt.href.endsWith(e))return;const t=document.createElement("link");t.rel="stylesheet",t.href=e,t.id="bulma-theme",t.onload=()=>{qt&&qt!==t&&qt.remove(),qt=t},document.head.appendChild(t);const o=document.head.querySelector('meta[name="color-scheme"]');o&&o.setAttribute("content",l)}pl.subscribe(qs);function Bs(l){let e,t;return{c(){e=f("option"),t=U(l[1]),e.__value=l[0],e.value=e.__value},m(o,n){R(o,e,n),s(e,t)},p(o,[n]){n&2&&ve(t,o[1]),n&1&&(e.__value=o[0],e.value=e.__value)},i:Te,o:Te,d(o){o&&T(e)}}}function Js(l,e,t){let o,{subject:n}=e;const u=ls(n),r=Pl(u,os.properties.name);return Oe(l,r,c=>t(1,o=c)),Pl(u,"http://localhost:9883/property/theme"),l.$$set=c=>{"subject"in c&&t(0,n=c.subject)},[n,o,r]}class Vs extends ht{constructor(e){super(),gt(this,e,Js,Bs,ct,{subject:0})}}function po(l){let e,t,o,n,u,r,c=l[0]&&_o();return{c(){e=f("button"),t=f("span"),t.innerHTML='<i class="fas fa-arrow-left"></i>',o=g(),c&&c.c(),a(t,"class","icon svelte-rnsqpo"),a(e,"class",n="button is-light back-button "+l[1]+" svelte-rnsqpo"),a(e,"title","Go back"),a(e,"aria-label","Go back")},m(i,d){R(i,e,d),s(e,t),s(e,o),c&&c.m(e,null),u||(r=[ee(e,"click",l[3]),ee(e,"keydown",l[6])],u=!0)},p(i,d){i[0]?c||(c=_o(),c.c(),c.m(e,null)):c&&(c.d(1),c=null),d&2&&n!==(n="button is-light back-button "+i[1]+" svelte-rnsqpo")&&a(e,"class",n)},d(i){i&&T(e),c&&c.d(),u=!1,Qe(r)}}}function _o(l){let e;return{c(){e=f("span"),e.textContent="Back",a(e,"class","back-text svelte-rnsqpo")},m(t,o){R(t,e,o)},d(t){t&&T(e)}}}function Qs(l){let e,t=l[2]&&po(l);return{c(){t&&t.c(),e=ot()},m(o,n){t&&t.m(o,n),R(o,e,n)},p(o,[n]){o[2]?t?t.p(o,n):(t=po(o),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Te,o:Te,d(o){t&&t.d(o),o&&T(e)}}}function Ys(l,e,t){let{fallbackPath:o="/"}=e,{showText:n=!0}=e,{customClass:u=""}=e,{hideOnPaths:r=["/"]}=e,c=!0;function i(){var _;try{const m=((_=window.location)==null?void 0:_.pathname)||"/";t(2,c=!r.includes(m))}catch{t(2,c=!0)}}function d(){window.history.length>1?window.history.back():window.location.href=o}Bt(()=>(i(),window.addEventListener("popstate",i),window.addEventListener("hashchange",i),()=>{window.removeEventListener("popstate",i),window.removeEventListener("hashchange",i)}));const p=_=>{(_.key==="Enter"||_.key===" ")&&(_.preventDefault(),d())};return l.$$set=_=>{"fallbackPath"in _&&t(4,o=_.fallbackPath),"showText"in _&&t(0,n=_.showText),"customClass"in _&&t(1,u=_.customClass),"hideOnPaths"in _&&t(5,r=_.hideOnPaths)},[n,u,c,d,o,r,p]}class rl extends ht{constructor(e){super(),gt(this,e,Ys,Qs,ct,{fallbackPath:4,showText:0,customClass:1,hideOnPaths:5})}}function Zs(){return window.crypto.getRandomValues(new Uint32Array(1))[0]}function Il(l,e=!1){const t=Zs(),o=`_${t}`;return Object.defineProperty(window,o,{value:n=>(e&&Reflect.deleteProperty(window,o),l==null?void 0:l(n)),writable:!1,configurable:!0}),t}async function Me(l,e={}){return new Promise((t,o)=>{const n=Il(r=>{t(r),Reflect.deleteProperty(window,`_${u}`)},!0),u=Il(r=>{o(r),Reflect.deleteProperty(window,`_${n}`)},!0);window.__TAURI_IPC__({cmd:l,callback:n,error:u,...e})})}function mo(l,e,t){const o=l.slice();return o[25]=e[t],o}function Xs(l){let e,t,o;function n(r){l[13](r)}let u={};return l[5]!==void 0&&(u.value=l[5]),e=new Jt({props:u}),xe.push(()=>tt(e,"value",n)),{c(){pe(e.$$.fragment)},m(r,c){_e(e,r,c),o=!0},p(r,c){const i={};!t&&c&32&&(t=!0,i.value=r[5],lt(()=>t=!1)),e.$set(i)},i(r){o||(J(e.$$.fragment,r),o=!0)},o(r){Y(e.$$.fragment,r),o=!1},d(r){me(e,r)}}}function xs(l){let e,t,o;function n(r){l[14](r)}let u={type:"password",placeholder:"secret",icon:"fas fa-lock",expanded:!0};return l[6]!==void 0&&(u.value=l[6]),e=new Jt({props:u}),xe.push(()=>tt(e,"value",n)),{c(){pe(e.$$.fragment)},m(r,c){_e(e,r,c),o=!0},p(r,c){const i={};!t&&c&64&&(t=!0,i.value=r[6],lt(()=>t=!1)),e.$set(i)},i(r){o||(J(e.$$.fragment,r),o=!0)},o(r){Y(e.$$.fragment,r),o=!1},d(r){me(e,r)}}}function er(l){let e;return{c(){e=U("Save")},m(t,o){R(t,e,o)},d(t){t&&T(e)}}}function tr(l){let e,t;return e=new El({props:{type:"is-success",class:"is-right",iconPack:"fa",iconLeft:"check",$$slots:{default:[er]},$$scope:{ctx:l}}}),e.$on("click",l[8]),e.$on("submit",l[8]),{c(){pe(e.$$.fragment)},m(o,n){_e(e,o,n),t=!0},p(o,n){const u={};n&268435456&&(u.$$scope={dirty:n,ctx:o}),e.$set(u)},i(o){t||(J(e.$$.fragment,o),t=!0)},o(o){Y(e.$$.fragment,o),t=!1},d(o){me(e,o)}}}function lr(l){let e,t,o,n,u,r;return e=new Ht({props:{$$slots:{default:[Xs]},$$scope:{ctx:l}}}),o=new Ht({props:{grouped:!0,$$slots:{default:[xs]},$$scope:{ctx:l}}}),u=new Ht({props:{grouped:!0,$$slots:{default:[tr]},$$scope:{ctx:l}}}),{c(){pe(e.$$.fragment),t=g(),pe(o.$$.fragment),n=g(),pe(u.$$.fragment)},m(c,i){_e(e,c,i),R(c,t,i),_e(o,c,i),R(c,n,i),_e(u,c,i),r=!0},p(c,i){const d={};i&268435488&&(d.$$scope={dirty:i,ctx:c}),e.$set(d);const p={};i&268435520&&(p.$$scope={dirty:i,ctx:c}),o.$set(p);const _={};i&268435456&&(_.$$scope={dirty:i,ctx:c}),u.$set(_)},i(c){r||(J(e.$$.fragment,c),J(o.$$.fragment,c),J(u.$$.fragment,c),r=!0)},o(c){Y(e.$$.fragment,c),Y(o.$$.fragment,c),Y(u.$$.fragment,c),r=!1},d(c){me(e,c),c&&T(t),me(o,c),c&&T(n),me(u,c)}}}function or(l){let e,t,o;function n(r){l[15](r)}let u={type:"search",placeholder:"Fetch JSON",icon:"search"};return l[3]!==void 0&&(u.value=l[3]),e=new Jt({props:u}),xe.push(()=>tt(e,"value",n)),{c(){pe(e.$$.fragment)},m(r,c){_e(e,r,c),o=!0},p(r,c){const i={};!t&&c&8&&(t=!0,i.value=r[3],lt(()=>t=!1)),e.$set(i)},i(r){o||(J(e.$$.fragment,r),o=!0)},o(r){Y(e.$$.fragment,r),o=!1},d(r){me(e,r)}}}function nr(l){let e;return{c(){e=U("WikiPage")},m(t,o){R(t,e,o)},d(t){t&&T(e)}}}function sr(l){let e,t,o,n,u,r;function c(_){l[16](_)}let i={type:"search",placeholder:"Post JSON",icon:"search"};l[4]!==void 0&&(i.value=l[4]),e=new Jt({props:i}),xe.push(()=>tt(e,"value",c));function d(_){l[17](_)}let p={$$slots:{default:[nr]},$$scope:{ctx:l}};return l[2]!==void 0&&(p.checked=l[2]),n=new vs({props:p}),xe.push(()=>tt(n,"checked",d)),{c(){pe(e.$$.fragment),o=g(),pe(n.$$.fragment)},m(_,m){_e(e,_,m),R(_,o,m),_e(n,_,m),r=!0},p(_,m){const w={};!t&&m&16&&(t=!0,w.value=_[4],lt(()=>t=!1)),e.$set(w);const v={};m&268435456&&(v.$$scope={dirty:m,ctx:_}),!u&&m&4&&(u=!0,v.checked=_[2],lt(()=>u=!1)),n.$set(v)},i(_){r||(J(e.$$.fragment,_),J(n.$$.fragment,_),r=!0)},o(_){Y(e.$$.fragment,_),Y(n.$$.fragment,_),r=!1},d(_){me(e,_),_&&T(o),me(n,_)}}}function rr(l){let e;return{c(){e=U("Fetch")},m(t,o){R(t,e,o)},d(t){t&&T(e)}}}function ir(l){let e,t;return e=new El({props:{type:"is-primary",$$slots:{default:[rr]},$$scope:{ctx:l}}}),e.$on("click",l[9]),e.$on("submit",l[9]),{c(){pe(e.$$.fragment)},m(o,n){_e(e,o,n),t=!0},p(o,n){const u={};n&268435456&&(u.$$scope={dirty:n,ctx:o}),e.$set(u)},i(o){t||(J(e.$$.fragment,o),t=!0)},o(o){Y(e.$$.fragment,o),t=!1},d(o){me(e,o)}}}function ar(l){let e,t,o,n,u,r;return e=new Ht({props:{grouped:!0,$$slots:{default:[or]},$$scope:{ctx:l}}}),o=new Ht({props:{grouped:!0,$$slots:{default:[sr]},$$scope:{ctx:l}}}),u=new Ht({props:{grouped:!0,$$slots:{default:[ir]},$$scope:{ctx:l}}}),{c(){pe(e.$$.fragment),t=g(),pe(o.$$.fragment),n=g(),pe(u.$$.fragment)},m(c,i){_e(e,c,i),R(c,t,i),_e(o,c,i),R(c,n,i),_e(u,c,i),r=!0},p(c,i){const d={};i&268435464&&(d.$$scope={dirty:i,ctx:c}),e.$set(d);const p={};i&268435476&&(p.$$scope={dirty:i,ctx:c}),o.$set(p);const _={};i&268435456&&(_.$$scope={dirty:i,ctx:c}),u.$set(_)},i(c){r||(J(e.$$.fragment,c),J(o.$$.fragment,c),J(u.$$.fragment,c),r=!0)},o(c){Y(e.$$.fragment,c),Y(o.$$.fragment,c),Y(u.$$.fragment,c),r=!1},d(c){me(e,c),c&&T(t),me(o,c),c&&T(n),me(u,c)}}}function ur(l){let e,t,o,n,u;return n=new ts({props:{content:l[1],onChange:l[7]}}),{c(){e=f("p"),e.innerHTML=`<i>The best editing experience is to configure Atomic Server, in the
        meantime use editor below. You will need to refresh page via Command R
        or Ctrl-R to see changes</i>`,t=g(),o=f("div"),pe(n.$$.fragment),a(o,"class","editor")},m(r,c){R(r,e,c),R(r,t,c),R(r,o,c),_e(n,o,null),u=!0},p(r,c){const i={};c&2&&(i.content=r[1]),n.$set(i)},i(r){u||(J(n.$$.fragment,r),u=!0)},o(r){Y(n.$$.fragment,r),u=!1},d(r){r&&T(e),r&&T(t),r&&T(o),me(n)}}}function ho(l){let e,t;return e=new Vs({props:{subject:l[25]}}),{c(){pe(e.$$.fragment)},m(o,n){_e(e,o,n),t=!0},p(o,n){const u={};n&1&&(u.subject=o[25]),e.$set(u)},i(o){t||(J(e.$$.fragment,o),t=!0)},o(o){Y(e.$$.fragment,o),t=!1},d(o){me(e,o)}}}function cr(l){let e,t,o=l[0]??[],n=[];for(let r=0;r<o.length;r+=1)n[r]=ho(mo(l,o,r));const u=r=>Y(n[r],1,1,()=>{n[r]=null});return{c(){for(let r=0;r<n.length;r+=1)n[r].c();e=ot()},m(r,c){for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(r,c);R(r,e,c),t=!0},p(r,c){if(c&1){o=r[0]??[];let i;for(i=0;i<o.length;i+=1){const d=mo(r,o,i);n[i]?(n[i].p(d,c),J(n[i],1)):(n[i]=ho(d),n[i].c(),J(n[i],1),n[i].m(e.parentNode,e))}for(qe(),i=o.length;i<n.length;i+=1)u(i);Be()}},i(r){if(!t){for(let c=0;c<o.length;c+=1)J(n[c]);t=!0}},o(r){n=n.filter(Boolean);for(let c=0;c<n.length;c+=1)Y(n[c]);t=!1},d(r){Ve(n,r),r&&T(e)}}}function fr(l){let e,t;return e=new gs({props:{$$slots:{default:[cr]},$$scope:{ctx:l}}}),{c(){pe(e.$$.fragment)},m(o,n){_e(e,o,n),t=!0},p(o,n){const u={};n&268435457&&(u.$$scope={dirty:n,ctx:o}),e.$set(u)},i(o){t||(J(e.$$.fragment,o),t=!0)},o(o){Y(e.$$.fragment,o),t=!1},d(o){me(e,o)}}}function dr(l){let e,t,o,n,u,r,c,i,d,p,_,m,w,v,k;return e=new rl({props:{fallbackPath:"/"}}),n=new Pt({props:{path:"/atomic",$$slots:{default:[lr]},$$scope:{ctx:l}}}),r=new Pt({props:{path:"/json",$$slots:{default:[ar]},$$scope:{ctx:l}}}),i=new Pt({props:{path:"/editor",$$slots:{default:[ur]},$$scope:{ctx:l}}}),m=new Ht({props:{grouped:!0,position:"is-right",$$slots:{default:[fr]},$$scope:{ctx:l}}}),{c(){pe(e.$$.fragment),t=g(),o=f("div"),pe(n.$$.fragment),u=g(),pe(r.$$.fragment),c=g(),pe(i.$$.fragment),d=g(),p=f("hr"),_=g(),pe(m.$$.fragment),w=g(),v=f("nav"),v.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a>
    <a class="navbar-item" href="/fetch/json">Fetch JSON Data</a>
    <a class="navbar-item" href="/fetch/atomic">Set Atomic Server</a>
    <a class="navbar-item" href="/fetch/editor">Edit JSON config</a></div>`,a(o,"class","box"),a(v,"class","navbar")},m(y,S){_e(e,y,S),R(y,t,S),R(y,o,S),_e(n,o,null),s(o,u),_e(r,o,null),s(o,c),_e(i,o,null),R(y,d,S),R(y,p,S),R(y,_,S),_e(m,y,S),R(y,w,S),R(y,v,S),k=!0},p(y,[S]){const b={};S&268435552&&(b.$$scope={dirty:S,ctx:y}),n.$set(b);const h={};S&268435484&&(h.$$scope={dirty:S,ctx:y}),r.$set(h);const $={};S&268435458&&($.$$scope={dirty:S,ctx:y}),i.$set($);const q={};S&268435457&&(q.$$scope={dirty:S,ctx:y}),m.$set(q)},i(y){k||(J(e.$$.fragment,y),J(n.$$.fragment,y),J(r.$$.fragment,y),J(i.$$.fragment,y),J(m.$$.fragment,y),k=!0)},o(y){Y(e.$$.fragment,y),Y(n.$$.fragment,y),Y(r.$$.fragment,y),Y(i.$$.fragment,y),Y(m.$$.fragment,y),k=!1},d(y){me(e,y),y&&T(t),y&&T(o),me(n),me(r),me(i),y&&T(d),y&&T(p),y&&T(_),me(m,y),y&&T(w),y&&T(v)}}}function pr(l,e,t){let o,n,u,r,c;Oe(l,As,A=>t(19,u=A)),Oe(l,ze,A=>t(20,r=A)),Oe(l,Tt,A=>t(21,c=A));let i={json:c};function d(A){if(console.log("contents changed:",A),console.log("is tauri",r),Tt.update(E=>(E=A.json,E)),ze)console.log("Updating config on server"),Me("update_config",{configNew:A.json}).then(E=>{console.log(`Message: ${E}`)}).catch(E=>console.error(E));else{let E=`${Xe.ServerURL}/config/`;fetch(E,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(A.json)})}t(1,i=A)}let p=!1,_="https://raw.githubusercontent.com/terraphim/terraphim-cloud-fastapi/main/data/ref_arch.json",m="http://localhost:8000/documents/",w="http://localhost:9883/",v;const k=async()=>{console.log("Updating atomic server configuration");const A=Ls.fromSecret(v);u.setServerUrl(w),console.log("Server set.Setting agent"),u.setAgent(A)},y=async()=>{h()},S=({data:{msg:A,data:E}})=>{console.log(A,E)};let b;const h=async()=>{const A=await Ss(()=>import("./fetcher.worker-7e58969a.js"),[]);b=new A.default,b.onmessage=S;const E={msg:"fetcher",data:{url:_,postUrl:m,isWiki:p}};b.postMessage(E)},$=ls("http://localhost:9883/config/y3zx5wtm0bq"),q=Pl($,os.properties.name);Oe(l,q,A=>t(12,n=A));const O=Pl($,"http://localhost:9883/property/role");Oe(l,O,A=>t(0,o=A));function N(A){w=A,t(5,w)}function L(A){v=A,t(6,v)}function Q(A){_=A,t(3,_)}function V(A){m=A,t(4,m)}function K(A){p=A,t(2,p)}return l.$$.update=()=>{l.$$.dirty&4096&&console.log("Print name",n),l.$$.dirty&1&&console.log("Print roles",o)},[o,i,p,_,m,w,v,d,k,y,q,O,n,N,L,Q,V,K]}class _r extends ht{constructor(e){super(),gt(this,e,pr,dr,ct,{})}}class mr{constructor(){yt(this,"baseUrl");yt(this,"autocompleteIndexBuilt",!1);yt(this,"sessionId");yt(this,"currentRole","Default");yt(this,"connectionRetries",0);yt(this,"maxRetries",3);yt(this,"retryDelay",1e3);yt(this,"isConnecting",!1);this.baseUrl=typeof window<"u"?(window.location.protocol==="https:"?"https://":"http://")+window.location.hostname+":8001":"http://localhost:8001",this.sessionId=`novel-${Date.now()}`,this.detectServerPort()}setRole(e){this.currentRole=e,this.autocompleteIndexBuilt=!1}async detectServerPort(){if(Ze(ze))return;const e=[8001,3e3,8e3,8080];for(const t of e)try{const o=typeof window<"u"?(window.location.protocol==="https:"?"https://":"http://")+window.location.hostname+":"+t:"http://localhost:"+t,n=await fetch(`${o}/message?sessionId=health-check`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:0,method:"ping",params:{}}),signal:AbortSignal.timeout(2e3)});if(n.ok||n.status===404){this.baseUrl=o,console.log(`NovelAutocompleteService: Detected server at ${o}`);return}}catch{continue}console.warn("NovelAutocompleteService: Could not detect running server, using default:",this.baseUrl)}async buildAutocompleteIndex(){if(this.isConnecting)return await new Promise(e=>setTimeout(e,1e3)),this.autocompleteIndexBuilt;this.isConnecting=!0;try{if(Ze(ze)){console.log("Using Tauri autocomplete - testing connection");const e=await Me("get_autocomplete_suggestions",{query:"test",roleName:this.currentRole,limit:1});return e&&e.status==="success"?(this.autocompleteIndexBuilt=!0,this.connectionRetries=0,console.log("Tauri autocomplete connection verified"),!0):(console.warn("Tauri autocomplete test failed:",e),!1)}else return await this.buildMCPIndex()}catch(e){return console.error("Error building Novel autocomplete index:",e),!1}finally{this.isConnecting=!1}}async buildMCPIndex(){for(let e=0;e<=this.maxRetries;e++)try{const t=await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:Date.now(),method:"tools/call",params:{name:"build_autocomplete_index",arguments:{}}}),signal:AbortSignal.timeout(1e4)});if(t.ok){const o=await t.json();if(console.log(`MCP build index response (attempt ${e+1}):`,o),o.result&&!o.result.is_error)return this.autocompleteIndexBuilt=!0,this.connectionRetries=0,console.log("MCP autocomplete index built successfully"),!0}else if(t.status>=500&&e<this.maxRetries){console.warn(`MCP server error ${t.status}, retrying in ${this.retryDelay}ms...`),await new Promise(o=>setTimeout(o,this.retryDelay*(e+1)));continue}console.warn(`MCP build index failed (attempt ${e+1}):`,t.status,t.statusText)}catch(t){t instanceof Error&&t.name==="AbortError"?console.warn(`MCP request timeout (attempt ${e+1})`):console.warn(`MCP connection error (attempt ${e+1}):`,t),e<this.maxRetries&&await new Promise(o=>setTimeout(o,this.retryDelay*(e+1)))}return console.error("Failed to build MCP autocomplete index after all retries"),!1}async getCompletion(e){if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return{text:""};try{const t=this.extractLastWord(e.prompt);if(!t||t.length<1)return{text:""};const o=await this.getSuggestionsWithSnippets(t,5);if(o.length===0)return{text:""};let u=o[0].text;u.toLowerCase().startsWith(t.toLowerCase())&&(u=u.substring(t.length));const r=e.prompt.length/4,c=u.length/4;return{text:u,usage:{promptTokens:Math.round(r),completionTokens:Math.round(c),totalTokens:Math.round(r+c)}}}catch(t){return console.error("Error getting Novel autocomplete completion:",t),{text:""}}}async getSuggestions(e,t=10){if(!e||e.trim().length===0)return[];if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return console.warn("Autocomplete index not built, returning empty suggestions"),[];try{return Ze(ze)?await this.getTauriSuggestions(e,t):await this.getMCPSuggestions(e,t,"autocomplete_terms")}catch(o){return console.error("Error getting autocomplete suggestions:",o),[]}}async getTauriSuggestions(e,t){const o=await Me("get_autocomplete_suggestions",{query:e.trim(),roleName:this.currentRole,limit:t});return console.log("Tauri autocomplete response:",o),o&&o.status==="success"&&o.suggestions?o.suggestions.map(n=>({text:n.term||n.text||"",snippet:n.url||n.snippet||"",score:n.score||1})).filter(n=>n.text.length>0):(o&&o.error&&console.error("Tauri autocomplete error:",o.error),[])}async getMCPSuggestions(e,t,o){const n=Date.now(),u=await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:n,method:"tools/call",params:{name:o,arguments:{query:e.trim(),limit:t,role:this.currentRole}}}),signal:AbortSignal.timeout(5e3)});if(!u.ok)return console.error(`MCP ${o} request failed:`,u.status,u.statusText),[];const r=await u.json();return console.log(`MCP ${o} response:`,r),r.result&&!r.result.is_error&&r.result.content?o==="autocomplete_with_snippets"?this.parseAutocompleteWithSnippetsContent(r.result.content):this.parseAutocompleteContent(r.result.content):(r.error&&console.error(`MCP ${o} error:`,r.error),[])}async getSuggestionsWithSnippets(e,t=10){if(!e||e.trim().length===0)return[];if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return console.warn("Autocomplete index not built, returning empty suggestions with snippets"),[];try{return Ze(ze)?await this.getTauriSuggestions(e,t):await this.getMCPSuggestions(e,t,"autocomplete_with_snippets")}catch(o){return console.error("Error getting autocomplete suggestions with snippets:",o),[]}}extractLastWord(e){const t=e.trim().split(/\s+/);return t[t.length-1]||""}parseAutocompleteContent(e){const t=[];for(const o of e)if(o.type==="text"&&o.text){if(!o.text.startsWith("Found")&&!o.text.startsWith("•"))t.push({text:o.text.trim()});else if(o.text.startsWith("•")){const n=o.text.replace("•","").trim();n&&t.push({text:n})}}return t}parseAutocompleteWithSnippetsContent(e){const t=[];for(const o of e)if(o.type==="text"&&o.text){if(!o.text.startsWith("Found")&&!o.text.startsWith("•")){const n=o.text.split(" — ");n.length===2?t.push({text:n[0].trim(),snippet:n[1].trim()}):t.push({text:o.text.trim()})}else if(o.text.startsWith("•")){const n=o.text.replace("•","").trim();n&&t.push({text:n})}}return t}isReady(){return this.autocompleteIndexBuilt}getStatus(){return{ready:this.autocompleteIndexBuilt,baseUrl:this.baseUrl,sessionId:this.sessionId,usingTauri:Ze(ze),currentRole:this.currentRole,connectionRetries:this.connectionRetries,isConnecting:this.isConnecting}}async refreshIndex(){return this.autocompleteIndexBuilt=!1,this.connectionRetries=0,await this.buildAutocompleteIndex()}async testConnection(){try{if(Ze(ze)){const e=await Me("get_config");return e&&e.status==="success"}else return(await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:Date.now(),method:"tools/list",params:{}}),signal:AbortSignal.timeout(3e3)})).ok}catch(e){return console.warn("Connection test failed:",e),!1}}}const Ot=new mr,go=Ts.create({name:"terraphimSuggestion",addOptions(){return{trigger:"/",pluginKey:new Rs("terraphimSuggestion"),allowSpaces:!1,limit:8,minLength:1,debounce:300}},addCommands(){return{insertSuggestion:l=>({commands:e,chain:t})=>t().insertContent(l.text).run()}},addProseMirrorPlugins(){const l={editor:this.editor,char:this.options.trigger,pluginKey:this.options.pluginKey,allowSpaces:this.options.allowSpaces,startOfLine:!1,command:({editor:e,range:t,props:o})=>{const n=o;e.chain().focus().insertContentAt(t,n.text+" ").run()},items:async({query:e,editor:t})=>new Promise(o=>{setTimeout(async()=>{if(e.length<this.options.minLength){o([]);return}try{const n=await Ot.getSuggestionsWithSnippets(e,this.options.limit);console.log(`TerraphimSuggestion: Found ${n.length} suggestions for "${e}"`),o(n)}catch(n){console.error("TerraphimSuggestion: Error getting suggestions:",n),o([])}},this.options.debounce)}),render:()=>{let e,t;return{onStart:o=>{e=new hr({items:o.items,command:o.command}),o.clientRect&&(t=Os("body",{getReferenceClientRect:o.clientRect,appendTo:()=>document.body,content:e.element,showOnCreate:!0,interactive:!0,trigger:"manual",placement:"bottom-start",theme:"terraphim-suggestion",maxWidth:"none"})[0])},onUpdate(o){e==null||e.updateItems(o.items),o.clientRect&&(t==null||t.setProps({getReferenceClientRect:o.clientRect}))},onKeyDown(o){return o.event.key==="Escape"?(t==null||t.hide(),!0):(e==null?void 0:e.onKeyDown(o))??!1},onExit(){t==null||t.destroy(),e==null||e.destroy()}}}};return[Ns(l)]}});class hr{constructor(e){yt(this,"element");yt(this,"items",[]);yt(this,"selectedIndex",0);yt(this,"command");this.items=e.items,this.command=e.command,this.element=document.createElement("div"),this.element.className="terraphim-suggestion-dropdown",this.render()}updateItems(e){this.items=e,this.selectedIndex=0,this.render()}onKeyDown({event:e}){return e.key==="ArrowUp"?(this.selectPrevious(),!0):e.key==="ArrowDown"?(this.selectNext(),!0):e.key==="Enter"||e.key==="Tab"?(this.selectItem(this.selectedIndex),!0):!1}selectPrevious(){this.selectedIndex=Math.max(0,this.selectedIndex-1),this.render()}selectNext(){this.selectedIndex=Math.min(this.items.length-1,this.selectedIndex+1),this.render()}selectItem(e){const t=this.items[e];t&&this.command(t)}render(){if(this.element.innerHTML="",this.items.length===0){this.element.innerHTML=`
        <div class="terraphim-suggestion-item terraphim-suggestion-empty">
          <div class="terraphim-suggestion-text">No suggestions found</div>
          <div class="terraphim-suggestion-hint">Try a different search term</div>
        </div>
      `;return}const e=document.createElement("div");e.className="terraphim-suggestion-header",e.innerHTML=`
      <div class="terraphim-suggestion-count">${this.items.length} suggestions</div>
      <div class="terraphim-suggestion-hint">↑↓ Navigate • Tab/Enter Select • Esc Cancel</div>
    `,this.element.appendChild(e),this.items.forEach((t,o)=>{const n=document.createElement("div");n.className=`terraphim-suggestion-item ${o===this.selectedIndex?"terraphim-suggestion-selected":""}`,n.innerHTML=`
        <div class="terraphim-suggestion-main">
          <div class="terraphim-suggestion-text">${this.escapeHtml(t.text)}</div>
          ${t.snippet?`<div class="terraphim-suggestion-snippet">${this.escapeHtml(t.snippet)}</div>`:""}
        </div>
        ${t.score?`<div class="terraphim-suggestion-score">${Math.round(t.score*100)}%</div>`:""}
      `,n.addEventListener("click",()=>this.selectItem(o)),n.addEventListener("mouseenter",()=>{this.selectedIndex=o,this.render()}),this.element.appendChild(n)})}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}destroy(){this.element.remove()}}const gr=`
.terraphim-suggestion-dropdown {
  background: white;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  box-shadow: 0 10px 38px -10px rgba(22, 23, 24, 0.35), 0 10px 20px -15px rgba(22, 23, 24, 0.2);
  max-height: 300px;
  min-width: 300px;
  overflow-y: auto;
  z-index: 1000;
}

.terraphim-suggestion-header {
  padding: 8px 12px;
  border-bottom: 1px solid #f1f5f9;
  background: #f8fafc;
  font-size: 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.terraphim-suggestion-count {
  font-weight: 600;
  color: #475569;
}

.terraphim-suggestion-hint {
  color: #64748b;
}

.terraphim-suggestion-item {
  padding: 8px 12px;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  border-bottom: 1px solid #f1f5f9;
}

.terraphim-suggestion-item:hover {
  background: #f8fafc;
}

.terraphim-suggestion-selected {
  background: #eff6ff !important;
  border-left: 3px solid #3b82f6;
}

.terraphim-suggestion-empty {
  color: #64748b;
  font-style: italic;
  text-align: center;
  cursor: default;
}

.terraphim-suggestion-main {
  flex: 1;
}

.terraphim-suggestion-text {
  font-weight: 500;
  color: #1e293b;
  margin-bottom: 2px;
}

.terraphim-suggestion-snippet {
  font-size: 12px;
  color: #64748b;
  line-height: 1.3;
}

.terraphim-suggestion-score {
  font-size: 11px;
  color: #10b981;
  font-weight: 600;
  background: #ecfdf5;
  padding: 2px 6px;
  border-radius: 4px;
  margin-left: 8px;
}

/* Dark theme support */
@media (prefers-color-scheme: dark) {
  .terraphim-suggestion-dropdown {
    background: #1e293b;
    border-color: #334155;
  }

  .terraphim-suggestion-header {
    background: #0f172a;
    border-color: #334155;
  }

  .terraphim-suggestion-item:hover {
    background: #334155;
  }

  .terraphim-suggestion-selected {
    background: #1e40af !important;
  }

  .terraphim-suggestion-text {
    color: #f1f5f9;
  }

  .terraphim-suggestion-snippet {
    color: #94a3b8;
  }
}

/* Tippy.js theme */
.tippy-box[data-theme~='terraphim-suggestion'] {
  background: transparent;
  box-shadow: none;
}

.tippy-box[data-theme~='terraphim-suggestion'] > .tippy-backdrop {
  background: transparent;
}

.tippy-box[data-theme~='terraphim-suggestion'] > .tippy-arrow {
  display: none;
}
`;function vo(l){let e,t,o,n,u,r,c,i,d,p,_,m,w,v,k,y,S,b,h,$,q,O,N,L,Q,V,K=l[12]?"Tauri (native)":`MCP Server (${Ot.getStatus().baseUrl})`,A,E,G,C,H,B,F,Z,P,I,z,W,X,D,oe,ge,we,he,fe,se,ce=l[6]!==1?"s":"",ke,Ce,te,ie,ae,ue,Ee,We,Ke,Pe,Re,x,ne,Se,Ae,et,Ne,ft,nt=l[3]?"Enabled":"Disabled",vt,Ye,st,dt,Ie=l[11]&&!l[8]&&bo(l);function Rt(j,re){if(j[8])return wr;if(j[11])return kr}let M=Rt(l),le=M&&M(l);return{c(){e=f("div"),t=f("div"),o=f("strong"),o.textContent="Local Autocomplete Status:",n=g(),u=f("div"),r=f("button"),c=U("Test"),d=g(),p=f("button"),p.textContent="Rebuild Index",_=g(),m=f("button"),w=U("Demo"),k=g(),y=f("div"),S=U(l[10]),b=g(),Ie&&Ie.c(),h=g(),$=f("div"),q=f("strong"),q.textContent="Configuration:",O=g(),N=f("br"),L=U("• "),Q=f("strong"),Q.textContent="Backend:",V=g(),A=U(K),E=g(),G=f("br"),C=U("• "),H=f("strong"),H.textContent="Role:",B=g(),F=U(l[9]),Z=g(),P=f("br"),I=U("• "),z=f("strong"),z.textContent="Trigger:",W=U(' "'),X=U(l[4]),D=U(`" + text
      `),oe=f("br"),ge=U("• "),we=f("strong"),we.textContent="Min Length:",he=g(),fe=U(l[6]),se=U(" character"),ke=U(ce),Ce=g(),te=f("br"),ie=U("• "),ae=f("strong"),ae.textContent="Max Results:",ue=g(),Ee=U(l[5]),We=g(),Ke=f("br"),Pe=U("• "),Re=f("strong"),Re.textContent="Debounce:",x=g(),ne=U(l[7]),Se=U(`ms
      `),Ae=f("br"),et=U("• "),Ne=f("strong"),Ne.textContent="Snippets:",ft=g(),vt=U(nt),Ye=g(),le&&le.c(),de(o,"color","#495057"),de(r,"padding","4px 8px"),de(r,"background","#007bff"),de(r,"color","white"),de(r,"border","none"),de(r,"border-radius","4px"),de(r,"cursor","pointer"),de(r,"font-size","12px"),r.disabled=i=!l[8],de(p,"padding","4px 8px"),de(p,"background","#28a745"),de(p,"color","white"),de(p,"border","none"),de(p,"border-radius","4px"),de(p,"cursor","pointer"),de(p,"font-size","12px"),de(m,"padding","4px 8px"),de(m,"background","#ffc107"),de(m,"color","#212529"),de(m,"border","none"),de(m,"border-radius","4px"),de(m,"cursor","pointer"),de(m,"font-size","12px"),m.disabled=v=!l[8],de(u,"display","flex"),de(u,"gap","8px"),de(t,"display","flex"),de(t,"justify-content","space-between"),de(t,"align-items","center"),de(t,"margin-bottom","8px"),de(y,"font-size","13px"),de(y,"color","#6c757d"),de(y,"margin-bottom","8px"),de(y,"font-family","monospace"),de($,"font-size","12px"),de($,"color","#6c757d"),de(e,"margin-top","10px"),de(e,"padding","12px"),de(e,"background","#f8f9fa"),de(e,"border-radius","6px"),de(e,"border","1px solid #e9ecef")},m(j,re){R(j,e,re),s(e,t),s(t,o),s(t,n),s(t,u),s(u,r),s(r,c),s(u,d),s(u,p),s(u,_),s(u,m),s(m,w),s(e,k),s(e,y),s(y,S),s(e,b),Ie&&Ie.m(e,null),s(e,h),s(e,$),s($,q),s($,O),s($,N),s($,L),s($,Q),s($,V),s($,A),s($,E),s($,G),s($,C),s($,H),s($,B),s($,F),s($,Z),s($,P),s($,I),s($,z),s($,W),s($,X),s($,D),s($,oe),s($,ge),s($,we),s($,he),s($,fe),s($,se),s($,ke),s($,Ce),s($,te),s($,ie),s($,ae),s($,ue),s($,Ee),s($,We),s($,Ke),s($,Pe),s($,Re),s($,x),s($,ne),s($,Se),s($,Ae),s($,et),s($,Ne),s($,ft),s($,vt),s(e,Ye),le&&le.m(e,null),st||(dt=[ee(r,"click",l[14]),ee(p,"click",l[15]),ee(m,"click",l[16])],st=!0)},p(j,re){re&256&&i!==(i=!j[8])&&(r.disabled=i),re&256&&v!==(v=!j[8])&&(m.disabled=v),re&1024&&ve(S,j[10]),j[11]&&!j[8]?Ie?Ie.p(j,re):(Ie=bo(j),Ie.c(),Ie.m(e,h)):Ie&&(Ie.d(1),Ie=null),re&4096&&K!==(K=j[12]?"Tauri (native)":`MCP Server (${Ot.getStatus().baseUrl})`)&&ve(A,K),re&512&&ve(F,j[9]),re&16&&ve(X,j[4]),re&64&&ve(fe,j[6]),re&64&&ce!==(ce=j[6]!==1?"s":"")&&ve(ke,ce),re&32&&ve(Ee,j[5]),re&128&&ve(ne,j[7]),re&8&&nt!==(nt=j[3]?"Enabled":"Disabled")&&ve(vt,nt),M===(M=Rt(j))&&le?le.p(j,re):(le&&le.d(1),le=M&&M(j),le&&(le.c(),le.m(e,null)))},d(j){j&&T(e),Ie&&Ie.d(),le&&le.d(),st=!1,Qe(dt)}}}function bo(l){let e,t,o,n;function u(i,d){return i[12]?br:vr}let r=u(l),c=r(l);return{c(){e=f("div"),t=f("strong"),t.textContent="⚠️ Autocomplete Not Available",o=f("br"),n=g(),c.c(),de(e,"font-size","12px"),de(e,"color","#dc3545"),de(e,"margin-bottom","8px"),de(e,"padding","6px"),de(e,"background","#f8d7da"),de(e,"border-radius","4px")},m(i,d){R(i,e,d),s(e,t),s(e,o),s(e,n),c.m(e,null)},p(i,d){r===(r=u(i))&&c?c.p(i,d):(c.d(1),c=r(i),c&&(c.c(),c.m(e,null)))},d(i){i&&T(e),c.d()}}}function vr(l){let e,t=Ot.getStatus().baseUrl+"",o;return{c(){e=U("MCP server not responding. Ensure the server is running on "),o=U(t)},m(n,u){R(n,e,u),R(n,o,u)},p:Te,d(n){n&&T(e),n&&T(o)}}}function br(l){let e;return{c(){e=U("Tauri backend connection failed. Ensure the application has proper permissions.")},m(t,o){R(t,e,o)},p:Te,d(t){t&&T(e)}}}function kr(l){let e;return{c(){e=f("div"),e.innerHTML=`<strong>❌ Autocomplete Unavailable</strong>
        <div style="font-size: 11px; margin-top: 4px; color: #721c24;">Click &quot;Rebuild Index&quot; to retry or check server/backend status.</div>`,de(e,"margin-top","8px"),de(e,"padding","8px"),de(e,"background","#f8d7da"),de(e,"border","1px solid #f5c6cb"),de(e,"border-radius","4px")},m(t,o){R(t,e,o)},p:Te,d(t){t&&T(e)}}}function wr(l){let e,t,o,n,u,r,c,i,d,p,_,m,w,v,k,y,S;return{c(){e=f("div"),t=f("strong"),t.textContent="🎯 Autocomplete Active",o=g(),n=f("div"),u=U("Type "),r=f("code"),c=U(l[4]),i=U(" in the editor above to trigger suggestions."),d=f("br"),p=U(`
          Example: `),_=f("code"),m=U(l[4]),w=U("terraphim"),v=U(" or "),k=f("code"),y=U(l[4]),S=U("graph"),de(n,"font-size","11px"),de(n,"margin-top","4px"),de(n,"color","#0056b3"),de(e,"margin-top","8px"),de(e,"padding","8px"),de(e,"background","#d1edff"),de(e,"border","1px solid #b3d9ff"),de(e,"border-radius","4px")},m(b,h){R(b,e,h),s(e,t),s(e,o),s(e,n),s(n,u),s(n,r),s(r,c),s(n,i),s(n,d),s(n,p),s(n,_),s(_,m),s(_,w),s(n,v),s(n,k),s(k,y),s(k,S)},p(b,h){h&16&&ve(c,b[4]),h&16&&ve(m,b[4]),h&16&&ve(y,b[4])},d(b){b&&T(e)}}}function yr(l){let e,t,o,n;e=new Us({props:{defaultValue:l[0],isEditable:!l[1],disableLocalStorage:!0,onUpdate:l[13],extensions:[co,...l[2]?[go.configure({trigger:l[4],allowSpaces:!1,limit:l[5],minLength:l[6],debounce:l[7]})]:[]]}});let u=l[2]&&vo(l);return{c(){pe(e.$$.fragment),t=g(),u&&u.c(),o=ot()},m(r,c){_e(e,r,c),R(r,t,c),u&&u.m(r,c),R(r,o,c),n=!0},p(r,[c]){const i={};c&1&&(i.defaultValue=r[0]),c&2&&(i.isEditable=!r[1]),c&244&&(i.extensions=[co,...r[2]?[go.configure({trigger:r[4],allowSpaces:!1,limit:r[5],minLength:r[6],debounce:r[7]})]:[]]),e.$set(i),r[2]?u?u.p(r,c):(u=vo(r),u.c(),u.m(o.parentNode,o)):u&&(u.d(1),u=null)},i(r){n||(J(e.$$.fragment,r),n=!0)},o(r){Y(e.$$.fragment,r),n=!1},d(r){me(e,r),r&&T(t),u&&u.d(r),r&&T(o)}}}function $r(l,e,t){let o,n;Oe(l,St,L=>t(9,o=L)),Oe(l,ze,L=>t(12,n=L));let{html:u=""}=e,{readOnly:r=!1}=e,{outputFormat:c="html"}=e,{enableAutocomplete:i=!0}=e,{showSnippets:d=!0}=e,{suggestionTrigger:p="/"}=e,{maxSuggestions:_=8}=e,{minQueryLength:m=1}=e,{debounceDelay:w=300}=e,v=null,k="⏳ Initializing...",y=!1,S=!1,b=null;Bt(async()=>{i&&await h(),typeof document<"u"&&(b=document.createElement("style"),b.textContent=gr,document.head.appendChild(b))}),bs(()=>{b&&b.parentNode&&b.parentNode.removeChild(b)});async function h(){t(10,k="⏳ Initializing autocomplete..."),t(8,y=!1),t(11,S=!1);try{Ot.setRole(o),t(10,k="🔗 Testing connection...");const L=await Ot.testConnection();t(11,S=!0),L?(t(10,k="🔨 Building autocomplete index..."),await Ot.buildAutocompleteIndex()?(n?t(10,k="✅ Ready - Using Tauri backend"):t(10,k="✅ Ready - Using MCP server backend"),t(8,y=!0)):t(10,k="❌ Failed to build autocomplete index")):n?t(10,k="❌ Tauri backend not available"):t(10,k="❌ MCP server not responding")}catch(L){console.error("Error initializing autocomplete:",L),t(10,k="❌ Autocomplete initialization error")}}const $=L=>{v=L,c==="markdown"?t(0,u=L.storage.markdown.getMarkdown()):t(0,u=L.getHTML())},q=async()=>{if(!S){alert("Please wait for connection test to complete");return}if(!y){alert("Autocomplete service not ready. Check the status above.");return}try{t(10,k="🧪 Testing autocomplete...");const L="terraphim",Q=await Ot.getSuggestions(L,5);if(console.log("Autocomplete test results:",Q),Q.length>0){const V=Q.map((K,A)=>`${A+1}. ${K.text}${K.snippet?` (${K.snippet})`:""}`).join(`
`);alert(`✅ Found ${Q.length} suggestions for '${L}':

${V}`),n?t(10,k="✅ Ready - Using Tauri backend"):t(10,k="✅ Ready - Using MCP server backend")}else alert(`⚠️ No suggestions found for '${L}'. This might be normal if the term isn't in your knowledge graph.`)}catch(L){console.error("Autocomplete test failed:",L),alert(`❌ Autocomplete test failed: ${L.message}`),t(10,k="❌ Test failed - check console for details")}},O=async()=>{t(10,k="⏳ Rebuilding index..."),t(8,y=!1);try{await Ot.refreshIndex()?(n?t(10,k="✅ Ready - Tauri index rebuilt successfully"):t(10,k="✅ Ready - MCP server index rebuilt successfully"),t(8,y=!0)):t(10,k="❌ Failed to rebuild index")}catch(L){console.error("Error rebuilding index:",L),t(10,k="❌ Index rebuild failed - check console for details")}},N=()=>{if(!v){alert("Editor not ready yet");return}const L=`# Terraphim Autocomplete Demo

This is a demonstration of the integrated Terraphim autocomplete system.

## How to Use:
1. Type "${p}" to trigger autocomplete
2. Start typing any term (e.g., "${p}terraphim", "${p}graph")
3. Use ↑↓ arrows to navigate suggestions
4. Press Tab or Enter to select
5. Press Esc to cancel

## Try these queries:
- ${p}terraphim
- ${p}graph
- ${p}service
- ${p}automata
- ${p}role

The autocomplete system uses your local knowledge graph to provide intelligent suggestions based on your selected role: **${o}**.

---

Start typing below:`;v.commands.setContent(L),setTimeout(()=>{v.commands.focus("end")},100),alert(`Demo content inserted!

Type "${p}" followed by any term to see autocomplete suggestions.

Example: "${p}terraphim"`)};return l.$$set=L=>{"html"in L&&t(0,u=L.html),"readOnly"in L&&t(1,r=L.readOnly),"outputFormat"in L&&t(17,c=L.outputFormat),"enableAutocomplete"in L&&t(2,i=L.enableAutocomplete),"showSnippets"in L&&t(3,d=L.showSnippets),"suggestionTrigger"in L&&t(4,p=L.suggestionTrigger),"maxSuggestions"in L&&t(5,_=L.maxSuggestions),"minQueryLength"in L&&t(6,m=L.minQueryLength),"debounceDelay"in L&&t(7,w=L.debounceDelay)},l.$$.update=()=>{l.$$.dirty&772&&o&&i&&y&&(Ot.setRole(o),h())},[u,r,i,d,p,_,m,w,y,o,k,S,n,$,q,O,N,c]}class Cr extends ht{constructor(e){super(),gt(this,e,$r,yr,ct,{html:0,readOnly:1,outputFormat:17,enableAutocomplete:2,showSnippets:3,suggestionTrigger:4,maxSuggestions:5,minQueryLength:6,debounceDelay:7})}}function ko(l){let e,t,o,n,u,r,c,i,d,p,_;return{c(){e=f("div"),t=f("h3"),o=f("span"),o.textContent="Knowledge Graph",n=U(`
          Term: `),u=f("strong"),r=U(l[2]),c=U(" | Rank: "),i=f("strong"),d=U(l[3]),p=g(),_=f("hr"),a(o,"class","tag is-info svelte-329px1"),a(t,"class","subtitle is-6 svelte-329px1"),a(_,"class","svelte-329px1"),a(e,"class","kg-context svelte-329px1")},m(m,w){R(m,e,w),s(e,t),s(t,o),s(t,n),s(t,u),s(u,r),s(t,c),s(t,i),s(i,d),s(e,p),s(e,_)},p(m,w){w&4&&ve(r,m[2]),w&8&&ve(d,m[3])},d(m){m&&T(e)}}}function Sr(l){let e,t,o,n,u,r,c,i;const d=[Ar,Rr],p=[];function _(m,w){return m[5]?0:1}return t=_(l),o=p[t]=d[t](l),{c(){e=f("div"),o.c(),n=g(),u=f("div"),u.innerHTML='<span class="hint-text svelte-329px1">Double-click to edit • Ctrl+E to edit • Ctrl+S to save • Click KG links to explore</span>',a(u,"class","edit-hint svelte-329px1"),a(e,"class","content-viewer svelte-329px1"),a(e,"tabindex","0"),a(e,"role","button"),a(e,"aria-label","Double-click to edit article content")},m(m,w){R(m,e,w),p[t].m(e,null),s(e,n),s(e,u),l[20](e),r=!0,c||(i=[ee(e,"dblclick",l[14]),ee(e,"keydown",l[15]),ee(e,"click",l[13])],c=!0)},p(m,w){let v=t;t=_(m),t===v?p[t].p(m,w):(qe(),Y(p[v],1,1,()=>{p[v]=null}),Be(),o=p[t],o?o.p(m,w):(o=p[t]=d[t](m),o.c()),J(o,1),o.m(e,n))},i(m){r||(J(o),r=!0)},o(m){Y(o),r=!1},d(m){m&&T(e),p[t].d(),l[20](null),c=!1,Qe(i)}}}function Tr(l){let e,t,o,n,u,r,c,i,d,p;function _(w){l[18](w)}let m={outputFormat:l[11]};return l[1].body!==void 0&&(m.html=l[1].body),e=new Cr({props:m}),xe.push(()=>tt(e,"html",_)),{c(){pe(e.$$.fragment),o=g(),n=f("div"),u=f("button"),u.textContent="Save",r=g(),c=f("button"),c.textContent="Cancel",a(u,"class","button is-primary"),a(c,"class","button is-light"),a(n,"class","edit-controls svelte-329px1")},m(w,v){_e(e,w,v),R(w,o,v),R(w,n,v),s(n,u),s(n,r),s(n,c),i=!0,d||(p=[ee(u,"click",l[12]),ee(c,"click",l[19])],d=!0)},p(w,v){const k={};v&2048&&(k.outputFormat=w[11]),!t&&v&2&&(t=!0,k.html=w[1].body,lt(()=>t=!1)),e.$set(k)},i(w){i||(J(e.$$.fragment,w),i=!0)},o(w){Y(e.$$.fragment,w),i=!1},d(w){me(e,w),w&&T(o),w&&T(n),d=!1,Qe(p)}}}function Rr(l){let e,t,o;return t=new Ol({props:{source:l[1].body}}),{c(){e=f("div"),pe(t.$$.fragment),a(e,"class","markdown-content svelte-329px1")},m(n,u){R(n,e,u),_e(t,e,null),o=!0},p(n,u){const r={};u&2&&(r.source=n[1].body),t.$set(r)},i(n){o||(J(t.$$.fragment,n),o=!0)},o(n){Y(t.$$.fragment,n),o=!1},d(n){n&&T(e),me(t)}}}function Ar(l){let e,t=l[1].body+"";return{c(){e=f("div"),a(e,"class","prose svelte-329px1")},m(o,n){R(o,e,n),e.innerHTML=t},p(o,n){n&2&&t!==(t=o[1].body+"")&&(e.innerHTML=t)},i:Te,o:Te,d(o){o&&T(e)}}}function Lr(l){let e,t,o,n,u,r=l[1].title+"",c,i,d,p,_,m,w,v=l[2]&&l[3]!==null&&ko(l);const k=[Tr,Sr],y=[];function S(b,h){return b[4]?0:1}return d=S(l),p=y[d]=k[d](l),{c(){e=f("div"),t=f("button"),o=g(),v&&v.c(),n=g(),u=f("h2"),c=U(r),i=g(),p.c(),a(t,"class","delete is-large modal-close-btn svelte-329px1"),a(t,"aria-label","close"),a(u,"class","svelte-329px1"),a(e,"class","box wrapper svelte-329px1")},m(b,h){R(b,e,h),s(e,t),s(e,o),v&&v.m(e,null),s(e,n),s(e,u),s(u,c),s(e,i),y[d].m(e,null),_=!0,m||(w=ee(t,"click",l[17]),m=!0)},p(b,h){b[2]&&b[3]!==null?v?v.p(b,h):(v=ko(b),v.c(),v.m(e,n)):v&&(v.d(1),v=null),(!_||h&2)&&r!==(r=b[1].title+"")&&ve(c,r);let $=d;d=S(b),d===$?y[d].p(b,h):(qe(),Y(y[$],1,1,()=>{y[$]=null}),Be(),p=y[d],p?p.p(b,h):(p=y[d]=k[d](b),p.c()),J(p,1),p.m(e,null))},i(b){_||(J(p),_=!0)},o(b){Y(p),_=!1},d(b){b&&T(e),v&&v.d(),y[d].d(),m=!1,w()}}}function wo(l){let e,t,o;function n(r){l[23](r)}let u={$$slots:{default:[Or]},$$scope:{ctx:l}};return l[7]!==void 0&&(u.active=l[7]),e=new Ml({props:u}),xe.push(()=>tt(e,"active",n)),{c(){pe(e.$$.fragment)},m(r,c){_e(e,r,c),o=!0},p(r,c){const i={};c&536872832&&(i.$$scope={dirty:c,ctx:r}),!t&&c&128&&(t=!0,i.active=r[7],lt(()=>t=!1)),e.$set(i)},i(r){o||(J(e.$$.fragment,r),o=!0)},o(r){Y(e.$$.fragment,r),o=!1},d(r){me(e,r)}}}function yo(l){let e,t,o,n,u,r,c,i,d,p,_;return{c(){e=f("div"),t=f("h3"),o=f("span"),o.textContent="Knowledge Graph",n=U(`
            Term: `),u=f("strong"),r=U(l[9]),c=U(" | Rank: "),i=f("strong"),d=U(l[10]),p=g(),_=f("hr"),a(o,"class","tag is-info svelte-329px1"),a(t,"class","subtitle is-6 svelte-329px1"),a(_,"class","svelte-329px1"),a(e,"class","kg-context svelte-329px1")},m(m,w){R(m,e,w),s(e,t),s(t,o),s(t,n),s(t,u),s(u,r),s(t,c),s(t,i),s(i,d),s(e,p),s(e,_)},p(m,w){w&512&&ve(r,m[9]),w&1024&&ve(d,m[10])},d(m){m&&T(e)}}}function Er(l){let e,t,o;return t=new Ol({props:{source:l[8].body}}),{c(){e=f("div"),pe(t.$$.fragment),a(e,"class","markdown-content svelte-329px1")},m(n,u){R(n,e,u),_e(t,e,null),o=!0},p(n,u){const r={};u&256&&(r.source=n[8].body),t.$set(r)},i(n){o||(J(t.$$.fragment,n),o=!0)},o(n){Y(t.$$.fragment,n),o=!1},d(n){n&&T(e),me(t)}}}function Pr(l){let e,t=l[8].body+"";return{c(){e=f("div"),a(e,"class","prose svelte-329px1")},m(o,n){R(o,e,n),e.innerHTML=t},p(o,n){n&256&&t!==(t=o[8].body+"")&&(e.innerHTML=t)},i:Te,o:Te,d(o){o&&T(e)}}}function Or(l){let e,t,o,n,u,r=l[8].title+"",c,i,d,p,_,m,w,v,k,y,S,b=l[9]&&l[10]!==null&&yo(l);const h=[Pr,Er],$=[];function q(O,N){return N&256&&(p=null),p==null&&(p=!!(O[8].body&&(/<html/i.test(O[8].body)||/<body/i.test(O[8].body)||/<head/i.test(O[8].body)))),p?0:1}return _=q(l,-1),m=$[_]=h[_](l),{c(){e=f("div"),t=f("button"),o=g(),b&&b.c(),n=g(),u=f("h2"),c=U(r),i=g(),d=f("div"),m.c(),w=g(),v=f("div"),v.innerHTML='<span class="hint-text svelte-329px1">Knowledge Graph document • Click KG links to explore further</span>',a(t,"class","delete is-large modal-close-btn svelte-329px1"),a(t,"aria-label","close"),a(u,"class","svelte-329px1"),a(v,"class","edit-hint svelte-329px1"),a(d,"class","content-viewer svelte-329px1"),a(d,"tabindex","0"),a(d,"role","button"),a(d,"aria-label","KG document content - click KG links to explore further"),a(e,"class","box wrapper svelte-329px1")},m(O,N){R(O,e,N),s(e,t),s(e,o),b&&b.m(e,null),s(e,n),s(e,u),s(u,c),s(e,i),s(e,d),$[_].m(d,null),s(d,w),s(d,v),k=!0,y||(S=[ee(t,"click",l[22]),ee(d,"click",l[13])],y=!0)},p(O,N){O[9]&&O[10]!==null?b?b.p(O,N):(b=yo(O),b.c(),b.m(e,n)):b&&(b.d(1),b=null),(!k||N&256)&&r!==(r=O[8].title+"")&&ve(c,r);let L=_;_=q(O,N),_===L?$[_].p(O,N):(qe(),Y($[L],1,1,()=>{$[L]=null}),Be(),m=$[_],m?m.p(O,N):(m=$[_]=h[_](O),m.c()),J(m,1),m.m(d,w))},i(O){k||(J(m),k=!0)},o(O){Y(m),k=!1},d(O){O&&T(e),b&&b.d(),$[_].d(),y=!1,Qe(S)}}}function Nr(l){let e,t,o,n,u;function r(d){l[21](d)}let c={$$slots:{default:[Lr]},$$scope:{ctx:l}};l[0]!==void 0&&(c.active=l[0]),e=new Ml({props:c}),xe.push(()=>tt(e,"active",r));let i=l[8]&&wo(l);return{c(){pe(e.$$.fragment),o=g(),i&&i.c(),n=ot()},m(d,p){_e(e,d,p),R(d,o,p),i&&i.m(d,p),R(d,n,p),u=!0},p(d,[p]){const _={};p&536873087&&(_.$$scope={dirty:p,ctx:d}),!t&&p&1&&(t=!0,_.active=d[0],lt(()=>t=!1)),e.$set(_),d[8]?i?(i.p(d,p),p&256&&J(i,1)):(i=wo(d),i.c(),J(i,1),i.m(n.parentNode,n)):i&&(qe(),Y(i,1,1,()=>{i=null}),Be())},i(d){u||(J(e.$$.fragment,d),J(i),u=!0)},o(d){Y(e.$$.fragment,d),Y(i),u=!1},d(d){me(e,d),d&&T(o),i&&i.d(d),d&&T(n)}}}function Ur(l,e,t){let o,n,u,r;Oe(l,ze,C=>t(25,u=C)),Oe(l,St,C=>t(26,r=C));let{active:c=!1}=e,{item:i}=e,{initialEdit:d=!1}=e,{kgTerm:p=null}=e,{kgRank:_=null}=e,m=!1,w,v=!1,k=null,y=null,S=null;async function b(){if(u)try{const C=await Me("get_document",{documentId:i.id});C!=null&&C.document&&t(1,i=C.document)}catch(C){console.error("Failed to load document",C)}}async function h(){if(!u){t(4,m=!1);return}try{await Me("create_document",{document:i}),t(4,m=!1)}catch(C){console.error("Failed to save document",C)}}async function $(C){var H,B,F,Z,P;t(9,y=C),console.log("🔍 KG Link Click Debug Info:"),console.log("  Term clicked:",C),console.log("  Current role:",r),console.log("  Is Tauri mode:",u);try{if(u){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:r,term:C});const I=await Me("find_documents_for_kg_term",{roleName:r,term:C});console.log("  📥 Tauri response received:"),console.log("    Status:",I.status),console.log("    Results count:",((H=I.results)==null?void 0:H.length)||0),console.log("    Total:",I.total||0),console.log("    Full response:",JSON.stringify(I,null,2)),I.status==="success"&&I.results&&I.results.length>0?(t(8,k=I.results[0]),t(10,S=k.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",k.title),console.log("    Rank:",S),console.log("    Body length:",((B=k.body)==null?void 0:B.length)||0,"characters"),t(7,v=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${C}" in role: "${r}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const I=Xe.ServerURL,z=encodeURIComponent(r),W=encodeURIComponent(C),X=`${I}/roles/${z}/kg_search?term=${W}`;console.log("  📤 HTTP Request details:"),console.log("    Base URL:",I),console.log("    Role (encoded):",z),console.log("    Term (encoded):",W),console.log("    Full URL:",X);const D=await fetch(X);if(console.log("  📥 HTTP Response received:"),console.log("    Status code:",D.status),console.log("    Status text:",D.statusText),console.log("    Headers:",Object.fromEntries(D.headers.entries())),!D.ok)throw new Error(`HTTP error! Status: ${D.status} - ${D.statusText}`);const oe=await D.json();console.log("  📄 Response data:"),console.log("    Status:",oe.status),console.log("    Results count:",((F=oe.results)==null?void 0:F.length)||0),console.log("    Total:",oe.total||0),console.log("    Full response:",JSON.stringify(oe,null,2)),oe.status==="success"&&oe.results&&oe.results.length>0?(t(8,k=oe.results[0]),t(10,S=k.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",k.title),console.log("    Rank:",S),console.log("    Body length:",((Z=k.body)==null?void 0:Z.length)||0,"characters"),t(7,v=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${C}" in role: "${r}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",X))}}catch(I){console.error("❌ Error fetching KG document:"),console.error("  Error type:",I.constructor.name),console.error("  Error message:",I.message||I),console.error("  Request details:",{term:C,role:r,isTauri:u,timestamp:new Date().toISOString()}),!u&&((P=I.message)!=null&&P.includes("Failed to fetch"))&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{}}function q(C){const H=C.target;if(H.tagName==="A"){const B=H.getAttribute("href");if(B&&B.startsWith("kg:")){C.preventDefault();const F=B.substring(3);$(F)}}}function O(){t(4,m=!0)}function N(C){C.type!=="dblclick"&&((C.ctrlKey||C.metaKey)&&C.key==="e"&&(C.preventDefault(),t(4,m=!0)),m&&(C.ctrlKey||C.metaKey)&&C.key==="s"&&(C.preventDefault(),h()),C.key==="Escape"&&(C.preventDefault(),m?t(4,m=!1):t(0,c=!1)))}const L=()=>t(0,c=!1);function Q(C){l.$$.not_equal(i.body,C)&&(i.body=C,t(1,i))}const V=()=>t(4,m=!1);function K(C){xe[C?"unshift":"push"](()=>{w=C,t(6,w)})}function A(C){c=C,t(0,c)}const E=()=>t(7,v=!1);function G(C){v=C,t(7,v)}return l.$$set=C=>{"active"in C&&t(0,c=C.active),"item"in C&&t(1,i=C.item),"initialEdit"in C&&t(16,d=C.initialEdit),"kgTerm"in C&&t(2,p=C.kgTerm),"kgRank"in C&&t(3,_=C.kgRank)},l.$$.update=()=>{l.$$.dirty&65537&&c&&d&&t(4,m=!0),l.$$.dirty&19&&c&&i&&!m&&b(),l.$$.dirty&2&&t(5,o=i!=null&&i.body?/<html/i.test(i.body)||/<body/i.test(i.body)||/<head/i.test(i.body)||/^\s*<(!DOCTYPE|html|head|body|div|p|span)/i.test(i.body.trim()):!1),l.$$.dirty&32&&t(11,n=o?"html":"markdown")},[c,i,p,_,m,o,w,v,k,y,S,n,h,q,O,N,d,L,Q,V,K,A,E,G]}class Hl extends ht{constructor(e){super(),gt(this,e,Ur,Nr,ct,{active:0,item:1,initialEdit:16,kgTerm:2,kgRank:3})}}function $o(l,e,t){const o=l.slice();return o[33]=e[t],o}function Co(l,e,t){const o=l.slice();return o[36]=e[t],o}function So(l,e,t){const o=l.slice();return o[39]=e[t],o}function To(l){let e,t;return e=new Zn({props:{type:"is-success",$$slots:{default:[Ir]},$$scope:{ctx:l}}}),{c(){pe(e.$$.fragment)},m(o,n){_e(e,o,n),t=!0},i(o){t||(J(e.$$.fragment,o),t=!0)},o(o){Y(e.$$.fragment,o),t=!1},d(o){me(e,o)}}}function Ir(l){let e,t,o;return{c(){e=f("p"),e.innerHTML="<strong>Success!</strong> Article saved to atomic server successfully.",t=g(),o=f("p"),o.textContent="The modal will close automatically..."},m(n,u){R(n,e,u),R(n,t,u),R(n,o,u)},p:Te,d(n){n&&T(e),n&&T(t),n&&T(o)}}}function Ro(l){let e,t;return e=new Zn({props:{type:"is-danger",$$slots:{default:[Dr]},$$scope:{ctx:l}}}),{c(){pe(e.$$.fragment)},m(o,n){_e(e,o,n),t=!0},p(o,n){const u={};n[0]&8|n[1]&2048&&(u.$$scope={dirty:n,ctx:o}),e.$set(u)},i(o){t||(J(e.$$.fragment,o),t=!0)},o(o){Y(e.$$.fragment,o),t=!1},d(o){me(e,o)}}}function Dr(l){let e,t,o,n;return{c(){e=f("p"),t=f("strong"),t.textContent="Error:",o=g(),n=U(l[3])},m(u,r){R(u,e,r),s(e,t),s(e,o),s(e,n)},p(u,r){r[0]&8&&ve(n,u[3])},d(u){u&&T(e)}}}function Ao(l){var G,C,H,B;let e,t,o,n,u,r=(((G=l[1])==null?void 0:G.title)||"Untitled")+"",c,i,d,p,_,m,w=(((C=l[1])==null?void 0:C.rank)||0)+"",v,k,y,S,b,h,$,q,O,N,L=((H=l[1])==null?void 0:H.description)&&Lo(l),Q=((B=l[1])==null?void 0:B.tags)&&Eo(l);function V(F,Z){return F[10].length>0?jr:Mr}let K=V(l),A=K(l),E=l[10].length>0&&No(l);return{c(){e=f("div"),t=f("label"),t.textContent="Document to Save",o=g(),n=f("div"),u=f("h5"),c=U(r),i=g(),L&&L.c(),d=g(),p=f("div"),_=f("span"),m=U("Rank: "),v=U(w),k=g(),Q&&Q.c(),y=g(),S=f("div"),b=f("label"),b.textContent="Atomic Server",h=g(),$=f("div"),A.c(),q=g(),E&&E.c(),O=ot(),a(t,"class","label"),a(u,"class","title is-6"),a(_,"class","tag is-info svelte-48g63o"),a(p,"class","tags svelte-48g63o"),a(n,"class","box document-preview svelte-48g63o"),a(e,"class","field"),a(b,"class","label"),a(b,"for","atomic-server-select"),a($,"class","control"),a(S,"class","field")},m(F,Z){R(F,e,Z),s(e,t),s(e,o),s(e,n),s(n,u),s(u,c),s(n,i),L&&L.m(n,null),s(n,d),s(n,p),s(p,_),s(_,m),s(_,v),s(p,k),Q&&Q.m(p,null),R(F,y,Z),R(F,S,Z),s(S,b),s(S,h),s(S,$),A.m($,null),R(F,q,Z),E&&E.m(F,Z),R(F,O,Z),N=!0},p(F,Z){var P,I,z,W;(!N||Z[0]&2)&&r!==(r=(((P=F[1])==null?void 0:P.title)||"Untitled")+"")&&ve(c,r),(I=F[1])!=null&&I.description?L?L.p(F,Z):(L=Lo(F),L.c(),L.m(n,d)):L&&(L.d(1),L=null),(!N||Z[0]&2)&&w!==(w=(((z=F[1])==null?void 0:z.rank)||0)+"")&&ve(v,w),(W=F[1])!=null&&W.tags?Q?Q.p(F,Z):(Q=Eo(F),Q.c(),Q.m(p,null)):Q&&(Q.d(1),Q=null),K===(K=V(F))&&A?A.p(F,Z):(A.d(1),A=K(F),A&&(A.c(),A.m($,null))),F[10].length>0?E?(E.p(F,Z),Z[0]&1024&&J(E,1)):(E=No(F),E.c(),J(E,1),E.m(O.parentNode,O)):E&&(qe(),Y(E,1,1,()=>{E=null}),Be())},i(F){N||(J(E),N=!0)},o(F){Y(E),N=!1},d(F){F&&T(e),L&&L.d(),Q&&Q.d(),F&&T(y),F&&T(S),A.d(),F&&T(q),E&&E.d(F),F&&T(O)}}}function Lo(l){let e,t=l[1].description+"",o;return{c(){e=f("p"),o=U(t),a(e,"class","content")},m(n,u){R(n,e,u),s(e,o)},p(n,u){u[0]&2&&t!==(t=n[1].description+"")&&ve(o,t)},d(n){n&&T(e)}}}function Eo(l){let e,t=l[1].tags,o=[];for(let n=0;n<t.length;n+=1)o[n]=Po(So(l,t,n));return{c(){for(let n=0;n<o.length;n+=1)o[n].c();e=ot()},m(n,u){for(let r=0;r<o.length;r+=1)o[r]&&o[r].m(n,u);R(n,e,u)},p(n,u){if(u[0]&2){t=n[1].tags;let r;for(r=0;r<t.length;r+=1){const c=So(n,t,r);o[r]?o[r].p(c,u):(o[r]=Po(c),o[r].c(),o[r].m(e.parentNode,e))}for(;r<o.length;r+=1)o[r].d(1);o.length=t.length}},d(n){Ve(o,n),n&&T(e)}}}function Po(l){let e,t=l[39]+"",o;return{c(){e=f("span"),o=U(t),a(e,"class","tag svelte-48g63o")},m(n,u){R(n,e,u),s(e,o)},p(n,u){u[0]&2&&t!==(t=n[39]+"")&&ve(o,t)},d(n){n&&T(e)}}}function Mr(l){let e,t,o,n,u,r,c,i,d;return{c(){e=f("div"),t=f("p"),t.innerHTML="<strong>No atomic servers available</strong>",o=g(),n=f("p"),u=U('Your current role "'),r=U(l[12]),c=U(`" doesn't have any writable atomic server configurations.`),i=g(),d=f("p"),d.textContent="Please configure an atomic server haystack in your role settings.",a(e,"class","notification is-warning")},m(p,_){R(p,e,_),s(e,t),s(e,o),s(e,n),s(n,u),s(n,r),s(n,c),s(e,i),s(e,d)},p(p,_){_[0]&4096&&ve(r,p[12])},d(p){p&&T(e)}}}function jr(l){let e,t,o,n,u,r,c=l[10],i=[];for(let d=0;d<c.length;d+=1)i[d]=Oo(Co(l,c,d));return{c(){e=f("div"),t=f("select");for(let d=0;d<i.length;d+=1)i[d].c();o=g(),n=f("p"),n.textContent=`Select the atomic server from your current role configuration.
              🔐 = Authenticated, ⚠️ = Anonymous access`,a(t,"id","atomic-server-select"),t.disabled=l[2],l[11]===void 0&&ut(()=>l[18].call(t)),a(e,"class","select is-fullwidth"),a(n,"class","help svelte-48g63o")},m(d,p){R(d,e,p),s(e,t);for(let _=0;_<i.length;_+=1)i[_]&&i[_].m(t,null);He(t,l[11],!0),R(d,o,p),R(d,n,p),u||(r=ee(t,"change",l[18]),u=!0)},p(d,p){if(p[0]&1024){c=d[10];let _;for(_=0;_<c.length;_+=1){const m=Co(d,c,_);i[_]?i[_].p(m,p):(i[_]=Oo(m),i[_].c(),i[_].m(t,null))}for(;_<i.length;_+=1)i[_].d(1);i.length=c.length}p[0]&4&&(t.disabled=d[2]),p[0]&3072&&He(t,d[11])},d(d){d&&T(e),Ve(i,d),d&&T(o),d&&T(n),u=!1,r()}}}function Hr(l){let e;return{c(){e=f("span"),e.textContent="⚠️ No Auth",a(e,"class","has-text-warning")},m(t,o){R(t,e,o)},d(t){t&&T(e)}}}function zr(l){let e;return{c(){e=f("span"),e.textContent="🔐",a(e,"class","has-text-success")},m(t,o){R(t,e,o)},d(t){t&&T(e)}}}function Oo(l){let e,t=l[36].location+"",o,n,u,r;function c(p,_){return p[36].atomic_server_secret?zr:Hr}let i=c(l),d=i(l);return{c(){e=f("option"),o=U(t),n=g(),d.c(),u=g(),e.__value=r=l[36].location,e.value=e.__value},m(p,_){R(p,e,_),s(e,o),s(e,n),d.m(e,null),s(e,u)},p(p,_){_[0]&1024&&t!==(t=p[36].location+"")&&ve(o,t),i!==(i=c(p))&&(d.d(1),d=i(p),d&&(d.c(),d.m(e,u))),_[0]&1024&&r!==(r=p[36].location)&&(e.__value=r,e.value=e.__value)},d(p){p&&T(e),d.d()}}}function No(l){var M,le;let e,t,o,n,u,r,c,i,d,p,_,m,w,v,k,y,S,b,h,$,q,O,N,L,Q,V,K,A,E,G,C,H,B,F,Z,P,I,z,W,X,D,oe,ge,we=(l[8]||"Untitled")+"",he,fe,se,ce,ke,Ce=(((le=(M=l[1])==null?void 0:M.body)==null?void 0:le.length)||0)+"",te,ie,ae,ue,Ee,We,Ke=l[14]()+"",Pe,Re,x,ne,Se,Ae=l[15]()+"",et,Ne,ft,nt,vt;function Ye(j){l[19](j)}let st={id:"article-title",placeholder:"Enter article title",disabled:l[2],required:!0};l[8]!==void 0&&(st.value=l[8]),u=new Jt({props:st}),xe.push(()=>tt(u,"value",Ye));const dt=[Wr,Fr],Ie=[];function Rt(j,re){return j[7]?1:0}return V=Rt(l),K=Ie[V]=dt[V](l),C=new El({props:{type:"is-primary",loading:l[2],disabled:l[2]||!l[8].trim()||!l[11],$$slots:{default:[Kr]},$$scope:{ctx:l}}}),C.$on("click",l[16]),F=new El({props:{type:"is-light",disabled:l[2],$$slots:{default:[Gr]},$$scope:{ctx:l}}}),F.$on("click",l[17]),ft=Xn(l[22][0]),{c(){e=f("div"),t=f("label"),t.textContent="Article Title",o=g(),n=f("div"),pe(u.$$.fragment),c=g(),i=f("div"),d=f("label"),d.textContent="Description",p=g(),_=f("div"),m=f("textarea"),w=g(),v=f("div"),k=f("label"),k.textContent="Parent Collection",y=g(),S=f("div"),b=f("label"),h=f("input"),$=U(`
              Use predefined collection`),q=g(),O=f("label"),N=f("input"),L=U(`
              Custom parent URL/path`),Q=g(),K.c(),A=g(),E=f("div"),G=f("div"),pe(C.$$.fragment),H=g(),B=f("div"),pe(F.$$.fragment),Z=g(),P=f("div"),I=f("div"),z=f("p"),z.innerHTML="<strong>What will be saved:</strong>",W=g(),X=f("ul"),D=f("li"),oe=f("strong"),oe.textContent="Title:",ge=g(),he=U(we),fe=g(),se=f("li"),ce=f("strong"),ce.textContent="Body:",ke=U(" Original document content ("),te=U(Ce),ie=U(" characters)"),ae=g(),ue=f("li"),Ee=f("strong"),Ee.textContent="Parent:",We=g(),Pe=U(Ke),Re=g(),x=f("li"),ne=f("strong"),ne.textContent="Subject URL:",Se=g(),et=U(Ae),a(t,"class","label"),a(t,"for","article-title"),a(n,"class","control"),a(e,"class","field"),a(d,"class","label"),a(d,"for","article-description"),a(m,"id","article-description"),a(m,"class","textarea"),a(m,"placeholder","Brief description of the article"),m.disabled=l[2],a(m,"rows","3"),a(_,"class","control"),a(i,"class","field"),a(k,"class","label"),a(h,"type","radio"),h.__value=!1,h.value=h.__value,h.disabled=l[2],a(b,"class","radio svelte-48g63o"),a(N,"type","radio"),N.__value=!0,N.value=N.__value,N.disabled=l[2],a(O,"class","radio svelte-48g63o"),a(S,"class","control"),a(v,"class","field"),a(G,"class","control"),a(B,"class","control"),a(E,"class","field is-grouped"),a(D,"class","svelte-48g63o"),a(se,"class","svelte-48g63o"),a(ue,"class","svelte-48g63o"),a(x,"class","svelte-48g63o"),a(X,"class","svelte-48g63o"),a(I,"class","notification is-info is-light svelte-48g63o"),a(P,"class","field"),ft.p(h,N)},m(j,re){R(j,e,re),s(e,t),s(e,o),s(e,n),_e(u,n,null),R(j,c,re),R(j,i,re),s(i,d),s(i,p),s(i,_),s(_,m),Ue(m,l[9]),R(j,w,re),R(j,v,re),s(v,k),s(v,y),s(v,S),s(S,b),s(b,h),h.checked=h.__value===l[7],s(b,$),s(S,q),s(S,O),s(O,N),N.checked=N.__value===l[7],s(O,L),R(j,Q,re),Ie[V].m(j,re),R(j,A,re),R(j,E,re),s(E,G),_e(C,G,null),s(E,H),s(E,B),_e(F,B,null),R(j,Z,re),R(j,P,re),s(P,I),s(I,z),s(I,W),s(I,X),s(X,D),s(D,oe),s(D,ge),s(D,he),s(X,fe),s(X,se),s(se,ce),s(se,ke),s(se,te),s(se,ie),s(X,ae),s(X,ue),s(ue,Ee),s(ue,We),s(ue,Pe),s(X,Re),s(X,x),s(x,ne),s(x,Se),s(x,et),Ne=!0,nt||(vt=[ee(m,"input",l[20]),ee(h,"change",l[21]),ee(N,"change",l[23])],nt=!0)},p(j,re){var De,Ge;const ye={};re[0]&4&&(ye.disabled=j[2]),!r&&re[0]&256&&(r=!0,ye.value=j[8],lt(()=>r=!1)),u.$set(ye),(!Ne||re[0]&4)&&(m.disabled=j[2]),re[0]&512&&Ue(m,j[9]),(!Ne||re[0]&4)&&(h.disabled=j[2]),re[0]&128&&(h.checked=h.__value===j[7]),(!Ne||re[0]&4)&&(N.disabled=j[2]),re[0]&128&&(N.checked=N.__value===j[7]);let be=V;V=Rt(j),V===be?Ie[V].p(j,re):(qe(),Y(Ie[be],1,1,()=>{Ie[be]=null}),Be(),K=Ie[V],K?K.p(j,re):(K=Ie[V]=dt[V](j),K.c()),J(K,1),K.m(A.parentNode,A));const Fe={};re[0]&4&&(Fe.loading=j[2]),re[0]&2308&&(Fe.disabled=j[2]||!j[8].trim()||!j[11]),re[1]&2048&&(Fe.$$scope={dirty:re,ctx:j}),C.$set(Fe);const Je={};re[0]&4&&(Je.disabled=j[2]),re[1]&2048&&(Je.$$scope={dirty:re,ctx:j}),F.$set(Je),(!Ne||re[0]&256)&&we!==(we=(j[8]||"Untitled")+"")&&ve(he,we),(!Ne||re[0]&2)&&Ce!==(Ce=(((Ge=(De=j[1])==null?void 0:De.body)==null?void 0:Ge.length)||0)+"")&&ve(te,Ce)},i(j){Ne||(J(u.$$.fragment,j),J(K),J(C.$$.fragment,j),J(F.$$.fragment,j),Ne=!0)},o(j){Y(u.$$.fragment,j),Y(K),Y(C.$$.fragment,j),Y(F.$$.fragment,j),Ne=!1},d(j){j&&T(e),me(u),j&&T(c),j&&T(i),j&&T(w),j&&T(v),j&&T(Q),Ie[V].d(j),j&&T(A),j&&T(E),me(C),me(F),j&&T(Z),j&&T(P),ft.r(),nt=!1,Qe(vt)}}}function Fr(l){let e,t,o,n,u,r,c;function i(p){l[25](p)}let d={placeholder:"e.g., my-collection or http://server/custom-parent",disabled:l[2]};return l[6]!==void 0&&(d.value=l[6]),o=new Jt({props:d}),xe.push(()=>tt(o,"value",i)),{c(){e=f("div"),t=f("div"),pe(o.$$.fragment),u=g(),r=f("p"),r.textContent=`Enter a collection name (e.g., "my-articles") or full URL.
              If the collection doesn't exist, it will be created.`,a(t,"class","control"),a(r,"class","help svelte-48g63o"),a(e,"class","field")},m(p,_){R(p,e,_),s(e,t),_e(o,t,null),s(e,u),s(e,r),c=!0},p(p,_){const m={};_[0]&4&&(m.disabled=p[2]),!n&&_[0]&64&&(n=!0,m.value=p[6],lt(()=>n=!1)),o.$set(m)},i(p){c||(J(o.$$.fragment,p),c=!0)},o(p){Y(o.$$.fragment,p),c=!1},d(p){p&&T(e),me(o)}}}function Wr(l){let e,t,o,n,u,r,c=l[13],i=[];for(let d=0;d<c.length;d+=1)i[d]=Uo($o(l,c,d));return{c(){e=f("div"),t=f("div"),o=f("div"),n=f("select");for(let d=0;d<i.length;d+=1)i[d].c();n.disabled=l[2],l[5]===void 0&&ut(()=>l[24].call(n)),a(o,"class","select is-fullwidth"),a(t,"class","control"),a(e,"class","field")},m(d,p){R(d,e,p),s(e,t),s(t,o),s(o,n);for(let _=0;_<i.length;_+=1)i[_]&&i[_].m(n,null);He(n,l[5],!0),u||(r=ee(n,"change",l[24]),u=!0)},p(d,p){if(p[0]&8192){c=d[13];let _;for(_=0;_<c.length;_+=1){const m=$o(d,c,_);i[_]?i[_].p(m,p):(i[_]=Uo(m),i[_].c(),i[_].m(n,null))}for(;_<i.length;_+=1)i[_].d(1);i.length=c.length}p[0]&4&&(n.disabled=d[2]),p[0]&8224&&He(n,d[5])},i:Te,o:Te,d(d){d&&T(e),Ve(i,d),u=!1,r()}}}function Uo(l){let e,t=l[33].label+"",o;return{c(){e=f("option"),o=U(t),e.__value=l[33].value,e.value=e.__value},m(n,u){R(n,e,u),s(e,o)},p:Te,d(n){n&&T(e)}}}function Kr(l){let e,t,o;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-cloud-upload-alt"></i>',t=g(),o=f("span"),o.textContent="Save to Atomic Server",a(e,"class","icon")},m(n,u){R(n,e,u),R(n,t,u),R(n,o,u)},p:Te,d(n){n&&T(e),n&&T(t),n&&T(o)}}}function Gr(l){let e;return{c(){e=U("Cancel")},m(t,o){R(t,e,o)},d(t){t&&T(e)}}}function qr(l){let e,t,o,n,u,r,c,i,d,p,_,m,w,v=l[4]&&To(l),k=l[3]&&Ro(l),y=!l[4]&&Ao(l);return{c(){e=f("div"),t=f("div"),o=f("div"),o.innerHTML=`<div class="level-item"><h3 class="title is-4"><span class="icon"><i class="fas fa-save"></i></span>
            Save to Atomic Server</h3></div>`,n=g(),u=f("div"),r=f("div"),c=f("button"),i=g(),v&&v.c(),d=g(),k&&k.c(),p=g(),y&&y.c(),a(o,"class","level-left"),a(c,"class","delete is-large"),c.disabled=l[2],a(c,"aria-label","close"),a(r,"class","level-item"),a(u,"class","level-right"),a(t,"class","level svelte-48g63o"),a(e,"class","box")},m(S,b){R(S,e,b),s(e,t),s(t,o),s(t,n),s(t,u),s(u,r),s(r,c),s(e,i),v&&v.m(e,null),s(e,d),k&&k.m(e,null),s(e,p),y&&y.m(e,null),_=!0,m||(w=ee(c,"click",l[17]),m=!0)},p(S,b){(!_||b[0]&4)&&(c.disabled=S[2]),S[4]?v?b[0]&16&&J(v,1):(v=To(S),v.c(),J(v,1),v.m(e,d)):v&&(qe(),Y(v,1,1,()=>{v=null}),Be()),S[3]?k?(k.p(S,b),b[0]&8&&J(k,1)):(k=Ro(S),k.c(),J(k,1),k.m(e,p)):k&&(qe(),Y(k,1,1,()=>{k=null}),Be()),S[4]?y&&(qe(),Y(y,1,1,()=>{y=null}),Be()):y?(y.p(S,b),b[0]&16&&J(y,1)):(y=Ao(S),y.c(),J(y,1),y.m(e,null))},i(S){_||(J(v),J(k),J(y),_=!0)},o(S){Y(v),Y(k),Y(y),_=!1},d(S){S&&T(e),v&&v.d(),k&&k.d(),y&&y.d(),m=!1,w()}}}function Br(l){let e,t,o;function n(r){l[26](r)}let u={$$slots:{default:[qr]},$$scope:{ctx:l}};return l[0]!==void 0&&(u.active=l[0]),e=new Ml({props:u}),xe.push(()=>tt(e,"active",n)),e.$on("close",l[17]),{c(){pe(e.$$.fragment)},m(r,c){_e(e,r,c),o=!0},p(r,c){const i={};c[0]&8190|c[1]&2048&&(i.$$scope={dirty:c,ctx:r}),!t&&c[0]&1&&(t=!0,i.active=r[0],lt(()=>t=!1)),e.$set(i)},i(r){o||(J(e.$$.fragment,r),o=!0)},o(r){Y(e.$$.fragment,r),o=!1},d(r){me(e,r)}}}function Jr(l,e,t){let o,n,u;Oe(l,ze,P=>t(27,o=P)),Oe(l,Tt,P=>t(28,n=P)),Oe(l,St,P=>t(12,u=P));let{active:r=!1}=e,{document:c}=e,i=!1,d=null,p=!1,_="",m="",w=!1,v="",k="",y=[],S="";const b=[{label:"Root (Server Root)",value:""},{label:"Articles Collection",value:"articles"},{label:"Documents Collection",value:"documents"},{label:"Knowledge Base",value:"knowledge-base"},{label:"Research",value:"research"},{label:"Projects",value:"projects"}];function h(){t(2,i=!1),t(3,d=null),t(4,p=!1),t(5,_=""),t(6,m=""),t(7,w=!1),t(8,v=(c==null?void 0:c.title)||""),t(9,k=(c==null?void 0:c.description)||`Article saved from Terraphim search: ${c==null?void 0:c.title}`),t(10,y=[]),t(11,S="")}function $(){var W;const P=u,I=n;if(!(I!=null&&I.roles)||!P){console.warn("No role configuration found");return}let z=null;try{for(const[X,D]of Object.entries(I.roles)){const oe=D,ge=typeof oe.name=="object"?oe.name.original:String(oe.name);if(X===P||ge===P){z=oe;break}}}catch(X){console.warn("Error checking role configuration:",X);return}if(!z){console.warn(`Role "${P}" not found in configuration`);return}t(10,y=((W=z.haystacks)==null?void 0:W.filter(X=>X.service==="Atomic"&&X.location&&!X.read_only))||[]),y.length>0&&t(11,S=y[0].location),console.log("Loaded atomic servers:",y)}function q(){const P=y.find(I=>I.location===S);return P==null?void 0:P.atomic_server_secret}function O(){const P=S.replace(/\/$/,"");if(w&&m.trim()){const I=m.trim();return I.startsWith("http://")||I.startsWith("https://")?I:`${P}/${I.replace(/^\//,"")}`}else return _?`${P}/${_}`:P}function N(){return v.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,50)}function L(){const P=S.replace(/\/$/,""),I=N(),z=Date.now();return`${P}/${I}-${z}`}async function Q(){if(!S||!v.trim()){t(3,d="Please select an atomic server and provide a title");return}t(2,i=!0),t(3,d=null);try{const P=L(),I=O(),z=q();console.log("🔄 Saving article to atomic server:",{subject:P,parent:I,server:S,hasSecret:!!z});const W={subject:P,title:v.trim(),description:k.trim(),body:c.body,parent:I,shortname:N(),original_id:c.id,original_url:c.url,original_rank:c.rank,tags:c.tags||[]};if(o)await Me("save_article_to_atomic",{article:W,serverUrl:S,atomicSecret:z});else{const X=await fetch(`${Xe.ServerURL}/atomic/save`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({article:W,server_url:S,atomic_secret:z})});if(!X.ok){const D=await X.json().catch(()=>({error:X.statusText}));throw new Error(D.error||`HTTP ${X.status}: ${X.statusText}`)}}t(4,p=!0),console.log("✅ Article saved successfully to atomic server"),setTimeout(()=>{t(0,r=!1)},2e3)}catch(P){console.error("❌ Failed to save article to atomic server:",P),t(3,d=P.message||"Failed to save article to atomic server")}finally{t(2,i=!1)}}function V(){i||t(0,r=!1)}const K=[[]];function A(){S=At(this),t(11,S),t(10,y)}function E(P){v=P,t(8,v)}function G(){k=this.value,t(9,k)}function C(){w=this.__value,t(7,w)}function H(){w=this.__value,t(7,w)}function B(){_=At(this),t(5,_),t(13,b)}function F(P){m=P,t(6,m)}function Z(P){r=P,t(0,r)}return l.$$set=P=>{"active"in P&&t(0,r=P.active),"document"in P&&t(1,c=P.document)},l.$$.update=()=>{l.$$.dirty[0]&3&&r&&c&&(h(),$())},[r,c,i,d,p,_,m,w,v,k,y,S,u,b,O,L,Q,V,A,E,G,C,K,H,B,F,Z]}class Vr extends ht{constructor(e){super(),gt(this,e,Jr,Br,ct,{active:0,document:1},null,[-1,-1])}}async function zl(l){return Me("tauri",l)}async function Qr(l,e){return zl({__tauriModule:"Event",message:{cmd:"unlisten",event:l,eventId:e}})}async function Yr(l,e,t){return zl({__tauriModule:"Event",message:{cmd:"listen",event:l,windowLabel:e,handler:Il(t)}}).then(o=>async()=>Qr(l,o))}var Io;(function(l){l.WINDOW_RESIZED="tauri://resize",l.WINDOW_MOVED="tauri://move",l.WINDOW_CLOSE_REQUESTED="tauri://close-requested",l.WINDOW_CREATED="tauri://window-created",l.WINDOW_DESTROYED="tauri://destroyed",l.WINDOW_FOCUS="tauri://focus",l.WINDOW_BLUR="tauri://blur",l.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",l.WINDOW_THEME_CHANGED="tauri://theme-changed",l.WINDOW_FILE_DROP="tauri://file-drop",l.WINDOW_FILE_DROP_HOVER="tauri://file-drop-hover",l.WINDOW_FILE_DROP_CANCELLED="tauri://file-drop-cancelled",l.MENU="tauri://menu",l.CHECK_UPDATE="tauri://update",l.UPDATE_AVAILABLE="tauri://update-available",l.INSTALL_UPDATE="tauri://update-install",l.STATUS_UPDATE="tauri://update-status",l.DOWNLOAD_PROGRESS="tauri://update-download-progress"})(Io||(Io={}));async function Zr(l,e){return Yr(l,null,e)}function Do(l,e,t){const o=l.slice();return o[9]=e[t],o}function Mo(l){let e,t=l[9].name+"",o,n;return{c(){e=f("option"),o=U(t),e.__value=n=l[9].name,e.value=e.__value},m(u,r){R(u,e,r),s(e,o)},p(u,r){r&1&&t!==(t=u[9].name+"")&&ve(o,t),r&1&&n!==(n=u[9].name)&&(e.__value=n,e.value=e.__value)},d(u){u&&T(e)}}}function Xr(l){let e,t,o,n,u,r,c=l[0],i=[];for(let d=0;d<c.length;d+=1)i[d]=Mo(Do(l,c,d));return{c(){e=f("div"),t=f("div"),o=f("div"),n=f("select");for(let d=0;d<i.length;d+=1)i[d].c();a(o,"class","select"),a(t,"class","control"),a(e,"class","field is-grouped is-grouped-right")},m(d,p){R(d,e,p),s(e,t),s(t,o),s(o,n);for(let _=0;_<i.length;_+=1)i[_]&&i[_].m(n,null);He(n,l[1]),u||(r=ee(n,"change",l[2]),u=!0)},p(d,[p]){if(p&1){c=d[0];let _;for(_=0;_<c.length;_+=1){const m=Do(d,c,_);i[_]?i[_].p(m,p):(i[_]=Mo(m),i[_].c(),i[_].m(n,null))}for(;_<i.length;_+=1)i[_].d(1);i.length=c.length}p&3&&He(n,d[1])},i:Te,o:Te,d(d){d&&T(e),Ve(i,d),u=!1,r()}}}function xr(l,e,t){let o,n,u,r;Oe(l,Tt,m=>t(5,o=m)),Oe(l,ze,m=>t(6,n=m)),Oe(l,fo,m=>t(0,u=m)),Oe(l,St,m=>t(1,r=m));let c="";async function i(){try{ze.set(window.__TAURI__!==void 0),n?(console.log("Loading config from Tauri"),Me("get_config").then(m=>{console.log("get_config response",m),m&&m.status==="success"&&d(m.config)}).catch(m=>console.error("Error fetching config in Tauri:",m))):(console.log("Loading config from server"),c=`${Xe.ServerURL}/config/`,fetch(c).then(m=>m.json()).then(m=>{console.log("Config received",m),m&&m.status==="success"&&d(m.config)}).catch(m=>console.error("Error fetching config:",m)))}catch(m){console.error("Unhandled error in loadConfig:",m)}}function d(m){var y;console.log("Updating stores from config:",m);const w={default_role:m.selected_role,...m};Tt.set(w);const v=Object.entries(m.roles).map(([S,b])=>({name:S,...b}));fo.set(v),St.set(m.selected_role);const k=m.roles[m.selected_role];if(console.log("Selected role settings:",k),k){const S=k.theme||"spacelab";console.log("Setting theme to:",S),pl.set(S),(y=k.kg)!=null&&y.publish?n?Me("publish_thesaurus",{roleName:m.selected_role}).then(b=>{console.log("publish_thesaurus response",b),fl.set(b),Ct.set(!0)}):(console.log("Fetching thesaurus from HTTP endpoint for role",m.selected_role),fetch(`${Xe.ServerURL}/thesaurus/${encodeURIComponent(m.selected_role)}`).then(b=>b.json()).then(b=>{console.log("thesaurus HTTP response",b),b&&b.status==="success"&&b.thesaurus?(fl.set(b.thesaurus),Ct.set(!0)):(console.error("Failed to fetch thesaurus:",b),Ct.set(!1))}).catch(b=>{console.error("Error fetching thesaurus:",b),Ct.set(!1)})):Ct.set(!1)}else console.warn("No role settings found for:",m.selected_role),pl.set("spacelab")}typeof window<"u"&&window.__TAURI__&&Zr("role_changed",m=>{console.log("Role changed event received from backend:",m.payload),d(m.payload)});async function p(){await i()}p(),console.log("Using Terraphim Server URL:",Xe.ServerURL);function _(m){var S,b;const v=m.currentTarget.value;console.log("Role change requested:",v),St.set(v);const k=u.find(h=>h.name===v);if(!k){console.error(`No role settings found for role: ${v}.`);return}const y=k.theme||"spacelab";pl.set(y),console.log(`Theme changed to ${y}`),Tt.update(h=>(h.selected_role=v,h)),n?(Me("select_role",{roleName:v}).catch(h=>console.error("Error selecting role:",h)),(S=k.kg)!=null&&S.publish?(console.log("Publishing thesaurus for role",v),Me("publish_thesaurus",{roleName:v}).then(h=>{fl.set(h),Ct.set(!0)})):Ct.set(!1)):(fetch(`${Xe.ServerURL}/config/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).catch(h=>console.error("Error updating config on server:",h)),(b=k.kg)!=null&&b.publish?(console.log("Fetching thesaurus from HTTP endpoint for role",v),fetch(`${Xe.ServerURL}/thesaurus/${encodeURIComponent(v)}`).then(h=>h.json()).then(h=>{console.log("thesaurus HTTP response",h),h&&h.status==="success"&&h.thesaurus?(fl.set(h.thesaurus),Ct.set(!0)):(console.error("Failed to fetch thesaurus:",h),Ct.set(!1))}).catch(h=>{console.error("Error fetching thesaurus:",h),Ct.set(!1)})):Ct.set(!1))}return[u,r,_,i]}class Ll extends ht{constructor(e){super(),gt(this,e,xr,Xr,ct,{loadConfig:3})}get loadConfig(){return this.$$.ctx[3]}}function jo(l,e,t){const o=l.slice();return o[38]=e[t],o}function Ho(l,e,t){const o=l.slice();return o[41]=e[t],o}function zo(l){let e,t;return e=new xn({props:{$$slots:{default:[ti]},$$scope:{ctx:l}}}),{c(){pe(e.$$.fragment)},m(o,n){_e(e,o,n),t=!0},p(o,n){const u={};n[0]&129|n[1]&8192&&(u.$$scope={dirty:n,ctx:o}),e.$set(u)},i(o){t||(J(e.$$.fragment,o),t=!0)},o(o){Y(e.$$.fragment,o),t=!1},d(o){me(e,o)}}}function ei(l){let e=l[41]+"",t;return{c(){t=U(e)},m(o,n){R(o,t,n)},p(o,n){n[0]&1&&e!==(e=o[41]+"")&&ve(t,e)},d(o){o&&T(t)}}}function Fo(l){let e,t,o,n,u,r;t=new es({props:{rounded:!0,$$slots:{default:[ei]},$$scope:{ctx:l}}});function c(){return l[19](l[41])}return{c(){e=f("button"),pe(t.$$.fragment),o=g(),a(e,"class","tag-button svelte-2smypa"),e.disabled=l[7],a(e,"title","Click to view knowledge graph document")},m(i,d){R(i,e,d),_e(t,e,null),s(e,o),n=!0,u||(r=ee(e,"click",c),u=!0)},p(i,d){l=i;const p={};d[0]&1|d[1]&8192&&(p.$$scope={dirty:d,ctx:l}),t.$set(p),(!n||d[0]&128)&&(e.disabled=l[7])},i(i){n||(J(t.$$.fragment,i),n=!0)},o(i){Y(t.$$.fragment,i),n=!1},d(i){i&&T(e),me(t),u=!1,r()}}}function ti(l){let e,t,o=l[0].tags,n=[];for(let r=0;r<o.length;r+=1)n[r]=Fo(Ho(l,o,r));const u=r=>Y(n[r],1,1,()=>{n[r]=null});return{c(){for(let r=0;r<n.length;r+=1)n[r].c();e=ot()},m(r,c){for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(r,c);R(r,e,c),t=!0},p(r,c){if(c[0]&131201){o=r[0].tags;let i;for(i=0;i<o.length;i+=1){const d=Ho(r,o,i);n[i]?(n[i].p(d,c),J(n[i],1)):(n[i]=Fo(d),n[i].c(),J(n[i],1),n[i].m(e.parentNode,e))}for(qe(),i=o.length;i<n.length;i+=1)u(i);Be()}},i(r){if(!t){for(let c=0;c<o.length;c+=1)J(n[c]);t=!0}},o(r){n=n.filter(Boolean);for(let c=0;c<n.length;c+=1)Y(n[c]);t=!1},d(r){Ve(n,r),r&&T(e)}}}function li(l){let e,t=(l[0].rank||0)+"",o;return{c(){e=U("Rank "),o=U(t)},m(n,u){R(n,e,u),R(n,o,u)},p(n,u){u[0]&1&&t!==(t=(n[0].rank||0)+"")&&ve(o,t)},d(n){n&&T(e),n&&T(o)}}}function oi(l){let e,t;return e=new es({props:{rounded:!0,$$slots:{default:[li]},$$scope:{ctx:l}}}),{c(){pe(e.$$.fragment)},m(o,n){_e(e,o,n),t=!0},p(o,n){const u={};n[0]&1|n[1]&8192&&(u.$$scope={dirty:n,ctx:o}),e.$set(u)},i(o){t||(J(e.$$.fragment,o),t=!0)},o(o){Y(e.$$.fragment,o),t=!1},d(o){me(e,o)}}}function ni(l){let e;return{c(){e=f("small"),e.textContent="No description available",a(e,"class","no-description svelte-2smypa")},m(t,o){R(t,e,o)},p:Te,i:Te,o:Te,d(t){t&&T(e)}}}function si(l){let e,t;return e=new Ol({props:{source:l[0].description}}),{c(){pe(e.$$.fragment)},m(o,n){_e(e,o,n),t=!0},p(o,n){const u={};n[0]&1&&(u.source=o[0].description),e.$set(u)},i(o){t||(J(e.$$.fragment,o),t=!0)},o(o){Y(e.$$.fragment,o),t=!1},d(o){me(e,o)}}}function Wo(l){let e,t,o,n,u,r;return{c(){e=f("button"),t=f("span"),t.innerHTML='<i class="fas fa-magic" aria-hidden="true"></i>',o=g(),n=f("span"),n.textContent="AI Summary",a(t,"class","icon is-small"),a(e,"class","button is-small is-info is-outlined ai-summary-button svelte-2smypa"),e.disabled=l[9],a(e,"title","Generate AI-powered summary using OpenRouter")},m(c,i){R(c,e,i),s(e,t),s(e,o),s(e,n),u||(r=ee(e,"click",l[18]),u=!0)},p(c,i){i[0]&512&&(e.disabled=c[9])},d(c){c&&T(e),u=!1,r()}}}function Ko(l){let e;return{c(){e=f("div"),e.innerHTML=`<span class="icon"><i class="fas fa-spinner fa-spin" aria-hidden="true"></i></span>
                <small>Generating AI summary...</small>`,a(e,"class","ai-summary-loading svelte-2smypa")},m(t,o){R(t,e,o)},d(t){t&&T(e)}}}function Go(l){let e,t,o,n,u,r,c,i,d,p;return{c(){e=f("div"),t=f("span"),t.innerHTML='<i class="fas fa-exclamation-triangle" aria-hidden="true"></i>',o=g(),n=f("small"),u=U("Summary error: "),r=U(l[10]),c=g(),i=f("button"),i.textContent="Retry",a(t,"class","icon has-text-danger"),a(n,"class","has-text-danger"),a(i,"class","button is-small is-text svelte-2smypa"),a(i,"title","Retry generating summary"),a(e,"class","ai-summary-error svelte-2smypa")},m(_,m){R(_,e,m),s(e,t),s(e,o),s(e,n),s(n,u),s(n,r),s(e,c),s(e,i),d||(p=ee(i,"click",l[20]),d=!0)},p(_,m){m[0]&1024&&ve(r,_[10])},d(_){_&&T(e),d=!1,p()}}}function qo(l){let e,t,o,n,u,r,c,i,d,p,_,m,w,v,k,y,S,b,h,$;function q(L,Q){return L[12]?ii:ri}let O=q(l),N=O(l);return p=new Ol({props:{source:l[8]}}),{c(){e=f("div"),t=f("div"),o=f("small"),n=f("span"),n.innerHTML='<i class="fas fa-robot" aria-hidden="true"></i>',u=U(`
                    AI Summary
                    `),N.c(),r=g(),c=f("button"),c.innerHTML='<span class="icon is-small"><i class="fas fa-times" aria-hidden="true"></i></span>',i=g(),d=f("div"),pe(p.$$.fragment),_=g(),m=f("div"),w=f("button"),v=f("span"),v.innerHTML='<i class="fas fa-redo" aria-hidden="true"></i>',k=g(),y=f("span"),y.textContent="Regenerate",a(n,"class","icon is-small"),a(o,"class","ai-summary-label svelte-2smypa"),a(c,"class","button is-small is-text svelte-2smypa"),a(c,"title","Hide AI summary"),a(t,"class","ai-summary-header svelte-2smypa"),a(d,"class","ai-summary-content svelte-2smypa"),a(v,"class","icon is-small"),a(w,"class","button is-small is-text svelte-2smypa"),w.disabled=l[9],a(w,"title","Regenerate summary"),a(m,"class","ai-summary-actions svelte-2smypa"),a(e,"class","ai-summary svelte-2smypa")},m(L,Q){R(L,e,Q),s(e,t),s(t,o),s(o,n),s(o,u),N.m(o,null),s(t,r),s(t,c),s(e,i),s(e,d),_e(p,d,null),s(e,_),s(e,m),s(m,w),s(w,v),s(w,k),s(w,y),b=!0,h||($=[ee(c,"click",l[21]),ee(w,"click",l[22])],h=!0)},p(L,Q){O!==(O=q(L))&&(N.d(1),N=O(L),N&&(N.c(),N.m(o,null)));const V={};Q[0]&256&&(V.source=L[8]),p.$set(V),(!b||Q[0]&512)&&(w.disabled=L[9])},i(L){b||(J(p.$$.fragment,L),ut(()=>{b&&(S||(S=nl(e,sl,{},!0)),S.run(1))}),b=!0)},o(L){Y(p.$$.fragment,L),S||(S=nl(e,sl,{},!1)),S.run(0),b=!1},d(L){L&&T(e),N.d(),me(p),L&&S&&S.end(),h=!1,Qe($)}}}function ri(l){let e;return{c(){e=f("span"),e.textContent="fresh",a(e,"class","tag is-small is-success")},m(t,o){R(t,e,o)},d(t){t&&T(e)}}}function ii(l){let e;return{c(){e=f("span"),e.textContent="cached",a(e,"class","tag is-small is-light")},m(t,o){R(t,e,o)},d(t){t&&T(e)}}}function Bo(l){let e;function t(u,r){return u[38].disabled?ci:u[38].isLink?ui:ai}let o=t(l),n=o(l);return{c(){n.c(),e=ot()},m(u,r){n.m(u,r),R(u,e,r)},p(u,r){o===(o=t(u))&&n?n.p(u,r):(n.d(1),n=o(u),n&&(n.c(),n.m(e.parentNode,e)))},d(u){n.d(u),u&&T(e)}}}function ai(l){let e,t,o,n,u,r,c,i,d;return{c(){e=f("button"),t=f("span"),o=f("i"),u=g(),a(o,"class",n=Nt(l[38].icon)+" svelte-2smypa"),a(t,"class","icon is-medium"),Ut(t,"has-text-primary",l[38].className),a(e,"type","button"),a(e,"class","level-item button is-ghost svelte-2smypa"),a(e,"aria-label",r=l[38].title),a(e,"title",c=l[38].title)},m(p,_){R(p,e,_),s(e,t),s(t,o),s(e,u),i||(d=ee(e,"click",function(){jl(l[38].action)&&l[38].action.apply(this,arguments)}),i=!0)},p(p,_){l=p,_[0]&32768&&n!==(n=Nt(l[38].icon)+" svelte-2smypa")&&a(o,"class",n),_[0]&32768&&Ut(t,"has-text-primary",l[38].className),_[0]&32768&&r!==(r=l[38].title)&&a(e,"aria-label",r),_[0]&32768&&c!==(c=l[38].title)&&a(e,"title",c)},d(p){p&&T(e),i=!1,d()}}}function ui(l){let e,t,o,n,u,r,c,i;return{c(){e=f("a"),t=f("span"),o=f("i"),u=g(),a(o,"class",n=Nt(l[38].icon)+" svelte-2smypa"),a(t,"class","icon is-medium"),Ut(t,"has-text-primary",l[38].className),a(e,"href",r=l[38].href),a(e,"target","_blank"),a(e,"class","level-item"),a(e,"aria-label",c=l[38].title),a(e,"title",i=l[38].title)},m(d,p){R(d,e,p),s(e,t),s(t,o),s(e,u)},p(d,p){p[0]&32768&&n!==(n=Nt(d[38].icon)+" svelte-2smypa")&&a(o,"class",n),p[0]&32768&&Ut(t,"has-text-primary",d[38].className),p[0]&32768&&r!==(r=d[38].href)&&a(e,"href",r),p[0]&32768&&c!==(c=d[38].title)&&a(e,"aria-label",c),p[0]&32768&&i!==(i=d[38].title)&&a(e,"title",i)},d(d){d&&T(e)}}}function ci(l){let e,t,o,n,u,r,c;return{c(){e=f("button"),t=f("span"),o=f("i"),u=g(),a(o,"class",n=Nt(l[38].icon)+" svelte-2smypa"),a(t,"class","icon is-medium"),Ut(t,"has-text-primary",l[38].className),a(e,"type","button"),a(e,"class","level-item button is-ghost svelte-2smypa"),a(e,"aria-label",r=l[38].title),a(e,"title",c=l[38].title),e.disabled=!0},m(i,d){R(i,e,d),s(e,t),s(t,o),s(e,u)},p(i,d){d[0]&32768&&n!==(n=Nt(i[38].icon)+" svelte-2smypa")&&a(o,"class",n),d[0]&32768&&Ut(t,"has-text-primary",i[38].className),d[0]&32768&&r!==(r=i[38].title)&&a(e,"aria-label",r),d[0]&32768&&c!==(c=i[38].title)&&a(e,"title",c)},d(i){i&&T(e)}}}function Jo(l){let e,t=l[38].visible&&Bo(l);return{c(){t&&t.c(),e=ot()},m(o,n){t&&t.m(o,n),R(o,e,n)},p(o,n){o[38].visible?t?t.p(o,n):(t=Bo(o),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(o){t&&t.d(o),o&&T(e)}}}function Vo(l){let e,t,o,n,u,r;return{c(){e=f("div"),t=f("button"),o=g(),n=U(l[13]),a(t,"class","delete svelte-2smypa"),a(e,"class","notification is-danger is-light mt-2")},m(c,i){R(c,e,i),s(e,t),s(e,o),s(e,n),u||(r=ee(t,"click",l[23]),u=!0)},p(c,i){i[0]&8192&&ve(n,c[13])},d(c){c&&T(e),u=!1,r()}}}function Qo(l){let e,t,o;function n(r){l[25](r)}let u={item:l[4],kgTerm:l[5],kgRank:l[6]};return l[2]!==void 0&&(u.active=l[2]),e=new Hl({props:u}),xe.push(()=>tt(e,"active",n)),{c(){pe(e.$$.fragment)},m(r,c){_e(e,r,c),o=!0},p(r,c){const i={};c[0]&16&&(i.item=r[4]),c[0]&32&&(i.kgTerm=r[5]),c[0]&64&&(i.kgRank=r[6]),!t&&c[0]&4&&(t=!0,i.active=r[2],lt(()=>t=!1)),e.$set(i)},i(r){o||(J(e.$$.fragment,r),o=!0)},o(r){Y(e.$$.fragment,r),o=!1},d(r){me(e,r)}}}function Yo(l){let e,t,o;function n(r){l[26](r)}let u={document:l[0]};return l[3]!==void 0&&(u.active=l[3]),e=new Vr({props:u}),xe.push(()=>tt(e,"active",n)),{c(){pe(e.$$.fragment)},m(r,c){_e(e,r,c),o=!0},p(r,c){const i={};c[0]&1&&(i.document=r[0]),!t&&c[0]&8&&(t=!0,i.active=r[3],lt(()=>t=!1)),e.$set(i)},i(r){o||(J(e.$$.fragment,r),o=!0)},o(r){Y(e.$$.fragment,r),o=!1},d(r){me(e,r)}}}function fi(l){let e,t,o,n,u,r,c,i,d,p,_,m,w=l[0].title+"",v,k,y,S,b,h,$,q,O,N,L,Q,V,K,A,E,G,C,H,B,F,Z,P,I,z,W,X,D,oe,ge,we,he=l[0].tags&&zo(l);i=new xn({props:{$$slots:{default:[oi]},$$scope:{ctx:l}}});const fe=[si,ni],se=[];function ce(x,ne){return x[0].description?0:1}$=ce(l),q=se[$]=fe[$](l);let ke=!l[11]&&!l[9]&&!l[10]&&Wo(l),Ce=l[9]&&Ko(),te=l[10]&&Go(l),ie=l[11]&&l[8]&&qo(l),ae=l[15],ue=[];for(let x=0;x<ae.length;x+=1)ue[x]=Jo(jo(l,ae,x));let Ee=l[13]&&Vo(l);function We(x){l[24](x)}let Ke={item:l[0]};l[1]!==void 0&&(Ke.active=l[1]),I=new Hl({props:Ke}),xe.push(()=>tt(I,"active",We));let Pe=l[4]&&Qo(l),Re=l[14]&&Yo(l);return{c(){e=f("div"),t=f("article"),o=f("div"),n=f("div"),u=f("div"),he&&he.c(),r=g(),c=f("div"),pe(i.$$.fragment),d=g(),p=f("div"),_=f("button"),m=f("h2"),v=U(w),k=g(),y=f("div"),S=f("small"),S.textContent="Description:",b=g(),h=f("div"),q.c(),O=g(),N=f("div"),ke&&ke.c(),L=g(),Ce&&Ce.c(),Q=g(),te&&te.c(),V=g(),ie&&ie.c(),K=g(),A=f("br"),G=g(),C=f("div"),H=f("nav"),B=f("div");for(let x=0;x<ue.length;x+=1)ue[x].c();Z=g(),Ee&&Ee.c(),P=g(),pe(I.$$.fragment),W=g(),Pe&&Pe.c(),X=g(),Re&&Re.c(),D=ot(),a(u,"class","level-right"),a(c,"class","level-right"),a(m,"class","title svelte-2smypa"),a(_,"class","svelte-2smypa"),a(S,"class","description-label svelte-2smypa"),a(h,"class","description-content svelte-2smypa"),a(y,"class","description svelte-2smypa"),a(N,"class","ai-summary-section svelte-2smypa"),a(n,"class","content"),a(B,"class","level-right"),a(H,"class","level is-mobile"),a(C,"class","level-right"),a(o,"class","media-content"),a(t,"class","media"),a(e,"class","box")},m(x,ne){R(x,e,ne),s(e,t),s(t,o),s(o,n),s(n,u),he&&he.m(u,null),s(n,r),s(n,c),_e(i,c,null),s(n,d),s(n,p),s(p,_),s(_,m),s(m,v),s(p,k),s(p,y),s(y,S),s(y,b),s(y,h),se[$].m(h,null),s(p,O),s(p,N),ke&&ke.m(N,null),s(N,L),Ce&&Ce.m(N,null),s(N,Q),te&&te.m(N,null),s(N,V),ie&&ie.m(N,null),s(p,K),s(p,A),s(o,G),s(o,C),s(C,H),s(H,B);for(let Se=0;Se<ue.length;Se+=1)ue[Se]&&ue[Se].m(B,null);s(e,Z),Ee&&Ee.m(e,null),R(x,P,ne),_e(I,x,ne),R(x,W,ne),Pe&&Pe.m(x,ne),R(x,X,ne),Re&&Re.m(x,ne),R(x,D,ne),oe=!0,ge||(we=ee(_,"click",l[16]),ge=!0)},p(x,ne){x[0].tags?he?(he.p(x,ne),ne[0]&1&&J(he,1)):(he=zo(x),he.c(),J(he,1),he.m(u,null)):he&&(qe(),Y(he,1,1,()=>{he=null}),Be());const Se={};ne[0]&1|ne[1]&8192&&(Se.$$scope={dirty:ne,ctx:x}),i.$set(Se),(!oe||ne[0]&1)&&w!==(w=x[0].title+"")&&ve(v,w);let Ae=$;if($=ce(x),$===Ae?se[$].p(x,ne):(qe(),Y(se[Ae],1,1,()=>{se[Ae]=null}),Be(),q=se[$],q?q.p(x,ne):(q=se[$]=fe[$](x),q.c()),J(q,1),q.m(h,null)),!x[11]&&!x[9]&&!x[10]?ke?ke.p(x,ne):(ke=Wo(x),ke.c(),ke.m(N,L)):ke&&(ke.d(1),ke=null),x[9]?Ce||(Ce=Ko(),Ce.c(),Ce.m(N,Q)):Ce&&(Ce.d(1),Ce=null),x[10]?te?te.p(x,ne):(te=Go(x),te.c(),te.m(N,V)):te&&(te.d(1),te=null),x[11]&&x[8]?ie?(ie.p(x,ne),ne[0]&2304&&J(ie,1)):(ie=qo(x),ie.c(),J(ie,1),ie.m(N,null)):ie&&(qe(),Y(ie,1,1,()=>{ie=null}),Be()),ne[0]&32768){ae=x[15];let Ne;for(Ne=0;Ne<ae.length;Ne+=1){const ft=jo(x,ae,Ne);ue[Ne]?ue[Ne].p(ft,ne):(ue[Ne]=Jo(ft),ue[Ne].c(),ue[Ne].m(B,null))}for(;Ne<ue.length;Ne+=1)ue[Ne].d(1);ue.length=ae.length}x[13]?Ee?Ee.p(x,ne):(Ee=Vo(x),Ee.c(),Ee.m(e,null)):Ee&&(Ee.d(1),Ee=null);const et={};ne[0]&1&&(et.item=x[0]),!z&&ne[0]&2&&(z=!0,et.active=x[1],lt(()=>z=!1)),I.$set(et),x[4]?Pe?(Pe.p(x,ne),ne[0]&16&&J(Pe,1)):(Pe=Qo(x),Pe.c(),J(Pe,1),Pe.m(X.parentNode,X)):Pe&&(qe(),Y(Pe,1,1,()=>{Pe=null}),Be()),x[14]?Re?(Re.p(x,ne),ne[0]&16384&&J(Re,1)):(Re=Yo(x),Re.c(),J(Re,1),Re.m(D.parentNode,D)):Re&&(qe(),Y(Re,1,1,()=>{Re=null}),Be())},i(x){oe||(J(he),J(i.$$.fragment,x),J(q),J(ie),ut(()=>{oe&&(E||(E=nl(p,sl,{},!0)),E.run(1))}),ut(()=>{oe&&(F||(F=nl(H,sl,{},!0)),F.run(1))}),J(I.$$.fragment,x),J(Pe),J(Re),oe=!0)},o(x){Y(he),Y(i.$$.fragment,x),Y(q),Y(ie),E||(E=nl(p,sl,{},!1)),E.run(0),F||(F=nl(H,sl,{},!1)),F.run(0),Y(I.$$.fragment,x),Y(Pe),Y(Re),oe=!1},d(x){x&&T(e),he&&he.d(),me(i),se[$].d(),ke&&ke.d(),Ce&&Ce.d(),te&&te.d(),ie&&ie.d(),x&&E&&E.end(),Ve(ue,x),x&&F&&F.end(),Ee&&Ee.d(),x&&T(P),me(I,x),x&&T(W),Pe&&Pe.d(x),x&&T(X),Re&&Re.d(x),x&&T(D),ge=!1,we()}}}function di(l,e,t){let o,n,u,r,c;Oe(l,St,D=>t(29,u=D)),Oe(l,ze,D=>t(30,r=D)),Oe(l,Tt,D=>t(31,c=D));let{document:i}=e,d=!1,p=!1,_=!1,m=null,w=null,v=null,k=!1,y=null,S=!1,b=null,h=!1,$=!1,q=!1,O=!1,N=null;function L(){const D=[];return D.push({id:"download-markdown",label:"Download to Markdown",icon:"fas fa-download",action:()=>G(),visible:!0,title:"Download document as markdown file"}),o&&D.push({id:"save-atomic",label:"Save to Atomic Server",icon:"fas fa-cloud-upload-alt",action:()=>K(),visible:!0,title:"Save article to Atomic Server",className:"has-text-primary"}),i.url&&D.push({id:"external-url",label:"Open URL",icon:"fas fa-link",action:()=>window.open(i.url,"_blank"),visible:!0,title:"Open original URL in new tab",isLink:!0,href:i.url}),D.push({id:"open-vscode",label:"Open in VSCode",icon:"fas fa-code",action:()=>C(),visible:!0,title:"Open document in VSCode",isLink:!0,href:`vscode://${encodeURIComponent(i.title)}.md?${encodeURIComponent(i.body)}`}),D.push({id:"add-context",label:O?"Added to Context":q?"Adding...":"Add to Context",icon:O?"fas fa-check":q?"fas fa-spinner fa-spin":"fas fa-plus",action:()=>H(),visible:!0,title:O?"Document added to context":"Add document to LLM conversation context",disabled:q||O}),D}function Q(){var he;const D=u,oe=c;if(!(oe!=null&&oe.roles)||!D)return!1;let ge=null;try{for(const[fe,se]of Object.entries(oe.roles)){const ce=se,ke=typeof ce.name=="object"?ce.name.original:String(ce.name);if(fe===D||ke===D){ge=ce;break}}}catch(fe){return console.warn("Error checking role configuration:",fe),!1}return ge?(((he=ge.haystacks)==null?void 0:he.filter(fe=>fe.service==="Atomic"&&fe.location&&!fe.read_only))||[]).length>0:!1}const V=()=>{t(1,d=!0)},K=()=>{console.log("🔄 Opening atomic save modal for document:",i.title),t(3,_=!0)};async function A(D){var oe,ge,we,he,fe;t(7,k=!0),t(5,w=D),console.log("🔍 KG Search Debug Info:"),console.log("  Tag clicked:",D),console.log("  Current role:",u),console.log("  Is Tauri mode:",r);try{if(r){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:u,term:D});const se=await Me("find_documents_for_kg_term",{roleName:u,term:D});console.log("  📥 Tauri response received:"),console.log("    Status:",se.status),console.log("    Results count:",((oe=se.results)==null?void 0:oe.length)||0),console.log("    Total:",se.total||0),console.log("    Full response:",JSON.stringify(se,null,2)),se.status==="success"&&se.results&&se.results.length>0?(t(4,m=se.results[0]),t(6,v=m.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",m.title),console.log("    Rank:",v),console.log("    Body length:",((ge=m.body)==null?void 0:ge.length)||0,"characters"),t(2,p=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${D}" in role: "${u}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const se=Xe.ServerURL,ce=encodeURIComponent(u),ke=encodeURIComponent(D),Ce=`${se}/roles/${ce}/kg_search?term=${ke}`;console.log("  📤 HTTP Request details:"),console.log("    Base URL:",se),console.log("    Role (encoded):",ce),console.log("    Term (encoded):",ke),console.log("    Full URL:",Ce);const te=await fetch(Ce);if(console.log("  📥 HTTP Response received:"),console.log("    Status code:",te.status),console.log("    Status text:",te.statusText),console.log("    Headers:",Object.fromEntries(te.headers.entries())),!te.ok)throw new Error(`HTTP error! Status: ${te.status} - ${te.statusText}`);const ie=await te.json();console.log("  📄 Response data:"),console.log("    Status:",ie.status),console.log("    Results count:",((we=ie.results)==null?void 0:we.length)||0),console.log("    Total:",ie.total||0),console.log("    Full response:",JSON.stringify(ie,null,2)),ie.status==="success"&&ie.results&&ie.results.length>0?(t(4,m=ie.results[0]),t(6,v=m.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",m.title),console.log("    Rank:",v),console.log("    Body length:",((he=m.body)==null?void 0:he.length)||0,"characters"),t(2,p=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${D}" in role: "${u}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",Ce))}}catch(se){console.error("❌ Error fetching KG document:"),console.error("  Error type:",se.constructor.name),console.error("  Error message:",se.message||se),console.error("  Request details:",{tag:D,role:u,isTauri:r,timestamp:new Date().toISOString()}),!r&&((fe=se.message)!=null&&fe.includes("Failed to fetch"))&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{t(7,k=!1)}}async function E(){var D;if(!(S||!i.id||!u)){t(9,S=!0),t(10,b=null),console.log("🤖 AI Summary Debug Info:"),console.log("  Document ID:",i.id),console.log("  Current role:",u),console.log("  Is Tauri mode:",r);try{const oe={document_id:i.id,role:u,max_length:250,force_regenerate:!1};console.log("  📤 Summarization request:",oe);let ge;if(r){const fe=`${Xe.ServerURL}/documents/summarize`;ge=await fetch(fe,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(oe)})}else{const fe=`${Xe.ServerURL}/documents/summarize`;ge=await fetch(fe,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(oe)})}if(console.log("  📥 Summary response received:"),console.log("    Status code:",ge.status),console.log("    Status text:",ge.statusText),!ge.ok)throw new Error(`HTTP error! Status: ${ge.status} - ${ge.statusText}`);const we=await ge.json();console.log("  📄 Summary response data:",we),we.status==="Success"&&we.summary?(t(8,y=we.summary),t(12,$=we.from_cache||!1),t(11,h=!0),console.log("  ✅ Summary generated successfully"),console.log("    Summary length:",y.length,"characters"),console.log("    From cache:",$),console.log("    Model used:",we.model_used)):(t(10,b=we.error||"Failed to generate summary"),console.error("  ❌ Summary generation failed:",b))}catch(oe){console.error("❌ Error generating summary:"),console.error("  Error type:",oe.constructor.name),console.error("  Error message:",oe.message||oe),console.error("  Request details:",{document_id:i.id,role:u,isTauri:r,timestamp:new Date().toISOString()}),t(10,b=oe.message||"Network error occurred"),(D=oe.message)!=null&&D.includes("Failed to fetch")&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Verify OpenRouter is enabled for this role"),console.error("    3. Check OPENROUTER_KEY environment variable"),console.error("    4. Verify server URL in CONFIG.ServerURL"))}finally{t(9,S=!1)}}}function G(){console.log("📥 Downloading document as markdown:",i.title);let D=`# ${i.title}

`;D+=`**Source:** Terraphim Search
`,D+=`**Rank:** ${i.rank||"N/A"}
`,i.url&&(D+=`**URL:** ${i.url}
`),i.tags&&i.tags.length>0&&(D+=`**Tags:** ${i.tags.join(", ")}
`),D+=`**Downloaded:** ${new Date().toISOString()}

`,i.description&&(D+=`## Description

${i.description}

`),D+=`## Content

${i.body}
`;const oe=`${i.title.replace(/[^a-z0-9]/gi,"_").toLowerCase()}_${Date.now()}.md`,ge=new Blob([D],{type:"text/markdown"}),we=URL.createObjectURL(ge),he=window.document.createElement("a");he.href=we,he.download=oe,window.document.body.appendChild(he),he.click(),window.document.body.removeChild(he),URL.revokeObjectURL(we),console.log("✅ Markdown file downloaded:",oe)}function C(){const D=`vscode://${encodeURIComponent(i.title)}.md?${encodeURIComponent(i.body)}`;window.open(D,"_blank")}async function H(){console.log("📝 Adding document to LLM context:",i.title),q=!0,O=!1,t(13,N=null);try{let D=null;if(r){try{const we=await Me("list_conversations");if(console.log("📋 Available conversations:",we),we!=null&&we.conversations&&we.conversations.length>0)D=we.conversations[0].id,console.log("🎯 Using existing conversation:",D);else{const he=await Me("create_conversation",{title:"Search Context",role:u||"default"});if(he.status==="Success"&&he.conversationId)D=he.conversationId,console.log("🆕 Created new conversation:",D);else throw new Error("Failed to create conversation: "+(he.error||"Unknown error"))}}catch(we){throw console.error("❌ Failed to manage conversations:",we),new Error("Could not create or find conversation: "+we.message)}const oe={source_type:"document",document_id:i.id};i.url&&(oe.url=i.url),i.tags&&i.tags.length>0&&(oe.tags=i.tags.join(", ")),i.rank!==void 0&&(oe.rank=i.rank.toString());const ge=await Me("add_context_to_conversation",{conversationId:D,contextType:"document",title:i.title,content:i.body,metadata:oe});console.log("✅ Document added to context via Tauri:",ge)}else{const oe=Xe.ServerURL;try{const fe=await fetch(`${oe}/conversations`);if(fe.ok){const se=await fe.json();if(se.conversations&&se.conversations.length>0)D=se.conversations[0].id,console.log("🎯 Using existing conversation:",D);else{const ce=await fetch(`${oe}/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"Search Context",role:u||"default"})});if(ce.ok){const ke=await ce.json();if(ke.status==="Success"&&ke.conversation_id)D=ke.conversation_id,console.log("🆕 Created new conversation:",D);else throw new Error("Failed to create conversation: "+(ke.error||"Unknown error"))}else throw new Error(`Failed to create conversation: ${ce.status} ${ce.statusText}`)}}else throw new Error(`Failed to list conversations: ${fe.status} ${fe.statusText}`)}catch(fe){throw console.error("❌ Failed to manage conversations:",fe),new Error("Could not create or find conversation: "+fe.message)}const ge=`${oe}/conversations/${D}/context`,we=await fetch(ge,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context_item:{id:"",context_type:"Document",title:i.title,content:i.body,metadata:{source_type:"document",document_id:i.id,url:i.url||"",tags:i.tags?i.tags.join(", "):"",rank:i.rank?i.rank.toString():"0"},created_at:new Date().toISOString(),relevance_score:i.rank}})});if(!we.ok)throw new Error(`HTTP error! Status: ${we.status} - ${we.statusText}`);const he=await we.json();console.log("✅ Document added to context via HTTP:",he)}console.log("✅ Successfully added document to LLM context"),O=!0,setTimeout(()=>{O=!1},3e3)}catch(D){console.error("❌ Error adding document to context:",D),t(13,N=D.message||"Failed to add document to context"),setTimeout(()=>{t(13,N=null)},5e3)}finally{q=!1}}Ll[u]!==void 0&&(console.log("Have attribute",Ll[u]),Ll[u].hasOwnProperty("enableLogseq")?console.log("enable logseq True"):console.log("Didn't make it"));const B=D=>A(D),F=()=>{t(10,b=null),E()},Z=()=>t(11,h=!1),P=()=>{E()},I=()=>t(13,N=null);function z(D){d=D,t(1,d)}function W(D){p=D,t(2,p)}function X(D){_=D,t(3,_)}return l.$$set=D=>{"document"in D&&t(0,i=D.document)},t(14,o=Q()),t(15,n=L()),[i,d,p,_,m,w,v,k,y,S,b,h,$,N,o,n,V,A,E,B,F,Z,P,I,z,W,X]}class pi extends ht{constructor(e){super(),gt(this,e,di,fi,ct,{document:0},null,[-1,-1])}}const _i="/assets/terraphim_gray.png";function mi(l){const e=l.trim();if(!e)return{hasOperator:!1,operator:null,terms:[l],originalQuery:l};const t=/\b(and)\b/i,o=/\b(or)\b/i,n=t.test(e),u=o.test(e);if(n&&!u)return{hasOperator:!0,operator:"AND",terms:e.split(t).filter((c,i)=>i%2===0).map(c=>c.trim()).filter(c=>c.length>0),originalQuery:l};if(u&&!n)return{hasOperator:!0,operator:"OR",terms:e.split(o).filter((c,i)=>i%2===0).map(c=>c.trim()).filter(c=>c.length>0),originalQuery:l};if(n&&u){const r=e.toLowerCase().indexOf(" and "),c=e.toLowerCase().indexOf(" or ");if(r!==-1&&(c===-1||r<c))return{hasOperator:!0,operator:"AND",terms:e.split(t).filter((d,p)=>p%2===0).map(d=>d.trim()).filter(d=>d.length>0),originalQuery:l};if(c!==-1)return{hasOperator:!0,operator:"OR",terms:e.split(o).filter((d,p)=>p%2===0).map(d=>d.trim()).filter(d=>d.length>0),originalQuery:l}}return{hasOperator:!1,operator:null,terms:[e],originalQuery:l}}function Zo(l,e){var o,n;if(l.hasOperator&&l.terms.length>1){const u=l.terms.filter(r=>r.trim().length>0);if(u.length>1)return{search_term:u[0],search_terms:u,operator:(o=l.operator)==null?void 0:o.toLowerCase(),skip:0,limit:50,role:e||null}}return{search_term:((n=l.terms[0])==null?void 0:n.trim())||"",search_terms:void 0,operator:void 0,skip:0,limit:50,role:e||null}}function Xo(l,e,t){const o=l.slice();return o[27]=e[t],o}function xo(l,e,t){const o=l.slice();return o[30]=e[t],o[32]=t,o}function en(l){let e,t=l[2],o=[];for(let n=0;n<t.length;n+=1)o[n]=tn(xo(l,t,n));return{c(){e=f("ul");for(let n=0;n<o.length;n+=1)o[n].c();a(e,"class","suggestions svelte-e76e8j")},m(n,u){R(n,e,u);for(let r=0;r<o.length;r+=1)o[r]&&o[r].m(e,null)},p(n,u){if(u[0]&1036){t=n[2];let r;for(r=0;r<t.length;r+=1){const c=xo(n,t,r);o[r]?o[r].p(c,u):(o[r]=tn(c),o[r].c(),o[r].m(e,null))}for(;r<o.length;r+=1)o[r].d(1);o.length=t.length}},d(n){n&&T(e),Ve(o,n)}}}function tn(l){let e,t=l[30]+"",o,n,u,r,c,i;function d(){return l[14](l[30])}function p(..._){return l[15](l[30],..._)}return{c(){e=f("li"),o=U(t),n=g(),a(e,"tabindex","0"),a(e,"role","option"),a(e,"aria-selected",u=l[32]===l[3]),a(e,"aria-label",r=`Apply suggestion: ${l[30]}`),a(e,"class","svelte-e76e8j"),Ut(e,"active",l[32]===l[3])},m(_,m){R(_,e,m),s(e,o),s(e,n),c||(i=[ee(e,"click",d),ee(e,"keydown",p)],c=!0)},p(_,m){l=_,m[0]&4&&t!==(t=l[30]+"")&&ve(o,t),m[0]&8&&u!==(u=l[32]===l[3])&&a(e,"aria-selected",u),m[0]&4&&r!==(r=`Apply suggestion: ${l[30]}`)&&a(e,"aria-label",r),m[0]&8&&Ut(e,"active",l[32]===l[3])},d(_){_&&T(e),c=!1,Qe(i)}}}function hi(l){let e,t,o,n,u,r,c,i,d,p,_,m,w,v,k,y,S,b,h,$,q,O,N;function L(K){l[13](K)}let Q={type:"search",placeholder:l[7]?`Search over Knowledge graph for ${l[6]}`:"Search",icon:"search",expanded:!0,autofocus:!0};l[5]!==void 0&&(Q.value=l[5]),o=new Jt({props:Q}),xe.push(()=>tt(o,"value",L)),o.$on("click",l[11]),o.$on("submit",l[11]),o.$on("keydown",l[9]),o.$on("input",l[8]);let V=l[2].length>0&&en(l);return q=Xn(l[17][0]),{c(){e=f("div"),t=f("div"),pe(o.$$.fragment),u=g(),V&&V.c(),r=g(),c=f("div"),i=f("div"),d=f("label"),p=f("input"),_=U(`
            Exact`),m=g(),w=f("label"),v=f("input"),k=U(`
            All (AND)`),y=g(),S=f("label"),b=f("input"),h=U(`
            Any (OR)`),a(t,"class","input-wrapper svelte-e76e8j"),a(p,"type","radio"),p.__value="none",p.value=p.__value,a(p,"class","svelte-e76e8j"),a(d,"class","radio svelte-e76e8j"),a(v,"type","radio"),v.__value="and",v.value=v.__value,a(v,"class","svelte-e76e8j"),a(w,"class","radio svelte-e76e8j"),a(b,"type","radio"),b.__value="or",b.value=b.__value,a(b,"class","svelte-e76e8j"),a(S,"class","radio svelte-e76e8j"),a(i,"class","control svelte-e76e8j"),a(c,"class","operator-controls svelte-e76e8j"),a(e,"class","search-row svelte-e76e8j"),q.p(p,v,b)},m(K,A){R(K,e,A),s(e,t),_e(o,t,null),s(t,u),V&&V.m(t,null),s(e,r),s(e,c),s(c,i),s(i,d),s(d,p),p.checked=p.__value===l[4],s(d,_),s(i,m),s(i,w),s(w,v),v.checked=v.__value===l[4],s(w,k),s(i,y),s(i,S),s(S,b),b.checked=b.__value===l[4],s(S,h),$=!0,O||(N=[ee(p,"change",l[16]),ee(v,"change",l[18]),ee(b,"change",l[19])],O=!0)},p(K,A){const E={};A[0]&192&&(E.placeholder=K[7]?`Search over Knowledge graph for ${K[6]}`:"Search"),!n&&A[0]&32&&(n=!0,E.value=K[5],lt(()=>n=!1)),o.$set(E),K[2].length>0?V?V.p(K,A):(V=en(K),V.c(),V.m(t,null)):V&&(V.d(1),V=null),A[0]&16&&(p.checked=p.__value===K[4]),A[0]&16&&(v.checked=v.__value===K[4]),A[0]&16&&(b.checked=b.__value===K[4])},i(K){$||(J(o.$$.fragment,K),$=!0)},o(K){Y(o.$$.fragment,K),$=!1},d(K){K&&T(e),me(o),V&&V.d(),q.r(),O=!1,Qe(N)}}}function gi(l){let e,t,o,n,u,r,c,i,d,p;return{c(){e=f("section"),t=f("div"),o=f("img"),u=g(),r=f("p"),r.textContent="I am Terraphim, your personal assistant.",c=g(),i=f("button"),i.innerHTML=`<span class="icon"><i class="fas fa-magic"></i></span>
        <span>Configuration Wizard</span>`,ws(o.src,n=_i)||a(o,"src",n),a(o,"alt","Terraphim Logo"),a(o,"class","svelte-e76e8j"),a(i,"class","button is-primary"),a(i,"data-testid","wizard-start"),a(t,"class","content has-text-grey has-text-centered svelte-e76e8j"),a(e,"class","section")},m(_,m){R(_,e,m),s(e,t),s(t,o),s(t,u),s(t,r),s(t,c),s(t,i),d||(p=ee(i,"click",l[20]),d=!0)},p:Te,i:Te,o:Te,d(_){_&&T(e),d=!1,p()}}}function vi(l){let e,t,o=l[0],n=[];for(let r=0;r<o.length;r+=1)n[r]=ln(Xo(l,o,r));const u=r=>Y(n[r],1,1,()=>{n[r]=null});return{c(){for(let r=0;r<n.length;r+=1)n[r].c();e=ot()},m(r,c){for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(r,c);R(r,e,c),t=!0},p(r,c){if(c[0]&1){o=r[0];let i;for(i=0;i<o.length;i+=1){const d=Xo(r,o,i);n[i]?(n[i].p(d,c),J(n[i],1)):(n[i]=ln(d),n[i].c(),J(n[i],1),n[i].m(e.parentNode,e))}for(qe(),i=o.length;i<n.length;i+=1)u(i);Be()}},i(r){if(!t){for(let c=0;c<o.length;c+=1)J(n[c]);t=!0}},o(r){n=n.filter(Boolean);for(let c=0;c<n.length;c+=1)Y(n[c]);t=!1},d(r){Ve(n,r),r&&T(e)}}}function bi(l){let e,t;return{c(){e=f("p"),t=U(l[1]),a(e,"class","error svelte-e76e8j")},m(o,n){R(o,e,n),s(e,t)},p(o,n){n[0]&2&&ve(t,o[1])},i:Te,o:Te,d(o){o&&T(e)}}}function ln(l){let e,t;return e=new pi({props:{document:l[27]}}),{c(){pe(e.$$.fragment)},m(o,n){_e(e,o,n),t=!0},p(o,n){const u={};n[0]&1&&(u.document=o[27]),e.$set(u)},i(o){t||(J(e.$$.fragment,o),t=!0)},o(o){Y(e.$$.fragment,o),t=!1},d(o){me(e,o)}}}function ki(l){let e,t,o,n,u,r,c,i,d,p,_;e=new rl({props:{fallbackPath:"/"}}),n=new Ht({props:{$$slots:{default:[hi]},$$scope:{ctx:l}}});const m=[bi,vi,gi],w=[];function v(k,y){return k[1]?0:k[0].length?1:2}return r=v(l),c=w[r]=m[r](l),{c(){pe(e.$$.fragment),t=g(),o=f("form"),pe(n.$$.fragment),u=g(),c.c(),i=ot()},m(k,y){_e(e,k,y),R(k,t,y),R(k,o,y),_e(n,o,null),R(k,u,y),w[r].m(k,y),R(k,i,y),d=!0,p||(_=ee(o,"submit",ks(l[11])),p=!0)},p(k,y){const S={};y[0]&252|y[1]&4&&(S.$$scope={dirty:y,ctx:k}),n.$set(S);let b=r;r=v(k),r===b?w[r].p(k,y):(qe(),Y(w[b],1,1,()=>{w[b]=null}),Be(),c=w[r],c?c.p(k,y):(c=w[r]=m[r](k),c.c()),J(c,1),c.m(i.parentNode,i))},i(k){d||(J(e.$$.fragment,k),J(n.$$.fragment,k),J(c),d=!0)},o(k){Y(e.$$.fragment,k),Y(n.$$.fragment,k),Y(c),d=!1},d(k){me(e,k),k&&T(t),k&&T(o),me(n),k&&T(u),w[r].d(k),k&&T(i),p=!1,_()}}}function wi(l,e,t){let o,n,u,r,c,i,d;Oe(l,Gs,G=>t(22,n=G)),Oe(l,Al,G=>t(5,u=G)),Oe(l,ze,G=>t(23,r=G)),Oe(l,St,G=>t(6,c=G)),Oe(l,fl,G=>t(12,i=G)),Oe(l,Ct,G=>t(7,d=G));let p=[],_=null,m=[],w=-1,v="none";async function k(G){try{if(r){const C=await Me("get_autocomplete_suggestions",{query:G,roleName:c,limit:8});if(C.status==="success"&&C.suggestions)return C.suggestions.map(H=>H.term)}else{const C=await fetch(`${n.replace("/documents/search","")}/autocomplete/${encodeURIComponent(c)}/${encodeURIComponent(G)}`);if(C.ok){const H=await C.json();if(H.status==="success"&&H.suggestions)return H.suggestions.map(B=>B.term)}}return o.filter(([C])=>C.toLowerCase().includes(G.toLowerCase())).map(([C])=>C).slice(0,8)}catch(C){return console.warn("Error fetching term suggestions:",C),[]}}async function y(G){const C=G.trim();if(C.length===0)return[];if(v!=="none"){const P=C.split(/\s+/),I=P[P.length-1].toLowerCase();return I.length<2?[]:k(I)}const B=C.split(/\s+/),F=B[B.length-1].toLowerCase();if(B.length>1&&v==="none"){const P=[];if("and".startsWith(F)&&P.push("AND"),"or".startsWith(F)&&P.push("OR"),P.length>0)return P}const Z=C.toLowerCase();if(Z.includes(" and ")||Z.includes(" or ")){const P=F;return P.length<2?[]:k(P)}try{const P=await k(C);return B.length===1&&B[0].length>2&&v==="none"?[...P.slice(0,6),"AND","OR"]:P}catch(P){console.warn("Error fetching autocomplete suggestions:",P);const I=o.filter(([z])=>z.toLowerCase().includes(C.toLowerCase())).map(([z])=>z).slice(0,6);return B.length===1&&B[0].length>2&&v==="none"?[...I,"AND","OR"]:I}}async function S(G){const C=G.target;if(!C||C.selectionStart==null)return;const H=C.selectionStart,F=u.slice(0,H).split(/\s+/),Z=F[F.length-1];if(Z.length>=2)try{t(2,m=await y(Z))}catch(P){console.warn("Failed to get suggestions:",P),t(2,m=[])}else t(2,m=[]);t(3,w=-1)}function b(G){m.length!==0&&(G.key==="ArrowDown"?(G.preventDefault(),t(3,w=(w+1)%m.length)):G.key==="ArrowUp"?(G.preventDefault(),t(3,w=(w-1+m.length)%m.length)):(G.key==="Enter"||G.key==="Tab")&&w!==-1&&(G.preventDefault(),h(m[w])))}function h(G){var P,I;const C=document.querySelector('input[type="search"]'),H=(C==null?void 0:C.selectionStart)??0,B=u.slice(0,H),F=u.slice(H),Z=B.split(/\s+/);if(G==="AND"||G==="OR"){Z[Z.length-1]=G,dl(Al,u=[...Z,"",F].join(" "),u);const z=H+G.length+1;(P=C==null?void 0:C.setSelectionRange)==null||P.call(C,z,z)}else{Z[Z.length-1]=G,dl(Al,u=[...Z,F].join(" "),u);const z=H+G.length;(I=C==null?void 0:C.setSelectionRange)==null||I.call(C,z,z)}t(2,m=[]),t(3,w=-1)}function $(){const G=u.trim();if(!G)return null;if(v!=="none"){const B=G.split(/\s+/).filter(F=>F.length>0);return B.length>1?{...Zo({hasOperator:!0,operator:v==="and"?"AND":"OR",terms:B,originalQuery:G},c),skip:0,limit:10}:{search_term:G,skip:0,limit:10,role:c}}const C=mi(G);return{...Zo(C,c),skip:0,limit:10}}async function q(){if(t(1,_=null),r){if(!u.trim())return;try{const G=$();if(!G)return;const C=await Me("search",{searchQuery:G});C.status==="success"?(t(0,p=C.results),console.log("Response results"),console.log(p)):(t(1,_=`Search failed: ${C.status}`),console.error("Search failed:",C))}catch(G){t(1,_=`Error in Tauri search: ${G}`),console.error("Error in Tauri search:",G)}}else{if(!u.trim())return;const G=$();if(!G)return;const C=JSON.stringify(G);try{const H=await fetch(n,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:C}),B=await H.json();if(!H.ok)throw new Error(`HTTP error! Status: ${H.status}`);t(0,p=B.results)}catch(H){console.error("Error fetching data:",H),t(1,_=`Error fetching data: ${H}`)}}}const O=[[]];function N(G){u=G,Al.set(u)}const L=G=>h(G),Q=(G,C)=>{(C.key==="Enter"||C.key===" ")&&(C.preventDefault(),h(G))};function V(){v=this.__value,t(4,v)}function K(){v=this.__value,t(4,v)}function A(){v=this.__value,t(4,v)}const E=()=>window.location.href="/config/wizard";return l.$$.update=()=>{l.$$.dirty[0]&4096&&(o=Object.entries(i))},[p,_,m,w,v,u,c,d,S,b,h,q,i,N,L,Q,V,O,K,A,E]}class yi extends ht{constructor(e){super(),gt(this,e,wi,ki,ct,{},null,[-1,-1])}}async function on(l={}){return typeof l=="object"&&Object.freeze(l),zl({__tauriModule:"Dialog",message:{cmd:"openDialog",options:l}})}function nn(l,e,t){const o=l.slice();return o[71]=e[t],o[79]=t,o}function sn(l,e,t){const o=l.slice();return o[77]=e[t],o[78]=e,o[79]=t,o}function rn(l,e,t){const o=l.slice();return o[80]=e[t],o}function an(l,e,t){const o=l.slice();return o[80]=e[t],o}function un(l,e,t){const o=l.slice();return o[85]=e[t],o[86]=e,o[87]=t,o}function cn(l,e,t){const o=l.slice();return o[88]=e[t][0],o[89]=e[t][1],o[90]=e,o[91]=t,o}function fn(l,e,t){const o=l.slice();return o[74]=e[t],o}function dn(l,e,t){const o=l.slice();return o[71]=e[t],o}function pn(l,e,t){const o=l.slice();return o[74]=e[t],o}function _n(l){let e,t,o,n,u;return{c(){e=f("div"),t=f("button"),o=U(`
      Configuration saved successfully!`),a(t,"class","delete"),a(e,"class","notification is-success"),a(e,"data-testid","wizard-success")},m(r,c){R(r,e,c),s(e,t),s(e,o),n||(u=ee(t,"click",l[20]),n=!0)},p:Te,d(r){r&&T(e),n=!1,u()}}}function mn(l){let e,t,o,n,u;return{c(){e=f("div"),t=f("button"),o=U(`
      Failed to save configuration. Please try again.`),a(t,"class","delete"),a(e,"class","notification is-danger"),a(e,"data-testid","wizard-error")},m(r,c){R(r,e,c),s(e,t),s(e,o),n||(u=ee(t,"click",l[21]),n=!0)},p:Te,d(r){r&&T(e),n=!1,u()}}}function $i(l){let e,t,o,n,u,r,c,i,d,p=l[3].id+"",_,m,w,v,k,y=l[3].global_shortcut+"",S,b,h,$,q,O=l[3].default_theme+"",N,L,Q,V,K,A=l[3].default_role+"",E,G,C,H,B,F,Z=JSON.stringify(l[3],null,2)+"",P,I=l[3].roles,z=[];for(let W=0;W<I.length;W+=1)z[W]=hn(nn(l,I,W));return{c(){e=f("h4"),e.textContent="Review",t=g(),o=f("div"),n=f("h5"),n.textContent="Configuration Summary:",u=g(),r=f("ul"),c=f("li"),i=f("strong"),i.textContent="Configuration ID:",d=g(),_=U(p),m=g(),w=f("li"),v=f("strong"),v.textContent="Global Shortcut:",k=g(),S=U(y),b=g(),h=f("li"),$=f("strong"),$.textContent="Default Theme:",q=g(),N=U(O),L=g(),Q=f("li"),V=f("strong"),V.textContent="Default Role:",K=g(),E=U(A),G=g(),C=f("h5"),C.textContent="Roles:",H=g();for(let W=0;W<z.length;W+=1)z[W].c();B=g(),F=f("pre"),P=U(Z),a(e,"class","title is-5"),a(o,"class","content"),de(F,"max-height","300px"),de(F,"overflow","auto")},m(W,X){R(W,e,X),R(W,t,X),R(W,o,X),s(o,n),s(o,u),s(o,r),s(r,c),s(c,i),s(c,d),s(c,_),s(r,m),s(r,w),s(w,v),s(w,k),s(w,S),s(r,b),s(r,h),s(h,$),s(h,q),s(h,N),s(r,L),s(r,Q),s(Q,V),s(Q,K),s(Q,E),s(o,G),s(o,C),s(o,H);for(let D=0;D<z.length;D+=1)z[D]&&z[D].m(o,null);R(W,B,X),R(W,F,X),s(F,P)},p(W,X){if(X[0]&8&&p!==(p=W[3].id+"")&&ve(_,p),X[0]&8&&y!==(y=W[3].global_shortcut+"")&&ve(S,y),X[0]&8&&O!==(O=W[3].default_theme+"")&&ve(N,O),X[0]&8&&A!==(A=W[3].default_role+"")&&ve(E,A),X[0]&10){I=W[3].roles;let D;for(D=0;D<I.length;D+=1){const oe=nn(W,I,D);z[D]?z[D].p(oe,X):(z[D]=hn(oe),z[D].c(),z[D].m(o,null))}for(;D<z.length;D+=1)z[D].d(1);z.length=I.length}X[0]&8&&Z!==(Z=JSON.stringify(W[3],null,2)+"")&&ve(P,Z)},d(W){W&&T(e),W&&T(t),W&&T(o),Ve(z,W),W&&T(B),W&&T(F)}}}function Ci(l){let e,t,o=[],n=new Map,u,r,c,i,d=l[3].roles;const p=_=>_[77].name;for(let _=0;_<d.length;_+=1){let m=sn(l,d,_),w=p(m);n.set(w,o[_]=Pn(w,m))}return{c(){e=f("h4"),e.textContent="Roles",t=g();for(let _=0;_<o.length;_+=1)o[_].c();u=g(),r=f("button"),r.textContent="Add Role",a(e,"class","title is-5"),a(r,"class","button is-link is-light"),a(r,"data-testid","add-role")},m(_,m){R(_,e,m),R(_,t,m);for(let w=0;w<o.length;w+=1)o[w]&&o[w].m(_,m);R(_,u,m),R(_,r,m),c||(i=ee(r,"click",l[12]),c=!0)},p(_,m){m[0]&516985&&(d=_[3].roles,o=ys(o,m,p,1,_,d,n,u.parentNode,$s,Pn,u,sn))},d(_){_&&T(e),_&&T(t);for(let m=0;m<o.length;m+=1)o[m].d(_);_&&T(u),_&&T(r),c=!1,i()}}}function Si(l){let e,t,o,n,u,r,c,i,d,p,_,m,w,v,k,y,S,b,h,$,q,O,N,L,Q,V,K,A,E,G,C,H=l[8],B=[];for(let P=0;P<H.length;P+=1)B[P]=On(pn(l,H,P));let F=l[3].roles,Z=[];for(let P=0;P<F.length;P+=1)Z[P]=Nn(dn(l,F,P));return{c(){e=f("div"),t=f("label"),t.textContent="Configuration ID",o=g(),n=f("div"),u=f("div"),r=f("select"),c=f("option"),c.textContent="Desktop",i=f("option"),i.textContent="Server",d=f("option"),d.textContent="Embedded",p=g(),_=f("div"),m=f("label"),m.textContent="Global shortcut",w=g(),v=f("div"),k=f("input"),y=g(),S=f("div"),b=f("label"),b.textContent="Default theme",h=g(),$=f("div"),q=f("div"),O=f("select");for(let P=0;P<B.length;P+=1)B[P].c();N=g(),L=f("div"),Q=f("label"),Q.textContent="Default Role",V=g(),K=f("div"),A=f("div"),E=f("select");for(let P=0;P<Z.length;P+=1)Z[P].c();a(t,"class","label"),a(t,"for","config-id"),c.__value="Desktop",c.value=c.__value,i.__value="Server",i.value=i.__value,d.__value="Embedded",d.value=d.__value,a(r,"id","config-id"),l[3].id===void 0&&ut(()=>l[22].call(r)),a(u,"class","select"),a(n,"class","control"),a(e,"class","field"),a(m,"class","label"),a(m,"for","global-shortcut"),a(k,"class","input"),a(k,"id","global-shortcut"),a(k,"type","text"),a(v,"class","control"),a(_,"class","field"),a(b,"class","label"),a(b,"for","default-theme"),a(O,"id","default-theme"),l[3].default_theme===void 0&&ut(()=>l[24].call(O)),a(q,"class","select is-fullwidth"),a($,"class","control"),a(S,"class","field"),a(Q,"class","label"),a(Q,"for","default-role"),a(E,"id","default-role"),l[3].default_role===void 0&&ut(()=>l[25].call(E)),a(A,"class","select"),a(K,"class","control"),a(L,"class","field")},m(P,I){R(P,e,I),s(e,t),s(e,o),s(e,n),s(n,u),s(u,r),s(r,c),s(r,i),s(r,d),He(r,l[3].id,!0),R(P,p,I),R(P,_,I),s(_,m),s(_,w),s(_,v),s(v,k),Ue(k,l[3].global_shortcut),R(P,y,I),R(P,S,I),s(S,b),s(S,h),s(S,$),s($,q),s(q,O);for(let z=0;z<B.length;z+=1)B[z]&&B[z].m(O,null);He(O,l[3].default_theme,!0),R(P,N,I),R(P,L,I),s(L,Q),s(L,V),s(L,K),s(K,A),s(A,E);for(let z=0;z<Z.length;z+=1)Z[z]&&Z[z].m(E,null);He(E,l[3].default_role,!0),G||(C=[ee(r,"change",l[22]),ee(k,"input",l[23]),ee(O,"change",l[24]),ee(E,"change",l[25])],G=!0)},p(P,I){if(I[0]&264&&He(r,P[3].id),I[0]&264&&k.value!==P[3].global_shortcut&&Ue(k,P[3].global_shortcut),I[0]&256){H=P[8];let z;for(z=0;z<H.length;z+=1){const W=pn(P,H,z);B[z]?B[z].p(W,I):(B[z]=On(W),B[z].c(),B[z].m(O,null))}for(;z<B.length;z+=1)B[z].d(1);B.length=H.length}if(I[0]&264&&He(O,P[3].default_theme),I[0]&8){F=P[3].roles;let z;for(z=0;z<F.length;z+=1){const W=dn(P,F,z);Z[z]?Z[z].p(W,I):(Z[z]=Nn(W),Z[z].c(),Z[z].m(E,null))}for(;z<Z.length;z+=1)Z[z].d(1);Z.length=F.length}I[0]&264&&He(E,P[3].default_role)},d(P){P&&T(e),P&&T(p),P&&T(_),P&&T(y),P&&T(S),Ve(B,P),P&&T(N),P&&T(L),Ve(Z,P),G=!1,Qe(C)}}}function hn(l){let e,t,o=l[71].name+"",n,u,r,c,i,d=l[71].shortname+"",p,_,m,w,v,k=l[71].theme+"",y,S,b,h,$,q=l[71].relevance_function+"",O,N,L,Q,V,K;return{c(){e=f("div"),t=f("h6"),n=U(o),u=g(),r=f("p"),c=f("strong"),c.textContent="Shortname:",i=g(),p=U(d),_=g(),m=f("p"),w=f("strong"),w.textContent="Theme:",v=g(),y=U(k),S=g(),b=f("p"),h=f("strong"),h.textContent="Relevance Function:",$=g(),O=U(q),N=g(),L=f("button"),L.textContent="Edit Role",Q=g(),a(t,"data-testid","review-role-name-"+l[79]),a(L,"class","button is-small"),a(L,"data-testid","edit-role-"+l[79]),a(e,"class","box")},m(A,E){R(A,e,E),s(e,t),s(t,n),s(e,u),s(e,r),s(r,c),s(r,i),s(r,p),s(e,_),s(e,m),s(m,w),s(m,v),s(m,y),s(e,S),s(e,b),s(b,h),s(b,$),s(b,O),s(e,N),s(e,L),s(e,Q),V||(K=ee(L,"click",l[68]),V=!0)},p(A,E){E[0]&8&&o!==(o=A[71].name+"")&&ve(n,o),E[0]&8&&d!==(d=A[71].shortname+"")&&ve(p,d),E[0]&8&&k!==(k=A[71].theme+"")&&ve(y,k),E[0]&8&&q!==(q=A[71].relevance_function+"")&&ve(O,q)},d(A){A&&T(e),V=!1,K()}}}function gn(l){let e,t=l[74]+"",o;return{c(){e=f("option"),o=U(t),e.__value=l[74],e.value=e.__value},m(n,u){R(n,e,u),s(e,o)},p:Te,d(n){n&&T(e)}}}function Ti(l){let e;return{c(){e=U("Directory Path")},m(t,o){R(t,e,o)},d(t){t&&T(e)}}}function Ri(l){let e;return{c(){e=U("Server URL")},m(t,o){R(t,e,o)},d(t){t&&T(e)}}}function vn(l){let e;return{c(){e=f("p"),e.textContent="Click to select directory",a(e,"class","help")},m(t,o){R(t,e,o)},d(t){t&&T(e)}}}function bn(l){let e,t,o,n,u,r,c,i,d,p,_,m;function w(){l[34].call(c,l[79],l[87])}return{c(){e=f("div"),t=f("label"),o=U("Atomic Server Secret"),u=g(),r=f("div"),c=f("input"),d=g(),p=f("p"),p.textContent="Leave empty for anonymous access",a(t,"class","label"),a(t,"for",n=`haystack-secret-${l[79]}-${l[87]}`),a(c,"class","input"),a(c,"id",i=`haystack-secret-${l[79]}-${l[87]}`),a(c,"type","password"),a(c,"placeholder","Base64 encoded secret (optional)"),a(r,"class","control"),a(p,"class","help"),a(e,"class","field")},m(v,k){R(v,e,k),s(e,t),s(t,o),s(e,u),s(e,r),s(r,c),Ue(c,l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret),s(e,d),s(e,p),_||(m=ee(c,"input",w),_=!0)},p(v,k){l=v,k[0]&264&&n!==(n=`haystack-secret-${l[79]}-${l[87]}`)&&a(t,"for",n),k[0]&264&&i!==(i=`haystack-secret-${l[79]}-${l[87]}`)&&a(c,"id",i),k[0]&264&&c.value!==l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret&&Ue(c,l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret)},d(v){v&&T(e),_=!1,m()}}}function kn(l){let e,t,o,n,u,r,c,i,d,p,_,m,w,v,k,y,S,b,h,$,q,O,N,L,Q,V,K,A,E,G,C,H,B,F,Z,P,I,z,W,X,D,oe,ge;function we(){l[35].call(p,l[79],l[87])}function he(...te){return l[36](l[79],l[87],...te)}let fe=Object.entries(l[3].roles[l[79]].haystacks[l[87]].extra_parameters||{}),se=[];for(let te=0;te<fe.length;te+=1)se[te]=wn(cn(l,fe,te));function ce(){return l[40](l[79],l[87])}function ke(){return l[41](l[79],l[87])}function Ce(){return l[42](l[79],l[87])}return{c(){e=f("div"),t=f("label"),t.textContent="Extra Parameters (for filtering)",o=g(),n=f("div"),u=f("div"),r=f("label"),c=U("Hashtag"),d=g(),p=f("input"),m=g(),w=f("div"),v=f("div"),k=f("label"),y=U("Presets"),b=g(),h=f("div"),$=f("select"),q=f("option"),q.textContent="(choose)",O=f("option"),O.textContent="#rust",N=f("option"),N.textContent="#docs",L=f("option"),L.textContent="#test",Q=f("option"),Q.textContent="#todo",K=g(),A=f("p"),A.innerHTML="When set, searches will enforce the hashtag alongside your query (AND), e.g. <code>-e &quot;search&quot; -e &quot;#rust&quot;</code>.",E=g();for(let te=0;te<se.length;te+=1)se[te].c();G=g(),C=f("div"),H=f("div"),B=f("button"),B.textContent="+ Tag Filter",F=g(),Z=f("div"),P=f("button"),P.textContent="+ Max Results",I=g(),z=f("div"),W=f("button"),W.textContent="+ Custom Parameter",X=g(),D=f("p"),D.innerHTML=`Common parameters: <code>tag</code> (e.g., &quot;#rust&quot;), <code>glob</code> (e.g., &quot;*.md&quot;),
                  <code>max_count</code> (e.g., &quot;10&quot;), <code>context</code> (e.g., &quot;5&quot;)`,a(t,"class","label"),a(r,"class","label"),a(r,"for",i=`ripgrep-hashtag-${l[79]}-${l[87]}`),a(p,"class","input"),a(p,"id",_=`ripgrep-hashtag-${l[79]}-${l[87]}`),a(p,"type","text"),a(p,"placeholder","#rust"),a(u,"class","control"),a(n,"class","field is-grouped"),a(k,"class","label"),a(k,"for",S=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`),q.__value="",q.value=q.__value,O.__value="#rust",O.value=O.__value,N.__value="#docs",N.value=N.__value,L.__value="#test",L.value=L.__value,Q.__value="#todo",Q.value=Q.__value,a($,"id",V=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`),a(h,"class","select is-small"),a(v,"class","control"),a(w,"class","field is-grouped"),de(w,"margin-bottom",".5rem"),a(A,"class","help"),a(B,"class","button is-small is-link is-light"),a(H,"class","control"),a(P,"class","button is-small is-link is-light"),a(Z,"class","control"),a(W,"class","button is-small is-link is-light"),a(z,"class","control"),a(C,"class","field is-grouped"),a(D,"class","help"),a(e,"class","field")},m(te,ie){R(te,e,ie),s(e,t),s(e,o),s(e,n),s(n,u),s(u,r),s(r,c),s(u,d),s(u,p),Ue(p,l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag),s(e,m),s(e,w),s(w,v),s(v,k),s(k,y),s(v,b),s(v,h),s(h,$),s($,q),s($,O),s($,N),s($,L),s($,Q),s(e,K),s(e,A),s(e,E);for(let ae=0;ae<se.length;ae+=1)se[ae]&&se[ae].m(e,null);s(e,G),s(e,C),s(C,H),s(H,B),s(C,F),s(C,Z),s(Z,P),s(C,I),s(C,z),s(z,W),s(e,X),s(e,D),oe||(ge=[ee(p,"input",we),ee($,"change",he),ee(B,"click",ce),ee(P,"click",ke),ee(W,"click",Ce)],oe=!0)},p(te,ie){if(l=te,ie[0]&264&&i!==(i=`ripgrep-hashtag-${l[79]}-${l[87]}`)&&a(r,"for",i),ie[0]&264&&_!==(_=`ripgrep-hashtag-${l[79]}-${l[87]}`)&&a(p,"id",_),ie[0]&264&&p.value!==l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag&&Ue(p,l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag),ie[0]&264&&S!==(S=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`)&&a(k,"for",S),ie[0]&264&&V!==(V=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`)&&a($,"id",V),ie[0]&393224){fe=Object.entries(l[3].roles[l[79]].haystacks[l[87]].extra_parameters||{});let ae;for(ae=0;ae<fe.length;ae+=1){const ue=cn(l,fe,ae);se[ae]?se[ae].p(ue,ie):(se[ae]=wn(ue),se[ae].c(),se[ae].m(e,G))}for(;ae<se.length;ae+=1)se[ae].d(1);se.length=fe.length}},d(te){te&&T(e),Ve(se,te),oe=!1,Qe(ge)}}}function wn(l){let e,t,o,n,u,r,c,i,d,p,_,m,w;function v(...S){return l[37](l[79],l[87],l[88],...S)}function k(){l[38].call(c,l[79],l[87],l[88])}function y(){return l[39](l[79],l[87],l[88])}return{c(){e=f("div"),t=f("div"),o=f("input"),u=g(),r=f("div"),c=f("input"),i=g(),d=f("div"),p=f("button"),p.textContent="×",_=g(),a(o,"class","input"),a(o,"type","text"),a(o,"placeholder","Parameter name"),o.value=n=l[88],a(t,"class","control"),a(c,"class","input"),a(c,"type","text"),a(c,"placeholder","Parameter value"),a(r,"class","control is-expanded"),a(p,"class","button is-small is-danger"),a(d,"class","control"),a(e,"class","field is-grouped")},m(S,b){R(S,e,b),s(e,t),s(t,o),s(e,u),s(e,r),s(r,c),Ue(c,l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]]),s(e,i),s(e,d),s(d,p),s(e,_),m||(w=[ee(o,"blur",v),ee(c,"input",k),ee(p,"click",y)],m=!0)},p(S,b){l=S,b[0]&264&&n!==(n=l[88])&&o.value!==n&&(o.value=n),b[0]&264&&c.value!==l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]]&&Ue(c,l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]])},d(S){S&&T(e),m=!1,Qe(w)}}}function yn(l){let e,t,o,n,u,r,c,i,d,p,_,m,w,v,k,y,S,b,h,$,q,O,N,L,Q,V,K,A,E,G,C,H,B,F,Z,P,I,z,W;function X(){l[31].call(d,l[79],l[87])}function D(te,ie){return te[3].roles[te[79]].haystacks[te[87]].service==="Atomic"?Ri:Ti}let oe=D(l),ge=oe(l);function we(){l[32].call(h,l[79],l[87])}function he(){return l[33](l[79],l[87])}let fe=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"&&vn(),se=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"&&bn(l),ce=l[3].roles[l[79]].haystacks[l[87]].service==="Ripgrep"&&kn(l);function ke(){l[43].call(E,l[79],l[87])}function Ce(){return l[44](l[79],l[87])}return{c(){e=f("div"),t=f("div"),o=f("label"),n=U("Service Type"),r=g(),c=f("div"),i=f("div"),d=f("select"),p=f("option"),p.textContent="Ripgrep (File Search)",_=f("option"),_.textContent="Atomic Server",w=g(),v=f("div"),k=f("label"),ge.c(),S=g(),b=f("div"),h=f("input"),N=g(),fe&&fe.c(),L=g(),se&&se.c(),Q=g(),ce&&ce.c(),V=g(),K=f("div"),A=f("label"),E=f("input"),C=U(`
                 Read-only`),B=g(),F=f("div"),Z=f("button"),P=U("Remove Haystack"),a(o,"class","label"),a(o,"for",u=`haystack-service-${l[79]}-${l[87]}`),p.__value="Ripgrep",p.value=p.__value,_.__value="Atomic",_.value=_.__value,a(d,"id",m=`haystack-service-${l[79]}-${l[87]}`),l[3].roles[l[79]].haystacks[l[87]].service===void 0&&ut(X),a(i,"class","select"),a(c,"class","control"),a(t,"class","field"),a(k,"class","label"),a(k,"for",y=`haystack-path-${l[79]}-${l[87]}`),a(h,"class","input"),a(h,"id",$=`haystack-path-${l[79]}-${l[87]}`),a(h,"type","text"),a(h,"placeholder",q=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?"https://localhost:9883":"/path/to/documents"),h.readOnly=O=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic",a(b,"class","control"),a(v,"class","field"),a(E,"id",G=`haystack-readonly-${l[79]}-${l[87]}`),a(E,"type","checkbox"),a(A,"class","checkbox"),a(A,"for",H=`haystack-readonly-${l[79]}-${l[87]}`),a(K,"class","field"),a(Z,"class","button is-small is-danger"),a(Z,"data-testid",I="remove-haystack-"+l[79]+"-"+l[87]),a(F,"class","field"),a(e,"class","box is-light")},m(te,ie){R(te,e,ie),s(e,t),s(t,o),s(o,n),s(t,r),s(t,c),s(c,i),s(i,d),s(d,p),s(d,_),He(d,l[3].roles[l[79]].haystacks[l[87]].service,!0),s(e,w),s(e,v),s(v,k),ge.m(k,null),s(v,S),s(v,b),s(b,h),Ue(h,l[3].roles[l[79]].haystacks[l[87]].path),s(b,N),fe&&fe.m(b,null),s(e,L),se&&se.m(e,null),s(e,Q),ce&&ce.m(e,null),s(e,V),s(e,K),s(K,A),s(A,E),E.checked=l[3].roles[l[79]].haystacks[l[87]].read_only,s(A,C),s(e,B),s(e,F),s(F,Z),s(Z,P),z||(W=[ee(d,"change",X),ee(h,"input",we),ee(h,"click",function(){jl(l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?he:void 0)&&(l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?he:void 0).apply(this,arguments)}),ee(E,"change",ke),ee(Z,"click",Ce)],z=!0)},p(te,ie){l=te,ie[0]&264&&u!==(u=`haystack-service-${l[79]}-${l[87]}`)&&a(o,"for",u),ie[0]&264&&m!==(m=`haystack-service-${l[79]}-${l[87]}`)&&a(d,"id",m),ie[0]&264&&He(d,l[3].roles[l[79]].haystacks[l[87]].service),oe!==(oe=D(l))&&(ge.d(1),ge=oe(l),ge&&(ge.c(),ge.m(k,null))),ie[0]&264&&y!==(y=`haystack-path-${l[79]}-${l[87]}`)&&a(k,"for",y),ie[0]&264&&$!==($=`haystack-path-${l[79]}-${l[87]}`)&&a(h,"id",$),ie[0]&264&&q!==(q=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?"https://localhost:9883":"/path/to/documents")&&a(h,"placeholder",q),ie[0]&280&&O!==(O=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic")&&(h.readOnly=O),ie[0]&264&&h.value!==l[3].roles[l[79]].haystacks[l[87]].path&&Ue(h,l[3].roles[l[79]].haystacks[l[87]].path),l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?fe||(fe=vn(),fe.c(),fe.m(b,null)):fe&&(fe.d(1),fe=null),l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?se?se.p(l,ie):(se=bn(l),se.c(),se.m(e,Q)):se&&(se.d(1),se=null),l[3].roles[l[79]].haystacks[l[87]].service==="Ripgrep"?ce?ce.p(l,ie):(ce=kn(l),ce.c(),ce.m(e,V)):ce&&(ce.d(1),ce=null),ie[0]&264&&G!==(G=`haystack-readonly-${l[79]}-${l[87]}`)&&a(E,"id",G),ie[0]&264&&(E.checked=l[3].roles[l[79]].haystacks[l[87]].read_only),ie[0]&264&&H!==(H=`haystack-readonly-${l[79]}-${l[87]}`)&&a(A,"for",H),ie[0]&264&&I!==(I="remove-haystack-"+l[79]+"-"+l[87])&&a(Z,"data-testid",I)},d(te){te&&T(e),ge.d(),fe&&fe.d(),se&&se.d(),ce&&ce.d(),z=!1,Qe(W)}}}function $n(l){var Z;let e,t,o,n,u,r,c,i,d,p,_,m,w,v,k,y,S,b,h,$,q,O,N,L,Q,V,K,A,E;function G(){l[47].call(c,l[79])}function C(){return l[48](l[79])}let H=((Z=l[0][l[79]])==null?void 0:Z.length)&&Cn(l);function B(){l[50].call(h,l[79])}function F(){l[51].call(L,l[79])}return{c(){e=f("div"),t=f("label"),o=U("Model"),u=g(),r=f("div"),c=f("input"),d=g(),p=f("button"),p.textContent="Fetch models",_=g(),H&&H.c(),m=g(),w=f("div"),v=f("label"),k=U("Base URL"),S=g(),b=f("div"),h=f("input"),q=g(),O=f("div"),N=f("label"),L=f("input"),V=U(`
               Automatically summarize search results`),a(t,"class","label"),a(t,"for",n=`llm-model-${l[79]}`),a(c,"class","input"),a(c,"id",i=`llm-model-${l[79]}`),a(c,"type","text"),a(c,"placeholder","llama3.1"),a(r,"class","control"),a(p,"class","button is-small"),a(e,"class","field"),a(v,"class","label"),a(v,"for",y=`llm-base-url-${l[79]}`),a(h,"class","input"),a(h,"id",$=`llm-base-url-${l[79]}`),a(h,"type","text"),a(h,"placeholder","http://127.0.0.1:11434"),a(b,"class","control"),a(w,"class","field"),a(L,"id",Q=`llm-auto-summarize-${l[79]}`),a(L,"type","checkbox"),a(N,"class","checkbox"),a(N,"for",K=`llm-auto-summarize-${l[79]}`),a(O,"class","field")},m(P,I){R(P,e,I),s(e,t),s(t,o),s(e,u),s(e,r),s(r,c),Ue(c,l[3].roles[l[79]].llm_model),s(e,d),s(e,p),s(e,_),H&&H.m(e,null),R(P,m,I),R(P,w,I),s(w,v),s(v,k),s(w,S),s(w,b),s(b,h),Ue(h,l[3].roles[l[79]].llm_base_url),R(P,q,I),R(P,O,I),s(O,N),s(N,L),L.checked=l[3].roles[l[79]].llm_auto_summarize,s(N,V),A||(E=[ee(c,"input",G),ee(p,"click",C),ee(h,"input",B),ee(L,"change",F)],A=!0)},p(P,I){var z;l=P,I[0]&264&&n!==(n=`llm-model-${l[79]}`)&&a(t,"for",n),I[0]&264&&i!==(i=`llm-model-${l[79]}`)&&a(c,"id",i),I[0]&264&&c.value!==l[3].roles[l[79]].llm_model&&Ue(c,l[3].roles[l[79]].llm_model),(z=l[0][l[79]])!=null&&z.length?H?H.p(l,I):(H=Cn(l),H.c(),H.m(e,null)):H&&(H.d(1),H=null),I[0]&264&&y!==(y=`llm-base-url-${l[79]}`)&&a(v,"for",y),I[0]&264&&$!==($=`llm-base-url-${l[79]}`)&&a(h,"id",$),I[0]&264&&h.value!==l[3].roles[l[79]].llm_base_url&&Ue(h,l[3].roles[l[79]].llm_base_url),I[0]&264&&Q!==(Q=`llm-auto-summarize-${l[79]}`)&&a(L,"id",Q),I[0]&264&&(L.checked=l[3].roles[l[79]].llm_auto_summarize),I[0]&264&&K!==(K=`llm-auto-summarize-${l[79]}`)&&a(N,"for",K)},d(P){P&&T(e),H&&H.d(),P&&T(m),P&&T(w),P&&T(q),P&&T(O),A=!1,Qe(E)}}}function Cn(l){let e,t,o,n,u=l[0][l[79]],r=[];for(let i=0;i<u.length;i+=1)r[i]=Sn(an(l,u,i));function c(...i){return l[49](l[79],...i)}return{c(){e=f("div"),t=f("select");for(let i=0;i<r.length;i+=1)r[i].c();a(e,"class","select is-fullwidth"),de(e,"margin-top","0.5rem")},m(i,d){R(i,e,d),s(e,t);for(let p=0;p<r.length;p+=1)r[p]&&r[p].m(t,null);o||(n=ee(t,"change",c),o=!0)},p(i,d){if(l=i,d[0]&9){u=l[0][l[79]];let p;for(p=0;p<u.length;p+=1){const _=an(l,u,p);r[p]?r[p].p(_,d):(r[p]=Sn(_),r[p].c(),r[p].m(t,null))}for(;p<r.length;p+=1)r[p].d(1);r.length=u.length}},d(i){i&&T(e),Ve(r,i),o=!1,n()}}}function Sn(l){let e,t=l[80]+"",o,n;return{c(){e=f("option"),o=U(t),e.__value=n=l[80],e.value=e.__value},m(u,r){R(u,e,r),s(e,o)},p(u,r){r[0]&9&&t!==(t=u[80]+"")&&ve(o,t),r[0]&265&&n!==(n=u[80])&&(e.__value=n,e.value=e.__value)},d(u){u&&T(e)}}}function Tn(l){var ie;let e,t,o,n,u,r,c,i,d,p,_,m,w,v,k,y,S,b,h,$,q,O,N,L,Q,V,K,A,E,G,C,H,B,F,Z,P,I,z,W,X,D,oe,ge,we;function he(){l[53].call(c,l[79])}function fe(){l[54].call(b,l[79])}function se(){return l[55](l[79])}let ce=((ie=l[0][l[79]])==null?void 0:ie.length)&&Rn(l);function ke(){l[57].call(A,l[79])}function Ce(){l[58].call(I,l[79])}let te=l[3].roles[l[79]].openrouter_chat_enabled&&Ln(l);return{c(){e=f("div"),t=f("label"),o=U("OpenRouter API Key"),u=g(),r=f("div"),c=f("input"),d=g(),p=f("p"),p.innerHTML='Get your API key from <a href="https://openrouter.ai" target="_blank" rel="noopener">OpenRouter</a>',_=g(),m=f("div"),w=f("label"),v=U("Model"),y=g(),S=f("div"),b=f("input"),$=g(),q=f("button"),q.textContent="Fetch models",O=g(),ce&&ce.c(),N=g(),L=f("p"),L.textContent="Choose the language model for generating summaries. Different models offer different speed/quality tradeoffs.",Q=g(),V=f("div"),K=f("label"),A=f("input"),G=U(`
               Automatically summarize search results`),H=g(),B=f("p"),B.textContent="When enabled, summaries will be generated and shown in search results.",F=g(),Z=f("div"),P=f("label"),I=f("input"),W=U(`
               Enable Chat interface (OpenRouter)`),D=g(),te&&te.c(),oe=ot(),a(t,"class","label"),a(t,"for",n=`openrouter-api-key-${l[79]}`),a(c,"class","input"),a(c,"id",i=`openrouter-api-key-${l[79]}`),a(c,"type","password"),a(c,"placeholder","sk-or-v1-..."),a(r,"class","control"),a(p,"class","help"),a(e,"class","field"),a(w,"class","label"),a(w,"for",k=`openrouter-model-${l[79]}`),a(b,"class","input"),a(b,"id",h=`openrouter-model-${l[79]}`),a(b,"type","text"),a(b,"placeholder","openai/gpt-4-turbo"),a(S,"class","control"),a(q,"class","button is-small"),a(L,"class","help"),a(m,"class","field"),a(A,"id",E=`openrouter-auto-summarize-${l[79]}`),a(A,"type","checkbox"),a(K,"class","checkbox"),a(K,"for",C=`openrouter-auto-summarize-${l[79]}`),a(B,"class","help"),a(V,"class","field"),a(I,"id",z=`openrouter-chat-enabled-${l[79]}`),a(I,"type","checkbox"),a(P,"class","checkbox"),a(P,"for",X=`openrouter-chat-enabled-${l[79]}`),a(Z,"class","field")},m(ae,ue){R(ae,e,ue),s(e,t),s(t,o),s(e,u),s(e,r),s(r,c),Ue(c,l[3].roles[l[79]].openrouter_api_key),s(e,d),s(e,p),R(ae,_,ue),R(ae,m,ue),s(m,w),s(w,v),s(m,y),s(m,S),s(S,b),Ue(b,l[3].roles[l[79]].openrouter_model),s(m,$),s(m,q),s(m,O),ce&&ce.m(m,null),s(m,N),s(m,L),R(ae,Q,ue),R(ae,V,ue),s(V,K),s(K,A),A.checked=l[3].roles[l[79]].openrouter_auto_summarize,s(K,G),s(V,H),s(V,B),R(ae,F,ue),R(ae,Z,ue),s(Z,P),s(P,I),I.checked=l[3].roles[l[79]].openrouter_chat_enabled,s(P,W),R(ae,D,ue),te&&te.m(ae,ue),R(ae,oe,ue),ge||(we=[ee(c,"input",he),ee(b,"input",fe),ee(q,"click",se),ee(A,"change",ke),ee(I,"change",Ce)],ge=!0)},p(ae,ue){var Ee;l=ae,ue[0]&264&&n!==(n=`openrouter-api-key-${l[79]}`)&&a(t,"for",n),ue[0]&264&&i!==(i=`openrouter-api-key-${l[79]}`)&&a(c,"id",i),ue[0]&264&&c.value!==l[3].roles[l[79]].openrouter_api_key&&Ue(c,l[3].roles[l[79]].openrouter_api_key),ue[0]&264&&k!==(k=`openrouter-model-${l[79]}`)&&a(w,"for",k),ue[0]&264&&h!==(h=`openrouter-model-${l[79]}`)&&a(b,"id",h),ue[0]&264&&b.value!==l[3].roles[l[79]].openrouter_model&&Ue(b,l[3].roles[l[79]].openrouter_model),(Ee=l[0][l[79]])!=null&&Ee.length?ce?ce.p(l,ue):(ce=Rn(l),ce.c(),ce.m(m,N)):ce&&(ce.d(1),ce=null),ue[0]&264&&E!==(E=`openrouter-auto-summarize-${l[79]}`)&&a(A,"id",E),ue[0]&264&&(A.checked=l[3].roles[l[79]].openrouter_auto_summarize),ue[0]&264&&C!==(C=`openrouter-auto-summarize-${l[79]}`)&&a(K,"for",C),ue[0]&264&&z!==(z=`openrouter-chat-enabled-${l[79]}`)&&a(I,"id",z),ue[0]&264&&(I.checked=l[3].roles[l[79]].openrouter_chat_enabled),ue[0]&264&&X!==(X=`openrouter-chat-enabled-${l[79]}`)&&a(P,"for",X),l[3].roles[l[79]].openrouter_chat_enabled?te?te.p(l,ue):(te=Ln(l),te.c(),te.m(oe.parentNode,oe)):te&&(te.d(1),te=null)},d(ae){ae&&T(e),ae&&T(_),ae&&T(m),ce&&ce.d(),ae&&T(Q),ae&&T(V),ae&&T(F),ae&&T(Z),ae&&T(D),te&&te.d(ae),ae&&T(oe),ge=!1,Qe(we)}}}function Rn(l){let e,t,o,n,u=l[0][l[79]],r=[];for(let i=0;i<u.length;i+=1)r[i]=An(rn(l,u,i));function c(...i){return l[56](l[79],...i)}return{c(){e=f("div"),t=f("select");for(let i=0;i<r.length;i+=1)r[i].c();a(e,"class","select is-fullwidth"),de(e,"margin-top","0.5rem")},m(i,d){R(i,e,d),s(e,t);for(let p=0;p<r.length;p+=1)r[p]&&r[p].m(t,null);o||(n=ee(t,"change",c),o=!0)},p(i,d){if(l=i,d[0]&9){u=l[0][l[79]];let p;for(p=0;p<u.length;p+=1){const _=rn(l,u,p);r[p]?r[p].p(_,d):(r[p]=An(_),r[p].c(),r[p].m(t,null))}for(;p<r.length;p+=1)r[p].d(1);r.length=u.length}},d(i){i&&T(e),Ve(r,i),o=!1,n()}}}function An(l){let e,t=l[80]+"",o,n;return{c(){e=f("option"),o=U(t),e.__value=n=l[80],e.value=e.__value},m(u,r){R(u,e,r),s(e,o)},p(u,r){r[0]&9&&t!==(t=u[80]+"")&&ve(o,t),r[0]&265&&n!==(n=u[80])&&(e.__value=n,e.value=e.__value)},d(u){u&&T(e)}}}function Ln(l){let e,t,o,n,u,r,c,i,d,p,_,m,w,v,k,y,S,b,h,$,q,O,N,L,Q;function V(){l[59].call(i,l[79])}function K(){l[60].call(O,l[79])}return{c(){e=f("div"),t=f("label"),o=U("Chat Model"),u=g(),r=f("div"),c=f("div"),i=f("select"),d=f("option"),d.textContent="GPT-3.5 Turbo",p=f("option"),p.textContent="GPT-4",_=f("option"),_.textContent="Claude 3 Sonnet",m=f("option"),m.textContent="Claude 3 Haiku",w=f("option"),w.textContent="Mixtral 8x7B",k=g(),y=f("div"),S=f("label"),b=U("System Prompt (optional)"),$=g(),q=f("div"),O=f("textarea"),a(t,"class","label"),a(t,"for",n=`openrouter-chat-model-${l[79]}`),d.__value="openai/gpt-3.5-turbo",d.value=d.__value,p.__value="openai/gpt-4",p.value=p.__value,_.__value="anthropic/claude-3-sonnet",_.value=_.__value,m.__value="anthropic/claude-3-haiku",m.value=m.__value,w.__value="mistralai/mixtral-8x7b-instruct",w.value=w.__value,a(i,"id",v=`openrouter-chat-model-${l[79]}`),l[3].roles[l[79]].openrouter_chat_model===void 0&&ut(V),a(c,"class","select is-fullwidth"),a(r,"class","control"),a(e,"class","field"),a(S,"class","label"),a(S,"for",h=`openrouter-chat-system-${l[79]}`),a(O,"class","textarea"),a(O,"id",N=`openrouter-chat-system-${l[79]}`),a(O,"rows","3"),a(O,"placeholder","You are a helpful Rust engineer assistant..."),a(q,"class","control"),a(y,"class","field")},m(A,E){R(A,e,E),s(e,t),s(t,o),s(e,u),s(e,r),s(r,c),s(c,i),s(i,d),s(i,p),s(i,_),s(i,m),s(i,w),He(i,l[3].roles[l[79]].openrouter_chat_model,!0),R(A,k,E),R(A,y,E),s(y,S),s(S,b),s(y,$),s(y,q),s(q,O),Ue(O,l[3].roles[l[79]].openrouter_chat_system_prompt),L||(Q=[ee(i,"change",V),ee(O,"input",K)],L=!0)},p(A,E){l=A,E[0]&264&&n!==(n=`openrouter-chat-model-${l[79]}`)&&a(t,"for",n),E[0]&264&&v!==(v=`openrouter-chat-model-${l[79]}`)&&a(i,"id",v),E[0]&264&&He(i,l[3].roles[l[79]].openrouter_chat_model),E[0]&264&&h!==(h=`openrouter-chat-system-${l[79]}`)&&a(S,"for",h),E[0]&264&&N!==(N=`openrouter-chat-system-${l[79]}`)&&a(O,"id",N),E[0]&264&&Ue(O,l[3].roles[l[79]].openrouter_chat_system_prompt)},d(A){A&&T(e),A&&T(k),A&&T(y),L=!1,Qe(Q)}}}function En(l){let e;return{c(){e=f("p"),e.textContent="Click to select directory",a(e,"class","help")},m(t,o){R(t,e,o)},d(t){t&&T(e)}}}function Pn(l,e){let t,o,n,u,r,c,i,d,p,_,m,w,v,k,y,S,b,h,$,q,O,N,L,Q,V,K,A,E,G,C,H,B,F,Z,P,I,z,W,X,D,oe,ge,we,he,fe,se,ce,ke,Ce,te,ie,ae,ue,Ee,We,Ke,Pe,Re,x,ne,Se,Ae,et,Ne,ft,nt,vt,Ye,st,dt,Ie,Rt,M,le,j,re,ye,be,Fe,Je,De,Ge,bt,pt,il,zt,al,Vt,Ft,ul,It,kt,Fl,_l,Wl,ml,$t,hl,Kl,Qt,Yt,Gl,gl,ql,Wt,rt,vl,Bl,Jl,bl,Zt,Xt,Vl,kl,Ql,wl,Et,xt,el,yl,Yl,tl,jt,Dt,$l,Zl,Cl,Xl,Kt,Mt,Sl,xl,Tl,eo,to,lo,Gt,oo,Rl,Nl,no;function ss(){e[26].call(d,e[79])}function rs(){e[27].call(b,e[79])}let ll=e[8],it=[];for(let je=0;je<ll.length;je+=1)it[je]=gn(fn(e,ll,je));function so(){e[28].call(A,e[79])}function ro(){e[29].call(z,e[79])}function is(){e[30].call(ce,e[79])}let ol=e[77].haystacks,at=[];for(let je=0;je<ol.length;je+=1)at[je]=yn(un(e,ol,je));function as(){return e[45](e[79])}function io(){e[46].call(Ye,e[79])}let _t=e[3].roles[e[79]].llm_provider==="ollama"&&$n(e);function us(){e[52].call(De,e[79])}let mt=e[3].roles[e[79]].openrouter_enabled&&Tn(e);function cs(){e[61].call($t,e[79])}function fs(){e[62].call(rt,e[79])}function ao(){return e[63](e[79])}let wt=e[4]&&En();function uo(){e[64].call(Et,e[79])}function ds(){e[65].call(Dt,e[79])}function ps(){e[66].call(Mt,e[79])}function _s(){return e[67](e[79])}return{key:l,first:null,c(){t=f("div"),o=f("div"),n=f("label"),u=U("Role name"),c=g(),i=f("div"),d=f("input"),_=g(),m=f("div"),w=f("label"),v=U("Short name"),y=g(),S=f("div"),b=f("input"),$=g(),q=f("div"),O=f("label"),N=U("Theme"),Q=g(),V=f("div"),K=f("div"),A=f("select");for(let je=0;je<it.length;je+=1)it[je].c();G=g(),C=f("div"),H=f("label"),B=U("Relevance function"),Z=g(),P=f("div"),I=f("div"),z=f("select"),W=f("option"),W.textContent="title-scorer",X=f("option"),X.textContent="terraphim-graph",D=f("option"),D.textContent="bm25",oe=f("option"),oe.textContent="bm25f",ge=f("option"),ge.textContent="bm25plus",he=g(),fe=f("div"),se=f("label"),ce=f("input"),Ce=U(`
            Enable Terraphim IT features (KG preprocessing, auto-linking)`),ie=g(),ae=f("h5"),ae.textContent="Haystacks",ue=g();for(let je=0;je<at.length;je+=1)at[je].c();Ee=g(),We=f("button"),Ke=U("Add Haystack"),Re=g(),x=f("h5"),x.textContent="AI-Enhanced Summaries (LLM Provider)",ne=g(),Se=f("div"),Ae=f("label"),et=U("Provider"),ft=g(),nt=f("div"),vt=f("div"),Ye=f("select"),st=f("option"),st.textContent="(none)",dt=f("option"),dt.textContent="OpenRouter",Ie=f("option"),Ie.textContent="Ollama (local)",M=g(),le=f("p"),le.textContent="Choose a provider. OpenRouter uses API key; Ollama runs locally.",j=g(),_t&&_t.c(),re=g(),ye=f("h5"),ye.textContent="AI-Enhanced Summaries (OpenRouter)",be=g(),Fe=f("div"),Je=f("label"),De=f("input"),bt=U(`
             Enable AI-generated article summaries`),il=g(),zt=f("p"),zt.textContent="Generate intelligent summaries using OpenRouter's language models",al=g(),mt&&mt.c(),Vt=g(),Ft=f("h5"),Ft.textContent="Knowledge Graph",ul=g(),It=f("div"),kt=f("label"),Fl=U("Remote automata URL"),Wl=g(),ml=f("div"),$t=f("input"),Kl=g(),Qt=f("div"),Yt=f("label"),Gl=U("Local KG path"),ql=g(),Wt=f("div"),rt=f("input"),Bl=g(),wt&&wt.c(),Jl=g(),bl=f("div"),Zt=f("div"),Xt=f("label"),Vl=U("Local KG type"),Ql=g(),wl=f("div"),Et=f("select"),xt=f("option"),xt.textContent="markdown",el=f("option"),el.textContent="json",Yl=g(),tl=f("div"),jt=f("label"),Dt=f("input"),Zl=U(`
             Public`),Xl=g(),Kt=f("label"),Mt=f("input"),xl=U(`
             Publish`),eo=g(),to=f("hr"),lo=g(),Gt=f("button"),oo=U("Remove Role"),a(n,"class","label"),a(n,"for",r=`role-name-${e[79]}`),a(d,"class","input"),a(d,"id",p=`role-name-${e[79]}`),a(d,"type","text"),a(i,"class","control"),a(o,"class","field"),a(w,"class","label"),a(w,"for",k=`role-shortname-${e[79]}`),a(b,"class","input"),a(b,"id",h=`role-shortname-${e[79]}`),a(b,"type","text"),a(S,"class","control"),a(m,"class","field"),a(O,"class","label"),a(O,"for",L=`role-theme-${e[79]}`),a(A,"id",E=`role-theme-${e[79]}`),e[3].roles[e[79]].theme===void 0&&ut(so),a(K,"class","select is-fullwidth"),a(V,"class","control"),a(q,"class","field"),a(H,"class","label"),a(H,"for",F=`role-relevance-${e[79]}`),W.__value="title-scorer",W.value=W.__value,X.__value="terraphim-graph",X.value=X.__value,D.__value="bm25",D.value=D.__value,oe.__value="bm25f",oe.value=oe.__value,ge.__value="bm25plus",ge.value=ge.__value,a(z,"id",we=`role-relevance-${e[79]}`),e[3].roles[e[79]].relevance_function===void 0&&ut(ro),a(I,"class","select is-fullwidth"),a(P,"class","control"),a(C,"class","field"),a(ce,"class","checkbox"),a(ce,"id",ke=`role-terraphim-it-${e[79]}`),a(ce,"type","checkbox"),a(se,"class","label"),a(se,"for",te=`role-terraphim-it-${e[79]}`),a(fe,"class","field"),a(ae,"class","title is-6"),a(We,"class","button is-small"),a(We,"data-testid",Pe="add-haystack-"+e[79]),a(x,"class","title is-6"),a(Ae,"class","label"),a(Ae,"for",Ne=`llm-provider-${e[79]}`),st.__value="",st.value=st.__value,dt.__value="openrouter",dt.value=dt.__value,Ie.__value="ollama",Ie.value=Ie.__value,a(Ye,"id",Rt=`llm-provider-${e[79]}`),e[3].roles[e[79]].llm_provider===void 0&&ut(io),a(vt,"class","select"),a(nt,"class","control"),a(le,"class","help"),a(Se,"class","field"),a(ye,"class","title is-6"),a(De,"id",Ge=`openrouter-enabled-${e[79]}`),a(De,"type","checkbox"),a(Je,"class","checkbox"),a(Je,"for",pt=`openrouter-enabled-${e[79]}`),a(zt,"class","help"),a(Fe,"class","field"),a(Ft,"class","title is-6"),a(kt,"class","label"),a(kt,"for",_l=`kg-url-${e[79]}`),a($t,"class","input"),a($t,"id",hl=`kg-url-${e[79]}`),a($t,"type","text"),a($t,"placeholder","https://example.com/thesaurus.json"),a(ml,"class","control"),a(It,"class","field"),a(Yt,"class","label"),a(Yt,"for",gl=`kg-local-path-${e[79]}`),a(rt,"class","input"),a(rt,"id",vl=`kg-local-path-${e[79]}`),a(rt,"type","text"),a(rt,"placeholder","/path/to/markdown"),rt.readOnly=e[4],a(Wt,"class","control"),a(Qt,"class","field"),a(Xt,"class","label"),a(Xt,"for",kl=`kg-local-type-${e[79]}`),xt.__value="markdown",xt.value=xt.__value,el.__value="json",el.value=el.__value,a(Et,"id",yl=`kg-local-type-${e[79]}`),e[3].roles[e[79]].kg.local_type===void 0&&ut(uo),a(wl,"class","select"),a(Zt,"class","control"),a(bl,"class","field is-grouped"),a(Dt,"id",$l=`kg-public-${e[79]}`),a(Dt,"type","checkbox"),a(jt,"class","checkbox"),a(jt,"for",Cl=`kg-public-${e[79]}`),de(jt,"margin-right","1rem"),a(Mt,"id",Sl=`kg-publish-${e[79]}`),a(Mt,"type","checkbox"),a(Kt,"class","checkbox"),a(Kt,"for",Tl=`kg-publish-${e[79]}`),a(tl,"class","field is-grouped"),a(Gt,"class","button is-small is-danger"),a(Gt,"data-testid",Rl="remove-role-"+e[79]),a(t,"class","box"),this.first=t},m(je,$e){R(je,t,$e),s(t,o),s(o,n),s(n,u),s(o,c),s(o,i),s(i,d),Ue(d,e[3].roles[e[79]].name),s(t,_),s(t,m),s(m,w),s(w,v),s(m,y),s(m,S),s(S,b),Ue(b,e[3].roles[e[79]].shortname),s(t,$),s(t,q),s(q,O),s(O,N),s(q,Q),s(q,V),s(V,K),s(K,A);for(let Le=0;Le<it.length;Le+=1)it[Le]&&it[Le].m(A,null);He(A,e[3].roles[e[79]].theme,!0),s(t,G),s(t,C),s(C,H),s(H,B),s(C,Z),s(C,P),s(P,I),s(I,z),s(z,W),s(z,X),s(z,D),s(z,oe),s(z,ge),He(z,e[3].roles[e[79]].relevance_function,!0),s(t,he),s(t,fe),s(fe,se),s(se,ce),ce.checked=e[3].roles[e[79]].terraphim_it,s(se,Ce),s(t,ie),s(t,ae),s(t,ue);for(let Le=0;Le<at.length;Le+=1)at[Le]&&at[Le].m(t,null);s(t,Ee),s(t,We),s(We,Ke),s(t,Re),s(t,x),s(t,ne),s(t,Se),s(Se,Ae),s(Ae,et),s(Se,ft),s(Se,nt),s(nt,vt),s(vt,Ye),s(Ye,st),s(Ye,dt),s(Ye,Ie),He(Ye,e[3].roles[e[79]].llm_provider,!0),s(Se,M),s(Se,le),s(t,j),_t&&_t.m(t,null),s(t,re),s(t,ye),s(t,be),s(t,Fe),s(Fe,Je),s(Je,De),De.checked=e[3].roles[e[79]].openrouter_enabled,s(Je,bt),s(Fe,il),s(Fe,zt),s(t,al),mt&&mt.m(t,null),s(t,Vt),s(t,Ft),s(t,ul),s(t,It),s(It,kt),s(kt,Fl),s(It,Wl),s(It,ml),s(ml,$t),Ue($t,e[3].roles[e[79]].kg.url),s(t,Kl),s(t,Qt),s(Qt,Yt),s(Yt,Gl),s(Qt,ql),s(Qt,Wt),s(Wt,rt),Ue(rt,e[3].roles[e[79]].kg.local_path),s(Wt,Bl),wt&&wt.m(Wt,null),s(t,Jl),s(t,bl),s(bl,Zt),s(Zt,Xt),s(Xt,Vl),s(Zt,Ql),s(Zt,wl),s(wl,Et),s(Et,xt),s(Et,el),He(Et,e[3].roles[e[79]].kg.local_type,!0),s(t,Yl),s(t,tl),s(tl,jt),s(jt,Dt),Dt.checked=e[3].roles[e[79]].kg.public,s(jt,Zl),s(tl,Xl),s(tl,Kt),s(Kt,Mt),Mt.checked=e[3].roles[e[79]].kg.publish,s(Kt,xl),s(t,eo),s(t,to),s(t,lo),s(t,Gt),s(Gt,oo),Nl||(no=[ee(d,"input",ss),ee(b,"input",rs),ee(A,"change",so),ee(z,"change",ro),ee(ce,"change",is),ee(We,"click",as),ee(Ye,"change",io),ee(De,"change",us),ee($t,"input",cs),ee(rt,"input",fs),ee(rt,"click",function(){jl(e[4]?ao:void 0)&&(e[4]?ao:void 0).apply(this,arguments)}),ee(Et,"change",uo),ee(Dt,"change",ds),ee(Mt,"change",ps),ee(Gt,"click",_s)],Nl=!0)},p(je,$e){if(e=je,$e[0]&264&&r!==(r=`role-name-${e[79]}`)&&a(n,"for",r),$e[0]&264&&p!==(p=`role-name-${e[79]}`)&&a(d,"id",p),$e[0]&264&&d.value!==e[3].roles[e[79]].name&&Ue(d,e[3].roles[e[79]].name),$e[0]&264&&k!==(k=`role-shortname-${e[79]}`)&&a(w,"for",k),$e[0]&264&&h!==(h=`role-shortname-${e[79]}`)&&a(b,"id",h),$e[0]&264&&b.value!==e[3].roles[e[79]].shortname&&Ue(b,e[3].roles[e[79]].shortname),$e[0]&264&&L!==(L=`role-theme-${e[79]}`)&&a(O,"for",L),$e[0]&256){ll=e[8];let Le;for(Le=0;Le<ll.length;Le+=1){const cl=fn(e,ll,Le);it[Le]?it[Le].p(cl,$e):(it[Le]=gn(cl),it[Le].c(),it[Le].m(A,null))}for(;Le<it.length;Le+=1)it[Le].d(1);it.length=ll.length}if($e[0]&264&&E!==(E=`role-theme-${e[79]}`)&&a(A,"id",E),$e[0]&264&&He(A,e[3].roles[e[79]].theme),$e[0]&264&&F!==(F=`role-relevance-${e[79]}`)&&a(H,"for",F),$e[0]&264&&we!==(we=`role-relevance-${e[79]}`)&&a(z,"id",we),$e[0]&264&&He(z,e[3].roles[e[79]].relevance_function),$e[0]&264&&ke!==(ke=`role-terraphim-it-${e[79]}`)&&a(ce,"id",ke),$e[0]&264&&(ce.checked=e[3].roles[e[79]].terraphim_it),$e[0]&264&&te!==(te=`role-terraphim-it-${e[79]}`)&&a(se,"for",te),$e[0]&491576){ol=e[77].haystacks;let Le;for(Le=0;Le<ol.length;Le+=1){const cl=un(e,ol,Le);at[Le]?at[Le].p(cl,$e):(at[Le]=yn(cl),at[Le].c(),at[Le].m(t,Ee))}for(;Le<at.length;Le+=1)at[Le].d(1);at.length=ol.length}$e[0]&264&&Pe!==(Pe="add-haystack-"+e[79])&&a(We,"data-testid",Pe),$e[0]&264&&Ne!==(Ne=`llm-provider-${e[79]}`)&&a(Ae,"for",Ne),$e[0]&264&&Rt!==(Rt=`llm-provider-${e[79]}`)&&a(Ye,"id",Rt),$e[0]&264&&He(Ye,e[3].roles[e[79]].llm_provider),e[3].roles[e[79]].llm_provider==="ollama"?_t?_t.p(e,$e):(_t=$n(e),_t.c(),_t.m(t,re)):_t&&(_t.d(1),_t=null),$e[0]&264&&Ge!==(Ge=`openrouter-enabled-${e[79]}`)&&a(De,"id",Ge),$e[0]&264&&(De.checked=e[3].roles[e[79]].openrouter_enabled),$e[0]&264&&pt!==(pt=`openrouter-enabled-${e[79]}`)&&a(Je,"for",pt),e[3].roles[e[79]].openrouter_enabled?mt?mt.p(e,$e):(mt=Tn(e),mt.c(),mt.m(t,Vt)):mt&&(mt.d(1),mt=null),$e[0]&264&&_l!==(_l=`kg-url-${e[79]}`)&&a(kt,"for",_l),$e[0]&264&&hl!==(hl=`kg-url-${e[79]}`)&&a($t,"id",hl),$e[0]&264&&$t.value!==e[3].roles[e[79]].kg.url&&Ue($t,e[3].roles[e[79]].kg.url),$e[0]&264&&gl!==(gl=`kg-local-path-${e[79]}`)&&a(Yt,"for",gl),$e[0]&264&&vl!==(vl=`kg-local-path-${e[79]}`)&&a(rt,"id",vl),$e[0]&16&&(rt.readOnly=e[4]),$e[0]&264&&rt.value!==e[3].roles[e[79]].kg.local_path&&Ue(rt,e[3].roles[e[79]].kg.local_path),e[4]?wt||(wt=En(),wt.c(),wt.m(Wt,null)):wt&&(wt.d(1),wt=null),$e[0]&264&&kl!==(kl=`kg-local-type-${e[79]}`)&&a(Xt,"for",kl),$e[0]&264&&yl!==(yl=`kg-local-type-${e[79]}`)&&a(Et,"id",yl),$e[0]&264&&He(Et,e[3].roles[e[79]].kg.local_type),$e[0]&264&&$l!==($l=`kg-public-${e[79]}`)&&a(Dt,"id",$l),$e[0]&264&&(Dt.checked=e[3].roles[e[79]].kg.public),$e[0]&264&&Cl!==(Cl=`kg-public-${e[79]}`)&&a(jt,"for",Cl),$e[0]&264&&Sl!==(Sl=`kg-publish-${e[79]}`)&&a(Mt,"id",Sl),$e[0]&264&&(Mt.checked=e[3].roles[e[79]].kg.publish),$e[0]&264&&Tl!==(Tl=`kg-publish-${e[79]}`)&&a(Kt,"for",Tl),$e[0]&264&&Rl!==(Rl="remove-role-"+e[79])&&a(Gt,"data-testid",Rl)},d(je){je&&T(t),Ve(it,je),Ve(at,je),_t&&_t.d(),mt&&mt.d(),wt&&wt.d(),Nl=!1,Qe(no)}}}function On(l){let e,t=l[74]+"",o;return{c(){e=f("option"),o=U(t),e.__value=l[74],e.value=e.__value},m(n,u){R(n,e,u),s(e,o)},p:Te,d(n){n&&T(e)}}}function Nn(l){let e,t=l[71].name+"",o,n;return{c(){e=f("option"),o=U(t),e.__value=n=l[71].name,e.value=e.__value},m(u,r){R(u,e,r),s(e,o)},p(u,r){r[0]&8&&t!==(t=u[71].name+"")&&ve(o,t),r[0]&264&&n!==(n=u[71].name)&&(e.__value=n,e.value=e.__value)},d(u){u&&T(e)}}}function Un(l){let e,t,o;return{c(){e=f("button"),e.textContent="Back",a(e,"class","button"),a(e,"data-testid","wizard-back")},m(n,u){R(n,e,u),t||(o=ee(e,"click",l[11]),t=!0)},p:Te,d(n){n&&T(e),t=!1,o()}}}function Ai(l){let e,t,o;return{c(){e=f("button"),e.textContent="Save",a(e,"class","button is-success"),a(e,"data-testid","wizard-save")},m(n,u){R(n,e,u),t||(o=ee(e,"click",l[19]),t=!0)},p:Te,d(n){n&&T(e),t=!1,o()}}}function Li(l){let e,t,o;return{c(){e=f("button"),e.textContent="Next",a(e,"class","button is-primary"),a(e,"data-testid","wizard-next")},m(n,u){R(n,e,u),t||(o=ee(e,"click",l[10]),t=!0)},p:Te,d(n){n&&T(e),t=!1,o()}}}function Ei(l){let e,t,o,n,u,r,c,i,d,p,_,m,w,v,k,y,S,b;e=new rl({props:{fallbackPath:"/"}});let h=l[2]==="success"&&_n(l),$=l[2]==="error"&&mn(l);function q(A,E){return A[1]===1?Si:A[1]===2?Ci:$i}let O=q(l),N=O(l),L=l[1]>1&&Un(l);function Q(A,E){return A[1]<ns?Li:Ai}let V=Q(l),K=V(l);return{c(){pe(e.$$.fragment),t=g(),o=f("div"),n=f("div"),u=f("h3"),u.textContent="Configuration Wizard",r=g(),c=f("button"),c.textContent="Close",i=g(),h&&h.c(),d=g(),$&&$.c(),p=g(),N.c(),_=g(),m=f("nav"),w=f("div"),L&&L.c(),v=g(),k=f("div"),K.c(),a(u,"class","title is-4"),de(u,"margin-bottom","0"),a(c,"class","button is-small is-light"),a(c,"aria-label","Close configuration wizard"),a(n,"class","is-flex is-justify-content-space-between is-align-items-center"),de(n,"gap",".5rem"),a(w,"class","level-left"),a(k,"class","level-right"),a(m,"class","level"),a(o,"class","box")},m(A,E){_e(e,A,E),R(A,t,E),R(A,o,E),s(o,n),s(n,u),s(n,r),s(n,c),s(o,i),h&&h.m(o,null),s(o,d),$&&$.m(o,null),s(o,p),N.m(o,null),s(o,_),s(o,m),s(m,w),L&&L.m(w,null),s(m,v),s(m,k),K.m(k,null),y=!0,S||(b=ee(c,"click",Pi),S=!0)},p(A,E){A[2]==="success"?h?h.p(A,E):(h=_n(A),h.c(),h.m(o,d)):h&&(h.d(1),h=null),A[2]==="error"?$?$.p(A,E):($=mn(A),$.c(),$.m(o,p)):$&&($.d(1),$=null),O===(O=q(A))&&N?N.p(A,E):(N.d(1),N=O(A),N&&(N.c(),N.m(o,_))),A[1]>1?L?L.p(A,E):(L=Un(A),L.c(),L.m(w,null)):L&&(L.d(1),L=null),V===(V=Q(A))&&K?K.p(A,E):(K.d(1),K=V(A),K&&(K.c(),K.m(k,null)))},i(A){y||(J(e.$$.fragment,A),y=!0)},o(A){Y(e.$$.fragment,A),y=!1},d(A){me(e,A),A&&T(t),A&&T(o),h&&h.d(),$&&$.d(),N.d(),L&&L.d(),K.d(),S=!1,b()}}}const ns=3;function Pi(){typeof window<"u"&&window.history.back()}function Oi(l,e,t){let o,n;Oe(l,ze,M=>t(4,n=M));const u=Lt(null);async function r(M,le){if(Ze(ze))try{const j=await on({directory:!0,multiple:!1});j&&typeof j=="string"&&i.update(re=>(re.roles[M].haystacks[le].path=j,re))}catch(j){console.error("Failed to open folder selector:",j)}}async function c(M){if(Ze(ze))try{const le=await on({directory:!0,multiple:!1});le&&typeof le=="string"&&i.update(j=>(j.roles[M].kg.local_path=le,j))}catch(le){console.error("Failed to open folder selector:",le)}}const i=Lt({id:"Desktop",global_shortcut:"Ctrl+X",default_theme:"spacelab",default_role:"Default",roles:[]});Oe(l,i,M=>t(3,o=M));const d=["default","darkly","cerulean","cosmo","cyborg","flatly","journal","litera","lumen","lux","materia","minty","nuclear","pulse","sandstone","simplex","slate","solar","spacelab","superhero","united","yeti"];Bt(async()=>{try{let M;Ze(ze)?M=await Me("get_config_schema"):M=await(await fetch("/config/schema")).json(),u.set(M);const le=Ze(Tt);le&&le.id&&i.update(j=>{var re;return{...j,id:le.id,global_shortcut:le.global_shortcut,default_theme:((re=le.roles[le.default_role])==null?void 0:re.theme)??"spacelab",default_role:le.default_role,roles:Object.values(le.roles).map(ye=>{var De,Ge,bt,pt,il,zt,al,Vt,Ft,ul,It;const be=(De=ye.kg)==null?void 0:De.automata_path,Fe=(be==null?void 0:be.Remote)??"",Je=((bt=(Ge=ye.kg)==null?void 0:Ge.knowledge_graph_local)==null?void 0:bt.path)??"";return{name:ye.name,shortname:ye.shortname,relevance_function:ye.relevance_function,terraphim_it:ye.terraphim_it??!1,theme:ye.theme,haystacks:(ye.haystacks??[]).map(kt=>({path:kt.location||kt.path||"",read_only:kt.read_only??!1,service:kt.service||"Ripgrep",atomic_server_secret:kt.atomic_server_secret||"",extra_parameters:kt.extra_parameters||{}})),kg:{url:Fe,local_path:Je,local_type:((il=(pt=ye.kg)==null?void 0:pt.knowledge_graph_local)==null?void 0:il.input_type)??"markdown",public:((zt=ye.kg)==null?void 0:zt.public)??!1,publish:((al=ye.kg)==null?void 0:al.publish)??!1},openrouter_enabled:ye.openrouter_enabled??!1,openrouter_api_key:ye.openrouter_api_key??"",openrouter_model:ye.openrouter_model??"openai/gpt-3.5-turbo",openrouter_auto_summarize:ye.openrouter_auto_summarize??!1,openrouter_chat_enabled:ye.openrouter_chat_enabled??!1,openrouter_chat_model:ye.openrouter_chat_model??ye.openrouter_model??"openai/gpt-3.5-turbo",openrouter_chat_system_prompt:ye.openrouter_chat_system_prompt??"",llm_provider:((Vt=ye.extra)==null?void 0:Vt.llm_provider)??"",llm_model:((Ft=ye.extra)==null?void 0:Ft.llm_model)??"",llm_base_url:((ul=ye.extra)==null?void 0:ul.llm_base_url)??"",llm_auto_summarize:((It=ye.extra)==null?void 0:It.llm_auto_summarize)??!1}})}})}catch(M){console.error("Failed to load schema",M)}}),Bt(()=>{const M=le=>{le.key==="Escape"&&typeof window<"u"&&window.history.back()};return window.addEventListener("keydown",M),()=>window.removeEventListener("keydown",M)});let p={};async function _(M){var be;const j=Ze(i).roles[M],re=j.llm_provider||(j.openrouter_enabled?"openrouter":""),ye=[];try{if(re==="ollama"){const Fe=(j.llm_base_url||"http://127.0.0.1:11434").replace(/\/$/,""),De=await(await fetch(`${Fe}/api/tags`)).json();if(Array.isArray(De==null?void 0:De.models))for(const Ge of De.models)Ge!=null&&Ge.name&&ye.push(Ge.name)}else if(re==="openrouter"){const Fe=(be=j.openrouter_api_key)==null?void 0:be.trim();if(!Fe)throw new Error("OpenRouter API key required");const De=await(await fetch("https://openrouter.ai/api/v1/models",{headers:{Authorization:`Bearer ${Fe}`,"HTTP-Referer":"https://terraphim.ai","X-Title":"Terraphim Desktop"}})).json(),Ge=Array.isArray(De==null?void 0:De.data)?De.data:[];for(const bt of Ge)bt!=null&&bt.id&&ye.push(bt.id)}}catch(Fe){console.error("Failed to fetch models",Fe)}t(0,p={...p,[M]:ye})}let m=1,w="";function v(){m<ns&&t(1,m+=1)}function k(){m>1&&t(1,m-=1)}function y(){i.update(M=>({...M,roles:[...M.roles,{name:"New Role",shortname:"new",relevance_function:"title-scorer",terraphim_it:!1,theme:"spacelab",haystacks:[],kg:{url:"",local_path:"",local_type:"markdown",public:!1,publish:!1},openrouter_enabled:!1,openrouter_api_key:"",openrouter_model:"openai/gpt-3.5-turbo",openrouter_auto_summarize:!1,openrouter_chat_enabled:!1,openrouter_chat_model:"openai/gpt-3.5-turbo",openrouter_chat_system_prompt:"",llm_provider:"",llm_model:"",llm_base_url:"",llm_auto_summarize:!1}]}))}function S(M){i.update(le=>({...le,roles:le.roles.filter((j,re)=>re!==M)}))}function b(M){i.update(le=>(le.roles[M].haystacks.push({path:"",read_only:!1,service:"Ripgrep",atomic_server_secret:"",extra_parameters:{}}),le))}function h(M,le){i.update(j=>(j.roles[M].haystacks=j.roles[M].haystacks.filter((re,ye)=>ye!==le),j))}function $(M,le,j="",re=""){i.update(ye=>{ye.roles[M].haystacks[le].extra_parameters||(ye.roles[M].haystacks[le].extra_parameters={});const be=j||`param_${Date.now()}`;return ye.roles[M].haystacks[le].extra_parameters[be]=re,ye})}function q(M,le,j){i.update(re=>(delete re.roles[M].haystacks[le].extra_parameters[j],re))}function O(M,le,j,re){i.update(ye=>{const be=ye.roles[M].haystacks[le].extra_parameters;return be[j]!==void 0&&j!==re&&(be[re]=be[j],delete be[j]),ye})}function N(M,le,j,re){const ye=re.target.value;O(M,le,j,ye)}async function L(){var ye;const M=Ze(i),le=Ze(Tt);let j={...le};j.id=M.id,j.global_shortcut=M.global_shortcut,j.default_role=M.default_role;const re={};M.roles.forEach(be=>{var Ge,bt;const Fe=be.name,Je=Fe.replace(/^"|"$/g,"");re[Je]={extra:((bt=(Ge=le.roles)==null?void 0:Ge[Fe])==null?void 0:bt.extra)??{},name:be.name,shortname:be.shortname,theme:be.theme,relevance_function:be.relevance_function,terraphim_it:be.terraphim_it??!1,haystacks:be.haystacks.map(pt=>({location:pt.path,service:pt.service,read_only:pt.read_only,atomic_server_secret:pt.service==="Atomic"?pt.atomic_server_secret:void 0,extra_parameters:pt.extra_parameters||{}})),kg:be.kg.url||be.kg.local_path?{automata_path:be.kg.url?{Remote:be.kg.url}:null,knowledge_graph_local:be.kg.local_path?{input_type:be.kg.local_type,path:be.kg.local_path}:null,public:be.kg.public,publish:be.kg.publish}:null,...be.openrouter_enabled&&{openrouter_enabled:be.openrouter_enabled,openrouter_api_key:be.openrouter_api_key,openrouter_model:be.openrouter_model,openrouter_auto_summarize:be.openrouter_auto_summarize??!1,openrouter_chat_enabled:be.openrouter_chat_enabled??!1,openrouter_chat_model:be.openrouter_chat_model??be.openrouter_model,openrouter_chat_system_prompt:be.openrouter_chat_system_prompt??""}};const De={};be.llm_provider&&(De.llm_provider=be.llm_provider),be.llm_model&&(De.llm_model=be.llm_model),be.llm_base_url&&(De.llm_base_url=be.llm_base_url),typeof be.llm_auto_summarize=="boolean"&&(De.llm_auto_summarize=be.llm_auto_summarize),re[Je].extra={...re[Je].extra||{},...De}}),j.roles=re,(!j.default_role||!re[j.default_role])&&(j.default_role=((ye=M.roles[0])==null?void 0:ye.name)??"Default"),j.selected_role=j.default_role;try{if(Ze(ze))await Me("update_config",{configNew:j});else{const be=await fetch("/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(j)});if(!be.ok)throw new Error(`HTTP ${be.status}: ${be.statusText}`)}Tt.set(j),t(2,w="success"),setTimeout(()=>{t(2,w="")},3e3)}catch(be){console.error(be),t(2,w="error"),setTimeout(()=>{t(2,w="")},3e3)}}const Q=()=>t(2,w=""),V=()=>t(2,w="");function K(){o.id=At(this),i.set(o),t(8,d)}function A(){o.global_shortcut=this.value,i.set(o),t(8,d)}function E(){o.default_theme=At(this),i.set(o),t(8,d)}function G(){o.default_role=At(this),i.set(o),t(8,d)}function C(M){o.roles[M].name=this.value,i.set(o),t(8,d)}function H(M){o.roles[M].shortname=this.value,i.set(o),t(8,d)}function B(M){o.roles[M].theme=At(this),i.set(o),t(8,d)}function F(M){o.roles[M].relevance_function=At(this),i.set(o),t(8,d)}function Z(M){o.roles[M].terraphim_it=this.checked,i.set(o),t(8,d)}function P(M,le){o.roles[M].haystacks[le].service=At(this),i.set(o),t(8,d)}function I(M,le){o.roles[M].haystacks[le].path=this.value,i.set(o),t(8,d)}const z=(M,le)=>r(M,le);function W(M,le){o.roles[M].haystacks[le].atomic_server_secret=this.value,i.set(o),t(8,d)}function X(M,le){o.roles[M].haystacks[le].extra_parameters.tag=this.value,i.set(o),t(8,d)}const D=(M,le,j)=>{const re=j.currentTarget.value;re&&dl(i,o.roles[M].haystacks[le].extra_parameters.tag=re,o)},oe=(M,le,j,re)=>N(M,le,j,re);function ge(M,le,j){o.roles[M].haystacks[le].extra_parameters[j]=this.value,i.set(o),t(8,d)}const we=(M,le,j)=>q(M,le,j),he=(M,le)=>$(M,le,"tag","#rust"),fe=(M,le)=>$(M,le,"max_count","10"),se=(M,le)=>$(M,le,"","");function ce(M,le){o.roles[M].haystacks[le].read_only=this.checked,i.set(o),t(8,d)}const ke=(M,le)=>h(M,le),Ce=M=>b(M);function te(M){o.roles[M].llm_provider=At(this),i.set(o),t(8,d)}function ie(M){o.roles[M].llm_model=this.value,i.set(o),t(8,d)}const ae=M=>_(M),ue=(M,le)=>{dl(i,o.roles[M].llm_model=le.currentTarget.value,o)};function Ee(M){o.roles[M].llm_base_url=this.value,i.set(o),t(8,d)}function We(M){o.roles[M].llm_auto_summarize=this.checked,i.set(o),t(8,d)}function Ke(M){o.roles[M].openrouter_enabled=this.checked,i.set(o),t(8,d)}function Pe(M){o.roles[M].openrouter_api_key=this.value,i.set(o),t(8,d)}function Re(M){o.roles[M].openrouter_model=this.value,i.set(o),t(8,d)}const x=M=>_(M),ne=(M,le)=>{dl(i,o.roles[M].openrouter_model=le.currentTarget.value,o)};function Se(M){o.roles[M].openrouter_auto_summarize=this.checked,i.set(o),t(8,d)}function Ae(M){o.roles[M].openrouter_chat_enabled=this.checked,i.set(o),t(8,d)}function et(M){o.roles[M].openrouter_chat_model=At(this),i.set(o),t(8,d)}function Ne(M){o.roles[M].openrouter_chat_system_prompt=this.value,i.set(o),t(8,d)}function ft(M){o.roles[M].kg.url=this.value,i.set(o),t(8,d)}function nt(M){o.roles[M].kg.local_path=this.value,i.set(o),t(8,d)}const vt=M=>c(M);function Ye(M){o.roles[M].kg.local_type=At(this),i.set(o),t(8,d)}function st(M){o.roles[M].kg.public=this.checked,i.set(o),t(8,d)}function dt(M){o.roles[M].kg.publish=this.checked,i.set(o),t(8,d)}return[p,m,w,o,n,r,c,i,d,_,v,k,y,S,b,h,$,q,N,L,Q,V,K,A,E,G,C,H,B,F,Z,P,I,z,W,X,D,oe,ge,we,he,fe,se,ce,ke,Ce,te,ie,ae,ue,Ee,We,Ke,Pe,Re,x,ne,Se,Ae,et,Ne,ft,nt,vt,Ye,st,dt,M=>S(M),()=>{t(1,m=2)}]}class Ni extends ht{constructor(e){super(),gt(this,e,Oi,Ei,ct,{},null,[-1,-1,-1,-1])}}function Ui(l){let e,t,o,n,u,r,c,i;return e=new rl({props:{fallbackPath:"/"}}),c=new ts({props:{content:l[0],onChange:l[1]}}),{c(){pe(e.$$.fragment),t=g(),o=f("div"),n=f("p"),n.innerHTML="<i>The best editing experience is to configure Atomic Server, in the meantime use editor below. You will need to refresh page via Command R or Ctrl-R to see changes</i>",u=g(),r=f("div"),pe(c.$$.fragment),a(r,"class","editor"),a(o,"class","box")},m(d,p){_e(e,d,p),R(d,t,p),R(d,o,p),s(o,n),s(o,u),s(o,r),_e(c,r,null),i=!0},p(d,[p]){const _={};p&1&&(_.content=d[0]),c.$set(_)},i(d){i||(J(e.$$.fragment,d),J(c.$$.fragment,d),i=!0)},o(d){Y(e.$$.fragment,d),Y(c.$$.fragment,d),i=!1},d(d){me(e,d),d&&T(t),d&&T(o),me(c)}}}function Ii(l,e,t){let o,n;Oe(l,Tt,c=>t(2,o=c)),Oe(l,ze,c=>t(3,n=c));let u={json:o};function r(c){if(console.log("contents changed:",c),console.log("is tauri",n),Tt.update(i=>(i=c.json,i)),Ze(ze))console.log("Updating config on server"),Me("update_config",{configNew:c.json}).then(i=>{console.log(`Message: ${i}`)}).catch(i=>console.error(i));else{let i=`${Xe.ServerURL}/config/`;fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c.json)})}t(0,u=c)}return Bt(()=>{t(0,u={json:o})}),[u,r]}class Di extends ht{constructor(e){super(),gt(this,e,Ii,Ui,ct,{})}}const{window:Dl}=Cs;function Mi(l){let e,t,o,n,u,r,c,i,d,p;return{c(){e=f("div"),t=f("div"),o=f("h3"),o.textContent="Error loading graph",n=g(),u=f("p"),r=U(l[3]),c=g(),i=f("button"),i.textContent="Retry",a(i,"class","button is-primary"),a(t,"class","error-content svelte-1ry9pkl"),a(e,"class","error-overlay svelte-1ry9pkl")},m(_,m){R(_,e,m),s(e,t),s(t,o),s(t,n),s(t,u),s(u,r),s(t,c),s(t,i),d||(p=ee(i,"click",l[11]),d=!0)},p(_,m){m&8&&ve(r,_[3])},d(_){_&&T(e),d=!1,p()}}}function ji(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="loading-content svelte-1ry9pkl"><div class="loader svelte-1ry9pkl"></div>
        <p>Loading knowledge graph...</p></div>`,a(e,"class","loading-overlay svelte-1ry9pkl")},m(t,o){R(t,e,o)},p:Te,d(t){t&&T(e)}}}function In(l){let e,t,o;return{c(){e=f("button"),e.innerHTML='<i class="fas fa-times svelte-1ry9pkl"></i>',a(e,"class","close-button svelte-1ry9pkl"),a(e,"title","Close Graph")},m(n,u){R(n,e,u),t||(o=ee(e,"click",l[17]),t=!0)},p:Te,d(n){n&&T(e),t=!1,o()}}}function Dn(l){let e;return{c(){e=f("div"),e.innerHTML="<span><strong>Left-click:</strong> View node • <strong>Right-click:</strong> Edit node • <strong>Drag:</strong> Move • <strong>Scroll:</strong> Zoom</span>",a(e,"class","controls-info svelte-1ry9pkl")},m(t,o){R(t,e,o)},d(t){t&&T(e)}}}function Mn(l){let e,t;return{c(){e=f("div"),t=U(l[8]),a(e,"class","debug-message svelte-1ry9pkl")},m(o,n){R(o,e,n),s(e,t)},p(o,n){n&256&&ve(t,o[8])},d(o){o&&T(e)}}}function jn(l){let e=l[5].id,t,o,n=Hn(l);return{c(){n.c(),t=ot()},m(u,r){n.m(u,r),R(u,t,r),o=!0},p(u,r){r&32&&ct(e,e=u[5].id)?(qe(),Y(n,1,1,Te),Be(),n=Hn(u),n.c(),J(n,1),n.m(t.parentNode,t)):n.p(u,r)},i(u){o||(J(n),o=!0)},o(u){Y(n),o=!1},d(u){u&&T(t),n.d(u)}}}function Hn(l){let e,t,o;function n(r){l[18](r)}let u={item:l[5],initialEdit:l[7]};return l[6]!==void 0&&(u.active=l[6]),e=new Hl({props:u}),xe.push(()=>tt(e,"active",n)),e.$on("close",l[12]),e.$on("save",l[13]),{c(){pe(e.$$.fragment)},m(r,c){_e(e,r,c),o=!0},p(r,c){const i={};c&32&&(i.item=r[5]),c&128&&(i.initialEdit=r[7]),!t&&c&64&&(t=!0,i.active=r[6],lt(()=>t=!1)),e.$set(i)},i(r){o||(J(e.$$.fragment,r),o=!0)},o(r){Y(e.$$.fragment,r),o=!1},d(r){me(e,r)}}}function Hi(l){let e,t,o,n,u,r,c,i,d,p,_;ut(l[15]),e=new rl({props:{fallbackPath:"/"}});function m(h,$){if(h[2])return ji;if(h[3])return Mi}let w=m(l),v=w&&w(l),k=l[0]&&In(l),y=!l[2]&&!l[3]&&l[4].length>0&&Dn(),S=l[8]&&Mn(l),b=l[5]&&jn(l);return{c(){pe(e.$$.fragment),t=g(),o=f("div"),v&&v.c(),n=g(),k&&k.c(),u=g(),y&&y.c(),r=g(),S&&S.c(),c=g(),b&&b.c(),i=ot(),a(o,"class","graph-container svelte-1ry9pkl"),de(o,"width",l[0]?"100vw":"600px"),de(o,"height",l[0]?"100vh":"400px"),Ut(o,"fullscreen",l[0])},m(h,$){_e(e,h,$),R(h,t,$),R(h,o,$),v&&v.m(o,null),l[16](o),R(h,n,$),k&&k.m(h,$),R(h,u,$),y&&y.m(h,$),R(h,r,$),S&&S.m(h,$),R(h,c,$),b&&b.m(h,$),R(h,i,$),d=!0,p||(_=ee(Dl,"resize",l[15]),p=!0)},p(h,[$]){w===(w=m(h))&&v?v.p(h,$):(v&&v.d(1),v=w&&w(h),v&&(v.c(),v.m(o,null))),(!d||$&1)&&de(o,"width",h[0]?"100vw":"600px"),(!d||$&1)&&de(o,"height",h[0]?"100vh":"400px"),(!d||$&1)&&Ut(o,"fullscreen",h[0]),h[0]?k?k.p(h,$):(k=In(h),k.c(),k.m(u.parentNode,u)):k&&(k.d(1),k=null),!h[2]&&!h[3]&&h[4].length>0?y||(y=Dn(),y.c(),y.m(r.parentNode,r)):y&&(y.d(1),y=null),h[8]?S?S.p(h,$):(S=Mn(h),S.c(),S.m(c.parentNode,c)):S&&(S.d(1),S=null),h[5]?b?(b.p(h,$),$&32&&J(b,1)):(b=jn(h),b.c(),J(b,1),b.m(i.parentNode,i)):b&&(qe(),Y(b,1,1,()=>{b=null}),Be())},i(h){d||(J(e.$$.fragment,h),J(b),d=!0)},o(h){Y(e.$$.fragment,h),Y(b),d=!1},d(h){me(e,h),h&&T(t),h&&T(o),v&&v.d(),l[16](null),h&&T(n),k&&k.d(h),h&&T(u),y&&y.d(h),h&&T(r),S&&S.d(h),h&&T(c),b&&b.d(h),h&&T(i),p=!1,_()}}}function zn(l){return{id:`kg-node-${l.id}`,url:`#/graph/node/${l.id}`,title:l.label,body:`# ${l.label}

**Knowledge Graph Node**

ID: ${l.id}
Rank: ${l.rank}

This is a concept node from the knowledge graph. You can edit this content to add more information about "${l.label}".`,description:`Knowledge graph concept: ${l.label}`,tags:["knowledge-graph","concept"],rank:l.rank,stub:`Knowledge graph concept: ${l.label}`}}function zi(l,e,t){let o,n;Oe(l,St,E=>t(20,o=E)),Oe(l,ze,E=>t(21,n=E));let{apiUrl:u="/rolegraph"}=e,{fullscreen:r=!0}=e,c,i=!0,d=null,p=[],_=[],m=null,w=!1,v=!1,k="",y=window.innerWidth,S=window.innerHeight;function b(){t(9,y=window.innerWidth),t(10,S=window.innerHeight),!i&&!d&&L()}async function h(){t(2,i=!0),t(3,d=null);try{if(n){console.log("Loading rolegraph from Tauri");const E=await Me("get_rolegraph",{role_name:o||void 0});if(E&&E.status==="success")t(4,p=E.nodes),_=E.edges;else throw new Error(`Tauri rolegraph fetch failed: ${(E==null?void 0:E.status)||"unknown error"}`)}else{console.log("Loading rolegraph from server");const E=o?`${u}?role=${encodeURIComponent(o)}`:u,G=await fetch(E);if(!G.ok)throw new Error(`Failed to fetch: ${G.status}`);const C=await G.json();t(4,p=C.nodes),_=C.edges}}catch(E){t(3,d=E.message),console.error("Error fetching rolegraph:",E)}finally{t(2,i=!1)}}function $(E,G){E.stopPropagation(),console.log("Node clicked:",G.label),t(5,m=zn(G)),t(7,v=!1),t(6,w=!0)}function q(E,G){E.preventDefault(),E.stopPropagation(),console.log("Node right-clicked:",G.label),t(8,k=`Right-clicked: ${G.label}`),t(5,m=zn(G)),t(7,v=!0),t(6,w=!0),setTimeout(()=>{t(8,k="")},2e3)}function O(){t(6,w=!1),t(5,m=null),t(7,v=!1)}async function N(){if(m)try{const E=await fetch("/documents",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)});E.ok?console.log("Successfully saved KG record:",m.id):console.error("Failed to save KG record:",E.statusText)}catch(E){console.error("Error saving KG record:",E)}finally{t(6,w=!1),t(5,m=null),t(7,v=!1)}}function L(){if(!c)return;t(1,c.innerHTML="",c);const E=Ul(c).append("svg").attr("width",y).attr("height",S),G=Is().scaleExtent([.1,10]).on("zoom",W=>{C.attr("transform",W.transform)});E.call(G);const C=E.append("g"),H=Ds(p).force("link",Ms(_).id(W=>W.id).distance(100)).force("charge",js().strength(-200)).force("center",Hs(y/2,S/2)).force("collision",zs().radius(20)),B=C.append("g").attr("class","links").selectAll("line").data(_).enter().append("line").attr("stroke","#666").attr("stroke-opacity",.7).attr("stroke-width",W=>{const X=W.weight||W.rank||1;return Math.max(1,Math.min(8,X*2))}),F=C.append("g").attr("class","nodes").selectAll("circle").data(p).enter().append("circle").attr("r",W=>{const X=W.rank||1;return Math.max(6,Math.min(20,X*2))}).attr("fill",W=>{const X=W.rank||1,D=Math.min(X/10,1);return Fs(.2+D*.6)}).attr("stroke","#fff").attr("stroke-width",2).style("cursor","pointer").on("click",(W,X)=>$(W,X)).on("contextmenu",(W,X)=>q(W,X)).on("mouseover",function(W,X){Ul(this).transition().duration(150).attr("stroke-width",3).attr("r",D=>{const oe=D.rank||1;return Math.max(8,Math.min(24,oe*2.5))})}).on("mouseout",function(W,X){Ul(this).transition().duration(150).attr("stroke-width",2).attr("r",D=>{const oe=D.rank||1;return Math.max(6,Math.min(20,oe*2))})}).call(Ws().on("start",P).on("drag",I).on("end",z)),Z=C.append("g").attr("class","labels").selectAll("text").data(p).enter().append("text").attr("text-anchor","middle").attr("dy",".35em").attr("font-size","11px").attr("font-family","Arial, sans-serif").attr("fill","#333").attr("pointer-events","none").text(W=>W.label.length>12?W.label.substring(0,12)+"...":W.label);H.on("tick",()=>{B.attr("x1",W=>W.source.x).attr("y1",W=>W.source.y).attr("x2",W=>W.target.x).attr("y2",W=>W.target.y),F.attr("cx",W=>W.x).attr("cy",W=>W.y),Z.attr("x",W=>W.x).attr("y",W=>W.y)});function P(W,X){W.active||H.alphaTarget(.3).restart(),X.fx=X.x,X.fy=X.y}function I(W,X){X.fx=W.x,X.fy=W.y}function z(W,X){W.active||H.alphaTarget(0),X.fx=null,X.fy=null}}Bt(()=>{h().then(()=>{d||L()});const E=G=>{G.preventDefault()};return c&&c.addEventListener("contextmenu",E),window.addEventListener("resize",b),()=>{c&&c.removeEventListener("contextmenu",E),window.removeEventListener("resize",b)}});function Q(){t(9,y=Dl.innerWidth),t(10,S=Dl.innerHeight)}function V(E){xe[E?"unshift":"push"](()=>{c=E,t(1,c)})}const K=()=>history.back();function A(E){w=E,t(6,w)}return l.$$set=E=>{"apiUrl"in E&&t(14,u=E.apiUrl),"fullscreen"in E&&t(0,r=E.fullscreen)},[r,c,i,d,p,m,w,v,k,y,S,h,O,N,u,Q,V,K,A]}class Fi extends ht{constructor(e){super(),gt(this,e,zi,Hi,ct,{apiUrl:14,fullscreen:0})}}function Fn(l,e,t){const o=l.slice();return o[16]=e[t],o[18]=t,o}function Wn(l,e,t){const o=l.slice();return o[19]=e[t],o[21]=t,o}function Kn(l){let e,t,o;return{c(){e=f("p"),t=U("Conversation ID: "),o=U(l[5]),a(e,"class","is-size-7 has-text-grey")},m(n,u){R(n,e,u),s(e,t),s(e,o)},p(n,u){u&32&&ve(o,n[5])},d(n){n&&T(e)}}}function Gn(l){let e,t,o,n=l[19].content+"",u,r;return{c(){e=f("div"),t=f("div"),o=f("pre"),u=U(n),a(o,"class","svelte-fa1qxe"),a(t,"class","bubble svelte-fa1qxe"),a(e,"class",r=Nt(`msg ${l[19].role}`)+" svelte-fa1qxe")},m(c,i){R(c,e,i),s(e,t),s(t,o),s(o,u)},p(c,i){i&1&&n!==(n=c[19].content+"")&&ve(u,n),i&1&&r!==(r=Nt(`msg ${c[19].role}`)+" svelte-fa1qxe")&&a(e,"class",r)},d(c){c&&T(e)}}}function qn(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="bubble loading svelte-fa1qxe"><span class="icon is-small"><i class="fas fa-spinner fa-spin"></i></span>
            <span>Thinking...</span></div>`,a(e,"class","msg assistant svelte-fa1qxe")},m(t,o){R(t,e,o)},d(t){t&&T(e)}}}function Bn(l){let e,t,o;return{c(){e=f("p"),t=U("Model: "),o=U(l[4]),a(e,"class","is-size-7 has-text-grey")},m(n,u){R(n,e,u),s(e,t),s(e,o)},p(n,u){u&16&&ve(o,n[4])},d(n){n&&T(e)}}}function Jn(l){let e,t;return{c(){e=f("p"),t=U(l[3]),a(e,"class","has-text-danger is-size-7")},m(o,n){R(o,e,n),s(e,t)},p(o,n){n&8&&ve(t,o[3])},d(o){o&&T(e)}}}function Wi(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-refresh"></i>',a(e,"class","icon is-small")},m(t,o){R(t,e,o)},d(t){t&&T(e)}}}function Ki(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-spinner fa-spin"></i>',a(e,"class","icon is-small")},m(t,o){R(t,e,o)},d(t){t&&T(e)}}}function Gi(l){let e,t=l[6],o=[];for(let n=0;n<t.length;n+=1)o[n]=Yn(Fn(l,t,n));return{c(){e=f("div");for(let n=0;n<o.length;n+=1)o[n].c();a(e,"class","context-items svelte-fa1qxe")},m(n,u){R(n,e,u);for(let r=0;r<o.length;r+=1)o[r]&&o[r].m(e,null)},p(n,u){if(u&64){t=n[6];let r;for(r=0;r<t.length;r+=1){const c=Fn(n,t,r);o[r]?o[r].p(c,u):(o[r]=Yn(c),o[r].c(),o[r].m(e,null))}for(;r<o.length;r+=1)o[r].d(1);o.length=t.length}},d(n){n&&T(e),Ve(o,n)}}}function qi(l){let e;return{c(){e=f("div"),e.innerHTML=`<span class="icon is-large"><i class="fas fa-inbox fa-2x"></i></span>
              <p class="is-size-6">No context items yet</p>
              <p class="is-size-7">Add documents from search results to provide context for your chat.</p>`,a(e,"class","has-text-centered has-text-grey-light")},m(t,o){R(t,e,o)},p:Te,d(t){t&&T(e)}}}function Vn(l){let e,t=l[16].relevance_score.toFixed(1)+"",o;return{c(){e=f("span"),o=U(t),a(e,"class","tag is-light is-small")},m(n,u){R(n,e,u),s(e,o)},p(n,u){u&64&&t!==(t=n[16].relevance_score.toFixed(1)+"")&&ve(o,t)},d(n){n&&T(e)}}}function Qn(l){let e;return{c(){e=f("hr"),a(e,"class","context-divider svelte-fa1qxe")},m(t,o){R(t,e,o)},d(t){t&&T(e)}}}function Yn(l){let e,t,o,n,u,r=l[16].context_type.replace(/([A-Z])/g," $1").trim()+"",c,i,d,p,_,m,w,v=l[16].title+"",k,y,S,b,h=l[16].content.substring(0,150)+"",$,q=l[16].content.length>150?"...":"",O,N,L,Q,V=new Date(l[16].created_at).toLocaleString()+"",K,A,E,G,C=l[16].relevance_score&&Vn(l),H=l[18]<l[6].length-1&&Qn();return{c(){e=f("div"),t=f("div"),o=f("div"),n=f("div"),u=f("span"),c=U(r),d=g(),p=f("div"),_=f("div"),C&&C.c(),m=g(),w=f("h6"),k=U(v),y=g(),S=f("div"),b=f("p"),$=U(h),O=U(q),N=g(),L=f("div"),Q=U("Added: "),K=U(V),E=g(),H&&H.c(),G=ot(),a(u,"class",i="tag is-small "+(l[16].context_type==="Document"?"is-info":l[16].context_type==="SearchResult"?"is-primary":l[16].context_type==="UserInput"?"is-warning":"is-light")),a(n,"class","level-item"),a(o,"class","level-left"),a(_,"class","level-item"),a(p,"class","level-right"),a(t,"class","level is-mobile"),a(w,"class","title is-6 has-text-dark"),a(b,"class","context-preview svelte-fa1qxe"),a(S,"class","content is-small"),a(L,"class","is-size-7 has-text-grey"),a(e,"class","context-item svelte-fa1qxe"),a(e,"data-context-id",A=l[16].id)},m(B,F){R(B,e,F),s(e,t),s(t,o),s(o,n),s(n,u),s(u,c),s(t,d),s(t,p),s(p,_),C&&C.m(_,null),s(e,m),s(e,w),s(w,k),s(e,y),s(e,S),s(S,b),s(b,$),s(b,O),s(e,N),s(e,L),s(L,Q),s(L,K),R(B,E,F),H&&H.m(B,F),R(B,G,F)},p(B,F){F&64&&r!==(r=B[16].context_type.replace(/([A-Z])/g," $1").trim()+"")&&ve(c,r),F&64&&i!==(i="tag is-small "+(B[16].context_type==="Document"?"is-info":B[16].context_type==="SearchResult"?"is-primary":B[16].context_type==="UserInput"?"is-warning":"is-light"))&&a(u,"class",i),B[16].relevance_score?C?C.p(B,F):(C=Vn(B),C.c(),C.m(_,null)):C&&(C.d(1),C=null),F&64&&v!==(v=B[16].title+"")&&ve(k,v),F&64&&h!==(h=B[16].content.substring(0,150)+"")&&ve($,h),F&64&&q!==(q=B[16].content.length>150?"...":"")&&ve(O,q),F&64&&V!==(V=new Date(B[16].created_at).toLocaleString()+"")&&ve(K,V),F&64&&A!==(A=B[16].id)&&a(e,"data-context-id",A),B[18]<B[6].length-1?H||(H=Qn(),H.c(),H.m(G.parentNode,G)):H&&(H.d(1),H=null)},d(B){B&&T(e),C&&C.d(),B&&T(E),H&&H.d(B),B&&T(G)}}}function Bi(l){let e,t,o,n,u,r,c,i,d,p,_,m,w,v,k,y,S,b,h,$,q,O,N,L,Q,V,K,A,E,G,C,H,B,F,Z,P,I,z,W,X,D=l[6].length+"",oe,ge,we,he,fe,se,ce;e=new rl({props:{fallbackPath:"/"}});let ke=l[5]&&Kn(l),Ce=l[0],te=[];for(let ne=0;ne<Ce.length;ne+=1)te[ne]=Gn(Wn(l,Ce,ne));let ie=l[2]&&qn(),ae=l[4]&&Bn(l),ue=l[3]&&Jn(l);function Ee(ne,Se){return ne[7]?Ki:Wi}let We=Ee(l),Ke=We(l);function Pe(ne,Se){return ne[6].length===0?qi:Gi}let Re=Pe(l),x=Re(l);return{c(){pe(e.$$.fragment),t=g(),o=f("section"),n=f("div"),u=f("div"),r=f("div"),c=f("h2"),c.textContent="Chat",i=g(),d=f("p"),d.textContent=`Role: ${Ze(St)}`,p=g(),ke&&ke.c(),_=g(),m=f("div");for(let ne=0;ne<te.length;ne+=1)te[ne].c();w=g(),ie&&ie.c(),v=g(),ae&&ae.c(),k=g(),ue&&ue.c(),y=g(),S=f("div"),b=f("div"),h=f("textarea"),$=g(),q=f("div"),O=f("button"),N=f("span"),N.innerHTML='<i class="fas fa-paper-plane"></i>',Q=g(),V=f("div"),K=f("div"),A=f("div"),E=f("div"),E.innerHTML='<div class="level-item"><h4 class="title is-5">Context</h4></div>',G=g(),C=f("div"),H=f("div"),B=f("button"),Ke.c(),F=g(),x.c(),Z=g(),P=f("div"),I=f("div"),z=f("div"),W=f("div"),X=f("span"),oe=U(D),ge=U(" context items"),we=g(),he=f("div"),he.innerHTML='<div class="level-item"><span class="is-size-7 has-text-grey">Context is automatically included in your chat</span></div>',a(c,"class","title is-4"),a(d,"class","subtitle is-6"),a(m,"class","chat-window svelte-fa1qxe"),a(h,"class","textarea"),a(h,"rows","3"),a(h,"placeholder","Type your message and press Enter..."),a(b,"class","control is-expanded"),a(N,"class","icon"),a(O,"class","button is-primary"),O.disabled=L=l[2]||!l[1].trim(),a(q,"class","control"),a(S,"class","field has-addons chat-input svelte-fa1qxe"),a(r,"class","column is-8"),a(E,"class","level-left"),a(B,"class","button is-small is-light"),B.disabled=l[7],a(H,"class","level-item"),a(C,"class","level-right"),a(A,"class","level is-mobile"),a(X,"class","tag is-light is-small"),a(W,"class","level-item"),a(z,"class","level-left"),a(he,"class","level-right"),a(I,"class","level is-mobile"),a(P,"class","mt-4"),a(K,"class","box context-panel svelte-fa1qxe"),a(V,"class","column is-4"),a(u,"class","columns svelte-fa1qxe"),a(n,"class","container"),a(o,"class","section")},m(ne,Se){_e(e,ne,Se),R(ne,t,Se),R(ne,o,Se),s(o,n),s(n,u),s(u,r),s(r,c),s(r,i),s(r,d),s(r,p),ke&&ke.m(r,null),s(r,_),s(r,m);for(let Ae=0;Ae<te.length;Ae+=1)te[Ae]&&te[Ae].m(m,null);s(m,w),ie&&ie.m(m,null),s(r,v),ae&&ae.m(r,null),s(r,k),ue&&ue.m(r,null),s(r,y),s(r,S),s(S,b),s(b,h),Ue(h,l[1]),s(S,$),s(S,q),s(q,O),s(O,N),s(u,Q),s(u,V),s(V,K),s(K,A),s(A,E),s(A,G),s(A,C),s(C,H),s(H,B),Ke.m(B,null),s(K,F),x.m(K,null),s(K,Z),s(K,P),s(P,I),s(I,z),s(z,W),s(W,X),s(X,oe),s(X,ge),s(I,we),s(I,he),fe=!0,se||(ce=[ee(h,"input",l[11]),ee(h,"keydown",l[10]),ee(O,"click",l[9]),ee(B,"click",l[8])],se=!0)},p(ne,[Se]){if(ne[5]?ke?ke.p(ne,Se):(ke=Kn(ne),ke.c(),ke.m(r,_)):ke&&(ke.d(1),ke=null),Se&1){Ce=ne[0];let Ae;for(Ae=0;Ae<Ce.length;Ae+=1){const et=Wn(ne,Ce,Ae);te[Ae]?te[Ae].p(et,Se):(te[Ae]=Gn(et),te[Ae].c(),te[Ae].m(m,w))}for(;Ae<te.length;Ae+=1)te[Ae].d(1);te.length=Ce.length}ne[2]?ie||(ie=qn(),ie.c(),ie.m(m,null)):ie&&(ie.d(1),ie=null),ne[4]?ae?ae.p(ne,Se):(ae=Bn(ne),ae.c(),ae.m(r,k)):ae&&(ae.d(1),ae=null),ne[3]?ue?ue.p(ne,Se):(ue=Jn(ne),ue.c(),ue.m(r,y)):ue&&(ue.d(1),ue=null),Se&2&&Ue(h,ne[1]),(!fe||Se&6&&L!==(L=ne[2]||!ne[1].trim()))&&(O.disabled=L),We!==(We=Ee(ne))&&(Ke.d(1),Ke=We(ne),Ke&&(Ke.c(),Ke.m(B,null))),(!fe||Se&128)&&(B.disabled=ne[7]),Re===(Re=Pe(ne))&&x?x.p(ne,Se):(x.d(1),x=Re(ne),x&&(x.c(),x.m(K,Z))),(!fe||Se&64)&&D!==(D=ne[6].length+"")&&ve(oe,D)},i(ne){fe||(J(e.$$.fragment,ne),fe=!0)},o(ne){Y(e.$$.fragment,ne),fe=!1},d(ne){me(e,ne),ne&&T(t),ne&&T(o),ke&&ke.d(),Ve(te,ne),ie&&ie.d(),ae&&ae.d(),ue&&ue.d(),Ke.d(),x.d(),se=!1,Qe(ce)}}}function Ji(l,e,t){let o;Oe(l,ze,h=>t(12,o=h));let n=[],u="",r=!1,c=null,i=null,d=null,p=[],_=!1;function m(h){t(0,n=[...n,{role:"user",content:h}])}async function w(){try{if(o){const h=await Me("list_conversations");h!=null&&h.conversations&&h.conversations.length>0?(t(5,d=h.conversations[0].id),console.log("🎯 Using existing conversation:",d),await k()):await v()}else{const h=await fetch(`${Xe.ServerURL}/conversations`);if(h.ok){const $=await h.json();$.conversations&&$.conversations.length>0?(t(5,d=$.conversations[0].id),console.log("🎯 Using existing conversation:",d),await k()):await v()}else await v()}}catch(h){console.error("❌ Error initializing conversation:",h)}}async function v(){try{const h=Ze(St);if(o){const $=await Me("create_conversation",{title:"Chat Conversation",role:h});$.status==="Success"&&$.conversationId&&(t(5,d=$.conversationId),console.log("🆕 Created new conversation:",d))}else{const $=await fetch(`${Xe.ServerURL}/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"Chat Conversation",role:h})});if($.ok){const q=await $.json();q.status==="Success"&&q.conversation_id&&(t(5,d=q.conversation_id),console.log("🆕 Created new conversation:",d))}}}catch(h){console.error("❌ Error creating conversation:",h)}}async function k(){if(d){t(7,_=!0);try{if(o){const h=await Me("get_conversation",{conversationId:d});h.status==="Success"&&h.conversation&&t(6,p=h.conversation.global_context||[])}else{const h=await fetch(`${Xe.ServerURL}/conversations/${d}`);if(h.ok){const $=await h.json();$.status==="Success"&&$.conversation&&t(6,p=$.conversation.global_context||[])}}}catch(h){console.error("❌ Error loading conversation context:",h)}finally{t(7,_=!1)}}}async function y(){var q;if(!u.trim()||r)return;t(3,c=null);const h=Ze(St),$=u.trim();t(1,u=""),d||await w(),m($),t(2,r=!0);try{const O={role:h,messages:n};d&&(O.conversation_id=d);const N=await fetch(`${Xe.ServerURL}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(O)});if(!N.ok)throw new Error(`HTTP ${N.status}`);const L=await N.json();t(4,i=L.model_used??null),((q=L.status)==null?void 0:q.toLowerCase())==="success"&&L.message?t(0,n=[...n,{role:"assistant",content:L.message}]):t(3,c=L.error||"Chat failed")}catch(O){t(3,c=(O==null?void 0:O.message)||String(O))}finally{t(2,r=!1)}}function S(h){(h.key==="Enter"||h.key==="Return")&&!h.shiftKey&&(h.preventDefault(),y())}Bt(()=>{t(0,n=[{role:"assistant",content:"Hi! How can I help you? Ask me anything about your search results or documents."}]),w()});function b(){u=this.value,t(1,u)}return[n,u,r,c,i,d,p,_,k,y,S,b]}class Vi extends ht{constructor(e){super(),gt(this,e,Ji,Bi,ct,{})}}function Qi(l){let e,t;return e=new yi({}),{c(){pe(e.$$.fragment)},m(o,n){_e(e,o,n),t=!0},i(o){t||(J(e.$$.fragment,o),t=!0)},o(o){Y(e.$$.fragment,o),t=!1},d(o){me(e,o)}}}function Yi(l){let e,t;return e=new _r({}),{c(){pe(e.$$.fragment)},m(o,n){_e(e,o,n),t=!0},i(o){t||(J(e.$$.fragment,o),t=!0)},o(o){Y(e.$$.fragment,o),t=!1},d(o){me(e,o)}}}function Zi(l){let e,t;return e=new Ni({}),{c(){pe(e.$$.fragment)},m(o,n){_e(e,o,n),t=!0},i(o){t||(J(e.$$.fragment,o),t=!0)},o(o){Y(e.$$.fragment,o),t=!1},d(o){me(e,o)}}}function Xi(l){let e,t;return e=new Di({}),{c(){pe(e.$$.fragment)},m(o,n){_e(e,o,n),t=!0},i(o){t||(J(e.$$.fragment,o),t=!0)},o(o){Y(e.$$.fragment,o),t=!1},d(o){me(e,o)}}}function xi(l){let e,t;return e=new Fi({}),{c(){pe(e.$$.fragment)},m(o,n){_e(e,o,n),t=!0},i(o){t||(J(e.$$.fragment,o),t=!0)},o(o){Y(e.$$.fragment,o),t=!1},d(o){me(e,o)}}}function ea(l){let e,t;return e=new Vi({}),{c(){pe(e.$$.fragment)},m(o,n){_e(e,o,n),t=!0},i(o){t||(J(e.$$.fragment,o),t=!0)},o(o){Y(e.$$.fragment,o),t=!1},d(o){me(e,o)}}}function ta(l){let e;return{c(){e=f("nav"),e.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a>
            <a class="navbar-item" href="/config/wizard">Wizard</a>
            <a class="navbar-item" href="/config/json">JSON Editor</a>
            <a class="navbar-item" href="/graph">Graph</a>
            <a class="navbar-item" href="/chat">Chat</a></div>`,a(e,"class","navbar")},m(t,o){R(t,e,o)},p:Te,d(t){t&&T(e)}}}function la(l){let e,t,o,n,u,r,c,i,d,p,_,m,w,v,k,y,S,b,h,$,q,O,N,L,Q,V,K,A,E,G;return c=new Ll({}),p=new Pt({props:{path:"/",$$slots:{default:[Qi]},$$scope:{ctx:l}}}),v=new Pt({props:{path:"/fetch/*",$$slots:{default:[Yi]},$$scope:{ctx:l}}}),y=new Pt({props:{path:"/config/wizard",$$slots:{default:[Zi]},$$scope:{ctx:l}}}),b=new Pt({props:{path:"/config/json",$$slots:{default:[Xi]},$$scope:{ctx:l}}}),$=new Pt({props:{path:"/graph",$$slots:{default:[xi]},$$scope:{ctx:l}}}),O=new Pt({props:{path:"/chat",$$slots:{default:[ea]},$$scope:{ctx:l}}}),V=new Pt({props:{path:"/",$$slots:{default:[ta]},$$scope:{ctx:l}}}),{c(){e=f("meta"),t=g(),o=f("div"),n=f("main"),u=f("div"),r=f("div"),pe(c.$$.fragment),i=g(),d=f("div"),pe(p.$$.fragment),_=g(),m=f("br"),w=g(),pe(v.$$.fragment),k=g(),pe(y.$$.fragment),S=g(),pe(b.$$.fragment),h=g(),pe($.$$.fragment),q=g(),pe(O.$$.fragment),N=g(),L=f("footer"),Q=f("div"),pe(V.$$.fragment),a(e,"name","color-scheme"),a(e,"content",l[1]),document.title="Terraphim",a(r,"class","role-selector svelte-1bfpta4"),a(u,"class","top-controls svelte-1bfpta4"),a(d,"class","search-area svelte-1bfpta4"),a(n,"class","main-content svelte-1bfpta4"),a(Q,"class",K=Nt(l[0])+" svelte-1bfpta4"),a(L,"class","svelte-1bfpta4"),a(o,"class","is-full-height svelte-1bfpta4")},m(C,H){s(document.head,e),R(C,t,H),R(C,o,H),s(o,n),s(n,u),s(u,r),_e(c,r,null),s(n,i),s(n,d),_e(p,d,null),s(n,_),s(n,m),s(n,w),_e(v,n,null),s(n,k),_e(y,n,null),s(n,S),_e(b,n,null),s(n,h),_e($,n,null),s(n,q),_e(O,n,null),s(o,N),s(o,L),s(L,Q),_e(V,Q,null),A=!0,E||(G=[ee(L,"mouseover",l[2]),ee(L,"focus",l[2])],E=!0)},p(C,[H]){(!A||H&2)&&a(e,"content",C[1]);const B={};H&8&&(B.$$scope={dirty:H,ctx:C}),p.$set(B);const F={};H&8&&(F.$$scope={dirty:H,ctx:C}),v.$set(F);const Z={};H&8&&(Z.$$scope={dirty:H,ctx:C}),y.$set(Z);const P={};H&8&&(P.$$scope={dirty:H,ctx:C}),b.$set(P);const I={};H&8&&(I.$$scope={dirty:H,ctx:C}),$.$set(I);const z={};H&8&&(z.$$scope={dirty:H,ctx:C}),O.$set(z);const W={};H&8&&(W.$$scope={dirty:H,ctx:C}),V.$set(W),(!A||H&1&&K!==(K=Nt(C[0])+" svelte-1bfpta4"))&&a(Q,"class",K)},i(C){A||(J(c.$$.fragment,C),J(p.$$.fragment,C),J(v.$$.fragment,C),J(y.$$.fragment,C),J(b.$$.fragment,C),J($.$$.fragment,C),J(O.$$.fragment,C),J(V.$$.fragment,C),A=!0)},o(C){Y(c.$$.fragment,C),Y(p.$$.fragment,C),Y(v.$$.fragment,C),Y(y.$$.fragment,C),Y(b.$$.fragment,C),Y($.$$.fragment,C),Y(O.$$.fragment,C),Y(V.$$.fragment,C),A=!1},d(C){T(e),C&&T(t),C&&T(o),me(c),me(p),me(v),me(y),me(b),me($),me(O),me(V),E=!1,Qe(G)}}}function oa(l,e,t){let o;Oe(l,pl,r=>t(1,o=r));let n="is-hidden";function u(){t(0,n="")}return[n,o,u]}class na extends ht{constructor(e){super(),gt(this,e,oa,la,ct,{})}}const sa=new Es;Ps(sa);new na({target:document.getElementById("app")});
