var nr=Object.defineProperty;var or=(l,e,t)=>e in l?nr(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var Ct=(l,e,t)=>(or(l,typeof e!="symbol"?e+"":e,t),t);import{aa as It,S as _t,i as gt,s as pt,q as f,Y as U,b as S,y as r,Z as be,I as Re,j as T,ak as je,F as ut,m as tl,a as v,v as c,l as ae,E as Ze,au as Ft,r as ge,z as he,t as M,d as V,B as ve,av as sr,aw as Vt,H as lt,U as st,V as rt,ax as Kt,ay as rr,g as Fe,e as Ke,O as tt,af as Rt,o as Wl,W as we,az as kl,aA as St,aB as Bl,aC as ir,a1 as De,C as mt,aD as Je,aE as Jl,D as pl,G as ml,aF as Gt,w as Pt,x as dt,A as Vl,a2 as ar,aG as Ht,ac as cr,a5 as ur,a7 as fr,a9 as dr,n as pr,k as Ql,aH as Qt,_ as Hl}from"./vendor-ui-65216d17.js";import{R as Nt,S as jl,f as mr,Y as Fl}from"./vendor-utils-f7aada8e.js";import{J as Ks,_ as _r,c as Gs,P as gr,i as hr,D as vr,j as br,E as kr,k as yn}from"./vendor-editor-f87b2f73.js";import{P as qs,T as Ml,b as Ws,y as wr,A as yr,a as $r,q as Cr}from"./vendor-atomic-911c42f7.js";import{t as Tr,E as Sr}from"./novel-editor-72d0a44a.js";import{s as Kl,z as Rr,a as Ar,l as Er,m as Lr,c as Ir,b as Dr,B as Nr,d as Or}from"./vendor-charts-e6a4a6c9.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function t(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=t(o);fetch(o.href,a)}})();const Ve={ServerURL:location.protocol+"//"+window.location.host||"/"},vl=It([]),Pr={id:"Desktop",global_shortcut:"",roles:{},default_role:{original:"",lowercase:""},selected_role:{original:"",lowercase:""}},bl=It("spacelab"),At=It("selected"),ct=It(!1),Ur=It(`${Ve.ServerURL}/documents/search`),Lt=It(Pr),$n=It([]);let Bt=It("");const Tt=It(!1);let el=null;function Mr(l){if(typeof document>"u")return;const e=`/assets/bulmaswatch/${l}/bulmaswatch.min.css`;if(el!=null&&el.href.endsWith(e))return;const t=document.createElement("link");t.rel="stylesheet",t.href=e,t.id="bulma-theme",t.onload=()=>{el&&el!==t&&el.remove(),el=t},document.head.appendChild(t);const n=document.head.querySelector('meta[name="color-scheme"]');n&&n.setAttribute("content",l)}bl.subscribe(Mr);function jr(l){let e,t;return{c(){e=f("option"),t=U(l[1]),e.__value=l[0],e.value=e.__value},m(n,o){S(n,e,o),r(e,t)},p(n,[o]){o&2&&be(t,n[1]),o&1&&(e.__value=n[0],e.value=e.__value)},i:Re,o:Re,d(n){n&&T(e)}}}function zr(l,e,t){let n,{subject:o}=e;const a=qs(o),s=Ml(a,Ws.properties.name);return je(l,s,u=>t(1,n=u)),Ml(a,"http://localhost:9883/property/theme"),l.$$set=u=>{"subject"in u&&t(0,o=u.subject)},[o,n,s]}class Hr extends _t{constructor(e){super(),gt(this,e,zr,jr,pt,{subject:0})}}function Cn(l){let e,t,n,o,a,s,u=l[0]&&Tn();return{c(){e=f("button"),t=f("span"),t.innerHTML='<i class="fas fa-arrow-left"></i>',n=v(),u&&u.c(),c(t,"class","icon svelte-rnsqpo"),c(e,"class",o="button is-light back-button "+l[1]+" svelte-rnsqpo"),c(e,"title","Go back"),c(e,"aria-label","Go back")},m(i,d){S(i,e,d),r(e,t),r(e,n),u&&u.m(e,null),a||(s=[ae(e,"click",l[3]),ae(e,"keydown",l[6])],a=!0)},p(i,d){i[0]?u||(u=Tn(),u.c(),u.m(e,null)):u&&(u.d(1),u=null),d&2&&o!==(o="button is-light back-button "+i[1]+" svelte-rnsqpo")&&c(e,"class",o)},d(i){i&&T(e),u&&u.d(),a=!1,Ze(s)}}}function Tn(l){let e;return{c(){e=f("span"),e.textContent="Back",c(e,"class","back-text svelte-rnsqpo")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function Fr(l){let e,t=l[2]&&Cn(l);return{c(){t&&t.c(),e=ut()},m(n,o){t&&t.m(n,o),S(n,e,o)},p(n,[o]){n[2]?t?t.p(n,o):(t=Cn(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Re,o:Re,d(n){t&&t.d(n),n&&T(e)}}}function Kr(l,e,t){let{fallbackPath:n="/"}=e,{showText:o=!0}=e,{customClass:a=""}=e,{hideOnPaths:s=["/"]}=e,u=!0;function i(){var m;try{const _=((m=window.location)==null?void 0:m.pathname)||"/";t(2,u=!s.includes(_))}catch{t(2,u=!0)}}function d(){window.history.length>1?window.history.back():window.location.href=n}tl(()=>(i(),window.addEventListener("popstate",i),window.addEventListener("hashchange",i),()=>{window.removeEventListener("popstate",i),window.removeEventListener("hashchange",i)}));const p=m=>{(m.key==="Enter"||m.key===" ")&&(m.preventDefault(),d())};return l.$$set=m=>{"fallbackPath"in m&&t(4,n=m.fallbackPath),"showText"in m&&t(0,o=m.showText),"customClass"in m&&t(1,a=m.customClass),"hideOnPaths"in m&&t(5,s=m.hideOnPaths)},[o,a,u,d,n,s,p]}class _l extends _t{constructor(e){super(),gt(this,e,Kr,Fr,pt,{fallbackPath:4,showText:0,customClass:1,hideOnPaths:5})}}function Gr(){return window.crypto.getRandomValues(new Uint32Array(1))[0]}function Gl(l,e=!1){const t=Gr(),n=`_${t}`;return Object.defineProperty(window,n,{value:o=>(e&&Reflect.deleteProperty(window,n),l==null?void 0:l(o)),writable:!1,configurable:!0}),t}async function Ue(l,e={}){return new Promise((t,n)=>{const o=Gl(s=>{t(s),Reflect.deleteProperty(window,`_${a}`)},!0),a=Gl(s=>{n(s),Reflect.deleteProperty(window,`_${o}`)},!0);window.__TAURI_IPC__({cmd:l,callback:o,error:a,...e})})}function Sn(l,e,t){const n=l.slice();return n[25]=e[t],n}function qr(l){let e,t,n;function o(s){l[13](s)}let a={};return l[5]!==void 0&&(a.value=l[5]),e=new Vt({props:a}),lt.push(()=>st(e,"value",o)),{c(){ge(e.$$.fragment)},m(s,u){he(e,s,u),n=!0},p(s,u){const i={};!t&&u&32&&(t=!0,i.value=s[5],rt(()=>t=!1)),e.$set(i)},i(s){n||(M(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){ve(e,s)}}}function Wr(l){let e,t,n;function o(s){l[14](s)}let a={type:"password",placeholder:"secret",icon:"fas fa-lock",expanded:!0};return l[6]!==void 0&&(a.value=l[6]),e=new Vt({props:a}),lt.push(()=>st(e,"value",o)),{c(){ge(e.$$.fragment)},m(s,u){he(e,s,u),n=!0},p(s,u){const i={};!t&&u&64&&(t=!0,i.value=s[6],rt(()=>t=!1)),e.$set(i)},i(s){n||(M(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){ve(e,s)}}}function Br(l){let e;return{c(){e=U("Save")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function Jr(l){let e,t;return e=new Kt({props:{type:"is-success",class:"is-right",iconPack:"fa",iconLeft:"check",$$slots:{default:[Br]},$$scope:{ctx:l}}}),e.$on("click",l[8]),e.$on("submit",l[8]),{c(){ge(e.$$.fragment)},m(n,o){he(e,n,o),t=!0},p(n,o){const a={};o&268435456&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function Vr(l){let e,t,n,o,a,s;return e=new Ft({props:{$$slots:{default:[qr]},$$scope:{ctx:l}}}),n=new Ft({props:{grouped:!0,$$slots:{default:[Wr]},$$scope:{ctx:l}}}),a=new Ft({props:{grouped:!0,$$slots:{default:[Jr]},$$scope:{ctx:l}}}),{c(){ge(e.$$.fragment),t=v(),ge(n.$$.fragment),o=v(),ge(a.$$.fragment)},m(u,i){he(e,u,i),S(u,t,i),he(n,u,i),S(u,o,i),he(a,u,i),s=!0},p(u,i){const d={};i&268435488&&(d.$$scope={dirty:i,ctx:u}),e.$set(d);const p={};i&268435520&&(p.$$scope={dirty:i,ctx:u}),n.$set(p);const m={};i&268435456&&(m.$$scope={dirty:i,ctx:u}),a.$set(m)},i(u){s||(M(e.$$.fragment,u),M(n.$$.fragment,u),M(a.$$.fragment,u),s=!0)},o(u){V(e.$$.fragment,u),V(n.$$.fragment,u),V(a.$$.fragment,u),s=!1},d(u){ve(e,u),u&&T(t),ve(n,u),u&&T(o),ve(a,u)}}}function Qr(l){let e,t,n;function o(s){l[15](s)}let a={type:"search",placeholder:"Fetch JSON",icon:"search"};return l[3]!==void 0&&(a.value=l[3]),e=new Vt({props:a}),lt.push(()=>st(e,"value",o)),{c(){ge(e.$$.fragment)},m(s,u){he(e,s,u),n=!0},p(s,u){const i={};!t&&u&8&&(t=!0,i.value=s[3],rt(()=>t=!1)),e.$set(i)},i(s){n||(M(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){ve(e,s)}}}function Yr(l){let e;return{c(){e=U("WikiPage")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function Zr(l){let e,t,n,o,a,s;function u(m){l[16](m)}let i={type:"search",placeholder:"Post JSON",icon:"search"};l[4]!==void 0&&(i.value=l[4]),e=new Vt({props:i}),lt.push(()=>st(e,"value",u));function d(m){l[17](m)}let p={$$slots:{default:[Yr]},$$scope:{ctx:l}};return l[2]!==void 0&&(p.checked=l[2]),o=new rr({props:p}),lt.push(()=>st(o,"checked",d)),{c(){ge(e.$$.fragment),n=v(),ge(o.$$.fragment)},m(m,_){he(e,m,_),S(m,n,_),he(o,m,_),s=!0},p(m,_){const g={};!t&&_&16&&(t=!0,g.value=m[4],rt(()=>t=!1)),e.$set(g);const w={};_&268435456&&(w.$$scope={dirty:_,ctx:m}),!a&&_&4&&(a=!0,w.checked=m[2],rt(()=>a=!1)),o.$set(w)},i(m){s||(M(e.$$.fragment,m),M(o.$$.fragment,m),s=!0)},o(m){V(e.$$.fragment,m),V(o.$$.fragment,m),s=!1},d(m){ve(e,m),m&&T(n),ve(o,m)}}}function Xr(l){let e;return{c(){e=U("Fetch")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function xr(l){let e,t;return e=new Kt({props:{type:"is-primary",$$slots:{default:[Xr]},$$scope:{ctx:l}}}),e.$on("click",l[9]),e.$on("submit",l[9]),{c(){ge(e.$$.fragment)},m(n,o){he(e,n,o),t=!0},p(n,o){const a={};o&268435456&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function ei(l){let e,t,n,o,a,s;return e=new Ft({props:{grouped:!0,$$slots:{default:[Qr]},$$scope:{ctx:l}}}),n=new Ft({props:{grouped:!0,$$slots:{default:[Zr]},$$scope:{ctx:l}}}),a=new Ft({props:{grouped:!0,$$slots:{default:[xr]},$$scope:{ctx:l}}}),{c(){ge(e.$$.fragment),t=v(),ge(n.$$.fragment),o=v(),ge(a.$$.fragment)},m(u,i){he(e,u,i),S(u,t,i),he(n,u,i),S(u,o,i),he(a,u,i),s=!0},p(u,i){const d={};i&268435464&&(d.$$scope={dirty:i,ctx:u}),e.$set(d);const p={};i&268435476&&(p.$$scope={dirty:i,ctx:u}),n.$set(p);const m={};i&268435456&&(m.$$scope={dirty:i,ctx:u}),a.$set(m)},i(u){s||(M(e.$$.fragment,u),M(n.$$.fragment,u),M(a.$$.fragment,u),s=!0)},o(u){V(e.$$.fragment,u),V(n.$$.fragment,u),V(a.$$.fragment,u),s=!1},d(u){ve(e,u),u&&T(t),ve(n,u),u&&T(o),ve(a,u)}}}function ti(l){let e,t,n,o,a;return o=new Ks({props:{content:l[1],onChange:l[7]}}),{c(){e=f("p"),e.innerHTML=`<i>The best editing experience is to configure Atomic Server, in the
        meantime use editor below. You will need to refresh page via Command R
        or Ctrl-R to see changes</i>`,t=v(),n=f("div"),ge(o.$$.fragment),c(n,"class","editor")},m(s,u){S(s,e,u),S(s,t,u),S(s,n,u),he(o,n,null),a=!0},p(s,u){const i={};u&2&&(i.content=s[1]),o.$set(i)},i(s){a||(M(o.$$.fragment,s),a=!0)},o(s){V(o.$$.fragment,s),a=!1},d(s){s&&T(e),s&&T(t),s&&T(n),ve(o)}}}function Rn(l){let e,t;return e=new Hr({props:{subject:l[25]}}),{c(){ge(e.$$.fragment)},m(n,o){he(e,n,o),t=!0},p(n,o){const a={};o&1&&(a.subject=n[25]),e.$set(a)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function li(l){let e,t,n=l[0]??[],o=[];for(let s=0;s<n.length;s+=1)o[s]=Rn(Sn(l,n,s));const a=s=>V(o[s],1,1,()=>{o[s]=null});return{c(){for(let s=0;s<o.length;s+=1)o[s].c();e=ut()},m(s,u){for(let i=0;i<o.length;i+=1)o[i]&&o[i].m(s,u);S(s,e,u),t=!0},p(s,u){if(u&1){n=s[0]??[];let i;for(i=0;i<n.length;i+=1){const d=Sn(s,n,i);o[i]?(o[i].p(d,u),M(o[i],1)):(o[i]=Rn(d),o[i].c(),M(o[i],1),o[i].m(e.parentNode,e))}for(Fe(),i=n.length;i<o.length;i+=1)a(i);Ke()}},i(s){if(!t){for(let u=0;u<n.length;u+=1)M(o[u]);t=!0}},o(s){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)V(o[u]);t=!1},d(s){tt(o,s),s&&T(e)}}}function ni(l){let e,t;return e=new sr({props:{$$slots:{default:[li]},$$scope:{ctx:l}}}),{c(){ge(e.$$.fragment)},m(n,o){he(e,n,o),t=!0},p(n,o){const a={};o&268435457&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function oi(l){let e,t,n,o,a,s,u,i,d,p,m,_,g,w,h;return e=new _l({props:{fallbackPath:"/"}}),o=new Nt({props:{path:"/atomic",$$slots:{default:[Vr]},$$scope:{ctx:l}}}),s=new Nt({props:{path:"/json",$$slots:{default:[ei]},$$scope:{ctx:l}}}),i=new Nt({props:{path:"/editor",$$slots:{default:[ti]},$$scope:{ctx:l}}}),_=new Ft({props:{grouped:!0,position:"is-right",$$slots:{default:[ni]},$$scope:{ctx:l}}}),{c(){ge(e.$$.fragment),t=v(),n=f("div"),ge(o.$$.fragment),a=v(),ge(s.$$.fragment),u=v(),ge(i.$$.fragment),d=v(),p=f("hr"),m=v(),ge(_.$$.fragment),g=v(),w=f("nav"),w.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
    <a class="navbar-item" href="/fetch/json">Fetch JSON Data</a> 
    <a class="navbar-item" href="/fetch/atomic">Set Atomic Server</a> 
    <a class="navbar-item" href="/fetch/editor">Edit JSON config</a></div>`,c(n,"class","box"),c(w,"class","navbar")},m(k,$){he(e,k,$),S(k,t,$),S(k,n,$),he(o,n,null),r(n,a),he(s,n,null),r(n,u),he(i,n,null),S(k,d,$),S(k,p,$),S(k,m,$),he(_,k,$),S(k,g,$),S(k,w,$),h=!0},p(k,[$]){const y={};$&268435552&&(y.$$scope={dirty:$,ctx:k}),o.$set(y);const b={};$&268435484&&(b.$$scope={dirty:$,ctx:k}),s.$set(b);const C={};$&268435458&&(C.$$scope={dirty:$,ctx:k}),i.$set(C);const K={};$&268435457&&(K.$$scope={dirty:$,ctx:k}),_.$set(K)},i(k){h||(M(e.$$.fragment,k),M(o.$$.fragment,k),M(s.$$.fragment,k),M(i.$$.fragment,k),M(_.$$.fragment,k),h=!0)},o(k){V(e.$$.fragment,k),V(o.$$.fragment,k),V(s.$$.fragment,k),V(i.$$.fragment,k),V(_.$$.fragment,k),h=!1},d(k){ve(e,k),k&&T(t),k&&T(n),ve(o),ve(s),ve(i),k&&T(d),k&&T(p),k&&T(m),ve(_,k),k&&T(g),k&&T(w)}}}function si(l,e,t){let n,o,a,s,u;je(l,wr,E=>t(19,a=E)),je(l,ct,E=>t(20,s=E)),je(l,Lt,E=>t(21,u=E));let i={json:u};function d(E){if(console.log("contents changed:",E),console.log("is tauri",s),Lt.update(L=>(L=E.json,L)),ct)console.log("Updating config on server"),Ue("update_config",{configNew:E.json}).then(L=>{console.log(`Message: ${L}`)}).catch(L=>console.error(L));else{let L=`${Ve.ServerURL}/config/`;fetch(L,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(E.json)})}t(1,i=E)}let p=!1,m="https://raw.githubusercontent.com/terraphim/terraphim-cloud-fastapi/main/data/ref_arch.json",_="http://localhost:8000/documents/",g="http://localhost:9883/",w;const h=async()=>{console.log("Updating atomic server configuration");const E=yr.fromSecret(w);a.setServerUrl(g),console.log("Server set.Setting agent"),a.setAgent(E)},k=async()=>{b()},$=({data:{msg:E,data:L}})=>{console.log(E,L)};let y;const b=async()=>{const E=await _r(()=>import("./fetcher.worker-7e58969a.js"),[]);y=new E.default,y.onmessage=$;const L={msg:"fetcher",data:{url:m,postUrl:_,isWiki:p}};y.postMessage(L)},C=qs("http://localhost:9883/config/y3zx5wtm0bq"),K=Ml(C,Ws.properties.name);je(l,K,E=>t(12,o=E));const N=Ml(C,"http://localhost:9883/property/role");je(l,N,E=>t(0,n=E));function O(E){g=E,t(5,g)}function R(E){w=E,t(6,w)}function F(E){m=E,t(3,m)}function x(E){_=E,t(4,_)}function Q(E){p=E,t(2,p)}return l.$$.update=()=>{l.$$.dirty&4096&&console.log("Print name",o),l.$$.dirty&1&&console.log("Print roles",n)},[n,i,p,m,_,g,w,d,h,k,K,N,o,O,R,F,x,Q]}class ri extends _t{constructor(e){super(),gt(this,e,si,oi,pt,{})}}function Jt(){return Rt(ct)||typeof window<"u"&&window.__TAURI__!==void 0}class ii{constructor(){Ct(this,"baseUrl");Ct(this,"autocompleteIndexBuilt",!1);Ct(this,"sessionId");Ct(this,"currentRole","Default");Ct(this,"connectionRetries",0);Ct(this,"maxRetries",3);Ct(this,"retryDelay",1e3);Ct(this,"isConnecting",!1);this.baseUrl=typeof window<"u"?(window.location.protocol==="https:"?"https://":"http://")+window.location.hostname+":8001":"http://localhost:8001",this.sessionId=`novel-${Date.now()}`,typeof window<"u"&&!Jt()&&this.shouldPerformHealthCheck()?this.detectServerPort():typeof window<"u"&&!Jt()&&console.log("NovelAutocompleteService: Skipping server detection - not needed for current page")}setRole(e){this.currentRole=e,this.autocompleteIndexBuilt=!1}async detectServerPort(){if(Jt())return;if(!this.shouldPerformHealthCheck()){console.log("NovelAutocompleteService: Skipping health check - service not needed");return}const t=[8001,3e3];for(const n of t)try{const o=typeof window<"u"?(window.location.protocol==="https:"?"https://":"http://")+window.location.hostname+":"+n:"http://localhost:"+n,a=await fetch(`${o}/message?sessionId=health-check`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:0,method:"ping",params:{}}),signal:AbortSignal.timeout(1e3)});if(a.ok||a.status===404){this.baseUrl=o,console.log(`NovelAutocompleteService: Detected server at ${o}`);return}}catch{continue}console.warn("NovelAutocompleteService: Could not detect running server, using default:",this.baseUrl)}shouldPerformHealthCheck(){return!(typeof window<"u"&&(!window.location.pathname.startsWith("/chat")||!(document.querySelector('[contenteditable="true"]')||document.querySelector("textarea")||document.querySelector('input[type="text"]'))))}async buildAutocompleteIndex(){if(this.isConnecting)return await new Promise(e=>setTimeout(e,1e3)),this.autocompleteIndexBuilt;this.isConnecting=!0;try{return Jt()?(console.log("Using Tauri backend - no index building required"),this.autocompleteIndexBuilt=!0,this.connectionRetries=0,console.log("Tauri autocomplete ready"),!0):await this.buildMCPIndex()}catch(e){return console.error("Error building Novel autocomplete index:",e),!1}finally{this.isConnecting=!1}}async buildMCPIndex(){for(let e=0;e<=this.maxRetries;e++)try{const t=await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:Date.now(),method:"tools/call",params:{name:"build_autocomplete_index",arguments:{}}}),signal:AbortSignal.timeout(1e4)});if(t.ok){const n=await t.json();if(console.log(`MCP build index response (attempt ${e+1}):`,n),n.result&&!n.result.is_error)return this.autocompleteIndexBuilt=!0,this.connectionRetries=0,console.log("MCP autocomplete index built successfully"),!0}else if(t.status>=500&&e<this.maxRetries){console.warn(`MCP server error ${t.status}, retrying in ${this.retryDelay}ms...`),await new Promise(n=>setTimeout(n,this.retryDelay*(e+1)));continue}console.warn(`MCP build index failed (attempt ${e+1}):`,t.status,t.statusText)}catch(t){t instanceof Error&&t.name==="AbortError"?console.warn(`MCP request timeout (attempt ${e+1})`):console.warn(`MCP connection error (attempt ${e+1}):`,t),e<this.maxRetries&&await new Promise(n=>setTimeout(n,this.retryDelay*(e+1)))}return console.error("Failed to build MCP autocomplete index after all retries"),!1}async getCompletion(e){if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return{text:""};try{const t=this.extractLastWord(e.prompt);if(!t||t.length<1)return{text:""};const n=await this.getSuggestionsWithSnippets(t,5);if(n.length===0)return{text:""};let a=n[0].text;a.toLowerCase().startsWith(t.toLowerCase())&&(a=a.substring(t.length));const s=e.prompt.length/4,u=a.length/4;return{text:a,usage:{promptTokens:Math.round(s),completionTokens:Math.round(u),totalTokens:Math.round(s+u)}}}catch(t){return console.error("Error getting Novel autocomplete completion:",t),{text:""}}}async getSuggestions(e,t=10){if(!e||e.trim().length===0)return[];if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return console.warn("Autocomplete index not built, returning empty suggestions"),[];try{return Jt()?await this.getTauriSuggestions(e,t):await this.getMCPSuggestions(e,t,"autocomplete_terms")}catch(n){return console.error("Error getting autocomplete suggestions:",n),[]}}async getTauriSuggestions(e,t){const n=await Ue("get_autocomplete_suggestions",{query:e.trim(),role_name:this.currentRole,limit:t});return console.log("Tauri autocomplete response:",n),n&&n.status==="success"&&n.suggestions?n.suggestions.map(o=>({text:o.term||o.text||"",snippet:o.url||o.snippet||"",score:o.score||1})).filter(o=>o.text.length>0):(n&&n.error&&console.error("Tauri autocomplete error:",n.error),[])}async getMCPSuggestions(e,t,n){const o=Date.now(),a=await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:o,method:"tools/call",params:{name:n,arguments:{query:e.trim(),limit:t,role:this.currentRole}}}),signal:AbortSignal.timeout(5e3)});if(!a.ok)return console.error(`MCP ${n} request failed:`,a.status,a.statusText),[];const s=await a.json();return console.log(`MCP ${n} response:`,s),s.result&&!s.result.is_error&&s.result.content?n==="autocomplete_with_snippets"?this.parseAutocompleteWithSnippetsContent(s.result.content):this.parseAutocompleteContent(s.result.content):(s.error&&console.error(`MCP ${n} error:`,s.error),[])}async getSuggestionsWithSnippets(e,t=10){if(!e||e.trim().length===0)return[];if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return console.warn("Autocomplete index not built, returning empty suggestions with snippets"),[];try{return Jt()?await this.getTauriSuggestions(e,t):await this.getMCPSuggestions(e,t,"autocomplete_with_snippets")}catch(n){return console.error("Error getting autocomplete suggestions with snippets:",n),[]}}extractLastWord(e){const t=e.trim().split(/\s+/);return t[t.length-1]||""}parseAutocompleteContent(e){const t=[];for(const n of e)if(n.type==="text"&&n.text){if(!n.text.startsWith("Found")&&!n.text.startsWith("‚Ä¢"))t.push({text:n.text.trim()});else if(n.text.startsWith("‚Ä¢")){const o=n.text.replace("‚Ä¢","").trim();o&&t.push({text:o})}}return t}parseAutocompleteWithSnippetsContent(e){const t=[];for(const n of e)if(n.type==="text"&&n.text){if(!n.text.startsWith("Found")&&!n.text.startsWith("‚Ä¢")){const o=n.text.split(" ‚Äî ");o.length===2?t.push({text:o[0].trim(),snippet:o[1].trim()}):t.push({text:n.text.trim()})}else if(n.text.startsWith("‚Ä¢")){const o=n.text.replace("‚Ä¢","").trim();o&&t.push({text:o})}}return t}isReady(){return this.autocompleteIndexBuilt}getStatus(){return{ready:this.autocompleteIndexBuilt,baseUrl:this.baseUrl,sessionId:this.sessionId,usingTauri:Jt(),currentRole:this.currentRole,connectionRetries:this.connectionRetries,isConnecting:this.isConnecting}}async refreshIndex(){return this.autocompleteIndexBuilt=!1,this.connectionRetries=0,await this.buildAutocompleteIndex()}async testConnection(){try{if(Jt()){const e=await Ue("get_autocomplete_suggestions",{query:"test",role_name:this.currentRole,limit:1});return e&&(e.status==="success"||e.status==="error")}else return(await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:Date.now(),method:"tools/list",params:{}}),signal:AbortSignal.timeout(3e3)})).ok}catch(e){return console.warn("Connection test failed:",e),!1}}}const Ot=new ii;function ai(l){var e;const{char:t,allowSpaces:n,allowToIncludeChar:o,allowedPrefixes:a,startOfLine:s,$position:u}=l,i=n&&!o,d=br(t),p=new RegExp(`\\s${d}$`),m=s?"^":"",_=o?"":d,g=i?new RegExp(`${m}${d}.*?(?=\\s${_}|$)`,"gm"):new RegExp(`${m}(?:^)?${d}[^\\s${_}]*`,"gm"),w=((e=u.nodeBefore)===null||e===void 0?void 0:e.isText)&&u.nodeBefore.text;if(!w)return null;const h=u.pos-w.length,k=Array.from(w.matchAll(g)).pop();if(!k||k.input===void 0||k.index===void 0)return null;const $=k.input.slice(Math.max(0,k.index-1),k.index),y=new RegExp(`^[${a==null?void 0:a.join("")}\0]?$`).test($);if(a!==null&&!y)return null;const b=h+k.index;let C=b+k[0].length;return i&&p.test(w.slice(C-1,C+1))&&(k[0]+=" ",C+=1),b<u.pos&&C>=u.pos?{range:{from:b,to:C},query:k[0].slice(t.length),text:k[0]}:null}const ci=new Gs("suggestion");function ui({pluginKey:l=ci,editor:e,char:t="@",allowSpaces:n=!1,allowToIncludeChar:o=!1,allowedPrefixes:a=[" "],startOfLine:s=!1,decorationTag:u="span",decorationClass:i="suggestion",decorationContent:d="",decorationEmptyClass:p="is-empty",command:m=()=>null,items:_=()=>[],render:g=()=>({}),allow:w=()=>!0,findSuggestionMatch:h=ai}){let k;const $=g==null?void 0:g(),y=new gr({key:l,view(){return{update:async(b,C)=>{var K,N,O,R,F,x,Q;const E=(K=this.key)===null||K===void 0?void 0:K.getState(C),L=(N=this.key)===null||N===void 0?void 0:N.getState(b.state),se=E.active&&L.active&&E.range.from!==L.range.from,J=!E.active&&L.active,ie=E.active&&!L.active,ee=!J&&!ie&&E.query!==L.query,z=J||se&&ee,Z=ee||se,I=ie||se&&ee;if(!z&&!Z&&!I)return;const j=I&&!z?E:L,A=b.dom.querySelector(`[data-decoration-id="${j.decorationId}"]`);k={editor:e,range:j.range,query:j.query,text:j.text,items:[],command:P=>m({editor:e,range:j.range,props:P}),decorationNode:A,clientRect:A?()=>{var P;const{decorationId:G}=(P=this.key)===null||P===void 0?void 0:P.getState(e.state),oe=b.dom.querySelector(`[data-decoration-id="${G}"]`);return(oe==null?void 0:oe.getBoundingClientRect())||null}:null},z&&((O=$==null?void 0:$.onBeforeStart)===null||O===void 0||O.call($,k)),Z&&((R=$==null?void 0:$.onBeforeUpdate)===null||R===void 0||R.call($,k)),(Z||z)&&(k.items=await _({editor:e,query:j.query})),I&&((F=$==null?void 0:$.onExit)===null||F===void 0||F.call($,k)),Z&&((x=$==null?void 0:$.onUpdate)===null||x===void 0||x.call($,k)),z&&((Q=$==null?void 0:$.onStart)===null||Q===void 0||Q.call($,k))},destroy:()=>{var b;k&&((b=$==null?void 0:$.onExit)===null||b===void 0||b.call($,k))}}},state:{init(){return{active:!1,range:{from:0,to:0},query:null,text:null,composing:!1}},apply(b,C,K,N){const{isEditable:O}=e,{composing:R}=e.view,{selection:F}=b,{empty:x,from:Q}=F,E={...C};if(E.composing=R,O&&(x||e.view.composing)){(Q<C.range.from||Q>C.range.to)&&!R&&!C.composing&&(E.active=!1);const L=h({char:t,allowSpaces:n,allowToIncludeChar:o,allowedPrefixes:a,startOfLine:s,$position:F.$from}),se=`id_${Math.floor(Math.random()*4294967295)}`;L&&w({editor:e,state:N,range:L.range,isActive:C.active})?(E.active=!0,E.decorationId=C.decorationId?C.decorationId:se,E.range=L.range,E.query=L.query,E.text=L.text):E.active=!1}else E.active=!1;return E.active||(E.decorationId=null,E.range={from:0,to:0},E.query=null,E.text=null),E}},props:{handleKeyDown(b,C){var K;const{active:N,range:O}=y.getState(b.state);return N&&((K=$==null?void 0:$.onKeyDown)===null||K===void 0?void 0:K.call($,{view:b,event:C,range:O}))||!1},decorations(b){const{active:C,range:K,decorationId:N,query:O}=y.getState(b);if(!C)return null;const R=!(O!=null&&O.length),F=[i];return R&&F.push(p),hr.create(b.doc,[vr.inline(K.from,K.to,{nodeName:u,class:F.join(" "),"data-decoration-id":N,"data-decoration-content":d})])}}});return y}const An=kr.create({name:"terraphimSuggestion",addOptions(){return{trigger:"++",pluginKey:new Gs("terraphimSuggestion"),allowSpaces:!1,limit:8,minLength:1,debounce:300}},addCommands(){return{insertSuggestion:l=>({commands:e,chain:t})=>t().insertContent(l.text).run()}},addProseMirrorPlugins(){const l={editor:this.editor,char:this.options.trigger,pluginKey:this.options.pluginKey,allowSpaces:this.options.allowSpaces,startOfLine:!1,command:({editor:e,range:t,props:n})=>{const o=n;e.chain().focus().insertContentAt(t,o.text+" ").run()},items:async({query:e,editor:t})=>new Promise(n=>{setTimeout(async()=>{if(e.length<this.options.minLength){n([]);return}try{const o=await Ot.getSuggestionsWithSnippets(e,this.options.limit);console.log(`TerraphimSuggestion: Found ${o.length} suggestions for "${e}"`),n(o)}catch(o){console.error("TerraphimSuggestion: Error getting suggestions:",o),n([])}},this.options.debounce)}),render:()=>{let e,t;return{onStart:n=>{e=new fi({items:n.items,command:n.command}),n.clientRect&&(t=Tr("body",{getReferenceClientRect:n.clientRect,appendTo:()=>document.body,content:e.element,showOnCreate:!0,interactive:!0,trigger:"manual",placement:"bottom-start",theme:"terraphim-suggestion",maxWidth:"none"})[0])},onUpdate(n){e==null||e.updateItems(n.items),n.clientRect&&(t==null||t.setProps({getReferenceClientRect:n.clientRect}))},onKeyDown(n){return n.event.key==="Escape"?(t==null||t.hide(),!0):(e==null?void 0:e.onKeyDown(n))??!1},onExit(){t==null||t.destroy(),e==null||e.destroy()}}}};return[ui(l)]}});class fi{constructor(e){Ct(this,"element");Ct(this,"items",[]);Ct(this,"selectedIndex",0);Ct(this,"command");this.items=e.items,this.command=e.command,this.element=document.createElement("div"),this.element.className="terraphim-suggestion-dropdown",this.render()}updateItems(e){this.items=e,this.selectedIndex=0,this.render()}onKeyDown({event:e}){return e.key==="ArrowUp"?(this.selectPrevious(),!0):e.key==="ArrowDown"?(this.selectNext(),!0):e.key==="Enter"||e.key==="Tab"?(this.selectItem(this.selectedIndex),!0):!1}selectPrevious(){this.selectedIndex=Math.max(0,this.selectedIndex-1),this.render()}selectNext(){this.selectedIndex=Math.min(this.items.length-1,this.selectedIndex+1),this.render()}selectItem(e){const t=this.items[e];t&&this.command({id:t.text,...t})}render(){if(this.element.innerHTML="",this.items.length===0){this.element.innerHTML=`
        <div class="terraphim-suggestion-item terraphim-suggestion-empty">
          <div class="terraphim-suggestion-text">No suggestions found</div>
          <div class="terraphim-suggestion-hint">Try a different search term</div>
        </div>
      `;return}const e=document.createElement("div");e.className="terraphim-suggestion-header",e.innerHTML=`
      <div class="terraphim-suggestion-count">${this.items.length} suggestions</div>
      <div class="terraphim-suggestion-hint">‚Üë‚Üì Navigate ‚Ä¢ Tab/Enter Select ‚Ä¢ Esc Cancel</div>
    `,this.element.appendChild(e),this.items.forEach((t,n)=>{const o=document.createElement("div");o.className=`terraphim-suggestion-item ${n===this.selectedIndex?"terraphim-suggestion-selected":""}`,o.innerHTML=`
        <div class="terraphim-suggestion-main">
          <div class="terraphim-suggestion-text">${this.escapeHtml(t.text)}</div>
          ${t.snippet?`<div class="terraphim-suggestion-snippet">${this.escapeHtml(t.snippet)}</div>`:""}
        </div>
        ${t.score?`<div class="terraphim-suggestion-score">${Math.round(t.score*100)}%</div>`:""}
      `,o.addEventListener("click",()=>this.selectItem(n)),o.addEventListener("mouseenter",()=>{this.selectedIndex=n,this.render()}),this.element.appendChild(o)})}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}destroy(){this.element.remove()}}const di=`
.terraphim-suggestion-dropdown {
  background: white;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  box-shadow: 0 10px 38px -10px rgba(22, 23, 24, 0.35), 0 10px 20px -15px rgba(22, 23, 24, 0.2);
  max-height: 300px;
  min-width: 300px;
  overflow-y: auto;
  z-index: 1000;
}

.terraphim-suggestion-header {
  padding: 8px 12px;
  border-bottom: 1px solid #f1f5f9;
  background: #f8fafc;
  font-size: 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.terraphim-suggestion-count {
  font-weight: 600;
  color: #475569;
}

.terraphim-suggestion-hint {
  color: #64748b;
}

.terraphim-suggestion-item {
  padding: 8px 12px;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  border-bottom: 1px solid #f1f5f9;
}

.terraphim-suggestion-item:hover {
  background: #f8fafc;
}

.terraphim-suggestion-selected {
  background: #eff6ff !important;
  border-left: 3px solid #3b82f6;
}

.terraphim-suggestion-empty {
  color: #64748b;
  font-style: italic;
  text-align: center;
  cursor: default;
}

.terraphim-suggestion-main {
  flex: 1;
}

.terraphim-suggestion-text {
  font-weight: 500;
  color: #1e293b;
  margin-bottom: 2px;
}

.terraphim-suggestion-snippet {
  font-size: 12px;
  color: #64748b;
  line-height: 1.3;
}

.terraphim-suggestion-score {
  font-size: 11px;
  color: #10b981;
  font-weight: 600;
  background: #ecfdf5;
  padding: 2px 6px;
  border-radius: 4px;
  margin-left: 8px;
}

/* Dark theme support */
@media (prefers-color-scheme: dark) {
  .terraphim-suggestion-dropdown {
    background: #1e293b;
    border-color: #334155;
  }

  .terraphim-suggestion-header {
    background: #0f172a;
    border-color: #334155;
  }

  .terraphim-suggestion-item:hover {
    background: #334155;
  }

  .terraphim-suggestion-selected {
    background: #1e40af !important;
  }

  .terraphim-suggestion-text {
    color: #f1f5f9;
  }

  .terraphim-suggestion-snippet {
    color: #94a3b8;
  }
}

/* Tippy.js theme */
.tippy-box[data-theme~='terraphim-suggestion'] {
  background: transparent;
  box-shadow: none;
}

.tippy-box[data-theme~='terraphim-suggestion'] > .tippy-backdrop {
  background: transparent;
}

.tippy-box[data-theme~='terraphim-suggestion'] > .tippy-arrow {
  display: none;
}
`;function En(l){let e,t,n,o,a,s,u,i,d,p,m,_,g,w,h,k,$,y,b,C,K,N,O,R,F,x,Q=l[12]?"Tauri (native)":`MCP Server (${Ot.getStatus().baseUrl})`,E,L,se,J,ie,ee,z,Z,I,j,A,P,G,oe,X,re,D,W,le,ne,ce=l[6]!==1?"s":"",ue,H,Y,fe,_e,ke,Te,Xe,Be,Ne,Pe,pe,Se,Me,xe,et,ye,ze,Ge=l[3]?"Enabled":"Disabled",qe,Le,Ie,it,Oe=l[11]&&!l[8]&&Ln(l);function We(B,de){if(B[8])return gi;if(B[11])return _i}let q=We(l),te=q&&q(l);return{c(){e=f("div"),t=f("div"),n=f("strong"),n.textContent="Local Autocomplete Status:",o=v(),a=f("div"),s=f("button"),u=U("Test"),d=v(),p=f("button"),p.textContent="Rebuild Index",m=v(),_=f("button"),g=U("Demo"),h=v(),k=f("div"),$=U(l[10]),y=v(),Oe&&Oe.c(),b=v(),C=f("div"),K=f("strong"),K.textContent="Configuration:",N=v(),O=f("br"),R=U("‚Ä¢ "),F=f("strong"),F.textContent="Backend:",x=v(),E=U(Q),L=v(),se=f("br"),J=U("‚Ä¢ "),ie=f("strong"),ie.textContent="Role:",ee=v(),z=U(l[9]),Z=v(),I=f("br"),j=U("‚Ä¢ "),A=f("strong"),A.textContent="Trigger:",P=U(' "'),G=U(l[4]),oe=U(`" + text
      `),X=f("br"),re=U("‚Ä¢ "),D=f("strong"),D.textContent="Min Length:",W=v(),le=U(l[6]),ne=U(" character"),ue=U(ce),H=v(),Y=f("br"),fe=U("‚Ä¢ "),_e=f("strong"),_e.textContent="Max Results:",ke=v(),Te=U(l[5]),Xe=v(),Be=f("br"),Ne=U("‚Ä¢ "),Pe=f("strong"),Pe.textContent="Debounce:",pe=v(),Se=U(l[7]),Me=U(`ms
      `),xe=f("br"),et=U("‚Ä¢ "),ye=f("strong"),ye.textContent="Snippets:",ze=v(),qe=U(Ge),Le=v(),te&&te.c(),we(n,"color","#495057"),we(s,"padding","4px 8px"),we(s,"background","#007bff"),we(s,"color","white"),we(s,"border","none"),we(s,"border-radius","4px"),we(s,"cursor","pointer"),we(s,"font-size","12px"),s.disabled=i=!l[8],we(p,"padding","4px 8px"),we(p,"background","#28a745"),we(p,"color","white"),we(p,"border","none"),we(p,"border-radius","4px"),we(p,"cursor","pointer"),we(p,"font-size","12px"),we(_,"padding","4px 8px"),we(_,"background","#ffc107"),we(_,"color","#212529"),we(_,"border","none"),we(_,"border-radius","4px"),we(_,"cursor","pointer"),we(_,"font-size","12px"),_.disabled=w=!l[8],we(a,"display","flex"),we(a,"gap","8px"),we(t,"display","flex"),we(t,"justify-content","space-between"),we(t,"align-items","center"),we(t,"margin-bottom","8px"),we(k,"font-size","13px"),we(k,"color","#6c757d"),we(k,"margin-bottom","8px"),we(k,"font-family","monospace"),we(C,"font-size","12px"),we(C,"color","#6c757d"),we(e,"margin-top","10px"),we(e,"padding","12px"),we(e,"background","#f8f9fa"),we(e,"border-radius","6px"),we(e,"border","1px solid #e9ecef")},m(B,de){S(B,e,de),r(e,t),r(t,n),r(t,o),r(t,a),r(a,s),r(s,u),r(a,d),r(a,p),r(a,m),r(a,_),r(_,g),r(e,h),r(e,k),r(k,$),r(e,y),Oe&&Oe.m(e,null),r(e,b),r(e,C),r(C,K),r(C,N),r(C,O),r(C,R),r(C,F),r(C,x),r(C,E),r(C,L),r(C,se),r(C,J),r(C,ie),r(C,ee),r(C,z),r(C,Z),r(C,I),r(C,j),r(C,A),r(C,P),r(C,G),r(C,oe),r(C,X),r(C,re),r(C,D),r(C,W),r(C,le),r(C,ne),r(C,ue),r(C,H),r(C,Y),r(C,fe),r(C,_e),r(C,ke),r(C,Te),r(C,Xe),r(C,Be),r(C,Ne),r(C,Pe),r(C,pe),r(C,Se),r(C,Me),r(C,xe),r(C,et),r(C,ye),r(C,ze),r(C,qe),r(e,Le),te&&te.m(e,null),Ie||(it=[ae(s,"click",l[14]),ae(p,"click",l[15]),ae(_,"click",l[16])],Ie=!0)},p(B,de){de&256&&i!==(i=!B[8])&&(s.disabled=i),de&256&&w!==(w=!B[8])&&(_.disabled=w),de&1024&&be($,B[10]),B[11]&&!B[8]?Oe?Oe.p(B,de):(Oe=Ln(B),Oe.c(),Oe.m(e,b)):Oe&&(Oe.d(1),Oe=null),de&4096&&Q!==(Q=B[12]?"Tauri (native)":`MCP Server (${Ot.getStatus().baseUrl})`)&&be(E,Q),de&512&&be(z,B[9]),de&16&&be(G,B[4]),de&64&&be(le,B[6]),de&64&&ce!==(ce=B[6]!==1?"s":"")&&be(ue,ce),de&32&&be(Te,B[5]),de&128&&be(Se,B[7]),de&8&&Ge!==(Ge=B[3]?"Enabled":"Disabled")&&be(qe,Ge),q===(q=We(B))&&te?te.p(B,de):(te&&te.d(1),te=q&&q(B),te&&(te.c(),te.m(e,null)))},d(B){B&&T(e),Oe&&Oe.d(),te&&te.d(),Ie=!1,Ze(it)}}}function Ln(l){let e,t,n,o;function a(i,d){return i[12]?mi:pi}let s=a(l),u=s(l);return{c(){e=f("div"),t=f("strong"),t.textContent="‚ö†Ô∏è Autocomplete Not Available",n=f("br"),o=v(),u.c(),we(e,"font-size","12px"),we(e,"color","#dc3545"),we(e,"margin-bottom","8px"),we(e,"padding","6px"),we(e,"background","#f8d7da"),we(e,"border-radius","4px")},m(i,d){S(i,e,d),r(e,t),r(e,n),r(e,o),u.m(e,null)},p(i,d){s===(s=a(i))&&u?u.p(i,d):(u.d(1),u=s(i),u&&(u.c(),u.m(e,null)))},d(i){i&&T(e),u.d()}}}function pi(l){let e,t=Ot.getStatus().baseUrl+"",n;return{c(){e=U("MCP server not responding. Ensure the server is running on "),n=U(t)},m(o,a){S(o,e,a),S(o,n,a)},p:Re,d(o){o&&T(e),o&&T(n)}}}function mi(l){let e;return{c(){e=U("Tauri backend connection failed. Ensure the application has proper permissions.")},m(t,n){S(t,e,n)},p:Re,d(t){t&&T(e)}}}function _i(l){let e;return{c(){e=f("div"),e.innerHTML=`<strong>‚ùå Autocomplete Unavailable</strong> 
        <div style="font-size: 11px; margin-top: 4px; color: #721c24;">Click &quot;Rebuild Index&quot; to retry or check server/backend status.</div>`,we(e,"margin-top","8px"),we(e,"padding","8px"),we(e,"background","#f8d7da"),we(e,"border","1px solid #f5c6cb"),we(e,"border-radius","4px")},m(t,n){S(t,e,n)},p:Re,d(t){t&&T(e)}}}function gi(l){let e,t,n,o,a,s,u,i,d,p,m,_,g,w,h,k,$;return{c(){e=f("div"),t=f("strong"),t.textContent="üéØ Autocomplete Active",n=v(),o=f("div"),a=U("Type "),s=f("code"),u=U(l[4]),i=U(" in the editor above to trigger suggestions."),d=f("br"),p=U(`
          Example: `),m=f("code"),_=U(l[4]),g=U("terraphim"),w=U(" or "),h=f("code"),k=U(l[4]),$=U("graph"),we(o,"font-size","11px"),we(o,"margin-top","4px"),we(o,"color","#0056b3"),we(e,"margin-top","8px"),we(e,"padding","8px"),we(e,"background","#d1edff"),we(e,"border","1px solid #b3d9ff"),we(e,"border-radius","4px")},m(y,b){S(y,e,b),r(e,t),r(e,n),r(e,o),r(o,a),r(o,s),r(s,u),r(o,i),r(o,d),r(o,p),r(o,m),r(m,_),r(m,g),r(o,w),r(o,h),r(h,k),r(h,$)},p(y,b){b&16&&be(u,y[4]),b&16&&be(_,y[4]),b&16&&be(k,y[4])},d(y){y&&T(e)}}}function hi(l){let e,t,n,o;e=new Sr({props:{defaultValue:l[0],isEditable:!l[1],disableLocalStorage:!0,onUpdate:l[13],extensions:[yn,...l[2]?[An.configure({trigger:l[4],allowSpaces:!1,limit:l[5],minLength:l[6],debounce:l[7]})]:[]]}});let a=l[2]&&En(l);return{c(){ge(e.$$.fragment),t=v(),a&&a.c(),n=ut()},m(s,u){he(e,s,u),S(s,t,u),a&&a.m(s,u),S(s,n,u),o=!0},p(s,[u]){const i={};u&1&&(i.defaultValue=s[0]),u&2&&(i.isEditable=!s[1]),u&244&&(i.extensions=[yn,...s[2]?[An.configure({trigger:s[4],allowSpaces:!1,limit:s[5],minLength:s[6],debounce:s[7]})]:[]]),e.$set(i),s[2]?a?a.p(s,u):(a=En(s),a.c(),a.m(n.parentNode,n)):a&&(a.d(1),a=null)},i(s){o||(M(e.$$.fragment,s),o=!0)},o(s){V(e.$$.fragment,s),o=!1},d(s){ve(e,s),s&&T(t),a&&a.d(s),s&&T(n)}}}function vi(l,e,t){let n,o;je(l,At,R=>t(9,n=R)),je(l,ct,R=>t(12,o=R));let{html:a=""}=e,{readOnly:s=!1}=e,{outputFormat:u="html"}=e,{enableAutocomplete:i=!0}=e,{showSnippets:d=!0}=e,{suggestionTrigger:p="++"}=e,{maxSuggestions:m=8}=e,{minQueryLength:_=1}=e,{debounceDelay:g=300}=e,w=null,h="‚è≥ Initializing...",k=!1,$=!1,y=null;tl(async()=>{i&&await b(),typeof document<"u"&&(y=document.createElement("style"),y.textContent=di,document.head.appendChild(y))}),Wl(()=>{y&&y.parentNode&&y.parentNode.removeChild(y)});async function b(){t(10,h="‚è≥ Initializing autocomplete..."),t(8,k=!1),t(11,$=!1);try{Ot.setRole(n),t(10,h="üîó Testing connection...");const R=await Ot.testConnection();t(11,$=!0),R?(t(10,h="üî® Building autocomplete index..."),await Ot.buildAutocompleteIndex()?(o?t(10,h="‚úÖ Ready - Using Tauri backend"):t(10,h="‚úÖ Ready - Using MCP server backend"),t(8,k=!0)):t(10,h="‚ùå Failed to build autocomplete index")):o?t(10,h="‚ùå Tauri backend not available"):t(10,h="‚ùå MCP server not responding")}catch(R){console.error("Error initializing autocomplete:",R),t(10,h="‚ùå Autocomplete initialization error")}}const C=R=>{w=R,u==="markdown"?t(0,a=R.storage.markdown.getMarkdown()):t(0,a=R.getHTML())},K=async()=>{if(!$){alert("Please wait for connection test to complete");return}if(!k){alert("Autocomplete service not ready. Check the status above.");return}try{t(10,h="üß™ Testing autocomplete...");const R="terraphim",F=await Ot.getSuggestions(R,5);if(console.log("Autocomplete test results:",F),F.length>0){const x=F.map((Q,E)=>`${E+1}. ${Q.text}${Q.snippet?` (${Q.snippet})`:""}`).join(`
`);alert(`‚úÖ Found ${F.length} suggestions for '${R}':

${x}`),o?t(10,h="‚úÖ Ready - Using Tauri backend"):t(10,h="‚úÖ Ready - Using MCP server backend")}else alert(`‚ö†Ô∏è No suggestions found for '${R}'. This might be normal if the term isn't in your knowledge graph.`)}catch(R){console.error("Autocomplete test failed:",R),alert(`‚ùå Autocomplete test failed: ${R.message}`),t(10,h="‚ùå Test failed - check console for details")}},N=async()=>{t(10,h="‚è≥ Rebuilding index..."),t(8,k=!1);try{await Ot.refreshIndex()?(o?t(10,h="‚úÖ Ready - Tauri index rebuilt successfully"):t(10,h="‚úÖ Ready - MCP server index rebuilt successfully"),t(8,k=!0)):t(10,h="‚ùå Failed to rebuild index")}catch(R){console.error("Error rebuilding index:",R),t(10,h="‚ùå Index rebuild failed - check console for details")}},O=()=>{if(!w){alert("Editor not ready yet");return}const R=`# Terraphim Autocomplete Demo

This is a demonstration of the integrated Terraphim autocomplete system.

## How to Use:
1. Type "${p}" to trigger autocomplete
2. Start typing any term (e.g., "${p}terraphim", "${p}graph")
3. Use ‚Üë‚Üì arrows to navigate suggestions
4. Press Tab or Enter to select
5. Press Esc to cancel

## Try these queries:
- ${p}terraphim
- ${p}graph
- ${p}service
- ${p}automata
- ${p}role

The autocomplete system uses your local knowledge graph to provide intelligent suggestions based on your selected role: **${n}**.

---

Start typing below:`;w.commands.setContent(R),setTimeout(()=>{w.commands.focus("end")},100),alert(`Demo content inserted!

Type "${p}" followed by any term to see autocomplete suggestions.

Example: "${p}terraphim"`)};return l.$$set=R=>{"html"in R&&t(0,a=R.html),"readOnly"in R&&t(1,s=R.readOnly),"outputFormat"in R&&t(17,u=R.outputFormat),"enableAutocomplete"in R&&t(2,i=R.enableAutocomplete),"showSnippets"in R&&t(3,d=R.showSnippets),"suggestionTrigger"in R&&t(4,p=R.suggestionTrigger),"maxSuggestions"in R&&t(5,m=R.maxSuggestions),"minQueryLength"in R&&t(6,_=R.minQueryLength),"debounceDelay"in R&&t(7,g=R.debounceDelay)},l.$$.update=()=>{l.$$.dirty&772&&n&&i&&k&&(Ot.setRole(n),b())},[a,s,i,d,p,m,_,g,k,n,h,$,o,C,K,N,O,u]}class bi extends _t{constructor(e){super(),gt(this,e,vi,hi,pt,{html:0,readOnly:1,outputFormat:17,enableAutocomplete:2,showSnippets:3,suggestionTrigger:4,maxSuggestions:5,minQueryLength:6,debounceDelay:7})}}function In(l){let e,t,n,o,a,s,u,i,d,p,m;return{c(){e=f("div"),t=f("h3"),n=f("span"),n.textContent="Knowledge Graph",o=U(`
          Term: `),a=f("strong"),s=U(l[2]),u=U(" | Rank: "),i=f("strong"),d=U(l[3]),p=v(),m=f("hr"),c(n,"class","tag is-info svelte-329px1"),c(t,"class","subtitle is-6 svelte-329px1"),c(m,"class","svelte-329px1"),c(e,"class","kg-context svelte-329px1")},m(_,g){S(_,e,g),r(e,t),r(t,n),r(t,o),r(t,a),r(a,s),r(t,u),r(t,i),r(i,d),r(e,p),r(e,m)},p(_,g){g&4&&be(s,_[2]),g&8&&be(d,_[3])},d(_){_&&T(e)}}}function ki(l){let e,t,n,o,a,s,u,i;const d=[$i,yi],p=[];function m(_,g){return _[5]?0:1}return t=m(l),n=p[t]=d[t](l),{c(){e=f("div"),n.c(),o=v(),a=f("div"),a.innerHTML='<span class="hint-text svelte-329px1">Double-click to edit ‚Ä¢ Ctrl+E to edit ‚Ä¢ Ctrl+S to save ‚Ä¢ Click KG links to explore</span>',c(a,"class","edit-hint svelte-329px1"),c(e,"class","content-viewer svelte-329px1"),c(e,"tabindex","0"),c(e,"role","button"),c(e,"aria-label","Double-click to edit article content")},m(_,g){S(_,e,g),p[t].m(e,null),r(e,o),r(e,a),l[20](e),s=!0,u||(i=[ae(e,"dblclick",l[14]),ae(e,"keydown",l[15]),ae(e,"click",l[13])],u=!0)},p(_,g){let w=t;t=m(_),t===w?p[t].p(_,g):(Fe(),V(p[w],1,1,()=>{p[w]=null}),Ke(),n=p[t],n?n.p(_,g):(n=p[t]=d[t](_),n.c()),M(n,1),n.m(e,o))},i(_){s||(M(n),s=!0)},o(_){V(n),s=!1},d(_){_&&T(e),p[t].d(),l[20](null),u=!1,Ze(i)}}}function wi(l){let e,t,n,o,a,s,u,i,d,p;function m(g){l[18](g)}let _={outputFormat:l[11]};return l[1].body!==void 0&&(_.html=l[1].body),e=new bi({props:_}),lt.push(()=>st(e,"html",m)),{c(){ge(e.$$.fragment),n=v(),o=f("div"),a=f("button"),a.textContent="Save",s=v(),u=f("button"),u.textContent="Cancel",c(a,"class","button is-primary"),c(u,"class","button is-light"),c(o,"class","edit-controls svelte-329px1")},m(g,w){he(e,g,w),S(g,n,w),S(g,o,w),r(o,a),r(o,s),r(o,u),i=!0,d||(p=[ae(a,"click",l[12]),ae(u,"click",l[19])],d=!0)},p(g,w){const h={};w&2048&&(h.outputFormat=g[11]),!t&&w&2&&(t=!0,h.html=g[1].body,rt(()=>t=!1)),e.$set(h)},i(g){i||(M(e.$$.fragment,g),i=!0)},o(g){V(e.$$.fragment,g),i=!1},d(g){ve(e,g),g&&T(n),g&&T(o),d=!1,Ze(p)}}}function yi(l){let e,t,n;return t=new jl({props:{source:l[1].body}}),{c(){e=f("div"),ge(t.$$.fragment),c(e,"class","markdown-content svelte-329px1")},m(o,a){S(o,e,a),he(t,e,null),n=!0},p(o,a){const s={};a&2&&(s.source=o[1].body),t.$set(s)},i(o){n||(M(t.$$.fragment,o),n=!0)},o(o){V(t.$$.fragment,o),n=!1},d(o){o&&T(e),ve(t)}}}function $i(l){let e,t=l[1].body+"";return{c(){e=f("div"),c(e,"class","prose svelte-329px1")},m(n,o){S(n,e,o),e.innerHTML=t},p(n,o){o&2&&t!==(t=n[1].body+"")&&(e.innerHTML=t)},i:Re,o:Re,d(n){n&&T(e)}}}function Ci(l){let e,t,n,o,a,s=l[1].title+"",u,i,d,p,m,_,g,w=l[2]&&l[3]!==null&&In(l);const h=[wi,ki],k=[];function $(y,b){return y[4]?0:1}return d=$(l),p=k[d]=h[d](l),{c(){e=f("div"),t=f("button"),n=v(),w&&w.c(),o=v(),a=f("h2"),u=U(s),i=v(),p.c(),c(t,"class","delete is-large modal-close-btn svelte-329px1"),c(t,"aria-label","close"),c(a,"class","svelte-329px1"),c(e,"class","box wrapper svelte-329px1")},m(y,b){S(y,e,b),r(e,t),r(e,n),w&&w.m(e,null),r(e,o),r(e,a),r(a,u),r(e,i),k[d].m(e,null),m=!0,_||(g=ae(t,"click",l[17]),_=!0)},p(y,b){y[2]&&y[3]!==null?w?w.p(y,b):(w=In(y),w.c(),w.m(e,o)):w&&(w.d(1),w=null),(!m||b&2)&&s!==(s=y[1].title+"")&&be(u,s);let C=d;d=$(y),d===C?k[d].p(y,b):(Fe(),V(k[C],1,1,()=>{k[C]=null}),Ke(),p=k[d],p?p.p(y,b):(p=k[d]=h[d](y),p.c()),M(p,1),p.m(e,null))},i(y){m||(M(p),m=!0)},o(y){V(p),m=!1},d(y){y&&T(e),w&&w.d(),k[d].d(),_=!1,g()}}}function Dn(l){let e,t,n;function o(s){l[23](s)}let a={$$slots:{default:[Ri]},$$scope:{ctx:l}};return l[7]!==void 0&&(a.active=l[7]),e=new kl({props:a}),lt.push(()=>st(e,"active",o)),{c(){ge(e.$$.fragment)},m(s,u){he(e,s,u),n=!0},p(s,u){const i={};u&536872832&&(i.$$scope={dirty:u,ctx:s}),!t&&u&128&&(t=!0,i.active=s[7],rt(()=>t=!1)),e.$set(i)},i(s){n||(M(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){ve(e,s)}}}function Nn(l){let e,t,n,o,a,s,u,i,d,p,m;return{c(){e=f("div"),t=f("h3"),n=f("span"),n.textContent="Knowledge Graph",o=U(`
            Term: `),a=f("strong"),s=U(l[9]),u=U(" | Rank: "),i=f("strong"),d=U(l[10]),p=v(),m=f("hr"),c(n,"class","tag is-info svelte-329px1"),c(t,"class","subtitle is-6 svelte-329px1"),c(m,"class","svelte-329px1"),c(e,"class","kg-context svelte-329px1")},m(_,g){S(_,e,g),r(e,t),r(t,n),r(t,o),r(t,a),r(a,s),r(t,u),r(t,i),r(i,d),r(e,p),r(e,m)},p(_,g){g&512&&be(s,_[9]),g&1024&&be(d,_[10])},d(_){_&&T(e)}}}function Ti(l){let e,t,n;return t=new jl({props:{source:l[8].body}}),{c(){e=f("div"),ge(t.$$.fragment),c(e,"class","markdown-content svelte-329px1")},m(o,a){S(o,e,a),he(t,e,null),n=!0},p(o,a){const s={};a&256&&(s.source=o[8].body),t.$set(s)},i(o){n||(M(t.$$.fragment,o),n=!0)},o(o){V(t.$$.fragment,o),n=!1},d(o){o&&T(e),ve(t)}}}function Si(l){let e,t=l[8].body+"";return{c(){e=f("div"),c(e,"class","prose svelte-329px1")},m(n,o){S(n,e,o),e.innerHTML=t},p(n,o){o&256&&t!==(t=n[8].body+"")&&(e.innerHTML=t)},i:Re,o:Re,d(n){n&&T(e)}}}function Ri(l){let e,t,n,o,a,s=l[8].title+"",u,i,d,p,m,_,g,w,h,k,$,y=l[9]&&l[10]!==null&&Nn(l);const b=[Si,Ti],C=[];function K(N,O){return O&256&&(p=null),p==null&&(p=!!(N[8].body&&(/<html/i.test(N[8].body)||/<body/i.test(N[8].body)||/<head/i.test(N[8].body)))),p?0:1}return m=K(l,-1),_=C[m]=b[m](l),{c(){e=f("div"),t=f("button"),n=v(),y&&y.c(),o=v(),a=f("h2"),u=U(s),i=v(),d=f("div"),_.c(),g=v(),w=f("div"),w.innerHTML='<span class="hint-text svelte-329px1">Knowledge Graph document ‚Ä¢ Click KG links to explore further</span>',c(t,"class","delete is-large modal-close-btn svelte-329px1"),c(t,"aria-label","close"),c(a,"class","svelte-329px1"),c(w,"class","edit-hint svelte-329px1"),c(d,"class","content-viewer svelte-329px1"),c(d,"tabindex","0"),c(d,"role","button"),c(d,"aria-label","KG document content - click KG links to explore further"),c(e,"class","box wrapper svelte-329px1")},m(N,O){S(N,e,O),r(e,t),r(e,n),y&&y.m(e,null),r(e,o),r(e,a),r(a,u),r(e,i),r(e,d),C[m].m(d,null),r(d,g),r(d,w),h=!0,k||($=[ae(t,"click",l[22]),ae(d,"click",l[13])],k=!0)},p(N,O){N[9]&&N[10]!==null?y?y.p(N,O):(y=Nn(N),y.c(),y.m(e,o)):y&&(y.d(1),y=null),(!h||O&256)&&s!==(s=N[8].title+"")&&be(u,s);let R=m;m=K(N,O),m===R?C[m].p(N,O):(Fe(),V(C[R],1,1,()=>{C[R]=null}),Ke(),_=C[m],_?_.p(N,O):(_=C[m]=b[m](N),_.c()),M(_,1),_.m(d,g))},i(N){h||(M(_),h=!0)},o(N){V(_),h=!1},d(N){N&&T(e),y&&y.d(),C[m].d(),k=!1,Ze($)}}}function Ai(l){let e,t,n,o,a;function s(d){l[21](d)}let u={$$slots:{default:[Ci]},$$scope:{ctx:l}};l[0]!==void 0&&(u.active=l[0]),e=new kl({props:u}),lt.push(()=>st(e,"active",s));let i=l[8]&&Dn(l);return{c(){ge(e.$$.fragment),n=v(),i&&i.c(),o=ut()},m(d,p){he(e,d,p),S(d,n,p),i&&i.m(d,p),S(d,o,p),a=!0},p(d,[p]){const m={};p&536873087&&(m.$$scope={dirty:p,ctx:d}),!t&&p&1&&(t=!0,m.active=d[0],rt(()=>t=!1)),e.$set(m),d[8]?i?(i.p(d,p),p&256&&M(i,1)):(i=Dn(d),i.c(),M(i,1),i.m(o.parentNode,o)):i&&(Fe(),V(i,1,1,()=>{i=null}),Ke())},i(d){a||(M(e.$$.fragment,d),M(i),a=!0)},o(d){V(e.$$.fragment,d),V(i),a=!1},d(d){ve(e,d),d&&T(n),i&&i.d(d),d&&T(o)}}}function Ei(l,e,t){let n,o,a,s;je(l,ct,J=>t(25,a=J)),je(l,At,J=>t(26,s=J));let{active:u=!1}=e,{item:i}=e,{initialEdit:d=!1}=e,{kgTerm:p=null}=e,{kgRank:m=null}=e,_=!1,g,w=!1,h=null,k=null,$=null;async function y(){if(a)try{const J=await Ue("get_document",{documentId:i.id});J!=null&&J.document&&t(1,i=J.document)}catch(J){console.error("Failed to load document",J)}}async function b(){if(!a){t(4,_=!1);return}try{await Ue("create_document",{document:i}),t(4,_=!1)}catch(J){console.error("Failed to save document",J)}}async function C(J){var ie,ee,z,Z,I;t(9,k=J),console.log("üîç KG Link Click Debug Info:"),console.log("  Term clicked:",J),console.log("  Current role:",s),console.log("  Is Tauri mode:",a);try{if(a){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:s,term:J});const j=await Ue("find_documents_for_kg_term",{roleName:s,term:J});console.log("  üì• Tauri response received:"),console.log("    Status:",j.status),console.log("    Results count:",((ie=j.results)==null?void 0:ie.length)||0),console.log("    Total:",j.total||0),console.log("    Full response:",JSON.stringify(j,null,2)),j.status==="success"&&j.results&&j.results.length>0?(t(8,h=j.results[0]),t(10,$=h.rank||0),console.log("  ‚úÖ Found KG document:"),console.log("    Title:",h.title),console.log("    Rank:",$),console.log("    Body length:",((ee=h.body)==null?void 0:ee.length)||0,"characters"),t(7,w=!0)):(console.warn(`  ‚ö†Ô∏è  No KG documents found for term: "${J}" in role: "${s}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const j=Ve.ServerURL,A=encodeURIComponent(s),P=encodeURIComponent(J),G=`${j}/roles/${A}/kg_search?term=${P}`;console.log("  üì§ HTTP Request details:"),console.log("    Base URL:",j),console.log("    Role (encoded):",A),console.log("    Term (encoded):",P),console.log("    Full URL:",G);const oe=await fetch(G);if(console.log("  üì• HTTP Response received:"),console.log("    Status code:",oe.status),console.log("    Status text:",oe.statusText),console.log("    Headers:",Object.fromEntries(oe.headers.entries())),!oe.ok)throw new Error(`HTTP error! Status: ${oe.status} - ${oe.statusText}`);const X=await oe.json();console.log("  üìÑ Response data:"),console.log("    Status:",X.status),console.log("    Results count:",((z=X.results)==null?void 0:z.length)||0),console.log("    Total:",X.total||0),console.log("    Full response:",JSON.stringify(X,null,2)),X.status==="success"&&X.results&&X.results.length>0?(t(8,h=X.results[0]),t(10,$=h.rank||0),console.log("  ‚úÖ Found KG document:"),console.log("    Title:",h.title),console.log("    Rank:",$),console.log("    Body length:",((Z=h.body)==null?void 0:Z.length)||0,"characters"),t(7,w=!0)):(console.warn(`  ‚ö†Ô∏è  No KG documents found for term: "${J}" in role: "${s}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",G))}}catch(j){console.error("‚ùå Error fetching KG document:"),console.error("  Error type:",j.constructor.name),console.error("  Error message:",j.message||j),console.error("  Request details:",{term:J,role:s,isTauri:a,timestamp:new Date().toISOString()}),!a&&((I=j.message)!=null&&I.includes("Failed to fetch"))&&(console.error("  üí° Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{}}function K(J){const ie=J.target;if(ie.tagName==="A"){const ee=ie.getAttribute("href");if(ee&&ee.startsWith("kg:")){J.preventDefault();const z=ee.substring(3);C(z)}}}function N(){t(4,_=!0)}function O(J){J.type!=="dblclick"&&((J.ctrlKey||J.metaKey)&&J.key==="e"&&(J.preventDefault(),t(4,_=!0)),_&&(J.ctrlKey||J.metaKey)&&J.key==="s"&&(J.preventDefault(),b()),J.key==="Escape"&&(J.preventDefault(),_?t(4,_=!1):t(0,u=!1)))}const R=()=>t(0,u=!1);function F(J){l.$$.not_equal(i.body,J)&&(i.body=J,t(1,i))}const x=()=>t(4,_=!1);function Q(J){lt[J?"unshift":"push"](()=>{g=J,t(6,g)})}function E(J){u=J,t(0,u)}const L=()=>t(7,w=!1);function se(J){w=J,t(7,w)}return l.$$set=J=>{"active"in J&&t(0,u=J.active),"item"in J&&t(1,i=J.item),"initialEdit"in J&&t(16,d=J.initialEdit),"kgTerm"in J&&t(2,p=J.kgTerm),"kgRank"in J&&t(3,m=J.kgRank)},l.$$.update=()=>{l.$$.dirty&65537&&u&&d&&t(4,_=!0),l.$$.dirty&19&&u&&i&&!_&&y(),l.$$.dirty&2&&t(5,n=i!=null&&i.body?/<html/i.test(i.body)||/<body/i.test(i.body)||/<head/i.test(i.body)||/^\s*<(!DOCTYPE|html|head|body|div|p|span)/i.test(i.body.trim()):!1),l.$$.dirty&32&&t(11,o=n?"html":"markdown")},[u,i,p,m,_,n,g,w,h,k,$,o,b,K,N,O,d,R,F,x,Q,E,L,se]}class Yl extends _t{constructor(e){super(),gt(this,e,Ei,Ai,pt,{active:0,item:1,initialEdit:16,kgTerm:2,kgRank:3})}}function On(l,e,t){const n=l.slice();return n[33]=e[t],n}function Pn(l,e,t){const n=l.slice();return n[36]=e[t],n}function Un(l,e,t){const n=l.slice();return n[39]=e[t],n}function Mn(l){let e,t;return e=new Bl({props:{type:"is-success",$$slots:{default:[Li]},$$scope:{ctx:l}}}),{c(){ge(e.$$.fragment)},m(n,o){he(e,n,o),t=!0},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function Li(l){let e,t,n;return{c(){e=f("p"),e.innerHTML="<strong>Success!</strong> Article saved to atomic server successfully.",t=v(),n=f("p"),n.textContent="The modal will close automatically..."},m(o,a){S(o,e,a),S(o,t,a),S(o,n,a)},p:Re,d(o){o&&T(e),o&&T(t),o&&T(n)}}}function jn(l){let e,t;return e=new Bl({props:{type:"is-danger",$$slots:{default:[Ii]},$$scope:{ctx:l}}}),{c(){ge(e.$$.fragment)},m(n,o){he(e,n,o),t=!0},p(n,o){const a={};o[0]&8|o[1]&2048&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function Ii(l){let e,t,n,o;return{c(){e=f("p"),t=f("strong"),t.textContent="Error:",n=v(),o=U(l[3])},m(a,s){S(a,e,s),r(e,t),r(e,n),r(e,o)},p(a,s){s[0]&8&&be(o,a[3])},d(a){a&&T(e)}}}function zn(l){var se,J,ie,ee;let e,t,n,o,a,s=(((se=l[1])==null?void 0:se.title)||"Untitled")+"",u,i,d,p,m,_,g=(((J=l[1])==null?void 0:J.rank)||0)+"",w,h,k,$,y,b,C,K,N,O,R=((ie=l[1])==null?void 0:ie.description)&&Hn(l),F=((ee=l[1])==null?void 0:ee.tags)&&Fn(l);function x(z,Z){return z[10].length>0?Ni:Di}let Q=x(l),E=Q(l),L=l[10].length>0&&qn(l);return{c(){e=f("div"),t=f("label"),t.textContent="Document to Save",n=v(),o=f("div"),a=f("h5"),u=U(s),i=v(),R&&R.c(),d=v(),p=f("div"),m=f("span"),_=U("Rank: "),w=U(g),h=v(),F&&F.c(),k=v(),$=f("div"),y=f("label"),y.textContent="Atomic Server",b=v(),C=f("div"),E.c(),K=v(),L&&L.c(),N=ut(),c(t,"class","label"),c(a,"class","title is-6"),c(m,"class","tag is-info svelte-48g63o"),c(p,"class","tags svelte-48g63o"),c(o,"class","box document-preview svelte-48g63o"),c(e,"class","field"),c(y,"class","label"),c(y,"for","atomic-server-select"),c(C,"class","control"),c($,"class","field")},m(z,Z){S(z,e,Z),r(e,t),r(e,n),r(e,o),r(o,a),r(a,u),r(o,i),R&&R.m(o,null),r(o,d),r(o,p),r(p,m),r(m,_),r(m,w),r(p,h),F&&F.m(p,null),S(z,k,Z),S(z,$,Z),r($,y),r($,b),r($,C),E.m(C,null),S(z,K,Z),L&&L.m(z,Z),S(z,N,Z),O=!0},p(z,Z){var I,j,A,P;(!O||Z[0]&2)&&s!==(s=(((I=z[1])==null?void 0:I.title)||"Untitled")+"")&&be(u,s),(j=z[1])!=null&&j.description?R?R.p(z,Z):(R=Hn(z),R.c(),R.m(o,d)):R&&(R.d(1),R=null),(!O||Z[0]&2)&&g!==(g=(((A=z[1])==null?void 0:A.rank)||0)+"")&&be(w,g),(P=z[1])!=null&&P.tags?F?F.p(z,Z):(F=Fn(z),F.c(),F.m(p,null)):F&&(F.d(1),F=null),Q===(Q=x(z))&&E?E.p(z,Z):(E.d(1),E=Q(z),E&&(E.c(),E.m(C,null))),z[10].length>0?L?(L.p(z,Z),Z[0]&1024&&M(L,1)):(L=qn(z),L.c(),M(L,1),L.m(N.parentNode,N)):L&&(Fe(),V(L,1,1,()=>{L=null}),Ke())},i(z){O||(M(L),O=!0)},o(z){V(L),O=!1},d(z){z&&T(e),R&&R.d(),F&&F.d(),z&&T(k),z&&T($),E.d(),z&&T(K),L&&L.d(z),z&&T(N)}}}function Hn(l){let e,t=l[1].description+"",n;return{c(){e=f("p"),n=U(t),c(e,"class","content")},m(o,a){S(o,e,a),r(e,n)},p(o,a){a[0]&2&&t!==(t=o[1].description+"")&&be(n,t)},d(o){o&&T(e)}}}function Fn(l){let e,t=l[1].tags,n=[];for(let o=0;o<t.length;o+=1)n[o]=Kn(Un(l,t,o));return{c(){for(let o=0;o<n.length;o+=1)n[o].c();e=ut()},m(o,a){for(let s=0;s<n.length;s+=1)n[s]&&n[s].m(o,a);S(o,e,a)},p(o,a){if(a[0]&2){t=o[1].tags;let s;for(s=0;s<t.length;s+=1){const u=Un(o,t,s);n[s]?n[s].p(u,a):(n[s]=Kn(u),n[s].c(),n[s].m(e.parentNode,e))}for(;s<n.length;s+=1)n[s].d(1);n.length=t.length}},d(o){tt(n,o),o&&T(e)}}}function Kn(l){let e,t=l[39]+"",n;return{c(){e=f("span"),n=U(t),c(e,"class","tag svelte-48g63o")},m(o,a){S(o,e,a),r(e,n)},p(o,a){a[0]&2&&t!==(t=o[39]+"")&&be(n,t)},d(o){o&&T(e)}}}function Di(l){let e,t,n,o,a,s,u,i,d;return{c(){e=f("div"),t=f("p"),t.innerHTML="<strong>No atomic servers available</strong>",n=v(),o=f("p"),a=U('Your current role "'),s=U(l[12]),u=U(`" doesn't have any writable atomic server configurations.`),i=v(),d=f("p"),d.textContent="Please configure an atomic server haystack in your role settings.",c(e,"class","notification is-warning")},m(p,m){S(p,e,m),r(e,t),r(e,n),r(e,o),r(o,a),r(o,s),r(o,u),r(e,i),r(e,d)},p(p,m){m[0]&4096&&be(s,p[12])},d(p){p&&T(e)}}}function Ni(l){let e,t,n,o,a,s,u=l[10],i=[];for(let d=0;d<u.length;d+=1)i[d]=Gn(Pn(l,u,d));return{c(){e=f("div"),t=f("select");for(let d=0;d<i.length;d+=1)i[d].c();n=v(),o=f("p"),o.textContent=`Select the atomic server from your current role configuration.
              üîê = Authenticated, ‚ö†Ô∏è = Anonymous access`,c(t,"id","atomic-server-select"),t.disabled=l[2],l[11]===void 0&&mt(()=>l[18].call(t)),c(e,"class","select is-fullwidth"),c(o,"class","help svelte-48g63o")},m(d,p){S(d,e,p),r(e,t);for(let m=0;m<i.length;m+=1)i[m]&&i[m].m(t,null);Je(t,l[11],!0),S(d,n,p),S(d,o,p),a||(s=ae(t,"change",l[18]),a=!0)},p(d,p){if(p[0]&1024){u=d[10];let m;for(m=0;m<u.length;m+=1){const _=Pn(d,u,m);i[m]?i[m].p(_,p):(i[m]=Gn(_),i[m].c(),i[m].m(t,null))}for(;m<i.length;m+=1)i[m].d(1);i.length=u.length}p[0]&4&&(t.disabled=d[2]),p[0]&3072&&Je(t,d[11])},d(d){d&&T(e),tt(i,d),d&&T(n),d&&T(o),a=!1,s()}}}function Oi(l){let e;return{c(){e=f("span"),e.textContent="‚ö†Ô∏è No Auth",c(e,"class","has-text-warning")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function Pi(l){let e;return{c(){e=f("span"),e.textContent="üîê",c(e,"class","has-text-success")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function Gn(l){let e,t=l[36].location+"",n,o,a,s;function u(p,m){return p[36].atomic_server_secret?Pi:Oi}let i=u(l),d=i(l);return{c(){e=f("option"),n=U(t),o=v(),d.c(),a=v(),e.__value=s=l[36].location,e.value=e.__value},m(p,m){S(p,e,m),r(e,n),r(e,o),d.m(e,null),r(e,a)},p(p,m){m[0]&1024&&t!==(t=p[36].location+"")&&be(n,t),i!==(i=u(p))&&(d.d(1),d=i(p),d&&(d.c(),d.m(e,a))),m[0]&1024&&s!==(s=p[36].location)&&(e.__value=s,e.value=e.__value)},d(p){p&&T(e),d.d()}}}function qn(l){var q,te;let e,t,n,o,a,s,u,i,d,p,m,_,g,w,h,k,$,y,b,C,K,N,O,R,F,x,Q,E,L,se,J,ie,ee,z,Z,I,j,A,P,G,oe,X,re,D=(l[8]||"Untitled")+"",W,le,ne,ce,ue,H=(((te=(q=l[1])==null?void 0:q.body)==null?void 0:te.length)||0)+"",Y,fe,_e,ke,Te,Xe,Be=l[14]()+"",Ne,Pe,pe,Se,Me,xe=l[15]()+"",et,ye,ze,Ge,qe;function Le(B){l[19](B)}let Ie={id:"article-title",placeholder:"Enter article title",disabled:l[2],required:!0};l[8]!==void 0&&(Ie.value=l[8]),a=new Vt({props:Ie}),lt.push(()=>st(a,"value",Le));const it=[Mi,Ui],Oe=[];function We(B,de){return B[7]?1:0}return x=We(l),Q=Oe[x]=it[x](l),J=new Kt({props:{type:"is-primary",loading:l[2],disabled:l[2]||!l[8].trim()||!l[11],$$slots:{default:[ji]},$$scope:{ctx:l}}}),J.$on("click",l[16]),z=new Kt({props:{type:"is-light",disabled:l[2],$$slots:{default:[zi]},$$scope:{ctx:l}}}),z.$on("click",l[17]),ze=ir(l[22][0]),{c(){e=f("div"),t=f("label"),t.textContent="Article Title",n=v(),o=f("div"),ge(a.$$.fragment),u=v(),i=f("div"),d=f("label"),d.textContent="Description",p=v(),m=f("div"),_=f("textarea"),g=v(),w=f("div"),h=f("label"),h.textContent="Parent Collection",k=v(),$=f("div"),y=f("label"),b=f("input"),C=U(`
              Use predefined collection`),K=v(),N=f("label"),O=f("input"),R=U(`
              Custom parent URL/path`),F=v(),Q.c(),E=v(),L=f("div"),se=f("div"),ge(J.$$.fragment),ie=v(),ee=f("div"),ge(z.$$.fragment),Z=v(),I=f("div"),j=f("div"),A=f("p"),A.innerHTML="<strong>What will be saved:</strong>",P=v(),G=f("ul"),oe=f("li"),X=f("strong"),X.textContent="Title:",re=v(),W=U(D),le=v(),ne=f("li"),ce=f("strong"),ce.textContent="Body:",ue=U(" Original document content ("),Y=U(H),fe=U(" characters)"),_e=v(),ke=f("li"),Te=f("strong"),Te.textContent="Parent:",Xe=v(),Ne=U(Be),Pe=v(),pe=f("li"),Se=f("strong"),Se.textContent="Subject URL:",Me=v(),et=U(xe),c(t,"class","label"),c(t,"for","article-title"),c(o,"class","control"),c(e,"class","field"),c(d,"class","label"),c(d,"for","article-description"),c(_,"id","article-description"),c(_,"class","textarea"),c(_,"placeholder","Brief description of the article"),_.disabled=l[2],c(_,"rows","3"),c(m,"class","control"),c(i,"class","field"),c(h,"class","label"),c(b,"type","radio"),b.__value=!1,b.value=b.__value,b.disabled=l[2],c(y,"class","radio svelte-48g63o"),c(O,"type","radio"),O.__value=!0,O.value=O.__value,O.disabled=l[2],c(N,"class","radio svelte-48g63o"),c($,"class","control"),c(w,"class","field"),c(se,"class","control"),c(ee,"class","control"),c(L,"class","field is-grouped"),c(oe,"class","svelte-48g63o"),c(ne,"class","svelte-48g63o"),c(ke,"class","svelte-48g63o"),c(pe,"class","svelte-48g63o"),c(G,"class","svelte-48g63o"),c(j,"class","notification is-info is-light svelte-48g63o"),c(I,"class","field"),ze.p(b,O)},m(B,de){S(B,e,de),r(e,t),r(e,n),r(e,o),he(a,o,null),S(B,u,de),S(B,i,de),r(i,d),r(i,p),r(i,m),r(m,_),De(_,l[9]),S(B,g,de),S(B,w,de),r(w,h),r(w,k),r(w,$),r($,y),r(y,b),b.checked=b.__value===l[7],r(y,C),r($,K),r($,N),r(N,O),O.checked=O.__value===l[7],r(N,R),S(B,F,de),Oe[x].m(B,de),S(B,E,de),S(B,L,de),r(L,se),he(J,se,null),r(L,ie),r(L,ee),he(z,ee,null),S(B,Z,de),S(B,I,de),r(I,j),r(j,A),r(j,P),r(j,G),r(G,oe),r(oe,X),r(oe,re),r(oe,W),r(G,le),r(G,ne),r(ne,ce),r(ne,ue),r(ne,Y),r(ne,fe),r(G,_e),r(G,ke),r(ke,Te),r(ke,Xe),r(ke,Ne),r(G,Pe),r(G,pe),r(pe,Se),r(pe,Me),r(pe,et),ye=!0,Ge||(qe=[ae(_,"input",l[20]),ae(b,"change",l[21]),ae(O,"change",l[23])],Ge=!0)},p(B,de){var me,Ae;const Ce={};de[0]&4&&(Ce.disabled=B[2]),!s&&de[0]&256&&(s=!0,Ce.value=B[8],rt(()=>s=!1)),a.$set(Ce),(!ye||de[0]&4)&&(_.disabled=B[2]),de[0]&512&&De(_,B[9]),(!ye||de[0]&4)&&(b.disabled=B[2]),de[0]&128&&(b.checked=b.__value===B[7]),(!ye||de[0]&4)&&(O.disabled=B[2]),de[0]&128&&(O.checked=O.__value===B[7]);let $e=x;x=We(B),x===$e?Oe[x].p(B,de):(Fe(),V(Oe[$e],1,1,()=>{Oe[$e]=null}),Ke(),Q=Oe[x],Q?Q.p(B,de):(Q=Oe[x]=it[x](B),Q.c()),M(Q,1),Q.m(E.parentNode,E));const Qe={};de[0]&4&&(Qe.loading=B[2]),de[0]&2308&&(Qe.disabled=B[2]||!B[8].trim()||!B[11]),de[1]&2048&&(Qe.$$scope={dirty:de,ctx:B}),J.$set(Qe);const nt={};de[0]&4&&(nt.disabled=B[2]),de[1]&2048&&(nt.$$scope={dirty:de,ctx:B}),z.$set(nt),(!ye||de[0]&256)&&D!==(D=(B[8]||"Untitled")+"")&&be(W,D),(!ye||de[0]&2)&&H!==(H=(((Ae=(me=B[1])==null?void 0:me.body)==null?void 0:Ae.length)||0)+"")&&be(Y,H)},i(B){ye||(M(a.$$.fragment,B),M(Q),M(J.$$.fragment,B),M(z.$$.fragment,B),ye=!0)},o(B){V(a.$$.fragment,B),V(Q),V(J.$$.fragment,B),V(z.$$.fragment,B),ye=!1},d(B){B&&T(e),ve(a),B&&T(u),B&&T(i),B&&T(g),B&&T(w),B&&T(F),Oe[x].d(B),B&&T(E),B&&T(L),ve(J),ve(z),B&&T(Z),B&&T(I),ze.r(),Ge=!1,Ze(qe)}}}function Ui(l){let e,t,n,o,a,s,u;function i(p){l[25](p)}let d={placeholder:"e.g., my-collection or http://server/custom-parent",disabled:l[2]};return l[6]!==void 0&&(d.value=l[6]),n=new Vt({props:d}),lt.push(()=>st(n,"value",i)),{c(){e=f("div"),t=f("div"),ge(n.$$.fragment),a=v(),s=f("p"),s.textContent=`Enter a collection name (e.g., "my-articles") or full URL.
              If the collection doesn't exist, it will be created.`,c(t,"class","control"),c(s,"class","help svelte-48g63o"),c(e,"class","field")},m(p,m){S(p,e,m),r(e,t),he(n,t,null),r(e,a),r(e,s),u=!0},p(p,m){const _={};m[0]&4&&(_.disabled=p[2]),!o&&m[0]&64&&(o=!0,_.value=p[6],rt(()=>o=!1)),n.$set(_)},i(p){u||(M(n.$$.fragment,p),u=!0)},o(p){V(n.$$.fragment,p),u=!1},d(p){p&&T(e),ve(n)}}}function Mi(l){let e,t,n,o,a,s,u=l[13],i=[];for(let d=0;d<u.length;d+=1)i[d]=Wn(On(l,u,d));return{c(){e=f("div"),t=f("div"),n=f("div"),o=f("select");for(let d=0;d<i.length;d+=1)i[d].c();o.disabled=l[2],l[5]===void 0&&mt(()=>l[24].call(o)),c(n,"class","select is-fullwidth"),c(t,"class","control"),c(e,"class","field")},m(d,p){S(d,e,p),r(e,t),r(t,n),r(n,o);for(let m=0;m<i.length;m+=1)i[m]&&i[m].m(o,null);Je(o,l[5],!0),a||(s=ae(o,"change",l[24]),a=!0)},p(d,p){if(p[0]&8192){u=d[13];let m;for(m=0;m<u.length;m+=1){const _=On(d,u,m);i[m]?i[m].p(_,p):(i[m]=Wn(_),i[m].c(),i[m].m(o,null))}for(;m<i.length;m+=1)i[m].d(1);i.length=u.length}p[0]&4&&(o.disabled=d[2]),p[0]&8224&&Je(o,d[5])},i:Re,o:Re,d(d){d&&T(e),tt(i,d),a=!1,s()}}}function Wn(l){let e,t=l[33].label+"",n;return{c(){e=f("option"),n=U(t),e.__value=l[33].value,e.value=e.__value},m(o,a){S(o,e,a),r(e,n)},p:Re,d(o){o&&T(e)}}}function ji(l){let e,t,n;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-cloud-upload-alt"></i>',t=v(),n=f("span"),n.textContent="Save to Atomic Server",c(e,"class","icon")},m(o,a){S(o,e,a),S(o,t,a),S(o,n,a)},p:Re,d(o){o&&T(e),o&&T(t),o&&T(n)}}}function zi(l){let e;return{c(){e=U("Cancel")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function Hi(l){let e,t,n,o,a,s,u,i,d,p,m,_,g,w=l[4]&&Mn(l),h=l[3]&&jn(l),k=!l[4]&&zn(l);return{c(){e=f("div"),t=f("div"),n=f("div"),n.innerHTML=`<div class="level-item"><h3 class="title is-4"><span class="icon"><i class="fas fa-save"></i></span>
            Save to Atomic Server</h3></div>`,o=v(),a=f("div"),s=f("div"),u=f("button"),i=v(),w&&w.c(),d=v(),h&&h.c(),p=v(),k&&k.c(),c(n,"class","level-left"),c(u,"class","delete is-large"),u.disabled=l[2],c(u,"aria-label","close"),c(s,"class","level-item"),c(a,"class","level-right"),c(t,"class","level svelte-48g63o"),c(e,"class","box")},m($,y){S($,e,y),r(e,t),r(t,n),r(t,o),r(t,a),r(a,s),r(s,u),r(e,i),w&&w.m(e,null),r(e,d),h&&h.m(e,null),r(e,p),k&&k.m(e,null),m=!0,_||(g=ae(u,"click",l[17]),_=!0)},p($,y){(!m||y[0]&4)&&(u.disabled=$[2]),$[4]?w?y[0]&16&&M(w,1):(w=Mn($),w.c(),M(w,1),w.m(e,d)):w&&(Fe(),V(w,1,1,()=>{w=null}),Ke()),$[3]?h?(h.p($,y),y[0]&8&&M(h,1)):(h=jn($),h.c(),M(h,1),h.m(e,p)):h&&(Fe(),V(h,1,1,()=>{h=null}),Ke()),$[4]?k&&(Fe(),V(k,1,1,()=>{k=null}),Ke()):k?(k.p($,y),y[0]&16&&M(k,1)):(k=zn($),k.c(),M(k,1),k.m(e,null))},i($){m||(M(w),M(h),M(k),m=!0)},o($){V(w),V(h),V(k),m=!1},d($){$&&T(e),w&&w.d(),h&&h.d(),k&&k.d(),_=!1,g()}}}function Fi(l){let e,t,n;function o(s){l[26](s)}let a={$$slots:{default:[Hi]},$$scope:{ctx:l}};return l[0]!==void 0&&(a.active=l[0]),e=new kl({props:a}),lt.push(()=>st(e,"active",o)),e.$on("close",l[17]),{c(){ge(e.$$.fragment)},m(s,u){he(e,s,u),n=!0},p(s,u){const i={};u[0]&8190|u[1]&2048&&(i.$$scope={dirty:u,ctx:s}),!t&&u[0]&1&&(t=!0,i.active=s[0],rt(()=>t=!1)),e.$set(i)},i(s){n||(M(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){ve(e,s)}}}function Ki(l,e,t){let n,o,a;je(l,ct,I=>t(27,n=I)),je(l,Lt,I=>t(28,o=I)),je(l,At,I=>t(12,a=I));let{active:s=!1}=e,{document:u}=e,i=!1,d=null,p=!1,m="",_="",g=!1,w="",h="",k=[],$="";const y=[{label:"Root (Server Root)",value:""},{label:"Articles Collection",value:"articles"},{label:"Documents Collection",value:"documents"},{label:"Knowledge Base",value:"knowledge-base"},{label:"Research",value:"research"},{label:"Projects",value:"projects"}];function b(){t(2,i=!1),t(3,d=null),t(4,p=!1),t(5,m=""),t(6,_=""),t(7,g=!1),t(8,w=(u==null?void 0:u.title)||""),t(9,h=(u==null?void 0:u.description)||`Article saved from Terraphim search: ${u==null?void 0:u.title}`),t(10,k=[]),t(11,$="")}function C(){var P;const I=a,j=o;if(!(j!=null&&j.roles)||!I){console.warn("No role configuration found");return}let A=null;try{for(const[G,oe]of Object.entries(j.roles)){const X=oe,re=typeof X.name=="object"?X.name.original:String(X.name);if(G===I||re===I){A=X;break}}}catch(G){console.warn("Error checking role configuration:",G);return}if(!A){console.warn(`Role "${I}" not found in configuration`);return}t(10,k=((P=A.haystacks)==null?void 0:P.filter(G=>G.service==="Atomic"&&G.location&&!G.read_only))||[]),k.length>0&&t(11,$=k[0].location),console.log("Loaded atomic servers:",k)}function K(){const I=k.find(j=>j.location===$);return I==null?void 0:I.atomic_server_secret}function N(){const I=$.replace(/\/$/,"");if(g&&_.trim()){const j=_.trim();return j.startsWith("http://")||j.startsWith("https://")?j:`${I}/${j.replace(/^\//,"")}`}else return m?`${I}/${m}`:I}function O(){return w.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,50)}function R(){const I=$.replace(/\/$/,""),j=O(),A=Date.now();return`${I}/${j}-${A}`}async function F(){if(!$||!w.trim()){t(3,d="Please select an atomic server and provide a title");return}t(2,i=!0),t(3,d=null);try{const I=R(),j=N(),A=K();console.log("üîÑ Saving article to atomic server:",{subject:I,parent:j,server:$,hasSecret:!!A});const P={subject:I,title:w.trim(),description:h.trim(),body:u.body,parent:j,shortname:O(),original_id:u.id,original_url:u.url,original_rank:u.rank,tags:u.tags||[]};if(n)await Ue("save_article_to_atomic",{article:P,serverUrl:$,atomicSecret:A});else{const G=await fetch(`${Ve.ServerURL}/atomic/save`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({article:P,server_url:$,atomic_secret:A})});if(!G.ok){const oe=await G.json().catch(()=>({error:G.statusText}));throw new Error(oe.error||`HTTP ${G.status}: ${G.statusText}`)}}t(4,p=!0),console.log("‚úÖ Article saved successfully to atomic server"),setTimeout(()=>{t(0,s=!1)},2e3)}catch(I){console.error("‚ùå Failed to save article to atomic server:",I),t(3,d=I.message||"Failed to save article to atomic server")}finally{t(2,i=!1)}}function x(){i||t(0,s=!1)}const Q=[[]];function E(){$=St(this),t(11,$),t(10,k)}function L(I){w=I,t(8,w)}function se(){h=this.value,t(9,h)}function J(){g=this.__value,t(7,g)}function ie(){g=this.__value,t(7,g)}function ee(){m=St(this),t(5,m),t(13,y)}function z(I){_=I,t(6,_)}function Z(I){s=I,t(0,s)}return l.$$set=I=>{"active"in I&&t(0,s=I.active),"document"in I&&t(1,u=I.document)},l.$$.update=()=>{l.$$.dirty[0]&3&&s&&u&&(b(),C())},[s,u,i,d,p,m,_,g,w,h,k,$,a,y,N,R,F,x,E,L,se,J,Q,ie,ee,z,Z]}class Gi extends _t{constructor(e){super(),gt(this,e,Ki,Fi,pt,{active:0,document:1},null,[-1,-1])}}async function Zl(l){return Ue("tauri",l)}async function qi(l,e){return Zl({__tauriModule:"Event",message:{cmd:"unlisten",event:l,eventId:e}})}async function Wi(l,e,t){return Zl({__tauriModule:"Event",message:{cmd:"listen",event:l,windowLabel:e,handler:Gl(t)}}).then(n=>async()=>qi(l,n))}var Bn;(function(l){l.WINDOW_RESIZED="tauri://resize",l.WINDOW_MOVED="tauri://move",l.WINDOW_CLOSE_REQUESTED="tauri://close-requested",l.WINDOW_CREATED="tauri://window-created",l.WINDOW_DESTROYED="tauri://destroyed",l.WINDOW_FOCUS="tauri://focus",l.WINDOW_BLUR="tauri://blur",l.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",l.WINDOW_THEME_CHANGED="tauri://theme-changed",l.WINDOW_FILE_DROP="tauri://file-drop",l.WINDOW_FILE_DROP_HOVER="tauri://file-drop-hover",l.WINDOW_FILE_DROP_CANCELLED="tauri://file-drop-cancelled",l.MENU="tauri://menu",l.CHECK_UPDATE="tauri://update",l.UPDATE_AVAILABLE="tauri://update-available",l.INSTALL_UPDATE="tauri://update-install",l.STATUS_UPDATE="tauri://update-status",l.DOWNLOAD_PROGRESS="tauri://update-download-progress"})(Bn||(Bn={}));async function Bi(l,e){return Wi(l,null,e)}function Jn(l,e,t){const n=l.slice();return n[9]=e[t],n}function Vn(l){let e,t=l[9].name+"",n,o;return{c(){e=f("option"),n=U(t),e.__value=o=l[9].name,e.value=e.__value},m(a,s){S(a,e,s),r(e,n)},p(a,s){s&1&&t!==(t=a[9].name+"")&&be(n,t),s&1&&o!==(o=a[9].name)&&(e.__value=o,e.value=e.__value)},d(a){a&&T(e)}}}function Ji(l){let e,t,n,o,a,s,u=l[0],i=[];for(let d=0;d<u.length;d+=1)i[d]=Vn(Jn(l,u,d));return{c(){e=f("div"),t=f("div"),n=f("div"),o=f("select");for(let d=0;d<i.length;d+=1)i[d].c();c(n,"class","select"),c(t,"class","control"),c(e,"class","field is-grouped is-grouped-right")},m(d,p){S(d,e,p),r(e,t),r(t,n),r(n,o);for(let m=0;m<i.length;m+=1)i[m]&&i[m].m(o,null);Je(o,l[1]),a||(s=ae(o,"change",l[2]),a=!0)},p(d,[p]){if(p&1){u=d[0];let m;for(m=0;m<u.length;m+=1){const _=Jn(d,u,m);i[m]?i[m].p(_,p):(i[m]=Vn(_),i[m].c(),i[m].m(o,null))}for(;m<i.length;m+=1)i[m].d(1);i.length=u.length}p&3&&Je(o,d[1])},i:Re,o:Re,d(d){d&&T(e),tt(i,d),a=!1,s()}}}function Vi(l,e,t){let n,o,a,s;je(l,Lt,_=>t(5,n=_)),je(l,ct,_=>t(6,o=_)),je(l,$n,_=>t(0,a=_)),je(l,At,_=>t(1,s=_));let u="";async function i(){try{ct.set(window.__TAURI__!==void 0),o?(console.log("Loading config from Tauri"),Ue("get_config").then(_=>{console.log("get_config response",_),_&&_.status==="success"&&d(_.config)}).catch(_=>console.error("Error fetching config in Tauri:",_))):(console.log("Loading config from server"),u=`${Ve.ServerURL}/config/`,fetch(u).then(_=>_.json()).then(_=>{console.log("Config received",_),_&&_.status==="success"&&d(_.config)}).catch(_=>console.error("Error fetching config:",_)))}catch(_){console.error("Unhandled error in loadConfig:",_)}}function d(_){var k;console.log("Updating stores from config:",_);const g={default_role:_.selected_role,..._};Lt.set(g);const w=Object.entries(_.roles).map(([$,y])=>({name:$,...y}));$n.set(w),At.set(_.selected_role);const h=_.roles[_.selected_role];if(console.log("Selected role settings:",h),h){const $=h.theme||"spacelab";console.log("Setting theme to:",$),bl.set($),(k=h.kg)!=null&&k.publish?o?Ue("publish_thesaurus",{roleName:_.selected_role}).then(y=>{console.log("publish_thesaurus response",y),vl.set(y),Tt.set(!0)}).catch(y=>{console.error("Error publishing thesaurus:",y),Tt.set(!1)}):(console.log("Fetching thesaurus from HTTP endpoint for role",_.selected_role),fetch(`${Ve.ServerURL}/thesaurus/${encodeURIComponent(_.selected_role)}`).then(y=>y.json()).then(y=>{console.log("thesaurus HTTP response",y),y&&y.status==="success"&&y.thesaurus?(vl.set(y.thesaurus),Tt.set(!0)):(console.error("Failed to fetch thesaurus:",y),Tt.set(!1))}).catch(y=>{console.error("Error fetching thesaurus:",y),Tt.set(!1)})):Tt.set(!1)}else console.warn("No role settings found for:",_.selected_role),bl.set("spacelab")}typeof window<"u"&&window.__TAURI__&&Bi("role_changed",_=>{console.log("Role changed event received from backend:",_.payload),d(_.payload)});async function p(){await i()}p(),console.log("Using Terraphim Server URL:",Ve.ServerURL);function m(_){var $,y;const w=_.currentTarget.value;console.log("Role change requested:",w),At.set(w);const h=a.find(b=>b.name===w);if(!h){console.error(`No role settings found for role: ${w}.`);return}const k=h.theme||"spacelab";bl.set(k),console.log(`Theme changed to ${k}`),Lt.update(b=>(b.selected_role=w,b)),o?(Ue("select_role",{roleName:w}).catch(b=>console.error("Error selecting role:",b)),($=h.kg)!=null&&$.publish?(console.log("Publishing thesaurus for role",w),Ue("publish_thesaurus",{roleName:w}).then(b=>{vl.set(b),Tt.set(!0)})):Tt.set(!1)):(fetch(`${Ve.ServerURL}/config/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).catch(b=>console.error("Error updating config on server:",b)),(y=h.kg)!=null&&y.publish?(console.log("Fetching thesaurus from HTTP endpoint for role",w),fetch(`${Ve.ServerURL}/thesaurus/${encodeURIComponent(w)}`).then(b=>b.json()).then(b=>{console.log("thesaurus HTTP response",b),b&&b.status==="success"&&b.thesaurus?(vl.set(b.thesaurus),Tt.set(!0)):(console.error("Failed to fetch thesaurus:",b),Tt.set(!1))}).catch(b=>{console.error("Error fetching thesaurus:",b),Tt.set(!1)})):Tt.set(!1))}return[a,s,m,i]}class Ul extends _t{constructor(e){super(),gt(this,e,Vi,Ji,pt,{loadConfig:3})}get loadConfig(){return this.$$.ctx[3]}}function Qn(l,e,t){const n=l.slice();return n[41]=e[t],n}function Yn(l,e,t){const n=l.slice();return n[44]=e[t],n}function Zn(l){let e,t;return e=new Jl({props:{$$slots:{default:[Yi]},$$scope:{ctx:l}}}),{c(){ge(e.$$.fragment)},m(n,o){he(e,n,o),t=!0},p(n,o){const a={};o[0]&129|o[1]&65536&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function Qi(l){let e=l[44]+"",t;return{c(){t=U(e)},m(n,o){S(n,t,o)},p(n,o){o[0]&1&&e!==(e=n[44]+"")&&be(t,e)},d(n){n&&T(t)}}}function Xn(l){let e,t,n,o,a,s;t=new Gt({props:{rounded:!0,$$slots:{default:[Qi]},$$scope:{ctx:l}}});function u(){return l[19](l[44])}return{c(){e=f("button"),ge(t.$$.fragment),n=v(),c(e,"class","tag-button svelte-2smypa"),e.disabled=l[7],c(e,"title","Click to view knowledge graph document")},m(i,d){S(i,e,d),he(t,e,null),r(e,n),o=!0,a||(s=ae(e,"click",u),a=!0)},p(i,d){l=i;const p={};d[0]&1|d[1]&65536&&(p.$$scope={dirty:d,ctx:l}),t.$set(p),(!o||d[0]&128)&&(e.disabled=l[7])},i(i){o||(M(t.$$.fragment,i),o=!0)},o(i){V(t.$$.fragment,i),o=!1},d(i){i&&T(e),ve(t),a=!1,s()}}}function Yi(l){let e,t,n=l[0].tags,o=[];for(let s=0;s<n.length;s+=1)o[s]=Xn(Yn(l,n,s));const a=s=>V(o[s],1,1,()=>{o[s]=null});return{c(){for(let s=0;s<o.length;s+=1)o[s].c();e=ut()},m(s,u){for(let i=0;i<o.length;i+=1)o[i]&&o[i].m(s,u);S(s,e,u),t=!0},p(s,u){if(u[0]&131201){n=s[0].tags;let i;for(i=0;i<n.length;i+=1){const d=Yn(s,n,i);o[i]?(o[i].p(d,u),M(o[i],1)):(o[i]=Xn(d),o[i].c(),M(o[i],1),o[i].m(e.parentNode,e))}for(Fe(),i=n.length;i<o.length;i+=1)a(i);Ke()}},i(s){if(!t){for(let u=0;u<n.length;u+=1)M(o[u]);t=!0}},o(s){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)V(o[u]);t=!1},d(s){tt(o,s),s&&T(e)}}}function Zi(l){let e,t=(l[0].rank||0)+"",n;return{c(){e=U("Rank "),n=U(t)},m(o,a){S(o,e,a),S(o,n,a)},p(o,a){a[0]&1&&t!==(t=(o[0].rank||0)+"")&&be(n,t)},d(o){o&&T(e),o&&T(n)}}}function Xi(l){let e,t;return e=new Gt({props:{rounded:!0,$$slots:{default:[Zi]},$$scope:{ctx:l}}}),{c(){ge(e.$$.fragment)},m(n,o){he(e,n,o),t=!0},p(n,o){const a={};o[0]&1|o[1]&65536&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function xi(l){let e;return{c(){e=f("small"),e.textContent="No description available",c(e,"class","no-description svelte-2smypa")},m(t,n){S(t,e,n)},p:Re,i:Re,o:Re,d(t){t&&T(e)}}}function ea(l){let e,t;return e=new jl({props:{source:l[0].description}}),{c(){ge(e.$$.fragment)},m(n,o){he(e,n,o),t=!0},p(n,o){const a={};o[0]&1&&(a.source=n[0].description),e.$set(a)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function xn(l){let e,t,n,o,a,s;return{c(){e=f("button"),t=f("span"),t.innerHTML='<i class="fas fa-magic" aria-hidden="true"></i>',n=v(),o=f("span"),o.textContent="AI Summary",c(t,"class","icon is-small"),c(e,"class","button is-small is-info is-outlined ai-summary-button svelte-2smypa"),e.disabled=l[9],c(e,"title","Generate AI-powered summary using OpenRouter")},m(u,i){S(u,e,i),r(e,t),r(e,n),r(e,o),a||(s=ae(e,"click",l[18]),a=!0)},p(u,i){i[0]&512&&(e.disabled=u[9])},d(u){u&&T(e),a=!1,s()}}}function eo(l){let e;return{c(){e=f("div"),e.innerHTML=`<span class="icon"><i class="fas fa-spinner fa-spin" aria-hidden="true"></i></span> 
                <small>Generating AI summary...</small>`,c(e,"class","ai-summary-loading svelte-2smypa")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function to(l){let e,t,n,o,a,s,u,i,d,p;return{c(){e=f("div"),t=f("span"),t.innerHTML='<i class="fas fa-exclamation-triangle" aria-hidden="true"></i>',n=v(),o=f("small"),a=U("Summary error: "),s=U(l[10]),u=v(),i=f("button"),i.textContent="Retry",c(t,"class","icon has-text-danger"),c(o,"class","has-text-danger"),c(i,"class","button is-small is-text svelte-2smypa"),c(i,"title","Retry generating summary"),c(e,"class","ai-summary-error svelte-2smypa")},m(m,_){S(m,e,_),r(e,t),r(e,n),r(e,o),r(o,a),r(o,s),r(e,u),r(e,i),d||(p=ae(i,"click",l[20]),d=!0)},p(m,_){_[0]&1024&&be(s,m[10])},d(m){m&&T(e),d=!1,p()}}}function lo(l){let e,t,n,o,a,s,u,i,d,p,m,_,g,w,h,k,$,y,b,C;function K(R,F){return R[12]?la:ta}let N=K(l),O=N(l);return p=new jl({props:{source:l[8]}}),{c(){e=f("div"),t=f("div"),n=f("small"),o=f("span"),o.innerHTML='<i class="fas fa-robot" aria-hidden="true"></i>',a=U(`
                    AI Summary
                    `),O.c(),s=v(),u=f("button"),u.innerHTML='<span class="icon is-small"><i class="fas fa-times" aria-hidden="true"></i></span>',i=v(),d=f("div"),ge(p.$$.fragment),m=v(),_=f("div"),g=f("button"),w=f("span"),w.innerHTML='<i class="fas fa-redo" aria-hidden="true"></i>',h=v(),k=f("span"),k.textContent="Regenerate",c(o,"class","icon is-small"),c(n,"class","ai-summary-label svelte-2smypa"),c(u,"class","button is-small is-text svelte-2smypa"),c(u,"title","Hide AI summary"),c(t,"class","ai-summary-header svelte-2smypa"),c(d,"class","ai-summary-content svelte-2smypa"),c(w,"class","icon is-small"),c(g,"class","button is-small is-text svelte-2smypa"),g.disabled=l[9],c(g,"title","Regenerate summary"),c(_,"class","ai-summary-actions svelte-2smypa"),c(e,"class","ai-summary svelte-2smypa")},m(R,F){S(R,e,F),r(e,t),r(t,n),r(n,o),r(n,a),O.m(n,null),r(t,s),r(t,u),r(e,i),r(e,d),he(p,d,null),r(e,m),r(e,_),r(_,g),r(g,w),r(g,h),r(g,k),y=!0,b||(C=[ae(u,"click",l[21]),ae(g,"click",l[22])],b=!0)},p(R,F){N!==(N=K(R))&&(O.d(1),O=N(R),O&&(O.c(),O.m(n,null)));const x={};F[0]&256&&(x.source=R[8]),p.$set(x),(!y||F[0]&512)&&(g.disabled=R[9])},i(R){y||(M(p.$$.fragment,R),mt(()=>{y&&($||($=pl(e,ml,{},!0)),$.run(1))}),y=!0)},o(R){V(p.$$.fragment,R),$||($=pl(e,ml,{},!1)),$.run(0),y=!1},d(R){R&&T(e),O.d(),ve(p),R&&$&&$.end(),b=!1,Ze(C)}}}function ta(l){let e;return{c(){e=f("span"),e.textContent="fresh",c(e,"class","tag is-small is-success")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function la(l){let e;return{c(){e=f("span"),e.textContent="cached",c(e,"class","tag is-small is-light")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function no(l){let e;function t(a,s){return a[41].disabled?sa:a[41].isLink?oa:na}let n=t(l),o=n(l);return{c(){o.c(),e=ut()},m(a,s){o.m(a,s),S(a,e,s)},p(a,s){n===(n=t(a))&&o?o.p(a,s):(o.d(1),o=n(a),o&&(o.c(),o.m(e.parentNode,e)))},d(a){o.d(a),a&&T(e)}}}function na(l){let e,t,n,o,a,s,u,i,d,p;return{c(){var m,_,g;e=f("button"),t=f("span"),n=f("i"),a=v(),c(n,"class",o=Pt(l[41].icon)+" svelte-2smypa"),c(t,"class","icon is-medium"),dt(t,"has-text-primary",(m=l[41].className)==null?void 0:m.includes("primary")),dt(t,"has-text-success",(_=l[41].className)==null?void 0:_.includes("success")),dt(t,"has-text-danger",(g=l[41].className)==null?void 0:g.includes("danger")),c(e,"type","button"),c(e,"class","level-item button is-ghost svelte-2smypa"),c(e,"aria-label",s=l[41].title),c(e,"title",u=l[41].title),c(e,"data-testid",i=l[41].testId||"")},m(m,_){S(m,e,_),r(e,t),r(t,n),r(e,a),d||(p=ae(e,"click",function(){Vl(l[41].action)&&l[41].action.apply(this,arguments)}),d=!0)},p(m,_){var g,w,h;l=m,_[0]&32768&&o!==(o=Pt(l[41].icon)+" svelte-2smypa")&&c(n,"class",o),_[0]&32768&&dt(t,"has-text-primary",(g=l[41].className)==null?void 0:g.includes("primary")),_[0]&32768&&dt(t,"has-text-success",(w=l[41].className)==null?void 0:w.includes("success")),_[0]&32768&&dt(t,"has-text-danger",(h=l[41].className)==null?void 0:h.includes("danger")),_[0]&32768&&s!==(s=l[41].title)&&c(e,"aria-label",s),_[0]&32768&&u!==(u=l[41].title)&&c(e,"title",u),_[0]&32768&&i!==(i=l[41].testId||"")&&c(e,"data-testid",i)},d(m){m&&T(e),d=!1,p()}}}function oa(l){let e,t,n,o,a,s,u,i;return{c(){e=f("a"),t=f("span"),n=f("i"),a=v(),c(n,"class",o=Pt(l[41].icon)+" svelte-2smypa"),c(t,"class","icon is-medium"),dt(t,"has-text-primary",l[41].className),c(e,"href",s=l[41].href),c(e,"target","_blank"),c(e,"class","level-item"),c(e,"aria-label",u=l[41].title),c(e,"title",i=l[41].title)},m(d,p){S(d,e,p),r(e,t),r(t,n),r(e,a)},p(d,p){p[0]&32768&&o!==(o=Pt(d[41].icon)+" svelte-2smypa")&&c(n,"class",o),p[0]&32768&&dt(t,"has-text-primary",d[41].className),p[0]&32768&&s!==(s=d[41].href)&&c(e,"href",s),p[0]&32768&&u!==(u=d[41].title)&&c(e,"aria-label",u),p[0]&32768&&i!==(i=d[41].title)&&c(e,"title",i)},d(d){d&&T(e)}}}function sa(l){let e,t,n,o,a,s,u;return{c(){e=f("button"),t=f("span"),n=f("i"),a=v(),c(n,"class",o=Pt(l[41].icon)+" svelte-2smypa"),c(t,"class","icon is-medium"),dt(t,"has-text-primary",l[41].className),c(e,"type","button"),c(e,"class","level-item button is-ghost svelte-2smypa"),c(e,"aria-label",s=l[41].title),c(e,"title",u=l[41].title),e.disabled=!0},m(i,d){S(i,e,d),r(e,t),r(t,n),r(e,a)},p(i,d){d[0]&32768&&o!==(o=Pt(i[41].icon)+" svelte-2smypa")&&c(n,"class",o),d[0]&32768&&dt(t,"has-text-primary",i[41].className),d[0]&32768&&s!==(s=i[41].title)&&c(e,"aria-label",s),d[0]&32768&&u!==(u=i[41].title)&&c(e,"title",u)},d(i){i&&T(e)}}}function oo(l){let e,t=l[41].visible&&no(l);return{c(){t&&t.c(),e=ut()},m(n,o){t&&t.m(n,o),S(n,e,o)},p(n,o){n[41].visible?t?t.p(n,o):(t=no(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(n){t&&t.d(n),n&&T(e)}}}function so(l){let e,t,n,o,a,s;return{c(){e=f("div"),t=f("button"),n=v(),o=U(l[13]),c(t,"class","delete svelte-2smypa"),c(e,"class","notification is-danger is-light mt-2")},m(u,i){S(u,e,i),r(e,t),r(e,n),r(e,o),a||(s=ae(t,"click",l[23]),a=!0)},p(u,i){i[0]&8192&&be(o,u[13])},d(u){u&&T(e),a=!1,s()}}}function ro(l){let e,t,n;function o(s){l[25](s)}let a={item:l[4],kgTerm:l[5],kgRank:l[6]};return l[2]!==void 0&&(a.active=l[2]),e=new Yl({props:a}),lt.push(()=>st(e,"active",o)),{c(){ge(e.$$.fragment)},m(s,u){he(e,s,u),n=!0},p(s,u){const i={};u[0]&16&&(i.item=s[4]),u[0]&32&&(i.kgTerm=s[5]),u[0]&64&&(i.kgRank=s[6]),!t&&u[0]&4&&(t=!0,i.active=s[2],rt(()=>t=!1)),e.$set(i)},i(s){n||(M(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){ve(e,s)}}}function io(l){let e,t,n;function o(s){l[26](s)}let a={document:l[0]};return l[3]!==void 0&&(a.active=l[3]),e=new Gi({props:a}),lt.push(()=>st(e,"active",o)),{c(){ge(e.$$.fragment)},m(s,u){he(e,s,u),n=!0},p(s,u){const i={};u[0]&1&&(i.document=s[0]),!t&&u[0]&8&&(t=!0,i.active=s[3],rt(()=>t=!1)),e.$set(i)},i(s){n||(M(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){ve(e,s)}}}function ra(l){let e,t,n,o,a,s,u,i,d,p,m,_,g=l[0].title+"",w,h,k,$,y,b,C,K,N,O,R,F,x,Q,E,L,se,J,ie,ee,z,Z,I,j,A,P,G,oe,X,re,D,W=l[0].tags&&Zn(l);i=new Jl({props:{$$slots:{default:[Xi]},$$scope:{ctx:l}}});const le=[ea,xi],ne=[];function ce(pe,Se){return pe[0].description?0:1}C=ce(l),K=ne[C]=le[C](l);let ue=!l[11]&&!l[9]&&!l[10]&&xn(l),H=l[9]&&eo(),Y=l[10]&&to(l),fe=l[11]&&l[8]&&lo(l),_e=l[15],ke=[];for(let pe=0;pe<_e.length;pe+=1)ke[pe]=oo(Qn(l,_e,pe));let Te=l[13]&&so(l);function Xe(pe){l[24](pe)}let Be={item:l[0]};l[1]!==void 0&&(Be.active=l[1]),j=new Yl({props:Be}),lt.push(()=>st(j,"active",Xe));let Ne=l[4]&&ro(l),Pe=l[14]&&io(l);return{c(){e=f("div"),t=f("article"),n=f("div"),o=f("div"),a=f("div"),W&&W.c(),s=v(),u=f("div"),ge(i.$$.fragment),d=v(),p=f("div"),m=f("button"),_=f("h2"),w=U(g),h=v(),k=f("div"),$=f("small"),$.textContent="Description:",y=v(),b=f("div"),K.c(),N=v(),O=f("div"),ue&&ue.c(),R=v(),H&&H.c(),F=v(),Y&&Y.c(),x=v(),fe&&fe.c(),Q=v(),E=f("br"),se=v(),J=f("div"),ie=f("nav"),ee=f("div");for(let pe=0;pe<ke.length;pe+=1)ke[pe].c();Z=v(),Te&&Te.c(),I=v(),ge(j.$$.fragment),P=v(),Ne&&Ne.c(),G=v(),Pe&&Pe.c(),oe=ut(),c(a,"class","level-right"),c(u,"class","level-right"),c(_,"class","title svelte-2smypa"),c(m,"class","svelte-2smypa"),c($,"class","description-label svelte-2smypa"),c(b,"class","description-content svelte-2smypa"),c(k,"class","description svelte-2smypa"),c(O,"class","ai-summary-section svelte-2smypa"),c(o,"class","content"),c(ee,"class","level-right"),c(ie,"class","level is-mobile"),c(J,"class","level-right"),c(n,"class","media-content"),c(t,"class","media"),c(e,"class","box")},m(pe,Se){S(pe,e,Se),r(e,t),r(t,n),r(n,o),r(o,a),W&&W.m(a,null),r(o,s),r(o,u),he(i,u,null),r(o,d),r(o,p),r(p,m),r(m,_),r(_,w),r(p,h),r(p,k),r(k,$),r(k,y),r(k,b),ne[C].m(b,null),r(p,N),r(p,O),ue&&ue.m(O,null),r(O,R),H&&H.m(O,null),r(O,F),Y&&Y.m(O,null),r(O,x),fe&&fe.m(O,null),r(p,Q),r(p,E),r(n,se),r(n,J),r(J,ie),r(ie,ee);for(let Me=0;Me<ke.length;Me+=1)ke[Me]&&ke[Me].m(ee,null);r(e,Z),Te&&Te.m(e,null),S(pe,I,Se),he(j,pe,Se),S(pe,P,Se),Ne&&Ne.m(pe,Se),S(pe,G,Se),Pe&&Pe.m(pe,Se),S(pe,oe,Se),X=!0,re||(D=ae(m,"click",l[16]),re=!0)},p(pe,Se){pe[0].tags?W?(W.p(pe,Se),Se[0]&1&&M(W,1)):(W=Zn(pe),W.c(),M(W,1),W.m(a,null)):W&&(Fe(),V(W,1,1,()=>{W=null}),Ke());const Me={};Se[0]&1|Se[1]&65536&&(Me.$$scope={dirty:Se,ctx:pe}),i.$set(Me),(!X||Se[0]&1)&&g!==(g=pe[0].title+"")&&be(w,g);let xe=C;if(C=ce(pe),C===xe?ne[C].p(pe,Se):(Fe(),V(ne[xe],1,1,()=>{ne[xe]=null}),Ke(),K=ne[C],K?K.p(pe,Se):(K=ne[C]=le[C](pe),K.c()),M(K,1),K.m(b,null)),!pe[11]&&!pe[9]&&!pe[10]?ue?ue.p(pe,Se):(ue=xn(pe),ue.c(),ue.m(O,R)):ue&&(ue.d(1),ue=null),pe[9]?H||(H=eo(),H.c(),H.m(O,F)):H&&(H.d(1),H=null),pe[10]?Y?Y.p(pe,Se):(Y=to(pe),Y.c(),Y.m(O,x)):Y&&(Y.d(1),Y=null),pe[11]&&pe[8]?fe?(fe.p(pe,Se),Se[0]&2304&&M(fe,1)):(fe=lo(pe),fe.c(),M(fe,1),fe.m(O,null)):fe&&(Fe(),V(fe,1,1,()=>{fe=null}),Ke()),Se[0]&32768){_e=pe[15];let ye;for(ye=0;ye<_e.length;ye+=1){const ze=Qn(pe,_e,ye);ke[ye]?ke[ye].p(ze,Se):(ke[ye]=oo(ze),ke[ye].c(),ke[ye].m(ee,null))}for(;ye<ke.length;ye+=1)ke[ye].d(1);ke.length=_e.length}pe[13]?Te?Te.p(pe,Se):(Te=so(pe),Te.c(),Te.m(e,null)):Te&&(Te.d(1),Te=null);const et={};Se[0]&1&&(et.item=pe[0]),!A&&Se[0]&2&&(A=!0,et.active=pe[1],rt(()=>A=!1)),j.$set(et),pe[4]?Ne?(Ne.p(pe,Se),Se[0]&16&&M(Ne,1)):(Ne=ro(pe),Ne.c(),M(Ne,1),Ne.m(G.parentNode,G)):Ne&&(Fe(),V(Ne,1,1,()=>{Ne=null}),Ke()),pe[14]?Pe?(Pe.p(pe,Se),Se[0]&16384&&M(Pe,1)):(Pe=io(pe),Pe.c(),M(Pe,1),Pe.m(oe.parentNode,oe)):Pe&&(Fe(),V(Pe,1,1,()=>{Pe=null}),Ke())},i(pe){X||(M(W),M(i.$$.fragment,pe),M(K),M(fe),mt(()=>{X&&(L||(L=pl(p,ml,{},!0)),L.run(1))}),mt(()=>{X&&(z||(z=pl(ie,ml,{},!0)),z.run(1))}),M(j.$$.fragment,pe),M(Ne),M(Pe),X=!0)},o(pe){V(W),V(i.$$.fragment,pe),V(K),V(fe),L||(L=pl(p,ml,{},!1)),L.run(0),z||(z=pl(ie,ml,{},!1)),z.run(0),V(j.$$.fragment,pe),V(Ne),V(Pe),X=!1},d(pe){pe&&T(e),W&&W.d(),ve(i),ne[C].d(),ue&&ue.d(),H&&H.d(),Y&&Y.d(),fe&&fe.d(),pe&&L&&L.end(),tt(ke,pe),pe&&z&&z.end(),Te&&Te.d(),pe&&T(I),ve(j,pe),pe&&T(P),Ne&&Ne.d(pe),pe&&T(G),Pe&&Pe.d(pe),pe&&T(oe),re=!1,D()}}}function ia(l,e,t){let n,o,a,s,u;je(l,At,D=>t(31,a=D)),je(l,ct,D=>t(32,s=D)),je(l,Lt,D=>t(33,u=D));let{document:i}=e,d=!1,p=!1,m=!1,_=null,g=null,w=null,h=!1,k=null,$=!1,y=null,b=!1,C=!1,K=!1,N=!1,O=null,R=!1,F=!1;function x(){const D=[];return D.push({id:"download-markdown",label:"Download to Markdown",icon:"fas fa-download",action:()=>ie(),visible:!0,title:"Download document as markdown file"}),n&&D.push({id:"save-atomic",label:"Save to Atomic Server",icon:"fas fa-cloud-upload-alt",action:()=>L(),visible:!0,title:"Save article to Atomic Server",className:"has-text-primary"}),i.url&&D.push({id:"external-url",label:"Open URL",icon:"fas fa-link",action:()=>window.open(i.url,"_blank"),visible:!0,title:"Open original URL in new tab",isLink:!0,href:i.url}),D.push({id:"open-vscode",label:"Open in VSCode",icon:"fas fa-code",action:()=>ee(),visible:!0,title:"Open document in VSCode",isLink:!0,href:`vscode://${encodeURIComponent(i.title)}.md?${encodeURIComponent(i.body)}`}),D.push({id:"add-context",label:N?"Added to Context ‚úì":K?"Adding...":"Add to Context",icon:N?"fas fa-check-circle":K?"fas fa-spinner fa-spin":"fas fa-plus-circle",action:()=>z(),visible:!0,title:N?"Document successfully added to chat context. Go to Chat tab to see it.":"Add document to LLM conversation context",disabled:K||N,className:N?"has-text-success":O?"has-text-danger":"",testId:"add-to-context-button"}),D.push({id:"chat-with-document",label:F?"Opening Chat...":R?"Adding to Chat...":"Chat with Document",icon:F?"fas fa-external-link-alt":R?"fas fa-spinner fa-spin":"fas fa-comment-dots",action:()=>Z(),visible:!0,title:F?"Opening chat with this document":"Add document to context and open chat",disabled:R||F||K,className:F?"has-text-info":O?"has-text-danger":"has-text-primary",testId:"chat-with-document-button"}),D}function Q(){var ce;const D=a,W=u;if(!(W!=null&&W.roles)||!D)return!1;let le=null;try{for(const[ue,H]of Object.entries(W.roles)){const Y=H,fe=typeof Y.name=="object"?Y.name.original:String(Y.name);if(ue===D||fe===D){le=Y;break}}}catch(ue){return console.warn("Error checking role configuration:",ue),!1}return le?(((ce=le.haystacks)==null?void 0:ce.filter(ue=>ue.service==="Atomic"&&ue.location&&!ue.read_only))||[]).length>0:!1}const E=()=>{t(1,d=!0)},L=()=>{console.log("üîÑ Opening atomic save modal for document:",i.title),t(3,m=!0)};async function se(D){var W,le,ne,ce,ue;t(7,h=!0),t(5,g=D),console.log("üîç KG Search Debug Info:"),console.log("  Tag clicked:",D),console.log("  Current role:",a),console.log("  Is Tauri mode:",s);try{if(s){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:a,term:D});const H=await Ue("find_documents_for_kg_term",{roleName:a,term:D});console.log("  üì• Tauri response received:"),console.log("    Status:",H.status),console.log("    Results count:",((W=H.results)==null?void 0:W.length)||0),console.log("    Total:",H.total||0),console.log("    Full response:",JSON.stringify(H,null,2)),H.status==="success"&&H.results&&H.results.length>0?(t(4,_=H.results[0]),t(6,w=_.rank||0),console.log("  ‚úÖ Found KG document:"),console.log("    Title:",_.title),console.log("    Rank:",w),console.log("    Body length:",((le=_.body)==null?void 0:le.length)||0,"characters"),t(2,p=!0)):(console.warn(`  ‚ö†Ô∏è  No KG documents found for term: "${D}" in role: "${a}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const H=Ve.ServerURL,Y=encodeURIComponent(a),fe=encodeURIComponent(D),_e=`${H}/roles/${Y}/kg_search?term=${fe}`;console.log("  üì§ HTTP Request details:"),console.log("    Base URL:",H),console.log("    Role (encoded):",Y),console.log("    Term (encoded):",fe),console.log("    Full URL:",_e);const ke=await fetch(_e);if(console.log("  üì• HTTP Response received:"),console.log("    Status code:",ke.status),console.log("    Status text:",ke.statusText),console.log("    Headers:",Object.fromEntries(ke.headers.entries())),!ke.ok)throw new Error(`HTTP error! Status: ${ke.status} - ${ke.statusText}`);const Te=await ke.json();console.log("  üìÑ Response data:"),console.log("    Status:",Te.status),console.log("    Results count:",((ne=Te.results)==null?void 0:ne.length)||0),console.log("    Total:",Te.total||0),console.log("    Full response:",JSON.stringify(Te,null,2)),Te.status==="success"&&Te.results&&Te.results.length>0?(t(4,_=Te.results[0]),t(6,w=_.rank||0),console.log("  ‚úÖ Found KG document:"),console.log("    Title:",_.title),console.log("    Rank:",w),console.log("    Body length:",((ce=_.body)==null?void 0:ce.length)||0,"characters"),t(2,p=!0)):(console.warn(`  ‚ö†Ô∏è  No KG documents found for term: "${D}" in role: "${a}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",_e))}}catch(H){console.error("‚ùå Error fetching KG document:"),console.error("  Error type:",H.constructor.name),console.error("  Error message:",H.message||H),console.error("  Request details:",{tag:D,role:a,isTauri:s,timestamp:new Date().toISOString()}),!s&&((ue=H.message)!=null&&ue.includes("Failed to fetch"))&&(console.error("  üí° Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{t(7,h=!1)}}async function J(){var D;if(!($||!i.id||!a)){t(9,$=!0),t(10,y=null),console.log("ü§ñ AI Summary Debug Info:"),console.log("  Document ID:",i.id),console.log("  Current role:",a),console.log("  Is Tauri mode:",s);try{const W={document_id:i.id,role:a,max_length:250,force_regenerate:!1};console.log("  üì§ Summarization request:",W);let le;if(s){const ue=`${Ve.ServerURL}/documents/summarize`;le=await fetch(ue,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(W)})}else{const ue=`${Ve.ServerURL}/documents/summarize`;le=await fetch(ue,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(W)})}if(console.log("  üì• Summary response received:"),console.log("    Status code:",le.status),console.log("    Status text:",le.statusText),!le.ok)throw new Error(`HTTP error! Status: ${le.status} - ${le.statusText}`);const ne=await le.json();console.log("  üìÑ Summary response data:",ne),ne.status==="success"&&ne.summary?(t(8,k=ne.summary),t(12,C=ne.from_cache||!1),t(11,b=!0),console.log("  ‚úÖ Summary generated successfully"),console.log("    Summary length:",k.length,"characters"),console.log("    From cache:",C),console.log("    Model used:",ne.model_used)):(t(10,y=ne.error||"Failed to generate summary"),console.error("  ‚ùå Summary generation failed:",y))}catch(W){console.error("‚ùå Error generating summary:"),console.error("  Error type:",W.constructor.name),console.error("  Error message:",W.message||W),console.error("  Request details:",{document_id:i.id,role:a,isTauri:s,timestamp:new Date().toISOString()}),t(10,y=W.message||"Network error occurred"),(D=W.message)!=null&&D.includes("Failed to fetch")&&(console.error("  üí° Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Verify OpenRouter is enabled for this role"),console.error("    3. Check OPENROUTER_KEY environment variable"),console.error("    4. Verify server URL in CONFIG.ServerURL"))}finally{t(9,$=!1)}}}function ie(){console.log("üì• Downloading document as markdown:",i.title);let D=`# ${i.title}

`;D+=`**Source:** Terraphim Search
`,D+=`**Rank:** ${i.rank||"N/A"}
`,i.url&&(D+=`**URL:** ${i.url}
`),i.tags&&i.tags.length>0&&(D+=`**Tags:** ${i.tags.join(", ")}
`),D+=`**Downloaded:** ${new Date().toISOString()}

`,i.description&&(D+=`## Description

${i.description}

`),D+=`## Content

${i.body}
`;const W=`${i.title.replace(/[^a-z0-9]/gi,"_").toLowerCase()}_${Date.now()}.md`,le=new Blob([D],{type:"text/markdown"}),ne=URL.createObjectURL(le),ce=window.document.createElement("a");ce.href=ne,ce.download=W,window.document.body.appendChild(ce),ce.click(),window.document.body.removeChild(ce),URL.revokeObjectURL(ne),console.log("‚úÖ Markdown file downloaded:",W)}function ee(){const D=`vscode://${encodeURIComponent(i.title)}.md?${encodeURIComponent(i.body)}`;window.open(D,"_blank")}async function z(){console.log("üìù Adding document to LLM context:",i.title),K=!0,N=!1,t(13,O=null);try{let D=null;if(s){try{const ce=await Ue("list_conversations");if(console.log("üìã Available conversations:",ce),ce!=null&&ce.conversations&&ce.conversations.length>0)D=ce.conversations[0].id,console.log("üéØ Using existing conversation:",D);else{const ue=await Ue("create_conversation",{title:"Search Context",role:a||"default"});if(ue.status==="success"&&ue.conversation_id)D=ue.conversation_id,console.log("üÜï Created new conversation:",D);else throw new Error("Failed to create conversation: "+(ue.error||"Unknown error"))}}catch(ce){throw console.error("‚ùå Failed to manage conversations:",ce),new Error("Could not create or find conversation: "+ce.message)}const le={source_type:"document",document_id:i.id};i.url&&(le.url=i.url),i.tags&&i.tags.length>0&&(le.tags=i.tags.join(", ")),i.rank!==void 0&&(le.rank=i.rank.toString());const ne=await Ue("add_context_to_conversation",{conversationId:D,contextType:"document",title:i.title,content:i.body,metadata:le});console.log("‚úÖ Document added to context via Tauri:",ne)}else{const le=Ve.ServerURL;try{const H=await fetch(`${le}/conversations`);if(H.ok){const Y=await H.json();if(Y.conversations&&Y.conversations.length>0)D=Y.conversations[0].id,console.log("üéØ Using existing conversation:",D);else{const fe=await fetch(`${le}/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"Search Context",role:a||"default"})});if(fe.ok){const _e=await fe.json();if(_e.status==="success"&&_e.conversation_id)D=_e.conversation_id,console.log("üÜï Created new conversation:",D);else throw new Error("Failed to create conversation: "+(_e.error||"Unknown error"))}else throw new Error(`Failed to create conversation: ${fe.status} ${fe.statusText}`)}}else throw new Error(`Failed to list conversations: ${H.status} ${H.statusText}`)}catch(H){throw console.error("‚ùå Failed to manage conversations:",H),new Error("Could not create or find conversation: "+H.message)}const ne=`${le}/conversations/${D}/context`,ce=await fetch(ne,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context_type:"document",title:i.title,content:i.body,metadata:{source_type:"document",document_id:i.id,url:i.url||"",tags:i.tags?i.tags.join(", "):"",rank:i.rank?i.rank.toString():"0"}})});if(!ce.ok)throw new Error(`HTTP error! Status: ${ce.status} - ${ce.statusText}`);const ue=await ce.json();console.log("‚úÖ Document added to context via HTTP:",ue)}console.log("‚úÖ Successfully added document to LLM context"),N=!0;const W=window.document.createElement("div");W.className="notification is-success is-light",W.innerHTML=`
        <button class="delete" onclick="this.parentElement.remove()"></button>
        <strong>‚úì Added to Chat Context</strong><br>
        <small>Document added successfully. <a href="/chat" class="has-text-success has-text-weight-bold">Go to Chat ‚Üí</a> to see it in the context panel.</small>
      `,W.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(W),setTimeout(()=>{W.remove()},8e3),setTimeout(()=>{N=!1},5e3)}catch(D){console.error("‚ùå Error adding document to context:",D),t(13,O=D.message||"Failed to add document to context");const W=window.document.createElement("div");W.className="notification is-danger is-light",W.innerHTML=`
        <button class="delete" onclick="this.parentElement.remove()"></button>
        <strong>‚úó Failed to Add Context</strong><br>
        <small>${O}</small>
      `,W.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(W),setTimeout(()=>{W.remove()},8e3),setTimeout(()=>{t(13,O=null)},5e3)}finally{K=!1}}async function Z(){console.log("üí¨ Adding document to context and opening chat:",i.title),R=!0,F=!1,t(13,O=null);try{let D=null;if(s){try{const ce=await Ue("list_conversations");if(console.log("üìã Available conversations:",ce),ce!=null&&ce.conversations&&ce.conversations.length>0)D=ce.conversations[0].id,console.log("üéØ Using existing conversation:",D);else{const ue=await Ue("create_conversation",{title:"Chat with Documents",role:a||"default"});if(ue.status==="success"&&ue.conversation_id)D=ue.conversation_id,console.log("üÜï Created new conversation:",D);else throw new Error("Failed to create conversation: "+(ue.error||"Unknown error"))}}catch(ce){throw console.error("‚ùå Failed to manage conversations:",ce),new Error("Could not create or find conversation: "+ce.message)}const le={source_type:"document",document_id:i.id};i.url&&(le.url=i.url),i.tags&&i.tags.length>0&&(le.tags=i.tags.join(", ")),i.rank!==void 0&&(le.rank=i.rank.toString());const ne=await Ue("add_context_to_conversation",{conversationId:D,contextType:"document",title:i.title,content:i.body,metadata:le});console.log("‚úÖ Document added to context via Tauri:",ne)}else{const le=Ve.ServerURL;try{const H=await fetch(`${le}/conversations`);if(H.ok){const Y=await H.json();if(Y.conversations&&Y.conversations.length>0)D=Y.conversations[0].id,console.log("üéØ Using existing conversation:",D);else{const fe=await fetch(`${le}/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"Chat with Documents",role:a||"default"})});if(fe.ok){const _e=await fe.json();if(_e.status==="success"&&_e.conversation_id)D=_e.conversation_id,console.log("üÜï Created new conversation:",D);else throw new Error("Failed to create conversation: "+(_e.error||"Unknown error"))}else throw new Error(`Failed to create conversation: ${fe.status} ${fe.statusText}`)}}else throw new Error(`Failed to list conversations: ${H.status} ${H.statusText}`)}catch(H){throw console.error("‚ùå Failed to manage conversations:",H),new Error("Could not create or find conversation: "+H.message)}const ne=`${le}/conversations/${D}/context`,ce=await fetch(ne,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context_type:"document",title:i.title,content:i.body,metadata:{source_type:"document",document_id:i.id,url:i.url||"",tags:i.tags?i.tags.join(", "):"",rank:i.rank?i.rank.toString():"0"}})});if(!ce.ok)throw new Error(`HTTP error! Status: ${ce.status} - ${ce.statusText}`);const ue=await ce.json();console.log("‚úÖ Document added to context via HTTP:",ue)}console.log("‚úÖ Successfully added document to chat context, navigating to chat..."),F=!0;const W=window.document.createElement("div");W.className="notification is-success is-light",W.innerHTML=`
        <strong>üí¨ Opening Chat with Document</strong><br>
        <small>Context added successfully. Redirecting to chat...</small>
      `,W.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(W),setTimeout(()=>{W.remove(),mr.goto("/chat")},1500),setTimeout(()=>{F=!1},2e3)}catch(D){console.error("‚ùå Error adding document to context and opening chat:",D),t(13,O=D.message||"Failed to add document to context");const W=window.document.createElement("div");W.className="notification is-danger is-light",W.innerHTML=`
        <button class="delete" onclick="this.parentElement.remove()"></button>
        <strong>‚úó Failed to Open Chat with Document</strong><br>
        <small>${O}</small>
      `,W.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(W),setTimeout(()=>{W.remove()},8e3),setTimeout(()=>{t(13,O=null)},5e3)}finally{R=!1}}Ul[a]!==void 0&&(console.log("Have attribute",Ul[a]),Ul[a].hasOwnProperty("enableLogseq")?console.log("enable logseq True"):console.log("Didn't make it"));const I=D=>se(D),j=()=>{t(10,y=null),J()},A=()=>t(11,b=!1),P=()=>{J()},G=()=>t(13,O=null);function oe(D){d=D,t(1,d)}function X(D){p=D,t(2,p)}function re(D){m=D,t(3,m)}return l.$$set=D=>{"document"in D&&t(0,i=D.document)},t(14,n=Q()),t(15,o=x()),[i,d,p,m,_,g,w,h,k,$,y,b,C,O,n,o,E,se,J,I,j,A,P,G,oe,X,re]}class aa extends _t{constructor(e){super(),gt(this,e,ia,ra,pt,{document:0},null,[-1,-1])}}const ca="/assets/terraphim_gray.png";function Pl(l){const e=l.trim();if(!e)return{hasOperator:!1,operator:null,terms:[l],originalQuery:l};const t=/\b(AND)\b/,n=/\b(OR)\b/,o=/\b(and)\b/i,a=/\b(or)\b/i,s=t.test(e),u=n.test(e),i=o.test(e)&&!s,d=a.test(e)&&!u;if(s&&!u)return{hasOperator:!0,operator:"AND",terms:e.split(t).filter((m,_)=>_%2===0).map(m=>m.trim()).filter(m=>m.length>0),originalQuery:l};if(u&&!s)return{hasOperator:!0,operator:"OR",terms:e.split(n).filter((m,_)=>_%2===0).map(m=>m.trim()).filter(m=>m.length>0),originalQuery:l};if(s&&u){const p=e.indexOf(" AND "),m=e.indexOf(" OR ");if(p!==-1&&(m===-1||p<m))return{hasOperator:!0,operator:"AND",terms:e.split(/\s+(?:AND|OR)\s+/i).map(g=>g.trim()).filter(g=>g.length>0),originalQuery:l};if(m!==-1)return{hasOperator:!0,operator:"OR",terms:e.split(/\s+(?:AND|OR)\s+/i).map(g=>g.trim()).filter(g=>g.length>0),originalQuery:l}}if(i&&!d)return{hasOperator:!0,operator:"AND",terms:e.split(o).filter((m,_)=>_%2===0).map(m=>m.trim()).filter(m=>m.length>0),originalQuery:l};if(d&&!i)return{hasOperator:!0,operator:"OR",terms:e.split(a).filter((m,_)=>_%2===0).map(m=>m.trim()).filter(m=>m.length>0),originalQuery:l};if(i&&d){const p=e.toLowerCase().indexOf(" and "),m=e.toLowerCase().indexOf(" or ");if(p!==-1&&(m===-1||p<m))return{hasOperator:!0,operator:"AND",terms:e.split(/\s+(?:and|or)\s+/i).map(g=>g.trim()).filter(g=>g.length>0),originalQuery:l};if(m!==-1)return{hasOperator:!0,operator:"OR",terms:e.split(/\s+(?:and|or)\s+/i).map(g=>g.trim()).filter(g=>g.length>0),originalQuery:l}}return{hasOperator:!1,operator:null,terms:[e],originalQuery:l}}function ua(l,e){var n,o;if(l.hasOperator&&l.terms.length>1){const a=l.terms.filter(s=>s.trim().length>0);if(a.length>1)return{search_term:a[0],search_terms:a,operator:(n=l.operator)==null?void 0:n.toLowerCase(),skip:0,limit:50,role:e||null}}return{search_term:((o=l.terms[0])==null?void 0:o.trim())||"",search_terms:void 0,operator:void 0,skip:0,limit:50,role:e||null}}function ao(l,e,t){const n=l.slice();return n[43]=e[t],n}function co(l,e,t){const n=l.slice();return n[46]=e[t],n[48]=t,n}function uo(l,e,t){const n=l.slice();return n[49]=e[t],n[48]=t,n}function fo(l){let e,t=l[3],n=[];for(let o=0;o<t.length;o+=1)n[o]=po(uo(l,t,o));return{c(){e=f("ul");for(let o=0;o<n.length;o+=1)n[o].c();c(e,"class","suggestions svelte-sfnt4t")},m(o,a){S(o,e,a);for(let s=0;s<n.length;s+=1)n[s]&&n[s].m(e,null)},p(o,a){if(a[0]&4120){t=o[3];let s;for(s=0;s<t.length;s+=1){const u=uo(o,t,s);n[s]?n[s].p(u,a):(n[s]=po(u),n[s].c(),n[s].m(e,null))}for(;s<n.length;s+=1)n[s].d(1);n.length=t.length}},d(o){o&&T(e),tt(n,o)}}}function po(l){let e,t=l[49]+"",n,o,a,s,u,i;function d(){return l[20](l[49])}function p(...m){return l[21](l[49],...m)}return{c(){e=f("li"),n=U(t),o=v(),c(e,"tabindex","0"),c(e,"role","option"),c(e,"aria-selected",a=l[48]===l[4]),c(e,"aria-label",s=`Apply suggestion: ${l[49]}`),c(e,"class","svelte-sfnt4t"),dt(e,"active",l[48]===l[4])},m(m,_){S(m,e,_),r(e,n),r(e,o),u||(i=[ae(e,"click",d),ae(e,"keydown",p)],u=!0)},p(m,_){l=m,_[0]&8&&t!==(t=l[49]+"")&&be(n,t),_[0]&16&&a!==(a=l[48]===l[4])&&c(e,"aria-selected",a),_[0]&8&&s!==(s=`Apply suggestion: ${l[49]}`)&&c(e,"aria-label",s),_[0]&16&&dt(e,"active",l[48]===l[4])},d(m){m&&T(e),u=!1,Ze(i)}}}function mo(l){let e,t,n,o,a,s,u;return t=new Jl({props:{$$slots:{default:[pa]},$$scope:{ctx:l}}}),{c(){e=f("div"),ge(t.$$.fragment),n=v(),o=f("button"),o.textContent="Clear all",c(o,"type","button"),c(o,"class","clear-terms-btn svelte-sfnt4t"),c(e,"class","selected-terms-section svelte-sfnt4t")},m(i,d){S(i,e,d),he(t,e,null),r(e,n),r(e,o),a=!0,s||(u=ae(o,"click",l[14]),s=!0)},p(i,d){const p={};d[0]&96|d[1]&1048576&&(p.$$scope={dirty:d,ctx:i}),t.$set(p)},i(i){a||(M(t.$$.fragment,i),a=!0)},o(i){V(t.$$.fragment,i),a=!1},d(i){i&&T(e),ve(t),s=!1,u()}}}function fa(l){let e=l[46].value+"",t,n,o,a,s,u,i;function d(){return l[22](l[46])}return{c(){t=U(e),n=v(),o=f("button"),a=U("√ó"),c(o,"class","remove-tag-btn svelte-sfnt4t"),c(o,"aria-label",s=`Remove term: ${l[46].value}`)},m(p,m){S(p,t,m),S(p,n,m),S(p,o,m),r(o,a),u||(i=ae(o,"click",ur(d)),u=!0)},p(p,m){l=p,m[0]&32&&e!==(e=l[46].value+"")&&be(t,e),m[0]&32&&s!==(s=`Remove term: ${l[46].value}`)&&c(o,"aria-label",s)},d(p){p&&T(t),p&&T(n),p&&T(o),u=!1,i()}}}function _o(l){let e,t,n,o;return t=new Gt({props:{class:"operator-tag",rounded:!0,$$slots:{default:[da]},$$scope:{ctx:l}}}),{c(){e=f("div"),ge(t.$$.fragment),n=v(),c(e,"class","operator-tag-wrapper svelte-sfnt4t")},m(a,s){S(a,e,s),he(t,e,null),r(e,n),o=!0},p(a,s){const u={};s[0]&64|s[1]&1048576&&(u.$$scope={dirty:s,ctx:a}),t.$set(u)},i(a){o||(M(t.$$.fragment,a),o=!0)},o(a){V(t.$$.fragment,a),o=!1},d(a){a&&T(e),ve(t)}}}function da(l){let e=(l[6]||"AND")+"",t;return{c(){t=U(e)},m(n,o){S(n,t,o)},p(n,o){o[0]&64&&e!==(e=(n[6]||"AND")+"")&&be(t,e)},d(n){n&&T(t)}}}function go(l){let e,t,n,o,a;function s(){return l[23](l[46])}t=new Gt({props:{rounded:!0,title:"Click to remove term",$$slots:{default:[fa]},$$scope:{ctx:l}}}),t.$on("click",s);let u=l[48]<l[5].length-1&&_o(l);return{c(){e=f("div"),ge(t.$$.fragment),n=v(),u&&u.c(),o=ut(),c(e,"class","term-tag-wrapper svelte-sfnt4t"),dt(e,"from-kg",l[46].isFromKG)},m(i,d){S(i,e,d),he(t,e,null),S(i,n,d),u&&u.m(i,d),S(i,o,d),a=!0},p(i,d){l=i;const p={};d[0]&32|d[1]&1048576&&(p.$$scope={dirty:d,ctx:l}),t.$set(p),(!a||d[0]&32)&&dt(e,"from-kg",l[46].isFromKG),l[48]<l[5].length-1?u?(u.p(l,d),d[0]&32&&M(u,1)):(u=_o(l),u.c(),M(u,1),u.m(o.parentNode,o)):u&&(Fe(),V(u,1,1,()=>{u=null}),Ke())},i(i){a||(M(t.$$.fragment,i),M(u),a=!0)},o(i){V(t.$$.fragment,i),V(u),a=!1},d(i){i&&T(e),ve(t),i&&T(n),u&&u.d(i),i&&T(o)}}}function pa(l){let e,t,n=l[5],o=[];for(let s=0;s<n.length;s+=1)o[s]=go(co(l,n,s));const a=s=>V(o[s],1,1,()=>{o[s]=null});return{c(){for(let s=0;s<o.length;s+=1)o[s].c();e=ut()},m(s,u){for(let i=0;i<o.length;i+=1)o[i]&&o[i].m(s,u);S(s,e,u),t=!0},p(s,u){if(u[0]&8288){n=s[5];let i;for(i=0;i<n.length;i+=1){const d=co(s,n,i);o[i]?(o[i].p(d,u),M(o[i],1)):(o[i]=go(d),o[i].c(),M(o[i],1),o[i].m(e.parentNode,e))}for(Fe(),i=n.length;i<o.length;i+=1)a(i);Ke()}},i(s){if(!t){for(let u=0;u<n.length;u+=1)M(o[u]);t=!0}},o(s){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)V(o[u]);t=!1},d(s){tt(o,s),s&&T(e)}}}function ho(l){let e,t,n,o;return{c(){e=f("div"),t=f("button"),t.textContent="Parse Terms",c(t,"type","button"),c(t,"class","button is-small is-info"),c(e,"class","search-hint-container svelte-sfnt4t")},m(a,s){S(a,e,s),r(e,t),n||(o=ae(t,"click",l[24]),n=!0)},p:Re,d(a){a&&T(e),n=!1,o()}}}function ma(l){let e,t,n,o,a,s,u,i=l[0]&&(l[0].includes(" AND ")||l[0].includes(" OR "))&&l[5].length===0,d;function p(h){l[19](h)}let m={type:"search",placeholder:l[8]?`Search over Knowledge graph for ${l[7]}`:"Search",icon:"search",expanded:!0,autofocus:!0};l[0]!==void 0&&(m.value=l[0]),n=new Vt({props:m}),lt.push(()=>st(n,"value",p)),n.$on("click",l[15]),n.$on("submit",l[15]),n.$on("keydown",l[11]),n.$on("input",l[10]);let _=l[3].length>0&&fo(l),g=l[5].length>0&&mo(l),w=i&&ho(l);return{c(){e=f("div"),t=f("div"),ge(n.$$.fragment),a=v(),_&&_.c(),s=v(),g&&g.c(),u=v(),w&&w.c(),c(t,"class","input-wrapper svelte-sfnt4t"),c(e,"class","search-row svelte-sfnt4t")},m(h,k){S(h,e,k),r(e,t),he(n,t,null),r(t,a),_&&_.m(t,null),r(e,s),g&&g.m(e,null),r(e,u),w&&w.m(e,null),d=!0},p(h,k){const $={};k[0]&384&&($.placeholder=h[8]?`Search over Knowledge graph for ${h[7]}`:"Search"),!o&&k[0]&1&&(o=!0,$.value=h[0],rt(()=>o=!1)),n.$set($),h[3].length>0?_?_.p(h,k):(_=fo(h),_.c(),_.m(t,null)):_&&(_.d(1),_=null),h[5].length>0?g?(g.p(h,k),k[0]&32&&M(g,1)):(g=mo(h),g.c(),M(g,1),g.m(e,u)):g&&(Fe(),V(g,1,1,()=>{g=null}),Ke()),k[0]&33&&(i=h[0]&&(h[0].includes(" AND ")||h[0].includes(" OR "))&&h[5].length===0),i?w?w.p(h,k):(w=ho(h),w.c(),w.m(e,null)):w&&(w.d(1),w=null)},i(h){d||(M(n.$$.fragment,h),M(g),d=!0)},o(h){V(n.$$.fragment,h),V(g),d=!1},d(h){h&&T(e),ve(n),_&&_.d(),g&&g.d(),w&&w.d()}}}function _a(l){let e,t,n,o,a,s,u,i,d,p;return{c(){e=f("section"),t=f("div"),n=f("img"),a=v(),s=f("p"),s.textContent="I am Terraphim, your personal assistant.",u=v(),i=f("button"),i.innerHTML=`<span class="icon"><i class="fas fa-magic"></i></span> 
        <span>Configuration Wizard</span>`,cr(n.src,o=ca)||c(n,"src",o),c(n,"alt","Terraphim Logo"),c(n,"class","svelte-sfnt4t"),c(i,"class","button is-primary"),c(i,"data-testid","wizard-start"),c(t,"class","content has-text-grey has-text-centered svelte-sfnt4t"),c(e,"class","section")},m(m,_){S(m,e,_),r(e,t),r(t,n),r(t,a),r(t,s),r(t,u),r(t,i),d||(p=ae(i,"click",l[25]),d=!0)},p:Re,i:Re,o:Re,d(m){m&&T(e),d=!1,p()}}}function ga(l){let e,t,n=l[1],o=[];for(let s=0;s<n.length;s+=1)o[s]=vo(ao(l,n,s));const a=s=>V(o[s],1,1,()=>{o[s]=null});return{c(){for(let s=0;s<o.length;s+=1)o[s].c();e=ut()},m(s,u){for(let i=0;i<o.length;i+=1)o[i]&&o[i].m(s,u);S(s,e,u),t=!0},p(s,u){if(u[0]&2){n=s[1];let i;for(i=0;i<n.length;i+=1){const d=ao(s,n,i);o[i]?(o[i].p(d,u),M(o[i],1)):(o[i]=vo(d),o[i].c(),M(o[i],1),o[i].m(e.parentNode,e))}for(Fe(),i=n.length;i<o.length;i+=1)a(i);Ke()}},i(s){if(!t){for(let u=0;u<n.length;u+=1)M(o[u]);t=!0}},o(s){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)V(o[u]);t=!1},d(s){tt(o,s),s&&T(e)}}}function ha(l){let e,t;return{c(){e=f("p"),t=U(l[2]),c(e,"class","error svelte-sfnt4t")},m(n,o){S(n,e,o),r(e,t)},p(n,o){o[0]&4&&be(t,n[2])},i:Re,o:Re,d(n){n&&T(e)}}}function vo(l){let e,t;return e=new aa({props:{document:l[43]}}),{c(){ge(e.$$.fragment)},m(n,o){he(e,n,o),t=!0},p(n,o){const a={};o[0]&2&&(a.document=n[43]),e.$set(a)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function va(l){let e,t,n,o,a,s,u,i,d,p,m;e=new _l({props:{fallbackPath:"/"}}),o=new Ft({props:{$$slots:{default:[ma]},$$scope:{ctx:l}}});const _=[ha,ga,_a],g=[];function w(h,k){return h[2]?0:h[1].length?1:2}return s=w(l),u=g[s]=_[s](l),{c(){ge(e.$$.fragment),t=v(),n=f("form"),ge(o.$$.fragment),a=v(),u.c(),i=ut()},m(h,k){he(e,h,k),S(h,t,k),S(h,n,k),he(o,n,null),S(h,a,k),g[s].m(h,k),S(h,i,k),d=!0,p||(m=ae(n,"submit",ar(l[15])),p=!0)},p(h,k){const $={};k[0]&505|k[1]&1048576&&($.$$scope={dirty:k,ctx:h}),o.$set($);let y=s;s=w(h),s===y?g[s].p(h,k):(Fe(),V(g[y],1,1,()=>{g[y]=null}),Ke(),u=g[s],u?u.p(h,k):(u=g[s]=_[s](h),u.c()),M(u,1),u.m(i.parentNode,i))},i(h){d||(M(e.$$.fragment,h),M(o.$$.fragment,h),M(u),d=!0)},o(h){V(e.$$.fragment,h),V(o.$$.fragment,h),V(u),d=!1},d(h){ve(e,h),h&&T(t),h&&T(n),ve(o),h&&T(a),g[s].d(h),h&&T(i),p=!1,m()}}}function ba(l,e,t){let n,o,a,s,u,i,d;je(l,Ur,D=>t(29,o=D)),je(l,Bt,D=>t(0,a=D)),je(l,ct,D=>t(30,s=D)),je(l,At,D=>t(7,u=D)),je(l,vl,D=>t(18,i=D)),je(l,Tt,D=>t(8,d=D));let p=[],m=null,_=[],g=-1,w=null,h=[],k=null,$=!1,y=null;Wl(()=>{y&&clearTimeout(y),w&&(w.close(),w=null),N()});function b(){if(s){K();return}w&&w.close();const W=`${o.replace("/documents/search","")}/summarization/stream`;try{w=new EventSource(W),w.onopen=()=>{console.log("SSE connection opened for summarization updates")},w.onmessage=le=>{try{const ne=JSON.parse(le.data);console.log("SSE received:",ne),ne.task_id&&ne.status==="completed"&&ne.summary&&O(ne.task_id,ne.summary)}catch(ne){console.warn("Failed to parse SSE message:",ne)}},w.onerror=le=>{console.warn("SSE connection error:",le),setTimeout(()=>{w&&b()},5e3)}}catch(le){console.error("Failed to create SSE connection:",le)}}let C=null;function K(){console.log("Starting polling for summary updates (Tauri mode)"),C&&clearInterval(C),C=setInterval(async()=>{if(p.length!==0)try{const D=J();if(!D)return;const W=await Ue("search",{searchQuery:D});if(W.status==="success"){const le=W.results;let ne=!1;for(let ue=0;ue<Math.min(p.length,le.length);ue++)!p[ue].summarization&&le[ue].summarization&&(ne=!0,console.log(`New AI summary found for document: ${le[ue].title}`));ne&&(t(1,p=le),console.log("Updated results with new AI summaries")),p.filter(ue=>!ue.summarization&&ue.body&&ue.body.length>500).length===0&&(console.log("All summaries complete, stopping polling"),N())}}catch(D){console.error("Error during summary polling:",D)}},2e3),setTimeout(()=>{C&&(console.log("Stopping summary polling after timeout"),N())},3e4)}function N(){C&&(clearInterval(C),C=null)}function O(D,W){t(1,p=p.map(le=>!le.summarization&&le.body&&le.body.length>500?{...le,summarization:W}:le)),console.log(`Updated document summary for task ${D}:`,W)}function R(D){const W=Pl(D);if(W.hasOperator&&W.terms.length>1){const le=W.terms.map(ue=>{const H=n.some(([Y])=>Y.toLowerCase()===ue.toLowerCase());return{value:ue,isFromKG:H}}),ne=h.map(ue=>ue.value),ce=le.map(ue=>ue.value);(JSON.stringify(ne)!==JSON.stringify(ce)||k!==W.operator)&&(t(5,h=le),t(6,k=W.operator))}else W.terms.length===1&&h.length>0?(t(5,h=[]),t(6,k=null)):W.terms.length===0&&(t(5,h=[]),t(6,k=null))}async function F(D){try{if(s){const W=await Ue("get_autocomplete_suggestions",{query:D,roleName:u,limit:8});if(W.status==="success"&&W.suggestions)return W.suggestions.map(le=>le.term)}else{const W=await fetch(`${o.replace("/documents/search","")}/autocomplete/${encodeURIComponent(u)}/${encodeURIComponent(D)}`);if(W.ok){const le=await W.json();if(le.status==="success"&&le.suggestions)return le.suggestions.map(ne=>ne.term)}}return n.filter(([W])=>W.toLowerCase().includes(D.toLowerCase())).map(([W])=>W).slice(0,8)}catch(W){return console.warn("Error fetching term suggestions:",W),[]}}async function x(D){const W=D.trim();if(W.length===0)return[];const ne=Pl(W),ce=W.split(/\s+/),ue=ce[ce.length-1].toLowerCase();if(ne.hasOperator&&ne.terms.length>0){const Y=ne.terms[ne.terms.length-1];return Y&&Y.length>=2?F(Y):[]}if(ce.length>1){const Y=[];if("and".startsWith(ue)&&Y.push("AND"),"or".startsWith(ue)&&Y.push("OR"),Y.length>0)return Y}const H=W.toLowerCase();if(H.includes(" and ")||H.includes(" or ")||H.includes(" AND ")||H.includes(" OR ")){const Y=ue;return Y.length<2?[]:F(Y)}try{return(await F(W)).slice(0,7)}catch(Y){return console.warn("Error fetching autocomplete suggestions:",Y),n.filter(([_e])=>_e.toLowerCase().includes(W.toLowerCase())).map(([_e])=>_e).slice(0,5).slice(0,7)}}async function Q(D){const W=D.target;if(!W||W.selectionStart==null)return;const le=W.selectionStart,ce=a.slice(0,le).split(/\s+/),ue=ce[ce.length-1];if(ue.toLowerCase()==="a"||ue.toLowerCase()==="an")t(3,_=["AND"]);else if(ue.toLowerCase()==="o"||ue.toLowerCase()==="or")t(3,_=["OR"]);else if(ue.length>=2)try{const H=await x(ue);t(3,_=H)}catch(H){console.warn("Failed to get suggestions:",H),t(3,_=[])}else t(3,_=[]);t(4,g=-1)}function E(D){_.length>0?D.key==="ArrowDown"?(D.preventDefault(),t(4,g=(g+1)%_.length)):D.key==="ArrowUp"?(D.preventDefault(),t(4,g=(g-1+_.length)%_.length)):(D.key==="Enter"||D.key==="Tab")&&g!==-1?(D.preventDefault(),se(_[g])):D.key==="Escape"&&(D.preventDefault(),t(3,_=[]),t(4,g=-1)):D.key==="Enter"&&(D.preventDefault(),L())}function L(){R(a),I()}function se(D){if(D==="AND"||D==="OR"){t(6,k=D);const W=Pl(a);W.terms.length>0&&!h.some(le=>le.value===W.terms[W.terms.length-1])&&ie(W.terms[W.terms.length-1]),Ht(Bt,a=a+` ${D} `,a)}else{const W=a.trim().split(/\s+/),le=W[W.length-1];D.toLowerCase().startsWith(le.toLowerCase())?(W[W.length-1]=D,Ht(Bt,a=W.join(" "),a)):ie(D,k)}t(3,_=[]),t(4,g=-1)}function J(){const D=a.trim();if(!D)return null;const W=Pl(D);return{...ua(W,u),skip:0,limit:10}}function ie(D,W=null){const le=n.some(([ne])=>ne.toLowerCase()===D.toLowerCase());h.some(ne=>ne.value.toLowerCase()===D.toLowerCase())||(t(5,h=[...h,{value:D,isFromKG:le}]),W&&h.length>1&&t(6,k=W),z())}function ee(D){t(5,h=h.filter(W=>W.value!==D)),z()}function z(){if(t(16,$=!0),h.length===0)Ht(Bt,a="",a),t(6,k=null);else if(h.length===1)Ht(Bt,a=h[0].value,a),t(6,k=null);else{const D=k||"AND";Ht(Bt,a=h.map(W=>W.value).join(` ${D} `),a)}setTimeout(()=>{t(16,$=!1)},10)}function Z(){t(5,h=[]),t(6,k=null),Ht(Bt,a="",a)}async function I(){if(t(2,m=null),s){if(!a.trim())return;try{const D=J();if(!D)return;const W=await Ue("search",{searchQuery:D});W.status==="success"?(t(1,p=W.results),console.log("Response results"),console.log(p)):(t(2,m=`Search failed: ${W.status}`),console.error("Search failed:",W))}catch(D){t(2,m=`Error in Tauri search: ${D}`),console.error("Error in Tauri search:",D)}}else{if(!a.trim())return;const D=J();if(!D)return;const W=JSON.stringify(D);try{const le=await fetch(o,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:W}),ne=await le.json();if(!le.ok)throw new Error(`HTTP error! Status: ${le.status}`);t(1,p=ne.results),b()}catch(le){console.error("Error fetching data:",le),t(2,m=`Error fetching data: ${le}`)}}}function j(D){a=D,Bt.set(a)}const A=D=>se(D),P=(D,W)=>{(W.key==="Enter"||W.key===" ")&&(W.preventDefault(),se(D))},G=D=>ee(D.value),oe=D=>ee(D.value),X=()=>R(a),re=()=>window.location.href="/config/wizard";return l.$$.update=()=>{l.$$.dirty[0]&262144&&(n=Object.entries(i)),l.$$.dirty[0]&196609&&a&&!$&&(a.includes(" AND ")||a.includes(" OR ")||a.includes(" and ")||a.includes(" or "))&&(y&&clearTimeout(y),t(17,y=setTimeout(()=>{R(a),t(17,y=null)},300)))},[a,p,m,_,g,h,k,u,d,R,Q,E,se,ee,Z,I,$,y,i,j,A,P,G,oe,X,re]}class ka extends _t{constructor(e){super(),gt(this,e,ba,va,pt,{},null,[-1,-1])}}async function bo(l={}){return typeof l=="object"&&Object.freeze(l),Zl({__tauriModule:"Dialog",message:{cmd:"openDialog",options:l}})}function ko(l,e,t){const n=l.slice();return n[71]=e[t],n[79]=t,n}function wo(l,e,t){const n=l.slice();return n[77]=e[t],n[78]=e,n[79]=t,n}function yo(l,e,t){const n=l.slice();return n[80]=e[t],n}function $o(l,e,t){const n=l.slice();return n[80]=e[t],n}function Co(l,e,t){const n=l.slice();return n[85]=e[t],n[86]=e,n[87]=t,n}function To(l,e,t){const n=l.slice();return n[88]=e[t][0],n[89]=e[t][1],n[90]=e,n[91]=t,n}function So(l,e,t){const n=l.slice();return n[74]=e[t],n}function Ro(l,e,t){const n=l.slice();return n[71]=e[t],n}function Ao(l,e,t){const n=l.slice();return n[74]=e[t],n}function Eo(l){let e,t,n,o,a;return{c(){e=f("div"),t=f("button"),n=U(`
      Configuration saved successfully!`),c(t,"class","delete"),c(e,"class","notification is-success"),c(e,"data-testid","wizard-success")},m(s,u){S(s,e,u),r(e,t),r(e,n),o||(a=ae(t,"click",l[20]),o=!0)},p:Re,d(s){s&&T(e),o=!1,a()}}}function Lo(l){let e,t,n,o,a;return{c(){e=f("div"),t=f("button"),n=U(`
      Failed to save configuration. Please try again.`),c(t,"class","delete"),c(e,"class","notification is-danger"),c(e,"data-testid","wizard-error")},m(s,u){S(s,e,u),r(e,t),r(e,n),o||(a=ae(t,"click",l[21]),o=!0)},p:Re,d(s){s&&T(e),o=!1,a()}}}function wa(l){let e,t,n,o,a,s,u,i,d,p=l[3].id+"",m,_,g,w,h,k=l[3].global_shortcut+"",$,y,b,C,K,N=l[3].default_theme+"",O,R,F,x,Q,E=l[3].default_role+"",L,se,J,ie,ee,z,Z=JSON.stringify(l[3],null,2)+"",I,j=l[3].roles,A=[];for(let P=0;P<j.length;P+=1)A[P]=Io(ko(l,j,P));return{c(){e=f("h4"),e.textContent="Review",t=v(),n=f("div"),o=f("h5"),o.textContent="Configuration Summary:",a=v(),s=f("ul"),u=f("li"),i=f("strong"),i.textContent="Configuration ID:",d=v(),m=U(p),_=v(),g=f("li"),w=f("strong"),w.textContent="Global Shortcut:",h=v(),$=U(k),y=v(),b=f("li"),C=f("strong"),C.textContent="Default Theme:",K=v(),O=U(N),R=v(),F=f("li"),x=f("strong"),x.textContent="Default Role:",Q=v(),L=U(E),se=v(),J=f("h5"),J.textContent="Roles:",ie=v();for(let P=0;P<A.length;P+=1)A[P].c();ee=v(),z=f("pre"),I=U(Z),c(e,"class","title is-5"),c(n,"class","content"),we(z,"max-height","300px"),we(z,"overflow","auto")},m(P,G){S(P,e,G),S(P,t,G),S(P,n,G),r(n,o),r(n,a),r(n,s),r(s,u),r(u,i),r(u,d),r(u,m),r(s,_),r(s,g),r(g,w),r(g,h),r(g,$),r(s,y),r(s,b),r(b,C),r(b,K),r(b,O),r(s,R),r(s,F),r(F,x),r(F,Q),r(F,L),r(n,se),r(n,J),r(n,ie);for(let oe=0;oe<A.length;oe+=1)A[oe]&&A[oe].m(n,null);S(P,ee,G),S(P,z,G),r(z,I)},p(P,G){if(G[0]&8&&p!==(p=P[3].id+"")&&be(m,p),G[0]&8&&k!==(k=P[3].global_shortcut+"")&&be($,k),G[0]&8&&N!==(N=P[3].default_theme+"")&&be(O,N),G[0]&8&&E!==(E=P[3].default_role+"")&&be(L,E),G[0]&10){j=P[3].roles;let oe;for(oe=0;oe<j.length;oe+=1){const X=ko(P,j,oe);A[oe]?A[oe].p(X,G):(A[oe]=Io(X),A[oe].c(),A[oe].m(n,null))}for(;oe<A.length;oe+=1)A[oe].d(1);A.length=j.length}G[0]&8&&Z!==(Z=JSON.stringify(P[3],null,2)+"")&&be(I,Z)},d(P){P&&T(e),P&&T(t),P&&T(n),tt(A,P),P&&T(ee),P&&T(z)}}}function ya(l){let e,t,n=[],o=new Map,a,s,u,i,d=l[3].roles;const p=m=>m[77].name;for(let m=0;m<d.length;m+=1){let _=wo(l,d,m),g=p(_);o.set(g,n[m]=Bo(g,_))}return{c(){e=f("h4"),e.textContent="Roles",t=v();for(let m=0;m<n.length;m+=1)n[m].c();a=v(),s=f("button"),s.textContent="Add Role",c(e,"class","title is-5"),c(s,"class","button is-link is-light"),c(s,"data-testid","add-role")},m(m,_){S(m,e,_),S(m,t,_);for(let g=0;g<n.length;g+=1)n[g]&&n[g].m(m,_);S(m,a,_),S(m,s,_),u||(i=ae(s,"click",l[12]),u=!0)},p(m,_){_[0]&516985&&(d=m[3].roles,n=fr(n,_,p,1,m,d,o,a.parentNode,dr,Bo,a,wo))},d(m){m&&T(e),m&&T(t);for(let _=0;_<n.length;_+=1)n[_].d(m);m&&T(a),m&&T(s),u=!1,i()}}}function $a(l){let e,t,n,o,a,s,u,i,d,p,m,_,g,w,h,k,$,y,b,C,K,N,O,R,F,x,Q,E,L,se,J,ie=l[8],ee=[];for(let I=0;I<ie.length;I+=1)ee[I]=Jo(Ao(l,ie,I));let z=l[3].roles,Z=[];for(let I=0;I<z.length;I+=1)Z[I]=Vo(Ro(l,z,I));return{c(){e=f("div"),t=f("label"),t.textContent="Configuration ID",n=v(),o=f("div"),a=f("div"),s=f("select"),u=f("option"),u.textContent="Desktop",i=f("option"),i.textContent="Server",d=f("option"),d.textContent="Embedded",p=v(),m=f("div"),_=f("label"),_.textContent="Global shortcut",g=v(),w=f("div"),h=f("input"),k=v(),$=f("div"),y=f("label"),y.textContent="Default theme",b=v(),C=f("div"),K=f("div"),N=f("select");for(let I=0;I<ee.length;I+=1)ee[I].c();O=v(),R=f("div"),F=f("label"),F.textContent="Default Role",x=v(),Q=f("div"),E=f("div"),L=f("select");for(let I=0;I<Z.length;I+=1)Z[I].c();c(t,"class","label"),c(t,"for","config-id"),u.__value="Desktop",u.value=u.__value,i.__value="Server",i.value=i.__value,d.__value="Embedded",d.value=d.__value,c(s,"id","config-id"),l[3].id===void 0&&mt(()=>l[22].call(s)),c(a,"class","select"),c(o,"class","control"),c(e,"class","field"),c(_,"class","label"),c(_,"for","global-shortcut"),c(h,"class","input"),c(h,"id","global-shortcut"),c(h,"type","text"),c(w,"class","control"),c(m,"class","field"),c(y,"class","label"),c(y,"for","default-theme"),c(N,"id","default-theme"),l[3].default_theme===void 0&&mt(()=>l[24].call(N)),c(K,"class","select is-fullwidth"),c(C,"class","control"),c($,"class","field"),c(F,"class","label"),c(F,"for","default-role"),c(L,"id","default-role"),l[3].default_role===void 0&&mt(()=>l[25].call(L)),c(E,"class","select"),c(Q,"class","control"),c(R,"class","field")},m(I,j){S(I,e,j),r(e,t),r(e,n),r(e,o),r(o,a),r(a,s),r(s,u),r(s,i),r(s,d),Je(s,l[3].id,!0),S(I,p,j),S(I,m,j),r(m,_),r(m,g),r(m,w),r(w,h),De(h,l[3].global_shortcut),S(I,k,j),S(I,$,j),r($,y),r($,b),r($,C),r(C,K),r(K,N);for(let A=0;A<ee.length;A+=1)ee[A]&&ee[A].m(N,null);Je(N,l[3].default_theme,!0),S(I,O,j),S(I,R,j),r(R,F),r(R,x),r(R,Q),r(Q,E),r(E,L);for(let A=0;A<Z.length;A+=1)Z[A]&&Z[A].m(L,null);Je(L,l[3].default_role,!0),se||(J=[ae(s,"change",l[22]),ae(h,"input",l[23]),ae(N,"change",l[24]),ae(L,"change",l[25])],se=!0)},p(I,j){if(j[0]&264&&Je(s,I[3].id),j[0]&264&&h.value!==I[3].global_shortcut&&De(h,I[3].global_shortcut),j[0]&256){ie=I[8];let A;for(A=0;A<ie.length;A+=1){const P=Ao(I,ie,A);ee[A]?ee[A].p(P,j):(ee[A]=Jo(P),ee[A].c(),ee[A].m(N,null))}for(;A<ee.length;A+=1)ee[A].d(1);ee.length=ie.length}if(j[0]&264&&Je(N,I[3].default_theme),j[0]&8){z=I[3].roles;let A;for(A=0;A<z.length;A+=1){const P=Ro(I,z,A);Z[A]?Z[A].p(P,j):(Z[A]=Vo(P),Z[A].c(),Z[A].m(L,null))}for(;A<Z.length;A+=1)Z[A].d(1);Z.length=z.length}j[0]&264&&Je(L,I[3].default_role)},d(I){I&&T(e),I&&T(p),I&&T(m),I&&T(k),I&&T($),tt(ee,I),I&&T(O),I&&T(R),tt(Z,I),se=!1,Ze(J)}}}function Io(l){let e,t,n=l[71].name+"",o,a,s,u,i,d=l[71].shortname+"",p,m,_,g,w,h=l[71].theme+"",k,$,y,b,C,K=l[71].relevance_function+"",N,O,R,F,x,Q;return{c(){e=f("div"),t=f("h6"),o=U(n),a=v(),s=f("p"),u=f("strong"),u.textContent="Shortname:",i=v(),p=U(d),m=v(),_=f("p"),g=f("strong"),g.textContent="Theme:",w=v(),k=U(h),$=v(),y=f("p"),b=f("strong"),b.textContent="Relevance Function:",C=v(),N=U(K),O=v(),R=f("button"),R.textContent="Edit Role",F=v(),c(t,"data-testid","review-role-name-"+l[79]),c(R,"class","button is-small"),c(R,"data-testid","edit-role-"+l[79]),c(e,"class","box")},m(E,L){S(E,e,L),r(e,t),r(t,o),r(e,a),r(e,s),r(s,u),r(s,i),r(s,p),r(e,m),r(e,_),r(_,g),r(_,w),r(_,k),r(e,$),r(e,y),r(y,b),r(y,C),r(y,N),r(e,O),r(e,R),r(e,F),x||(Q=ae(R,"click",l[68]),x=!0)},p(E,L){L[0]&8&&n!==(n=E[71].name+"")&&be(o,n),L[0]&8&&d!==(d=E[71].shortname+"")&&be(p,d),L[0]&8&&h!==(h=E[71].theme+"")&&be(k,h),L[0]&8&&K!==(K=E[71].relevance_function+"")&&be(N,K)},d(E){E&&T(e),x=!1,Q()}}}function Do(l){let e,t=l[74]+"",n;return{c(){e=f("option"),n=U(t),e.__value=l[74],e.value=e.__value},m(o,a){S(o,e,a),r(e,n)},p:Re,d(o){o&&T(e)}}}function Ca(l){let e;return{c(){e=U("Directory Path")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function Ta(l){let e;return{c(){e=U("Server URL")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function No(l){let e;return{c(){e=f("p"),e.textContent="Click to select directory",c(e,"class","help")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function Oo(l){let e,t,n,o,a,s,u,i,d,p,m,_;function g(){l[34].call(u,l[79],l[87])}return{c(){e=f("div"),t=f("label"),n=U("Atomic Server Secret"),a=v(),s=f("div"),u=f("input"),d=v(),p=f("p"),p.textContent="Leave empty for anonymous access",c(t,"class","label"),c(t,"for",o=`haystack-secret-${l[79]}-${l[87]}`),c(u,"class","input"),c(u,"id",i=`haystack-secret-${l[79]}-${l[87]}`),c(u,"type","password"),c(u,"placeholder","Base64 encoded secret (optional)"),c(s,"class","control"),c(p,"class","help"),c(e,"class","field")},m(w,h){S(w,e,h),r(e,t),r(t,n),r(e,a),r(e,s),r(s,u),De(u,l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret),r(e,d),r(e,p),m||(_=ae(u,"input",g),m=!0)},p(w,h){l=w,h[0]&264&&o!==(o=`haystack-secret-${l[79]}-${l[87]}`)&&c(t,"for",o),h[0]&264&&i!==(i=`haystack-secret-${l[79]}-${l[87]}`)&&c(u,"id",i),h[0]&264&&u.value!==l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret&&De(u,l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret)},d(w){w&&T(e),m=!1,_()}}}function Po(l){let e,t,n,o,a,s,u,i,d,p,m,_,g,w,h,k,$,y,b,C,K,N,O,R,F,x,Q,E,L,se,J,ie,ee,z,Z,I,j,A,P,G,oe,X,re;function D(){l[35].call(p,l[79],l[87])}function W(...Y){return l[36](l[79],l[87],...Y)}let le=Object.entries(l[3].roles[l[79]].haystacks[l[87]].extra_parameters||{}),ne=[];for(let Y=0;Y<le.length;Y+=1)ne[Y]=Uo(To(l,le,Y));function ce(){return l[40](l[79],l[87])}function ue(){return l[41](l[79],l[87])}function H(){return l[42](l[79],l[87])}return{c(){e=f("div"),t=f("label"),t.textContent="Extra Parameters (for filtering)",n=v(),o=f("div"),a=f("div"),s=f("label"),u=U("Hashtag"),d=v(),p=f("input"),_=v(),g=f("div"),w=f("div"),h=f("label"),k=U("Presets"),y=v(),b=f("div"),C=f("select"),K=f("option"),K.textContent="(choose)",N=f("option"),N.textContent="#rust",O=f("option"),O.textContent="#docs",R=f("option"),R.textContent="#test",F=f("option"),F.textContent="#todo",Q=v(),E=f("p"),E.innerHTML="When set, searches will enforce the hashtag alongside your query (AND), e.g. <code>-e &quot;search&quot; -e &quot;#rust&quot;</code>.",L=v();for(let Y=0;Y<ne.length;Y+=1)ne[Y].c();se=v(),J=f("div"),ie=f("div"),ee=f("button"),ee.textContent="+ Tag Filter",z=v(),Z=f("div"),I=f("button"),I.textContent="+ Max Results",j=v(),A=f("div"),P=f("button"),P.textContent="+ Custom Parameter",G=v(),oe=f("p"),oe.innerHTML=`Common parameters: <code>tag</code> (e.g., &quot;#rust&quot;), <code>glob</code> (e.g., &quot;*.md&quot;),
                  <code>max_count</code> (e.g., &quot;10&quot;), <code>context</code> (e.g., &quot;5&quot;)`,c(t,"class","label"),c(s,"class","label"),c(s,"for",i=`ripgrep-hashtag-${l[79]}-${l[87]}`),c(p,"class","input"),c(p,"id",m=`ripgrep-hashtag-${l[79]}-${l[87]}`),c(p,"type","text"),c(p,"placeholder","#rust"),c(a,"class","control"),c(o,"class","field is-grouped"),c(h,"class","label"),c(h,"for",$=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`),K.__value="",K.value=K.__value,N.__value="#rust",N.value=N.__value,O.__value="#docs",O.value=O.__value,R.__value="#test",R.value=R.__value,F.__value="#todo",F.value=F.__value,c(C,"id",x=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`),c(b,"class","select is-small"),c(w,"class","control"),c(g,"class","field is-grouped"),we(g,"margin-bottom",".5rem"),c(E,"class","help"),c(ee,"class","button is-small is-link is-light"),c(ie,"class","control"),c(I,"class","button is-small is-link is-light"),c(Z,"class","control"),c(P,"class","button is-small is-link is-light"),c(A,"class","control"),c(J,"class","field is-grouped"),c(oe,"class","help"),c(e,"class","field")},m(Y,fe){S(Y,e,fe),r(e,t),r(e,n),r(e,o),r(o,a),r(a,s),r(s,u),r(a,d),r(a,p),De(p,l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag),r(e,_),r(e,g),r(g,w),r(w,h),r(h,k),r(w,y),r(w,b),r(b,C),r(C,K),r(C,N),r(C,O),r(C,R),r(C,F),r(e,Q),r(e,E),r(e,L);for(let _e=0;_e<ne.length;_e+=1)ne[_e]&&ne[_e].m(e,null);r(e,se),r(e,J),r(J,ie),r(ie,ee),r(J,z),r(J,Z),r(Z,I),r(J,j),r(J,A),r(A,P),r(e,G),r(e,oe),X||(re=[ae(p,"input",D),ae(C,"change",W),ae(ee,"click",ce),ae(I,"click",ue),ae(P,"click",H)],X=!0)},p(Y,fe){if(l=Y,fe[0]&264&&i!==(i=`ripgrep-hashtag-${l[79]}-${l[87]}`)&&c(s,"for",i),fe[0]&264&&m!==(m=`ripgrep-hashtag-${l[79]}-${l[87]}`)&&c(p,"id",m),fe[0]&264&&p.value!==l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag&&De(p,l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag),fe[0]&264&&$!==($=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`)&&c(h,"for",$),fe[0]&264&&x!==(x=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`)&&c(C,"id",x),fe[0]&393224){le=Object.entries(l[3].roles[l[79]].haystacks[l[87]].extra_parameters||{});let _e;for(_e=0;_e<le.length;_e+=1){const ke=To(l,le,_e);ne[_e]?ne[_e].p(ke,fe):(ne[_e]=Uo(ke),ne[_e].c(),ne[_e].m(e,se))}for(;_e<ne.length;_e+=1)ne[_e].d(1);ne.length=le.length}},d(Y){Y&&T(e),tt(ne,Y),X=!1,Ze(re)}}}function Uo(l){let e,t,n,o,a,s,u,i,d,p,m,_,g;function w(...$){return l[37](l[79],l[87],l[88],...$)}function h(){l[38].call(u,l[79],l[87],l[88])}function k(){return l[39](l[79],l[87],l[88])}return{c(){e=f("div"),t=f("div"),n=f("input"),a=v(),s=f("div"),u=f("input"),i=v(),d=f("div"),p=f("button"),p.textContent="√ó",m=v(),c(n,"class","input"),c(n,"type","text"),c(n,"placeholder","Parameter name"),n.value=o=l[88],c(t,"class","control"),c(u,"class","input"),c(u,"type","text"),c(u,"placeholder","Parameter value"),c(s,"class","control is-expanded"),c(p,"class","button is-small is-danger"),c(d,"class","control"),c(e,"class","field is-grouped")},m($,y){S($,e,y),r(e,t),r(t,n),r(e,a),r(e,s),r(s,u),De(u,l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]]),r(e,i),r(e,d),r(d,p),r(e,m),_||(g=[ae(n,"blur",w),ae(u,"input",h),ae(p,"click",k)],_=!0)},p($,y){l=$,y[0]&264&&o!==(o=l[88])&&n.value!==o&&(n.value=o),y[0]&264&&u.value!==l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]]&&De(u,l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]])},d($){$&&T(e),_=!1,Ze(g)}}}function Mo(l){let e,t,n,o,a,s,u,i,d,p,m,_,g,w,h,k,$,y,b,C,K,N,O,R,F,x,Q,E,L,se,J,ie,ee,z,Z,I,j,A,P;function G(){l[31].call(d,l[79],l[87])}function oe(Y,fe){return Y[3].roles[Y[79]].haystacks[Y[87]].service==="Atomic"?Ta:Ca}let X=oe(l),re=X(l);function D(){l[32].call(b,l[79],l[87])}function W(){return l[33](l[79],l[87])}let le=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"&&No(),ne=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"&&Oo(l),ce=l[3].roles[l[79]].haystacks[l[87]].service==="Ripgrep"&&Po(l);function ue(){l[43].call(L,l[79],l[87])}function H(){return l[44](l[79],l[87])}return{c(){e=f("div"),t=f("div"),n=f("label"),o=U("Service Type"),s=v(),u=f("div"),i=f("div"),d=f("select"),p=f("option"),p.textContent="Ripgrep (File Search)",m=f("option"),m.textContent="Atomic Server",g=v(),w=f("div"),h=f("label"),re.c(),$=v(),y=f("div"),b=f("input"),O=v(),le&&le.c(),R=v(),ne&&ne.c(),F=v(),ce&&ce.c(),x=v(),Q=f("div"),E=f("label"),L=f("input"),J=U(`
                ¬†Read-only`),ee=v(),z=f("div"),Z=f("button"),I=U("Remove Haystack"),c(n,"class","label"),c(n,"for",a=`haystack-service-${l[79]}-${l[87]}`),p.__value="Ripgrep",p.value=p.__value,m.__value="Atomic",m.value=m.__value,c(d,"id",_=`haystack-service-${l[79]}-${l[87]}`),l[3].roles[l[79]].haystacks[l[87]].service===void 0&&mt(G),c(i,"class","select"),c(u,"class","control"),c(t,"class","field"),c(h,"class","label"),c(h,"for",k=`haystack-path-${l[79]}-${l[87]}`),c(b,"class","input"),c(b,"id",C=`haystack-path-${l[79]}-${l[87]}`),c(b,"type","text"),c(b,"placeholder",K=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?"https://localhost:9883":"/path/to/documents"),b.readOnly=N=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic",c(y,"class","control"),c(w,"class","field"),c(L,"id",se=`haystack-readonly-${l[79]}-${l[87]}`),c(L,"type","checkbox"),c(E,"class","checkbox"),c(E,"for",ie=`haystack-readonly-${l[79]}-${l[87]}`),c(Q,"class","field"),c(Z,"class","button is-small is-danger"),c(Z,"data-testid",j="remove-haystack-"+l[79]+"-"+l[87]),c(z,"class","field"),c(e,"class","box is-light")},m(Y,fe){S(Y,e,fe),r(e,t),r(t,n),r(n,o),r(t,s),r(t,u),r(u,i),r(i,d),r(d,p),r(d,m),Je(d,l[3].roles[l[79]].haystacks[l[87]].service,!0),r(e,g),r(e,w),r(w,h),re.m(h,null),r(w,$),r(w,y),r(y,b),De(b,l[3].roles[l[79]].haystacks[l[87]].path),r(y,O),le&&le.m(y,null),r(e,R),ne&&ne.m(e,null),r(e,F),ce&&ce.m(e,null),r(e,x),r(e,Q),r(Q,E),r(E,L),L.checked=l[3].roles[l[79]].haystacks[l[87]].read_only,r(E,J),r(e,ee),r(e,z),r(z,Z),r(Z,I),A||(P=[ae(d,"change",G),ae(b,"input",D),ae(b,"click",function(){Vl(l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?W:void 0)&&(l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?W:void 0).apply(this,arguments)}),ae(L,"change",ue),ae(Z,"click",H)],A=!0)},p(Y,fe){l=Y,fe[0]&264&&a!==(a=`haystack-service-${l[79]}-${l[87]}`)&&c(n,"for",a),fe[0]&264&&_!==(_=`haystack-service-${l[79]}-${l[87]}`)&&c(d,"id",_),fe[0]&264&&Je(d,l[3].roles[l[79]].haystacks[l[87]].service),X!==(X=oe(l))&&(re.d(1),re=X(l),re&&(re.c(),re.m(h,null))),fe[0]&264&&k!==(k=`haystack-path-${l[79]}-${l[87]}`)&&c(h,"for",k),fe[0]&264&&C!==(C=`haystack-path-${l[79]}-${l[87]}`)&&c(b,"id",C),fe[0]&264&&K!==(K=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?"https://localhost:9883":"/path/to/documents")&&c(b,"placeholder",K),fe[0]&280&&N!==(N=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic")&&(b.readOnly=N),fe[0]&264&&b.value!==l[3].roles[l[79]].haystacks[l[87]].path&&De(b,l[3].roles[l[79]].haystacks[l[87]].path),l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?le||(le=No(),le.c(),le.m(y,null)):le&&(le.d(1),le=null),l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?ne?ne.p(l,fe):(ne=Oo(l),ne.c(),ne.m(e,F)):ne&&(ne.d(1),ne=null),l[3].roles[l[79]].haystacks[l[87]].service==="Ripgrep"?ce?ce.p(l,fe):(ce=Po(l),ce.c(),ce.m(e,x)):ce&&(ce.d(1),ce=null),fe[0]&264&&se!==(se=`haystack-readonly-${l[79]}-${l[87]}`)&&c(L,"id",se),fe[0]&264&&(L.checked=l[3].roles[l[79]].haystacks[l[87]].read_only),fe[0]&264&&ie!==(ie=`haystack-readonly-${l[79]}-${l[87]}`)&&c(E,"for",ie),fe[0]&264&&j!==(j="remove-haystack-"+l[79]+"-"+l[87])&&c(Z,"data-testid",j)},d(Y){Y&&T(e),re.d(),le&&le.d(),ne&&ne.d(),ce&&ce.d(),A=!1,Ze(P)}}}function jo(l){var Z;let e,t,n,o,a,s,u,i,d,p,m,_,g,w,h,k,$,y,b,C,K,N,O,R,F,x,Q,E,L;function se(){l[47].call(u,l[79])}function J(){return l[48](l[79])}let ie=((Z=l[0][l[79]])==null?void 0:Z.length)&&zo(l);function ee(){l[50].call(b,l[79])}function z(){l[51].call(R,l[79])}return{c(){e=f("div"),t=f("label"),n=U("Model"),a=v(),s=f("div"),u=f("input"),d=v(),p=f("button"),p.textContent="Fetch models",m=v(),ie&&ie.c(),_=v(),g=f("div"),w=f("label"),h=U("Base URL"),$=v(),y=f("div"),b=f("input"),K=v(),N=f("div"),O=f("label"),R=f("input"),x=U(`
              ¬†Automatically summarize search results`),c(t,"class","label"),c(t,"for",o=`llm-model-${l[79]}`),c(u,"class","input"),c(u,"id",i=`llm-model-${l[79]}`),c(u,"type","text"),c(u,"placeholder","llama3.1"),c(s,"class","control"),c(p,"class","button is-small"),c(e,"class","field"),c(w,"class","label"),c(w,"for",k=`llm-base-url-${l[79]}`),c(b,"class","input"),c(b,"id",C=`llm-base-url-${l[79]}`),c(b,"type","text"),c(b,"placeholder","http://127.0.0.1:11434"),c(y,"class","control"),c(g,"class","field"),c(R,"id",F=`llm-auto-summarize-${l[79]}`),c(R,"type","checkbox"),c(O,"class","checkbox"),c(O,"for",Q=`llm-auto-summarize-${l[79]}`),c(N,"class","field")},m(I,j){S(I,e,j),r(e,t),r(t,n),r(e,a),r(e,s),r(s,u),De(u,l[3].roles[l[79]].llm_model),r(e,d),r(e,p),r(e,m),ie&&ie.m(e,null),S(I,_,j),S(I,g,j),r(g,w),r(w,h),r(g,$),r(g,y),r(y,b),De(b,l[3].roles[l[79]].llm_base_url),S(I,K,j),S(I,N,j),r(N,O),r(O,R),R.checked=l[3].roles[l[79]].llm_auto_summarize,r(O,x),E||(L=[ae(u,"input",se),ae(p,"click",J),ae(b,"input",ee),ae(R,"change",z)],E=!0)},p(I,j){var A;l=I,j[0]&264&&o!==(o=`llm-model-${l[79]}`)&&c(t,"for",o),j[0]&264&&i!==(i=`llm-model-${l[79]}`)&&c(u,"id",i),j[0]&264&&u.value!==l[3].roles[l[79]].llm_model&&De(u,l[3].roles[l[79]].llm_model),(A=l[0][l[79]])!=null&&A.length?ie?ie.p(l,j):(ie=zo(l),ie.c(),ie.m(e,null)):ie&&(ie.d(1),ie=null),j[0]&264&&k!==(k=`llm-base-url-${l[79]}`)&&c(w,"for",k),j[0]&264&&C!==(C=`llm-base-url-${l[79]}`)&&c(b,"id",C),j[0]&264&&b.value!==l[3].roles[l[79]].llm_base_url&&De(b,l[3].roles[l[79]].llm_base_url),j[0]&264&&F!==(F=`llm-auto-summarize-${l[79]}`)&&c(R,"id",F),j[0]&264&&(R.checked=l[3].roles[l[79]].llm_auto_summarize),j[0]&264&&Q!==(Q=`llm-auto-summarize-${l[79]}`)&&c(O,"for",Q)},d(I){I&&T(e),ie&&ie.d(),I&&T(_),I&&T(g),I&&T(K),I&&T(N),E=!1,Ze(L)}}}function zo(l){let e,t,n,o,a=l[0][l[79]],s=[];for(let i=0;i<a.length;i+=1)s[i]=Ho($o(l,a,i));function u(...i){return l[49](l[79],...i)}return{c(){e=f("div"),t=f("select");for(let i=0;i<s.length;i+=1)s[i].c();c(e,"class","select is-fullwidth"),we(e,"margin-top","0.5rem")},m(i,d){S(i,e,d),r(e,t);for(let p=0;p<s.length;p+=1)s[p]&&s[p].m(t,null);n||(o=ae(t,"change",u),n=!0)},p(i,d){if(l=i,d[0]&9){a=l[0][l[79]];let p;for(p=0;p<a.length;p+=1){const m=$o(l,a,p);s[p]?s[p].p(m,d):(s[p]=Ho(m),s[p].c(),s[p].m(t,null))}for(;p<s.length;p+=1)s[p].d(1);s.length=a.length}},d(i){i&&T(e),tt(s,i),n=!1,o()}}}function Ho(l){let e,t=l[80]+"",n,o;return{c(){e=f("option"),n=U(t),e.__value=o=l[80],e.value=e.__value},m(a,s){S(a,e,s),r(e,n)},p(a,s){s[0]&9&&t!==(t=a[80]+"")&&be(n,t),s[0]&265&&o!==(o=a[80])&&(e.__value=o,e.value=e.__value)},d(a){a&&T(e)}}}function Fo(l){var fe;let e,t,n,o,a,s,u,i,d,p,m,_,g,w,h,k,$,y,b,C,K,N,O,R,F,x,Q,E,L,se,J,ie,ee,z,Z,I,j,A,P,G,oe,X,re,D;function W(){l[53].call(u,l[79])}function le(){l[54].call(y,l[79])}function ne(){return l[55](l[79])}let ce=((fe=l[0][l[79]])==null?void 0:fe.length)&&Ko(l);function ue(){l[57].call(E,l[79])}function H(){l[58].call(j,l[79])}let Y=l[3].roles[l[79]].openrouter_chat_enabled&&qo(l);return{c(){e=f("div"),t=f("label"),n=U("OpenRouter API Key"),a=v(),s=f("div"),u=f("input"),d=v(),p=f("p"),p.innerHTML='Get your API key from <a href="https://openrouter.ai" target="_blank" rel="noopener">OpenRouter</a>',m=v(),_=f("div"),g=f("label"),w=U("Model"),k=v(),$=f("div"),y=f("input"),C=v(),K=f("button"),K.textContent="Fetch models",N=v(),ce&&ce.c(),O=v(),R=f("p"),R.textContent="Choose the language model for generating summaries. Different models offer different speed/quality tradeoffs.",F=v(),x=f("div"),Q=f("label"),E=f("input"),se=U(`
              ¬†Automatically summarize search results`),ie=v(),ee=f("p"),ee.textContent="When enabled, summaries will be generated and shown in search results.",z=v(),Z=f("div"),I=f("label"),j=f("input"),P=U(`
              ¬†Enable Chat interface (OpenRouter)`),oe=v(),Y&&Y.c(),X=ut(),c(t,"class","label"),c(t,"for",o=`openrouter-api-key-${l[79]}`),c(u,"class","input"),c(u,"id",i=`openrouter-api-key-${l[79]}`),c(u,"type","password"),c(u,"placeholder","sk-or-v1-..."),c(s,"class","control"),c(p,"class","help"),c(e,"class","field"),c(g,"class","label"),c(g,"for",h=`openrouter-model-${l[79]}`),c(y,"class","input"),c(y,"id",b=`openrouter-model-${l[79]}`),c(y,"type","text"),c(y,"placeholder","openai/gpt-4-turbo"),c($,"class","control"),c(K,"class","button is-small"),c(R,"class","help"),c(_,"class","field"),c(E,"id",L=`openrouter-auto-summarize-${l[79]}`),c(E,"type","checkbox"),c(Q,"class","checkbox"),c(Q,"for",J=`openrouter-auto-summarize-${l[79]}`),c(ee,"class","help"),c(x,"class","field"),c(j,"id",A=`openrouter-chat-enabled-${l[79]}`),c(j,"type","checkbox"),c(I,"class","checkbox"),c(I,"for",G=`openrouter-chat-enabled-${l[79]}`),c(Z,"class","field")},m(_e,ke){S(_e,e,ke),r(e,t),r(t,n),r(e,a),r(e,s),r(s,u),De(u,l[3].roles[l[79]].openrouter_api_key),r(e,d),r(e,p),S(_e,m,ke),S(_e,_,ke),r(_,g),r(g,w),r(_,k),r(_,$),r($,y),De(y,l[3].roles[l[79]].openrouter_model),r(_,C),r(_,K),r(_,N),ce&&ce.m(_,null),r(_,O),r(_,R),S(_e,F,ke),S(_e,x,ke),r(x,Q),r(Q,E),E.checked=l[3].roles[l[79]].openrouter_auto_summarize,r(Q,se),r(x,ie),r(x,ee),S(_e,z,ke),S(_e,Z,ke),r(Z,I),r(I,j),j.checked=l[3].roles[l[79]].openrouter_chat_enabled,r(I,P),S(_e,oe,ke),Y&&Y.m(_e,ke),S(_e,X,ke),re||(D=[ae(u,"input",W),ae(y,"input",le),ae(K,"click",ne),ae(E,"change",ue),ae(j,"change",H)],re=!0)},p(_e,ke){var Te;l=_e,ke[0]&264&&o!==(o=`openrouter-api-key-${l[79]}`)&&c(t,"for",o),ke[0]&264&&i!==(i=`openrouter-api-key-${l[79]}`)&&c(u,"id",i),ke[0]&264&&u.value!==l[3].roles[l[79]].openrouter_api_key&&De(u,l[3].roles[l[79]].openrouter_api_key),ke[0]&264&&h!==(h=`openrouter-model-${l[79]}`)&&c(g,"for",h),ke[0]&264&&b!==(b=`openrouter-model-${l[79]}`)&&c(y,"id",b),ke[0]&264&&y.value!==l[3].roles[l[79]].openrouter_model&&De(y,l[3].roles[l[79]].openrouter_model),(Te=l[0][l[79]])!=null&&Te.length?ce?ce.p(l,ke):(ce=Ko(l),ce.c(),ce.m(_,O)):ce&&(ce.d(1),ce=null),ke[0]&264&&L!==(L=`openrouter-auto-summarize-${l[79]}`)&&c(E,"id",L),ke[0]&264&&(E.checked=l[3].roles[l[79]].openrouter_auto_summarize),ke[0]&264&&J!==(J=`openrouter-auto-summarize-${l[79]}`)&&c(Q,"for",J),ke[0]&264&&A!==(A=`openrouter-chat-enabled-${l[79]}`)&&c(j,"id",A),ke[0]&264&&(j.checked=l[3].roles[l[79]].openrouter_chat_enabled),ke[0]&264&&G!==(G=`openrouter-chat-enabled-${l[79]}`)&&c(I,"for",G),l[3].roles[l[79]].openrouter_chat_enabled?Y?Y.p(l,ke):(Y=qo(l),Y.c(),Y.m(X.parentNode,X)):Y&&(Y.d(1),Y=null)},d(_e){_e&&T(e),_e&&T(m),_e&&T(_),ce&&ce.d(),_e&&T(F),_e&&T(x),_e&&T(z),_e&&T(Z),_e&&T(oe),Y&&Y.d(_e),_e&&T(X),re=!1,Ze(D)}}}function Ko(l){let e,t,n,o,a=l[0][l[79]],s=[];for(let i=0;i<a.length;i+=1)s[i]=Go(yo(l,a,i));function u(...i){return l[56](l[79],...i)}return{c(){e=f("div"),t=f("select");for(let i=0;i<s.length;i+=1)s[i].c();c(e,"class","select is-fullwidth"),we(e,"margin-top","0.5rem")},m(i,d){S(i,e,d),r(e,t);for(let p=0;p<s.length;p+=1)s[p]&&s[p].m(t,null);n||(o=ae(t,"change",u),n=!0)},p(i,d){if(l=i,d[0]&9){a=l[0][l[79]];let p;for(p=0;p<a.length;p+=1){const m=yo(l,a,p);s[p]?s[p].p(m,d):(s[p]=Go(m),s[p].c(),s[p].m(t,null))}for(;p<s.length;p+=1)s[p].d(1);s.length=a.length}},d(i){i&&T(e),tt(s,i),n=!1,o()}}}function Go(l){let e,t=l[80]+"",n,o;return{c(){e=f("option"),n=U(t),e.__value=o=l[80],e.value=e.__value},m(a,s){S(a,e,s),r(e,n)},p(a,s){s[0]&9&&t!==(t=a[80]+"")&&be(n,t),s[0]&265&&o!==(o=a[80])&&(e.__value=o,e.value=e.__value)},d(a){a&&T(e)}}}function qo(l){let e,t,n,o,a,s,u,i,d,p,m,_,g,w,h,k,$,y,b,C,K,N,O,R,F;function x(){l[59].call(i,l[79])}function Q(){l[60].call(N,l[79])}return{c(){e=f("div"),t=f("label"),n=U("Chat Model"),a=v(),s=f("div"),u=f("div"),i=f("select"),d=f("option"),d.textContent="GPT-3.5 Turbo",p=f("option"),p.textContent="GPT-4",m=f("option"),m.textContent="Claude 3 Sonnet",_=f("option"),_.textContent="Claude 3 Haiku",g=f("option"),g.textContent="Mixtral 8x7B",h=v(),k=f("div"),$=f("label"),y=U("System Prompt (optional)"),C=v(),K=f("div"),N=f("textarea"),c(t,"class","label"),c(t,"for",o=`openrouter-chat-model-${l[79]}`),d.__value="openai/gpt-3.5-turbo",d.value=d.__value,p.__value="openai/gpt-4",p.value=p.__value,m.__value="anthropic/claude-3-sonnet",m.value=m.__value,_.__value="anthropic/claude-3-haiku",_.value=_.__value,g.__value="mistralai/mixtral-8x7b-instruct",g.value=g.__value,c(i,"id",w=`openrouter-chat-model-${l[79]}`),l[3].roles[l[79]].openrouter_chat_model===void 0&&mt(x),c(u,"class","select is-fullwidth"),c(s,"class","control"),c(e,"class","field"),c($,"class","label"),c($,"for",b=`openrouter-chat-system-${l[79]}`),c(N,"class","textarea"),c(N,"id",O=`openrouter-chat-system-${l[79]}`),c(N,"rows","3"),c(N,"placeholder","You are a helpful Rust engineer assistant..."),c(K,"class","control"),c(k,"class","field")},m(E,L){S(E,e,L),r(e,t),r(t,n),r(e,a),r(e,s),r(s,u),r(u,i),r(i,d),r(i,p),r(i,m),r(i,_),r(i,g),Je(i,l[3].roles[l[79]].openrouter_chat_model,!0),S(E,h,L),S(E,k,L),r(k,$),r($,y),r(k,C),r(k,K),r(K,N),De(N,l[3].roles[l[79]].openrouter_chat_system_prompt),R||(F=[ae(i,"change",x),ae(N,"input",Q)],R=!0)},p(E,L){l=E,L[0]&264&&o!==(o=`openrouter-chat-model-${l[79]}`)&&c(t,"for",o),L[0]&264&&w!==(w=`openrouter-chat-model-${l[79]}`)&&c(i,"id",w),L[0]&264&&Je(i,l[3].roles[l[79]].openrouter_chat_model),L[0]&264&&b!==(b=`openrouter-chat-system-${l[79]}`)&&c($,"for",b),L[0]&264&&O!==(O=`openrouter-chat-system-${l[79]}`)&&c(N,"id",O),L[0]&264&&De(N,l[3].roles[l[79]].openrouter_chat_system_prompt)},d(E){E&&T(e),E&&T(h),E&&T(k),R=!1,Ze(F)}}}function Wo(l){let e;return{c(){e=f("p"),e.textContent="Click to select directory",c(e,"class","help")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function Bo(l,e){let t,n,o,a,s,u,i,d,p,m,_,g,w,h,k,$,y,b,C,K,N,O,R,F,x,Q,E,L,se,J,ie,ee,z,Z,I,j,A,P,G,oe,X,re,D,W,le,ne,ce,ue,H,Y,fe,_e,ke,Te,Xe,Be,Ne,Pe,pe,Se,Me,xe,et,ye,ze,Ge,qe,Le,Ie,it,Oe,We,q,te,B,de,Ce,$e,Qe,nt,me,Ae,ot,ft,Ut,at,qt,ll,Yt,gl,Mt,yt,Xl,wl,xl,yl,Et,$l,en,nl,ol,tn,Cl,ln,Zt,ht,Tl,nn,on,Sl,sl,rl,sn,Rl,rn,Al,Dt,il,al,El,an,cl,Wt,jt,Ll,cn,Il,un,Xt,zt,Dl,fn,Nl,dn,pn,mn,xt,_n,Ol,zl,gn;function Js(){e[26].call(d,e[79])}function Vs(){e[27].call(y,e[79])}let ul=e[8],vt=[];for(let Ye=0;Ye<ul.length;Ye+=1)vt[Ye]=Do(So(e,ul,Ye));function hn(){e[28].call(E,e[79])}function vn(){e[29].call(A,e[79])}function Qs(){e[30].call(ce,e[79])}let fl=e[77].haystacks,bt=[];for(let Ye=0;Ye<fl.length;Ye+=1)bt[Ye]=Mo(Co(e,fl,Ye));function Ys(){return e[45](e[79])}function bn(){e[46].call(Le,e[79])}let kt=e[3].roles[e[79]].llm_provider==="ollama"&&jo(e);function Zs(){e[52].call(me,e[79])}let wt=e[3].roles[e[79]].openrouter_enabled&&Fo(e);function Xs(){e[61].call(Et,e[79])}function xs(){e[62].call(ht,e[79])}function kn(){return e[63](e[79])}let $t=e[4]&&Wo();function wn(){e[64].call(Dt,e[79])}function er(){e[65].call(jt,e[79])}function tr(){e[66].call(zt,e[79])}function lr(){return e[67](e[79])}return{key:l,first:null,c(){t=f("div"),n=f("div"),o=f("label"),a=U("Role name"),u=v(),i=f("div"),d=f("input"),m=v(),_=f("div"),g=f("label"),w=U("Short name"),k=v(),$=f("div"),y=f("input"),C=v(),K=f("div"),N=f("label"),O=U("Theme"),F=v(),x=f("div"),Q=f("div"),E=f("select");for(let Ye=0;Ye<vt.length;Ye+=1)vt[Ye].c();se=v(),J=f("div"),ie=f("label"),ee=U("Relevance function"),Z=v(),I=f("div"),j=f("div"),A=f("select"),P=f("option"),P.textContent="title-scorer",G=f("option"),G.textContent="terraphim-graph",oe=f("option"),oe.textContent="bm25",X=f("option"),X.textContent="bm25f",re=f("option"),re.textContent="bm25plus",W=v(),le=f("div"),ne=f("label"),ce=f("input"),H=U(`
            Enable Terraphim IT features (KG preprocessing, auto-linking)`),fe=v(),_e=f("h5"),_e.textContent="Haystacks",ke=v();for(let Ye=0;Ye<bt.length;Ye+=1)bt[Ye].c();Te=v(),Xe=f("button"),Be=U("Add Haystack"),Pe=v(),pe=f("h5"),pe.textContent="AI-Enhanced Summaries (LLM Provider)",Se=v(),Me=f("div"),xe=f("label"),et=U("Provider"),ze=v(),Ge=f("div"),qe=f("div"),Le=f("select"),Ie=f("option"),Ie.textContent="(none)",it=f("option"),it.textContent="OpenRouter",Oe=f("option"),Oe.textContent="Ollama (local)",q=v(),te=f("p"),te.textContent="Choose a provider. OpenRouter uses API key; Ollama runs locally.",B=v(),kt&&kt.c(),de=v(),Ce=f("h5"),Ce.textContent="AI-Enhanced Summaries (OpenRouter)",$e=v(),Qe=f("div"),nt=f("label"),me=f("input"),ot=U(`
            ¬†Enable AI-generated article summaries`),Ut=v(),at=f("p"),at.textContent="Generate intelligent summaries using OpenRouter's language models",qt=v(),wt&&wt.c(),ll=v(),Yt=f("h5"),Yt.textContent="Knowledge Graph",gl=v(),Mt=f("div"),yt=f("label"),Xl=U("Remote automata URL"),xl=v(),yl=f("div"),Et=f("input"),en=v(),nl=f("div"),ol=f("label"),tn=U("Local KG path"),ln=v(),Zt=f("div"),ht=f("input"),nn=v(),$t&&$t.c(),on=v(),Sl=f("div"),sl=f("div"),rl=f("label"),sn=U("Local KG type"),rn=v(),Al=f("div"),Dt=f("select"),il=f("option"),il.textContent="markdown",al=f("option"),al.textContent="json",an=v(),cl=f("div"),Wt=f("label"),jt=f("input"),cn=U(`
            ¬†Public`),un=v(),Xt=f("label"),zt=f("input"),fn=U(`
            ¬†Publish`),dn=v(),pn=f("hr"),mn=v(),xt=f("button"),_n=U("Remove Role"),c(o,"class","label"),c(o,"for",s=`role-name-${e[79]}`),c(d,"class","input"),c(d,"id",p=`role-name-${e[79]}`),c(d,"type","text"),c(i,"class","control"),c(n,"class","field"),c(g,"class","label"),c(g,"for",h=`role-shortname-${e[79]}`),c(y,"class","input"),c(y,"id",b=`role-shortname-${e[79]}`),c(y,"type","text"),c($,"class","control"),c(_,"class","field"),c(N,"class","label"),c(N,"for",R=`role-theme-${e[79]}`),c(E,"id",L=`role-theme-${e[79]}`),e[3].roles[e[79]].theme===void 0&&mt(hn),c(Q,"class","select is-fullwidth"),c(x,"class","control"),c(K,"class","field"),c(ie,"class","label"),c(ie,"for",z=`role-relevance-${e[79]}`),P.__value="title-scorer",P.value=P.__value,G.__value="terraphim-graph",G.value=G.__value,oe.__value="bm25",oe.value=oe.__value,X.__value="bm25f",X.value=X.__value,re.__value="bm25plus",re.value=re.__value,c(A,"id",D=`role-relevance-${e[79]}`),e[3].roles[e[79]].relevance_function===void 0&&mt(vn),c(j,"class","select is-fullwidth"),c(I,"class","control"),c(J,"class","field"),c(ce,"class","checkbox"),c(ce,"id",ue=`role-terraphim-it-${e[79]}`),c(ce,"type","checkbox"),c(ne,"class","label"),c(ne,"for",Y=`role-terraphim-it-${e[79]}`),c(le,"class","field"),c(_e,"class","title is-6"),c(Xe,"class","button is-small"),c(Xe,"data-testid",Ne="add-haystack-"+e[79]),c(pe,"class","title is-6"),c(xe,"class","label"),c(xe,"for",ye=`llm-provider-${e[79]}`),Ie.__value="",Ie.value=Ie.__value,it.__value="openrouter",it.value=it.__value,Oe.__value="ollama",Oe.value=Oe.__value,c(Le,"id",We=`llm-provider-${e[79]}`),e[3].roles[e[79]].llm_provider===void 0&&mt(bn),c(qe,"class","select"),c(Ge,"class","control"),c(te,"class","help"),c(Me,"class","field"),c(Ce,"class","title is-6"),c(me,"id",Ae=`openrouter-enabled-${e[79]}`),c(me,"type","checkbox"),c(nt,"class","checkbox"),c(nt,"for",ft=`openrouter-enabled-${e[79]}`),c(at,"class","help"),c(Qe,"class","field"),c(Yt,"class","title is-6"),c(yt,"class","label"),c(yt,"for",wl=`kg-url-${e[79]}`),c(Et,"class","input"),c(Et,"id",$l=`kg-url-${e[79]}`),c(Et,"type","text"),c(Et,"placeholder","https://example.com/thesaurus.json"),c(yl,"class","control"),c(Mt,"class","field"),c(ol,"class","label"),c(ol,"for",Cl=`kg-local-path-${e[79]}`),c(ht,"class","input"),c(ht,"id",Tl=`kg-local-path-${e[79]}`),c(ht,"type","text"),c(ht,"placeholder","/path/to/markdown"),ht.readOnly=e[4],c(Zt,"class","control"),c(nl,"class","field"),c(rl,"class","label"),c(rl,"for",Rl=`kg-local-type-${e[79]}`),il.__value="markdown",il.value=il.__value,al.__value="json",al.value=al.__value,c(Dt,"id",El=`kg-local-type-${e[79]}`),e[3].roles[e[79]].kg.local_type===void 0&&mt(wn),c(Al,"class","select"),c(sl,"class","control"),c(Sl,"class","field is-grouped"),c(jt,"id",Ll=`kg-public-${e[79]}`),c(jt,"type","checkbox"),c(Wt,"class","checkbox"),c(Wt,"for",Il=`kg-public-${e[79]}`),we(Wt,"margin-right","1rem"),c(zt,"id",Dl=`kg-publish-${e[79]}`),c(zt,"type","checkbox"),c(Xt,"class","checkbox"),c(Xt,"for",Nl=`kg-publish-${e[79]}`),c(cl,"class","field is-grouped"),c(xt,"class","button is-small is-danger"),c(xt,"data-testid",Ol="remove-role-"+e[79]),c(t,"class","box"),this.first=t},m(Ye,Ee){S(Ye,t,Ee),r(t,n),r(n,o),r(o,a),r(n,u),r(n,i),r(i,d),De(d,e[3].roles[e[79]].name),r(t,m),r(t,_),r(_,g),r(g,w),r(_,k),r(_,$),r($,y),De(y,e[3].roles[e[79]].shortname),r(t,C),r(t,K),r(K,N),r(N,O),r(K,F),r(K,x),r(x,Q),r(Q,E);for(let He=0;He<vt.length;He+=1)vt[He]&&vt[He].m(E,null);Je(E,e[3].roles[e[79]].theme,!0),r(t,se),r(t,J),r(J,ie),r(ie,ee),r(J,Z),r(J,I),r(I,j),r(j,A),r(A,P),r(A,G),r(A,oe),r(A,X),r(A,re),Je(A,e[3].roles[e[79]].relevance_function,!0),r(t,W),r(t,le),r(le,ne),r(ne,ce),ce.checked=e[3].roles[e[79]].terraphim_it,r(ne,H),r(t,fe),r(t,_e),r(t,ke);for(let He=0;He<bt.length;He+=1)bt[He]&&bt[He].m(t,null);r(t,Te),r(t,Xe),r(Xe,Be),r(t,Pe),r(t,pe),r(t,Se),r(t,Me),r(Me,xe),r(xe,et),r(Me,ze),r(Me,Ge),r(Ge,qe),r(qe,Le),r(Le,Ie),r(Le,it),r(Le,Oe),Je(Le,e[3].roles[e[79]].llm_provider,!0),r(Me,q),r(Me,te),r(t,B),kt&&kt.m(t,null),r(t,de),r(t,Ce),r(t,$e),r(t,Qe),r(Qe,nt),r(nt,me),me.checked=e[3].roles[e[79]].openrouter_enabled,r(nt,ot),r(Qe,Ut),r(Qe,at),r(t,qt),wt&&wt.m(t,null),r(t,ll),r(t,Yt),r(t,gl),r(t,Mt),r(Mt,yt),r(yt,Xl),r(Mt,xl),r(Mt,yl),r(yl,Et),De(Et,e[3].roles[e[79]].kg.url),r(t,en),r(t,nl),r(nl,ol),r(ol,tn),r(nl,ln),r(nl,Zt),r(Zt,ht),De(ht,e[3].roles[e[79]].kg.local_path),r(Zt,nn),$t&&$t.m(Zt,null),r(t,on),r(t,Sl),r(Sl,sl),r(sl,rl),r(rl,sn),r(sl,rn),r(sl,Al),r(Al,Dt),r(Dt,il),r(Dt,al),Je(Dt,e[3].roles[e[79]].kg.local_type,!0),r(t,an),r(t,cl),r(cl,Wt),r(Wt,jt),jt.checked=e[3].roles[e[79]].kg.public,r(Wt,cn),r(cl,un),r(cl,Xt),r(Xt,zt),zt.checked=e[3].roles[e[79]].kg.publish,r(Xt,fn),r(t,dn),r(t,pn),r(t,mn),r(t,xt),r(xt,_n),zl||(gn=[ae(d,"input",Js),ae(y,"input",Vs),ae(E,"change",hn),ae(A,"change",vn),ae(ce,"change",Qs),ae(Xe,"click",Ys),ae(Le,"change",bn),ae(me,"change",Zs),ae(Et,"input",Xs),ae(ht,"input",xs),ae(ht,"click",function(){Vl(e[4]?kn:void 0)&&(e[4]?kn:void 0).apply(this,arguments)}),ae(Dt,"change",wn),ae(jt,"change",er),ae(zt,"change",tr),ae(xt,"click",lr)],zl=!0)},p(Ye,Ee){if(e=Ye,Ee[0]&264&&s!==(s=`role-name-${e[79]}`)&&c(o,"for",s),Ee[0]&264&&p!==(p=`role-name-${e[79]}`)&&c(d,"id",p),Ee[0]&264&&d.value!==e[3].roles[e[79]].name&&De(d,e[3].roles[e[79]].name),Ee[0]&264&&h!==(h=`role-shortname-${e[79]}`)&&c(g,"for",h),Ee[0]&264&&b!==(b=`role-shortname-${e[79]}`)&&c(y,"id",b),Ee[0]&264&&y.value!==e[3].roles[e[79]].shortname&&De(y,e[3].roles[e[79]].shortname),Ee[0]&264&&R!==(R=`role-theme-${e[79]}`)&&c(N,"for",R),Ee[0]&256){ul=e[8];let He;for(He=0;He<ul.length;He+=1){const hl=So(e,ul,He);vt[He]?vt[He].p(hl,Ee):(vt[He]=Do(hl),vt[He].c(),vt[He].m(E,null))}for(;He<vt.length;He+=1)vt[He].d(1);vt.length=ul.length}if(Ee[0]&264&&L!==(L=`role-theme-${e[79]}`)&&c(E,"id",L),Ee[0]&264&&Je(E,e[3].roles[e[79]].theme),Ee[0]&264&&z!==(z=`role-relevance-${e[79]}`)&&c(ie,"for",z),Ee[0]&264&&D!==(D=`role-relevance-${e[79]}`)&&c(A,"id",D),Ee[0]&264&&Je(A,e[3].roles[e[79]].relevance_function),Ee[0]&264&&ue!==(ue=`role-terraphim-it-${e[79]}`)&&c(ce,"id",ue),Ee[0]&264&&(ce.checked=e[3].roles[e[79]].terraphim_it),Ee[0]&264&&Y!==(Y=`role-terraphim-it-${e[79]}`)&&c(ne,"for",Y),Ee[0]&491576){fl=e[77].haystacks;let He;for(He=0;He<fl.length;He+=1){const hl=Co(e,fl,He);bt[He]?bt[He].p(hl,Ee):(bt[He]=Mo(hl),bt[He].c(),bt[He].m(t,Te))}for(;He<bt.length;He+=1)bt[He].d(1);bt.length=fl.length}Ee[0]&264&&Ne!==(Ne="add-haystack-"+e[79])&&c(Xe,"data-testid",Ne),Ee[0]&264&&ye!==(ye=`llm-provider-${e[79]}`)&&c(xe,"for",ye),Ee[0]&264&&We!==(We=`llm-provider-${e[79]}`)&&c(Le,"id",We),Ee[0]&264&&Je(Le,e[3].roles[e[79]].llm_provider),e[3].roles[e[79]].llm_provider==="ollama"?kt?kt.p(e,Ee):(kt=jo(e),kt.c(),kt.m(t,de)):kt&&(kt.d(1),kt=null),Ee[0]&264&&Ae!==(Ae=`openrouter-enabled-${e[79]}`)&&c(me,"id",Ae),Ee[0]&264&&(me.checked=e[3].roles[e[79]].openrouter_enabled),Ee[0]&264&&ft!==(ft=`openrouter-enabled-${e[79]}`)&&c(nt,"for",ft),e[3].roles[e[79]].openrouter_enabled?wt?wt.p(e,Ee):(wt=Fo(e),wt.c(),wt.m(t,ll)):wt&&(wt.d(1),wt=null),Ee[0]&264&&wl!==(wl=`kg-url-${e[79]}`)&&c(yt,"for",wl),Ee[0]&264&&$l!==($l=`kg-url-${e[79]}`)&&c(Et,"id",$l),Ee[0]&264&&Et.value!==e[3].roles[e[79]].kg.url&&De(Et,e[3].roles[e[79]].kg.url),Ee[0]&264&&Cl!==(Cl=`kg-local-path-${e[79]}`)&&c(ol,"for",Cl),Ee[0]&264&&Tl!==(Tl=`kg-local-path-${e[79]}`)&&c(ht,"id",Tl),Ee[0]&16&&(ht.readOnly=e[4]),Ee[0]&264&&ht.value!==e[3].roles[e[79]].kg.local_path&&De(ht,e[3].roles[e[79]].kg.local_path),e[4]?$t||($t=Wo(),$t.c(),$t.m(Zt,null)):$t&&($t.d(1),$t=null),Ee[0]&264&&Rl!==(Rl=`kg-local-type-${e[79]}`)&&c(rl,"for",Rl),Ee[0]&264&&El!==(El=`kg-local-type-${e[79]}`)&&c(Dt,"id",El),Ee[0]&264&&Je(Dt,e[3].roles[e[79]].kg.local_type),Ee[0]&264&&Ll!==(Ll=`kg-public-${e[79]}`)&&c(jt,"id",Ll),Ee[0]&264&&(jt.checked=e[3].roles[e[79]].kg.public),Ee[0]&264&&Il!==(Il=`kg-public-${e[79]}`)&&c(Wt,"for",Il),Ee[0]&264&&Dl!==(Dl=`kg-publish-${e[79]}`)&&c(zt,"id",Dl),Ee[0]&264&&(zt.checked=e[3].roles[e[79]].kg.publish),Ee[0]&264&&Nl!==(Nl=`kg-publish-${e[79]}`)&&c(Xt,"for",Nl),Ee[0]&264&&Ol!==(Ol="remove-role-"+e[79])&&c(xt,"data-testid",Ol)},d(Ye){Ye&&T(t),tt(vt,Ye),tt(bt,Ye),kt&&kt.d(),wt&&wt.d(),$t&&$t.d(),zl=!1,Ze(gn)}}}function Jo(l){let e,t=l[74]+"",n;return{c(){e=f("option"),n=U(t),e.__value=l[74],e.value=e.__value},m(o,a){S(o,e,a),r(e,n)},p:Re,d(o){o&&T(e)}}}function Vo(l){let e,t=l[71].name+"",n,o;return{c(){e=f("option"),n=U(t),e.__value=o=l[71].name,e.value=e.__value},m(a,s){S(a,e,s),r(e,n)},p(a,s){s[0]&8&&t!==(t=a[71].name+"")&&be(n,t),s[0]&264&&o!==(o=a[71].name)&&(e.__value=o,e.value=e.__value)},d(a){a&&T(e)}}}function Qo(l){let e,t,n;return{c(){e=f("button"),e.textContent="Back",c(e,"class","button"),c(e,"data-testid","wizard-back")},m(o,a){S(o,e,a),t||(n=ae(e,"click",l[11]),t=!0)},p:Re,d(o){o&&T(e),t=!1,n()}}}function Sa(l){let e,t,n;return{c(){e=f("button"),e.textContent="Save",c(e,"class","button is-success"),c(e,"data-testid","wizard-save")},m(o,a){S(o,e,a),t||(n=ae(e,"click",l[19]),t=!0)},p:Re,d(o){o&&T(e),t=!1,n()}}}function Ra(l){let e,t,n;return{c(){e=f("button"),e.textContent="Next",c(e,"class","button is-primary"),c(e,"data-testid","wizard-next")},m(o,a){S(o,e,a),t||(n=ae(e,"click",l[10]),t=!0)},p:Re,d(o){o&&T(e),t=!1,n()}}}function Aa(l){let e,t,n,o,a,s,u,i,d,p,m,_,g,w,h,k,$,y;e=new _l({props:{fallbackPath:"/"}});let b=l[2]==="success"&&Eo(l),C=l[2]==="error"&&Lo(l);function K(E,L){return E[1]===1?$a:E[1]===2?ya:wa}let N=K(l),O=N(l),R=l[1]>1&&Qo(l);function F(E,L){return E[1]<Bs?Ra:Sa}let x=F(l),Q=x(l);return{c(){ge(e.$$.fragment),t=v(),n=f("div"),o=f("div"),a=f("h3"),a.textContent="Configuration Wizard",s=v(),u=f("button"),u.textContent="Close",i=v(),b&&b.c(),d=v(),C&&C.c(),p=v(),O.c(),m=v(),_=f("nav"),g=f("div"),R&&R.c(),w=v(),h=f("div"),Q.c(),c(a,"class","title is-4"),we(a,"margin-bottom","0"),c(u,"class","button is-small is-light"),c(u,"aria-label","Close configuration wizard"),c(o,"class","is-flex is-justify-content-space-between is-align-items-center"),we(o,"gap",".5rem"),c(g,"class","level-left"),c(h,"class","level-right"),c(_,"class","level"),c(n,"class","box")},m(E,L){he(e,E,L),S(E,t,L),S(E,n,L),r(n,o),r(o,a),r(o,s),r(o,u),r(n,i),b&&b.m(n,null),r(n,d),C&&C.m(n,null),r(n,p),O.m(n,null),r(n,m),r(n,_),r(_,g),R&&R.m(g,null),r(_,w),r(_,h),Q.m(h,null),k=!0,$||(y=ae(u,"click",Ea),$=!0)},p(E,L){E[2]==="success"?b?b.p(E,L):(b=Eo(E),b.c(),b.m(n,d)):b&&(b.d(1),b=null),E[2]==="error"?C?C.p(E,L):(C=Lo(E),C.c(),C.m(n,p)):C&&(C.d(1),C=null),N===(N=K(E))&&O?O.p(E,L):(O.d(1),O=N(E),O&&(O.c(),O.m(n,m))),E[1]>1?R?R.p(E,L):(R=Qo(E),R.c(),R.m(g,null)):R&&(R.d(1),R=null),x===(x=F(E))&&Q?Q.p(E,L):(Q.d(1),Q=x(E),Q&&(Q.c(),Q.m(h,null)))},i(E){k||(M(e.$$.fragment,E),k=!0)},o(E){V(e.$$.fragment,E),k=!1},d(E){ve(e,E),E&&T(t),E&&T(n),b&&b.d(),C&&C.d(),O.d(),R&&R.d(),Q.d(),$=!1,y()}}}const Bs=3;function Ea(){typeof window<"u"&&window.history.back()}function La(l,e,t){let n,o;je(l,ct,q=>t(4,o=q));const a=It(null);async function s(q,te){if(Rt(ct))try{const B=await bo({directory:!0,multiple:!1});B&&typeof B=="string"&&i.update(de=>(de.roles[q].haystacks[te].path=B,de))}catch(B){console.error("Failed to open folder selector:",B)}}async function u(q){if(Rt(ct))try{const te=await bo({directory:!0,multiple:!1});te&&typeof te=="string"&&i.update(B=>(B.roles[q].kg.local_path=te,B))}catch(te){console.error("Failed to open folder selector:",te)}}const i=It({id:"Desktop",global_shortcut:"Ctrl+X",default_theme:"spacelab",default_role:"Default",roles:[]});je(l,i,q=>t(3,n=q));const d=["default","darkly","cerulean","cosmo","cyborg","flatly","journal","litera","lumen","lux","materia","minty","nuclear","pulse","sandstone","simplex","slate","solar","spacelab","superhero","united","yeti"];tl(async()=>{try{let q;Rt(ct)?q=await Ue("get_config_schema"):q=await(await fetch("/config/schema")).json(),a.set(q);const te=Rt(Lt);te&&te.id&&i.update(B=>{var de;return{...B,id:te.id,global_shortcut:te.global_shortcut,default_theme:((de=te.roles[te.default_role])==null?void 0:de.theme)??"spacelab",default_role:te.default_role,roles:Object.values(te.roles).map(Ce=>{var me,Ae,ot,ft,Ut,at,qt,ll,Yt,gl,Mt;const $e=(me=Ce.kg)==null?void 0:me.automata_path,Qe=($e==null?void 0:$e.Remote)??"",nt=((ot=(Ae=Ce.kg)==null?void 0:Ae.knowledge_graph_local)==null?void 0:ot.path)??"";return{name:Ce.name,shortname:Ce.shortname,relevance_function:Ce.relevance_function,terraphim_it:Ce.terraphim_it??!1,theme:Ce.theme,haystacks:(Ce.haystacks??[]).map(yt=>({path:yt.location||yt.path||"",read_only:yt.read_only??!1,service:yt.service||"Ripgrep",atomic_server_secret:yt.atomic_server_secret||"",extra_parameters:yt.extra_parameters||{}})),kg:{url:Qe,local_path:nt,local_type:((Ut=(ft=Ce.kg)==null?void 0:ft.knowledge_graph_local)==null?void 0:Ut.input_type)??"markdown",public:((at=Ce.kg)==null?void 0:at.public)??!1,publish:((qt=Ce.kg)==null?void 0:qt.publish)??!1},openrouter_enabled:Ce.openrouter_enabled??!1,openrouter_api_key:Ce.openrouter_api_key??"",openrouter_model:Ce.openrouter_model??"openai/gpt-3.5-turbo",openrouter_auto_summarize:Ce.openrouter_auto_summarize??!1,openrouter_chat_enabled:Ce.openrouter_chat_enabled??!1,openrouter_chat_model:Ce.openrouter_chat_model??Ce.openrouter_model??"openai/gpt-3.5-turbo",openrouter_chat_system_prompt:Ce.openrouter_chat_system_prompt??"",llm_provider:((ll=Ce.extra)==null?void 0:ll.llm_provider)??"",llm_model:((Yt=Ce.extra)==null?void 0:Yt.llm_model)??"",llm_base_url:((gl=Ce.extra)==null?void 0:gl.llm_base_url)??"",llm_auto_summarize:((Mt=Ce.extra)==null?void 0:Mt.llm_auto_summarize)??!1}})}})}catch(q){console.error("Failed to load schema",q)}}),tl(()=>{const q=te=>{te.key==="Escape"&&typeof window<"u"&&window.history.back()};return window.addEventListener("keydown",q),()=>window.removeEventListener("keydown",q)});let p={};async function m(q){var $e;const B=Rt(i).roles[q],de=B.llm_provider||(B.openrouter_enabled?"openrouter":""),Ce=[];try{if(de==="ollama"){const Qe=(B.llm_base_url||"http://127.0.0.1:11434").replace(/\/$/,""),me=await(await fetch(`${Qe}/api/tags`)).json();if(Array.isArray(me==null?void 0:me.models))for(const Ae of me.models)Ae!=null&&Ae.name&&Ce.push(Ae.name)}else if(de==="openrouter"){const Qe=($e=B.openrouter_api_key)==null?void 0:$e.trim();if(!Qe)throw new Error("OpenRouter API key required");const me=await(await fetch("https://openrouter.ai/api/v1/models",{headers:{Authorization:`Bearer ${Qe}`,"HTTP-Referer":"https://terraphim.ai","X-Title":"Terraphim Desktop"}})).json(),Ae=Array.isArray(me==null?void 0:me.data)?me.data:[];for(const ot of Ae)ot!=null&&ot.id&&Ce.push(ot.id)}}catch(Qe){console.error("Failed to fetch models",Qe)}t(0,p={...p,[q]:Ce})}let _=1,g="";function w(){_<Bs&&t(1,_+=1)}function h(){_>1&&t(1,_-=1)}function k(){i.update(q=>({...q,roles:[...q.roles,{name:"New Role",shortname:"new",relevance_function:"title-scorer",terraphim_it:!1,theme:"spacelab",haystacks:[],kg:{url:"",local_path:"",local_type:"markdown",public:!1,publish:!1},openrouter_enabled:!1,openrouter_api_key:"",openrouter_model:"openai/gpt-3.5-turbo",openrouter_auto_summarize:!1,openrouter_chat_enabled:!1,openrouter_chat_model:"openai/gpt-3.5-turbo",openrouter_chat_system_prompt:"",llm_provider:"",llm_model:"",llm_base_url:"",llm_auto_summarize:!1}]}))}function $(q){i.update(te=>({...te,roles:te.roles.filter((B,de)=>de!==q)}))}function y(q){i.update(te=>(te.roles[q].haystacks.push({path:"",read_only:!1,service:"Ripgrep",atomic_server_secret:"",extra_parameters:{}}),te))}function b(q,te){i.update(B=>(B.roles[q].haystacks=B.roles[q].haystacks.filter((de,Ce)=>Ce!==te),B))}function C(q,te,B="",de=""){i.update(Ce=>{Ce.roles[q].haystacks[te].extra_parameters||(Ce.roles[q].haystacks[te].extra_parameters={});const $e=B||`param_${Date.now()}`;return Ce.roles[q].haystacks[te].extra_parameters[$e]=de,Ce})}function K(q,te,B){i.update(de=>(delete de.roles[q].haystacks[te].extra_parameters[B],de))}function N(q,te,B,de){i.update(Ce=>{const $e=Ce.roles[q].haystacks[te].extra_parameters;return $e[B]!==void 0&&B!==de&&($e[de]=$e[B],delete $e[B]),Ce})}function O(q,te,B,de){const Ce=de.target.value;N(q,te,B,Ce)}async function R(){var Ce;const q=Rt(i),te=Rt(Lt);let B={...te};B.id=q.id,B.global_shortcut=q.global_shortcut,B.default_role=q.default_role;const de={};q.roles.forEach($e=>{var Ae,ot;const Qe=$e.name,nt=Qe.replace(/^"|"$/g,"");de[nt]={extra:((ot=(Ae=te.roles)==null?void 0:Ae[Qe])==null?void 0:ot.extra)??{},name:$e.name,shortname:$e.shortname,theme:$e.theme,relevance_function:$e.relevance_function,terraphim_it:$e.terraphim_it??!1,haystacks:$e.haystacks.map(ft=>({location:ft.path,service:ft.service,read_only:ft.read_only,atomic_server_secret:ft.service==="Atomic"?ft.atomic_server_secret:void 0,extra_parameters:ft.extra_parameters||{}})),kg:$e.kg.url||$e.kg.local_path?{automata_path:$e.kg.url?{Remote:$e.kg.url}:null,knowledge_graph_local:$e.kg.local_path?{input_type:$e.kg.local_type,path:$e.kg.local_path}:null,public:$e.kg.public,publish:$e.kg.publish}:null,...$e.openrouter_enabled&&{openrouter_enabled:$e.openrouter_enabled,openrouter_api_key:$e.openrouter_api_key,openrouter_model:$e.openrouter_model,openrouter_auto_summarize:$e.openrouter_auto_summarize??!1,openrouter_chat_enabled:$e.openrouter_chat_enabled??!1,openrouter_chat_model:$e.openrouter_chat_model??$e.openrouter_model,openrouter_chat_system_prompt:$e.openrouter_chat_system_prompt??""}};const me={};$e.llm_provider&&(me.llm_provider=$e.llm_provider),$e.llm_model&&(me.llm_model=$e.llm_model),$e.llm_base_url&&(me.llm_base_url=$e.llm_base_url),typeof $e.llm_auto_summarize=="boolean"&&(me.llm_auto_summarize=$e.llm_auto_summarize),de[nt].extra={...de[nt].extra||{},...me}}),B.roles=de,(!B.default_role||!de[B.default_role])&&(B.default_role=((Ce=q.roles[0])==null?void 0:Ce.name)??"Default"),B.selected_role=B.default_role;try{if(Rt(ct))await Ue("update_config",{configNew:B});else{const $e=await fetch("/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(B)});if(!$e.ok)throw new Error(`HTTP ${$e.status}: ${$e.statusText}`)}Lt.set(B),t(2,g="success"),setTimeout(()=>{t(2,g="")},3e3)}catch($e){console.error($e),t(2,g="error"),setTimeout(()=>{t(2,g="")},3e3)}}const F=()=>t(2,g=""),x=()=>t(2,g="");function Q(){n.id=St(this),i.set(n),t(8,d)}function E(){n.global_shortcut=this.value,i.set(n),t(8,d)}function L(){n.default_theme=St(this),i.set(n),t(8,d)}function se(){n.default_role=St(this),i.set(n),t(8,d)}function J(q){n.roles[q].name=this.value,i.set(n),t(8,d)}function ie(q){n.roles[q].shortname=this.value,i.set(n),t(8,d)}function ee(q){n.roles[q].theme=St(this),i.set(n),t(8,d)}function z(q){n.roles[q].relevance_function=St(this),i.set(n),t(8,d)}function Z(q){n.roles[q].terraphim_it=this.checked,i.set(n),t(8,d)}function I(q,te){n.roles[q].haystacks[te].service=St(this),i.set(n),t(8,d)}function j(q,te){n.roles[q].haystacks[te].path=this.value,i.set(n),t(8,d)}const A=(q,te)=>s(q,te);function P(q,te){n.roles[q].haystacks[te].atomic_server_secret=this.value,i.set(n),t(8,d)}function G(q,te){n.roles[q].haystacks[te].extra_parameters.tag=this.value,i.set(n),t(8,d)}const oe=(q,te,B)=>{const de=B.currentTarget.value;de&&Ht(i,n.roles[q].haystacks[te].extra_parameters.tag=de,n)},X=(q,te,B,de)=>O(q,te,B,de);function re(q,te,B){n.roles[q].haystacks[te].extra_parameters[B]=this.value,i.set(n),t(8,d)}const D=(q,te,B)=>K(q,te,B),W=(q,te)=>C(q,te,"tag","#rust"),le=(q,te)=>C(q,te,"max_count","10"),ne=(q,te)=>C(q,te,"","");function ce(q,te){n.roles[q].haystacks[te].read_only=this.checked,i.set(n),t(8,d)}const ue=(q,te)=>b(q,te),H=q=>y(q);function Y(q){n.roles[q].llm_provider=St(this),i.set(n),t(8,d)}function fe(q){n.roles[q].llm_model=this.value,i.set(n),t(8,d)}const _e=q=>m(q),ke=(q,te)=>{Ht(i,n.roles[q].llm_model=te.currentTarget.value,n)};function Te(q){n.roles[q].llm_base_url=this.value,i.set(n),t(8,d)}function Xe(q){n.roles[q].llm_auto_summarize=this.checked,i.set(n),t(8,d)}function Be(q){n.roles[q].openrouter_enabled=this.checked,i.set(n),t(8,d)}function Ne(q){n.roles[q].openrouter_api_key=this.value,i.set(n),t(8,d)}function Pe(q){n.roles[q].openrouter_model=this.value,i.set(n),t(8,d)}const pe=q=>m(q),Se=(q,te)=>{Ht(i,n.roles[q].openrouter_model=te.currentTarget.value,n)};function Me(q){n.roles[q].openrouter_auto_summarize=this.checked,i.set(n),t(8,d)}function xe(q){n.roles[q].openrouter_chat_enabled=this.checked,i.set(n),t(8,d)}function et(q){n.roles[q].openrouter_chat_model=St(this),i.set(n),t(8,d)}function ye(q){n.roles[q].openrouter_chat_system_prompt=this.value,i.set(n),t(8,d)}function ze(q){n.roles[q].kg.url=this.value,i.set(n),t(8,d)}function Ge(q){n.roles[q].kg.local_path=this.value,i.set(n),t(8,d)}const qe=q=>u(q);function Le(q){n.roles[q].kg.local_type=St(this),i.set(n),t(8,d)}function Ie(q){n.roles[q].kg.public=this.checked,i.set(n),t(8,d)}function it(q){n.roles[q].kg.publish=this.checked,i.set(n),t(8,d)}return[p,_,g,n,o,s,u,i,d,m,w,h,k,$,y,b,C,K,O,R,F,x,Q,E,L,se,J,ie,ee,z,Z,I,j,A,P,G,oe,X,re,D,W,le,ne,ce,ue,H,Y,fe,_e,ke,Te,Xe,Be,Ne,Pe,pe,Se,Me,xe,et,ye,ze,Ge,qe,Le,Ie,it,q=>$(q),()=>{t(1,_=2)}]}class Ia extends _t{constructor(e){super(),gt(this,e,La,Aa,pt,{},null,[-1,-1,-1,-1])}}function Da(l){let e,t,n,o,a,s,u,i;return e=new _l({props:{fallbackPath:"/"}}),u=new Ks({props:{content:l[0],onChange:l[1]}}),{c(){ge(e.$$.fragment),t=v(),n=f("div"),o=f("p"),o.innerHTML="<i>The best editing experience is to configure Atomic Server, in the meantime use editor below. You will need to refresh page via Command R or Ctrl-R to see changes</i>",a=v(),s=f("div"),ge(u.$$.fragment),c(s,"class","editor"),c(n,"class","box")},m(d,p){he(e,d,p),S(d,t,p),S(d,n,p),r(n,o),r(n,a),r(n,s),he(u,s,null),i=!0},p(d,[p]){const m={};p&1&&(m.content=d[0]),u.$set(m)},i(d){i||(M(e.$$.fragment,d),M(u.$$.fragment,d),i=!0)},o(d){V(e.$$.fragment,d),V(u.$$.fragment,d),i=!1},d(d){ve(e,d),d&&T(t),d&&T(n),ve(u)}}}function Na(l,e,t){let n,o;je(l,Lt,u=>t(2,n=u)),je(l,ct,u=>t(3,o=u));let a={json:n};function s(u){if(console.log("contents changed:",u),console.log("is tauri",o),Lt.update(i=>(i=u.json,i)),Rt(ct))console.log("Updating config on server"),Ue("update_config",{configNew:u.json}).then(i=>{console.log(`Message: ${i}`)}).catch(i=>console.error(i));else{let i=`${Ve.ServerURL}/config/`;fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u.json)})}t(0,a=u)}return tl(()=>{t(0,a={json:n})}),[a,s]}class Oa extends _t{constructor(e){super(),gt(this,e,Na,Da,pt,{})}}const{window:ql}=pr;function Pa(l){let e,t,n,o,a,s,u,i,d,p;return{c(){e=f("div"),t=f("div"),n=f("h3"),n.textContent="Error loading graph",o=v(),a=f("p"),s=U(l[3]),u=v(),i=f("button"),i.textContent="Retry",c(i,"class","button is-primary"),c(t,"class","error-content svelte-1ry9pkl"),c(e,"class","error-overlay svelte-1ry9pkl")},m(m,_){S(m,e,_),r(e,t),r(t,n),r(t,o),r(t,a),r(a,s),r(t,u),r(t,i),d||(p=ae(i,"click",l[11]),d=!0)},p(m,_){_&8&&be(s,m[3])},d(m){m&&T(e),d=!1,p()}}}function Ua(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="loading-content svelte-1ry9pkl"><div class="loader svelte-1ry9pkl"></div> 
        <p>Loading knowledge graph...</p></div>`,c(e,"class","loading-overlay svelte-1ry9pkl")},m(t,n){S(t,e,n)},p:Re,d(t){t&&T(e)}}}function Yo(l){let e,t,n;return{c(){e=f("button"),e.innerHTML='<i class="fas fa-times svelte-1ry9pkl"></i>',c(e,"class","close-button svelte-1ry9pkl"),c(e,"title","Close Graph")},m(o,a){S(o,e,a),t||(n=ae(e,"click",l[17]),t=!0)},p:Re,d(o){o&&T(e),t=!1,n()}}}function Zo(l){let e;return{c(){e=f("div"),e.innerHTML="<span><strong>Left-click:</strong> View node ‚Ä¢ <strong>Right-click:</strong> Edit node ‚Ä¢ <strong>Drag:</strong> Move ‚Ä¢ <strong>Scroll:</strong> Zoom</span>",c(e,"class","controls-info svelte-1ry9pkl")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function Xo(l){let e,t;return{c(){e=f("div"),t=U(l[8]),c(e,"class","debug-message svelte-1ry9pkl")},m(n,o){S(n,e,o),r(e,t)},p(n,o){o&256&&be(t,n[8])},d(n){n&&T(e)}}}function xo(l){let e=l[5].id,t,n,o=es(l);return{c(){o.c(),t=ut()},m(a,s){o.m(a,s),S(a,t,s),n=!0},p(a,s){s&32&&pt(e,e=a[5].id)?(Fe(),V(o,1,1,Re),Ke(),o=es(a),o.c(),M(o,1),o.m(t.parentNode,t)):o.p(a,s)},i(a){n||(M(o),n=!0)},o(a){V(o),n=!1},d(a){a&&T(t),o.d(a)}}}function es(l){let e,t,n;function o(s){l[18](s)}let a={item:l[5],initialEdit:l[7]};return l[6]!==void 0&&(a.active=l[6]),e=new Yl({props:a}),lt.push(()=>st(e,"active",o)),e.$on("close",l[12]),e.$on("save",l[13]),{c(){ge(e.$$.fragment)},m(s,u){he(e,s,u),n=!0},p(s,u){const i={};u&32&&(i.item=s[5]),u&128&&(i.initialEdit=s[7]),!t&&u&64&&(t=!0,i.active=s[6],rt(()=>t=!1)),e.$set(i)},i(s){n||(M(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){ve(e,s)}}}function Ma(l){let e,t,n,o,a,s,u,i,d,p,m;mt(l[15]),e=new _l({props:{fallbackPath:"/"}});function _(b,C){if(b[2])return Ua;if(b[3])return Pa}let g=_(l),w=g&&g(l),h=l[0]&&Yo(l),k=!l[2]&&!l[3]&&l[4].length>0&&Zo(),$=l[8]&&Xo(l),y=l[5]&&xo(l);return{c(){ge(e.$$.fragment),t=v(),n=f("div"),w&&w.c(),o=v(),h&&h.c(),a=v(),k&&k.c(),s=v(),$&&$.c(),u=v(),y&&y.c(),i=ut(),c(n,"class","graph-container svelte-1ry9pkl"),we(n,"width",l[0]?"100vw":"600px"),we(n,"height",l[0]?"100vh":"400px"),dt(n,"fullscreen",l[0])},m(b,C){he(e,b,C),S(b,t,C),S(b,n,C),w&&w.m(n,null),l[16](n),S(b,o,C),h&&h.m(b,C),S(b,a,C),k&&k.m(b,C),S(b,s,C),$&&$.m(b,C),S(b,u,C),y&&y.m(b,C),S(b,i,C),d=!0,p||(m=ae(ql,"resize",l[15]),p=!0)},p(b,[C]){g===(g=_(b))&&w?w.p(b,C):(w&&w.d(1),w=g&&g(b),w&&(w.c(),w.m(n,null))),(!d||C&1)&&we(n,"width",b[0]?"100vw":"600px"),(!d||C&1)&&we(n,"height",b[0]?"100vh":"400px"),(!d||C&1)&&dt(n,"fullscreen",b[0]),b[0]?h?h.p(b,C):(h=Yo(b),h.c(),h.m(a.parentNode,a)):h&&(h.d(1),h=null),!b[2]&&!b[3]&&b[4].length>0?k||(k=Zo(),k.c(),k.m(s.parentNode,s)):k&&(k.d(1),k=null),b[8]?$?$.p(b,C):($=Xo(b),$.c(),$.m(u.parentNode,u)):$&&($.d(1),$=null),b[5]?y?(y.p(b,C),C&32&&M(y,1)):(y=xo(b),y.c(),M(y,1),y.m(i.parentNode,i)):y&&(Fe(),V(y,1,1,()=>{y=null}),Ke())},i(b){d||(M(e.$$.fragment,b),M(y),d=!0)},o(b){V(e.$$.fragment,b),V(y),d=!1},d(b){ve(e,b),b&&T(t),b&&T(n),w&&w.d(),l[16](null),b&&T(o),h&&h.d(b),b&&T(a),k&&k.d(b),b&&T(s),$&&$.d(b),b&&T(u),y&&y.d(b),b&&T(i),p=!1,m()}}}function ts(l){return{id:`kg-node-${l.id}`,url:`#/graph/node/${l.id}`,title:l.label,body:`# ${l.label}

**Knowledge Graph Node**

ID: ${l.id}
Rank: ${l.rank}

This is a concept node from the knowledge graph. You can edit this content to add more information about "${l.label}".`,description:`Knowledge graph concept: ${l.label}`,tags:["knowledge-graph","concept"],rank:l.rank,stub:`Knowledge graph concept: ${l.label}`}}function ja(l,e,t){let n,o;je(l,At,L=>t(20,n=L)),je(l,ct,L=>t(21,o=L));let{apiUrl:a="/rolegraph"}=e,{fullscreen:s=!0}=e,u,i=!0,d=null,p=[],m=[],_=null,g=!1,w=!1,h="",k=window.innerWidth,$=window.innerHeight;function y(){t(9,k=window.innerWidth),t(10,$=window.innerHeight),!i&&!d&&R()}async function b(){t(2,i=!0),t(3,d=null);try{if(o){console.log("Loading rolegraph from Tauri");const L=await Ue("get_rolegraph",{role_name:n||void 0});if(L&&L.status==="success")t(4,p=L.nodes),m=L.edges;else throw new Error(`Tauri rolegraph fetch failed: ${(L==null?void 0:L.status)||"unknown error"}`)}else{console.log("Loading rolegraph from server");const L=n?`${a}?role=${encodeURIComponent(n)}`:a,se=await fetch(L);if(!se.ok)throw new Error(`Failed to fetch: ${se.status}`);const J=await se.json();t(4,p=J.nodes),m=J.edges}}catch(L){t(3,d=L.message),console.error("Error fetching rolegraph:",L)}finally{t(2,i=!1)}}function C(L,se){L.stopPropagation(),console.log("Node clicked:",se.label),t(5,_=ts(se)),t(7,w=!1),t(6,g=!0)}function K(L,se){L.preventDefault(),L.stopPropagation(),console.log("Node right-clicked:",se.label),t(8,h=`Right-clicked: ${se.label}`),t(5,_=ts(se)),t(7,w=!0),t(6,g=!0),setTimeout(()=>{t(8,h="")},2e3)}function N(){t(6,g=!1),t(5,_=null),t(7,w=!1)}async function O(){if(_)try{const L=await fetch("/documents",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(_)});L.ok?console.log("Successfully saved KG record:",_.id):console.error("Failed to save KG record:",L.statusText)}catch(L){console.error("Error saving KG record:",L)}finally{t(6,g=!1),t(5,_=null),t(7,w=!1)}}function R(){if(!u)return;t(1,u.innerHTML="",u);const L=Kl(u).append("svg").attr("width",k).attr("height",$),se=Rr().scaleExtent([.1,10]).on("zoom",P=>{J.attr("transform",P.transform)});L.call(se);const J=L.append("g"),ie=Ar(p).force("link",Er(m).id(P=>P.id).distance(100)).force("charge",Lr().strength(-200)).force("center",Ir(k/2,$/2)).force("collision",Dr().radius(20)),ee=J.append("g").attr("class","links").selectAll("line").data(m).enter().append("line").attr("stroke","#666").attr("stroke-opacity",.7).attr("stroke-width",P=>{const G=P.weight||P.rank||1;return Math.max(1,Math.min(8,G*2))}),z=J.append("g").attr("class","nodes").selectAll("circle").data(p).enter().append("circle").attr("r",P=>{const G=P.rank||1;return Math.max(6,Math.min(20,G*2))}).attr("fill",P=>{const G=P.rank||1,oe=Math.min(G/10,1);return Nr(.2+oe*.6)}).attr("stroke","#fff").attr("stroke-width",2).style("cursor","pointer").on("click",(P,G)=>C(P,G)).on("contextmenu",(P,G)=>K(P,G)).on("mouseover",function(P,G){Kl(this).transition().duration(150).attr("stroke-width",3).attr("r",oe=>{const X=oe.rank||1;return Math.max(8,Math.min(24,X*2.5))})}).on("mouseout",function(P,G){Kl(this).transition().duration(150).attr("stroke-width",2).attr("r",oe=>{const X=oe.rank||1;return Math.max(6,Math.min(20,X*2))})}).call(Or().on("start",I).on("drag",j).on("end",A)),Z=J.append("g").attr("class","labels").selectAll("text").data(p).enter().append("text").attr("text-anchor","middle").attr("dy",".35em").attr("font-size","11px").attr("font-family","Arial, sans-serif").attr("fill","#333").attr("pointer-events","none").text(P=>P.label.length>12?P.label.substring(0,12)+"...":P.label);ie.on("tick",()=>{ee.attr("x1",P=>P.source.x).attr("y1",P=>P.source.y).attr("x2",P=>P.target.x).attr("y2",P=>P.target.y),z.attr("cx",P=>P.x).attr("cy",P=>P.y),Z.attr("x",P=>P.x).attr("y",P=>P.y)});function I(P,G){P.active||ie.alphaTarget(.3).restart(),G.fx=G.x,G.fy=G.y}function j(P,G){G.fx=P.x,G.fy=P.y}function A(P,G){P.active||ie.alphaTarget(0),G.fx=null,G.fy=null}}tl(()=>{b().then(()=>{d||R()});const L=se=>{se.preventDefault()};return u&&u.addEventListener("contextmenu",L),window.addEventListener("resize",y),()=>{u&&u.removeEventListener("contextmenu",L),window.removeEventListener("resize",y)}});function F(){t(9,k=ql.innerWidth),t(10,$=ql.innerHeight)}function x(L){lt[L?"unshift":"push"](()=>{u=L,t(1,u)})}const Q=()=>history.back();function E(L){g=L,t(6,g)}return l.$$set=L=>{"apiUrl"in L&&t(14,a=L.apiUrl),"fullscreen"in L&&t(0,s=L.fullscreen)},[s,u,i,d,p,_,g,w,h,k,$,b,N,O,a,F,x,Q,E]}class za extends _t{constructor(e){super(),gt(this,e,ja,Ma,pt,{apiUrl:14,fullscreen:0})}}function ls(l,e,t){const n=l.slice();return n[19]=e[t][0],n[20]=e[t][1],n[21]=e,n[22]=t,n}function ns(l,e,t){const n=l.slice();return n[23]=e[t],n}function os(l){let e,t,n,o,a,s,u,i,d,p,m,_,g,w,h=l[2].title.trim()==="",k,$,y,b,C,K,N,O,R,F,x,Q,E,L,se,J=l[2].content.trim()==="",ie,ee,z,Z,I,j,A,P,G,oe,X,re,D,W,le,ne,ce,ue,H,Y,fe,_e=l[1]==="edit"?"Save Changes":"Add Context",ke,Te,Xe,Be,Ne,Pe,pe,Se,Me,xe,et=l[4],ye=[];for(let te=0;te<et.length;te+=1)ye[te]=ss(ns(l,et,te));let ze=h&&rs();function Ge(te,B){return te[2].summary?Fa:Ha}let qe=Ge(l),Le=qe(l),Ie=J&&is();function it(te,B){return B&4&&(X=null),X==null&&(X=Object.keys(te[2].metadata).length===0),X?Ga:Ka}let Oe=it(l,-1),We=Oe(l),q=l[1]==="edit"&&cs(l);return{c(){e=f("section"),t=f("div"),n=f("label"),n.textContent="Type",o=v(),a=f("div"),s=f("div"),u=f("select");for(let te=0;te<ye.length;te+=1)ye[te].c();i=v(),d=f("div"),p=f("label"),p.textContent="Title *",m=v(),_=f("div"),g=f("input"),w=v(),ze&&ze.c(),k=v(),$=f("div"),y=f("label"),y.textContent="Summary",b=v(),C=f("div"),K=f("textarea"),N=v(),O=f("p"),Le.c(),R=v(),F=f("div"),x=f("label"),x.textContent="Content *",Q=v(),E=f("div"),L=f("textarea"),se=v(),Ie&&Ie.c(),ie=v(),ee=f("details"),z=f("summary"),z.innerHTML=`<span class="icon-text"><span class="icon"><i class="fas fa-cog"></i></span> 
              <span>Advanced Options</span></span>`,Z=v(),I=f("div"),j=f("label"),j.textContent="Metadata",A=v(),P=f("div"),G=f("p"),G.textContent="Additional key-value pairs for this context item",oe=v(),We.c(),re=v(),D=f("button"),D.innerHTML=`<span class="icon"><i class="fas fa-plus"></i></span> 
                <span>Add Metadata</span>`,W=v(),le=f("footer"),ne=f("div"),ce=f("div"),ue=f("button"),H=f("span"),H.innerHTML='<i class="fas fa-save"></i>',Y=v(),fe=f("span"),ke=U(_e),Xe=v(),Be=f("div"),Ne=f("button"),Ne.innerHTML="<span>Cancel</span>",Pe=v(),q&&q.c(),pe=v(),Se=f("div"),Se.innerHTML=`<strong>Keyboard shortcuts:</strong>
          Ctrl/Cmd + Enter to save, Escape to close`,c(n,"class","label"),c(n,"for","context-type"),c(u,"id","context-type"),c(u,"data-testid","context-type-select"),l[2].context_type===void 0&&mt(()=>l[10].call(u)),c(s,"class","select is-fullwidth"),c(a,"class","control"),c(t,"class","field"),c(p,"class","label"),c(p,"for","context-title"),c(g,"id","context-title"),c(g,"class","input"),c(g,"type","text"),c(g,"placeholder","Enter title..."),c(g,"data-testid","context-title-input"),g.required=!0,c(_,"class","control"),c(d,"class","field"),c(y,"class","label"),c(y,"for","context-summary"),c(K,"id","context-summary"),c(K,"class","textarea svelte-1oesbw7"),c(K,"placeholder","Brief summary of the content (optional)..."),c(K,"data-testid","context-summary-textarea"),c(K,"rows","3"),c(K,"maxlength","500"),c(C,"class","control"),c(O,"class","help svelte-1oesbw7"),c($,"class","field"),c(x,"class","label"),c(x,"for","context-content"),c(L,"id","context-content"),c(L,"class","textarea svelte-1oesbw7"),c(L,"placeholder","Enter the full content..."),c(L,"data-testid","context-content-textarea"),c(L,"rows","8"),L.required=!0,c(E,"class","control"),c(F,"class","field"),c(z,"class","summary svelte-1oesbw7"),c(j,"class","label"),c(G,"class","help svelte-1oesbw7"),c(D,"class","button is-small is-light"),c(P,"class","content"),c(I,"class","field mt-4"),c(ee,"class","details svelte-1oesbw7"),c(e,"class","modal-card-body svelte-1oesbw7"),c(H,"class","icon"),c(ue,"class","button is-primary"),ue.disabled=Te=!l[3],c(ue,"data-testid","save-context-button"),c(ce,"class","control"),c(Ne,"class","button is-light"),c(Ne,"data-testid","cancel-context-button"),c(Be,"class","control"),c(ne,"class","field is-grouped"),c(Se,"class","help svelte-1oesbw7"),c(le,"class","modal-card-foot")},m(te,B){S(te,e,B),r(e,t),r(t,n),r(t,o),r(t,a),r(a,s),r(s,u);for(let de=0;de<ye.length;de+=1)ye[de]&&ye[de].m(u,null);Je(u,l[2].context_type,!0),r(e,i),r(e,d),r(d,p),r(d,m),r(d,_),r(_,g),De(g,l[2].title),r(d,w),ze&&ze.m(d,null),r(e,k),r(e,$),r($,y),r($,b),r($,C),r(C,K),De(K,l[2].summary),r($,N),r($,O),Le.m(O,null),r(e,R),r(e,F),r(F,x),r(F,Q),r(F,E),r(E,L),De(L,l[2].content),r(F,se),Ie&&Ie.m(F,null),r(e,ie),r(e,ee),r(ee,z),r(ee,Z),r(ee,I),r(I,j),r(I,A),r(I,P),r(P,G),r(P,oe),We.m(P,null),r(P,re),r(P,D),S(te,W,B),S(te,le,B),r(le,ne),r(ne,ce),r(ce,ue),r(ue,H),r(ue,Y),r(ue,fe),r(fe,ke),r(ne,Xe),r(ne,Be),r(Be,Ne),r(ne,Pe),q&&q.m(ne,null),r(le,pe),r(le,Se),Me||(xe=[ae(u,"change",l[10]),ae(g,"input",l[11]),ae(K,"input",l[12]),ae(L,"input",l[13]),ae(D,"click",l[17]),ae(ue,"click",l[6]),ae(Ne,"click",l[5])],Me=!0)},p(te,B){if(B&16){et=te[4];let de;for(de=0;de<et.length;de+=1){const Ce=ns(te,et,de);ye[de]?ye[de].p(Ce,B):(ye[de]=ss(Ce),ye[de].c(),ye[de].m(u,null))}for(;de<ye.length;de+=1)ye[de].d(1);ye.length=et.length}B&20&&Je(u,te[2].context_type),B&20&&g.value!==te[2].title&&De(g,te[2].title),B&4&&(h=te[2].title.trim()===""),h?ze||(ze=rs(),ze.c(),ze.m(d,null)):ze&&(ze.d(1),ze=null),B&20&&De(K,te[2].summary),qe===(qe=Ge(te))&&Le?Le.p(te,B):(Le.d(1),Le=qe(te),Le&&(Le.c(),Le.m(O,null))),B&20&&De(L,te[2].content),B&4&&(J=te[2].content.trim()===""),J?Ie||(Ie=is(),Ie.c(),Ie.m(F,null)):Ie&&(Ie.d(1),Ie=null),Oe===(Oe=it(te,B))&&We?We.p(te,B):(We.d(1),We=Oe(te),We&&(We.c(),We.m(P,re))),B&2&&_e!==(_e=te[1]==="edit"?"Save Changes":"Add Context")&&be(ke,_e),B&8&&Te!==(Te=!te[3])&&(ue.disabled=Te),te[1]==="edit"?q?q.p(te,B):(q=cs(te),q.c(),q.m(ne,null)):q&&(q.d(1),q=null)},d(te){te&&T(e),tt(ye,te),ze&&ze.d(),Le.d(),Ie&&Ie.d(),We.d(),te&&T(W),te&&T(le),q&&q.d(),Me=!1,Ze(xe)}}}function ss(l){let e,t=l[23].label+"",n;return{c(){e=f("option"),n=U(t),e.__value=l[23].value,e.value=e.__value},m(o,a){S(o,e,a),r(e,n)},p:Re,d(o){o&&T(e)}}}function rs(l){let e;return{c(){e=f("p"),e.textContent="Title is required",c(e,"class","help is-danger svelte-1oesbw7")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function Ha(l){let e;return{c(){e=U("Optional brief summary (up to 500 characters)")},m(t,n){S(t,e,n)},p:Re,d(t){t&&T(e)}}}function Fa(l){let e=l[2].summary.length+"",t,n;return{c(){t=U(e),n=U("/500 characters")},m(o,a){S(o,t,a),S(o,n,a)},p(o,a){a&4&&e!==(e=o[2].summary.length+"")&&be(t,e)},d(o){o&&T(t),o&&T(n)}}}function is(l){let e;return{c(){e=f("p"),e.textContent="Content is required",c(e,"class","help is-danger svelte-1oesbw7")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function Ka(l){let e,t=Object.entries(l[2].metadata),n=[];for(let o=0;o<t.length;o+=1)n[o]=as(ls(l,t,o));return{c(){for(let o=0;o<n.length;o+=1)n[o].c();e=ut()},m(o,a){for(let s=0;s<n.length;s+=1)n[s]&&n[s].m(o,a);S(o,e,a)},p(o,a){if(a&4){t=Object.entries(o[2].metadata);let s;for(s=0;s<t.length;s+=1){const u=ls(o,t,s);n[s]?n[s].p(u,a):(n[s]=as(u),n[s].c(),n[s].m(e.parentNode,e))}for(;s<n.length;s+=1)n[s].d(1);n.length=t.length}},d(o){tt(n,o),o&&T(e)}}}function Ga(l){let e;return{c(){e=f("p"),e.textContent="No metadata defined",c(e,"class","has-text-grey-light")},m(t,n){S(t,e,n)},p:Re,d(t){t&&T(e)}}}function as(l){let e,t,n,o,a,s,u,i,d,p,m,_,g;function w(...$){return l[14](l[19],l[20],...$)}function h(){l[15].call(u,l[19])}function k(){return l[16](l[19])}return{c(){e=f("div"),t=f("div"),n=f("input"),a=v(),s=f("div"),u=f("input"),i=v(),d=f("div"),p=f("button"),p.innerHTML='<span class="icon"><i class="fas fa-times"></i></span>',m=v(),c(n,"class","input is-small"),c(n,"type","text"),c(n,"placeholder","Key"),n.value=o=l[19],c(t,"class","control is-expanded"),c(u,"class","input is-small"),c(u,"type","text"),c(u,"placeholder","Value"),c(s,"class","control is-expanded"),c(p,"class","button is-small is-danger is-outlined"),c(d,"class","control"),c(e,"class","field is-grouped")},m($,y){S($,e,y),r(e,t),r(t,n),r(e,a),r(e,s),r(s,u),De(u,l[2].metadata[l[19]]),r(e,i),r(e,d),r(d,p),r(e,m),_||(g=[ae(n,"input",w),ae(u,"input",h),ae(p,"click",k)],_=!0)},p($,y){l=$,y&20&&o!==(o=l[19])&&n.value!==o&&(n.value=o),y&20&&u.value!==l[2].metadata[l[19]]&&De(u,l[2].metadata[l[19]])},d($){$&&T(e),_=!1,Ze(g)}}}function cs(l){let e,t,n,o,a,s;return{c(){e=f("div"),t=v(),n=f("div"),o=f("button"),o.innerHTML=`<span class="icon"><i class="fas fa-trash"></i></span> 
                <span>Delete</span>`,c(e,"class","control is-expanded"),c(o,"class","button is-danger is-outlined"),c(o,"data-testid","delete-context-button"),c(n,"class","control")},m(u,i){S(u,e,i),S(u,t,i),S(u,n,i),r(n,o),a||(s=ae(o,"click",l[7]),a=!0)},p:Re,d(u){u&&T(e),u&&T(t),u&&T(n),a=!1,s()}}}function qa(l){let e,t,n,o=l[1]==="edit"?"Edit Context Item":"Add Context Item",a,s,u,i,d,p,m=l[2]&&os(l);return{c(){e=f("div"),t=f("header"),n=f("p"),a=U(o),s=v(),u=f("button"),i=v(),m&&m.c(),c(n,"class","modal-card-title"),c(u,"class","delete"),c(u,"aria-label","close"),c(t,"class","modal-card-head"),c(e,"class","modal-card")},m(_,g){S(_,e,g),r(e,t),r(t,n),r(n,a),r(t,s),r(t,u),r(e,i),m&&m.m(e,null),d||(p=ae(u,"click",l[5]),d=!0)},p(_,g){g&2&&o!==(o=_[1]==="edit"?"Edit Context Item":"Add Context Item")&&be(a,o),_[2]?m?m.p(_,g):(m=os(_),m.c(),m.m(e,null)):m&&(m.d(1),m=null)},d(_){_&&T(e),m&&m.d(),d=!1,p()}}}function Wa(l){let e,t,n,o;return e=new kl({props:{active:l[0],$$slots:{default:[qa]},$$scope:{ctx:l}}}),e.$on("close",l[5]),{c(){ge(e.$$.fragment)},m(a,s){he(e,a,s),t=!0,n||(o=ae(window,"keydown",l[8]),n=!0)},p(a,[s]){const u={};s&1&&(u.active=a[0]),s&67108878&&(u.$$scope={dirty:s,ctx:a}),e.$set(u)},i(a){t||(M(e.$$.fragment,a),t=!0)},o(a){V(e.$$.fragment,a),t=!1},d(a){ve(e,a),n=!1,o()}}}function Ba(l,e,t){let n,{active:o=!1}=e,{context:a=null}=e,{mode:s="edit"}=e;const u=Ql();let i=null,d=[{value:"Document",label:"Document"},{value:"SearchResult",label:"Search Result"},{value:"UserInput",label:"User Input"},{value:"System",label:"System"},{value:"External",label:"External"}];function p(){t(0,o=!1),t(2,i=null),u("close")}function m(){!n||!i||(u(s==="edit"?"update":"create",i),p())}function _(){s==="edit"&&a&&(u("delete",a.id),p())}function g(N){N.key==="Escape"?p():N.key==="Enter"&&(N.ctrlKey||N.metaKey)&&m()}function w(){i.context_type=St(this),t(2,i),t(0,o),t(9,a),t(1,s),t(4,d)}function h(){i.title=this.value,t(2,i),t(0,o),t(9,a),t(1,s),t(4,d)}function k(){i.summary=this.value,t(2,i),t(0,o),t(9,a),t(1,s),t(4,d)}function $(){i.content=this.value,t(2,i),t(0,o),t(9,a),t(1,s),t(4,d)}const y=(N,O,R)=>{const F={...i.metadata};delete F[N],F[R.target.value]=O,t(2,i.metadata=F,i)};function b(N){i.metadata[N]=this.value,t(2,i),t(0,o),t(9,a),t(1,s),t(4,d)}const C=N=>{const O={...i.metadata};delete O[N],t(2,i.metadata=O,i)},K=()=>{t(2,i.metadata={...i.metadata,[`key_${Date.now()}`]:""},i)};return l.$$set=N=>{"active"in N&&t(0,o=N.active),"context"in N&&t(9,a=N.context),"mode"in N&&t(1,s=N.mode)},l.$$.update=()=>{l.$$.dirty&515&&(o&&a?t(2,i={...a,metadata:{...a.metadata}}):o&&s==="create"&&t(2,i={id:"",context_type:"UserInput",title:"",summary:"",content:"",metadata:{},created_at:new Date().toISOString(),relevance_score:null})),l.$$.dirty&4&&t(3,n=i&&i.title.trim()!==""&&i.content.trim()!=="")},[o,s,i,n,d,p,m,_,g,a,w,h,k,$,y,b,C,K]}class Ja extends _t{constructor(e){super(),gt(this,e,Ba,Wa,pt,{active:0,context:9,mode:1})}}function us(l,e,t){const n=l.slice();return n[35]=e[t],n}function fs(l,e,t){const n=l.slice();return n[38]=e[t],n[40]=t,n}function ds(l){let e,t=l[7],n=[];for(let o=0;o<t.length;o+=1)n[o]=ps(fs(l,t,o));return{c(){e=f("ul");for(let o=0;o<n.length;o+=1)n[o].c();c(e,"class","suggestions svelte-k0eopx"),c(e,"data-testid","kg-typeahead-list")},m(o,a){S(o,e,a);for(let s=0;s<n.length;s+=1)n[s]&&n[s].m(e,null)},p(o,a){if(a[0]&4480){t=o[7];let s;for(s=0;s<t.length;s+=1){const u=fs(o,t,s);n[s]?n[s].p(u,a):(n[s]=ps(u),n[s].c(),n[s].m(e,null))}for(;s<n.length;s+=1)n[s].d(1);n.length=t.length}},d(o){o&&T(e),tt(n,o)}}}function ps(l){let e,t=l[38]+"",n,o,a,s,u,i;function d(){return l[24](l[38])}function p(...m){return l[25](l[38],...m)}return{c(){e=f("li"),n=U(t),o=v(),c(e,"tabindex","0"),c(e,"role","option"),c(e,"aria-selected",a=l[40]===l[8]),c(e,"aria-label",s=`Apply suggestion: ${l[38]}`),c(e,"data-testid","kg-typeahead-item"),c(e,"class","svelte-k0eopx"),dt(e,"active",l[40]===l[8])},m(m,_){S(m,e,_),r(e,n),r(e,o),u||(i=[ae(e,"click",d),ae(e,"keydown",p)],u=!0)},p(m,_){l=m,_[0]&128&&t!==(t=l[38]+"")&&be(n,t),_[0]&256&&a!==(a=l[40]===l[8])&&c(e,"aria-selected",a),_[0]&128&&s!==(s=`Apply suggestion: ${l[38]}`)&&c(e,"aria-label",s),_[0]&256&&dt(e,"active",l[40]===l[8])},d(m){m&&T(e),u=!1,Ze(i)}}}function Va(l){let e,t,n,o,a,s;function u(m){l[21](m)}function i(m){l[22](m)}let d={placeholder:"Search knowledge graph terms...",type:"search",disabled:l[4],icon:"search",expanded:!0,autofocus:!0,"data-testid":"kg-search-input"};l[2]!==void 0&&(d.element=l[2]),l[1]!==void 0&&(d.value=l[1]),t=new Vt({props:d}),lt.push(()=>st(t,"element",u)),lt.push(()=>st(t,"value",i)),t.$on("input",l[23]),t.$on("keydown",l[13]);let p=l[7].length>0&&ds(l);return{c(){e=f("div"),ge(t.$$.fragment),a=v(),p&&p.c(),c(e,"class","input-wrapper svelte-k0eopx")},m(m,_){S(m,e,_),he(t,e,null),r(e,a),p&&p.m(e,null),s=!0},p(m,_){const g={};_[0]&16&&(g.disabled=m[4]),!n&&_[0]&4&&(n=!0,g.element=m[2],rt(()=>n=!1)),!o&&_[0]&2&&(o=!0,g.value=m[1],rt(()=>o=!1)),t.$set(g),m[7].length>0?p?p.p(m,_):(p=ds(m),p.c(),p.m(e,null)):p&&(p.d(1),p=null)},i(m){s||(M(t.$$.fragment,m),s=!0)},o(m){V(t.$$.fragment,m),s=!1},d(m){m&&T(e),ve(t),p&&p.d()}}}function ms(l){let e,t;return e=new Bl({props:{type:"is-danger","data-testid":"kg-search-error",$$slots:{default:[Qa]},$$scope:{ctx:l}}}),{c(){ge(e.$$.fragment)},m(n,o){he(e,n,o),t=!0},p(n,o){const a={};o[0]&32|o[1]&1024&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function Qa(l){let e;return{c(){e=U(l[5])},m(t,n){S(t,e,n)},p(t,n){n[0]&32&&be(e,t[5])},d(t){t&&T(e)}}}function Ya(l){let e,t,n,o,a,s,u;return{c(){e=f("div"),t=f("p"),t.textContent="Enter at least 2 characters to search the knowledge graph",n=v(),o=f("p"),a=U('This will search terms from the knowledge graph for role "'),s=U(l[9]),u=U('"'),c(t,"class","has-text-centered"),c(o,"class","has-text-centered is-size-7 mt-2"),c(e,"class","notification is-info is-light")},m(i,d){S(i,e,d),r(e,t),r(e,n),r(e,o),r(o,a),r(o,s),r(o,u)},p(i,d){d[0]&512&&be(s,i[9])},d(i){i&&T(e)}}}function Za(l){let e,t,n,o,a,s,u,i,d,p,m;return{c(){e=f("div"),t=f("p"),n=U('No knowledge graph terms found for "'),o=f("strong"),a=U(l[1]),s=U('"'),u=v(),i=f("p"),d=U('Try different keywords or check if the role "'),p=U(l[9]),m=U('" has a knowledge graph enabled.'),c(t,"class","has-text-centered"),c(i,"class","has-text-centered is-size-7 has-text-grey mt-2"),c(e,"class","notification is-light"),c(e,"data-testid","kg-search-empty")},m(_,g){S(_,e,g),r(e,t),r(t,n),r(t,o),r(o,a),r(t,s),r(e,u),r(e,i),r(i,d),r(i,p),r(i,m)},p(_,g){g[0]&2&&be(a,_[1]),g[0]&512&&be(p,_[9])},d(_){_&&T(e)}}}function Xa(l){let e,t=l[3],n=[];for(let o=0;o<t.length;o+=1)n[o]=vs(us(l,t,o));return{c(){e=f("div");for(let o=0;o<n.length;o+=1)n[o].c();c(e,"class","suggestions-container svelte-k0eopx"),c(e,"data-testid","kg-suggestions-list")},m(o,a){S(o,e,a);for(let s=0;s<n.length;s+=1)n[s]&&n[s].m(e,null)},p(o,a){if(a[0]&16456){t=o[3];let s;for(s=0;s<t.length;s+=1){const u=us(o,t,s);n[s]?n[s].p(u,a):(n[s]=vs(u),n[s].c(),n[s].m(e,null))}for(;s<n.length;s+=1)n[s].d(1);n.length=t.length}},d(o){o&&T(e),tt(n,o)}}}function xa(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="progress-container svelte-k0eopx"><div class="progress-bar svelte-k0eopx"><div class="progress-fill svelte-k0eopx"></div></div></div> 
          <p>Searching knowledge graph...</p>`,c(e,"class","empty-state svelte-k0eopx"),c(e,"data-testid","kg-search-loading")},m(t,n){S(t,e,n)},p:Re,d(t){t&&T(e)}}}function _s(l){let e,t,n=l[35].normalized_term+"",o;return{c(){e=f("span"),t=U("‚Üí "),o=U(n),c(e,"class","has-text-grey")},m(a,s){S(a,e,s),r(e,t),r(e,o)},p(a,s){s[0]&8&&n!==(n=a[35].normalized_term+"")&&be(o,n)},d(a){a&&T(e)}}}function gs(l){let e,t=l[35].suggestion_type+"",n;return{c(){e=f("span"),n=U(t),c(e,"class","tag is-small is-light")},m(o,a){S(o,e,a),r(e,n)},p(o,a){a[0]&8&&t!==(t=o[35].suggestion_type+"")&&be(n,t)},d(o){o&&T(e)}}}function hs(l){let e,t=l[35].url+"",n;return{c(){e=f("div"),n=U(t),c(e,"class","suggestion-url svelte-k0eopx")},m(o,a){S(o,e,a),r(e,n)},p(o,a){a[0]&8&&t!==(t=o[35].url+"")&&be(n,t)},d(o){o&&T(e)}}}function vs(l){let e,t,n=l[35].term+"",o,a,s,u,i=(l[35].score*100).toFixed(0)+"",d,p,m,_,g,w,h,k,$,y=l[35].normalized_term&&l[35].normalized_term!==l[35].term&&_s(l),b=l[35].suggestion_type&&gs(l),C=l[35].url&&hs(l);function K(){return l[26](l[35])}function N(...O){return l[27](l[35],...O)}return{c(){var O;e=f("button"),t=f("div"),o=U(n),a=v(),s=f("div"),u=f("span"),d=U(i),p=U("%"),m=v(),y&&y.c(),_=v(),b&&b.c(),g=v(),C&&C.c(),w=v(),c(t,"class","suggestion-term svelte-k0eopx"),c(u,"class","tag is-info is-small"),c(s,"class","suggestion-meta svelte-k0eopx"),c(e,"class",h="suggestion-item "+(((O=l[6])==null?void 0:O.term)===l[35].term?"is-active":"")+" svelte-k0eopx"),c(e,"type","button"),c(e,"data-testid","kg-suggestion-item")},m(O,R){S(O,e,R),r(e,t),r(t,o),r(e,a),r(e,s),r(s,u),r(u,d),r(u,p),r(s,m),y&&y.m(s,null),r(s,_),b&&b.m(s,null),r(e,g),C&&C.m(e,null),r(e,w),k||($=[ae(e,"click",K),ae(e,"keydown",N)],k=!0)},p(O,R){var F;l=O,R[0]&8&&n!==(n=l[35].term+"")&&be(o,n),R[0]&8&&i!==(i=(l[35].score*100).toFixed(0)+"")&&be(d,i),l[35].normalized_term&&l[35].normalized_term!==l[35].term?y?y.p(l,R):(y=_s(l),y.c(),y.m(s,_)):y&&(y.d(1),y=null),l[35].suggestion_type?b?b.p(l,R):(b=gs(l),b.c(),b.m(s,null)):b&&(b.d(1),b=null),l[35].url?C?C.p(l,R):(C=hs(l),C.c(),C.m(e,w)):C&&(C.d(1),C=null),R[0]&72&&h!==(h="suggestion-item "+(((F=l[6])==null?void 0:F.term)===l[35].term?"is-active":"")+" svelte-k0eopx")&&c(e,"class",h)},d(O){O&&T(e),y&&y.d(),b&&b.d(),C&&C.d(),k=!1,Ze($)}}}function ec(l){let e;return{c(){e=U("Cancel")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function bs(l){let e,t;return e=new Kt({props:{type:"is-primary",disabled:!l[6],"data-testid":"kg-add-term-button",$$slots:{default:[tc]},$$scope:{ctx:l}}}),e.$on("click",l[15]),{c(){ge(e.$$.fragment)},m(n,o){he(e,n,o),t=!0},p(n,o){const a={};o[0]&64&&(a.disabled=!n[6]),o[0]&64|o[1]&1024&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function tc(l){let e,t=l[6].term+"",n,o;return{c(){e=U('Add "'),n=U(t),o=U('" to Context')},m(a,s){S(a,e,s),S(a,n,s),S(a,o,s)},p(a,s){s[0]&64&&t!==(t=a[6].term+"")&&be(n,t)},d(a){a&&T(e),a&&T(n),a&&T(o)}}}function lc(l){let e;return{c(){e=U("Add Complete Thesaurus to Context")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function nc(l){let e,t,n,o,a,s,u,i,d,p,m,_,g,w,h,k,$,y,b,C,K,N,O,R,F,x,Q,E,L;i=new Ft({props:{$$slots:{default:[Va]},$$scope:{ctx:l}}});let se=l[5]&&ms(l);function J(Z,I){return I[0]&2&&(m=null),Z[4]?xa:Z[3].length>0?Xa:(m==null&&(m=Z[1].trim().length>=2),m?Za:Ya)}let ie=J(l,[-1,-1]),ee=ie(l);h=new Kt({props:{$$slots:{default:[ec]},$$scope:{ctx:l}}}),h.$on("click",l[17]);let z=l[6]&&bs(l);return x=new Kt({props:{type:"is-link",size:"is-small",style:"width: 100%;","data-testid":"kg-add-index-button",$$slots:{default:[lc]},$$scope:{ctx:l}}}),x.$on("click",l[16]),{c(){e=f("div"),t=f("div"),n=f("button"),o=v(),a=f("div"),a.innerHTML=`<div class="modal-title svelte-k0eopx"><h3 class="svelte-k0eopx">Knowledge Graph Search</h3> 
          <p class="svelte-k0eopx">Search and add terms from the knowledge graph to your context</p></div>`,s=v(),u=f("div"),ge(i.$$.fragment),d=v(),se&&se.c(),p=v(),ee.c(),_=v(),g=f("div"),w=f("div"),ge(h.$$.fragment),k=v(),z&&z.c(),$=v(),y=f("div"),b=f("div"),C=f("p"),K=f("strong"),K.textContent="Alternative:",N=U(' Add the complete thesaurus for role "'),O=U(l[9]),R=U('". This includes all domain-specific terms and their normalized mappings in JSON format for comprehensive vocabulary context.'),F=v(),ge(x.$$.fragment),c(n,"class","delete is-large modal-close-btn svelte-k0eopx"),c(n,"aria-label","close"),c(a,"class","modal-header svelte-k0eopx"),c(u,"class","search-section svelte-k0eopx"),c(w,"class","action-buttons svelte-k0eopx"),c(g,"class","modal-actions svelte-k0eopx"),c(C,"class","svelte-k0eopx"),c(b,"class","alternative-content svelte-k0eopx"),c(y,"class","alternative-section svelte-k0eopx"),c(t,"class","kg-search-container svelte-k0eopx"),c(e,"class","box wrapper svelte-k0eopx"),c(e,"data-testid","kg-search-modal")},m(Z,I){S(Z,e,I),r(e,t),r(t,n),r(t,o),r(t,a),r(t,s),r(t,u),he(i,u,null),r(t,d),se&&se.m(t,null),r(t,p),ee.m(t,null),r(t,_),r(t,g),r(g,w),he(h,w,null),r(w,k),z&&z.m(w,null),r(t,$),r(t,y),r(y,b),r(b,C),r(C,K),r(C,N),r(C,O),r(C,R),r(y,F),he(x,y,null),Q=!0,E||(L=[ae(n,"click",l[17]),ae(t,"keydown",l[18])],E=!0)},p(Z,I){const j={};I[0]&406|I[1]&1024&&(j.$$scope={dirty:I,ctx:Z}),i.$set(j),Z[5]?se?(se.p(Z,I),I[0]&32&&M(se,1)):(se=ms(Z),se.c(),M(se,1),se.m(t,p)):se&&(Fe(),V(se,1,1,()=>{se=null}),Ke()),ie===(ie=J(Z,I))&&ee?ee.p(Z,I):(ee.d(1),ee=ie(Z),ee&&(ee.c(),ee.m(t,_)));const A={};I[1]&1024&&(A.$$scope={dirty:I,ctx:Z}),h.$set(A),Z[6]?z?(z.p(Z,I),I[0]&64&&M(z,1)):(z=bs(Z),z.c(),M(z,1),z.m(w,null)):z&&(Fe(),V(z,1,1,()=>{z=null}),Ke()),(!Q||I[0]&512)&&be(O,Z[9]);const P={};I[1]&1024&&(P.$$scope={dirty:I,ctx:Z}),x.$set(P)},i(Z){Q||(M(i.$$.fragment,Z),M(se),M(h.$$.fragment,Z),M(z),M(x.$$.fragment,Z),Q=!0)},o(Z){V(i.$$.fragment,Z),V(se),V(h.$$.fragment,Z),V(z),V(x.$$.fragment,Z),Q=!1},d(Z){Z&&T(e),ve(i),se&&se.d(),ee.d(),ve(h),z&&z.d(),ve(x),E=!1,Ze(L)}}}function oc(l){let e,t,n;function o(s){l[28](s)}let a={$$slots:{default:[nc]},$$scope:{ctx:l}};return l[0]!==void 0&&(a.active=l[0]),e=new kl({props:a}),lt.push(()=>st(e,"active",o)),e.$on("close",l[17]),{c(){ge(e.$$.fragment)},m(s,u){he(e,s,u),n=!0},p(s,u){const i={};u[0]&1022|u[1]&1024&&(i.$$scope={dirty:u,ctx:s}),!t&&u[0]&1&&(t=!0,i.active=s[0],rt(()=>t=!1)),e.$set(i)},i(s){n||(M(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){ve(e,s)}}}function sc(l,e,t){let n,o;je(l,At,A=>t(9,n=A)),je(l,ct,A=>t(30,o=A));let{active:a=!1}=e,{initialQuery:s=""}=e,{conversationId:u=null}=e;const i=Ql();let d="",p=[],m=!1,_=null,g=null,w=null,h=[],k=-1,$;function y(){w&&clearTimeout(w),w=setTimeout(()=>{d.trim().length>=2?O():(t(3,p=[]),t(6,g=null))},300)}async function b(A){const P=A.trim();if(!P)return[];try{if(o){const G=await Ue("get_autocomplete_suggestions",{query:P,roleName:n,limit:8});if((G==null?void 0:G.status)==="success"&&Array.isArray(G.suggestions))return G.suggestions.map(oe=>oe.term)}else{const G=await fetch(`${Ve.ServerURL}/autocomplete/${encodeURIComponent(n)}/${encodeURIComponent(P)}`);if(G.ok){const oe=await G.json();if((oe==null?void 0:oe.status)==="success"&&Array.isArray(oe.suggestions))return oe.suggestions.map(X=>X.term)}}}catch(G){console.warn("KG typeahead failed",G)}return[]}async function C(){if(d.trim().length<1){t(7,h=[]),t(8,k=-1);return}t(7,h=await b(d)),t(8,k=-1)}async function K(A){t(6,g={term:A,score:1}),t(7,h=[]),t(8,k=-1),await F()}function N(A){h.length>0&&(A.key==="ArrowDown"?(A.preventDefault(),t(8,k=(k+1)%h.length)):A.key==="ArrowUp"?(A.preventDefault(),t(8,k=(k-1+h.length)%h.length)):(A.key==="Enter"||A.key==="Tab")&&k!==-1?(A.preventDefault(),K(h[k])):A.key==="Escape"&&(t(7,h=[]),t(8,k=-1)))}async function O(){if(!d.trim()||d.trim().length<2){t(3,p=[]);return}t(4,m=!0),t(5,_=null);try{if(o){const A=await Ue("search_kg_terms",{request:{query:d.trim(),role_name:n,limit:20,min_similarity:.6}});A.status==="success"?(t(3,p=A.suggestions||[]),p.length>0&&!g&&t(6,g=p[0])):(t(5,_=A.error||"Search failed"),t(3,p=[]))}else{if(!u){t(5,_="No active conversation. Please start a conversation first."),t(3,p=[]);return}const A=await fetch(`${Ve.ServerURL}/conversations/${u}/context/kg/search?query=${encodeURIComponent(d.trim())}&role=${encodeURIComponent(n)}`);if(A.ok){const P=await A.json();P.status==="success"?(t(3,p=P.suggestions||[]),p.length>0&&!g&&t(6,g=p[0])):(t(5,_=P.error||"Search failed"),t(3,p=[]))}else t(5,_=`HTTP ${A.status}: ${A.statusText}`),t(3,p=[])}}catch(A){console.error("KG search error:",A),t(5,_=`Search failed: ${A}`),t(3,p=[])}finally{t(4,m=!1)}}function R(A){t(6,g=A)}async function F(){if(g){if(!u){t(5,_="No active conversation. Please start a conversation first.");return}try{if(o)await Ue("add_kg_term_context",{request:{conversation_id:u,term:g.term,role_name:n}}),i("termAdded",{term:g.term,suggestion:g}),Q();else{const A=await fetch(`${Ve.ServerURL}/conversations/${u}/context/kg/term`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({term:g.term,role:n})});if(A.ok){const P=await A.json();P.status==="success"?(i("termAdded",{term:g.term,suggestion:g}),Q()):t(5,_=P.error||"Failed to add term to context")}else t(5,_=`HTTP ${A.status}: ${A.statusText}`)}}catch(A){console.error("Error adding term to context:",A),t(5,_=`Failed to add term to context: ${A}`)}}}async function x(){if(!u){t(5,_="No active conversation. Please start a conversation first.");return}try{if(o)await Ue("add_kg_index_context",{request:{conversation_id:u,role_name:n}}),i("kgIndexAdded",{role:n}),Q();else{const A=await fetch(`${Ve.ServerURL}/conversations/${u}/context/kg/index`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({role:n})});if(A.ok){const P=await A.json();P.status==="success"?(i("kgIndexAdded",{role:n}),Q()):t(5,_=P.error||"Failed to add KG index to context")}else t(5,_=`HTTP ${A.status}: ${A.statusText}`)}}catch(A){console.error("Error adding KG index to context:",A),t(5,_=`Failed to add KG index to context: ${A}`)}}function Q(){t(0,a=!1),t(1,d=""),t(3,p=[]),t(6,g=null),t(5,_=null),t(4,m=!1),w&&(clearTimeout(w),w=null)}function E(A){switch(A.key){case"Escape":Q();break;case"ArrowDown":A.preventDefault(),L(1);break;case"ArrowUp":A.preventDefault(),L(-1);break;case"Enter":A.preventDefault(),g&&F();break}}function L(A){if(p.length===0)return;let G=(g?p.findIndex(oe=>oe.term===(g==null?void 0:g.term)):-1)+A;G<0?G=p.length-1:G>=p.length&&(G=0),t(6,g=p[G])}Wl(()=>{w&&clearTimeout(w)});function se(A){$=A,t(2,$)}function J(A){d=A,t(1,d),t(0,a),t(19,s)}const ie=()=>{y(),C()},ee=A=>K(A),z=(A,P)=>{(P.key==="Enter"||P.key===" ")&&(P.preventDefault(),K(A))},Z=A=>R(A),I=(A,P)=>P.key==="Enter"&&R(A);function j(A){a=A,t(0,a)}return l.$$set=A=>{"active"in A&&t(0,a=A.active),"initialQuery"in A&&t(19,s=A.initialQuery),"conversationId"in A&&t(20,u=A.conversationId)},l.$$.update=()=>{l.$$.dirty[0]&524291&&a&&s!==d&&(t(1,d=s),d.trim()&&O()),l.$$.dirty[0]&5&&a&&$&&setTimeout(()=>{$==null||$.focus(),t(5,_=null)},100)},[a,d,$,p,m,_,g,h,k,n,y,C,K,N,R,F,x,Q,E,s,u,se,J,ie,ee,z,Z,I,j]}class rc extends _t{constructor(e){super(),gt(this,e,sc,oc,pt,{active:0,initialQuery:19,conversationId:20},null,[-1,-1])}}function ic(l){const e=l.slice(),t=e[0].kg_index_info;return e[9]=t,e}function ac(l){const e=l.slice(),t=e[0].kg_term_definition;return e[8]=t,e}function cc(l){let e=l[0].context_type==="KGTermDefinition"?"KG Term":"KG Index",t;return{c(){t=U(e)},m(n,o){S(n,t,o)},p(n,o){o&1&&e!==(e=n[0].context_type==="KGTermDefinition"?"KG Term":"KG Index")&&be(t,e)},d(n){n&&T(t)}}}function uc(l){let e,t;return e=new Qt({props:{icon:"fas fa-eye",size:"is-small"}}),{c(){ge(e.$$.fragment)},m(n,o){he(e,n,o),t=!0},p:Re,i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function ks(l){let e,t;return e=new Kt({props:{size:"is-small",type:"is-ghost",title:"Remove from context",$$slots:{default:[fc]},$$scope:{ctx:l}}}),e.$on("click",l[5]),{c(){ge(e.$$.fragment)},m(n,o){he(e,n,o),t=!0},p(n,o){const a={};o&1024&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function fc(l){let e,t;return e=new Qt({props:{icon:"fas fa-times",size:"is-small"}}),{c(){ge(e.$$.fragment)},m(n,o){he(e,n,o),t=!0},p:Re,i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function dc(l){let e,t,n,o=dl(l[9].total_terms)+"",a,s,u,i,d,p,m,_=dl(l[9].total_nodes)+"",g,w,h,k,$,y,b,C=dl(l[9].total_edges)+"",K,N,O,R,F,x,Q,E=(l[9].version||"N/A")+"",L,se,J,ie,ee,z,Z,I=!l[2]&&ws();return{c(){e=f("div"),t=f("div"),n=f("div"),a=U(o),u=v(),i=f("div"),i.textContent="Terms",d=v(),p=f("div"),m=f("div"),g=U(_),h=v(),k=f("div"),k.textContent="Nodes",$=v(),y=f("div"),b=f("div"),K=U(C),O=v(),R=f("div"),R.textContent="Edges",F=v(),x=f("div"),Q=f("div"),L=U(E),J=v(),ie=f("div"),ie.textContent="Version",z=v(),I&&I.c(),Z=ut(),c(n,"class",s="stat-value "+(l[2]?"compact":"")+" svelte-lkmjyw"),c(i,"class","stat-label svelte-lkmjyw"),c(t,"class","stat-item svelte-lkmjyw"),c(m,"class",w="stat-value "+(l[2]?"compact":"")+" svelte-lkmjyw"),c(k,"class","stat-label svelte-lkmjyw"),c(p,"class","stat-item svelte-lkmjyw"),c(b,"class",N="stat-value "+(l[2]?"compact":"")+" svelte-lkmjyw"),c(R,"class","stat-label svelte-lkmjyw"),c(y,"class","stat-item svelte-lkmjyw"),c(Q,"class",se="stat-value "+(l[2]?"compact":"")+" svelte-lkmjyw"),c(ie,"class","stat-label svelte-lkmjyw"),c(x,"class","stat-item svelte-lkmjyw"),c(e,"class",ee="kg-index-stats "+(l[2]?"compact":"")+" svelte-lkmjyw")},m(j,A){S(j,e,A),r(e,t),r(t,n),r(n,a),r(t,u),r(t,i),r(e,d),r(e,p),r(p,m),r(m,g),r(p,h),r(p,k),r(e,$),r(e,y),r(y,b),r(b,K),r(y,O),r(y,R),r(e,F),r(e,x),r(x,Q),r(Q,L),r(x,J),r(x,ie),S(j,z,A),I&&I.m(j,A),S(j,Z,A)},p(j,A){A&1&&o!==(o=dl(j[9].total_terms)+"")&&be(a,o),A&4&&s!==(s="stat-value "+(j[2]?"compact":"")+" svelte-lkmjyw")&&c(n,"class",s),A&1&&_!==(_=dl(j[9].total_nodes)+"")&&be(g,_),A&4&&w!==(w="stat-value "+(j[2]?"compact":"")+" svelte-lkmjyw")&&c(m,"class",w),A&1&&C!==(C=dl(j[9].total_edges)+"")&&be(K,C),A&4&&N!==(N="stat-value "+(j[2]?"compact":"")+" svelte-lkmjyw")&&c(b,"class",N),A&1&&E!==(E=(j[9].version||"N/A")+"")&&be(L,E),A&4&&se!==(se="stat-value "+(j[2]?"compact":"")+" svelte-lkmjyw")&&c(Q,"class",se),A&4&&ee!==(ee="kg-index-stats "+(j[2]?"compact":"")+" svelte-lkmjyw")&&c(e,"class",ee),j[2]?I&&(I.d(1),I=null):I||(I=ws(),I.c(),I.m(Z.parentNode,Z))},i:Re,o:Re,d(j){j&&T(e),j&&T(z),I&&I.d(j),j&&T(Z)}}}function pc(l){let e,t,n,o,a,s,u,i,d,p=l[8].definition&&ys(l),m=l[8].synonyms.length>0&&$s(l),_=l[8].related_terms.length>0&&Cs(l),g=l[8].usage_examples.length>0&&Ts(l),w=l[8].url&&Ss(l);return{c(){e=f("div"),p&&p.c(),t=v(),n=f("div"),m&&m.c(),o=v(),_&&_.c(),a=v(),g&&g.c(),s=v(),w&&w.c(),c(n,"class",u="term-metadata "+(l[2]?"compact":"")+" svelte-lkmjyw"),c(e,"class",i="term-definition "+(l[2]?"compact":"")+" svelte-lkmjyw")},m(h,k){S(h,e,k),p&&p.m(e,null),r(e,t),r(e,n),m&&m.m(n,null),r(n,o),_&&_.m(n,null),r(n,a),g&&g.m(n,null),r(n,s),w&&w.m(n,null),d=!0},p(h,k){h[8].definition?p?p.p(h,k):(p=ys(h),p.c(),p.m(e,t)):p&&(p.d(1),p=null),h[8].synonyms.length>0?m?(m.p(h,k),k&1&&M(m,1)):(m=$s(h),m.c(),M(m,1),m.m(n,o)):m&&(Fe(),V(m,1,1,()=>{m=null}),Ke()),h[8].related_terms.length>0?_?(_.p(h,k),k&1&&M(_,1)):(_=Cs(h),_.c(),M(_,1),_.m(n,a)):_&&(Fe(),V(_,1,1,()=>{_=null}),Ke()),h[8].usage_examples.length>0?g?(g.p(h,k),k&1&&M(g,1)):(g=Ts(h),g.c(),M(g,1),g.m(n,s)):g&&(Fe(),V(g,1,1,()=>{g=null}),Ke()),h[8].url?w?k&1&&M(w,1):(w=Ss(h),w.c(),M(w,1),w.m(n,null)):w&&(Fe(),V(w,1,1,()=>{w=null}),Ke()),(!d||k&4&&u!==(u="term-metadata "+(h[2]?"compact":"")+" svelte-lkmjyw"))&&c(n,"class",u),(!d||k&4&&i!==(i="term-definition "+(h[2]?"compact":"")+" svelte-lkmjyw"))&&c(e,"class",i)},i(h){d||(M(m),M(_),M(g),M(w),d=!0)},o(h){V(m),V(_),V(g),V(w),d=!1},d(h){h&&T(e),p&&p.d(),m&&m.d(),_&&_.d(),g&&g.d(),w&&w.d()}}}function ws(l){let e;return{c(){e=f("div"),e.innerHTML='<p class="is-size-7"><strong>Thesaurus Data:</strong> This context item contains the complete thesaurus as JSON, providing all domain-specific vocabulary and term mappings for comprehensive AI understanding.</p>',c(e,"class","notification is-success is-light mt-3")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function ys(l){let e,t=l[8].definition+"",n,o;return{c(){e=f("div"),n=U(t),c(e,"class",o="definition-text "+(l[2]?"compact":"")+" svelte-lkmjyw")},m(a,s){S(a,e,s),r(e,n)},p(a,s){s&1&&t!==(t=a[8].definition+"")&&be(n,t),s&4&&o!==(o="definition-text "+(a[2]?"compact":"")+" svelte-lkmjyw")&&c(e,"class",o)},d(a){a&&T(e)}}}function $s(l){let e,t;return e=new Gt({props:{type:"is-light",size:"is-small",title:"Synonyms",$$slots:{default:[mc]},$$scope:{ctx:l}}}),{c(){ge(e.$$.fragment)},m(n,o){he(e,n,o),t=!0},p(n,o){const a={};o&1025&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function mc(l){let e,t,n,o=l[8].synonyms.length+"",a,s,u=l[8].synonyms.length!==1?"s":"",i,d;return e=new Qt({props:{icon:"fas fa-equals",size:"is-small"}}),{c(){ge(e.$$.fragment),t=v(),n=f("span"),a=U(o),s=U(" synonym"),i=U(u)},m(p,m){he(e,p,m),S(p,t,m),S(p,n,m),r(n,a),r(n,s),r(n,i),d=!0},p(p,m){(!d||m&1)&&o!==(o=p[8].synonyms.length+"")&&be(a,o),(!d||m&1)&&u!==(u=p[8].synonyms.length!==1?"s":"")&&be(i,u)},i(p){d||(M(e.$$.fragment,p),d=!0)},o(p){V(e.$$.fragment,p),d=!1},d(p){ve(e,p),p&&T(t),p&&T(n)}}}function Cs(l){let e,t;return e=new Gt({props:{type:"is-light",size:"is-small",title:"Related Terms",$$slots:{default:[_c]},$$scope:{ctx:l}}}),{c(){ge(e.$$.fragment)},m(n,o){he(e,n,o),t=!0},p(n,o){const a={};o&1025&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function _c(l){let e,t,n,o=l[8].related_terms.length+"",a,s,u;return e=new Qt({props:{icon:"fas fa-link",size:"is-small"}}),{c(){ge(e.$$.fragment),t=v(),n=f("span"),a=U(o),s=U(" related")},m(i,d){he(e,i,d),S(i,t,d),S(i,n,d),r(n,a),r(n,s),u=!0},p(i,d){(!u||d&1)&&o!==(o=i[8].related_terms.length+"")&&be(a,o)},i(i){u||(M(e.$$.fragment,i),u=!0)},o(i){V(e.$$.fragment,i),u=!1},d(i){ve(e,i),i&&T(t),i&&T(n)}}}function Ts(l){let e,t;return e=new Gt({props:{type:"is-light",size:"is-small",title:"Usage Examples",$$slots:{default:[gc]},$$scope:{ctx:l}}}),{c(){ge(e.$$.fragment)},m(n,o){he(e,n,o),t=!0},p(n,o){const a={};o&1025&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function gc(l){let e,t,n,o=l[8].usage_examples.length+"",a,s,u=l[8].usage_examples.length!==1?"s":"",i,d;return e=new Qt({props:{icon:"fas fa-quote-left",size:"is-small"}}),{c(){ge(e.$$.fragment),t=v(),n=f("span"),a=U(o),s=U(" example"),i=U(u)},m(p,m){he(e,p,m),S(p,t,m),S(p,n,m),r(n,a),r(n,s),r(n,i),d=!0},p(p,m){(!d||m&1)&&o!==(o=p[8].usage_examples.length+"")&&be(a,o),(!d||m&1)&&u!==(u=p[8].usage_examples.length!==1?"s":"")&&be(i,u)},i(p){d||(M(e.$$.fragment,p),d=!0)},o(p){V(e.$$.fragment,p),d=!1},d(p){ve(e,p),p&&T(t),p&&T(n)}}}function Ss(l){let e,t;return e=new Gt({props:{type:"is-link",size:"is-small",$$slots:{default:[hc]},$$scope:{ctx:l}}}),{c(){ge(e.$$.fragment)},m(n,o){he(e,n,o),t=!0},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function hc(l){let e,t,n,o;return e=new Qt({props:{icon:"fas fa-external-link-alt",size:"is-small"}}),{c(){ge(e.$$.fragment),t=v(),n=f("span"),n.textContent="Source"},m(a,s){he(e,a,s),S(a,t,s),S(a,n,s),o=!0},p:Re,i(a){o||(M(e.$$.fragment,a),o=!0)},o(a){V(e.$$.fragment,a),o=!1},d(a){ve(e,a),a&&T(t),a&&T(n)}}}function Rs(l){let e,t=l[0].summary+"",n;return{c(){e=f("div"),n=U(t),c(e,"class","context-summary svelte-lkmjyw")},m(o,a){S(o,e,a),r(e,n)},p(o,a){a&1&&t!==(t=o[0].summary+"")&&be(n,t)},d(o){o&&T(e)}}}function As(l){let e,t,n=(l[0].relevance_score*100).toFixed(0)+"",o,a;return{c(){e=f("span"),t=U("Relevance: "),o=U(n),a=U("%"),c(e,"class","relevance-score svelte-lkmjyw")},m(s,u){S(s,e,u),r(e,t),r(e,o),r(e,a)},p(s,u){u&1&&n!==(n=(s[0].relevance_score*100).toFixed(0)+"")&&be(o,n)},d(s){s&&T(e)}}}function Es(l){let e,t,n,o=(l[0].metadata.document_title||l[0].metadata.source_document)+"",a,s;return t=new Qt({props:{icon:"fas fa-file-alt",size:"is-small"}}),{c(){e=f("span"),ge(t.$$.fragment),n=v(),a=U(o),c(e,"title","Source Document")},m(u,i){S(u,e,i),he(t,e,null),r(e,n),r(e,a),s=!0},p(u,i){(!s||i&1)&&o!==(o=(u[0].metadata.document_title||u[0].metadata.source_document)+"")&&be(a,o)},i(u){s||(M(t.$$.fragment,u),s=!0)},o(u){V(t.$$.fragment,u),s=!1},d(u){u&&T(e),ve(t)}}}function vc(l){let e,t,n,o,a,s,u=l[0].title+"",i,d,p,m,_,g,w,h,k,$,y,b,C,K,N,O,R,F,x,Q=Ls(l[0].created_at)+"",E,L,se,J,ie,ee;o=new Qt({props:{icon:l[4],size:"is-small"}}),m=new Gt({props:{type:l[3],size:"is-small",$$slots:{default:[cc]},$$scope:{ctx:l}}}),w=new Kt({props:{size:"is-small",type:"is-ghost",title:"View details",$$slots:{default:[uc]},$$scope:{ctx:l}}}),w.$on("click",l[6]);let z=l[1]&&ks(l);const Z=[pc,dc],I=[];function j(X,re){return X[0].context_type==="KGTermDefinition"&&X[0].kg_term_definition?0:X[0].context_type==="KGIndex"&&X[0].kg_index_info?1:-1}function A(X,re){if(re===0)return ac(X);if(re===1)return ic(X)}~(b=j(l))&&(C=I[b]=Z[b](A(l,b)));let P=l[0].summary&&!l[2]&&Rs(l),G=l[0].relevance_score&&As(l),oe=l[0].metadata.source_document&&Es(l);return{c(){e=f("div"),t=f("div"),n=f("div"),ge(o.$$.fragment),a=v(),s=f("span"),i=U(u),p=v(),ge(m.$$.fragment),_=v(),g=f("div"),ge(w.$$.fragment),h=v(),z&&z.c(),$=v(),y=f("div"),C&&C.c(),K=v(),P&&P.c(),O=v(),R=f("div"),F=f("span"),x=U("Added "),E=U(Q),L=v(),G&&G.c(),se=v(),oe&&oe.c(),c(s,"class",d="context-title-text "+(l[2]?"compact":"")+" svelte-lkmjyw"),c(n,"class","context-title svelte-lkmjyw"),c(g,"class","context-actions svelte-lkmjyw"),c(t,"class",k="context-header "+(l[2]?"compact":"")+" svelte-lkmjyw"),c(y,"class",N="context-content "+(l[2]?"compact":"")+" svelte-lkmjyw"),c(R,"class",J="context-meta "+(l[2]?"compact":"")+" svelte-lkmjyw"),c(e,"class",ie="kg-context-item "+(l[2]?"compact":"")+" svelte-lkmjyw")},m(X,re){S(X,e,re),r(e,t),r(t,n),he(o,n,null),r(n,a),r(n,s),r(s,i),r(n,p),he(m,n,null),r(t,_),r(t,g),he(w,g,null),r(g,h),z&&z.m(g,null),r(e,$),r(e,y),~b&&I[b].m(y,null),r(y,K),P&&P.m(y,null),r(e,O),r(e,R),r(R,F),r(F,x),r(F,E),r(R,L),G&&G.m(R,null),r(R,se),oe&&oe.m(R,null),ee=!0},p(X,[re]){const D={};re&16&&(D.icon=X[4]),o.$set(D),(!ee||re&1)&&u!==(u=X[0].title+"")&&be(i,u),(!ee||re&4&&d!==(d="context-title-text "+(X[2]?"compact":"")+" svelte-lkmjyw"))&&c(s,"class",d);const W={};re&8&&(W.type=X[3]),re&1025&&(W.$$scope={dirty:re,ctx:X}),m.$set(W);const le={};re&1024&&(le.$$scope={dirty:re,ctx:X}),w.$set(le),X[1]?z?(z.p(X,re),re&2&&M(z,1)):(z=ks(X),z.c(),M(z,1),z.m(g,null)):z&&(Fe(),V(z,1,1,()=>{z=null}),Ke()),(!ee||re&4&&k!==(k="context-header "+(X[2]?"compact":"")+" svelte-lkmjyw"))&&c(t,"class",k);let ne=b;b=j(X),b===ne?~b&&I[b].p(A(X,b),re):(C&&(Fe(),V(I[ne],1,1,()=>{I[ne]=null}),Ke()),~b?(C=I[b],C?C.p(A(X,b),re):(C=I[b]=Z[b](A(X,b)),C.c()),M(C,1),C.m(y,K)):C=null),X[0].summary&&!X[2]?P?P.p(X,re):(P=Rs(X),P.c(),P.m(y,null)):P&&(P.d(1),P=null),(!ee||re&4&&N!==(N="context-content "+(X[2]?"compact":"")+" svelte-lkmjyw"))&&c(y,"class",N),(!ee||re&1)&&Q!==(Q=Ls(X[0].created_at)+"")&&be(E,Q),X[0].relevance_score?G?G.p(X,re):(G=As(X),G.c(),G.m(R,se)):G&&(G.d(1),G=null),X[0].metadata.source_document?oe?(oe.p(X,re),re&1&&M(oe,1)):(oe=Es(X),oe.c(),M(oe,1),oe.m(R,null)):oe&&(Fe(),V(oe,1,1,()=>{oe=null}),Ke()),(!ee||re&4&&J!==(J="context-meta "+(X[2]?"compact":"")+" svelte-lkmjyw"))&&c(R,"class",J),(!ee||re&4&&ie!==(ie="kg-context-item "+(X[2]?"compact":"")+" svelte-lkmjyw"))&&c(e,"class",ie)},i(X){ee||(M(o.$$.fragment,X),M(m.$$.fragment,X),M(w.$$.fragment,X),M(z),M(C),M(oe),ee=!0)},o(X){V(o.$$.fragment,X),V(m.$$.fragment,X),V(w.$$.fragment,X),V(z),V(C),V(oe),ee=!1},d(X){X&&T(e),ve(o),ve(m),ve(w),z&&z.d(),~b&&I[b].d(),P&&P.d(),G&&G.d(),oe&&oe.d()}}}function dl(l){return new Intl.NumberFormat().format(l)}function Ls(l){try{return new Date(l).toLocaleDateString()}catch{return l}}function bc(l,e,t){let n,o,{contextItem:a}=e,{removable:s=!0}=e,{compact:u=!1}=e;const i=Ql();function d(){i("remove",{contextId:a.id})}function p(){i("viewDetails",{contextItem:a})}return l.$$set=m=>{"contextItem"in m&&t(0,a=m.contextItem),"removable"in m&&t(1,s=m.removable),"compact"in m&&t(2,u=m.compact)},l.$$.update=()=>{l.$$.dirty&1&&t(4,n=a.context_type==="KGTermDefinition"?"fas fa-tag":"fas fa-sitemap"),l.$$.dirty&1&&t(3,o=a.context_type==="KGTermDefinition"?"is-info":"is-primary")},[a,s,u,o,n,d,p]}class kc extends _t{constructor(e){super(),gt(this,e,bc,vc,pt,{contextItem:0,removable:1,compact:2})}}function Is(l,e,t){const n=l.slice();return n[47]=e[t],n[49]=t,n}function Ds(l,e,t){const n=l.slice();return n[50]=e[t],n[52]=t,n}function Ns(l){let e,t,n;return{c(){e=f("p"),t=U("Conversation ID: "),n=U(l[5]),c(e,"class","is-size-7 has-text-grey")},m(o,a){S(o,e,a),r(e,t),r(e,n)},p(o,a){a[0]&32&&be(n,o[5])},d(o){o&&T(e)}}}function Os(l){let e,t,n,o=l[50].content+"",a,s;return{c(){e=f("div"),t=f("div"),n=f("pre"),a=U(o),c(n,"class","svelte-rbq0zi"),c(t,"class","bubble svelte-rbq0zi"),c(e,"class",s=Pt(`msg ${l[50].role}`)+" svelte-rbq0zi")},m(u,i){S(u,e,i),r(e,t),r(t,n),r(n,a)},p(u,i){i[0]&1&&o!==(o=u[50].content+"")&&be(a,o),i[0]&1&&s!==(s=Pt(`msg ${u[50].role}`)+" svelte-rbq0zi")&&c(e,"class",s)},d(u){u&&T(e)}}}function Ps(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="bubble loading svelte-rbq0zi"><span class="icon is-small"><i class="fas fa-spinner fa-spin"></i></span> 
            <span>Thinking...</span></div>`,c(e,"class","msg assistant svelte-rbq0zi")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function Us(l){let e,t,n;return{c(){e=f("p"),t=U("Model: "),n=U(l[4]),c(e,"class","is-size-7 has-text-grey")},m(o,a){S(o,e,a),r(e,t),r(e,n)},p(o,a){a[0]&16&&be(n,o[4])},d(o){o&&T(e)}}}function Ms(l){let e,t;return{c(){e=f("p"),t=U(l[3]),c(e,"class","has-text-danger is-size-7")},m(n,o){S(n,e,o),r(e,t)},p(n,o){o[0]&8&&be(t,n[3])},d(n){n&&T(e)}}}function wc(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-refresh"></i>',c(e,"class","icon is-small")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function yc(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-spinner fa-spin"></i>',c(e,"class","icon is-small")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function js(l){let e,t,n,o,a,s,u,i,d,p,m,_,g,w,h,k,$,y,b,C,K,N,O,R,F,x,Q,E,L,se,J,ie,ee,z,Z,I,j,A;function P(X,re){return X[12]?Cc:$c}let G=P(l),oe=G(l);return{c(){e=f("div"),t=f("div"),n=f("label"),n.textContent="Context Type",o=v(),a=f("div"),s=f("div"),u=f("select"),i=f("option"),i.textContent="Document",d=f("option"),d.textContent="Search Result",p=f("option"),p.textContent="User Input",m=f("option"),m.textContent="Note",_=v(),g=f("div"),w=f("label"),w.textContent="Title",h=v(),k=f("div"),$=f("input"),y=v(),b=f("div"),C=f("label"),C.textContent="Content",K=v(),N=f("div"),O=f("textarea"),R=v(),F=f("div"),x=f("div"),Q=f("button"),oe.c(),E=v(),L=f("span"),L.textContent="Save Context",J=v(),ie=f("div"),ee=f("button"),z=f("span"),z.innerHTML='<i class="fas fa-times"></i>',Z=v(),I=f("span"),I.textContent="Cancel",c(n,"class","label is-small"),i.__value="document",i.value=i.__value,d.__value="search_result",d.value=d.__value,p.__value="user_input",p.value=p.__value,m.__value="note",m.value=m.__value,c(u,"data-testid","context-type-select"),l[11]===void 0&&mt(()=>l[30].call(u)),c(s,"class","select is-small is-fullwidth"),c(a,"class","control"),c(t,"class","field"),c(w,"class","label is-small"),c($,"class","input is-small"),c($,"type","text"),c($,"placeholder","Enter context title"),c($,"data-testid","context-title-input"),c(k,"class","control"),c(g,"class","field"),c(C,"class","label is-small"),c(O,"class","textarea is-small"),c(O,"rows","4"),c(O,"placeholder","Enter context content"),c(O,"data-testid","context-content-textarea"),c(N,"class","control"),c(b,"class","field"),c(Q,"class","button is-primary is-small"),Q.disabled=se=l[12]||!l[9].trim()||!l[10].trim(),c(Q,"data-testid","add-context-submit-button"),c(x,"class","control"),c(z,"class","icon is-small"),c(ee,"class","button is-light is-small"),ee.disabled=l[12],c(ie,"class","control"),c(F,"class","field is-grouped"),c(e,"class","box has-background-light mb-4"),c(e,"data-testid","add-context-form")},m(X,re){S(X,e,re),r(e,t),r(t,n),r(t,o),r(t,a),r(a,s),r(s,u),r(u,i),r(u,d),r(u,p),r(u,m),Je(u,l[11],!0),r(e,_),r(e,g),r(g,w),r(g,h),r(g,k),r(k,$),De($,l[9]),r(e,y),r(e,b),r(b,C),r(b,K),r(b,N),r(N,O),De(O,l[10]),r(e,R),r(e,F),r(F,x),r(x,Q),oe.m(Q,null),r(Q,E),r(Q,L),r(F,J),r(F,ie),r(ie,ee),r(ee,z),r(ee,Z),r(ee,I),j||(A=[ae(u,"change",l[30]),ae($,"input",l[31]),ae(O,"input",l[32]),ae(Q,"click",l[19]),ae(ee,"click",l[18])],j=!0)},p(X,re){re[0]&2048&&Je(u,X[11]),re[0]&512&&$.value!==X[9]&&De($,X[9]),re[0]&1024&&De(O,X[10]),G!==(G=P(X))&&(oe.d(1),oe=G(X),oe&&(oe.c(),oe.m(Q,E))),re[0]&5632&&se!==(se=X[12]||!X[9].trim()||!X[10].trim())&&(Q.disabled=se),re[0]&4096&&(ee.disabled=X[12])},d(X){X&&T(e),oe.d(),j=!1,Ze(A)}}}function $c(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-save"></i>',c(e,"class","icon is-small")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function Cc(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-spinner fa-spin"></i>',c(e,"class","icon is-small")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function Tc(l){let e,t,n=l[6],o=[];for(let s=0;s<n.length;s+=1)o[s]=Fs(Is(l,n,s));const a=s=>V(o[s],1,1,()=>{o[s]=null});return{c(){e=f("div");for(let s=0;s<o.length;s+=1)o[s].c();c(e,"class","context-items svelte-rbq0zi"),c(e,"data-testid","conversation-context")},m(s,u){S(s,e,u);for(let i=0;i<o.length;i+=1)o[i]&&o[i].m(e,null);t=!0},p(s,u){if(u[0]&7340096){n=s[6];let i;for(i=0;i<n.length;i+=1){const d=Is(s,n,i);o[i]?(o[i].p(d,u),M(o[i],1)):(o[i]=Fs(d),o[i].c(),M(o[i],1),o[i].m(e,null))}for(Fe(),i=n.length;i<o.length;i+=1)a(i);Ke()}},i(s){if(!t){for(let u=0;u<n.length;u+=1)M(o[u]);t=!0}},o(s){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)V(o[u]);t=!1},d(s){s&&T(e),tt(o,s)}}}function Sc(l){let e;return{c(){e=f("div"),e.innerHTML=`<span class="icon is-large"><i class="fas fa-inbox fa-2x"></i></span> 
              <p class="is-size-6">No context items yet</p> 
              <p class="is-size-7">Add documents from search results to provide context for your chat.</p>`,c(e,"class","has-text-centered has-text-grey-light"),c(e,"data-testid","empty-context-message")},m(t,n){S(t,e,n)},p:Re,i:Re,o:Re,d(t){t&&T(e)}}}function Rc(l){let e,t,n,o,a,s=l[47].context_type.replace(/([A-Z])/g," $1").trim()+"",u,i,d,p,m,_,g,w,h,k,$,y,b,C,K,N=l[47].title+"",O,R,F,x,Q,E,L=new Date(l[47].created_at).toLocaleString()+"",se,J,ie,ee,z,Z=l[47].relevance_score&&zs(l);function I(){return l[35](l[47])}function j(){return l[36](l[47])}function A(oe,X){return oe[47].summary?Lc:Ec}let P=A(l),G=P(l);return{c(){e=f("div"),t=f("div"),n=f("div"),o=f("div"),a=f("span"),u=U(s),d=v(),p=f("div"),m=f("div"),Z&&Z.c(),_=v(),g=f("div"),w=f("div"),h=f("div"),k=f("button"),k.innerHTML='<span class="icon is-small"><i class="fas fa-edit"></i></span>',$=v(),y=f("div"),b=f("button"),b.innerHTML='<span class="icon is-small"><i class="fas fa-trash"></i></span>',C=v(),K=f("h6"),O=U(N),R=v(),F=f("div"),G.c(),x=v(),Q=f("div"),E=U("Added: "),se=U(L),c(a,"class",i="tag is-small "+(l[47].context_type==="Document"?"is-info":l[47].context_type==="SearchResult"?"is-primary":l[47].context_type==="UserInput"?"is-warning":"is-light")),c(a,"data-testid",`context-type-${l[49]}`),c(o,"class","level-item"),c(n,"class","level-left"),c(m,"class","level-item"),c(k,"class","button is-small is-light"),c(k,"data-testid",`edit-context-${l[49]}`),c(k,"title","Edit context"),c(h,"class","control"),c(b,"class","button is-small is-light is-danger"),c(b,"data-testid",`delete-context-${l[49]}`),c(b,"title","Delete context"),c(y,"class","control"),c(w,"class","field is-grouped"),c(g,"class","level-item context-actions svelte-rbq0zi"),c(p,"class","level-right"),c(t,"class","level is-mobile"),c(K,"class","title is-6 has-text-dark"),c(K,"data-testid",`context-title-${l[49]}`),c(F,"class","content is-small"),c(Q,"class","is-size-7 has-text-grey"),c(e,"class","context-item svelte-rbq0zi"),c(e,"data-context-id",J=l[47].id),c(e,"data-testid",`context-item-${l[49]}`),c(e,"data-context-type",ie=l[47].context_type)},m(oe,X){S(oe,e,X),r(e,t),r(t,n),r(n,o),r(o,a),r(a,u),r(t,d),r(t,p),r(p,m),Z&&Z.m(m,null),r(p,_),r(p,g),r(g,w),r(w,h),r(h,k),r(w,$),r(w,y),r(y,b),r(e,C),r(e,K),r(K,O),r(e,R),r(e,F),G.m(F,null),r(e,x),r(e,Q),r(Q,E),r(Q,se),ee||(z=[ae(k,"click",I),ae(b,"click",j)],ee=!0)},p(oe,X){l=oe,X[0]&64&&s!==(s=l[47].context_type.replace(/([A-Z])/g," $1").trim()+"")&&be(u,s),X[0]&64&&i!==(i="tag is-small "+(l[47].context_type==="Document"?"is-info":l[47].context_type==="SearchResult"?"is-primary":l[47].context_type==="UserInput"?"is-warning":"is-light"))&&c(a,"class",i),l[47].relevance_score?Z?Z.p(l,X):(Z=zs(l),Z.c(),Z.m(m,null)):Z&&(Z.d(1),Z=null),X[0]&64&&N!==(N=l[47].title+"")&&be(O,N),P===(P=A(l))&&G?G.p(l,X):(G.d(1),G=P(l),G&&(G.c(),G.m(F,null))),X[0]&64&&L!==(L=new Date(l[47].created_at).toLocaleString()+"")&&be(se,L),X[0]&64&&J!==(J=l[47].id)&&c(e,"data-context-id",J),X[0]&64&&ie!==(ie=l[47].context_type)&&c(e,"data-context-type",ie)},i:Re,o:Re,d(oe){oe&&T(e),Z&&Z.d(),G.d(),ee=!1,Ze(z)}}}function Ac(l){let e,t;return e=new kc({props:{contextItem:l[47],compact:!0}}),e.$on("remove",l[33]),e.$on("viewDetails",l[34]),{c(){ge(e.$$.fragment)},m(n,o){he(e,n,o),t=!0},p(n,o){const a={};o[0]&64&&(a.contextItem=n[47]),e.$set(a)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function zs(l){let e,t=l[47].relevance_score.toFixed(1)+"",n;return{c(){e=f("span"),n=U(t),c(e,"class","tag is-light is-small")},m(o,a){S(o,e,a),r(e,n)},p(o,a){a[0]&64&&t!==(t=o[47].relevance_score.toFixed(1)+"")&&be(n,t)},d(o){o&&T(e)}}}function Ec(l){let e,t=l[47].content.substring(0,150)+"",n,o=l[47].content.length>150?"...":"",a;return{c(){e=f("p"),n=U(t),a=U(o),c(e,"class","context-preview svelte-rbq0zi"),c(e,"data-testid",`context-content-${l[49]}`)},m(s,u){S(s,e,u),r(e,n),r(e,a)},p(s,u){u[0]&64&&t!==(t=s[47].content.substring(0,150)+"")&&be(n,t),u[0]&64&&o!==(o=s[47].content.length>150?"...":"")&&be(a,o)},d(s){s&&T(e)}}}function Lc(l){let e,t=l[47].summary+"",n;return{c(){e=f("p"),n=U(t),c(e,"class","context-summary svelte-rbq0zi"),c(e,"data-testid",`context-summary-${l[49]}`)},m(o,a){S(o,e,a),r(e,n)},p(o,a){a[0]&64&&t!==(t=o[47].summary+"")&&be(n,t)},d(o){o&&T(e)}}}function Hs(l){let e;return{c(){e=f("hr"),c(e,"class","context-divider svelte-rbq0zi")},m(t,n){S(t,e,n)},d(t){t&&T(e)}}}function Fs(l){let e,t,n,o,a;const s=[Ac,Rc],u=[];function i(p,m){return p[47].context_type==="KGTermDefinition"||p[47].context_type==="KGIndex"?0:1}e=i(l),t=u[e]=s[e](l);let d=l[49]<l[6].length-1&&Hs();return{c(){t.c(),n=v(),d&&d.c(),o=ut()},m(p,m){u[e].m(p,m),S(p,n,m),d&&d.m(p,m),S(p,o,m),a=!0},p(p,m){let _=e;e=i(p),e===_?u[e].p(p,m):(Fe(),V(u[_],1,1,()=>{u[_]=null}),Ke(),t=u[e],t?t.p(p,m):(t=u[e]=s[e](p),t.c()),M(t,1),t.m(n.parentNode,n)),p[49]<p[6].length-1?d||(d=Hs(),d.c(),d.m(o.parentNode,o)):d&&(d.d(1),d=null)},i(p){a||(M(t),a=!0)},o(p){V(t),a=!1},d(p){u[e].d(p),p&&T(n),d&&d.d(p),p&&T(o)}}}function Ic(l){let e,t,n,o,a,s,u,i,d,p,m,_,g,w,h,k,$,y,b,C,K,N,O,R,F,x,Q,E,L,se,J,ie,ee,z,Z,I,j,A,P,G,oe,X,re,D,W,le,ne,ce,ue,H,Y=l[6].length+"",fe,_e,ke,Te,Xe,Be,Ne,Pe,pe,Se,Me,xe,et;e=new _l({props:{fallbackPath:"/"}});let ye=l[5]&&Ns(l),ze=l[0],Ge=[];for(let me=0;me<ze.length;me+=1)Ge[me]=Os(Ds(l,ze,me));let qe=l[2]&&Ps(),Le=l[4]&&Us(l),Ie=l[3]&&Ms(l);function it(me,Ae){return me[7]?yc:wc}let Oe=it(l),We=Oe(l),q=l[8]&&js(l);const te=[Sc,Tc],B=[];function de(me,Ae){return me[6].length===0?0:1}re=de(l),D=B[re]=te[re](l);function Ce(me){l[37](me)}let $e={context:l[14],mode:l[15]};l[13]!==void 0&&($e.active=l[13]),Be=new Ja({props:$e}),lt.push(()=>st(Be,"active",Ce)),Be.$on("update",l[38]),Be.$on("delete",l[39]),Be.$on("close",l[40]);function Qe(me){l[41](me)}let nt={conversationId:l[5]};return l[16]!==void 0&&(nt.active=l[16]),pe=new rc({props:nt}),lt.push(()=>st(pe,"active",Qe)),pe.$on("termAdded",l[27]),pe.$on("kgIndexAdded",l[28]),{c(){ge(e.$$.fragment),t=v(),n=f("section"),o=f("div"),a=f("div"),s=f("div"),u=f("h2"),u.textContent="Chat",i=v(),d=f("p"),d.textContent=`Role: ${Rt(At)}`,p=v(),ye&&ye.c(),m=v(),_=f("div");for(let me=0;me<Ge.length;me+=1)Ge[me].c();g=v(),qe&&qe.c(),w=v(),Le&&Le.c(),h=v(),Ie&&Ie.c(),k=v(),$=f("div"),y=f("div"),b=f("textarea"),C=v(),K=f("div"),N=f("button"),O=f("span"),O.innerHTML='<i class="fas fa-paper-plane"></i>',F=v(),x=f("div"),Q=f("div"),E=f("div"),L=f("div"),se=f("div"),J=f("h4"),J.textContent="Context",ie=v(),ee=f("div"),z=f("button"),z.innerHTML=`<span class="icon is-small"><i class="fas fa-plus"></i></span> 
                    <span>Add</span>`,Z=v(),I=f("button"),I.innerHTML=`<span class="icon is-small"><i class="fas fa-sitemap"></i></span> 
                    <span>KG Search</span>`,j=v(),A=f("div"),P=f("div"),G=f("button"),We.c(),oe=v(),q&&q.c(),X=v(),D.c(),W=v(),le=f("div"),ne=f("div"),ce=f("div"),ue=f("div"),H=f("span"),fe=U(Y),_e=U(" context items"),ke=v(),Te=f("div"),Te.innerHTML='<div class="level-item"><span class="is-size-7 has-text-grey">Context is automatically included in your chat</span></div>',Xe=v(),ge(Be.$$.fragment),Pe=v(),ge(pe.$$.fragment),c(u,"class","title is-4"),c(d,"class","subtitle is-6"),c(_,"class","chat-window svelte-rbq0zi"),c(_,"data-testid","chat-messages"),c(b,"class","textarea"),c(b,"rows","3"),c(b,"placeholder","Type your message and press Enter..."),c(b,"data-testid","chat-input"),c(y,"class","control is-expanded"),c(O,"class","icon"),c(N,"class","button is-primary"),N.disabled=R=l[2]||!l[1].trim(),c(N,"data-testid","send-message-button"),c(K,"class","control"),c($,"class","field has-addons chat-input svelte-rbq0zi"),c(s,"class","column is-8"),c(J,"class","title is-5"),c(z,"class","button is-small is-primary"),c(z,"data-testid","show-add-context-button"),c(I,"class","button is-small is-info"),c(I,"data-testid","kg-search-button"),c(ee,"class","buttons has-addons"),c(se,"class","level-item"),c(L,"class","level-left"),c(G,"class","button is-small is-light"),G.disabled=l[7],c(G,"data-testid","refresh-context-button"),c(P,"class","level-item"),c(A,"class","level-right"),c(E,"class","level is-mobile"),c(H,"class","tag is-light is-small"),c(H,"data-testid","context-summary"),c(ue,"class","level-item"),c(ce,"class","level-left"),c(Te,"class","level-right"),c(ne,"class","level is-mobile"),c(le,"class","mt-4"),c(Q,"class","box context-panel svelte-rbq0zi"),c(Q,"data-testid","context-panel"),c(x,"class","column is-4"),c(a,"class","columns svelte-rbq0zi"),c(o,"class","container"),c(n,"class","section"),c(n,"data-testid","chat-interface")},m(me,Ae){he(e,me,Ae),S(me,t,Ae),S(me,n,Ae),r(n,o),r(o,a),r(a,s),r(s,u),r(s,i),r(s,d),r(s,p),ye&&ye.m(s,null),r(s,m),r(s,_);for(let ot=0;ot<Ge.length;ot+=1)Ge[ot]&&Ge[ot].m(_,null);r(_,g),qe&&qe.m(_,null),r(s,w),Le&&Le.m(s,null),r(s,h),Ie&&Ie.m(s,null),r(s,k),r(s,$),r($,y),r(y,b),De(b,l[1]),r($,C),r($,K),r(K,N),r(N,O),r(a,F),r(a,x),r(x,Q),r(Q,E),r(E,L),r(L,se),r(se,J),r(se,ie),r(se,ee),r(ee,z),r(ee,Z),r(ee,I),r(E,j),r(E,A),r(A,P),r(P,G),We.m(G,null),r(Q,oe),q&&q.m(Q,null),r(Q,X),B[re].m(Q,null),r(Q,W),r(Q,le),r(le,ne),r(ne,ce),r(ce,ue),r(ue,H),r(H,fe),r(H,_e),r(ne,ke),r(ne,Te),S(me,Xe,Ae),he(Be,me,Ae),S(me,Pe,Ae),he(pe,me,Ae),Me=!0,xe||(et=[ae(b,"input",l[29]),ae(b,"keydown",l[25]),ae(N,"click",l[24]),ae(z,"click",l[18]),ae(I,"click",l[26]),ae(G,"click",l[17])],xe=!0)},p(me,Ae){if(me[5]?ye?ye.p(me,Ae):(ye=Ns(me),ye.c(),ye.m(s,m)):ye&&(ye.d(1),ye=null),Ae[0]&1){ze=me[0];let at;for(at=0;at<ze.length;at+=1){const qt=Ds(me,ze,at);Ge[at]?Ge[at].p(qt,Ae):(Ge[at]=Os(qt),Ge[at].c(),Ge[at].m(_,g))}for(;at<Ge.length;at+=1)Ge[at].d(1);Ge.length=ze.length}me[2]?qe||(qe=Ps(),qe.c(),qe.m(_,null)):qe&&(qe.d(1),qe=null),me[4]?Le?Le.p(me,Ae):(Le=Us(me),Le.c(),Le.m(s,h)):Le&&(Le.d(1),Le=null),me[3]?Ie?Ie.p(me,Ae):(Ie=Ms(me),Ie.c(),Ie.m(s,k)):Ie&&(Ie.d(1),Ie=null),Ae[0]&2&&De(b,me[1]),(!Me||Ae[0]&6&&R!==(R=me[2]||!me[1].trim()))&&(N.disabled=R),Oe!==(Oe=it(me))&&(We.d(1),We=Oe(me),We&&(We.c(),We.m(G,null))),(!Me||Ae[0]&128)&&(G.disabled=me[7]),me[8]?q?q.p(me,Ae):(q=js(me),q.c(),q.m(Q,X)):q&&(q.d(1),q=null);let ot=re;re=de(me),re===ot?B[re].p(me,Ae):(Fe(),V(B[ot],1,1,()=>{B[ot]=null}),Ke(),D=B[re],D?D.p(me,Ae):(D=B[re]=te[re](me),D.c()),M(D,1),D.m(Q,W)),(!Me||Ae[0]&64)&&Y!==(Y=me[6].length+"")&&be(fe,Y);const ft={};Ae[0]&16384&&(ft.context=me[14]),Ae[0]&32768&&(ft.mode=me[15]),!Ne&&Ae[0]&8192&&(Ne=!0,ft.active=me[13],rt(()=>Ne=!1)),Be.$set(ft);const Ut={};Ae[0]&32&&(Ut.conversationId=me[5]),!Se&&Ae[0]&65536&&(Se=!0,Ut.active=me[16],rt(()=>Se=!1)),pe.$set(Ut)},i(me){Me||(M(e.$$.fragment,me),M(D),M(Be.$$.fragment,me),M(pe.$$.fragment,me),Me=!0)},o(me){V(e.$$.fragment,me),V(D),V(Be.$$.fragment,me),V(pe.$$.fragment,me),Me=!1},d(me){ve(e,me),me&&T(t),me&&T(n),ye&&ye.d(),tt(Ge,me),qe&&qe.d(),Le&&Le.d(),Ie&&Ie.d(),We.d(),q&&q.d(),B[re].d(),me&&T(Xe),ve(Be,me),me&&T(Pe),ve(pe,me),xe=!1,Ze(et)}}}function Dc(l,e,t){let n;je(l,ct,H=>t(43,n=H));let o=[],a="",s=!1,u=null,i=null,d=null,p=[],m=!1,_=!1,g="",w="",h="document",k=!1,$=!1,y=null,b="edit",C=null,K=!1;function N(H){t(0,o=[...o,{role:"user",content:H}])}async function O(){try{if(n){const H=await Ue("list_conversations");H!=null&&H.conversations&&H.conversations.length>0?(t(5,d=H.conversations[0].id),console.log("üéØ Using existing conversation:",d),await F()):await R()}else{const H=await fetch(`${Ve.ServerURL}/conversations`);if(H.ok){const Y=await H.json();Y.conversations&&Y.conversations.length>0?(t(5,d=Y.conversations[0].id),console.log("üéØ Using existing conversation:",d),await F()):await R()}else await R()}}catch(H){console.error("‚ùå Error initializing conversation:",H)}}async function R(){try{const H=Rt(At);if(n){const Y=await Ue("create_conversation",{title:"Chat Conversation",role:H});Y.status==="success"&&Y.conversation_id&&(t(5,d=Y.conversation_id),console.log("üÜï Created new conversation:",d))}else{const Y=await fetch(`${Ve.ServerURL}/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"Chat Conversation",role:H})});if(Y.ok){const fe=await Y.json();fe.status==="Success"&&fe.conversation_id&&(t(5,d=fe.conversation_id),console.log("üÜï Created new conversation:",d))}}}catch(H){console.error("‚ùå Error creating conversation:",H)}}async function F(){if(!d){console.warn("‚ö†Ô∏è Cannot load context: no conversation ID available");return}t(7,m=!0),console.log("üîÑ Loading conversation context for:",d);try{if(n){console.log("üì± Loading context via Tauri...");const H=await Ue("get_conversation",{conversationId:d});if(console.log("üì• Tauri response:",H),H.status==="success"&&H.conversation){const Y=H.conversation.global_context||[];t(6,p=Y),console.log(`‚úÖ Loaded ${Y.length} context items via Tauri`)}else console.error("‚ùå Failed to get conversation via Tauri:",H.error||"Unknown error"),t(6,p=[])}else{console.log("üåê Loading context via HTTP...");const H=await fetch(`${Ve.ServerURL}/conversations/${d}`);if(console.log("üì• HTTP response status:",H.status,H.statusText),H.ok){const Y=await H.json();if(console.log("üìÑ HTTP response data:",Y),Y.status==="success"&&Y.conversation){const fe=Y.conversation.global_context||[];t(6,p=fe),console.log(`‚úÖ Loaded ${fe.length} context items via HTTP`)}else console.error("‚ùå Failed to get conversation via HTTP:",Y.error||"Unknown error"),t(6,p=[])}else console.error("‚ùå HTTP request failed:",H.status,H.statusText),t(6,p=[])}}catch(H){console.error("‚ùå Error loading conversation context:",{error:H.message||H,conversationId:d,isTauri:n,timestamp:new Date().toISOString()}),t(6,p=[])}finally{t(7,m=!1),console.log("üèÅ Context loading completed. Items count:",p.length)}}function x(){t(8,_=!_),_||(t(9,g=""),t(10,w=""),t(11,h="document"))}async function Q(){if(!(!d||!g.trim()||!w.trim())){t(12,k=!0);try{const H={title:g.trim(),summary:null,content:w.trim(),context_type:h};if(n){const Y=await Ue("add_context_to_conversation",{conversationId:d,contextData:H});Y.status==="success"?(await F(),x(),console.log("‚úÖ Context added successfully via Tauri")):console.error("‚ùå Failed to add context via Tauri:",Y.error)}else{const Y=await fetch(`${Ve.ServerURL}/conversations/${d}/context`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(H)});if(Y.ok){const fe=await Y.json();fe.status==="success"?(await F(),x(),console.log("‚úÖ Context added successfully via HTTP")):console.error("‚ùå Failed to add context via HTTP:",fe.error)}else console.error("‚ùå HTTP request failed:",Y.status,Y.statusText)}}catch(H){console.error("‚ùå Error adding manual context:",H)}finally{t(12,k=!1)}}}function E(H){t(14,y=H),t(15,b="edit"),t(13,$=!0)}function L(H){confirm(`Are you sure you want to delete "${H.title}"?`)&&se(H.id)}async function se(H){if(!(!d||C)){C=H,console.log("üóëÔ∏è Deleting context:",H);try{if(n){const Y=await Ue("delete_context",{conversationId:d,contextId:H});(Y==null?void 0:Y.status)==="success"?(console.log("‚úÖ Context deleted successfully via Tauri"),await F()):console.error("‚ùå Failed to delete context via Tauri:",Y==null?void 0:Y.error)}else{const Y=await fetch(`${Ve.ServerURL}/conversations/${d}/context/${H}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(Y.ok){const fe=await Y.json();fe.status==="success"?(console.log("‚úÖ Context deleted successfully via HTTP"),await F()):console.error("‚ùå Failed to delete context via HTTP:",fe.error)}else console.error("‚ùå HTTP delete request failed:",Y.status)}}catch(Y){console.error("‚ùå Error deleting context:",Y)}finally{C=null}}}async function J(H){if(d){console.log("üìù Updating context:",H.id);try{const Y={context_type:H.context_type,title:H.title,summary:H.summary,content:H.content,metadata:H.metadata};if(n){const fe=await Ue("update_context",{conversationId:d,contextId:H.id,request:Y});(fe==null?void 0:fe.status)==="success"?(console.log("‚úÖ Context updated successfully via Tauri"),await F()):console.error("‚ùå Failed to update context via Tauri:",fe==null?void 0:fe.error)}else{const fe=await fetch(`${Ve.ServerURL}/conversations/${d}/context/${H.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(Y)});if(fe.ok){const _e=await fe.json();_e.status==="success"?(console.log("‚úÖ Context updated successfully via HTTP"),await F()):console.error("‚ùå Failed to update context via HTTP:",_e.error)}else console.error("‚ùå HTTP update request failed:",fe.status)}}catch(Y){console.error("‚ùå Error updating context:",Y)}}}async function ie(){var fe;if(!a.trim()||s)return;t(3,u=null);const H=Rt(At),Y=a.trim();t(1,a=""),d||await O(),N(Y),t(2,s=!0);try{const _e={role:H,messages:o};d&&(_e.conversation_id=d);let ke;if(n)ke=await Ue("chat",{request:_e});else{const Te=await fetch(`${Ve.ServerURL}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(_e)});if(!Te.ok)throw new Error(`HTTP ${Te.status}`);ke=await Te.json()}t(4,i=ke.model_used??null),((fe=ke.status)==null?void 0:fe.toLowerCase())==="success"&&ke.message?t(0,o=[...o,{role:"assistant",content:ke.message}]):t(3,u=ke.error||"Chat failed")}catch(_e){t(3,u=(_e==null?void 0:_e.message)||String(_e))}finally{t(2,s=!1)}}function ee(H){(H.key==="Enter"||H.key==="Return")&&!H.shiftKey&&(H.preventDefault(),ie())}function z(){t(16,K=!0)}function Z(H){console.log("‚úÖ KG term added to context:",H.detail.term),F()}function I(H){console.log("‚úÖ KG index added to context for role:",H.detail.role),F()}tl(()=>{if(t(0,o=[{role:"assistant",content:"Hi! How can I help you? Ask me anything about your search results or documents."}]),O(),typeof window<"u"){const H=()=>{d&&F()};return window.addEventListener("focus",H),()=>{window.removeEventListener("focus",H)}}});function j(){a=this.value,t(1,a)}function A(){h=St(this),t(11,h)}function P(){g=this.value,t(9,g)}function G(){w=this.value,t(10,w)}const oe=H=>se(H.detail.contextId),X=H=>E(H.detail.contextItem),re=H=>E(H),D=H=>L(H);function W(H){$=H,t(13,$)}const le=H=>J(H.detail),ne=H=>se(H.detail),ce=()=>{t(13,$=!1),t(14,y=null)};function ue(H){K=H,t(16,K)}return[o,a,s,u,i,d,p,m,_,g,w,h,k,$,y,b,K,F,x,Q,E,L,se,J,ie,ee,z,Z,I,j,A,P,G,oe,X,re,D,W,le,ne,ce,ue]}class Nc extends _t{constructor(e){super(),gt(this,e,Dc,Ic,pt,{},null,[-1,-1])}}function Oc(l){let e,t;return e=new ka({}),{c(){ge(e.$$.fragment)},m(n,o){he(e,n,o),t=!0},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function Pc(l){let e,t;return e=new Nc({}),{c(){ge(e.$$.fragment)},m(n,o){he(e,n,o),t=!0},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function Uc(l){let e,t;return e=new za({}),{c(){ge(e.$$.fragment)},m(n,o){he(e,n,o),t=!0},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function Mc(l){let e,t;return e=new ri({}),{c(){ge(e.$$.fragment)},m(n,o){he(e,n,o),t=!0},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function jc(l){let e,t;return e=new Ia({}),{c(){ge(e.$$.fragment)},m(n,o){he(e,n,o),t=!0},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function zc(l){let e,t;return e=new Oa({}),{c(){ge(e.$$.fragment)},m(n,o){he(e,n,o),t=!0},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ve(e,n)}}}function Hc(l){let e;return{c(){e=f("nav"),e.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
            <a class="navbar-item" href="/config/wizard">Wizard</a> 
            <a class="navbar-item" href="/config/json">JSON¬†Editor</a> 
            <a class="navbar-item" href="/graph">Graph</a> 
            <a class="navbar-item" href="/chat">Chat</a></div>`,c(e,"class","navbar")},m(t,n){S(t,e,n)},p:Re,d(t){t&&T(e)}}}function Fc(l){let e,t,n,o,a,s,u,i,d,p,m,_,g,w,h,k,$,y,b,C,K,N,O,R,F,x,Q,E,L,se,J,ie,ee,z,Z,I,j,A,P,G,oe,X;return b=new Ul({}),N=new Nt({props:{path:"/",$$slots:{default:[Oc]},$$scope:{ctx:l}}}),R=new Nt({props:{path:"/chat",$$slots:{default:[Pc]},$$scope:{ctx:l}}}),x=new Nt({props:{path:"/graph",$$slots:{default:[Uc]},$$scope:{ctx:l}}}),se=new Nt({props:{path:"/fetch/*",$$slots:{default:[Mc]},$$scope:{ctx:l}}}),ie=new Nt({props:{path:"/config/wizard",$$slots:{default:[jc]},$$scope:{ctx:l}}}),z=new Nt({props:{path:"/config/json",$$slots:{default:[zc]},$$scope:{ctx:l}}}),A=new Nt({props:{path:"/",$$slots:{default:[Hc]},$$scope:{ctx:l}}}),{c(){e=f("meta"),t=v(),n=f("div"),o=f("main"),a=f("div"),s=f("div"),u=f("div"),i=f("ul"),d=f("li"),p=f("a"),p.innerHTML=`<span class="icon is-small"><i class="fas fa-search"></i></span> 
                <span>Search</span>`,m=v(),_=f("li"),g=f("a"),g.innerHTML=`<span class="icon is-small"><i class="fas fa-comments"></i></span> 
                <span>Chat</span>`,w=v(),h=f("li"),k=f("a"),k.innerHTML=`<span class="icon is-small"><i class="fas fa-project-diagram"></i></span> 
                <span>Graph</span>`,$=v(),y=f("div"),ge(b.$$.fragment),C=v(),K=f("div"),ge(N.$$.fragment),O=v(),ge(R.$$.fragment),F=v(),ge(x.$$.fragment),Q=v(),E=f("br"),L=v(),ge(se.$$.fragment),J=v(),ge(ie.$$.fragment),ee=v(),ge(z.$$.fragment),Z=v(),I=f("footer"),j=f("div"),ge(A.$$.fragment),c(e,"name","color-scheme"),c(e,"content",l[1]),document.title="Terraphim",c(p,"href","/"),c(p,"data-exact",""),c(p,"data-testid","search-tab"),c(d,"class","svelte-1nmgbjk"),c(g,"href","/chat"),c(g,"data-testid","chat-tab"),c(_,"class","svelte-1nmgbjk"),c(k,"href","/graph"),c(k,"data-testid","graph-tab"),c(h,"class","svelte-1nmgbjk"),c(u,"class","tabs is-boxed svelte-1nmgbjk"),c(s,"class","main-navigation svelte-1nmgbjk"),c(y,"class","role-selector svelte-1nmgbjk"),c(a,"class","top-controls svelte-1nmgbjk"),c(K,"class","main-area svelte-1nmgbjk"),c(o,"class","main-content svelte-1nmgbjk"),c(j,"class",P=Pt(l[0])+" svelte-1nmgbjk"),c(I,"class","svelte-1nmgbjk"),c(n,"class","is-full-height svelte-1nmgbjk")},m(re,D){r(document.head,e),S(re,t,D),S(re,n,D),r(n,o),r(o,a),r(a,s),r(s,u),r(u,i),r(i,d),r(d,p),r(i,m),r(i,_),r(_,g),r(i,w),r(i,h),r(h,k),r(a,$),r(a,y),he(b,y,null),r(o,C),r(o,K),he(N,K,null),r(K,O),he(R,K,null),r(K,F),he(x,K,null),r(o,Q),r(o,E),r(o,L),he(se,o,null),r(o,J),he(ie,o,null),r(o,ee),he(z,o,null),r(n,Z),r(n,I),r(I,j),he(A,j,null),G=!0,oe||(X=[Hl(Fl.call(null,p)),Hl(Fl.call(null,g)),Hl(Fl.call(null,k)),ae(I,"mouseover",l[2]),ae(I,"focus",l[2])],oe=!0)},p(re,[D]){(!G||D&2)&&c(e,"content",re[1]);const W={};D&16&&(W.$$scope={dirty:D,ctx:re}),N.$set(W);const le={};D&16&&(le.$$scope={dirty:D,ctx:re}),R.$set(le);const ne={};D&16&&(ne.$$scope={dirty:D,ctx:re}),x.$set(ne);const ce={};D&16&&(ce.$$scope={dirty:D,ctx:re}),se.$set(ce);const ue={};D&16&&(ue.$$scope={dirty:D,ctx:re}),ie.$set(ue);const H={};D&16&&(H.$$scope={dirty:D,ctx:re}),z.$set(H);const Y={};D&16&&(Y.$$scope={dirty:D,ctx:re}),A.$set(Y),(!G||D&1&&P!==(P=Pt(re[0])+" svelte-1nmgbjk"))&&c(j,"class",P)},i(re){G||(M(b.$$.fragment,re),M(N.$$.fragment,re),M(R.$$.fragment,re),M(x.$$.fragment,re),M(se.$$.fragment,re),M(ie.$$.fragment,re),M(z.$$.fragment,re),M(A.$$.fragment,re),G=!0)},o(re){V(b.$$.fragment,re),V(N.$$.fragment,re),V(R.$$.fragment,re),V(x.$$.fragment,re),V(se.$$.fragment,re),V(ie.$$.fragment,re),V(z.$$.fragment,re),V(A.$$.fragment,re),G=!1},d(re){T(e),re&&T(t),re&&T(n),ve(b),ve(N),ve(R),ve(x),ve(se),ve(ie),ve(z),ve(A),oe=!1,Ze(X)}}}function Kc(l,e,t){let n;je(l,bl,s=>t(1,n=s));let o="is-hidden";function a(){t(0,o="")}return[o,n,a]}class Gc extends _t{constructor(e){super(),gt(this,e,Kc,Fc,pt,{})}}const qc=new $r;Cr(qc);new Gc({target:document.getElementById("app")});
