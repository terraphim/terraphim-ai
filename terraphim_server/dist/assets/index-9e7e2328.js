import{aa as rt,S as Ze,i as Xe,s as qe,q as f,Y as J,b as C,y as r,Z as pe,I as ve,j as S,ak as ye,au as kt,r as re,a as b,v as u,z as ae,t as P,d as K,B as ie,av as Yo,aw as Rt,H as De,U as Ie,V as He,ax as Vt,ay as Qo,F as xe,g as Ne,e as Oe,O as Je,az as nl,l as X,E as ze,aA as vt,aB as Oo,aC as Zo,a1 as we,C as lt,aD as Ee,aE as Ao,D as Et,G as Dt,aF as Uo,w as ft,x as dt,A as Xo,a2 as xo,aG as en,ac as tn,m as Qt,af as bt,W as Tt,a7 as ln,a9 as on,n as nn}from"./vendor-ui-cd3d2b6a.js";import{R as ut,S as Zt}from"./vendor-utils-1b347ea1.js";import{J as Eo,_ as sn,o as rn}from"./vendor-editor-992829d3.js";import{P as Do,T as Yt,u as Mo,y as an,A as un,S as cn,q as fn}from"./vendor-atomic-1ea13e29.js";import{E as dn}from"./novel-editor-b32024cb.js";import{s as xt,z as pn,a as _n,l as mn,m as hn,c as gn,b as vn,B as bn,d as kn}from"./vendor-charts-e6a4a6c9.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function t(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(n){if(n.ep)return;n.ep=!0;const a=t(n);fetch(n.href,a)}})();const et={ServerURL:location.protocol+"//"+window.location.host||"/"},tl=rt([]),$n={id:"Desktop",global_shortcut:"",roles:{},default_role:{original:"",lowercase:""},selected_role:{original:"",lowercase:""}},Ht=rt("spacelab"),ct=rt("selected"),Qe=rt(!1),wn=rt(`${et.ServerURL}/documents/search`),tt=rt($n),gl=rt([]);let el=rt("");const It=rt(!1);let Ct=null;function yn(l){if(typeof document>"u")return;const e=`/assets/bulmaswatch/${l}/bulmaswatch.min.css`;if(Ct!=null&&Ct.href.endsWith(e))return;const t=document.createElement("link");t.rel="stylesheet",t.href=e,t.id="bulma-theme",t.onload=()=>{Ct&&Ct!==t&&Ct.remove(),Ct=t},document.head.appendChild(t);const o=document.head.querySelector('meta[name="color-scheme"]');o&&o.setAttribute("content",l)}Ht.subscribe(yn);function Sn(l){let e,t;return{c(){e=f("option"),t=J(l[1]),e.__value=l[0],e.value=e.__value},m(o,n){C(o,e,n),r(e,t)},p(o,[n]){n&2&&pe(t,o[1]),n&1&&(e.__value=o[0],e.value=e.__value)},i:ve,o:ve,d(o){o&&S(e)}}}function Cn(l,e,t){let o,{subject:n}=e;const a=Do(n),s=Yt(a,Mo.properties.name);return ye(l,s,i=>t(1,o=i)),Yt(a,"http://localhost:9883/property/theme"),l.$$set=i=>{"subject"in i&&t(0,n=i.subject)},[n,o,s]}class Tn extends Ze{constructor(e){super(),Xe(this,e,Cn,Sn,qe,{subject:0})}}function Rn(){return window.crypto.getRandomValues(new Uint32Array(1))[0]}function ll(l,e=!1){const t=Rn(),o=`_${t}`;return Object.defineProperty(window,o,{value:n=>(e&&Reflect.deleteProperty(window,o),l==null?void 0:l(n)),writable:!1,configurable:!0}),t}async function je(l,e={}){return new Promise((t,o)=>{const n=ll(s=>{t(s),Reflect.deleteProperty(window,`_${a}`)},!0),a=ll(s=>{o(s),Reflect.deleteProperty(window,`_${n}`)},!0);window.__TAURI_IPC__({cmd:l,callback:n,error:a,...e})})}function vl(l,e,t){const o=l.slice();return o[25]=e[t],o}function Ln(l){let e,t,o;function n(s){l[13](s)}let a={};return l[5]!==void 0&&(a.value=l[5]),e=new Rt({props:a}),De.push(()=>Ie(e,"value",n)),{c(){re(e.$$.fragment)},m(s,i){ae(e,s,i),o=!0},p(s,i){const c={};!t&&i&32&&(t=!0,c.value=s[5],He(()=>t=!1)),e.$set(c)},i(s){o||(P(e.$$.fragment,s),o=!0)},o(s){K(e.$$.fragment,s),o=!1},d(s){ie(e,s)}}}function Nn(l){let e,t,o;function n(s){l[14](s)}let a={type:"password",placeholder:"secret",icon:"fas fa-lock",expanded:!0};return l[6]!==void 0&&(a.value=l[6]),e=new Rt({props:a}),De.push(()=>Ie(e,"value",n)),{c(){re(e.$$.fragment)},m(s,i){ae(e,s,i),o=!0},p(s,i){const c={};!t&&i&64&&(t=!0,c.value=s[6],He(()=>t=!1)),e.$set(c)},i(s){o||(P(e.$$.fragment,s),o=!0)},o(s){K(e.$$.fragment,s),o=!1},d(s){ie(e,s)}}}function On(l){let e;return{c(){e=J("Save")},m(t,o){C(t,e,o)},d(t){t&&S(e)}}}function An(l){let e,t;return e=new Vt({props:{type:"is-success",class:"is-right",iconPack:"fa",iconLeft:"check",$$slots:{default:[On]},$$scope:{ctx:l}}}),e.$on("click",l[8]),e.$on("submit",l[8]),{c(){re(e.$$.fragment)},m(o,n){ae(e,o,n),t=!0},p(o,n){const a={};n&268435456&&(a.$$scope={dirty:n,ctx:o}),e.$set(a)},i(o){t||(P(e.$$.fragment,o),t=!0)},o(o){K(e.$$.fragment,o),t=!1},d(o){ie(e,o)}}}function Un(l){let e,t,o,n,a,s;return e=new kt({props:{$$slots:{default:[Ln]},$$scope:{ctx:l}}}),o=new kt({props:{grouped:!0,$$slots:{default:[Nn]},$$scope:{ctx:l}}}),a=new kt({props:{grouped:!0,$$slots:{default:[An]},$$scope:{ctx:l}}}),{c(){re(e.$$.fragment),t=b(),re(o.$$.fragment),n=b(),re(a.$$.fragment)},m(i,c){ae(e,i,c),C(i,t,c),ae(o,i,c),C(i,n,c),ae(a,i,c),s=!0},p(i,c){const d={};c&268435488&&(d.$$scope={dirty:c,ctx:i}),e.$set(d);const m={};c&268435520&&(m.$$scope={dirty:c,ctx:i}),o.$set(m);const p={};c&268435456&&(p.$$scope={dirty:c,ctx:i}),a.$set(p)},i(i){s||(P(e.$$.fragment,i),P(o.$$.fragment,i),P(a.$$.fragment,i),s=!0)},o(i){K(e.$$.fragment,i),K(o.$$.fragment,i),K(a.$$.fragment,i),s=!1},d(i){ie(e,i),i&&S(t),ie(o,i),i&&S(n),ie(a,i)}}}function En(l){let e,t,o;function n(s){l[15](s)}let a={type:"search",placeholder:"Fetch JSON",icon:"search"};return l[3]!==void 0&&(a.value=l[3]),e=new Rt({props:a}),De.push(()=>Ie(e,"value",n)),{c(){re(e.$$.fragment)},m(s,i){ae(e,s,i),o=!0},p(s,i){const c={};!t&&i&8&&(t=!0,c.value=s[3],He(()=>t=!1)),e.$set(c)},i(s){o||(P(e.$$.fragment,s),o=!0)},o(s){K(e.$$.fragment,s),o=!1},d(s){ie(e,s)}}}function Dn(l){let e;return{c(){e=J("WikiPage")},m(t,o){C(t,e,o)},d(t){t&&S(e)}}}function Mn(l){let e,t,o,n,a,s;function i(p){l[16](p)}let c={type:"search",placeholder:"Post JSON",icon:"search"};l[4]!==void 0&&(c.value=l[4]),e=new Rt({props:c}),De.push(()=>Ie(e,"value",i));function d(p){l[17](p)}let m={$$slots:{default:[Dn]},$$scope:{ctx:l}};return l[2]!==void 0&&(m.checked=l[2]),n=new Qo({props:m}),De.push(()=>Ie(n,"checked",d)),{c(){re(e.$$.fragment),o=b(),re(n.$$.fragment)},m(p,_){ae(e,p,_),C(p,o,_),ae(n,p,_),s=!0},p(p,_){const g={};!t&&_&16&&(t=!0,g.value=p[4],He(()=>t=!1)),e.$set(g);const h={};_&268435456&&(h.$$scope={dirty:_,ctx:p}),!a&&_&4&&(a=!0,h.checked=p[2],He(()=>a=!1)),n.$set(h)},i(p){s||(P(e.$$.fragment,p),P(n.$$.fragment,p),s=!0)},o(p){K(e.$$.fragment,p),K(n.$$.fragment,p),s=!1},d(p){ie(e,p),p&&S(o),ie(n,p)}}}function Pn(l){let e;return{c(){e=J("Fetch")},m(t,o){C(t,e,o)},d(t){t&&S(e)}}}function jn(l){let e,t;return e=new Vt({props:{type:"is-primary",$$slots:{default:[Pn]},$$scope:{ctx:l}}}),e.$on("click",l[9]),e.$on("submit",l[9]),{c(){re(e.$$.fragment)},m(o,n){ae(e,o,n),t=!0},p(o,n){const a={};n&268435456&&(a.$$scope={dirty:n,ctx:o}),e.$set(a)},i(o){t||(P(e.$$.fragment,o),t=!0)},o(o){K(e.$$.fragment,o),t=!1},d(o){ie(e,o)}}}function In(l){let e,t,o,n,a,s;return e=new kt({props:{grouped:!0,$$slots:{default:[En]},$$scope:{ctx:l}}}),o=new kt({props:{grouped:!0,$$slots:{default:[Mn]},$$scope:{ctx:l}}}),a=new kt({props:{grouped:!0,$$slots:{default:[jn]},$$scope:{ctx:l}}}),{c(){re(e.$$.fragment),t=b(),re(o.$$.fragment),n=b(),re(a.$$.fragment)},m(i,c){ae(e,i,c),C(i,t,c),ae(o,i,c),C(i,n,c),ae(a,i,c),s=!0},p(i,c){const d={};c&268435464&&(d.$$scope={dirty:c,ctx:i}),e.$set(d);const m={};c&268435476&&(m.$$scope={dirty:c,ctx:i}),o.$set(m);const p={};c&268435456&&(p.$$scope={dirty:c,ctx:i}),a.$set(p)},i(i){s||(P(e.$$.fragment,i),P(o.$$.fragment,i),P(a.$$.fragment,i),s=!0)},o(i){K(e.$$.fragment,i),K(o.$$.fragment,i),K(a.$$.fragment,i),s=!1},d(i){ie(e,i),i&&S(t),ie(o,i),i&&S(n),ie(a,i)}}}function Hn(l){let e,t,o,n,a;return n=new Eo({props:{content:l[1],onChange:l[7]}}),{c(){e=f("p"),e.innerHTML=`<i>The best editing experience is to configure Atomic Server, in the
        meantime use editor below. You will need to refresh page via Command R
        or Ctrl-R to see changes</i>`,t=b(),o=f("div"),re(n.$$.fragment),u(o,"class","editor")},m(s,i){C(s,e,i),C(s,t,i),C(s,o,i),ae(n,o,null),a=!0},p(s,i){const c={};i&2&&(c.content=s[1]),n.$set(c)},i(s){a||(P(n.$$.fragment,s),a=!0)},o(s){K(n.$$.fragment,s),a=!1},d(s){s&&S(e),s&&S(t),s&&S(o),ie(n)}}}function bl(l){let e,t;return e=new Tn({props:{subject:l[25]}}),{c(){re(e.$$.fragment)},m(o,n){ae(e,o,n),t=!0},p(o,n){const a={};n&1&&(a.subject=o[25]),e.$set(a)},i(o){t||(P(e.$$.fragment,o),t=!0)},o(o){K(e.$$.fragment,o),t=!1},d(o){ie(e,o)}}}function Fn(l){let e,t,o=l[0]??[],n=[];for(let s=0;s<o.length;s+=1)n[s]=bl(vl(l,o,s));const a=s=>K(n[s],1,1,()=>{n[s]=null});return{c(){for(let s=0;s<n.length;s+=1)n[s].c();e=xe()},m(s,i){for(let c=0;c<n.length;c+=1)n[c]&&n[c].m(s,i);C(s,e,i),t=!0},p(s,i){if(i&1){o=s[0]??[];let c;for(c=0;c<o.length;c+=1){const d=vl(s,o,c);n[c]?(n[c].p(d,i),P(n[c],1)):(n[c]=bl(d),n[c].c(),P(n[c],1),n[c].m(e.parentNode,e))}for(Ne(),c=o.length;c<n.length;c+=1)a(c);Oe()}},i(s){if(!t){for(let i=0;i<o.length;i+=1)P(n[i]);t=!0}},o(s){n=n.filter(Boolean);for(let i=0;i<n.length;i+=1)K(n[i]);t=!1},d(s){Je(n,s),s&&S(e)}}}function Gn(l){let e,t;return e=new Yo({props:{$$slots:{default:[Fn]},$$scope:{ctx:l}}}),{c(){re(e.$$.fragment)},m(o,n){ae(e,o,n),t=!0},p(o,n){const a={};n&268435457&&(a.$$scope={dirty:n,ctx:o}),e.$set(a)},i(o){t||(P(e.$$.fragment,o),t=!0)},o(o){K(e.$$.fragment,o),t=!1},d(o){ie(e,o)}}}function Kn(l){let e,t,o,n,a,s,i,c,d,m,p,_,g;return t=new ut({props:{path:"/atomic",$$slots:{default:[Un]},$$scope:{ctx:l}}}),n=new ut({props:{path:"/json",$$slots:{default:[In]},$$scope:{ctx:l}}}),s=new ut({props:{path:"/editor",$$slots:{default:[Hn]},$$scope:{ctx:l}}}),m=new kt({props:{grouped:!0,position:"is-right",$$slots:{default:[Gn]},$$scope:{ctx:l}}}),{c(){e=f("div"),re(t.$$.fragment),o=b(),re(n.$$.fragment),a=b(),re(s.$$.fragment),i=b(),c=f("hr"),d=b(),re(m.$$.fragment),p=b(),_=f("nav"),_.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
    <a class="navbar-item" href="/fetch/json">Fetch JSON Data</a> 
    <a class="navbar-item" href="/fetch/atomic">Set Atomic Server</a> 
    <a class="navbar-item" href="/fetch/editor">Edit JSON config</a></div>`,u(e,"class","box"),u(_,"class","navbar")},m(h,k){C(h,e,k),ae(t,e,null),r(e,o),ae(n,e,null),r(e,a),ae(s,e,null),C(h,i,k),C(h,c,k),C(h,d,k),ae(m,h,k),C(h,p,k),C(h,_,k),g=!0},p(h,[k]){const w={};k&268435552&&(w.$$scope={dirty:k,ctx:h}),t.$set(w);const v={};k&268435484&&(v.$$scope={dirty:k,ctx:h}),n.$set(v);const $={};k&268435458&&($.$$scope={dirty:k,ctx:h}),s.$set($);const L={};k&268435457&&(L.$$scope={dirty:k,ctx:h}),m.$set(L)},i(h){g||(P(t.$$.fragment,h),P(n.$$.fragment,h),P(s.$$.fragment,h),P(m.$$.fragment,h),g=!0)},o(h){K(t.$$.fragment,h),K(n.$$.fragment,h),K(s.$$.fragment,h),K(m.$$.fragment,h),g=!1},d(h){h&&S(e),ie(t),ie(n),ie(s),h&&S(i),h&&S(c),h&&S(d),ie(m,h),h&&S(p),h&&S(_)}}}function zn(l,e,t){let o,n,a,s,i;ye(l,an,A=>t(19,a=A)),ye(l,Qe,A=>t(20,s=A)),ye(l,tt,A=>t(21,i=A));let c={json:i};function d(A){if(console.log("contents changed:",A),console.log("is tauri",s),tt.update(T=>(T=A.json,T)),Qe)console.log("Updating config on server"),je("update_config",{configNew:A.json}).then(T=>{console.log(`Message: ${T}`)}).catch(T=>console.error(T));else{let T=`${et.ServerURL}/config/`;fetch(T,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(A.json)})}t(1,c=A)}let m=!1,p="https://raw.githubusercontent.com/terraphim/terraphim-cloud-fastapi/main/data/ref_arch.json",_="http://localhost:8000/documents/",g="http://localhost:9883/",h;const k=async()=>{console.log("Updating atomic server configuration");const A=un.fromSecret(h);a.setServerUrl(g),console.log("Server set.Setting agent"),a.setAgent(A)},w=async()=>{L()},v=({data:{msg:A,data:T}})=>{console.log(A,T)};let $;const L=async()=>{const A=await sn(()=>import("./fetcher.worker-7e58969a.js"),[]);$=new A.default,$.onmessage=v;const T={msg:"fetcher",data:{url:p,postUrl:_,isWiki:m}};$.postMessage(T)},E=Do("http://localhost:9883/config/y3zx5wtm0bq"),z=Yt(E,Mo.properties.name);ye(l,z,A=>t(12,n=A));const M=Yt(E,"http://localhost:9883/property/role");ye(l,M,A=>t(0,o=A));function y(A){g=A,t(5,g)}function N(A){h=A,t(6,h)}function D(A){p=A,t(3,p)}function G(A){_=A,t(4,_)}function j(A){m=A,t(2,m)}return l.$$.update=()=>{l.$$.dirty&4096&&console.log("Print name",n),l.$$.dirty&1&&console.log("Print roles",o)},[o,c,m,p,_,g,h,d,k,w,z,M,n,y,N,D,G,j]}class Wn extends Ze{constructor(e){super(),Xe(this,e,zn,Kn,qe,{})}}function Bn(l){let e,t;return e=new dn({props:{defaultValue:l[0],isEditable:!l[1],disableLocalStorage:!0,onUpdate:l[2],extensions:[rn]}}),{c(){re(e.$$.fragment)},m(o,n){ae(e,o,n),t=!0},p(o,[n]){const a={};n&1&&(a.defaultValue=o[0]),n&2&&(a.isEditable=!o[1]),e.$set(a)},i(o){t||(P(e.$$.fragment,o),t=!0)},o(o){K(e.$$.fragment,o),t=!1},d(o){ie(e,o)}}}function qn(l,e,t){let{html:o=""}=e,{readOnly:n=!1}=e,{outputFormat:a="html"}=e;const s=i=>{a==="markdown"?t(0,o=i.storage.markdown.getMarkdown()):t(0,o=i.getHTML())};return l.$$set=i=>{"html"in i&&t(0,o=i.html),"readOnly"in i&&t(1,n=i.readOnly),"outputFormat"in i&&t(3,a=i.outputFormat)},[o,n,s,a]}class Jn extends Ze{constructor(e){super(),Xe(this,e,qn,Bn,qe,{html:0,readOnly:1,outputFormat:3})}}function kl(l){let e,t,o,n,a,s,i,c,d,m,p;return{c(){e=f("div"),t=f("h3"),o=f("span"),o.textContent="Knowledge Graph",n=J(`
          Term: `),a=f("strong"),s=J(l[2]),i=J(" | Rank: "),c=f("strong"),d=J(l[3]),m=b(),p=f("hr"),u(o,"class","tag is-info svelte-329px1"),u(t,"class","subtitle is-6 svelte-329px1"),u(p,"class","svelte-329px1"),u(e,"class","kg-context svelte-329px1")},m(_,g){C(_,e,g),r(e,t),r(t,o),r(t,n),r(t,a),r(a,s),r(t,i),r(t,c),r(c,d),r(e,m),r(e,p)},p(_,g){g&4&&pe(s,_[2]),g&8&&pe(d,_[3])},d(_){_&&S(e)}}}function Vn(l){let e,t,o,n,a,s,i,c;const d=[Zn,Qn],m=[];function p(_,g){return _[5]?0:1}return t=p(l),o=m[t]=d[t](l),{c(){e=f("div"),o.c(),n=b(),a=f("div"),a.innerHTML='<span class="hint-text svelte-329px1">Double-click to edit • Ctrl+E to edit • Ctrl+S to save • Click KG links to explore</span>',u(a,"class","edit-hint svelte-329px1"),u(e,"class","content-viewer svelte-329px1"),u(e,"tabindex","0"),u(e,"role","button"),u(e,"aria-label","Double-click to edit article content")},m(_,g){C(_,e,g),m[t].m(e,null),r(e,n),r(e,a),l[20](e),s=!0,i||(c=[X(e,"dblclick",l[14]),X(e,"keydown",l[15]),X(e,"click",l[13])],i=!0)},p(_,g){let h=t;t=p(_),t===h?m[t].p(_,g):(Ne(),K(m[h],1,1,()=>{m[h]=null}),Oe(),o=m[t],o?o.p(_,g):(o=m[t]=d[t](_),o.c()),P(o,1),o.m(e,n))},i(_){s||(P(o),s=!0)},o(_){K(o),s=!1},d(_){_&&S(e),m[t].d(),l[20](null),i=!1,ze(c)}}}function Yn(l){let e,t,o,n,a,s,i,c,d,m;function p(g){l[18](g)}let _={outputFormat:l[11]};return l[1].body!==void 0&&(_.html=l[1].body),e=new Jn({props:_}),De.push(()=>Ie(e,"html",p)),{c(){re(e.$$.fragment),o=b(),n=f("div"),a=f("button"),a.textContent="Save",s=b(),i=f("button"),i.textContent="Cancel",u(a,"class","button is-primary"),u(i,"class","button is-light"),u(n,"class","edit-controls svelte-329px1")},m(g,h){ae(e,g,h),C(g,o,h),C(g,n,h),r(n,a),r(n,s),r(n,i),c=!0,d||(m=[X(a,"click",l[12]),X(i,"click",l[19])],d=!0)},p(g,h){const k={};h&2048&&(k.outputFormat=g[11]),!t&&h&2&&(t=!0,k.html=g[1].body,He(()=>t=!1)),e.$set(k)},i(g){c||(P(e.$$.fragment,g),c=!0)},o(g){K(e.$$.fragment,g),c=!1},d(g){ie(e,g),g&&S(o),g&&S(n),d=!1,ze(m)}}}function Qn(l){let e,t,o;return t=new Zt({props:{source:l[1].body}}),{c(){e=f("div"),re(t.$$.fragment),u(e,"class","markdown-content svelte-329px1")},m(n,a){C(n,e,a),ae(t,e,null),o=!0},p(n,a){const s={};a&2&&(s.source=n[1].body),t.$set(s)},i(n){o||(P(t.$$.fragment,n),o=!0)},o(n){K(t.$$.fragment,n),o=!1},d(n){n&&S(e),ie(t)}}}function Zn(l){let e,t=l[1].body+"";return{c(){e=f("div"),u(e,"class","prose svelte-329px1")},m(o,n){C(o,e,n),e.innerHTML=t},p(o,n){n&2&&t!==(t=o[1].body+"")&&(e.innerHTML=t)},i:ve,o:ve,d(o){o&&S(e)}}}function Xn(l){let e,t,o,n,a,s=l[1].title+"",i,c,d,m,p,_,g,h=l[2]&&l[3]!==null&&kl(l);const k=[Yn,Vn],w=[];function v($,L){return $[4]?0:1}return d=v(l),m=w[d]=k[d](l),{c(){e=f("div"),t=f("button"),o=b(),h&&h.c(),n=b(),a=f("h2"),i=J(s),c=b(),m.c(),u(t,"class","delete is-large modal-close-btn svelte-329px1"),u(t,"aria-label","close"),u(a,"class","svelte-329px1"),u(e,"class","box wrapper svelte-329px1")},m($,L){C($,e,L),r(e,t),r(e,o),h&&h.m(e,null),r(e,n),r(e,a),r(a,i),r(e,c),w[d].m(e,null),p=!0,_||(g=X(t,"click",l[17]),_=!0)},p($,L){$[2]&&$[3]!==null?h?h.p($,L):(h=kl($),h.c(),h.m(e,n)):h&&(h.d(1),h=null),(!p||L&2)&&s!==(s=$[1].title+"")&&pe(i,s);let E=d;d=v($),d===E?w[d].p($,L):(Ne(),K(w[E],1,1,()=>{w[E]=null}),Oe(),m=w[d],m?m.p($,L):(m=w[d]=k[d]($),m.c()),P(m,1),m.m(e,null))},i($){p||(P(m),p=!0)},o($){K(m),p=!1},d($){$&&S(e),h&&h.d(),w[d].d(),_=!1,g()}}}function $l(l){let e,t,o;function n(s){l[23](s)}let a={$$slots:{default:[ts]},$$scope:{ctx:l}};return l[7]!==void 0&&(a.active=l[7]),e=new nl({props:a}),De.push(()=>Ie(e,"active",n)),{c(){re(e.$$.fragment)},m(s,i){ae(e,s,i),o=!0},p(s,i){const c={};i&536872832&&(c.$$scope={dirty:i,ctx:s}),!t&&i&128&&(t=!0,c.active=s[7],He(()=>t=!1)),e.$set(c)},i(s){o||(P(e.$$.fragment,s),o=!0)},o(s){K(e.$$.fragment,s),o=!1},d(s){ie(e,s)}}}function wl(l){let e,t,o,n,a,s,i,c,d,m,p;return{c(){e=f("div"),t=f("h3"),o=f("span"),o.textContent="Knowledge Graph",n=J(`
            Term: `),a=f("strong"),s=J(l[9]),i=J(" | Rank: "),c=f("strong"),d=J(l[10]),m=b(),p=f("hr"),u(o,"class","tag is-info svelte-329px1"),u(t,"class","subtitle is-6 svelte-329px1"),u(p,"class","svelte-329px1"),u(e,"class","kg-context svelte-329px1")},m(_,g){C(_,e,g),r(e,t),r(t,o),r(t,n),r(t,a),r(a,s),r(t,i),r(t,c),r(c,d),r(e,m),r(e,p)},p(_,g){g&512&&pe(s,_[9]),g&1024&&pe(d,_[10])},d(_){_&&S(e)}}}function xn(l){let e,t,o;return t=new Zt({props:{source:l[8].body}}),{c(){e=f("div"),re(t.$$.fragment),u(e,"class","markdown-content svelte-329px1")},m(n,a){C(n,e,a),ae(t,e,null),o=!0},p(n,a){const s={};a&256&&(s.source=n[8].body),t.$set(s)},i(n){o||(P(t.$$.fragment,n),o=!0)},o(n){K(t.$$.fragment,n),o=!1},d(n){n&&S(e),ie(t)}}}function es(l){let e,t=l[8].body+"";return{c(){e=f("div"),u(e,"class","prose svelte-329px1")},m(o,n){C(o,e,n),e.innerHTML=t},p(o,n){n&256&&t!==(t=o[8].body+"")&&(e.innerHTML=t)},i:ve,o:ve,d(o){o&&S(e)}}}function ts(l){let e,t,o,n,a,s=l[8].title+"",i,c,d,m,p,_,g,h,k,w,v,$=l[9]&&l[10]!==null&&wl(l);const L=[es,xn],E=[];function z(M,y){return y&256&&(m=null),m==null&&(m=!!(M[8].body&&(/<html/i.test(M[8].body)||/<body/i.test(M[8].body)||/<head/i.test(M[8].body)))),m?0:1}return p=z(l,-1),_=E[p]=L[p](l),{c(){e=f("div"),t=f("button"),o=b(),$&&$.c(),n=b(),a=f("h2"),i=J(s),c=b(),d=f("div"),_.c(),g=b(),h=f("div"),h.innerHTML='<span class="hint-text svelte-329px1">Knowledge Graph document • Click KG links to explore further</span>',u(t,"class","delete is-large modal-close-btn svelte-329px1"),u(t,"aria-label","close"),u(a,"class","svelte-329px1"),u(h,"class","edit-hint svelte-329px1"),u(d,"class","content-viewer svelte-329px1"),u(d,"tabindex","0"),u(d,"role","button"),u(d,"aria-label","KG document content - click KG links to explore further"),u(e,"class","box wrapper svelte-329px1")},m(M,y){C(M,e,y),r(e,t),r(e,o),$&&$.m(e,null),r(e,n),r(e,a),r(a,i),r(e,c),r(e,d),E[p].m(d,null),r(d,g),r(d,h),k=!0,w||(v=[X(t,"click",l[22]),X(d,"click",l[13])],w=!0)},p(M,y){M[9]&&M[10]!==null?$?$.p(M,y):($=wl(M),$.c(),$.m(e,n)):$&&($.d(1),$=null),(!k||y&256)&&s!==(s=M[8].title+"")&&pe(i,s);let N=p;p=z(M,y),p===N?E[p].p(M,y):(Ne(),K(E[N],1,1,()=>{E[N]=null}),Oe(),_=E[p],_?_.p(M,y):(_=E[p]=L[p](M),_.c()),P(_,1),_.m(d,g))},i(M){k||(P(_),k=!0)},o(M){K(_),k=!1},d(M){M&&S(e),$&&$.d(),E[p].d(),w=!1,ze(v)}}}function ls(l){let e,t,o,n,a;function s(d){l[21](d)}let i={$$slots:{default:[Xn]},$$scope:{ctx:l}};l[0]!==void 0&&(i.active=l[0]),e=new nl({props:i}),De.push(()=>Ie(e,"active",s));let c=l[8]&&$l(l);return{c(){re(e.$$.fragment),o=b(),c&&c.c(),n=xe()},m(d,m){ae(e,d,m),C(d,o,m),c&&c.m(d,m),C(d,n,m),a=!0},p(d,[m]){const p={};m&536873087&&(p.$$scope={dirty:m,ctx:d}),!t&&m&1&&(t=!0,p.active=d[0],He(()=>t=!1)),e.$set(p),d[8]?c?(c.p(d,m),m&256&&P(c,1)):(c=$l(d),c.c(),P(c,1),c.m(n.parentNode,n)):c&&(Ne(),K(c,1,1,()=>{c=null}),Oe())},i(d){a||(P(e.$$.fragment,d),P(c),a=!0)},o(d){K(e.$$.fragment,d),K(c),a=!1},d(d){ie(e,d),d&&S(o),c&&c.d(d),d&&S(n)}}}function os(l,e,t){let o,n,a,s;ye(l,Qe,R=>t(25,a=R)),ye(l,ct,R=>t(26,s=R));let{active:i=!1}=e,{item:c}=e,{initialEdit:d=!1}=e,{kgTerm:m=null}=e,{kgRank:p=null}=e,_=!1,g,h=!1,k=null,w=null,v=null;async function $(){if(a)try{const R=await je("get_document",{documentId:c.id});R!=null&&R.document&&t(1,c=R.document)}catch(R){console.error("Failed to load document",R)}}async function L(){if(!a){t(4,_=!1);return}try{await je("create_document",{document:c}),t(4,_=!1)}catch(R){console.error("Failed to save document",R)}}async function E(R){var Y,q,W,x,O;t(9,w=R),console.log("🔍 KG Link Click Debug Info:"),console.log("  Term clicked:",R),console.log("  Current role:",s),console.log("  Is Tauri mode:",a);try{if(a){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:s,term:R});const B=await je("find_documents_for_kg_term",{roleName:s,term:R});console.log("  📥 Tauri response received:"),console.log("    Status:",B.status),console.log("    Results count:",((Y=B.results)==null?void 0:Y.length)||0),console.log("    Total:",B.total||0),console.log("    Full response:",JSON.stringify(B,null,2)),B.status==="success"&&B.results&&B.results.length>0?(t(8,k=B.results[0]),t(10,v=k.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",k.title),console.log("    Rank:",v),console.log("    Body length:",((q=k.body)==null?void 0:q.length)||0,"characters"),t(7,h=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${R}" in role: "${s}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const B=et.ServerURL,Q=encodeURIComponent(s),U=encodeURIComponent(R),I=`${B}/roles/${Q}/kg_search?term=${U}`;console.log("  📤 HTTP Request details:"),console.log("    Base URL:",B),console.log("    Role (encoded):",Q),console.log("    Term (encoded):",U),console.log("    Full URL:",I);const V=await fetch(I);if(console.log("  📥 HTTP Response received:"),console.log("    Status code:",V.status),console.log("    Status text:",V.statusText),console.log("    Headers:",Object.fromEntries(V.headers.entries())),!V.ok)throw new Error(`HTTP error! Status: ${V.status} - ${V.statusText}`);const oe=await V.json();console.log("  📄 Response data:"),console.log("    Status:",oe.status),console.log("    Results count:",((W=oe.results)==null?void 0:W.length)||0),console.log("    Total:",oe.total||0),console.log("    Full response:",JSON.stringify(oe,null,2)),oe.status==="success"&&oe.results&&oe.results.length>0?(t(8,k=oe.results[0]),t(10,v=k.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",k.title),console.log("    Rank:",v),console.log("    Body length:",((x=k.body)==null?void 0:x.length)||0,"characters"),t(7,h=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${R}" in role: "${s}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",I))}}catch(B){console.error("❌ Error fetching KG document:"),console.error("  Error type:",B.constructor.name),console.error("  Error message:",B.message||B),console.error("  Request details:",{term:R,role:s,isTauri:a,timestamp:new Date().toISOString()}),!a&&((O=B.message)!=null&&O.includes("Failed to fetch"))&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{}}function z(R){const Y=R.target;if(Y.tagName==="A"){const q=Y.getAttribute("href");if(q&&q.startsWith("kg:")){R.preventDefault();const W=q.substring(3);E(W)}}}function M(){t(4,_=!0)}function y(R){R.type!=="dblclick"&&((R.ctrlKey||R.metaKey)&&R.key==="e"&&(R.preventDefault(),t(4,_=!0)),_&&(R.ctrlKey||R.metaKey)&&R.key==="s"&&(R.preventDefault(),L()),R.key==="Escape"&&(R.preventDefault(),_?t(4,_=!1):t(0,i=!1)))}const N=()=>t(0,i=!1);function D(R){l.$$.not_equal(c.body,R)&&(c.body=R,t(1,c))}const G=()=>t(4,_=!1);function j(R){De[R?"unshift":"push"](()=>{g=R,t(6,g)})}function A(R){i=R,t(0,i)}const T=()=>t(7,h=!1);function te(R){h=R,t(7,h)}return l.$$set=R=>{"active"in R&&t(0,i=R.active),"item"in R&&t(1,c=R.item),"initialEdit"in R&&t(16,d=R.initialEdit),"kgTerm"in R&&t(2,m=R.kgTerm),"kgRank"in R&&t(3,p=R.kgRank)},l.$$.update=()=>{l.$$.dirty&65537&&i&&d&&t(4,_=!0),l.$$.dirty&19&&i&&c&&!_&&$(),l.$$.dirty&2&&t(5,o=c!=null&&c.body?/<html/i.test(c.body)||/<body/i.test(c.body)||/<head/i.test(c.body)||/^\s*<(!DOCTYPE|html|head|body|div|p|span)/i.test(c.body.trim()):!1),l.$$.dirty&32&&t(11,n=o?"html":"markdown")},[i,c,m,p,_,o,g,h,k,w,v,n,L,z,M,y,d,N,D,G,j,A,T,te]}class sl extends Ze{constructor(e){super(),Xe(this,e,os,ls,qe,{active:0,item:1,initialEdit:16,kgTerm:2,kgRank:3})}}function yl(l,e,t){const o=l.slice();return o[33]=e[t],o}function Sl(l,e,t){const o=l.slice();return o[36]=e[t],o}function Cl(l,e,t){const o=l.slice();return o[39]=e[t],o}function Tl(l){let e,t;return e=new Oo({props:{type:"is-success",$$slots:{default:[ns]},$$scope:{ctx:l}}}),{c(){re(e.$$.fragment)},m(o,n){ae(e,o,n),t=!0},i(o){t||(P(e.$$.fragment,o),t=!0)},o(o){K(e.$$.fragment,o),t=!1},d(o){ie(e,o)}}}function ns(l){let e,t,o;return{c(){e=f("p"),e.innerHTML="<strong>Success!</strong> Article saved to atomic server successfully.",t=b(),o=f("p"),o.textContent="The modal will close automatically..."},m(n,a){C(n,e,a),C(n,t,a),C(n,o,a)},p:ve,d(n){n&&S(e),n&&S(t),n&&S(o)}}}function Rl(l){let e,t;return e=new Oo({props:{type:"is-danger",$$slots:{default:[ss]},$$scope:{ctx:l}}}),{c(){re(e.$$.fragment)},m(o,n){ae(e,o,n),t=!0},p(o,n){const a={};n[0]&8|n[1]&2048&&(a.$$scope={dirty:n,ctx:o}),e.$set(a)},i(o){t||(P(e.$$.fragment,o),t=!0)},o(o){K(e.$$.fragment,o),t=!1},d(o){ie(e,o)}}}function ss(l){let e,t,o,n;return{c(){e=f("p"),t=f("strong"),t.textContent="Error:",o=b(),n=J(l[3])},m(a,s){C(a,e,s),r(e,t),r(e,o),r(e,n)},p(a,s){s[0]&8&&pe(n,a[3])},d(a){a&&S(e)}}}function Ll(l){var te,R,Y,q;let e,t,o,n,a,s=(((te=l[1])==null?void 0:te.title)||"Untitled")+"",i,c,d,m,p,_,g=(((R=l[1])==null?void 0:R.rank)||0)+"",h,k,w,v,$,L,E,z,M,y,N=((Y=l[1])==null?void 0:Y.description)&&Nl(l),D=((q=l[1])==null?void 0:q.tags)&&Ol(l);function G(W,x){return W[10].length>0?as:rs}let j=G(l),A=j(l),T=l[10].length>0&&El(l);return{c(){e=f("div"),t=f("label"),t.textContent="Document to Save",o=b(),n=f("div"),a=f("h5"),i=J(s),c=b(),N&&N.c(),d=b(),m=f("div"),p=f("span"),_=J("Rank: "),h=J(g),k=b(),D&&D.c(),w=b(),v=f("div"),$=f("label"),$.textContent="Atomic Server",L=b(),E=f("div"),A.c(),z=b(),T&&T.c(),M=xe(),u(t,"class","label"),u(a,"class","title is-6"),u(p,"class","tag is-info svelte-48g63o"),u(m,"class","tags svelte-48g63o"),u(n,"class","box document-preview svelte-48g63o"),u(e,"class","field"),u($,"class","label"),u($,"for","atomic-server-select"),u(E,"class","control"),u(v,"class","field")},m(W,x){C(W,e,x),r(e,t),r(e,o),r(e,n),r(n,a),r(a,i),r(n,c),N&&N.m(n,null),r(n,d),r(n,m),r(m,p),r(p,_),r(p,h),r(m,k),D&&D.m(m,null),C(W,w,x),C(W,v,x),r(v,$),r(v,L),r(v,E),A.m(E,null),C(W,z,x),T&&T.m(W,x),C(W,M,x),y=!0},p(W,x){var O,B,Q,U;(!y||x[0]&2)&&s!==(s=(((O=W[1])==null?void 0:O.title)||"Untitled")+"")&&pe(i,s),(B=W[1])!=null&&B.description?N?N.p(W,x):(N=Nl(W),N.c(),N.m(n,d)):N&&(N.d(1),N=null),(!y||x[0]&2)&&g!==(g=(((Q=W[1])==null?void 0:Q.rank)||0)+"")&&pe(h,g),(U=W[1])!=null&&U.tags?D?D.p(W,x):(D=Ol(W),D.c(),D.m(m,null)):D&&(D.d(1),D=null),j===(j=G(W))&&A?A.p(W,x):(A.d(1),A=j(W),A&&(A.c(),A.m(E,null))),W[10].length>0?T?(T.p(W,x),x[0]&1024&&P(T,1)):(T=El(W),T.c(),P(T,1),T.m(M.parentNode,M)):T&&(Ne(),K(T,1,1,()=>{T=null}),Oe())},i(W){y||(P(T),y=!0)},o(W){K(T),y=!1},d(W){W&&S(e),N&&N.d(),D&&D.d(),W&&S(w),W&&S(v),A.d(),W&&S(z),T&&T.d(W),W&&S(M)}}}function Nl(l){let e,t=l[1].description+"",o;return{c(){e=f("p"),o=J(t),u(e,"class","content")},m(n,a){C(n,e,a),r(e,o)},p(n,a){a[0]&2&&t!==(t=n[1].description+"")&&pe(o,t)},d(n){n&&S(e)}}}function Ol(l){let e,t=l[1].tags,o=[];for(let n=0;n<t.length;n+=1)o[n]=Al(Cl(l,t,n));return{c(){for(let n=0;n<o.length;n+=1)o[n].c();e=xe()},m(n,a){for(let s=0;s<o.length;s+=1)o[s]&&o[s].m(n,a);C(n,e,a)},p(n,a){if(a[0]&2){t=n[1].tags;let s;for(s=0;s<t.length;s+=1){const i=Cl(n,t,s);o[s]?o[s].p(i,a):(o[s]=Al(i),o[s].c(),o[s].m(e.parentNode,e))}for(;s<o.length;s+=1)o[s].d(1);o.length=t.length}},d(n){Je(o,n),n&&S(e)}}}function Al(l){let e,t=l[39]+"",o;return{c(){e=f("span"),o=J(t),u(e,"class","tag svelte-48g63o")},m(n,a){C(n,e,a),r(e,o)},p(n,a){a[0]&2&&t!==(t=n[39]+"")&&pe(o,t)},d(n){n&&S(e)}}}function rs(l){let e,t,o,n,a,s,i,c,d;return{c(){e=f("div"),t=f("p"),t.innerHTML="<strong>No atomic servers available</strong>",o=b(),n=f("p"),a=J('Your current role "'),s=J(l[12]),i=J(`" doesn't have any writable atomic server configurations.`),c=b(),d=f("p"),d.textContent="Please configure an atomic server haystack in your role settings.",u(e,"class","notification is-warning")},m(m,p){C(m,e,p),r(e,t),r(e,o),r(e,n),r(n,a),r(n,s),r(n,i),r(e,c),r(e,d)},p(m,p){p[0]&4096&&pe(s,m[12])},d(m){m&&S(e)}}}function as(l){let e,t,o,n,a,s,i=l[10],c=[];for(let d=0;d<i.length;d+=1)c[d]=Ul(Sl(l,i,d));return{c(){e=f("div"),t=f("select");for(let d=0;d<c.length;d+=1)c[d].c();o=b(),n=f("p"),n.textContent=`Select the atomic server from your current role configuration.
              🔐 = Authenticated, ⚠️ = Anonymous access`,u(t,"id","atomic-server-select"),t.disabled=l[2],l[11]===void 0&&lt(()=>l[18].call(t)),u(e,"class","select is-fullwidth"),u(n,"class","help svelte-48g63o")},m(d,m){C(d,e,m),r(e,t);for(let p=0;p<c.length;p+=1)c[p]&&c[p].m(t,null);Ee(t,l[11],!0),C(d,o,m),C(d,n,m),a||(s=X(t,"change",l[18]),a=!0)},p(d,m){if(m[0]&1024){i=d[10];let p;for(p=0;p<i.length;p+=1){const _=Sl(d,i,p);c[p]?c[p].p(_,m):(c[p]=Ul(_),c[p].c(),c[p].m(t,null))}for(;p<c.length;p+=1)c[p].d(1);c.length=i.length}m[0]&4&&(t.disabled=d[2]),m[0]&3072&&Ee(t,d[11])},d(d){d&&S(e),Je(c,d),d&&S(o),d&&S(n),a=!1,s()}}}function is(l){let e;return{c(){e=f("span"),e.textContent="⚠️ No Auth",u(e,"class","has-text-warning")},m(t,o){C(t,e,o)},d(t){t&&S(e)}}}function us(l){let e;return{c(){e=f("span"),e.textContent="🔐",u(e,"class","has-text-success")},m(t,o){C(t,e,o)},d(t){t&&S(e)}}}function Ul(l){let e,t=l[36].location+"",o,n,a,s;function i(m,p){return m[36].atomic_server_secret?us:is}let c=i(l),d=c(l);return{c(){e=f("option"),o=J(t),n=b(),d.c(),a=b(),e.__value=s=l[36].location,e.value=e.__value},m(m,p){C(m,e,p),r(e,o),r(e,n),d.m(e,null),r(e,a)},p(m,p){p[0]&1024&&t!==(t=m[36].location+"")&&pe(o,t),c!==(c=i(m))&&(d.d(1),d=c(m),d&&(d.c(),d.m(e,a))),p[0]&1024&&s!==(s=m[36].location)&&(e.__value=s,e.value=e.__value)},d(m){m&&S(e),d.d()}}}function El(l){var $t,Fe;let e,t,o,n,a,s,i,c,d,m,p,_,g,h,k,w,v,$,L,E,z,M,y,N,D,G,j,A,T,te,R,Y,q,W,x,O,B,Q,U,I,V,oe,de,ue=(l[8]||"Untitled")+"",Le,ke,_e,fe,Se,be=(((Fe=($t=l[1])==null?void 0:$t.body)==null?void 0:Fe.length)||0)+"",$e,Ce,ce,me,H,Z,ne=l[14]()+"",F,ee,le,Ae,Ve,Te=l[15]()+"",We,Re,Ue,ot,mt;function nt(se){l[19](se)}let Pe={id:"article-title",placeholder:"Enter article title",disabled:l[2],required:!0};l[8]!==void 0&&(Pe.value=l[8]),a=new Rt({props:Pe}),De.push(()=>Ie(a,"value",nt));const Mt=[fs,cs],Ye=[];function Pt(se,ge){return se[7]?1:0}return G=Pt(l),j=Ye[G]=Mt[G](l),R=new Vt({props:{type:"is-primary",loading:l[2],disabled:l[2]||!l[8].trim()||!l[11],$$slots:{default:[ds]},$$scope:{ctx:l}}}),R.$on("click",l[16]),W=new Vt({props:{type:"is-light",disabled:l[2],$$slots:{default:[ps]},$$scope:{ctx:l}}}),W.$on("click",l[17]),Ue=Zo(l[22][0]),{c(){e=f("div"),t=f("label"),t.textContent="Article Title",o=b(),n=f("div"),re(a.$$.fragment),i=b(),c=f("div"),d=f("label"),d.textContent="Description",m=b(),p=f("div"),_=f("textarea"),g=b(),h=f("div"),k=f("label"),k.textContent="Parent Collection",w=b(),v=f("div"),$=f("label"),L=f("input"),E=J(`
              Use predefined collection`),z=b(),M=f("label"),y=f("input"),N=J(`
              Custom parent URL/path`),D=b(),j.c(),A=b(),T=f("div"),te=f("div"),re(R.$$.fragment),Y=b(),q=f("div"),re(W.$$.fragment),x=b(),O=f("div"),B=f("div"),Q=f("p"),Q.innerHTML="<strong>What will be saved:</strong>",U=b(),I=f("ul"),V=f("li"),oe=f("strong"),oe.textContent="Title:",de=b(),Le=J(ue),ke=b(),_e=f("li"),fe=f("strong"),fe.textContent="Body:",Se=J(" Original document content ("),$e=J(be),Ce=J(" characters)"),ce=b(),me=f("li"),H=f("strong"),H.textContent="Parent:",Z=b(),F=J(ne),ee=b(),le=f("li"),Ae=f("strong"),Ae.textContent="Subject URL:",Ve=b(),We=J(Te),u(t,"class","label"),u(t,"for","article-title"),u(n,"class","control"),u(e,"class","field"),u(d,"class","label"),u(d,"for","article-description"),u(_,"id","article-description"),u(_,"class","textarea"),u(_,"placeholder","Brief description of the article"),_.disabled=l[2],u(_,"rows","3"),u(p,"class","control"),u(c,"class","field"),u(k,"class","label"),u(L,"type","radio"),L.__value=!1,L.value=L.__value,L.disabled=l[2],u($,"class","radio svelte-48g63o"),u(y,"type","radio"),y.__value=!0,y.value=y.__value,y.disabled=l[2],u(M,"class","radio svelte-48g63o"),u(v,"class","control"),u(h,"class","field"),u(te,"class","control"),u(q,"class","control"),u(T,"class","field is-grouped"),u(V,"class","svelte-48g63o"),u(_e,"class","svelte-48g63o"),u(me,"class","svelte-48g63o"),u(le,"class","svelte-48g63o"),u(I,"class","svelte-48g63o"),u(B,"class","notification is-info is-light svelte-48g63o"),u(O,"class","field"),Ue.p(L,y)},m(se,ge){C(se,e,ge),r(e,t),r(e,o),r(e,n),ae(a,n,null),C(se,i,ge),C(se,c,ge),r(c,d),r(c,m),r(c,p),r(p,_),we(_,l[9]),C(se,g,ge),C(se,h,ge),r(h,k),r(h,w),r(h,v),r(v,$),r($,L),L.checked=L.__value===l[7],r($,E),r(v,z),r(v,M),r(M,y),y.checked=y.__value===l[7],r(M,N),C(se,D,ge),Ye[G].m(se,ge),C(se,A,ge),C(se,T,ge),r(T,te),ae(R,te,null),r(T,Y),r(T,q),ae(W,q,null),C(se,x,ge),C(se,O,ge),r(O,B),r(B,Q),r(B,U),r(B,I),r(I,V),r(V,oe),r(V,de),r(V,Le),r(I,ke),r(I,_e),r(_e,fe),r(_e,Se),r(_e,$e),r(_e,Ce),r(I,ce),r(I,me),r(me,H),r(me,Z),r(me,F),r(I,ee),r(I,le),r(le,Ae),r(le,Ve),r(le,We),Re=!0,ot||(mt=[X(_,"input",l[20]),X(L,"change",l[21]),X(y,"change",l[23])],ot=!0)},p(se,ge){var wt,jt;const ht={};ge[0]&4&&(ht.disabled=se[2]),!s&&ge[0]&256&&(s=!0,ht.value=se[8],He(()=>s=!1)),a.$set(ht),(!Re||ge[0]&4)&&(_.disabled=se[2]),ge[0]&512&&we(_,se[9]),(!Re||ge[0]&4)&&(L.disabled=se[2]),ge[0]&128&&(L.checked=L.__value===se[7]),(!Re||ge[0]&4)&&(y.disabled=se[2]),ge[0]&128&&(y.checked=y.__value===se[7]);let at=G;G=Pt(se),G===at?Ye[G].p(se,ge):(Ne(),K(Ye[at],1,1,()=>{Ye[at]=null}),Oe(),j=Ye[G],j?j.p(se,ge):(j=Ye[G]=Mt[G](se),j.c()),P(j,1),j.m(A.parentNode,A));const st={};ge[0]&4&&(st.loading=se[2]),ge[0]&2308&&(st.disabled=se[2]||!se[8].trim()||!se[11]),ge[1]&2048&&(st.$$scope={dirty:ge,ctx:se}),R.$set(st);const Lt={};ge[0]&4&&(Lt.disabled=se[2]),ge[1]&2048&&(Lt.$$scope={dirty:ge,ctx:se}),W.$set(Lt),(!Re||ge[0]&256)&&ue!==(ue=(se[8]||"Untitled")+"")&&pe(Le,ue),(!Re||ge[0]&2)&&be!==(be=(((jt=(wt=se[1])==null?void 0:wt.body)==null?void 0:jt.length)||0)+"")&&pe($e,be)},i(se){Re||(P(a.$$.fragment,se),P(j),P(R.$$.fragment,se),P(W.$$.fragment,se),Re=!0)},o(se){K(a.$$.fragment,se),K(j),K(R.$$.fragment,se),K(W.$$.fragment,se),Re=!1},d(se){se&&S(e),ie(a),se&&S(i),se&&S(c),se&&S(g),se&&S(h),se&&S(D),Ye[G].d(se),se&&S(A),se&&S(T),ie(R),ie(W),se&&S(x),se&&S(O),Ue.r(),ot=!1,ze(mt)}}}function cs(l){let e,t,o,n,a,s,i;function c(m){l[25](m)}let d={placeholder:"e.g., my-collection or http://server/custom-parent",disabled:l[2]};return l[6]!==void 0&&(d.value=l[6]),o=new Rt({props:d}),De.push(()=>Ie(o,"value",c)),{c(){e=f("div"),t=f("div"),re(o.$$.fragment),a=b(),s=f("p"),s.textContent=`Enter a collection name (e.g., "my-articles") or full URL. 
              If the collection doesn't exist, it will be created.`,u(t,"class","control"),u(s,"class","help svelte-48g63o"),u(e,"class","field")},m(m,p){C(m,e,p),r(e,t),ae(o,t,null),r(e,a),r(e,s),i=!0},p(m,p){const _={};p[0]&4&&(_.disabled=m[2]),!n&&p[0]&64&&(n=!0,_.value=m[6],He(()=>n=!1)),o.$set(_)},i(m){i||(P(o.$$.fragment,m),i=!0)},o(m){K(o.$$.fragment,m),i=!1},d(m){m&&S(e),ie(o)}}}function fs(l){let e,t,o,n,a,s,i=l[13],c=[];for(let d=0;d<i.length;d+=1)c[d]=Dl(yl(l,i,d));return{c(){e=f("div"),t=f("div"),o=f("div"),n=f("select");for(let d=0;d<c.length;d+=1)c[d].c();n.disabled=l[2],l[5]===void 0&&lt(()=>l[24].call(n)),u(o,"class","select is-fullwidth"),u(t,"class","control"),u(e,"class","field")},m(d,m){C(d,e,m),r(e,t),r(t,o),r(o,n);for(let p=0;p<c.length;p+=1)c[p]&&c[p].m(n,null);Ee(n,l[5],!0),a||(s=X(n,"change",l[24]),a=!0)},p(d,m){if(m[0]&8192){i=d[13];let p;for(p=0;p<i.length;p+=1){const _=yl(d,i,p);c[p]?c[p].p(_,m):(c[p]=Dl(_),c[p].c(),c[p].m(n,null))}for(;p<c.length;p+=1)c[p].d(1);c.length=i.length}m[0]&4&&(n.disabled=d[2]),m[0]&8224&&Ee(n,d[5])},i:ve,o:ve,d(d){d&&S(e),Je(c,d),a=!1,s()}}}function Dl(l){let e,t=l[33].label+"",o;return{c(){e=f("option"),o=J(t),e.__value=l[33].value,e.value=e.__value},m(n,a){C(n,e,a),r(e,o)},p:ve,d(n){n&&S(e)}}}function ds(l){let e,t,o;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-cloud-upload-alt"></i>',t=b(),o=f("span"),o.textContent="Save to Atomic Server",u(e,"class","icon")},m(n,a){C(n,e,a),C(n,t,a),C(n,o,a)},p:ve,d(n){n&&S(e),n&&S(t),n&&S(o)}}}function ps(l){let e;return{c(){e=J("Cancel")},m(t,o){C(t,e,o)},d(t){t&&S(e)}}}function _s(l){let e,t,o,n,a,s,i,c,d,m,p,_,g,h=l[4]&&Tl(l),k=l[3]&&Rl(l),w=!l[4]&&Ll(l);return{c(){e=f("div"),t=f("div"),o=f("div"),o.innerHTML=`<div class="level-item"><h3 class="title is-4"><span class="icon"><i class="fas fa-save"></i></span>
            Save to Atomic Server</h3></div>`,n=b(),a=f("div"),s=f("div"),i=f("button"),c=b(),h&&h.c(),d=b(),k&&k.c(),m=b(),w&&w.c(),u(o,"class","level-left"),u(i,"class","delete is-large"),i.disabled=l[2],u(i,"aria-label","close"),u(s,"class","level-item"),u(a,"class","level-right"),u(t,"class","level svelte-48g63o"),u(e,"class","box")},m(v,$){C(v,e,$),r(e,t),r(t,o),r(t,n),r(t,a),r(a,s),r(s,i),r(e,c),h&&h.m(e,null),r(e,d),k&&k.m(e,null),r(e,m),w&&w.m(e,null),p=!0,_||(g=X(i,"click",l[17]),_=!0)},p(v,$){(!p||$[0]&4)&&(i.disabled=v[2]),v[4]?h?$[0]&16&&P(h,1):(h=Tl(v),h.c(),P(h,1),h.m(e,d)):h&&(Ne(),K(h,1,1,()=>{h=null}),Oe()),v[3]?k?(k.p(v,$),$[0]&8&&P(k,1)):(k=Rl(v),k.c(),P(k,1),k.m(e,m)):k&&(Ne(),K(k,1,1,()=>{k=null}),Oe()),v[4]?w&&(Ne(),K(w,1,1,()=>{w=null}),Oe()):w?(w.p(v,$),$[0]&16&&P(w,1)):(w=Ll(v),w.c(),P(w,1),w.m(e,null))},i(v){p||(P(h),P(k),P(w),p=!0)},o(v){K(h),K(k),K(w),p=!1},d(v){v&&S(e),h&&h.d(),k&&k.d(),w&&w.d(),_=!1,g()}}}function ms(l){let e,t,o;function n(s){l[26](s)}let a={$$slots:{default:[_s]},$$scope:{ctx:l}};return l[0]!==void 0&&(a.active=l[0]),e=new nl({props:a}),De.push(()=>Ie(e,"active",n)),e.$on("close",l[17]),{c(){re(e.$$.fragment)},m(s,i){ae(e,s,i),o=!0},p(s,i){const c={};i[0]&8190|i[1]&2048&&(c.$$scope={dirty:i,ctx:s}),!t&&i[0]&1&&(t=!0,c.active=s[0],He(()=>t=!1)),e.$set(c)},i(s){o||(P(e.$$.fragment,s),o=!0)},o(s){K(e.$$.fragment,s),o=!1},d(s){ie(e,s)}}}function hs(l,e,t){let o,n,a;ye(l,Qe,O=>t(27,o=O)),ye(l,tt,O=>t(28,n=O)),ye(l,ct,O=>t(12,a=O));let{active:s=!1}=e,{document:i}=e,c=!1,d=null,m=!1,p="",_="",g=!1,h="",k="",w=[],v="";const $=[{label:"Root (Server Root)",value:""},{label:"Articles Collection",value:"articles"},{label:"Documents Collection",value:"documents"},{label:"Knowledge Base",value:"knowledge-base"},{label:"Research",value:"research"},{label:"Projects",value:"projects"}];function L(){t(2,c=!1),t(3,d=null),t(4,m=!1),t(5,p=""),t(6,_=""),t(7,g=!1),t(8,h=(i==null?void 0:i.title)||""),t(9,k=(i==null?void 0:i.description)||`Article saved from Terraphim search: ${i==null?void 0:i.title}`),t(10,w=[]),t(11,v="")}function E(){var U;const O=a,B=n;if(!(B!=null&&B.roles)||!O){console.warn("No role configuration found");return}let Q=null;try{for(const[I,V]of Object.entries(B.roles)){const oe=V,de=typeof oe.name=="object"?oe.name.original:String(oe.name);if(I===O||de===O){Q=oe;break}}}catch(I){console.warn("Error checking role configuration:",I);return}if(!Q){console.warn(`Role "${O}" not found in configuration`);return}t(10,w=((U=Q.haystacks)==null?void 0:U.filter(I=>I.service==="Atomic"&&I.location&&!I.read_only))||[]),w.length>0&&t(11,v=w[0].location),console.log("Loaded atomic servers:",w)}function z(){const O=w.find(B=>B.location===v);return O==null?void 0:O.atomic_server_secret}function M(){const O=v.replace(/\/$/,"");if(g&&_.trim()){const B=_.trim();return B.startsWith("http://")||B.startsWith("https://")?B:`${O}/${B.replace(/^\//,"")}`}else return p?`${O}/${p}`:O}function y(){return h.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,50)}function N(){const O=v.replace(/\/$/,""),B=y(),Q=Date.now();return`${O}/${B}-${Q}`}async function D(){if(!v||!h.trim()){t(3,d="Please select an atomic server and provide a title");return}t(2,c=!0),t(3,d=null);try{const O=N(),B=M(),Q=z();console.log("🔄 Saving article to atomic server:",{subject:O,parent:B,server:v,hasSecret:!!Q});const U={subject:O,title:h.trim(),description:k.trim(),body:i.body,parent:B,shortname:y(),original_id:i.id,original_url:i.url,original_rank:i.rank,tags:i.tags||[]};if(o)await je("save_article_to_atomic",{article:U,serverUrl:v,atomicSecret:Q});else{const I=await fetch(`${et.ServerURL}/atomic/save`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({article:U,server_url:v,atomic_secret:Q})});if(!I.ok){const V=await I.json().catch(()=>({error:I.statusText}));throw new Error(V.error||`HTTP ${I.status}: ${I.statusText}`)}}t(4,m=!0),console.log("✅ Article saved successfully to atomic server"),setTimeout(()=>{t(0,s=!1)},2e3)}catch(O){console.error("❌ Failed to save article to atomic server:",O),t(3,d=O.message||"Failed to save article to atomic server")}finally{t(2,c=!1)}}function G(){c||t(0,s=!1)}const j=[[]];function A(){v=vt(this),t(11,v),t(10,w)}function T(O){h=O,t(8,h)}function te(){k=this.value,t(9,k)}function R(){g=this.__value,t(7,g)}function Y(){g=this.__value,t(7,g)}function q(){p=vt(this),t(5,p),t(13,$)}function W(O){_=O,t(6,_)}function x(O){s=O,t(0,s)}return l.$$set=O=>{"active"in O&&t(0,s=O.active),"document"in O&&t(1,i=O.document)},l.$$.update=()=>{l.$$.dirty[0]&3&&s&&i&&(L(),E())},[s,i,c,d,m,p,_,g,h,k,w,v,a,$,M,N,D,G,A,T,te,R,j,Y,q,W,x]}class gs extends Ze{constructor(e){super(),Xe(this,e,hs,ms,qe,{active:0,document:1},null,[-1,-1])}}async function Po(l){return je("tauri",l)}async function vs(l,e){return Po({__tauriModule:"Event",message:{cmd:"unlisten",event:l,eventId:e}})}async function bs(l,e,t){return Po({__tauriModule:"Event",message:{cmd:"listen",event:l,windowLabel:e,handler:ll(t)}}).then(o=>async()=>vs(l,o))}var Ml;(function(l){l.WINDOW_RESIZED="tauri://resize",l.WINDOW_MOVED="tauri://move",l.WINDOW_CLOSE_REQUESTED="tauri://close-requested",l.WINDOW_CREATED="tauri://window-created",l.WINDOW_DESTROYED="tauri://destroyed",l.WINDOW_FOCUS="tauri://focus",l.WINDOW_BLUR="tauri://blur",l.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",l.WINDOW_THEME_CHANGED="tauri://theme-changed",l.WINDOW_FILE_DROP="tauri://file-drop",l.WINDOW_FILE_DROP_HOVER="tauri://file-drop-hover",l.WINDOW_FILE_DROP_CANCELLED="tauri://file-drop-cancelled",l.MENU="tauri://menu",l.CHECK_UPDATE="tauri://update",l.UPDATE_AVAILABLE="tauri://update-available",l.INSTALL_UPDATE="tauri://update-install",l.STATUS_UPDATE="tauri://update-status",l.DOWNLOAD_PROGRESS="tauri://update-download-progress"})(Ml||(Ml={}));async function ks(l,e){return bs(l,null,e)}function Pl(l,e,t){const o=l.slice();return o[9]=e[t],o}function jl(l){let e,t=l[9].name+"",o,n;return{c(){e=f("option"),o=J(t),e.__value=n=l[9].name,e.value=e.__value},m(a,s){C(a,e,s),r(e,o)},p(a,s){s&1&&t!==(t=a[9].name+"")&&pe(o,t),s&1&&n!==(n=a[9].name)&&(e.__value=n,e.value=e.__value)},d(a){a&&S(e)}}}function $s(l){let e,t,o,n,a,s,i=l[0],c=[];for(let d=0;d<i.length;d+=1)c[d]=jl(Pl(l,i,d));return{c(){e=f("div"),t=f("div"),o=f("div"),n=f("select");for(let d=0;d<c.length;d+=1)c[d].c();u(o,"class","select"),u(t,"class","control"),u(e,"class","field is-grouped is-grouped-right")},m(d,m){C(d,e,m),r(e,t),r(t,o),r(o,n);for(let p=0;p<c.length;p+=1)c[p]&&c[p].m(n,null);Ee(n,l[1]),a||(s=X(n,"change",l[2]),a=!0)},p(d,[m]){if(m&1){i=d[0];let p;for(p=0;p<i.length;p+=1){const _=Pl(d,i,p);c[p]?c[p].p(_,m):(c[p]=jl(_),c[p].c(),c[p].m(n,null))}for(;p<c.length;p+=1)c[p].d(1);c.length=i.length}m&3&&Ee(n,d[1])},i:ve,o:ve,d(d){d&&S(e),Je(c,d),a=!1,s()}}}function ws(l,e,t){let o,n,a,s;ye(l,tt,_=>t(5,o=_)),ye(l,Qe,_=>t(6,n=_)),ye(l,gl,_=>t(0,a=_)),ye(l,ct,_=>t(1,s=_));let i="";async function c(){try{Qe.set(window.__TAURI__!==void 0),n?(console.log("Loading config from Tauri"),je("get_config").then(_=>{console.log("get_config response",_),_&&_.status==="success"&&d(_.config)}).catch(_=>console.error("Error fetching config in Tauri:",_))):(console.log("Loading config from server"),i=`${et.ServerURL}/config/`,fetch(i).then(_=>_.json()).then(_=>{console.log("Config received",_),_&&_.status==="success"&&d(_.config)}).catch(_=>console.error("Error fetching config:",_)))}catch(_){console.error("Unhandled error in loadConfig:",_)}}function d(_){var w;console.log("Updating stores from config:",_);const g={default_role:_.selected_role,..._};tt.set(g);const h=Object.entries(_.roles).map(([v,$])=>({name:v,...$}));gl.set(h),ct.set(_.selected_role);const k=_.roles[_.selected_role];if(console.log("Selected role settings:",k),k){const v=k.theme||"spacelab";console.log("Setting theme to:",v),Ht.set(v),(w=k.kg)!=null&&w.publish?n&&je("publish_thesaurus",{roleName:_.selected_role}).then($=>{console.log("publish_thesaurus response",$),tl.set($),It.set(!0)}):It.set(!1)}else console.warn("No role settings found for:",_.selected_role),Ht.set("spacelab")}typeof window<"u"&&window.__TAURI__&&ks("role_changed",_=>{console.log("Role changed event received from backend:",_.payload),d(_.payload)});async function m(){await c()}m(),console.log("Using Terraphim Server URL:",et.ServerURL);function p(_){var v;const h=_.target.value;console.log("Role change requested:",h),ct.set(h);const k=a.find($=>$.name===h);if(!k){console.error(`No role settings found for role: ${h}.`);return}const w=k.theme||"spacelab";Ht.set(w),console.log(`Theme changed to ${w}`),tt.update($=>($.selected_role=h,$)),n?(je("select_role",{roleName:h}).catch($=>console.error("Error selecting role:",$)),(v=k.kg)!=null&&v.publish?(console.log("Publishing thesaurus for role",h),je("publish_thesaurus",{roleName:h}).then($=>{tl.set($),It.set(!0)})):It.set(!1)):fetch(`${et.ServerURL}/config/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).catch($=>console.error("Error updating config on server:",$))}return[a,s,p,c]}class Jt extends Ze{constructor(e){super(),Xe(this,e,ws,$s,qe,{loadConfig:3})}get loadConfig(){return this.$$.ctx[3]}}function Il(l,e,t){const o=l.slice();return o[33]=e[t],o}function Hl(l,e,t){const o=l.slice();return o[36]=e[t],o}function Fl(l){let e,t;return e=new Ao({props:{$$slots:{default:[Ss]},$$scope:{ctx:l}}}),{c(){re(e.$$.fragment)},m(o,n){ae(e,o,n),t=!0},p(o,n){const a={};n[0]&129|n[1]&256&&(a.$$scope={dirty:n,ctx:o}),e.$set(a)},i(o){t||(P(e.$$.fragment,o),t=!0)},o(o){K(e.$$.fragment,o),t=!1},d(o){ie(e,o)}}}function ys(l){let e=l[36]+"",t;return{c(){t=J(e)},m(o,n){C(o,t,n)},p(o,n){n[0]&1&&e!==(e=o[36]+"")&&pe(t,e)},d(o){o&&S(t)}}}function Gl(l){let e,t,o,n,a,s;t=new Uo({props:{rounded:!0,$$slots:{default:[ys]},$$scope:{ctx:l}}});function i(){return l[18](l[36])}return{c(){e=f("button"),re(t.$$.fragment),o=b(),u(e,"class","tag-button svelte-2smypa"),e.disabled=l[7],u(e,"title","Click to view knowledge graph document")},m(c,d){C(c,e,d),ae(t,e,null),r(e,o),n=!0,a||(s=X(e,"click",i),a=!0)},p(c,d){l=c;const m={};d[0]&1|d[1]&256&&(m.$$scope={dirty:d,ctx:l}),t.$set(m),(!n||d[0]&128)&&(e.disabled=l[7])},i(c){n||(P(t.$$.fragment,c),n=!0)},o(c){K(t.$$.fragment,c),n=!1},d(c){c&&S(e),ie(t),a=!1,s()}}}function Ss(l){let e,t,o=l[0].tags,n=[];for(let s=0;s<o.length;s+=1)n[s]=Gl(Hl(l,o,s));const a=s=>K(n[s],1,1,()=>{n[s]=null});return{c(){for(let s=0;s<n.length;s+=1)n[s].c();e=xe()},m(s,i){for(let c=0;c<n.length;c+=1)n[c]&&n[c].m(s,i);C(s,e,i),t=!0},p(s,i){if(i[0]&65665){o=s[0].tags;let c;for(c=0;c<o.length;c+=1){const d=Hl(s,o,c);n[c]?(n[c].p(d,i),P(n[c],1)):(n[c]=Gl(d),n[c].c(),P(n[c],1),n[c].m(e.parentNode,e))}for(Ne(),c=o.length;c<n.length;c+=1)a(c);Oe()}},i(s){if(!t){for(let i=0;i<o.length;i+=1)P(n[i]);t=!0}},o(s){n=n.filter(Boolean);for(let i=0;i<n.length;i+=1)K(n[i]);t=!1},d(s){Je(n,s),s&&S(e)}}}function Cs(l){let e,t=l[0].rank+"",o;return{c(){e=J("Rank "),o=J(t)},m(n,a){C(n,e,a),C(n,o,a)},p(n,a){a[0]&1&&t!==(t=n[0].rank+"")&&pe(o,t)},d(n){n&&S(e),n&&S(o)}}}function Ts(l){let e,t;return e=new Uo({props:{rounded:!0,$$slots:{default:[Cs]},$$scope:{ctx:l}}}),{c(){re(e.$$.fragment)},m(o,n){ae(e,o,n),t=!0},p(o,n){const a={};n[0]&1|n[1]&256&&(a.$$scope={dirty:n,ctx:o}),e.$set(a)},i(o){t||(P(e.$$.fragment,o),t=!0)},o(o){K(e.$$.fragment,o),t=!1},d(o){ie(e,o)}}}function Rs(l){let e;return{c(){e=f("small"),e.textContent="No description available",u(e,"class","no-description svelte-2smypa")},m(t,o){C(t,e,o)},p:ve,i:ve,o:ve,d(t){t&&S(e)}}}function Ls(l){let e,t;return e=new Zt({props:{source:l[0].description}}),{c(){re(e.$$.fragment)},m(o,n){ae(e,o,n),t=!0},p(o,n){const a={};n[0]&1&&(a.source=o[0].description),e.$set(a)},i(o){t||(P(e.$$.fragment,o),t=!0)},o(o){K(e.$$.fragment,o),t=!1},d(o){ie(e,o)}}}function Kl(l){let e,t,o,n,a,s;return{c(){e=f("button"),t=f("span"),t.innerHTML='<i class="fas fa-magic" aria-hidden="true"></i>',o=b(),n=f("span"),n.textContent="AI Summary",u(t,"class","icon is-small"),u(e,"class","button is-small is-info is-outlined ai-summary-button svelte-2smypa"),e.disabled=l[9],u(e,"title","Generate AI-powered summary using OpenRouter")},m(i,c){C(i,e,c),r(e,t),r(e,o),r(e,n),a||(s=X(e,"click",l[17]),a=!0)},p(i,c){c[0]&512&&(e.disabled=i[9])},d(i){i&&S(e),a=!1,s()}}}function zl(l){let e;return{c(){e=f("div"),e.innerHTML=`<span class="icon"><i class="fas fa-spinner fa-spin" aria-hidden="true"></i></span> 
                <small>Generating AI summary...</small>`,u(e,"class","ai-summary-loading svelte-2smypa")},m(t,o){C(t,e,o)},d(t){t&&S(e)}}}function Wl(l){let e,t,o,n,a,s,i,c,d,m;return{c(){e=f("div"),t=f("span"),t.innerHTML='<i class="fas fa-exclamation-triangle" aria-hidden="true"></i>',o=b(),n=f("small"),a=J("Summary error: "),s=J(l[10]),i=b(),c=f("button"),c.textContent="Retry",u(t,"class","icon has-text-danger"),u(n,"class","has-text-danger"),u(c,"class","button is-small is-text svelte-2smypa"),u(c,"title","Retry generating summary"),u(e,"class","ai-summary-error svelte-2smypa")},m(p,_){C(p,e,_),r(e,t),r(e,o),r(e,n),r(n,a),r(n,s),r(e,i),r(e,c),d||(m=X(c,"click",l[19]),d=!0)},p(p,_){_[0]&1024&&pe(s,p[10])},d(p){p&&S(e),d=!1,m()}}}function Bl(l){let e,t,o,n,a,s,i,c,d,m,p,_,g,h,k,w,v,$,L,E;function z(N,D){return N[12]?Os:Ns}let M=z(l),y=M(l);return m=new Zt({props:{source:l[8]}}),{c(){e=f("div"),t=f("div"),o=f("small"),n=f("span"),n.innerHTML='<i class="fas fa-robot" aria-hidden="true"></i>',a=J(`
                    AI Summary
                    `),y.c(),s=b(),i=f("button"),i.innerHTML='<span class="icon is-small"><i class="fas fa-times" aria-hidden="true"></i></span>',c=b(),d=f("div"),re(m.$$.fragment),p=b(),_=f("div"),g=f("button"),h=f("span"),h.innerHTML='<i class="fas fa-redo" aria-hidden="true"></i>',k=b(),w=f("span"),w.textContent="Regenerate",u(n,"class","icon is-small"),u(o,"class","ai-summary-label svelte-2smypa"),u(i,"class","button is-small is-text svelte-2smypa"),u(i,"title","Hide AI summary"),u(t,"class","ai-summary-header svelte-2smypa"),u(d,"class","ai-summary-content svelte-2smypa"),u(h,"class","icon is-small"),u(g,"class","button is-small is-text svelte-2smypa"),g.disabled=l[9],u(g,"title","Regenerate summary"),u(_,"class","ai-summary-actions svelte-2smypa"),u(e,"class","ai-summary svelte-2smypa")},m(N,D){C(N,e,D),r(e,t),r(t,o),r(o,n),r(o,a),y.m(o,null),r(t,s),r(t,i),r(e,c),r(e,d),ae(m,d,null),r(e,p),r(e,_),r(_,g),r(g,h),r(g,k),r(g,w),$=!0,L||(E=[X(i,"click",l[20]),X(g,"click",l[21])],L=!0)},p(N,D){M!==(M=z(N))&&(y.d(1),y=M(N),y&&(y.c(),y.m(o,null)));const G={};D[0]&256&&(G.source=N[8]),m.$set(G),(!$||D[0]&512)&&(g.disabled=N[9])},i(N){$||(P(m.$$.fragment,N),lt(()=>{$&&(v||(v=Et(e,Dt,{},!0)),v.run(1))}),$=!0)},o(N){K(m.$$.fragment,N),v||(v=Et(e,Dt,{},!1)),v.run(0),$=!1},d(N){N&&S(e),y.d(),ie(m),N&&v&&v.end(),L=!1,ze(E)}}}function Ns(l){let e;return{c(){e=f("span"),e.textContent="fresh",u(e,"class","tag is-small is-success")},m(t,o){C(t,e,o)},d(t){t&&S(e)}}}function Os(l){let e;return{c(){e=f("span"),e.textContent="cached",u(e,"class","tag is-small is-light")},m(t,o){C(t,e,o)},d(t){t&&S(e)}}}function ql(l){let e;function t(a,s){return a[33].disabled?Es:a[33].isLink?Us:As}let o=t(l),n=o(l);return{c(){n.c(),e=xe()},m(a,s){n.m(a,s),C(a,e,s)},p(a,s){o===(o=t(a))&&n?n.p(a,s):(n.d(1),n=o(a),n&&(n.c(),n.m(e.parentNode,e)))},d(a){n.d(a),a&&S(e)}}}function As(l){let e,t,o,n,a,s,i,c,d;return{c(){e=f("button"),t=f("span"),o=f("i"),a=b(),u(o,"class",n=ft(l[33].icon)+" svelte-2smypa"),u(t,"class","icon is-medium"),dt(t,"has-text-primary",l[33].className),u(e,"type","button"),u(e,"class","level-item button is-ghost svelte-2smypa"),u(e,"aria-label",s=l[33].title),u(e,"title",i=l[33].title)},m(m,p){C(m,e,p),r(e,t),r(t,o),r(e,a),c||(d=X(e,"click",function(){Xo(l[33].action)&&l[33].action.apply(this,arguments)}),c=!0)},p(m,p){l=m,p[0]&16384&&n!==(n=ft(l[33].icon)+" svelte-2smypa")&&u(o,"class",n),p[0]&16384&&dt(t,"has-text-primary",l[33].className),p[0]&16384&&s!==(s=l[33].title)&&u(e,"aria-label",s),p[0]&16384&&i!==(i=l[33].title)&&u(e,"title",i)},d(m){m&&S(e),c=!1,d()}}}function Us(l){let e,t,o,n,a,s,i,c;return{c(){e=f("a"),t=f("span"),o=f("i"),a=b(),u(o,"class",n=ft(l[33].icon)+" svelte-2smypa"),u(t,"class","icon is-medium"),dt(t,"has-text-primary",l[33].className),u(e,"href",s=l[33].href),u(e,"target","_blank"),u(e,"class","level-item"),u(e,"aria-label",i=l[33].title),u(e,"title",c=l[33].title)},m(d,m){C(d,e,m),r(e,t),r(t,o),r(e,a)},p(d,m){m[0]&16384&&n!==(n=ft(d[33].icon)+" svelte-2smypa")&&u(o,"class",n),m[0]&16384&&dt(t,"has-text-primary",d[33].className),m[0]&16384&&s!==(s=d[33].href)&&u(e,"href",s),m[0]&16384&&i!==(i=d[33].title)&&u(e,"aria-label",i),m[0]&16384&&c!==(c=d[33].title)&&u(e,"title",c)},d(d){d&&S(e)}}}function Es(l){let e,t,o,n,a,s,i;return{c(){e=f("button"),t=f("span"),o=f("i"),a=b(),u(o,"class",n=ft(l[33].icon)+" svelte-2smypa"),u(t,"class","icon is-medium"),dt(t,"has-text-primary",l[33].className),u(e,"type","button"),u(e,"class","level-item button is-ghost svelte-2smypa"),u(e,"aria-label",s=l[33].title),u(e,"title",i=l[33].title),e.disabled=!0},m(c,d){C(c,e,d),r(e,t),r(t,o),r(e,a)},p(c,d){d[0]&16384&&n!==(n=ft(c[33].icon)+" svelte-2smypa")&&u(o,"class",n),d[0]&16384&&dt(t,"has-text-primary",c[33].className),d[0]&16384&&s!==(s=c[33].title)&&u(e,"aria-label",s),d[0]&16384&&i!==(i=c[33].title)&&u(e,"title",i)},d(c){c&&S(e)}}}function Jl(l){let e,t=l[33].visible&&ql(l);return{c(){t&&t.c(),e=xe()},m(o,n){t&&t.m(o,n),C(o,e,n)},p(o,n){o[33].visible?t?t.p(o,n):(t=ql(o),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(o){t&&t.d(o),o&&S(e)}}}function Vl(l){let e,t,o;function n(s){l[23](s)}let a={item:l[4],kgTerm:l[5],kgRank:l[6]};return l[2]!==void 0&&(a.active=l[2]),e=new sl({props:a}),De.push(()=>Ie(e,"active",n)),{c(){re(e.$$.fragment)},m(s,i){ae(e,s,i),o=!0},p(s,i){const c={};i[0]&16&&(c.item=s[4]),i[0]&32&&(c.kgTerm=s[5]),i[0]&64&&(c.kgRank=s[6]),!t&&i[0]&4&&(t=!0,c.active=s[2],He(()=>t=!1)),e.$set(c)},i(s){o||(P(e.$$.fragment,s),o=!0)},o(s){K(e.$$.fragment,s),o=!1},d(s){ie(e,s)}}}function Yl(l){let e,t,o;function n(s){l[24](s)}let a={document:l[0]};return l[3]!==void 0&&(a.active=l[3]),e=new gs({props:a}),De.push(()=>Ie(e,"active",n)),{c(){re(e.$$.fragment)},m(s,i){ae(e,s,i),o=!0},p(s,i){const c={};i[0]&1&&(c.document=s[0]),!t&&i[0]&8&&(t=!0,c.active=s[3],He(()=>t=!1)),e.$set(c)},i(s){o||(P(e.$$.fragment,s),o=!0)},o(s){K(e.$$.fragment,s),o=!1},d(s){ie(e,s)}}}function Ds(l){let e,t,o,n,a,s,i,c,d,m,p,_,g=l[0].title+"",h,k,w,v,$,L,E,z,M,y,N,D,G,j,A,T,te,R,Y,q,W,x,O,B,Q,U,I,V,oe,de,ue=l[0].tags&&Fl(l);c=new Ao({props:{$$slots:{default:[Ts]},$$scope:{ctx:l}}});const Le=[Ls,Rs],ke=[];function _e(F,ee){return F[0].description?0:1}E=_e(l),z=ke[E]=Le[E](l);let fe=!l[11]&&!l[9]&&!l[10]&&Kl(l),Se=l[9]&&zl(),be=l[10]&&Wl(l),$e=l[11]&&l[8]&&Bl(l),Ce=l[14],ce=[];for(let F=0;F<Ce.length;F+=1)ce[F]=Jl(Il(l,Ce,F));function me(F){l[22](F)}let H={item:l[0]};l[1]!==void 0&&(H.active=l[1]),O=new sl({props:H}),De.push(()=>Ie(O,"active",me));let Z=l[4]&&Vl(l),ne=l[13]&&Yl(l);return{c(){e=f("div"),t=f("article"),o=f("div"),n=f("div"),a=f("div"),ue&&ue.c(),s=b(),i=f("div"),re(c.$$.fragment),d=b(),m=f("div"),p=f("button"),_=f("h2"),h=J(g),k=b(),w=f("div"),v=f("small"),v.textContent="Description:",$=b(),L=f("div"),z.c(),M=b(),y=f("div"),fe&&fe.c(),N=b(),Se&&Se.c(),D=b(),be&&be.c(),G=b(),$e&&$e.c(),j=b(),A=f("br"),te=b(),R=f("div"),Y=f("nav"),q=f("div");for(let F=0;F<ce.length;F+=1)ce[F].c();x=b(),re(O.$$.fragment),Q=b(),Z&&Z.c(),U=b(),ne&&ne.c(),I=xe(),u(a,"class","level-right"),u(i,"class","level-right"),u(_,"class","title svelte-2smypa"),u(p,"class","svelte-2smypa"),u(v,"class","description-label svelte-2smypa"),u(L,"class","description-content svelte-2smypa"),u(w,"class","description svelte-2smypa"),u(y,"class","ai-summary-section svelte-2smypa"),u(n,"class","content"),u(q,"class","level-right"),u(Y,"class","level is-mobile"),u(R,"class","level-right"),u(o,"class","media-content"),u(t,"class","media"),u(e,"class","box")},m(F,ee){C(F,e,ee),r(e,t),r(t,o),r(o,n),r(n,a),ue&&ue.m(a,null),r(n,s),r(n,i),ae(c,i,null),r(n,d),r(n,m),r(m,p),r(p,_),r(_,h),r(m,k),r(m,w),r(w,v),r(w,$),r(w,L),ke[E].m(L,null),r(m,M),r(m,y),fe&&fe.m(y,null),r(y,N),Se&&Se.m(y,null),r(y,D),be&&be.m(y,null),r(y,G),$e&&$e.m(y,null),r(m,j),r(m,A),r(o,te),r(o,R),r(R,Y),r(Y,q);for(let le=0;le<ce.length;le+=1)ce[le]&&ce[le].m(q,null);C(F,x,ee),ae(O,F,ee),C(F,Q,ee),Z&&Z.m(F,ee),C(F,U,ee),ne&&ne.m(F,ee),C(F,I,ee),V=!0,oe||(de=X(p,"click",l[15]),oe=!0)},p(F,ee){F[0].tags?ue?(ue.p(F,ee),ee[0]&1&&P(ue,1)):(ue=Fl(F),ue.c(),P(ue,1),ue.m(a,null)):ue&&(Ne(),K(ue,1,1,()=>{ue=null}),Oe());const le={};ee[0]&1|ee[1]&256&&(le.$$scope={dirty:ee,ctx:F}),c.$set(le),(!V||ee[0]&1)&&g!==(g=F[0].title+"")&&pe(h,g);let Ae=E;if(E=_e(F),E===Ae?ke[E].p(F,ee):(Ne(),K(ke[Ae],1,1,()=>{ke[Ae]=null}),Oe(),z=ke[E],z?z.p(F,ee):(z=ke[E]=Le[E](F),z.c()),P(z,1),z.m(L,null)),!F[11]&&!F[9]&&!F[10]?fe?fe.p(F,ee):(fe=Kl(F),fe.c(),fe.m(y,N)):fe&&(fe.d(1),fe=null),F[9]?Se||(Se=zl(),Se.c(),Se.m(y,D)):Se&&(Se.d(1),Se=null),F[10]?be?be.p(F,ee):(be=Wl(F),be.c(),be.m(y,G)):be&&(be.d(1),be=null),F[11]&&F[8]?$e?($e.p(F,ee),ee[0]&2304&&P($e,1)):($e=Bl(F),$e.c(),P($e,1),$e.m(y,null)):$e&&(Ne(),K($e,1,1,()=>{$e=null}),Oe()),ee[0]&16384){Ce=F[14];let Te;for(Te=0;Te<Ce.length;Te+=1){const We=Il(F,Ce,Te);ce[Te]?ce[Te].p(We,ee):(ce[Te]=Jl(We),ce[Te].c(),ce[Te].m(q,null))}for(;Te<ce.length;Te+=1)ce[Te].d(1);ce.length=Ce.length}const Ve={};ee[0]&1&&(Ve.item=F[0]),!B&&ee[0]&2&&(B=!0,Ve.active=F[1],He(()=>B=!1)),O.$set(Ve),F[4]?Z?(Z.p(F,ee),ee[0]&16&&P(Z,1)):(Z=Vl(F),Z.c(),P(Z,1),Z.m(U.parentNode,U)):Z&&(Ne(),K(Z,1,1,()=>{Z=null}),Oe()),F[13]?ne?(ne.p(F,ee),ee[0]&8192&&P(ne,1)):(ne=Yl(F),ne.c(),P(ne,1),ne.m(I.parentNode,I)):ne&&(Ne(),K(ne,1,1,()=>{ne=null}),Oe())},i(F){V||(P(ue),P(c.$$.fragment,F),P(z),P($e),lt(()=>{V&&(T||(T=Et(m,Dt,{},!0)),T.run(1))}),lt(()=>{V&&(W||(W=Et(Y,Dt,{},!0)),W.run(1))}),P(O.$$.fragment,F),P(Z),P(ne),V=!0)},o(F){K(ue),K(c.$$.fragment,F),K(z),K($e),T||(T=Et(m,Dt,{},!1)),T.run(0),W||(W=Et(Y,Dt,{},!1)),W.run(0),K(O.$$.fragment,F),K(Z),K(ne),V=!1},d(F){F&&S(e),ue&&ue.d(),ie(c),ke[E].d(),fe&&fe.d(),Se&&Se.d(),be&&be.d(),$e&&$e.d(),F&&T&&T.end(),Je(ce,F),F&&W&&W.end(),F&&S(x),ie(O,F),F&&S(Q),Z&&Z.d(F),F&&S(U),ne&&ne.d(F),F&&S(I),oe=!1,de()}}}function Ms(l,e,t){let o,n,a,s,i;ye(l,ct,O=>t(25,a=O)),ye(l,Qe,O=>t(26,s=O)),ye(l,tt,O=>t(27,i=O));let{document:c}=e,d=!1,m=!1,p=!1,_=null,g=null,h=null,k=!1,w=null,v=!1,$=null,L=!1,E=!1;function z(){const O=[];return O.push({id:"download-markdown",label:"Download to Markdown",icon:"fas fa-download",action:()=>j(),visible:!0,title:"Download document as markdown file"}),o&&O.push({id:"save-atomic",label:"Save to Atomic Server",icon:"fas fa-cloud-upload-alt",action:()=>N(),visible:!0,title:"Save article to Atomic Server",className:"has-text-primary"}),c.url&&O.push({id:"external-url",label:"Open URL",icon:"fas fa-link",action:()=>window.open(c.url,"_blank"),visible:!0,title:"Open original URL in new tab",isLink:!0,href:c.url}),O.push({id:"open-vscode",label:"Open in VSCode",icon:"fas fa-code",action:()=>A(),visible:!0,title:"Open document in VSCode",isLink:!0,href:`vscode://${encodeURIComponent(c.title)}.md?${encodeURIComponent(c.body)}`}),O.push({id:"add-favorites",label:"Add to Favorites",icon:"fas fa-plus",action:()=>{},visible:!0,title:"Add to favorites (coming soon)",disabled:!0}),O}function M(){var I;const O=a,B=i;if(!(B!=null&&B.roles)||!O)return!1;let Q=null;try{for(const[V,oe]of Object.entries(B.roles)){const de=oe,ue=typeof de.name=="object"?de.name.original:String(de.name);if(V===O||ue===O){Q=de;break}}}catch(V){return console.warn("Error checking role configuration:",V),!1}return Q?(((I=Q.haystacks)==null?void 0:I.filter(V=>V.service==="Atomic"&&V.location&&!V.read_only))||[]).length>0:!1}const y=()=>{t(1,d=!0)},N=()=>{console.log("🔄 Opening atomic save modal for document:",c.title),t(3,p=!0)};async function D(O){var B,Q,U,I,V;t(7,k=!0),t(5,g=O),console.log("🔍 KG Search Debug Info:"),console.log("  Tag clicked:",O),console.log("  Current role:",a),console.log("  Is Tauri mode:",s);try{if(s){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:a,term:O});const oe=await je("find_documents_for_kg_term",{roleName:a,term:O});console.log("  📥 Tauri response received:"),console.log("    Status:",oe.status),console.log("    Results count:",((B=oe.results)==null?void 0:B.length)||0),console.log("    Total:",oe.total||0),console.log("    Full response:",JSON.stringify(oe,null,2)),oe.status==="success"&&oe.results&&oe.results.length>0?(t(4,_=oe.results[0]),t(6,h=_.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",_.title),console.log("    Rank:",h),console.log("    Body length:",((Q=_.body)==null?void 0:Q.length)||0,"characters"),t(2,m=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${O}" in role: "${a}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const oe=et.ServerURL,de=encodeURIComponent(a),ue=encodeURIComponent(O),Le=`${oe}/roles/${de}/kg_search?term=${ue}`;console.log("  📤 HTTP Request details:"),console.log("    Base URL:",oe),console.log("    Role (encoded):",de),console.log("    Term (encoded):",ue),console.log("    Full URL:",Le);const ke=await fetch(Le);if(console.log("  📥 HTTP Response received:"),console.log("    Status code:",ke.status),console.log("    Status text:",ke.statusText),console.log("    Headers:",Object.fromEntries(ke.headers.entries())),!ke.ok)throw new Error(`HTTP error! Status: ${ke.status} - ${ke.statusText}`);const _e=await ke.json();console.log("  📄 Response data:"),console.log("    Status:",_e.status),console.log("    Results count:",((U=_e.results)==null?void 0:U.length)||0),console.log("    Total:",_e.total||0),console.log("    Full response:",JSON.stringify(_e,null,2)),_e.status==="success"&&_e.results&&_e.results.length>0?(t(4,_=_e.results[0]),t(6,h=_.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",_.title),console.log("    Rank:",h),console.log("    Body length:",((I=_.body)==null?void 0:I.length)||0,"characters"),t(2,m=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${O}" in role: "${a}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",Le))}}catch(oe){console.error("❌ Error fetching KG document:"),console.error("  Error type:",oe.constructor.name),console.error("  Error message:",oe.message||oe),console.error("  Request details:",{tag:O,role:a,isTauri:s,timestamp:new Date().toISOString()}),!s&&((V=oe.message)!=null&&V.includes("Failed to fetch"))&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{t(7,k=!1)}}async function G(){var O;if(!(v||!c.id||!a)){t(9,v=!0),t(10,$=null),console.log("🤖 AI Summary Debug Info:"),console.log("  Document ID:",c.id),console.log("  Current role:",a),console.log("  Is Tauri mode:",s);try{const B={document_id:c.id,role:a,max_length:250,force_regenerate:!1};console.log("  📤 Summarization request:",B);let Q;if(s){const V=`${et.ServerURL}/documents/summarize`;Q=await fetch(V,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(B)})}else{const V=`${et.ServerURL}/documents/summarize`;Q=await fetch(V,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(B)})}if(console.log("  📥 Summary response received:"),console.log("    Status code:",Q.status),console.log("    Status text:",Q.statusText),!Q.ok)throw new Error(`HTTP error! Status: ${Q.status} - ${Q.statusText}`);const U=await Q.json();console.log("  📄 Summary response data:",U),U.status==="Success"&&U.summary?(t(8,w=U.summary),t(12,E=U.from_cache||!1),t(11,L=!0),console.log("  ✅ Summary generated successfully"),console.log("    Summary length:",w.length,"characters"),console.log("    From cache:",E),console.log("    Model used:",U.model_used)):(t(10,$=U.error||"Failed to generate summary"),console.error("  ❌ Summary generation failed:",$))}catch(B){console.error("❌ Error generating summary:"),console.error("  Error type:",B.constructor.name),console.error("  Error message:",B.message||B),console.error("  Request details:",{document_id:c.id,role:a,isTauri:s,timestamp:new Date().toISOString()}),t(10,$=B.message||"Network error occurred"),(O=B.message)!=null&&O.includes("Failed to fetch")&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Verify OpenRouter is enabled for this role"),console.error("    3. Check OPENROUTER_KEY environment variable"),console.error("    4. Verify server URL in CONFIG.ServerURL"))}finally{t(9,v=!1)}}}function j(){console.log("📥 Downloading document as markdown:",c.title);let O=`# ${c.title}

`;O+=`**Source:** Terraphim Search
`,O+=`**Rank:** ${c.rank}
`,c.url&&(O+=`**URL:** ${c.url}
`),c.tags&&c.tags.length>0&&(O+=`**Tags:** ${c.tags.join(", ")}
`),O+=`**Downloaded:** ${new Date().toISOString()}

`,c.description&&(O+=`## Description

${c.description}

`),O+=`## Content

${c.body}
`;const B=`${c.title.replace(/[^a-z0-9]/gi,"_").toLowerCase()}_${Date.now()}.md`,Q=new Blob([O],{type:"text/markdown"}),U=URL.createObjectURL(Q),I=window.document.createElement("a");I.href=U,I.download=B,window.document.body.appendChild(I),I.click(),window.document.body.removeChild(I),URL.revokeObjectURL(U),console.log("✅ Markdown file downloaded:",B)}function A(){const O=`vscode://${encodeURIComponent(c.title)}.md?${encodeURIComponent(c.body)}`;window.open(O,"_blank")}Jt[a]!==void 0&&(console.log("Have attribute",Jt[a]),Jt[a].hasOwnProperty("enableLogseq")?console.log("enable logseq True"):console.log("Didn't make it"));const T=O=>D(O),te=()=>{t(10,$=null),G()},R=()=>t(11,L=!1),Y=()=>{G()};function q(O){d=O,t(1,d)}function W(O){m=O,t(2,m)}function x(O){p=O,t(3,p)}return l.$$set=O=>{"document"in O&&t(0,c=O.document)},t(13,o=M()),t(14,n=z()),[c,d,m,p,_,g,h,k,w,v,$,L,E,o,n,y,D,G,T,te,R,Y,q,W,x]}class Ps extends Ze{constructor(e){super(),Xe(this,e,Ms,Ds,qe,{document:0},null,[-1,-1])}}const js="/assets/terraphim_gray.png";function Ql(l,e,t){const o=l.slice();return o[20]=e[t],o}function Zl(l,e,t){const o=l.slice();return o[23]=e[t],o[25]=t,o}function Xl(l){let e,t=l[2],o=[];for(let n=0;n<t.length;n+=1)o[n]=xl(Zl(l,t,n));return{c(){e=f("ul");for(let n=0;n<o.length;n+=1)o[n].c();u(e,"class","suggestions svelte-13t09eu")},m(n,a){C(n,e,a);for(let s=0;s<o.length;s+=1)o[s]&&o[s].m(e,null)},p(n,a){if(a&524){t=n[2];let s;for(s=0;s<t.length;s+=1){const i=Zl(n,t,s);o[s]?o[s].p(i,a):(o[s]=xl(i),o[s].c(),o[s].m(e,null))}for(;s<o.length;s+=1)o[s].d(1);o.length=t.length}},d(n){n&&S(e),Je(o,n)}}}function xl(l){let e,t=l[23]+"",o,n,a,s,i,c;function d(){return l[13](l[23])}function m(...p){return l[14](l[23],...p)}return{c(){e=f("li"),o=J(t),n=b(),u(e,"tabindex","0"),u(e,"role","option"),u(e,"aria-selected",a=l[25]===l[3]),u(e,"aria-label",s=`Apply suggestion: ${l[23]}`),u(e,"class","svelte-13t09eu"),dt(e,"active",l[25]===l[3])},m(p,_){C(p,e,_),r(e,o),r(e,n),i||(c=[X(e,"click",d),X(e,"keydown",m)],i=!0)},p(p,_){l=p,_&4&&t!==(t=l[23]+"")&&pe(o,t),_&8&&a!==(a=l[25]===l[3])&&u(e,"aria-selected",a),_&4&&s!==(s=`Apply suggestion: ${l[23]}`)&&u(e,"aria-label",s),_&8&&dt(e,"active",l[25]===l[3])},d(p){p&&S(e),i=!1,ze(c)}}}function Is(l){let e,t,o,n,a;function s(d){l[12](d)}let i={type:"search",placeholder:l[6]?`Search over Knowledge graph for ${l[4]}`:"Search",icon:"search",expanded:!0,autofocus:!0};l[5]!==void 0&&(i.value=l[5]),t=new Rt({props:i}),De.push(()=>Ie(t,"value",s)),t.$on("click",l[10]),t.$on("submit",l[10]),t.$on("keydown",l[8]),t.$on("input",l[7]);let c=l[2].length>0&&Xl(l);return{c(){e=f("div"),re(t.$$.fragment),n=b(),c&&c.c(),u(e,"class","input-wrapper svelte-13t09eu")},m(d,m){C(d,e,m),ae(t,e,null),r(e,n),c&&c.m(e,null),a=!0},p(d,m){const p={};m&80&&(p.placeholder=d[6]?`Search over Knowledge graph for ${d[4]}`:"Search"),!o&&m&32&&(o=!0,p.value=d[5],He(()=>o=!1)),t.$set(p),d[2].length>0?c?c.p(d,m):(c=Xl(d),c.c(),c.m(e,null)):c&&(c.d(1),c=null)},i(d){a||(P(t.$$.fragment,d),a=!0)},o(d){K(t.$$.fragment,d),a=!1},d(d){d&&S(e),ie(t),c&&c.d()}}}function Hs(l){let e,t,o,n,a,s,i,c,d,m;return{c(){e=f("section"),t=f("div"),o=f("img"),a=b(),s=f("p"),s.textContent="I am Terraphim, your personal assistant.",i=b(),c=f("button"),c.innerHTML=`<span class="icon"><i class="fas fa-magic"></i></span> 
        <span>Configuration Wizard</span>`,tn(o.src,n=js)||u(o,"src",n),u(o,"alt","Terraphim Logo"),u(o,"class","svelte-13t09eu"),u(c,"class","button is-primary"),u(c,"data-testid","wizard-start"),u(t,"class","content has-text-grey has-text-centered svelte-13t09eu"),u(e,"class","section")},m(p,_){C(p,e,_),r(e,t),r(t,o),r(t,a),r(t,s),r(t,i),r(t,c),d||(m=X(c,"click",l[15]),d=!0)},p:ve,i:ve,o:ve,d(p){p&&S(e),d=!1,m()}}}function Fs(l){let e,t,o=l[0],n=[];for(let s=0;s<o.length;s+=1)n[s]=eo(Ql(l,o,s));const a=s=>K(n[s],1,1,()=>{n[s]=null});return{c(){for(let s=0;s<n.length;s+=1)n[s].c();e=xe()},m(s,i){for(let c=0;c<n.length;c+=1)n[c]&&n[c].m(s,i);C(s,e,i),t=!0},p(s,i){if(i&1){o=s[0];let c;for(c=0;c<o.length;c+=1){const d=Ql(s,o,c);n[c]?(n[c].p(d,i),P(n[c],1)):(n[c]=eo(d),n[c].c(),P(n[c],1),n[c].m(e.parentNode,e))}for(Ne(),c=o.length;c<n.length;c+=1)a(c);Oe()}},i(s){if(!t){for(let i=0;i<o.length;i+=1)P(n[i]);t=!0}},o(s){n=n.filter(Boolean);for(let i=0;i<n.length;i+=1)K(n[i]);t=!1},d(s){Je(n,s),s&&S(e)}}}function Gs(l){let e,t;return{c(){e=f("p"),t=J(l[1]),u(e,"class","error svelte-13t09eu")},m(o,n){C(o,e,n),r(e,t)},p(o,n){n&2&&pe(t,o[1])},i:ve,o:ve,d(o){o&&S(e)}}}function eo(l){let e,t;return e=new Ps({props:{document:l[20]}}),{c(){re(e.$$.fragment)},m(o,n){ae(e,o,n),t=!0},p(o,n){const a={};n&1&&(a.document=o[20]),e.$set(a)},i(o){t||(P(e.$$.fragment,o),t=!0)},o(o){K(e.$$.fragment,o),t=!1},d(o){ie(e,o)}}}function Ks(l){let e,t,o,n,a,s,i,c,d;t=new kt({props:{$$slots:{default:[Is]},$$scope:{ctx:l}}});const m=[Gs,Fs,Hs],p=[];function _(g,h){return g[1]?0:g[0].length?1:2}return n=_(l),a=p[n]=m[n](l),{c(){e=f("form"),re(t.$$.fragment),o=b(),a.c(),s=xe()},m(g,h){C(g,e,h),ae(t,e,null),C(g,o,h),p[n].m(g,h),C(g,s,h),i=!0,c||(d=X(e,"submit",xo(l[10])),c=!0)},p(g,[h]){const k={};h&67108988&&(k.$$scope={dirty:h,ctx:g}),t.$set(k);let w=n;n=_(g),n===w?p[n].p(g,h):(Ne(),K(p[w],1,1,()=>{p[w]=null}),Oe(),a=p[n],a?a.p(g,h):(a=p[n]=m[n](g),a.c()),P(a,1),a.m(s.parentNode,s))},i(g){i||(P(t.$$.fragment,g),P(a),i=!0)},o(g){K(t.$$.fragment,g),K(a),i=!1},d(g){g&&S(e),ie(t),g&&S(o),p[n].d(g),g&&S(s),c=!1,d()}}}function zs(l,e,t){let o,n,a,s,i,c,d;ye(l,wn,y=>t(17,n=y)),ye(l,ct,y=>t(4,a=y)),ye(l,el,y=>t(5,s=y)),ye(l,Qe,y=>t(18,i=y)),ye(l,tl,y=>t(11,c=y)),ye(l,It,y=>t(6,d=y));let m=[],p=null,_=[],g=-1;function h(y){const N=y.trim().toLowerCase();return N.length===0?[]:o.filter(([G])=>G.toLowerCase().includes(N)).map(([G])=>G).slice(0,5)}function k(y){const N=y.target;if(!N||N.selectionStart==null)return;const D=N.selectionStart,j=s.slice(0,D).split(/\s+/),A=j[j.length-1];t(2,_=h(A)),t(3,g=-1)}function w(y){_.length!==0&&(y.key==="ArrowDown"?(y.preventDefault(),t(3,g=(g+1)%_.length)):y.key==="ArrowUp"?(y.preventDefault(),t(3,g=(g-1+_.length)%_.length)):(y.key==="Enter"||y.key==="Tab")&&g!==-1&&(y.preventDefault(),v(_[g])))}function v(y){var T;const N=document.querySelector('input[type="search"]'),D=(N==null?void 0:N.selectionStart)??0,G=s.slice(0,D),j=s.slice(D),A=G.split(/\s+/);A[A.length-1]=y,en(el,s=[...A,j].join(" "),s),(T=N==null?void 0:N.setSelectionRange)==null||T.call(N,D+y.length,D+y.length),t(2,_=[]),t(3,g=-1)}async function $(){if(t(1,p=null),i)try{const y=await je("search",{searchQuery:{search_term:s,skip:0,limit:10,role:a}});y.status==="success"?(t(0,m=y.results),console.log("Response results"),console.log(m)):(t(1,p=`Search failed: ${y.status}`),console.error("Search failed:",y))}catch(y){t(1,p=`Error in Tauri search: ${y}`),console.error("Error in Tauri search:",y)}else{if(!s.trim())return;const y=JSON.stringify({search_term:s,skip:0,limit:10,role:a});try{const N=await fetch(n,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:y}),D=await N.json();if(!N.ok)throw new Error(`HTTP error! Status: ${N.status}`);t(0,m=D.results)}catch(N){console.error("Error fetching data:",N),t(1,p=`Error fetching data: ${N}`)}}}function L(y){s=y,el.set(s)}const E=y=>v(y),z=(y,N)=>{(N.key==="Enter"||N.key===" ")&&(N.preventDefault(),v(y))},M=()=>window.location.href="/config/wizard";return l.$$.update=()=>{l.$$.dirty&2048&&(o=Object.entries(c))},[m,p,_,g,a,s,d,k,w,v,$,c,L,E,z,M]}class Ws extends Ze{constructor(e){super(),Xe(this,e,zs,Ks,qe,{})}}function to(l,e,t){const o=l.slice();return o[52]=e[t],o[57]=t,o}function lo(l,e,t){const o=l.slice();return o[55]=e[t],o[56]=e,o[57]=t,o}function oo(l,e,t){const o=l.slice();return o[58]=e[t],o[59]=e,o[60]=t,o}function no(l,e,t){const o=l.slice();return o[61]=e[t][0],o[62]=e[t][1],o[63]=e,o[64]=t,o}function so(l,e,t){const o=l.slice();return o[52]=e[t],o}function ro(l){let e,t,o,n,a;return{c(){e=f("div"),t=f("button"),o=J(`
      Configuration saved successfully!`),u(t,"class","delete"),u(e,"class","notification is-success"),u(e,"data-testid","wizard-success")},m(s,i){C(s,e,i),r(e,t),r(e,o),n||(a=X(t,"click",l[14]),n=!0)},p:ve,d(s){s&&S(e),n=!1,a()}}}function ao(l){let e,t,o,n,a;return{c(){e=f("div"),t=f("button"),o=J(`
      Failed to save configuration. Please try again.`),u(t,"class","delete"),u(e,"class","notification is-danger"),u(e,"data-testid","wizard-error")},m(s,i){C(s,e,i),r(e,t),r(e,o),n||(a=X(t,"click",l[15]),n=!0)},p:ve,d(s){s&&S(e),n=!1,a()}}}function Bs(l){let e,t,o,n,a,s,i,c,d,m=l[2].id+"",p,_,g,h,k,w=l[2].global_shortcut+"",v,$,L,E,z,M=l[2].default_theme+"",y,N,D,G,j,A=l[2].default_role+"",T,te,R,Y,q,W,x=JSON.stringify(l[2],null,2)+"",O,B=l[2].roles,Q=[];for(let U=0;U<B.length;U+=1)Q[U]=io(to(l,B,U));return{c(){e=f("h4"),e.textContent="Review",t=b(),o=f("div"),n=f("h5"),n.textContent="Configuration Summary:",a=b(),s=f("ul"),i=f("li"),c=f("strong"),c.textContent="Configuration ID:",d=b(),p=J(m),_=b(),g=f("li"),h=f("strong"),h.textContent="Global Shortcut:",k=b(),v=J(w),$=b(),L=f("li"),E=f("strong"),E.textContent="Default Theme:",z=b(),y=J(M),N=b(),D=f("li"),G=f("strong"),G.textContent="Default Role:",j=b(),T=J(A),te=b(),R=f("h5"),R.textContent="Roles:",Y=b();for(let U=0;U<Q.length;U+=1)Q[U].c();q=b(),W=f("pre"),O=J(x),u(e,"class","title is-5"),u(o,"class","content"),Tt(W,"max-height","300px"),Tt(W,"overflow","auto")},m(U,I){C(U,e,I),C(U,t,I),C(U,o,I),r(o,n),r(o,a),r(o,s),r(s,i),r(i,c),r(i,d),r(i,p),r(s,_),r(s,g),r(g,h),r(g,k),r(g,v),r(s,$),r(s,L),r(L,E),r(L,z),r(L,y),r(s,N),r(s,D),r(D,G),r(D,j),r(D,T),r(o,te),r(o,R),r(o,Y);for(let V=0;V<Q.length;V+=1)Q[V]&&Q[V].m(o,null);C(U,q,I),C(U,W,I),r(W,O)},p(U,I){if(I[0]&4&&m!==(m=U[2].id+"")&&pe(p,m),I[0]&4&&w!==(w=U[2].global_shortcut+"")&&pe(v,w),I[0]&4&&M!==(M=U[2].default_theme+"")&&pe(y,M),I[0]&4&&A!==(A=U[2].default_role+"")&&pe(T,A),I[0]&5){B=U[2].roles;let V;for(V=0;V<B.length;V+=1){const oe=to(U,B,V);Q[V]?Q[V].p(oe,I):(Q[V]=io(oe),Q[V].c(),Q[V].m(o,null))}for(;V<Q.length;V+=1)Q[V].d(1);Q.length=B.length}I[0]&4&&x!==(x=JSON.stringify(U[2],null,2)+"")&&pe(O,x)},d(U){U&&S(e),U&&S(t),U&&S(o),Je(Q,U),U&&S(q),U&&S(W)}}}function qs(l){let e,t,o=[],n=new Map,a,s,i,c,d=l[2].roles;const m=p=>p[55].name;for(let p=0;p<d.length;p+=1){let _=lo(l,d,p),g=m(_);n.set(g,o[p]=ho(g,_))}return{c(){e=f("h4"),e.textContent="Roles",t=b();for(let p=0;p<o.length;p+=1)o[p].c();a=b(),s=f("button"),s.textContent="Add Role",u(e,"class","title is-5"),u(s,"class","button is-link is-light"),u(s,"data-testid","add-role")},m(p,_){C(p,e,_),C(p,t,_);for(let g=0;g<o.length;g+=1)o[g]&&o[g].m(p,_);C(p,a,_),C(p,s,_),i||(c=X(s,"click",l[6]),i=!0)},p(p,_){_[0]&8068&&(d=p[2].roles,o=ln(o,_,m,1,p,d,n,a.parentNode,on,ho,a,lo))},d(p){p&&S(e),p&&S(t);for(let _=0;_<o.length;_+=1)o[_].d(p);p&&S(a),p&&S(s),i=!1,c()}}}function Js(l){let e,t,o,n,a,s,i,c,d,m,p,_,g,h,k,w,v,$,L,E,z,M,y,N,D,G,j,A,T,te,R=l[2].roles,Y=[];for(let q=0;q<R.length;q+=1)Y[q]=go(so(l,R,q));return{c(){e=f("div"),t=f("label"),t.textContent="Configuration ID",o=b(),n=f("div"),a=f("div"),s=f("select"),i=f("option"),i.textContent="Desktop",c=f("option"),c.textContent="Server",d=f("option"),d.textContent="Embedded",m=b(),p=f("div"),_=f("label"),_.textContent="Global shortcut",g=b(),h=f("div"),k=f("input"),w=b(),v=f("div"),$=f("label"),$.textContent="Default theme",L=b(),E=f("div"),z=f("input"),M=b(),y=f("div"),N=f("label"),N.textContent="Default Role",D=b(),G=f("div"),j=f("div"),A=f("select");for(let q=0;q<Y.length;q+=1)Y[q].c();u(t,"class","label"),u(t,"for","config-id"),i.__value="Desktop",i.value=i.__value,c.__value="Server",c.value=c.__value,d.__value="Embedded",d.value=d.__value,u(s,"id","config-id"),l[2].id===void 0&&lt(()=>l[16].call(s)),u(a,"class","select"),u(n,"class","control"),u(e,"class","field"),u(_,"class","label"),u(_,"for","global-shortcut"),u(k,"class","input"),u(k,"id","global-shortcut"),u(k,"type","text"),u(h,"class","control"),u(p,"class","field"),u($,"class","label"),u($,"for","default-theme"),u(z,"class","input"),u(z,"id","default-theme"),u(z,"type","text"),u(E,"class","control"),u(v,"class","field"),u(N,"class","label"),u(N,"for","default-role"),u(A,"id","default-role"),l[2].default_role===void 0&&lt(()=>l[19].call(A)),u(j,"class","select"),u(G,"class","control"),u(y,"class","field")},m(q,W){C(q,e,W),r(e,t),r(e,o),r(e,n),r(n,a),r(a,s),r(s,i),r(s,c),r(s,d),Ee(s,l[2].id,!0),C(q,m,W),C(q,p,W),r(p,_),r(p,g),r(p,h),r(h,k),we(k,l[2].global_shortcut),C(q,w,W),C(q,v,W),r(v,$),r(v,L),r(v,E),r(E,z),we(z,l[2].default_theme),C(q,M,W),C(q,y,W),r(y,N),r(y,D),r(y,G),r(G,j),r(j,A);for(let x=0;x<Y.length;x+=1)Y[x]&&Y[x].m(A,null);Ee(A,l[2].default_role,!0),T||(te=[X(s,"change",l[16]),X(k,"input",l[17]),X(z,"input",l[18]),X(A,"change",l[19])],T=!0)},p(q,W){if(W[0]&4&&Ee(s,q[2].id),W[0]&4&&k.value!==q[2].global_shortcut&&we(k,q[2].global_shortcut),W[0]&4&&z.value!==q[2].default_theme&&we(z,q[2].default_theme),W[0]&4){R=q[2].roles;let x;for(x=0;x<R.length;x+=1){const O=so(q,R,x);Y[x]?Y[x].p(O,W):(Y[x]=go(O),Y[x].c(),Y[x].m(A,null))}for(;x<Y.length;x+=1)Y[x].d(1);Y.length=R.length}W[0]&4&&Ee(A,q[2].default_role)},d(q){q&&S(e),q&&S(m),q&&S(p),q&&S(w),q&&S(v),q&&S(M),q&&S(y),Je(Y,q),T=!1,ze(te)}}}function io(l){let e,t,o=l[52].name+"",n,a,s,i,c,d=l[52].shortname+"",m,p,_,g,h,k=l[52].theme+"",w,v,$,L,E,z=l[52].relevance_function+"",M,y,N,D,G,j;return{c(){e=f("div"),t=f("h6"),n=J(o),a=b(),s=f("p"),i=f("strong"),i.textContent="Shortname:",c=b(),m=J(d),p=b(),_=f("p"),g=f("strong"),g.textContent="Theme:",h=b(),w=J(k),v=b(),$=f("p"),L=f("strong"),L.textContent="Relevance Function:",E=b(),M=J(z),y=b(),N=f("button"),N.textContent="Edit Role",D=b(),u(t,"data-testid","review-role-name-"+l[57]),u(N,"class","button is-small"),u(N,"data-testid","edit-role-"+l[57]),u(e,"class","box")},m(A,T){C(A,e,T),r(e,t),r(t,n),r(e,a),r(e,s),r(s,i),r(s,c),r(s,m),r(e,p),r(e,_),r(_,g),r(_,h),r(_,w),r(e,v),r(e,$),r($,L),r($,E),r($,M),r(e,y),r(e,N),r(e,D),G||(j=X(N,"click",l[49]),G=!0)},p(A,T){T[0]&4&&o!==(o=A[52].name+"")&&pe(n,o),T[0]&4&&d!==(d=A[52].shortname+"")&&pe(m,d),T[0]&4&&k!==(k=A[52].theme+"")&&pe(w,k),T[0]&4&&z!==(z=A[52].relevance_function+"")&&pe(M,z)},d(A){A&&S(e),G=!1,j()}}}function Vs(l){let e;return{c(){e=J("Directory Path")},m(t,o){C(t,e,o)},d(t){t&&S(e)}}}function Ys(l){let e;return{c(){e=J("Server URL")},m(t,o){C(t,e,o)},d(t){t&&S(e)}}}function uo(l){let e,t,o,n,a,s,i,c,d,m,p,_;function g(){l[26].call(i,l[57],l[60])}return{c(){e=f("div"),t=f("label"),o=J("Atomic Server Secret"),a=b(),s=f("div"),i=f("input"),d=b(),m=f("p"),m.textContent="Leave empty for anonymous access",u(t,"class","label"),u(t,"for",n=`haystack-secret-${l[57]}-${l[60]}`),u(i,"class","input"),u(i,"id",c=`haystack-secret-${l[57]}-${l[60]}`),u(i,"type","password"),u(i,"placeholder","Base64 encoded secret (optional)"),u(s,"class","control"),u(m,"class","help"),u(e,"class","field")},m(h,k){C(h,e,k),r(e,t),r(t,o),r(e,a),r(e,s),r(s,i),we(i,l[2].roles[l[57]].haystacks[l[60]].atomic_server_secret),r(e,d),r(e,m),p||(_=X(i,"input",g),p=!0)},p(h,k){l=h,k[0]&4&&n!==(n=`haystack-secret-${l[57]}-${l[60]}`)&&u(t,"for",n),k[0]&4&&c!==(c=`haystack-secret-${l[57]}-${l[60]}`)&&u(i,"id",c),k[0]&4&&i.value!==l[2].roles[l[57]].haystacks[l[60]].atomic_server_secret&&we(i,l[2].roles[l[57]].haystacks[l[60]].atomic_server_secret)},d(h){h&&S(e),p=!1,_()}}}function co(l){let e,t,o,n,a,s,i,c,d,m,p,_,g,h,k,w,v,$=Object.entries(l[2].roles[l[57]].haystacks[l[60]].extra_parameters||{}),L=[];for(let y=0;y<$.length;y+=1)L[y]=fo(no(l,$,y));function E(){return l[30](l[57],l[60])}function z(){return l[31](l[57],l[60])}function M(){return l[32](l[57],l[60])}return{c(){e=f("div"),t=f("label"),t.textContent="Extra Parameters (for filtering)",o=b();for(let y=0;y<L.length;y+=1)L[y].c();n=b(),a=f("div"),s=f("div"),i=f("button"),i.textContent="+ Tag Filter",c=b(),d=f("div"),m=f("button"),m.textContent="+ Max Results",p=b(),_=f("div"),g=f("button"),g.textContent="+ Custom Parameter",h=b(),k=f("p"),k.innerHTML=`Common parameters: <code>tag</code> (e.g., &quot;#rust&quot;), <code>glob</code> (e.g., &quot;*.md&quot;), 
                  <code>max_count</code> (e.g., &quot;10&quot;), <code>context</code> (e.g., &quot;5&quot;)`,u(t,"class","label"),u(i,"class","button is-small is-link is-light"),u(s,"class","control"),u(m,"class","button is-small is-link is-light"),u(d,"class","control"),u(g,"class","button is-small is-link is-light"),u(_,"class","control"),u(a,"class","field is-grouped"),u(k,"class","help"),u(e,"class","field")},m(y,N){C(y,e,N),r(e,t),r(e,o);for(let D=0;D<L.length;D+=1)L[D]&&L[D].m(e,null);r(e,n),r(e,a),r(a,s),r(s,i),r(a,c),r(a,d),r(d,m),r(a,p),r(a,_),r(_,g),r(e,h),r(e,k),w||(v=[X(i,"click",E),X(m,"click",z),X(g,"click",M)],w=!0)},p(y,N){if(l=y,N[0]&6148){$=Object.entries(l[2].roles[l[57]].haystacks[l[60]].extra_parameters||{});let D;for(D=0;D<$.length;D+=1){const G=no(l,$,D);L[D]?L[D].p(G,N):(L[D]=fo(G),L[D].c(),L[D].m(e,n))}for(;D<L.length;D+=1)L[D].d(1);L.length=$.length}},d(y){y&&S(e),Je(L,y),w=!1,ze(v)}}}function fo(l){let e,t,o,n,a,s,i,c,d,m,p,_,g;function h(...v){return l[27](l[57],l[60],l[61],...v)}function k(){l[28].call(i,l[57],l[60],l[61])}function w(){return l[29](l[57],l[60],l[61])}return{c(){e=f("div"),t=f("div"),o=f("input"),a=b(),s=f("div"),i=f("input"),c=b(),d=f("div"),m=f("button"),m.textContent="×",p=b(),u(o,"class","input"),u(o,"type","text"),u(o,"placeholder","Parameter name"),o.value=n=l[61],u(t,"class","control"),u(i,"class","input"),u(i,"type","text"),u(i,"placeholder","Parameter value"),u(s,"class","control is-expanded"),u(m,"class","button is-small is-danger"),u(d,"class","control"),u(e,"class","field is-grouped")},m(v,$){C(v,e,$),r(e,t),r(t,o),r(e,a),r(e,s),r(s,i),we(i,l[2].roles[l[57]].haystacks[l[60]].extra_parameters[l[61]]),r(e,c),r(e,d),r(d,m),r(e,p),_||(g=[X(o,"blur",h),X(i,"input",k),X(m,"click",w)],_=!0)},p(v,$){l=v,$[0]&4&&n!==(n=l[61])&&o.value!==n&&(o.value=n),$[0]&4&&i.value!==l[2].roles[l[57]].haystacks[l[60]].extra_parameters[l[61]]&&we(i,l[2].roles[l[57]].haystacks[l[60]].extra_parameters[l[61]])},d(v){v&&S(e),_=!1,ze(g)}}}function po(l){let e,t,o,n,a,s,i,c,d,m,p,_,g,h,k,w,v,$,L,E,z,M,y,N,D,G,j,A,T,te,R,Y,q,W,x,O,B;function Q(){l[24].call(d,l[57],l[60])}function U(_e,fe){return _e[2].roles[_e[57]].haystacks[_e[60]].service==="Atomic"?Ys:Vs}let I=U(l),V=I(l);function oe(){l[25].call(L,l[57],l[60])}let de=l[2].roles[l[57]].haystacks[l[60]].service==="Atomic"&&uo(l),ue=l[2].roles[l[57]].haystacks[l[60]].service==="Ripgrep"&&co(l);function Le(){l[33].call(j,l[57],l[60])}function ke(){return l[34](l[57],l[60])}return{c(){e=f("div"),t=f("div"),o=f("label"),n=J("Service Type"),s=b(),i=f("div"),c=f("div"),d=f("select"),m=f("option"),m.textContent="Ripgrep (File Search)",p=f("option"),p.textContent="Atomic Server",g=b(),h=f("div"),k=f("label"),V.c(),v=b(),$=f("div"),L=f("input"),M=b(),de&&de.c(),y=b(),ue&&ue.c(),N=b(),D=f("div"),G=f("label"),j=f("input"),T=J(`
                 Read-only`),R=b(),Y=f("div"),q=f("button"),W=J("Remove Haystack"),u(o,"class","label"),u(o,"for",a=`haystack-service-${l[57]}-${l[60]}`),m.__value="Ripgrep",m.value=m.__value,p.__value="Atomic",p.value=p.__value,u(d,"id",_=`haystack-service-${l[57]}-${l[60]}`),l[2].roles[l[57]].haystacks[l[60]].service===void 0&&lt(Q),u(c,"class","select"),u(i,"class","control"),u(t,"class","field"),u(k,"class","label"),u(k,"for",w=`haystack-path-${l[57]}-${l[60]}`),u(L,"class","input"),u(L,"id",E=`haystack-path-${l[57]}-${l[60]}`),u(L,"type","text"),u(L,"placeholder",z=l[2].roles[l[57]].haystacks[l[60]].service==="Atomic"?"https://localhost:9883":"/path/to/documents"),u($,"class","control"),u(h,"class","field"),u(j,"id",A=`haystack-readonly-${l[57]}-${l[60]}`),u(j,"type","checkbox"),u(G,"class","checkbox"),u(G,"for",te=`haystack-readonly-${l[57]}-${l[60]}`),u(D,"class","field"),u(q,"class","button is-small is-danger"),u(q,"data-testid",x="remove-haystack-"+l[57]+"-"+l[60]),u(Y,"class","field"),u(e,"class","box is-light")},m(_e,fe){C(_e,e,fe),r(e,t),r(t,o),r(o,n),r(t,s),r(t,i),r(i,c),r(c,d),r(d,m),r(d,p),Ee(d,l[2].roles[l[57]].haystacks[l[60]].service,!0),r(e,g),r(e,h),r(h,k),V.m(k,null),r(h,v),r(h,$),r($,L),we(L,l[2].roles[l[57]].haystacks[l[60]].path),r(e,M),de&&de.m(e,null),r(e,y),ue&&ue.m(e,null),r(e,N),r(e,D),r(D,G),r(G,j),j.checked=l[2].roles[l[57]].haystacks[l[60]].read_only,r(G,T),r(e,R),r(e,Y),r(Y,q),r(q,W),O||(B=[X(d,"change",Q),X(L,"input",oe),X(j,"change",Le),X(q,"click",ke)],O=!0)},p(_e,fe){l=_e,fe[0]&4&&a!==(a=`haystack-service-${l[57]}-${l[60]}`)&&u(o,"for",a),fe[0]&4&&_!==(_=`haystack-service-${l[57]}-${l[60]}`)&&u(d,"id",_),fe[0]&4&&Ee(d,l[2].roles[l[57]].haystacks[l[60]].service),I!==(I=U(l))&&(V.d(1),V=I(l),V&&(V.c(),V.m(k,null))),fe[0]&4&&w!==(w=`haystack-path-${l[57]}-${l[60]}`)&&u(k,"for",w),fe[0]&4&&E!==(E=`haystack-path-${l[57]}-${l[60]}`)&&u(L,"id",E),fe[0]&4&&z!==(z=l[2].roles[l[57]].haystacks[l[60]].service==="Atomic"?"https://localhost:9883":"/path/to/documents")&&u(L,"placeholder",z),fe[0]&4&&L.value!==l[2].roles[l[57]].haystacks[l[60]].path&&we(L,l[2].roles[l[57]].haystacks[l[60]].path),l[2].roles[l[57]].haystacks[l[60]].service==="Atomic"?de?de.p(l,fe):(de=uo(l),de.c(),de.m(e,y)):de&&(de.d(1),de=null),l[2].roles[l[57]].haystacks[l[60]].service==="Ripgrep"?ue?ue.p(l,fe):(ue=co(l),ue.c(),ue.m(e,N)):ue&&(ue.d(1),ue=null),fe[0]&4&&A!==(A=`haystack-readonly-${l[57]}-${l[60]}`)&&u(j,"id",A),fe[0]&4&&(j.checked=l[2].roles[l[57]].haystacks[l[60]].read_only),fe[0]&4&&te!==(te=`haystack-readonly-${l[57]}-${l[60]}`)&&u(G,"for",te),fe[0]&4&&x!==(x="remove-haystack-"+l[57]+"-"+l[60])&&u(q,"data-testid",x)},d(_e){_e&&S(e),V.d(),de&&de.d(),ue&&ue.d(),O=!1,ze(B)}}}function _o(l){let e,t,o,n,a,s,i,c,d,m,p,_,g,h,k,w,v,$,L,E,z,M,y,N,D,G,j,A,T,te,R,Y,q,W,x,O,B,Q,U,I,V,oe,de,ue,Le,ke,_e;function fe(){l[37].call(i,l[57])}function Se(){l[38].call(L,l[57])}function be(){l[39].call(R,l[57])}function $e(){l[40].call(I,l[57])}let Ce=l[2].roles[l[57]].openrouter_chat_enabled&&mo(l);return{c(){e=f("div"),t=f("label"),o=J("OpenRouter API Key"),a=b(),s=f("div"),i=f("input"),d=b(),m=f("p"),m.innerHTML='Get your API key from <a href="https://openrouter.ai" target="_blank" rel="noopener">OpenRouter</a>',p=b(),_=f("div"),g=f("label"),h=J("Model"),w=b(),v=f("div"),$=f("div"),L=f("select"),E=f("option"),E.textContent="GPT-3.5 Turbo (Fast & Affordable)",z=f("option"),z.textContent="GPT-4 (High Quality)",M=f("option"),M.textContent="Claude 3 Sonnet (Balanced)",y=f("option"),y.textContent="Claude 3 Haiku (Fast)",N=f("option"),N.textContent="Mixtral 8x7B (Open Source)",G=b(),j=f("p"),j.textContent="Choose the language model for generating summaries. Different models offer different speed/quality tradeoffs.",A=b(),T=f("div"),te=f("label"),R=f("input"),q=J(`
               Automatically summarize search results`),x=b(),O=f("p"),O.textContent="When enabled, summaries will be generated and shown in search results.",B=b(),Q=f("div"),U=f("label"),I=f("input"),oe=J(`
               Enable Chat interface (OpenRouter)`),ue=b(),Ce&&Ce.c(),Le=xe(),u(t,"class","label"),u(t,"for",n=`openrouter-api-key-${l[57]}`),u(i,"class","input"),u(i,"id",c=`openrouter-api-key-${l[57]}`),u(i,"type","password"),u(i,"placeholder","sk-or-v1-..."),u(s,"class","control"),u(m,"class","help"),u(e,"class","field"),u(g,"class","label"),u(g,"for",k=`openrouter-model-${l[57]}`),E.__value="openai/gpt-3.5-turbo",E.value=E.__value,z.__value="openai/gpt-4",z.value=z.__value,M.__value="anthropic/claude-3-sonnet",M.value=M.__value,y.__value="anthropic/claude-3-haiku",y.value=y.__value,N.__value="mistralai/mixtral-8x7b-instruct",N.value=N.__value,u(L,"id",D=`openrouter-model-${l[57]}`),l[2].roles[l[57]].openrouter_model===void 0&&lt(Se),u($,"class","select is-fullwidth"),u(v,"class","control"),u(j,"class","help"),u(_,"class","field"),u(R,"id",Y=`openrouter-auto-summarize-${l[57]}`),u(R,"type","checkbox"),u(te,"class","checkbox"),u(te,"for",W=`openrouter-auto-summarize-${l[57]}`),u(O,"class","help"),u(T,"class","field"),u(I,"id",V=`openrouter-chat-enabled-${l[57]}`),u(I,"type","checkbox"),u(U,"class","checkbox"),u(U,"for",de=`openrouter-chat-enabled-${l[57]}`),u(Q,"class","field")},m(ce,me){C(ce,e,me),r(e,t),r(t,o),r(e,a),r(e,s),r(s,i),we(i,l[2].roles[l[57]].openrouter_api_key),r(e,d),r(e,m),C(ce,p,me),C(ce,_,me),r(_,g),r(g,h),r(_,w),r(_,v),r(v,$),r($,L),r(L,E),r(L,z),r(L,M),r(L,y),r(L,N),Ee(L,l[2].roles[l[57]].openrouter_model,!0),r(_,G),r(_,j),C(ce,A,me),C(ce,T,me),r(T,te),r(te,R),R.checked=l[2].roles[l[57]].openrouter_auto_summarize,r(te,q),r(T,x),r(T,O),C(ce,B,me),C(ce,Q,me),r(Q,U),r(U,I),I.checked=l[2].roles[l[57]].openrouter_chat_enabled,r(U,oe),C(ce,ue,me),Ce&&Ce.m(ce,me),C(ce,Le,me),ke||(_e=[X(i,"input",fe),X(L,"change",Se),X(R,"change",be),X(I,"change",$e)],ke=!0)},p(ce,me){l=ce,me[0]&4&&n!==(n=`openrouter-api-key-${l[57]}`)&&u(t,"for",n),me[0]&4&&c!==(c=`openrouter-api-key-${l[57]}`)&&u(i,"id",c),me[0]&4&&i.value!==l[2].roles[l[57]].openrouter_api_key&&we(i,l[2].roles[l[57]].openrouter_api_key),me[0]&4&&k!==(k=`openrouter-model-${l[57]}`)&&u(g,"for",k),me[0]&4&&D!==(D=`openrouter-model-${l[57]}`)&&u(L,"id",D),me[0]&4&&Ee(L,l[2].roles[l[57]].openrouter_model),me[0]&4&&Y!==(Y=`openrouter-auto-summarize-${l[57]}`)&&u(R,"id",Y),me[0]&4&&(R.checked=l[2].roles[l[57]].openrouter_auto_summarize),me[0]&4&&W!==(W=`openrouter-auto-summarize-${l[57]}`)&&u(te,"for",W),me[0]&4&&V!==(V=`openrouter-chat-enabled-${l[57]}`)&&u(I,"id",V),me[0]&4&&(I.checked=l[2].roles[l[57]].openrouter_chat_enabled),me[0]&4&&de!==(de=`openrouter-chat-enabled-${l[57]}`)&&u(U,"for",de),l[2].roles[l[57]].openrouter_chat_enabled?Ce?Ce.p(l,me):(Ce=mo(l),Ce.c(),Ce.m(Le.parentNode,Le)):Ce&&(Ce.d(1),Ce=null)},d(ce){ce&&S(e),ce&&S(p),ce&&S(_),ce&&S(A),ce&&S(T),ce&&S(B),ce&&S(Q),ce&&S(ue),Ce&&Ce.d(ce),ce&&S(Le),ke=!1,ze(_e)}}}function mo(l){let e,t,o,n,a,s,i,c,d,m,p,_,g,h,k,w,v,$,L,E,z,M,y,N,D;function G(){l[41].call(c,l[57])}function j(){l[42].call(M,l[57])}return{c(){e=f("div"),t=f("label"),o=J("Chat Model"),a=b(),s=f("div"),i=f("div"),c=f("select"),d=f("option"),d.textContent="GPT-3.5 Turbo",m=f("option"),m.textContent="GPT-4",p=f("option"),p.textContent="Claude 3 Sonnet",_=f("option"),_.textContent="Claude 3 Haiku",g=f("option"),g.textContent="Mixtral 8x7B",k=b(),w=f("div"),v=f("label"),$=J("System Prompt (optional)"),E=b(),z=f("div"),M=f("textarea"),u(t,"class","label"),u(t,"for",n=`openrouter-chat-model-${l[57]}`),d.__value="openai/gpt-3.5-turbo",d.value=d.__value,m.__value="openai/gpt-4",m.value=m.__value,p.__value="anthropic/claude-3-sonnet",p.value=p.__value,_.__value="anthropic/claude-3-haiku",_.value=_.__value,g.__value="mistralai/mixtral-8x7b-instruct",g.value=g.__value,u(c,"id",h=`openrouter-chat-model-${l[57]}`),l[2].roles[l[57]].openrouter_chat_model===void 0&&lt(G),u(i,"class","select is-fullwidth"),u(s,"class","control"),u(e,"class","field"),u(v,"class","label"),u(v,"for",L=`openrouter-chat-system-${l[57]}`),u(M,"class","textarea"),u(M,"id",y=`openrouter-chat-system-${l[57]}`),u(M,"rows","3"),u(M,"placeholder","You are a helpful Rust engineer assistant..."),u(z,"class","control"),u(w,"class","field")},m(A,T){C(A,e,T),r(e,t),r(t,o),r(e,a),r(e,s),r(s,i),r(i,c),r(c,d),r(c,m),r(c,p),r(c,_),r(c,g),Ee(c,l[2].roles[l[57]].openrouter_chat_model,!0),C(A,k,T),C(A,w,T),r(w,v),r(v,$),r(w,E),r(w,z),r(z,M),we(M,l[2].roles[l[57]].openrouter_chat_system_prompt),N||(D=[X(c,"change",G),X(M,"input",j)],N=!0)},p(A,T){l=A,T[0]&4&&n!==(n=`openrouter-chat-model-${l[57]}`)&&u(t,"for",n),T[0]&4&&h!==(h=`openrouter-chat-model-${l[57]}`)&&u(c,"id",h),T[0]&4&&Ee(c,l[2].roles[l[57]].openrouter_chat_model),T[0]&4&&L!==(L=`openrouter-chat-system-${l[57]}`)&&u(v,"for",L),T[0]&4&&y!==(y=`openrouter-chat-system-${l[57]}`)&&u(M,"id",y),T[0]&4&&we(M,l[2].roles[l[57]].openrouter_chat_system_prompt)},d(A){A&&S(e),A&&S(k),A&&S(w),N=!1,ze(D)}}}function ho(l,e){let t,o,n,a,s,i,c,d,m,p,_,g,h,k,w,v,$,L,E,z,M,y,N,D,G,j,A,T,te,R,Y,q,W,x,O,B,Q,U,I,V,oe,de,ue,Le,ke,_e,fe,Se,be,$e,Ce,ce,me,H,Z,ne,F,ee,le,Ae,Ve,Te,We,Re,Ue,ot,mt,nt,Pe,Mt,Ye,Pt,$t,Fe,se,ge,ht,at,st,Lt,wt,jt,Ft,it,Nt,Ot,Gt,rl,At,gt,pt,Kt,al,zt,il,yt,_t,Wt,ul,Bt,cl,fl,dl,St,pl,qt,Xt,_l;function Io(){e[20].call(d,e[57])}function Ho(){e[21].call($,e[57])}function Fo(){e[22].call(j,e[57])}function Go(){e[23].call(O,e[57])}let Ut=e[55].haystacks,Ge=[];for(let Ke=0;Ke<Ut.length;Ke+=1)Ge[Ke]=po(oo(e,Ut,Ke));function Ko(){return e[35](e[57])}function zo(){e[36].call(be,e[57])}let Be=e[2].roles[e[57]].openrouter_enabled&&_o(e);function Wo(){e[43].call(Ue,e[57])}function Bo(){e[44].call(Fe,e[57])}function ml(){e[45].call(it,e[57])}function qo(){e[46].call(pt,e[57])}function Jo(){e[47].call(_t,e[57])}function Vo(){return e[48](e[57])}return{key:l,first:null,c(){t=f("div"),o=f("div"),n=f("label"),a=J("Role name"),i=b(),c=f("div"),d=f("input"),p=b(),_=f("div"),g=f("label"),h=J("Short name"),w=b(),v=f("div"),$=f("input"),E=b(),z=f("div"),M=f("label"),y=J("Theme"),D=b(),G=f("div"),j=f("input"),T=b(),te=f("div"),R=f("label"),Y=J("Relevance function"),W=b(),x=f("div"),O=f("input"),Q=b(),U=f("h5"),U.textContent="Haystacks",I=b();for(let Ke=0;Ke<Ge.length;Ke+=1)Ge[Ke].c();V=b(),oe=f("button"),de=J("Add Haystack"),Le=b(),ke=f("h5"),ke.textContent="AI-Enhanced Summaries (OpenRouter)",_e=b(),fe=f("div"),Se=f("label"),be=f("input"),Ce=J(`
             Enable AI-generated article summaries`),me=b(),H=f("p"),H.textContent="Generate intelligent summaries using OpenRouter's language models",Z=b(),Be&&Be.c(),ne=b(),F=f("h5"),F.textContent="Knowledge Graph",ee=b(),le=f("div"),Ae=f("label"),Ve=J("Remote automata URL"),We=b(),Re=f("div"),Ue=f("input"),mt=b(),nt=f("div"),Pe=f("label"),Mt=J("Local KG path"),Pt=b(),$t=f("div"),Fe=f("input"),ge=b(),ht=f("div"),at=f("div"),st=f("label"),Lt=J("Local KG type"),jt=b(),Ft=f("div"),it=f("select"),Nt=f("option"),Nt.textContent="markdown",Ot=f("option"),Ot.textContent="json",rl=b(),At=f("div"),gt=f("label"),pt=f("input"),al=J(`
             Public`),il=b(),yt=f("label"),_t=f("input"),ul=J(`
             Publish`),cl=b(),fl=f("hr"),dl=b(),St=f("button"),pl=J("Remove Role"),u(n,"class","label"),u(n,"for",s=`role-name-${e[57]}`),u(d,"class","input"),u(d,"id",m=`role-name-${e[57]}`),u(d,"type","text"),u(c,"class","control"),u(o,"class","field"),u(g,"class","label"),u(g,"for",k=`role-shortname-${e[57]}`),u($,"class","input"),u($,"id",L=`role-shortname-${e[57]}`),u($,"type","text"),u(v,"class","control"),u(_,"class","field"),u(M,"class","label"),u(M,"for",N=`role-theme-${e[57]}`),u(j,"class","input"),u(j,"id",A=`role-theme-${e[57]}`),u(j,"type","text"),u(G,"class","control"),u(z,"class","field"),u(R,"class","label"),u(R,"for",q=`role-relevance-${e[57]}`),u(O,"class","input"),u(O,"id",B=`role-relevance-${e[57]}`),u(O,"type","text"),u(x,"class","control"),u(te,"class","field"),u(U,"class","title is-6"),u(oe,"class","button is-small"),u(oe,"data-testid",ue="add-haystack-"+e[57]),u(ke,"class","title is-6"),u(be,"id",$e=`openrouter-enabled-${e[57]}`),u(be,"type","checkbox"),u(Se,"class","checkbox"),u(Se,"for",ce=`openrouter-enabled-${e[57]}`),u(H,"class","help"),u(fe,"class","field"),u(F,"class","title is-6"),u(Ae,"class","label"),u(Ae,"for",Te=`kg-url-${e[57]}`),u(Ue,"class","input"),u(Ue,"id",ot=`kg-url-${e[57]}`),u(Ue,"type","text"),u(Ue,"placeholder","https://example.com/thesaurus.json"),u(Re,"class","control"),u(le,"class","field"),u(Pe,"class","label"),u(Pe,"for",Ye=`kg-local-path-${e[57]}`),u(Fe,"class","input"),u(Fe,"id",se=`kg-local-path-${e[57]}`),u(Fe,"type","text"),u(Fe,"placeholder","/path/to/markdown"),u($t,"class","control"),u(nt,"class","field"),u(st,"class","label"),u(st,"for",wt=`kg-local-type-${e[57]}`),Nt.__value="markdown",Nt.value=Nt.__value,Ot.__value="json",Ot.value=Ot.__value,u(it,"id",Gt=`kg-local-type-${e[57]}`),e[2].roles[e[57]].kg.local_type===void 0&&lt(ml),u(Ft,"class","select"),u(at,"class","control"),u(ht,"class","field is-grouped"),u(pt,"id",Kt=`kg-public-${e[57]}`),u(pt,"type","checkbox"),u(gt,"class","checkbox"),u(gt,"for",zt=`kg-public-${e[57]}`),Tt(gt,"margin-right","1rem"),u(_t,"id",Wt=`kg-publish-${e[57]}`),u(_t,"type","checkbox"),u(yt,"class","checkbox"),u(yt,"for",Bt=`kg-publish-${e[57]}`),u(At,"class","field is-grouped"),u(St,"class","button is-small is-danger"),u(St,"data-testid",qt="remove-role-"+e[57]),u(t,"class","box"),this.first=t},m(Ke,he){C(Ke,t,he),r(t,o),r(o,n),r(n,a),r(o,i),r(o,c),r(c,d),we(d,e[2].roles[e[57]].name),r(t,p),r(t,_),r(_,g),r(g,h),r(_,w),r(_,v),r(v,$),we($,e[2].roles[e[57]].shortname),r(t,E),r(t,z),r(z,M),r(M,y),r(z,D),r(z,G),r(G,j),we(j,e[2].roles[e[57]].theme),r(t,T),r(t,te),r(te,R),r(R,Y),r(te,W),r(te,x),r(x,O),we(O,e[2].roles[e[57]].relevance_function),r(t,Q),r(t,U),r(t,I);for(let Me=0;Me<Ge.length;Me+=1)Ge[Me]&&Ge[Me].m(t,null);r(t,V),r(t,oe),r(oe,de),r(t,Le),r(t,ke),r(t,_e),r(t,fe),r(fe,Se),r(Se,be),be.checked=e[2].roles[e[57]].openrouter_enabled,r(Se,Ce),r(fe,me),r(fe,H),r(t,Z),Be&&Be.m(t,null),r(t,ne),r(t,F),r(t,ee),r(t,le),r(le,Ae),r(Ae,Ve),r(le,We),r(le,Re),r(Re,Ue),we(Ue,e[2].roles[e[57]].kg.url),r(t,mt),r(t,nt),r(nt,Pe),r(Pe,Mt),r(nt,Pt),r(nt,$t),r($t,Fe),we(Fe,e[2].roles[e[57]].kg.local_path),r(t,ge),r(t,ht),r(ht,at),r(at,st),r(st,Lt),r(at,jt),r(at,Ft),r(Ft,it),r(it,Nt),r(it,Ot),Ee(it,e[2].roles[e[57]].kg.local_type,!0),r(t,rl),r(t,At),r(At,gt),r(gt,pt),pt.checked=e[2].roles[e[57]].kg.public,r(gt,al),r(At,il),r(At,yt),r(yt,_t),_t.checked=e[2].roles[e[57]].kg.publish,r(yt,ul),r(t,cl),r(t,fl),r(t,dl),r(t,St),r(St,pl),Xt||(_l=[X(d,"input",Io),X($,"input",Ho),X(j,"input",Fo),X(O,"input",Go),X(oe,"click",Ko),X(be,"change",zo),X(Ue,"input",Wo),X(Fe,"input",Bo),X(it,"change",ml),X(pt,"change",qo),X(_t,"change",Jo),X(St,"click",Vo)],Xt=!0)},p(Ke,he){if(e=Ke,he[0]&4&&s!==(s=`role-name-${e[57]}`)&&u(n,"for",s),he[0]&4&&m!==(m=`role-name-${e[57]}`)&&u(d,"id",m),he[0]&4&&d.value!==e[2].roles[e[57]].name&&we(d,e[2].roles[e[57]].name),he[0]&4&&k!==(k=`role-shortname-${e[57]}`)&&u(g,"for",k),he[0]&4&&L!==(L=`role-shortname-${e[57]}`)&&u($,"id",L),he[0]&4&&$.value!==e[2].roles[e[57]].shortname&&we($,e[2].roles[e[57]].shortname),he[0]&4&&N!==(N=`role-theme-${e[57]}`)&&u(M,"for",N),he[0]&4&&A!==(A=`role-theme-${e[57]}`)&&u(j,"id",A),he[0]&4&&j.value!==e[2].roles[e[57]].theme&&we(j,e[2].roles[e[57]].theme),he[0]&4&&q!==(q=`role-relevance-${e[57]}`)&&u(R,"for",q),he[0]&4&&B!==(B=`role-relevance-${e[57]}`)&&u(O,"id",B),he[0]&4&&O.value!==e[2].roles[e[57]].relevance_function&&we(O,e[2].roles[e[57]].relevance_function),he[0]&7684){Ut=e[55].haystacks;let Me;for(Me=0;Me<Ut.length;Me+=1){const hl=oo(e,Ut,Me);Ge[Me]?Ge[Me].p(hl,he):(Ge[Me]=po(hl),Ge[Me].c(),Ge[Me].m(t,V))}for(;Me<Ge.length;Me+=1)Ge[Me].d(1);Ge.length=Ut.length}he[0]&4&&ue!==(ue="add-haystack-"+e[57])&&u(oe,"data-testid",ue),he[0]&4&&$e!==($e=`openrouter-enabled-${e[57]}`)&&u(be,"id",$e),he[0]&4&&(be.checked=e[2].roles[e[57]].openrouter_enabled),he[0]&4&&ce!==(ce=`openrouter-enabled-${e[57]}`)&&u(Se,"for",ce),e[2].roles[e[57]].openrouter_enabled?Be?Be.p(e,he):(Be=_o(e),Be.c(),Be.m(t,ne)):Be&&(Be.d(1),Be=null),he[0]&4&&Te!==(Te=`kg-url-${e[57]}`)&&u(Ae,"for",Te),he[0]&4&&ot!==(ot=`kg-url-${e[57]}`)&&u(Ue,"id",ot),he[0]&4&&Ue.value!==e[2].roles[e[57]].kg.url&&we(Ue,e[2].roles[e[57]].kg.url),he[0]&4&&Ye!==(Ye=`kg-local-path-${e[57]}`)&&u(Pe,"for",Ye),he[0]&4&&se!==(se=`kg-local-path-${e[57]}`)&&u(Fe,"id",se),he[0]&4&&Fe.value!==e[2].roles[e[57]].kg.local_path&&we(Fe,e[2].roles[e[57]].kg.local_path),he[0]&4&&wt!==(wt=`kg-local-type-${e[57]}`)&&u(st,"for",wt),he[0]&4&&Gt!==(Gt=`kg-local-type-${e[57]}`)&&u(it,"id",Gt),he[0]&4&&Ee(it,e[2].roles[e[57]].kg.local_type),he[0]&4&&Kt!==(Kt=`kg-public-${e[57]}`)&&u(pt,"id",Kt),he[0]&4&&(pt.checked=e[2].roles[e[57]].kg.public),he[0]&4&&zt!==(zt=`kg-public-${e[57]}`)&&u(gt,"for",zt),he[0]&4&&Wt!==(Wt=`kg-publish-${e[57]}`)&&u(_t,"id",Wt),he[0]&4&&(_t.checked=e[2].roles[e[57]].kg.publish),he[0]&4&&Bt!==(Bt=`kg-publish-${e[57]}`)&&u(yt,"for",Bt),he[0]&4&&qt!==(qt="remove-role-"+e[57])&&u(St,"data-testid",qt)},d(Ke){Ke&&S(t),Je(Ge,Ke),Be&&Be.d(),Xt=!1,ze(_l)}}}function go(l){let e,t=l[52].name+"",o,n;return{c(){e=f("option"),o=J(t),e.__value=n=l[52].name,e.value=e.__value},m(a,s){C(a,e,s),r(e,o)},p(a,s){s[0]&4&&t!==(t=a[52].name+"")&&pe(o,t),s[0]&4&&n!==(n=a[52].name)&&(e.__value=n,e.value=e.__value)},d(a){a&&S(e)}}}function vo(l){let e,t,o;return{c(){e=f("button"),e.textContent="Back",u(e,"class","button"),u(e,"data-testid","wizard-back")},m(n,a){C(n,e,a),t||(o=X(e,"click",l[5]),t=!0)},p:ve,d(n){n&&S(e),t=!1,o()}}}function Qs(l){let e,t,o;return{c(){e=f("button"),e.textContent="Save",u(e,"class","button is-success"),u(e,"data-testid","wizard-save")},m(n,a){C(n,e,a),t||(o=X(e,"click",l[13]),t=!0)},p:ve,d(n){n&&S(e),t=!1,o()}}}function Zs(l){let e,t,o;return{c(){e=f("button"),e.textContent="Next",u(e,"class","button is-primary"),u(e,"data-testid","wizard-next")},m(n,a){C(n,e,a),t||(o=X(e,"click",l[4]),t=!0)},p:ve,d(n){n&&S(e),t=!1,o()}}}function Xs(l){let e,t,o,n,a,s,i,c,d,m,p=l[1]==="success"&&ro(l),_=l[1]==="error"&&ao(l);function g(E,z){return E[0]===1?Js:E[0]===2?qs:Bs}let h=g(l),k=h(l),w=l[0]>1&&vo(l);function v(E,z){return E[0]<jo?Zs:Qs}let $=v(l),L=$(l);return{c(){e=f("div"),t=f("h3"),t.textContent="Configuration Wizard",o=b(),p&&p.c(),n=b(),_&&_.c(),a=b(),k.c(),s=b(),i=f("nav"),c=f("div"),w&&w.c(),d=b(),m=f("div"),L.c(),u(t,"class","title is-4"),u(c,"class","level-left"),u(m,"class","level-right"),u(i,"class","level"),u(e,"class","box")},m(E,z){C(E,e,z),r(e,t),r(e,o),p&&p.m(e,null),r(e,n),_&&_.m(e,null),r(e,a),k.m(e,null),r(e,s),r(e,i),r(i,c),w&&w.m(c,null),r(i,d),r(i,m),L.m(m,null)},p(E,z){E[1]==="success"?p?p.p(E,z):(p=ro(E),p.c(),p.m(e,n)):p&&(p.d(1),p=null),E[1]==="error"?_?_.p(E,z):(_=ao(E),_.c(),_.m(e,a)):_&&(_.d(1),_=null),h===(h=g(E))&&k?k.p(E,z):(k.d(1),k=h(E),k&&(k.c(),k.m(e,s))),E[0]>1?w?w.p(E,z):(w=vo(E),w.c(),w.m(c,null)):w&&(w.d(1),w=null),$===($=v(E))&&L?L.p(E,z):(L.d(1),L=$(E),L&&(L.c(),L.m(m,null)))},i:ve,o:ve,d(E){E&&S(e),p&&p.d(),_&&_.d(),k.d(),w&&w.d(),L.d()}}}const jo=3;function xs(l,e,t){let o;const n=rt(null),a=rt({id:"Desktop",global_shortcut:"Ctrl+X",default_theme:"spacelab",default_role:"Default",roles:[]});ye(l,a,H=>t(2,o=H)),Qt(async()=>{try{let H;bt(Qe)?H=await je("get_config_schema"):H=await(await fetch("/config/schema")).json(),n.set(H);const Z=bt(tt);Z&&Z.id&&a.update(ne=>{var F;return{...ne,id:Z.id,global_shortcut:Z.global_shortcut,default_theme:((F=Z.roles[Z.default_role])==null?void 0:F.theme)??"spacelab",default_role:Z.default_role,roles:Object.values(Z.roles).map(ee=>{var Te,We,Re,Ue,ot,mt,nt;const le=(Te=ee.kg)==null?void 0:Te.automata_path,Ae=(le==null?void 0:le.Remote)??"",Ve=((Re=(We=ee.kg)==null?void 0:We.knowledge_graph_local)==null?void 0:Re.path)??"";return{name:ee.name,shortname:ee.shortname,relevance_function:ee.relevance_function,theme:ee.theme,haystacks:(ee.haystacks??[]).map(Pe=>({path:Pe.location||Pe.path||"",read_only:Pe.read_only??!1,service:Pe.service||"Ripgrep",atomic_server_secret:Pe.atomic_server_secret||"",extra_parameters:Pe.extra_parameters||{}})),kg:{url:Ae,local_path:Ve,local_type:((ot=(Ue=ee.kg)==null?void 0:Ue.knowledge_graph_local)==null?void 0:ot.input_type)??"markdown",public:((mt=ee.kg)==null?void 0:mt.public)??!1,publish:((nt=ee.kg)==null?void 0:nt.publish)??!1},openrouter_enabled:ee.openrouter_enabled??!1,openrouter_api_key:ee.openrouter_api_key??"",openrouter_model:ee.openrouter_model??"openai/gpt-3.5-turbo",openrouter_auto_summarize:ee.openrouter_auto_summarize??!1,openrouter_chat_enabled:ee.openrouter_chat_enabled??!1,openrouter_chat_model:ee.openrouter_chat_model??ee.openrouter_model??"openai/gpt-3.5-turbo",openrouter_chat_system_prompt:ee.openrouter_chat_system_prompt??""}})}})}catch(H){console.error("Failed to load schema",H)}});let s=1,i="";function c(){s<jo&&t(0,s+=1)}function d(){s>1&&t(0,s-=1)}function m(){a.update(H=>({...H,roles:[...H.roles,{name:"New Role",shortname:"new",relevance_function:"title-scorer",theme:"spacelab",haystacks:[],kg:{url:"",local_path:"",local_type:"markdown",public:!1,publish:!1},openrouter_enabled:!1,openrouter_api_key:"",openrouter_model:"openai/gpt-3.5-turbo",openrouter_auto_summarize:!1,openrouter_chat_enabled:!1,openrouter_chat_model:"openai/gpt-3.5-turbo",openrouter_chat_system_prompt:""}]}))}function p(H){a.update(Z=>({...Z,roles:Z.roles.filter((ne,F)=>F!==H)}))}function _(H){a.update(Z=>(Z.roles[H].haystacks.push({path:"",read_only:!1,service:"Ripgrep",atomic_server_secret:"",extra_parameters:{}}),Z))}function g(H,Z){a.update(ne=>(ne.roles[H].haystacks=ne.roles[H].haystacks.filter((F,ee)=>ee!==Z),ne))}function h(H,Z,ne="",F=""){a.update(ee=>{ee.roles[H].haystacks[Z].extra_parameters||(ee.roles[H].haystacks[Z].extra_parameters={});const le=ne||`param_${Date.now()}`;return ee.roles[H].haystacks[Z].extra_parameters[le]=F,ee})}function k(H,Z,ne){a.update(F=>(delete F.roles[H].haystacks[Z].extra_parameters[ne],F))}function w(H,Z,ne,F){a.update(ee=>{const le=ee.roles[H].haystacks[Z].extra_parameters;return le[ne]!==void 0&&ne!==F&&(le[F]=le[ne],delete le[ne]),ee})}function v(H,Z,ne,F){const ee=F.target.value;w(H,Z,ne,ee)}async function $(){var ee;const H=bt(a),Z=bt(tt);let ne={...Z};ne.id=H.id,ne.global_shortcut=H.global_shortcut,ne.default_role=H.default_role;const F={};H.roles.forEach(le=>{var Te,We;const Ae=le.name,Ve=Ae.replace(/^"|"$/g,"");F[Ve]={extra:((We=(Te=Z.roles)==null?void 0:Te[Ae])==null?void 0:We.extra)??{},name:le.name,shortname:le.shortname,theme:le.theme,relevance_function:le.relevance_function,haystacks:le.haystacks.map(Re=>({location:Re.path,service:Re.service,read_only:Re.read_only,atomic_server_secret:Re.service==="Atomic"?Re.atomic_server_secret:void 0,extra_parameters:Re.extra_parameters||{}})),kg:le.kg.url||le.kg.local_path?{automata_path:le.kg.url?{Remote:le.kg.url}:null,knowledge_graph_local:le.kg.local_path?{input_type:le.kg.local_type,path:le.kg.local_path}:null,public:le.kg.public,publish:le.kg.publish}:null,...le.openrouter_enabled&&{openrouter_enabled:le.openrouter_enabled,openrouter_api_key:le.openrouter_api_key,openrouter_model:le.openrouter_model,openrouter_auto_summarize:le.openrouter_auto_summarize??!1,openrouter_chat_enabled:le.openrouter_chat_enabled??!1,openrouter_chat_model:le.openrouter_chat_model??le.openrouter_model,openrouter_chat_system_prompt:le.openrouter_chat_system_prompt??""}}}),ne.roles=F,(!ne.default_role||!F[ne.default_role])&&(ne.default_role=((ee=H.roles[0])==null?void 0:ee.name)??"Default"),ne.selected_role=ne.default_role;try{if(bt(Qe))await je("update_config",{configNew:ne});else{const le=await fetch("/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ne)});if(!le.ok)throw new Error(`HTTP ${le.status}: ${le.statusText}`)}tt.set(ne),t(1,i="success"),setTimeout(()=>{t(1,i="")},3e3)}catch(le){console.error(le),t(1,i="error"),setTimeout(()=>{t(1,i="")},3e3)}}const L=()=>t(1,i=""),E=()=>t(1,i="");function z(){o.id=vt(this),a.set(o)}function M(){o.global_shortcut=this.value,a.set(o)}function y(){o.default_theme=this.value,a.set(o)}function N(){o.default_role=vt(this),a.set(o)}function D(H){o.roles[H].name=this.value,a.set(o)}function G(H){o.roles[H].shortname=this.value,a.set(o)}function j(H){o.roles[H].theme=this.value,a.set(o)}function A(H){o.roles[H].relevance_function=this.value,a.set(o)}function T(H,Z){o.roles[H].haystacks[Z].service=vt(this),a.set(o)}function te(H,Z){o.roles[H].haystacks[Z].path=this.value,a.set(o)}function R(H,Z){o.roles[H].haystacks[Z].atomic_server_secret=this.value,a.set(o)}const Y=(H,Z,ne,F)=>v(H,Z,ne,F);function q(H,Z,ne){o.roles[H].haystacks[Z].extra_parameters[ne]=this.value,a.set(o)}const W=(H,Z,ne)=>k(H,Z,ne),x=(H,Z)=>h(H,Z,"tag","#rust"),O=(H,Z)=>h(H,Z,"max_count","10"),B=(H,Z)=>h(H,Z,"","");function Q(H,Z){o.roles[H].haystacks[Z].read_only=this.checked,a.set(o)}const U=(H,Z)=>g(H,Z),I=H=>_(H);function V(H){o.roles[H].openrouter_enabled=this.checked,a.set(o)}function oe(H){o.roles[H].openrouter_api_key=this.value,a.set(o)}function de(H){o.roles[H].openrouter_model=vt(this),a.set(o)}function ue(H){o.roles[H].openrouter_auto_summarize=this.checked,a.set(o)}function Le(H){o.roles[H].openrouter_chat_enabled=this.checked,a.set(o)}function ke(H){o.roles[H].openrouter_chat_model=vt(this),a.set(o)}function _e(H){o.roles[H].openrouter_chat_system_prompt=this.value,a.set(o)}function fe(H){o.roles[H].kg.url=this.value,a.set(o)}function Se(H){o.roles[H].kg.local_path=this.value,a.set(o)}function be(H){o.roles[H].kg.local_type=vt(this),a.set(o)}function $e(H){o.roles[H].kg.public=this.checked,a.set(o)}function Ce(H){o.roles[H].kg.publish=this.checked,a.set(o)}return[s,i,o,a,c,d,m,p,_,g,h,k,v,$,L,E,z,M,y,N,D,G,j,A,T,te,R,Y,q,W,x,O,B,Q,U,I,V,oe,de,ue,Le,ke,_e,fe,Se,be,$e,Ce,H=>p(H),()=>{t(0,s=2)}]}class er extends Ze{constructor(e){super(),Xe(this,e,xs,Xs,qe,{},null,[-1,-1,-1])}}function tr(l){let e,t,o,n,a,s;return a=new Eo({props:{content:l[0],onChange:l[1]}}),{c(){e=f("div"),t=f("p"),t.innerHTML="<i>The best editing experience is to configure Atomic Server, in the meantime use editor below. You will need to refresh page via Command R or Ctrl-R to see changes</i>",o=b(),n=f("div"),re(a.$$.fragment),u(n,"class","editor"),u(e,"class","box")},m(i,c){C(i,e,c),r(e,t),r(e,o),r(e,n),ae(a,n,null),s=!0},p(i,[c]){const d={};c&1&&(d.content=i[0]),a.$set(d)},i(i){s||(P(a.$$.fragment,i),s=!0)},o(i){K(a.$$.fragment,i),s=!1},d(i){i&&S(e),ie(a)}}}function lr(l,e,t){let o,n;ye(l,tt,i=>t(2,o=i)),ye(l,Qe,i=>t(3,n=i));let a={json:o};function s(i){if(console.log("contents changed:",i),console.log("is tauri",n),tt.update(c=>(c=i.json,c)),bt(Qe))console.log("Updating config on server"),je("update_config",{configNew:i.json}).then(c=>{console.log(`Message: ${c}`)}).catch(c=>console.error(c));else{let c=`${et.ServerURL}/config/`;fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i.json)})}t(0,a=i)}return Qt(()=>{t(0,a={json:o})}),[a,s]}class or extends Ze{constructor(e){super(),Xe(this,e,lr,tr,qe,{})}}const{window:ol}=nn;function nr(l){let e,t,o,n,a,s,i,c,d,m;return{c(){e=f("div"),t=f("div"),o=f("h3"),o.textContent="Error loading graph",n=b(),a=f("p"),s=J(l[3]),i=b(),c=f("button"),c.textContent="Retry",u(c,"class","button is-primary"),u(t,"class","error-content svelte-1ry9pkl"),u(e,"class","error-overlay svelte-1ry9pkl")},m(p,_){C(p,e,_),r(e,t),r(t,o),r(t,n),r(t,a),r(a,s),r(t,i),r(t,c),d||(m=X(c,"click",l[11]),d=!0)},p(p,_){_&8&&pe(s,p[3])},d(p){p&&S(e),d=!1,m()}}}function sr(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="loading-content svelte-1ry9pkl"><div class="loader svelte-1ry9pkl"></div> 
        <p>Loading knowledge graph...</p></div>`,u(e,"class","loading-overlay svelte-1ry9pkl")},m(t,o){C(t,e,o)},p:ve,d(t){t&&S(e)}}}function bo(l){let e,t,o;return{c(){e=f("button"),e.innerHTML='<i class="fas fa-times svelte-1ry9pkl"></i>',u(e,"class","close-button svelte-1ry9pkl"),u(e,"title","Close Graph")},m(n,a){C(n,e,a),t||(o=X(e,"click",l[17]),t=!0)},p:ve,d(n){n&&S(e),t=!1,o()}}}function ko(l){let e;return{c(){e=f("div"),e.innerHTML="<span><strong>Left-click:</strong> View node • <strong>Right-click:</strong> Edit node • <strong>Drag:</strong> Move • <strong>Scroll:</strong> Zoom</span>",u(e,"class","controls-info svelte-1ry9pkl")},m(t,o){C(t,e,o)},d(t){t&&S(e)}}}function $o(l){let e,t;return{c(){e=f("div"),t=J(l[8]),u(e,"class","debug-message svelte-1ry9pkl")},m(o,n){C(o,e,n),r(e,t)},p(o,n){n&256&&pe(t,o[8])},d(o){o&&S(e)}}}function wo(l){let e=l[5].id,t,o,n=yo(l);return{c(){n.c(),t=xe()},m(a,s){n.m(a,s),C(a,t,s),o=!0},p(a,s){s&32&&qe(e,e=a[5].id)?(Ne(),K(n,1,1,ve),Oe(),n=yo(a),n.c(),P(n,1),n.m(t.parentNode,t)):n.p(a,s)},i(a){o||(P(n),o=!0)},o(a){K(n),o=!1},d(a){a&&S(t),n.d(a)}}}function yo(l){let e,t,o;function n(s){l[18](s)}let a={item:l[5],initialEdit:l[7]};return l[6]!==void 0&&(a.active=l[6]),e=new sl({props:a}),De.push(()=>Ie(e,"active",n)),e.$on("close",l[12]),e.$on("save",l[13]),{c(){re(e.$$.fragment)},m(s,i){ae(e,s,i),o=!0},p(s,i){const c={};i&32&&(c.item=s[5]),i&128&&(c.initialEdit=s[7]),!t&&i&64&&(t=!0,c.active=s[6],He(()=>t=!1)),e.$set(c)},i(s){o||(P(e.$$.fragment,s),o=!0)},o(s){K(e.$$.fragment,s),o=!1},d(s){ie(e,s)}}}function rr(l){let e,t,o,n,a,s,i,c,d;lt(l[15]);function m(v,$){if(v[2])return sr;if(v[3])return nr}let p=m(l),_=p&&p(l),g=l[0]&&bo(l),h=!l[2]&&!l[3]&&l[4].length>0&&ko(),k=l[8]&&$o(l),w=l[5]&&wo(l);return{c(){e=f("div"),_&&_.c(),t=b(),g&&g.c(),o=b(),h&&h.c(),n=b(),k&&k.c(),a=b(),w&&w.c(),s=xe(),u(e,"class","graph-container svelte-1ry9pkl"),Tt(e,"width",l[0]?"100vw":"600px"),Tt(e,"height",l[0]?"100vh":"400px"),dt(e,"fullscreen",l[0])},m(v,$){C(v,e,$),_&&_.m(e,null),l[16](e),C(v,t,$),g&&g.m(v,$),C(v,o,$),h&&h.m(v,$),C(v,n,$),k&&k.m(v,$),C(v,a,$),w&&w.m(v,$),C(v,s,$),i=!0,c||(d=X(ol,"resize",l[15]),c=!0)},p(v,[$]){p===(p=m(v))&&_?_.p(v,$):(_&&_.d(1),_=p&&p(v),_&&(_.c(),_.m(e,null))),(!i||$&1)&&Tt(e,"width",v[0]?"100vw":"600px"),(!i||$&1)&&Tt(e,"height",v[0]?"100vh":"400px"),(!i||$&1)&&dt(e,"fullscreen",v[0]),v[0]?g?g.p(v,$):(g=bo(v),g.c(),g.m(o.parentNode,o)):g&&(g.d(1),g=null),!v[2]&&!v[3]&&v[4].length>0?h||(h=ko(),h.c(),h.m(n.parentNode,n)):h&&(h.d(1),h=null),v[8]?k?k.p(v,$):(k=$o(v),k.c(),k.m(a.parentNode,a)):k&&(k.d(1),k=null),v[5]?w?(w.p(v,$),$&32&&P(w,1)):(w=wo(v),w.c(),P(w,1),w.m(s.parentNode,s)):w&&(Ne(),K(w,1,1,()=>{w=null}),Oe())},i(v){i||(P(w),i=!0)},o(v){K(w),i=!1},d(v){v&&S(e),_&&_.d(),l[16](null),v&&S(t),g&&g.d(v),v&&S(o),h&&h.d(v),v&&S(n),k&&k.d(v),v&&S(a),w&&w.d(v),v&&S(s),c=!1,d()}}}function So(l){return{id:`kg-node-${l.id}`,url:`#/graph/node/${l.id}`,title:l.label,body:`# ${l.label}

**Knowledge Graph Node**

ID: ${l.id}
Rank: ${l.rank}

This is a concept node from the knowledge graph. You can edit this content to add more information about "${l.label}".`,description:`Knowledge graph concept: ${l.label}`,tags:["knowledge-graph","concept"],rank:l.rank,stub:`Knowledge graph concept: ${l.label}`}}function ar(l,e,t){let o,n;ye(l,ct,T=>t(20,o=T)),ye(l,Qe,T=>t(21,n=T));let{apiUrl:a="/rolegraph"}=e,{fullscreen:s=!0}=e,i,c=!0,d=null,m=[],p=[],_=null,g=!1,h=!1,k="",w=window.innerWidth,v=window.innerHeight;function $(){t(9,w=window.innerWidth),t(10,v=window.innerHeight),!c&&!d&&N()}async function L(){t(2,c=!0),t(3,d=null);try{if(n){console.log("Loading rolegraph from Tauri");const T=await je("get_rolegraph",{role_name:o||void 0});if(T&&T.status==="success")t(4,m=T.nodes),p=T.edges;else throw new Error(`Tauri rolegraph fetch failed: ${(T==null?void 0:T.status)||"unknown error"}`)}else{console.log("Loading rolegraph from server");const T=o?`${a}?role=${encodeURIComponent(o)}`:a,te=await fetch(T);if(!te.ok)throw new Error(`Failed to fetch: ${te.status}`);const R=await te.json();t(4,m=R.nodes),p=R.edges}}catch(T){t(3,d=T.message),console.error("Error fetching rolegraph:",T)}finally{t(2,c=!1)}}function E(T,te){T.stopPropagation(),console.log("Node clicked:",te.label),t(5,_=So(te)),t(7,h=!1),t(6,g=!0)}function z(T,te){T.preventDefault(),T.stopPropagation(),console.log("Node right-clicked:",te.label),t(8,k=`Right-clicked: ${te.label}`),t(5,_=So(te)),t(7,h=!0),t(6,g=!0),setTimeout(()=>{t(8,k="")},2e3)}function M(){t(6,g=!1),t(5,_=null),t(7,h=!1)}async function y(){if(_)try{const T=await fetch("/documents",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(_)});T.ok?console.log("Successfully saved KG record:",_.id):console.error("Failed to save KG record:",T.statusText)}catch(T){console.error("Error saving KG record:",T)}finally{t(6,g=!1),t(5,_=null),t(7,h=!1)}}function N(){if(!i)return;t(1,i.innerHTML="",i);const T=xt(i).append("svg").attr("width",w).attr("height",v),te=pn().scaleExtent([.1,10]).on("zoom",U=>{R.attr("transform",U.transform)});T.call(te);const R=T.append("g"),Y=_n(m).force("link",mn(p).id(U=>U.id).distance(100)).force("charge",hn().strength(-200)).force("center",gn(w/2,v/2)).force("collision",vn().radius(20)),q=R.append("g").attr("class","links").selectAll("line").data(p).enter().append("line").attr("stroke","#666").attr("stroke-opacity",.7).attr("stroke-width",U=>{const I=U.weight||U.rank||1;return Math.max(1,Math.min(8,I*2))}),W=R.append("g").attr("class","nodes").selectAll("circle").data(m).enter().append("circle").attr("r",U=>{const I=U.rank||1;return Math.max(6,Math.min(20,I*2))}).attr("fill",U=>{const I=U.rank||1,V=Math.min(I/10,1);return bn(.2+V*.6)}).attr("stroke","#fff").attr("stroke-width",2).style("cursor","pointer").on("click",(U,I)=>E(U,I)).on("contextmenu",(U,I)=>z(U,I)).on("mouseover",function(U,I){xt(this).transition().duration(150).attr("stroke-width",3).attr("r",V=>{const oe=V.rank||1;return Math.max(8,Math.min(24,oe*2.5))})}).on("mouseout",function(U,I){xt(this).transition().duration(150).attr("stroke-width",2).attr("r",V=>{const oe=V.rank||1;return Math.max(6,Math.min(20,oe*2))})}).call(kn().on("start",O).on("drag",B).on("end",Q)),x=R.append("g").attr("class","labels").selectAll("text").data(m).enter().append("text").attr("text-anchor","middle").attr("dy",".35em").attr("font-size","11px").attr("font-family","Arial, sans-serif").attr("fill","#333").attr("pointer-events","none").text(U=>U.label.length>12?U.label.substring(0,12)+"...":U.label);Y.on("tick",()=>{q.attr("x1",U=>U.source.x).attr("y1",U=>U.source.y).attr("x2",U=>U.target.x).attr("y2",U=>U.target.y),W.attr("cx",U=>U.x).attr("cy",U=>U.y),x.attr("x",U=>U.x).attr("y",U=>U.y)});function O(U,I){U.active||Y.alphaTarget(.3).restart(),I.fx=I.x,I.fy=I.y}function B(U,I){I.fx=U.x,I.fy=U.y}function Q(U,I){U.active||Y.alphaTarget(0),I.fx=null,I.fy=null}}Qt(()=>{L().then(()=>{d||N()});const T=te=>{te.preventDefault()};return i&&i.addEventListener("contextmenu",T),window.addEventListener("resize",$),()=>{i&&i.removeEventListener("contextmenu",T),window.removeEventListener("resize",$)}});function D(){t(9,w=ol.innerWidth),t(10,v=ol.innerHeight)}function G(T){De[T?"unshift":"push"](()=>{i=T,t(1,i)})}const j=()=>history.back();function A(T){g=T,t(6,g)}return l.$$set=T=>{"apiUrl"in T&&t(14,a=T.apiUrl),"fullscreen"in T&&t(0,s=T.fullscreen)},[s,i,c,d,m,_,g,h,k,w,v,L,M,y,a,D,G,j,A]}class ir extends Ze{constructor(e){super(),Xe(this,e,ar,rr,qe,{apiUrl:14,fullscreen:0})}}function Co(l,e,t){const o=l.slice();return o[9]=e[t],o[11]=t,o}function To(l){let e,t,o,n=l[9].content+"",a,s;return{c(){e=f("div"),t=f("div"),o=f("pre"),a=J(n),u(o,"class","svelte-tu8ic4"),u(t,"class","bubble svelte-tu8ic4"),u(e,"class",s=ft(`msg ${l[9].role}`)+" svelte-tu8ic4")},m(i,c){C(i,e,c),r(e,t),r(t,o),r(o,a)},p(i,c){c&1&&n!==(n=i[9].content+"")&&pe(a,n),c&1&&s!==(s=ft(`msg ${i[9].role}`)+" svelte-tu8ic4")&&u(e,"class",s)},d(i){i&&S(e)}}}function Ro(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="bubble loading svelte-tu8ic4"><span class="icon is-small"><i class="fas fa-spinner fa-spin"></i></span> 
            <span>Thinking...</span></div>`,u(e,"class","msg assistant svelte-tu8ic4")},m(t,o){C(t,e,o)},d(t){t&&S(e)}}}function Lo(l){let e,t,o;return{c(){e=f("p"),t=J("Model: "),o=J(l[4]),u(e,"class","is-size-7 has-text-grey")},m(n,a){C(n,e,a),r(e,t),r(e,o)},p(n,a){a&16&&pe(o,n[4])},d(n){n&&S(e)}}}function No(l){let e,t;return{c(){e=f("p"),t=J(l[3]),u(e,"class","has-text-danger is-size-7")},m(o,n){C(o,e,n),r(e,t)},p(o,n){n&8&&pe(t,o[3])},d(o){o&&S(e)}}}function ur(l){let e,t,o,n,a,s,i,c,d,m,p,_,g,h,k,w,v,$,L,E,z,M=l[0],y=[];for(let j=0;j<M.length;j+=1)y[j]=To(Co(l,M,j));let N=l[2]&&Ro(),D=l[4]&&Lo(l),G=l[3]&&No(l);return{c(){e=f("section"),t=f("div"),o=f("h2"),o.textContent="Chat",n=b(),a=f("p"),a.textContent=`Role: ${bt(ct)}`,s=b(),i=f("div");for(let j=0;j<y.length;j+=1)y[j].c();c=b(),N&&N.c(),d=b(),D&&D.c(),m=b(),G&&G.c(),p=b(),_=f("div"),g=f("div"),h=f("textarea"),k=b(),w=f("div"),v=f("button"),$=f("span"),$.innerHTML='<i class="fas fa-paper-plane"></i>',u(o,"class","title is-4"),u(a,"class","subtitle is-6"),u(i,"class","chat-window svelte-tu8ic4"),u(h,"class","textarea"),u(h,"rows","3"),u(h,"placeholder","Type your message and press Enter..."),u(g,"class","control is-expanded"),u($,"class","icon"),u(v,"class","button is-primary"),v.disabled=L=l[2]||!l[1].trim(),u(w,"class","control"),u(_,"class","field has-addons chat-input svelte-tu8ic4"),u(t,"class","container"),u(e,"class","section")},m(j,A){C(j,e,A),r(e,t),r(t,o),r(t,n),r(t,a),r(t,s),r(t,i);for(let T=0;T<y.length;T+=1)y[T]&&y[T].m(i,null);r(i,c),N&&N.m(i,null),r(t,d),D&&D.m(t,null),r(t,m),G&&G.m(t,null),r(t,p),r(t,_),r(_,g),r(g,h),we(h,l[1]),r(_,k),r(_,w),r(w,v),r(v,$),E||(z=[X(h,"input",l[7]),X(h,"keydown",l[6]),X(v,"click",l[5])],E=!0)},p(j,[A]){if(A&1){M=j[0];let T;for(T=0;T<M.length;T+=1){const te=Co(j,M,T);y[T]?y[T].p(te,A):(y[T]=To(te),y[T].c(),y[T].m(i,c))}for(;T<y.length;T+=1)y[T].d(1);y.length=M.length}j[2]?N||(N=Ro(),N.c(),N.m(i,null)):N&&(N.d(1),N=null),j[4]?D?D.p(j,A):(D=Lo(j),D.c(),D.m(t,m)):D&&(D.d(1),D=null),j[3]?G?G.p(j,A):(G=No(j),G.c(),G.m(t,p)):G&&(G.d(1),G=null),A&2&&we(h,j[1]),A&6&&L!==(L=j[2]||!j[1].trim())&&(v.disabled=L)},i:ve,o:ve,d(j){j&&S(e),Je(y,j),N&&N.d(),D&&D.d(),G&&G.d(),E=!1,ze(z)}}}function cr(l,e,t){let o=[],n="",a=!1,s=null,i=null;function c(_){t(0,o=[...o,{role:"user",content:_}])}async function d(){var h;if(!n.trim()||a)return;t(3,s=null);const _=bt(ct),g=n.trim();t(1,n=""),c(g),t(2,a=!0);try{const k=await fetch(`${et.ServerURL}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({role:_,messages:o})});if(!k.ok)throw new Error(`HTTP ${k.status}`);const w=await k.json();t(4,i=w.model_used??null),((h=w.status)==null?void 0:h.toLowerCase())==="success"&&w.message?t(0,o=[...o,{role:"assistant",content:w.message}]):t(3,s=w.error||"Chat failed")}catch(k){t(3,s=(k==null?void 0:k.message)||String(k))}finally{t(2,a=!1)}}function m(_){(_.key==="Enter"||_.key==="Return")&&!_.shiftKey&&(_.preventDefault(),d())}Qt(()=>{t(0,o=[{role:"assistant",content:"Hi! How can I help you? Ask me anything about your search results or documents."}])});function p(){n=this.value,t(1,n)}return[o,n,a,s,i,d,m,p]}class fr extends Ze{constructor(e){super(),Xe(this,e,cr,ur,qe,{})}}function dr(l){let e,t;return e=new Ws({}),{c(){re(e.$$.fragment)},m(o,n){ae(e,o,n),t=!0},i(o){t||(P(e.$$.fragment,o),t=!0)},o(o){K(e.$$.fragment,o),t=!1},d(o){ie(e,o)}}}function pr(l){let e,t;return e=new Wn({}),{c(){re(e.$$.fragment)},m(o,n){ae(e,o,n),t=!0},i(o){t||(P(e.$$.fragment,o),t=!0)},o(o){K(e.$$.fragment,o),t=!1},d(o){ie(e,o)}}}function _r(l){let e,t;return e=new er({}),{c(){re(e.$$.fragment)},m(o,n){ae(e,o,n),t=!0},i(o){t||(P(e.$$.fragment,o),t=!0)},o(o){K(e.$$.fragment,o),t=!1},d(o){ie(e,o)}}}function mr(l){let e,t;return e=new or({}),{c(){re(e.$$.fragment)},m(o,n){ae(e,o,n),t=!0},i(o){t||(P(e.$$.fragment,o),t=!0)},o(o){K(e.$$.fragment,o),t=!1},d(o){ie(e,o)}}}function hr(l){let e,t;return e=new ir({}),{c(){re(e.$$.fragment)},m(o,n){ae(e,o,n),t=!0},i(o){t||(P(e.$$.fragment,o),t=!0)},o(o){K(e.$$.fragment,o),t=!1},d(o){ie(e,o)}}}function gr(l){let e,t;return e=new fr({}),{c(){re(e.$$.fragment)},m(o,n){ae(e,o,n),t=!0},i(o){t||(P(e.$$.fragment,o),t=!0)},o(o){K(e.$$.fragment,o),t=!1},d(o){ie(e,o)}}}function vr(l){let e;return{c(){e=f("nav"),e.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
            <a class="navbar-item" href="/config/wizard">Wizard</a> 
            <a class="navbar-item" href="/config/json">JSON Editor</a> 
            <a class="navbar-item" href="/graph">Graph</a> 
            <a class="navbar-item" href="/chat">Chat</a></div>`,u(e,"class","navbar")},m(t,o){C(t,e,o)},p:ve,d(t){t&&S(e)}}}function br(l){let e,t,o,n,a,s,i,c,d,m,p,_,g,h,k,w,v,$,L,E,z,M,y,N,D,G,j,A,T,te;return i=new Jt({}),m=new ut({props:{path:"/",$$slots:{default:[dr]},$$scope:{ctx:l}}}),h=new ut({props:{path:"/fetch/*",$$slots:{default:[pr]},$$scope:{ctx:l}}}),w=new ut({props:{path:"/config/wizard",$$slots:{default:[_r]},$$scope:{ctx:l}}}),$=new ut({props:{path:"/config/json",$$slots:{default:[mr]},$$scope:{ctx:l}}}),E=new ut({props:{path:"/graph",$$slots:{default:[hr]},$$scope:{ctx:l}}}),M=new ut({props:{path:"/chat",$$slots:{default:[gr]},$$scope:{ctx:l}}}),G=new ut({props:{path:"/",$$slots:{default:[vr]},$$scope:{ctx:l}}}),{c(){e=f("meta"),t=b(),o=f("div"),n=f("main"),a=f("div"),s=f("div"),re(i.$$.fragment),c=b(),d=f("div"),re(m.$$.fragment),p=b(),_=f("br"),g=b(),re(h.$$.fragment),k=b(),re(w.$$.fragment),v=b(),re($.$$.fragment),L=b(),re(E.$$.fragment),z=b(),re(M.$$.fragment),y=b(),N=f("footer"),D=f("div"),re(G.$$.fragment),u(e,"name","color-scheme"),u(e,"content",l[1]),document.title="Terraphim",u(s,"class","role-selector svelte-1bfpta4"),u(a,"class","top-controls svelte-1bfpta4"),u(d,"class","search-area svelte-1bfpta4"),u(n,"class","main-content svelte-1bfpta4"),u(D,"class",j=ft(l[0])+" svelte-1bfpta4"),u(N,"class","svelte-1bfpta4"),u(o,"class","is-full-height svelte-1bfpta4")},m(R,Y){r(document.head,e),C(R,t,Y),C(R,o,Y),r(o,n),r(n,a),r(a,s),ae(i,s,null),r(n,c),r(n,d),ae(m,d,null),r(n,p),r(n,_),r(n,g),ae(h,n,null),r(n,k),ae(w,n,null),r(n,v),ae($,n,null),r(n,L),ae(E,n,null),r(n,z),ae(M,n,null),r(o,y),r(o,N),r(N,D),ae(G,D,null),A=!0,T||(te=[X(N,"mouseover",l[2]),X(N,"focus",l[2])],T=!0)},p(R,[Y]){(!A||Y&2)&&u(e,"content",R[1]);const q={};Y&8&&(q.$$scope={dirty:Y,ctx:R}),m.$set(q);const W={};Y&8&&(W.$$scope={dirty:Y,ctx:R}),h.$set(W);const x={};Y&8&&(x.$$scope={dirty:Y,ctx:R}),w.$set(x);const O={};Y&8&&(O.$$scope={dirty:Y,ctx:R}),$.$set(O);const B={};Y&8&&(B.$$scope={dirty:Y,ctx:R}),E.$set(B);const Q={};Y&8&&(Q.$$scope={dirty:Y,ctx:R}),M.$set(Q);const U={};Y&8&&(U.$$scope={dirty:Y,ctx:R}),G.$set(U),(!A||Y&1&&j!==(j=ft(R[0])+" svelte-1bfpta4"))&&u(D,"class",j)},i(R){A||(P(i.$$.fragment,R),P(m.$$.fragment,R),P(h.$$.fragment,R),P(w.$$.fragment,R),P($.$$.fragment,R),P(E.$$.fragment,R),P(M.$$.fragment,R),P(G.$$.fragment,R),A=!0)},o(R){K(i.$$.fragment,R),K(m.$$.fragment,R),K(h.$$.fragment,R),K(w.$$.fragment,R),K($.$$.fragment,R),K(E.$$.fragment,R),K(M.$$.fragment,R),K(G.$$.fragment,R),A=!1},d(R){S(e),R&&S(t),R&&S(o),ie(i),ie(m),ie(h),ie(w),ie($),ie(E),ie(M),ie(G),T=!1,ze(te)}}}function kr(l,e,t){let o;ye(l,Ht,s=>t(1,o=s));let n="is-hidden";function a(){t(0,n="")}return[n,o,a]}class $r extends Ze{constructor(e){super(),Xe(this,e,kr,br,qe,{})}}const wr=new cn;fn(wr);new $r({target:document.getElementById("app")});
