import{aa as Ne,S as De,i as Ue,s as Re,q as d,Y as te,b as L,y as u,Z as ke,I as fe,j as R,ak as ue,au as ze,r as q,a as S,v as c,z,t as O,d as D,B,av as Zl,aw as pt,H as ye,U as Ee,V as Oe,ax as Ol,ay as Ql,F as xe,g as Te,e as Le,O as Be,az as Xl,l as V,E as Ie,aA as Pe,aB as Dl,C as Xe,D as yt,G as St,aC as Ul,a2 as xl,aD as en,x as Tt,ac as tn,m as Mt,af as rt,aE as Ct,W as Ze,a7 as ln,a9 as nn,a1 as pe,n as on,w as Zt}from"./vendor-ui-9d42ca49.js";import{R as Ke,S as Al}from"./vendor-utils-9430c5aa.js";import{J as Ml,_ as sn,o as rn}from"./vendor-editor-1278af61.js";import{P as Pl,T as Lt,u as jl,y as an,A as cn,S as un,q as fn}from"./vendor-atomic-756de3e6.js";import{E as pn}from"./novel-editor-7c40b83e.js";import{s as Et,z as dn,a as _n,l as mn,m as hn,c as gn,b as vn,B as bn,d as kn}from"./vendor-charts-e6a4a6c9.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))t(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&t(s)}).observe(document,{childList:!0,subtree:!0});function l(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function t(o){if(o.ep)return;o.ep=!0;const a=l(o);fetch(o.href,a)}})();const Qe={ServerURL:location.protocol+"//"+window.location.host||"/"},Dt=Ne([]),$n={id:"Desktop",global_shortcut:"",roles:{},default_role:{original:"",lowercase:""},selected_role:{original:"",lowercase:""}},ft=Ne("spacelab"),at=Ne("selected"),Ce=Ne(!1),wn=Ne(`${Qe.ServerURL}/documents/search`),je=Ne($n),Qt=Ne([]);let Ot=Ne("");const ut=Ne(!1);let Ye=null;function yn(n){if(typeof document>"u")return;const e=`/assets/bulmaswatch/${n}/bulmaswatch.min.css`;if(Ye!=null&&Ye.href.endsWith(e))return;const l=document.createElement("link");l.rel="stylesheet",l.href=e,l.id="bulma-theme",l.onload=()=>{Ye&&Ye!==l&&Ye.remove(),Ye=l},document.head.appendChild(l);const t=document.head.querySelector('meta[name="color-scheme"]');t&&t.setAttribute("content",n)}ft.subscribe(yn);function Sn(n){let e,l;return{c(){e=d("option"),l=te(n[1]),e.__value=n[0],e.value=e.__value},m(t,o){L(t,e,o),u(e,l)},p(t,[o]){o&2&&ke(l,t[1]),o&1&&(e.__value=t[0],e.value=e.__value)},i:fe,o:fe,d(t){t&&R(e)}}}function Cn(n,e,l){let t,{subject:o}=e;const a=Pl(o),s=Lt(a,jl.properties.name);return ue(n,s,r=>l(1,t=r)),Lt(a,"http://localhost:9883/property/theme"),n.$$set=r=>{"subject"in r&&l(0,o=r.subject)},[o,t,s]}class Rn extends De{constructor(e){super(),Ue(this,e,Cn,Sn,Re,{subject:0})}}function Tn(){return window.crypto.getRandomValues(new Uint32Array(1))[0]}function Ut(n,e=!1){const l=Tn(),t=`_${l}`;return Object.defineProperty(window,t,{value:o=>(e&&Reflect.deleteProperty(window,t),n==null?void 0:n(o)),writable:!1,configurable:!0}),l}async function be(n,e={}){return new Promise((l,t)=>{const o=Ut(s=>{l(s),Reflect.deleteProperty(window,`_${a}`)},!0),a=Ut(s=>{t(s),Reflect.deleteProperty(window,`_${o}`)},!0);window.__TAURI_IPC__({cmd:n,callback:o,error:a,...e})})}function Xt(n,e,l){const t=n.slice();return t[25]=e[l],t}function Ln(n){let e,l,t;function o(s){n[13](s)}let a={};return n[5]!==void 0&&(a.value=n[5]),e=new pt({props:a}),ye.push(()=>Ee(e,"value",o)),{c(){q(e.$$.fragment)},m(s,r){z(e,s,r),t=!0},p(s,r){const i={};!l&&r&32&&(l=!0,i.value=s[5],Oe(()=>l=!1)),e.$set(i)},i(s){t||(O(e.$$.fragment,s),t=!0)},o(s){D(e.$$.fragment,s),t=!1},d(s){B(e,s)}}}function Nn(n){let e,l,t;function o(s){n[14](s)}let a={type:"password",placeholder:"secret",icon:"fas fa-lock",expanded:!0};return n[6]!==void 0&&(a.value=n[6]),e=new pt({props:a}),ye.push(()=>Ee(e,"value",o)),{c(){q(e.$$.fragment)},m(s,r){z(e,s,r),t=!0},p(s,r){const i={};!l&&r&64&&(l=!0,i.value=s[6],Oe(()=>l=!1)),e.$set(i)},i(s){t||(O(e.$$.fragment,s),t=!0)},o(s){D(e.$$.fragment,s),t=!1},d(s){B(e,s)}}}function En(n){let e;return{c(){e=te("Save")},m(l,t){L(l,e,t)},d(l){l&&R(e)}}}function On(n){let e,l;return e=new Ol({props:{type:"is-success",class:"is-right",iconPack:"fa",iconLeft:"check",$$slots:{default:[En]},$$scope:{ctx:n}}}),e.$on("click",n[8]),e.$on("submit",n[8]),{c(){q(e.$$.fragment)},m(t,o){z(e,t,o),l=!0},p(t,o){const a={};o&268435456&&(a.$$scope={dirty:o,ctx:t}),e.$set(a)},i(t){l||(O(e.$$.fragment,t),l=!0)},o(t){D(e.$$.fragment,t),l=!1},d(t){B(e,t)}}}function Dn(n){let e,l,t,o,a,s;return e=new ze({props:{$$slots:{default:[Ln]},$$scope:{ctx:n}}}),t=new ze({props:{grouped:!0,$$slots:{default:[Nn]},$$scope:{ctx:n}}}),a=new ze({props:{grouped:!0,$$slots:{default:[On]},$$scope:{ctx:n}}}),{c(){q(e.$$.fragment),l=S(),q(t.$$.fragment),o=S(),q(a.$$.fragment)},m(r,i){z(e,r,i),L(r,l,i),z(t,r,i),L(r,o,i),z(a,r,i),s=!0},p(r,i){const _={};i&268435488&&(_.$$scope={dirty:i,ctx:r}),e.$set(_);const h={};i&268435520&&(h.$$scope={dirty:i,ctx:r}),t.$set(h);const p={};i&268435456&&(p.$$scope={dirty:i,ctx:r}),a.$set(p)},i(r){s||(O(e.$$.fragment,r),O(t.$$.fragment,r),O(a.$$.fragment,r),s=!0)},o(r){D(e.$$.fragment,r),D(t.$$.fragment,r),D(a.$$.fragment,r),s=!1},d(r){B(e,r),r&&R(l),B(t,r),r&&R(o),B(a,r)}}}function Un(n){let e,l,t;function o(s){n[15](s)}let a={type:"search",placeholder:"Fetch JSON",icon:"search"};return n[3]!==void 0&&(a.value=n[3]),e=new pt({props:a}),ye.push(()=>Ee(e,"value",o)),{c(){q(e.$$.fragment)},m(s,r){z(e,s,r),t=!0},p(s,r){const i={};!l&&r&8&&(l=!0,i.value=s[3],Oe(()=>l=!1)),e.$set(i)},i(s){t||(O(e.$$.fragment,s),t=!0)},o(s){D(e.$$.fragment,s),t=!1},d(s){B(e,s)}}}function An(n){let e;return{c(){e=te("WikiPage")},m(l,t){L(l,e,t)},d(l){l&&R(e)}}}function Mn(n){let e,l,t,o,a,s;function r(p){n[16](p)}let i={type:"search",placeholder:"Post JSON",icon:"search"};n[4]!==void 0&&(i.value=n[4]),e=new pt({props:i}),ye.push(()=>Ee(e,"value",r));function _(p){n[17](p)}let h={$$slots:{default:[An]},$$scope:{ctx:n}};return n[2]!==void 0&&(h.checked=n[2]),o=new Ql({props:h}),ye.push(()=>Ee(o,"checked",_)),{c(){q(e.$$.fragment),t=S(),q(o.$$.fragment)},m(p,f){z(e,p,f),L(p,t,f),z(o,p,f),s=!0},p(p,f){const g={};!l&&f&16&&(l=!0,g.value=p[4],Oe(()=>l=!1)),e.$set(g);const m={};f&268435456&&(m.$$scope={dirty:f,ctx:p}),!a&&f&4&&(a=!0,m.checked=p[2],Oe(()=>a=!1)),o.$set(m)},i(p){s||(O(e.$$.fragment,p),O(o.$$.fragment,p),s=!0)},o(p){D(e.$$.fragment,p),D(o.$$.fragment,p),s=!1},d(p){B(e,p),p&&R(t),B(o,p)}}}function Pn(n){let e;return{c(){e=te("Fetch")},m(l,t){L(l,e,t)},d(l){l&&R(e)}}}function jn(n){let e,l;return e=new Ol({props:{type:"is-primary",$$slots:{default:[Pn]},$$scope:{ctx:n}}}),e.$on("click",n[9]),e.$on("submit",n[9]),{c(){q(e.$$.fragment)},m(t,o){z(e,t,o),l=!0},p(t,o){const a={};o&268435456&&(a.$$scope={dirty:o,ctx:t}),e.$set(a)},i(t){l||(O(e.$$.fragment,t),l=!0)},o(t){D(e.$$.fragment,t),l=!1},d(t){B(e,t)}}}function In(n){let e,l,t,o,a,s;return e=new ze({props:{grouped:!0,$$slots:{default:[Un]},$$scope:{ctx:n}}}),t=new ze({props:{grouped:!0,$$slots:{default:[Mn]},$$scope:{ctx:n}}}),a=new ze({props:{grouped:!0,$$slots:{default:[jn]},$$scope:{ctx:n}}}),{c(){q(e.$$.fragment),l=S(),q(t.$$.fragment),o=S(),q(a.$$.fragment)},m(r,i){z(e,r,i),L(r,l,i),z(t,r,i),L(r,o,i),z(a,r,i),s=!0},p(r,i){const _={};i&268435464&&(_.$$scope={dirty:i,ctx:r}),e.$set(_);const h={};i&268435476&&(h.$$scope={dirty:i,ctx:r}),t.$set(h);const p={};i&268435456&&(p.$$scope={dirty:i,ctx:r}),a.$set(p)},i(r){s||(O(e.$$.fragment,r),O(t.$$.fragment,r),O(a.$$.fragment,r),s=!0)},o(r){D(e.$$.fragment,r),D(t.$$.fragment,r),D(a.$$.fragment,r),s=!1},d(r){B(e,r),r&&R(l),B(t,r),r&&R(o),B(a,r)}}}function Wn(n){let e,l,t,o,a;return o=new Ml({props:{content:n[1],onChange:n[7]}}),{c(){e=d("p"),e.innerHTML=`<i>The best editing experience is to configure Atomic Server, in the
        meantime use editor below. You will need to refresh page via Command R
        or Ctrl-R to see changes</i>`,l=S(),t=d("div"),q(o.$$.fragment),c(t,"class","editor")},m(s,r){L(s,e,r),L(s,l,r),L(s,t,r),z(o,t,null),a=!0},p(s,r){const i={};r&2&&(i.content=s[1]),o.$set(i)},i(s){a||(O(o.$$.fragment,s),a=!0)},o(s){D(o.$$.fragment,s),a=!1},d(s){s&&R(e),s&&R(l),s&&R(t),B(o)}}}function xt(n){let e,l;return e=new Rn({props:{subject:n[25]}}),{c(){q(e.$$.fragment)},m(t,o){z(e,t,o),l=!0},p(t,o){const a={};o&1&&(a.subject=t[25]),e.$set(a)},i(t){l||(O(e.$$.fragment,t),l=!0)},o(t){D(e.$$.fragment,t),l=!1},d(t){B(e,t)}}}function Hn(n){let e,l,t=n[0]??[],o=[];for(let s=0;s<t.length;s+=1)o[s]=xt(Xt(n,t,s));const a=s=>D(o[s],1,1,()=>{o[s]=null});return{c(){for(let s=0;s<o.length;s+=1)o[s].c();e=xe()},m(s,r){for(let i=0;i<o.length;i+=1)o[i]&&o[i].m(s,r);L(s,e,r),l=!0},p(s,r){if(r&1){t=s[0]??[];let i;for(i=0;i<t.length;i+=1){const _=Xt(s,t,i);o[i]?(o[i].p(_,r),O(o[i],1)):(o[i]=xt(_),o[i].c(),O(o[i],1),o[i].m(e.parentNode,e))}for(Te(),i=t.length;i<o.length;i+=1)a(i);Le()}},i(s){if(!l){for(let r=0;r<t.length;r+=1)O(o[r]);l=!0}},o(s){o=o.filter(Boolean);for(let r=0;r<o.length;r+=1)D(o[r]);l=!1},d(s){Be(o,s),s&&R(e)}}}function Fn(n){let e,l;return e=new Zl({props:{$$slots:{default:[Hn]},$$scope:{ctx:n}}}),{c(){q(e.$$.fragment)},m(t,o){z(e,t,o),l=!0},p(t,o){const a={};o&268435457&&(a.$$scope={dirty:o,ctx:t}),e.$set(a)},i(t){l||(O(e.$$.fragment,t),l=!0)},o(t){D(e.$$.fragment,t),l=!1},d(t){B(e,t)}}}function Kn(n){let e,l,t,o,a,s,r,i,_,h,p,f,g;return l=new Ke({props:{path:"/atomic",$$slots:{default:[Dn]},$$scope:{ctx:n}}}),o=new Ke({props:{path:"/json",$$slots:{default:[In]},$$scope:{ctx:n}}}),s=new Ke({props:{path:"/editor",$$slots:{default:[Wn]},$$scope:{ctx:n}}}),h=new ze({props:{grouped:!0,position:"is-right",$$slots:{default:[Fn]},$$scope:{ctx:n}}}),{c(){e=d("div"),q(l.$$.fragment),t=S(),q(o.$$.fragment),a=S(),q(s.$$.fragment),r=S(),i=d("hr"),_=S(),q(h.$$.fragment),p=S(),f=d("nav"),f.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
    <a class="navbar-item" href="/fetch/json">Fetch JSON Data</a> 
    <a class="navbar-item" href="/fetch/atomic">Set Atomic Server</a> 
    <a class="navbar-item" href="/fetch/editor">Edit JSON config</a></div>`,c(e,"class","box"),c(f,"class","navbar")},m(m,b){L(m,e,b),z(l,e,null),u(e,t),z(o,e,null),u(e,a),z(s,e,null),L(m,r,b),L(m,i,b),L(m,_,b),z(h,m,b),L(m,p,b),L(m,f,b),g=!0},p(m,[b]){const k={};b&268435552&&(k.$$scope={dirty:b,ctx:m}),l.$set(k);const v={};b&268435484&&(v.$$scope={dirty:b,ctx:m}),o.$set(v);const y={};b&268435458&&(y.$$scope={dirty:b,ctx:m}),s.$set(y);const P={};b&268435457&&(P.$$scope={dirty:b,ctx:m}),h.$set(P)},i(m){g||(O(l.$$.fragment,m),O(o.$$.fragment,m),O(s.$$.fragment,m),O(h.$$.fragment,m),g=!0)},o(m){D(l.$$.fragment,m),D(o.$$.fragment,m),D(s.$$.fragment,m),D(h.$$.fragment,m),g=!1},d(m){m&&R(e),B(l),B(o),B(s),m&&R(r),m&&R(i),m&&R(_),B(h,m),m&&R(p),m&&R(f)}}}function Gn(n,e,l){let t,o,a,s,r;ue(n,an,N=>l(19,a=N)),ue(n,Ce,N=>l(20,s=N)),ue(n,je,N=>l(21,r=N));let i={json:r};function _(N){if(console.log("contents changed:",N),console.log("is tauri",s),je.update(w=>(w=N.json,w)),Ce)console.log("Updating config on server"),be("update_config",{configNew:N.json}).then(w=>{console.log(`Message: ${w}`)}).catch(w=>console.error(w));else{let w=`${Qe.ServerURL}/config/`;fetch(w,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(N.json)})}l(1,i=N)}let h=!1,p="https://raw.githubusercontent.com/terraphim/terraphim-cloud-fastapi/main/data/ref_arch.json",f="http://localhost:8000/documents/",g="http://localhost:9883/",m;const b=async()=>{console.log("Updating atomic server configuration");const N=cn.fromSecret(m);a.setServerUrl(g),console.log("Server set.Setting agent"),a.setAgent(N)},k=async()=>{P()},v=({data:{msg:N,data:w}})=>{console.log(N,w)};let y;const P=async()=>{const N=await sn(()=>import("./fetcher.worker-7e58969a.js"),[]);y=new N.default,y.onmessage=v;const w={msg:"fetcher",data:{url:p,postUrl:f,isWiki:h}};y.postMessage(w)},G=Pl("http://localhost:9883/config/y3zx5wtm0bq"),C=Lt(G,jl.properties.name);ue(n,C,N=>l(12,o=N));const E=Lt(G,"http://localhost:9883/property/role");ue(n,E,N=>l(0,t=N));function T(N){g=N,l(5,g)}function F(N){m=N,l(6,m)}function K(N){p=N,l(3,p)}function J(N){f=N,l(4,f)}function I(N){h=N,l(2,h)}return n.$$.update=()=>{n.$$.dirty&4096&&console.log("Print name",o),n.$$.dirty&1&&console.log("Print roles",t)},[t,i,h,p,f,g,m,_,b,k,C,E,o,T,F,K,J,I]}class qn extends De{constructor(e){super(),Ue(this,e,Gn,Kn,Re,{})}}function zn(n){let e,l;return e=new pn({props:{defaultValue:n[0],isEditable:!n[1],disableLocalStorage:!0,onUpdate:n[2],extensions:[rn]}}),{c(){q(e.$$.fragment)},m(t,o){z(e,t,o),l=!0},p(t,[o]){const a={};o&1&&(a.defaultValue=t[0]),o&2&&(a.isEditable=!t[1]),e.$set(a)},i(t){l||(O(e.$$.fragment,t),l=!0)},o(t){D(e.$$.fragment,t),l=!1},d(t){B(e,t)}}}function Bn(n,e,l){let{html:t=""}=e,{readOnly:o=!1}=e,{outputFormat:a="html"}=e;const s=r=>{a==="markdown"?l(0,t=r.storage.markdown.getMarkdown()):l(0,t=r.getHTML())};return n.$$set=r=>{"html"in r&&l(0,t=r.html),"readOnly"in r&&l(1,o=r.readOnly),"outputFormat"in r&&l(3,a=r.outputFormat)},[t,o,s,a]}class Jn extends De{constructor(e){super(),Ue(this,e,Bn,zn,Re,{html:0,readOnly:1,outputFormat:3})}}function el(n){let e,l,t,o,a,s,r,i,_,h,p;return{c(){e=d("div"),l=d("h3"),t=d("span"),t.textContent="Knowledge Graph",o=te(`
          Term: `),a=d("strong"),s=te(n[2]),r=te(" | Rank: "),i=d("strong"),_=te(n[3]),h=S(),p=d("hr"),c(t,"class","tag is-info"),c(l,"class","subtitle is-6"),c(e,"class","kg-context")},m(f,g){L(f,e,g),u(e,l),u(l,t),u(l,o),u(l,a),u(a,s),u(l,r),u(l,i),u(i,_),u(e,h),u(e,p)},p(f,g){g&4&&ke(s,f[2]),g&8&&ke(_,f[3])},d(f){f&&R(e)}}}function Vn(n){let e,l,t,o,a,s,r,i;const _=[Qn,Zn],h=[];function p(f,g){return f[5]?0:1}return l=p(n),t=h[l]=_[l](n),{c(){e=d("div"),t.c(),o=S(),a=d("div"),a.innerHTML='<span class="hint-text svelte-1n7y4av">Double-click to edit • Ctrl+E to edit • Ctrl+S to save</span>',c(a,"class","edit-hint svelte-1n7y4av"),c(e,"class","content-viewer svelte-1n7y4av"),c(e,"tabindex","0"),c(e,"role","button"),c(e,"aria-label","Double-click to edit article content")},m(f,g){L(f,e,g),h[l].m(e,null),u(e,o),u(e,a),n[14](e),s=!0,r||(i=[V(e,"dblclick",n[9]),V(e,"keydown",n[10])],r=!0)},p(f,g){let m=l;l=p(f),l===m?h[l].p(f,g):(Te(),D(h[m],1,1,()=>{h[m]=null}),Le(),t=h[l],t?t.p(f,g):(t=h[l]=_[l](f),t.c()),O(t,1),t.m(e,o))},i(f){s||(O(t),s=!0)},o(f){D(t),s=!1},d(f){f&&R(e),h[l].d(),n[14](null),r=!1,Ie(i)}}}function Yn(n){let e,l,t,o,a,s,r,i,_,h;function p(g){n[12](g)}let f={outputFormat:n[7]};return n[1].body!==void 0&&(f.html=n[1].body),e=new Jn({props:f}),ye.push(()=>Ee(e,"html",p)),{c(){q(e.$$.fragment),t=S(),o=d("div"),a=d("button"),a.textContent="Save",s=S(),r=d("button"),r.textContent="Cancel",c(a,"class","button is-primary"),c(r,"class","button is-light"),c(o,"class","edit-controls svelte-1n7y4av")},m(g,m){z(e,g,m),L(g,t,m),L(g,o,m),u(o,a),u(o,s),u(o,r),i=!0,_||(h=[V(a,"click",n[8]),V(r,"click",n[13])],_=!0)},p(g,m){const b={};m&128&&(b.outputFormat=g[7]),!l&&m&2&&(l=!0,b.html=g[1].body,Oe(()=>l=!1)),e.$set(b)},i(g){i||(O(e.$$.fragment,g),i=!0)},o(g){D(e.$$.fragment,g),i=!1},d(g){B(e,g),g&&R(t),g&&R(o),_=!1,Ie(h)}}}function Zn(n){let e,l;return e=new Al({props:{source:n[1].body}}),{c(){q(e.$$.fragment)},m(t,o){z(e,t,o),l=!0},p(t,o){const a={};o&2&&(a.source=t[1].body),e.$set(a)},i(t){l||(O(e.$$.fragment,t),l=!0)},o(t){D(e.$$.fragment,t),l=!1},d(t){B(e,t)}}}function Qn(n){let e,l=n[1].body+"";return{c(){e=d("div"),c(e,"class","prose")},m(t,o){L(t,e,o),e.innerHTML=l},p(t,o){o&2&&l!==(l=t[1].body+"")&&(e.innerHTML=l)},i:fe,o:fe,d(t){t&&R(e)}}}function Xn(n){let e,l,t,o=n[1].title+"",a,s,r,i,_,h=n[2]&&n[3]!==null&&el(n);const p=[Yn,Vn],f=[];function g(m,b){return m[4]?0:1}return r=g(n),i=f[r]=p[r](n),{c(){e=d("div"),h&&h.c(),l=S(),t=d("h2"),a=te(o),s=S(),i.c(),c(t,"class","svelte-1n7y4av"),c(e,"class","box wrapper svelte-1n7y4av")},m(m,b){L(m,e,b),h&&h.m(e,null),u(e,l),u(e,t),u(t,a),u(e,s),f[r].m(e,null),_=!0},p(m,b){m[2]&&m[3]!==null?h?h.p(m,b):(h=el(m),h.c(),h.m(e,l)):h&&(h.d(1),h=null),(!_||b&2)&&o!==(o=m[1].title+"")&&ke(a,o);let k=r;r=g(m),r===k?f[r].p(m,b):(Te(),D(f[k],1,1,()=>{f[k]=null}),Le(),i=f[r],i?i.p(m,b):(i=f[r]=p[r](m),i.c()),O(i,1),i.m(e,null))},i(m){_||(O(i),_=!0)},o(m){D(i),_=!1},d(m){m&&R(e),h&&h.d(),f[r].d()}}}function xn(n){let e,l,t;function o(s){n[15](s)}let a={$$slots:{default:[Xn]},$$scope:{ctx:n}};return n[0]!==void 0&&(a.active=n[0]),e=new Xl({props:a}),ye.push(()=>Ee(e,"active",o)),{c(){q(e.$$.fragment)},m(s,r){z(e,s,r),t=!0},p(s,[r]){const i={};r&262398&&(i.$$scope={dirty:r,ctx:s}),!l&&r&1&&(l=!0,i.active=s[0],Oe(()=>l=!1)),e.$set(i)},i(s){t||(O(e.$$.fragment,s),t=!0)},o(s){D(e.$$.fragment,s),t=!1},d(s){B(e,s)}}}function eo(n,e,l){let t,o,a;ue(n,Ce,C=>l(16,a=C));let{active:s=!1}=e,{item:r}=e,{initialEdit:i=!1}=e,{kgTerm:_=null}=e,{kgRank:h=null}=e,p=!1,f;async function g(){if(a)try{const C=await be("get_document",{document_id:r.id});C!=null&&C.document&&l(1,r=C.document)}catch(C){console.error("Failed to load document",C)}}async function m(){if(!a){l(4,p=!1);return}try{await be("create_document",{document:r}),l(4,p=!1)}catch(C){console.error("Failed to save document",C)}}function b(){l(4,p=!0)}function k(C){C.type!=="dblclick"&&((C.ctrlKey||C.metaKey)&&C.key==="e"&&(C.preventDefault(),l(4,p=!0)),p&&(C.ctrlKey||C.metaKey)&&C.key==="s"&&(C.preventDefault(),m()),p&&C.key==="Escape"&&(C.preventDefault(),l(4,p=!1)))}function v(C){n.$$.not_equal(r.body,C)&&(r.body=C,l(1,r))}const y=()=>l(4,p=!1);function P(C){ye[C?"unshift":"push"](()=>{f=C,l(6,f)})}function G(C){s=C,l(0,s)}return n.$$set=C=>{"active"in C&&l(0,s=C.active),"item"in C&&l(1,r=C.item),"initialEdit"in C&&l(11,i=C.initialEdit),"kgTerm"in C&&l(2,_=C.kgTerm),"kgRank"in C&&l(3,h=C.kgRank)},n.$$.update=()=>{n.$$.dirty&2049&&s&&i&&l(4,p=!0),n.$$.dirty&19&&s&&r&&!p&&g(),n.$$.dirty&2&&l(5,t=/<\w+/.test((r==null?void 0:r.body)??"")),n.$$.dirty&32&&l(7,o=t?"html":"markdown")},[s,r,_,h,p,t,f,o,m,b,k,i,v,y,P,G]}class Pt extends De{constructor(e){super(),Ue(this,e,eo,xn,Re,{active:0,item:1,initialEdit:11,kgTerm:2,kgRank:3})}}async function Il(n){return be("tauri",n)}async function to(n,e){return Il({__tauriModule:"Event",message:{cmd:"unlisten",event:n,eventId:e}})}async function lo(n,e,l){return Il({__tauriModule:"Event",message:{cmd:"listen",event:n,windowLabel:e,handler:Ut(l)}}).then(t=>async()=>to(n,t))}var tl;(function(n){n.WINDOW_RESIZED="tauri://resize",n.WINDOW_MOVED="tauri://move",n.WINDOW_CLOSE_REQUESTED="tauri://close-requested",n.WINDOW_CREATED="tauri://window-created",n.WINDOW_DESTROYED="tauri://destroyed",n.WINDOW_FOCUS="tauri://focus",n.WINDOW_BLUR="tauri://blur",n.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",n.WINDOW_THEME_CHANGED="tauri://theme-changed",n.WINDOW_FILE_DROP="tauri://file-drop",n.WINDOW_FILE_DROP_HOVER="tauri://file-drop-hover",n.WINDOW_FILE_DROP_CANCELLED="tauri://file-drop-cancelled",n.MENU="tauri://menu",n.CHECK_UPDATE="tauri://update",n.UPDATE_AVAILABLE="tauri://update-available",n.INSTALL_UPDATE="tauri://update-install",n.STATUS_UPDATE="tauri://update-status",n.DOWNLOAD_PROGRESS="tauri://update-download-progress"})(tl||(tl={}));async function no(n,e){return lo(n,null,e)}function ll(n,e,l){const t=n.slice();return t[9]=e[l],t}function nl(n){let e,l=n[9].name+"",t,o;return{c(){e=d("option"),t=te(l),e.__value=o=n[9].name,e.value=e.__value},m(a,s){L(a,e,s),u(e,t)},p(a,s){s&1&&l!==(l=a[9].name+"")&&ke(t,l),s&1&&o!==(o=a[9].name)&&(e.__value=o,e.value=e.__value)},d(a){a&&R(e)}}}function oo(n){let e,l,t,o,a,s,r=n[0],i=[];for(let _=0;_<r.length;_+=1)i[_]=nl(ll(n,r,_));return{c(){e=d("div"),l=d("div"),t=d("div"),o=d("select");for(let _=0;_<i.length;_+=1)i[_].c();c(t,"class","select"),c(l,"class","control"),c(e,"class","field is-grouped is-grouped-right")},m(_,h){L(_,e,h),u(e,l),u(l,t),u(t,o);for(let p=0;p<i.length;p+=1)i[p]&&i[p].m(o,null);Pe(o,n[1]),a||(s=V(o,"change",n[2]),a=!0)},p(_,[h]){if(h&1){r=_[0];let p;for(p=0;p<r.length;p+=1){const f=ll(_,r,p);i[p]?i[p].p(f,h):(i[p]=nl(f),i[p].c(),i[p].m(o,null))}for(;p<i.length;p+=1)i[p].d(1);i.length=r.length}h&3&&Pe(o,_[1])},i:fe,o:fe,d(_){_&&R(e),Be(i,_),a=!1,s()}}}function so(n,e,l){let t,o,a,s;ue(n,je,f=>l(5,t=f)),ue(n,Ce,f=>l(6,o=f)),ue(n,Qt,f=>l(0,a=f)),ue(n,at,f=>l(1,s=f));let r="";async function i(){try{Ce.set(window.__TAURI__!==void 0),o?(console.log("Loading config from Tauri"),be("get_config").then(f=>{console.log("get_config response",f),f&&f.status==="success"&&_(f.config)}).catch(f=>console.error("Error fetching config in Tauri:",f))):(console.log("Loading config from server"),r=`${Qe.ServerURL}/config/`,fetch(r).then(f=>f.json()).then(f=>{console.log("Config received",f),f&&f.status==="success"&&_(f.config)}).catch(f=>console.error("Error fetching config:",f)))}catch(f){console.error("Unhandled error in loadConfig:",f)}}function _(f){var k;console.log("Updating stores from config:",f);const g={default_role:f.selected_role,...f};je.set(g);const m=Object.entries(f.roles).map(([v,y])=>({name:v,...y}));Qt.set(m),at.set(f.selected_role);const b=f.roles[f.selected_role];if(console.log("Selected role settings:",b),b){const v=b.theme||"spacelab";console.log("Setting theme to:",v),ft.set(v),(k=b.kg)!=null&&k.publish?o&&be("publish_thesaurus",{roleName:f.selected_role}).then(y=>{console.log("publish_thesaurus response",y),Dt.set(y),ut.set(!0)}):ut.set(!1)}else console.warn("No role settings found for:",f.selected_role),ft.set("spacelab")}typeof window<"u"&&window.__TAURI__&&no("role_changed",f=>{console.log("Role changed event received from backend:",f.payload),_(f.payload)});async function h(){await i()}h(),console.log("Using Terraphim Server URL:",Qe.ServerURL);function p(f){var v;const m=f.target.value;console.log("Role change requested:",m),at.set(m);const b=a.find(y=>y.name===m);if(!b){console.error(`No role settings found for role: ${m}.`);return}const k=b.theme||"spacelab";ft.set(k),console.log(`Theme changed to ${k}`),je.update(y=>(y.selected_role=m,y)),o?(be("select_role",{roleName:m}).catch(y=>console.error("Error selecting role:",y)),(v=b.kg)!=null&&v.publish?(console.log("Publishing thesaurus for role",m),be("publish_thesaurus",{roleName:m}).then(y=>{Dt.set(y),ut.set(!0)})):ut.set(!1)):fetch(`${Qe.ServerURL}/config/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).catch(y=>console.error("Error updating config on server:",y))}return[a,s,p,i]}class Rt extends De{constructor(e){super(),Ue(this,e,so,oo,Re,{loadConfig:3})}get loadConfig(){return this.$$.ctx[3]}}function ol(n,e,l){const t=n.slice();return t[14]=e[l],t}function sl(n){let e,l;return e=new Dl({props:{$$slots:{default:[ao]},$$scope:{ctx:n}}}),{c(){q(e.$$.fragment)},m(t,o){z(e,t,o),l=!0},p(t,o){const a={};o&131137&&(a.$$scope={dirty:o,ctx:t}),e.$set(a)},i(t){l||(O(e.$$.fragment,t),l=!0)},o(t){D(e.$$.fragment,t),l=!1},d(t){B(e,t)}}}function ro(n){let e=n[14]+"",l;return{c(){l=te(e)},m(t,o){L(t,l,o)},p(t,o){o&1&&e!==(e=t[14]+"")&&ke(l,e)},d(t){t&&R(l)}}}function rl(n){let e,l,t,o,a,s;l=new Ul({props:{rounded:!0,$$slots:{default:[ro]},$$scope:{ctx:n}}});function r(){return n[9](n[14])}return{c(){e=d("button"),q(l.$$.fragment),t=S(),c(e,"class","tag-button svelte-1m2cvhr"),e.disabled=n[6],c(e,"title","Click to view knowledge graph document")},m(i,_){L(i,e,_),z(l,e,null),u(e,t),o=!0,a||(s=V(e,"click",r),a=!0)},p(i,_){n=i;const h={};_&131073&&(h.$$scope={dirty:_,ctx:n}),l.$set(h),(!o||_&64)&&(e.disabled=n[6])},i(i){o||(O(l.$$.fragment,i),o=!0)},o(i){D(l.$$.fragment,i),o=!1},d(i){i&&R(e),B(l),a=!1,s()}}}function ao(n){let e,l,t=n[0].tags,o=[];for(let s=0;s<t.length;s+=1)o[s]=rl(ol(n,t,s));const a=s=>D(o[s],1,1,()=>{o[s]=null});return{c(){for(let s=0;s<o.length;s+=1)o[s].c();e=xe()},m(s,r){for(let i=0;i<o.length;i+=1)o[i]&&o[i].m(s,r);L(s,e,r),l=!0},p(s,r){if(r&321){t=s[0].tags;let i;for(i=0;i<t.length;i+=1){const _=ol(s,t,i);o[i]?(o[i].p(_,r),O(o[i],1)):(o[i]=rl(_),o[i].c(),O(o[i],1),o[i].m(e.parentNode,e))}for(Te(),i=t.length;i<o.length;i+=1)a(i);Le()}},i(s){if(!l){for(let r=0;r<t.length;r+=1)O(o[r]);l=!0}},o(s){o=o.filter(Boolean);for(let r=0;r<o.length;r+=1)D(o[r]);l=!1},d(s){Be(o,s),s&&R(e)}}}function io(n){let e,l=n[0].rank+"",t;return{c(){e=te("Rank "),t=te(l)},m(o,a){L(o,e,a),L(o,t,a)},p(o,a){a&1&&l!==(l=o[0].rank+"")&&ke(t,l)},d(o){o&&R(e),o&&R(t)}}}function co(n){let e,l;return e=new Ul({props:{rounded:!0,$$slots:{default:[io]},$$scope:{ctx:n}}}),{c(){q(e.$$.fragment)},m(t,o){z(e,t,o),l=!0},p(t,o){const a={};o&131073&&(a.$$scope={dirty:o,ctx:t}),e.$set(a)},i(t){l||(O(e.$$.fragment,t),l=!0)},o(t){D(e.$$.fragment,t),l=!1},d(t){B(e,t)}}}function uo(n){let e;return{c(){e=d("small"),e.textContent="No description available",c(e,"class","no-description svelte-1m2cvhr")},m(l,t){L(l,e,t)},p:fe,i:fe,o:fe,d(l){l&&R(e)}}}function fo(n){let e,l;return e=new Al({props:{source:n[0].description}}),{c(){q(e.$$.fragment)},m(t,o){z(e,t,o),l=!0},p(t,o){const a={};o&1&&(a.source=t[0].description),e.$set(a)},i(t){l||(O(e.$$.fragment,t),l=!0)},o(t){D(e.$$.fragment,t),l=!1},d(t){B(e,t)}}}function al(n){let e,l,t;return{c(){e=d("a"),l=d("span"),l.innerHTML='<i class="fas fa-link"></i>',c(l,"class","icon is-medium"),c(e,"href",t=n[0].url),c(e,"target","_blank"),c(e,"class","level-item"),c(e,"aria-label","URL")},m(o,a){L(o,e,a),u(e,l)},p(o,a){a&1&&t!==(t=o[0].url)&&c(e,"href",t)},d(o){o&&R(e)}}}function il(n){let e,l,t;function o(s){n[11](s)}let a={item:n[3],kgTerm:n[4],kgRank:n[5]};return n[2]!==void 0&&(a.active=n[2]),e=new Pt({props:a}),ye.push(()=>Ee(e,"active",o)),{c(){q(e.$$.fragment)},m(s,r){z(e,s,r),t=!0},p(s,r){const i={};r&8&&(i.item=s[3]),r&16&&(i.kgTerm=s[4]),r&32&&(i.kgRank=s[5]),!l&&r&4&&(l=!0,i.active=s[2],Oe(()=>l=!1)),e.$set(i)},i(s){t||(O(e.$$.fragment,s),t=!0)},o(s){D(e.$$.fragment,s),t=!1},d(s){B(e,s)}}}function po(n){let e,l,t,o,a,s,r,i,_,h,p,f,g=n[0].title+"",m,b,k,v,y,P,G,C,E,T,F,K,J,I,N,w,W,ne,Q,H,le,Z,ie,de,me,j,X,x,ae,Ge,$=n[0].tags&&sl(n);i=new Dl({props:{$$slots:{default:[co]},$$scope:{ctx:n}}});const A=[fo,uo],U=[];function se(M,oe){return M[0].description?0:1}G=se(n),C=U[G]=A[G](n);let Y="url"in n[0]&&al(n);function ee(M){n[10](M)}let Ae={item:n[0]};n[1]!==void 0&&(Ae.active=n[1]),de=new Pt({props:Ae}),ye.push(()=>Ee(de,"active",ee));let ce=n[3]&&il(n);return{c(){e=d("div"),l=d("article"),t=d("div"),o=d("div"),a=d("div"),$&&$.c(),s=S(),r=d("div"),q(i.$$.fragment),_=S(),h=d("div"),p=d("button"),f=d("h2"),m=te(g),b=S(),k=d("div"),v=d("small"),v.textContent="Description:",y=S(),P=d("div"),C.c(),E=S(),T=d("br"),K=S(),J=d("div"),I=d("nav"),N=d("div"),Y&&Y.c(),w=S(),W=d("button"),W.innerHTML='<span class="icon is-medium"><i class="fas fa-plus" aria-hidden="true"></i></span>',ne=S(),Q=d("a"),H=d("span"),H.innerHTML='<i class="fas fa-code" aria-hidden="true"></i>',ie=S(),q(de.$$.fragment),j=S(),ce&&ce.c(),X=xe(),c(a,"class","level-right"),c(r,"class","level-right"),c(f,"class","title svelte-1m2cvhr"),c(p,"class","svelte-1m2cvhr"),c(v,"class","description-label svelte-1m2cvhr"),c(P,"class","description-content svelte-1m2cvhr"),c(k,"class","description svelte-1m2cvhr"),c(o,"class","content"),c(W,"type","button"),c(W,"class","level-item button is-ghost svelte-1m2cvhr"),c(W,"aria-label","Add to favorites"),c(H,"class","icon is-medium"),c(Q,"href",le=`vscode://${encodeURIComponent(n[0].title)}.md?${encodeURIComponent(n[0].body)}`),c(Q,"class","level-item"),c(Q,"aria-label","Open in VSCode"),c(N,"class","level-right"),c(I,"class","level is-mobile"),c(J,"class","level-right"),c(t,"class","media-content"),c(l,"class","media"),c(e,"class","box")},m(M,oe){L(M,e,oe),u(e,l),u(l,t),u(t,o),u(o,a),$&&$.m(a,null),u(o,s),u(o,r),z(i,r,null),u(o,_),u(o,h),u(h,p),u(p,f),u(f,m),u(h,b),u(h,k),u(k,v),u(k,y),u(k,P),U[G].m(P,null),u(h,E),u(h,T),u(t,K),u(t,J),u(J,I),u(I,N),Y&&Y.m(N,null),u(N,w),u(N,W),u(N,ne),u(N,Q),u(Q,H),L(M,ie,oe),z(de,M,oe),L(M,j,oe),ce&&ce.m(M,oe),L(M,X,oe),x=!0,ae||(Ge=[V(p,"click",n[7]),V(W,"click",_o)],ae=!0)},p(M,[oe]){M[0].tags?$?($.p(M,oe),oe&1&&O($,1)):($=sl(M),$.c(),O($,1),$.m(a,null)):$&&(Te(),D($,1,1,()=>{$=null}),Le());const he={};oe&131073&&(he.$$scope={dirty:oe,ctx:M}),i.$set(he),(!x||oe&1)&&g!==(g=M[0].title+"")&&ke(m,g);let $e=G;G=se(M),G===$e?U[G].p(M,oe):(Te(),D(U[$e],1,1,()=>{U[$e]=null}),Le(),C=U[G],C?C.p(M,oe):(C=U[G]=A[G](M),C.c()),O(C,1),C.m(P,null)),"url"in M[0]?Y?Y.p(M,oe):(Y=al(M),Y.c(),Y.m(N,w)):Y&&(Y.d(1),Y=null),(!x||oe&1&&le!==(le=`vscode://${encodeURIComponent(M[0].title)}.md?${encodeURIComponent(M[0].body)}`))&&c(Q,"href",le);const we={};oe&1&&(we.item=M[0]),!me&&oe&2&&(me=!0,we.active=M[1],Oe(()=>me=!1)),de.$set(we),M[3]?ce?(ce.p(M,oe),oe&8&&O(ce,1)):(ce=il(M),ce.c(),O(ce,1),ce.m(X.parentNode,X)):ce&&(Te(),D(ce,1,1,()=>{ce=null}),Le())},i(M){x||(O($),O(i.$$.fragment,M),O(C),Xe(()=>{x&&(F||(F=yt(h,St,{},!0)),F.run(1))}),Xe(()=>{x&&(Z||(Z=yt(I,St,{},!0)),Z.run(1))}),O(de.$$.fragment,M),O(ce),x=!0)},o(M){D($),D(i.$$.fragment,M),D(C),F||(F=yt(h,St,{},!1)),F.run(0),Z||(Z=yt(I,St,{},!1)),Z.run(0),D(de.$$.fragment,M),D(ce),x=!1},d(M){M&&R(e),$&&$.d(),B(i),U[G].d(),M&&F&&F.end(),Y&&Y.d(),M&&Z&&Z.end(),M&&R(ie),B(de,M),M&&R(j),ce&&ce.d(M),M&&R(X),ae=!1,Ie(Ge)}}}const _o=()=>{};function mo(n,e,l){let t,o;ue(n,at,v=>l(12,t=v)),ue(n,Ce,v=>l(13,o=v));let{document:a}=e,s=!1,r=!1,i=null,_=null,h=null,p=!1;const f=()=>{l(1,s=!0)};async function g(v){var y,P,G,C,E;l(6,p=!0),l(4,_=v),console.log("🔍 KG Search Debug Info:"),console.log("  Tag clicked:",v),console.log("  Current role:",t),console.log("  Is Tauri mode:",o);try{if(o){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:t,term:v});const T=await be("find_documents_for_kg_term",{roleName:t,term:v});console.log("  📥 Tauri response received:"),console.log("    Status:",T.status),console.log("    Results count:",((y=T.results)==null?void 0:y.length)||0),console.log("    Total:",T.total||0),console.log("    Full response:",JSON.stringify(T,null,2)),T.status==="success"&&T.results&&T.results.length>0?(l(3,i=T.results[0]),l(5,h=i.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",i.title),console.log("    Rank:",h),console.log("    Body length:",((P=i.body)==null?void 0:P.length)||0,"characters"),l(2,r=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${v}" in role: "${t}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const T=Qe.ServerURL,F=encodeURIComponent(t),K=encodeURIComponent(v),J=`${T}/roles/${F}/kg_search?term=${K}`;console.log("  📤 HTTP Request details:"),console.log("    Base URL:",T),console.log("    Role (encoded):",F),console.log("    Term (encoded):",K),console.log("    Full URL:",J);const I=await fetch(J);if(console.log("  📥 HTTP Response received:"),console.log("    Status code:",I.status),console.log("    Status text:",I.statusText),console.log("    Headers:",Object.fromEntries(I.headers.entries())),!I.ok)throw new Error(`HTTP error! Status: ${I.status} - ${I.statusText}`);const N=await I.json();console.log("  📄 Response data:"),console.log("    Status:",N.status),console.log("    Results count:",((G=N.results)==null?void 0:G.length)||0),console.log("    Total:",N.total||0),console.log("    Full response:",JSON.stringify(N,null,2)),N.status==="success"&&N.results&&N.results.length>0?(l(3,i=N.results[0]),l(5,h=i.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",i.title),console.log("    Rank:",h),console.log("    Body length:",((C=i.body)==null?void 0:C.length)||0,"characters"),l(2,r=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${v}" in role: "${t}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",J))}}catch(T){console.error("❌ Error fetching KG document:"),console.error("  Error type:",T.constructor.name),console.error("  Error message:",T.message||T),console.error("  Request details:",{tag:v,role:t,isTauri:o,timestamp:new Date().toISOString()}),!o&&((E=T.message)!=null&&E.includes("Failed to fetch"))&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{l(6,p=!1)}}Rt[t]!==void 0&&(console.log("Have attribute",Rt[t]),Rt[t].hasOwnProperty("enableLogseq")?console.log("enable logseq True"):console.log("Didn't make it"));const m=v=>g(v);function b(v){s=v,l(1,s)}function k(v){r=v,l(2,r)}return n.$$set=v=>{"document"in v&&l(0,a=v.document)},[a,s,r,i,_,h,p,f,g,m,b,k]}class ho extends De{constructor(e){super(),Ue(this,e,mo,po,Re,{document:0})}}const go="/assets/terraphim_gray.png";function cl(n,e,l){const t=n.slice();return t[19]=e[l],t}function ul(n,e,l){const t=n.slice();return t[22]=e[l],t[24]=l,t}function fl(n){let e,l=n[2],t=[];for(let o=0;o<l.length;o+=1)t[o]=pl(ul(n,l,o));return{c(){e=d("ul");for(let o=0;o<t.length;o+=1)t[o].c();c(e,"class","suggestions svelte-13t09eu")},m(o,a){L(o,e,a);for(let s=0;s<t.length;s+=1)t[s]&&t[s].m(e,null)},p(o,a){if(a&524){l=o[2];let s;for(s=0;s<l.length;s+=1){const r=ul(o,l,s);t[s]?t[s].p(r,a):(t[s]=pl(r),t[s].c(),t[s].m(e,null))}for(;s<t.length;s+=1)t[s].d(1);t.length=l.length}},d(o){o&&R(e),Be(t,o)}}}function pl(n){let e,l=n[22]+"",t,o,a,s,r,i;function _(){return n[13](n[22])}function h(...p){return n[14](n[22],...p)}return{c(){e=d("li"),t=te(l),o=S(),c(e,"tabindex","0"),c(e,"role","option"),c(e,"aria-selected",a=n[24]===n[3]),c(e,"aria-label",s=`Apply suggestion: ${n[22]}`),c(e,"class","svelte-13t09eu"),Tt(e,"active",n[24]===n[3])},m(p,f){L(p,e,f),u(e,t),u(e,o),r||(i=[V(e,"click",_),V(e,"keydown",h)],r=!0)},p(p,f){n=p,f&4&&l!==(l=n[22]+"")&&ke(t,l),f&8&&a!==(a=n[24]===n[3])&&c(e,"aria-selected",a),f&4&&s!==(s=`Apply suggestion: ${n[22]}`)&&c(e,"aria-label",s),f&8&&Tt(e,"active",n[24]===n[3])},d(p){p&&R(e),r=!1,Ie(i)}}}function vo(n){let e,l,t,o,a;function s(_){n[12](_)}let r={type:"search",placeholder:n[6]?`Search over Knowledge graph for ${n[4]}`:"Search",icon:"search",expanded:!0,autofocus:!0};n[5]!==void 0&&(r.value=n[5]),l=new pt({props:r}),ye.push(()=>Ee(l,"value",s)),l.$on("click",n[10]),l.$on("submit",n[10]),l.$on("keydown",n[8]),l.$on("input",n[7]);let i=n[2].length>0&&fl(n);return{c(){e=d("div"),q(l.$$.fragment),o=S(),i&&i.c(),c(e,"class","input-wrapper svelte-13t09eu")},m(_,h){L(_,e,h),z(l,e,null),u(e,o),i&&i.m(e,null),a=!0},p(_,h){const p={};h&80&&(p.placeholder=_[6]?`Search over Knowledge graph for ${_[4]}`:"Search"),!t&&h&32&&(t=!0,p.value=_[5],Oe(()=>t=!1)),l.$set(p),_[2].length>0?i?i.p(_,h):(i=fl(_),i.c(),i.m(e,null)):i&&(i.d(1),i=null)},i(_){a||(O(l.$$.fragment,_),a=!0)},o(_){D(l.$$.fragment,_),a=!1},d(_){_&&R(e),B(l),i&&i.d()}}}function bo(n){let e,l,t,o,a,s;return{c(){e=d("section"),l=d("div"),t=d("img"),a=S(),s=d("p"),s.textContent="I am Terraphim, your personal assistant.",tn(t.src,o=go)||c(t,"src",o),c(t,"alt","Terraphim Logo"),c(t,"class","svelte-13t09eu"),c(l,"class","content has-text-grey has-text-centered svelte-13t09eu"),c(e,"class","section")},m(r,i){L(r,e,i),u(e,l),u(l,t),u(l,a),u(l,s)},p:fe,i:fe,o:fe,d(r){r&&R(e)}}}function ko(n){let e,l,t=n[0],o=[];for(let s=0;s<t.length;s+=1)o[s]=dl(cl(n,t,s));const a=s=>D(o[s],1,1,()=>{o[s]=null});return{c(){for(let s=0;s<o.length;s+=1)o[s].c();e=xe()},m(s,r){for(let i=0;i<o.length;i+=1)o[i]&&o[i].m(s,r);L(s,e,r),l=!0},p(s,r){if(r&1){t=s[0];let i;for(i=0;i<t.length;i+=1){const _=cl(s,t,i);o[i]?(o[i].p(_,r),O(o[i],1)):(o[i]=dl(_),o[i].c(),O(o[i],1),o[i].m(e.parentNode,e))}for(Te(),i=t.length;i<o.length;i+=1)a(i);Le()}},i(s){if(!l){for(let r=0;r<t.length;r+=1)O(o[r]);l=!0}},o(s){o=o.filter(Boolean);for(let r=0;r<o.length;r+=1)D(o[r]);l=!1},d(s){Be(o,s),s&&R(e)}}}function $o(n){let e,l;return{c(){e=d("p"),l=te(n[1]),c(e,"class","error svelte-13t09eu")},m(t,o){L(t,e,o),u(e,l)},p(t,o){o&2&&ke(l,t[1])},i:fe,o:fe,d(t){t&&R(e)}}}function dl(n){let e,l;return e=new ho({props:{document:n[19]}}),{c(){q(e.$$.fragment)},m(t,o){z(e,t,o),l=!0},p(t,o){const a={};o&1&&(a.document=t[19]),e.$set(a)},i(t){l||(O(e.$$.fragment,t),l=!0)},o(t){D(e.$$.fragment,t),l=!1},d(t){B(e,t)}}}function wo(n){let e,l,t,o,a,s,r,i,_;l=new ze({props:{$$slots:{default:[vo]},$$scope:{ctx:n}}});const h=[$o,ko,bo],p=[];function f(g,m){return g[1]?0:g[0].length?1:2}return o=f(n),a=p[o]=h[o](n),{c(){e=d("form"),q(l.$$.fragment),t=S(),a.c(),s=xe()},m(g,m){L(g,e,m),z(l,e,null),L(g,t,m),p[o].m(g,m),L(g,s,m),r=!0,i||(_=V(e,"submit",xl(n[10])),i=!0)},p(g,[m]){const b={};m&33554556&&(b.$$scope={dirty:m,ctx:g}),l.$set(b);let k=o;o=f(g),o===k?p[o].p(g,m):(Te(),D(p[k],1,1,()=>{p[k]=null}),Le(),a=p[o],a?a.p(g,m):(a=p[o]=h[o](g),a.c()),O(a,1),a.m(s.parentNode,s))},i(g){r||(O(l.$$.fragment,g),O(a),r=!0)},o(g){D(l.$$.fragment,g),D(a),r=!1},d(g){g&&R(e),B(l),g&&R(t),p[o].d(g),g&&R(s),i=!1,_()}}}function yo(n,e,l){let t,o,a,s,r,i,_;ue(n,wn,E=>l(16,o=E)),ue(n,at,E=>l(4,a=E)),ue(n,Ot,E=>l(5,s=E)),ue(n,Ce,E=>l(17,r=E)),ue(n,Dt,E=>l(11,i=E)),ue(n,ut,E=>l(6,_=E));let h=[],p=null,f=[],g=-1;function m(E){const T=E.trim().toLowerCase();return T.length===0?[]:t.filter(([K])=>K.toLowerCase().includes(T)).map(([K])=>K).slice(0,5)}function b(E){const T=E.target;if(!T||T.selectionStart==null)return;const F=T.selectionStart,J=s.slice(0,F).split(/\s+/),I=J[J.length-1];l(2,f=m(I)),l(3,g=-1)}function k(E){f.length!==0&&(E.key==="ArrowDown"?(E.preventDefault(),l(3,g=(g+1)%f.length)):E.key==="ArrowUp"?(E.preventDefault(),l(3,g=(g-1+f.length)%f.length)):(E.key==="Enter"||E.key==="Tab")&&g!==-1&&(E.preventDefault(),v(f[g])))}function v(E){var N;const T=document.querySelector('input[type="search"]'),F=(T==null?void 0:T.selectionStart)??0,K=s.slice(0,F),J=s.slice(F),I=K.split(/\s+/);I[I.length-1]=E,en(Ot,s=[...I,J].join(" "),s),(N=T==null?void 0:T.setSelectionRange)==null||N.call(T,F+E.length,F+E.length),l(2,f=[]),l(3,g=-1)}async function y(){if(l(1,p=null),r)try{const E=await be("search",{searchQuery:{search_term:s,skip:0,limit:10,role:a}});E.status==="success"?(l(0,h=E.results),console.log("Response results"),console.log(h)):(l(1,p=`Search failed: ${E.status}`),console.error("Search failed:",E))}catch(E){l(1,p=`Error in Tauri search: ${E}`),console.error("Error in Tauri search:",E)}else{if(!s.trim())return;const E=JSON.stringify({search_term:s,skip:0,limit:10,role:a});try{const T=await fetch(o,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:E}),F=await T.json();if(!T.ok)throw new Error(`HTTP error! Status: ${T.status}`);l(0,h=F.results)}catch(T){console.error("Error fetching data:",T),l(1,p=`Error fetching data: ${T}`)}}}function P(E){s=E,Ot.set(s)}const G=E=>v(E),C=(E,T)=>{(T.key==="Enter"||T.key===" ")&&(T.preventDefault(),v(E))};return n.$$.update=()=>{n.$$.dirty&2048&&(t=Object.entries(i))},[h,p,f,g,a,s,_,b,k,v,y,i,P,G,C]}class So extends De{constructor(e){super(),Ue(this,e,yo,wo,Re,{})}}function _l(n,e,l){const t=n.slice();return t[44]=e[l],t[45]=e,t[46]=l,t}function ml(n,e,l){const t=n.slice();return t[47]=e[l],t[48]=e,t[49]=l,t}function hl(n,e,l){const t=n.slice();return t[50]=e[l][0],t[51]=e[l][1],t[52]=e,t[53]=l,t}function gl(n,e,l){const t=n.slice();return t[41]=e[l],t}function Co(n){let e,l,t,o=JSON.stringify(n[1],null,2)+"",a;return{c(){e=d("h4"),e.textContent="Review",l=S(),t=d("pre"),a=te(o),c(e,"class","title is-5"),Ze(t,"max-height","300px"),Ze(t,"overflow","auto")},m(s,r){L(s,e,r),L(s,l,r),L(s,t,r),u(t,a)},p(s,r){r[0]&2&&o!==(o=JSON.stringify(s[1],null,2)+"")&&ke(a,o)},d(s){s&&R(e),s&&R(l),s&&R(t)}}}function Ro(n){let e,l,t=[],o=new Map,a,s,r,i,_=n[1].roles;const h=p=>p[44].name;for(let p=0;p<_.length;p+=1){let f=_l(n,_,p),g=h(f);o.set(g,t[p]=wl(g,f))}return{c(){e=d("h4"),e.textContent="Roles",l=S();for(let p=0;p<t.length;p+=1)t[p].c();a=S(),s=d("button"),s.textContent="Add Role",c(e,"class","title is-5"),c(s,"class","button is-link is-light")},m(p,f){L(p,e,f),L(p,l,f);for(let g=0;g<t.length;g+=1)t[g]&&t[g].m(p,f);L(p,a,f),L(p,s,f),r||(i=V(s,"click",n[5]),r=!0)},p(p,f){f[0]&4034&&(_=p[1].roles,t=ln(t,f,h,1,p,_,o,a.parentNode,nn,wl,a,_l))},d(p){p&&R(e),p&&R(l);for(let f=0;f<t.length;f+=1)t[f].d(p);p&&R(a),p&&R(s),r=!1,i()}}}function To(n){let e,l,t,o,a,s,r,i,_,h,p,f,g,m,b,k,v,y,P,G,C,E,T,F,K,J,I,N,w,W,ne=n[1].roles,Q=[];for(let H=0;H<ne.length;H+=1)Q[H]=yl(gl(n,ne,H));return{c(){e=d("div"),l=d("label"),l.textContent="Configuration ID",t=S(),o=d("div"),a=d("div"),s=d("select"),r=d("option"),r.textContent="Desktop",i=d("option"),i.textContent="Server",_=d("option"),_.textContent="Embedded",h=S(),p=d("div"),f=d("label"),f.textContent="Global shortcut",g=S(),m=d("div"),b=d("input"),k=S(),v=d("div"),y=d("label"),y.textContent="Default theme",P=S(),G=d("div"),C=d("input"),E=S(),T=d("div"),F=d("label"),F.textContent="Default Role",K=S(),J=d("div"),I=d("div"),N=d("select");for(let H=0;H<Q.length;H+=1)Q[H].c();c(l,"class","label"),c(l,"for","config-id"),r.__value="Desktop",r.value=r.__value,i.__value="Server",i.value=i.__value,_.__value="Embedded",_.value=_.__value,c(s,"id","config-id"),n[1].id===void 0&&Xe(()=>n[13].call(s)),c(a,"class","select"),c(o,"class","control"),c(e,"class","field"),c(f,"class","label"),c(f,"for","global-shortcut"),c(b,"class","input"),c(b,"id","global-shortcut"),c(b,"type","text"),c(m,"class","control"),c(p,"class","field"),c(y,"class","label"),c(y,"for","default-theme"),c(C,"class","input"),c(C,"id","default-theme"),c(C,"type","text"),c(G,"class","control"),c(v,"class","field"),c(F,"class","label"),c(F,"for","default-role"),c(N,"id","default-role"),n[1].default_role===void 0&&Xe(()=>n[16].call(N)),c(I,"class","select"),c(J,"class","control"),c(T,"class","field")},m(H,le){L(H,e,le),u(e,l),u(e,t),u(e,o),u(o,a),u(a,s),u(s,r),u(s,i),u(s,_),Pe(s,n[1].id,!0),L(H,h,le),L(H,p,le),u(p,f),u(p,g),u(p,m),u(m,b),pe(b,n[1].global_shortcut),L(H,k,le),L(H,v,le),u(v,y),u(v,P),u(v,G),u(G,C),pe(C,n[1].default_theme),L(H,E,le),L(H,T,le),u(T,F),u(T,K),u(T,J),u(J,I),u(I,N);for(let Z=0;Z<Q.length;Z+=1)Q[Z]&&Q[Z].m(N,null);Pe(N,n[1].default_role,!0),w||(W=[V(s,"change",n[13]),V(b,"input",n[14]),V(C,"input",n[15]),V(N,"change",n[16])],w=!0)},p(H,le){if(le[0]&2&&Pe(s,H[1].id),le[0]&2&&b.value!==H[1].global_shortcut&&pe(b,H[1].global_shortcut),le[0]&2&&C.value!==H[1].default_theme&&pe(C,H[1].default_theme),le[0]&2){ne=H[1].roles;let Z;for(Z=0;Z<ne.length;Z+=1){const ie=gl(H,ne,Z);Q[Z]?Q[Z].p(ie,le):(Q[Z]=yl(ie),Q[Z].c(),Q[Z].m(N,null))}for(;Z<Q.length;Z+=1)Q[Z].d(1);Q.length=ne.length}le[0]&2&&Pe(N,H[1].default_role)},d(H){H&&R(e),H&&R(h),H&&R(p),H&&R(k),H&&R(v),H&&R(E),H&&R(T),Be(Q,H),w=!1,Ie(W)}}}function Lo(n){let e;return{c(){e=te("Directory Path")},m(l,t){L(l,e,t)},d(l){l&&R(e)}}}function No(n){let e;return{c(){e=te("Server URL")},m(l,t){L(l,e,t)},d(l){l&&R(e)}}}function vl(n){let e,l,t,o,a,s,r,i,_,h,p,f;function g(){n[23].call(r,n[46],n[49])}return{c(){e=d("div"),l=d("label"),t=te("Atomic Server Secret"),a=S(),s=d("div"),r=d("input"),_=S(),h=d("p"),h.textContent="Leave empty for anonymous access",c(l,"class","label"),c(l,"for",o=`haystack-secret-${n[46]}-${n[49]}`),c(r,"class","input"),c(r,"id",i=`haystack-secret-${n[46]}-${n[49]}`),c(r,"type","password"),c(r,"placeholder","Base64 encoded secret (optional)"),c(s,"class","control"),c(h,"class","help"),c(e,"class","field")},m(m,b){L(m,e,b),u(e,l),u(l,t),u(e,a),u(e,s),u(s,r),pe(r,n[1].roles[n[46]].haystacks[n[49]].atomic_server_secret),u(e,_),u(e,h),p||(f=V(r,"input",g),p=!0)},p(m,b){n=m,b[0]&2&&o!==(o=`haystack-secret-${n[46]}-${n[49]}`)&&c(l,"for",o),b[0]&2&&i!==(i=`haystack-secret-${n[46]}-${n[49]}`)&&c(r,"id",i),b[0]&2&&r.value!==n[1].roles[n[46]].haystacks[n[49]].atomic_server_secret&&pe(r,n[1].roles[n[46]].haystacks[n[49]].atomic_server_secret)},d(m){m&&R(e),p=!1,f()}}}function bl(n){let e,l,t,o,a,s,r,i,_,h,p,f,g,m,b,k,v,y=Object.entries(n[1].roles[n[46]].haystacks[n[49]].extra_parameters||{}),P=[];for(let T=0;T<y.length;T+=1)P[T]=kl(hl(n,y,T));function G(){return n[27](n[46],n[49])}function C(){return n[28](n[46],n[49])}function E(){return n[29](n[46],n[49])}return{c(){e=d("div"),l=d("label"),l.textContent="Extra Parameters (for filtering)",t=S();for(let T=0;T<P.length;T+=1)P[T].c();o=S(),a=d("div"),s=d("div"),r=d("button"),r.textContent="+ Tag Filter",i=S(),_=d("div"),h=d("button"),h.textContent="+ Max Results",p=S(),f=d("div"),g=d("button"),g.textContent="+ Custom Parameter",m=S(),b=d("p"),b.innerHTML=`Common parameters: <code>tag</code> (e.g., &quot;#rust&quot;), <code>glob</code> (e.g., &quot;*.md&quot;), 
                  <code>max_count</code> (e.g., &quot;10&quot;), <code>context</code> (e.g., &quot;5&quot;)`,c(l,"class","label"),c(r,"class","button is-small is-link is-light"),c(s,"class","control"),c(h,"class","button is-small is-link is-light"),c(_,"class","control"),c(g,"class","button is-small is-link is-light"),c(f,"class","control"),c(a,"class","field is-grouped"),c(b,"class","help"),c(e,"class","field")},m(T,F){L(T,e,F),u(e,l),u(e,t);for(let K=0;K<P.length;K+=1)P[K]&&P[K].m(e,null);u(e,o),u(e,a),u(a,s),u(s,r),u(a,i),u(a,_),u(_,h),u(a,p),u(a,f),u(f,g),u(e,m),u(e,b),k||(v=[V(r,"click",G),V(h,"click",C),V(g,"click",E)],k=!0)},p(T,F){if(n=T,F[0]&3074){y=Object.entries(n[1].roles[n[46]].haystacks[n[49]].extra_parameters||{});let K;for(K=0;K<y.length;K+=1){const J=hl(n,y,K);P[K]?P[K].p(J,F):(P[K]=kl(J),P[K].c(),P[K].m(e,o))}for(;K<P.length;K+=1)P[K].d(1);P.length=y.length}},d(T){T&&R(e),Be(P,T),k=!1,Ie(v)}}}function kl(n){let e,l,t,o,a,s,r,i,_,h,p,f,g;function m(...v){return n[24](n[46],n[49],n[50],...v)}function b(){n[25].call(r,n[46],n[49],n[50])}function k(){return n[26](n[46],n[49],n[50])}return{c(){e=d("div"),l=d("div"),t=d("input"),a=S(),s=d("div"),r=d("input"),i=S(),_=d("div"),h=d("button"),h.textContent="×",p=S(),c(t,"class","input"),c(t,"type","text"),c(t,"placeholder","Parameter name"),t.value=o=n[50],c(l,"class","control"),c(r,"class","input"),c(r,"type","text"),c(r,"placeholder","Parameter value"),c(s,"class","control is-expanded"),c(h,"class","button is-small is-danger"),c(_,"class","control"),c(e,"class","field is-grouped")},m(v,y){L(v,e,y),u(e,l),u(l,t),u(e,a),u(e,s),u(s,r),pe(r,n[1].roles[n[46]].haystacks[n[49]].extra_parameters[n[50]]),u(e,i),u(e,_),u(_,h),u(e,p),f||(g=[V(t,"blur",m),V(r,"input",b),V(h,"click",k)],f=!0)},p(v,y){n=v,y[0]&2&&o!==(o=n[50])&&t.value!==o&&(t.value=o),y[0]&2&&r.value!==n[1].roles[n[46]].haystacks[n[49]].extra_parameters[n[50]]&&pe(r,n[1].roles[n[46]].haystacks[n[49]].extra_parameters[n[50]])},d(v){v&&R(e),f=!1,Ie(g)}}}function $l(n){let e,l,t,o,a,s,r,i,_,h,p,f,g,m,b,k,v,y,P,G,C,E,T,F,K,J,I,N,w,W,ne,Q,H,le,Z;function ie(){n[21].call(_,n[46],n[49])}function de(A,U){return A[1].roles[A[46]].haystacks[A[49]].service==="Atomic"?No:Lo}let me=de(n),j=me(n);function X(){n[22].call(P,n[46],n[49])}let x=n[1].roles[n[46]].haystacks[n[49]].service==="Atomic"&&vl(n),ae=n[1].roles[n[46]].haystacks[n[49]].service==="Ripgrep"&&bl(n);function Ge(){n[30].call(I,n[46],n[49])}function $(){return n[31](n[46],n[49])}return{c(){e=d("div"),l=d("div"),t=d("label"),o=te("Service Type"),s=S(),r=d("div"),i=d("div"),_=d("select"),h=d("option"),h.textContent="Ripgrep (File Search)",p=d("option"),p.textContent="Atomic Server",g=S(),m=d("div"),b=d("label"),j.c(),v=S(),y=d("div"),P=d("input"),E=S(),x&&x.c(),T=S(),ae&&ae.c(),F=S(),K=d("div"),J=d("label"),I=d("input"),w=te(`
                 Read-only`),ne=S(),Q=d("div"),H=d("button"),H.textContent="Remove Haystack",c(t,"class","label"),c(t,"for",a=`haystack-service-${n[46]}-${n[49]}`),h.__value="Ripgrep",h.value=h.__value,p.__value="Atomic",p.value=p.__value,c(_,"id",f=`haystack-service-${n[46]}-${n[49]}`),n[1].roles[n[46]].haystacks[n[49]].service===void 0&&Xe(ie),c(i,"class","select"),c(r,"class","control"),c(l,"class","field"),c(b,"class","label"),c(b,"for",k=`haystack-path-${n[46]}-${n[49]}`),c(P,"class","input"),c(P,"id",G=`haystack-path-${n[46]}-${n[49]}`),c(P,"type","text"),c(P,"placeholder",C=n[1].roles[n[46]].haystacks[n[49]].service==="Atomic"?"https://localhost:9883":"/path/to/documents"),c(y,"class","control"),c(m,"class","field"),c(I,"id",N=`haystack-readonly-${n[46]}-${n[49]}`),c(I,"type","checkbox"),c(J,"class","checkbox"),c(J,"for",W=`haystack-readonly-${n[46]}-${n[49]}`),c(K,"class","field"),c(H,"class","button is-small is-danger"),c(Q,"class","field"),c(e,"class","box is-light")},m(A,U){L(A,e,U),u(e,l),u(l,t),u(t,o),u(l,s),u(l,r),u(r,i),u(i,_),u(_,h),u(_,p),Pe(_,n[1].roles[n[46]].haystacks[n[49]].service,!0),u(e,g),u(e,m),u(m,b),j.m(b,null),u(m,v),u(m,y),u(y,P),pe(P,n[1].roles[n[46]].haystacks[n[49]].path),u(e,E),x&&x.m(e,null),u(e,T),ae&&ae.m(e,null),u(e,F),u(e,K),u(K,J),u(J,I),I.checked=n[1].roles[n[46]].haystacks[n[49]].read_only,u(J,w),u(e,ne),u(e,Q),u(Q,H),le||(Z=[V(_,"change",ie),V(P,"input",X),V(I,"change",Ge),V(H,"click",$)],le=!0)},p(A,U){n=A,U[0]&2&&a!==(a=`haystack-service-${n[46]}-${n[49]}`)&&c(t,"for",a),U[0]&2&&f!==(f=`haystack-service-${n[46]}-${n[49]}`)&&c(_,"id",f),U[0]&2&&Pe(_,n[1].roles[n[46]].haystacks[n[49]].service),me!==(me=de(n))&&(j.d(1),j=me(n),j&&(j.c(),j.m(b,null))),U[0]&2&&k!==(k=`haystack-path-${n[46]}-${n[49]}`)&&c(b,"for",k),U[0]&2&&G!==(G=`haystack-path-${n[46]}-${n[49]}`)&&c(P,"id",G),U[0]&2&&C!==(C=n[1].roles[n[46]].haystacks[n[49]].service==="Atomic"?"https://localhost:9883":"/path/to/documents")&&c(P,"placeholder",C),U[0]&2&&P.value!==n[1].roles[n[46]].haystacks[n[49]].path&&pe(P,n[1].roles[n[46]].haystacks[n[49]].path),n[1].roles[n[46]].haystacks[n[49]].service==="Atomic"?x?x.p(n,U):(x=vl(n),x.c(),x.m(e,T)):x&&(x.d(1),x=null),n[1].roles[n[46]].haystacks[n[49]].service==="Ripgrep"?ae?ae.p(n,U):(ae=bl(n),ae.c(),ae.m(e,F)):ae&&(ae.d(1),ae=null),U[0]&2&&N!==(N=`haystack-readonly-${n[46]}-${n[49]}`)&&c(I,"id",N),U[0]&2&&(I.checked=n[1].roles[n[46]].haystacks[n[49]].read_only),U[0]&2&&W!==(W=`haystack-readonly-${n[46]}-${n[49]}`)&&c(J,"for",W)},d(A){A&&R(e),j.d(),x&&x.d(),ae&&ae.d(),le=!1,Ie(Z)}}}function wl(n,e){let l,t,o,a,s,r,i,_,h,p,f,g,m,b,k,v,y,P,G,C,E,T,F,K,J,I,N,w,W,ne,Q,H,le,Z,ie,de,me,j,X,x,ae,Ge,$,A,U,se,Y,ee,Ae,ce,M,oe,he,$e,we,it,Je,We,dt,Se,_t,jt,mt,et,tt,It,ht,Wt,gt,Me,lt,nt,vt,Ht,ot,qe,He,bt,Ft,kt,Kt,Ve,Fe,$t,Gt,wt,qt,zt,Bt,ct,Nt,Jt;function Hl(){e[17].call(_,e[46])}function Fl(){e[18].call(y,e[46])}function Kl(){e[19].call(I,e[46])}function Gl(){e[20].call(ie,e[46])}let st=e[44].haystacks,ge=[];for(let ve=0;ve<st.length;ve+=1)ge[ve]=$l(ml(e,st,ve));function ql(){return e[32](e[46])}function zl(){e[33].call(M,e[46])}function Bl(){e[34].call(Se,e[46])}function Vt(){e[35].call(Me,e[46])}function Jl(){e[36].call(He,e[46])}function Vl(){e[37].call(Fe,e[46])}function Yl(){return e[38](e[46])}return{key:n,first:null,c(){l=d("div"),t=d("div"),o=d("label"),a=te("Role name"),r=S(),i=d("div"),_=d("input"),p=S(),f=d("div"),g=d("label"),m=te("Short name"),k=S(),v=d("div"),y=d("input"),G=S(),C=d("div"),E=d("label"),T=te("Theme"),K=S(),J=d("div"),I=d("input"),w=S(),W=d("div"),ne=d("label"),Q=te("Relevance function"),le=S(),Z=d("div"),ie=d("input"),me=S(),j=d("h5"),j.textContent="Haystacks",X=S();for(let ve=0;ve<ge.length;ve+=1)ge[ve].c();x=S(),ae=d("button"),ae.textContent="Add Haystack",Ge=S(),$=d("h5"),$.textContent="Knowledge Graph",A=S(),U=d("div"),se=d("label"),Y=te("Remote automata URL"),Ae=S(),ce=d("div"),M=d("input"),he=S(),$e=d("div"),we=d("label"),it=te("Local KG path"),We=S(),dt=d("div"),Se=d("input"),jt=S(),mt=d("div"),et=d("div"),tt=d("label"),It=te("Local KG type"),Wt=S(),gt=d("div"),Me=d("select"),lt=d("option"),lt.textContent="markdown",nt=d("option"),nt.textContent="json",Ht=S(),ot=d("div"),qe=d("label"),He=d("input"),Ft=te(`
             Public`),Kt=S(),Ve=d("label"),Fe=d("input"),Gt=te(`
             Publish`),qt=S(),zt=d("hr"),Bt=S(),ct=d("button"),ct.textContent="Remove Role",c(o,"class","label"),c(o,"for",s=`role-name-${e[46]}`),c(_,"class","input"),c(_,"id",h=`role-name-${e[46]}`),c(_,"type","text"),c(i,"class","control"),c(t,"class","field"),c(g,"class","label"),c(g,"for",b=`role-shortname-${e[46]}`),c(y,"class","input"),c(y,"id",P=`role-shortname-${e[46]}`),c(y,"type","text"),c(v,"class","control"),c(f,"class","field"),c(E,"class","label"),c(E,"for",F=`role-theme-${e[46]}`),c(I,"class","input"),c(I,"id",N=`role-theme-${e[46]}`),c(I,"type","text"),c(J,"class","control"),c(C,"class","field"),c(ne,"class","label"),c(ne,"for",H=`role-relevance-${e[46]}`),c(ie,"class","input"),c(ie,"id",de=`role-relevance-${e[46]}`),c(ie,"type","text"),c(Z,"class","control"),c(W,"class","field"),c(j,"class","title is-6"),c(ae,"class","button is-small"),c($,"class","title is-6"),c(se,"class","label"),c(se,"for",ee=`kg-url-${e[46]}`),c(M,"class","input"),c(M,"id",oe=`kg-url-${e[46]}`),c(M,"type","text"),c(M,"placeholder","https://example.com/thesaurus.json"),c(ce,"class","control"),c(U,"class","field"),c(we,"class","label"),c(we,"for",Je=`kg-local-path-${e[46]}`),c(Se,"class","input"),c(Se,"id",_t=`kg-local-path-${e[46]}`),c(Se,"type","text"),c(Se,"placeholder","/path/to/markdown"),c(dt,"class","control"),c($e,"class","field"),c(tt,"class","label"),c(tt,"for",ht=`kg-local-type-${e[46]}`),lt.__value="markdown",lt.value=lt.__value,nt.__value="json",nt.value=nt.__value,c(Me,"id",vt=`kg-local-type-${e[46]}`),e[1].roles[e[46]].kg.local_type===void 0&&Xe(Vt),c(gt,"class","select"),c(et,"class","control"),c(mt,"class","field is-grouped"),c(He,"id",bt=`kg-public-${e[46]}`),c(He,"type","checkbox"),c(qe,"class","checkbox"),c(qe,"for",kt=`kg-public-${e[46]}`),Ze(qe,"margin-right","1rem"),c(Fe,"id",$t=`kg-publish-${e[46]}`),c(Fe,"type","checkbox"),c(Ve,"class","checkbox"),c(Ve,"for",wt=`kg-publish-${e[46]}`),c(ot,"class","field is-grouped"),c(ct,"class","button is-small is-danger"),c(l,"class","box"),this.first=l},m(ve,re){L(ve,l,re),u(l,t),u(t,o),u(o,a),u(t,r),u(t,i),u(i,_),pe(_,e[1].roles[e[46]].name),u(l,p),u(l,f),u(f,g),u(g,m),u(f,k),u(f,v),u(v,y),pe(y,e[1].roles[e[46]].shortname),u(l,G),u(l,C),u(C,E),u(E,T),u(C,K),u(C,J),u(J,I),pe(I,e[1].roles[e[46]].theme),u(l,w),u(l,W),u(W,ne),u(ne,Q),u(W,le),u(W,Z),u(Z,ie),pe(ie,e[1].roles[e[46]].relevance_function),u(l,me),u(l,j),u(l,X);for(let _e=0;_e<ge.length;_e+=1)ge[_e]&&ge[_e].m(l,null);u(l,x),u(l,ae),u(l,Ge),u(l,$),u(l,A),u(l,U),u(U,se),u(se,Y),u(U,Ae),u(U,ce),u(ce,M),pe(M,e[1].roles[e[46]].kg.url),u(l,he),u(l,$e),u($e,we),u(we,it),u($e,We),u($e,dt),u(dt,Se),pe(Se,e[1].roles[e[46]].kg.local_path),u(l,jt),u(l,mt),u(mt,et),u(et,tt),u(tt,It),u(et,Wt),u(et,gt),u(gt,Me),u(Me,lt),u(Me,nt),Pe(Me,e[1].roles[e[46]].kg.local_type,!0),u(l,Ht),u(l,ot),u(ot,qe),u(qe,He),He.checked=e[1].roles[e[46]].kg.public,u(qe,Ft),u(ot,Kt),u(ot,Ve),u(Ve,Fe),Fe.checked=e[1].roles[e[46]].kg.publish,u(Ve,Gt),u(l,qt),u(l,zt),u(l,Bt),u(l,ct),Nt||(Jt=[V(_,"input",Hl),V(y,"input",Fl),V(I,"input",Kl),V(ie,"input",Gl),V(ae,"click",ql),V(M,"input",zl),V(Se,"input",Bl),V(Me,"change",Vt),V(He,"change",Jl),V(Fe,"change",Vl),V(ct,"click",Yl)],Nt=!0)},p(ve,re){if(e=ve,re[0]&2&&s!==(s=`role-name-${e[46]}`)&&c(o,"for",s),re[0]&2&&h!==(h=`role-name-${e[46]}`)&&c(_,"id",h),re[0]&2&&_.value!==e[1].roles[e[46]].name&&pe(_,e[1].roles[e[46]].name),re[0]&2&&b!==(b=`role-shortname-${e[46]}`)&&c(g,"for",b),re[0]&2&&P!==(P=`role-shortname-${e[46]}`)&&c(y,"id",P),re[0]&2&&y.value!==e[1].roles[e[46]].shortname&&pe(y,e[1].roles[e[46]].shortname),re[0]&2&&F!==(F=`role-theme-${e[46]}`)&&c(E,"for",F),re[0]&2&&N!==(N=`role-theme-${e[46]}`)&&c(I,"id",N),re[0]&2&&I.value!==e[1].roles[e[46]].theme&&pe(I,e[1].roles[e[46]].theme),re[0]&2&&H!==(H=`role-relevance-${e[46]}`)&&c(ne,"for",H),re[0]&2&&de!==(de=`role-relevance-${e[46]}`)&&c(ie,"id",de),re[0]&2&&ie.value!==e[1].roles[e[46]].relevance_function&&pe(ie,e[1].roles[e[46]].relevance_function),re[0]&3842){st=e[44].haystacks;let _e;for(_e=0;_e<st.length;_e+=1){const Yt=ml(e,st,_e);ge[_e]?ge[_e].p(Yt,re):(ge[_e]=$l(Yt),ge[_e].c(),ge[_e].m(l,x))}for(;_e<ge.length;_e+=1)ge[_e].d(1);ge.length=st.length}re[0]&2&&ee!==(ee=`kg-url-${e[46]}`)&&c(se,"for",ee),re[0]&2&&oe!==(oe=`kg-url-${e[46]}`)&&c(M,"id",oe),re[0]&2&&M.value!==e[1].roles[e[46]].kg.url&&pe(M,e[1].roles[e[46]].kg.url),re[0]&2&&Je!==(Je=`kg-local-path-${e[46]}`)&&c(we,"for",Je),re[0]&2&&_t!==(_t=`kg-local-path-${e[46]}`)&&c(Se,"id",_t),re[0]&2&&Se.value!==e[1].roles[e[46]].kg.local_path&&pe(Se,e[1].roles[e[46]].kg.local_path),re[0]&2&&ht!==(ht=`kg-local-type-${e[46]}`)&&c(tt,"for",ht),re[0]&2&&vt!==(vt=`kg-local-type-${e[46]}`)&&c(Me,"id",vt),re[0]&2&&Pe(Me,e[1].roles[e[46]].kg.local_type),re[0]&2&&bt!==(bt=`kg-public-${e[46]}`)&&c(He,"id",bt),re[0]&2&&(He.checked=e[1].roles[e[46]].kg.public),re[0]&2&&kt!==(kt=`kg-public-${e[46]}`)&&c(qe,"for",kt),re[0]&2&&$t!==($t=`kg-publish-${e[46]}`)&&c(Fe,"id",$t),re[0]&2&&(Fe.checked=e[1].roles[e[46]].kg.publish),re[0]&2&&wt!==(wt=`kg-publish-${e[46]}`)&&c(Ve,"for",wt)},d(ve){ve&&R(l),Be(ge,ve),Nt=!1,Ie(Jt)}}}function yl(n){let e,l=n[41].name+"",t,o;return{c(){e=d("option"),t=te(l),e.__value=o=n[41].name,e.value=e.__value},m(a,s){L(a,e,s),u(e,t)},p(a,s){s[0]&2&&l!==(l=a[41].name+"")&&ke(t,l),s[0]&2&&o!==(o=a[41].name)&&(e.__value=o,e.value=e.__value)},d(a){a&&R(e)}}}function Sl(n){let e,l,t;return{c(){e=d("button"),e.textContent="Back",c(e,"class","button")},m(o,a){L(o,e,a),l||(t=V(e,"click",n[4]),l=!0)},p:fe,d(o){o&&R(e),l=!1,t()}}}function Eo(n){let e,l,t;return{c(){e=d("button"),e.textContent="Save",c(e,"class","button is-success")},m(o,a){L(o,e,a),l||(t=V(e,"click",n[12]),l=!0)},p:fe,d(o){o&&R(e),l=!1,t()}}}function Oo(n){let e,l,t;return{c(){e=d("button"),e.textContent="Next",c(e,"class","button is-primary")},m(o,a){L(o,e,a),l||(t=V(e,"click",n[3]),l=!0)},p:fe,d(o){o&&R(e),l=!1,t()}}}function Do(n){let e,l,t,o,a,s,r,i;function _(k,v){return k[0]===1?To:k[0]===2?Ro:Co}let h=_(n),p=h(n),f=n[0]>1&&Sl(n);function g(k,v){return k[0]<Wl?Oo:Eo}let m=g(n),b=m(n);return{c(){e=d("div"),l=d("h3"),l.textContent="Configuration Wizard",t=S(),p.c(),o=S(),a=d("nav"),s=d("div"),f&&f.c(),r=S(),i=d("div"),b.c(),c(l,"class","title is-4"),c(s,"class","level-left"),c(i,"class","level-right"),c(a,"class","level"),c(e,"class","box")},m(k,v){L(k,e,v),u(e,l),u(e,t),p.m(e,null),u(e,o),u(e,a),u(a,s),f&&f.m(s,null),u(a,r),u(a,i),b.m(i,null)},p(k,v){h===(h=_(k))&&p?p.p(k,v):(p.d(1),p=h(k),p&&(p.c(),p.m(e,o))),k[0]>1?f?f.p(k,v):(f=Sl(k),f.c(),f.m(s,null)):f&&(f.d(1),f=null),m===(m=g(k))&&b?b.p(k,v):(b.d(1),b=m(k),b&&(b.c(),b.m(i,null)))},i:fe,o:fe,d(k){k&&R(e),p.d(),f&&f.d(),b.d()}}}const Wl=3;function Uo(n,e,l){let t;const o=Ne(null),a=Ne({id:"Desktop",global_shortcut:"Ctrl+X",default_theme:"spacelab",default_role:"Default",roles:[]});ue(n,a,$=>l(1,t=$)),Mt(async()=>{try{let $;rt(Ce)?$=await be("get_config_schema"):$=await(await fetch("/config/schema")).json(),o.set($);const A=rt(je);A&&A.id&&a.update(U=>{var se;return{...U,id:A.id,global_shortcut:A.global_shortcut,default_theme:((se=A.roles[A.default_role])==null?void 0:se.theme)??"spacelab",default_role:A.default_role,roles:Object.values(A.roles).map(Y=>{var M,oe,he,$e,we,it,Je;const ee=(M=Y.kg)==null?void 0:M.automata_path,Ae=(ee==null?void 0:ee.Remote)??"",ce=((he=(oe=Y.kg)==null?void 0:oe.knowledge_graph_local)==null?void 0:he.path)??"";return{name:Y.name,shortname:Y.shortname,relevance_function:Y.relevance_function,theme:Y.theme,haystacks:(Y.haystacks??[]).map(We=>({path:We.location||We.path||"",read_only:We.read_only??!1,service:We.service||"Ripgrep",atomic_server_secret:We.atomic_server_secret||"",extra_parameters:We.extra_parameters||{}})),kg:{url:Ae,local_path:ce,local_type:((we=($e=Y.kg)==null?void 0:$e.knowledge_graph_local)==null?void 0:we.input_type)??"markdown",public:((it=Y.kg)==null?void 0:it.public)??!1,publish:((Je=Y.kg)==null?void 0:Je.publish)??!1}}})}})}catch($){console.error("Failed to load schema",$)}});let s=1;function r(){s<Wl&&l(0,s+=1)}function i(){s>1&&l(0,s-=1)}function _(){a.update($=>({...$,roles:[...$.roles,{name:"New Role",shortname:"new",relevance_function:"title-scorer",theme:"spacelab",haystacks:[],kg:{url:"",local_path:"",local_type:"markdown",public:!1,publish:!1}}]}))}function h($){a.update(A=>({...A,roles:A.roles.filter((U,se)=>se!==$)}))}function p($){a.update(A=>(A.roles[$].haystacks.push({path:"",read_only:!1,service:"Ripgrep",atomic_server_secret:"",extra_parameters:{}}),A))}function f($,A){a.update(U=>(U.roles[$].haystacks=U.roles[$].haystacks.filter((se,Y)=>Y!==A),U))}function g($,A,U="",se=""){a.update(Y=>{Y.roles[$].haystacks[A].extra_parameters||(Y.roles[$].haystacks[A].extra_parameters={});const ee=U||`param_${Date.now()}`;return Y.roles[$].haystacks[A].extra_parameters[ee]=se,Y})}function m($,A,U){a.update(se=>(delete se.roles[$].haystacks[A].extra_parameters[U],se))}function b($,A,U,se){a.update(Y=>{const ee=Y.roles[$].haystacks[A].extra_parameters;return ee[U]!==void 0&&U!==se&&(ee[se]=ee[U],delete ee[U]),Y})}function k($,A,U,se){const Y=se.target.value;b($,A,U,Y)}async function v(){var Y;const $=rt(a),A=rt(je);let U={...A};U.id=$.id,U.global_shortcut=$.global_shortcut,U.default_role=$.default_role;const se={};$.roles.forEach(ee=>{var M,oe;const Ae=ee.name,ce=Ae.replace(/^"|"$/g,"");se[ce]={extra:((oe=(M=A.roles)==null?void 0:M[Ae])==null?void 0:oe.extra)??{},name:ee.name,shortname:ee.shortname,theme:ee.theme,relevance_function:ee.relevance_function,haystacks:ee.haystacks.map(he=>({location:he.path,service:he.service,read_only:he.read_only,atomic_server_secret:he.service==="Atomic"?he.atomic_server_secret:void 0,extra_parameters:he.extra_parameters||{}})),kg:ee.kg.url||ee.kg.local_path?{automata_path:ee.kg.url?{Remote:ee.kg.url}:null,knowledge_graph_local:ee.kg.local_path?{input_type:ee.kg.local_type,path:ee.kg.local_path}:null,public:ee.kg.public,publish:ee.kg.publish}:null}}),U.roles=se,(!U.default_role||!se[U.default_role])&&(U.default_role=((Y=$.roles[0])==null?void 0:Y.name)??"Default"),U.selected_role=U.default_role;try{rt(Ce)?await be("update_config",{configNew:U}):await fetch("/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(U)}),je.set(U),alert("Configuration saved")}catch(ee){console.error(ee),alert("Failed to save config")}}function y(){t.id=Ct(this),a.set(t)}function P(){t.global_shortcut=this.value,a.set(t)}function G(){t.default_theme=this.value,a.set(t)}function C(){t.default_role=Ct(this),a.set(t)}function E($){t.roles[$].name=this.value,a.set(t)}function T($){t.roles[$].shortname=this.value,a.set(t)}function F($){t.roles[$].theme=this.value,a.set(t)}function K($){t.roles[$].relevance_function=this.value,a.set(t)}function J($,A){t.roles[$].haystacks[A].service=Ct(this),a.set(t)}function I($,A){t.roles[$].haystacks[A].path=this.value,a.set(t)}function N($,A){t.roles[$].haystacks[A].atomic_server_secret=this.value,a.set(t)}const w=($,A,U,se)=>k($,A,U,se);function W($,A,U){t.roles[$].haystacks[A].extra_parameters[U]=this.value,a.set(t)}const ne=($,A,U)=>m($,A,U),Q=($,A)=>g($,A,"tag","#rust"),H=($,A)=>g($,A,"max_count","10"),le=($,A)=>g($,A,"","");function Z($,A){t.roles[$].haystacks[A].read_only=this.checked,a.set(t)}const ie=($,A)=>f($,A),de=$=>p($);function me($){t.roles[$].kg.url=this.value,a.set(t)}function j($){t.roles[$].kg.local_path=this.value,a.set(t)}function X($){t.roles[$].kg.local_type=Ct(this),a.set(t)}function x($){t.roles[$].kg.public=this.checked,a.set(t)}function ae($){t.roles[$].kg.publish=this.checked,a.set(t)}return[s,t,a,r,i,_,h,p,f,g,m,k,v,y,P,G,C,E,T,F,K,J,I,N,w,W,ne,Q,H,le,Z,ie,de,me,j,X,x,ae,$=>h($)]}class Ao extends De{constructor(e){super(),Ue(this,e,Uo,Do,Re,{},null,[-1,-1])}}function Mo(n){let e,l,t,o,a,s;return a=new Ml({props:{content:n[0],onChange:n[1]}}),{c(){e=d("div"),l=d("p"),l.innerHTML="<i>The best editing experience is to configure Atomic Server, in the meantime use editor below. You will need to refresh page via Command R or Ctrl-R to see changes</i>",t=S(),o=d("div"),q(a.$$.fragment),c(o,"class","editor"),c(e,"class","box")},m(r,i){L(r,e,i),u(e,l),u(e,t),u(e,o),z(a,o,null),s=!0},p(r,[i]){const _={};i&1&&(_.content=r[0]),a.$set(_)},i(r){s||(O(a.$$.fragment,r),s=!0)},o(r){D(a.$$.fragment,r),s=!1},d(r){r&&R(e),B(a)}}}function Po(n,e,l){let t,o;ue(n,je,r=>l(2,t=r)),ue(n,Ce,r=>l(3,o=r));let a={json:t};function s(r){if(console.log("contents changed:",r),console.log("is tauri",o),je.update(i=>(i=r.json,i)),rt(Ce))console.log("Updating config on server"),be("update_config",{configNew:r.json}).then(i=>{console.log(`Message: ${i}`)}).catch(i=>console.error(i));else{let i=`${Qe.ServerURL}/config/`;fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r.json)})}l(0,a=r)}return Mt(()=>{l(0,a={json:t})}),[a,s]}class jo extends De{constructor(e){super(),Ue(this,e,Po,Mo,Re,{})}}const{window:At}=on;function Io(n){let e,l,t,o,a,s,r,i,_,h;return{c(){e=d("div"),l=d("div"),t=d("h3"),t.textContent="Error loading graph",o=S(),a=d("p"),s=te(n[3]),r=S(),i=d("button"),i.textContent="Retry",c(i,"class","button is-primary"),c(l,"class","error-content svelte-1ry9pkl"),c(e,"class","error-overlay svelte-1ry9pkl")},m(p,f){L(p,e,f),u(e,l),u(l,t),u(l,o),u(l,a),u(a,s),u(l,r),u(l,i),_||(h=V(i,"click",n[11]),_=!0)},p(p,f){f&8&&ke(s,p[3])},d(p){p&&R(e),_=!1,h()}}}function Wo(n){let e;return{c(){e=d("div"),e.innerHTML=`<div class="loading-content svelte-1ry9pkl"><div class="loader svelte-1ry9pkl"></div> 
        <p>Loading knowledge graph...</p></div>`,c(e,"class","loading-overlay svelte-1ry9pkl")},m(l,t){L(l,e,t)},p:fe,d(l){l&&R(e)}}}function Cl(n){let e,l,t;return{c(){e=d("button"),e.innerHTML='<i class="fas fa-times svelte-1ry9pkl"></i>',c(e,"class","close-button svelte-1ry9pkl"),c(e,"title","Close Graph")},m(o,a){L(o,e,a),l||(t=V(e,"click",n[17]),l=!0)},p:fe,d(o){o&&R(e),l=!1,t()}}}function Rl(n){let e;return{c(){e=d("div"),e.innerHTML="<span><strong>Left-click:</strong> View node • <strong>Right-click:</strong> Edit node • <strong>Drag:</strong> Move • <strong>Scroll:</strong> Zoom</span>",c(e,"class","controls-info svelte-1ry9pkl")},m(l,t){L(l,e,t)},d(l){l&&R(e)}}}function Tl(n){let e,l;return{c(){e=d("div"),l=te(n[8]),c(e,"class","debug-message svelte-1ry9pkl")},m(t,o){L(t,e,o),u(e,l)},p(t,o){o&256&&ke(l,t[8])},d(t){t&&R(e)}}}function Ll(n){let e=n[5].id,l,t,o=Nl(n);return{c(){o.c(),l=xe()},m(a,s){o.m(a,s),L(a,l,s),t=!0},p(a,s){s&32&&Re(e,e=a[5].id)?(Te(),D(o,1,1,fe),Le(),o=Nl(a),o.c(),O(o,1),o.m(l.parentNode,l)):o.p(a,s)},i(a){t||(O(o),t=!0)},o(a){D(o),t=!1},d(a){a&&R(l),o.d(a)}}}function Nl(n){let e,l,t;function o(s){n[18](s)}let a={item:n[5],initialEdit:n[7]};return n[6]!==void 0&&(a.active=n[6]),e=new Pt({props:a}),ye.push(()=>Ee(e,"active",o)),e.$on("close",n[12]),e.$on("save",n[13]),{c(){q(e.$$.fragment)},m(s,r){z(e,s,r),t=!0},p(s,r){const i={};r&32&&(i.item=s[5]),r&128&&(i.initialEdit=s[7]),!l&&r&64&&(l=!0,i.active=s[6],Oe(()=>l=!1)),e.$set(i)},i(s){t||(O(e.$$.fragment,s),t=!0)},o(s){D(e.$$.fragment,s),t=!1},d(s){B(e,s)}}}function Ho(n){let e,l,t,o,a,s,r,i,_;Xe(n[15]);function h(v,y){if(v[2])return Wo;if(v[3])return Io}let p=h(n),f=p&&p(n),g=n[0]&&Cl(n),m=!n[2]&&!n[3]&&n[4].length>0&&Rl(),b=n[8]&&Tl(n),k=n[5]&&Ll(n);return{c(){e=d("div"),f&&f.c(),l=S(),g&&g.c(),t=S(),m&&m.c(),o=S(),b&&b.c(),a=S(),k&&k.c(),s=xe(),c(e,"class","graph-container svelte-1ry9pkl"),Ze(e,"width",n[0]?"100vw":"600px"),Ze(e,"height",n[0]?"100vh":"400px"),Tt(e,"fullscreen",n[0])},m(v,y){L(v,e,y),f&&f.m(e,null),n[16](e),L(v,l,y),g&&g.m(v,y),L(v,t,y),m&&m.m(v,y),L(v,o,y),b&&b.m(v,y),L(v,a,y),k&&k.m(v,y),L(v,s,y),r=!0,i||(_=V(At,"resize",n[15]),i=!0)},p(v,[y]){p===(p=h(v))&&f?f.p(v,y):(f&&f.d(1),f=p&&p(v),f&&(f.c(),f.m(e,null))),(!r||y&1)&&Ze(e,"width",v[0]?"100vw":"600px"),(!r||y&1)&&Ze(e,"height",v[0]?"100vh":"400px"),(!r||y&1)&&Tt(e,"fullscreen",v[0]),v[0]?g?g.p(v,y):(g=Cl(v),g.c(),g.m(t.parentNode,t)):g&&(g.d(1),g=null),!v[2]&&!v[3]&&v[4].length>0?m||(m=Rl(),m.c(),m.m(o.parentNode,o)):m&&(m.d(1),m=null),v[8]?b?b.p(v,y):(b=Tl(v),b.c(),b.m(a.parentNode,a)):b&&(b.d(1),b=null),v[5]?k?(k.p(v,y),y&32&&O(k,1)):(k=Ll(v),k.c(),O(k,1),k.m(s.parentNode,s)):k&&(Te(),D(k,1,1,()=>{k=null}),Le())},i(v){r||(O(k),r=!0)},o(v){D(k),r=!1},d(v){v&&R(e),f&&f.d(),n[16](null),v&&R(l),g&&g.d(v),v&&R(t),m&&m.d(v),v&&R(o),b&&b.d(v),v&&R(a),k&&k.d(v),v&&R(s),i=!1,_()}}}function El(n){return{id:`kg-node-${n.id}`,url:`#/graph/node/${n.id}`,title:n.label,body:`# ${n.label}

**Knowledge Graph Node**

ID: ${n.id}
Rank: ${n.rank}

This is a concept node from the knowledge graph. You can edit this content to add more information about "${n.label}".`,description:`Knowledge graph concept: ${n.label}`,tags:["knowledge-graph","concept"],rank:n.rank,stub:`Knowledge graph concept: ${n.label}`}}function Fo(n,e,l){let t,o;ue(n,at,w=>l(20,t=w)),ue(n,Ce,w=>l(21,o=w));let{apiUrl:a="/rolegraph"}=e,{fullscreen:s=!0}=e,r,i=!0,_=null,h=[],p=[],f=null,g=!1,m=!1,b="",k=window.innerWidth,v=window.innerHeight;function y(){l(9,k=window.innerWidth),l(10,v=window.innerHeight),!i&&!_&&F()}async function P(){l(2,i=!0),l(3,_=null);try{if(o){console.log("Loading rolegraph from Tauri");const w=await be("get_rolegraph",{roleName:t||void 0});if(w&&w.status==="success")l(4,h=w.nodes),p=w.edges;else throw new Error(`Tauri rolegraph fetch failed: ${(w==null?void 0:w.status)||"unknown error"}`)}else{console.log("Loading rolegraph from server");const w=t?`${a}?role=${encodeURIComponent(t)}`:a,W=await fetch(w);if(!W.ok)throw new Error(`Failed to fetch: ${W.status}`);const ne=await W.json();l(4,h=ne.nodes),p=ne.edges}}catch(w){l(3,_=w.message),console.error("Error fetching rolegraph:",w)}finally{l(2,i=!1)}}function G(w,W){w.stopPropagation(),console.log("Node clicked:",W.label),l(5,f=El(W)),l(7,m=!1),l(6,g=!0)}function C(w,W){w.preventDefault(),w.stopPropagation(),console.log("Node right-clicked:",W.label),l(8,b=`Right-clicked: ${W.label}`),l(5,f=El(W)),l(7,m=!0),l(6,g=!0),setTimeout(()=>{l(8,b="")},2e3)}function E(){l(6,g=!1),l(5,f=null),l(7,m=!1)}async function T(){if(f)try{const w=await fetch("/documents",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)});w.ok?console.log("Successfully saved KG record:",f.id):console.error("Failed to save KG record:",w.statusText)}catch(w){console.error("Error saving KG record:",w)}finally{l(6,g=!1),l(5,f=null),l(7,m=!1)}}function F(){if(!r)return;l(1,r.innerHTML="",r);const w=Et(r).append("svg").attr("width",k).attr("height",v),W=dn().scaleExtent([.1,10]).on("zoom",j=>{ne.attr("transform",j.transform)});w.call(W);const ne=w.append("g"),Q=_n(h).force("link",mn(p).id(j=>j.id).distance(100)).force("charge",hn().strength(-200)).force("center",gn(k/2,v/2)).force("collision",vn().radius(20)),H=ne.append("g").attr("class","links").selectAll("line").data(p).enter().append("line").attr("stroke","#666").attr("stroke-opacity",.7).attr("stroke-width",j=>{const X=j.weight||j.rank||1;return Math.max(1,Math.min(8,X*2))}),le=ne.append("g").attr("class","nodes").selectAll("circle").data(h).enter().append("circle").attr("r",j=>{const X=j.rank||1;return Math.max(6,Math.min(20,X*2))}).attr("fill",j=>{const X=j.rank||1,x=Math.min(X/10,1);return bn(.2+x*.6)}).attr("stroke","#fff").attr("stroke-width",2).style("cursor","pointer").on("click",(j,X)=>G(j,X)).on("contextmenu",(j,X)=>C(j,X)).on("mouseover",function(j,X){Et(this).transition().duration(150).attr("stroke-width",3).attr("r",x=>{const ae=x.rank||1;return Math.max(8,Math.min(24,ae*2.5))})}).on("mouseout",function(j,X){Et(this).transition().duration(150).attr("stroke-width",2).attr("r",x=>{const ae=x.rank||1;return Math.max(6,Math.min(20,ae*2))})}).call(kn().on("start",ie).on("drag",de).on("end",me)),Z=ne.append("g").attr("class","labels").selectAll("text").data(h).enter().append("text").attr("text-anchor","middle").attr("dy",".35em").attr("font-size","11px").attr("font-family","Arial, sans-serif").attr("fill","#333").attr("pointer-events","none").text(j=>j.label.length>12?j.label.substring(0,12)+"...":j.label);Q.on("tick",()=>{H.attr("x1",j=>j.source.x).attr("y1",j=>j.source.y).attr("x2",j=>j.target.x).attr("y2",j=>j.target.y),le.attr("cx",j=>j.x).attr("cy",j=>j.y),Z.attr("x",j=>j.x).attr("y",j=>j.y)});function ie(j,X){j.active||Q.alphaTarget(.3).restart(),X.fx=X.x,X.fy=X.y}function de(j,X){X.fx=j.x,X.fy=j.y}function me(j,X){j.active||Q.alphaTarget(0),X.fx=null,X.fy=null}}Mt(()=>{P().then(()=>{_||F()});const w=W=>{W.preventDefault()};return r&&r.addEventListener("contextmenu",w),window.addEventListener("resize",y),()=>{r&&r.removeEventListener("contextmenu",w),window.removeEventListener("resize",y)}});function K(){l(9,k=At.innerWidth),l(10,v=At.innerHeight)}function J(w){ye[w?"unshift":"push"](()=>{r=w,l(1,r)})}const I=()=>history.back();function N(w){g=w,l(6,g)}return n.$$set=w=>{"apiUrl"in w&&l(14,a=w.apiUrl),"fullscreen"in w&&l(0,s=w.fullscreen)},[s,r,i,_,h,f,g,m,b,k,v,P,E,T,a,K,J,I,N]}class Ko extends De{constructor(e){super(),Ue(this,e,Fo,Ho,Re,{apiUrl:14,fullscreen:0})}}function Go(n){let e,l;return e=new So({}),{c(){q(e.$$.fragment)},m(t,o){z(e,t,o),l=!0},i(t){l||(O(e.$$.fragment,t),l=!0)},o(t){D(e.$$.fragment,t),l=!1},d(t){B(e,t)}}}function qo(n){let e,l;return e=new qn({}),{c(){q(e.$$.fragment)},m(t,o){z(e,t,o),l=!0},i(t){l||(O(e.$$.fragment,t),l=!0)},o(t){D(e.$$.fragment,t),l=!1},d(t){B(e,t)}}}function zo(n){let e,l;return e=new Ao({}),{c(){q(e.$$.fragment)},m(t,o){z(e,t,o),l=!0},i(t){l||(O(e.$$.fragment,t),l=!0)},o(t){D(e.$$.fragment,t),l=!1},d(t){B(e,t)}}}function Bo(n){let e,l;return e=new jo({}),{c(){q(e.$$.fragment)},m(t,o){z(e,t,o),l=!0},i(t){l||(O(e.$$.fragment,t),l=!0)},o(t){D(e.$$.fragment,t),l=!1},d(t){B(e,t)}}}function Jo(n){let e,l;return e=new Ko({}),{c(){q(e.$$.fragment)},m(t,o){z(e,t,o),l=!0},i(t){l||(O(e.$$.fragment,t),l=!0)},o(t){D(e.$$.fragment,t),l=!1},d(t){B(e,t)}}}function Vo(n){let e;return{c(){e=d("nav"),e.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
            <a class="navbar-item" href="/config/wizard">Wizard</a> 
            <a class="navbar-item" href="/config/json">JSON Editor</a> 
            <a class="navbar-item" href="/graph">Graph</a></div>`,c(e,"class","navbar")},m(l,t){L(l,e,t)},p:fe,d(l){l&&R(e)}}}function Yo(n){let e,l,t,o,a,s,r,i,_,h,p,f,g,m,b,k,v,y,P,G,C,E,T,F,K,J,I,N;return r=new Rt({}),h=new Ke({props:{path:"/",$$slots:{default:[Go]},$$scope:{ctx:n}}}),m=new Ke({props:{path:"/fetch/*",$$slots:{default:[qo]},$$scope:{ctx:n}}}),k=new Ke({props:{path:"/config/wizard",$$slots:{default:[zo]},$$scope:{ctx:n}}}),y=new Ke({props:{path:"/config/json",$$slots:{default:[Bo]},$$scope:{ctx:n}}}),G=new Ke({props:{path:"/graph",$$slots:{default:[Jo]},$$scope:{ctx:n}}}),F=new Ke({props:{path:"/",$$slots:{default:[Vo]},$$scope:{ctx:n}}}),{c(){e=d("meta"),l=S(),t=d("div"),o=d("main"),a=d("div"),s=d("div"),q(r.$$.fragment),i=S(),_=d("div"),q(h.$$.fragment),p=S(),f=d("br"),g=S(),q(m.$$.fragment),b=S(),q(k.$$.fragment),v=S(),q(y.$$.fragment),P=S(),q(G.$$.fragment),C=S(),E=d("footer"),T=d("div"),q(F.$$.fragment),c(e,"name","color-scheme"),c(e,"content",n[1]),document.title="Terraphim",c(s,"class","role-selector svelte-1bfpta4"),c(a,"class","top-controls svelte-1bfpta4"),c(_,"class","search-area svelte-1bfpta4"),c(o,"class","main-content svelte-1bfpta4"),c(T,"class",K=Zt(n[0])+" svelte-1bfpta4"),c(E,"class","svelte-1bfpta4"),c(t,"class","is-full-height svelte-1bfpta4")},m(w,W){u(document.head,e),L(w,l,W),L(w,t,W),u(t,o),u(o,a),u(a,s),z(r,s,null),u(o,i),u(o,_),z(h,_,null),u(o,p),u(o,f),u(o,g),z(m,o,null),u(o,b),z(k,o,null),u(o,v),z(y,o,null),u(o,P),z(G,o,null),u(t,C),u(t,E),u(E,T),z(F,T,null),J=!0,I||(N=[V(E,"mouseover",n[2]),V(E,"focus",n[2])],I=!0)},p(w,[W]){(!J||W&2)&&c(e,"content",w[1]);const ne={};W&8&&(ne.$$scope={dirty:W,ctx:w}),h.$set(ne);const Q={};W&8&&(Q.$$scope={dirty:W,ctx:w}),m.$set(Q);const H={};W&8&&(H.$$scope={dirty:W,ctx:w}),k.$set(H);const le={};W&8&&(le.$$scope={dirty:W,ctx:w}),y.$set(le);const Z={};W&8&&(Z.$$scope={dirty:W,ctx:w}),G.$set(Z);const ie={};W&8&&(ie.$$scope={dirty:W,ctx:w}),F.$set(ie),(!J||W&1&&K!==(K=Zt(w[0])+" svelte-1bfpta4"))&&c(T,"class",K)},i(w){J||(O(r.$$.fragment,w),O(h.$$.fragment,w),O(m.$$.fragment,w),O(k.$$.fragment,w),O(y.$$.fragment,w),O(G.$$.fragment,w),O(F.$$.fragment,w),J=!0)},o(w){D(r.$$.fragment,w),D(h.$$.fragment,w),D(m.$$.fragment,w),D(k.$$.fragment,w),D(y.$$.fragment,w),D(G.$$.fragment,w),D(F.$$.fragment,w),J=!1},d(w){R(e),w&&R(l),w&&R(t),B(r),B(h),B(m),B(k),B(y),B(G),B(F),I=!1,Ie(N)}}}function Zo(n,e,l){let t;ue(n,ft,s=>l(1,t=s));let o="is-hidden";function a(){l(0,o="")}return[o,t,a]}class Qo extends De{constructor(e){super(),Ue(this,e,Zo,Yo,Re,{})}}const Xo=new un;fn(Xo);new Qo({target:document.getElementById("app")});
