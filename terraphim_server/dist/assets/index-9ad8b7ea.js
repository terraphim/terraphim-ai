var is=Object.defineProperty;var as=(l,e,t)=>e in l?is(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var Tl=(l,e,t)=>(as(l,typeof e!="symbol"?e+"":e,t),t);import{aa as $t,S as ut,i as ct,s as ot,q as f,Y as q,b as T,y as r,Z as ge,I as ye,j as S,ak as Re,F as nt,m as Kt,a as g,v as a,l as X,E as Ke,au as It,r as re,z as ie,t as G,d as J,B as ae,av as us,aw as Bt,H as We,U as Ye,V as Qe,ax as Ll,ay as cs,g as je,e as ze,O as Ge,W as pe,az as Il,aA as kt,aB as Kn,aC as fs,a1 as Ce,C as lt,aD as Ue,aE as Bn,D as ll,G as ol,aF as qn,w as At,x as Lt,A as jl,a2 as ps,aG as cl,ac as ds,af as wt,a7 as _s,a9 as ms,n as hs}from"./vendor-ui-cd3d2b6a.js";import{R as Tt,S as Ol}from"./vendor-utils-1b347ea1.js";import{J as Jn,_ as gs,o as bs}from"./vendor-editor-992829d3.js";import{P as Vn,T as Nl,u as Yn,y as vs,A as ks,S as ws,q as $s}from"./vendor-atomic-1ea13e29.js";import{E as ys}from"./novel-editor-b32024cb.js";import{s as Pl,z as Cs,a as Ss,l as Ts,m as Rs,c as As,b as Ls,B as Ns,d as Os}from"./vendor-charts-e6a4a6c9.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const u of n)if(u.type==="childList")for(const s of u.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function t(n){const u={};return n.integrity&&(u.integrity=n.integrity),n.referrerPolicy&&(u.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?u.credentials="include":n.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function o(n){if(n.ep)return;n.ep=!0;const u=t(n);fetch(n.href,u)}})();const at={ServerURL:location.protocol+"//"+window.location.host||"/"},ul=$t([]),Us={id:"Desktop",global_shortcut:"",roles:{},default_role:{original:"",lowercase:""},selected_role:{original:"",lowercase:""}},fl=$t("spacelab"),Rt=$t("selected"),Ve=$t(!1),Ps=$t(`${at.ServerURL}/documents/search`),gt=$t(Us),co=$t([]);let Rl=$t("");const ht=$t(!1);let Gt=null;function Es(l){if(typeof document>"u")return;const e=`/assets/bulmaswatch/${l}/bulmaswatch.min.css`;if(Gt!=null&&Gt.href.endsWith(e))return;const t=document.createElement("link");t.rel="stylesheet",t.href=e,t.id="bulma-theme",t.onload=()=>{Gt&&Gt!==t&&Gt.remove(),Gt=t},document.head.appendChild(t);const o=document.head.querySelector('meta[name="color-scheme"]');o&&o.setAttribute("content",l)}fl.subscribe(Es);function Ds(l){let e,t;return{c(){e=f("option"),t=q(l[1]),e.__value=l[0],e.value=e.__value},m(o,n){T(o,e,n),r(e,t)},p(o,[n]){n&2&&ge(t,o[1]),n&1&&(e.__value=o[0],e.value=e.__value)},i:ye,o:ye,d(o){o&&S(e)}}}function Ms(l,e,t){let o,{subject:n}=e;const u=Vn(n),s=Nl(u,Yn.properties.name);return Re(l,s,c=>t(1,o=c)),Nl(u,"http://localhost:9883/property/theme"),l.$$set=c=>{"subject"in c&&t(0,n=c.subject)},[n,o,s]}class Is extends ut{constructor(e){super(),ct(this,e,Ms,Ds,ot,{subject:0})}}function fo(l){let e,t,o,n,u,s,c=l[0]&&po();return{c(){e=f("button"),t=f("span"),t.innerHTML='<i class="fas fa-arrow-left"></i>',o=g(),c&&c.c(),a(t,"class","icon svelte-rnsqpo"),a(e,"class",n="button is-light back-button "+l[1]+" svelte-rnsqpo"),a(e,"title","Go back"),a(e,"aria-label","Go back")},m(i,p){T(i,e,p),r(e,t),r(e,o),c&&c.m(e,null),u||(s=[X(e,"click",l[3]),X(e,"keydown",l[6])],u=!0)},p(i,p){i[0]?c||(c=po(),c.c(),c.m(e,null)):c&&(c.d(1),c=null),p&2&&n!==(n="button is-light back-button "+i[1]+" svelte-rnsqpo")&&a(e,"class",n)},d(i){i&&S(e),c&&c.d(),u=!1,Ke(s)}}}function po(l){let e;return{c(){e=f("span"),e.textContent="Back",a(e,"class","back-text svelte-rnsqpo")},m(t,o){T(t,e,o)},d(t){t&&S(e)}}}function js(l){let e,t=l[2]&&fo(l);return{c(){t&&t.c(),e=nt()},m(o,n){t&&t.m(o,n),T(o,e,n)},p(o,[n]){o[2]?t?t.p(o,n):(t=fo(o),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:ye,o:ye,d(o){t&&t.d(o),o&&S(e)}}}function zs(l,e,t){let{fallbackPath:o="/"}=e,{showText:n=!0}=e,{customClass:u=""}=e,{hideOnPaths:s=["/"]}=e,c=!0;function i(){var _;try{const m=((_=window.location)==null?void 0:_.pathname)||"/";t(2,c=!s.includes(m))}catch{t(2,c=!0)}}function p(){window.history.length>1?window.history.back():window.location.href=o}Kt(()=>(i(),window.addEventListener("popstate",i),window.addEventListener("hashchange",i),()=>{window.removeEventListener("popstate",i),window.removeEventListener("hashchange",i)}));const d=_=>{(_.key==="Enter"||_.key===" ")&&(_.preventDefault(),p())};return l.$$set=_=>{"fallbackPath"in _&&t(4,o=_.fallbackPath),"showText"in _&&t(0,n=_.showText),"customClass"in _&&t(1,u=_.customClass),"hideOnPaths"in _&&t(5,s=_.hideOnPaths)},[n,u,c,p,o,s,d]}class nl extends ut{constructor(e){super(),ct(this,e,zs,js,ot,{fallbackPath:4,showText:0,customClass:1,hideOnPaths:5})}}function Hs(){return window.crypto.getRandomValues(new Uint32Array(1))[0]}function Dl(l,e=!1){const t=Hs(),o=`_${t}`;return Object.defineProperty(window,o,{value:n=>(e&&Reflect.deleteProperty(window,o),l==null?void 0:l(n)),writable:!1,configurable:!0}),t}async function Fe(l,e={}){return new Promise((t,o)=>{const n=Dl(s=>{t(s),Reflect.deleteProperty(window,`_${u}`)},!0),u=Dl(s=>{o(s),Reflect.deleteProperty(window,`_${n}`)},!0);window.__TAURI_IPC__({cmd:l,callback:n,error:u,...e})})}function _o(l,e,t){const o=l.slice();return o[25]=e[t],o}function Fs(l){let e,t,o;function n(s){l[13](s)}let u={};return l[5]!==void 0&&(u.value=l[5]),e=new Bt({props:u}),We.push(()=>Ye(e,"value",n)),{c(){re(e.$$.fragment)},m(s,c){ie(e,s,c),o=!0},p(s,c){const i={};!t&&c&32&&(t=!0,i.value=s[5],Qe(()=>t=!1)),e.$set(i)},i(s){o||(G(e.$$.fragment,s),o=!0)},o(s){J(e.$$.fragment,s),o=!1},d(s){ae(e,s)}}}function Ws(l){let e,t,o;function n(s){l[14](s)}let u={type:"password",placeholder:"secret",icon:"fas fa-lock",expanded:!0};return l[6]!==void 0&&(u.value=l[6]),e=new Bt({props:u}),We.push(()=>Ye(e,"value",n)),{c(){re(e.$$.fragment)},m(s,c){ie(e,s,c),o=!0},p(s,c){const i={};!t&&c&64&&(t=!0,i.value=s[6],Qe(()=>t=!1)),e.$set(i)},i(s){o||(G(e.$$.fragment,s),o=!0)},o(s){J(e.$$.fragment,s),o=!1},d(s){ae(e,s)}}}function Gs(l){let e;return{c(){e=q("Save")},m(t,o){T(t,e,o)},d(t){t&&S(e)}}}function Ks(l){let e,t;return e=new Ll({props:{type:"is-success",class:"is-right",iconPack:"fa",iconLeft:"check",$$slots:{default:[Gs]},$$scope:{ctx:l}}}),e.$on("click",l[8]),e.$on("submit",l[8]),{c(){re(e.$$.fragment)},m(o,n){ie(e,o,n),t=!0},p(o,n){const u={};n&268435456&&(u.$$scope={dirty:n,ctx:o}),e.$set(u)},i(o){t||(G(e.$$.fragment,o),t=!0)},o(o){J(e.$$.fragment,o),t=!1},d(o){ae(e,o)}}}function Bs(l){let e,t,o,n,u,s;return e=new It({props:{$$slots:{default:[Fs]},$$scope:{ctx:l}}}),o=new It({props:{grouped:!0,$$slots:{default:[Ws]},$$scope:{ctx:l}}}),u=new It({props:{grouped:!0,$$slots:{default:[Ks]},$$scope:{ctx:l}}}),{c(){re(e.$$.fragment),t=g(),re(o.$$.fragment),n=g(),re(u.$$.fragment)},m(c,i){ie(e,c,i),T(c,t,i),ie(o,c,i),T(c,n,i),ie(u,c,i),s=!0},p(c,i){const p={};i&268435488&&(p.$$scope={dirty:i,ctx:c}),e.$set(p);const d={};i&268435520&&(d.$$scope={dirty:i,ctx:c}),o.$set(d);const _={};i&268435456&&(_.$$scope={dirty:i,ctx:c}),u.$set(_)},i(c){s||(G(e.$$.fragment,c),G(o.$$.fragment,c),G(u.$$.fragment,c),s=!0)},o(c){J(e.$$.fragment,c),J(o.$$.fragment,c),J(u.$$.fragment,c),s=!1},d(c){ae(e,c),c&&S(t),ae(o,c),c&&S(n),ae(u,c)}}}function qs(l){let e,t,o;function n(s){l[15](s)}let u={type:"search",placeholder:"Fetch JSON",icon:"search"};return l[3]!==void 0&&(u.value=l[3]),e=new Bt({props:u}),We.push(()=>Ye(e,"value",n)),{c(){re(e.$$.fragment)},m(s,c){ie(e,s,c),o=!0},p(s,c){const i={};!t&&c&8&&(t=!0,i.value=s[3],Qe(()=>t=!1)),e.$set(i)},i(s){o||(G(e.$$.fragment,s),o=!0)},o(s){J(e.$$.fragment,s),o=!1},d(s){ae(e,s)}}}function Js(l){let e;return{c(){e=q("WikiPage")},m(t,o){T(t,e,o)},d(t){t&&S(e)}}}function Vs(l){let e,t,o,n,u,s;function c(_){l[16](_)}let i={type:"search",placeholder:"Post JSON",icon:"search"};l[4]!==void 0&&(i.value=l[4]),e=new Bt({props:i}),We.push(()=>Ye(e,"value",c));function p(_){l[17](_)}let d={$$slots:{default:[Js]},$$scope:{ctx:l}};return l[2]!==void 0&&(d.checked=l[2]),n=new cs({props:d}),We.push(()=>Ye(n,"checked",p)),{c(){re(e.$$.fragment),o=g(),re(n.$$.fragment)},m(_,m){ie(e,_,m),T(_,o,m),ie(n,_,m),s=!0},p(_,m){const k={};!t&&m&16&&(t=!0,k.value=_[4],Qe(()=>t=!1)),e.$set(k);const v={};m&268435456&&(v.$$scope={dirty:m,ctx:_}),!u&&m&4&&(u=!0,v.checked=_[2],Qe(()=>u=!1)),n.$set(v)},i(_){s||(G(e.$$.fragment,_),G(n.$$.fragment,_),s=!0)},o(_){J(e.$$.fragment,_),J(n.$$.fragment,_),s=!1},d(_){ae(e,_),_&&S(o),ae(n,_)}}}function Ys(l){let e;return{c(){e=q("Fetch")},m(t,o){T(t,e,o)},d(t){t&&S(e)}}}function Qs(l){let e,t;return e=new Ll({props:{type:"is-primary",$$slots:{default:[Ys]},$$scope:{ctx:l}}}),e.$on("click",l[9]),e.$on("submit",l[9]),{c(){re(e.$$.fragment)},m(o,n){ie(e,o,n),t=!0},p(o,n){const u={};n&268435456&&(u.$$scope={dirty:n,ctx:o}),e.$set(u)},i(o){t||(G(e.$$.fragment,o),t=!0)},o(o){J(e.$$.fragment,o),t=!1},d(o){ae(e,o)}}}function Zs(l){let e,t,o,n,u,s;return e=new It({props:{grouped:!0,$$slots:{default:[qs]},$$scope:{ctx:l}}}),o=new It({props:{grouped:!0,$$slots:{default:[Vs]},$$scope:{ctx:l}}}),u=new It({props:{grouped:!0,$$slots:{default:[Qs]},$$scope:{ctx:l}}}),{c(){re(e.$$.fragment),t=g(),re(o.$$.fragment),n=g(),re(u.$$.fragment)},m(c,i){ie(e,c,i),T(c,t,i),ie(o,c,i),T(c,n,i),ie(u,c,i),s=!0},p(c,i){const p={};i&268435464&&(p.$$scope={dirty:i,ctx:c}),e.$set(p);const d={};i&268435476&&(d.$$scope={dirty:i,ctx:c}),o.$set(d);const _={};i&268435456&&(_.$$scope={dirty:i,ctx:c}),u.$set(_)},i(c){s||(G(e.$$.fragment,c),G(o.$$.fragment,c),G(u.$$.fragment,c),s=!0)},o(c){J(e.$$.fragment,c),J(o.$$.fragment,c),J(u.$$.fragment,c),s=!1},d(c){ae(e,c),c&&S(t),ae(o,c),c&&S(n),ae(u,c)}}}function Xs(l){let e,t,o,n,u;return n=new Jn({props:{content:l[1],onChange:l[7]}}),{c(){e=f("p"),e.innerHTML=`<i>The best editing experience is to configure Atomic Server, in the
        meantime use editor below. You will need to refresh page via Command R
        or Ctrl-R to see changes</i>`,t=g(),o=f("div"),re(n.$$.fragment),a(o,"class","editor")},m(s,c){T(s,e,c),T(s,t,c),T(s,o,c),ie(n,o,null),u=!0},p(s,c){const i={};c&2&&(i.content=s[1]),n.$set(i)},i(s){u||(G(n.$$.fragment,s),u=!0)},o(s){J(n.$$.fragment,s),u=!1},d(s){s&&S(e),s&&S(t),s&&S(o),ae(n)}}}function mo(l){let e,t;return e=new Is({props:{subject:l[25]}}),{c(){re(e.$$.fragment)},m(o,n){ie(e,o,n),t=!0},p(o,n){const u={};n&1&&(u.subject=o[25]),e.$set(u)},i(o){t||(G(e.$$.fragment,o),t=!0)},o(o){J(e.$$.fragment,o),t=!1},d(o){ae(e,o)}}}function xs(l){let e,t,o=l[0]??[],n=[];for(let s=0;s<o.length;s+=1)n[s]=mo(_o(l,o,s));const u=s=>J(n[s],1,1,()=>{n[s]=null});return{c(){for(let s=0;s<n.length;s+=1)n[s].c();e=nt()},m(s,c){for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(s,c);T(s,e,c),t=!0},p(s,c){if(c&1){o=s[0]??[];let i;for(i=0;i<o.length;i+=1){const p=_o(s,o,i);n[i]?(n[i].p(p,c),G(n[i],1)):(n[i]=mo(p),n[i].c(),G(n[i],1),n[i].m(e.parentNode,e))}for(je(),i=o.length;i<n.length;i+=1)u(i);ze()}},i(s){if(!t){for(let c=0;c<o.length;c+=1)G(n[c]);t=!0}},o(s){n=n.filter(Boolean);for(let c=0;c<n.length;c+=1)J(n[c]);t=!1},d(s){Ge(n,s),s&&S(e)}}}function er(l){let e,t;return e=new us({props:{$$slots:{default:[xs]},$$scope:{ctx:l}}}),{c(){re(e.$$.fragment)},m(o,n){ie(e,o,n),t=!0},p(o,n){const u={};n&268435457&&(u.$$scope={dirty:n,ctx:o}),e.$set(u)},i(o){t||(G(e.$$.fragment,o),t=!0)},o(o){J(e.$$.fragment,o),t=!1},d(o){ae(e,o)}}}function tr(l){let e,t,o,n,u,s,c,i,p,d,_,m,k,v,w;return e=new nl({props:{fallbackPath:"/"}}),n=new Tt({props:{path:"/atomic",$$slots:{default:[Bs]},$$scope:{ctx:l}}}),s=new Tt({props:{path:"/json",$$slots:{default:[Zs]},$$scope:{ctx:l}}}),i=new Tt({props:{path:"/editor",$$slots:{default:[Xs]},$$scope:{ctx:l}}}),m=new It({props:{grouped:!0,position:"is-right",$$slots:{default:[er]},$$scope:{ctx:l}}}),{c(){re(e.$$.fragment),t=g(),o=f("div"),re(n.$$.fragment),u=g(),re(s.$$.fragment),c=g(),re(i.$$.fragment),p=g(),d=f("hr"),_=g(),re(m.$$.fragment),k=g(),v=f("nav"),v.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
    <a class="navbar-item" href="/fetch/json">Fetch JSON Data</a> 
    <a class="navbar-item" href="/fetch/atomic">Set Atomic Server</a> 
    <a class="navbar-item" href="/fetch/editor">Edit JSON config</a></div>`,a(o,"class","box"),a(v,"class","navbar")},m(h,A){ie(e,h,A),T(h,t,A),T(h,o,A),ie(n,o,null),r(o,u),ie(s,o,null),r(o,c),ie(i,o,null),T(h,p,A),T(h,d,A),T(h,_,A),ie(m,h,A),T(h,k,A),T(h,v,A),w=!0},p(h,[A]){const $={};A&268435552&&($.$$scope={dirty:A,ctx:h}),n.$set($);const b={};A&268435484&&(b.$$scope={dirty:A,ctx:h}),s.$set(b);const O={};A&268435458&&(O.$$scope={dirty:A,ctx:h}),i.$set(O);const Y={};A&268435457&&(Y.$$scope={dirty:A,ctx:h}),m.$set(Y)},i(h){w||(G(e.$$.fragment,h),G(n.$$.fragment,h),G(s.$$.fragment,h),G(i.$$.fragment,h),G(m.$$.fragment,h),w=!0)},o(h){J(e.$$.fragment,h),J(n.$$.fragment,h),J(s.$$.fragment,h),J(i.$$.fragment,h),J(m.$$.fragment,h),w=!1},d(h){ae(e,h),h&&S(t),h&&S(o),ae(n),ae(s),ae(i),h&&S(p),h&&S(d),h&&S(_),ae(m,h),h&&S(k),h&&S(v)}}}function lr(l,e,t){let o,n,u,s,c;Re(l,vs,R=>t(19,u=R)),Re(l,Ve,R=>t(20,s=R)),Re(l,gt,R=>t(21,c=R));let i={json:c};function p(R){if(console.log("contents changed:",R),console.log("is tauri",s),gt.update(C=>(C=R.json,C)),Ve)console.log("Updating config on server"),Fe("update_config",{configNew:R.json}).then(C=>{console.log(`Message: ${C}`)}).catch(C=>console.error(C));else{let C=`${at.ServerURL}/config/`;fetch(C,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(R.json)})}t(1,i=R)}let d=!1,_="https://raw.githubusercontent.com/terraphim/terraphim-cloud-fastapi/main/data/ref_arch.json",m="http://localhost:8000/documents/",k="http://localhost:9883/",v;const w=async()=>{console.log("Updating atomic server configuration");const R=ks.fromSecret(v);u.setServerUrl(k),console.log("Server set.Setting agent"),u.setAgent(R)},h=async()=>{b()},A=({data:{msg:R,data:C}})=>{console.log(R,C)};let $;const b=async()=>{const R=await gs(()=>import("./fetcher.worker-7e58969a.js"),[]);$=new R.default,$.onmessage=A;const C={msg:"fetcher",data:{url:_,postUrl:m,isWiki:d}};$.postMessage(C)},O=Vn("http://localhost:9883/config/y3zx5wtm0bq"),Y=Nl(O,Yn.properties.name);Re(l,Y,R=>t(12,n=R));const M=Nl(O,"http://localhost:9883/property/role");Re(l,M,R=>t(0,o=R));function j(R){k=R,t(5,k)}function N(R){v=R,t(6,v)}function P(R){_=R,t(3,_)}function F(R){m=R,t(4,m)}function H(R){d=R,t(2,d)}return l.$$.update=()=>{l.$$.dirty&4096&&console.log("Print name",n),l.$$.dirty&1&&console.log("Print roles",o)},[o,i,d,_,m,k,v,p,w,h,Y,M,n,j,N,P,F,H]}class or extends ut{constructor(e){super(),ct(this,e,lr,tr,ot,{})}}class nr{constructor(){Tl(this,"baseUrl");Tl(this,"autocompleteIndexBuilt",!1);Tl(this,"sessionId");this.baseUrl="http://localhost:8001",this.sessionId=`novel-${Date.now()}`}async buildAutocompleteIndex(){try{const e=await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:1,method:"tools/call",params:{name:"build_autocomplete_index",arguments:{}}})});if(e.ok){const t=await e.json();if(console.log("Build index response:",t),t.result&&!t.result.is_error)return this.autocompleteIndexBuilt=!0,console.log("Novel autocomplete index built successfully"),!0}return console.warn("Failed to build Novel autocomplete index"),!1}catch(e){return console.error("Error building Novel autocomplete index:",e),!1}}async getCompletion(e){if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return{text:""};try{const t=this.extractLastWord(e.prompt);if(!t||t.length<2)return{text:""};const o=await this.getSuggestionsWithSnippets(t,5);if(o.length===0)return{text:""};const u=o[0].text,s=e.prompt.length/4,c=u.length/4;return{text:u,usage:{promptTokens:Math.round(s),completionTokens:Math.round(c),totalTokens:Math.round(s+c)}}}catch(t){return console.error("Error getting Novel autocomplete completion:",t),{text:""}}}async getSuggestions(e,t=10){if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return[];try{const o=await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:1,method:"tools/call",params:{name:"autocomplete_terms",arguments:{query:e,limit:t}}})});if(o.ok){const n=await o.json();if(console.log("Get suggestions response:",n),n.result&&!n.result.is_error&&n.result.content)return this.parseAutocompleteContent(n.result.content)}return[]}catch(o){return console.error("Error getting autocomplete suggestions:",o),[]}}async getSuggestionsWithSnippets(e,t=10){if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return[];try{const o=await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:1,method:"tools/call",params:{name:"autocomplete_with_snippets",arguments:{query:e,limit:t}}})});if(o.ok){const n=await o.json();if(console.log("Get suggestions with snippets response:",n),n.result&&!n.result.is_error&&n.result.content)return this.parseAutocompleteWithSnippetsContent(n.result.content)}return[]}catch(o){return console.error("Error getting autocomplete suggestions with snippets:",o),[]}}extractLastWord(e){const t=e.trim().split(/\s+/);return t[t.length-1]||""}parseAutocompleteContent(e){const t=[];for(const o of e)if(o.type==="text"&&o.text){if(!o.text.startsWith("Found")&&!o.text.startsWith("â€¢"))t.push({text:o.text.trim()});else if(o.text.startsWith("â€¢")){const n=o.text.replace("â€¢","").trim();n&&t.push({text:n})}}return t}parseAutocompleteWithSnippetsContent(e){const t=[];for(const o of e)if(o.type==="text"&&o.text){if(!o.text.startsWith("Found")&&!o.text.startsWith("â€¢")){const n=o.text.split(" â€” ");n.length===2?t.push({text:n[0].trim(),snippet:n[1].trim()}):t.push({text:o.text.trim()})}else if(o.text.startsWith("â€¢")){const n=o.text.replace("â€¢","").trim();n&&t.push({text:n})}}return t}isReady(){return this.autocompleteIndexBuilt}getStatus(){return{ready:this.autocompleteIndexBuilt,baseUrl:this.baseUrl,sessionId:this.sessionId}}}const El=new nr;function ho(l){let e,t,o,n,u,s,c,i,p,d,_,m,k,v,w,h,A,$,b,O,Y,M,j,N,P,F,H,R,C;function W(Z,y){return Z[3]?rr:sr}let L=W(l),U=L(l),Q=l[6].length>0&&go(),K=l[6].length>0&&bo(l);return{c(){e=f("div"),t=f("div"),o=f("strong"),o.textContent="Local Autocomplete Status:",n=g(),u=f("div"),s=f("button"),c=q("Test"),p=g(),d=f("button"),d.textContent="Rebuild Index",_=g(),m=f("button"),k=q("Demo"),w=g(),h=f("div"),A=q(l[4]),$=g(),b=f("div"),O=f("strong"),O.textContent="Features:",Y=g(),U.c(),M=g(),j=f("br"),N=q(`â€¢ Type at least 2 characters to trigger
      `),P=f("br"),F=q(`â€¢ Uses role-based knowledge graph for suggestions
      `),Q&&Q.c(),H=g(),K&&K.c(),pe(o,"color","#495057"),pe(s,"padding","4px 8px"),pe(s,"background","#007bff"),pe(s,"color","white"),pe(s,"border","none"),pe(s,"border-radius","4px"),pe(s,"cursor","pointer"),pe(s,"font-size","12px"),s.disabled=i=!l[5],pe(d,"padding","4px 8px"),pe(d,"background","#28a745"),pe(d,"color","white"),pe(d,"border","none"),pe(d,"border-radius","4px"),pe(d,"cursor","pointer"),pe(d,"font-size","12px"),pe(m,"padding","4px 8px"),pe(m,"background","#ffc107"),pe(m,"color","#212529"),pe(m,"border","none"),pe(m,"border-radius","4px"),pe(m,"cursor","pointer"),pe(m,"font-size","12px"),m.disabled=v=!l[5],pe(u,"display","flex"),pe(u,"gap","8px"),pe(t,"display","flex"),pe(t,"justify-content","space-between"),pe(t,"align-items","center"),pe(t,"margin-bottom","8px"),pe(h,"font-size","13px"),pe(h,"color","#6c757d"),pe(h,"margin-bottom","8px"),pe(b,"font-size","12px"),pe(b,"color","#6c757d"),pe(e,"margin-top","10px"),pe(e,"padding","12px"),pe(e,"background","#f8f9fa"),pe(e,"border-radius","6px"),pe(e,"border","1px solid #e9ecef")},m(Z,y){T(Z,e,y),r(e,t),r(t,o),r(t,n),r(t,u),r(u,s),r(s,c),r(u,p),r(u,d),r(u,_),r(u,m),r(m,k),r(e,w),r(e,h),r(h,A),r(e,$),r(e,b),r(b,O),r(b,Y),U.m(b,null),r(b,M),r(b,j),r(b,N),r(b,P),r(b,F),Q&&Q.m(b,null),r(e,H),K&&K.m(e,null),R||(C=[X(s,"click",l[8]),X(d,"click",l[9]),X(m,"click",l[10])],R=!0)},p(Z,y){y&32&&i!==(i=!Z[5])&&(s.disabled=i),y&32&&v!==(v=!Z[5])&&(m.disabled=v),y&16&&ge(A,Z[4]),L!==(L=W(Z))&&(U.d(1),U=L(Z),U&&(U.c(),U.m(b,M))),Z[6].length>0?Q||(Q=go(),Q.c(),Q.m(b,null)):Q&&(Q.d(1),Q=null),Z[6].length>0?K?K.p(Z,y):(K=bo(Z),K.c(),K.m(e,null)):K&&(K.d(1),K=null)},d(Z){Z&&S(e),U.d(),Q&&Q.d(),K&&K.d(),R=!1,Ke(C)}}}function sr(l){let e,t;return{c(){e=f("br"),t=q("â€¢ Local autocomplete from MCP server")},m(o,n){T(o,e,n),T(o,t,n)},d(o){o&&S(e),o&&S(t)}}}function rr(l){let e,t;return{c(){e=f("br"),t=q("â€¢ Local autocomplete with snippets from MCP server")},m(o,n){T(o,e,n),T(o,t,n)},d(o){o&&S(e),o&&S(t)}}}function go(l){let e,t,o,n;return{c(){e=f("br"),t=q("â€¢ "),o=f("strong"),o.textContent="Demo Mode:",n=q(" Using mock suggestions for demonstration")},m(u,s){T(u,e,s),T(u,t,s),T(u,o,s),T(u,n,s)},d(u){u&&S(e),u&&S(t),u&&S(o),u&&S(n)}}}function bo(l){let e,t,o,n,u=l[6].slice(0,6).join(" â€¢ ")+"",s,c,i=l[6].length>6&&vo(l);return{c(){e=f("div"),t=f("strong"),t.textContent="ðŸŽ¯ Mock Autocomplete Suggestions:",o=g(),n=f("div"),s=q(u),c=g(),i&&i.c(),pe(n,"font-size","11px"),pe(n,"margin-top","4px"),pe(e,"margin-top","8px"),pe(e,"padding","8px"),pe(e,"background","#fff3cd"),pe(e,"border","1px solid #ffeaa7"),pe(e,"border-radius","4px")},m(p,d){T(p,e,d),r(e,t),r(e,o),r(e,n),r(n,s),r(n,c),i&&i.m(n,null)},p(p,d){d&64&&u!==(u=p[6].slice(0,6).join(" â€¢ ")+"")&&ge(s,u),p[6].length>6?i?i.p(p,d):(i=vo(p),i.c(),i.m(n,null)):i&&(i.d(1),i=null)},d(p){p&&S(e),i&&i.d()}}}function vo(l){let e,t,o=l[6].length-6+"",n,u;return{c(){e=f("br"),t=q("... and "),n=q(o),u=q(" more")},m(s,c){T(s,e,c),T(s,t,c),T(s,n,c),T(s,u,c)},p(s,c){c&64&&o!==(o=s[6].length-6+"")&&ge(n,o)},d(s){s&&S(e),s&&S(t),s&&S(n),s&&S(u)}}}function ir(l){let e,t,o,n;e=new ys({props:{defaultValue:l[0],isEditable:!l[1],disableLocalStorage:!0,onUpdate:l[7],extensions:[bs]}});let u=l[2]&&ho(l);return{c(){re(e.$$.fragment),t=g(),u&&u.c(),o=nt()},m(s,c){ie(e,s,c),T(s,t,c),u&&u.m(s,c),T(s,o,c),n=!0},p(s,[c]){const i={};c&1&&(i.defaultValue=s[0]),c&2&&(i.isEditable=!s[1]),e.$set(i),s[2]?u?u.p(s,c):(u=ho(s),u.c(),u.m(o.parentNode,o)):u&&(u.d(1),u=null)},i(s){n||(G(e.$$.fragment,s),n=!0)},o(s){J(e.$$.fragment,s),n=!1},d(s){ae(e,s),s&&S(t),u&&u.d(s),s&&S(o)}}}function ar(l,e,t){let{html:o=""}=e,{readOnly:n=!1}=e,{outputFormat:u="html"}=e,{enableAutocomplete:s=!0}=e,{showSnippets:c=!0}=e,i=null,p="â³ Initializing...",d=!1,_=[];Kt(async()=>{if(s)try{await El.buildAutocompleteIndex()?(t(4,p="âœ… Ready - Type to trigger autocomplete"),t(5,d=!0)):(t(4,p="âš ï¸ Using mock autocomplete (MCP server not responding)"),t(5,d=!0),t(6,_=["terraphim-graph","terraphim-automata","terraphim-service","terraphim-types","terraphim-config","knowledge-graph","role-based-search","haystack-integration","atomic-server","mcp-protocol"]))}catch(h){console.error("Error initializing autocomplete:",h),t(4,p="âš ï¸ Using mock autocomplete (MCP server error)"),t(5,d=!0),t(6,_=["terraphim-graph","terraphim-automata","terraphim-service","terraphim-types","terraphim-config","knowledge-graph","role-based-search","haystack-integration","atomic-server","mcp-protocol"])}});const m=h=>{i=h,u==="markdown"?t(0,o=h.storage.markdown.getMarkdown()):t(0,o=h.getHTML())},k=async()=>{if(d)try{if(_.length>0)console.log("Mock autocomplete suggestions:",_),alert(`Found ${_.length} mock suggestions:
${_.slice(0,5).join(`
`)}`);else{const h=await El.getSuggestions("terraphim",5);console.log("Autocomplete test results:",h),alert(`Found ${h.length} suggestions for 'terraphim'`)}}catch(h){console.error("Autocomplete test failed:",h),alert("Autocomplete test failed - check console for details")}else alert("Autocomplete service not ready yet")},v=async()=>{t(4,p="â³ Rebuilding index...");try{await El.buildAutocompleteIndex()?(t(4,p="âœ… Ready - Index rebuilt successfully"),t(5,d=!0)):(t(4,p="âš ï¸ Using mock autocomplete (MCP server not responding)"),t(5,d=!0))}catch(h){console.error("Error rebuilding index:",h),t(4,p="âš ï¸ Using mock autocomplete (MCP server error)"),t(5,d=!0)}},w=()=>{if(i&&_.length>0){const h=`# Terraphim Autocomplete Demo

This is a demonstration of how autocomplete would work in the Novel editor.

Try typing these terms to see autocomplete suggestions:
- terraphim
- graph
- service
- automata

The autocomplete system provides suggestions based on your knowledge graph and document content.`;i.commands.setContent(h),alert('Demo content inserted! Type "terraphim" or "graph" to see autocomplete suggestions.')}};return l.$$set=h=>{"html"in h&&t(0,o=h.html),"readOnly"in h&&t(1,n=h.readOnly),"outputFormat"in h&&t(11,u=h.outputFormat),"enableAutocomplete"in h&&t(2,s=h.enableAutocomplete),"showSnippets"in h&&t(3,c=h.showSnippets)},[o,n,s,c,p,d,_,m,k,v,w,u]}class ur extends ut{constructor(e){super(),ct(this,e,ar,ir,ot,{html:0,readOnly:1,outputFormat:11,enableAutocomplete:2,showSnippets:3})}}function ko(l){let e,t,o,n,u,s,c,i,p,d,_;return{c(){e=f("div"),t=f("h3"),o=f("span"),o.textContent="Knowledge Graph",n=q(`
          Term: `),u=f("strong"),s=q(l[2]),c=q(" | Rank: "),i=f("strong"),p=q(l[3]),d=g(),_=f("hr"),a(o,"class","tag is-info svelte-329px1"),a(t,"class","subtitle is-6 svelte-329px1"),a(_,"class","svelte-329px1"),a(e,"class","kg-context svelte-329px1")},m(m,k){T(m,e,k),r(e,t),r(t,o),r(t,n),r(t,u),r(u,s),r(t,c),r(t,i),r(i,p),r(e,d),r(e,_)},p(m,k){k&4&&ge(s,m[2]),k&8&&ge(p,m[3])},d(m){m&&S(e)}}}function cr(l){let e,t,o,n,u,s,c,i;const p=[dr,pr],d=[];function _(m,k){return m[5]?0:1}return t=_(l),o=d[t]=p[t](l),{c(){e=f("div"),o.c(),n=g(),u=f("div"),u.innerHTML='<span class="hint-text svelte-329px1">Double-click to edit â€¢ Ctrl+E to edit â€¢ Ctrl+S to save â€¢ Click KG links to explore</span>',a(u,"class","edit-hint svelte-329px1"),a(e,"class","content-viewer svelte-329px1"),a(e,"tabindex","0"),a(e,"role","button"),a(e,"aria-label","Double-click to edit article content")},m(m,k){T(m,e,k),d[t].m(e,null),r(e,n),r(e,u),l[20](e),s=!0,c||(i=[X(e,"dblclick",l[14]),X(e,"keydown",l[15]),X(e,"click",l[13])],c=!0)},p(m,k){let v=t;t=_(m),t===v?d[t].p(m,k):(je(),J(d[v],1,1,()=>{d[v]=null}),ze(),o=d[t],o?o.p(m,k):(o=d[t]=p[t](m),o.c()),G(o,1),o.m(e,n))},i(m){s||(G(o),s=!0)},o(m){J(o),s=!1},d(m){m&&S(e),d[t].d(),l[20](null),c=!1,Ke(i)}}}function fr(l){let e,t,o,n,u,s,c,i,p,d;function _(k){l[18](k)}let m={outputFormat:l[11]};return l[1].body!==void 0&&(m.html=l[1].body),e=new ur({props:m}),We.push(()=>Ye(e,"html",_)),{c(){re(e.$$.fragment),o=g(),n=f("div"),u=f("button"),u.textContent="Save",s=g(),c=f("button"),c.textContent="Cancel",a(u,"class","button is-primary"),a(c,"class","button is-light"),a(n,"class","edit-controls svelte-329px1")},m(k,v){ie(e,k,v),T(k,o,v),T(k,n,v),r(n,u),r(n,s),r(n,c),i=!0,p||(d=[X(u,"click",l[12]),X(c,"click",l[19])],p=!0)},p(k,v){const w={};v&2048&&(w.outputFormat=k[11]),!t&&v&2&&(t=!0,w.html=k[1].body,Qe(()=>t=!1)),e.$set(w)},i(k){i||(G(e.$$.fragment,k),i=!0)},o(k){J(e.$$.fragment,k),i=!1},d(k){ae(e,k),k&&S(o),k&&S(n),p=!1,Ke(d)}}}function pr(l){let e,t,o;return t=new Ol({props:{source:l[1].body}}),{c(){e=f("div"),re(t.$$.fragment),a(e,"class","markdown-content svelte-329px1")},m(n,u){T(n,e,u),ie(t,e,null),o=!0},p(n,u){const s={};u&2&&(s.source=n[1].body),t.$set(s)},i(n){o||(G(t.$$.fragment,n),o=!0)},o(n){J(t.$$.fragment,n),o=!1},d(n){n&&S(e),ae(t)}}}function dr(l){let e,t=l[1].body+"";return{c(){e=f("div"),a(e,"class","prose svelte-329px1")},m(o,n){T(o,e,n),e.innerHTML=t},p(o,n){n&2&&t!==(t=o[1].body+"")&&(e.innerHTML=t)},i:ye,o:ye,d(o){o&&S(e)}}}function _r(l){let e,t,o,n,u,s=l[1].title+"",c,i,p,d,_,m,k,v=l[2]&&l[3]!==null&&ko(l);const w=[fr,cr],h=[];function A($,b){return $[4]?0:1}return p=A(l),d=h[p]=w[p](l),{c(){e=f("div"),t=f("button"),o=g(),v&&v.c(),n=g(),u=f("h2"),c=q(s),i=g(),d.c(),a(t,"class","delete is-large modal-close-btn svelte-329px1"),a(t,"aria-label","close"),a(u,"class","svelte-329px1"),a(e,"class","box wrapper svelte-329px1")},m($,b){T($,e,b),r(e,t),r(e,o),v&&v.m(e,null),r(e,n),r(e,u),r(u,c),r(e,i),h[p].m(e,null),_=!0,m||(k=X(t,"click",l[17]),m=!0)},p($,b){$[2]&&$[3]!==null?v?v.p($,b):(v=ko($),v.c(),v.m(e,n)):v&&(v.d(1),v=null),(!_||b&2)&&s!==(s=$[1].title+"")&&ge(c,s);let O=p;p=A($),p===O?h[p].p($,b):(je(),J(h[O],1,1,()=>{h[O]=null}),ze(),d=h[p],d?d.p($,b):(d=h[p]=w[p]($),d.c()),G(d,1),d.m(e,null))},i($){_||(G(d),_=!0)},o($){J(d),_=!1},d($){$&&S(e),v&&v.d(),h[p].d(),m=!1,k()}}}function wo(l){let e,t,o;function n(s){l[23](s)}let u={$$slots:{default:[gr]},$$scope:{ctx:l}};return l[7]!==void 0&&(u.active=l[7]),e=new Il({props:u}),We.push(()=>Ye(e,"active",n)),{c(){re(e.$$.fragment)},m(s,c){ie(e,s,c),o=!0},p(s,c){const i={};c&536872832&&(i.$$scope={dirty:c,ctx:s}),!t&&c&128&&(t=!0,i.active=s[7],Qe(()=>t=!1)),e.$set(i)},i(s){o||(G(e.$$.fragment,s),o=!0)},o(s){J(e.$$.fragment,s),o=!1},d(s){ae(e,s)}}}function $o(l){let e,t,o,n,u,s,c,i,p,d,_;return{c(){e=f("div"),t=f("h3"),o=f("span"),o.textContent="Knowledge Graph",n=q(`
            Term: `),u=f("strong"),s=q(l[9]),c=q(" | Rank: "),i=f("strong"),p=q(l[10]),d=g(),_=f("hr"),a(o,"class","tag is-info svelte-329px1"),a(t,"class","subtitle is-6 svelte-329px1"),a(_,"class","svelte-329px1"),a(e,"class","kg-context svelte-329px1")},m(m,k){T(m,e,k),r(e,t),r(t,o),r(t,n),r(t,u),r(u,s),r(t,c),r(t,i),r(i,p),r(e,d),r(e,_)},p(m,k){k&512&&ge(s,m[9]),k&1024&&ge(p,m[10])},d(m){m&&S(e)}}}function mr(l){let e,t,o;return t=new Ol({props:{source:l[8].body}}),{c(){e=f("div"),re(t.$$.fragment),a(e,"class","markdown-content svelte-329px1")},m(n,u){T(n,e,u),ie(t,e,null),o=!0},p(n,u){const s={};u&256&&(s.source=n[8].body),t.$set(s)},i(n){o||(G(t.$$.fragment,n),o=!0)},o(n){J(t.$$.fragment,n),o=!1},d(n){n&&S(e),ae(t)}}}function hr(l){let e,t=l[8].body+"";return{c(){e=f("div"),a(e,"class","prose svelte-329px1")},m(o,n){T(o,e,n),e.innerHTML=t},p(o,n){n&256&&t!==(t=o[8].body+"")&&(e.innerHTML=t)},i:ye,o:ye,d(o){o&&S(e)}}}function gr(l){let e,t,o,n,u,s=l[8].title+"",c,i,p,d,_,m,k,v,w,h,A,$=l[9]&&l[10]!==null&&$o(l);const b=[hr,mr],O=[];function Y(M,j){return j&256&&(d=null),d==null&&(d=!!(M[8].body&&(/<html/i.test(M[8].body)||/<body/i.test(M[8].body)||/<head/i.test(M[8].body)))),d?0:1}return _=Y(l,-1),m=O[_]=b[_](l),{c(){e=f("div"),t=f("button"),o=g(),$&&$.c(),n=g(),u=f("h2"),c=q(s),i=g(),p=f("div"),m.c(),k=g(),v=f("div"),v.innerHTML='<span class="hint-text svelte-329px1">Knowledge Graph document â€¢ Click KG links to explore further</span>',a(t,"class","delete is-large modal-close-btn svelte-329px1"),a(t,"aria-label","close"),a(u,"class","svelte-329px1"),a(v,"class","edit-hint svelte-329px1"),a(p,"class","content-viewer svelte-329px1"),a(p,"tabindex","0"),a(p,"role","button"),a(p,"aria-label","KG document content - click KG links to explore further"),a(e,"class","box wrapper svelte-329px1")},m(M,j){T(M,e,j),r(e,t),r(e,o),$&&$.m(e,null),r(e,n),r(e,u),r(u,c),r(e,i),r(e,p),O[_].m(p,null),r(p,k),r(p,v),w=!0,h||(A=[X(t,"click",l[22]),X(p,"click",l[13])],h=!0)},p(M,j){M[9]&&M[10]!==null?$?$.p(M,j):($=$o(M),$.c(),$.m(e,n)):$&&($.d(1),$=null),(!w||j&256)&&s!==(s=M[8].title+"")&&ge(c,s);let N=_;_=Y(M,j),_===N?O[_].p(M,j):(je(),J(O[N],1,1,()=>{O[N]=null}),ze(),m=O[_],m?m.p(M,j):(m=O[_]=b[_](M),m.c()),G(m,1),m.m(p,k))},i(M){w||(G(m),w=!0)},o(M){J(m),w=!1},d(M){M&&S(e),$&&$.d(),O[_].d(),h=!1,Ke(A)}}}function br(l){let e,t,o,n,u;function s(p){l[21](p)}let c={$$slots:{default:[_r]},$$scope:{ctx:l}};l[0]!==void 0&&(c.active=l[0]),e=new Il({props:c}),We.push(()=>Ye(e,"active",s));let i=l[8]&&wo(l);return{c(){re(e.$$.fragment),o=g(),i&&i.c(),n=nt()},m(p,d){ie(e,p,d),T(p,o,d),i&&i.m(p,d),T(p,n,d),u=!0},p(p,[d]){const _={};d&536873087&&(_.$$scope={dirty:d,ctx:p}),!t&&d&1&&(t=!0,_.active=p[0],Qe(()=>t=!1)),e.$set(_),p[8]?i?(i.p(p,d),d&256&&G(i,1)):(i=wo(p),i.c(),G(i,1),i.m(n.parentNode,n)):i&&(je(),J(i,1,1,()=>{i=null}),ze())},i(p){u||(G(e.$$.fragment,p),G(i),u=!0)},o(p){J(e.$$.fragment,p),J(i),u=!1},d(p){ae(e,p),p&&S(o),i&&i.d(p),p&&S(n)}}}function vr(l,e,t){let o,n,u,s;Re(l,Ve,L=>t(25,u=L)),Re(l,Rt,L=>t(26,s=L));let{active:c=!1}=e,{item:i}=e,{initialEdit:p=!1}=e,{kgTerm:d=null}=e,{kgRank:_=null}=e,m=!1,k,v=!1,w=null,h=null,A=null;async function $(){if(u)try{const L=await Fe("get_document",{documentId:i.id});L!=null&&L.document&&t(1,i=L.document)}catch(L){console.error("Failed to load document",L)}}async function b(){if(!u){t(4,m=!1);return}try{await Fe("create_document",{document:i}),t(4,m=!1)}catch(L){console.error("Failed to save document",L)}}async function O(L){var U,Q,K,Z,y;t(9,h=L),console.log("ðŸ” KG Link Click Debug Info:"),console.log("  Term clicked:",L),console.log("  Current role:",s),console.log("  Is Tauri mode:",u);try{if(u){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:s,term:L});const E=await Fe("find_documents_for_kg_term",{roleName:s,term:L});console.log("  ðŸ“¥ Tauri response received:"),console.log("    Status:",E.status),console.log("    Results count:",((U=E.results)==null?void 0:U.length)||0),console.log("    Total:",E.total||0),console.log("    Full response:",JSON.stringify(E,null,2)),E.status==="success"&&E.results&&E.results.length>0?(t(8,w=E.results[0]),t(10,A=w.rank||0),console.log("  âœ… Found KG document:"),console.log("    Title:",w.title),console.log("    Rank:",A),console.log("    Body length:",((Q=w.body)==null?void 0:Q.length)||0,"characters"),t(7,v=!0)):(console.warn(`  âš ï¸  No KG documents found for term: "${L}" in role: "${s}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const E=at.ServerURL,z=encodeURIComponent(s),D=encodeURIComponent(L),V=`${E}/roles/${z}/kg_search?term=${D}`;console.log("  ðŸ“¤ HTTP Request details:"),console.log("    Base URL:",E),console.log("    Role (encoded):",z),console.log("    Term (encoded):",D),console.log("    Full URL:",V);const x=await fetch(V);if(console.log("  ðŸ“¥ HTTP Response received:"),console.log("    Status code:",x.status),console.log("    Status text:",x.statusText),console.log("    Headers:",Object.fromEntries(x.headers.entries())),!x.ok)throw new Error(`HTTP error! Status: ${x.status} - ${x.statusText}`);const oe=await x.json();console.log("  ðŸ“„ Response data:"),console.log("    Status:",oe.status),console.log("    Results count:",((K=oe.results)==null?void 0:K.length)||0),console.log("    Total:",oe.total||0),console.log("    Full response:",JSON.stringify(oe,null,2)),oe.status==="success"&&oe.results&&oe.results.length>0?(t(8,w=oe.results[0]),t(10,A=w.rank||0),console.log("  âœ… Found KG document:"),console.log("    Title:",w.title),console.log("    Rank:",A),console.log("    Body length:",((Z=w.body)==null?void 0:Z.length)||0,"characters"),t(7,v=!0)):(console.warn(`  âš ï¸  No KG documents found for term: "${L}" in role: "${s}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",V))}}catch(E){console.error("âŒ Error fetching KG document:"),console.error("  Error type:",E.constructor.name),console.error("  Error message:",E.message||E),console.error("  Request details:",{term:L,role:s,isTauri:u,timestamp:new Date().toISOString()}),!u&&((y=E.message)!=null&&y.includes("Failed to fetch"))&&(console.error("  ðŸ’¡ Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{}}function Y(L){const U=L.target;if(U.tagName==="A"){const Q=U.getAttribute("href");if(Q&&Q.startsWith("kg:")){L.preventDefault();const K=Q.substring(3);O(K)}}}function M(){t(4,m=!0)}function j(L){L.type!=="dblclick"&&((L.ctrlKey||L.metaKey)&&L.key==="e"&&(L.preventDefault(),t(4,m=!0)),m&&(L.ctrlKey||L.metaKey)&&L.key==="s"&&(L.preventDefault(),b()),L.key==="Escape"&&(L.preventDefault(),m?t(4,m=!1):t(0,c=!1)))}const N=()=>t(0,c=!1);function P(L){l.$$.not_equal(i.body,L)&&(i.body=L,t(1,i))}const F=()=>t(4,m=!1);function H(L){We[L?"unshift":"push"](()=>{k=L,t(6,k)})}function R(L){c=L,t(0,c)}const C=()=>t(7,v=!1);function W(L){v=L,t(7,v)}return l.$$set=L=>{"active"in L&&t(0,c=L.active),"item"in L&&t(1,i=L.item),"initialEdit"in L&&t(16,p=L.initialEdit),"kgTerm"in L&&t(2,d=L.kgTerm),"kgRank"in L&&t(3,_=L.kgRank)},l.$$.update=()=>{l.$$.dirty&65537&&c&&p&&t(4,m=!0),l.$$.dirty&19&&c&&i&&!m&&$(),l.$$.dirty&2&&t(5,o=i!=null&&i.body?/<html/i.test(i.body)||/<body/i.test(i.body)||/<head/i.test(i.body)||/^\s*<(!DOCTYPE|html|head|body|div|p|span)/i.test(i.body.trim()):!1),l.$$.dirty&32&&t(11,n=o?"html":"markdown")},[c,i,d,_,m,o,k,v,w,h,A,n,b,Y,M,j,p,N,P,F,H,R,C,W]}class zl extends ut{constructor(e){super(),ct(this,e,vr,br,ot,{active:0,item:1,initialEdit:16,kgTerm:2,kgRank:3})}}function yo(l,e,t){const o=l.slice();return o[33]=e[t],o}function Co(l,e,t){const o=l.slice();return o[36]=e[t],o}function So(l,e,t){const o=l.slice();return o[39]=e[t],o}function To(l){let e,t;return e=new Kn({props:{type:"is-success",$$slots:{default:[kr]},$$scope:{ctx:l}}}),{c(){re(e.$$.fragment)},m(o,n){ie(e,o,n),t=!0},i(o){t||(G(e.$$.fragment,o),t=!0)},o(o){J(e.$$.fragment,o),t=!1},d(o){ae(e,o)}}}function kr(l){let e,t,o;return{c(){e=f("p"),e.innerHTML="<strong>Success!</strong> Article saved to atomic server successfully.",t=g(),o=f("p"),o.textContent="The modal will close automatically..."},m(n,u){T(n,e,u),T(n,t,u),T(n,o,u)},p:ye,d(n){n&&S(e),n&&S(t),n&&S(o)}}}function Ro(l){let e,t;return e=new Kn({props:{type:"is-danger",$$slots:{default:[wr]},$$scope:{ctx:l}}}),{c(){re(e.$$.fragment)},m(o,n){ie(e,o,n),t=!0},p(o,n){const u={};n[0]&8|n[1]&2048&&(u.$$scope={dirty:n,ctx:o}),e.$set(u)},i(o){t||(G(e.$$.fragment,o),t=!0)},o(o){J(e.$$.fragment,o),t=!1},d(o){ae(e,o)}}}function wr(l){let e,t,o,n;return{c(){e=f("p"),t=f("strong"),t.textContent="Error:",o=g(),n=q(l[3])},m(u,s){T(u,e,s),r(e,t),r(e,o),r(e,n)},p(u,s){s[0]&8&&ge(n,u[3])},d(u){u&&S(e)}}}function Ao(l){var W,L,U,Q;let e,t,o,n,u,s=(((W=l[1])==null?void 0:W.title)||"Untitled")+"",c,i,p,d,_,m,k=(((L=l[1])==null?void 0:L.rank)||0)+"",v,w,h,A,$,b,O,Y,M,j,N=((U=l[1])==null?void 0:U.description)&&Lo(l),P=((Q=l[1])==null?void 0:Q.tags)&&No(l);function F(K,Z){return K[10].length>0?yr:$r}let H=F(l),R=H(l),C=l[10].length>0&&Po(l);return{c(){e=f("div"),t=f("label"),t.textContent="Document to Save",o=g(),n=f("div"),u=f("h5"),c=q(s),i=g(),N&&N.c(),p=g(),d=f("div"),_=f("span"),m=q("Rank: "),v=q(k),w=g(),P&&P.c(),h=g(),A=f("div"),$=f("label"),$.textContent="Atomic Server",b=g(),O=f("div"),R.c(),Y=g(),C&&C.c(),M=nt(),a(t,"class","label"),a(u,"class","title is-6"),a(_,"class","tag is-info svelte-48g63o"),a(d,"class","tags svelte-48g63o"),a(n,"class","box document-preview svelte-48g63o"),a(e,"class","field"),a($,"class","label"),a($,"for","atomic-server-select"),a(O,"class","control"),a(A,"class","field")},m(K,Z){T(K,e,Z),r(e,t),r(e,o),r(e,n),r(n,u),r(u,c),r(n,i),N&&N.m(n,null),r(n,p),r(n,d),r(d,_),r(_,m),r(_,v),r(d,w),P&&P.m(d,null),T(K,h,Z),T(K,A,Z),r(A,$),r(A,b),r(A,O),R.m(O,null),T(K,Y,Z),C&&C.m(K,Z),T(K,M,Z),j=!0},p(K,Z){var y,E,z,D;(!j||Z[0]&2)&&s!==(s=(((y=K[1])==null?void 0:y.title)||"Untitled")+"")&&ge(c,s),(E=K[1])!=null&&E.description?N?N.p(K,Z):(N=Lo(K),N.c(),N.m(n,p)):N&&(N.d(1),N=null),(!j||Z[0]&2)&&k!==(k=(((z=K[1])==null?void 0:z.rank)||0)+"")&&ge(v,k),(D=K[1])!=null&&D.tags?P?P.p(K,Z):(P=No(K),P.c(),P.m(d,null)):P&&(P.d(1),P=null),H===(H=F(K))&&R?R.p(K,Z):(R.d(1),R=H(K),R&&(R.c(),R.m(O,null))),K[10].length>0?C?(C.p(K,Z),Z[0]&1024&&G(C,1)):(C=Po(K),C.c(),G(C,1),C.m(M.parentNode,M)):C&&(je(),J(C,1,1,()=>{C=null}),ze())},i(K){j||(G(C),j=!0)},o(K){J(C),j=!1},d(K){K&&S(e),N&&N.d(),P&&P.d(),K&&S(h),K&&S(A),R.d(),K&&S(Y),C&&C.d(K),K&&S(M)}}}function Lo(l){let e,t=l[1].description+"",o;return{c(){e=f("p"),o=q(t),a(e,"class","content")},m(n,u){T(n,e,u),r(e,o)},p(n,u){u[0]&2&&t!==(t=n[1].description+"")&&ge(o,t)},d(n){n&&S(e)}}}function No(l){let e,t=l[1].tags,o=[];for(let n=0;n<t.length;n+=1)o[n]=Oo(So(l,t,n));return{c(){for(let n=0;n<o.length;n+=1)o[n].c();e=nt()},m(n,u){for(let s=0;s<o.length;s+=1)o[s]&&o[s].m(n,u);T(n,e,u)},p(n,u){if(u[0]&2){t=n[1].tags;let s;for(s=0;s<t.length;s+=1){const c=So(n,t,s);o[s]?o[s].p(c,u):(o[s]=Oo(c),o[s].c(),o[s].m(e.parentNode,e))}for(;s<o.length;s+=1)o[s].d(1);o.length=t.length}},d(n){Ge(o,n),n&&S(e)}}}function Oo(l){let e,t=l[39]+"",o;return{c(){e=f("span"),o=q(t),a(e,"class","tag svelte-48g63o")},m(n,u){T(n,e,u),r(e,o)},p(n,u){u[0]&2&&t!==(t=n[39]+"")&&ge(o,t)},d(n){n&&S(e)}}}function $r(l){let e,t,o,n,u,s,c,i,p;return{c(){e=f("div"),t=f("p"),t.innerHTML="<strong>No atomic servers available</strong>",o=g(),n=f("p"),u=q('Your current role "'),s=q(l[12]),c=q(`" doesn't have any writable atomic server configurations.`),i=g(),p=f("p"),p.textContent="Please configure an atomic server haystack in your role settings.",a(e,"class","notification is-warning")},m(d,_){T(d,e,_),r(e,t),r(e,o),r(e,n),r(n,u),r(n,s),r(n,c),r(e,i),r(e,p)},p(d,_){_[0]&4096&&ge(s,d[12])},d(d){d&&S(e)}}}function yr(l){let e,t,o,n,u,s,c=l[10],i=[];for(let p=0;p<c.length;p+=1)i[p]=Uo(Co(l,c,p));return{c(){e=f("div"),t=f("select");for(let p=0;p<i.length;p+=1)i[p].c();o=g(),n=f("p"),n.textContent=`Select the atomic server from your current role configuration.
              ðŸ” = Authenticated, âš ï¸ = Anonymous access`,a(t,"id","atomic-server-select"),t.disabled=l[2],l[11]===void 0&&lt(()=>l[18].call(t)),a(e,"class","select is-fullwidth"),a(n,"class","help svelte-48g63o")},m(p,d){T(p,e,d),r(e,t);for(let _=0;_<i.length;_+=1)i[_]&&i[_].m(t,null);Ue(t,l[11],!0),T(p,o,d),T(p,n,d),u||(s=X(t,"change",l[18]),u=!0)},p(p,d){if(d[0]&1024){c=p[10];let _;for(_=0;_<c.length;_+=1){const m=Co(p,c,_);i[_]?i[_].p(m,d):(i[_]=Uo(m),i[_].c(),i[_].m(t,null))}for(;_<i.length;_+=1)i[_].d(1);i.length=c.length}d[0]&4&&(t.disabled=p[2]),d[0]&3072&&Ue(t,p[11])},d(p){p&&S(e),Ge(i,p),p&&S(o),p&&S(n),u=!1,s()}}}function Cr(l){let e;return{c(){e=f("span"),e.textContent="âš ï¸ No Auth",a(e,"class","has-text-warning")},m(t,o){T(t,e,o)},d(t){t&&S(e)}}}function Sr(l){let e;return{c(){e=f("span"),e.textContent="ðŸ”",a(e,"class","has-text-success")},m(t,o){T(t,e,o)},d(t){t&&S(e)}}}function Uo(l){let e,t=l[36].location+"",o,n,u,s;function c(d,_){return d[36].atomic_server_secret?Sr:Cr}let i=c(l),p=i(l);return{c(){e=f("option"),o=q(t),n=g(),p.c(),u=g(),e.__value=s=l[36].location,e.value=e.__value},m(d,_){T(d,e,_),r(e,o),r(e,n),p.m(e,null),r(e,u)},p(d,_){_[0]&1024&&t!==(t=d[36].location+"")&&ge(o,t),i!==(i=c(d))&&(p.d(1),p=i(d),p&&(p.c(),p.m(e,u))),_[0]&1024&&s!==(s=d[36].location)&&(e.__value=s,e.value=e.__value)},d(d){d&&S(e),p.d()}}}function Po(l){var I,te;let e,t,o,n,u,s,c,i,p,d,_,m,k,v,w,h,A,$,b,O,Y,M,j,N,P,F,H,R,C,W,L,U,Q,K,Z,y,E,z,D,V,x,oe,ke,be=(l[8]||"Untitled")+"",De,_e,ce,ue,Le,Ae=(((te=(I=l[1])==null?void 0:I.body)==null?void 0:te.length)||0)+"",le,he,se,ve,Ze,Se,Ne=l[14]()+"",ee,we,Me,_t,Be,Pe=l[15]()+"",yt,qe,Et,Ct,Nt;function Xe(B){l[19](B)}let bt={id:"article-title",placeholder:"Enter article title",disabled:l[2],required:!0};l[8]!==void 0&&(bt.value=l[8]),u=new Bt({props:bt}),We.push(()=>Ye(u,"value",Xe));const vt=[Rr,Tr],Je=[];function Dt(B,ne){return B[7]?1:0}return F=Dt(l),H=Je[F]=vt[F](l),L=new Ll({props:{type:"is-primary",loading:l[2],disabled:l[2]||!l[8].trim()||!l[11],$$slots:{default:[Ar]},$$scope:{ctx:l}}}),L.$on("click",l[16]),K=new Ll({props:{type:"is-light",disabled:l[2],$$slots:{default:[Lr]},$$scope:{ctx:l}}}),K.$on("click",l[17]),Et=fs(l[22][0]),{c(){e=f("div"),t=f("label"),t.textContent="Article Title",o=g(),n=f("div"),re(u.$$.fragment),c=g(),i=f("div"),p=f("label"),p.textContent="Description",d=g(),_=f("div"),m=f("textarea"),k=g(),v=f("div"),w=f("label"),w.textContent="Parent Collection",h=g(),A=f("div"),$=f("label"),b=f("input"),O=q(`
              Use predefined collection`),Y=g(),M=f("label"),j=f("input"),N=q(`
              Custom parent URL/path`),P=g(),H.c(),R=g(),C=f("div"),W=f("div"),re(L.$$.fragment),U=g(),Q=f("div"),re(K.$$.fragment),Z=g(),y=f("div"),E=f("div"),z=f("p"),z.innerHTML="<strong>What will be saved:</strong>",D=g(),V=f("ul"),x=f("li"),oe=f("strong"),oe.textContent="Title:",ke=g(),De=q(be),_e=g(),ce=f("li"),ue=f("strong"),ue.textContent="Body:",Le=q(" Original document content ("),le=q(Ae),he=q(" characters)"),se=g(),ve=f("li"),Ze=f("strong"),Ze.textContent="Parent:",Se=g(),ee=q(Ne),we=g(),Me=f("li"),_t=f("strong"),_t.textContent="Subject URL:",Be=g(),yt=q(Pe),a(t,"class","label"),a(t,"for","article-title"),a(n,"class","control"),a(e,"class","field"),a(p,"class","label"),a(p,"for","article-description"),a(m,"id","article-description"),a(m,"class","textarea"),a(m,"placeholder","Brief description of the article"),m.disabled=l[2],a(m,"rows","3"),a(_,"class","control"),a(i,"class","field"),a(w,"class","label"),a(b,"type","radio"),b.__value=!1,b.value=b.__value,b.disabled=l[2],a($,"class","radio svelte-48g63o"),a(j,"type","radio"),j.__value=!0,j.value=j.__value,j.disabled=l[2],a(M,"class","radio svelte-48g63o"),a(A,"class","control"),a(v,"class","field"),a(W,"class","control"),a(Q,"class","control"),a(C,"class","field is-grouped"),a(x,"class","svelte-48g63o"),a(ce,"class","svelte-48g63o"),a(ve,"class","svelte-48g63o"),a(Me,"class","svelte-48g63o"),a(V,"class","svelte-48g63o"),a(E,"class","notification is-info is-light svelte-48g63o"),a(y,"class","field"),Et.p(b,j)},m(B,ne){T(B,e,ne),r(e,t),r(e,o),r(e,n),ie(u,n,null),T(B,c,ne),T(B,i,ne),r(i,p),r(i,d),r(i,_),r(_,m),Ce(m,l[9]),T(B,k,ne),T(B,v,ne),r(v,w),r(v,h),r(v,A),r(A,$),r($,b),b.checked=b.__value===l[7],r($,O),r(A,Y),r(A,M),r(M,j),j.checked=j.__value===l[7],r(M,N),T(B,P,ne),Je[F].m(B,ne),T(B,R,ne),T(B,C,ne),r(C,W),ie(L,W,null),r(C,U),r(C,Q),ie(K,Q,null),T(B,Z,ne),T(B,y,ne),r(y,E),r(E,z),r(E,D),r(E,V),r(V,x),r(x,oe),r(x,ke),r(x,De),r(V,_e),r(V,ce),r(ce,ue),r(ce,Le),r(ce,le),r(ce,he),r(V,se),r(V,ve),r(ve,Ze),r(ve,Se),r(ve,ee),r(V,we),r(V,Me),r(Me,_t),r(Me,Be),r(Me,yt),qe=!0,Ct||(Nt=[X(m,"input",l[20]),X(b,"change",l[21]),X(j,"change",l[23])],Ct=!0)},p(B,ne){var Te,Ie;const de={};ne[0]&4&&(de.disabled=B[2]),!s&&ne[0]&256&&(s=!0,de.value=B[8],Qe(()=>s=!1)),u.$set(de),(!qe||ne[0]&4)&&(m.disabled=B[2]),ne[0]&512&&Ce(m,B[9]),(!qe||ne[0]&4)&&(b.disabled=B[2]),ne[0]&128&&(b.checked=b.__value===B[7]),(!qe||ne[0]&4)&&(j.disabled=B[2]),ne[0]&128&&(j.checked=j.__value===B[7]);let fe=F;F=Dt(B),F===fe?Je[F].p(B,ne):(je(),J(Je[fe],1,1,()=>{Je[fe]=null}),ze(),H=Je[F],H?H.p(B,ne):(H=Je[F]=vt[F](B),H.c()),G(H,1),H.m(R.parentNode,R));const Ee={};ne[0]&4&&(Ee.loading=B[2]),ne[0]&2308&&(Ee.disabled=B[2]||!B[8].trim()||!B[11]),ne[1]&2048&&(Ee.$$scope={dirty:ne,ctx:B}),L.$set(Ee);const He={};ne[0]&4&&(He.disabled=B[2]),ne[1]&2048&&(He.$$scope={dirty:ne,ctx:B}),K.$set(He),(!qe||ne[0]&256)&&be!==(be=(B[8]||"Untitled")+"")&&ge(De,be),(!qe||ne[0]&2)&&Ae!==(Ae=(((Ie=(Te=B[1])==null?void 0:Te.body)==null?void 0:Ie.length)||0)+"")&&ge(le,Ae)},i(B){qe||(G(u.$$.fragment,B),G(H),G(L.$$.fragment,B),G(K.$$.fragment,B),qe=!0)},o(B){J(u.$$.fragment,B),J(H),J(L.$$.fragment,B),J(K.$$.fragment,B),qe=!1},d(B){B&&S(e),ae(u),B&&S(c),B&&S(i),B&&S(k),B&&S(v),B&&S(P),Je[F].d(B),B&&S(R),B&&S(C),ae(L),ae(K),B&&S(Z),B&&S(y),Et.r(),Ct=!1,Ke(Nt)}}}function Tr(l){let e,t,o,n,u,s,c;function i(d){l[25](d)}let p={placeholder:"e.g., my-collection or http://server/custom-parent",disabled:l[2]};return l[6]!==void 0&&(p.value=l[6]),o=new Bt({props:p}),We.push(()=>Ye(o,"value",i)),{c(){e=f("div"),t=f("div"),re(o.$$.fragment),u=g(),s=f("p"),s.textContent=`Enter a collection name (e.g., "my-articles") or full URL.
              If the collection doesn't exist, it will be created.`,a(t,"class","control"),a(s,"class","help svelte-48g63o"),a(e,"class","field")},m(d,_){T(d,e,_),r(e,t),ie(o,t,null),r(e,u),r(e,s),c=!0},p(d,_){const m={};_[0]&4&&(m.disabled=d[2]),!n&&_[0]&64&&(n=!0,m.value=d[6],Qe(()=>n=!1)),o.$set(m)},i(d){c||(G(o.$$.fragment,d),c=!0)},o(d){J(o.$$.fragment,d),c=!1},d(d){d&&S(e),ae(o)}}}function Rr(l){let e,t,o,n,u,s,c=l[13],i=[];for(let p=0;p<c.length;p+=1)i[p]=Eo(yo(l,c,p));return{c(){e=f("div"),t=f("div"),o=f("div"),n=f("select");for(let p=0;p<i.length;p+=1)i[p].c();n.disabled=l[2],l[5]===void 0&&lt(()=>l[24].call(n)),a(o,"class","select is-fullwidth"),a(t,"class","control"),a(e,"class","field")},m(p,d){T(p,e,d),r(e,t),r(t,o),r(o,n);for(let _=0;_<i.length;_+=1)i[_]&&i[_].m(n,null);Ue(n,l[5],!0),u||(s=X(n,"change",l[24]),u=!0)},p(p,d){if(d[0]&8192){c=p[13];let _;for(_=0;_<c.length;_+=1){const m=yo(p,c,_);i[_]?i[_].p(m,d):(i[_]=Eo(m),i[_].c(),i[_].m(n,null))}for(;_<i.length;_+=1)i[_].d(1);i.length=c.length}d[0]&4&&(n.disabled=p[2]),d[0]&8224&&Ue(n,p[5])},i:ye,o:ye,d(p){p&&S(e),Ge(i,p),u=!1,s()}}}function Eo(l){let e,t=l[33].label+"",o;return{c(){e=f("option"),o=q(t),e.__value=l[33].value,e.value=e.__value},m(n,u){T(n,e,u),r(e,o)},p:ye,d(n){n&&S(e)}}}function Ar(l){let e,t,o;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-cloud-upload-alt"></i>',t=g(),o=f("span"),o.textContent="Save to Atomic Server",a(e,"class","icon")},m(n,u){T(n,e,u),T(n,t,u),T(n,o,u)},p:ye,d(n){n&&S(e),n&&S(t),n&&S(o)}}}function Lr(l){let e;return{c(){e=q("Cancel")},m(t,o){T(t,e,o)},d(t){t&&S(e)}}}function Nr(l){let e,t,o,n,u,s,c,i,p,d,_,m,k,v=l[4]&&To(l),w=l[3]&&Ro(l),h=!l[4]&&Ao(l);return{c(){e=f("div"),t=f("div"),o=f("div"),o.innerHTML=`<div class="level-item"><h3 class="title is-4"><span class="icon"><i class="fas fa-save"></i></span>
            Save to Atomic Server</h3></div>`,n=g(),u=f("div"),s=f("div"),c=f("button"),i=g(),v&&v.c(),p=g(),w&&w.c(),d=g(),h&&h.c(),a(o,"class","level-left"),a(c,"class","delete is-large"),c.disabled=l[2],a(c,"aria-label","close"),a(s,"class","level-item"),a(u,"class","level-right"),a(t,"class","level svelte-48g63o"),a(e,"class","box")},m(A,$){T(A,e,$),r(e,t),r(t,o),r(t,n),r(t,u),r(u,s),r(s,c),r(e,i),v&&v.m(e,null),r(e,p),w&&w.m(e,null),r(e,d),h&&h.m(e,null),_=!0,m||(k=X(c,"click",l[17]),m=!0)},p(A,$){(!_||$[0]&4)&&(c.disabled=A[2]),A[4]?v?$[0]&16&&G(v,1):(v=To(A),v.c(),G(v,1),v.m(e,p)):v&&(je(),J(v,1,1,()=>{v=null}),ze()),A[3]?w?(w.p(A,$),$[0]&8&&G(w,1)):(w=Ro(A),w.c(),G(w,1),w.m(e,d)):w&&(je(),J(w,1,1,()=>{w=null}),ze()),A[4]?h&&(je(),J(h,1,1,()=>{h=null}),ze()):h?(h.p(A,$),$[0]&16&&G(h,1)):(h=Ao(A),h.c(),G(h,1),h.m(e,null))},i(A){_||(G(v),G(w),G(h),_=!0)},o(A){J(v),J(w),J(h),_=!1},d(A){A&&S(e),v&&v.d(),w&&w.d(),h&&h.d(),m=!1,k()}}}function Or(l){let e,t,o;function n(s){l[26](s)}let u={$$slots:{default:[Nr]},$$scope:{ctx:l}};return l[0]!==void 0&&(u.active=l[0]),e=new Il({props:u}),We.push(()=>Ye(e,"active",n)),e.$on("close",l[17]),{c(){re(e.$$.fragment)},m(s,c){ie(e,s,c),o=!0},p(s,c){const i={};c[0]&8190|c[1]&2048&&(i.$$scope={dirty:c,ctx:s}),!t&&c[0]&1&&(t=!0,i.active=s[0],Qe(()=>t=!1)),e.$set(i)},i(s){o||(G(e.$$.fragment,s),o=!0)},o(s){J(e.$$.fragment,s),o=!1},d(s){ae(e,s)}}}function Ur(l,e,t){let o,n,u;Re(l,Ve,y=>t(27,o=y)),Re(l,gt,y=>t(28,n=y)),Re(l,Rt,y=>t(12,u=y));let{active:s=!1}=e,{document:c}=e,i=!1,p=null,d=!1,_="",m="",k=!1,v="",w="",h=[],A="";const $=[{label:"Root (Server Root)",value:""},{label:"Articles Collection",value:"articles"},{label:"Documents Collection",value:"documents"},{label:"Knowledge Base",value:"knowledge-base"},{label:"Research",value:"research"},{label:"Projects",value:"projects"}];function b(){t(2,i=!1),t(3,p=null),t(4,d=!1),t(5,_=""),t(6,m=""),t(7,k=!1),t(8,v=(c==null?void 0:c.title)||""),t(9,w=(c==null?void 0:c.description)||`Article saved from Terraphim search: ${c==null?void 0:c.title}`),t(10,h=[]),t(11,A="")}function O(){var D;const y=u,E=n;if(!(E!=null&&E.roles)||!y){console.warn("No role configuration found");return}let z=null;try{for(const[V,x]of Object.entries(E.roles)){const oe=x,ke=typeof oe.name=="object"?oe.name.original:String(oe.name);if(V===y||ke===y){z=oe;break}}}catch(V){console.warn("Error checking role configuration:",V);return}if(!z){console.warn(`Role "${y}" not found in configuration`);return}t(10,h=((D=z.haystacks)==null?void 0:D.filter(V=>V.service==="Atomic"&&V.location&&!V.read_only))||[]),h.length>0&&t(11,A=h[0].location),console.log("Loaded atomic servers:",h)}function Y(){const y=h.find(E=>E.location===A);return y==null?void 0:y.atomic_server_secret}function M(){const y=A.replace(/\/$/,"");if(k&&m.trim()){const E=m.trim();return E.startsWith("http://")||E.startsWith("https://")?E:`${y}/${E.replace(/^\//,"")}`}else return _?`${y}/${_}`:y}function j(){return v.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,50)}function N(){const y=A.replace(/\/$/,""),E=j(),z=Date.now();return`${y}/${E}-${z}`}async function P(){if(!A||!v.trim()){t(3,p="Please select an atomic server and provide a title");return}t(2,i=!0),t(3,p=null);try{const y=N(),E=M(),z=Y();console.log("ðŸ”„ Saving article to atomic server:",{subject:y,parent:E,server:A,hasSecret:!!z});const D={subject:y,title:v.trim(),description:w.trim(),body:c.body,parent:E,shortname:j(),original_id:c.id,original_url:c.url,original_rank:c.rank,tags:c.tags||[]};if(o)await Fe("save_article_to_atomic",{article:D,serverUrl:A,atomicSecret:z});else{const V=await fetch(`${at.ServerURL}/atomic/save`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({article:D,server_url:A,atomic_secret:z})});if(!V.ok){const x=await V.json().catch(()=>({error:V.statusText}));throw new Error(x.error||`HTTP ${V.status}: ${V.statusText}`)}}t(4,d=!0),console.log("âœ… Article saved successfully to atomic server"),setTimeout(()=>{t(0,s=!1)},2e3)}catch(y){console.error("âŒ Failed to save article to atomic server:",y),t(3,p=y.message||"Failed to save article to atomic server")}finally{t(2,i=!1)}}function F(){i||t(0,s=!1)}const H=[[]];function R(){A=kt(this),t(11,A),t(10,h)}function C(y){v=y,t(8,v)}function W(){w=this.value,t(9,w)}function L(){k=this.__value,t(7,k)}function U(){k=this.__value,t(7,k)}function Q(){_=kt(this),t(5,_),t(13,$)}function K(y){m=y,t(6,m)}function Z(y){s=y,t(0,s)}return l.$$set=y=>{"active"in y&&t(0,s=y.active),"document"in y&&t(1,c=y.document)},l.$$.update=()=>{l.$$.dirty[0]&3&&s&&c&&(b(),O())},[s,c,i,p,d,_,m,k,v,w,h,A,u,$,M,N,P,F,R,C,W,L,H,U,Q,K,Z]}class Pr extends ut{constructor(e){super(),ct(this,e,Ur,Or,ot,{active:0,document:1},null,[-1,-1])}}async function Hl(l){return Fe("tauri",l)}async function Er(l,e){return Hl({__tauriModule:"Event",message:{cmd:"unlisten",event:l,eventId:e}})}async function Dr(l,e,t){return Hl({__tauriModule:"Event",message:{cmd:"listen",event:l,windowLabel:e,handler:Dl(t)}}).then(o=>async()=>Er(l,o))}var Do;(function(l){l.WINDOW_RESIZED="tauri://resize",l.WINDOW_MOVED="tauri://move",l.WINDOW_CLOSE_REQUESTED="tauri://close-requested",l.WINDOW_CREATED="tauri://window-created",l.WINDOW_DESTROYED="tauri://destroyed",l.WINDOW_FOCUS="tauri://focus",l.WINDOW_BLUR="tauri://blur",l.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",l.WINDOW_THEME_CHANGED="tauri://theme-changed",l.WINDOW_FILE_DROP="tauri://file-drop",l.WINDOW_FILE_DROP_HOVER="tauri://file-drop-hover",l.WINDOW_FILE_DROP_CANCELLED="tauri://file-drop-cancelled",l.MENU="tauri://menu",l.CHECK_UPDATE="tauri://update",l.UPDATE_AVAILABLE="tauri://update-available",l.INSTALL_UPDATE="tauri://update-install",l.STATUS_UPDATE="tauri://update-status",l.DOWNLOAD_PROGRESS="tauri://update-download-progress"})(Do||(Do={}));async function Mr(l,e){return Dr(l,null,e)}function Mo(l,e,t){const o=l.slice();return o[9]=e[t],o}function Io(l){let e,t=l[9].name+"",o,n;return{c(){e=f("option"),o=q(t),e.__value=n=l[9].name,e.value=e.__value},m(u,s){T(u,e,s),r(e,o)},p(u,s){s&1&&t!==(t=u[9].name+"")&&ge(o,t),s&1&&n!==(n=u[9].name)&&(e.__value=n,e.value=e.__value)},d(u){u&&S(e)}}}function Ir(l){let e,t,o,n,u,s,c=l[0],i=[];for(let p=0;p<c.length;p+=1)i[p]=Io(Mo(l,c,p));return{c(){e=f("div"),t=f("div"),o=f("div"),n=f("select");for(let p=0;p<i.length;p+=1)i[p].c();a(o,"class","select"),a(t,"class","control"),a(e,"class","field is-grouped is-grouped-right")},m(p,d){T(p,e,d),r(e,t),r(t,o),r(o,n);for(let _=0;_<i.length;_+=1)i[_]&&i[_].m(n,null);Ue(n,l[1]),u||(s=X(n,"change",l[2]),u=!0)},p(p,[d]){if(d&1){c=p[0];let _;for(_=0;_<c.length;_+=1){const m=Mo(p,c,_);i[_]?i[_].p(m,d):(i[_]=Io(m),i[_].c(),i[_].m(n,null))}for(;_<i.length;_+=1)i[_].d(1);i.length=c.length}d&3&&Ue(n,p[1])},i:ye,o:ye,d(p){p&&S(e),Ge(i,p),u=!1,s()}}}function jr(l,e,t){let o,n,u,s;Re(l,gt,m=>t(5,o=m)),Re(l,Ve,m=>t(6,n=m)),Re(l,co,m=>t(0,u=m)),Re(l,Rt,m=>t(1,s=m));let c="";async function i(){try{Ve.set(window.__TAURI__!==void 0),n?(console.log("Loading config from Tauri"),Fe("get_config").then(m=>{console.log("get_config response",m),m&&m.status==="success"&&p(m.config)}).catch(m=>console.error("Error fetching config in Tauri:",m))):(console.log("Loading config from server"),c=`${at.ServerURL}/config/`,fetch(c).then(m=>m.json()).then(m=>{console.log("Config received",m),m&&m.status==="success"&&p(m.config)}).catch(m=>console.error("Error fetching config:",m)))}catch(m){console.error("Unhandled error in loadConfig:",m)}}function p(m){var h;console.log("Updating stores from config:",m);const k={default_role:m.selected_role,...m};gt.set(k);const v=Object.entries(m.roles).map(([A,$])=>({name:A,...$}));co.set(v),Rt.set(m.selected_role);const w=m.roles[m.selected_role];if(console.log("Selected role settings:",w),w){const A=w.theme||"spacelab";console.log("Setting theme to:",A),fl.set(A),(h=w.kg)!=null&&h.publish?n?Fe("publish_thesaurus",{roleName:m.selected_role}).then($=>{console.log("publish_thesaurus response",$),ul.set($),ht.set(!0)}):(console.log("Fetching thesaurus from HTTP endpoint for role",m.selected_role),fetch(`${at.ServerURL}/thesaurus/${encodeURIComponent(m.selected_role)}`).then($=>$.json()).then($=>{console.log("thesaurus HTTP response",$),$&&$.status==="success"&&$.thesaurus?(ul.set($.thesaurus),ht.set(!0)):(console.error("Failed to fetch thesaurus:",$),ht.set(!1))}).catch($=>{console.error("Error fetching thesaurus:",$),ht.set(!1)})):ht.set(!1)}else console.warn("No role settings found for:",m.selected_role),fl.set("spacelab")}typeof window<"u"&&window.__TAURI__&&Mr("role_changed",m=>{console.log("Role changed event received from backend:",m.payload),p(m.payload)});async function d(){await i()}d(),console.log("Using Terraphim Server URL:",at.ServerURL);function _(m){var A,$;const v=m.currentTarget.value;console.log("Role change requested:",v),Rt.set(v);const w=u.find(b=>b.name===v);if(!w){console.error(`No role settings found for role: ${v}.`);return}const h=w.theme||"spacelab";fl.set(h),console.log(`Theme changed to ${h}`),gt.update(b=>(b.selected_role=v,b)),n?(Fe("select_role",{roleName:v}).catch(b=>console.error("Error selecting role:",b)),(A=w.kg)!=null&&A.publish?(console.log("Publishing thesaurus for role",v),Fe("publish_thesaurus",{roleName:v}).then(b=>{ul.set(b),ht.set(!0)})):ht.set(!1)):(fetch(`${at.ServerURL}/config/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).catch(b=>console.error("Error updating config on server:",b)),($=w.kg)!=null&&$.publish?(console.log("Fetching thesaurus from HTTP endpoint for role",v),fetch(`${at.ServerURL}/thesaurus/${encodeURIComponent(v)}`).then(b=>b.json()).then(b=>{console.log("thesaurus HTTP response",b),b&&b.status==="success"&&b.thesaurus?(ul.set(b.thesaurus),ht.set(!0)):(console.error("Failed to fetch thesaurus:",b),ht.set(!1))}).catch(b=>{console.error("Error fetching thesaurus:",b),ht.set(!1)})):ht.set(!1))}return[u,s,_,i]}class Al extends ut{constructor(e){super(),ct(this,e,jr,Ir,ot,{loadConfig:3})}get loadConfig(){return this.$$.ctx[3]}}function jo(l,e,t){const o=l.slice();return o[33]=e[t],o}function zo(l,e,t){const o=l.slice();return o[36]=e[t],o}function Ho(l){let e,t;return e=new Bn({props:{$$slots:{default:[Hr]},$$scope:{ctx:l}}}),{c(){re(e.$$.fragment)},m(o,n){ie(e,o,n),t=!0},p(o,n){const u={};n[0]&129|n[1]&256&&(u.$$scope={dirty:n,ctx:o}),e.$set(u)},i(o){t||(G(e.$$.fragment,o),t=!0)},o(o){J(e.$$.fragment,o),t=!1},d(o){ae(e,o)}}}function zr(l){let e=l[36]+"",t;return{c(){t=q(e)},m(o,n){T(o,t,n)},p(o,n){n[0]&1&&e!==(e=o[36]+"")&&ge(t,e)},d(o){o&&S(t)}}}function Fo(l){let e,t,o,n,u,s;t=new qn({props:{rounded:!0,$$slots:{default:[zr]},$$scope:{ctx:l}}});function c(){return l[18](l[36])}return{c(){e=f("button"),re(t.$$.fragment),o=g(),a(e,"class","tag-button svelte-2smypa"),e.disabled=l[7],a(e,"title","Click to view knowledge graph document")},m(i,p){T(i,e,p),ie(t,e,null),r(e,o),n=!0,u||(s=X(e,"click",c),u=!0)},p(i,p){l=i;const d={};p[0]&1|p[1]&256&&(d.$$scope={dirty:p,ctx:l}),t.$set(d),(!n||p[0]&128)&&(e.disabled=l[7])},i(i){n||(G(t.$$.fragment,i),n=!0)},o(i){J(t.$$.fragment,i),n=!1},d(i){i&&S(e),ae(t),u=!1,s()}}}function Hr(l){let e,t,o=l[0].tags,n=[];for(let s=0;s<o.length;s+=1)n[s]=Fo(zo(l,o,s));const u=s=>J(n[s],1,1,()=>{n[s]=null});return{c(){for(let s=0;s<n.length;s+=1)n[s].c();e=nt()},m(s,c){for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(s,c);T(s,e,c),t=!0},p(s,c){if(c[0]&65665){o=s[0].tags;let i;for(i=0;i<o.length;i+=1){const p=zo(s,o,i);n[i]?(n[i].p(p,c),G(n[i],1)):(n[i]=Fo(p),n[i].c(),G(n[i],1),n[i].m(e.parentNode,e))}for(je(),i=o.length;i<n.length;i+=1)u(i);ze()}},i(s){if(!t){for(let c=0;c<o.length;c+=1)G(n[c]);t=!0}},o(s){n=n.filter(Boolean);for(let c=0;c<n.length;c+=1)J(n[c]);t=!1},d(s){Ge(n,s),s&&S(e)}}}function Fr(l){let e,t=(l[0].rank||0)+"",o;return{c(){e=q("Rank "),o=q(t)},m(n,u){T(n,e,u),T(n,o,u)},p(n,u){u[0]&1&&t!==(t=(n[0].rank||0)+"")&&ge(o,t)},d(n){n&&S(e),n&&S(o)}}}function Wr(l){let e,t;return e=new qn({props:{rounded:!0,$$slots:{default:[Fr]},$$scope:{ctx:l}}}),{c(){re(e.$$.fragment)},m(o,n){ie(e,o,n),t=!0},p(o,n){const u={};n[0]&1|n[1]&256&&(u.$$scope={dirty:n,ctx:o}),e.$set(u)},i(o){t||(G(e.$$.fragment,o),t=!0)},o(o){J(e.$$.fragment,o),t=!1},d(o){ae(e,o)}}}function Gr(l){let e;return{c(){e=f("small"),e.textContent="No description available",a(e,"class","no-description svelte-2smypa")},m(t,o){T(t,e,o)},p:ye,i:ye,o:ye,d(t){t&&S(e)}}}function Kr(l){let e,t;return e=new Ol({props:{source:l[0].description}}),{c(){re(e.$$.fragment)},m(o,n){ie(e,o,n),t=!0},p(o,n){const u={};n[0]&1&&(u.source=o[0].description),e.$set(u)},i(o){t||(G(e.$$.fragment,o),t=!0)},o(o){J(e.$$.fragment,o),t=!1},d(o){ae(e,o)}}}function Wo(l){let e,t,o,n,u,s;return{c(){e=f("button"),t=f("span"),t.innerHTML='<i class="fas fa-magic" aria-hidden="true"></i>',o=g(),n=f("span"),n.textContent="AI Summary",a(t,"class","icon is-small"),a(e,"class","button is-small is-info is-outlined ai-summary-button svelte-2smypa"),e.disabled=l[9],a(e,"title","Generate AI-powered summary using OpenRouter")},m(c,i){T(c,e,i),r(e,t),r(e,o),r(e,n),u||(s=X(e,"click",l[17]),u=!0)},p(c,i){i[0]&512&&(e.disabled=c[9])},d(c){c&&S(e),u=!1,s()}}}function Go(l){let e;return{c(){e=f("div"),e.innerHTML=`<span class="icon"><i class="fas fa-spinner fa-spin" aria-hidden="true"></i></span> 
                <small>Generating AI summary...</small>`,a(e,"class","ai-summary-loading svelte-2smypa")},m(t,o){T(t,e,o)},d(t){t&&S(e)}}}function Ko(l){let e,t,o,n,u,s,c,i,p,d;return{c(){e=f("div"),t=f("span"),t.innerHTML='<i class="fas fa-exclamation-triangle" aria-hidden="true"></i>',o=g(),n=f("small"),u=q("Summary error: "),s=q(l[10]),c=g(),i=f("button"),i.textContent="Retry",a(t,"class","icon has-text-danger"),a(n,"class","has-text-danger"),a(i,"class","button is-small is-text svelte-2smypa"),a(i,"title","Retry generating summary"),a(e,"class","ai-summary-error svelte-2smypa")},m(_,m){T(_,e,m),r(e,t),r(e,o),r(e,n),r(n,u),r(n,s),r(e,c),r(e,i),p||(d=X(i,"click",l[19]),p=!0)},p(_,m){m[0]&1024&&ge(s,_[10])},d(_){_&&S(e),p=!1,d()}}}function Bo(l){let e,t,o,n,u,s,c,i,p,d,_,m,k,v,w,h,A,$,b,O;function Y(N,P){return N[12]?qr:Br}let M=Y(l),j=M(l);return d=new Ol({props:{source:l[8]}}),{c(){e=f("div"),t=f("div"),o=f("small"),n=f("span"),n.innerHTML='<i class="fas fa-robot" aria-hidden="true"></i>',u=q(`
                    AI Summary
                    `),j.c(),s=g(),c=f("button"),c.innerHTML='<span class="icon is-small"><i class="fas fa-times" aria-hidden="true"></i></span>',i=g(),p=f("div"),re(d.$$.fragment),_=g(),m=f("div"),k=f("button"),v=f("span"),v.innerHTML='<i class="fas fa-redo" aria-hidden="true"></i>',w=g(),h=f("span"),h.textContent="Regenerate",a(n,"class","icon is-small"),a(o,"class","ai-summary-label svelte-2smypa"),a(c,"class","button is-small is-text svelte-2smypa"),a(c,"title","Hide AI summary"),a(t,"class","ai-summary-header svelte-2smypa"),a(p,"class","ai-summary-content svelte-2smypa"),a(v,"class","icon is-small"),a(k,"class","button is-small is-text svelte-2smypa"),k.disabled=l[9],a(k,"title","Regenerate summary"),a(m,"class","ai-summary-actions svelte-2smypa"),a(e,"class","ai-summary svelte-2smypa")},m(N,P){T(N,e,P),r(e,t),r(t,o),r(o,n),r(o,u),j.m(o,null),r(t,s),r(t,c),r(e,i),r(e,p),ie(d,p,null),r(e,_),r(e,m),r(m,k),r(k,v),r(k,w),r(k,h),$=!0,b||(O=[X(c,"click",l[20]),X(k,"click",l[21])],b=!0)},p(N,P){M!==(M=Y(N))&&(j.d(1),j=M(N),j&&(j.c(),j.m(o,null)));const F={};P[0]&256&&(F.source=N[8]),d.$set(F),(!$||P[0]&512)&&(k.disabled=N[9])},i(N){$||(G(d.$$.fragment,N),lt(()=>{$&&(A||(A=ll(e,ol,{},!0)),A.run(1))}),$=!0)},o(N){J(d.$$.fragment,N),A||(A=ll(e,ol,{},!1)),A.run(0),$=!1},d(N){N&&S(e),j.d(),ae(d),N&&A&&A.end(),b=!1,Ke(O)}}}function Br(l){let e;return{c(){e=f("span"),e.textContent="fresh",a(e,"class","tag is-small is-success")},m(t,o){T(t,e,o)},d(t){t&&S(e)}}}function qr(l){let e;return{c(){e=f("span"),e.textContent="cached",a(e,"class","tag is-small is-light")},m(t,o){T(t,e,o)},d(t){t&&S(e)}}}function qo(l){let e;function t(u,s){return u[33].disabled?Yr:u[33].isLink?Vr:Jr}let o=t(l),n=o(l);return{c(){n.c(),e=nt()},m(u,s){n.m(u,s),T(u,e,s)},p(u,s){o===(o=t(u))&&n?n.p(u,s):(n.d(1),n=o(u),n&&(n.c(),n.m(e.parentNode,e)))},d(u){n.d(u),u&&S(e)}}}function Jr(l){let e,t,o,n,u,s,c,i,p;return{c(){e=f("button"),t=f("span"),o=f("i"),u=g(),a(o,"class",n=At(l[33].icon)+" svelte-2smypa"),a(t,"class","icon is-medium"),Lt(t,"has-text-primary",l[33].className),a(e,"type","button"),a(e,"class","level-item button is-ghost svelte-2smypa"),a(e,"aria-label",s=l[33].title),a(e,"title",c=l[33].title)},m(d,_){T(d,e,_),r(e,t),r(t,o),r(e,u),i||(p=X(e,"click",function(){jl(l[33].action)&&l[33].action.apply(this,arguments)}),i=!0)},p(d,_){l=d,_[0]&16384&&n!==(n=At(l[33].icon)+" svelte-2smypa")&&a(o,"class",n),_[0]&16384&&Lt(t,"has-text-primary",l[33].className),_[0]&16384&&s!==(s=l[33].title)&&a(e,"aria-label",s),_[0]&16384&&c!==(c=l[33].title)&&a(e,"title",c)},d(d){d&&S(e),i=!1,p()}}}function Vr(l){let e,t,o,n,u,s,c,i;return{c(){e=f("a"),t=f("span"),o=f("i"),u=g(),a(o,"class",n=At(l[33].icon)+" svelte-2smypa"),a(t,"class","icon is-medium"),Lt(t,"has-text-primary",l[33].className),a(e,"href",s=l[33].href),a(e,"target","_blank"),a(e,"class","level-item"),a(e,"aria-label",c=l[33].title),a(e,"title",i=l[33].title)},m(p,d){T(p,e,d),r(e,t),r(t,o),r(e,u)},p(p,d){d[0]&16384&&n!==(n=At(p[33].icon)+" svelte-2smypa")&&a(o,"class",n),d[0]&16384&&Lt(t,"has-text-primary",p[33].className),d[0]&16384&&s!==(s=p[33].href)&&a(e,"href",s),d[0]&16384&&c!==(c=p[33].title)&&a(e,"aria-label",c),d[0]&16384&&i!==(i=p[33].title)&&a(e,"title",i)},d(p){p&&S(e)}}}function Yr(l){let e,t,o,n,u,s,c;return{c(){e=f("button"),t=f("span"),o=f("i"),u=g(),a(o,"class",n=At(l[33].icon)+" svelte-2smypa"),a(t,"class","icon is-medium"),Lt(t,"has-text-primary",l[33].className),a(e,"type","button"),a(e,"class","level-item button is-ghost svelte-2smypa"),a(e,"aria-label",s=l[33].title),a(e,"title",c=l[33].title),e.disabled=!0},m(i,p){T(i,e,p),r(e,t),r(t,o),r(e,u)},p(i,p){p[0]&16384&&n!==(n=At(i[33].icon)+" svelte-2smypa")&&a(o,"class",n),p[0]&16384&&Lt(t,"has-text-primary",i[33].className),p[0]&16384&&s!==(s=i[33].title)&&a(e,"aria-label",s),p[0]&16384&&c!==(c=i[33].title)&&a(e,"title",c)},d(i){i&&S(e)}}}function Jo(l){let e,t=l[33].visible&&qo(l);return{c(){t&&t.c(),e=nt()},m(o,n){t&&t.m(o,n),T(o,e,n)},p(o,n){o[33].visible?t?t.p(o,n):(t=qo(o),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(o){t&&t.d(o),o&&S(e)}}}function Vo(l){let e,t,o;function n(s){l[23](s)}let u={item:l[4],kgTerm:l[5],kgRank:l[6]};return l[2]!==void 0&&(u.active=l[2]),e=new zl({props:u}),We.push(()=>Ye(e,"active",n)),{c(){re(e.$$.fragment)},m(s,c){ie(e,s,c),o=!0},p(s,c){const i={};c[0]&16&&(i.item=s[4]),c[0]&32&&(i.kgTerm=s[5]),c[0]&64&&(i.kgRank=s[6]),!t&&c[0]&4&&(t=!0,i.active=s[2],Qe(()=>t=!1)),e.$set(i)},i(s){o||(G(e.$$.fragment,s),o=!0)},o(s){J(e.$$.fragment,s),o=!1},d(s){ae(e,s)}}}function Yo(l){let e,t,o;function n(s){l[24](s)}let u={document:l[0]};return l[3]!==void 0&&(u.active=l[3]),e=new Pr({props:u}),We.push(()=>Ye(e,"active",n)),{c(){re(e.$$.fragment)},m(s,c){ie(e,s,c),o=!0},p(s,c){const i={};c[0]&1&&(i.document=s[0]),!t&&c[0]&8&&(t=!0,i.active=s[3],Qe(()=>t=!1)),e.$set(i)},i(s){o||(G(e.$$.fragment,s),o=!0)},o(s){J(e.$$.fragment,s),o=!1},d(s){ae(e,s)}}}function Qr(l){let e,t,o,n,u,s,c,i,p,d,_,m,k=l[0].title+"",v,w,h,A,$,b,O,Y,M,j,N,P,F,H,R,C,W,L,U,Q,K,Z,y,E,z,D,V,x,oe,ke,be=l[0].tags&&Ho(l);i=new Bn({props:{$$slots:{default:[Wr]},$$scope:{ctx:l}}});const De=[Kr,Gr],_e=[];function ce(ee,we){return ee[0].description?0:1}O=ce(l),Y=_e[O]=De[O](l);let ue=!l[11]&&!l[9]&&!l[10]&&Wo(l),Le=l[9]&&Go(),Ae=l[10]&&Ko(l),le=l[11]&&l[8]&&Bo(l),he=l[14],se=[];for(let ee=0;ee<he.length;ee+=1)se[ee]=Jo(jo(l,he,ee));function ve(ee){l[22](ee)}let Ze={item:l[0]};l[1]!==void 0&&(Ze.active=l[1]),y=new zl({props:Ze}),We.push(()=>Ye(y,"active",ve));let Se=l[4]&&Vo(l),Ne=l[13]&&Yo(l);return{c(){e=f("div"),t=f("article"),o=f("div"),n=f("div"),u=f("div"),be&&be.c(),s=g(),c=f("div"),re(i.$$.fragment),p=g(),d=f("div"),_=f("button"),m=f("h2"),v=q(k),w=g(),h=f("div"),A=f("small"),A.textContent="Description:",$=g(),b=f("div"),Y.c(),M=g(),j=f("div"),ue&&ue.c(),N=g(),Le&&Le.c(),P=g(),Ae&&Ae.c(),F=g(),le&&le.c(),H=g(),R=f("br"),W=g(),L=f("div"),U=f("nav"),Q=f("div");for(let ee=0;ee<se.length;ee+=1)se[ee].c();Z=g(),re(y.$$.fragment),z=g(),Se&&Se.c(),D=g(),Ne&&Ne.c(),V=nt(),a(u,"class","level-right"),a(c,"class","level-right"),a(m,"class","title svelte-2smypa"),a(_,"class","svelte-2smypa"),a(A,"class","description-label svelte-2smypa"),a(b,"class","description-content svelte-2smypa"),a(h,"class","description svelte-2smypa"),a(j,"class","ai-summary-section svelte-2smypa"),a(n,"class","content"),a(Q,"class","level-right"),a(U,"class","level is-mobile"),a(L,"class","level-right"),a(o,"class","media-content"),a(t,"class","media"),a(e,"class","box")},m(ee,we){T(ee,e,we),r(e,t),r(t,o),r(o,n),r(n,u),be&&be.m(u,null),r(n,s),r(n,c),ie(i,c,null),r(n,p),r(n,d),r(d,_),r(_,m),r(m,v),r(d,w),r(d,h),r(h,A),r(h,$),r(h,b),_e[O].m(b,null),r(d,M),r(d,j),ue&&ue.m(j,null),r(j,N),Le&&Le.m(j,null),r(j,P),Ae&&Ae.m(j,null),r(j,F),le&&le.m(j,null),r(d,H),r(d,R),r(o,W),r(o,L),r(L,U),r(U,Q);for(let Me=0;Me<se.length;Me+=1)se[Me]&&se[Me].m(Q,null);T(ee,Z,we),ie(y,ee,we),T(ee,z,we),Se&&Se.m(ee,we),T(ee,D,we),Ne&&Ne.m(ee,we),T(ee,V,we),x=!0,oe||(ke=X(_,"click",l[15]),oe=!0)},p(ee,we){ee[0].tags?be?(be.p(ee,we),we[0]&1&&G(be,1)):(be=Ho(ee),be.c(),G(be,1),be.m(u,null)):be&&(je(),J(be,1,1,()=>{be=null}),ze());const Me={};we[0]&1|we[1]&256&&(Me.$$scope={dirty:we,ctx:ee}),i.$set(Me),(!x||we[0]&1)&&k!==(k=ee[0].title+"")&&ge(v,k);let _t=O;if(O=ce(ee),O===_t?_e[O].p(ee,we):(je(),J(_e[_t],1,1,()=>{_e[_t]=null}),ze(),Y=_e[O],Y?Y.p(ee,we):(Y=_e[O]=De[O](ee),Y.c()),G(Y,1),Y.m(b,null)),!ee[11]&&!ee[9]&&!ee[10]?ue?ue.p(ee,we):(ue=Wo(ee),ue.c(),ue.m(j,N)):ue&&(ue.d(1),ue=null),ee[9]?Le||(Le=Go(),Le.c(),Le.m(j,P)):Le&&(Le.d(1),Le=null),ee[10]?Ae?Ae.p(ee,we):(Ae=Ko(ee),Ae.c(),Ae.m(j,F)):Ae&&(Ae.d(1),Ae=null),ee[11]&&ee[8]?le?(le.p(ee,we),we[0]&2304&&G(le,1)):(le=Bo(ee),le.c(),G(le,1),le.m(j,null)):le&&(je(),J(le,1,1,()=>{le=null}),ze()),we[0]&16384){he=ee[14];let Pe;for(Pe=0;Pe<he.length;Pe+=1){const yt=jo(ee,he,Pe);se[Pe]?se[Pe].p(yt,we):(se[Pe]=Jo(yt),se[Pe].c(),se[Pe].m(Q,null))}for(;Pe<se.length;Pe+=1)se[Pe].d(1);se.length=he.length}const Be={};we[0]&1&&(Be.item=ee[0]),!E&&we[0]&2&&(E=!0,Be.active=ee[1],Qe(()=>E=!1)),y.$set(Be),ee[4]?Se?(Se.p(ee,we),we[0]&16&&G(Se,1)):(Se=Vo(ee),Se.c(),G(Se,1),Se.m(D.parentNode,D)):Se&&(je(),J(Se,1,1,()=>{Se=null}),ze()),ee[13]?Ne?(Ne.p(ee,we),we[0]&8192&&G(Ne,1)):(Ne=Yo(ee),Ne.c(),G(Ne,1),Ne.m(V.parentNode,V)):Ne&&(je(),J(Ne,1,1,()=>{Ne=null}),ze())},i(ee){x||(G(be),G(i.$$.fragment,ee),G(Y),G(le),lt(()=>{x&&(C||(C=ll(d,ol,{},!0)),C.run(1))}),lt(()=>{x&&(K||(K=ll(U,ol,{},!0)),K.run(1))}),G(y.$$.fragment,ee),G(Se),G(Ne),x=!0)},o(ee){J(be),J(i.$$.fragment,ee),J(Y),J(le),C||(C=ll(d,ol,{},!1)),C.run(0),K||(K=ll(U,ol,{},!1)),K.run(0),J(y.$$.fragment,ee),J(Se),J(Ne),x=!1},d(ee){ee&&S(e),be&&be.d(),ae(i),_e[O].d(),ue&&ue.d(),Le&&Le.d(),Ae&&Ae.d(),le&&le.d(),ee&&C&&C.end(),Ge(se,ee),ee&&K&&K.end(),ee&&S(Z),ae(y,ee),ee&&S(z),Se&&Se.d(ee),ee&&S(D),Ne&&Ne.d(ee),ee&&S(V),oe=!1,ke()}}}function Zr(l,e,t){let o,n,u,s,c;Re(l,Rt,y=>t(25,u=y)),Re(l,Ve,y=>t(26,s=y)),Re(l,gt,y=>t(27,c=y));let{document:i}=e,p=!1,d=!1,_=!1,m=null,k=null,v=null,w=!1,h=null,A=!1,$=null,b=!1,O=!1;function Y(){const y=[];return y.push({id:"download-markdown",label:"Download to Markdown",icon:"fas fa-download",action:()=>H(),visible:!0,title:"Download document as markdown file"}),o&&y.push({id:"save-atomic",label:"Save to Atomic Server",icon:"fas fa-cloud-upload-alt",action:()=>N(),visible:!0,title:"Save article to Atomic Server",className:"has-text-primary"}),i.url&&y.push({id:"external-url",label:"Open URL",icon:"fas fa-link",action:()=>window.open(i.url,"_blank"),visible:!0,title:"Open original URL in new tab",isLink:!0,href:i.url}),y.push({id:"open-vscode",label:"Open in VSCode",icon:"fas fa-code",action:()=>R(),visible:!0,title:"Open document in VSCode",isLink:!0,href:`vscode://${encodeURIComponent(i.title)}.md?${encodeURIComponent(i.body)}`}),y.push({id:"add-favorites",label:"Add to Favorites",icon:"fas fa-plus",action:()=>{},visible:!0,title:"Add to favorites (coming soon)",disabled:!0}),y}function M(){var V;const y=u,E=c;if(!(E!=null&&E.roles)||!y)return!1;let z=null;try{for(const[x,oe]of Object.entries(E.roles)){const ke=oe,be=typeof ke.name=="object"?ke.name.original:String(ke.name);if(x===y||be===y){z=ke;break}}}catch(x){return console.warn("Error checking role configuration:",x),!1}return z?(((V=z.haystacks)==null?void 0:V.filter(x=>x.service==="Atomic"&&x.location&&!x.read_only))||[]).length>0:!1}const j=()=>{t(1,p=!0)},N=()=>{console.log("ðŸ”„ Opening atomic save modal for document:",i.title),t(3,_=!0)};async function P(y){var E,z,D,V,x;t(7,w=!0),t(5,k=y),console.log("ðŸ” KG Search Debug Info:"),console.log("  Tag clicked:",y),console.log("  Current role:",u),console.log("  Is Tauri mode:",s);try{if(s){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:u,term:y});const oe=await Fe("find_documents_for_kg_term",{roleName:u,term:y});console.log("  ðŸ“¥ Tauri response received:"),console.log("    Status:",oe.status),console.log("    Results count:",((E=oe.results)==null?void 0:E.length)||0),console.log("    Total:",oe.total||0),console.log("    Full response:",JSON.stringify(oe,null,2)),oe.status==="success"&&oe.results&&oe.results.length>0?(t(4,m=oe.results[0]),t(6,v=m.rank||0),console.log("  âœ… Found KG document:"),console.log("    Title:",m.title),console.log("    Rank:",v),console.log("    Body length:",((z=m.body)==null?void 0:z.length)||0,"characters"),t(2,d=!0)):(console.warn(`  âš ï¸  No KG documents found for term: "${y}" in role: "${u}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const oe=at.ServerURL,ke=encodeURIComponent(u),be=encodeURIComponent(y),De=`${oe}/roles/${ke}/kg_search?term=${be}`;console.log("  ðŸ“¤ HTTP Request details:"),console.log("    Base URL:",oe),console.log("    Role (encoded):",ke),console.log("    Term (encoded):",be),console.log("    Full URL:",De);const _e=await fetch(De);if(console.log("  ðŸ“¥ HTTP Response received:"),console.log("    Status code:",_e.status),console.log("    Status text:",_e.statusText),console.log("    Headers:",Object.fromEntries(_e.headers.entries())),!_e.ok)throw new Error(`HTTP error! Status: ${_e.status} - ${_e.statusText}`);const ce=await _e.json();console.log("  ðŸ“„ Response data:"),console.log("    Status:",ce.status),console.log("    Results count:",((D=ce.results)==null?void 0:D.length)||0),console.log("    Total:",ce.total||0),console.log("    Full response:",JSON.stringify(ce,null,2)),ce.status==="success"&&ce.results&&ce.results.length>0?(t(4,m=ce.results[0]),t(6,v=m.rank||0),console.log("  âœ… Found KG document:"),console.log("    Title:",m.title),console.log("    Rank:",v),console.log("    Body length:",((V=m.body)==null?void 0:V.length)||0,"characters"),t(2,d=!0)):(console.warn(`  âš ï¸  No KG documents found for term: "${y}" in role: "${u}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",De))}}catch(oe){console.error("âŒ Error fetching KG document:"),console.error("  Error type:",oe.constructor.name),console.error("  Error message:",oe.message||oe),console.error("  Request details:",{tag:y,role:u,isTauri:s,timestamp:new Date().toISOString()}),!s&&((x=oe.message)!=null&&x.includes("Failed to fetch"))&&(console.error("  ðŸ’¡ Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{t(7,w=!1)}}async function F(){var y;if(!(A||!i.id||!u)){t(9,A=!0),t(10,$=null),console.log("ðŸ¤– AI Summary Debug Info:"),console.log("  Document ID:",i.id),console.log("  Current role:",u),console.log("  Is Tauri mode:",s);try{const E={document_id:i.id,role:u,max_length:250,force_regenerate:!1};console.log("  ðŸ“¤ Summarization request:",E);let z;if(s){const x=`${at.ServerURL}/documents/summarize`;z=await fetch(x,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(E)})}else{const x=`${at.ServerURL}/documents/summarize`;z=await fetch(x,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(E)})}if(console.log("  ðŸ“¥ Summary response received:"),console.log("    Status code:",z.status),console.log("    Status text:",z.statusText),!z.ok)throw new Error(`HTTP error! Status: ${z.status} - ${z.statusText}`);const D=await z.json();console.log("  ðŸ“„ Summary response data:",D),D.status==="Success"&&D.summary?(t(8,h=D.summary),t(12,O=D.from_cache||!1),t(11,b=!0),console.log("  âœ… Summary generated successfully"),console.log("    Summary length:",h.length,"characters"),console.log("    From cache:",O),console.log("    Model used:",D.model_used)):(t(10,$=D.error||"Failed to generate summary"),console.error("  âŒ Summary generation failed:",$))}catch(E){console.error("âŒ Error generating summary:"),console.error("  Error type:",E.constructor.name),console.error("  Error message:",E.message||E),console.error("  Request details:",{document_id:i.id,role:u,isTauri:s,timestamp:new Date().toISOString()}),t(10,$=E.message||"Network error occurred"),(y=E.message)!=null&&y.includes("Failed to fetch")&&(console.error("  ðŸ’¡ Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Verify OpenRouter is enabled for this role"),console.error("    3. Check OPENROUTER_KEY environment variable"),console.error("    4. Verify server URL in CONFIG.ServerURL"))}finally{t(9,A=!1)}}}function H(){console.log("ðŸ“¥ Downloading document as markdown:",i.title);let y=`# ${i.title}

`;y+=`**Source:** Terraphim Search
`,y+=`**Rank:** ${i.rank||"N/A"}
`,i.url&&(y+=`**URL:** ${i.url}
`),i.tags&&i.tags.length>0&&(y+=`**Tags:** ${i.tags.join(", ")}
`),y+=`**Downloaded:** ${new Date().toISOString()}

`,i.description&&(y+=`## Description

${i.description}

`),y+=`## Content

${i.body}
`;const E=`${i.title.replace(/[^a-z0-9]/gi,"_").toLowerCase()}_${Date.now()}.md`,z=new Blob([y],{type:"text/markdown"}),D=URL.createObjectURL(z),V=window.document.createElement("a");V.href=D,V.download=E,window.document.body.appendChild(V),V.click(),window.document.body.removeChild(V),URL.revokeObjectURL(D),console.log("âœ… Markdown file downloaded:",E)}function R(){const y=`vscode://${encodeURIComponent(i.title)}.md?${encodeURIComponent(i.body)}`;window.open(y,"_blank")}Al[u]!==void 0&&(console.log("Have attribute",Al[u]),Al[u].hasOwnProperty("enableLogseq")?console.log("enable logseq True"):console.log("Didn't make it"));const C=y=>P(y),W=()=>{t(10,$=null),F()},L=()=>t(11,b=!1),U=()=>{F()};function Q(y){p=y,t(1,p)}function K(y){d=y,t(2,d)}function Z(y){_=y,t(3,_)}return l.$$set=y=>{"document"in y&&t(0,i=y.document)},t(13,o=M()),t(14,n=Y()),[i,p,d,_,m,k,v,w,h,A,$,b,O,o,n,j,P,F,C,W,L,U,Q,K,Z]}class Xr extends ut{constructor(e){super(),ct(this,e,Zr,Qr,ot,{document:0},null,[-1,-1])}}const xr="/assets/terraphim_gray.png";function Qo(l,e,t){const o=l.slice();return o[21]=e[t],o}function Zo(l,e,t){const o=l.slice();return o[24]=e[t],o[26]=t,o}function Xo(l){let e,t=l[2],o=[];for(let n=0;n<t.length;n+=1)o[n]=xo(Zo(l,t,n));return{c(){e=f("ul");for(let n=0;n<o.length;n+=1)o[n].c();a(e,"class","suggestions svelte-13t09eu")},m(n,u){T(n,e,u);for(let s=0;s<o.length;s+=1)o[s]&&o[s].m(e,null)},p(n,u){if(u&524){t=n[2];let s;for(s=0;s<t.length;s+=1){const c=Zo(n,t,s);o[s]?o[s].p(c,u):(o[s]=xo(c),o[s].c(),o[s].m(e,null))}for(;s<o.length;s+=1)o[s].d(1);o.length=t.length}},d(n){n&&S(e),Ge(o,n)}}}function xo(l){let e,t=l[24]+"",o,n,u,s,c,i;function p(){return l[13](l[24])}function d(..._){return l[14](l[24],..._)}return{c(){e=f("li"),o=q(t),n=g(),a(e,"tabindex","0"),a(e,"role","option"),a(e,"aria-selected",u=l[26]===l[3]),a(e,"aria-label",s=`Apply suggestion: ${l[24]}`),a(e,"class","svelte-13t09eu"),Lt(e,"active",l[26]===l[3])},m(_,m){T(_,e,m),r(e,o),r(e,n),c||(i=[X(e,"click",p),X(e,"keydown",d)],c=!0)},p(_,m){l=_,m&4&&t!==(t=l[24]+"")&&ge(o,t),m&8&&u!==(u=l[26]===l[3])&&a(e,"aria-selected",u),m&4&&s!==(s=`Apply suggestion: ${l[24]}`)&&a(e,"aria-label",s),m&8&&Lt(e,"active",l[26]===l[3])},d(_){_&&S(e),c=!1,Ke(i)}}}function ei(l){let e,t,o,n,u;function s(p){l[12](p)}let c={type:"search",placeholder:l[6]?`Search over Knowledge graph for ${l[5]}`:"Search",icon:"search",expanded:!0,autofocus:!0};l[4]!==void 0&&(c.value=l[4]),t=new Bt({props:c}),We.push(()=>Ye(t,"value",s)),t.$on("click",l[10]),t.$on("submit",l[10]),t.$on("keydown",l[8]),t.$on("input",l[7]);let i=l[2].length>0&&Xo(l);return{c(){e=f("div"),re(t.$$.fragment),n=g(),i&&i.c(),a(e,"class","input-wrapper svelte-13t09eu")},m(p,d){T(p,e,d),ie(t,e,null),r(e,n),i&&i.m(e,null),u=!0},p(p,d){const _={};d&96&&(_.placeholder=p[6]?`Search over Knowledge graph for ${p[5]}`:"Search"),!o&&d&16&&(o=!0,_.value=p[4],Qe(()=>o=!1)),t.$set(_),p[2].length>0?i?i.p(p,d):(i=Xo(p),i.c(),i.m(e,null)):i&&(i.d(1),i=null)},i(p){u||(G(t.$$.fragment,p),u=!0)},o(p){J(t.$$.fragment,p),u=!1},d(p){p&&S(e),ae(t),i&&i.d()}}}function ti(l){let e,t,o,n,u,s,c,i,p,d;return{c(){e=f("section"),t=f("div"),o=f("img"),u=g(),s=f("p"),s.textContent="I am Terraphim, your personal assistant.",c=g(),i=f("button"),i.innerHTML=`<span class="icon"><i class="fas fa-magic"></i></span> 
        <span>Configuration Wizard</span>`,ds(o.src,n=xr)||a(o,"src",n),a(o,"alt","Terraphim Logo"),a(o,"class","svelte-13t09eu"),a(i,"class","button is-primary"),a(i,"data-testid","wizard-start"),a(t,"class","content has-text-grey has-text-centered svelte-13t09eu"),a(e,"class","section")},m(_,m){T(_,e,m),r(e,t),r(t,o),r(t,u),r(t,s),r(t,c),r(t,i),p||(d=X(i,"click",l[15]),p=!0)},p:ye,i:ye,o:ye,d(_){_&&S(e),p=!1,d()}}}function li(l){let e,t,o=l[0],n=[];for(let s=0;s<o.length;s+=1)n[s]=en(Qo(l,o,s));const u=s=>J(n[s],1,1,()=>{n[s]=null});return{c(){for(let s=0;s<n.length;s+=1)n[s].c();e=nt()},m(s,c){for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(s,c);T(s,e,c),t=!0},p(s,c){if(c&1){o=s[0];let i;for(i=0;i<o.length;i+=1){const p=Qo(s,o,i);n[i]?(n[i].p(p,c),G(n[i],1)):(n[i]=en(p),n[i].c(),G(n[i],1),n[i].m(e.parentNode,e))}for(je(),i=o.length;i<n.length;i+=1)u(i);ze()}},i(s){if(!t){for(let c=0;c<o.length;c+=1)G(n[c]);t=!0}},o(s){n=n.filter(Boolean);for(let c=0;c<n.length;c+=1)J(n[c]);t=!1},d(s){Ge(n,s),s&&S(e)}}}function oi(l){let e,t;return{c(){e=f("p"),t=q(l[1]),a(e,"class","error svelte-13t09eu")},m(o,n){T(o,e,n),r(e,t)},p(o,n){n&2&&ge(t,o[1])},i:ye,o:ye,d(o){o&&S(e)}}}function en(l){let e,t;return e=new Xr({props:{document:l[21]}}),{c(){re(e.$$.fragment)},m(o,n){ie(e,o,n),t=!0},p(o,n){const u={};n&1&&(u.document=o[21]),e.$set(u)},i(o){t||(G(e.$$.fragment,o),t=!0)},o(o){J(e.$$.fragment,o),t=!1},d(o){ae(e,o)}}}function ni(l){let e,t,o,n,u,s,c,i,p,d,_;e=new nl({props:{fallbackPath:"/"}}),n=new It({props:{$$slots:{default:[ei]},$$scope:{ctx:l}}});const m=[oi,li,ti],k=[];function v(w,h){return w[1]?0:w[0].length?1:2}return s=v(l),c=k[s]=m[s](l),{c(){re(e.$$.fragment),t=g(),o=f("form"),re(n.$$.fragment),u=g(),c.c(),i=nt()},m(w,h){ie(e,w,h),T(w,t,h),T(w,o,h),ie(n,o,null),T(w,u,h),k[s].m(w,h),T(w,i,h),p=!0,d||(_=X(o,"submit",ps(l[10])),d=!0)},p(w,[h]){const A={};h&134217852&&(A.$$scope={dirty:h,ctx:w}),n.$set(A);let $=s;s=v(w),s===$?k[s].p(w,h):(je(),J(k[$],1,1,()=>{k[$]=null}),ze(),c=k[s],c?c.p(w,h):(c=k[s]=m[s](w),c.c()),G(c,1),c.m(i.parentNode,i))},i(w){p||(G(e.$$.fragment,w),G(n.$$.fragment,w),G(c),p=!0)},o(w){J(e.$$.fragment,w),J(n.$$.fragment,w),J(c),p=!1},d(w){ae(e,w),w&&S(t),w&&S(o),ae(n),w&&S(u),k[s].d(w),w&&S(i),d=!1,_()}}}function si(l,e,t){let o,n,u,s,c,i,p;Re(l,Ps,N=>t(17,n=N)),Re(l,Rl,N=>t(4,u=N)),Re(l,Ve,N=>t(18,s=N)),Re(l,Rt,N=>t(5,c=N)),Re(l,ul,N=>t(11,i=N)),Re(l,ht,N=>t(6,p=N));let d=[],_=null,m=[],k=-1;async function v(N){const P=N.trim();if(P.length===0)return[];const H=P.split(/\s+/),R=H[H.length-1].toLowerCase();if(H.length>1){const W=[];if("and".startsWith(R)&&W.push("AND"),"or".startsWith(R)&&W.push("OR"),W.length>0)return W}const C=P.toLowerCase();if(C.includes(" and ")||C.includes(" or ")){const W=R;if(W.length<2)return[];try{if(s){const L=await Fe("get_autocomplete_suggestions",{query:W,roleName:c,limit:8});if(L.status==="success"&&L.suggestions)return L.suggestions.map(U=>U.term)}else{const L=await fetch(`${n.replace("/documents/search","")}/autocomplete/${encodeURIComponent(c)}/${encodeURIComponent(W)}`);if(L.ok){const U=await L.json();if(U.status==="success"&&U.suggestions)return U.suggestions.map(Q=>Q.term)}}return o.filter(([L])=>L.toLowerCase().includes(W.toLowerCase())).map(([L])=>L).slice(0,8)}catch(L){return console.warn("Error fetching autocomplete suggestions:",L),[]}}try{if(s){const W=await Fe("get_autocomplete_suggestions",{query:P,roleName:c,limit:6});if(W.status==="success"&&W.suggestions){const L=W.suggestions.map(U=>U.term);return H.length===1&&H[0].length>2?[...L,"AND","OR"]:L}else{console.warn("Tauri autocomplete failed, falling back to thesaurus matching");const L=o.filter(([U])=>U.toLowerCase().includes(P.toLowerCase())).map(([U])=>U).slice(0,6);return H.length===1&&H[0].length>2?[...L,"AND","OR"]:L}}else{const W=await fetch(`${n.replace("/documents/search","")}/autocomplete/${encodeURIComponent(c)}/${encodeURIComponent(P)}`);if(!W.ok){console.warn("FST autocomplete failed, falling back to thesaurus matching");const U=o.filter(([Q])=>Q.toLowerCase().includes(P.toLowerCase())).map(([Q])=>Q).slice(0,6);return H.length===1&&H[0].length>2?[...U,"AND","OR"]:U}const L=await W.json();if(L.status==="success"&&L.suggestions){const U=L.suggestions.map(Q=>Q.term);return H.length===1&&H[0].length>2?[...U,"AND","OR"]:U}else{const U=o.filter(([Q])=>Q.toLowerCase().includes(P.toLowerCase())).map(([Q])=>Q).slice(0,6);return H.length===1&&H[0].length>2?[...U,"AND","OR"]:U}}}catch(W){console.warn("Error fetching autocomplete suggestions:",W);const L=o.filter(([U])=>U.toLowerCase().includes(P.toLowerCase())).map(([U])=>U).slice(0,6);return H.length===1&&H[0].length>2?[...L,"AND","OR"]:L}}async function w(N){const P=N.target;if(!P||P.selectionStart==null)return;const F=P.selectionStart,R=u.slice(0,F).split(/\s+/),C=R[R.length-1];if(C.length>=2)try{t(2,m=await v(C))}catch(W){console.warn("Failed to get suggestions:",W),t(2,m=[])}else t(2,m=[]);t(3,k=-1)}function h(N){m.length!==0&&(N.key==="ArrowDown"?(N.preventDefault(),t(3,k=(k+1)%m.length)):N.key==="ArrowUp"?(N.preventDefault(),t(3,k=(k-1+m.length)%m.length)):(N.key==="Enter"||N.key==="Tab")&&k!==-1&&(N.preventDefault(),A(m[k])))}function A(N){var W,L;const P=document.querySelector('input[type="search"]'),F=(P==null?void 0:P.selectionStart)??0,H=u.slice(0,F),R=u.slice(F),C=H.split(/\s+/);if(N==="AND"||N==="OR"){C[C.length-1]=N,cl(Rl,u=[...C,"",R].join(" "),u);const U=F+N.length+1;(W=P==null?void 0:P.setSelectionRange)==null||W.call(P,U,U)}else{C[C.length-1]=N,cl(Rl,u=[...C,R].join(" "),u);const U=F+N.length;(L=P==null?void 0:P.setSelectionRange)==null||L.call(P,U,U)}t(2,m=[]),t(3,k=-1)}function $(N){const P=N.trim(),F=P.match(/^(.+?)\s+and\s+(.+)$/i);if(F){const[,R,C]=F;return{search_term:R.trim(),search_terms:[C.trim()],operator:"and",skip:0,limit:10,role:c}}const H=P.match(/^(.+?)\s+or\s+(.+)$/i);if(H){const[,R,C]=H;return{search_term:R.trim(),search_terms:[C.trim()],operator:"or",skip:0,limit:10,role:c}}return{search_term:P,skip:0,limit:10,role:c}}async function b(){if(t(1,_=null),s){if(!u.trim())return;try{const N=$(u),P=await Fe("search",{searchQuery:N});P.status==="success"?(t(0,d=P.results),console.log("Response results"),console.log(d)):(t(1,_=`Search failed: ${P.status}`),console.error("Search failed:",P))}catch(N){t(1,_=`Error in Tauri search: ${N}`),console.error("Error in Tauri search:",N)}}else{if(!u.trim())return;const N=$(u),P=JSON.stringify(N);try{const F=await fetch(n,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:P}),H=await F.json();if(!F.ok)throw new Error(`HTTP error! Status: ${F.status}`);t(0,d=H.results)}catch(F){console.error("Error fetching data:",F),t(1,_=`Error fetching data: ${F}`)}}}function O(N){u=N,Rl.set(u)}const Y=N=>A(N),M=(N,P)=>{(P.key==="Enter"||P.key===" ")&&(P.preventDefault(),A(N))},j=()=>window.location.href="/config/wizard";return l.$$.update=()=>{l.$$.dirty&2048&&(o=Object.entries(i))},[d,_,m,k,u,c,p,w,h,A,b,i,O,Y,M,j]}class ri extends ut{constructor(e){super(),ct(this,e,si,ni,ot,{})}}async function tn(l={}){return typeof l=="object"&&Object.freeze(l),Hl({__tauriModule:"Dialog",message:{cmd:"openDialog",options:l}})}function ln(l,e,t){const o=l.slice();return o[71]=e[t],o[79]=t,o}function on(l,e,t){const o=l.slice();return o[77]=e[t],o[78]=e,o[79]=t,o}function nn(l,e,t){const o=l.slice();return o[80]=e[t],o}function sn(l,e,t){const o=l.slice();return o[80]=e[t],o}function rn(l,e,t){const o=l.slice();return o[85]=e[t],o[86]=e,o[87]=t,o}function an(l,e,t){const o=l.slice();return o[88]=e[t][0],o[89]=e[t][1],o[90]=e,o[91]=t,o}function un(l,e,t){const o=l.slice();return o[74]=e[t],o}function cn(l,e,t){const o=l.slice();return o[71]=e[t],o}function fn(l,e,t){const o=l.slice();return o[74]=e[t],o}function pn(l){let e,t,o,n,u;return{c(){e=f("div"),t=f("button"),o=q(`
      Configuration saved successfully!`),a(t,"class","delete"),a(e,"class","notification is-success"),a(e,"data-testid","wizard-success")},m(s,c){T(s,e,c),r(e,t),r(e,o),n||(u=X(t,"click",l[20]),n=!0)},p:ye,d(s){s&&S(e),n=!1,u()}}}function dn(l){let e,t,o,n,u;return{c(){e=f("div"),t=f("button"),o=q(`
      Failed to save configuration. Please try again.`),a(t,"class","delete"),a(e,"class","notification is-danger"),a(e,"data-testid","wizard-error")},m(s,c){T(s,e,c),r(e,t),r(e,o),n||(u=X(t,"click",l[21]),n=!0)},p:ye,d(s){s&&S(e),n=!1,u()}}}function ii(l){let e,t,o,n,u,s,c,i,p,d=l[3].id+"",_,m,k,v,w,h=l[3].global_shortcut+"",A,$,b,O,Y,M=l[3].default_theme+"",j,N,P,F,H,R=l[3].default_role+"",C,W,L,U,Q,K,Z=JSON.stringify(l[3],null,2)+"",y,E=l[3].roles,z=[];for(let D=0;D<E.length;D+=1)z[D]=_n(ln(l,E,D));return{c(){e=f("h4"),e.textContent="Review",t=g(),o=f("div"),n=f("h5"),n.textContent="Configuration Summary:",u=g(),s=f("ul"),c=f("li"),i=f("strong"),i.textContent="Configuration ID:",p=g(),_=q(d),m=g(),k=f("li"),v=f("strong"),v.textContent="Global Shortcut:",w=g(),A=q(h),$=g(),b=f("li"),O=f("strong"),O.textContent="Default Theme:",Y=g(),j=q(M),N=g(),P=f("li"),F=f("strong"),F.textContent="Default Role:",H=g(),C=q(R),W=g(),L=f("h5"),L.textContent="Roles:",U=g();for(let D=0;D<z.length;D+=1)z[D].c();Q=g(),K=f("pre"),y=q(Z),a(e,"class","title is-5"),a(o,"class","content"),pe(K,"max-height","300px"),pe(K,"overflow","auto")},m(D,V){T(D,e,V),T(D,t,V),T(D,o,V),r(o,n),r(o,u),r(o,s),r(s,c),r(c,i),r(c,p),r(c,_),r(s,m),r(s,k),r(k,v),r(k,w),r(k,A),r(s,$),r(s,b),r(b,O),r(b,Y),r(b,j),r(s,N),r(s,P),r(P,F),r(P,H),r(P,C),r(o,W),r(o,L),r(o,U);for(let x=0;x<z.length;x+=1)z[x]&&z[x].m(o,null);T(D,Q,V),T(D,K,V),r(K,y)},p(D,V){if(V[0]&8&&d!==(d=D[3].id+"")&&ge(_,d),V[0]&8&&h!==(h=D[3].global_shortcut+"")&&ge(A,h),V[0]&8&&M!==(M=D[3].default_theme+"")&&ge(j,M),V[0]&8&&R!==(R=D[3].default_role+"")&&ge(C,R),V[0]&10){E=D[3].roles;let x;for(x=0;x<E.length;x+=1){const oe=ln(D,E,x);z[x]?z[x].p(oe,V):(z[x]=_n(oe),z[x].c(),z[x].m(o,null))}for(;x<z.length;x+=1)z[x].d(1);z.length=E.length}V[0]&8&&Z!==(Z=JSON.stringify(D[3],null,2)+"")&&ge(y,Z)},d(D){D&&S(e),D&&S(t),D&&S(o),Ge(z,D),D&&S(Q),D&&S(K)}}}function ai(l){let e,t,o=[],n=new Map,u,s,c,i,p=l[3].roles;const d=_=>_[77].name;for(let _=0;_<p.length;_+=1){let m=on(l,p,_),k=d(m);n.set(k,o[_]=Ln(k,m))}return{c(){e=f("h4"),e.textContent="Roles",t=g();for(let _=0;_<o.length;_+=1)o[_].c();u=g(),s=f("button"),s.textContent="Add Role",a(e,"class","title is-5"),a(s,"class","button is-link is-light"),a(s,"data-testid","add-role")},m(_,m){T(_,e,m),T(_,t,m);for(let k=0;k<o.length;k+=1)o[k]&&o[k].m(_,m);T(_,u,m),T(_,s,m),c||(i=X(s,"click",l[12]),c=!0)},p(_,m){m[0]&516985&&(p=_[3].roles,o=_s(o,m,d,1,_,p,n,u.parentNode,ms,Ln,u,on))},d(_){_&&S(e),_&&S(t);for(let m=0;m<o.length;m+=1)o[m].d(_);_&&S(u),_&&S(s),c=!1,i()}}}function ui(l){let e,t,o,n,u,s,c,i,p,d,_,m,k,v,w,h,A,$,b,O,Y,M,j,N,P,F,H,R,C,W,L,U=l[8],Q=[];for(let y=0;y<U.length;y+=1)Q[y]=Nn(fn(l,U,y));let K=l[3].roles,Z=[];for(let y=0;y<K.length;y+=1)Z[y]=On(cn(l,K,y));return{c(){e=f("div"),t=f("label"),t.textContent="Configuration ID",o=g(),n=f("div"),u=f("div"),s=f("select"),c=f("option"),c.textContent="Desktop",i=f("option"),i.textContent="Server",p=f("option"),p.textContent="Embedded",d=g(),_=f("div"),m=f("label"),m.textContent="Global shortcut",k=g(),v=f("div"),w=f("input"),h=g(),A=f("div"),$=f("label"),$.textContent="Default theme",b=g(),O=f("div"),Y=f("div"),M=f("select");for(let y=0;y<Q.length;y+=1)Q[y].c();j=g(),N=f("div"),P=f("label"),P.textContent="Default Role",F=g(),H=f("div"),R=f("div"),C=f("select");for(let y=0;y<Z.length;y+=1)Z[y].c();a(t,"class","label"),a(t,"for","config-id"),c.__value="Desktop",c.value=c.__value,i.__value="Server",i.value=i.__value,p.__value="Embedded",p.value=p.__value,a(s,"id","config-id"),l[3].id===void 0&&lt(()=>l[22].call(s)),a(u,"class","select"),a(n,"class","control"),a(e,"class","field"),a(m,"class","label"),a(m,"for","global-shortcut"),a(w,"class","input"),a(w,"id","global-shortcut"),a(w,"type","text"),a(v,"class","control"),a(_,"class","field"),a($,"class","label"),a($,"for","default-theme"),a(M,"id","default-theme"),l[3].default_theme===void 0&&lt(()=>l[24].call(M)),a(Y,"class","select is-fullwidth"),a(O,"class","control"),a(A,"class","field"),a(P,"class","label"),a(P,"for","default-role"),a(C,"id","default-role"),l[3].default_role===void 0&&lt(()=>l[25].call(C)),a(R,"class","select"),a(H,"class","control"),a(N,"class","field")},m(y,E){T(y,e,E),r(e,t),r(e,o),r(e,n),r(n,u),r(u,s),r(s,c),r(s,i),r(s,p),Ue(s,l[3].id,!0),T(y,d,E),T(y,_,E),r(_,m),r(_,k),r(_,v),r(v,w),Ce(w,l[3].global_shortcut),T(y,h,E),T(y,A,E),r(A,$),r(A,b),r(A,O),r(O,Y),r(Y,M);for(let z=0;z<Q.length;z+=1)Q[z]&&Q[z].m(M,null);Ue(M,l[3].default_theme,!0),T(y,j,E),T(y,N,E),r(N,P),r(N,F),r(N,H),r(H,R),r(R,C);for(let z=0;z<Z.length;z+=1)Z[z]&&Z[z].m(C,null);Ue(C,l[3].default_role,!0),W||(L=[X(s,"change",l[22]),X(w,"input",l[23]),X(M,"change",l[24]),X(C,"change",l[25])],W=!0)},p(y,E){if(E[0]&264&&Ue(s,y[3].id),E[0]&264&&w.value!==y[3].global_shortcut&&Ce(w,y[3].global_shortcut),E[0]&256){U=y[8];let z;for(z=0;z<U.length;z+=1){const D=fn(y,U,z);Q[z]?Q[z].p(D,E):(Q[z]=Nn(D),Q[z].c(),Q[z].m(M,null))}for(;z<Q.length;z+=1)Q[z].d(1);Q.length=U.length}if(E[0]&264&&Ue(M,y[3].default_theme),E[0]&8){K=y[3].roles;let z;for(z=0;z<K.length;z+=1){const D=cn(y,K,z);Z[z]?Z[z].p(D,E):(Z[z]=On(D),Z[z].c(),Z[z].m(C,null))}for(;z<Z.length;z+=1)Z[z].d(1);Z.length=K.length}E[0]&264&&Ue(C,y[3].default_role)},d(y){y&&S(e),y&&S(d),y&&S(_),y&&S(h),y&&S(A),Ge(Q,y),y&&S(j),y&&S(N),Ge(Z,y),W=!1,Ke(L)}}}function _n(l){let e,t,o=l[71].name+"",n,u,s,c,i,p=l[71].shortname+"",d,_,m,k,v,w=l[71].theme+"",h,A,$,b,O,Y=l[71].relevance_function+"",M,j,N,P,F,H;return{c(){e=f("div"),t=f("h6"),n=q(o),u=g(),s=f("p"),c=f("strong"),c.textContent="Shortname:",i=g(),d=q(p),_=g(),m=f("p"),k=f("strong"),k.textContent="Theme:",v=g(),h=q(w),A=g(),$=f("p"),b=f("strong"),b.textContent="Relevance Function:",O=g(),M=q(Y),j=g(),N=f("button"),N.textContent="Edit Role",P=g(),a(t,"data-testid","review-role-name-"+l[79]),a(N,"class","button is-small"),a(N,"data-testid","edit-role-"+l[79]),a(e,"class","box")},m(R,C){T(R,e,C),r(e,t),r(t,n),r(e,u),r(e,s),r(s,c),r(s,i),r(s,d),r(e,_),r(e,m),r(m,k),r(m,v),r(m,h),r(e,A),r(e,$),r($,b),r($,O),r($,M),r(e,j),r(e,N),r(e,P),F||(H=X(N,"click",l[68]),F=!0)},p(R,C){C[0]&8&&o!==(o=R[71].name+"")&&ge(n,o),C[0]&8&&p!==(p=R[71].shortname+"")&&ge(d,p),C[0]&8&&w!==(w=R[71].theme+"")&&ge(h,w),C[0]&8&&Y!==(Y=R[71].relevance_function+"")&&ge(M,Y)},d(R){R&&S(e),F=!1,H()}}}function mn(l){let e,t=l[74]+"",o;return{c(){e=f("option"),o=q(t),e.__value=l[74],e.value=e.__value},m(n,u){T(n,e,u),r(e,o)},p:ye,d(n){n&&S(e)}}}function ci(l){let e;return{c(){e=q("Directory Path")},m(t,o){T(t,e,o)},d(t){t&&S(e)}}}function fi(l){let e;return{c(){e=q("Server URL")},m(t,o){T(t,e,o)},d(t){t&&S(e)}}}function hn(l){let e;return{c(){e=f("p"),e.textContent="Click to select directory",a(e,"class","help")},m(t,o){T(t,e,o)},d(t){t&&S(e)}}}function gn(l){let e,t,o,n,u,s,c,i,p,d,_,m;function k(){l[34].call(c,l[79],l[87])}return{c(){e=f("div"),t=f("label"),o=q("Atomic Server Secret"),u=g(),s=f("div"),c=f("input"),p=g(),d=f("p"),d.textContent="Leave empty for anonymous access",a(t,"class","label"),a(t,"for",n=`haystack-secret-${l[79]}-${l[87]}`),a(c,"class","input"),a(c,"id",i=`haystack-secret-${l[79]}-${l[87]}`),a(c,"type","password"),a(c,"placeholder","Base64 encoded secret (optional)"),a(s,"class","control"),a(d,"class","help"),a(e,"class","field")},m(v,w){T(v,e,w),r(e,t),r(t,o),r(e,u),r(e,s),r(s,c),Ce(c,l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret),r(e,p),r(e,d),_||(m=X(c,"input",k),_=!0)},p(v,w){l=v,w[0]&264&&n!==(n=`haystack-secret-${l[79]}-${l[87]}`)&&a(t,"for",n),w[0]&264&&i!==(i=`haystack-secret-${l[79]}-${l[87]}`)&&a(c,"id",i),w[0]&264&&c.value!==l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret&&Ce(c,l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret)},d(v){v&&S(e),_=!1,m()}}}function bn(l){let e,t,o,n,u,s,c,i,p,d,_,m,k,v,w,h,A,$,b,O,Y,M,j,N,P,F,H,R,C,W,L,U,Q,K,Z,y,E,z,D,V,x,oe,ke;function be(){l[35].call(d,l[79],l[87])}function De(...le){return l[36](l[79],l[87],...le)}let _e=Object.entries(l[3].roles[l[79]].haystacks[l[87]].extra_parameters||{}),ce=[];for(let le=0;le<_e.length;le+=1)ce[le]=vn(an(l,_e,le));function ue(){return l[40](l[79],l[87])}function Le(){return l[41](l[79],l[87])}function Ae(){return l[42](l[79],l[87])}return{c(){e=f("div"),t=f("label"),t.textContent="Extra Parameters (for filtering)",o=g(),n=f("div"),u=f("div"),s=f("label"),c=q("Hashtag"),p=g(),d=f("input"),m=g(),k=f("div"),v=f("div"),w=f("label"),h=q("Presets"),$=g(),b=f("div"),O=f("select"),Y=f("option"),Y.textContent="(choose)",M=f("option"),M.textContent="#rust",j=f("option"),j.textContent="#docs",N=f("option"),N.textContent="#test",P=f("option"),P.textContent="#todo",H=g(),R=f("p"),R.innerHTML="When set, searches will enforce the hashtag alongside your query (AND), e.g. <code>-e &quot;search&quot; -e &quot;#rust&quot;</code>.",C=g();for(let le=0;le<ce.length;le+=1)ce[le].c();W=g(),L=f("div"),U=f("div"),Q=f("button"),Q.textContent="+ Tag Filter",K=g(),Z=f("div"),y=f("button"),y.textContent="+ Max Results",E=g(),z=f("div"),D=f("button"),D.textContent="+ Custom Parameter",V=g(),x=f("p"),x.innerHTML=`Common parameters: <code>tag</code> (e.g., &quot;#rust&quot;), <code>glob</code> (e.g., &quot;*.md&quot;),
                  <code>max_count</code> (e.g., &quot;10&quot;), <code>context</code> (e.g., &quot;5&quot;)`,a(t,"class","label"),a(s,"class","label"),a(s,"for",i=`ripgrep-hashtag-${l[79]}-${l[87]}`),a(d,"class","input"),a(d,"id",_=`ripgrep-hashtag-${l[79]}-${l[87]}`),a(d,"type","text"),a(d,"placeholder","#rust"),a(u,"class","control"),a(n,"class","field is-grouped"),a(w,"class","label"),a(w,"for",A=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`),Y.__value="",Y.value=Y.__value,M.__value="#rust",M.value=M.__value,j.__value="#docs",j.value=j.__value,N.__value="#test",N.value=N.__value,P.__value="#todo",P.value=P.__value,a(O,"id",F=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`),a(b,"class","select is-small"),a(v,"class","control"),a(k,"class","field is-grouped"),pe(k,"margin-bottom",".5rem"),a(R,"class","help"),a(Q,"class","button is-small is-link is-light"),a(U,"class","control"),a(y,"class","button is-small is-link is-light"),a(Z,"class","control"),a(D,"class","button is-small is-link is-light"),a(z,"class","control"),a(L,"class","field is-grouped"),a(x,"class","help"),a(e,"class","field")},m(le,he){T(le,e,he),r(e,t),r(e,o),r(e,n),r(n,u),r(u,s),r(s,c),r(u,p),r(u,d),Ce(d,l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag),r(e,m),r(e,k),r(k,v),r(v,w),r(w,h),r(v,$),r(v,b),r(b,O),r(O,Y),r(O,M),r(O,j),r(O,N),r(O,P),r(e,H),r(e,R),r(e,C);for(let se=0;se<ce.length;se+=1)ce[se]&&ce[se].m(e,null);r(e,W),r(e,L),r(L,U),r(U,Q),r(L,K),r(L,Z),r(Z,y),r(L,E),r(L,z),r(z,D),r(e,V),r(e,x),oe||(ke=[X(d,"input",be),X(O,"change",De),X(Q,"click",ue),X(y,"click",Le),X(D,"click",Ae)],oe=!0)},p(le,he){if(l=le,he[0]&264&&i!==(i=`ripgrep-hashtag-${l[79]}-${l[87]}`)&&a(s,"for",i),he[0]&264&&_!==(_=`ripgrep-hashtag-${l[79]}-${l[87]}`)&&a(d,"id",_),he[0]&264&&d.value!==l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag&&Ce(d,l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag),he[0]&264&&A!==(A=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`)&&a(w,"for",A),he[0]&264&&F!==(F=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`)&&a(O,"id",F),he[0]&393224){_e=Object.entries(l[3].roles[l[79]].haystacks[l[87]].extra_parameters||{});let se;for(se=0;se<_e.length;se+=1){const ve=an(l,_e,se);ce[se]?ce[se].p(ve,he):(ce[se]=vn(ve),ce[se].c(),ce[se].m(e,W))}for(;se<ce.length;se+=1)ce[se].d(1);ce.length=_e.length}},d(le){le&&S(e),Ge(ce,le),oe=!1,Ke(ke)}}}function vn(l){let e,t,o,n,u,s,c,i,p,d,_,m,k;function v(...A){return l[37](l[79],l[87],l[88],...A)}function w(){l[38].call(c,l[79],l[87],l[88])}function h(){return l[39](l[79],l[87],l[88])}return{c(){e=f("div"),t=f("div"),o=f("input"),u=g(),s=f("div"),c=f("input"),i=g(),p=f("div"),d=f("button"),d.textContent="Ã—",_=g(),a(o,"class","input"),a(o,"type","text"),a(o,"placeholder","Parameter name"),o.value=n=l[88],a(t,"class","control"),a(c,"class","input"),a(c,"type","text"),a(c,"placeholder","Parameter value"),a(s,"class","control is-expanded"),a(d,"class","button is-small is-danger"),a(p,"class","control"),a(e,"class","field is-grouped")},m(A,$){T(A,e,$),r(e,t),r(t,o),r(e,u),r(e,s),r(s,c),Ce(c,l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]]),r(e,i),r(e,p),r(p,d),r(e,_),m||(k=[X(o,"blur",v),X(c,"input",w),X(d,"click",h)],m=!0)},p(A,$){l=A,$[0]&264&&n!==(n=l[88])&&o.value!==n&&(o.value=n),$[0]&264&&c.value!==l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]]&&Ce(c,l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]])},d(A){A&&S(e),m=!1,Ke(k)}}}function kn(l){let e,t,o,n,u,s,c,i,p,d,_,m,k,v,w,h,A,$,b,O,Y,M,j,N,P,F,H,R,C,W,L,U,Q,K,Z,y,E,z,D;function V(){l[31].call(p,l[79],l[87])}function x(le,he){return le[3].roles[le[79]].haystacks[le[87]].service==="Atomic"?fi:ci}let oe=x(l),ke=oe(l);function be(){l[32].call(b,l[79],l[87])}function De(){return l[33](l[79],l[87])}let _e=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"&&hn(),ce=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"&&gn(l),ue=l[3].roles[l[79]].haystacks[l[87]].service==="Ripgrep"&&bn(l);function Le(){l[43].call(C,l[79],l[87])}function Ae(){return l[44](l[79],l[87])}return{c(){e=f("div"),t=f("div"),o=f("label"),n=q("Service Type"),s=g(),c=f("div"),i=f("div"),p=f("select"),d=f("option"),d.textContent="Ripgrep (File Search)",_=f("option"),_.textContent="Atomic Server",k=g(),v=f("div"),w=f("label"),ke.c(),A=g(),$=f("div"),b=f("input"),j=g(),_e&&_e.c(),N=g(),ce&&ce.c(),P=g(),ue&&ue.c(),F=g(),H=f("div"),R=f("label"),C=f("input"),L=q(`
                Â Read-only`),Q=g(),K=f("div"),Z=f("button"),y=q("Remove Haystack"),a(o,"class","label"),a(o,"for",u=`haystack-service-${l[79]}-${l[87]}`),d.__value="Ripgrep",d.value=d.__value,_.__value="Atomic",_.value=_.__value,a(p,"id",m=`haystack-service-${l[79]}-${l[87]}`),l[3].roles[l[79]].haystacks[l[87]].service===void 0&&lt(V),a(i,"class","select"),a(c,"class","control"),a(t,"class","field"),a(w,"class","label"),a(w,"for",h=`haystack-path-${l[79]}-${l[87]}`),a(b,"class","input"),a(b,"id",O=`haystack-path-${l[79]}-${l[87]}`),a(b,"type","text"),a(b,"placeholder",Y=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?"https://localhost:9883":"/path/to/documents"),b.readOnly=M=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic",a($,"class","control"),a(v,"class","field"),a(C,"id",W=`haystack-readonly-${l[79]}-${l[87]}`),a(C,"type","checkbox"),a(R,"class","checkbox"),a(R,"for",U=`haystack-readonly-${l[79]}-${l[87]}`),a(H,"class","field"),a(Z,"class","button is-small is-danger"),a(Z,"data-testid",E="remove-haystack-"+l[79]+"-"+l[87]),a(K,"class","field"),a(e,"class","box is-light")},m(le,he){T(le,e,he),r(e,t),r(t,o),r(o,n),r(t,s),r(t,c),r(c,i),r(i,p),r(p,d),r(p,_),Ue(p,l[3].roles[l[79]].haystacks[l[87]].service,!0),r(e,k),r(e,v),r(v,w),ke.m(w,null),r(v,A),r(v,$),r($,b),Ce(b,l[3].roles[l[79]].haystacks[l[87]].path),r($,j),_e&&_e.m($,null),r(e,N),ce&&ce.m(e,null),r(e,P),ue&&ue.m(e,null),r(e,F),r(e,H),r(H,R),r(R,C),C.checked=l[3].roles[l[79]].haystacks[l[87]].read_only,r(R,L),r(e,Q),r(e,K),r(K,Z),r(Z,y),z||(D=[X(p,"change",V),X(b,"input",be),X(b,"click",function(){jl(l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?De:void 0)&&(l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?De:void 0).apply(this,arguments)}),X(C,"change",Le),X(Z,"click",Ae)],z=!0)},p(le,he){l=le,he[0]&264&&u!==(u=`haystack-service-${l[79]}-${l[87]}`)&&a(o,"for",u),he[0]&264&&m!==(m=`haystack-service-${l[79]}-${l[87]}`)&&a(p,"id",m),he[0]&264&&Ue(p,l[3].roles[l[79]].haystacks[l[87]].service),oe!==(oe=x(l))&&(ke.d(1),ke=oe(l),ke&&(ke.c(),ke.m(w,null))),he[0]&264&&h!==(h=`haystack-path-${l[79]}-${l[87]}`)&&a(w,"for",h),he[0]&264&&O!==(O=`haystack-path-${l[79]}-${l[87]}`)&&a(b,"id",O),he[0]&264&&Y!==(Y=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?"https://localhost:9883":"/path/to/documents")&&a(b,"placeholder",Y),he[0]&280&&M!==(M=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic")&&(b.readOnly=M),he[0]&264&&b.value!==l[3].roles[l[79]].haystacks[l[87]].path&&Ce(b,l[3].roles[l[79]].haystacks[l[87]].path),l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?_e||(_e=hn(),_e.c(),_e.m($,null)):_e&&(_e.d(1),_e=null),l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?ce?ce.p(l,he):(ce=gn(l),ce.c(),ce.m(e,P)):ce&&(ce.d(1),ce=null),l[3].roles[l[79]].haystacks[l[87]].service==="Ripgrep"?ue?ue.p(l,he):(ue=bn(l),ue.c(),ue.m(e,F)):ue&&(ue.d(1),ue=null),he[0]&264&&W!==(W=`haystack-readonly-${l[79]}-${l[87]}`)&&a(C,"id",W),he[0]&264&&(C.checked=l[3].roles[l[79]].haystacks[l[87]].read_only),he[0]&264&&U!==(U=`haystack-readonly-${l[79]}-${l[87]}`)&&a(R,"for",U),he[0]&264&&E!==(E="remove-haystack-"+l[79]+"-"+l[87])&&a(Z,"data-testid",E)},d(le){le&&S(e),ke.d(),_e&&_e.d(),ce&&ce.d(),ue&&ue.d(),z=!1,Ke(D)}}}function wn(l){var Z;let e,t,o,n,u,s,c,i,p,d,_,m,k,v,w,h,A,$,b,O,Y,M,j,N,P,F,H,R,C;function W(){l[47].call(c,l[79])}function L(){return l[48](l[79])}let U=((Z=l[0][l[79]])==null?void 0:Z.length)&&$n(l);function Q(){l[50].call(b,l[79])}function K(){l[51].call(N,l[79])}return{c(){e=f("div"),t=f("label"),o=q("Model"),u=g(),s=f("div"),c=f("input"),p=g(),d=f("button"),d.textContent="Fetch models",_=g(),U&&U.c(),m=g(),k=f("div"),v=f("label"),w=q("Base URL"),A=g(),$=f("div"),b=f("input"),Y=g(),M=f("div"),j=f("label"),N=f("input"),F=q(`
              Â Automatically summarize search results`),a(t,"class","label"),a(t,"for",n=`llm-model-${l[79]}`),a(c,"class","input"),a(c,"id",i=`llm-model-${l[79]}`),a(c,"type","text"),a(c,"placeholder","llama3.1"),a(s,"class","control"),a(d,"class","button is-small"),a(e,"class","field"),a(v,"class","label"),a(v,"for",h=`llm-base-url-${l[79]}`),a(b,"class","input"),a(b,"id",O=`llm-base-url-${l[79]}`),a(b,"type","text"),a(b,"placeholder","http://127.0.0.1:11434"),a($,"class","control"),a(k,"class","field"),a(N,"id",P=`llm-auto-summarize-${l[79]}`),a(N,"type","checkbox"),a(j,"class","checkbox"),a(j,"for",H=`llm-auto-summarize-${l[79]}`),a(M,"class","field")},m(y,E){T(y,e,E),r(e,t),r(t,o),r(e,u),r(e,s),r(s,c),Ce(c,l[3].roles[l[79]].llm_model),r(e,p),r(e,d),r(e,_),U&&U.m(e,null),T(y,m,E),T(y,k,E),r(k,v),r(v,w),r(k,A),r(k,$),r($,b),Ce(b,l[3].roles[l[79]].llm_base_url),T(y,Y,E),T(y,M,E),r(M,j),r(j,N),N.checked=l[3].roles[l[79]].llm_auto_summarize,r(j,F),R||(C=[X(c,"input",W),X(d,"click",L),X(b,"input",Q),X(N,"change",K)],R=!0)},p(y,E){var z;l=y,E[0]&264&&n!==(n=`llm-model-${l[79]}`)&&a(t,"for",n),E[0]&264&&i!==(i=`llm-model-${l[79]}`)&&a(c,"id",i),E[0]&264&&c.value!==l[3].roles[l[79]].llm_model&&Ce(c,l[3].roles[l[79]].llm_model),(z=l[0][l[79]])!=null&&z.length?U?U.p(l,E):(U=$n(l),U.c(),U.m(e,null)):U&&(U.d(1),U=null),E[0]&264&&h!==(h=`llm-base-url-${l[79]}`)&&a(v,"for",h),E[0]&264&&O!==(O=`llm-base-url-${l[79]}`)&&a(b,"id",O),E[0]&264&&b.value!==l[3].roles[l[79]].llm_base_url&&Ce(b,l[3].roles[l[79]].llm_base_url),E[0]&264&&P!==(P=`llm-auto-summarize-${l[79]}`)&&a(N,"id",P),E[0]&264&&(N.checked=l[3].roles[l[79]].llm_auto_summarize),E[0]&264&&H!==(H=`llm-auto-summarize-${l[79]}`)&&a(j,"for",H)},d(y){y&&S(e),U&&U.d(),y&&S(m),y&&S(k),y&&S(Y),y&&S(M),R=!1,Ke(C)}}}function $n(l){let e,t,o,n,u=l[0][l[79]],s=[];for(let i=0;i<u.length;i+=1)s[i]=yn(sn(l,u,i));function c(...i){return l[49](l[79],...i)}return{c(){e=f("div"),t=f("select");for(let i=0;i<s.length;i+=1)s[i].c();a(e,"class","select is-fullwidth"),pe(e,"margin-top","0.5rem")},m(i,p){T(i,e,p),r(e,t);for(let d=0;d<s.length;d+=1)s[d]&&s[d].m(t,null);o||(n=X(t,"change",c),o=!0)},p(i,p){if(l=i,p[0]&9){u=l[0][l[79]];let d;for(d=0;d<u.length;d+=1){const _=sn(l,u,d);s[d]?s[d].p(_,p):(s[d]=yn(_),s[d].c(),s[d].m(t,null))}for(;d<s.length;d+=1)s[d].d(1);s.length=u.length}},d(i){i&&S(e),Ge(s,i),o=!1,n()}}}function yn(l){let e,t=l[80]+"",o,n;return{c(){e=f("option"),o=q(t),e.__value=n=l[80],e.value=e.__value},m(u,s){T(u,e,s),r(e,o)},p(u,s){s[0]&9&&t!==(t=u[80]+"")&&ge(o,t),s[0]&265&&n!==(n=u[80])&&(e.__value=n,e.value=e.__value)},d(u){u&&S(e)}}}function Cn(l){var he;let e,t,o,n,u,s,c,i,p,d,_,m,k,v,w,h,A,$,b,O,Y,M,j,N,P,F,H,R,C,W,L,U,Q,K,Z,y,E,z,D,V,x,oe,ke,be;function De(){l[53].call(c,l[79])}function _e(){l[54].call($,l[79])}function ce(){return l[55](l[79])}let ue=((he=l[0][l[79]])==null?void 0:he.length)&&Sn(l);function Le(){l[57].call(R,l[79])}function Ae(){l[58].call(E,l[79])}let le=l[3].roles[l[79]].openrouter_chat_enabled&&Rn(l);return{c(){e=f("div"),t=f("label"),o=q("OpenRouter API Key"),u=g(),s=f("div"),c=f("input"),p=g(),d=f("p"),d.innerHTML='Get your API key from <a href="https://openrouter.ai" target="_blank" rel="noopener">OpenRouter</a>',_=g(),m=f("div"),k=f("label"),v=q("Model"),h=g(),A=f("div"),$=f("input"),O=g(),Y=f("button"),Y.textContent="Fetch models",M=g(),ue&&ue.c(),j=g(),N=f("p"),N.textContent="Choose the language model for generating summaries. Different models offer different speed/quality tradeoffs.",P=g(),F=f("div"),H=f("label"),R=f("input"),W=q(`
              Â Automatically summarize search results`),U=g(),Q=f("p"),Q.textContent="When enabled, summaries will be generated and shown in search results.",K=g(),Z=f("div"),y=f("label"),E=f("input"),D=q(`
              Â Enable Chat interface (OpenRouter)`),x=g(),le&&le.c(),oe=nt(),a(t,"class","label"),a(t,"for",n=`openrouter-api-key-${l[79]}`),a(c,"class","input"),a(c,"id",i=`openrouter-api-key-${l[79]}`),a(c,"type","password"),a(c,"placeholder","sk-or-v1-..."),a(s,"class","control"),a(d,"class","help"),a(e,"class","field"),a(k,"class","label"),a(k,"for",w=`openrouter-model-${l[79]}`),a($,"class","input"),a($,"id",b=`openrouter-model-${l[79]}`),a($,"type","text"),a($,"placeholder","openai/gpt-4-turbo"),a(A,"class","control"),a(Y,"class","button is-small"),a(N,"class","help"),a(m,"class","field"),a(R,"id",C=`openrouter-auto-summarize-${l[79]}`),a(R,"type","checkbox"),a(H,"class","checkbox"),a(H,"for",L=`openrouter-auto-summarize-${l[79]}`),a(Q,"class","help"),a(F,"class","field"),a(E,"id",z=`openrouter-chat-enabled-${l[79]}`),a(E,"type","checkbox"),a(y,"class","checkbox"),a(y,"for",V=`openrouter-chat-enabled-${l[79]}`),a(Z,"class","field")},m(se,ve){T(se,e,ve),r(e,t),r(t,o),r(e,u),r(e,s),r(s,c),Ce(c,l[3].roles[l[79]].openrouter_api_key),r(e,p),r(e,d),T(se,_,ve),T(se,m,ve),r(m,k),r(k,v),r(m,h),r(m,A),r(A,$),Ce($,l[3].roles[l[79]].openrouter_model),r(m,O),r(m,Y),r(m,M),ue&&ue.m(m,null),r(m,j),r(m,N),T(se,P,ve),T(se,F,ve),r(F,H),r(H,R),R.checked=l[3].roles[l[79]].openrouter_auto_summarize,r(H,W),r(F,U),r(F,Q),T(se,K,ve),T(se,Z,ve),r(Z,y),r(y,E),E.checked=l[3].roles[l[79]].openrouter_chat_enabled,r(y,D),T(se,x,ve),le&&le.m(se,ve),T(se,oe,ve),ke||(be=[X(c,"input",De),X($,"input",_e),X(Y,"click",ce),X(R,"change",Le),X(E,"change",Ae)],ke=!0)},p(se,ve){var Ze;l=se,ve[0]&264&&n!==(n=`openrouter-api-key-${l[79]}`)&&a(t,"for",n),ve[0]&264&&i!==(i=`openrouter-api-key-${l[79]}`)&&a(c,"id",i),ve[0]&264&&c.value!==l[3].roles[l[79]].openrouter_api_key&&Ce(c,l[3].roles[l[79]].openrouter_api_key),ve[0]&264&&w!==(w=`openrouter-model-${l[79]}`)&&a(k,"for",w),ve[0]&264&&b!==(b=`openrouter-model-${l[79]}`)&&a($,"id",b),ve[0]&264&&$.value!==l[3].roles[l[79]].openrouter_model&&Ce($,l[3].roles[l[79]].openrouter_model),(Ze=l[0][l[79]])!=null&&Ze.length?ue?ue.p(l,ve):(ue=Sn(l),ue.c(),ue.m(m,j)):ue&&(ue.d(1),ue=null),ve[0]&264&&C!==(C=`openrouter-auto-summarize-${l[79]}`)&&a(R,"id",C),ve[0]&264&&(R.checked=l[3].roles[l[79]].openrouter_auto_summarize),ve[0]&264&&L!==(L=`openrouter-auto-summarize-${l[79]}`)&&a(H,"for",L),ve[0]&264&&z!==(z=`openrouter-chat-enabled-${l[79]}`)&&a(E,"id",z),ve[0]&264&&(E.checked=l[3].roles[l[79]].openrouter_chat_enabled),ve[0]&264&&V!==(V=`openrouter-chat-enabled-${l[79]}`)&&a(y,"for",V),l[3].roles[l[79]].openrouter_chat_enabled?le?le.p(l,ve):(le=Rn(l),le.c(),le.m(oe.parentNode,oe)):le&&(le.d(1),le=null)},d(se){se&&S(e),se&&S(_),se&&S(m),ue&&ue.d(),se&&S(P),se&&S(F),se&&S(K),se&&S(Z),se&&S(x),le&&le.d(se),se&&S(oe),ke=!1,Ke(be)}}}function Sn(l){let e,t,o,n,u=l[0][l[79]],s=[];for(let i=0;i<u.length;i+=1)s[i]=Tn(nn(l,u,i));function c(...i){return l[56](l[79],...i)}return{c(){e=f("div"),t=f("select");for(let i=0;i<s.length;i+=1)s[i].c();a(e,"class","select is-fullwidth"),pe(e,"margin-top","0.5rem")},m(i,p){T(i,e,p),r(e,t);for(let d=0;d<s.length;d+=1)s[d]&&s[d].m(t,null);o||(n=X(t,"change",c),o=!0)},p(i,p){if(l=i,p[0]&9){u=l[0][l[79]];let d;for(d=0;d<u.length;d+=1){const _=nn(l,u,d);s[d]?s[d].p(_,p):(s[d]=Tn(_),s[d].c(),s[d].m(t,null))}for(;d<s.length;d+=1)s[d].d(1);s.length=u.length}},d(i){i&&S(e),Ge(s,i),o=!1,n()}}}function Tn(l){let e,t=l[80]+"",o,n;return{c(){e=f("option"),o=q(t),e.__value=n=l[80],e.value=e.__value},m(u,s){T(u,e,s),r(e,o)},p(u,s){s[0]&9&&t!==(t=u[80]+"")&&ge(o,t),s[0]&265&&n!==(n=u[80])&&(e.__value=n,e.value=e.__value)},d(u){u&&S(e)}}}function Rn(l){let e,t,o,n,u,s,c,i,p,d,_,m,k,v,w,h,A,$,b,O,Y,M,j,N,P;function F(){l[59].call(i,l[79])}function H(){l[60].call(M,l[79])}return{c(){e=f("div"),t=f("label"),o=q("Chat Model"),u=g(),s=f("div"),c=f("div"),i=f("select"),p=f("option"),p.textContent="GPT-3.5 Turbo",d=f("option"),d.textContent="GPT-4",_=f("option"),_.textContent="Claude 3 Sonnet",m=f("option"),m.textContent="Claude 3 Haiku",k=f("option"),k.textContent="Mixtral 8x7B",w=g(),h=f("div"),A=f("label"),$=q("System Prompt (optional)"),O=g(),Y=f("div"),M=f("textarea"),a(t,"class","label"),a(t,"for",n=`openrouter-chat-model-${l[79]}`),p.__value="openai/gpt-3.5-turbo",p.value=p.__value,d.__value="openai/gpt-4",d.value=d.__value,_.__value="anthropic/claude-3-sonnet",_.value=_.__value,m.__value="anthropic/claude-3-haiku",m.value=m.__value,k.__value="mistralai/mixtral-8x7b-instruct",k.value=k.__value,a(i,"id",v=`openrouter-chat-model-${l[79]}`),l[3].roles[l[79]].openrouter_chat_model===void 0&&lt(F),a(c,"class","select is-fullwidth"),a(s,"class","control"),a(e,"class","field"),a(A,"class","label"),a(A,"for",b=`openrouter-chat-system-${l[79]}`),a(M,"class","textarea"),a(M,"id",j=`openrouter-chat-system-${l[79]}`),a(M,"rows","3"),a(M,"placeholder","You are a helpful Rust engineer assistant..."),a(Y,"class","control"),a(h,"class","field")},m(R,C){T(R,e,C),r(e,t),r(t,o),r(e,u),r(e,s),r(s,c),r(c,i),r(i,p),r(i,d),r(i,_),r(i,m),r(i,k),Ue(i,l[3].roles[l[79]].openrouter_chat_model,!0),T(R,w,C),T(R,h,C),r(h,A),r(A,$),r(h,O),r(h,Y),r(Y,M),Ce(M,l[3].roles[l[79]].openrouter_chat_system_prompt),N||(P=[X(i,"change",F),X(M,"input",H)],N=!0)},p(R,C){l=R,C[0]&264&&n!==(n=`openrouter-chat-model-${l[79]}`)&&a(t,"for",n),C[0]&264&&v!==(v=`openrouter-chat-model-${l[79]}`)&&a(i,"id",v),C[0]&264&&Ue(i,l[3].roles[l[79]].openrouter_chat_model),C[0]&264&&b!==(b=`openrouter-chat-system-${l[79]}`)&&a(A,"for",b),C[0]&264&&j!==(j=`openrouter-chat-system-${l[79]}`)&&a(M,"id",j),C[0]&264&&Ce(M,l[3].roles[l[79]].openrouter_chat_system_prompt)},d(R){R&&S(e),R&&S(w),R&&S(h),N=!1,Ke(P)}}}function An(l){let e;return{c(){e=f("p"),e.textContent="Click to select directory",a(e,"class","help")},m(t,o){T(t,e,o)},d(t){t&&S(e)}}}function Ln(l,e){let t,o,n,u,s,c,i,p,d,_,m,k,v,w,h,A,$,b,O,Y,M,j,N,P,F,H,R,C,W,L,U,Q,K,Z,y,E,z,D,V,x,oe,ke,be,De,_e,ce,ue,Le,Ae,le,he,se,ve,Ze,Se,Ne,ee,we,Me,_t,Be,Pe,yt,qe,Et,Ct,Nt,Xe,bt,vt,Je,Dt,I,te,B,ne,de,fe,Ee,He,Te,Ie,ft,st,sl,jt,rl,qt,zt,il,Ot,pt,Fl,pl,Wl,dl,mt,_l,Gl,Jt,Vt,Kl,ml,Bl,Ht,xe,hl,ql,Jl,gl,Yt,Qt,Vl,bl,Yl,vl,St,Zt,Xt,kl,Ql,xt,Mt,Ut,wl,Zl,$l,Xl,Ft,Pt,yl,xl,Cl,eo,to,lo,Wt,oo,Sl,Ul,no;function Zn(){e[26].call(p,e[79])}function Xn(){e[27].call($,e[79])}let el=e[8],et=[];for(let Oe=0;Oe<el.length;Oe+=1)et[Oe]=mn(un(e,el,Oe));function so(){e[28].call(R,e[79])}function ro(){e[29].call(z,e[79])}function xn(){e[30].call(ue,e[79])}let tl=e[77].haystacks,tt=[];for(let Oe=0;Oe<tl.length;Oe+=1)tt[Oe]=kn(rn(e,tl,Oe));function es(){return e[45](e[79])}function io(){e[46].call(Xe,e[79])}let rt=e[3].roles[e[79]].llm_provider==="ollama"&&wn(e);function ts(){e[52].call(Te,e[79])}let it=e[3].roles[e[79]].openrouter_enabled&&Cn(e);function ls(){e[61].call(mt,e[79])}function os(){e[62].call(xe,e[79])}function ao(){return e[63](e[79])}let dt=e[4]&&An();function uo(){e[64].call(St,e[79])}function ns(){e[65].call(Ut,e[79])}function ss(){e[66].call(Pt,e[79])}function rs(){return e[67](e[79])}return{key:l,first:null,c(){t=f("div"),o=f("div"),n=f("label"),u=q("Role name"),c=g(),i=f("div"),p=f("input"),_=g(),m=f("div"),k=f("label"),v=q("Short name"),h=g(),A=f("div"),$=f("input"),O=g(),Y=f("div"),M=f("label"),j=q("Theme"),P=g(),F=f("div"),H=f("div"),R=f("select");for(let Oe=0;Oe<et.length;Oe+=1)et[Oe].c();W=g(),L=f("div"),U=f("label"),Q=q("Relevance function"),Z=g(),y=f("div"),E=f("div"),z=f("select"),D=f("option"),D.textContent="title-scorer",V=f("option"),V.textContent="terraphim-graph",x=f("option"),x.textContent="bm25",oe=f("option"),oe.textContent="bm25f",ke=f("option"),ke.textContent="bm25plus",De=g(),_e=f("div"),ce=f("label"),ue=f("input"),Ae=q(`
            Enable Terraphim IT features (KG preprocessing, auto-linking)`),he=g(),se=f("h5"),se.textContent="Haystacks",ve=g();for(let Oe=0;Oe<tt.length;Oe+=1)tt[Oe].c();Ze=g(),Se=f("button"),Ne=q("Add Haystack"),we=g(),Me=f("h5"),Me.textContent="AI-Enhanced Summaries (LLM Provider)",_t=g(),Be=f("div"),Pe=f("label"),yt=q("Provider"),Et=g(),Ct=f("div"),Nt=f("div"),Xe=f("select"),bt=f("option"),bt.textContent="(none)",vt=f("option"),vt.textContent="OpenRouter",Je=f("option"),Je.textContent="Ollama (local)",I=g(),te=f("p"),te.textContent="Choose a provider. OpenRouter uses API key; Ollama runs locally.",B=g(),rt&&rt.c(),ne=g(),de=f("h5"),de.textContent="AI-Enhanced Summaries (OpenRouter)",fe=g(),Ee=f("div"),He=f("label"),Te=f("input"),ft=q(`
            Â Enable AI-generated article summaries`),sl=g(),jt=f("p"),jt.textContent="Generate intelligent summaries using OpenRouter's language models",rl=g(),it&&it.c(),qt=g(),zt=f("h5"),zt.textContent="Knowledge Graph",il=g(),Ot=f("div"),pt=f("label"),Fl=q("Remote automata URL"),Wl=g(),dl=f("div"),mt=f("input"),Gl=g(),Jt=f("div"),Vt=f("label"),Kl=q("Local KG path"),Bl=g(),Ht=f("div"),xe=f("input"),ql=g(),dt&&dt.c(),Jl=g(),gl=f("div"),Yt=f("div"),Qt=f("label"),Vl=q("Local KG type"),Yl=g(),vl=f("div"),St=f("select"),Zt=f("option"),Zt.textContent="markdown",Xt=f("option"),Xt.textContent="json",Ql=g(),xt=f("div"),Mt=f("label"),Ut=f("input"),Zl=q(`
            Â Public`),Xl=g(),Ft=f("label"),Pt=f("input"),xl=q(`
            Â Publish`),eo=g(),to=f("hr"),lo=g(),Wt=f("button"),oo=q("Remove Role"),a(n,"class","label"),a(n,"for",s=`role-name-${e[79]}`),a(p,"class","input"),a(p,"id",d=`role-name-${e[79]}`),a(p,"type","text"),a(i,"class","control"),a(o,"class","field"),a(k,"class","label"),a(k,"for",w=`role-shortname-${e[79]}`),a($,"class","input"),a($,"id",b=`role-shortname-${e[79]}`),a($,"type","text"),a(A,"class","control"),a(m,"class","field"),a(M,"class","label"),a(M,"for",N=`role-theme-${e[79]}`),a(R,"id",C=`role-theme-${e[79]}`),e[3].roles[e[79]].theme===void 0&&lt(so),a(H,"class","select is-fullwidth"),a(F,"class","control"),a(Y,"class","field"),a(U,"class","label"),a(U,"for",K=`role-relevance-${e[79]}`),D.__value="title-scorer",D.value=D.__value,V.__value="terraphim-graph",V.value=V.__value,x.__value="bm25",x.value=x.__value,oe.__value="bm25f",oe.value=oe.__value,ke.__value="bm25plus",ke.value=ke.__value,a(z,"id",be=`role-relevance-${e[79]}`),e[3].roles[e[79]].relevance_function===void 0&&lt(ro),a(E,"class","select is-fullwidth"),a(y,"class","control"),a(L,"class","field"),a(ue,"class","checkbox"),a(ue,"id",Le=`role-terraphim-it-${e[79]}`),a(ue,"type","checkbox"),a(ce,"class","label"),a(ce,"for",le=`role-terraphim-it-${e[79]}`),a(_e,"class","field"),a(se,"class","title is-6"),a(Se,"class","button is-small"),a(Se,"data-testid",ee="add-haystack-"+e[79]),a(Me,"class","title is-6"),a(Pe,"class","label"),a(Pe,"for",qe=`llm-provider-${e[79]}`),bt.__value="",bt.value=bt.__value,vt.__value="openrouter",vt.value=vt.__value,Je.__value="ollama",Je.value=Je.__value,a(Xe,"id",Dt=`llm-provider-${e[79]}`),e[3].roles[e[79]].llm_provider===void 0&&lt(io),a(Nt,"class","select"),a(Ct,"class","control"),a(te,"class","help"),a(Be,"class","field"),a(de,"class","title is-6"),a(Te,"id",Ie=`openrouter-enabled-${e[79]}`),a(Te,"type","checkbox"),a(He,"class","checkbox"),a(He,"for",st=`openrouter-enabled-${e[79]}`),a(jt,"class","help"),a(Ee,"class","field"),a(zt,"class","title is-6"),a(pt,"class","label"),a(pt,"for",pl=`kg-url-${e[79]}`),a(mt,"class","input"),a(mt,"id",_l=`kg-url-${e[79]}`),a(mt,"type","text"),a(mt,"placeholder","https://example.com/thesaurus.json"),a(dl,"class","control"),a(Ot,"class","field"),a(Vt,"class","label"),a(Vt,"for",ml=`kg-local-path-${e[79]}`),a(xe,"class","input"),a(xe,"id",hl=`kg-local-path-${e[79]}`),a(xe,"type","text"),a(xe,"placeholder","/path/to/markdown"),xe.readOnly=e[4],a(Ht,"class","control"),a(Jt,"class","field"),a(Qt,"class","label"),a(Qt,"for",bl=`kg-local-type-${e[79]}`),Zt.__value="markdown",Zt.value=Zt.__value,Xt.__value="json",Xt.value=Xt.__value,a(St,"id",kl=`kg-local-type-${e[79]}`),e[3].roles[e[79]].kg.local_type===void 0&&lt(uo),a(vl,"class","select"),a(Yt,"class","control"),a(gl,"class","field is-grouped"),a(Ut,"id",wl=`kg-public-${e[79]}`),a(Ut,"type","checkbox"),a(Mt,"class","checkbox"),a(Mt,"for",$l=`kg-public-${e[79]}`),pe(Mt,"margin-right","1rem"),a(Pt,"id",yl=`kg-publish-${e[79]}`),a(Pt,"type","checkbox"),a(Ft,"class","checkbox"),a(Ft,"for",Cl=`kg-publish-${e[79]}`),a(xt,"class","field is-grouped"),a(Wt,"class","button is-small is-danger"),a(Wt,"data-testid",Sl="remove-role-"+e[79]),a(t,"class","box"),this.first=t},m(Oe,me){T(Oe,t,me),r(t,o),r(o,n),r(n,u),r(o,c),r(o,i),r(i,p),Ce(p,e[3].roles[e[79]].name),r(t,_),r(t,m),r(m,k),r(k,v),r(m,h),r(m,A),r(A,$),Ce($,e[3].roles[e[79]].shortname),r(t,O),r(t,Y),r(Y,M),r(M,j),r(Y,P),r(Y,F),r(F,H),r(H,R);for(let $e=0;$e<et.length;$e+=1)et[$e]&&et[$e].m(R,null);Ue(R,e[3].roles[e[79]].theme,!0),r(t,W),r(t,L),r(L,U),r(U,Q),r(L,Z),r(L,y),r(y,E),r(E,z),r(z,D),r(z,V),r(z,x),r(z,oe),r(z,ke),Ue(z,e[3].roles[e[79]].relevance_function,!0),r(t,De),r(t,_e),r(_e,ce),r(ce,ue),ue.checked=e[3].roles[e[79]].terraphim_it,r(ce,Ae),r(t,he),r(t,se),r(t,ve);for(let $e=0;$e<tt.length;$e+=1)tt[$e]&&tt[$e].m(t,null);r(t,Ze),r(t,Se),r(Se,Ne),r(t,we),r(t,Me),r(t,_t),r(t,Be),r(Be,Pe),r(Pe,yt),r(Be,Et),r(Be,Ct),r(Ct,Nt),r(Nt,Xe),r(Xe,bt),r(Xe,vt),r(Xe,Je),Ue(Xe,e[3].roles[e[79]].llm_provider,!0),r(Be,I),r(Be,te),r(t,B),rt&&rt.m(t,null),r(t,ne),r(t,de),r(t,fe),r(t,Ee),r(Ee,He),r(He,Te),Te.checked=e[3].roles[e[79]].openrouter_enabled,r(He,ft),r(Ee,sl),r(Ee,jt),r(t,rl),it&&it.m(t,null),r(t,qt),r(t,zt),r(t,il),r(t,Ot),r(Ot,pt),r(pt,Fl),r(Ot,Wl),r(Ot,dl),r(dl,mt),Ce(mt,e[3].roles[e[79]].kg.url),r(t,Gl),r(t,Jt),r(Jt,Vt),r(Vt,Kl),r(Jt,Bl),r(Jt,Ht),r(Ht,xe),Ce(xe,e[3].roles[e[79]].kg.local_path),r(Ht,ql),dt&&dt.m(Ht,null),r(t,Jl),r(t,gl),r(gl,Yt),r(Yt,Qt),r(Qt,Vl),r(Yt,Yl),r(Yt,vl),r(vl,St),r(St,Zt),r(St,Xt),Ue(St,e[3].roles[e[79]].kg.local_type,!0),r(t,Ql),r(t,xt),r(xt,Mt),r(Mt,Ut),Ut.checked=e[3].roles[e[79]].kg.public,r(Mt,Zl),r(xt,Xl),r(xt,Ft),r(Ft,Pt),Pt.checked=e[3].roles[e[79]].kg.publish,r(Ft,xl),r(t,eo),r(t,to),r(t,lo),r(t,Wt),r(Wt,oo),Ul||(no=[X(p,"input",Zn),X($,"input",Xn),X(R,"change",so),X(z,"change",ro),X(ue,"change",xn),X(Se,"click",es),X(Xe,"change",io),X(Te,"change",ts),X(mt,"input",ls),X(xe,"input",os),X(xe,"click",function(){jl(e[4]?ao:void 0)&&(e[4]?ao:void 0).apply(this,arguments)}),X(St,"change",uo),X(Ut,"change",ns),X(Pt,"change",ss),X(Wt,"click",rs)],Ul=!0)},p(Oe,me){if(e=Oe,me[0]&264&&s!==(s=`role-name-${e[79]}`)&&a(n,"for",s),me[0]&264&&d!==(d=`role-name-${e[79]}`)&&a(p,"id",d),me[0]&264&&p.value!==e[3].roles[e[79]].name&&Ce(p,e[3].roles[e[79]].name),me[0]&264&&w!==(w=`role-shortname-${e[79]}`)&&a(k,"for",w),me[0]&264&&b!==(b=`role-shortname-${e[79]}`)&&a($,"id",b),me[0]&264&&$.value!==e[3].roles[e[79]].shortname&&Ce($,e[3].roles[e[79]].shortname),me[0]&264&&N!==(N=`role-theme-${e[79]}`)&&a(M,"for",N),me[0]&256){el=e[8];let $e;for($e=0;$e<el.length;$e+=1){const al=un(e,el,$e);et[$e]?et[$e].p(al,me):(et[$e]=mn(al),et[$e].c(),et[$e].m(R,null))}for(;$e<et.length;$e+=1)et[$e].d(1);et.length=el.length}if(me[0]&264&&C!==(C=`role-theme-${e[79]}`)&&a(R,"id",C),me[0]&264&&Ue(R,e[3].roles[e[79]].theme),me[0]&264&&K!==(K=`role-relevance-${e[79]}`)&&a(U,"for",K),me[0]&264&&be!==(be=`role-relevance-${e[79]}`)&&a(z,"id",be),me[0]&264&&Ue(z,e[3].roles[e[79]].relevance_function),me[0]&264&&Le!==(Le=`role-terraphim-it-${e[79]}`)&&a(ue,"id",Le),me[0]&264&&(ue.checked=e[3].roles[e[79]].terraphim_it),me[0]&264&&le!==(le=`role-terraphim-it-${e[79]}`)&&a(ce,"for",le),me[0]&491576){tl=e[77].haystacks;let $e;for($e=0;$e<tl.length;$e+=1){const al=rn(e,tl,$e);tt[$e]?tt[$e].p(al,me):(tt[$e]=kn(al),tt[$e].c(),tt[$e].m(t,Ze))}for(;$e<tt.length;$e+=1)tt[$e].d(1);tt.length=tl.length}me[0]&264&&ee!==(ee="add-haystack-"+e[79])&&a(Se,"data-testid",ee),me[0]&264&&qe!==(qe=`llm-provider-${e[79]}`)&&a(Pe,"for",qe),me[0]&264&&Dt!==(Dt=`llm-provider-${e[79]}`)&&a(Xe,"id",Dt),me[0]&264&&Ue(Xe,e[3].roles[e[79]].llm_provider),e[3].roles[e[79]].llm_provider==="ollama"?rt?rt.p(e,me):(rt=wn(e),rt.c(),rt.m(t,ne)):rt&&(rt.d(1),rt=null),me[0]&264&&Ie!==(Ie=`openrouter-enabled-${e[79]}`)&&a(Te,"id",Ie),me[0]&264&&(Te.checked=e[3].roles[e[79]].openrouter_enabled),me[0]&264&&st!==(st=`openrouter-enabled-${e[79]}`)&&a(He,"for",st),e[3].roles[e[79]].openrouter_enabled?it?it.p(e,me):(it=Cn(e),it.c(),it.m(t,qt)):it&&(it.d(1),it=null),me[0]&264&&pl!==(pl=`kg-url-${e[79]}`)&&a(pt,"for",pl),me[0]&264&&_l!==(_l=`kg-url-${e[79]}`)&&a(mt,"id",_l),me[0]&264&&mt.value!==e[3].roles[e[79]].kg.url&&Ce(mt,e[3].roles[e[79]].kg.url),me[0]&264&&ml!==(ml=`kg-local-path-${e[79]}`)&&a(Vt,"for",ml),me[0]&264&&hl!==(hl=`kg-local-path-${e[79]}`)&&a(xe,"id",hl),me[0]&16&&(xe.readOnly=e[4]),me[0]&264&&xe.value!==e[3].roles[e[79]].kg.local_path&&Ce(xe,e[3].roles[e[79]].kg.local_path),e[4]?dt||(dt=An(),dt.c(),dt.m(Ht,null)):dt&&(dt.d(1),dt=null),me[0]&264&&bl!==(bl=`kg-local-type-${e[79]}`)&&a(Qt,"for",bl),me[0]&264&&kl!==(kl=`kg-local-type-${e[79]}`)&&a(St,"id",kl),me[0]&264&&Ue(St,e[3].roles[e[79]].kg.local_type),me[0]&264&&wl!==(wl=`kg-public-${e[79]}`)&&a(Ut,"id",wl),me[0]&264&&(Ut.checked=e[3].roles[e[79]].kg.public),me[0]&264&&$l!==($l=`kg-public-${e[79]}`)&&a(Mt,"for",$l),me[0]&264&&yl!==(yl=`kg-publish-${e[79]}`)&&a(Pt,"id",yl),me[0]&264&&(Pt.checked=e[3].roles[e[79]].kg.publish),me[0]&264&&Cl!==(Cl=`kg-publish-${e[79]}`)&&a(Ft,"for",Cl),me[0]&264&&Sl!==(Sl="remove-role-"+e[79])&&a(Wt,"data-testid",Sl)},d(Oe){Oe&&S(t),Ge(et,Oe),Ge(tt,Oe),rt&&rt.d(),it&&it.d(),dt&&dt.d(),Ul=!1,Ke(no)}}}function Nn(l){let e,t=l[74]+"",o;return{c(){e=f("option"),o=q(t),e.__value=l[74],e.value=e.__value},m(n,u){T(n,e,u),r(e,o)},p:ye,d(n){n&&S(e)}}}function On(l){let e,t=l[71].name+"",o,n;return{c(){e=f("option"),o=q(t),e.__value=n=l[71].name,e.value=e.__value},m(u,s){T(u,e,s),r(e,o)},p(u,s){s[0]&8&&t!==(t=u[71].name+"")&&ge(o,t),s[0]&264&&n!==(n=u[71].name)&&(e.__value=n,e.value=e.__value)},d(u){u&&S(e)}}}function Un(l){let e,t,o;return{c(){e=f("button"),e.textContent="Back",a(e,"class","button"),a(e,"data-testid","wizard-back")},m(n,u){T(n,e,u),t||(o=X(e,"click",l[11]),t=!0)},p:ye,d(n){n&&S(e),t=!1,o()}}}function pi(l){let e,t,o;return{c(){e=f("button"),e.textContent="Save",a(e,"class","button is-success"),a(e,"data-testid","wizard-save")},m(n,u){T(n,e,u),t||(o=X(e,"click",l[19]),t=!0)},p:ye,d(n){n&&S(e),t=!1,o()}}}function di(l){let e,t,o;return{c(){e=f("button"),e.textContent="Next",a(e,"class","button is-primary"),a(e,"data-testid","wizard-next")},m(n,u){T(n,e,u),t||(o=X(e,"click",l[10]),t=!0)},p:ye,d(n){n&&S(e),t=!1,o()}}}function _i(l){let e,t,o,n,u,s,c,i,p,d,_,m,k,v,w,h,A,$;e=new nl({props:{fallbackPath:"/"}});let b=l[2]==="success"&&pn(l),O=l[2]==="error"&&dn(l);function Y(R,C){return R[1]===1?ui:R[1]===2?ai:ii}let M=Y(l),j=M(l),N=l[1]>1&&Un(l);function P(R,C){return R[1]<Qn?di:pi}let F=P(l),H=F(l);return{c(){re(e.$$.fragment),t=g(),o=f("div"),n=f("div"),u=f("h3"),u.textContent="Configuration Wizard",s=g(),c=f("button"),c.textContent="Close",i=g(),b&&b.c(),p=g(),O&&O.c(),d=g(),j.c(),_=g(),m=f("nav"),k=f("div"),N&&N.c(),v=g(),w=f("div"),H.c(),a(u,"class","title is-4"),pe(u,"margin-bottom","0"),a(c,"class","button is-small is-light"),a(c,"aria-label","Close configuration wizard"),a(n,"class","is-flex is-justify-content-space-between is-align-items-center"),pe(n,"gap",".5rem"),a(k,"class","level-left"),a(w,"class","level-right"),a(m,"class","level"),a(o,"class","box")},m(R,C){ie(e,R,C),T(R,t,C),T(R,o,C),r(o,n),r(n,u),r(n,s),r(n,c),r(o,i),b&&b.m(o,null),r(o,p),O&&O.m(o,null),r(o,d),j.m(o,null),r(o,_),r(o,m),r(m,k),N&&N.m(k,null),r(m,v),r(m,w),H.m(w,null),h=!0,A||($=X(c,"click",mi),A=!0)},p(R,C){R[2]==="success"?b?b.p(R,C):(b=pn(R),b.c(),b.m(o,p)):b&&(b.d(1),b=null),R[2]==="error"?O?O.p(R,C):(O=dn(R),O.c(),O.m(o,d)):O&&(O.d(1),O=null),M===(M=Y(R))&&j?j.p(R,C):(j.d(1),j=M(R),j&&(j.c(),j.m(o,_))),R[1]>1?N?N.p(R,C):(N=Un(R),N.c(),N.m(k,null)):N&&(N.d(1),N=null),F===(F=P(R))&&H?H.p(R,C):(H.d(1),H=F(R),H&&(H.c(),H.m(w,null)))},i(R){h||(G(e.$$.fragment,R),h=!0)},o(R){J(e.$$.fragment,R),h=!1},d(R){ae(e,R),R&&S(t),R&&S(o),b&&b.d(),O&&O.d(),j.d(),N&&N.d(),H.d(),A=!1,$()}}}const Qn=3;function mi(){typeof window<"u"&&window.history.back()}function hi(l,e,t){let o,n;Re(l,Ve,I=>t(4,n=I));const u=$t(null);async function s(I,te){if(wt(Ve))try{const B=await tn({directory:!0,multiple:!1});B&&typeof B=="string"&&i.update(ne=>(ne.roles[I].haystacks[te].path=B,ne))}catch(B){console.error("Failed to open folder selector:",B)}}async function c(I){if(wt(Ve))try{const te=await tn({directory:!0,multiple:!1});te&&typeof te=="string"&&i.update(B=>(B.roles[I].kg.local_path=te,B))}catch(te){console.error("Failed to open folder selector:",te)}}const i=$t({id:"Desktop",global_shortcut:"Ctrl+X",default_theme:"spacelab",default_role:"Default",roles:[]});Re(l,i,I=>t(3,o=I));const p=["default","darkly","cerulean","cosmo","cyborg","flatly","journal","litera","lumen","lux","materia","minty","nuclear","pulse","sandstone","simplex","slate","solar","spacelab","superhero","united","yeti"];Kt(async()=>{try{let I;wt(Ve)?I=await Fe("get_config_schema"):I=await(await fetch("/config/schema")).json(),u.set(I);const te=wt(gt);te&&te.id&&i.update(B=>{var ne;return{...B,id:te.id,global_shortcut:te.global_shortcut,default_theme:((ne=te.roles[te.default_role])==null?void 0:ne.theme)??"spacelab",default_role:te.default_role,roles:Object.values(te.roles).map(de=>{var Te,Ie,ft,st,sl,jt,rl,qt,zt,il,Ot;const fe=(Te=de.kg)==null?void 0:Te.automata_path,Ee=(fe==null?void 0:fe.Remote)??"",He=((ft=(Ie=de.kg)==null?void 0:Ie.knowledge_graph_local)==null?void 0:ft.path)??"";return{name:de.name,shortname:de.shortname,relevance_function:de.relevance_function,terraphim_it:de.terraphim_it??!1,theme:de.theme,haystacks:(de.haystacks??[]).map(pt=>({path:pt.location||pt.path||"",read_only:pt.read_only??!1,service:pt.service||"Ripgrep",atomic_server_secret:pt.atomic_server_secret||"",extra_parameters:pt.extra_parameters||{}})),kg:{url:Ee,local_path:He,local_type:((sl=(st=de.kg)==null?void 0:st.knowledge_graph_local)==null?void 0:sl.input_type)??"markdown",public:((jt=de.kg)==null?void 0:jt.public)??!1,publish:((rl=de.kg)==null?void 0:rl.publish)??!1},openrouter_enabled:de.openrouter_enabled??!1,openrouter_api_key:de.openrouter_api_key??"",openrouter_model:de.openrouter_model??"openai/gpt-3.5-turbo",openrouter_auto_summarize:de.openrouter_auto_summarize??!1,openrouter_chat_enabled:de.openrouter_chat_enabled??!1,openrouter_chat_model:de.openrouter_chat_model??de.openrouter_model??"openai/gpt-3.5-turbo",openrouter_chat_system_prompt:de.openrouter_chat_system_prompt??"",llm_provider:((qt=de.extra)==null?void 0:qt.llm_provider)??"",llm_model:((zt=de.extra)==null?void 0:zt.llm_model)??"",llm_base_url:((il=de.extra)==null?void 0:il.llm_base_url)??"",llm_auto_summarize:((Ot=de.extra)==null?void 0:Ot.llm_auto_summarize)??!1}})}})}catch(I){console.error("Failed to load schema",I)}}),Kt(()=>{const I=te=>{te.key==="Escape"&&typeof window<"u"&&window.history.back()};return window.addEventListener("keydown",I),()=>window.removeEventListener("keydown",I)});let d={};async function _(I){var fe;const B=wt(i).roles[I],ne=B.llm_provider||(B.openrouter_enabled?"openrouter":""),de=[];try{if(ne==="ollama"){const Ee=(B.llm_base_url||"http://127.0.0.1:11434").replace(/\/$/,""),Te=await(await fetch(`${Ee}/api/tags`)).json();if(Array.isArray(Te==null?void 0:Te.models))for(const Ie of Te.models)Ie!=null&&Ie.name&&de.push(Ie.name)}else if(ne==="openrouter"){const Ee=(fe=B.openrouter_api_key)==null?void 0:fe.trim();if(!Ee)throw new Error("OpenRouter API key required");const Te=await(await fetch("https://openrouter.ai/api/v1/models",{headers:{Authorization:`Bearer ${Ee}`,"HTTP-Referer":"https://terraphim.ai","X-Title":"Terraphim Desktop"}})).json(),Ie=Array.isArray(Te==null?void 0:Te.data)?Te.data:[];for(const ft of Ie)ft!=null&&ft.id&&de.push(ft.id)}}catch(Ee){console.error("Failed to fetch models",Ee)}t(0,d={...d,[I]:de})}let m=1,k="";function v(){m<Qn&&t(1,m+=1)}function w(){m>1&&t(1,m-=1)}function h(){i.update(I=>({...I,roles:[...I.roles,{name:"New Role",shortname:"new",relevance_function:"title-scorer",terraphim_it:!1,theme:"spacelab",haystacks:[],kg:{url:"",local_path:"",local_type:"markdown",public:!1,publish:!1},openrouter_enabled:!1,openrouter_api_key:"",openrouter_model:"openai/gpt-3.5-turbo",openrouter_auto_summarize:!1,openrouter_chat_enabled:!1,openrouter_chat_model:"openai/gpt-3.5-turbo",openrouter_chat_system_prompt:"",llm_provider:"",llm_model:"",llm_base_url:"",llm_auto_summarize:!1}]}))}function A(I){i.update(te=>({...te,roles:te.roles.filter((B,ne)=>ne!==I)}))}function $(I){i.update(te=>(te.roles[I].haystacks.push({path:"",read_only:!1,service:"Ripgrep",atomic_server_secret:"",extra_parameters:{}}),te))}function b(I,te){i.update(B=>(B.roles[I].haystacks=B.roles[I].haystacks.filter((ne,de)=>de!==te),B))}function O(I,te,B="",ne=""){i.update(de=>{de.roles[I].haystacks[te].extra_parameters||(de.roles[I].haystacks[te].extra_parameters={});const fe=B||`param_${Date.now()}`;return de.roles[I].haystacks[te].extra_parameters[fe]=ne,de})}function Y(I,te,B){i.update(ne=>(delete ne.roles[I].haystacks[te].extra_parameters[B],ne))}function M(I,te,B,ne){i.update(de=>{const fe=de.roles[I].haystacks[te].extra_parameters;return fe[B]!==void 0&&B!==ne&&(fe[ne]=fe[B],delete fe[B]),de})}function j(I,te,B,ne){const de=ne.target.value;M(I,te,B,de)}async function N(){var de;const I=wt(i),te=wt(gt);let B={...te};B.id=I.id,B.global_shortcut=I.global_shortcut,B.default_role=I.default_role;const ne={};I.roles.forEach(fe=>{var Ie,ft;const Ee=fe.name,He=Ee.replace(/^"|"$/g,"");ne[He]={extra:((ft=(Ie=te.roles)==null?void 0:Ie[Ee])==null?void 0:ft.extra)??{},name:fe.name,shortname:fe.shortname,theme:fe.theme,relevance_function:fe.relevance_function,terraphim_it:fe.terraphim_it??!1,haystacks:fe.haystacks.map(st=>({location:st.path,service:st.service,read_only:st.read_only,atomic_server_secret:st.service==="Atomic"?st.atomic_server_secret:void 0,extra_parameters:st.extra_parameters||{}})),kg:fe.kg.url||fe.kg.local_path?{automata_path:fe.kg.url?{Remote:fe.kg.url}:null,knowledge_graph_local:fe.kg.local_path?{input_type:fe.kg.local_type,path:fe.kg.local_path}:null,public:fe.kg.public,publish:fe.kg.publish}:null,...fe.openrouter_enabled&&{openrouter_enabled:fe.openrouter_enabled,openrouter_api_key:fe.openrouter_api_key,openrouter_model:fe.openrouter_model,openrouter_auto_summarize:fe.openrouter_auto_summarize??!1,openrouter_chat_enabled:fe.openrouter_chat_enabled??!1,openrouter_chat_model:fe.openrouter_chat_model??fe.openrouter_model,openrouter_chat_system_prompt:fe.openrouter_chat_system_prompt??""}};const Te={};fe.llm_provider&&(Te.llm_provider=fe.llm_provider),fe.llm_model&&(Te.llm_model=fe.llm_model),fe.llm_base_url&&(Te.llm_base_url=fe.llm_base_url),typeof fe.llm_auto_summarize=="boolean"&&(Te.llm_auto_summarize=fe.llm_auto_summarize),ne[He].extra={...ne[He].extra||{},...Te}}),B.roles=ne,(!B.default_role||!ne[B.default_role])&&(B.default_role=((de=I.roles[0])==null?void 0:de.name)??"Default"),B.selected_role=B.default_role;try{if(wt(Ve))await Fe("update_config",{configNew:B});else{const fe=await fetch("/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(B)});if(!fe.ok)throw new Error(`HTTP ${fe.status}: ${fe.statusText}`)}gt.set(B),t(2,k="success"),setTimeout(()=>{t(2,k="")},3e3)}catch(fe){console.error(fe),t(2,k="error"),setTimeout(()=>{t(2,k="")},3e3)}}const P=()=>t(2,k=""),F=()=>t(2,k="");function H(){o.id=kt(this),i.set(o),t(8,p)}function R(){o.global_shortcut=this.value,i.set(o),t(8,p)}function C(){o.default_theme=kt(this),i.set(o),t(8,p)}function W(){o.default_role=kt(this),i.set(o),t(8,p)}function L(I){o.roles[I].name=this.value,i.set(o),t(8,p)}function U(I){o.roles[I].shortname=this.value,i.set(o),t(8,p)}function Q(I){o.roles[I].theme=kt(this),i.set(o),t(8,p)}function K(I){o.roles[I].relevance_function=kt(this),i.set(o),t(8,p)}function Z(I){o.roles[I].terraphim_it=this.checked,i.set(o),t(8,p)}function y(I,te){o.roles[I].haystacks[te].service=kt(this),i.set(o),t(8,p)}function E(I,te){o.roles[I].haystacks[te].path=this.value,i.set(o),t(8,p)}const z=(I,te)=>s(I,te);function D(I,te){o.roles[I].haystacks[te].atomic_server_secret=this.value,i.set(o),t(8,p)}function V(I,te){o.roles[I].haystacks[te].extra_parameters.tag=this.value,i.set(o),t(8,p)}const x=(I,te,B)=>{const ne=B.currentTarget.value;ne&&cl(i,o.roles[I].haystacks[te].extra_parameters.tag=ne,o)},oe=(I,te,B,ne)=>j(I,te,B,ne);function ke(I,te,B){o.roles[I].haystacks[te].extra_parameters[B]=this.value,i.set(o),t(8,p)}const be=(I,te,B)=>Y(I,te,B),De=(I,te)=>O(I,te,"tag","#rust"),_e=(I,te)=>O(I,te,"max_count","10"),ce=(I,te)=>O(I,te,"","");function ue(I,te){o.roles[I].haystacks[te].read_only=this.checked,i.set(o),t(8,p)}const Le=(I,te)=>b(I,te),Ae=I=>$(I);function le(I){o.roles[I].llm_provider=kt(this),i.set(o),t(8,p)}function he(I){o.roles[I].llm_model=this.value,i.set(o),t(8,p)}const se=I=>_(I),ve=(I,te)=>{cl(i,o.roles[I].llm_model=te.currentTarget.value,o)};function Ze(I){o.roles[I].llm_base_url=this.value,i.set(o),t(8,p)}function Se(I){o.roles[I].llm_auto_summarize=this.checked,i.set(o),t(8,p)}function Ne(I){o.roles[I].openrouter_enabled=this.checked,i.set(o),t(8,p)}function ee(I){o.roles[I].openrouter_api_key=this.value,i.set(o),t(8,p)}function we(I){o.roles[I].openrouter_model=this.value,i.set(o),t(8,p)}const Me=I=>_(I),_t=(I,te)=>{cl(i,o.roles[I].openrouter_model=te.currentTarget.value,o)};function Be(I){o.roles[I].openrouter_auto_summarize=this.checked,i.set(o),t(8,p)}function Pe(I){o.roles[I].openrouter_chat_enabled=this.checked,i.set(o),t(8,p)}function yt(I){o.roles[I].openrouter_chat_model=kt(this),i.set(o),t(8,p)}function qe(I){o.roles[I].openrouter_chat_system_prompt=this.value,i.set(o),t(8,p)}function Et(I){o.roles[I].kg.url=this.value,i.set(o),t(8,p)}function Ct(I){o.roles[I].kg.local_path=this.value,i.set(o),t(8,p)}const Nt=I=>c(I);function Xe(I){o.roles[I].kg.local_type=kt(this),i.set(o),t(8,p)}function bt(I){o.roles[I].kg.public=this.checked,i.set(o),t(8,p)}function vt(I){o.roles[I].kg.publish=this.checked,i.set(o),t(8,p)}return[d,m,k,o,n,s,c,i,p,_,v,w,h,A,$,b,O,Y,j,N,P,F,H,R,C,W,L,U,Q,K,Z,y,E,z,D,V,x,oe,ke,be,De,_e,ce,ue,Le,Ae,le,he,se,ve,Ze,Se,Ne,ee,we,Me,_t,Be,Pe,yt,qe,Et,Ct,Nt,Xe,bt,vt,I=>A(I),()=>{t(1,m=2)}]}class gi extends ut{constructor(e){super(),ct(this,e,hi,_i,ot,{},null,[-1,-1,-1,-1])}}function bi(l){let e,t,o,n,u,s,c,i;return e=new nl({props:{fallbackPath:"/"}}),c=new Jn({props:{content:l[0],onChange:l[1]}}),{c(){re(e.$$.fragment),t=g(),o=f("div"),n=f("p"),n.innerHTML="<i>The best editing experience is to configure Atomic Server, in the meantime use editor below. You will need to refresh page via Command R or Ctrl-R to see changes</i>",u=g(),s=f("div"),re(c.$$.fragment),a(s,"class","editor"),a(o,"class","box")},m(p,d){ie(e,p,d),T(p,t,d),T(p,o,d),r(o,n),r(o,u),r(o,s),ie(c,s,null),i=!0},p(p,[d]){const _={};d&1&&(_.content=p[0]),c.$set(_)},i(p){i||(G(e.$$.fragment,p),G(c.$$.fragment,p),i=!0)},o(p){J(e.$$.fragment,p),J(c.$$.fragment,p),i=!1},d(p){ae(e,p),p&&S(t),p&&S(o),ae(c)}}}function vi(l,e,t){let o,n;Re(l,gt,c=>t(2,o=c)),Re(l,Ve,c=>t(3,n=c));let u={json:o};function s(c){if(console.log("contents changed:",c),console.log("is tauri",n),gt.update(i=>(i=c.json,i)),wt(Ve))console.log("Updating config on server"),Fe("update_config",{configNew:c.json}).then(i=>{console.log(`Message: ${i}`)}).catch(i=>console.error(i));else{let i=`${at.ServerURL}/config/`;fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c.json)})}t(0,u=c)}return Kt(()=>{t(0,u={json:o})}),[u,s]}class ki extends ut{constructor(e){super(),ct(this,e,vi,bi,ot,{})}}const{window:Ml}=hs;function wi(l){let e,t,o,n,u,s,c,i,p,d;return{c(){e=f("div"),t=f("div"),o=f("h3"),o.textContent="Error loading graph",n=g(),u=f("p"),s=q(l[3]),c=g(),i=f("button"),i.textContent="Retry",a(i,"class","button is-primary"),a(t,"class","error-content svelte-1ry9pkl"),a(e,"class","error-overlay svelte-1ry9pkl")},m(_,m){T(_,e,m),r(e,t),r(t,o),r(t,n),r(t,u),r(u,s),r(t,c),r(t,i),p||(d=X(i,"click",l[11]),p=!0)},p(_,m){m&8&&ge(s,_[3])},d(_){_&&S(e),p=!1,d()}}}function $i(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="loading-content svelte-1ry9pkl"><div class="loader svelte-1ry9pkl"></div> 
        <p>Loading knowledge graph...</p></div>`,a(e,"class","loading-overlay svelte-1ry9pkl")},m(t,o){T(t,e,o)},p:ye,d(t){t&&S(e)}}}function Pn(l){let e,t,o;return{c(){e=f("button"),e.innerHTML='<i class="fas fa-times svelte-1ry9pkl"></i>',a(e,"class","close-button svelte-1ry9pkl"),a(e,"title","Close Graph")},m(n,u){T(n,e,u),t||(o=X(e,"click",l[17]),t=!0)},p:ye,d(n){n&&S(e),t=!1,o()}}}function En(l){let e;return{c(){e=f("div"),e.innerHTML="<span><strong>Left-click:</strong> View node â€¢ <strong>Right-click:</strong> Edit node â€¢ <strong>Drag:</strong> Move â€¢ <strong>Scroll:</strong> Zoom</span>",a(e,"class","controls-info svelte-1ry9pkl")},m(t,o){T(t,e,o)},d(t){t&&S(e)}}}function Dn(l){let e,t;return{c(){e=f("div"),t=q(l[8]),a(e,"class","debug-message svelte-1ry9pkl")},m(o,n){T(o,e,n),r(e,t)},p(o,n){n&256&&ge(t,o[8])},d(o){o&&S(e)}}}function Mn(l){let e=l[5].id,t,o,n=In(l);return{c(){n.c(),t=nt()},m(u,s){n.m(u,s),T(u,t,s),o=!0},p(u,s){s&32&&ot(e,e=u[5].id)?(je(),J(n,1,1,ye),ze(),n=In(u),n.c(),G(n,1),n.m(t.parentNode,t)):n.p(u,s)},i(u){o||(G(n),o=!0)},o(u){J(n),o=!1},d(u){u&&S(t),n.d(u)}}}function In(l){let e,t,o;function n(s){l[18](s)}let u={item:l[5],initialEdit:l[7]};return l[6]!==void 0&&(u.active=l[6]),e=new zl({props:u}),We.push(()=>Ye(e,"active",n)),e.$on("close",l[12]),e.$on("save",l[13]),{c(){re(e.$$.fragment)},m(s,c){ie(e,s,c),o=!0},p(s,c){const i={};c&32&&(i.item=s[5]),c&128&&(i.initialEdit=s[7]),!t&&c&64&&(t=!0,i.active=s[6],Qe(()=>t=!1)),e.$set(i)},i(s){o||(G(e.$$.fragment,s),o=!0)},o(s){J(e.$$.fragment,s),o=!1},d(s){ae(e,s)}}}function yi(l){let e,t,o,n,u,s,c,i,p,d,_;lt(l[15]),e=new nl({props:{fallbackPath:"/"}});function m(b,O){if(b[2])return $i;if(b[3])return wi}let k=m(l),v=k&&k(l),w=l[0]&&Pn(l),h=!l[2]&&!l[3]&&l[4].length>0&&En(),A=l[8]&&Dn(l),$=l[5]&&Mn(l);return{c(){re(e.$$.fragment),t=g(),o=f("div"),v&&v.c(),n=g(),w&&w.c(),u=g(),h&&h.c(),s=g(),A&&A.c(),c=g(),$&&$.c(),i=nt(),a(o,"class","graph-container svelte-1ry9pkl"),pe(o,"width",l[0]?"100vw":"600px"),pe(o,"height",l[0]?"100vh":"400px"),Lt(o,"fullscreen",l[0])},m(b,O){ie(e,b,O),T(b,t,O),T(b,o,O),v&&v.m(o,null),l[16](o),T(b,n,O),w&&w.m(b,O),T(b,u,O),h&&h.m(b,O),T(b,s,O),A&&A.m(b,O),T(b,c,O),$&&$.m(b,O),T(b,i,O),p=!0,d||(_=X(Ml,"resize",l[15]),d=!0)},p(b,[O]){k===(k=m(b))&&v?v.p(b,O):(v&&v.d(1),v=k&&k(b),v&&(v.c(),v.m(o,null))),(!p||O&1)&&pe(o,"width",b[0]?"100vw":"600px"),(!p||O&1)&&pe(o,"height",b[0]?"100vh":"400px"),(!p||O&1)&&Lt(o,"fullscreen",b[0]),b[0]?w?w.p(b,O):(w=Pn(b),w.c(),w.m(u.parentNode,u)):w&&(w.d(1),w=null),!b[2]&&!b[3]&&b[4].length>0?h||(h=En(),h.c(),h.m(s.parentNode,s)):h&&(h.d(1),h=null),b[8]?A?A.p(b,O):(A=Dn(b),A.c(),A.m(c.parentNode,c)):A&&(A.d(1),A=null),b[5]?$?($.p(b,O),O&32&&G($,1)):($=Mn(b),$.c(),G($,1),$.m(i.parentNode,i)):$&&(je(),J($,1,1,()=>{$=null}),ze())},i(b){p||(G(e.$$.fragment,b),G($),p=!0)},o(b){J(e.$$.fragment,b),J($),p=!1},d(b){ae(e,b),b&&S(t),b&&S(o),v&&v.d(),l[16](null),b&&S(n),w&&w.d(b),b&&S(u),h&&h.d(b),b&&S(s),A&&A.d(b),b&&S(c),$&&$.d(b),b&&S(i),d=!1,_()}}}function jn(l){return{id:`kg-node-${l.id}`,url:`#/graph/node/${l.id}`,title:l.label,body:`# ${l.label}

**Knowledge Graph Node**

ID: ${l.id}
Rank: ${l.rank}

This is a concept node from the knowledge graph. You can edit this content to add more information about "${l.label}".`,description:`Knowledge graph concept: ${l.label}`,tags:["knowledge-graph","concept"],rank:l.rank,stub:`Knowledge graph concept: ${l.label}`}}function Ci(l,e,t){let o,n;Re(l,Rt,C=>t(20,o=C)),Re(l,Ve,C=>t(21,n=C));let{apiUrl:u="/rolegraph"}=e,{fullscreen:s=!0}=e,c,i=!0,p=null,d=[],_=[],m=null,k=!1,v=!1,w="",h=window.innerWidth,A=window.innerHeight;function $(){t(9,h=window.innerWidth),t(10,A=window.innerHeight),!i&&!p&&N()}async function b(){t(2,i=!0),t(3,p=null);try{if(n){console.log("Loading rolegraph from Tauri");const C=await Fe("get_rolegraph",{role_name:o||void 0});if(C&&C.status==="success")t(4,d=C.nodes),_=C.edges;else throw new Error(`Tauri rolegraph fetch failed: ${(C==null?void 0:C.status)||"unknown error"}`)}else{console.log("Loading rolegraph from server");const C=o?`${u}?role=${encodeURIComponent(o)}`:u,W=await fetch(C);if(!W.ok)throw new Error(`Failed to fetch: ${W.status}`);const L=await W.json();t(4,d=L.nodes),_=L.edges}}catch(C){t(3,p=C.message),console.error("Error fetching rolegraph:",C)}finally{t(2,i=!1)}}function O(C,W){C.stopPropagation(),console.log("Node clicked:",W.label),t(5,m=jn(W)),t(7,v=!1),t(6,k=!0)}function Y(C,W){C.preventDefault(),C.stopPropagation(),console.log("Node right-clicked:",W.label),t(8,w=`Right-clicked: ${W.label}`),t(5,m=jn(W)),t(7,v=!0),t(6,k=!0),setTimeout(()=>{t(8,w="")},2e3)}function M(){t(6,k=!1),t(5,m=null),t(7,v=!1)}async function j(){if(m)try{const C=await fetch("/documents",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)});C.ok?console.log("Successfully saved KG record:",m.id):console.error("Failed to save KG record:",C.statusText)}catch(C){console.error("Error saving KG record:",C)}finally{t(6,k=!1),t(5,m=null),t(7,v=!1)}}function N(){if(!c)return;t(1,c.innerHTML="",c);const C=Pl(c).append("svg").attr("width",h).attr("height",A),W=Cs().scaleExtent([.1,10]).on("zoom",D=>{L.attr("transform",D.transform)});C.call(W);const L=C.append("g"),U=Ss(d).force("link",Ts(_).id(D=>D.id).distance(100)).force("charge",Rs().strength(-200)).force("center",As(h/2,A/2)).force("collision",Ls().radius(20)),Q=L.append("g").attr("class","links").selectAll("line").data(_).enter().append("line").attr("stroke","#666").attr("stroke-opacity",.7).attr("stroke-width",D=>{const V=D.weight||D.rank||1;return Math.max(1,Math.min(8,V*2))}),K=L.append("g").attr("class","nodes").selectAll("circle").data(d).enter().append("circle").attr("r",D=>{const V=D.rank||1;return Math.max(6,Math.min(20,V*2))}).attr("fill",D=>{const V=D.rank||1,x=Math.min(V/10,1);return Ns(.2+x*.6)}).attr("stroke","#fff").attr("stroke-width",2).style("cursor","pointer").on("click",(D,V)=>O(D,V)).on("contextmenu",(D,V)=>Y(D,V)).on("mouseover",function(D,V){Pl(this).transition().duration(150).attr("stroke-width",3).attr("r",x=>{const oe=x.rank||1;return Math.max(8,Math.min(24,oe*2.5))})}).on("mouseout",function(D,V){Pl(this).transition().duration(150).attr("stroke-width",2).attr("r",x=>{const oe=x.rank||1;return Math.max(6,Math.min(20,oe*2))})}).call(Os().on("start",y).on("drag",E).on("end",z)),Z=L.append("g").attr("class","labels").selectAll("text").data(d).enter().append("text").attr("text-anchor","middle").attr("dy",".35em").attr("font-size","11px").attr("font-family","Arial, sans-serif").attr("fill","#333").attr("pointer-events","none").text(D=>D.label.length>12?D.label.substring(0,12)+"...":D.label);U.on("tick",()=>{Q.attr("x1",D=>D.source.x).attr("y1",D=>D.source.y).attr("x2",D=>D.target.x).attr("y2",D=>D.target.y),K.attr("cx",D=>D.x).attr("cy",D=>D.y),Z.attr("x",D=>D.x).attr("y",D=>D.y)});function y(D,V){D.active||U.alphaTarget(.3).restart(),V.fx=V.x,V.fy=V.y}function E(D,V){V.fx=D.x,V.fy=D.y}function z(D,V){D.active||U.alphaTarget(0),V.fx=null,V.fy=null}}Kt(()=>{b().then(()=>{p||N()});const C=W=>{W.preventDefault()};return c&&c.addEventListener("contextmenu",C),window.addEventListener("resize",$),()=>{c&&c.removeEventListener("contextmenu",C),window.removeEventListener("resize",$)}});function P(){t(9,h=Ml.innerWidth),t(10,A=Ml.innerHeight)}function F(C){We[C?"unshift":"push"](()=>{c=C,t(1,c)})}const H=()=>history.back();function R(C){k=C,t(6,k)}return l.$$set=C=>{"apiUrl"in C&&t(14,u=C.apiUrl),"fullscreen"in C&&t(0,s=C.fullscreen)},[s,c,i,p,d,m,k,v,w,h,A,b,M,j,u,P,F,H,R]}class Si extends ut{constructor(e){super(),ct(this,e,Ci,yi,ot,{apiUrl:14,fullscreen:0})}}function zn(l,e,t){const o=l.slice();return o[9]=e[t],o[11]=t,o}function Hn(l){let e,t,o,n=l[9].content+"",u,s;return{c(){e=f("div"),t=f("div"),o=f("pre"),u=q(n),a(o,"class","svelte-tu8ic4"),a(t,"class","bubble svelte-tu8ic4"),a(e,"class",s=At(`msg ${l[9].role}`)+" svelte-tu8ic4")},m(c,i){T(c,e,i),r(e,t),r(t,o),r(o,u)},p(c,i){i&1&&n!==(n=c[9].content+"")&&ge(u,n),i&1&&s!==(s=At(`msg ${c[9].role}`)+" svelte-tu8ic4")&&a(e,"class",s)},d(c){c&&S(e)}}}function Fn(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="bubble loading svelte-tu8ic4"><span class="icon is-small"><i class="fas fa-spinner fa-spin"></i></span> 
            <span>Thinking...</span></div>`,a(e,"class","msg assistant svelte-tu8ic4")},m(t,o){T(t,e,o)},d(t){t&&S(e)}}}function Wn(l){let e,t,o;return{c(){e=f("p"),t=q("Model: "),o=q(l[4]),a(e,"class","is-size-7 has-text-grey")},m(n,u){T(n,e,u),r(e,t),r(e,o)},p(n,u){u&16&&ge(o,n[4])},d(n){n&&S(e)}}}function Gn(l){let e,t;return{c(){e=f("p"),t=q(l[3]),a(e,"class","has-text-danger is-size-7")},m(o,n){T(o,e,n),r(e,t)},p(o,n){n&8&&ge(t,o[3])},d(o){o&&S(e)}}}function Ti(l){let e,t,o,n,u,s,c,i,p,d,_,m,k,v,w,h,A,$,b,O,Y,M,j,N;e=new nl({props:{fallbackPath:"/"}});let P=l[0],F=[];for(let W=0;W<P.length;W+=1)F[W]=Hn(zn(l,P,W));let H=l[2]&&Fn(),R=l[4]&&Wn(l),C=l[3]&&Gn(l);return{c(){re(e.$$.fragment),t=g(),o=f("section"),n=f("div"),u=f("h2"),u.textContent="Chat",s=g(),c=f("p"),c.textContent=`Role: ${wt(Rt)}`,i=g(),p=f("div");for(let W=0;W<F.length;W+=1)F[W].c();d=g(),H&&H.c(),_=g(),R&&R.c(),m=g(),C&&C.c(),k=g(),v=f("div"),w=f("div"),h=f("textarea"),A=g(),$=f("div"),b=f("button"),O=f("span"),O.innerHTML='<i class="fas fa-paper-plane"></i>',a(u,"class","title is-4"),a(c,"class","subtitle is-6"),a(p,"class","chat-window svelte-tu8ic4"),a(h,"class","textarea"),a(h,"rows","3"),a(h,"placeholder","Type your message and press Enter..."),a(w,"class","control is-expanded"),a(O,"class","icon"),a(b,"class","button is-primary"),b.disabled=Y=l[2]||!l[1].trim(),a($,"class","control"),a(v,"class","field has-addons chat-input svelte-tu8ic4"),a(n,"class","container"),a(o,"class","section")},m(W,L){ie(e,W,L),T(W,t,L),T(W,o,L),r(o,n),r(n,u),r(n,s),r(n,c),r(n,i),r(n,p);for(let U=0;U<F.length;U+=1)F[U]&&F[U].m(p,null);r(p,d),H&&H.m(p,null),r(n,_),R&&R.m(n,null),r(n,m),C&&C.m(n,null),r(n,k),r(n,v),r(v,w),r(w,h),Ce(h,l[1]),r(v,A),r(v,$),r($,b),r(b,O),M=!0,j||(N=[X(h,"input",l[7]),X(h,"keydown",l[6]),X(b,"click",l[5])],j=!0)},p(W,[L]){if(L&1){P=W[0];let U;for(U=0;U<P.length;U+=1){const Q=zn(W,P,U);F[U]?F[U].p(Q,L):(F[U]=Hn(Q),F[U].c(),F[U].m(p,d))}for(;U<F.length;U+=1)F[U].d(1);F.length=P.length}W[2]?H||(H=Fn(),H.c(),H.m(p,null)):H&&(H.d(1),H=null),W[4]?R?R.p(W,L):(R=Wn(W),R.c(),R.m(n,m)):R&&(R.d(1),R=null),W[3]?C?C.p(W,L):(C=Gn(W),C.c(),C.m(n,k)):C&&(C.d(1),C=null),L&2&&Ce(h,W[1]),(!M||L&6&&Y!==(Y=W[2]||!W[1].trim()))&&(b.disabled=Y)},i(W){M||(G(e.$$.fragment,W),M=!0)},o(W){J(e.$$.fragment,W),M=!1},d(W){ae(e,W),W&&S(t),W&&S(o),Ge(F,W),H&&H.d(),R&&R.d(),C&&C.d(),j=!1,Ke(N)}}}function Ri(l,e,t){let o=[],n="",u=!1,s=null,c=null;function i(m){t(0,o=[...o,{role:"user",content:m}])}async function p(){var v;if(!n.trim()||u)return;t(3,s=null);const m=wt(Rt),k=n.trim();t(1,n=""),i(k),t(2,u=!0);try{const w=await fetch(`${at.ServerURL}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({role:m,messages:o})});if(!w.ok)throw new Error(`HTTP ${w.status}`);const h=await w.json();t(4,c=h.model_used??null),((v=h.status)==null?void 0:v.toLowerCase())==="success"&&h.message?t(0,o=[...o,{role:"assistant",content:h.message}]):t(3,s=h.error||"Chat failed")}catch(w){t(3,s=(w==null?void 0:w.message)||String(w))}finally{t(2,u=!1)}}function d(m){(m.key==="Enter"||m.key==="Return")&&!m.shiftKey&&(m.preventDefault(),p())}Kt(()=>{t(0,o=[{role:"assistant",content:"Hi! How can I help you? Ask me anything about your search results or documents."}])});function _(){n=this.value,t(1,n)}return[o,n,u,s,c,p,d,_]}class Ai extends ut{constructor(e){super(),ct(this,e,Ri,Ti,ot,{})}}function Li(l){let e,t;return e=new ri({}),{c(){re(e.$$.fragment)},m(o,n){ie(e,o,n),t=!0},i(o){t||(G(e.$$.fragment,o),t=!0)},o(o){J(e.$$.fragment,o),t=!1},d(o){ae(e,o)}}}function Ni(l){let e,t;return e=new or({}),{c(){re(e.$$.fragment)},m(o,n){ie(e,o,n),t=!0},i(o){t||(G(e.$$.fragment,o),t=!0)},o(o){J(e.$$.fragment,o),t=!1},d(o){ae(e,o)}}}function Oi(l){let e,t;return e=new gi({}),{c(){re(e.$$.fragment)},m(o,n){ie(e,o,n),t=!0},i(o){t||(G(e.$$.fragment,o),t=!0)},o(o){J(e.$$.fragment,o),t=!1},d(o){ae(e,o)}}}function Ui(l){let e,t;return e=new ki({}),{c(){re(e.$$.fragment)},m(o,n){ie(e,o,n),t=!0},i(o){t||(G(e.$$.fragment,o),t=!0)},o(o){J(e.$$.fragment,o),t=!1},d(o){ae(e,o)}}}function Pi(l){let e,t;return e=new Si({}),{c(){re(e.$$.fragment)},m(o,n){ie(e,o,n),t=!0},i(o){t||(G(e.$$.fragment,o),t=!0)},o(o){J(e.$$.fragment,o),t=!1},d(o){ae(e,o)}}}function Ei(l){let e,t;return e=new Ai({}),{c(){re(e.$$.fragment)},m(o,n){ie(e,o,n),t=!0},i(o){t||(G(e.$$.fragment,o),t=!0)},o(o){J(e.$$.fragment,o),t=!1},d(o){ae(e,o)}}}function Di(l){let e;return{c(){e=f("nav"),e.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
            <a class="navbar-item" href="/config/wizard">Wizard</a> 
            <a class="navbar-item" href="/config/json">JSONÂ Editor</a> 
            <a class="navbar-item" href="/graph">Graph</a> 
            <a class="navbar-item" href="/chat">Chat</a></div>`,a(e,"class","navbar")},m(t,o){T(t,e,o)},p:ye,d(t){t&&S(e)}}}function Mi(l){let e,t,o,n,u,s,c,i,p,d,_,m,k,v,w,h,A,$,b,O,Y,M,j,N,P,F,H,R,C,W;return c=new Al({}),d=new Tt({props:{path:"/",$$slots:{default:[Li]},$$scope:{ctx:l}}}),v=new Tt({props:{path:"/fetch/*",$$slots:{default:[Ni]},$$scope:{ctx:l}}}),h=new Tt({props:{path:"/config/wizard",$$slots:{default:[Oi]},$$scope:{ctx:l}}}),$=new Tt({props:{path:"/config/json",$$slots:{default:[Ui]},$$scope:{ctx:l}}}),O=new Tt({props:{path:"/graph",$$slots:{default:[Pi]},$$scope:{ctx:l}}}),M=new Tt({props:{path:"/chat",$$slots:{default:[Ei]},$$scope:{ctx:l}}}),F=new Tt({props:{path:"/",$$slots:{default:[Di]},$$scope:{ctx:l}}}),{c(){e=f("meta"),t=g(),o=f("div"),n=f("main"),u=f("div"),s=f("div"),re(c.$$.fragment),i=g(),p=f("div"),re(d.$$.fragment),_=g(),m=f("br"),k=g(),re(v.$$.fragment),w=g(),re(h.$$.fragment),A=g(),re($.$$.fragment),b=g(),re(O.$$.fragment),Y=g(),re(M.$$.fragment),j=g(),N=f("footer"),P=f("div"),re(F.$$.fragment),a(e,"name","color-scheme"),a(e,"content",l[1]),document.title="Terraphim",a(s,"class","role-selector svelte-1bfpta4"),a(u,"class","top-controls svelte-1bfpta4"),a(p,"class","search-area svelte-1bfpta4"),a(n,"class","main-content svelte-1bfpta4"),a(P,"class",H=At(l[0])+" svelte-1bfpta4"),a(N,"class","svelte-1bfpta4"),a(o,"class","is-full-height svelte-1bfpta4")},m(L,U){r(document.head,e),T(L,t,U),T(L,o,U),r(o,n),r(n,u),r(u,s),ie(c,s,null),r(n,i),r(n,p),ie(d,p,null),r(n,_),r(n,m),r(n,k),ie(v,n,null),r(n,w),ie(h,n,null),r(n,A),ie($,n,null),r(n,b),ie(O,n,null),r(n,Y),ie(M,n,null),r(o,j),r(o,N),r(N,P),ie(F,P,null),R=!0,C||(W=[X(N,"mouseover",l[2]),X(N,"focus",l[2])],C=!0)},p(L,[U]){(!R||U&2)&&a(e,"content",L[1]);const Q={};U&8&&(Q.$$scope={dirty:U,ctx:L}),d.$set(Q);const K={};U&8&&(K.$$scope={dirty:U,ctx:L}),v.$set(K);const Z={};U&8&&(Z.$$scope={dirty:U,ctx:L}),h.$set(Z);const y={};U&8&&(y.$$scope={dirty:U,ctx:L}),$.$set(y);const E={};U&8&&(E.$$scope={dirty:U,ctx:L}),O.$set(E);const z={};U&8&&(z.$$scope={dirty:U,ctx:L}),M.$set(z);const D={};U&8&&(D.$$scope={dirty:U,ctx:L}),F.$set(D),(!R||U&1&&H!==(H=At(L[0])+" svelte-1bfpta4"))&&a(P,"class",H)},i(L){R||(G(c.$$.fragment,L),G(d.$$.fragment,L),G(v.$$.fragment,L),G(h.$$.fragment,L),G($.$$.fragment,L),G(O.$$.fragment,L),G(M.$$.fragment,L),G(F.$$.fragment,L),R=!0)},o(L){J(c.$$.fragment,L),J(d.$$.fragment,L),J(v.$$.fragment,L),J(h.$$.fragment,L),J($.$$.fragment,L),J(O.$$.fragment,L),J(M.$$.fragment,L),J(F.$$.fragment,L),R=!1},d(L){S(e),L&&S(t),L&&S(o),ae(c),ae(d),ae(v),ae(h),ae($),ae(O),ae(M),ae(F),C=!1,Ke(W)}}}function Ii(l,e,t){let o;Re(l,fl,s=>t(1,o=s));let n="is-hidden";function u(){t(0,n="")}return[n,o,u]}class ji extends ut{constructor(e){super(),ct(this,e,Ii,Mi,ot,{})}}const zi=new ws;$s(zi);new ji({target:document.getElementById("app")});
