var Ps=Object.defineProperty;var Ds=(l,e,t)=>e in l?Ps(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var Ct=(l,e,t)=>(Ds(l,typeof e!="symbol"?e+"":e,t),t);import{aa as At,S as _t,i as ht,s as ft,q as f,Y as K,b as T,y as s,Z as we,I as De,j as $,ak as Ue,F as rt,m as Qt,a as g,v as a,l as X,E as xe,au as qt,r as ge,z as ve,t as Q,d as x,B as be,av as Ms,aw as Yt,H as st,U as at,V as ct,ax as Nl,ay as Is,g as Qe,e as Ye,O as Xe,af as St,o as hs,W as ke,az as Dl,aA as Tt,aB as gs,aC as Us,a1 as Oe,C as it,aD as qe,aE as Kl,D as il,G as al,aF as Ml,w as Dt,x as ut,A as Wl,a2 as js,aG as jt,ac as Hs,a5 as zs,a7 as Fs,a9 as qs,n as Ks,k as Ws,_ as jl}from"./vendor-ui-cd3d2b6a.js";import{R as Nt,S as Il,f as Gs,Y as Hl}from"./vendor-utils-740e9743.js";import{J as vs,_ as Bs,d as bs,P as Js,k as Vs,D as Qs,l as Ys,E as Zs,o as gn}from"./vendor-editor-992829d3.js";import{P as ks,T as Pl,u as ws,y as Xs,A as xs,S as er,q as tr}from"./vendor-atomic-1ea13e29.js";import{t as lr,E as nr}from"./novel-editor-becefd2f.js";import{s as zl,z as or,a as sr,l as rr,m as ir,c as ar,b as cr,B as ur,d as fr}from"./vendor-charts-e6a4a6c9.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const r of c.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function t(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(o){if(o.ep)return;o.ep=!0;const c=t(o);fetch(o.href,c)}})();const Ze={ServerURL:location.protocol+"//"+window.location.host||"/"},ml=At([]),dr={id:"Desktop",global_shortcut:"",roles:{},default_role:{original:"",lowercase:""},selected_role:{original:"",lowercase:""}},_l=At("spacelab"),Et=At("selected"),ot=At(!1),pr=At(`${Ze.ServerURL}/documents/search`),Lt=At(dr),vn=At([]);let zt=At("");const $t=At(!1);let Vt=null;function mr(l){if(typeof document>"u")return;const e=`/assets/bulmaswatch/${l}/bulmaswatch.min.css`;if(Vt!=null&&Vt.href.endsWith(e))return;const t=document.createElement("link");t.rel="stylesheet",t.href=e,t.id="bulma-theme",t.onload=()=>{Vt&&Vt!==t&&Vt.remove(),Vt=t},document.head.appendChild(t);const n=document.head.querySelector('meta[name="color-scheme"]');n&&n.setAttribute("content",l)}_l.subscribe(mr);function _r(l){let e,t;return{c(){e=f("option"),t=K(l[1]),e.__value=l[0],e.value=e.__value},m(n,o){T(n,e,o),s(e,t)},p(n,[o]){o&2&&we(t,n[1]),o&1&&(e.__value=n[0],e.value=e.__value)},i:De,o:De,d(n){n&&$(e)}}}function hr(l,e,t){let n,{subject:o}=e;const c=ks(o),r=Pl(c,ws.properties.name);return Ue(l,r,u=>t(1,n=u)),Pl(c,"http://localhost:9883/property/theme"),l.$$set=u=>{"subject"in u&&t(0,o=u.subject)},[o,n,r]}class gr extends _t{constructor(e){super(),ht(this,e,hr,_r,ft,{subject:0})}}function bn(l){let e,t,n,o,c,r,u=l[0]&&kn();return{c(){e=f("button"),t=f("span"),t.innerHTML='<i class="fas fa-arrow-left"></i>',n=g(),u&&u.c(),a(t,"class","icon svelte-rnsqpo"),a(e,"class",o="button is-light back-button "+l[1]+" svelte-rnsqpo"),a(e,"title","Go back"),a(e,"aria-label","Go back")},m(i,d){T(i,e,d),s(e,t),s(e,n),u&&u.m(e,null),c||(r=[X(e,"click",l[3]),X(e,"keydown",l[6])],c=!0)},p(i,d){i[0]?u||(u=kn(),u.c(),u.m(e,null)):u&&(u.d(1),u=null),d&2&&o!==(o="button is-light back-button "+i[1]+" svelte-rnsqpo")&&a(e,"class",o)},d(i){i&&$(e),u&&u.d(),c=!1,xe(r)}}}function kn(l){let e;return{c(){e=f("span"),e.textContent="Back",a(e,"class","back-text svelte-rnsqpo")},m(t,n){T(t,e,n)},d(t){t&&$(e)}}}function vr(l){let e,t=l[2]&&bn(l);return{c(){t&&t.c(),e=rt()},m(n,o){t&&t.m(n,o),T(n,e,o)},p(n,[o]){n[2]?t?t.p(n,o):(t=bn(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:De,o:De,d(n){t&&t.d(n),n&&$(e)}}}function br(l,e,t){let{fallbackPath:n="/"}=e,{showText:o=!0}=e,{customClass:c=""}=e,{hideOnPaths:r=["/"]}=e,u=!0;function i(){var m;try{const _=((m=window.location)==null?void 0:m.pathname)||"/";t(2,u=!r.includes(_))}catch{t(2,u=!0)}}function d(){window.history.length>1?window.history.back():window.location.href=n}Qt(()=>(i(),window.addEventListener("popstate",i),window.addEventListener("hashchange",i),()=>{window.removeEventListener("popstate",i),window.removeEventListener("hashchange",i)}));const p=m=>{(m.key==="Enter"||m.key===" ")&&(m.preventDefault(),d())};return l.$$set=m=>{"fallbackPath"in m&&t(4,n=m.fallbackPath),"showText"in m&&t(0,o=m.showText),"customClass"in m&&t(1,c=m.customClass),"hideOnPaths"in m&&t(5,r=m.hideOnPaths)},[o,c,u,d,n,r,p]}class cl extends _t{constructor(e){super(),ht(this,e,br,vr,ft,{fallbackPath:4,showText:0,customClass:1,hideOnPaths:5})}}function kr(){return window.crypto.getRandomValues(new Uint32Array(1))[0]}function Fl(l,e=!1){const t=kr(),n=`_${t}`;return Object.defineProperty(window,n,{value:o=>(e&&Reflect.deleteProperty(window,n),l==null?void 0:l(o)),writable:!1,configurable:!0}),t}async function Fe(l,e={}){return new Promise((t,n)=>{const o=Fl(r=>{t(r),Reflect.deleteProperty(window,`_${c}`)},!0),c=Fl(r=>{n(r),Reflect.deleteProperty(window,`_${o}`)},!0);window.__TAURI_IPC__({cmd:l,callback:o,error:c,...e})})}function wn(l,e,t){const n=l.slice();return n[25]=e[t],n}function wr(l){let e,t,n;function o(r){l[13](r)}let c={};return l[5]!==void 0&&(c.value=l[5]),e=new Yt({props:c}),st.push(()=>at(e,"value",o)),{c(){ge(e.$$.fragment)},m(r,u){ve(e,r,u),n=!0},p(r,u){const i={};!t&&u&32&&(t=!0,i.value=r[5],ct(()=>t=!1)),e.$set(i)},i(r){n||(Q(e.$$.fragment,r),n=!0)},o(r){x(e.$$.fragment,r),n=!1},d(r){be(e,r)}}}function yr(l){let e,t,n;function o(r){l[14](r)}let c={type:"password",placeholder:"secret",icon:"fas fa-lock",expanded:!0};return l[6]!==void 0&&(c.value=l[6]),e=new Yt({props:c}),st.push(()=>at(e,"value",o)),{c(){ge(e.$$.fragment)},m(r,u){ve(e,r,u),n=!0},p(r,u){const i={};!t&&u&64&&(t=!0,i.value=r[6],ct(()=>t=!1)),e.$set(i)},i(r){n||(Q(e.$$.fragment,r),n=!0)},o(r){x(e.$$.fragment,r),n=!1},d(r){be(e,r)}}}function Cr(l){let e;return{c(){e=K("Save")},m(t,n){T(t,e,n)},d(t){t&&$(e)}}}function $r(l){let e,t;return e=new Nl({props:{type:"is-success",class:"is-right",iconPack:"fa",iconLeft:"check",$$slots:{default:[Cr]},$$scope:{ctx:l}}}),e.$on("click",l[8]),e.$on("submit",l[8]),{c(){ge(e.$$.fragment)},m(n,o){ve(e,n,o),t=!0},p(n,o){const c={};o&268435456&&(c.$$scope={dirty:o,ctx:n}),e.$set(c)},i(n){t||(Q(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){be(e,n)}}}function Tr(l){let e,t,n,o,c,r;return e=new qt({props:{$$slots:{default:[wr]},$$scope:{ctx:l}}}),n=new qt({props:{grouped:!0,$$slots:{default:[yr]},$$scope:{ctx:l}}}),c=new qt({props:{grouped:!0,$$slots:{default:[$r]},$$scope:{ctx:l}}}),{c(){ge(e.$$.fragment),t=g(),ge(n.$$.fragment),o=g(),ge(c.$$.fragment)},m(u,i){ve(e,u,i),T(u,t,i),ve(n,u,i),T(u,o,i),ve(c,u,i),r=!0},p(u,i){const d={};i&268435488&&(d.$$scope={dirty:i,ctx:u}),e.$set(d);const p={};i&268435520&&(p.$$scope={dirty:i,ctx:u}),n.$set(p);const m={};i&268435456&&(m.$$scope={dirty:i,ctx:u}),c.$set(m)},i(u){r||(Q(e.$$.fragment,u),Q(n.$$.fragment,u),Q(c.$$.fragment,u),r=!0)},o(u){x(e.$$.fragment,u),x(n.$$.fragment,u),x(c.$$.fragment,u),r=!1},d(u){be(e,u),u&&$(t),be(n,u),u&&$(o),be(c,u)}}}function Sr(l){let e,t,n;function o(r){l[15](r)}let c={type:"search",placeholder:"Fetch JSON",icon:"search"};return l[3]!==void 0&&(c.value=l[3]),e=new Yt({props:c}),st.push(()=>at(e,"value",o)),{c(){ge(e.$$.fragment)},m(r,u){ve(e,r,u),n=!0},p(r,u){const i={};!t&&u&8&&(t=!0,i.value=r[3],ct(()=>t=!1)),e.$set(i)},i(r){n||(Q(e.$$.fragment,r),n=!0)},o(r){x(e.$$.fragment,r),n=!1},d(r){be(e,r)}}}function Rr(l){let e;return{c(){e=K("WikiPage")},m(t,n){T(t,e,n)},d(t){t&&$(e)}}}function Er(l){let e,t,n,o,c,r;function u(m){l[16](m)}let i={type:"search",placeholder:"Post JSON",icon:"search"};l[4]!==void 0&&(i.value=l[4]),e=new Yt({props:i}),st.push(()=>at(e,"value",u));function d(m){l[17](m)}let p={$$slots:{default:[Rr]},$$scope:{ctx:l}};return l[2]!==void 0&&(p.checked=l[2]),o=new Is({props:p}),st.push(()=>at(o,"checked",d)),{c(){ge(e.$$.fragment),n=g(),ge(o.$$.fragment)},m(m,_){ve(e,m,_),T(m,n,_),ve(o,m,_),r=!0},p(m,_){const h={};!t&&_&16&&(t=!0,h.value=m[4],ct(()=>t=!1)),e.$set(h);const w={};_&268435456&&(w.$$scope={dirty:_,ctx:m}),!c&&_&4&&(c=!0,w.checked=m[2],ct(()=>c=!1)),o.$set(w)},i(m){r||(Q(e.$$.fragment,m),Q(o.$$.fragment,m),r=!0)},o(m){x(e.$$.fragment,m),x(o.$$.fragment,m),r=!1},d(m){be(e,m),m&&$(n),be(o,m)}}}function Lr(l){let e;return{c(){e=K("Fetch")},m(t,n){T(t,e,n)},d(t){t&&$(e)}}}function Ar(l){let e,t;return e=new Nl({props:{type:"is-primary",$$slots:{default:[Lr]},$$scope:{ctx:l}}}),e.$on("click",l[9]),e.$on("submit",l[9]),{c(){ge(e.$$.fragment)},m(n,o){ve(e,n,o),t=!0},p(n,o){const c={};o&268435456&&(c.$$scope={dirty:o,ctx:n}),e.$set(c)},i(n){t||(Q(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){be(e,n)}}}function Or(l){let e,t,n,o,c,r;return e=new qt({props:{grouped:!0,$$slots:{default:[Sr]},$$scope:{ctx:l}}}),n=new qt({props:{grouped:!0,$$slots:{default:[Er]},$$scope:{ctx:l}}}),c=new qt({props:{grouped:!0,$$slots:{default:[Ar]},$$scope:{ctx:l}}}),{c(){ge(e.$$.fragment),t=g(),ge(n.$$.fragment),o=g(),ge(c.$$.fragment)},m(u,i){ve(e,u,i),T(u,t,i),ve(n,u,i),T(u,o,i),ve(c,u,i),r=!0},p(u,i){const d={};i&268435464&&(d.$$scope={dirty:i,ctx:u}),e.$set(d);const p={};i&268435476&&(p.$$scope={dirty:i,ctx:u}),n.$set(p);const m={};i&268435456&&(m.$$scope={dirty:i,ctx:u}),c.$set(m)},i(u){r||(Q(e.$$.fragment,u),Q(n.$$.fragment,u),Q(c.$$.fragment,u),r=!0)},o(u){x(e.$$.fragment,u),x(n.$$.fragment,u),x(c.$$.fragment,u),r=!1},d(u){be(e,u),u&&$(t),be(n,u),u&&$(o),be(c,u)}}}function Nr(l){let e,t,n,o,c;return o=new vs({props:{content:l[1],onChange:l[7]}}),{c(){e=f("p"),e.innerHTML=`<i>The best editing experience is to configure Atomic Server, in the
        meantime use editor below. You will need to refresh page via Command R
        or Ctrl-R to see changes</i>`,t=g(),n=f("div"),ge(o.$$.fragment),a(n,"class","editor")},m(r,u){T(r,e,u),T(r,t,u),T(r,n,u),ve(o,n,null),c=!0},p(r,u){const i={};u&2&&(i.content=r[1]),o.$set(i)},i(r){c||(Q(o.$$.fragment,r),c=!0)},o(r){x(o.$$.fragment,r),c=!1},d(r){r&&$(e),r&&$(t),r&&$(n),be(o)}}}function yn(l){let e,t;return e=new gr({props:{subject:l[25]}}),{c(){ge(e.$$.fragment)},m(n,o){ve(e,n,o),t=!0},p(n,o){const c={};o&1&&(c.subject=n[25]),e.$set(c)},i(n){t||(Q(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){be(e,n)}}}function Pr(l){let e,t,n=l[0]??[],o=[];for(let r=0;r<n.length;r+=1)o[r]=yn(wn(l,n,r));const c=r=>x(o[r],1,1,()=>{o[r]=null});return{c(){for(let r=0;r<o.length;r+=1)o[r].c();e=rt()},m(r,u){for(let i=0;i<o.length;i+=1)o[i]&&o[i].m(r,u);T(r,e,u),t=!0},p(r,u){if(u&1){n=r[0]??[];let i;for(i=0;i<n.length;i+=1){const d=wn(r,n,i);o[i]?(o[i].p(d,u),Q(o[i],1)):(o[i]=yn(d),o[i].c(),Q(o[i],1),o[i].m(e.parentNode,e))}for(Qe(),i=n.length;i<o.length;i+=1)c(i);Ye()}},i(r){if(!t){for(let u=0;u<n.length;u+=1)Q(o[u]);t=!0}},o(r){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)x(o[u]);t=!1},d(r){Xe(o,r),r&&$(e)}}}function Dr(l){let e,t;return e=new Ms({props:{$$slots:{default:[Pr]},$$scope:{ctx:l}}}),{c(){ge(e.$$.fragment)},m(n,o){ve(e,n,o),t=!0},p(n,o){const c={};o&268435457&&(c.$$scope={dirty:o,ctx:n}),e.$set(c)},i(n){t||(Q(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){be(e,n)}}}function Mr(l){let e,t,n,o,c,r,u,i,d,p,m,_,h,w,v;return e=new cl({props:{fallbackPath:"/"}}),o=new Nt({props:{path:"/atomic",$$slots:{default:[Tr]},$$scope:{ctx:l}}}),r=new Nt({props:{path:"/json",$$slots:{default:[Or]},$$scope:{ctx:l}}}),i=new Nt({props:{path:"/editor",$$slots:{default:[Nr]},$$scope:{ctx:l}}}),_=new qt({props:{grouped:!0,position:"is-right",$$slots:{default:[Dr]},$$scope:{ctx:l}}}),{c(){ge(e.$$.fragment),t=g(),n=f("div"),ge(o.$$.fragment),c=g(),ge(r.$$.fragment),u=g(),ge(i.$$.fragment),d=g(),p=f("hr"),m=g(),ge(_.$$.fragment),h=g(),w=f("nav"),w.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
    <a class="navbar-item" href="/fetch/json">Fetch JSON Data</a> 
    <a class="navbar-item" href="/fetch/atomic">Set Atomic Server</a> 
    <a class="navbar-item" href="/fetch/editor">Edit JSON config</a></div>`,a(n,"class","box"),a(w,"class","navbar")},m(y,b){ve(e,y,b),T(y,t,b),T(y,n,b),ve(o,n,null),s(n,c),ve(r,n,null),s(n,u),ve(i,n,null),T(y,d,b),T(y,p,b),T(y,m,b),ve(_,y,b),T(y,h,b),T(y,w,b),v=!0},p(y,[b]){const C={};b&268435552&&(C.$$scope={dirty:b,ctx:y}),o.$set(C);const k={};b&268435484&&(k.$$scope={dirty:b,ctx:y}),r.$set(k);const S={};b&268435458&&(S.$$scope={dirty:b,ctx:y}),i.$set(S);const z={};b&268435457&&(z.$$scope={dirty:b,ctx:y}),_.$set(z)},i(y){v||(Q(e.$$.fragment,y),Q(o.$$.fragment,y),Q(r.$$.fragment,y),Q(i.$$.fragment,y),Q(_.$$.fragment,y),v=!0)},o(y){x(e.$$.fragment,y),x(o.$$.fragment,y),x(r.$$.fragment,y),x(i.$$.fragment,y),x(_.$$.fragment,y),v=!1},d(y){be(e,y),y&&$(t),y&&$(n),be(o),be(r),be(i),y&&$(d),y&&$(p),y&&$(m),be(_,y),y&&$(h),y&&$(w)}}}function Ir(l,e,t){let n,o,c,r,u;Ue(l,Xs,A=>t(19,c=A)),Ue(l,ot,A=>t(20,r=A)),Ue(l,Lt,A=>t(21,u=A));let i={json:u};function d(A){if(console.log("contents changed:",A),console.log("is tauri",r),Lt.update(E=>(E=A.json,E)),ot)console.log("Updating config on server"),Fe("update_config",{configNew:A.json}).then(E=>{console.log(`Message: ${E}`)}).catch(E=>console.error(E));else{let E=`${Ze.ServerURL}/config/`;fetch(E,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(A.json)})}t(1,i=A)}let p=!1,m="https://raw.githubusercontent.com/terraphim/terraphim-cloud-fastapi/main/data/ref_arch.json",_="http://localhost:8000/documents/",h="http://localhost:9883/",w;const v=async()=>{console.log("Updating atomic server configuration");const A=xs.fromSecret(w);c.setServerUrl(h),console.log("Server set.Setting agent"),c.setAgent(A)},y=async()=>{k()},b=({data:{msg:A,data:E}})=>{console.log(A,E)};let C;const k=async()=>{const A=await Bs(()=>import("./fetcher.worker-7e58969a.js"),[]);C=new A.default,C.onmessage=b;const E={msg:"fetcher",data:{url:m,postUrl:_,isWiki:p}};C.postMessage(E)},S=ks("http://localhost:9883/config/y3zx5wtm0bq"),z=Pl(S,ws.properties.name);Ue(l,z,A=>t(12,o=A));const D=Pl(S,"http://localhost:9883/property/role");Ue(l,D,A=>t(0,n=A));function M(A){h=A,t(5,h)}function R(A){w=A,t(6,w)}function W(A){m=A,t(3,m)}function Y(A){_=A,t(4,_)}function J(A){p=A,t(2,p)}return l.$$.update=()=>{l.$$.dirty&4096&&console.log("Print name",o),l.$$.dirty&1&&console.log("Print roles",n)},[n,i,p,m,_,h,w,d,v,y,z,D,o,M,R,W,Y,J]}class Ur extends _t{constructor(e){super(),ht(this,e,Ir,Mr,ft,{})}}function Ft(){return St(ot)||typeof window<"u"&&window.__TAURI__!==void 0}class jr{constructor(){Ct(this,"baseUrl");Ct(this,"autocompleteIndexBuilt",!1);Ct(this,"sessionId");Ct(this,"currentRole","Default");Ct(this,"connectionRetries",0);Ct(this,"maxRetries",3);Ct(this,"retryDelay",1e3);Ct(this,"isConnecting",!1);this.baseUrl=typeof window<"u"?(window.location.protocol==="https:"?"https://":"http://")+window.location.hostname+":8001":"http://localhost:8001",this.sessionId=`novel-${Date.now()}`,typeof window<"u"&&!Ft()&&this.shouldPerformHealthCheck()?this.detectServerPort():typeof window<"u"&&!Ft()&&console.log("NovelAutocompleteService: Skipping server detection - not needed for current page")}setRole(e){this.currentRole=e,this.autocompleteIndexBuilt=!1}async detectServerPort(){if(Ft())return;if(!this.shouldPerformHealthCheck()){console.log("NovelAutocompleteService: Skipping health check - service not needed");return}const t=[8001,3e3];for(const n of t)try{const o=typeof window<"u"?(window.location.protocol==="https:"?"https://":"http://")+window.location.hostname+":"+n:"http://localhost:"+n,c=await fetch(`${o}/message?sessionId=health-check`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:0,method:"ping",params:{}}),signal:AbortSignal.timeout(1e3)});if(c.ok||c.status===404){this.baseUrl=o,console.log(`NovelAutocompleteService: Detected server at ${o}`);return}}catch{continue}console.warn("NovelAutocompleteService: Could not detect running server, using default:",this.baseUrl)}shouldPerformHealthCheck(){return!(typeof window<"u"&&(!window.location.pathname.startsWith("/chat")||!(document.querySelector('[contenteditable="true"]')||document.querySelector("textarea")||document.querySelector('input[type="text"]'))))}async buildAutocompleteIndex(){if(this.isConnecting)return await new Promise(e=>setTimeout(e,1e3)),this.autocompleteIndexBuilt;this.isConnecting=!0;try{return Ft()?(console.log("Using Tauri backend - no index building required"),this.autocompleteIndexBuilt=!0,this.connectionRetries=0,console.log("Tauri autocomplete ready"),!0):await this.buildMCPIndex()}catch(e){return console.error("Error building Novel autocomplete index:",e),!1}finally{this.isConnecting=!1}}async buildMCPIndex(){for(let e=0;e<=this.maxRetries;e++)try{const t=await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:Date.now(),method:"tools/call",params:{name:"build_autocomplete_index",arguments:{}}}),signal:AbortSignal.timeout(1e4)});if(t.ok){const n=await t.json();if(console.log(`MCP build index response (attempt ${e+1}):`,n),n.result&&!n.result.is_error)return this.autocompleteIndexBuilt=!0,this.connectionRetries=0,console.log("MCP autocomplete index built successfully"),!0}else if(t.status>=500&&e<this.maxRetries){console.warn(`MCP server error ${t.status}, retrying in ${this.retryDelay}ms...`),await new Promise(n=>setTimeout(n,this.retryDelay*(e+1)));continue}console.warn(`MCP build index failed (attempt ${e+1}):`,t.status,t.statusText)}catch(t){t instanceof Error&&t.name==="AbortError"?console.warn(`MCP request timeout (attempt ${e+1})`):console.warn(`MCP connection error (attempt ${e+1}):`,t),e<this.maxRetries&&await new Promise(n=>setTimeout(n,this.retryDelay*(e+1)))}return console.error("Failed to build MCP autocomplete index after all retries"),!1}async getCompletion(e){if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return{text:""};try{const t=this.extractLastWord(e.prompt);if(!t||t.length<1)return{text:""};const n=await this.getSuggestionsWithSnippets(t,5);if(n.length===0)return{text:""};let c=n[0].text;c.toLowerCase().startsWith(t.toLowerCase())&&(c=c.substring(t.length));const r=e.prompt.length/4,u=c.length/4;return{text:c,usage:{promptTokens:Math.round(r),completionTokens:Math.round(u),totalTokens:Math.round(r+u)}}}catch(t){return console.error("Error getting Novel autocomplete completion:",t),{text:""}}}async getSuggestions(e,t=10){if(!e||e.trim().length===0)return[];if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return console.warn("Autocomplete index not built, returning empty suggestions"),[];try{return Ft()?await this.getTauriSuggestions(e,t):await this.getMCPSuggestions(e,t,"autocomplete_terms")}catch(n){return console.error("Error getting autocomplete suggestions:",n),[]}}async getTauriSuggestions(e,t){const n=await Fe("get_autocomplete_suggestions",{query:e.trim(),role_name:this.currentRole,limit:t});return console.log("Tauri autocomplete response:",n),n&&n.status==="success"&&n.suggestions?n.suggestions.map(o=>({text:o.term||o.text||"",snippet:o.url||o.snippet||"",score:o.score||1})).filter(o=>o.text.length>0):(n&&n.error&&console.error("Tauri autocomplete error:",n.error),[])}async getMCPSuggestions(e,t,n){const o=Date.now(),c=await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:o,method:"tools/call",params:{name:n,arguments:{query:e.trim(),limit:t,role:this.currentRole}}}),signal:AbortSignal.timeout(5e3)});if(!c.ok)return console.error(`MCP ${n} request failed:`,c.status,c.statusText),[];const r=await c.json();return console.log(`MCP ${n} response:`,r),r.result&&!r.result.is_error&&r.result.content?n==="autocomplete_with_snippets"?this.parseAutocompleteWithSnippetsContent(r.result.content):this.parseAutocompleteContent(r.result.content):(r.error&&console.error(`MCP ${n} error:`,r.error),[])}async getSuggestionsWithSnippets(e,t=10){if(!e||e.trim().length===0)return[];if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return console.warn("Autocomplete index not built, returning empty suggestions with snippets"),[];try{return Ft()?await this.getTauriSuggestions(e,t):await this.getMCPSuggestions(e,t,"autocomplete_with_snippets")}catch(n){return console.error("Error getting autocomplete suggestions with snippets:",n),[]}}extractLastWord(e){const t=e.trim().split(/\s+/);return t[t.length-1]||""}parseAutocompleteContent(e){const t=[];for(const n of e)if(n.type==="text"&&n.text){if(!n.text.startsWith("Found")&&!n.text.startsWith("•"))t.push({text:n.text.trim()});else if(n.text.startsWith("•")){const o=n.text.replace("•","").trim();o&&t.push({text:o})}}return t}parseAutocompleteWithSnippetsContent(e){const t=[];for(const n of e)if(n.type==="text"&&n.text){if(!n.text.startsWith("Found")&&!n.text.startsWith("•")){const o=n.text.split(" — ");o.length===2?t.push({text:o[0].trim(),snippet:o[1].trim()}):t.push({text:n.text.trim()})}else if(n.text.startsWith("•")){const o=n.text.replace("•","").trim();o&&t.push({text:o})}}return t}isReady(){return this.autocompleteIndexBuilt}getStatus(){return{ready:this.autocompleteIndexBuilt,baseUrl:this.baseUrl,sessionId:this.sessionId,usingTauri:Ft(),currentRole:this.currentRole,connectionRetries:this.connectionRetries,isConnecting:this.isConnecting}}async refreshIndex(){return this.autocompleteIndexBuilt=!1,this.connectionRetries=0,await this.buildAutocompleteIndex()}async testConnection(){try{if(Ft()){const e=await Fe("get_autocomplete_suggestions",{query:"test",role_name:this.currentRole,limit:1});return e&&(e.status==="success"||e.status==="error")}else return(await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:Date.now(),method:"tools/list",params:{}}),signal:AbortSignal.timeout(3e3)})).ok}catch(e){return console.warn("Connection test failed:",e),!1}}}const Pt=new jr;function Hr(l){var e;const{char:t,allowSpaces:n,allowToIncludeChar:o,allowedPrefixes:c,startOfLine:r,$position:u}=l,i=n&&!o,d=Ys(t),p=new RegExp(`\\s${d}$`),m=r?"^":"",_=o?"":d,h=i?new RegExp(`${m}${d}.*?(?=\\s${_}|$)`,"gm"):new RegExp(`${m}(?:^)?${d}[^\\s${_}]*`,"gm"),w=((e=u.nodeBefore)===null||e===void 0?void 0:e.isText)&&u.nodeBefore.text;if(!w)return null;const v=u.pos-w.length,y=Array.from(w.matchAll(h)).pop();if(!y||y.input===void 0||y.index===void 0)return null;const b=y.input.slice(Math.max(0,y.index-1),y.index),C=new RegExp(`^[${c==null?void 0:c.join("")}\0]?$`).test(b);if(c!==null&&!C)return null;const k=v+y.index;let S=k+y[0].length;return i&&p.test(w.slice(S-1,S+1))&&(y[0]+=" ",S+=1),k<u.pos&&S>=u.pos?{range:{from:k,to:S},query:y[0].slice(t.length),text:y[0]}:null}const zr=new bs("suggestion");function Fr({pluginKey:l=zr,editor:e,char:t="@",allowSpaces:n=!1,allowToIncludeChar:o=!1,allowedPrefixes:c=[" "],startOfLine:r=!1,decorationTag:u="span",decorationClass:i="suggestion",decorationContent:d="",decorationEmptyClass:p="is-empty",command:m=()=>null,items:_=()=>[],render:h=()=>({}),allow:w=()=>!0,findSuggestionMatch:v=Hr}){let y;const b=h==null?void 0:h(),C=new Js({key:l,view(){return{update:async(k,S)=>{var z,D,M,R,W,Y,J;const A=(z=this.key)===null||z===void 0?void 0:z.getState(S),E=(D=this.key)===null||D===void 0?void 0:D.getState(k.state),ce=A.active&&E.active&&A.range.from!==E.range.from,q=!A.active&&E.active,re=A.active&&!E.active,ne=!q&&!re&&A.query!==E.query,V=q||ce&&ne,oe=ne||ce,I=re||ce&&ne;if(!V&&!oe&&!I)return;const U=I&&!V?A:E,O=k.dom.querySelector(`[data-decoration-id="${U.decorationId}"]`);y={editor:e,range:U.range,query:U.query,text:U.text,items:[],command:L=>m({editor:e,range:U.range,props:L}),decorationNode:O,clientRect:O?()=>{var L;const{decorationId:B}=(L=this.key)===null||L===void 0?void 0:L.getState(e.state),Z=k.dom.querySelector(`[data-decoration-id="${B}"]`);return(Z==null?void 0:Z.getBoundingClientRect())||null}:null},V&&((M=b==null?void 0:b.onBeforeStart)===null||M===void 0||M.call(b,y)),oe&&((R=b==null?void 0:b.onBeforeUpdate)===null||R===void 0||R.call(b,y)),(oe||V)&&(y.items=await _({editor:e,query:U.query})),I&&((W=b==null?void 0:b.onExit)===null||W===void 0||W.call(b,y)),oe&&((Y=b==null?void 0:b.onUpdate)===null||Y===void 0||Y.call(b,y)),V&&((J=b==null?void 0:b.onStart)===null||J===void 0||J.call(b,y))},destroy:()=>{var k;y&&((k=b==null?void 0:b.onExit)===null||k===void 0||k.call(b,y))}}},state:{init(){return{active:!1,range:{from:0,to:0},query:null,text:null,composing:!1}},apply(k,S,z,D){const{isEditable:M}=e,{composing:R}=e.view,{selection:W}=k,{empty:Y,from:J}=W,A={...S};if(A.composing=R,M&&(Y||e.view.composing)){(J<S.range.from||J>S.range.to)&&!R&&!S.composing&&(A.active=!1);const E=v({char:t,allowSpaces:n,allowToIncludeChar:o,allowedPrefixes:c,startOfLine:r,$position:W.$from}),ce=`id_${Math.floor(Math.random()*4294967295)}`;E&&w({editor:e,state:D,range:E.range,isActive:S.active})?(A.active=!0,A.decorationId=S.decorationId?S.decorationId:ce,A.range=E.range,A.query=E.query,A.text=E.text):A.active=!1}else A.active=!1;return A.active||(A.decorationId=null,A.range={from:0,to:0},A.query=null,A.text=null),A}},props:{handleKeyDown(k,S){var z;const{active:D,range:M}=C.getState(k.state);return D&&((z=b==null?void 0:b.onKeyDown)===null||z===void 0?void 0:z.call(b,{view:k,event:S,range:M}))||!1},decorations(k){const{active:S,range:z,decorationId:D,query:M}=C.getState(k);if(!S)return null;const R=!(M!=null&&M.length),W=[i];return R&&W.push(p),Vs.create(k.doc,[Qs.inline(z.from,z.to,{nodeName:u,class:W.join(" "),"data-decoration-id":D,"data-decoration-content":d})])}}});return C}const Cn=Zs.create({name:"terraphimSuggestion",addOptions(){return{trigger:"++",pluginKey:new bs("terraphimSuggestion"),allowSpaces:!1,limit:8,minLength:1,debounce:300}},addCommands(){return{insertSuggestion:l=>({commands:e,chain:t})=>t().insertContent(l.text).run()}},addProseMirrorPlugins(){const l={editor:this.editor,char:this.options.trigger,pluginKey:this.options.pluginKey,allowSpaces:this.options.allowSpaces,startOfLine:!1,command:({editor:e,range:t,props:n})=>{const o=n;e.chain().focus().insertContentAt(t,o.text+" ").run()},items:async({query:e,editor:t})=>new Promise(n=>{setTimeout(async()=>{if(e.length<this.options.minLength){n([]);return}try{const o=await Pt.getSuggestionsWithSnippets(e,this.options.limit);console.log(`TerraphimSuggestion: Found ${o.length} suggestions for "${e}"`),n(o)}catch(o){console.error("TerraphimSuggestion: Error getting suggestions:",o),n([])}},this.options.debounce)}),render:()=>{let e,t;return{onStart:n=>{e=new qr({items:n.items,command:n.command}),n.clientRect&&(t=lr("body",{getReferenceClientRect:n.clientRect,appendTo:()=>document.body,content:e.element,showOnCreate:!0,interactive:!0,trigger:"manual",placement:"bottom-start",theme:"terraphim-suggestion",maxWidth:"none"})[0])},onUpdate(n){e==null||e.updateItems(n.items),n.clientRect&&(t==null||t.setProps({getReferenceClientRect:n.clientRect}))},onKeyDown(n){return n.event.key==="Escape"?(t==null||t.hide(),!0):(e==null?void 0:e.onKeyDown(n))??!1},onExit(){t==null||t.destroy(),e==null||e.destroy()}}}};return[Fr(l)]}});class qr{constructor(e){Ct(this,"element");Ct(this,"items",[]);Ct(this,"selectedIndex",0);Ct(this,"command");this.items=e.items,this.command=e.command,this.element=document.createElement("div"),this.element.className="terraphim-suggestion-dropdown",this.render()}updateItems(e){this.items=e,this.selectedIndex=0,this.render()}onKeyDown({event:e}){return e.key==="ArrowUp"?(this.selectPrevious(),!0):e.key==="ArrowDown"?(this.selectNext(),!0):e.key==="Enter"||e.key==="Tab"?(this.selectItem(this.selectedIndex),!0):!1}selectPrevious(){this.selectedIndex=Math.max(0,this.selectedIndex-1),this.render()}selectNext(){this.selectedIndex=Math.min(this.items.length-1,this.selectedIndex+1),this.render()}selectItem(e){const t=this.items[e];t&&this.command({id:t.text,...t})}render(){if(this.element.innerHTML="",this.items.length===0){this.element.innerHTML=`
        <div class="terraphim-suggestion-item terraphim-suggestion-empty">
          <div class="terraphim-suggestion-text">No suggestions found</div>
          <div class="terraphim-suggestion-hint">Try a different search term</div>
        </div>
      `;return}const e=document.createElement("div");e.className="terraphim-suggestion-header",e.innerHTML=`
      <div class="terraphim-suggestion-count">${this.items.length} suggestions</div>
      <div class="terraphim-suggestion-hint">↑↓ Navigate • Tab/Enter Select • Esc Cancel</div>
    `,this.element.appendChild(e),this.items.forEach((t,n)=>{const o=document.createElement("div");o.className=`terraphim-suggestion-item ${n===this.selectedIndex?"terraphim-suggestion-selected":""}`,o.innerHTML=`
        <div class="terraphim-suggestion-main">
          <div class="terraphim-suggestion-text">${this.escapeHtml(t.text)}</div>
          ${t.snippet?`<div class="terraphim-suggestion-snippet">${this.escapeHtml(t.snippet)}</div>`:""}
        </div>
        ${t.score?`<div class="terraphim-suggestion-score">${Math.round(t.score*100)}%</div>`:""}
      `,o.addEventListener("click",()=>this.selectItem(n)),o.addEventListener("mouseenter",()=>{this.selectedIndex=n,this.render()}),this.element.appendChild(o)})}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}destroy(){this.element.remove()}}const Kr=`
.terraphim-suggestion-dropdown {
  background: white;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  box-shadow: 0 10px 38px -10px rgba(22, 23, 24, 0.35), 0 10px 20px -15px rgba(22, 23, 24, 0.2);
  max-height: 300px;
  min-width: 300px;
  overflow-y: auto;
  z-index: 1000;
}

.terraphim-suggestion-header {
  padding: 8px 12px;
  border-bottom: 1px solid #f1f5f9;
  background: #f8fafc;
  font-size: 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.terraphim-suggestion-count {
  font-weight: 600;
  color: #475569;
}

.terraphim-suggestion-hint {
  color: #64748b;
}

.terraphim-suggestion-item {
  padding: 8px 12px;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  border-bottom: 1px solid #f1f5f9;
}

.terraphim-suggestion-item:hover {
  background: #f8fafc;
}

.terraphim-suggestion-selected {
  background: #eff6ff !important;
  border-left: 3px solid #3b82f6;
}

.terraphim-suggestion-empty {
  color: #64748b;
  font-style: italic;
  text-align: center;
  cursor: default;
}

.terraphim-suggestion-main {
  flex: 1;
}

.terraphim-suggestion-text {
  font-weight: 500;
  color: #1e293b;
  margin-bottom: 2px;
}

.terraphim-suggestion-snippet {
  font-size: 12px;
  color: #64748b;
  line-height: 1.3;
}

.terraphim-suggestion-score {
  font-size: 11px;
  color: #10b981;
  font-weight: 600;
  background: #ecfdf5;
  padding: 2px 6px;
  border-radius: 4px;
  margin-left: 8px;
}

/* Dark theme support */
@media (prefers-color-scheme: dark) {
  .terraphim-suggestion-dropdown {
    background: #1e293b;
    border-color: #334155;
  }

  .terraphim-suggestion-header {
    background: #0f172a;
    border-color: #334155;
  }

  .terraphim-suggestion-item:hover {
    background: #334155;
  }

  .terraphim-suggestion-selected {
    background: #1e40af !important;
  }

  .terraphim-suggestion-text {
    color: #f1f5f9;
  }

  .terraphim-suggestion-snippet {
    color: #94a3b8;
  }
}

/* Tippy.js theme */
.tippy-box[data-theme~='terraphim-suggestion'] {
  background: transparent;
  box-shadow: none;
}

.tippy-box[data-theme~='terraphim-suggestion'] > .tippy-backdrop {
  background: transparent;
}

.tippy-box[data-theme~='terraphim-suggestion'] > .tippy-arrow {
  display: none;
}
`;function $n(l){let e,t,n,o,c,r,u,i,d,p,m,_,h,w,v,y,b,C,k,S,z,D,M,R,W,Y,J=l[12]?"Tauri (native)":`MCP Server (${Pt.getStatus().baseUrl})`,A,E,ce,q,re,ne,V,oe,I,U,O,L,B,Z,te,P,N,F,ae,le,ee=l[6]!==1?"s":"",me,_e,fe,de,pe,he,Se,Ge,je,Le,Re,se,ye,Ne,Be,Ke,$e,Pe,et=l[3]?"Enabled":"Disabled",Je,Me,He,tt,ue=l[11]&&!l[8]&&Tn(l);function Ae(H,ie){if(H[8])return Jr;if(H[11])return Br}let j=Ae(l),G=j&&j(l);return{c(){e=f("div"),t=f("div"),n=f("strong"),n.textContent="Local Autocomplete Status:",o=g(),c=f("div"),r=f("button"),u=K("Test"),d=g(),p=f("button"),p.textContent="Rebuild Index",m=g(),_=f("button"),h=K("Demo"),v=g(),y=f("div"),b=K(l[10]),C=g(),ue&&ue.c(),k=g(),S=f("div"),z=f("strong"),z.textContent="Configuration:",D=g(),M=f("br"),R=K("• "),W=f("strong"),W.textContent="Backend:",Y=g(),A=K(J),E=g(),ce=f("br"),q=K("• "),re=f("strong"),re.textContent="Role:",ne=g(),V=K(l[9]),oe=g(),I=f("br"),U=K("• "),O=f("strong"),O.textContent="Trigger:",L=K(' "'),B=K(l[4]),Z=K(`" + text
      `),te=f("br"),P=K("• "),N=f("strong"),N.textContent="Min Length:",F=g(),ae=K(l[6]),le=K(" character"),me=K(ee),_e=g(),fe=f("br"),de=K("• "),pe=f("strong"),pe.textContent="Max Results:",he=g(),Se=K(l[5]),Ge=g(),je=f("br"),Le=K("• "),Re=f("strong"),Re.textContent="Debounce:",se=g(),ye=K(l[7]),Ne=K(`ms
      `),Be=f("br"),Ke=K("• "),$e=f("strong"),$e.textContent="Snippets:",Pe=g(),Je=K(et),Me=g(),G&&G.c(),ke(n,"color","#495057"),ke(r,"padding","4px 8px"),ke(r,"background","#007bff"),ke(r,"color","white"),ke(r,"border","none"),ke(r,"border-radius","4px"),ke(r,"cursor","pointer"),ke(r,"font-size","12px"),r.disabled=i=!l[8],ke(p,"padding","4px 8px"),ke(p,"background","#28a745"),ke(p,"color","white"),ke(p,"border","none"),ke(p,"border-radius","4px"),ke(p,"cursor","pointer"),ke(p,"font-size","12px"),ke(_,"padding","4px 8px"),ke(_,"background","#ffc107"),ke(_,"color","#212529"),ke(_,"border","none"),ke(_,"border-radius","4px"),ke(_,"cursor","pointer"),ke(_,"font-size","12px"),_.disabled=w=!l[8],ke(c,"display","flex"),ke(c,"gap","8px"),ke(t,"display","flex"),ke(t,"justify-content","space-between"),ke(t,"align-items","center"),ke(t,"margin-bottom","8px"),ke(y,"font-size","13px"),ke(y,"color","#6c757d"),ke(y,"margin-bottom","8px"),ke(y,"font-family","monospace"),ke(S,"font-size","12px"),ke(S,"color","#6c757d"),ke(e,"margin-top","10px"),ke(e,"padding","12px"),ke(e,"background","#f8f9fa"),ke(e,"border-radius","6px"),ke(e,"border","1px solid #e9ecef")},m(H,ie){T(H,e,ie),s(e,t),s(t,n),s(t,o),s(t,c),s(c,r),s(r,u),s(c,d),s(c,p),s(c,m),s(c,_),s(_,h),s(e,v),s(e,y),s(y,b),s(e,C),ue&&ue.m(e,null),s(e,k),s(e,S),s(S,z),s(S,D),s(S,M),s(S,R),s(S,W),s(S,Y),s(S,A),s(S,E),s(S,ce),s(S,q),s(S,re),s(S,ne),s(S,V),s(S,oe),s(S,I),s(S,U),s(S,O),s(S,L),s(S,B),s(S,Z),s(S,te),s(S,P),s(S,N),s(S,F),s(S,ae),s(S,le),s(S,me),s(S,_e),s(S,fe),s(S,de),s(S,pe),s(S,he),s(S,Se),s(S,Ge),s(S,je),s(S,Le),s(S,Re),s(S,se),s(S,ye),s(S,Ne),s(S,Be),s(S,Ke),s(S,$e),s(S,Pe),s(S,Je),s(e,Me),G&&G.m(e,null),He||(tt=[X(r,"click",l[14]),X(p,"click",l[15]),X(_,"click",l[16])],He=!0)},p(H,ie){ie&256&&i!==(i=!H[8])&&(r.disabled=i),ie&256&&w!==(w=!H[8])&&(_.disabled=w),ie&1024&&we(b,H[10]),H[11]&&!H[8]?ue?ue.p(H,ie):(ue=Tn(H),ue.c(),ue.m(e,k)):ue&&(ue.d(1),ue=null),ie&4096&&J!==(J=H[12]?"Tauri (native)":`MCP Server (${Pt.getStatus().baseUrl})`)&&we(A,J),ie&512&&we(V,H[9]),ie&16&&we(B,H[4]),ie&64&&we(ae,H[6]),ie&64&&ee!==(ee=H[6]!==1?"s":"")&&we(me,ee),ie&32&&we(Se,H[5]),ie&128&&we(ye,H[7]),ie&8&&et!==(et=H[3]?"Enabled":"Disabled")&&we(Je,et),j===(j=Ae(H))&&G?G.p(H,ie):(G&&G.d(1),G=j&&j(H),G&&(G.c(),G.m(e,null)))},d(H){H&&$(e),ue&&ue.d(),G&&G.d(),He=!1,xe(tt)}}}function Tn(l){let e,t,n,o;function c(i,d){return i[12]?Gr:Wr}let r=c(l),u=r(l);return{c(){e=f("div"),t=f("strong"),t.textContent="⚠️ Autocomplete Not Available",n=f("br"),o=g(),u.c(),ke(e,"font-size","12px"),ke(e,"color","#dc3545"),ke(e,"margin-bottom","8px"),ke(e,"padding","6px"),ke(e,"background","#f8d7da"),ke(e,"border-radius","4px")},m(i,d){T(i,e,d),s(e,t),s(e,n),s(e,o),u.m(e,null)},p(i,d){r===(r=c(i))&&u?u.p(i,d):(u.d(1),u=r(i),u&&(u.c(),u.m(e,null)))},d(i){i&&$(e),u.d()}}}function Wr(l){let e,t=Pt.getStatus().baseUrl+"",n;return{c(){e=K("MCP server not responding. Ensure the server is running on "),n=K(t)},m(o,c){T(o,e,c),T(o,n,c)},p:De,d(o){o&&$(e),o&&$(n)}}}function Gr(l){let e;return{c(){e=K("Tauri backend connection failed. Ensure the application has proper permissions.")},m(t,n){T(t,e,n)},p:De,d(t){t&&$(e)}}}function Br(l){let e;return{c(){e=f("div"),e.innerHTML=`<strong>❌ Autocomplete Unavailable</strong> 
        <div style="font-size: 11px; margin-top: 4px; color: #721c24;">Click &quot;Rebuild Index&quot; to retry or check server/backend status.</div>`,ke(e,"margin-top","8px"),ke(e,"padding","8px"),ke(e,"background","#f8d7da"),ke(e,"border","1px solid #f5c6cb"),ke(e,"border-radius","4px")},m(t,n){T(t,e,n)},p:De,d(t){t&&$(e)}}}function Jr(l){let e,t,n,o,c,r,u,i,d,p,m,_,h,w,v,y,b;return{c(){e=f("div"),t=f("strong"),t.textContent="🎯 Autocomplete Active",n=g(),o=f("div"),c=K("Type "),r=f("code"),u=K(l[4]),i=K(" in the editor above to trigger suggestions."),d=f("br"),p=K(`
          Example: `),m=f("code"),_=K(l[4]),h=K("terraphim"),w=K(" or "),v=f("code"),y=K(l[4]),b=K("graph"),ke(o,"font-size","11px"),ke(o,"margin-top","4px"),ke(o,"color","#0056b3"),ke(e,"margin-top","8px"),ke(e,"padding","8px"),ke(e,"background","#d1edff"),ke(e,"border","1px solid #b3d9ff"),ke(e,"border-radius","4px")},m(C,k){T(C,e,k),s(e,t),s(e,n),s(e,o),s(o,c),s(o,r),s(r,u),s(o,i),s(o,d),s(o,p),s(o,m),s(m,_),s(m,h),s(o,w),s(o,v),s(v,y),s(v,b)},p(C,k){k&16&&we(u,C[4]),k&16&&we(_,C[4]),k&16&&we(y,C[4])},d(C){C&&$(e)}}}function Vr(l){let e,t,n,o;e=new nr({props:{defaultValue:l[0],isEditable:!l[1],disableLocalStorage:!0,onUpdate:l[13],extensions:[gn,...l[2]?[Cn.configure({trigger:l[4],allowSpaces:!1,limit:l[5],minLength:l[6],debounce:l[7]})]:[]]}});let c=l[2]&&$n(l);return{c(){ge(e.$$.fragment),t=g(),c&&c.c(),n=rt()},m(r,u){ve(e,r,u),T(r,t,u),c&&c.m(r,u),T(r,n,u),o=!0},p(r,[u]){const i={};u&1&&(i.defaultValue=r[0]),u&2&&(i.isEditable=!r[1]),u&244&&(i.extensions=[gn,...r[2]?[Cn.configure({trigger:r[4],allowSpaces:!1,limit:r[5],minLength:r[6],debounce:r[7]})]:[]]),e.$set(i),r[2]?c?c.p(r,u):(c=$n(r),c.c(),c.m(n.parentNode,n)):c&&(c.d(1),c=null)},i(r){o||(Q(e.$$.fragment,r),o=!0)},o(r){x(e.$$.fragment,r),o=!1},d(r){be(e,r),r&&$(t),c&&c.d(r),r&&$(n)}}}function Qr(l,e,t){let n,o;Ue(l,Et,R=>t(9,n=R)),Ue(l,ot,R=>t(12,o=R));let{html:c=""}=e,{readOnly:r=!1}=e,{outputFormat:u="html"}=e,{enableAutocomplete:i=!0}=e,{showSnippets:d=!0}=e,{suggestionTrigger:p="++"}=e,{maxSuggestions:m=8}=e,{minQueryLength:_=1}=e,{debounceDelay:h=300}=e,w=null,v="⏳ Initializing...",y=!1,b=!1,C=null;Qt(async()=>{i&&await k(),typeof document<"u"&&(C=document.createElement("style"),C.textContent=Kr,document.head.appendChild(C))}),hs(()=>{C&&C.parentNode&&C.parentNode.removeChild(C)});async function k(){t(10,v="⏳ Initializing autocomplete..."),t(8,y=!1),t(11,b=!1);try{Pt.setRole(n),t(10,v="🔗 Testing connection...");const R=await Pt.testConnection();t(11,b=!0),R?(t(10,v="🔨 Building autocomplete index..."),await Pt.buildAutocompleteIndex()?(o?t(10,v="✅ Ready - Using Tauri backend"):t(10,v="✅ Ready - Using MCP server backend"),t(8,y=!0)):t(10,v="❌ Failed to build autocomplete index")):o?t(10,v="❌ Tauri backend not available"):t(10,v="❌ MCP server not responding")}catch(R){console.error("Error initializing autocomplete:",R),t(10,v="❌ Autocomplete initialization error")}}const S=R=>{w=R,u==="markdown"?t(0,c=R.storage.markdown.getMarkdown()):t(0,c=R.getHTML())},z=async()=>{if(!b){alert("Please wait for connection test to complete");return}if(!y){alert("Autocomplete service not ready. Check the status above.");return}try{t(10,v="🧪 Testing autocomplete...");const R="terraphim",W=await Pt.getSuggestions(R,5);if(console.log("Autocomplete test results:",W),W.length>0){const Y=W.map((J,A)=>`${A+1}. ${J.text}${J.snippet?` (${J.snippet})`:""}`).join(`
`);alert(`✅ Found ${W.length} suggestions for '${R}':

${Y}`),o?t(10,v="✅ Ready - Using Tauri backend"):t(10,v="✅ Ready - Using MCP server backend")}else alert(`⚠️ No suggestions found for '${R}'. This might be normal if the term isn't in your knowledge graph.`)}catch(R){console.error("Autocomplete test failed:",R),alert(`❌ Autocomplete test failed: ${R.message}`),t(10,v="❌ Test failed - check console for details")}},D=async()=>{t(10,v="⏳ Rebuilding index..."),t(8,y=!1);try{await Pt.refreshIndex()?(o?t(10,v="✅ Ready - Tauri index rebuilt successfully"):t(10,v="✅ Ready - MCP server index rebuilt successfully"),t(8,y=!0)):t(10,v="❌ Failed to rebuild index")}catch(R){console.error("Error rebuilding index:",R),t(10,v="❌ Index rebuild failed - check console for details")}},M=()=>{if(!w){alert("Editor not ready yet");return}const R=`# Terraphim Autocomplete Demo

This is a demonstration of the integrated Terraphim autocomplete system.

## How to Use:
1. Type "${p}" to trigger autocomplete
2. Start typing any term (e.g., "${p}terraphim", "${p}graph")
3. Use ↑↓ arrows to navigate suggestions
4. Press Tab or Enter to select
5. Press Esc to cancel

## Try these queries:
- ${p}terraphim
- ${p}graph
- ${p}service
- ${p}automata
- ${p}role

The autocomplete system uses your local knowledge graph to provide intelligent suggestions based on your selected role: **${n}**.

---

Start typing below:`;w.commands.setContent(R),setTimeout(()=>{w.commands.focus("end")},100),alert(`Demo content inserted!

Type "${p}" followed by any term to see autocomplete suggestions.

Example: "${p}terraphim"`)};return l.$$set=R=>{"html"in R&&t(0,c=R.html),"readOnly"in R&&t(1,r=R.readOnly),"outputFormat"in R&&t(17,u=R.outputFormat),"enableAutocomplete"in R&&t(2,i=R.enableAutocomplete),"showSnippets"in R&&t(3,d=R.showSnippets),"suggestionTrigger"in R&&t(4,p=R.suggestionTrigger),"maxSuggestions"in R&&t(5,m=R.maxSuggestions),"minQueryLength"in R&&t(6,_=R.minQueryLength),"debounceDelay"in R&&t(7,h=R.debounceDelay)},l.$$.update=()=>{l.$$.dirty&772&&n&&i&&y&&(Pt.setRole(n),k())},[c,r,i,d,p,m,_,h,y,n,v,b,o,S,z,D,M,u]}class Yr extends _t{constructor(e){super(),ht(this,e,Qr,Vr,ft,{html:0,readOnly:1,outputFormat:17,enableAutocomplete:2,showSnippets:3,suggestionTrigger:4,maxSuggestions:5,minQueryLength:6,debounceDelay:7})}}function Sn(l){let e,t,n,o,c,r,u,i,d,p,m;return{c(){e=f("div"),t=f("h3"),n=f("span"),n.textContent="Knowledge Graph",o=K(`
          Term: `),c=f("strong"),r=K(l[2]),u=K(" | Rank: "),i=f("strong"),d=K(l[3]),p=g(),m=f("hr"),a(n,"class","tag is-info svelte-329px1"),a(t,"class","subtitle is-6 svelte-329px1"),a(m,"class","svelte-329px1"),a(e,"class","kg-context svelte-329px1")},m(_,h){T(_,e,h),s(e,t),s(t,n),s(t,o),s(t,c),s(c,r),s(t,u),s(t,i),s(i,d),s(e,p),s(e,m)},p(_,h){h&4&&we(r,_[2]),h&8&&we(d,_[3])},d(_){_&&$(e)}}}function Zr(l){let e,t,n,o,c,r,u,i;const d=[ei,xr],p=[];function m(_,h){return _[5]?0:1}return t=m(l),n=p[t]=d[t](l),{c(){e=f("div"),n.c(),o=g(),c=f("div"),c.innerHTML='<span class="hint-text svelte-329px1">Double-click to edit • Ctrl+E to edit • Ctrl+S to save • Click KG links to explore</span>',a(c,"class","edit-hint svelte-329px1"),a(e,"class","content-viewer svelte-329px1"),a(e,"tabindex","0"),a(e,"role","button"),a(e,"aria-label","Double-click to edit article content")},m(_,h){T(_,e,h),p[t].m(e,null),s(e,o),s(e,c),l[20](e),r=!0,u||(i=[X(e,"dblclick",l[14]),X(e,"keydown",l[15]),X(e,"click",l[13])],u=!0)},p(_,h){let w=t;t=m(_),t===w?p[t].p(_,h):(Qe(),x(p[w],1,1,()=>{p[w]=null}),Ye(),n=p[t],n?n.p(_,h):(n=p[t]=d[t](_),n.c()),Q(n,1),n.m(e,o))},i(_){r||(Q(n),r=!0)},o(_){x(n),r=!1},d(_){_&&$(e),p[t].d(),l[20](null),u=!1,xe(i)}}}function Xr(l){let e,t,n,o,c,r,u,i,d,p;function m(h){l[18](h)}let _={outputFormat:l[11]};return l[1].body!==void 0&&(_.html=l[1].body),e=new Yr({props:_}),st.push(()=>at(e,"html",m)),{c(){ge(e.$$.fragment),n=g(),o=f("div"),c=f("button"),c.textContent="Save",r=g(),u=f("button"),u.textContent="Cancel",a(c,"class","button is-primary"),a(u,"class","button is-light"),a(o,"class","edit-controls svelte-329px1")},m(h,w){ve(e,h,w),T(h,n,w),T(h,o,w),s(o,c),s(o,r),s(o,u),i=!0,d||(p=[X(c,"click",l[12]),X(u,"click",l[19])],d=!0)},p(h,w){const v={};w&2048&&(v.outputFormat=h[11]),!t&&w&2&&(t=!0,v.html=h[1].body,ct(()=>t=!1)),e.$set(v)},i(h){i||(Q(e.$$.fragment,h),i=!0)},o(h){x(e.$$.fragment,h),i=!1},d(h){be(e,h),h&&$(n),h&&$(o),d=!1,xe(p)}}}function xr(l){let e,t,n;return t=new Il({props:{source:l[1].body}}),{c(){e=f("div"),ge(t.$$.fragment),a(e,"class","markdown-content svelte-329px1")},m(o,c){T(o,e,c),ve(t,e,null),n=!0},p(o,c){const r={};c&2&&(r.source=o[1].body),t.$set(r)},i(o){n||(Q(t.$$.fragment,o),n=!0)},o(o){x(t.$$.fragment,o),n=!1},d(o){o&&$(e),be(t)}}}function ei(l){let e,t=l[1].body+"";return{c(){e=f("div"),a(e,"class","prose svelte-329px1")},m(n,o){T(n,e,o),e.innerHTML=t},p(n,o){o&2&&t!==(t=n[1].body+"")&&(e.innerHTML=t)},i:De,o:De,d(n){n&&$(e)}}}function ti(l){let e,t,n,o,c,r=l[1].title+"",u,i,d,p,m,_,h,w=l[2]&&l[3]!==null&&Sn(l);const v=[Xr,Zr],y=[];function b(C,k){return C[4]?0:1}return d=b(l),p=y[d]=v[d](l),{c(){e=f("div"),t=f("button"),n=g(),w&&w.c(),o=g(),c=f("h2"),u=K(r),i=g(),p.c(),a(t,"class","delete is-large modal-close-btn svelte-329px1"),a(t,"aria-label","close"),a(c,"class","svelte-329px1"),a(e,"class","box wrapper svelte-329px1")},m(C,k){T(C,e,k),s(e,t),s(e,n),w&&w.m(e,null),s(e,o),s(e,c),s(c,u),s(e,i),y[d].m(e,null),m=!0,_||(h=X(t,"click",l[17]),_=!0)},p(C,k){C[2]&&C[3]!==null?w?w.p(C,k):(w=Sn(C),w.c(),w.m(e,o)):w&&(w.d(1),w=null),(!m||k&2)&&r!==(r=C[1].title+"")&&we(u,r);let S=d;d=b(C),d===S?y[d].p(C,k):(Qe(),x(y[S],1,1,()=>{y[S]=null}),Ye(),p=y[d],p?p.p(C,k):(p=y[d]=v[d](C),p.c()),Q(p,1),p.m(e,null))},i(C){m||(Q(p),m=!0)},o(C){x(p),m=!1},d(C){C&&$(e),w&&w.d(),y[d].d(),_=!1,h()}}}function Rn(l){let e,t,n;function o(r){l[23](r)}let c={$$slots:{default:[oi]},$$scope:{ctx:l}};return l[7]!==void 0&&(c.active=l[7]),e=new Dl({props:c}),st.push(()=>at(e,"active",o)),{c(){ge(e.$$.fragment)},m(r,u){ve(e,r,u),n=!0},p(r,u){const i={};u&536872832&&(i.$$scope={dirty:u,ctx:r}),!t&&u&128&&(t=!0,i.active=r[7],ct(()=>t=!1)),e.$set(i)},i(r){n||(Q(e.$$.fragment,r),n=!0)},o(r){x(e.$$.fragment,r),n=!1},d(r){be(e,r)}}}function En(l){let e,t,n,o,c,r,u,i,d,p,m;return{c(){e=f("div"),t=f("h3"),n=f("span"),n.textContent="Knowledge Graph",o=K(`
            Term: `),c=f("strong"),r=K(l[9]),u=K(" | Rank: "),i=f("strong"),d=K(l[10]),p=g(),m=f("hr"),a(n,"class","tag is-info svelte-329px1"),a(t,"class","subtitle is-6 svelte-329px1"),a(m,"class","svelte-329px1"),a(e,"class","kg-context svelte-329px1")},m(_,h){T(_,e,h),s(e,t),s(t,n),s(t,o),s(t,c),s(c,r),s(t,u),s(t,i),s(i,d),s(e,p),s(e,m)},p(_,h){h&512&&we(r,_[9]),h&1024&&we(d,_[10])},d(_){_&&$(e)}}}function li(l){let e,t,n;return t=new Il({props:{source:l[8].body}}),{c(){e=f("div"),ge(t.$$.fragment),a(e,"class","markdown-content svelte-329px1")},m(o,c){T(o,e,c),ve(t,e,null),n=!0},p(o,c){const r={};c&256&&(r.source=o[8].body),t.$set(r)},i(o){n||(Q(t.$$.fragment,o),n=!0)},o(o){x(t.$$.fragment,o),n=!1},d(o){o&&$(e),be(t)}}}function ni(l){let e,t=l[8].body+"";return{c(){e=f("div"),a(e,"class","prose svelte-329px1")},m(n,o){T(n,e,o),e.innerHTML=t},p(n,o){o&256&&t!==(t=n[8].body+"")&&(e.innerHTML=t)},i:De,o:De,d(n){n&&$(e)}}}function oi(l){let e,t,n,o,c,r=l[8].title+"",u,i,d,p,m,_,h,w,v,y,b,C=l[9]&&l[10]!==null&&En(l);const k=[ni,li],S=[];function z(D,M){return M&256&&(p=null),p==null&&(p=!!(D[8].body&&(/<html/i.test(D[8].body)||/<body/i.test(D[8].body)||/<head/i.test(D[8].body)))),p?0:1}return m=z(l,-1),_=S[m]=k[m](l),{c(){e=f("div"),t=f("button"),n=g(),C&&C.c(),o=g(),c=f("h2"),u=K(r),i=g(),d=f("div"),_.c(),h=g(),w=f("div"),w.innerHTML='<span class="hint-text svelte-329px1">Knowledge Graph document • Click KG links to explore further</span>',a(t,"class","delete is-large modal-close-btn svelte-329px1"),a(t,"aria-label","close"),a(c,"class","svelte-329px1"),a(w,"class","edit-hint svelte-329px1"),a(d,"class","content-viewer svelte-329px1"),a(d,"tabindex","0"),a(d,"role","button"),a(d,"aria-label","KG document content - click KG links to explore further"),a(e,"class","box wrapper svelte-329px1")},m(D,M){T(D,e,M),s(e,t),s(e,n),C&&C.m(e,null),s(e,o),s(e,c),s(c,u),s(e,i),s(e,d),S[m].m(d,null),s(d,h),s(d,w),v=!0,y||(b=[X(t,"click",l[22]),X(d,"click",l[13])],y=!0)},p(D,M){D[9]&&D[10]!==null?C?C.p(D,M):(C=En(D),C.c(),C.m(e,o)):C&&(C.d(1),C=null),(!v||M&256)&&r!==(r=D[8].title+"")&&we(u,r);let R=m;m=z(D,M),m===R?S[m].p(D,M):(Qe(),x(S[R],1,1,()=>{S[R]=null}),Ye(),_=S[m],_?_.p(D,M):(_=S[m]=k[m](D),_.c()),Q(_,1),_.m(d,h))},i(D){v||(Q(_),v=!0)},o(D){x(_),v=!1},d(D){D&&$(e),C&&C.d(),S[m].d(),y=!1,xe(b)}}}function si(l){let e,t,n,o,c;function r(d){l[21](d)}let u={$$slots:{default:[ti]},$$scope:{ctx:l}};l[0]!==void 0&&(u.active=l[0]),e=new Dl({props:u}),st.push(()=>at(e,"active",r));let i=l[8]&&Rn(l);return{c(){ge(e.$$.fragment),n=g(),i&&i.c(),o=rt()},m(d,p){ve(e,d,p),T(d,n,p),i&&i.m(d,p),T(d,o,p),c=!0},p(d,[p]){const m={};p&536873087&&(m.$$scope={dirty:p,ctx:d}),!t&&p&1&&(t=!0,m.active=d[0],ct(()=>t=!1)),e.$set(m),d[8]?i?(i.p(d,p),p&256&&Q(i,1)):(i=Rn(d),i.c(),Q(i,1),i.m(o.parentNode,o)):i&&(Qe(),x(i,1,1,()=>{i=null}),Ye())},i(d){c||(Q(e.$$.fragment,d),Q(i),c=!0)},o(d){x(e.$$.fragment,d),x(i),c=!1},d(d){be(e,d),d&&$(n),i&&i.d(d),d&&$(o)}}}function ri(l,e,t){let n,o,c,r;Ue(l,ot,q=>t(25,c=q)),Ue(l,Et,q=>t(26,r=q));let{active:u=!1}=e,{item:i}=e,{initialEdit:d=!1}=e,{kgTerm:p=null}=e,{kgRank:m=null}=e,_=!1,h,w=!1,v=null,y=null,b=null;async function C(){if(c)try{const q=await Fe("get_document",{documentId:i.id});q!=null&&q.document&&t(1,i=q.document)}catch(q){console.error("Failed to load document",q)}}async function k(){if(!c){t(4,_=!1);return}try{await Fe("create_document",{document:i}),t(4,_=!1)}catch(q){console.error("Failed to save document",q)}}async function S(q){var re,ne,V,oe,I;t(9,y=q),console.log("🔍 KG Link Click Debug Info:"),console.log("  Term clicked:",q),console.log("  Current role:",r),console.log("  Is Tauri mode:",c);try{if(c){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:r,term:q});const U=await Fe("find_documents_for_kg_term",{roleName:r,term:q});console.log("  📥 Tauri response received:"),console.log("    Status:",U.status),console.log("    Results count:",((re=U.results)==null?void 0:re.length)||0),console.log("    Total:",U.total||0),console.log("    Full response:",JSON.stringify(U,null,2)),U.status==="success"&&U.results&&U.results.length>0?(t(8,v=U.results[0]),t(10,b=v.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",v.title),console.log("    Rank:",b),console.log("    Body length:",((ne=v.body)==null?void 0:ne.length)||0,"characters"),t(7,w=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${q}" in role: "${r}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const U=Ze.ServerURL,O=encodeURIComponent(r),L=encodeURIComponent(q),B=`${U}/roles/${O}/kg_search?term=${L}`;console.log("  📤 HTTP Request details:"),console.log("    Base URL:",U),console.log("    Role (encoded):",O),console.log("    Term (encoded):",L),console.log("    Full URL:",B);const Z=await fetch(B);if(console.log("  📥 HTTP Response received:"),console.log("    Status code:",Z.status),console.log("    Status text:",Z.statusText),console.log("    Headers:",Object.fromEntries(Z.headers.entries())),!Z.ok)throw new Error(`HTTP error! Status: ${Z.status} - ${Z.statusText}`);const te=await Z.json();console.log("  📄 Response data:"),console.log("    Status:",te.status),console.log("    Results count:",((V=te.results)==null?void 0:V.length)||0),console.log("    Total:",te.total||0),console.log("    Full response:",JSON.stringify(te,null,2)),te.status==="success"&&te.results&&te.results.length>0?(t(8,v=te.results[0]),t(10,b=v.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",v.title),console.log("    Rank:",b),console.log("    Body length:",((oe=v.body)==null?void 0:oe.length)||0,"characters"),t(7,w=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${q}" in role: "${r}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",B))}}catch(U){console.error("❌ Error fetching KG document:"),console.error("  Error type:",U.constructor.name),console.error("  Error message:",U.message||U),console.error("  Request details:",{term:q,role:r,isTauri:c,timestamp:new Date().toISOString()}),!c&&((I=U.message)!=null&&I.includes("Failed to fetch"))&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{}}function z(q){const re=q.target;if(re.tagName==="A"){const ne=re.getAttribute("href");if(ne&&ne.startsWith("kg:")){q.preventDefault();const V=ne.substring(3);S(V)}}}function D(){t(4,_=!0)}function M(q){q.type!=="dblclick"&&((q.ctrlKey||q.metaKey)&&q.key==="e"&&(q.preventDefault(),t(4,_=!0)),_&&(q.ctrlKey||q.metaKey)&&q.key==="s"&&(q.preventDefault(),k()),q.key==="Escape"&&(q.preventDefault(),_?t(4,_=!1):t(0,u=!1)))}const R=()=>t(0,u=!1);function W(q){l.$$.not_equal(i.body,q)&&(i.body=q,t(1,i))}const Y=()=>t(4,_=!1);function J(q){st[q?"unshift":"push"](()=>{h=q,t(6,h)})}function A(q){u=q,t(0,u)}const E=()=>t(7,w=!1);function ce(q){w=q,t(7,w)}return l.$$set=q=>{"active"in q&&t(0,u=q.active),"item"in q&&t(1,i=q.item),"initialEdit"in q&&t(16,d=q.initialEdit),"kgTerm"in q&&t(2,p=q.kgTerm),"kgRank"in q&&t(3,m=q.kgRank)},l.$$.update=()=>{l.$$.dirty&65537&&u&&d&&t(4,_=!0),l.$$.dirty&19&&u&&i&&!_&&C(),l.$$.dirty&2&&t(5,n=i!=null&&i.body?/<html/i.test(i.body)||/<body/i.test(i.body)||/<head/i.test(i.body)||/^\s*<(!DOCTYPE|html|head|body|div|p|span)/i.test(i.body.trim()):!1),l.$$.dirty&32&&t(11,o=n?"html":"markdown")},[u,i,p,m,_,n,h,w,v,y,b,o,k,z,D,M,d,R,W,Y,J,A,E,ce]}class Gl extends _t{constructor(e){super(),ht(this,e,ri,si,ft,{active:0,item:1,initialEdit:16,kgTerm:2,kgRank:3})}}function Ln(l,e,t){const n=l.slice();return n[33]=e[t],n}function An(l,e,t){const n=l.slice();return n[36]=e[t],n}function On(l,e,t){const n=l.slice();return n[39]=e[t],n}function Nn(l){let e,t;return e=new gs({props:{type:"is-success",$$slots:{default:[ii]},$$scope:{ctx:l}}}),{c(){ge(e.$$.fragment)},m(n,o){ve(e,n,o),t=!0},i(n){t||(Q(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){be(e,n)}}}function ii(l){let e,t,n;return{c(){e=f("p"),e.innerHTML="<strong>Success!</strong> Article saved to atomic server successfully.",t=g(),n=f("p"),n.textContent="The modal will close automatically..."},m(o,c){T(o,e,c),T(o,t,c),T(o,n,c)},p:De,d(o){o&&$(e),o&&$(t),o&&$(n)}}}function Pn(l){let e,t;return e=new gs({props:{type:"is-danger",$$slots:{default:[ai]},$$scope:{ctx:l}}}),{c(){ge(e.$$.fragment)},m(n,o){ve(e,n,o),t=!0},p(n,o){const c={};o[0]&8|o[1]&2048&&(c.$$scope={dirty:o,ctx:n}),e.$set(c)},i(n){t||(Q(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){be(e,n)}}}function ai(l){let e,t,n,o;return{c(){e=f("p"),t=f("strong"),t.textContent="Error:",n=g(),o=K(l[3])},m(c,r){T(c,e,r),s(e,t),s(e,n),s(e,o)},p(c,r){r[0]&8&&we(o,c[3])},d(c){c&&$(e)}}}function Dn(l){var ce,q,re,ne;let e,t,n,o,c,r=(((ce=l[1])==null?void 0:ce.title)||"Untitled")+"",u,i,d,p,m,_,h=(((q=l[1])==null?void 0:q.rank)||0)+"",w,v,y,b,C,k,S,z,D,M,R=((re=l[1])==null?void 0:re.description)&&Mn(l),W=((ne=l[1])==null?void 0:ne.tags)&&In(l);function Y(V,oe){return V[10].length>0?ui:ci}let J=Y(l),A=J(l),E=l[10].length>0&&Hn(l);return{c(){e=f("div"),t=f("label"),t.textContent="Document to Save",n=g(),o=f("div"),c=f("h5"),u=K(r),i=g(),R&&R.c(),d=g(),p=f("div"),m=f("span"),_=K("Rank: "),w=K(h),v=g(),W&&W.c(),y=g(),b=f("div"),C=f("label"),C.textContent="Atomic Server",k=g(),S=f("div"),A.c(),z=g(),E&&E.c(),D=rt(),a(t,"class","label"),a(c,"class","title is-6"),a(m,"class","tag is-info svelte-48g63o"),a(p,"class","tags svelte-48g63o"),a(o,"class","box document-preview svelte-48g63o"),a(e,"class","field"),a(C,"class","label"),a(C,"for","atomic-server-select"),a(S,"class","control"),a(b,"class","field")},m(V,oe){T(V,e,oe),s(e,t),s(e,n),s(e,o),s(o,c),s(c,u),s(o,i),R&&R.m(o,null),s(o,d),s(o,p),s(p,m),s(m,_),s(m,w),s(p,v),W&&W.m(p,null),T(V,y,oe),T(V,b,oe),s(b,C),s(b,k),s(b,S),A.m(S,null),T(V,z,oe),E&&E.m(V,oe),T(V,D,oe),M=!0},p(V,oe){var I,U,O,L;(!M||oe[0]&2)&&r!==(r=(((I=V[1])==null?void 0:I.title)||"Untitled")+"")&&we(u,r),(U=V[1])!=null&&U.description?R?R.p(V,oe):(R=Mn(V),R.c(),R.m(o,d)):R&&(R.d(1),R=null),(!M||oe[0]&2)&&h!==(h=(((O=V[1])==null?void 0:O.rank)||0)+"")&&we(w,h),(L=V[1])!=null&&L.tags?W?W.p(V,oe):(W=In(V),W.c(),W.m(p,null)):W&&(W.d(1),W=null),J===(J=Y(V))&&A?A.p(V,oe):(A.d(1),A=J(V),A&&(A.c(),A.m(S,null))),V[10].length>0?E?(E.p(V,oe),oe[0]&1024&&Q(E,1)):(E=Hn(V),E.c(),Q(E,1),E.m(D.parentNode,D)):E&&(Qe(),x(E,1,1,()=>{E=null}),Ye())},i(V){M||(Q(E),M=!0)},o(V){x(E),M=!1},d(V){V&&$(e),R&&R.d(),W&&W.d(),V&&$(y),V&&$(b),A.d(),V&&$(z),E&&E.d(V),V&&$(D)}}}function Mn(l){let e,t=l[1].description+"",n;return{c(){e=f("p"),n=K(t),a(e,"class","content")},m(o,c){T(o,e,c),s(e,n)},p(o,c){c[0]&2&&t!==(t=o[1].description+"")&&we(n,t)},d(o){o&&$(e)}}}function In(l){let e,t=l[1].tags,n=[];for(let o=0;o<t.length;o+=1)n[o]=Un(On(l,t,o));return{c(){for(let o=0;o<n.length;o+=1)n[o].c();e=rt()},m(o,c){for(let r=0;r<n.length;r+=1)n[r]&&n[r].m(o,c);T(o,e,c)},p(o,c){if(c[0]&2){t=o[1].tags;let r;for(r=0;r<t.length;r+=1){const u=On(o,t,r);n[r]?n[r].p(u,c):(n[r]=Un(u),n[r].c(),n[r].m(e.parentNode,e))}for(;r<n.length;r+=1)n[r].d(1);n.length=t.length}},d(o){Xe(n,o),o&&$(e)}}}function Un(l){let e,t=l[39]+"",n;return{c(){e=f("span"),n=K(t),a(e,"class","tag svelte-48g63o")},m(o,c){T(o,e,c),s(e,n)},p(o,c){c[0]&2&&t!==(t=o[39]+"")&&we(n,t)},d(o){o&&$(e)}}}function ci(l){let e,t,n,o,c,r,u,i,d;return{c(){e=f("div"),t=f("p"),t.innerHTML="<strong>No atomic servers available</strong>",n=g(),o=f("p"),c=K('Your current role "'),r=K(l[12]),u=K(`" doesn't have any writable atomic server configurations.`),i=g(),d=f("p"),d.textContent="Please configure an atomic server haystack in your role settings.",a(e,"class","notification is-warning")},m(p,m){T(p,e,m),s(e,t),s(e,n),s(e,o),s(o,c),s(o,r),s(o,u),s(e,i),s(e,d)},p(p,m){m[0]&4096&&we(r,p[12])},d(p){p&&$(e)}}}function ui(l){let e,t,n,o,c,r,u=l[10],i=[];for(let d=0;d<u.length;d+=1)i[d]=jn(An(l,u,d));return{c(){e=f("div"),t=f("select");for(let d=0;d<i.length;d+=1)i[d].c();n=g(),o=f("p"),o.textContent=`Select the atomic server from your current role configuration.
              🔐 = Authenticated, ⚠️ = Anonymous access`,a(t,"id","atomic-server-select"),t.disabled=l[2],l[11]===void 0&&it(()=>l[18].call(t)),a(e,"class","select is-fullwidth"),a(o,"class","help svelte-48g63o")},m(d,p){T(d,e,p),s(e,t);for(let m=0;m<i.length;m+=1)i[m]&&i[m].m(t,null);qe(t,l[11],!0),T(d,n,p),T(d,o,p),c||(r=X(t,"change",l[18]),c=!0)},p(d,p){if(p[0]&1024){u=d[10];let m;for(m=0;m<u.length;m+=1){const _=An(d,u,m);i[m]?i[m].p(_,p):(i[m]=jn(_),i[m].c(),i[m].m(t,null))}for(;m<i.length;m+=1)i[m].d(1);i.length=u.length}p[0]&4&&(t.disabled=d[2]),p[0]&3072&&qe(t,d[11])},d(d){d&&$(e),Xe(i,d),d&&$(n),d&&$(o),c=!1,r()}}}function fi(l){let e;return{c(){e=f("span"),e.textContent="⚠️ No Auth",a(e,"class","has-text-warning")},m(t,n){T(t,e,n)},d(t){t&&$(e)}}}function di(l){let e;return{c(){e=f("span"),e.textContent="🔐",a(e,"class","has-text-success")},m(t,n){T(t,e,n)},d(t){t&&$(e)}}}function jn(l){let e,t=l[36].location+"",n,o,c,r;function u(p,m){return p[36].atomic_server_secret?di:fi}let i=u(l),d=i(l);return{c(){e=f("option"),n=K(t),o=g(),d.c(),c=g(),e.__value=r=l[36].location,e.value=e.__value},m(p,m){T(p,e,m),s(e,n),s(e,o),d.m(e,null),s(e,c)},p(p,m){m[0]&1024&&t!==(t=p[36].location+"")&&we(n,t),i!==(i=u(p))&&(d.d(1),d=i(p),d&&(d.c(),d.m(e,c))),m[0]&1024&&r!==(r=p[36].location)&&(e.__value=r,e.value=e.__value)},d(p){p&&$(e),d.d()}}}function Hn(l){var j,G;let e,t,n,o,c,r,u,i,d,p,m,_,h,w,v,y,b,C,k,S,z,D,M,R,W,Y,J,A,E,ce,q,re,ne,V,oe,I,U,O,L,B,Z,te,P,N=(l[8]||"Untitled")+"",F,ae,le,ee,me,_e=(((G=(j=l[1])==null?void 0:j.body)==null?void 0:G.length)||0)+"",fe,de,pe,he,Se,Ge,je=l[14]()+"",Le,Re,se,ye,Ne,Be=l[15]()+"",Ke,$e,Pe,et,Je;function Me(H){l[19](H)}let He={id:"article-title",placeholder:"Enter article title",disabled:l[2],required:!0};l[8]!==void 0&&(He.value=l[8]),c=new Yt({props:He}),st.push(()=>at(c,"value",Me));const tt=[mi,pi],ue=[];function Ae(H,ie){return H[7]?1:0}return Y=Ae(l),J=ue[Y]=tt[Y](l),q=new Nl({props:{type:"is-primary",loading:l[2],disabled:l[2]||!l[8].trim()||!l[11],$$slots:{default:[_i]},$$scope:{ctx:l}}}),q.$on("click",l[16]),V=new Nl({props:{type:"is-light",disabled:l[2],$$slots:{default:[hi]},$$scope:{ctx:l}}}),V.$on("click",l[17]),Pe=Us(l[22][0]),{c(){e=f("div"),t=f("label"),t.textContent="Article Title",n=g(),o=f("div"),ge(c.$$.fragment),u=g(),i=f("div"),d=f("label"),d.textContent="Description",p=g(),m=f("div"),_=f("textarea"),h=g(),w=f("div"),v=f("label"),v.textContent="Parent Collection",y=g(),b=f("div"),C=f("label"),k=f("input"),S=K(`
              Use predefined collection`),z=g(),D=f("label"),M=f("input"),R=K(`
              Custom parent URL/path`),W=g(),J.c(),A=g(),E=f("div"),ce=f("div"),ge(q.$$.fragment),re=g(),ne=f("div"),ge(V.$$.fragment),oe=g(),I=f("div"),U=f("div"),O=f("p"),O.innerHTML="<strong>What will be saved:</strong>",L=g(),B=f("ul"),Z=f("li"),te=f("strong"),te.textContent="Title:",P=g(),F=K(N),ae=g(),le=f("li"),ee=f("strong"),ee.textContent="Body:",me=K(" Original document content ("),fe=K(_e),de=K(" characters)"),pe=g(),he=f("li"),Se=f("strong"),Se.textContent="Parent:",Ge=g(),Le=K(je),Re=g(),se=f("li"),ye=f("strong"),ye.textContent="Subject URL:",Ne=g(),Ke=K(Be),a(t,"class","label"),a(t,"for","article-title"),a(o,"class","control"),a(e,"class","field"),a(d,"class","label"),a(d,"for","article-description"),a(_,"id","article-description"),a(_,"class","textarea"),a(_,"placeholder","Brief description of the article"),_.disabled=l[2],a(_,"rows","3"),a(m,"class","control"),a(i,"class","field"),a(v,"class","label"),a(k,"type","radio"),k.__value=!1,k.value=k.__value,k.disabled=l[2],a(C,"class","radio svelte-48g63o"),a(M,"type","radio"),M.__value=!0,M.value=M.__value,M.disabled=l[2],a(D,"class","radio svelte-48g63o"),a(b,"class","control"),a(w,"class","field"),a(ce,"class","control"),a(ne,"class","control"),a(E,"class","field is-grouped"),a(Z,"class","svelte-48g63o"),a(le,"class","svelte-48g63o"),a(he,"class","svelte-48g63o"),a(se,"class","svelte-48g63o"),a(B,"class","svelte-48g63o"),a(U,"class","notification is-info is-light svelte-48g63o"),a(I,"class","field"),Pe.p(k,M)},m(H,ie){T(H,e,ie),s(e,t),s(e,n),s(e,o),ve(c,o,null),T(H,u,ie),T(H,i,ie),s(i,d),s(i,p),s(i,m),s(m,_),Oe(_,l[9]),T(H,h,ie),T(H,w,ie),s(w,v),s(w,y),s(w,b),s(b,C),s(C,k),k.checked=k.__value===l[7],s(C,S),s(b,z),s(b,D),s(D,M),M.checked=M.__value===l[7],s(D,R),T(H,W,ie),ue[Y].m(H,ie),T(H,A,ie),T(H,E,ie),s(E,ce),ve(q,ce,null),s(E,re),s(E,ne),ve(V,ne,null),T(H,oe,ie),T(H,I,ie),s(I,U),s(U,O),s(U,L),s(U,B),s(B,Z),s(Z,te),s(Z,P),s(Z,F),s(B,ae),s(B,le),s(le,ee),s(le,me),s(le,fe),s(le,de),s(B,pe),s(B,he),s(he,Se),s(he,Ge),s(he,Le),s(B,Re),s(B,se),s(se,ye),s(se,Ne),s(se,Ke),$e=!0,et||(Je=[X(_,"input",l[20]),X(k,"change",l[21]),X(M,"change",l[23])],et=!0)},p(H,ie){var ze,lt;const Te={};ie[0]&4&&(Te.disabled=H[2]),!r&&ie[0]&256&&(r=!0,Te.value=H[8],ct(()=>r=!1)),c.$set(Te),(!$e||ie[0]&4)&&(_.disabled=H[2]),ie[0]&512&&Oe(_,H[9]),(!$e||ie[0]&4)&&(k.disabled=H[2]),ie[0]&128&&(k.checked=k.__value===H[7]),(!$e||ie[0]&4)&&(M.disabled=H[2]),ie[0]&128&&(M.checked=M.__value===H[7]);let Ce=Y;Y=Ae(H),Y===Ce?ue[Y].p(H,ie):(Qe(),x(ue[Ce],1,1,()=>{ue[Ce]=null}),Ye(),J=ue[Y],J?J.p(H,ie):(J=ue[Y]=tt[Y](H),J.c()),Q(J,1),J.m(A.parentNode,A));const Ve={};ie[0]&4&&(Ve.loading=H[2]),ie[0]&2308&&(Ve.disabled=H[2]||!H[8].trim()||!H[11]),ie[1]&2048&&(Ve.$$scope={dirty:ie,ctx:H}),q.$set(Ve);const nt={};ie[0]&4&&(nt.disabled=H[2]),ie[1]&2048&&(nt.$$scope={dirty:ie,ctx:H}),V.$set(nt),(!$e||ie[0]&256)&&N!==(N=(H[8]||"Untitled")+"")&&we(F,N),(!$e||ie[0]&2)&&_e!==(_e=(((lt=(ze=H[1])==null?void 0:ze.body)==null?void 0:lt.length)||0)+"")&&we(fe,_e)},i(H){$e||(Q(c.$$.fragment,H),Q(J),Q(q.$$.fragment,H),Q(V.$$.fragment,H),$e=!0)},o(H){x(c.$$.fragment,H),x(J),x(q.$$.fragment,H),x(V.$$.fragment,H),$e=!1},d(H){H&&$(e),be(c),H&&$(u),H&&$(i),H&&$(h),H&&$(w),H&&$(W),ue[Y].d(H),H&&$(A),H&&$(E),be(q),be(V),H&&$(oe),H&&$(I),Pe.r(),et=!1,xe(Je)}}}function pi(l){let e,t,n,o,c,r,u;function i(p){l[25](p)}let d={placeholder:"e.g., my-collection or http://server/custom-parent",disabled:l[2]};return l[6]!==void 0&&(d.value=l[6]),n=new Yt({props:d}),st.push(()=>at(n,"value",i)),{c(){e=f("div"),t=f("div"),ge(n.$$.fragment),c=g(),r=f("p"),r.textContent=`Enter a collection name (e.g., "my-articles") or full URL.
              If the collection doesn't exist, it will be created.`,a(t,"class","control"),a(r,"class","help svelte-48g63o"),a(e,"class","field")},m(p,m){T(p,e,m),s(e,t),ve(n,t,null),s(e,c),s(e,r),u=!0},p(p,m){const _={};m[0]&4&&(_.disabled=p[2]),!o&&m[0]&64&&(o=!0,_.value=p[6],ct(()=>o=!1)),n.$set(_)},i(p){u||(Q(n.$$.fragment,p),u=!0)},o(p){x(n.$$.fragment,p),u=!1},d(p){p&&$(e),be(n)}}}function mi(l){let e,t,n,o,c,r,u=l[13],i=[];for(let d=0;d<u.length;d+=1)i[d]=zn(Ln(l,u,d));return{c(){e=f("div"),t=f("div"),n=f("div"),o=f("select");for(let d=0;d<i.length;d+=1)i[d].c();o.disabled=l[2],l[5]===void 0&&it(()=>l[24].call(o)),a(n,"class","select is-fullwidth"),a(t,"class","control"),a(e,"class","field")},m(d,p){T(d,e,p),s(e,t),s(t,n),s(n,o);for(let m=0;m<i.length;m+=1)i[m]&&i[m].m(o,null);qe(o,l[5],!0),c||(r=X(o,"change",l[24]),c=!0)},p(d,p){if(p[0]&8192){u=d[13];let m;for(m=0;m<u.length;m+=1){const _=Ln(d,u,m);i[m]?i[m].p(_,p):(i[m]=zn(_),i[m].c(),i[m].m(o,null))}for(;m<i.length;m+=1)i[m].d(1);i.length=u.length}p[0]&4&&(o.disabled=d[2]),p[0]&8224&&qe(o,d[5])},i:De,o:De,d(d){d&&$(e),Xe(i,d),c=!1,r()}}}function zn(l){let e,t=l[33].label+"",n;return{c(){e=f("option"),n=K(t),e.__value=l[33].value,e.value=e.__value},m(o,c){T(o,e,c),s(e,n)},p:De,d(o){o&&$(e)}}}function _i(l){let e,t,n;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-cloud-upload-alt"></i>',t=g(),n=f("span"),n.textContent="Save to Atomic Server",a(e,"class","icon")},m(o,c){T(o,e,c),T(o,t,c),T(o,n,c)},p:De,d(o){o&&$(e),o&&$(t),o&&$(n)}}}function hi(l){let e;return{c(){e=K("Cancel")},m(t,n){T(t,e,n)},d(t){t&&$(e)}}}function gi(l){let e,t,n,o,c,r,u,i,d,p,m,_,h,w=l[4]&&Nn(l),v=l[3]&&Pn(l),y=!l[4]&&Dn(l);return{c(){e=f("div"),t=f("div"),n=f("div"),n.innerHTML=`<div class="level-item"><h3 class="title is-4"><span class="icon"><i class="fas fa-save"></i></span>
            Save to Atomic Server</h3></div>`,o=g(),c=f("div"),r=f("div"),u=f("button"),i=g(),w&&w.c(),d=g(),v&&v.c(),p=g(),y&&y.c(),a(n,"class","level-left"),a(u,"class","delete is-large"),u.disabled=l[2],a(u,"aria-label","close"),a(r,"class","level-item"),a(c,"class","level-right"),a(t,"class","level svelte-48g63o"),a(e,"class","box")},m(b,C){T(b,e,C),s(e,t),s(t,n),s(t,o),s(t,c),s(c,r),s(r,u),s(e,i),w&&w.m(e,null),s(e,d),v&&v.m(e,null),s(e,p),y&&y.m(e,null),m=!0,_||(h=X(u,"click",l[17]),_=!0)},p(b,C){(!m||C[0]&4)&&(u.disabled=b[2]),b[4]?w?C[0]&16&&Q(w,1):(w=Nn(b),w.c(),Q(w,1),w.m(e,d)):w&&(Qe(),x(w,1,1,()=>{w=null}),Ye()),b[3]?v?(v.p(b,C),C[0]&8&&Q(v,1)):(v=Pn(b),v.c(),Q(v,1),v.m(e,p)):v&&(Qe(),x(v,1,1,()=>{v=null}),Ye()),b[4]?y&&(Qe(),x(y,1,1,()=>{y=null}),Ye()):y?(y.p(b,C),C[0]&16&&Q(y,1)):(y=Dn(b),y.c(),Q(y,1),y.m(e,null))},i(b){m||(Q(w),Q(v),Q(y),m=!0)},o(b){x(w),x(v),x(y),m=!1},d(b){b&&$(e),w&&w.d(),v&&v.d(),y&&y.d(),_=!1,h()}}}function vi(l){let e,t,n;function o(r){l[26](r)}let c={$$slots:{default:[gi]},$$scope:{ctx:l}};return l[0]!==void 0&&(c.active=l[0]),e=new Dl({props:c}),st.push(()=>at(e,"active",o)),e.$on("close",l[17]),{c(){ge(e.$$.fragment)},m(r,u){ve(e,r,u),n=!0},p(r,u){const i={};u[0]&8190|u[1]&2048&&(i.$$scope={dirty:u,ctx:r}),!t&&u[0]&1&&(t=!0,i.active=r[0],ct(()=>t=!1)),e.$set(i)},i(r){n||(Q(e.$$.fragment,r),n=!0)},o(r){x(e.$$.fragment,r),n=!1},d(r){be(e,r)}}}function bi(l,e,t){let n,o,c;Ue(l,ot,I=>t(27,n=I)),Ue(l,Lt,I=>t(28,o=I)),Ue(l,Et,I=>t(12,c=I));let{active:r=!1}=e,{document:u}=e,i=!1,d=null,p=!1,m="",_="",h=!1,w="",v="",y=[],b="";const C=[{label:"Root (Server Root)",value:""},{label:"Articles Collection",value:"articles"},{label:"Documents Collection",value:"documents"},{label:"Knowledge Base",value:"knowledge-base"},{label:"Research",value:"research"},{label:"Projects",value:"projects"}];function k(){t(2,i=!1),t(3,d=null),t(4,p=!1),t(5,m=""),t(6,_=""),t(7,h=!1),t(8,w=(u==null?void 0:u.title)||""),t(9,v=(u==null?void 0:u.description)||`Article saved from Terraphim search: ${u==null?void 0:u.title}`),t(10,y=[]),t(11,b="")}function S(){var L;const I=c,U=o;if(!(U!=null&&U.roles)||!I){console.warn("No role configuration found");return}let O=null;try{for(const[B,Z]of Object.entries(U.roles)){const te=Z,P=typeof te.name=="object"?te.name.original:String(te.name);if(B===I||P===I){O=te;break}}}catch(B){console.warn("Error checking role configuration:",B);return}if(!O){console.warn(`Role "${I}" not found in configuration`);return}t(10,y=((L=O.haystacks)==null?void 0:L.filter(B=>B.service==="Atomic"&&B.location&&!B.read_only))||[]),y.length>0&&t(11,b=y[0].location),console.log("Loaded atomic servers:",y)}function z(){const I=y.find(U=>U.location===b);return I==null?void 0:I.atomic_server_secret}function D(){const I=b.replace(/\/$/,"");if(h&&_.trim()){const U=_.trim();return U.startsWith("http://")||U.startsWith("https://")?U:`${I}/${U.replace(/^\//,"")}`}else return m?`${I}/${m}`:I}function M(){return w.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,50)}function R(){const I=b.replace(/\/$/,""),U=M(),O=Date.now();return`${I}/${U}-${O}`}async function W(){if(!b||!w.trim()){t(3,d="Please select an atomic server and provide a title");return}t(2,i=!0),t(3,d=null);try{const I=R(),U=D(),O=z();console.log("🔄 Saving article to atomic server:",{subject:I,parent:U,server:b,hasSecret:!!O});const L={subject:I,title:w.trim(),description:v.trim(),body:u.body,parent:U,shortname:M(),original_id:u.id,original_url:u.url,original_rank:u.rank,tags:u.tags||[]};if(n)await Fe("save_article_to_atomic",{article:L,serverUrl:b,atomicSecret:O});else{const B=await fetch(`${Ze.ServerURL}/atomic/save`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({article:L,server_url:b,atomic_secret:O})});if(!B.ok){const Z=await B.json().catch(()=>({error:B.statusText}));throw new Error(Z.error||`HTTP ${B.status}: ${B.statusText}`)}}t(4,p=!0),console.log("✅ Article saved successfully to atomic server"),setTimeout(()=>{t(0,r=!1)},2e3)}catch(I){console.error("❌ Failed to save article to atomic server:",I),t(3,d=I.message||"Failed to save article to atomic server")}finally{t(2,i=!1)}}function Y(){i||t(0,r=!1)}const J=[[]];function A(){b=Tt(this),t(11,b),t(10,y)}function E(I){w=I,t(8,w)}function ce(){v=this.value,t(9,v)}function q(){h=this.__value,t(7,h)}function re(){h=this.__value,t(7,h)}function ne(){m=Tt(this),t(5,m),t(13,C)}function V(I){_=I,t(6,_)}function oe(I){r=I,t(0,r)}return l.$$set=I=>{"active"in I&&t(0,r=I.active),"document"in I&&t(1,u=I.document)},l.$$.update=()=>{l.$$.dirty[0]&3&&r&&u&&(k(),S())},[r,u,i,d,p,m,_,h,w,v,y,b,c,C,D,R,W,Y,A,E,ce,q,J,re,ne,V,oe]}class ki extends _t{constructor(e){super(),ht(this,e,bi,vi,ft,{active:0,document:1},null,[-1,-1])}}async function Bl(l){return Fe("tauri",l)}async function wi(l,e){return Bl({__tauriModule:"Event",message:{cmd:"unlisten",event:l,eventId:e}})}async function yi(l,e,t){return Bl({__tauriModule:"Event",message:{cmd:"listen",event:l,windowLabel:e,handler:Fl(t)}}).then(n=>async()=>wi(l,n))}var Fn;(function(l){l.WINDOW_RESIZED="tauri://resize",l.WINDOW_MOVED="tauri://move",l.WINDOW_CLOSE_REQUESTED="tauri://close-requested",l.WINDOW_CREATED="tauri://window-created",l.WINDOW_DESTROYED="tauri://destroyed",l.WINDOW_FOCUS="tauri://focus",l.WINDOW_BLUR="tauri://blur",l.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",l.WINDOW_THEME_CHANGED="tauri://theme-changed",l.WINDOW_FILE_DROP="tauri://file-drop",l.WINDOW_FILE_DROP_HOVER="tauri://file-drop-hover",l.WINDOW_FILE_DROP_CANCELLED="tauri://file-drop-cancelled",l.MENU="tauri://menu",l.CHECK_UPDATE="tauri://update",l.UPDATE_AVAILABLE="tauri://update-available",l.INSTALL_UPDATE="tauri://update-install",l.STATUS_UPDATE="tauri://update-status",l.DOWNLOAD_PROGRESS="tauri://update-download-progress"})(Fn||(Fn={}));async function Ci(l,e){return yi(l,null,e)}function qn(l,e,t){const n=l.slice();return n[9]=e[t],n}function Kn(l){let e,t=l[9].name+"",n,o;return{c(){e=f("option"),n=K(t),e.__value=o=l[9].name,e.value=e.__value},m(c,r){T(c,e,r),s(e,n)},p(c,r){r&1&&t!==(t=c[9].name+"")&&we(n,t),r&1&&o!==(o=c[9].name)&&(e.__value=o,e.value=e.__value)},d(c){c&&$(e)}}}function $i(l){let e,t,n,o,c,r,u=l[0],i=[];for(let d=0;d<u.length;d+=1)i[d]=Kn(qn(l,u,d));return{c(){e=f("div"),t=f("div"),n=f("div"),o=f("select");for(let d=0;d<i.length;d+=1)i[d].c();a(n,"class","select"),a(t,"class","control"),a(e,"class","field is-grouped is-grouped-right")},m(d,p){T(d,e,p),s(e,t),s(t,n),s(n,o);for(let m=0;m<i.length;m+=1)i[m]&&i[m].m(o,null);qe(o,l[1]),c||(r=X(o,"change",l[2]),c=!0)},p(d,[p]){if(p&1){u=d[0];let m;for(m=0;m<u.length;m+=1){const _=qn(d,u,m);i[m]?i[m].p(_,p):(i[m]=Kn(_),i[m].c(),i[m].m(o,null))}for(;m<i.length;m+=1)i[m].d(1);i.length=u.length}p&3&&qe(o,d[1])},i:De,o:De,d(d){d&&$(e),Xe(i,d),c=!1,r()}}}function Ti(l,e,t){let n,o,c,r;Ue(l,Lt,_=>t(5,n=_)),Ue(l,ot,_=>t(6,o=_)),Ue(l,vn,_=>t(0,c=_)),Ue(l,Et,_=>t(1,r=_));let u="";async function i(){try{ot.set(window.__TAURI__!==void 0),o?(console.log("Loading config from Tauri"),Fe("get_config").then(_=>{console.log("get_config response",_),_&&_.status==="success"&&d(_.config)}).catch(_=>console.error("Error fetching config in Tauri:",_))):(console.log("Loading config from server"),u=`${Ze.ServerURL}/config/`,fetch(u).then(_=>_.json()).then(_=>{console.log("Config received",_),_&&_.status==="success"&&d(_.config)}).catch(_=>console.error("Error fetching config:",_)))}catch(_){console.error("Unhandled error in loadConfig:",_)}}function d(_){var y;console.log("Updating stores from config:",_);const h={default_role:_.selected_role,..._};Lt.set(h);const w=Object.entries(_.roles).map(([b,C])=>({name:b,...C}));vn.set(w),Et.set(_.selected_role);const v=_.roles[_.selected_role];if(console.log("Selected role settings:",v),v){const b=v.theme||"spacelab";console.log("Setting theme to:",b),_l.set(b),(y=v.kg)!=null&&y.publish?o?Fe("publish_thesaurus",{roleName:_.selected_role}).then(C=>{console.log("publish_thesaurus response",C),ml.set(C),$t.set(!0)}).catch(C=>{console.error("Error publishing thesaurus:",C),$t.set(!1)}):(console.log("Fetching thesaurus from HTTP endpoint for role",_.selected_role),fetch(`${Ze.ServerURL}/thesaurus/${encodeURIComponent(_.selected_role)}`).then(C=>C.json()).then(C=>{console.log("thesaurus HTTP response",C),C&&C.status==="success"&&C.thesaurus?(ml.set(C.thesaurus),$t.set(!0)):(console.error("Failed to fetch thesaurus:",C),$t.set(!1))}).catch(C=>{console.error("Error fetching thesaurus:",C),$t.set(!1)})):$t.set(!1)}else console.warn("No role settings found for:",_.selected_role),_l.set("spacelab")}typeof window<"u"&&window.__TAURI__&&Ci("role_changed",_=>{console.log("Role changed event received from backend:",_.payload),d(_.payload)});async function p(){await i()}p(),console.log("Using Terraphim Server URL:",Ze.ServerURL);function m(_){var b,C;const w=_.currentTarget.value;console.log("Role change requested:",w),Et.set(w);const v=c.find(k=>k.name===w);if(!v){console.error(`No role settings found for role: ${w}.`);return}const y=v.theme||"spacelab";_l.set(y),console.log(`Theme changed to ${y}`),Lt.update(k=>(k.selected_role=w,k)),o?(Fe("select_role",{roleName:w}).catch(k=>console.error("Error selecting role:",k)),(b=v.kg)!=null&&b.publish?(console.log("Publishing thesaurus for role",w),Fe("publish_thesaurus",{roleName:w}).then(k=>{ml.set(k),$t.set(!0)})):$t.set(!1)):(fetch(`${Ze.ServerURL}/config/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).catch(k=>console.error("Error updating config on server:",k)),(C=v.kg)!=null&&C.publish?(console.log("Fetching thesaurus from HTTP endpoint for role",w),fetch(`${Ze.ServerURL}/thesaurus/${encodeURIComponent(w)}`).then(k=>k.json()).then(k=>{console.log("thesaurus HTTP response",k),k&&k.status==="success"&&k.thesaurus?(ml.set(k.thesaurus),$t.set(!0)):(console.error("Failed to fetch thesaurus:",k),$t.set(!1))}).catch(k=>{console.error("Error fetching thesaurus:",k),$t.set(!1)})):$t.set(!1))}return[c,r,m,i]}class Ol extends _t{constructor(e){super(),ht(this,e,Ti,$i,ft,{loadConfig:3})}get loadConfig(){return this.$$.ctx[3]}}function Wn(l,e,t){const n=l.slice();return n[41]=e[t],n}function Gn(l,e,t){const n=l.slice();return n[44]=e[t],n}function Bn(l){let e,t;return e=new Kl({props:{$$slots:{default:[Ri]},$$scope:{ctx:l}}}),{c(){ge(e.$$.fragment)},m(n,o){ve(e,n,o),t=!0},p(n,o){const c={};o[0]&129|o[1]&65536&&(c.$$scope={dirty:o,ctx:n}),e.$set(c)},i(n){t||(Q(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){be(e,n)}}}function Si(l){let e=l[44]+"",t;return{c(){t=K(e)},m(n,o){T(n,t,o)},p(n,o){o[0]&1&&e!==(e=n[44]+"")&&we(t,e)},d(n){n&&$(t)}}}function Jn(l){let e,t,n,o,c,r;t=new Ml({props:{rounded:!0,$$slots:{default:[Si]},$$scope:{ctx:l}}});function u(){return l[19](l[44])}return{c(){e=f("button"),ge(t.$$.fragment),n=g(),a(e,"class","tag-button svelte-2smypa"),e.disabled=l[7],a(e,"title","Click to view knowledge graph document")},m(i,d){T(i,e,d),ve(t,e,null),s(e,n),o=!0,c||(r=X(e,"click",u),c=!0)},p(i,d){l=i;const p={};d[0]&1|d[1]&65536&&(p.$$scope={dirty:d,ctx:l}),t.$set(p),(!o||d[0]&128)&&(e.disabled=l[7])},i(i){o||(Q(t.$$.fragment,i),o=!0)},o(i){x(t.$$.fragment,i),o=!1},d(i){i&&$(e),be(t),c=!1,r()}}}function Ri(l){let e,t,n=l[0].tags,o=[];for(let r=0;r<n.length;r+=1)o[r]=Jn(Gn(l,n,r));const c=r=>x(o[r],1,1,()=>{o[r]=null});return{c(){for(let r=0;r<o.length;r+=1)o[r].c();e=rt()},m(r,u){for(let i=0;i<o.length;i+=1)o[i]&&o[i].m(r,u);T(r,e,u),t=!0},p(r,u){if(u[0]&131201){n=r[0].tags;let i;for(i=0;i<n.length;i+=1){const d=Gn(r,n,i);o[i]?(o[i].p(d,u),Q(o[i],1)):(o[i]=Jn(d),o[i].c(),Q(o[i],1),o[i].m(e.parentNode,e))}for(Qe(),i=n.length;i<o.length;i+=1)c(i);Ye()}},i(r){if(!t){for(let u=0;u<n.length;u+=1)Q(o[u]);t=!0}},o(r){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)x(o[u]);t=!1},d(r){Xe(o,r),r&&$(e)}}}function Ei(l){let e,t=(l[0].rank||0)+"",n;return{c(){e=K("Rank "),n=K(t)},m(o,c){T(o,e,c),T(o,n,c)},p(o,c){c[0]&1&&t!==(t=(o[0].rank||0)+"")&&we(n,t)},d(o){o&&$(e),o&&$(n)}}}function Li(l){let e,t;return e=new Ml({props:{rounded:!0,$$slots:{default:[Ei]},$$scope:{ctx:l}}}),{c(){ge(e.$$.fragment)},m(n,o){ve(e,n,o),t=!0},p(n,o){const c={};o[0]&1|o[1]&65536&&(c.$$scope={dirty:o,ctx:n}),e.$set(c)},i(n){t||(Q(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){be(e,n)}}}function Ai(l){let e;return{c(){e=f("small"),e.textContent="No description available",a(e,"class","no-description svelte-2smypa")},m(t,n){T(t,e,n)},p:De,i:De,o:De,d(t){t&&$(e)}}}function Oi(l){let e,t;return e=new Il({props:{source:l[0].description}}),{c(){ge(e.$$.fragment)},m(n,o){ve(e,n,o),t=!0},p(n,o){const c={};o[0]&1&&(c.source=n[0].description),e.$set(c)},i(n){t||(Q(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){be(e,n)}}}function Vn(l){let e,t,n,o,c,r;return{c(){e=f("button"),t=f("span"),t.innerHTML='<i class="fas fa-magic" aria-hidden="true"></i>',n=g(),o=f("span"),o.textContent="AI Summary",a(t,"class","icon is-small"),a(e,"class","button is-small is-info is-outlined ai-summary-button svelte-2smypa"),e.disabled=l[9],a(e,"title","Generate AI-powered summary using OpenRouter")},m(u,i){T(u,e,i),s(e,t),s(e,n),s(e,o),c||(r=X(e,"click",l[18]),c=!0)},p(u,i){i[0]&512&&(e.disabled=u[9])},d(u){u&&$(e),c=!1,r()}}}function Qn(l){let e;return{c(){e=f("div"),e.innerHTML=`<span class="icon"><i class="fas fa-spinner fa-spin" aria-hidden="true"></i></span> 
                <small>Generating AI summary...</small>`,a(e,"class","ai-summary-loading svelte-2smypa")},m(t,n){T(t,e,n)},d(t){t&&$(e)}}}function Yn(l){let e,t,n,o,c,r,u,i,d,p;return{c(){e=f("div"),t=f("span"),t.innerHTML='<i class="fas fa-exclamation-triangle" aria-hidden="true"></i>',n=g(),o=f("small"),c=K("Summary error: "),r=K(l[10]),u=g(),i=f("button"),i.textContent="Retry",a(t,"class","icon has-text-danger"),a(o,"class","has-text-danger"),a(i,"class","button is-small is-text svelte-2smypa"),a(i,"title","Retry generating summary"),a(e,"class","ai-summary-error svelte-2smypa")},m(m,_){T(m,e,_),s(e,t),s(e,n),s(e,o),s(o,c),s(o,r),s(e,u),s(e,i),d||(p=X(i,"click",l[20]),d=!0)},p(m,_){_[0]&1024&&we(r,m[10])},d(m){m&&$(e),d=!1,p()}}}function Zn(l){let e,t,n,o,c,r,u,i,d,p,m,_,h,w,v,y,b,C,k,S;function z(R,W){return R[12]?Pi:Ni}let D=z(l),M=D(l);return p=new Il({props:{source:l[8]}}),{c(){e=f("div"),t=f("div"),n=f("small"),o=f("span"),o.innerHTML='<i class="fas fa-robot" aria-hidden="true"></i>',c=K(`
                    AI Summary
                    `),M.c(),r=g(),u=f("button"),u.innerHTML='<span class="icon is-small"><i class="fas fa-times" aria-hidden="true"></i></span>',i=g(),d=f("div"),ge(p.$$.fragment),m=g(),_=f("div"),h=f("button"),w=f("span"),w.innerHTML='<i class="fas fa-redo" aria-hidden="true"></i>',v=g(),y=f("span"),y.textContent="Regenerate",a(o,"class","icon is-small"),a(n,"class","ai-summary-label svelte-2smypa"),a(u,"class","button is-small is-text svelte-2smypa"),a(u,"title","Hide AI summary"),a(t,"class","ai-summary-header svelte-2smypa"),a(d,"class","ai-summary-content svelte-2smypa"),a(w,"class","icon is-small"),a(h,"class","button is-small is-text svelte-2smypa"),h.disabled=l[9],a(h,"title","Regenerate summary"),a(_,"class","ai-summary-actions svelte-2smypa"),a(e,"class","ai-summary svelte-2smypa")},m(R,W){T(R,e,W),s(e,t),s(t,n),s(n,o),s(n,c),M.m(n,null),s(t,r),s(t,u),s(e,i),s(e,d),ve(p,d,null),s(e,m),s(e,_),s(_,h),s(h,w),s(h,v),s(h,y),C=!0,k||(S=[X(u,"click",l[21]),X(h,"click",l[22])],k=!0)},p(R,W){D!==(D=z(R))&&(M.d(1),M=D(R),M&&(M.c(),M.m(n,null)));const Y={};W[0]&256&&(Y.source=R[8]),p.$set(Y),(!C||W[0]&512)&&(h.disabled=R[9])},i(R){C||(Q(p.$$.fragment,R),it(()=>{C&&(b||(b=il(e,al,{},!0)),b.run(1))}),C=!0)},o(R){x(p.$$.fragment,R),b||(b=il(e,al,{},!1)),b.run(0),C=!1},d(R){R&&$(e),M.d(),be(p),R&&b&&b.end(),k=!1,xe(S)}}}function Ni(l){let e;return{c(){e=f("span"),e.textContent="fresh",a(e,"class","tag is-small is-success")},m(t,n){T(t,e,n)},d(t){t&&$(e)}}}function Pi(l){let e;return{c(){e=f("span"),e.textContent="cached",a(e,"class","tag is-small is-light")},m(t,n){T(t,e,n)},d(t){t&&$(e)}}}function Xn(l){let e;function t(c,r){return c[41].disabled?Ii:c[41].isLink?Mi:Di}let n=t(l),o=n(l);return{c(){o.c(),e=rt()},m(c,r){o.m(c,r),T(c,e,r)},p(c,r){n===(n=t(c))&&o?o.p(c,r):(o.d(1),o=n(c),o&&(o.c(),o.m(e.parentNode,e)))},d(c){o.d(c),c&&$(e)}}}function Di(l){let e,t,n,o,c,r,u,i,d,p;return{c(){var m,_,h;e=f("button"),t=f("span"),n=f("i"),c=g(),a(n,"class",o=Dt(l[41].icon)+" svelte-2smypa"),a(t,"class","icon is-medium"),ut(t,"has-text-primary",(m=l[41].className)==null?void 0:m.includes("primary")),ut(t,"has-text-success",(_=l[41].className)==null?void 0:_.includes("success")),ut(t,"has-text-danger",(h=l[41].className)==null?void 0:h.includes("danger")),a(e,"type","button"),a(e,"class","level-item button is-ghost svelte-2smypa"),a(e,"aria-label",r=l[41].title),a(e,"title",u=l[41].title),a(e,"data-testid",i=l[41].testId||"")},m(m,_){T(m,e,_),s(e,t),s(t,n),s(e,c),d||(p=X(e,"click",function(){Wl(l[41].action)&&l[41].action.apply(this,arguments)}),d=!0)},p(m,_){var h,w,v;l=m,_[0]&32768&&o!==(o=Dt(l[41].icon)+" svelte-2smypa")&&a(n,"class",o),_[0]&32768&&ut(t,"has-text-primary",(h=l[41].className)==null?void 0:h.includes("primary")),_[0]&32768&&ut(t,"has-text-success",(w=l[41].className)==null?void 0:w.includes("success")),_[0]&32768&&ut(t,"has-text-danger",(v=l[41].className)==null?void 0:v.includes("danger")),_[0]&32768&&r!==(r=l[41].title)&&a(e,"aria-label",r),_[0]&32768&&u!==(u=l[41].title)&&a(e,"title",u),_[0]&32768&&i!==(i=l[41].testId||"")&&a(e,"data-testid",i)},d(m){m&&$(e),d=!1,p()}}}function Mi(l){let e,t,n,o,c,r,u,i;return{c(){e=f("a"),t=f("span"),n=f("i"),c=g(),a(n,"class",o=Dt(l[41].icon)+" svelte-2smypa"),a(t,"class","icon is-medium"),ut(t,"has-text-primary",l[41].className),a(e,"href",r=l[41].href),a(e,"target","_blank"),a(e,"class","level-item"),a(e,"aria-label",u=l[41].title),a(e,"title",i=l[41].title)},m(d,p){T(d,e,p),s(e,t),s(t,n),s(e,c)},p(d,p){p[0]&32768&&o!==(o=Dt(d[41].icon)+" svelte-2smypa")&&a(n,"class",o),p[0]&32768&&ut(t,"has-text-primary",d[41].className),p[0]&32768&&r!==(r=d[41].href)&&a(e,"href",r),p[0]&32768&&u!==(u=d[41].title)&&a(e,"aria-label",u),p[0]&32768&&i!==(i=d[41].title)&&a(e,"title",i)},d(d){d&&$(e)}}}function Ii(l){let e,t,n,o,c,r,u;return{c(){e=f("button"),t=f("span"),n=f("i"),c=g(),a(n,"class",o=Dt(l[41].icon)+" svelte-2smypa"),a(t,"class","icon is-medium"),ut(t,"has-text-primary",l[41].className),a(e,"type","button"),a(e,"class","level-item button is-ghost svelte-2smypa"),a(e,"aria-label",r=l[41].title),a(e,"title",u=l[41].title),e.disabled=!0},m(i,d){T(i,e,d),s(e,t),s(t,n),s(e,c)},p(i,d){d[0]&32768&&o!==(o=Dt(i[41].icon)+" svelte-2smypa")&&a(n,"class",o),d[0]&32768&&ut(t,"has-text-primary",i[41].className),d[0]&32768&&r!==(r=i[41].title)&&a(e,"aria-label",r),d[0]&32768&&u!==(u=i[41].title)&&a(e,"title",u)},d(i){i&&$(e)}}}function xn(l){let e,t=l[41].visible&&Xn(l);return{c(){t&&t.c(),e=rt()},m(n,o){t&&t.m(n,o),T(n,e,o)},p(n,o){n[41].visible?t?t.p(n,o):(t=Xn(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(n){t&&t.d(n),n&&$(e)}}}function eo(l){let e,t,n,o,c,r;return{c(){e=f("div"),t=f("button"),n=g(),o=K(l[13]),a(t,"class","delete svelte-2smypa"),a(e,"class","notification is-danger is-light mt-2")},m(u,i){T(u,e,i),s(e,t),s(e,n),s(e,o),c||(r=X(t,"click",l[23]),c=!0)},p(u,i){i[0]&8192&&we(o,u[13])},d(u){u&&$(e),c=!1,r()}}}function to(l){let e,t,n;function o(r){l[25](r)}let c={item:l[4],kgTerm:l[5],kgRank:l[6]};return l[2]!==void 0&&(c.active=l[2]),e=new Gl({props:c}),st.push(()=>at(e,"active",o)),{c(){ge(e.$$.fragment)},m(r,u){ve(e,r,u),n=!0},p(r,u){const i={};u[0]&16&&(i.item=r[4]),u[0]&32&&(i.kgTerm=r[5]),u[0]&64&&(i.kgRank=r[6]),!t&&u[0]&4&&(t=!0,i.active=r[2],ct(()=>t=!1)),e.$set(i)},i(r){n||(Q(e.$$.fragment,r),n=!0)},o(r){x(e.$$.fragment,r),n=!1},d(r){be(e,r)}}}function lo(l){let e,t,n;function o(r){l[26](r)}let c={document:l[0]};return l[3]!==void 0&&(c.active=l[3]),e=new ki({props:c}),st.push(()=>at(e,"active",o)),{c(){ge(e.$$.fragment)},m(r,u){ve(e,r,u),n=!0},p(r,u){const i={};u[0]&1&&(i.document=r[0]),!t&&u[0]&8&&(t=!0,i.active=r[3],ct(()=>t=!1)),e.$set(i)},i(r){n||(Q(e.$$.fragment,r),n=!0)},o(r){x(e.$$.fragment,r),n=!1},d(r){be(e,r)}}}function Ui(l){let e,t,n,o,c,r,u,i,d,p,m,_,h=l[0].title+"",w,v,y,b,C,k,S,z,D,M,R,W,Y,J,A,E,ce,q,re,ne,V,oe,I,U,O,L,B,Z,te,P,N,F=l[0].tags&&Bn(l);i=new Kl({props:{$$slots:{default:[Li]},$$scope:{ctx:l}}});const ae=[Oi,Ai],le=[];function ee(se,ye){return se[0].description?0:1}S=ee(l),z=le[S]=ae[S](l);let me=!l[11]&&!l[9]&&!l[10]&&Vn(l),_e=l[9]&&Qn(),fe=l[10]&&Yn(l),de=l[11]&&l[8]&&Zn(l),pe=l[15],he=[];for(let se=0;se<pe.length;se+=1)he[se]=xn(Wn(l,pe,se));let Se=l[13]&&eo(l);function Ge(se){l[24](se)}let je={item:l[0]};l[1]!==void 0&&(je.active=l[1]),U=new Gl({props:je}),st.push(()=>at(U,"active",Ge));let Le=l[4]&&to(l),Re=l[14]&&lo(l);return{c(){e=f("div"),t=f("article"),n=f("div"),o=f("div"),c=f("div"),F&&F.c(),r=g(),u=f("div"),ge(i.$$.fragment),d=g(),p=f("div"),m=f("button"),_=f("h2"),w=K(h),v=g(),y=f("div"),b=f("small"),b.textContent="Description:",C=g(),k=f("div"),z.c(),D=g(),M=f("div"),me&&me.c(),R=g(),_e&&_e.c(),W=g(),fe&&fe.c(),Y=g(),de&&de.c(),J=g(),A=f("br"),ce=g(),q=f("div"),re=f("nav"),ne=f("div");for(let se=0;se<he.length;se+=1)he[se].c();oe=g(),Se&&Se.c(),I=g(),ge(U.$$.fragment),L=g(),Le&&Le.c(),B=g(),Re&&Re.c(),Z=rt(),a(c,"class","level-right"),a(u,"class","level-right"),a(_,"class","title svelte-2smypa"),a(m,"class","svelte-2smypa"),a(b,"class","description-label svelte-2smypa"),a(k,"class","description-content svelte-2smypa"),a(y,"class","description svelte-2smypa"),a(M,"class","ai-summary-section svelte-2smypa"),a(o,"class","content"),a(ne,"class","level-right"),a(re,"class","level is-mobile"),a(q,"class","level-right"),a(n,"class","media-content"),a(t,"class","media"),a(e,"class","box")},m(se,ye){T(se,e,ye),s(e,t),s(t,n),s(n,o),s(o,c),F&&F.m(c,null),s(o,r),s(o,u),ve(i,u,null),s(o,d),s(o,p),s(p,m),s(m,_),s(_,w),s(p,v),s(p,y),s(y,b),s(y,C),s(y,k),le[S].m(k,null),s(p,D),s(p,M),me&&me.m(M,null),s(M,R),_e&&_e.m(M,null),s(M,W),fe&&fe.m(M,null),s(M,Y),de&&de.m(M,null),s(p,J),s(p,A),s(n,ce),s(n,q),s(q,re),s(re,ne);for(let Ne=0;Ne<he.length;Ne+=1)he[Ne]&&he[Ne].m(ne,null);s(e,oe),Se&&Se.m(e,null),T(se,I,ye),ve(U,se,ye),T(se,L,ye),Le&&Le.m(se,ye),T(se,B,ye),Re&&Re.m(se,ye),T(se,Z,ye),te=!0,P||(N=X(m,"click",l[16]),P=!0)},p(se,ye){se[0].tags?F?(F.p(se,ye),ye[0]&1&&Q(F,1)):(F=Bn(se),F.c(),Q(F,1),F.m(c,null)):F&&(Qe(),x(F,1,1,()=>{F=null}),Ye());const Ne={};ye[0]&1|ye[1]&65536&&(Ne.$$scope={dirty:ye,ctx:se}),i.$set(Ne),(!te||ye[0]&1)&&h!==(h=se[0].title+"")&&we(w,h);let Be=S;if(S=ee(se),S===Be?le[S].p(se,ye):(Qe(),x(le[Be],1,1,()=>{le[Be]=null}),Ye(),z=le[S],z?z.p(se,ye):(z=le[S]=ae[S](se),z.c()),Q(z,1),z.m(k,null)),!se[11]&&!se[9]&&!se[10]?me?me.p(se,ye):(me=Vn(se),me.c(),me.m(M,R)):me&&(me.d(1),me=null),se[9]?_e||(_e=Qn(),_e.c(),_e.m(M,W)):_e&&(_e.d(1),_e=null),se[10]?fe?fe.p(se,ye):(fe=Yn(se),fe.c(),fe.m(M,Y)):fe&&(fe.d(1),fe=null),se[11]&&se[8]?de?(de.p(se,ye),ye[0]&2304&&Q(de,1)):(de=Zn(se),de.c(),Q(de,1),de.m(M,null)):de&&(Qe(),x(de,1,1,()=>{de=null}),Ye()),ye[0]&32768){pe=se[15];let $e;for($e=0;$e<pe.length;$e+=1){const Pe=Wn(se,pe,$e);he[$e]?he[$e].p(Pe,ye):(he[$e]=xn(Pe),he[$e].c(),he[$e].m(ne,null))}for(;$e<he.length;$e+=1)he[$e].d(1);he.length=pe.length}se[13]?Se?Se.p(se,ye):(Se=eo(se),Se.c(),Se.m(e,null)):Se&&(Se.d(1),Se=null);const Ke={};ye[0]&1&&(Ke.item=se[0]),!O&&ye[0]&2&&(O=!0,Ke.active=se[1],ct(()=>O=!1)),U.$set(Ke),se[4]?Le?(Le.p(se,ye),ye[0]&16&&Q(Le,1)):(Le=to(se),Le.c(),Q(Le,1),Le.m(B.parentNode,B)):Le&&(Qe(),x(Le,1,1,()=>{Le=null}),Ye()),se[14]?Re?(Re.p(se,ye),ye[0]&16384&&Q(Re,1)):(Re=lo(se),Re.c(),Q(Re,1),Re.m(Z.parentNode,Z)):Re&&(Qe(),x(Re,1,1,()=>{Re=null}),Ye())},i(se){te||(Q(F),Q(i.$$.fragment,se),Q(z),Q(de),it(()=>{te&&(E||(E=il(p,al,{},!0)),E.run(1))}),it(()=>{te&&(V||(V=il(re,al,{},!0)),V.run(1))}),Q(U.$$.fragment,se),Q(Le),Q(Re),te=!0)},o(se){x(F),x(i.$$.fragment,se),x(z),x(de),E||(E=il(p,al,{},!1)),E.run(0),V||(V=il(re,al,{},!1)),V.run(0),x(U.$$.fragment,se),x(Le),x(Re),te=!1},d(se){se&&$(e),F&&F.d(),be(i),le[S].d(),me&&me.d(),_e&&_e.d(),fe&&fe.d(),de&&de.d(),se&&E&&E.end(),Xe(he,se),se&&V&&V.end(),Se&&Se.d(),se&&$(I),be(U,se),se&&$(L),Le&&Le.d(se),se&&$(B),Re&&Re.d(se),se&&$(Z),P=!1,N()}}}function ji(l,e,t){let n,o,c,r,u;Ue(l,Et,N=>t(31,c=N)),Ue(l,ot,N=>t(32,r=N)),Ue(l,Lt,N=>t(33,u=N));let{document:i}=e,d=!1,p=!1,m=!1,_=null,h=null,w=null,v=!1,y=null,b=!1,C=null,k=!1,S=!1,z=!1,D=!1,M=null,R=!1,W=!1;function Y(){const N=[];return N.push({id:"download-markdown",label:"Download to Markdown",icon:"fas fa-download",action:()=>re(),visible:!0,title:"Download document as markdown file"}),n&&N.push({id:"save-atomic",label:"Save to Atomic Server",icon:"fas fa-cloud-upload-alt",action:()=>E(),visible:!0,title:"Save article to Atomic Server",className:"has-text-primary"}),i.url&&N.push({id:"external-url",label:"Open URL",icon:"fas fa-link",action:()=>window.open(i.url,"_blank"),visible:!0,title:"Open original URL in new tab",isLink:!0,href:i.url}),N.push({id:"open-vscode",label:"Open in VSCode",icon:"fas fa-code",action:()=>ne(),visible:!0,title:"Open document in VSCode",isLink:!0,href:`vscode://${encodeURIComponent(i.title)}.md?${encodeURIComponent(i.body)}`}),N.push({id:"add-context",label:D?"Added to Context ✓":z?"Adding...":"Add to Context",icon:D?"fas fa-check-circle":z?"fas fa-spinner fa-spin":"fas fa-plus-circle",action:()=>V(),visible:!0,title:D?"Document successfully added to chat context. Go to Chat tab to see it.":"Add document to LLM conversation context",disabled:z||D,className:D?"has-text-success":M?"has-text-danger":"",testId:"add-to-context-button"}),N.push({id:"chat-with-document",label:W?"Opening Chat...":R?"Adding to Chat...":"Chat with Document",icon:W?"fas fa-external-link-alt":R?"fas fa-spinner fa-spin":"fas fa-comment-dots",action:()=>oe(),visible:!0,title:W?"Opening chat with this document":"Add document to context and open chat",disabled:R||W||z,className:W?"has-text-info":M?"has-text-danger":"has-text-primary",testId:"chat-with-document-button"}),N}function J(){var ee;const N=c,F=u;if(!(F!=null&&F.roles)||!N)return!1;let ae=null;try{for(const[me,_e]of Object.entries(F.roles)){const fe=_e,de=typeof fe.name=="object"?fe.name.original:String(fe.name);if(me===N||de===N){ae=fe;break}}}catch(me){return console.warn("Error checking role configuration:",me),!1}return ae?(((ee=ae.haystacks)==null?void 0:ee.filter(me=>me.service==="Atomic"&&me.location&&!me.read_only))||[]).length>0:!1}const A=()=>{t(1,d=!0)},E=()=>{console.log("🔄 Opening atomic save modal for document:",i.title),t(3,m=!0)};async function ce(N){var F,ae,le,ee,me;t(7,v=!0),t(5,h=N),console.log("🔍 KG Search Debug Info:"),console.log("  Tag clicked:",N),console.log("  Current role:",c),console.log("  Is Tauri mode:",r);try{if(r){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:c,term:N});const _e=await Fe("find_documents_for_kg_term",{roleName:c,term:N});console.log("  📥 Tauri response received:"),console.log("    Status:",_e.status),console.log("    Results count:",((F=_e.results)==null?void 0:F.length)||0),console.log("    Total:",_e.total||0),console.log("    Full response:",JSON.stringify(_e,null,2)),_e.status==="success"&&_e.results&&_e.results.length>0?(t(4,_=_e.results[0]),t(6,w=_.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",_.title),console.log("    Rank:",w),console.log("    Body length:",((ae=_.body)==null?void 0:ae.length)||0,"characters"),t(2,p=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${N}" in role: "${c}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const _e=Ze.ServerURL,fe=encodeURIComponent(c),de=encodeURIComponent(N),pe=`${_e}/roles/${fe}/kg_search?term=${de}`;console.log("  📤 HTTP Request details:"),console.log("    Base URL:",_e),console.log("    Role (encoded):",fe),console.log("    Term (encoded):",de),console.log("    Full URL:",pe);const he=await fetch(pe);if(console.log("  📥 HTTP Response received:"),console.log("    Status code:",he.status),console.log("    Status text:",he.statusText),console.log("    Headers:",Object.fromEntries(he.headers.entries())),!he.ok)throw new Error(`HTTP error! Status: ${he.status} - ${he.statusText}`);const Se=await he.json();console.log("  📄 Response data:"),console.log("    Status:",Se.status),console.log("    Results count:",((le=Se.results)==null?void 0:le.length)||0),console.log("    Total:",Se.total||0),console.log("    Full response:",JSON.stringify(Se,null,2)),Se.status==="success"&&Se.results&&Se.results.length>0?(t(4,_=Se.results[0]),t(6,w=_.rank||0),console.log("  ✅ Found KG document:"),console.log("    Title:",_.title),console.log("    Rank:",w),console.log("    Body length:",((ee=_.body)==null?void 0:ee.length)||0,"characters"),t(2,p=!0)):(console.warn(`  ⚠️  No KG documents found for term: "${N}" in role: "${c}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",pe))}}catch(_e){console.error("❌ Error fetching KG document:"),console.error("  Error type:",_e.constructor.name),console.error("  Error message:",_e.message||_e),console.error("  Request details:",{tag:N,role:c,isTauri:r,timestamp:new Date().toISOString()}),!r&&((me=_e.message)!=null&&me.includes("Failed to fetch"))&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{t(7,v=!1)}}async function q(){var N;if(!(b||!i.id||!c)){t(9,b=!0),t(10,C=null),console.log("🤖 AI Summary Debug Info:"),console.log("  Document ID:",i.id),console.log("  Current role:",c),console.log("  Is Tauri mode:",r);try{const F={document_id:i.id,role:c,max_length:250,force_regenerate:!1};console.log("  📤 Summarization request:",F);let ae;if(r){const me=`${Ze.ServerURL}/documents/summarize`;ae=await fetch(me,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(F)})}else{const me=`${Ze.ServerURL}/documents/summarize`;ae=await fetch(me,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(F)})}if(console.log("  📥 Summary response received:"),console.log("    Status code:",ae.status),console.log("    Status text:",ae.statusText),!ae.ok)throw new Error(`HTTP error! Status: ${ae.status} - ${ae.statusText}`);const le=await ae.json();console.log("  📄 Summary response data:",le),le.status==="success"&&le.summary?(t(8,y=le.summary),t(12,S=le.from_cache||!1),t(11,k=!0),console.log("  ✅ Summary generated successfully"),console.log("    Summary length:",y.length,"characters"),console.log("    From cache:",S),console.log("    Model used:",le.model_used)):(t(10,C=le.error||"Failed to generate summary"),console.error("  ❌ Summary generation failed:",C))}catch(F){console.error("❌ Error generating summary:"),console.error("  Error type:",F.constructor.name),console.error("  Error message:",F.message||F),console.error("  Request details:",{document_id:i.id,role:c,isTauri:r,timestamp:new Date().toISOString()}),t(10,C=F.message||"Network error occurred"),(N=F.message)!=null&&N.includes("Failed to fetch")&&(console.error("  💡 Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Verify OpenRouter is enabled for this role"),console.error("    3. Check OPENROUTER_KEY environment variable"),console.error("    4. Verify server URL in CONFIG.ServerURL"))}finally{t(9,b=!1)}}}function re(){console.log("📥 Downloading document as markdown:",i.title);let N=`# ${i.title}

`;N+=`**Source:** Terraphim Search
`,N+=`**Rank:** ${i.rank||"N/A"}
`,i.url&&(N+=`**URL:** ${i.url}
`),i.tags&&i.tags.length>0&&(N+=`**Tags:** ${i.tags.join(", ")}
`),N+=`**Downloaded:** ${new Date().toISOString()}

`,i.description&&(N+=`## Description

${i.description}

`),N+=`## Content

${i.body}
`;const F=`${i.title.replace(/[^a-z0-9]/gi,"_").toLowerCase()}_${Date.now()}.md`,ae=new Blob([N],{type:"text/markdown"}),le=URL.createObjectURL(ae),ee=window.document.createElement("a");ee.href=le,ee.download=F,window.document.body.appendChild(ee),ee.click(),window.document.body.removeChild(ee),URL.revokeObjectURL(le),console.log("✅ Markdown file downloaded:",F)}function ne(){const N=`vscode://${encodeURIComponent(i.title)}.md?${encodeURIComponent(i.body)}`;window.open(N,"_blank")}async function V(){console.log("📝 Adding document to LLM context:",i.title),z=!0,D=!1,t(13,M=null);try{let N=null;if(r){try{const ee=await Fe("list_conversations");if(console.log("📋 Available conversations:",ee),ee!=null&&ee.conversations&&ee.conversations.length>0)N=ee.conversations[0].id,console.log("🎯 Using existing conversation:",N);else{const me=await Fe("create_conversation",{title:"Search Context",role:c||"default"});if(me.status==="success"&&me.conversation_id)N=me.conversation_id,console.log("🆕 Created new conversation:",N);else throw new Error("Failed to create conversation: "+(me.error||"Unknown error"))}}catch(ee){throw console.error("❌ Failed to manage conversations:",ee),new Error("Could not create or find conversation: "+ee.message)}const ae={source_type:"document",document_id:i.id};i.url&&(ae.url=i.url),i.tags&&i.tags.length>0&&(ae.tags=i.tags.join(", ")),i.rank!==void 0&&(ae.rank=i.rank.toString());const le=await Fe("add_context_to_conversation",{conversationId:N,contextType:"document",title:i.title,content:i.body,metadata:ae});console.log("✅ Document added to context via Tauri:",le)}else{const ae=Ze.ServerURL;try{const _e=await fetch(`${ae}/conversations`);if(_e.ok){const fe=await _e.json();if(fe.conversations&&fe.conversations.length>0)N=fe.conversations[0].id,console.log("🎯 Using existing conversation:",N);else{const de=await fetch(`${ae}/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"Search Context",role:c||"default"})});if(de.ok){const pe=await de.json();if(pe.status==="success"&&pe.conversation_id)N=pe.conversation_id,console.log("🆕 Created new conversation:",N);else throw new Error("Failed to create conversation: "+(pe.error||"Unknown error"))}else throw new Error(`Failed to create conversation: ${de.status} ${de.statusText}`)}}else throw new Error(`Failed to list conversations: ${_e.status} ${_e.statusText}`)}catch(_e){throw console.error("❌ Failed to manage conversations:",_e),new Error("Could not create or find conversation: "+_e.message)}const le=`${ae}/conversations/${N}/context`,ee=await fetch(le,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context_type:"document",title:i.title,content:i.body,metadata:{source_type:"document",document_id:i.id,url:i.url||"",tags:i.tags?i.tags.join(", "):"",rank:i.rank?i.rank.toString():"0"}})});if(!ee.ok)throw new Error(`HTTP error! Status: ${ee.status} - ${ee.statusText}`);const me=await ee.json();console.log("✅ Document added to context via HTTP:",me)}console.log("✅ Successfully added document to LLM context"),D=!0;const F=window.document.createElement("div");F.className="notification is-success is-light",F.innerHTML=`
        <button class="delete" onclick="this.parentElement.remove()"></button>
        <strong>✓ Added to Chat Context</strong><br>
        <small>Document added successfully. <a href="/chat" class="has-text-success has-text-weight-bold">Go to Chat →</a> to see it in the context panel.</small>
      `,F.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(F),setTimeout(()=>{F.remove()},8e3),setTimeout(()=>{D=!1},5e3)}catch(N){console.error("❌ Error adding document to context:",N),t(13,M=N.message||"Failed to add document to context");const F=window.document.createElement("div");F.className="notification is-danger is-light",F.innerHTML=`
        <button class="delete" onclick="this.parentElement.remove()"></button>
        <strong>✗ Failed to Add Context</strong><br>
        <small>${M}</small>
      `,F.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(F),setTimeout(()=>{F.remove()},8e3),setTimeout(()=>{t(13,M=null)},5e3)}finally{z=!1}}async function oe(){console.log("💬 Adding document to context and opening chat:",i.title),R=!0,W=!1,t(13,M=null);try{let N=null;if(r){try{const ee=await Fe("list_conversations");if(console.log("📋 Available conversations:",ee),ee!=null&&ee.conversations&&ee.conversations.length>0)N=ee.conversations[0].id,console.log("🎯 Using existing conversation:",N);else{const me=await Fe("create_conversation",{title:"Chat with Documents",role:c||"default"});if(me.status==="success"&&me.conversation_id)N=me.conversation_id,console.log("🆕 Created new conversation:",N);else throw new Error("Failed to create conversation: "+(me.error||"Unknown error"))}}catch(ee){throw console.error("❌ Failed to manage conversations:",ee),new Error("Could not create or find conversation: "+ee.message)}const ae={source_type:"document",document_id:i.id};i.url&&(ae.url=i.url),i.tags&&i.tags.length>0&&(ae.tags=i.tags.join(", ")),i.rank!==void 0&&(ae.rank=i.rank.toString());const le=await Fe("add_context_to_conversation",{conversationId:N,contextType:"document",title:i.title,content:i.body,metadata:ae});console.log("✅ Document added to context via Tauri:",le)}else{const ae=Ze.ServerURL;try{const _e=await fetch(`${ae}/conversations`);if(_e.ok){const fe=await _e.json();if(fe.conversations&&fe.conversations.length>0)N=fe.conversations[0].id,console.log("🎯 Using existing conversation:",N);else{const de=await fetch(`${ae}/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"Chat with Documents",role:c||"default"})});if(de.ok){const pe=await de.json();if(pe.status==="success"&&pe.conversation_id)N=pe.conversation_id,console.log("🆕 Created new conversation:",N);else throw new Error("Failed to create conversation: "+(pe.error||"Unknown error"))}else throw new Error(`Failed to create conversation: ${de.status} ${de.statusText}`)}}else throw new Error(`Failed to list conversations: ${_e.status} ${_e.statusText}`)}catch(_e){throw console.error("❌ Failed to manage conversations:",_e),new Error("Could not create or find conversation: "+_e.message)}const le=`${ae}/conversations/${N}/context`,ee=await fetch(le,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context_type:"document",title:i.title,content:i.body,metadata:{source_type:"document",document_id:i.id,url:i.url||"",tags:i.tags?i.tags.join(", "):"",rank:i.rank?i.rank.toString():"0"}})});if(!ee.ok)throw new Error(`HTTP error! Status: ${ee.status} - ${ee.statusText}`);const me=await ee.json();console.log("✅ Document added to context via HTTP:",me)}console.log("✅ Successfully added document to chat context, navigating to chat..."),W=!0;const F=window.document.createElement("div");F.className="notification is-success is-light",F.innerHTML=`
        <strong>💬 Opening Chat with Document</strong><br>
        <small>Context added successfully. Redirecting to chat...</small>
      `,F.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(F),setTimeout(()=>{F.remove(),Gs.goto("/chat")},1500),setTimeout(()=>{W=!1},2e3)}catch(N){console.error("❌ Error adding document to context and opening chat:",N),t(13,M=N.message||"Failed to add document to context");const F=window.document.createElement("div");F.className="notification is-danger is-light",F.innerHTML=`
        <button class="delete" onclick="this.parentElement.remove()"></button>
        <strong>✗ Failed to Open Chat with Document</strong><br>
        <small>${M}</small>
      `,F.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(F),setTimeout(()=>{F.remove()},8e3),setTimeout(()=>{t(13,M=null)},5e3)}finally{R=!1}}Ol[c]!==void 0&&(console.log("Have attribute",Ol[c]),Ol[c].hasOwnProperty("enableLogseq")?console.log("enable logseq True"):console.log("Didn't make it"));const I=N=>ce(N),U=()=>{t(10,C=null),q()},O=()=>t(11,k=!1),L=()=>{q()},B=()=>t(13,M=null);function Z(N){d=N,t(1,d)}function te(N){p=N,t(2,p)}function P(N){m=N,t(3,m)}return l.$$set=N=>{"document"in N&&t(0,i=N.document)},t(14,n=J()),t(15,o=Y()),[i,d,p,m,_,h,w,v,y,b,C,k,S,M,n,o,A,ce,q,I,U,O,L,B,Z,te,P]}class Hi extends _t{constructor(e){super(),ht(this,e,ji,Ui,ft,{document:0},null,[-1,-1])}}const zi="/assets/terraphim_gray.png";function Al(l){const e=l.trim();if(!e)return{hasOperator:!1,operator:null,terms:[l],originalQuery:l};const t=/\b(AND)\b/,n=/\b(OR)\b/,o=/\b(and)\b/i,c=/\b(or)\b/i,r=t.test(e),u=n.test(e),i=o.test(e)&&!r,d=c.test(e)&&!u;if(r&&!u)return{hasOperator:!0,operator:"AND",terms:e.split(t).filter((m,_)=>_%2===0).map(m=>m.trim()).filter(m=>m.length>0),originalQuery:l};if(u&&!r)return{hasOperator:!0,operator:"OR",terms:e.split(n).filter((m,_)=>_%2===0).map(m=>m.trim()).filter(m=>m.length>0),originalQuery:l};if(r&&u){const p=e.indexOf(" AND "),m=e.indexOf(" OR ");if(p!==-1&&(m===-1||p<m))return{hasOperator:!0,operator:"AND",terms:e.split(/\s+(?:AND|OR)\s+/i).map(h=>h.trim()).filter(h=>h.length>0),originalQuery:l};if(m!==-1)return{hasOperator:!0,operator:"OR",terms:e.split(/\s+(?:AND|OR)\s+/i).map(h=>h.trim()).filter(h=>h.length>0),originalQuery:l}}if(i&&!d)return{hasOperator:!0,operator:"AND",terms:e.split(o).filter((m,_)=>_%2===0).map(m=>m.trim()).filter(m=>m.length>0),originalQuery:l};if(d&&!i)return{hasOperator:!0,operator:"OR",terms:e.split(c).filter((m,_)=>_%2===0).map(m=>m.trim()).filter(m=>m.length>0),originalQuery:l};if(i&&d){const p=e.toLowerCase().indexOf(" and "),m=e.toLowerCase().indexOf(" or ");if(p!==-1&&(m===-1||p<m))return{hasOperator:!0,operator:"AND",terms:e.split(/\s+(?:and|or)\s+/i).map(h=>h.trim()).filter(h=>h.length>0),originalQuery:l};if(m!==-1)return{hasOperator:!0,operator:"OR",terms:e.split(/\s+(?:and|or)\s+/i).map(h=>h.trim()).filter(h=>h.length>0),originalQuery:l}}return{hasOperator:!1,operator:null,terms:[e],originalQuery:l}}function Fi(l,e){var n,o;if(l.hasOperator&&l.terms.length>1){const c=l.terms.filter(r=>r.trim().length>0);if(c.length>1)return{search_term:c[0],search_terms:c,operator:(n=l.operator)==null?void 0:n.toLowerCase(),skip:0,limit:50,role:e||null}}return{search_term:((o=l.terms[0])==null?void 0:o.trim())||"",search_terms:void 0,operator:void 0,skip:0,limit:50,role:e||null}}function no(l,e,t){const n=l.slice();return n[35]=e[t],n}function oo(l,e,t){const n=l.slice();return n[38]=e[t],n[40]=t,n}function so(l,e,t){const n=l.slice();return n[41]=e[t],n[40]=t,n}function ro(l){let e,t=l[3],n=[];for(let o=0;o<t.length;o+=1)n[o]=io(so(l,t,o));return{c(){e=f("ul");for(let o=0;o<n.length;o+=1)n[o].c();a(e,"class","suggestions svelte-sfnt4t")},m(o,c){T(o,e,c);for(let r=0;r<n.length;r+=1)n[r]&&n[r].m(e,null)},p(o,c){if(c[0]&4120){t=o[3];let r;for(r=0;r<t.length;r+=1){const u=so(o,t,r);n[r]?n[r].p(u,c):(n[r]=io(u),n[r].c(),n[r].m(e,null))}for(;r<n.length;r+=1)n[r].d(1);n.length=t.length}},d(o){o&&$(e),Xe(n,o)}}}function io(l){let e,t=l[41]+"",n,o,c,r,u,i;function d(){return l[20](l[41])}function p(...m){return l[21](l[41],...m)}return{c(){e=f("li"),n=K(t),o=g(),a(e,"tabindex","0"),a(e,"role","option"),a(e,"aria-selected",c=l[40]===l[4]),a(e,"aria-label",r=`Apply suggestion: ${l[41]}`),a(e,"class","svelte-sfnt4t"),ut(e,"active",l[40]===l[4])},m(m,_){T(m,e,_),s(e,n),s(e,o),u||(i=[X(e,"click",d),X(e,"keydown",p)],u=!0)},p(m,_){l=m,_[0]&8&&t!==(t=l[41]+"")&&we(n,t),_[0]&16&&c!==(c=l[40]===l[4])&&a(e,"aria-selected",c),_[0]&8&&r!==(r=`Apply suggestion: ${l[41]}`)&&a(e,"aria-label",r),_[0]&16&&ut(e,"active",l[40]===l[4])},d(m){m&&$(e),u=!1,xe(i)}}}function ao(l){let e,t,n,o,c,r,u;return t=new Kl({props:{$$slots:{default:[Wi]},$$scope:{ctx:l}}}),{c(){e=f("div"),ge(t.$$.fragment),n=g(),o=f("button"),o.textContent="Clear all",a(o,"type","button"),a(o,"class","clear-terms-btn svelte-sfnt4t"),a(e,"class","selected-terms-section svelte-sfnt4t")},m(i,d){T(i,e,d),ve(t,e,null),s(e,n),s(e,o),c=!0,r||(u=X(o,"click",l[14]),r=!0)},p(i,d){const p={};d[0]&96|d[1]&4096&&(p.$$scope={dirty:d,ctx:i}),t.$set(p)},i(i){c||(Q(t.$$.fragment,i),c=!0)},o(i){x(t.$$.fragment,i),c=!1},d(i){i&&$(e),be(t),r=!1,u()}}}function qi(l){let e=l[38].value+"",t,n,o,c,r,u,i;function d(){return l[22](l[38])}return{c(){t=K(e),n=g(),o=f("button"),c=K("×"),a(o,"class","remove-tag-btn svelte-sfnt4t"),a(o,"aria-label",r=`Remove term: ${l[38].value}`)},m(p,m){T(p,t,m),T(p,n,m),T(p,o,m),s(o,c),u||(i=X(o,"click",zs(d)),u=!0)},p(p,m){l=p,m[0]&32&&e!==(e=l[38].value+"")&&we(t,e),m[0]&32&&r!==(r=`Remove term: ${l[38].value}`)&&a(o,"aria-label",r)},d(p){p&&$(t),p&&$(n),p&&$(o),u=!1,i()}}}function co(l){let e,t,n,o;return t=new Ml({props:{class:"operator-tag",rounded:!0,$$slots:{default:[Ki]},$$scope:{ctx:l}}}),{c(){e=f("div"),ge(t.$$.fragment),n=g(),a(e,"class","operator-tag-wrapper svelte-sfnt4t")},m(c,r){T(c,e,r),ve(t,e,null),s(e,n),o=!0},p(c,r){const u={};r[0]&64|r[1]&4096&&(u.$$scope={dirty:r,ctx:c}),t.$set(u)},i(c){o||(Q(t.$$.fragment,c),o=!0)},o(c){x(t.$$.fragment,c),o=!1},d(c){c&&$(e),be(t)}}}function Ki(l){let e=(l[6]||"AND")+"",t;return{c(){t=K(e)},m(n,o){T(n,t,o)},p(n,o){o[0]&64&&e!==(e=(n[6]||"AND")+"")&&we(t,e)},d(n){n&&$(t)}}}function uo(l){let e,t,n,o,c;function r(){return l[23](l[38])}t=new Ml({props:{rounded:!0,title:"Click to remove term",$$slots:{default:[qi]},$$scope:{ctx:l}}}),t.$on("click",r);let u=l[40]<l[5].length-1&&co(l);return{c(){e=f("div"),ge(t.$$.fragment),n=g(),u&&u.c(),o=rt(),a(e,"class","term-tag-wrapper svelte-sfnt4t"),ut(e,"from-kg",l[38].isFromKG)},m(i,d){T(i,e,d),ve(t,e,null),T(i,n,d),u&&u.m(i,d),T(i,o,d),c=!0},p(i,d){l=i;const p={};d[0]&32|d[1]&4096&&(p.$$scope={dirty:d,ctx:l}),t.$set(p),(!c||d[0]&32)&&ut(e,"from-kg",l[38].isFromKG),l[40]<l[5].length-1?u?(u.p(l,d),d[0]&32&&Q(u,1)):(u=co(l),u.c(),Q(u,1),u.m(o.parentNode,o)):u&&(Qe(),x(u,1,1,()=>{u=null}),Ye())},i(i){c||(Q(t.$$.fragment,i),Q(u),c=!0)},o(i){x(t.$$.fragment,i),x(u),c=!1},d(i){i&&$(e),be(t),i&&$(n),u&&u.d(i),i&&$(o)}}}function Wi(l){let e,t,n=l[5],o=[];for(let r=0;r<n.length;r+=1)o[r]=uo(oo(l,n,r));const c=r=>x(o[r],1,1,()=>{o[r]=null});return{c(){for(let r=0;r<o.length;r+=1)o[r].c();e=rt()},m(r,u){for(let i=0;i<o.length;i+=1)o[i]&&o[i].m(r,u);T(r,e,u),t=!0},p(r,u){if(u[0]&8288){n=r[5];let i;for(i=0;i<n.length;i+=1){const d=oo(r,n,i);o[i]?(o[i].p(d,u),Q(o[i],1)):(o[i]=uo(d),o[i].c(),Q(o[i],1),o[i].m(e.parentNode,e))}for(Qe(),i=n.length;i<o.length;i+=1)c(i);Ye()}},i(r){if(!t){for(let u=0;u<n.length;u+=1)Q(o[u]);t=!0}},o(r){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)x(o[u]);t=!1},d(r){Xe(o,r),r&&$(e)}}}function fo(l){let e,t,n,o;return{c(){e=f("div"),t=f("button"),t.textContent="Parse Terms",a(t,"type","button"),a(t,"class","button is-small is-info"),a(e,"class","search-hint-container svelte-sfnt4t")},m(c,r){T(c,e,r),s(e,t),n||(o=X(t,"click",l[24]),n=!0)},p:De,d(c){c&&$(e),n=!1,o()}}}function Gi(l){let e,t,n,o,c,r,u,i=l[0]&&(l[0].includes(" AND ")||l[0].includes(" OR "))&&l[5].length===0,d;function p(v){l[19](v)}let m={type:"search",placeholder:l[8]?`Search over Knowledge graph for ${l[7]}`:"Search",icon:"search",expanded:!0,autofocus:!0};l[0]!==void 0&&(m.value=l[0]),n=new Yt({props:m}),st.push(()=>at(n,"value",p)),n.$on("click",l[15]),n.$on("submit",l[15]),n.$on("keydown",l[11]),n.$on("input",l[10]);let _=l[3].length>0&&ro(l),h=l[5].length>0&&ao(l),w=i&&fo(l);return{c(){e=f("div"),t=f("div"),ge(n.$$.fragment),c=g(),_&&_.c(),r=g(),h&&h.c(),u=g(),w&&w.c(),a(t,"class","input-wrapper svelte-sfnt4t"),a(e,"class","search-row svelte-sfnt4t")},m(v,y){T(v,e,y),s(e,t),ve(n,t,null),s(t,c),_&&_.m(t,null),s(e,r),h&&h.m(e,null),s(e,u),w&&w.m(e,null),d=!0},p(v,y){const b={};y[0]&384&&(b.placeholder=v[8]?`Search over Knowledge graph for ${v[7]}`:"Search"),!o&&y[0]&1&&(o=!0,b.value=v[0],ct(()=>o=!1)),n.$set(b),v[3].length>0?_?_.p(v,y):(_=ro(v),_.c(),_.m(t,null)):_&&(_.d(1),_=null),v[5].length>0?h?(h.p(v,y),y[0]&32&&Q(h,1)):(h=ao(v),h.c(),Q(h,1),h.m(e,u)):h&&(Qe(),x(h,1,1,()=>{h=null}),Ye()),y[0]&33&&(i=v[0]&&(v[0].includes(" AND ")||v[0].includes(" OR "))&&v[5].length===0),i?w?w.p(v,y):(w=fo(v),w.c(),w.m(e,null)):w&&(w.d(1),w=null)},i(v){d||(Q(n.$$.fragment,v),Q(h),d=!0)},o(v){x(n.$$.fragment,v),x(h),d=!1},d(v){v&&$(e),be(n),_&&_.d(),h&&h.d(),w&&w.d()}}}function Bi(l){let e,t,n,o,c,r,u,i,d,p;return{c(){e=f("section"),t=f("div"),n=f("img"),c=g(),r=f("p"),r.textContent="I am Terraphim, your personal assistant.",u=g(),i=f("button"),i.innerHTML=`<span class="icon"><i class="fas fa-magic"></i></span> 
        <span>Configuration Wizard</span>`,Hs(n.src,o=zi)||a(n,"src",o),a(n,"alt","Terraphim Logo"),a(n,"class","svelte-sfnt4t"),a(i,"class","button is-primary"),a(i,"data-testid","wizard-start"),a(t,"class","content has-text-grey has-text-centered svelte-sfnt4t"),a(e,"class","section")},m(m,_){T(m,e,_),s(e,t),s(t,n),s(t,c),s(t,r),s(t,u),s(t,i),d||(p=X(i,"click",l[25]),d=!0)},p:De,i:De,o:De,d(m){m&&$(e),d=!1,p()}}}function Ji(l){let e,t,n=l[1],o=[];for(let r=0;r<n.length;r+=1)o[r]=po(no(l,n,r));const c=r=>x(o[r],1,1,()=>{o[r]=null});return{c(){for(let r=0;r<o.length;r+=1)o[r].c();e=rt()},m(r,u){for(let i=0;i<o.length;i+=1)o[i]&&o[i].m(r,u);T(r,e,u),t=!0},p(r,u){if(u[0]&2){n=r[1];let i;for(i=0;i<n.length;i+=1){const d=no(r,n,i);o[i]?(o[i].p(d,u),Q(o[i],1)):(o[i]=po(d),o[i].c(),Q(o[i],1),o[i].m(e.parentNode,e))}for(Qe(),i=n.length;i<o.length;i+=1)c(i);Ye()}},i(r){if(!t){for(let u=0;u<n.length;u+=1)Q(o[u]);t=!0}},o(r){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)x(o[u]);t=!1},d(r){Xe(o,r),r&&$(e)}}}function Vi(l){let e,t;return{c(){e=f("p"),t=K(l[2]),a(e,"class","error svelte-sfnt4t")},m(n,o){T(n,e,o),s(e,t)},p(n,o){o[0]&4&&we(t,n[2])},i:De,o:De,d(n){n&&$(e)}}}function po(l){let e,t;return e=new Hi({props:{document:l[35]}}),{c(){ge(e.$$.fragment)},m(n,o){ve(e,n,o),t=!0},p(n,o){const c={};o[0]&2&&(c.document=n[35]),e.$set(c)},i(n){t||(Q(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){be(e,n)}}}function Qi(l){let e,t,n,o,c,r,u,i,d,p,m;e=new cl({props:{fallbackPath:"/"}}),o=new qt({props:{$$slots:{default:[Gi]},$$scope:{ctx:l}}});const _=[Vi,Ji,Bi],h=[];function w(v,y){return v[2]?0:v[1].length?1:2}return r=w(l),u=h[r]=_[r](l),{c(){ge(e.$$.fragment),t=g(),n=f("form"),ge(o.$$.fragment),c=g(),u.c(),i=rt()},m(v,y){ve(e,v,y),T(v,t,y),T(v,n,y),ve(o,n,null),T(v,c,y),h[r].m(v,y),T(v,i,y),d=!0,p||(m=X(n,"submit",js(l[15])),p=!0)},p(v,y){const b={};y[0]&505|y[1]&4096&&(b.$$scope={dirty:y,ctx:v}),o.$set(b);let C=r;r=w(v),r===C?h[r].p(v,y):(Qe(),x(h[C],1,1,()=>{h[C]=null}),Ye(),u=h[r],u?u.p(v,y):(u=h[r]=_[r](v),u.c()),Q(u,1),u.m(i.parentNode,i))},i(v){d||(Q(e.$$.fragment,v),Q(o.$$.fragment,v),Q(u),d=!0)},o(v){x(e.$$.fragment,v),x(o.$$.fragment,v),x(u),d=!1},d(v){be(e,v),v&&$(t),v&&$(n),be(o),v&&$(c),h[r].d(v),v&&$(i),p=!1,m()}}}function Yi(l,e,t){let n,o,c,r,u,i,d;Ue(l,pr,O=>t(27,o=O)),Ue(l,zt,O=>t(0,c=O)),Ue(l,ot,O=>t(28,r=O)),Ue(l,Et,O=>t(7,u=O)),Ue(l,ml,O=>t(18,i=O)),Ue(l,$t,O=>t(8,d=O));let p=[],m=null,_=[],h=-1,w=[],v=null,y=!1,b=null;hs(()=>{b&&clearTimeout(b)});function C(O){const L=Al(O);if(L.hasOperator&&L.terms.length>1){const B=L.terms.map(P=>{const N=n.some(([F])=>F.toLowerCase()===P.toLowerCase());return{value:P,isFromKG:N}}),Z=w.map(P=>P.value),te=B.map(P=>P.value);(JSON.stringify(Z)!==JSON.stringify(te)||v!==L.operator)&&(t(5,w=B),t(6,v=L.operator))}else L.terms.length===1&&w.length>0?(t(5,w=[]),t(6,v=null)):L.terms.length===0&&(t(5,w=[]),t(6,v=null))}async function k(O){try{if(r){const L=await Fe("get_autocomplete_suggestions",{query:O,roleName:u,limit:8});if(L.status==="success"&&L.suggestions)return L.suggestions.map(B=>B.term)}else{const L=await fetch(`${o.replace("/documents/search","")}/autocomplete/${encodeURIComponent(u)}/${encodeURIComponent(O)}`);if(L.ok){const B=await L.json();if(B.status==="success"&&B.suggestions)return B.suggestions.map(Z=>Z.term)}}return n.filter(([L])=>L.toLowerCase().includes(O.toLowerCase())).map(([L])=>L).slice(0,8)}catch(L){return console.warn("Error fetching term suggestions:",L),[]}}async function S(O){const L=O.trim();if(L.length===0)return[];const Z=Al(L),te=L.split(/\s+/),P=te[te.length-1].toLowerCase();if(Z.hasOperator&&Z.terms.length>0){const F=Z.terms[Z.terms.length-1];return F&&F.length>=2?k(F):[]}if(te.length>1){const F=[];if("and".startsWith(P)&&F.push("AND"),"or".startsWith(P)&&F.push("OR"),F.length>0)return F}const N=L.toLowerCase();if(N.includes(" and ")||N.includes(" or ")||N.includes(" AND ")||N.includes(" OR ")){const F=P;return F.length<2?[]:k(F)}try{return(await k(L)).slice(0,7)}catch(F){return console.warn("Error fetching autocomplete suggestions:",F),n.filter(([le])=>le.toLowerCase().includes(L.toLowerCase())).map(([le])=>le).slice(0,5).slice(0,7)}}async function z(O){const L=O.target;if(!L||L.selectionStart==null)return;const B=L.selectionStart,te=c.slice(0,B).split(/\s+/),P=te[te.length-1];if(P.toLowerCase()==="a"||P.toLowerCase()==="an")t(3,_=["AND"]);else if(P.toLowerCase()==="o"||P.toLowerCase()==="or")t(3,_=["OR"]);else if(P.length>=2)try{const N=await S(P);t(3,_=N)}catch(N){console.warn("Failed to get suggestions:",N),t(3,_=[])}else t(3,_=[]);t(4,h=-1)}function D(O){_.length>0?O.key==="ArrowDown"?(O.preventDefault(),t(4,h=(h+1)%_.length)):O.key==="ArrowUp"?(O.preventDefault(),t(4,h=(h-1+_.length)%_.length)):(O.key==="Enter"||O.key==="Tab")&&h!==-1?(O.preventDefault(),R(_[h])):O.key==="Escape"&&(O.preventDefault(),t(3,_=[]),t(4,h=-1)):O.key==="Enter"&&(O.preventDefault(),M())}function M(){C(c),ce()}function R(O){if(O==="AND"||O==="OR"){t(6,v=O);const L=Al(c);L.terms.length>0&&!w.some(B=>B.value===L.terms[L.terms.length-1])&&Y(L.terms[L.terms.length-1]),jt(zt,c=c+` ${O} `,c)}else{const L=c.trim().split(/\s+/),B=L[L.length-1];O.toLowerCase().startsWith(B.toLowerCase())?(L[L.length-1]=O,jt(zt,c=L.join(" "),c)):Y(O,v)}t(3,_=[]),t(4,h=-1)}function W(){const O=c.trim();if(!O)return null;const L=Al(O);return{...Fi(L,u),skip:0,limit:10}}function Y(O,L=null){const B=n.some(([Z])=>Z.toLowerCase()===O.toLowerCase());w.some(Z=>Z.value.toLowerCase()===O.toLowerCase())||(t(5,w=[...w,{value:O,isFromKG:B}]),L&&w.length>1&&t(6,v=L),A())}function J(O){t(5,w=w.filter(L=>L.value!==O)),A()}function A(){if(t(16,y=!0),w.length===0)jt(zt,c="",c),t(6,v=null);else if(w.length===1)jt(zt,c=w[0].value,c),t(6,v=null);else{const O=v||"AND";jt(zt,c=w.map(L=>L.value).join(` ${O} `),c)}setTimeout(()=>{t(16,y=!1)},10)}function E(){t(5,w=[]),t(6,v=null),jt(zt,c="",c)}async function ce(){if(t(2,m=null),r){if(!c.trim())return;try{const O=W();if(!O)return;const L=await Fe("search",{searchQuery:O});L.status==="success"?(t(1,p=L.results),console.log("Response results"),console.log(p)):(t(2,m=`Search failed: ${L.status}`),console.error("Search failed:",L))}catch(O){t(2,m=`Error in Tauri search: ${O}`),console.error("Error in Tauri search:",O)}}else{if(!c.trim())return;const O=W();if(!O)return;const L=JSON.stringify(O);try{const B=await fetch(o,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:L}),Z=await B.json();if(!B.ok)throw new Error(`HTTP error! Status: ${B.status}`);t(1,p=Z.results)}catch(B){console.error("Error fetching data:",B),t(2,m=`Error fetching data: ${B}`)}}}function q(O){c=O,zt.set(c)}const re=O=>R(O),ne=(O,L)=>{(L.key==="Enter"||L.key===" ")&&(L.preventDefault(),R(O))},V=O=>J(O.value),oe=O=>J(O.value),I=()=>C(c),U=()=>window.location.href="/config/wizard";return l.$$.update=()=>{l.$$.dirty[0]&262144&&(n=Object.entries(i)),l.$$.dirty[0]&196609&&c&&!y&&(c.includes(" AND ")||c.includes(" OR ")||c.includes(" and ")||c.includes(" or "))&&(b&&clearTimeout(b),t(17,b=setTimeout(()=>{C(c),t(17,b=null)},300)))},[c,p,m,_,h,w,v,u,d,C,z,D,R,J,E,ce,y,b,i,q,re,ne,V,oe,I,U]}class Zi extends _t{constructor(e){super(),ht(this,e,Yi,Qi,ft,{},null,[-1,-1])}}async function mo(l={}){return typeof l=="object"&&Object.freeze(l),Bl({__tauriModule:"Dialog",message:{cmd:"openDialog",options:l}})}function _o(l,e,t){const n=l.slice();return n[71]=e[t],n[79]=t,n}function ho(l,e,t){const n=l.slice();return n[77]=e[t],n[78]=e,n[79]=t,n}function go(l,e,t){const n=l.slice();return n[80]=e[t],n}function vo(l,e,t){const n=l.slice();return n[80]=e[t],n}function bo(l,e,t){const n=l.slice();return n[85]=e[t],n[86]=e,n[87]=t,n}function ko(l,e,t){const n=l.slice();return n[88]=e[t][0],n[89]=e[t][1],n[90]=e,n[91]=t,n}function wo(l,e,t){const n=l.slice();return n[74]=e[t],n}function yo(l,e,t){const n=l.slice();return n[71]=e[t],n}function Co(l,e,t){const n=l.slice();return n[74]=e[t],n}function $o(l){let e,t,n,o,c;return{c(){e=f("div"),t=f("button"),n=K(`
      Configuration saved successfully!`),a(t,"class","delete"),a(e,"class","notification is-success"),a(e,"data-testid","wizard-success")},m(r,u){T(r,e,u),s(e,t),s(e,n),o||(c=X(t,"click",l[20]),o=!0)},p:De,d(r){r&&$(e),o=!1,c()}}}function To(l){let e,t,n,o,c;return{c(){e=f("div"),t=f("button"),n=K(`
      Failed to save configuration. Please try again.`),a(t,"class","delete"),a(e,"class","notification is-danger"),a(e,"data-testid","wizard-error")},m(r,u){T(r,e,u),s(e,t),s(e,n),o||(c=X(t,"click",l[21]),o=!0)},p:De,d(r){r&&$(e),o=!1,c()}}}function Xi(l){let e,t,n,o,c,r,u,i,d,p=l[3].id+"",m,_,h,w,v,y=l[3].global_shortcut+"",b,C,k,S,z,D=l[3].default_theme+"",M,R,W,Y,J,A=l[3].default_role+"",E,ce,q,re,ne,V,oe=JSON.stringify(l[3],null,2)+"",I,U=l[3].roles,O=[];for(let L=0;L<U.length;L+=1)O[L]=So(_o(l,U,L));return{c(){e=f("h4"),e.textContent="Review",t=g(),n=f("div"),o=f("h5"),o.textContent="Configuration Summary:",c=g(),r=f("ul"),u=f("li"),i=f("strong"),i.textContent="Configuration ID:",d=g(),m=K(p),_=g(),h=f("li"),w=f("strong"),w.textContent="Global Shortcut:",v=g(),b=K(y),C=g(),k=f("li"),S=f("strong"),S.textContent="Default Theme:",z=g(),M=K(D),R=g(),W=f("li"),Y=f("strong"),Y.textContent="Default Role:",J=g(),E=K(A),ce=g(),q=f("h5"),q.textContent="Roles:",re=g();for(let L=0;L<O.length;L+=1)O[L].c();ne=g(),V=f("pre"),I=K(oe),a(e,"class","title is-5"),a(n,"class","content"),ke(V,"max-height","300px"),ke(V,"overflow","auto")},m(L,B){T(L,e,B),T(L,t,B),T(L,n,B),s(n,o),s(n,c),s(n,r),s(r,u),s(u,i),s(u,d),s(u,m),s(r,_),s(r,h),s(h,w),s(h,v),s(h,b),s(r,C),s(r,k),s(k,S),s(k,z),s(k,M),s(r,R),s(r,W),s(W,Y),s(W,J),s(W,E),s(n,ce),s(n,q),s(n,re);for(let Z=0;Z<O.length;Z+=1)O[Z]&&O[Z].m(n,null);T(L,ne,B),T(L,V,B),s(V,I)},p(L,B){if(B[0]&8&&p!==(p=L[3].id+"")&&we(m,p),B[0]&8&&y!==(y=L[3].global_shortcut+"")&&we(b,y),B[0]&8&&D!==(D=L[3].default_theme+"")&&we(M,D),B[0]&8&&A!==(A=L[3].default_role+"")&&we(E,A),B[0]&10){U=L[3].roles;let Z;for(Z=0;Z<U.length;Z+=1){const te=_o(L,U,Z);O[Z]?O[Z].p(te,B):(O[Z]=So(te),O[Z].c(),O[Z].m(n,null))}for(;Z<O.length;Z+=1)O[Z].d(1);O.length=U.length}B[0]&8&&oe!==(oe=JSON.stringify(L[3],null,2)+"")&&we(I,oe)},d(L){L&&$(e),L&&$(t),L&&$(n),Xe(O,L),L&&$(ne),L&&$(V)}}}function xi(l){let e,t,n=[],o=new Map,c,r,u,i,d=l[3].roles;const p=m=>m[77].name;for(let m=0;m<d.length;m+=1){let _=ho(l,d,m),h=p(_);o.set(h,n[m]=Fo(h,_))}return{c(){e=f("h4"),e.textContent="Roles",t=g();for(let m=0;m<n.length;m+=1)n[m].c();c=g(),r=f("button"),r.textContent="Add Role",a(e,"class","title is-5"),a(r,"class","button is-link is-light"),a(r,"data-testid","add-role")},m(m,_){T(m,e,_),T(m,t,_);for(let h=0;h<n.length;h+=1)n[h]&&n[h].m(m,_);T(m,c,_),T(m,r,_),u||(i=X(r,"click",l[12]),u=!0)},p(m,_){_[0]&516985&&(d=m[3].roles,n=Fs(n,_,p,1,m,d,o,c.parentNode,qs,Fo,c,ho))},d(m){m&&$(e),m&&$(t);for(let _=0;_<n.length;_+=1)n[_].d(m);m&&$(c),m&&$(r),u=!1,i()}}}function ea(l){let e,t,n,o,c,r,u,i,d,p,m,_,h,w,v,y,b,C,k,S,z,D,M,R,W,Y,J,A,E,ce,q,re=l[8],ne=[];for(let I=0;I<re.length;I+=1)ne[I]=qo(Co(l,re,I));let V=l[3].roles,oe=[];for(let I=0;I<V.length;I+=1)oe[I]=Ko(yo(l,V,I));return{c(){e=f("div"),t=f("label"),t.textContent="Configuration ID",n=g(),o=f("div"),c=f("div"),r=f("select"),u=f("option"),u.textContent="Desktop",i=f("option"),i.textContent="Server",d=f("option"),d.textContent="Embedded",p=g(),m=f("div"),_=f("label"),_.textContent="Global shortcut",h=g(),w=f("div"),v=f("input"),y=g(),b=f("div"),C=f("label"),C.textContent="Default theme",k=g(),S=f("div"),z=f("div"),D=f("select");for(let I=0;I<ne.length;I+=1)ne[I].c();M=g(),R=f("div"),W=f("label"),W.textContent="Default Role",Y=g(),J=f("div"),A=f("div"),E=f("select");for(let I=0;I<oe.length;I+=1)oe[I].c();a(t,"class","label"),a(t,"for","config-id"),u.__value="Desktop",u.value=u.__value,i.__value="Server",i.value=i.__value,d.__value="Embedded",d.value=d.__value,a(r,"id","config-id"),l[3].id===void 0&&it(()=>l[22].call(r)),a(c,"class","select"),a(o,"class","control"),a(e,"class","field"),a(_,"class","label"),a(_,"for","global-shortcut"),a(v,"class","input"),a(v,"id","global-shortcut"),a(v,"type","text"),a(w,"class","control"),a(m,"class","field"),a(C,"class","label"),a(C,"for","default-theme"),a(D,"id","default-theme"),l[3].default_theme===void 0&&it(()=>l[24].call(D)),a(z,"class","select is-fullwidth"),a(S,"class","control"),a(b,"class","field"),a(W,"class","label"),a(W,"for","default-role"),a(E,"id","default-role"),l[3].default_role===void 0&&it(()=>l[25].call(E)),a(A,"class","select"),a(J,"class","control"),a(R,"class","field")},m(I,U){T(I,e,U),s(e,t),s(e,n),s(e,o),s(o,c),s(c,r),s(r,u),s(r,i),s(r,d),qe(r,l[3].id,!0),T(I,p,U),T(I,m,U),s(m,_),s(m,h),s(m,w),s(w,v),Oe(v,l[3].global_shortcut),T(I,y,U),T(I,b,U),s(b,C),s(b,k),s(b,S),s(S,z),s(z,D);for(let O=0;O<ne.length;O+=1)ne[O]&&ne[O].m(D,null);qe(D,l[3].default_theme,!0),T(I,M,U),T(I,R,U),s(R,W),s(R,Y),s(R,J),s(J,A),s(A,E);for(let O=0;O<oe.length;O+=1)oe[O]&&oe[O].m(E,null);qe(E,l[3].default_role,!0),ce||(q=[X(r,"change",l[22]),X(v,"input",l[23]),X(D,"change",l[24]),X(E,"change",l[25])],ce=!0)},p(I,U){if(U[0]&264&&qe(r,I[3].id),U[0]&264&&v.value!==I[3].global_shortcut&&Oe(v,I[3].global_shortcut),U[0]&256){re=I[8];let O;for(O=0;O<re.length;O+=1){const L=Co(I,re,O);ne[O]?ne[O].p(L,U):(ne[O]=qo(L),ne[O].c(),ne[O].m(D,null))}for(;O<ne.length;O+=1)ne[O].d(1);ne.length=re.length}if(U[0]&264&&qe(D,I[3].default_theme),U[0]&8){V=I[3].roles;let O;for(O=0;O<V.length;O+=1){const L=yo(I,V,O);oe[O]?oe[O].p(L,U):(oe[O]=Ko(L),oe[O].c(),oe[O].m(E,null))}for(;O<oe.length;O+=1)oe[O].d(1);oe.length=V.length}U[0]&264&&qe(E,I[3].default_role)},d(I){I&&$(e),I&&$(p),I&&$(m),I&&$(y),I&&$(b),Xe(ne,I),I&&$(M),I&&$(R),Xe(oe,I),ce=!1,xe(q)}}}function So(l){let e,t,n=l[71].name+"",o,c,r,u,i,d=l[71].shortname+"",p,m,_,h,w,v=l[71].theme+"",y,b,C,k,S,z=l[71].relevance_function+"",D,M,R,W,Y,J;return{c(){e=f("div"),t=f("h6"),o=K(n),c=g(),r=f("p"),u=f("strong"),u.textContent="Shortname:",i=g(),p=K(d),m=g(),_=f("p"),h=f("strong"),h.textContent="Theme:",w=g(),y=K(v),b=g(),C=f("p"),k=f("strong"),k.textContent="Relevance Function:",S=g(),D=K(z),M=g(),R=f("button"),R.textContent="Edit Role",W=g(),a(t,"data-testid","review-role-name-"+l[79]),a(R,"class","button is-small"),a(R,"data-testid","edit-role-"+l[79]),a(e,"class","box")},m(A,E){T(A,e,E),s(e,t),s(t,o),s(e,c),s(e,r),s(r,u),s(r,i),s(r,p),s(e,m),s(e,_),s(_,h),s(_,w),s(_,y),s(e,b),s(e,C),s(C,k),s(C,S),s(C,D),s(e,M),s(e,R),s(e,W),Y||(J=X(R,"click",l[68]),Y=!0)},p(A,E){E[0]&8&&n!==(n=A[71].name+"")&&we(o,n),E[0]&8&&d!==(d=A[71].shortname+"")&&we(p,d),E[0]&8&&v!==(v=A[71].theme+"")&&we(y,v),E[0]&8&&z!==(z=A[71].relevance_function+"")&&we(D,z)},d(A){A&&$(e),Y=!1,J()}}}function Ro(l){let e,t=l[74]+"",n;return{c(){e=f("option"),n=K(t),e.__value=l[74],e.value=e.__value},m(o,c){T(o,e,c),s(e,n)},p:De,d(o){o&&$(e)}}}function ta(l){let e;return{c(){e=K("Directory Path")},m(t,n){T(t,e,n)},d(t){t&&$(e)}}}function la(l){let e;return{c(){e=K("Server URL")},m(t,n){T(t,e,n)},d(t){t&&$(e)}}}function Eo(l){let e;return{c(){e=f("p"),e.textContent="Click to select directory",a(e,"class","help")},m(t,n){T(t,e,n)},d(t){t&&$(e)}}}function Lo(l){let e,t,n,o,c,r,u,i,d,p,m,_;function h(){l[34].call(u,l[79],l[87])}return{c(){e=f("div"),t=f("label"),n=K("Atomic Server Secret"),c=g(),r=f("div"),u=f("input"),d=g(),p=f("p"),p.textContent="Leave empty for anonymous access",a(t,"class","label"),a(t,"for",o=`haystack-secret-${l[79]}-${l[87]}`),a(u,"class","input"),a(u,"id",i=`haystack-secret-${l[79]}-${l[87]}`),a(u,"type","password"),a(u,"placeholder","Base64 encoded secret (optional)"),a(r,"class","control"),a(p,"class","help"),a(e,"class","field")},m(w,v){T(w,e,v),s(e,t),s(t,n),s(e,c),s(e,r),s(r,u),Oe(u,l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret),s(e,d),s(e,p),m||(_=X(u,"input",h),m=!0)},p(w,v){l=w,v[0]&264&&o!==(o=`haystack-secret-${l[79]}-${l[87]}`)&&a(t,"for",o),v[0]&264&&i!==(i=`haystack-secret-${l[79]}-${l[87]}`)&&a(u,"id",i),v[0]&264&&u.value!==l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret&&Oe(u,l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret)},d(w){w&&$(e),m=!1,_()}}}function Ao(l){let e,t,n,o,c,r,u,i,d,p,m,_,h,w,v,y,b,C,k,S,z,D,M,R,W,Y,J,A,E,ce,q,re,ne,V,oe,I,U,O,L,B,Z,te,P;function N(){l[35].call(p,l[79],l[87])}function F(...fe){return l[36](l[79],l[87],...fe)}let ae=Object.entries(l[3].roles[l[79]].haystacks[l[87]].extra_parameters||{}),le=[];for(let fe=0;fe<ae.length;fe+=1)le[fe]=Oo(ko(l,ae,fe));function ee(){return l[40](l[79],l[87])}function me(){return l[41](l[79],l[87])}function _e(){return l[42](l[79],l[87])}return{c(){e=f("div"),t=f("label"),t.textContent="Extra Parameters (for filtering)",n=g(),o=f("div"),c=f("div"),r=f("label"),u=K("Hashtag"),d=g(),p=f("input"),_=g(),h=f("div"),w=f("div"),v=f("label"),y=K("Presets"),C=g(),k=f("div"),S=f("select"),z=f("option"),z.textContent="(choose)",D=f("option"),D.textContent="#rust",M=f("option"),M.textContent="#docs",R=f("option"),R.textContent="#test",W=f("option"),W.textContent="#todo",J=g(),A=f("p"),A.innerHTML="When set, searches will enforce the hashtag alongside your query (AND), e.g. <code>-e &quot;search&quot; -e &quot;#rust&quot;</code>.",E=g();for(let fe=0;fe<le.length;fe+=1)le[fe].c();ce=g(),q=f("div"),re=f("div"),ne=f("button"),ne.textContent="+ Tag Filter",V=g(),oe=f("div"),I=f("button"),I.textContent="+ Max Results",U=g(),O=f("div"),L=f("button"),L.textContent="+ Custom Parameter",B=g(),Z=f("p"),Z.innerHTML=`Common parameters: <code>tag</code> (e.g., &quot;#rust&quot;), <code>glob</code> (e.g., &quot;*.md&quot;),
                  <code>max_count</code> (e.g., &quot;10&quot;), <code>context</code> (e.g., &quot;5&quot;)`,a(t,"class","label"),a(r,"class","label"),a(r,"for",i=`ripgrep-hashtag-${l[79]}-${l[87]}`),a(p,"class","input"),a(p,"id",m=`ripgrep-hashtag-${l[79]}-${l[87]}`),a(p,"type","text"),a(p,"placeholder","#rust"),a(c,"class","control"),a(o,"class","field is-grouped"),a(v,"class","label"),a(v,"for",b=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`),z.__value="",z.value=z.__value,D.__value="#rust",D.value=D.__value,M.__value="#docs",M.value=M.__value,R.__value="#test",R.value=R.__value,W.__value="#todo",W.value=W.__value,a(S,"id",Y=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`),a(k,"class","select is-small"),a(w,"class","control"),a(h,"class","field is-grouped"),ke(h,"margin-bottom",".5rem"),a(A,"class","help"),a(ne,"class","button is-small is-link is-light"),a(re,"class","control"),a(I,"class","button is-small is-link is-light"),a(oe,"class","control"),a(L,"class","button is-small is-link is-light"),a(O,"class","control"),a(q,"class","field is-grouped"),a(Z,"class","help"),a(e,"class","field")},m(fe,de){T(fe,e,de),s(e,t),s(e,n),s(e,o),s(o,c),s(c,r),s(r,u),s(c,d),s(c,p),Oe(p,l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag),s(e,_),s(e,h),s(h,w),s(w,v),s(v,y),s(w,C),s(w,k),s(k,S),s(S,z),s(S,D),s(S,M),s(S,R),s(S,W),s(e,J),s(e,A),s(e,E);for(let pe=0;pe<le.length;pe+=1)le[pe]&&le[pe].m(e,null);s(e,ce),s(e,q),s(q,re),s(re,ne),s(q,V),s(q,oe),s(oe,I),s(q,U),s(q,O),s(O,L),s(e,B),s(e,Z),te||(P=[X(p,"input",N),X(S,"change",F),X(ne,"click",ee),X(I,"click",me),X(L,"click",_e)],te=!0)},p(fe,de){if(l=fe,de[0]&264&&i!==(i=`ripgrep-hashtag-${l[79]}-${l[87]}`)&&a(r,"for",i),de[0]&264&&m!==(m=`ripgrep-hashtag-${l[79]}-${l[87]}`)&&a(p,"id",m),de[0]&264&&p.value!==l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag&&Oe(p,l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag),de[0]&264&&b!==(b=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`)&&a(v,"for",b),de[0]&264&&Y!==(Y=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`)&&a(S,"id",Y),de[0]&393224){ae=Object.entries(l[3].roles[l[79]].haystacks[l[87]].extra_parameters||{});let pe;for(pe=0;pe<ae.length;pe+=1){const he=ko(l,ae,pe);le[pe]?le[pe].p(he,de):(le[pe]=Oo(he),le[pe].c(),le[pe].m(e,ce))}for(;pe<le.length;pe+=1)le[pe].d(1);le.length=ae.length}},d(fe){fe&&$(e),Xe(le,fe),te=!1,xe(P)}}}function Oo(l){let e,t,n,o,c,r,u,i,d,p,m,_,h;function w(...b){return l[37](l[79],l[87],l[88],...b)}function v(){l[38].call(u,l[79],l[87],l[88])}function y(){return l[39](l[79],l[87],l[88])}return{c(){e=f("div"),t=f("div"),n=f("input"),c=g(),r=f("div"),u=f("input"),i=g(),d=f("div"),p=f("button"),p.textContent="×",m=g(),a(n,"class","input"),a(n,"type","text"),a(n,"placeholder","Parameter name"),n.value=o=l[88],a(t,"class","control"),a(u,"class","input"),a(u,"type","text"),a(u,"placeholder","Parameter value"),a(r,"class","control is-expanded"),a(p,"class","button is-small is-danger"),a(d,"class","control"),a(e,"class","field is-grouped")},m(b,C){T(b,e,C),s(e,t),s(t,n),s(e,c),s(e,r),s(r,u),Oe(u,l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]]),s(e,i),s(e,d),s(d,p),s(e,m),_||(h=[X(n,"blur",w),X(u,"input",v),X(p,"click",y)],_=!0)},p(b,C){l=b,C[0]&264&&o!==(o=l[88])&&n.value!==o&&(n.value=o),C[0]&264&&u.value!==l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]]&&Oe(u,l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]])},d(b){b&&$(e),_=!1,xe(h)}}}function No(l){let e,t,n,o,c,r,u,i,d,p,m,_,h,w,v,y,b,C,k,S,z,D,M,R,W,Y,J,A,E,ce,q,re,ne,V,oe,I,U,O,L;function B(){l[31].call(d,l[79],l[87])}function Z(fe,de){return fe[3].roles[fe[79]].haystacks[fe[87]].service==="Atomic"?la:ta}let te=Z(l),P=te(l);function N(){l[32].call(k,l[79],l[87])}function F(){return l[33](l[79],l[87])}let ae=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"&&Eo(),le=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"&&Lo(l),ee=l[3].roles[l[79]].haystacks[l[87]].service==="Ripgrep"&&Ao(l);function me(){l[43].call(E,l[79],l[87])}function _e(){return l[44](l[79],l[87])}return{c(){e=f("div"),t=f("div"),n=f("label"),o=K("Service Type"),r=g(),u=f("div"),i=f("div"),d=f("select"),p=f("option"),p.textContent="Ripgrep (File Search)",m=f("option"),m.textContent="Atomic Server",h=g(),w=f("div"),v=f("label"),P.c(),b=g(),C=f("div"),k=f("input"),M=g(),ae&&ae.c(),R=g(),le&&le.c(),W=g(),ee&&ee.c(),Y=g(),J=f("div"),A=f("label"),E=f("input"),q=K(`
                 Read-only`),ne=g(),V=f("div"),oe=f("button"),I=K("Remove Haystack"),a(n,"class","label"),a(n,"for",c=`haystack-service-${l[79]}-${l[87]}`),p.__value="Ripgrep",p.value=p.__value,m.__value="Atomic",m.value=m.__value,a(d,"id",_=`haystack-service-${l[79]}-${l[87]}`),l[3].roles[l[79]].haystacks[l[87]].service===void 0&&it(B),a(i,"class","select"),a(u,"class","control"),a(t,"class","field"),a(v,"class","label"),a(v,"for",y=`haystack-path-${l[79]}-${l[87]}`),a(k,"class","input"),a(k,"id",S=`haystack-path-${l[79]}-${l[87]}`),a(k,"type","text"),a(k,"placeholder",z=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?"https://localhost:9883":"/path/to/documents"),k.readOnly=D=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic",a(C,"class","control"),a(w,"class","field"),a(E,"id",ce=`haystack-readonly-${l[79]}-${l[87]}`),a(E,"type","checkbox"),a(A,"class","checkbox"),a(A,"for",re=`haystack-readonly-${l[79]}-${l[87]}`),a(J,"class","field"),a(oe,"class","button is-small is-danger"),a(oe,"data-testid",U="remove-haystack-"+l[79]+"-"+l[87]),a(V,"class","field"),a(e,"class","box is-light")},m(fe,de){T(fe,e,de),s(e,t),s(t,n),s(n,o),s(t,r),s(t,u),s(u,i),s(i,d),s(d,p),s(d,m),qe(d,l[3].roles[l[79]].haystacks[l[87]].service,!0),s(e,h),s(e,w),s(w,v),P.m(v,null),s(w,b),s(w,C),s(C,k),Oe(k,l[3].roles[l[79]].haystacks[l[87]].path),s(C,M),ae&&ae.m(C,null),s(e,R),le&&le.m(e,null),s(e,W),ee&&ee.m(e,null),s(e,Y),s(e,J),s(J,A),s(A,E),E.checked=l[3].roles[l[79]].haystacks[l[87]].read_only,s(A,q),s(e,ne),s(e,V),s(V,oe),s(oe,I),O||(L=[X(d,"change",B),X(k,"input",N),X(k,"click",function(){Wl(l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?F:void 0)&&(l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?F:void 0).apply(this,arguments)}),X(E,"change",me),X(oe,"click",_e)],O=!0)},p(fe,de){l=fe,de[0]&264&&c!==(c=`haystack-service-${l[79]}-${l[87]}`)&&a(n,"for",c),de[0]&264&&_!==(_=`haystack-service-${l[79]}-${l[87]}`)&&a(d,"id",_),de[0]&264&&qe(d,l[3].roles[l[79]].haystacks[l[87]].service),te!==(te=Z(l))&&(P.d(1),P=te(l),P&&(P.c(),P.m(v,null))),de[0]&264&&y!==(y=`haystack-path-${l[79]}-${l[87]}`)&&a(v,"for",y),de[0]&264&&S!==(S=`haystack-path-${l[79]}-${l[87]}`)&&a(k,"id",S),de[0]&264&&z!==(z=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?"https://localhost:9883":"/path/to/documents")&&a(k,"placeholder",z),de[0]&280&&D!==(D=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic")&&(k.readOnly=D),de[0]&264&&k.value!==l[3].roles[l[79]].haystacks[l[87]].path&&Oe(k,l[3].roles[l[79]].haystacks[l[87]].path),l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?ae||(ae=Eo(),ae.c(),ae.m(C,null)):ae&&(ae.d(1),ae=null),l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?le?le.p(l,de):(le=Lo(l),le.c(),le.m(e,W)):le&&(le.d(1),le=null),l[3].roles[l[79]].haystacks[l[87]].service==="Ripgrep"?ee?ee.p(l,de):(ee=Ao(l),ee.c(),ee.m(e,Y)):ee&&(ee.d(1),ee=null),de[0]&264&&ce!==(ce=`haystack-readonly-${l[79]}-${l[87]}`)&&a(E,"id",ce),de[0]&264&&(E.checked=l[3].roles[l[79]].haystacks[l[87]].read_only),de[0]&264&&re!==(re=`haystack-readonly-${l[79]}-${l[87]}`)&&a(A,"for",re),de[0]&264&&U!==(U="remove-haystack-"+l[79]+"-"+l[87])&&a(oe,"data-testid",U)},d(fe){fe&&$(e),P.d(),ae&&ae.d(),le&&le.d(),ee&&ee.d(),O=!1,xe(L)}}}function Po(l){var oe;let e,t,n,o,c,r,u,i,d,p,m,_,h,w,v,y,b,C,k,S,z,D,M,R,W,Y,J,A,E;function ce(){l[47].call(u,l[79])}function q(){return l[48](l[79])}let re=((oe=l[0][l[79]])==null?void 0:oe.length)&&Do(l);function ne(){l[50].call(k,l[79])}function V(){l[51].call(R,l[79])}return{c(){e=f("div"),t=f("label"),n=K("Model"),c=g(),r=f("div"),u=f("input"),d=g(),p=f("button"),p.textContent="Fetch models",m=g(),re&&re.c(),_=g(),h=f("div"),w=f("label"),v=K("Base URL"),b=g(),C=f("div"),k=f("input"),z=g(),D=f("div"),M=f("label"),R=f("input"),Y=K(`
               Automatically summarize search results`),a(t,"class","label"),a(t,"for",o=`llm-model-${l[79]}`),a(u,"class","input"),a(u,"id",i=`llm-model-${l[79]}`),a(u,"type","text"),a(u,"placeholder","llama3.1"),a(r,"class","control"),a(p,"class","button is-small"),a(e,"class","field"),a(w,"class","label"),a(w,"for",y=`llm-base-url-${l[79]}`),a(k,"class","input"),a(k,"id",S=`llm-base-url-${l[79]}`),a(k,"type","text"),a(k,"placeholder","http://127.0.0.1:11434"),a(C,"class","control"),a(h,"class","field"),a(R,"id",W=`llm-auto-summarize-${l[79]}`),a(R,"type","checkbox"),a(M,"class","checkbox"),a(M,"for",J=`llm-auto-summarize-${l[79]}`),a(D,"class","field")},m(I,U){T(I,e,U),s(e,t),s(t,n),s(e,c),s(e,r),s(r,u),Oe(u,l[3].roles[l[79]].llm_model),s(e,d),s(e,p),s(e,m),re&&re.m(e,null),T(I,_,U),T(I,h,U),s(h,w),s(w,v),s(h,b),s(h,C),s(C,k),Oe(k,l[3].roles[l[79]].llm_base_url),T(I,z,U),T(I,D,U),s(D,M),s(M,R),R.checked=l[3].roles[l[79]].llm_auto_summarize,s(M,Y),A||(E=[X(u,"input",ce),X(p,"click",q),X(k,"input",ne),X(R,"change",V)],A=!0)},p(I,U){var O;l=I,U[0]&264&&o!==(o=`llm-model-${l[79]}`)&&a(t,"for",o),U[0]&264&&i!==(i=`llm-model-${l[79]}`)&&a(u,"id",i),U[0]&264&&u.value!==l[3].roles[l[79]].llm_model&&Oe(u,l[3].roles[l[79]].llm_model),(O=l[0][l[79]])!=null&&O.length?re?re.p(l,U):(re=Do(l),re.c(),re.m(e,null)):re&&(re.d(1),re=null),U[0]&264&&y!==(y=`llm-base-url-${l[79]}`)&&a(w,"for",y),U[0]&264&&S!==(S=`llm-base-url-${l[79]}`)&&a(k,"id",S),U[0]&264&&k.value!==l[3].roles[l[79]].llm_base_url&&Oe(k,l[3].roles[l[79]].llm_base_url),U[0]&264&&W!==(W=`llm-auto-summarize-${l[79]}`)&&a(R,"id",W),U[0]&264&&(R.checked=l[3].roles[l[79]].llm_auto_summarize),U[0]&264&&J!==(J=`llm-auto-summarize-${l[79]}`)&&a(M,"for",J)},d(I){I&&$(e),re&&re.d(),I&&$(_),I&&$(h),I&&$(z),I&&$(D),A=!1,xe(E)}}}function Do(l){let e,t,n,o,c=l[0][l[79]],r=[];for(let i=0;i<c.length;i+=1)r[i]=Mo(vo(l,c,i));function u(...i){return l[49](l[79],...i)}return{c(){e=f("div"),t=f("select");for(let i=0;i<r.length;i+=1)r[i].c();a(e,"class","select is-fullwidth"),ke(e,"margin-top","0.5rem")},m(i,d){T(i,e,d),s(e,t);for(let p=0;p<r.length;p+=1)r[p]&&r[p].m(t,null);n||(o=X(t,"change",u),n=!0)},p(i,d){if(l=i,d[0]&9){c=l[0][l[79]];let p;for(p=0;p<c.length;p+=1){const m=vo(l,c,p);r[p]?r[p].p(m,d):(r[p]=Mo(m),r[p].c(),r[p].m(t,null))}for(;p<r.length;p+=1)r[p].d(1);r.length=c.length}},d(i){i&&$(e),Xe(r,i),n=!1,o()}}}function Mo(l){let e,t=l[80]+"",n,o;return{c(){e=f("option"),n=K(t),e.__value=o=l[80],e.value=e.__value},m(c,r){T(c,e,r),s(e,n)},p(c,r){r[0]&9&&t!==(t=c[80]+"")&&we(n,t),r[0]&265&&o!==(o=c[80])&&(e.__value=o,e.value=e.__value)},d(c){c&&$(e)}}}function Io(l){var de;let e,t,n,o,c,r,u,i,d,p,m,_,h,w,v,y,b,C,k,S,z,D,M,R,W,Y,J,A,E,ce,q,re,ne,V,oe,I,U,O,L,B,Z,te,P,N;function F(){l[53].call(u,l[79])}function ae(){l[54].call(C,l[79])}function le(){return l[55](l[79])}let ee=((de=l[0][l[79]])==null?void 0:de.length)&&Uo(l);function me(){l[57].call(A,l[79])}function _e(){l[58].call(U,l[79])}let fe=l[3].roles[l[79]].openrouter_chat_enabled&&Ho(l);return{c(){e=f("div"),t=f("label"),n=K("OpenRouter API Key"),c=g(),r=f("div"),u=f("input"),d=g(),p=f("p"),p.innerHTML='Get your API key from <a href="https://openrouter.ai" target="_blank" rel="noopener">OpenRouter</a>',m=g(),_=f("div"),h=f("label"),w=K("Model"),y=g(),b=f("div"),C=f("input"),S=g(),z=f("button"),z.textContent="Fetch models",D=g(),ee&&ee.c(),M=g(),R=f("p"),R.textContent="Choose the language model for generating summaries. Different models offer different speed/quality tradeoffs.",W=g(),Y=f("div"),J=f("label"),A=f("input"),ce=K(`
               Automatically summarize search results`),re=g(),ne=f("p"),ne.textContent="When enabled, summaries will be generated and shown in search results.",V=g(),oe=f("div"),I=f("label"),U=f("input"),L=K(`
               Enable Chat interface (OpenRouter)`),Z=g(),fe&&fe.c(),te=rt(),a(t,"class","label"),a(t,"for",o=`openrouter-api-key-${l[79]}`),a(u,"class","input"),a(u,"id",i=`openrouter-api-key-${l[79]}`),a(u,"type","password"),a(u,"placeholder","sk-or-v1-..."),a(r,"class","control"),a(p,"class","help"),a(e,"class","field"),a(h,"class","label"),a(h,"for",v=`openrouter-model-${l[79]}`),a(C,"class","input"),a(C,"id",k=`openrouter-model-${l[79]}`),a(C,"type","text"),a(C,"placeholder","openai/gpt-4-turbo"),a(b,"class","control"),a(z,"class","button is-small"),a(R,"class","help"),a(_,"class","field"),a(A,"id",E=`openrouter-auto-summarize-${l[79]}`),a(A,"type","checkbox"),a(J,"class","checkbox"),a(J,"for",q=`openrouter-auto-summarize-${l[79]}`),a(ne,"class","help"),a(Y,"class","field"),a(U,"id",O=`openrouter-chat-enabled-${l[79]}`),a(U,"type","checkbox"),a(I,"class","checkbox"),a(I,"for",B=`openrouter-chat-enabled-${l[79]}`),a(oe,"class","field")},m(pe,he){T(pe,e,he),s(e,t),s(t,n),s(e,c),s(e,r),s(r,u),Oe(u,l[3].roles[l[79]].openrouter_api_key),s(e,d),s(e,p),T(pe,m,he),T(pe,_,he),s(_,h),s(h,w),s(_,y),s(_,b),s(b,C),Oe(C,l[3].roles[l[79]].openrouter_model),s(_,S),s(_,z),s(_,D),ee&&ee.m(_,null),s(_,M),s(_,R),T(pe,W,he),T(pe,Y,he),s(Y,J),s(J,A),A.checked=l[3].roles[l[79]].openrouter_auto_summarize,s(J,ce),s(Y,re),s(Y,ne),T(pe,V,he),T(pe,oe,he),s(oe,I),s(I,U),U.checked=l[3].roles[l[79]].openrouter_chat_enabled,s(I,L),T(pe,Z,he),fe&&fe.m(pe,he),T(pe,te,he),P||(N=[X(u,"input",F),X(C,"input",ae),X(z,"click",le),X(A,"change",me),X(U,"change",_e)],P=!0)},p(pe,he){var Se;l=pe,he[0]&264&&o!==(o=`openrouter-api-key-${l[79]}`)&&a(t,"for",o),he[0]&264&&i!==(i=`openrouter-api-key-${l[79]}`)&&a(u,"id",i),he[0]&264&&u.value!==l[3].roles[l[79]].openrouter_api_key&&Oe(u,l[3].roles[l[79]].openrouter_api_key),he[0]&264&&v!==(v=`openrouter-model-${l[79]}`)&&a(h,"for",v),he[0]&264&&k!==(k=`openrouter-model-${l[79]}`)&&a(C,"id",k),he[0]&264&&C.value!==l[3].roles[l[79]].openrouter_model&&Oe(C,l[3].roles[l[79]].openrouter_model),(Se=l[0][l[79]])!=null&&Se.length?ee?ee.p(l,he):(ee=Uo(l),ee.c(),ee.m(_,M)):ee&&(ee.d(1),ee=null),he[0]&264&&E!==(E=`openrouter-auto-summarize-${l[79]}`)&&a(A,"id",E),he[0]&264&&(A.checked=l[3].roles[l[79]].openrouter_auto_summarize),he[0]&264&&q!==(q=`openrouter-auto-summarize-${l[79]}`)&&a(J,"for",q),he[0]&264&&O!==(O=`openrouter-chat-enabled-${l[79]}`)&&a(U,"id",O),he[0]&264&&(U.checked=l[3].roles[l[79]].openrouter_chat_enabled),he[0]&264&&B!==(B=`openrouter-chat-enabled-${l[79]}`)&&a(I,"for",B),l[3].roles[l[79]].openrouter_chat_enabled?fe?fe.p(l,he):(fe=Ho(l),fe.c(),fe.m(te.parentNode,te)):fe&&(fe.d(1),fe=null)},d(pe){pe&&$(e),pe&&$(m),pe&&$(_),ee&&ee.d(),pe&&$(W),pe&&$(Y),pe&&$(V),pe&&$(oe),pe&&$(Z),fe&&fe.d(pe),pe&&$(te),P=!1,xe(N)}}}function Uo(l){let e,t,n,o,c=l[0][l[79]],r=[];for(let i=0;i<c.length;i+=1)r[i]=jo(go(l,c,i));function u(...i){return l[56](l[79],...i)}return{c(){e=f("div"),t=f("select");for(let i=0;i<r.length;i+=1)r[i].c();a(e,"class","select is-fullwidth"),ke(e,"margin-top","0.5rem")},m(i,d){T(i,e,d),s(e,t);for(let p=0;p<r.length;p+=1)r[p]&&r[p].m(t,null);n||(o=X(t,"change",u),n=!0)},p(i,d){if(l=i,d[0]&9){c=l[0][l[79]];let p;for(p=0;p<c.length;p+=1){const m=go(l,c,p);r[p]?r[p].p(m,d):(r[p]=jo(m),r[p].c(),r[p].m(t,null))}for(;p<r.length;p+=1)r[p].d(1);r.length=c.length}},d(i){i&&$(e),Xe(r,i),n=!1,o()}}}function jo(l){let e,t=l[80]+"",n,o;return{c(){e=f("option"),n=K(t),e.__value=o=l[80],e.value=e.__value},m(c,r){T(c,e,r),s(e,n)},p(c,r){r[0]&9&&t!==(t=c[80]+"")&&we(n,t),r[0]&265&&o!==(o=c[80])&&(e.__value=o,e.value=e.__value)},d(c){c&&$(e)}}}function Ho(l){let e,t,n,o,c,r,u,i,d,p,m,_,h,w,v,y,b,C,k,S,z,D,M,R,W;function Y(){l[59].call(i,l[79])}function J(){l[60].call(D,l[79])}return{c(){e=f("div"),t=f("label"),n=K("Chat Model"),c=g(),r=f("div"),u=f("div"),i=f("select"),d=f("option"),d.textContent="GPT-3.5 Turbo",p=f("option"),p.textContent="GPT-4",m=f("option"),m.textContent="Claude 3 Sonnet",_=f("option"),_.textContent="Claude 3 Haiku",h=f("option"),h.textContent="Mixtral 8x7B",v=g(),y=f("div"),b=f("label"),C=K("System Prompt (optional)"),S=g(),z=f("div"),D=f("textarea"),a(t,"class","label"),a(t,"for",o=`openrouter-chat-model-${l[79]}`),d.__value="openai/gpt-3.5-turbo",d.value=d.__value,p.__value="openai/gpt-4",p.value=p.__value,m.__value="anthropic/claude-3-sonnet",m.value=m.__value,_.__value="anthropic/claude-3-haiku",_.value=_.__value,h.__value="mistralai/mixtral-8x7b-instruct",h.value=h.__value,a(i,"id",w=`openrouter-chat-model-${l[79]}`),l[3].roles[l[79]].openrouter_chat_model===void 0&&it(Y),a(u,"class","select is-fullwidth"),a(r,"class","control"),a(e,"class","field"),a(b,"class","label"),a(b,"for",k=`openrouter-chat-system-${l[79]}`),a(D,"class","textarea"),a(D,"id",M=`openrouter-chat-system-${l[79]}`),a(D,"rows","3"),a(D,"placeholder","You are a helpful Rust engineer assistant..."),a(z,"class","control"),a(y,"class","field")},m(A,E){T(A,e,E),s(e,t),s(t,n),s(e,c),s(e,r),s(r,u),s(u,i),s(i,d),s(i,p),s(i,m),s(i,_),s(i,h),qe(i,l[3].roles[l[79]].openrouter_chat_model,!0),T(A,v,E),T(A,y,E),s(y,b),s(b,C),s(y,S),s(y,z),s(z,D),Oe(D,l[3].roles[l[79]].openrouter_chat_system_prompt),R||(W=[X(i,"change",Y),X(D,"input",J)],R=!0)},p(A,E){l=A,E[0]&264&&o!==(o=`openrouter-chat-model-${l[79]}`)&&a(t,"for",o),E[0]&264&&w!==(w=`openrouter-chat-model-${l[79]}`)&&a(i,"id",w),E[0]&264&&qe(i,l[3].roles[l[79]].openrouter_chat_model),E[0]&264&&k!==(k=`openrouter-chat-system-${l[79]}`)&&a(b,"for",k),E[0]&264&&M!==(M=`openrouter-chat-system-${l[79]}`)&&a(D,"id",M),E[0]&264&&Oe(D,l[3].roles[l[79]].openrouter_chat_system_prompt)},d(A){A&&$(e),A&&$(v),A&&$(y),R=!1,xe(W)}}}function zo(l){let e;return{c(){e=f("p"),e.textContent="Click to select directory",a(e,"class","help")},m(t,n){T(t,e,n)},d(t){t&&$(e)}}}function Fo(l,e){let t,n,o,c,r,u,i,d,p,m,_,h,w,v,y,b,C,k,S,z,D,M,R,W,Y,J,A,E,ce,q,re,ne,V,oe,I,U,O,L,B,Z,te,P,N,F,ae,le,ee,me,_e,fe,de,pe,he,Se,Ge,je,Le,Re,se,ye,Ne,Be,Ke,$e,Pe,et,Je,Me,He,tt,ue,Ae,j,G,H,ie,Te,Ce,Ve,nt,ze,lt,kt,gt,ul,Kt,fl,Zt,Wt,dl,Mt,wt,Jl,hl,Vl,gl,Rt,vl,Ql,Xt,xt,Yl,bl,Zl,Gt,dt,kl,Xl,xl,wl,el,tl,en,yl,tn,Cl,Ot,ll,nl,$l,ln,ol,Ht,It,Tl,nn,Sl,on,Bt,Ut,Rl,sn,El,rn,an,cn,Jt,un,Ll,Ul,fn;function Cs(){e[26].call(d,e[79])}function $s(){e[27].call(C,e[79])}let sl=e[8],pt=[];for(let We=0;We<sl.length;We+=1)pt[We]=Ro(wo(e,sl,We));function dn(){e[28].call(A,e[79])}function pn(){e[29].call(O,e[79])}function Ts(){e[30].call(ee,e[79])}let rl=e[77].haystacks,mt=[];for(let We=0;We<rl.length;We+=1)mt[We]=No(bo(e,rl,We));function Ss(){return e[45](e[79])}function mn(){e[46].call(Me,e[79])}let vt=e[3].roles[e[79]].llm_provider==="ollama"&&Po(e);function Rs(){e[52].call(ze,e[79])}let bt=e[3].roles[e[79]].openrouter_enabled&&Io(e);function Es(){e[61].call(Rt,e[79])}function Ls(){e[62].call(dt,e[79])}function _n(){return e[63](e[79])}let yt=e[4]&&zo();function hn(){e[64].call(Ot,e[79])}function As(){e[65].call(It,e[79])}function Os(){e[66].call(Ut,e[79])}function Ns(){return e[67](e[79])}return{key:l,first:null,c(){t=f("div"),n=f("div"),o=f("label"),c=K("Role name"),u=g(),i=f("div"),d=f("input"),m=g(),_=f("div"),h=f("label"),w=K("Short name"),y=g(),b=f("div"),C=f("input"),S=g(),z=f("div"),D=f("label"),M=K("Theme"),W=g(),Y=f("div"),J=f("div"),A=f("select");for(let We=0;We<pt.length;We+=1)pt[We].c();ce=g(),q=f("div"),re=f("label"),ne=K("Relevance function"),oe=g(),I=f("div"),U=f("div"),O=f("select"),L=f("option"),L.textContent="title-scorer",B=f("option"),B.textContent="terraphim-graph",Z=f("option"),Z.textContent="bm25",te=f("option"),te.textContent="bm25f",P=f("option"),P.textContent="bm25plus",F=g(),ae=f("div"),le=f("label"),ee=f("input"),_e=K(`
            Enable Terraphim IT features (KG preprocessing, auto-linking)`),de=g(),pe=f("h5"),pe.textContent="Haystacks",he=g();for(let We=0;We<mt.length;We+=1)mt[We].c();Se=g(),Ge=f("button"),je=K("Add Haystack"),Re=g(),se=f("h5"),se.textContent="AI-Enhanced Summaries (LLM Provider)",ye=g(),Ne=f("div"),Be=f("label"),Ke=K("Provider"),Pe=g(),et=f("div"),Je=f("div"),Me=f("select"),He=f("option"),He.textContent="(none)",tt=f("option"),tt.textContent="OpenRouter",ue=f("option"),ue.textContent="Ollama (local)",j=g(),G=f("p"),G.textContent="Choose a provider. OpenRouter uses API key; Ollama runs locally.",H=g(),vt&&vt.c(),ie=g(),Te=f("h5"),Te.textContent="AI-Enhanced Summaries (OpenRouter)",Ce=g(),Ve=f("div"),nt=f("label"),ze=f("input"),kt=K(`
             Enable AI-generated article summaries`),ul=g(),Kt=f("p"),Kt.textContent="Generate intelligent summaries using OpenRouter's language models",fl=g(),bt&&bt.c(),Zt=g(),Wt=f("h5"),Wt.textContent="Knowledge Graph",dl=g(),Mt=f("div"),wt=f("label"),Jl=K("Remote automata URL"),Vl=g(),gl=f("div"),Rt=f("input"),Ql=g(),Xt=f("div"),xt=f("label"),Yl=K("Local KG path"),Zl=g(),Gt=f("div"),dt=f("input"),Xl=g(),yt&&yt.c(),xl=g(),wl=f("div"),el=f("div"),tl=f("label"),en=K("Local KG type"),tn=g(),Cl=f("div"),Ot=f("select"),ll=f("option"),ll.textContent="markdown",nl=f("option"),nl.textContent="json",ln=g(),ol=f("div"),Ht=f("label"),It=f("input"),nn=K(`
             Public`),on=g(),Bt=f("label"),Ut=f("input"),sn=K(`
             Publish`),rn=g(),an=f("hr"),cn=g(),Jt=f("button"),un=K("Remove Role"),a(o,"class","label"),a(o,"for",r=`role-name-${e[79]}`),a(d,"class","input"),a(d,"id",p=`role-name-${e[79]}`),a(d,"type","text"),a(i,"class","control"),a(n,"class","field"),a(h,"class","label"),a(h,"for",v=`role-shortname-${e[79]}`),a(C,"class","input"),a(C,"id",k=`role-shortname-${e[79]}`),a(C,"type","text"),a(b,"class","control"),a(_,"class","field"),a(D,"class","label"),a(D,"for",R=`role-theme-${e[79]}`),a(A,"id",E=`role-theme-${e[79]}`),e[3].roles[e[79]].theme===void 0&&it(dn),a(J,"class","select is-fullwidth"),a(Y,"class","control"),a(z,"class","field"),a(re,"class","label"),a(re,"for",V=`role-relevance-${e[79]}`),L.__value="title-scorer",L.value=L.__value,B.__value="terraphim-graph",B.value=B.__value,Z.__value="bm25",Z.value=Z.__value,te.__value="bm25f",te.value=te.__value,P.__value="bm25plus",P.value=P.__value,a(O,"id",N=`role-relevance-${e[79]}`),e[3].roles[e[79]].relevance_function===void 0&&it(pn),a(U,"class","select is-fullwidth"),a(I,"class","control"),a(q,"class","field"),a(ee,"class","checkbox"),a(ee,"id",me=`role-terraphim-it-${e[79]}`),a(ee,"type","checkbox"),a(le,"class","label"),a(le,"for",fe=`role-terraphim-it-${e[79]}`),a(ae,"class","field"),a(pe,"class","title is-6"),a(Ge,"class","button is-small"),a(Ge,"data-testid",Le="add-haystack-"+e[79]),a(se,"class","title is-6"),a(Be,"class","label"),a(Be,"for",$e=`llm-provider-${e[79]}`),He.__value="",He.value=He.__value,tt.__value="openrouter",tt.value=tt.__value,ue.__value="ollama",ue.value=ue.__value,a(Me,"id",Ae=`llm-provider-${e[79]}`),e[3].roles[e[79]].llm_provider===void 0&&it(mn),a(Je,"class","select"),a(et,"class","control"),a(G,"class","help"),a(Ne,"class","field"),a(Te,"class","title is-6"),a(ze,"id",lt=`openrouter-enabled-${e[79]}`),a(ze,"type","checkbox"),a(nt,"class","checkbox"),a(nt,"for",gt=`openrouter-enabled-${e[79]}`),a(Kt,"class","help"),a(Ve,"class","field"),a(Wt,"class","title is-6"),a(wt,"class","label"),a(wt,"for",hl=`kg-url-${e[79]}`),a(Rt,"class","input"),a(Rt,"id",vl=`kg-url-${e[79]}`),a(Rt,"type","text"),a(Rt,"placeholder","https://example.com/thesaurus.json"),a(gl,"class","control"),a(Mt,"class","field"),a(xt,"class","label"),a(xt,"for",bl=`kg-local-path-${e[79]}`),a(dt,"class","input"),a(dt,"id",kl=`kg-local-path-${e[79]}`),a(dt,"type","text"),a(dt,"placeholder","/path/to/markdown"),dt.readOnly=e[4],a(Gt,"class","control"),a(Xt,"class","field"),a(tl,"class","label"),a(tl,"for",yl=`kg-local-type-${e[79]}`),ll.__value="markdown",ll.value=ll.__value,nl.__value="json",nl.value=nl.__value,a(Ot,"id",$l=`kg-local-type-${e[79]}`),e[3].roles[e[79]].kg.local_type===void 0&&it(hn),a(Cl,"class","select"),a(el,"class","control"),a(wl,"class","field is-grouped"),a(It,"id",Tl=`kg-public-${e[79]}`),a(It,"type","checkbox"),a(Ht,"class","checkbox"),a(Ht,"for",Sl=`kg-public-${e[79]}`),ke(Ht,"margin-right","1rem"),a(Ut,"id",Rl=`kg-publish-${e[79]}`),a(Ut,"type","checkbox"),a(Bt,"class","checkbox"),a(Bt,"for",El=`kg-publish-${e[79]}`),a(ol,"class","field is-grouped"),a(Jt,"class","button is-small is-danger"),a(Jt,"data-testid",Ll="remove-role-"+e[79]),a(t,"class","box"),this.first=t},m(We,Ee){T(We,t,Ee),s(t,n),s(n,o),s(o,c),s(n,u),s(n,i),s(i,d),Oe(d,e[3].roles[e[79]].name),s(t,m),s(t,_),s(_,h),s(h,w),s(_,y),s(_,b),s(b,C),Oe(C,e[3].roles[e[79]].shortname),s(t,S),s(t,z),s(z,D),s(D,M),s(z,W),s(z,Y),s(Y,J),s(J,A);for(let Ie=0;Ie<pt.length;Ie+=1)pt[Ie]&&pt[Ie].m(A,null);qe(A,e[3].roles[e[79]].theme,!0),s(t,ce),s(t,q),s(q,re),s(re,ne),s(q,oe),s(q,I),s(I,U),s(U,O),s(O,L),s(O,B),s(O,Z),s(O,te),s(O,P),qe(O,e[3].roles[e[79]].relevance_function,!0),s(t,F),s(t,ae),s(ae,le),s(le,ee),ee.checked=e[3].roles[e[79]].terraphim_it,s(le,_e),s(t,de),s(t,pe),s(t,he);for(let Ie=0;Ie<mt.length;Ie+=1)mt[Ie]&&mt[Ie].m(t,null);s(t,Se),s(t,Ge),s(Ge,je),s(t,Re),s(t,se),s(t,ye),s(t,Ne),s(Ne,Be),s(Be,Ke),s(Ne,Pe),s(Ne,et),s(et,Je),s(Je,Me),s(Me,He),s(Me,tt),s(Me,ue),qe(Me,e[3].roles[e[79]].llm_provider,!0),s(Ne,j),s(Ne,G),s(t,H),vt&&vt.m(t,null),s(t,ie),s(t,Te),s(t,Ce),s(t,Ve),s(Ve,nt),s(nt,ze),ze.checked=e[3].roles[e[79]].openrouter_enabled,s(nt,kt),s(Ve,ul),s(Ve,Kt),s(t,fl),bt&&bt.m(t,null),s(t,Zt),s(t,Wt),s(t,dl),s(t,Mt),s(Mt,wt),s(wt,Jl),s(Mt,Vl),s(Mt,gl),s(gl,Rt),Oe(Rt,e[3].roles[e[79]].kg.url),s(t,Ql),s(t,Xt),s(Xt,xt),s(xt,Yl),s(Xt,Zl),s(Xt,Gt),s(Gt,dt),Oe(dt,e[3].roles[e[79]].kg.local_path),s(Gt,Xl),yt&&yt.m(Gt,null),s(t,xl),s(t,wl),s(wl,el),s(el,tl),s(tl,en),s(el,tn),s(el,Cl),s(Cl,Ot),s(Ot,ll),s(Ot,nl),qe(Ot,e[3].roles[e[79]].kg.local_type,!0),s(t,ln),s(t,ol),s(ol,Ht),s(Ht,It),It.checked=e[3].roles[e[79]].kg.public,s(Ht,nn),s(ol,on),s(ol,Bt),s(Bt,Ut),Ut.checked=e[3].roles[e[79]].kg.publish,s(Bt,sn),s(t,rn),s(t,an),s(t,cn),s(t,Jt),s(Jt,un),Ul||(fn=[X(d,"input",Cs),X(C,"input",$s),X(A,"change",dn),X(O,"change",pn),X(ee,"change",Ts),X(Ge,"click",Ss),X(Me,"change",mn),X(ze,"change",Rs),X(Rt,"input",Es),X(dt,"input",Ls),X(dt,"click",function(){Wl(e[4]?_n:void 0)&&(e[4]?_n:void 0).apply(this,arguments)}),X(Ot,"change",hn),X(It,"change",As),X(Ut,"change",Os),X(Jt,"click",Ns)],Ul=!0)},p(We,Ee){if(e=We,Ee[0]&264&&r!==(r=`role-name-${e[79]}`)&&a(o,"for",r),Ee[0]&264&&p!==(p=`role-name-${e[79]}`)&&a(d,"id",p),Ee[0]&264&&d.value!==e[3].roles[e[79]].name&&Oe(d,e[3].roles[e[79]].name),Ee[0]&264&&v!==(v=`role-shortname-${e[79]}`)&&a(h,"for",v),Ee[0]&264&&k!==(k=`role-shortname-${e[79]}`)&&a(C,"id",k),Ee[0]&264&&C.value!==e[3].roles[e[79]].shortname&&Oe(C,e[3].roles[e[79]].shortname),Ee[0]&264&&R!==(R=`role-theme-${e[79]}`)&&a(D,"for",R),Ee[0]&256){sl=e[8];let Ie;for(Ie=0;Ie<sl.length;Ie+=1){const pl=wo(e,sl,Ie);pt[Ie]?pt[Ie].p(pl,Ee):(pt[Ie]=Ro(pl),pt[Ie].c(),pt[Ie].m(A,null))}for(;Ie<pt.length;Ie+=1)pt[Ie].d(1);pt.length=sl.length}if(Ee[0]&264&&E!==(E=`role-theme-${e[79]}`)&&a(A,"id",E),Ee[0]&264&&qe(A,e[3].roles[e[79]].theme),Ee[0]&264&&V!==(V=`role-relevance-${e[79]}`)&&a(re,"for",V),Ee[0]&264&&N!==(N=`role-relevance-${e[79]}`)&&a(O,"id",N),Ee[0]&264&&qe(O,e[3].roles[e[79]].relevance_function),Ee[0]&264&&me!==(me=`role-terraphim-it-${e[79]}`)&&a(ee,"id",me),Ee[0]&264&&(ee.checked=e[3].roles[e[79]].terraphim_it),Ee[0]&264&&fe!==(fe=`role-terraphim-it-${e[79]}`)&&a(le,"for",fe),Ee[0]&491576){rl=e[77].haystacks;let Ie;for(Ie=0;Ie<rl.length;Ie+=1){const pl=bo(e,rl,Ie);mt[Ie]?mt[Ie].p(pl,Ee):(mt[Ie]=No(pl),mt[Ie].c(),mt[Ie].m(t,Se))}for(;Ie<mt.length;Ie+=1)mt[Ie].d(1);mt.length=rl.length}Ee[0]&264&&Le!==(Le="add-haystack-"+e[79])&&a(Ge,"data-testid",Le),Ee[0]&264&&$e!==($e=`llm-provider-${e[79]}`)&&a(Be,"for",$e),Ee[0]&264&&Ae!==(Ae=`llm-provider-${e[79]}`)&&a(Me,"id",Ae),Ee[0]&264&&qe(Me,e[3].roles[e[79]].llm_provider),e[3].roles[e[79]].llm_provider==="ollama"?vt?vt.p(e,Ee):(vt=Po(e),vt.c(),vt.m(t,ie)):vt&&(vt.d(1),vt=null),Ee[0]&264&&lt!==(lt=`openrouter-enabled-${e[79]}`)&&a(ze,"id",lt),Ee[0]&264&&(ze.checked=e[3].roles[e[79]].openrouter_enabled),Ee[0]&264&&gt!==(gt=`openrouter-enabled-${e[79]}`)&&a(nt,"for",gt),e[3].roles[e[79]].openrouter_enabled?bt?bt.p(e,Ee):(bt=Io(e),bt.c(),bt.m(t,Zt)):bt&&(bt.d(1),bt=null),Ee[0]&264&&hl!==(hl=`kg-url-${e[79]}`)&&a(wt,"for",hl),Ee[0]&264&&vl!==(vl=`kg-url-${e[79]}`)&&a(Rt,"id",vl),Ee[0]&264&&Rt.value!==e[3].roles[e[79]].kg.url&&Oe(Rt,e[3].roles[e[79]].kg.url),Ee[0]&264&&bl!==(bl=`kg-local-path-${e[79]}`)&&a(xt,"for",bl),Ee[0]&264&&kl!==(kl=`kg-local-path-${e[79]}`)&&a(dt,"id",kl),Ee[0]&16&&(dt.readOnly=e[4]),Ee[0]&264&&dt.value!==e[3].roles[e[79]].kg.local_path&&Oe(dt,e[3].roles[e[79]].kg.local_path),e[4]?yt||(yt=zo(),yt.c(),yt.m(Gt,null)):yt&&(yt.d(1),yt=null),Ee[0]&264&&yl!==(yl=`kg-local-type-${e[79]}`)&&a(tl,"for",yl),Ee[0]&264&&$l!==($l=`kg-local-type-${e[79]}`)&&a(Ot,"id",$l),Ee[0]&264&&qe(Ot,e[3].roles[e[79]].kg.local_type),Ee[0]&264&&Tl!==(Tl=`kg-public-${e[79]}`)&&a(It,"id",Tl),Ee[0]&264&&(It.checked=e[3].roles[e[79]].kg.public),Ee[0]&264&&Sl!==(Sl=`kg-public-${e[79]}`)&&a(Ht,"for",Sl),Ee[0]&264&&Rl!==(Rl=`kg-publish-${e[79]}`)&&a(Ut,"id",Rl),Ee[0]&264&&(Ut.checked=e[3].roles[e[79]].kg.publish),Ee[0]&264&&El!==(El=`kg-publish-${e[79]}`)&&a(Bt,"for",El),Ee[0]&264&&Ll!==(Ll="remove-role-"+e[79])&&a(Jt,"data-testid",Ll)},d(We){We&&$(t),Xe(pt,We),Xe(mt,We),vt&&vt.d(),bt&&bt.d(),yt&&yt.d(),Ul=!1,xe(fn)}}}function qo(l){let e,t=l[74]+"",n;return{c(){e=f("option"),n=K(t),e.__value=l[74],e.value=e.__value},m(o,c){T(o,e,c),s(e,n)},p:De,d(o){o&&$(e)}}}function Ko(l){let e,t=l[71].name+"",n,o;return{c(){e=f("option"),n=K(t),e.__value=o=l[71].name,e.value=e.__value},m(c,r){T(c,e,r),s(e,n)},p(c,r){r[0]&8&&t!==(t=c[71].name+"")&&we(n,t),r[0]&264&&o!==(o=c[71].name)&&(e.__value=o,e.value=e.__value)},d(c){c&&$(e)}}}function Wo(l){let e,t,n;return{c(){e=f("button"),e.textContent="Back",a(e,"class","button"),a(e,"data-testid","wizard-back")},m(o,c){T(o,e,c),t||(n=X(e,"click",l[11]),t=!0)},p:De,d(o){o&&$(e),t=!1,n()}}}function na(l){let e,t,n;return{c(){e=f("button"),e.textContent="Save",a(e,"class","button is-success"),a(e,"data-testid","wizard-save")},m(o,c){T(o,e,c),t||(n=X(e,"click",l[19]),t=!0)},p:De,d(o){o&&$(e),t=!1,n()}}}function oa(l){let e,t,n;return{c(){e=f("button"),e.textContent="Next",a(e,"class","button is-primary"),a(e,"data-testid","wizard-next")},m(o,c){T(o,e,c),t||(n=X(e,"click",l[10]),t=!0)},p:De,d(o){o&&$(e),t=!1,n()}}}function sa(l){let e,t,n,o,c,r,u,i,d,p,m,_,h,w,v,y,b,C;e=new cl({props:{fallbackPath:"/"}});let k=l[2]==="success"&&$o(l),S=l[2]==="error"&&To(l);function z(A,E){return A[1]===1?ea:A[1]===2?xi:Xi}let D=z(l),M=D(l),R=l[1]>1&&Wo(l);function W(A,E){return A[1]<ys?oa:na}let Y=W(l),J=Y(l);return{c(){ge(e.$$.fragment),t=g(),n=f("div"),o=f("div"),c=f("h3"),c.textContent="Configuration Wizard",r=g(),u=f("button"),u.textContent="Close",i=g(),k&&k.c(),d=g(),S&&S.c(),p=g(),M.c(),m=g(),_=f("nav"),h=f("div"),R&&R.c(),w=g(),v=f("div"),J.c(),a(c,"class","title is-4"),ke(c,"margin-bottom","0"),a(u,"class","button is-small is-light"),a(u,"aria-label","Close configuration wizard"),a(o,"class","is-flex is-justify-content-space-between is-align-items-center"),ke(o,"gap",".5rem"),a(h,"class","level-left"),a(v,"class","level-right"),a(_,"class","level"),a(n,"class","box")},m(A,E){ve(e,A,E),T(A,t,E),T(A,n,E),s(n,o),s(o,c),s(o,r),s(o,u),s(n,i),k&&k.m(n,null),s(n,d),S&&S.m(n,null),s(n,p),M.m(n,null),s(n,m),s(n,_),s(_,h),R&&R.m(h,null),s(_,w),s(_,v),J.m(v,null),y=!0,b||(C=X(u,"click",ra),b=!0)},p(A,E){A[2]==="success"?k?k.p(A,E):(k=$o(A),k.c(),k.m(n,d)):k&&(k.d(1),k=null),A[2]==="error"?S?S.p(A,E):(S=To(A),S.c(),S.m(n,p)):S&&(S.d(1),S=null),D===(D=z(A))&&M?M.p(A,E):(M.d(1),M=D(A),M&&(M.c(),M.m(n,m))),A[1]>1?R?R.p(A,E):(R=Wo(A),R.c(),R.m(h,null)):R&&(R.d(1),R=null),Y===(Y=W(A))&&J?J.p(A,E):(J.d(1),J=Y(A),J&&(J.c(),J.m(v,null)))},i(A){y||(Q(e.$$.fragment,A),y=!0)},o(A){x(e.$$.fragment,A),y=!1},d(A){be(e,A),A&&$(t),A&&$(n),k&&k.d(),S&&S.d(),M.d(),R&&R.d(),J.d(),b=!1,C()}}}const ys=3;function ra(){typeof window<"u"&&window.history.back()}function ia(l,e,t){let n,o;Ue(l,ot,j=>t(4,o=j));const c=At(null);async function r(j,G){if(St(ot))try{const H=await mo({directory:!0,multiple:!1});H&&typeof H=="string"&&i.update(ie=>(ie.roles[j].haystacks[G].path=H,ie))}catch(H){console.error("Failed to open folder selector:",H)}}async function u(j){if(St(ot))try{const G=await mo({directory:!0,multiple:!1});G&&typeof G=="string"&&i.update(H=>(H.roles[j].kg.local_path=G,H))}catch(G){console.error("Failed to open folder selector:",G)}}const i=At({id:"Desktop",global_shortcut:"Ctrl+X",default_theme:"spacelab",default_role:"Default",roles:[]});Ue(l,i,j=>t(3,n=j));const d=["default","darkly","cerulean","cosmo","cyborg","flatly","journal","litera","lumen","lux","materia","minty","nuclear","pulse","sandstone","simplex","slate","solar","spacelab","superhero","united","yeti"];Qt(async()=>{try{let j;St(ot)?j=await Fe("get_config_schema"):j=await(await fetch("/config/schema")).json(),c.set(j);const G=St(Lt);G&&G.id&&i.update(H=>{var ie;return{...H,id:G.id,global_shortcut:G.global_shortcut,default_theme:((ie=G.roles[G.default_role])==null?void 0:ie.theme)??"spacelab",default_role:G.default_role,roles:Object.values(G.roles).map(Te=>{var ze,lt,kt,gt,ul,Kt,fl,Zt,Wt,dl,Mt;const Ce=(ze=Te.kg)==null?void 0:ze.automata_path,Ve=(Ce==null?void 0:Ce.Remote)??"",nt=((kt=(lt=Te.kg)==null?void 0:lt.knowledge_graph_local)==null?void 0:kt.path)??"";return{name:Te.name,shortname:Te.shortname,relevance_function:Te.relevance_function,terraphim_it:Te.terraphim_it??!1,theme:Te.theme,haystacks:(Te.haystacks??[]).map(wt=>({path:wt.location||wt.path||"",read_only:wt.read_only??!1,service:wt.service||"Ripgrep",atomic_server_secret:wt.atomic_server_secret||"",extra_parameters:wt.extra_parameters||{}})),kg:{url:Ve,local_path:nt,local_type:((ul=(gt=Te.kg)==null?void 0:gt.knowledge_graph_local)==null?void 0:ul.input_type)??"markdown",public:((Kt=Te.kg)==null?void 0:Kt.public)??!1,publish:((fl=Te.kg)==null?void 0:fl.publish)??!1},openrouter_enabled:Te.openrouter_enabled??!1,openrouter_api_key:Te.openrouter_api_key??"",openrouter_model:Te.openrouter_model??"openai/gpt-3.5-turbo",openrouter_auto_summarize:Te.openrouter_auto_summarize??!1,openrouter_chat_enabled:Te.openrouter_chat_enabled??!1,openrouter_chat_model:Te.openrouter_chat_model??Te.openrouter_model??"openai/gpt-3.5-turbo",openrouter_chat_system_prompt:Te.openrouter_chat_system_prompt??"",llm_provider:((Zt=Te.extra)==null?void 0:Zt.llm_provider)??"",llm_model:((Wt=Te.extra)==null?void 0:Wt.llm_model)??"",llm_base_url:((dl=Te.extra)==null?void 0:dl.llm_base_url)??"",llm_auto_summarize:((Mt=Te.extra)==null?void 0:Mt.llm_auto_summarize)??!1}})}})}catch(j){console.error("Failed to load schema",j)}}),Qt(()=>{const j=G=>{G.key==="Escape"&&typeof window<"u"&&window.history.back()};return window.addEventListener("keydown",j),()=>window.removeEventListener("keydown",j)});let p={};async function m(j){var Ce;const H=St(i).roles[j],ie=H.llm_provider||(H.openrouter_enabled?"openrouter":""),Te=[];try{if(ie==="ollama"){const Ve=(H.llm_base_url||"http://127.0.0.1:11434").replace(/\/$/,""),ze=await(await fetch(`${Ve}/api/tags`)).json();if(Array.isArray(ze==null?void 0:ze.models))for(const lt of ze.models)lt!=null&&lt.name&&Te.push(lt.name)}else if(ie==="openrouter"){const Ve=(Ce=H.openrouter_api_key)==null?void 0:Ce.trim();if(!Ve)throw new Error("OpenRouter API key required");const ze=await(await fetch("https://openrouter.ai/api/v1/models",{headers:{Authorization:`Bearer ${Ve}`,"HTTP-Referer":"https://terraphim.ai","X-Title":"Terraphim Desktop"}})).json(),lt=Array.isArray(ze==null?void 0:ze.data)?ze.data:[];for(const kt of lt)kt!=null&&kt.id&&Te.push(kt.id)}}catch(Ve){console.error("Failed to fetch models",Ve)}t(0,p={...p,[j]:Te})}let _=1,h="";function w(){_<ys&&t(1,_+=1)}function v(){_>1&&t(1,_-=1)}function y(){i.update(j=>({...j,roles:[...j.roles,{name:"New Role",shortname:"new",relevance_function:"title-scorer",terraphim_it:!1,theme:"spacelab",haystacks:[],kg:{url:"",local_path:"",local_type:"markdown",public:!1,publish:!1},openrouter_enabled:!1,openrouter_api_key:"",openrouter_model:"openai/gpt-3.5-turbo",openrouter_auto_summarize:!1,openrouter_chat_enabled:!1,openrouter_chat_model:"openai/gpt-3.5-turbo",openrouter_chat_system_prompt:"",llm_provider:"",llm_model:"",llm_base_url:"",llm_auto_summarize:!1}]}))}function b(j){i.update(G=>({...G,roles:G.roles.filter((H,ie)=>ie!==j)}))}function C(j){i.update(G=>(G.roles[j].haystacks.push({path:"",read_only:!1,service:"Ripgrep",atomic_server_secret:"",extra_parameters:{}}),G))}function k(j,G){i.update(H=>(H.roles[j].haystacks=H.roles[j].haystacks.filter((ie,Te)=>Te!==G),H))}function S(j,G,H="",ie=""){i.update(Te=>{Te.roles[j].haystacks[G].extra_parameters||(Te.roles[j].haystacks[G].extra_parameters={});const Ce=H||`param_${Date.now()}`;return Te.roles[j].haystacks[G].extra_parameters[Ce]=ie,Te})}function z(j,G,H){i.update(ie=>(delete ie.roles[j].haystacks[G].extra_parameters[H],ie))}function D(j,G,H,ie){i.update(Te=>{const Ce=Te.roles[j].haystacks[G].extra_parameters;return Ce[H]!==void 0&&H!==ie&&(Ce[ie]=Ce[H],delete Ce[H]),Te})}function M(j,G,H,ie){const Te=ie.target.value;D(j,G,H,Te)}async function R(){var Te;const j=St(i),G=St(Lt);let H={...G};H.id=j.id,H.global_shortcut=j.global_shortcut,H.default_role=j.default_role;const ie={};j.roles.forEach(Ce=>{var lt,kt;const Ve=Ce.name,nt=Ve.replace(/^"|"$/g,"");ie[nt]={extra:((kt=(lt=G.roles)==null?void 0:lt[Ve])==null?void 0:kt.extra)??{},name:Ce.name,shortname:Ce.shortname,theme:Ce.theme,relevance_function:Ce.relevance_function,terraphim_it:Ce.terraphim_it??!1,haystacks:Ce.haystacks.map(gt=>({location:gt.path,service:gt.service,read_only:gt.read_only,atomic_server_secret:gt.service==="Atomic"?gt.atomic_server_secret:void 0,extra_parameters:gt.extra_parameters||{}})),kg:Ce.kg.url||Ce.kg.local_path?{automata_path:Ce.kg.url?{Remote:Ce.kg.url}:null,knowledge_graph_local:Ce.kg.local_path?{input_type:Ce.kg.local_type,path:Ce.kg.local_path}:null,public:Ce.kg.public,publish:Ce.kg.publish}:null,...Ce.openrouter_enabled&&{openrouter_enabled:Ce.openrouter_enabled,openrouter_api_key:Ce.openrouter_api_key,openrouter_model:Ce.openrouter_model,openrouter_auto_summarize:Ce.openrouter_auto_summarize??!1,openrouter_chat_enabled:Ce.openrouter_chat_enabled??!1,openrouter_chat_model:Ce.openrouter_chat_model??Ce.openrouter_model,openrouter_chat_system_prompt:Ce.openrouter_chat_system_prompt??""}};const ze={};Ce.llm_provider&&(ze.llm_provider=Ce.llm_provider),Ce.llm_model&&(ze.llm_model=Ce.llm_model),Ce.llm_base_url&&(ze.llm_base_url=Ce.llm_base_url),typeof Ce.llm_auto_summarize=="boolean"&&(ze.llm_auto_summarize=Ce.llm_auto_summarize),ie[nt].extra={...ie[nt].extra||{},...ze}}),H.roles=ie,(!H.default_role||!ie[H.default_role])&&(H.default_role=((Te=j.roles[0])==null?void 0:Te.name)??"Default"),H.selected_role=H.default_role;try{if(St(ot))await Fe("update_config",{configNew:H});else{const Ce=await fetch("/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(H)});if(!Ce.ok)throw new Error(`HTTP ${Ce.status}: ${Ce.statusText}`)}Lt.set(H),t(2,h="success"),setTimeout(()=>{t(2,h="")},3e3)}catch(Ce){console.error(Ce),t(2,h="error"),setTimeout(()=>{t(2,h="")},3e3)}}const W=()=>t(2,h=""),Y=()=>t(2,h="");function J(){n.id=Tt(this),i.set(n),t(8,d)}function A(){n.global_shortcut=this.value,i.set(n),t(8,d)}function E(){n.default_theme=Tt(this),i.set(n),t(8,d)}function ce(){n.default_role=Tt(this),i.set(n),t(8,d)}function q(j){n.roles[j].name=this.value,i.set(n),t(8,d)}function re(j){n.roles[j].shortname=this.value,i.set(n),t(8,d)}function ne(j){n.roles[j].theme=Tt(this),i.set(n),t(8,d)}function V(j){n.roles[j].relevance_function=Tt(this),i.set(n),t(8,d)}function oe(j){n.roles[j].terraphim_it=this.checked,i.set(n),t(8,d)}function I(j,G){n.roles[j].haystacks[G].service=Tt(this),i.set(n),t(8,d)}function U(j,G){n.roles[j].haystacks[G].path=this.value,i.set(n),t(8,d)}const O=(j,G)=>r(j,G);function L(j,G){n.roles[j].haystacks[G].atomic_server_secret=this.value,i.set(n),t(8,d)}function B(j,G){n.roles[j].haystacks[G].extra_parameters.tag=this.value,i.set(n),t(8,d)}const Z=(j,G,H)=>{const ie=H.currentTarget.value;ie&&jt(i,n.roles[j].haystacks[G].extra_parameters.tag=ie,n)},te=(j,G,H,ie)=>M(j,G,H,ie);function P(j,G,H){n.roles[j].haystacks[G].extra_parameters[H]=this.value,i.set(n),t(8,d)}const N=(j,G,H)=>z(j,G,H),F=(j,G)=>S(j,G,"tag","#rust"),ae=(j,G)=>S(j,G,"max_count","10"),le=(j,G)=>S(j,G,"","");function ee(j,G){n.roles[j].haystacks[G].read_only=this.checked,i.set(n),t(8,d)}const me=(j,G)=>k(j,G),_e=j=>C(j);function fe(j){n.roles[j].llm_provider=Tt(this),i.set(n),t(8,d)}function de(j){n.roles[j].llm_model=this.value,i.set(n),t(8,d)}const pe=j=>m(j),he=(j,G)=>{jt(i,n.roles[j].llm_model=G.currentTarget.value,n)};function Se(j){n.roles[j].llm_base_url=this.value,i.set(n),t(8,d)}function Ge(j){n.roles[j].llm_auto_summarize=this.checked,i.set(n),t(8,d)}function je(j){n.roles[j].openrouter_enabled=this.checked,i.set(n),t(8,d)}function Le(j){n.roles[j].openrouter_api_key=this.value,i.set(n),t(8,d)}function Re(j){n.roles[j].openrouter_model=this.value,i.set(n),t(8,d)}const se=j=>m(j),ye=(j,G)=>{jt(i,n.roles[j].openrouter_model=G.currentTarget.value,n)};function Ne(j){n.roles[j].openrouter_auto_summarize=this.checked,i.set(n),t(8,d)}function Be(j){n.roles[j].openrouter_chat_enabled=this.checked,i.set(n),t(8,d)}function Ke(j){n.roles[j].openrouter_chat_model=Tt(this),i.set(n),t(8,d)}function $e(j){n.roles[j].openrouter_chat_system_prompt=this.value,i.set(n),t(8,d)}function Pe(j){n.roles[j].kg.url=this.value,i.set(n),t(8,d)}function et(j){n.roles[j].kg.local_path=this.value,i.set(n),t(8,d)}const Je=j=>u(j);function Me(j){n.roles[j].kg.local_type=Tt(this),i.set(n),t(8,d)}function He(j){n.roles[j].kg.public=this.checked,i.set(n),t(8,d)}function tt(j){n.roles[j].kg.publish=this.checked,i.set(n),t(8,d)}return[p,_,h,n,o,r,u,i,d,m,w,v,y,b,C,k,S,z,M,R,W,Y,J,A,E,ce,q,re,ne,V,oe,I,U,O,L,B,Z,te,P,N,F,ae,le,ee,me,_e,fe,de,pe,he,Se,Ge,je,Le,Re,se,ye,Ne,Be,Ke,$e,Pe,et,Je,Me,He,tt,j=>b(j),()=>{t(1,_=2)}]}class aa extends _t{constructor(e){super(),ht(this,e,ia,sa,ft,{},null,[-1,-1,-1,-1])}}function ca(l){let e,t,n,o,c,r,u,i;return e=new cl({props:{fallbackPath:"/"}}),u=new vs({props:{content:l[0],onChange:l[1]}}),{c(){ge(e.$$.fragment),t=g(),n=f("div"),o=f("p"),o.innerHTML="<i>The best editing experience is to configure Atomic Server, in the meantime use editor below. You will need to refresh page via Command R or Ctrl-R to see changes</i>",c=g(),r=f("div"),ge(u.$$.fragment),a(r,"class","editor"),a(n,"class","box")},m(d,p){ve(e,d,p),T(d,t,p),T(d,n,p),s(n,o),s(n,c),s(n,r),ve(u,r,null),i=!0},p(d,[p]){const m={};p&1&&(m.content=d[0]),u.$set(m)},i(d){i||(Q(e.$$.fragment,d),Q(u.$$.fragment,d),i=!0)},o(d){x(e.$$.fragment,d),x(u.$$.fragment,d),i=!1},d(d){be(e,d),d&&$(t),d&&$(n),be(u)}}}function ua(l,e,t){let n,o;Ue(l,Lt,u=>t(2,n=u)),Ue(l,ot,u=>t(3,o=u));let c={json:n};function r(u){if(console.log("contents changed:",u),console.log("is tauri",o),Lt.update(i=>(i=u.json,i)),St(ot))console.log("Updating config on server"),Fe("update_config",{configNew:u.json}).then(i=>{console.log(`Message: ${i}`)}).catch(i=>console.error(i));else{let i=`${Ze.ServerURL}/config/`;fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u.json)})}t(0,c=u)}return Qt(()=>{t(0,c={json:n})}),[c,r]}class fa extends _t{constructor(e){super(),ht(this,e,ua,ca,ft,{})}}const{window:ql}=Ks;function da(l){let e,t,n,o,c,r,u,i,d,p;return{c(){e=f("div"),t=f("div"),n=f("h3"),n.textContent="Error loading graph",o=g(),c=f("p"),r=K(l[3]),u=g(),i=f("button"),i.textContent="Retry",a(i,"class","button is-primary"),a(t,"class","error-content svelte-1ry9pkl"),a(e,"class","error-overlay svelte-1ry9pkl")},m(m,_){T(m,e,_),s(e,t),s(t,n),s(t,o),s(t,c),s(c,r),s(t,u),s(t,i),d||(p=X(i,"click",l[11]),d=!0)},p(m,_){_&8&&we(r,m[3])},d(m){m&&$(e),d=!1,p()}}}function pa(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="loading-content svelte-1ry9pkl"><div class="loader svelte-1ry9pkl"></div> 
        <p>Loading knowledge graph...</p></div>`,a(e,"class","loading-overlay svelte-1ry9pkl")},m(t,n){T(t,e,n)},p:De,d(t){t&&$(e)}}}function Go(l){let e,t,n;return{c(){e=f("button"),e.innerHTML='<i class="fas fa-times svelte-1ry9pkl"></i>',a(e,"class","close-button svelte-1ry9pkl"),a(e,"title","Close Graph")},m(o,c){T(o,e,c),t||(n=X(e,"click",l[17]),t=!0)},p:De,d(o){o&&$(e),t=!1,n()}}}function Bo(l){let e;return{c(){e=f("div"),e.innerHTML="<span><strong>Left-click:</strong> View node • <strong>Right-click:</strong> Edit node • <strong>Drag:</strong> Move • <strong>Scroll:</strong> Zoom</span>",a(e,"class","controls-info svelte-1ry9pkl")},m(t,n){T(t,e,n)},d(t){t&&$(e)}}}function Jo(l){let e,t;return{c(){e=f("div"),t=K(l[8]),a(e,"class","debug-message svelte-1ry9pkl")},m(n,o){T(n,e,o),s(e,t)},p(n,o){o&256&&we(t,n[8])},d(n){n&&$(e)}}}function Vo(l){let e=l[5].id,t,n,o=Qo(l);return{c(){o.c(),t=rt()},m(c,r){o.m(c,r),T(c,t,r),n=!0},p(c,r){r&32&&ft(e,e=c[5].id)?(Qe(),x(o,1,1,De),Ye(),o=Qo(c),o.c(),Q(o,1),o.m(t.parentNode,t)):o.p(c,r)},i(c){n||(Q(o),n=!0)},o(c){x(o),n=!1},d(c){c&&$(t),o.d(c)}}}function Qo(l){let e,t,n;function o(r){l[18](r)}let c={item:l[5],initialEdit:l[7]};return l[6]!==void 0&&(c.active=l[6]),e=new Gl({props:c}),st.push(()=>at(e,"active",o)),e.$on("close",l[12]),e.$on("save",l[13]),{c(){ge(e.$$.fragment)},m(r,u){ve(e,r,u),n=!0},p(r,u){const i={};u&32&&(i.item=r[5]),u&128&&(i.initialEdit=r[7]),!t&&u&64&&(t=!0,i.active=r[6],ct(()=>t=!1)),e.$set(i)},i(r){n||(Q(e.$$.fragment,r),n=!0)},o(r){x(e.$$.fragment,r),n=!1},d(r){be(e,r)}}}function ma(l){let e,t,n,o,c,r,u,i,d,p,m;it(l[15]),e=new cl({props:{fallbackPath:"/"}});function _(k,S){if(k[2])return pa;if(k[3])return da}let h=_(l),w=h&&h(l),v=l[0]&&Go(l),y=!l[2]&&!l[3]&&l[4].length>0&&Bo(),b=l[8]&&Jo(l),C=l[5]&&Vo(l);return{c(){ge(e.$$.fragment),t=g(),n=f("div"),w&&w.c(),o=g(),v&&v.c(),c=g(),y&&y.c(),r=g(),b&&b.c(),u=g(),C&&C.c(),i=rt(),a(n,"class","graph-container svelte-1ry9pkl"),ke(n,"width",l[0]?"100vw":"600px"),ke(n,"height",l[0]?"100vh":"400px"),ut(n,"fullscreen",l[0])},m(k,S){ve(e,k,S),T(k,t,S),T(k,n,S),w&&w.m(n,null),l[16](n),T(k,o,S),v&&v.m(k,S),T(k,c,S),y&&y.m(k,S),T(k,r,S),b&&b.m(k,S),T(k,u,S),C&&C.m(k,S),T(k,i,S),d=!0,p||(m=X(ql,"resize",l[15]),p=!0)},p(k,[S]){h===(h=_(k))&&w?w.p(k,S):(w&&w.d(1),w=h&&h(k),w&&(w.c(),w.m(n,null))),(!d||S&1)&&ke(n,"width",k[0]?"100vw":"600px"),(!d||S&1)&&ke(n,"height",k[0]?"100vh":"400px"),(!d||S&1)&&ut(n,"fullscreen",k[0]),k[0]?v?v.p(k,S):(v=Go(k),v.c(),v.m(c.parentNode,c)):v&&(v.d(1),v=null),!k[2]&&!k[3]&&k[4].length>0?y||(y=Bo(),y.c(),y.m(r.parentNode,r)):y&&(y.d(1),y=null),k[8]?b?b.p(k,S):(b=Jo(k),b.c(),b.m(u.parentNode,u)):b&&(b.d(1),b=null),k[5]?C?(C.p(k,S),S&32&&Q(C,1)):(C=Vo(k),C.c(),Q(C,1),C.m(i.parentNode,i)):C&&(Qe(),x(C,1,1,()=>{C=null}),Ye())},i(k){d||(Q(e.$$.fragment,k),Q(C),d=!0)},o(k){x(e.$$.fragment,k),x(C),d=!1},d(k){be(e,k),k&&$(t),k&&$(n),w&&w.d(),l[16](null),k&&$(o),v&&v.d(k),k&&$(c),y&&y.d(k),k&&$(r),b&&b.d(k),k&&$(u),C&&C.d(k),k&&$(i),p=!1,m()}}}function Yo(l){return{id:`kg-node-${l.id}`,url:`#/graph/node/${l.id}`,title:l.label,body:`# ${l.label}

**Knowledge Graph Node**

ID: ${l.id}
Rank: ${l.rank}

This is a concept node from the knowledge graph. You can edit this content to add more information about "${l.label}".`,description:`Knowledge graph concept: ${l.label}`,tags:["knowledge-graph","concept"],rank:l.rank,stub:`Knowledge graph concept: ${l.label}`}}function _a(l,e,t){let n,o;Ue(l,Et,E=>t(20,n=E)),Ue(l,ot,E=>t(21,o=E));let{apiUrl:c="/rolegraph"}=e,{fullscreen:r=!0}=e,u,i=!0,d=null,p=[],m=[],_=null,h=!1,w=!1,v="",y=window.innerWidth,b=window.innerHeight;function C(){t(9,y=window.innerWidth),t(10,b=window.innerHeight),!i&&!d&&R()}async function k(){t(2,i=!0),t(3,d=null);try{if(o){console.log("Loading rolegraph from Tauri");const E=await Fe("get_rolegraph",{role_name:n||void 0});if(E&&E.status==="success")t(4,p=E.nodes),m=E.edges;else throw new Error(`Tauri rolegraph fetch failed: ${(E==null?void 0:E.status)||"unknown error"}`)}else{console.log("Loading rolegraph from server");const E=n?`${c}?role=${encodeURIComponent(n)}`:c,ce=await fetch(E);if(!ce.ok)throw new Error(`Failed to fetch: ${ce.status}`);const q=await ce.json();t(4,p=q.nodes),m=q.edges}}catch(E){t(3,d=E.message),console.error("Error fetching rolegraph:",E)}finally{t(2,i=!1)}}function S(E,ce){E.stopPropagation(),console.log("Node clicked:",ce.label),t(5,_=Yo(ce)),t(7,w=!1),t(6,h=!0)}function z(E,ce){E.preventDefault(),E.stopPropagation(),console.log("Node right-clicked:",ce.label),t(8,v=`Right-clicked: ${ce.label}`),t(5,_=Yo(ce)),t(7,w=!0),t(6,h=!0),setTimeout(()=>{t(8,v="")},2e3)}function D(){t(6,h=!1),t(5,_=null),t(7,w=!1)}async function M(){if(_)try{const E=await fetch("/documents",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(_)});E.ok?console.log("Successfully saved KG record:",_.id):console.error("Failed to save KG record:",E.statusText)}catch(E){console.error("Error saving KG record:",E)}finally{t(6,h=!1),t(5,_=null),t(7,w=!1)}}function R(){if(!u)return;t(1,u.innerHTML="",u);const E=zl(u).append("svg").attr("width",y).attr("height",b),ce=or().scaleExtent([.1,10]).on("zoom",L=>{q.attr("transform",L.transform)});E.call(ce);const q=E.append("g"),re=sr(p).force("link",rr(m).id(L=>L.id).distance(100)).force("charge",ir().strength(-200)).force("center",ar(y/2,b/2)).force("collision",cr().radius(20)),ne=q.append("g").attr("class","links").selectAll("line").data(m).enter().append("line").attr("stroke","#666").attr("stroke-opacity",.7).attr("stroke-width",L=>{const B=L.weight||L.rank||1;return Math.max(1,Math.min(8,B*2))}),V=q.append("g").attr("class","nodes").selectAll("circle").data(p).enter().append("circle").attr("r",L=>{const B=L.rank||1;return Math.max(6,Math.min(20,B*2))}).attr("fill",L=>{const B=L.rank||1,Z=Math.min(B/10,1);return ur(.2+Z*.6)}).attr("stroke","#fff").attr("stroke-width",2).style("cursor","pointer").on("click",(L,B)=>S(L,B)).on("contextmenu",(L,B)=>z(L,B)).on("mouseover",function(L,B){zl(this).transition().duration(150).attr("stroke-width",3).attr("r",Z=>{const te=Z.rank||1;return Math.max(8,Math.min(24,te*2.5))})}).on("mouseout",function(L,B){zl(this).transition().duration(150).attr("stroke-width",2).attr("r",Z=>{const te=Z.rank||1;return Math.max(6,Math.min(20,te*2))})}).call(fr().on("start",I).on("drag",U).on("end",O)),oe=q.append("g").attr("class","labels").selectAll("text").data(p).enter().append("text").attr("text-anchor","middle").attr("dy",".35em").attr("font-size","11px").attr("font-family","Arial, sans-serif").attr("fill","#333").attr("pointer-events","none").text(L=>L.label.length>12?L.label.substring(0,12)+"...":L.label);re.on("tick",()=>{ne.attr("x1",L=>L.source.x).attr("y1",L=>L.source.y).attr("x2",L=>L.target.x).attr("y2",L=>L.target.y),V.attr("cx",L=>L.x).attr("cy",L=>L.y),oe.attr("x",L=>L.x).attr("y",L=>L.y)});function I(L,B){L.active||re.alphaTarget(.3).restart(),B.fx=B.x,B.fy=B.y}function U(L,B){B.fx=L.x,B.fy=L.y}function O(L,B){L.active||re.alphaTarget(0),B.fx=null,B.fy=null}}Qt(()=>{k().then(()=>{d||R()});const E=ce=>{ce.preventDefault()};return u&&u.addEventListener("contextmenu",E),window.addEventListener("resize",C),()=>{u&&u.removeEventListener("contextmenu",E),window.removeEventListener("resize",C)}});function W(){t(9,y=ql.innerWidth),t(10,b=ql.innerHeight)}function Y(E){st[E?"unshift":"push"](()=>{u=E,t(1,u)})}const J=()=>history.back();function A(E){h=E,t(6,h)}return l.$$set=E=>{"apiUrl"in E&&t(14,c=E.apiUrl),"fullscreen"in E&&t(0,r=E.fullscreen)},[r,u,i,d,p,_,h,w,v,y,b,k,D,M,c,W,Y,J,A]}class ha extends _t{constructor(e){super(),ht(this,e,_a,ma,ft,{apiUrl:14,fullscreen:0})}}function Zo(l,e,t){const n=l.slice();return n[19]=e[t][0],n[20]=e[t][1],n[21]=e,n[22]=t,n}function Xo(l,e,t){const n=l.slice();return n[23]=e[t],n}function xo(l){let e,t,n,o,c,r,u,i,d,p,m,_,h,w,v=l[2].title.trim()==="",y,b,C,k,S,z,D,M,R,W,Y,J,A,E,ce,q=l[2].content.trim()==="",re,ne,V,oe,I,U,O,L,B,Z,te,P,N,F,ae,le,ee,me,_e,fe,de,pe=l[1]==="edit"?"Save Changes":"Add Context",he,Se,Ge,je,Le,Re,se,ye,Ne,Be,Ke=l[4],$e=[];for(let G=0;G<Ke.length;G+=1)$e[G]=es(Xo(l,Ke,G));let Pe=v&&ts();function et(G,H){return G[2].summary?va:ga}let Je=et(l),Me=Je(l),He=q&&ls();function tt(G,H){return H&4&&(te=null),te==null&&(te=Object.keys(G[2].metadata).length===0),te?ka:ba}let ue=tt(l,-1),Ae=ue(l),j=l[1]==="edit"&&os(l);return{c(){e=f("section"),t=f("div"),n=f("label"),n.textContent="Type",o=g(),c=f("div"),r=f("div"),u=f("select");for(let G=0;G<$e.length;G+=1)$e[G].c();i=g(),d=f("div"),p=f("label"),p.textContent="Title *",m=g(),_=f("div"),h=f("input"),w=g(),Pe&&Pe.c(),y=g(),b=f("div"),C=f("label"),C.textContent="Summary",k=g(),S=f("div"),z=f("textarea"),D=g(),M=f("p"),Me.c(),R=g(),W=f("div"),Y=f("label"),Y.textContent="Content *",J=g(),A=f("div"),E=f("textarea"),ce=g(),He&&He.c(),re=g(),ne=f("details"),V=f("summary"),V.innerHTML=`<span class="icon-text"><span class="icon"><i class="fas fa-cog"></i></span> 
              <span>Advanced Options</span></span>`,oe=g(),I=f("div"),U=f("label"),U.textContent="Metadata",O=g(),L=f("div"),B=f("p"),B.textContent="Additional key-value pairs for this context item",Z=g(),Ae.c(),P=g(),N=f("button"),N.innerHTML=`<span class="icon"><i class="fas fa-plus"></i></span> 
                <span>Add Metadata</span>`,F=g(),ae=f("footer"),le=f("div"),ee=f("div"),me=f("button"),_e=f("span"),_e.innerHTML='<i class="fas fa-save"></i>',fe=g(),de=f("span"),he=K(pe),Ge=g(),je=f("div"),Le=f("button"),Le.innerHTML="<span>Cancel</span>",Re=g(),j&&j.c(),se=g(),ye=f("div"),ye.innerHTML=`<strong>Keyboard shortcuts:</strong>
          Ctrl/Cmd + Enter to save, Escape to close`,a(n,"class","label"),a(n,"for","context-type"),a(u,"id","context-type"),a(u,"data-testid","context-type-select"),l[2].context_type===void 0&&it(()=>l[10].call(u)),a(r,"class","select is-fullwidth"),a(c,"class","control"),a(t,"class","field"),a(p,"class","label"),a(p,"for","context-title"),a(h,"id","context-title"),a(h,"class","input"),a(h,"type","text"),a(h,"placeholder","Enter title..."),a(h,"data-testid","context-title-input"),h.required=!0,a(_,"class","control"),a(d,"class","field"),a(C,"class","label"),a(C,"for","context-summary"),a(z,"id","context-summary"),a(z,"class","textarea svelte-1oesbw7"),a(z,"placeholder","Brief summary of the content (optional)..."),a(z,"data-testid","context-summary-textarea"),a(z,"rows","3"),a(z,"maxlength","500"),a(S,"class","control"),a(M,"class","help svelte-1oesbw7"),a(b,"class","field"),a(Y,"class","label"),a(Y,"for","context-content"),a(E,"id","context-content"),a(E,"class","textarea svelte-1oesbw7"),a(E,"placeholder","Enter the full content..."),a(E,"data-testid","context-content-textarea"),a(E,"rows","8"),E.required=!0,a(A,"class","control"),a(W,"class","field"),a(V,"class","summary svelte-1oesbw7"),a(U,"class","label"),a(B,"class","help svelte-1oesbw7"),a(N,"class","button is-small is-light"),a(L,"class","content"),a(I,"class","field mt-4"),a(ne,"class","details svelte-1oesbw7"),a(e,"class","modal-card-body svelte-1oesbw7"),a(_e,"class","icon"),a(me,"class","button is-primary"),me.disabled=Se=!l[3],a(me,"data-testid","save-context-button"),a(ee,"class","control"),a(Le,"class","button is-light"),a(Le,"data-testid","cancel-context-button"),a(je,"class","control"),a(le,"class","field is-grouped"),a(ye,"class","help svelte-1oesbw7"),a(ae,"class","modal-card-foot")},m(G,H){T(G,e,H),s(e,t),s(t,n),s(t,o),s(t,c),s(c,r),s(r,u);for(let ie=0;ie<$e.length;ie+=1)$e[ie]&&$e[ie].m(u,null);qe(u,l[2].context_type,!0),s(e,i),s(e,d),s(d,p),s(d,m),s(d,_),s(_,h),Oe(h,l[2].title),s(d,w),Pe&&Pe.m(d,null),s(e,y),s(e,b),s(b,C),s(b,k),s(b,S),s(S,z),Oe(z,l[2].summary),s(b,D),s(b,M),Me.m(M,null),s(e,R),s(e,W),s(W,Y),s(W,J),s(W,A),s(A,E),Oe(E,l[2].content),s(W,ce),He&&He.m(W,null),s(e,re),s(e,ne),s(ne,V),s(ne,oe),s(ne,I),s(I,U),s(I,O),s(I,L),s(L,B),s(L,Z),Ae.m(L,null),s(L,P),s(L,N),T(G,F,H),T(G,ae,H),s(ae,le),s(le,ee),s(ee,me),s(me,_e),s(me,fe),s(me,de),s(de,he),s(le,Ge),s(le,je),s(je,Le),s(le,Re),j&&j.m(le,null),s(ae,se),s(ae,ye),Ne||(Be=[X(u,"change",l[10]),X(h,"input",l[11]),X(z,"input",l[12]),X(E,"input",l[13]),X(N,"click",l[17]),X(me,"click",l[6]),X(Le,"click",l[5])],Ne=!0)},p(G,H){if(H&16){Ke=G[4];let ie;for(ie=0;ie<Ke.length;ie+=1){const Te=Xo(G,Ke,ie);$e[ie]?$e[ie].p(Te,H):($e[ie]=es(Te),$e[ie].c(),$e[ie].m(u,null))}for(;ie<$e.length;ie+=1)$e[ie].d(1);$e.length=Ke.length}H&20&&qe(u,G[2].context_type),H&20&&h.value!==G[2].title&&Oe(h,G[2].title),H&4&&(v=G[2].title.trim()===""),v?Pe||(Pe=ts(),Pe.c(),Pe.m(d,null)):Pe&&(Pe.d(1),Pe=null),H&20&&Oe(z,G[2].summary),Je===(Je=et(G))&&Me?Me.p(G,H):(Me.d(1),Me=Je(G),Me&&(Me.c(),Me.m(M,null))),H&20&&Oe(E,G[2].content),H&4&&(q=G[2].content.trim()===""),q?He||(He=ls(),He.c(),He.m(W,null)):He&&(He.d(1),He=null),ue===(ue=tt(G,H))&&Ae?Ae.p(G,H):(Ae.d(1),Ae=ue(G),Ae&&(Ae.c(),Ae.m(L,P))),H&2&&pe!==(pe=G[1]==="edit"?"Save Changes":"Add Context")&&we(he,pe),H&8&&Se!==(Se=!G[3])&&(me.disabled=Se),G[1]==="edit"?j?j.p(G,H):(j=os(G),j.c(),j.m(le,null)):j&&(j.d(1),j=null)},d(G){G&&$(e),Xe($e,G),Pe&&Pe.d(),Me.d(),He&&He.d(),Ae.d(),G&&$(F),G&&$(ae),j&&j.d(),Ne=!1,xe(Be)}}}function es(l){let e,t=l[23].label+"",n;return{c(){e=f("option"),n=K(t),e.__value=l[23].value,e.value=e.__value},m(o,c){T(o,e,c),s(e,n)},p:De,d(o){o&&$(e)}}}function ts(l){let e;return{c(){e=f("p"),e.textContent="Title is required",a(e,"class","help is-danger svelte-1oesbw7")},m(t,n){T(t,e,n)},d(t){t&&$(e)}}}function ga(l){let e;return{c(){e=K("Optional brief summary (up to 500 characters)")},m(t,n){T(t,e,n)},p:De,d(t){t&&$(e)}}}function va(l){let e=l[2].summary.length+"",t,n;return{c(){t=K(e),n=K("/500 characters")},m(o,c){T(o,t,c),T(o,n,c)},p(o,c){c&4&&e!==(e=o[2].summary.length+"")&&we(t,e)},d(o){o&&$(t),o&&$(n)}}}function ls(l){let e;return{c(){e=f("p"),e.textContent="Content is required",a(e,"class","help is-danger svelte-1oesbw7")},m(t,n){T(t,e,n)},d(t){t&&$(e)}}}function ba(l){let e,t=Object.entries(l[2].metadata),n=[];for(let o=0;o<t.length;o+=1)n[o]=ns(Zo(l,t,o));return{c(){for(let o=0;o<n.length;o+=1)n[o].c();e=rt()},m(o,c){for(let r=0;r<n.length;r+=1)n[r]&&n[r].m(o,c);T(o,e,c)},p(o,c){if(c&4){t=Object.entries(o[2].metadata);let r;for(r=0;r<t.length;r+=1){const u=Zo(o,t,r);n[r]?n[r].p(u,c):(n[r]=ns(u),n[r].c(),n[r].m(e.parentNode,e))}for(;r<n.length;r+=1)n[r].d(1);n.length=t.length}},d(o){Xe(n,o),o&&$(e)}}}function ka(l){let e;return{c(){e=f("p"),e.textContent="No metadata defined",a(e,"class","has-text-grey-light")},m(t,n){T(t,e,n)},p:De,d(t){t&&$(e)}}}function ns(l){let e,t,n,o,c,r,u,i,d,p,m,_,h;function w(...b){return l[14](l[19],l[20],...b)}function v(){l[15].call(u,l[19])}function y(){return l[16](l[19])}return{c(){e=f("div"),t=f("div"),n=f("input"),c=g(),r=f("div"),u=f("input"),i=g(),d=f("div"),p=f("button"),p.innerHTML='<span class="icon"><i class="fas fa-times"></i></span>',m=g(),a(n,"class","input is-small"),a(n,"type","text"),a(n,"placeholder","Key"),n.value=o=l[19],a(t,"class","control is-expanded"),a(u,"class","input is-small"),a(u,"type","text"),a(u,"placeholder","Value"),a(r,"class","control is-expanded"),a(p,"class","button is-small is-danger is-outlined"),a(d,"class","control"),a(e,"class","field is-grouped")},m(b,C){T(b,e,C),s(e,t),s(t,n),s(e,c),s(e,r),s(r,u),Oe(u,l[2].metadata[l[19]]),s(e,i),s(e,d),s(d,p),s(e,m),_||(h=[X(n,"input",w),X(u,"input",v),X(p,"click",y)],_=!0)},p(b,C){l=b,C&20&&o!==(o=l[19])&&n.value!==o&&(n.value=o),C&20&&u.value!==l[2].metadata[l[19]]&&Oe(u,l[2].metadata[l[19]])},d(b){b&&$(e),_=!1,xe(h)}}}function os(l){let e,t,n,o,c,r;return{c(){e=f("div"),t=g(),n=f("div"),o=f("button"),o.innerHTML=`<span class="icon"><i class="fas fa-trash"></i></span> 
                <span>Delete</span>`,a(e,"class","control is-expanded"),a(o,"class","button is-danger is-outlined"),a(o,"data-testid","delete-context-button"),a(n,"class","control")},m(u,i){T(u,e,i),T(u,t,i),T(u,n,i),s(n,o),c||(r=X(o,"click",l[7]),c=!0)},p:De,d(u){u&&$(e),u&&$(t),u&&$(n),c=!1,r()}}}function wa(l){let e,t,n,o=l[1]==="edit"?"Edit Context Item":"Add Context Item",c,r,u,i,d,p,m=l[2]&&xo(l);return{c(){e=f("div"),t=f("header"),n=f("p"),c=K(o),r=g(),u=f("button"),i=g(),m&&m.c(),a(n,"class","modal-card-title"),a(u,"class","delete"),a(u,"aria-label","close"),a(t,"class","modal-card-head"),a(e,"class","modal-card")},m(_,h){T(_,e,h),s(e,t),s(t,n),s(n,c),s(t,r),s(t,u),s(e,i),m&&m.m(e,null),d||(p=X(u,"click",l[5]),d=!0)},p(_,h){h&2&&o!==(o=_[1]==="edit"?"Edit Context Item":"Add Context Item")&&we(c,o),_[2]?m?m.p(_,h):(m=xo(_),m.c(),m.m(e,null)):m&&(m.d(1),m=null)},d(_){_&&$(e),m&&m.d(),d=!1,p()}}}function ya(l){let e,t,n,o;return e=new Dl({props:{active:l[0],$$slots:{default:[wa]},$$scope:{ctx:l}}}),e.$on("close",l[5]),{c(){ge(e.$$.fragment)},m(c,r){ve(e,c,r),t=!0,n||(o=X(window,"keydown",l[8]),n=!0)},p(c,[r]){const u={};r&1&&(u.active=c[0]),r&67108878&&(u.$$scope={dirty:r,ctx:c}),e.$set(u)},i(c){t||(Q(e.$$.fragment,c),t=!0)},o(c){x(e.$$.fragment,c),t=!1},d(c){be(e,c),n=!1,o()}}}function Ca(l,e,t){let n,{active:o=!1}=e,{context:c=null}=e,{mode:r="edit"}=e;const u=Ws();let i=null,d=[{value:"Document",label:"Document"},{value:"SearchResult",label:"Search Result"},{value:"UserInput",label:"User Input"},{value:"System",label:"System"},{value:"External",label:"External"}];function p(){t(0,o=!1),t(2,i=null),u("close")}function m(){!n||!i||(u(r==="edit"?"update":"create",i),p())}function _(){r==="edit"&&c&&(u("delete",c.id),p())}function h(D){D.key==="Escape"?p():D.key==="Enter"&&(D.ctrlKey||D.metaKey)&&m()}function w(){i.context_type=Tt(this),t(2,i),t(0,o),t(9,c),t(1,r),t(4,d)}function v(){i.title=this.value,t(2,i),t(0,o),t(9,c),t(1,r),t(4,d)}function y(){i.summary=this.value,t(2,i),t(0,o),t(9,c),t(1,r),t(4,d)}function b(){i.content=this.value,t(2,i),t(0,o),t(9,c),t(1,r),t(4,d)}const C=(D,M,R)=>{const W={...i.metadata};delete W[D],W[R.target.value]=M,t(2,i.metadata=W,i)};function k(D){i.metadata[D]=this.value,t(2,i),t(0,o),t(9,c),t(1,r),t(4,d)}const S=D=>{const M={...i.metadata};delete M[D],t(2,i.metadata=M,i)},z=()=>{t(2,i.metadata={...i.metadata,[`key_${Date.now()}`]:""},i)};return l.$$set=D=>{"active"in D&&t(0,o=D.active),"context"in D&&t(9,c=D.context),"mode"in D&&t(1,r=D.mode)},l.$$.update=()=>{l.$$.dirty&515&&(o&&c?t(2,i={...c,metadata:{...c.metadata}}):o&&r==="create"&&t(2,i={id:"",context_type:"UserInput",title:"",summary:"",content:"",metadata:{},created_at:new Date().toISOString(),relevance_score:null})),l.$$.dirty&4&&t(3,n=i&&i.title.trim()!==""&&i.content.trim()!=="")},[o,r,i,n,d,p,m,_,h,c,w,v,y,b,C,k,S,z]}class $a extends _t{constructor(e){super(),ht(this,e,Ca,ya,ft,{active:0,context:9,mode:1})}}function ss(l,e,t){const n=l.slice();return n[40]=e[t],n[42]=t,n}function rs(l,e,t){const n=l.slice();return n[43]=e[t],n[45]=t,n}function is(l){let e,t,n;return{c(){e=f("p"),t=K("Conversation ID: "),n=K(l[5]),a(e,"class","is-size-7 has-text-grey")},m(o,c){T(o,e,c),s(e,t),s(e,n)},p(o,c){c[0]&32&&we(n,o[5])},d(o){o&&$(e)}}}function as(l){let e,t,n,o=l[43].content+"",c,r;return{c(){e=f("div"),t=f("div"),n=f("pre"),c=K(o),a(n,"class","svelte-rbq0zi"),a(t,"class","bubble svelte-rbq0zi"),a(e,"class",r=Dt(`msg ${l[43].role}`)+" svelte-rbq0zi")},m(u,i){T(u,e,i),s(e,t),s(t,n),s(n,c)},p(u,i){i[0]&1&&o!==(o=u[43].content+"")&&we(c,o),i[0]&1&&r!==(r=Dt(`msg ${u[43].role}`)+" svelte-rbq0zi")&&a(e,"class",r)},d(u){u&&$(e)}}}function cs(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="bubble loading svelte-rbq0zi"><span class="icon is-small"><i class="fas fa-spinner fa-spin"></i></span> 
            <span>Thinking...</span></div>`,a(e,"class","msg assistant svelte-rbq0zi")},m(t,n){T(t,e,n)},d(t){t&&$(e)}}}function us(l){let e,t,n;return{c(){e=f("p"),t=K("Model: "),n=K(l[4]),a(e,"class","is-size-7 has-text-grey")},m(o,c){T(o,e,c),s(e,t),s(e,n)},p(o,c){c[0]&16&&we(n,o[4])},d(o){o&&$(e)}}}function fs(l){let e,t;return{c(){e=f("p"),t=K(l[3]),a(e,"class","has-text-danger is-size-7")},m(n,o){T(n,e,o),s(e,t)},p(n,o){o[0]&8&&we(t,n[3])},d(n){n&&$(e)}}}function Ta(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-refresh"></i>',a(e,"class","icon is-small")},m(t,n){T(t,e,n)},d(t){t&&$(e)}}}function Sa(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-spinner fa-spin"></i>',a(e,"class","icon is-small")},m(t,n){T(t,e,n)},d(t){t&&$(e)}}}function ds(l){let e,t,n,o,c,r,u,i,d,p,m,_,h,w,v,y,b,C,k,S,z,D,M,R,W,Y,J,A,E,ce,q,re,ne,V,oe,I,U,O;function L(te,P){return te[12]?Ea:Ra}let B=L(l),Z=B(l);return{c(){e=f("div"),t=f("div"),n=f("label"),n.textContent="Context Type",o=g(),c=f("div"),r=f("div"),u=f("select"),i=f("option"),i.textContent="Document",d=f("option"),d.textContent="Search Result",p=f("option"),p.textContent="User Input",m=f("option"),m.textContent="Note",_=g(),h=f("div"),w=f("label"),w.textContent="Title",v=g(),y=f("div"),b=f("input"),C=g(),k=f("div"),S=f("label"),S.textContent="Content",z=g(),D=f("div"),M=f("textarea"),R=g(),W=f("div"),Y=f("div"),J=f("button"),Z.c(),A=g(),E=f("span"),E.textContent="Save Context",q=g(),re=f("div"),ne=f("button"),V=f("span"),V.innerHTML='<i class="fas fa-times"></i>',oe=g(),I=f("span"),I.textContent="Cancel",a(n,"class","label is-small"),i.__value="document",i.value=i.__value,d.__value="search_result",d.value=d.__value,p.__value="user_input",p.value=p.__value,m.__value="note",m.value=m.__value,a(u,"data-testid","context-type-select"),l[11]===void 0&&it(()=>l[26].call(u)),a(r,"class","select is-small is-fullwidth"),a(c,"class","control"),a(t,"class","field"),a(w,"class","label is-small"),a(b,"class","input is-small"),a(b,"type","text"),a(b,"placeholder","Enter context title"),a(b,"data-testid","context-title-input"),a(y,"class","control"),a(h,"class","field"),a(S,"class","label is-small"),a(M,"class","textarea is-small"),a(M,"rows","4"),a(M,"placeholder","Enter context content"),a(M,"data-testid","context-content-textarea"),a(D,"class","control"),a(k,"class","field"),a(J,"class","button is-primary is-small"),J.disabled=ce=l[12]||!l[9].trim()||!l[10].trim(),a(J,"data-testid","add-context-submit-button"),a(Y,"class","control"),a(V,"class","icon is-small"),a(ne,"class","button is-light is-small"),ne.disabled=l[12],a(re,"class","control"),a(W,"class","field is-grouped"),a(e,"class","box has-background-light mb-4"),a(e,"data-testid","add-context-form")},m(te,P){T(te,e,P),s(e,t),s(t,n),s(t,o),s(t,c),s(c,r),s(r,u),s(u,i),s(u,d),s(u,p),s(u,m),qe(u,l[11],!0),s(e,_),s(e,h),s(h,w),s(h,v),s(h,y),s(y,b),Oe(b,l[9]),s(e,C),s(e,k),s(k,S),s(k,z),s(k,D),s(D,M),Oe(M,l[10]),s(e,R),s(e,W),s(W,Y),s(Y,J),Z.m(J,null),s(J,A),s(J,E),s(W,q),s(W,re),s(re,ne),s(ne,V),s(ne,oe),s(ne,I),U||(O=[X(u,"change",l[26]),X(b,"input",l[27]),X(M,"input",l[28]),X(J,"click",l[18]),X(ne,"click",l[17])],U=!0)},p(te,P){P[0]&2048&&qe(u,te[11]),P[0]&512&&b.value!==te[9]&&Oe(b,te[9]),P[0]&1024&&Oe(M,te[10]),B!==(B=L(te))&&(Z.d(1),Z=B(te),Z&&(Z.c(),Z.m(J,A))),P[0]&5632&&ce!==(ce=te[12]||!te[9].trim()||!te[10].trim())&&(J.disabled=ce),P[0]&4096&&(ne.disabled=te[12])},d(te){te&&$(e),Z.d(),U=!1,xe(O)}}}function Ra(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-save"></i>',a(e,"class","icon is-small")},m(t,n){T(t,e,n)},d(t){t&&$(e)}}}function Ea(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-spinner fa-spin"></i>',a(e,"class","icon is-small")},m(t,n){T(t,e,n)},d(t){t&&$(e)}}}function La(l){let e,t=l[6],n=[];for(let o=0;o<t.length;o+=1)n[o]=_s(ss(l,t,o));return{c(){e=f("div");for(let o=0;o<n.length;o+=1)n[o].c();a(e,"class","context-items svelte-rbq0zi"),a(e,"data-testid","conversation-context")},m(o,c){T(o,e,c);for(let r=0;r<n.length;r+=1)n[r]&&n[r].m(e,null)},p(o,c){if(c[0]&1572928){t=o[6];let r;for(r=0;r<t.length;r+=1){const u=ss(o,t,r);n[r]?n[r].p(u,c):(n[r]=_s(u),n[r].c(),n[r].m(e,null))}for(;r<n.length;r+=1)n[r].d(1);n.length=t.length}},d(o){o&&$(e),Xe(n,o)}}}function Aa(l){let e;return{c(){e=f("div"),e.innerHTML=`<span class="icon is-large"><i class="fas fa-inbox fa-2x"></i></span> 
              <p class="is-size-6">No context items yet</p> 
              <p class="is-size-7">Add documents from search results to provide context for your chat.</p>`,a(e,"class","has-text-centered has-text-grey-light"),a(e,"data-testid","empty-context-message")},m(t,n){T(t,e,n)},p:De,d(t){t&&$(e)}}}function ps(l){let e,t=l[40].relevance_score.toFixed(1)+"",n;return{c(){e=f("span"),n=K(t),a(e,"class","tag is-light is-small")},m(o,c){T(o,e,c),s(e,n)},p(o,c){c[0]&64&&t!==(t=o[40].relevance_score.toFixed(1)+"")&&we(n,t)},d(o){o&&$(e)}}}function Oa(l){let e,t=l[40].content.substring(0,150)+"",n,o=l[40].content.length>150?"...":"",c;return{c(){e=f("p"),n=K(t),c=K(o),a(e,"class","context-preview svelte-rbq0zi"),a(e,"data-testid",`context-content-${l[42]}`)},m(r,u){T(r,e,u),s(e,n),s(e,c)},p(r,u){u[0]&64&&t!==(t=r[40].content.substring(0,150)+"")&&we(n,t),u[0]&64&&o!==(o=r[40].content.length>150?"...":"")&&we(c,o)},d(r){r&&$(e)}}}function Na(l){let e,t=l[40].summary+"",n;return{c(){e=f("p"),n=K(t),a(e,"class","context-summary svelte-rbq0zi"),a(e,"data-testid",`context-summary-${l[42]}`)},m(o,c){T(o,e,c),s(e,n)},p(o,c){c[0]&64&&t!==(t=o[40].summary+"")&&we(n,t)},d(o){o&&$(e)}}}function ms(l){let e;return{c(){e=f("hr"),a(e,"class","context-divider svelte-rbq0zi")},m(t,n){T(t,e,n)},d(t){t&&$(e)}}}function _s(l){let e,t,n,o,c,r=l[40].context_type.replace(/([A-Z])/g," $1").trim()+"",u,i,d,p,m,_,h,w,v,y,b,C,k,S,z,D=l[40].title+"",M,R,W,Y,J,A,E=new Date(l[40].created_at).toLocaleString()+"",ce,q,re,ne,V,oe,I,U=l[40].relevance_score&&ps(l);function O(){return l[29](l[40])}function L(){return l[30](l[40])}function B(N,F){return N[40].summary?Na:Oa}let Z=B(l),te=Z(l),P=l[42]<l[6].length-1&&ms();return{c(){e=f("div"),t=f("div"),n=f("div"),o=f("div"),c=f("span"),u=K(r),d=g(),p=f("div"),m=f("div"),U&&U.c(),_=g(),h=f("div"),w=f("div"),v=f("div"),y=f("button"),y.innerHTML='<span class="icon is-small"><i class="fas fa-edit"></i></span>',b=g(),C=f("div"),k=f("button"),k.innerHTML='<span class="icon is-small"><i class="fas fa-trash"></i></span>',S=g(),z=f("h6"),M=K(D),R=g(),W=f("div"),te.c(),Y=g(),J=f("div"),A=K("Added: "),ce=K(E),ne=g(),P&&P.c(),V=rt(),a(c,"class",i="tag is-small "+(l[40].context_type==="Document"?"is-info":l[40].context_type==="SearchResult"?"is-primary":l[40].context_type==="UserInput"?"is-warning":"is-light")),a(c,"data-testid",`context-type-${l[42]}`),a(o,"class","level-item"),a(n,"class","level-left"),a(m,"class","level-item"),a(y,"class","button is-small is-light"),a(y,"data-testid",`edit-context-${l[42]}`),a(y,"title","Edit context"),a(v,"class","control"),a(k,"class","button is-small is-light is-danger"),a(k,"data-testid",`delete-context-${l[42]}`),a(k,"title","Delete context"),a(C,"class","control"),a(w,"class","field is-grouped"),a(h,"class","level-item context-actions svelte-rbq0zi"),a(p,"class","level-right"),a(t,"class","level is-mobile"),a(z,"class","title is-6 has-text-dark"),a(z,"data-testid",`context-title-${l[42]}`),a(W,"class","content is-small"),a(J,"class","is-size-7 has-text-grey"),a(e,"class","context-item svelte-rbq0zi"),a(e,"data-context-id",q=l[40].id),a(e,"data-testid",`context-item-${l[42]}`),a(e,"data-context-type",re=l[40].context_type)},m(N,F){T(N,e,F),s(e,t),s(t,n),s(n,o),s(o,c),s(c,u),s(t,d),s(t,p),s(p,m),U&&U.m(m,null),s(p,_),s(p,h),s(h,w),s(w,v),s(v,y),s(w,b),s(w,C),s(C,k),s(e,S),s(e,z),s(z,M),s(e,R),s(e,W),te.m(W,null),s(e,Y),s(e,J),s(J,A),s(J,ce),T(N,ne,F),P&&P.m(N,F),T(N,V,F),oe||(I=[X(y,"click",O),X(k,"click",L)],oe=!0)},p(N,F){l=N,F[0]&64&&r!==(r=l[40].context_type.replace(/([A-Z])/g," $1").trim()+"")&&we(u,r),F[0]&64&&i!==(i="tag is-small "+(l[40].context_type==="Document"?"is-info":l[40].context_type==="SearchResult"?"is-primary":l[40].context_type==="UserInput"?"is-warning":"is-light"))&&a(c,"class",i),l[40].relevance_score?U?U.p(l,F):(U=ps(l),U.c(),U.m(m,null)):U&&(U.d(1),U=null),F[0]&64&&D!==(D=l[40].title+"")&&we(M,D),Z===(Z=B(l))&&te?te.p(l,F):(te.d(1),te=Z(l),te&&(te.c(),te.m(W,null))),F[0]&64&&E!==(E=new Date(l[40].created_at).toLocaleString()+"")&&we(ce,E),F[0]&64&&q!==(q=l[40].id)&&a(e,"data-context-id",q),F[0]&64&&re!==(re=l[40].context_type)&&a(e,"data-context-type",re),l[42]<l[6].length-1?P||(P=ms(),P.c(),P.m(V.parentNode,V)):P&&(P.d(1),P=null)},d(N){N&&$(e),U&&U.d(),te.d(),N&&$(ne),P&&P.d(N),N&&$(V),oe=!1,xe(I)}}}function Pa(l){let e,t,n,o,c,r,u,i,d,p,m,_,h,w,v,y,b,C,k,S,z,D,M,R,W,Y,J,A,E,ce,q,re,ne,V,oe,I,U,O,L,B,Z,te,P,N,F,ae=l[6].length+"",le,ee,me,_e,fe,de,pe,he,Se,Ge;e=new cl({props:{fallbackPath:"/"}});let je=l[5]&&is(l),Le=l[0],Re=[];for(let ue=0;ue<Le.length;ue+=1)Re[ue]=as(rs(l,Le,ue));let se=l[2]&&cs(),ye=l[4]&&us(l),Ne=l[3]&&fs(l);function Be(ue,Ae){return ue[7]?Sa:Ta}let Ke=Be(l),$e=Ke(l),Pe=l[8]&&ds(l);function et(ue,Ae){return ue[6].length===0?Aa:La}let Je=et(l),Me=Je(l);function He(ue){l[31](ue)}let tt={context:l[14],mode:l[15]};return l[13]!==void 0&&(tt.active=l[13]),de=new $a({props:tt}),st.push(()=>at(de,"active",He)),de.$on("update",l[32]),de.$on("delete",l[33]),de.$on("close",l[34]),{c(){ge(e.$$.fragment),t=g(),n=f("section"),o=f("div"),c=f("div"),r=f("div"),u=f("h2"),u.textContent="Chat",i=g(),d=f("p"),d.textContent=`Role: ${St(Et)}`,p=g(),je&&je.c(),m=g(),_=f("div");for(let ue=0;ue<Re.length;ue+=1)Re[ue].c();h=g(),se&&se.c(),w=g(),ye&&ye.c(),v=g(),Ne&&Ne.c(),y=g(),b=f("div"),C=f("div"),k=f("textarea"),S=g(),z=f("div"),D=f("button"),M=f("span"),M.innerHTML='<i class="fas fa-paper-plane"></i>',W=g(),Y=f("div"),J=f("div"),A=f("div"),E=f("div"),ce=f("div"),q=f("h4"),q.textContent="Context",re=g(),ne=f("button"),ne.innerHTML=`<span class="icon is-small"><i class="fas fa-plus"></i></span> 
                  <span>Add Context</span>`,V=g(),oe=f("div"),I=f("div"),U=f("button"),$e.c(),O=g(),Pe&&Pe.c(),L=g(),Me.c(),B=g(),Z=f("div"),te=f("div"),P=f("div"),N=f("div"),F=f("span"),le=K(ae),ee=K(" context items"),me=g(),_e=f("div"),_e.innerHTML='<div class="level-item"><span class="is-size-7 has-text-grey">Context is automatically included in your chat</span></div>',fe=g(),ge(de.$$.fragment),a(u,"class","title is-4"),a(d,"class","subtitle is-6"),a(_,"class","chat-window svelte-rbq0zi"),a(_,"data-testid","chat-messages"),a(k,"class","textarea"),a(k,"rows","3"),a(k,"placeholder","Type your message and press Enter..."),a(k,"data-testid","chat-input"),a(C,"class","control is-expanded"),a(M,"class","icon"),a(D,"class","button is-primary"),D.disabled=R=l[2]||!l[1].trim(),a(D,"data-testid","send-message-button"),a(z,"class","control"),a(b,"class","field has-addons chat-input svelte-rbq0zi"),a(r,"class","column is-8"),a(q,"class","title is-5"),a(ne,"class","button is-small is-primary"),a(ne,"data-testid","show-add-context-button"),a(ce,"class","level-item"),a(E,"class","level-left"),a(U,"class","button is-small is-light"),U.disabled=l[7],a(U,"data-testid","refresh-context-button"),a(I,"class","level-item"),a(oe,"class","level-right"),a(A,"class","level is-mobile"),a(F,"class","tag is-light is-small"),a(F,"data-testid","context-summary"),a(N,"class","level-item"),a(P,"class","level-left"),a(_e,"class","level-right"),a(te,"class","level is-mobile"),a(Z,"class","mt-4"),a(J,"class","box context-panel svelte-rbq0zi"),a(J,"data-testid","context-panel"),a(Y,"class","column is-4"),a(c,"class","columns svelte-rbq0zi"),a(o,"class","container"),a(n,"class","section"),a(n,"data-testid","chat-interface")},m(ue,Ae){ve(e,ue,Ae),T(ue,t,Ae),T(ue,n,Ae),s(n,o),s(o,c),s(c,r),s(r,u),s(r,i),s(r,d),s(r,p),je&&je.m(r,null),s(r,m),s(r,_);for(let j=0;j<Re.length;j+=1)Re[j]&&Re[j].m(_,null);s(_,h),se&&se.m(_,null),s(r,w),ye&&ye.m(r,null),s(r,v),Ne&&Ne.m(r,null),s(r,y),s(r,b),s(b,C),s(C,k),Oe(k,l[1]),s(b,S),s(b,z),s(z,D),s(D,M),s(c,W),s(c,Y),s(Y,J),s(J,A),s(A,E),s(E,ce),s(ce,q),s(ce,re),s(ce,ne),s(A,V),s(A,oe),s(oe,I),s(I,U),$e.m(U,null),s(J,O),Pe&&Pe.m(J,null),s(J,L),Me.m(J,null),s(J,B),s(J,Z),s(Z,te),s(te,P),s(P,N),s(N,F),s(F,le),s(F,ee),s(te,me),s(te,_e),T(ue,fe,Ae),ve(de,ue,Ae),he=!0,Se||(Ge=[X(k,"input",l[25]),X(k,"keydown",l[24]),X(D,"click",l[23]),X(ne,"click",l[17]),X(U,"click",l[16])],Se=!0)},p(ue,Ae){if(ue[5]?je?je.p(ue,Ae):(je=is(ue),je.c(),je.m(r,m)):je&&(je.d(1),je=null),Ae[0]&1){Le=ue[0];let G;for(G=0;G<Le.length;G+=1){const H=rs(ue,Le,G);Re[G]?Re[G].p(H,Ae):(Re[G]=as(H),Re[G].c(),Re[G].m(_,h))}for(;G<Re.length;G+=1)Re[G].d(1);Re.length=Le.length}ue[2]?se||(se=cs(),se.c(),se.m(_,null)):se&&(se.d(1),se=null),ue[4]?ye?ye.p(ue,Ae):(ye=us(ue),ye.c(),ye.m(r,v)):ye&&(ye.d(1),ye=null),ue[3]?Ne?Ne.p(ue,Ae):(Ne=fs(ue),Ne.c(),Ne.m(r,y)):Ne&&(Ne.d(1),Ne=null),Ae[0]&2&&Oe(k,ue[1]),(!he||Ae[0]&6&&R!==(R=ue[2]||!ue[1].trim()))&&(D.disabled=R),Ke!==(Ke=Be(ue))&&($e.d(1),$e=Ke(ue),$e&&($e.c(),$e.m(U,null))),(!he||Ae[0]&128)&&(U.disabled=ue[7]),ue[8]?Pe?Pe.p(ue,Ae):(Pe=ds(ue),Pe.c(),Pe.m(J,L)):Pe&&(Pe.d(1),Pe=null),Je===(Je=et(ue))&&Me?Me.p(ue,Ae):(Me.d(1),Me=Je(ue),Me&&(Me.c(),Me.m(J,B))),(!he||Ae[0]&64)&&ae!==(ae=ue[6].length+"")&&we(le,ae);const j={};Ae[0]&16384&&(j.context=ue[14]),Ae[0]&32768&&(j.mode=ue[15]),!pe&&Ae[0]&8192&&(pe=!0,j.active=ue[13],ct(()=>pe=!1)),de.$set(j)},i(ue){he||(Q(e.$$.fragment,ue),Q(de.$$.fragment,ue),he=!0)},o(ue){x(e.$$.fragment,ue),x(de.$$.fragment,ue),he=!1},d(ue){be(e,ue),ue&&$(t),ue&&$(n),je&&je.d(),Xe(Re,ue),se&&se.d(),ye&&ye.d(),Ne&&Ne.d(),$e.d(),Pe&&Pe.d(),Me.d(),ue&&$(fe),be(de,ue),Se=!1,xe(Ge)}}}function Da(l,e,t){let n;Ue(l,ot,P=>t(36,n=P));let o=[],c="",r=!1,u=null,i=null,d=null,p=[],m=!1,_=!1,h="",w="",v="document",y=!1,b=!1,C=null,k="edit",S=null;function z(P){t(0,o=[...o,{role:"user",content:P}])}async function D(){try{if(n){const P=await Fe("list_conversations");P!=null&&P.conversations&&P.conversations.length>0?(t(5,d=P.conversations[0].id),console.log("🎯 Using existing conversation:",d),await R()):await M()}else{const P=await fetch(`${Ze.ServerURL}/conversations`);if(P.ok){const N=await P.json();N.conversations&&N.conversations.length>0?(t(5,d=N.conversations[0].id),console.log("🎯 Using existing conversation:",d),await R()):await M()}else await M()}}catch(P){console.error("❌ Error initializing conversation:",P)}}async function M(){try{const P=St(Et);if(n){const N=await Fe("create_conversation",{title:"Chat Conversation",role:P});N.status==="success"&&N.conversation_id&&(t(5,d=N.conversation_id),console.log("🆕 Created new conversation:",d))}else{const N=await fetch(`${Ze.ServerURL}/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"Chat Conversation",role:P})});if(N.ok){const F=await N.json();F.status==="Success"&&F.conversation_id&&(t(5,d=F.conversation_id),console.log("🆕 Created new conversation:",d))}}}catch(P){console.error("❌ Error creating conversation:",P)}}async function R(){if(!d){console.warn("⚠️ Cannot load context: no conversation ID available");return}t(7,m=!0),console.log("🔄 Loading conversation context for:",d);try{if(n){console.log("📱 Loading context via Tauri...");const P=await Fe("get_conversation",{conversationId:d});if(console.log("📥 Tauri response:",P),P.status==="success"&&P.conversation){const N=P.conversation.global_context||[];t(6,p=N),console.log(`✅ Loaded ${N.length} context items via Tauri`)}else console.error("❌ Failed to get conversation via Tauri:",P.error||"Unknown error"),t(6,p=[])}else{console.log("🌐 Loading context via HTTP...");const P=await fetch(`${Ze.ServerURL}/conversations/${d}`);if(console.log("📥 HTTP response status:",P.status,P.statusText),P.ok){const N=await P.json();if(console.log("📄 HTTP response data:",N),N.status==="success"&&N.conversation){const F=N.conversation.global_context||[];t(6,p=F),console.log(`✅ Loaded ${F.length} context items via HTTP`)}else console.error("❌ Failed to get conversation via HTTP:",N.error||"Unknown error"),t(6,p=[])}else console.error("❌ HTTP request failed:",P.status,P.statusText),t(6,p=[])}}catch(P){console.error("❌ Error loading conversation context:",{error:P.message||P,conversationId:d,isTauri:n,timestamp:new Date().toISOString()}),t(6,p=[])}finally{t(7,m=!1),console.log("🏁 Context loading completed. Items count:",p.length)}}function W(){t(8,_=!_),_||(t(9,h=""),t(10,w=""),t(11,v="document"))}async function Y(){if(!(!d||!h.trim()||!w.trim())){t(12,y=!0);try{const P={title:h.trim(),summary:null,content:w.trim(),context_type:v};if(n){const N=await Fe("add_context_to_conversation",{conversationId:d,contextData:P});N.status==="success"?(await R(),W(),console.log("✅ Context added successfully via Tauri")):console.error("❌ Failed to add context via Tauri:",N.error)}else{const N=await fetch(`${Ze.ServerURL}/conversations/${d}/context`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(P)});if(N.ok){const F=await N.json();F.status==="success"?(await R(),W(),console.log("✅ Context added successfully via HTTP")):console.error("❌ Failed to add context via HTTP:",F.error)}else console.error("❌ HTTP request failed:",N.status,N.statusText)}}catch(P){console.error("❌ Error adding manual context:",P)}finally{t(12,y=!1)}}}function J(P){t(14,C=P),t(15,k="edit"),t(13,b=!0)}function A(P){confirm(`Are you sure you want to delete "${P.title}"?`)&&E(P.id)}async function E(P){if(!(!d||S)){S=P,console.log("🗑️ Deleting context:",P);try{if(n){const N=await Fe("delete_context",{conversationId:d,contextId:P});(N==null?void 0:N.status)==="success"?(console.log("✅ Context deleted successfully via Tauri"),await R()):console.error("❌ Failed to delete context via Tauri:",N==null?void 0:N.error)}else{const N=await fetch(`${Ze.ServerURL}/conversations/${d}/context/${P}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(N.ok){const F=await N.json();F.status==="Success"?(console.log("✅ Context deleted successfully via HTTP"),await R()):console.error("❌ Failed to delete context via HTTP:",F.error)}else console.error("❌ HTTP delete request failed:",N.status)}}catch(N){console.error("❌ Error deleting context:",N)}finally{S=null}}}async function ce(P){if(d){console.log("📝 Updating context:",P.id);try{const N={context_type:P.context_type,title:P.title,summary:P.summary,content:P.content,metadata:P.metadata};if(n){const F=await Fe("update_context",{conversationId:d,contextId:P.id,request:N});(F==null?void 0:F.status)==="success"?(console.log("✅ Context updated successfully via Tauri"),await R()):console.error("❌ Failed to update context via Tauri:",F==null?void 0:F.error)}else{const F=await fetch(`${Ze.ServerURL}/conversations/${d}/context/${P.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(N)});if(F.ok){const ae=await F.json();ae.status==="Success"?(console.log("✅ Context updated successfully via HTTP"),await R()):console.error("❌ Failed to update context via HTTP:",ae.error)}else console.error("❌ HTTP update request failed:",F.status)}}catch(N){console.error("❌ Error updating context:",N)}}}async function q(){var F;if(!c.trim()||r)return;t(3,u=null);const P=St(Et),N=c.trim();t(1,c=""),d||await D(),z(N),t(2,r=!0);try{const ae={role:P,messages:o};d&&(ae.conversation_id=d);const le=await fetch(`${Ze.ServerURL}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ae)});if(!le.ok)throw new Error(`HTTP ${le.status}`);const ee=await le.json();t(4,i=ee.model_used??null),((F=ee.status)==null?void 0:F.toLowerCase())==="success"&&ee.message?t(0,o=[...o,{role:"assistant",content:ee.message}]):t(3,u=ee.error||"Chat failed")}catch(ae){t(3,u=(ae==null?void 0:ae.message)||String(ae))}finally{t(2,r=!1)}}function re(P){(P.key==="Enter"||P.key==="Return")&&!P.shiftKey&&(P.preventDefault(),q())}Qt(()=>{if(t(0,o=[{role:"assistant",content:"Hi! How can I help you? Ask me anything about your search results or documents."}]),D(),typeof window<"u"){const P=()=>{d&&R()};return window.addEventListener("focus",P),()=>{window.removeEventListener("focus",P)}}});function ne(){c=this.value,t(1,c)}function V(){v=Tt(this),t(11,v)}function oe(){h=this.value,t(9,h)}function I(){w=this.value,t(10,w)}const U=P=>J(P),O=P=>A(P);function L(P){b=P,t(13,b)}return[o,c,r,u,i,d,p,m,_,h,w,v,y,b,C,k,R,W,Y,J,A,E,ce,q,re,ne,V,oe,I,U,O,L,P=>ce(P.detail),P=>E(P.detail),()=>{t(13,b=!1),t(14,C=null)}]}class Ma extends _t{constructor(e){super(),ht(this,e,Da,Pa,ft,{},null,[-1,-1])}}function Ia(l){let e,t;return e=new Zi({}),{c(){ge(e.$$.fragment)},m(n,o){ve(e,n,o),t=!0},i(n){t||(Q(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){be(e,n)}}}function Ua(l){let e,t;return e=new Ma({}),{c(){ge(e.$$.fragment)},m(n,o){ve(e,n,o),t=!0},i(n){t||(Q(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){be(e,n)}}}function ja(l){let e,t;return e=new ha({}),{c(){ge(e.$$.fragment)},m(n,o){ve(e,n,o),t=!0},i(n){t||(Q(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){be(e,n)}}}function Ha(l){let e,t;return e=new Ur({}),{c(){ge(e.$$.fragment)},m(n,o){ve(e,n,o),t=!0},i(n){t||(Q(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){be(e,n)}}}function za(l){let e,t;return e=new aa({}),{c(){ge(e.$$.fragment)},m(n,o){ve(e,n,o),t=!0},i(n){t||(Q(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){be(e,n)}}}function Fa(l){let e,t;return e=new fa({}),{c(){ge(e.$$.fragment)},m(n,o){ve(e,n,o),t=!0},i(n){t||(Q(e.$$.fragment,n),t=!0)},o(n){x(e.$$.fragment,n),t=!1},d(n){be(e,n)}}}function qa(l){let e;return{c(){e=f("nav"),e.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
            <a class="navbar-item" href="/config/wizard">Wizard</a> 
            <a class="navbar-item" href="/config/json">JSON Editor</a> 
            <a class="navbar-item" href="/graph">Graph</a> 
            <a class="navbar-item" href="/chat">Chat</a></div>`,a(e,"class","navbar")},m(t,n){T(t,e,n)},p:De,d(t){t&&$(e)}}}function Ka(l){let e,t,n,o,c,r,u,i,d,p,m,_,h,w,v,y,b,C,k,S,z,D,M,R,W,Y,J,A,E,ce,q,re,ne,V,oe,I,U,O,L,B,Z,te;return k=new Ol({}),D=new Nt({props:{path:"/",$$slots:{default:[Ia]},$$scope:{ctx:l}}}),R=new Nt({props:{path:"/chat",$$slots:{default:[Ua]},$$scope:{ctx:l}}}),Y=new Nt({props:{path:"/graph",$$slots:{default:[ja]},$$scope:{ctx:l}}}),ce=new Nt({props:{path:"/fetch/*",$$slots:{default:[Ha]},$$scope:{ctx:l}}}),re=new Nt({props:{path:"/config/wizard",$$slots:{default:[za]},$$scope:{ctx:l}}}),V=new Nt({props:{path:"/config/json",$$slots:{default:[Fa]},$$scope:{ctx:l}}}),O=new Nt({props:{path:"/",$$slots:{default:[qa]},$$scope:{ctx:l}}}),{c(){e=f("meta"),t=g(),n=f("div"),o=f("main"),c=f("div"),r=f("div"),u=f("div"),i=f("ul"),d=f("li"),p=f("a"),p.innerHTML=`<span class="icon is-small"><i class="fas fa-search"></i></span> 
                <span>Search</span>`,m=g(),_=f("li"),h=f("a"),h.innerHTML=`<span class="icon is-small"><i class="fas fa-comments"></i></span> 
                <span>Chat</span>`,w=g(),v=f("li"),y=f("a"),y.innerHTML=`<span class="icon is-small"><i class="fas fa-project-diagram"></i></span> 
                <span>Graph</span>`,b=g(),C=f("div"),ge(k.$$.fragment),S=g(),z=f("div"),ge(D.$$.fragment),M=g(),ge(R.$$.fragment),W=g(),ge(Y.$$.fragment),J=g(),A=f("br"),E=g(),ge(ce.$$.fragment),q=g(),ge(re.$$.fragment),ne=g(),ge(V.$$.fragment),oe=g(),I=f("footer"),U=f("div"),ge(O.$$.fragment),a(e,"name","color-scheme"),a(e,"content",l[1]),document.title="Terraphim",a(p,"href","/"),a(p,"data-exact",""),a(p,"data-testid","search-tab"),a(d,"class","svelte-1nmgbjk"),a(h,"href","/chat"),a(h,"data-testid","chat-tab"),a(_,"class","svelte-1nmgbjk"),a(y,"href","/graph"),a(y,"data-testid","graph-tab"),a(v,"class","svelte-1nmgbjk"),a(u,"class","tabs is-boxed svelte-1nmgbjk"),a(r,"class","main-navigation svelte-1nmgbjk"),a(C,"class","role-selector svelte-1nmgbjk"),a(c,"class","top-controls svelte-1nmgbjk"),a(z,"class","main-area svelte-1nmgbjk"),a(o,"class","main-content svelte-1nmgbjk"),a(U,"class",L=Dt(l[0])+" svelte-1nmgbjk"),a(I,"class","svelte-1nmgbjk"),a(n,"class","is-full-height svelte-1nmgbjk")},m(P,N){s(document.head,e),T(P,t,N),T(P,n,N),s(n,o),s(o,c),s(c,r),s(r,u),s(u,i),s(i,d),s(d,p),s(i,m),s(i,_),s(_,h),s(i,w),s(i,v),s(v,y),s(c,b),s(c,C),ve(k,C,null),s(o,S),s(o,z),ve(D,z,null),s(z,M),ve(R,z,null),s(z,W),ve(Y,z,null),s(o,J),s(o,A),s(o,E),ve(ce,o,null),s(o,q),ve(re,o,null),s(o,ne),ve(V,o,null),s(n,oe),s(n,I),s(I,U),ve(O,U,null),B=!0,Z||(te=[jl(Hl.call(null,p)),jl(Hl.call(null,h)),jl(Hl.call(null,y)),X(I,"mouseover",l[2]),X(I,"focus",l[2])],Z=!0)},p(P,[N]){(!B||N&2)&&a(e,"content",P[1]);const F={};N&16&&(F.$$scope={dirty:N,ctx:P}),D.$set(F);const ae={};N&16&&(ae.$$scope={dirty:N,ctx:P}),R.$set(ae);const le={};N&16&&(le.$$scope={dirty:N,ctx:P}),Y.$set(le);const ee={};N&16&&(ee.$$scope={dirty:N,ctx:P}),ce.$set(ee);const me={};N&16&&(me.$$scope={dirty:N,ctx:P}),re.$set(me);const _e={};N&16&&(_e.$$scope={dirty:N,ctx:P}),V.$set(_e);const fe={};N&16&&(fe.$$scope={dirty:N,ctx:P}),O.$set(fe),(!B||N&1&&L!==(L=Dt(P[0])+" svelte-1nmgbjk"))&&a(U,"class",L)},i(P){B||(Q(k.$$.fragment,P),Q(D.$$.fragment,P),Q(R.$$.fragment,P),Q(Y.$$.fragment,P),Q(ce.$$.fragment,P),Q(re.$$.fragment,P),Q(V.$$.fragment,P),Q(O.$$.fragment,P),B=!0)},o(P){x(k.$$.fragment,P),x(D.$$.fragment,P),x(R.$$.fragment,P),x(Y.$$.fragment,P),x(ce.$$.fragment,P),x(re.$$.fragment,P),x(V.$$.fragment,P),x(O.$$.fragment,P),B=!1},d(P){$(e),P&&$(t),P&&$(n),be(k),be(D),be(R),be(Y),be(ce),be(re),be(V),be(O),Z=!1,xe(te)}}}function Wa(l,e,t){let n;Ue(l,_l,r=>t(1,n=r));let o="is-hidden";function c(){t(0,o="")}return[o,n,c]}class Ga extends _t{constructor(e){super(),ht(this,e,Wa,Ka,ft,{})}}const Ba=new er;tr(Ba);new Ga({target:document.getElementById("app")});
