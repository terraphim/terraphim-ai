var Ms=Object.defineProperty;var Is=(l,e,t)=>e in l?Ms(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var Ct=(l,e,t)=>(Is(l,typeof e!="symbol"?e+"":e,t),t);import{aa as At,S as dt,i as pt,s as ut,q as f,Y as q,b as $,y as s,Z as we,I as Pe,j as S,ak as Ue,F as rt,m as Qt,a as h,v as i,l as ne,E as Qe,au as zt,r as ve,z as be,t as X,d as re,B as ke,av as Us,aw as Yt,H as st,U as at,V as ct,ax as Pl,ay as js,g as Ze,e as Xe,O as xe,af as $t,o as Hs,W as ge,az as Nl,aA as St,aB as hs,aC as gs,a1 as Oe,C as it,aD as Ke,aE as vs,D as il,G as al,aF as bs,w as Dt,x as ft,A as Dl,a5 as Fs,a2 as zs,aG as Ft,ac as Ks,a7 as qs,a9 as Gs,n as Ws,k as Bs,_ as Ul}from"./vendor-ui-cd3d2b6a.js";import{R as Ot,S as Ml,f as Js,Y as jl}from"./vendor-utils-740e9743.js";import{J as ks,_ as Vs,d as ws,P as Qs,k as Ys,D as Zs,l as Xs,E as xs,o as _n}from"./vendor-editor-992829d3.js";import{P as ys,T as Ol,u as Cs,y as er,A as tr,S as lr,q as nr}from"./vendor-atomic-1ea13e29.js";import{t as or,E as sr}from"./novel-editor-becefd2f.js";import{s as Hl,z as rr,a as ir,l as ar,m as cr,c as ur,b as fr,B as dr,d as pr}from"./vendor-charts-e6a4a6c9.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const r of c.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function t(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(o){if(o.ep)return;o.ep=!0;const c=t(o);fetch(o.href,c)}})();const Ye={ServerURL:location.protocol+"//"+window.location.host||"/"},ml=At([]),mr={id:"Desktop",global_shortcut:"",roles:{},default_role:{original:"",lowercase:""},selected_role:{original:"",lowercase:""}},_l=At("spacelab"),Et=At("selected"),ot=At(!1),_r=At(`${Ye.ServerURL}/documents/search`),Lt=At(mr),hn=At([]);let Jt=At("");const Tt=At(!1);let Vt=null;function hr(l){if(typeof document>"u")return;const e=`/assets/bulmaswatch/${l}/bulmaswatch.min.css`;if(Vt!=null&&Vt.href.endsWith(e))return;const t=document.createElement("link");t.rel="stylesheet",t.href=e,t.id="bulma-theme",t.onload=()=>{Vt&&Vt!==t&&Vt.remove(),Vt=t},document.head.appendChild(t);const n=document.head.querySelector('meta[name="color-scheme"]');n&&n.setAttribute("content",l)}_l.subscribe(hr);function gr(l){let e,t;return{c(){e=f("option"),t=q(l[1]),e.__value=l[0],e.value=e.__value},m(n,o){$(n,e,o),s(e,t)},p(n,[o]){o&2&&we(t,n[1]),o&1&&(e.__value=n[0],e.value=e.__value)},i:Pe,o:Pe,d(n){n&&S(e)}}}function vr(l,e,t){let n,{subject:o}=e;const c=ys(o),r=Ol(c,Cs.properties.name);return Ue(l,r,u=>t(1,n=u)),Ol(c,"http://localhost:9883/property/theme"),l.$$set=u=>{"subject"in u&&t(0,o=u.subject)},[o,n,r]}class br extends dt{constructor(e){super(),pt(this,e,vr,gr,ut,{subject:0})}}function gn(l){let e,t,n,o,c,r,u=l[0]&&vn();return{c(){e=f("button"),t=f("span"),t.innerHTML='<i class="fas fa-arrow-left"></i>',n=h(),u&&u.c(),i(t,"class","icon svelte-rnsqpo"),i(e,"class",o="button is-light back-button "+l[1]+" svelte-rnsqpo"),i(e,"title","Go back"),i(e,"aria-label","Go back")},m(a,d){$(a,e,d),s(e,t),s(e,n),u&&u.m(e,null),c||(r=[ne(e,"click",l[3]),ne(e,"keydown",l[6])],c=!0)},p(a,d){a[0]?u||(u=vn(),u.c(),u.m(e,null)):u&&(u.d(1),u=null),d&2&&o!==(o="button is-light back-button "+a[1]+" svelte-rnsqpo")&&i(e,"class",o)},d(a){a&&S(e),u&&u.d(),c=!1,Qe(r)}}}function vn(l){let e;return{c(){e=f("span"),e.textContent="Back",i(e,"class","back-text svelte-rnsqpo")},m(t,n){$(t,e,n)},d(t){t&&S(e)}}}function kr(l){let e,t=l[2]&&gn(l);return{c(){t&&t.c(),e=rt()},m(n,o){t&&t.m(n,o),$(n,e,o)},p(n,[o]){n[2]?t?t.p(n,o):(t=gn(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Pe,o:Pe,d(n){t&&t.d(n),n&&S(e)}}}function wr(l,e,t){let{fallbackPath:n="/"}=e,{showText:o=!0}=e,{customClass:c=""}=e,{hideOnPaths:r=["/"]}=e,u=!0;function a(){var p;try{const _=((p=window.location)==null?void 0:p.pathname)||"/";t(2,u=!r.includes(_))}catch{t(2,u=!0)}}function d(){window.history.length>1?window.history.back():window.location.href=n}Qt(()=>(a(),window.addEventListener("popstate",a),window.addEventListener("hashchange",a),()=>{window.removeEventListener("popstate",a),window.removeEventListener("hashchange",a)}));const m=p=>{(p.key==="Enter"||p.key===" ")&&(p.preventDefault(),d())};return l.$$set=p=>{"fallbackPath"in p&&t(4,n=p.fallbackPath),"showText"in p&&t(0,o=p.showText),"customClass"in p&&t(1,c=p.customClass),"hideOnPaths"in p&&t(5,r=p.hideOnPaths)},[o,c,u,d,n,r,m]}class cl extends dt{constructor(e){super(),pt(this,e,wr,kr,ut,{fallbackPath:4,showText:0,customClass:1,hideOnPaths:5})}}function yr(){return window.crypto.getRandomValues(new Uint32Array(1))[0]}function zl(l,e=!1){const t=yr(),n=`_${t}`;return Object.defineProperty(window,n,{value:o=>(e&&Reflect.deleteProperty(window,n),l==null?void 0:l(o)),writable:!1,configurable:!0}),t}async function ze(l,e={}){return new Promise((t,n)=>{const o=zl(r=>{t(r),Reflect.deleteProperty(window,`_${c}`)},!0),c=zl(r=>{n(r),Reflect.deleteProperty(window,`_${o}`)},!0);window.__TAURI_IPC__({cmd:l,callback:o,error:c,...e})})}function bn(l,e,t){const n=l.slice();return n[25]=e[t],n}function Cr(l){let e,t,n;function o(r){l[13](r)}let c={};return l[5]!==void 0&&(c.value=l[5]),e=new Yt({props:c}),st.push(()=>at(e,"value",o)),{c(){ve(e.$$.fragment)},m(r,u){be(e,r,u),n=!0},p(r,u){const a={};!t&&u&32&&(t=!0,a.value=r[5],ct(()=>t=!1)),e.$set(a)},i(r){n||(X(e.$$.fragment,r),n=!0)},o(r){re(e.$$.fragment,r),n=!1},d(r){ke(e,r)}}}function Tr(l){let e,t,n;function o(r){l[14](r)}let c={type:"password",placeholder:"secret",icon:"fas fa-lock",expanded:!0};return l[6]!==void 0&&(c.value=l[6]),e=new Yt({props:c}),st.push(()=>at(e,"value",o)),{c(){ve(e.$$.fragment)},m(r,u){be(e,r,u),n=!0},p(r,u){const a={};!t&&u&64&&(t=!0,a.value=r[6],ct(()=>t=!1)),e.$set(a)},i(r){n||(X(e.$$.fragment,r),n=!0)},o(r){re(e.$$.fragment,r),n=!1},d(r){ke(e,r)}}}function Sr(l){let e;return{c(){e=q("Save")},m(t,n){$(t,e,n)},d(t){t&&S(e)}}}function $r(l){let e,t;return e=new Pl({props:{type:"is-success",class:"is-right",iconPack:"fa",iconLeft:"check",$$slots:{default:[Sr]},$$scope:{ctx:l}}}),e.$on("click",l[8]),e.$on("submit",l[8]),{c(){ve(e.$$.fragment)},m(n,o){be(e,n,o),t=!0},p(n,o){const c={};o&268435456&&(c.$$scope={dirty:o,ctx:n}),e.$set(c)},i(n){t||(X(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){ke(e,n)}}}function Rr(l){let e,t,n,o,c,r;return e=new zt({props:{$$slots:{default:[Cr]},$$scope:{ctx:l}}}),n=new zt({props:{grouped:!0,$$slots:{default:[Tr]},$$scope:{ctx:l}}}),c=new zt({props:{grouped:!0,$$slots:{default:[$r]},$$scope:{ctx:l}}}),{c(){ve(e.$$.fragment),t=h(),ve(n.$$.fragment),o=h(),ve(c.$$.fragment)},m(u,a){be(e,u,a),$(u,t,a),be(n,u,a),$(u,o,a),be(c,u,a),r=!0},p(u,a){const d={};a&268435488&&(d.$$scope={dirty:a,ctx:u}),e.$set(d);const m={};a&268435520&&(m.$$scope={dirty:a,ctx:u}),n.$set(m);const p={};a&268435456&&(p.$$scope={dirty:a,ctx:u}),c.$set(p)},i(u){r||(X(e.$$.fragment,u),X(n.$$.fragment,u),X(c.$$.fragment,u),r=!0)},o(u){re(e.$$.fragment,u),re(n.$$.fragment,u),re(c.$$.fragment,u),r=!1},d(u){ke(e,u),u&&S(t),ke(n,u),u&&S(o),ke(c,u)}}}function Er(l){let e,t,n;function o(r){l[15](r)}let c={type:"search",placeholder:"Fetch JSON",icon:"search"};return l[3]!==void 0&&(c.value=l[3]),e=new Yt({props:c}),st.push(()=>at(e,"value",o)),{c(){ve(e.$$.fragment)},m(r,u){be(e,r,u),n=!0},p(r,u){const a={};!t&&u&8&&(t=!0,a.value=r[3],ct(()=>t=!1)),e.$set(a)},i(r){n||(X(e.$$.fragment,r),n=!0)},o(r){re(e.$$.fragment,r),n=!1},d(r){ke(e,r)}}}function Lr(l){let e;return{c(){e=q("WikiPage")},m(t,n){$(t,e,n)},d(t){t&&S(e)}}}function Ar(l){let e,t,n,o,c,r;function u(p){l[16](p)}let a={type:"search",placeholder:"Post JSON",icon:"search"};l[4]!==void 0&&(a.value=l[4]),e=new Yt({props:a}),st.push(()=>at(e,"value",u));function d(p){l[17](p)}let m={$$slots:{default:[Lr]},$$scope:{ctx:l}};return l[2]!==void 0&&(m.checked=l[2]),o=new js({props:m}),st.push(()=>at(o,"checked",d)),{c(){ve(e.$$.fragment),n=h(),ve(o.$$.fragment)},m(p,_){be(e,p,_),$(p,n,_),be(o,p,_),r=!0},p(p,_){const g={};!t&&_&16&&(t=!0,g.value=p[4],ct(()=>t=!1)),e.$set(g);const y={};_&268435456&&(y.$$scope={dirty:_,ctx:p}),!c&&_&4&&(c=!0,y.checked=p[2],ct(()=>c=!1)),o.$set(y)},i(p){r||(X(e.$$.fragment,p),X(o.$$.fragment,p),r=!0)},o(p){re(e.$$.fragment,p),re(o.$$.fragment,p),r=!1},d(p){ke(e,p),p&&S(n),ke(o,p)}}}function Pr(l){let e;return{c(){e=q("Fetch")},m(t,n){$(t,e,n)},d(t){t&&S(e)}}}function Or(l){let e,t;return e=new Pl({props:{type:"is-primary",$$slots:{default:[Pr]},$$scope:{ctx:l}}}),e.$on("click",l[9]),e.$on("submit",l[9]),{c(){ve(e.$$.fragment)},m(n,o){be(e,n,o),t=!0},p(n,o){const c={};o&268435456&&(c.$$scope={dirty:o,ctx:n}),e.$set(c)},i(n){t||(X(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){ke(e,n)}}}function Nr(l){let e,t,n,o,c,r;return e=new zt({props:{grouped:!0,$$slots:{default:[Er]},$$scope:{ctx:l}}}),n=new zt({props:{grouped:!0,$$slots:{default:[Ar]},$$scope:{ctx:l}}}),c=new zt({props:{grouped:!0,$$slots:{default:[Or]},$$scope:{ctx:l}}}),{c(){ve(e.$$.fragment),t=h(),ve(n.$$.fragment),o=h(),ve(c.$$.fragment)},m(u,a){be(e,u,a),$(u,t,a),be(n,u,a),$(u,o,a),be(c,u,a),r=!0},p(u,a){const d={};a&268435464&&(d.$$scope={dirty:a,ctx:u}),e.$set(d);const m={};a&268435476&&(m.$$scope={dirty:a,ctx:u}),n.$set(m);const p={};a&268435456&&(p.$$scope={dirty:a,ctx:u}),c.$set(p)},i(u){r||(X(e.$$.fragment,u),X(n.$$.fragment,u),X(c.$$.fragment,u),r=!0)},o(u){re(e.$$.fragment,u),re(n.$$.fragment,u),re(c.$$.fragment,u),r=!1},d(u){ke(e,u),u&&S(t),ke(n,u),u&&S(o),ke(c,u)}}}function Dr(l){let e,t,n,o,c;return o=new ks({props:{content:l[1],onChange:l[7]}}),{c(){e=f("p"),e.innerHTML=`<i>The best editing experience is to configure Atomic Server, in the
        meantime use editor below. You will need to refresh page via Command R
        or Ctrl-R to see changes</i>`,t=h(),n=f("div"),ve(o.$$.fragment),i(n,"class","editor")},m(r,u){$(r,e,u),$(r,t,u),$(r,n,u),be(o,n,null),c=!0},p(r,u){const a={};u&2&&(a.content=r[1]),o.$set(a)},i(r){c||(X(o.$$.fragment,r),c=!0)},o(r){re(o.$$.fragment,r),c=!1},d(r){r&&S(e),r&&S(t),r&&S(n),ke(o)}}}function kn(l){let e,t;return e=new br({props:{subject:l[25]}}),{c(){ve(e.$$.fragment)},m(n,o){be(e,n,o),t=!0},p(n,o){const c={};o&1&&(c.subject=n[25]),e.$set(c)},i(n){t||(X(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){ke(e,n)}}}function Mr(l){let e,t,n=l[0]??[],o=[];for(let r=0;r<n.length;r+=1)o[r]=kn(bn(l,n,r));const c=r=>re(o[r],1,1,()=>{o[r]=null});return{c(){for(let r=0;r<o.length;r+=1)o[r].c();e=rt()},m(r,u){for(let a=0;a<o.length;a+=1)o[a]&&o[a].m(r,u);$(r,e,u),t=!0},p(r,u){if(u&1){n=r[0]??[];let a;for(a=0;a<n.length;a+=1){const d=bn(r,n,a);o[a]?(o[a].p(d,u),X(o[a],1)):(o[a]=kn(d),o[a].c(),X(o[a],1),o[a].m(e.parentNode,e))}for(Ze(),a=n.length;a<o.length;a+=1)c(a);Xe()}},i(r){if(!t){for(let u=0;u<n.length;u+=1)X(o[u]);t=!0}},o(r){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)re(o[u]);t=!1},d(r){xe(o,r),r&&S(e)}}}function Ir(l){let e,t;return e=new Us({props:{$$slots:{default:[Mr]},$$scope:{ctx:l}}}),{c(){ve(e.$$.fragment)},m(n,o){be(e,n,o),t=!0},p(n,o){const c={};o&268435457&&(c.$$scope={dirty:o,ctx:n}),e.$set(c)},i(n){t||(X(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){ke(e,n)}}}function Ur(l){let e,t,n,o,c,r,u,a,d,m,p,_,g,y,b;return e=new cl({props:{fallbackPath:"/"}}),o=new Ot({props:{path:"/atomic",$$slots:{default:[Rr]},$$scope:{ctx:l}}}),r=new Ot({props:{path:"/json",$$slots:{default:[Nr]},$$scope:{ctx:l}}}),a=new Ot({props:{path:"/editor",$$slots:{default:[Dr]},$$scope:{ctx:l}}}),_=new zt({props:{grouped:!0,position:"is-right",$$slots:{default:[Ir]},$$scope:{ctx:l}}}),{c(){ve(e.$$.fragment),t=h(),n=f("div"),ve(o.$$.fragment),c=h(),ve(r.$$.fragment),u=h(),ve(a.$$.fragment),d=h(),m=f("hr"),p=h(),ve(_.$$.fragment),g=h(),y=f("nav"),y.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
    <a class="navbar-item" href="/fetch/json">Fetch JSON Data</a> 
    <a class="navbar-item" href="/fetch/atomic">Set Atomic Server</a> 
    <a class="navbar-item" href="/fetch/editor">Edit JSON config</a></div>`,i(n,"class","box"),i(y,"class","navbar")},m(k,w){be(e,k,w),$(k,t,w),$(k,n,w),be(o,n,null),s(n,c),be(r,n,null),s(n,u),be(a,n,null),$(k,d,w),$(k,m,w),$(k,p,w),be(_,k,w),$(k,g,w),$(k,y,w),b=!0},p(k,[w]){const C={};w&268435552&&(C.$$scope={dirty:w,ctx:k}),o.$set(C);const v={};w&268435484&&(v.$$scope={dirty:w,ctx:k}),r.$set(v);const T={};w&268435458&&(T.$$scope={dirty:w,ctx:k}),a.$set(T);const z={};w&268435457&&(z.$$scope={dirty:w,ctx:k}),_.$set(z)},i(k){b||(X(e.$$.fragment,k),X(o.$$.fragment,k),X(r.$$.fragment,k),X(a.$$.fragment,k),X(_.$$.fragment,k),b=!0)},o(k){re(e.$$.fragment,k),re(o.$$.fragment,k),re(r.$$.fragment,k),re(a.$$.fragment,k),re(_.$$.fragment,k),b=!1},d(k){ke(e,k),k&&S(t),k&&S(n),ke(o),ke(r),ke(a),k&&S(d),k&&S(m),k&&S(p),ke(_,k),k&&S(g),k&&S(y)}}}function jr(l,e,t){let n,o,c,r,u;Ue(l,er,A=>t(19,c=A)),Ue(l,ot,A=>t(20,r=A)),Ue(l,Lt,A=>t(21,u=A));let a={json:u};function d(A){if(console.log("contents changed:",A),console.log("is tauri",r),Lt.update(R=>(R=A.json,R)),ot)console.log("Updating config on server"),ze("update_config",{configNew:A.json}).then(R=>{console.log(`Message: ${R}`)}).catch(R=>console.error(R));else{let R=`${Ye.ServerURL}/config/`;fetch(R,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(A.json)})}t(1,a=A)}let m=!1,p="https://raw.githubusercontent.com/terraphim/terraphim-cloud-fastapi/main/data/ref_arch.json",_="http://localhost:8000/documents/",g="http://localhost:9883/",y;const b=async()=>{console.log("Updating atomic server configuration");const A=tr.fromSecret(y);c.setServerUrl(g),console.log("Server set.Setting agent"),c.setAgent(A)},k=async()=>{v()},w=({data:{msg:A,data:R}})=>{console.log(A,R)};let C;const v=async()=>{const A=await Vs(()=>import("./fetcher.worker-7e58969a.js"),[]);C=new A.default,C.onmessage=w;const R={msg:"fetcher",data:{url:p,postUrl:_,isWiki:m}};C.postMessage(R)},T=ys("http://localhost:9883/config/y3zx5wtm0bq"),z=Ol(T,Cs.properties.name);Ue(l,z,A=>t(12,o=A));const O=Ol(T,"http://localhost:9883/property/role");Ue(l,O,A=>t(0,n=A));function N(A){g=A,t(5,g)}function E(A){y=A,t(6,y)}function G(A){p=A,t(3,p)}function te(A){_=A,t(4,_)}function J(A){m=A,t(2,m)}return l.$$.update=()=>{l.$$.dirty&4096&&console.log("Print name",o),l.$$.dirty&1&&console.log("Print roles",n)},[n,a,m,p,_,g,y,d,b,k,z,O,o,N,E,G,te,J]}class Hr extends dt{constructor(e){super(),pt(this,e,jr,Ur,ut,{})}}function Ht(){return $t(ot)||typeof window<"u"&&window.__TAURI__!==void 0}class Fr{constructor(){Ct(this,"baseUrl");Ct(this,"autocompleteIndexBuilt",!1);Ct(this,"sessionId");Ct(this,"currentRole","Default");Ct(this,"connectionRetries",0);Ct(this,"maxRetries",3);Ct(this,"retryDelay",1e3);Ct(this,"isConnecting",!1);this.baseUrl=typeof window<"u"?(window.location.protocol==="https:"?"https://":"http://")+window.location.hostname+":8001":"http://localhost:8001",this.sessionId=`novel-${Date.now()}`,typeof window<"u"&&!Ht()&&this.shouldPerformHealthCheck()?this.detectServerPort():typeof window<"u"&&!Ht()&&console.log("NovelAutocompleteService: Skipping server detection - not needed for current page")}setRole(e){this.currentRole=e,this.autocompleteIndexBuilt=!1}async detectServerPort(){if(Ht())return;if(!this.shouldPerformHealthCheck()){console.log("NovelAutocompleteService: Skipping health check - service not needed");return}const t=[8001,3e3];for(const n of t)try{const o=typeof window<"u"?(window.location.protocol==="https:"?"https://":"http://")+window.location.hostname+":"+n:"http://localhost:"+n,c=await fetch(`${o}/message?sessionId=health-check`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:0,method:"ping",params:{}}),signal:AbortSignal.timeout(1e3)});if(c.ok||c.status===404){this.baseUrl=o,console.log(`NovelAutocompleteService: Detected server at ${o}`);return}}catch{continue}console.warn("NovelAutocompleteService: Could not detect running server, using default:",this.baseUrl)}shouldPerformHealthCheck(){return!(typeof window<"u"&&(!window.location.pathname.startsWith("/chat")||!(document.querySelector('[contenteditable="true"]')||document.querySelector("textarea")||document.querySelector('input[type="text"]'))))}async buildAutocompleteIndex(){if(this.isConnecting)return await new Promise(e=>setTimeout(e,1e3)),this.autocompleteIndexBuilt;this.isConnecting=!0;try{return Ht()?(console.log("Using Tauri backend - no index building required"),this.autocompleteIndexBuilt=!0,this.connectionRetries=0,console.log("Tauri autocomplete ready"),!0):await this.buildMCPIndex()}catch(e){return console.error("Error building Novel autocomplete index:",e),!1}finally{this.isConnecting=!1}}async buildMCPIndex(){for(let e=0;e<=this.maxRetries;e++)try{const t=await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:Date.now(),method:"tools/call",params:{name:"build_autocomplete_index",arguments:{}}}),signal:AbortSignal.timeout(1e4)});if(t.ok){const n=await t.json();if(console.log(`MCP build index response (attempt ${e+1}):`,n),n.result&&!n.result.is_error)return this.autocompleteIndexBuilt=!0,this.connectionRetries=0,console.log("MCP autocomplete index built successfully"),!0}else if(t.status>=500&&e<this.maxRetries){console.warn(`MCP server error ${t.status}, retrying in ${this.retryDelay}ms...`),await new Promise(n=>setTimeout(n,this.retryDelay*(e+1)));continue}console.warn(`MCP build index failed (attempt ${e+1}):`,t.status,t.statusText)}catch(t){t instanceof Error&&t.name==="AbortError"?console.warn(`MCP request timeout (attempt ${e+1})`):console.warn(`MCP connection error (attempt ${e+1}):`,t),e<this.maxRetries&&await new Promise(n=>setTimeout(n,this.retryDelay*(e+1)))}return console.error("Failed to build MCP autocomplete index after all retries"),!1}async getCompletion(e){if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return{text:""};try{const t=this.extractLastWord(e.prompt);if(!t||t.length<1)return{text:""};const n=await this.getSuggestionsWithSnippets(t,5);if(n.length===0)return{text:""};let c=n[0].text;c.toLowerCase().startsWith(t.toLowerCase())&&(c=c.substring(t.length));const r=e.prompt.length/4,u=c.length/4;return{text:c,usage:{promptTokens:Math.round(r),completionTokens:Math.round(u),totalTokens:Math.round(r+u)}}}catch(t){return console.error("Error getting Novel autocomplete completion:",t),{text:""}}}async getSuggestions(e,t=10){if(!e||e.trim().length===0)return[];if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return console.warn("Autocomplete index not built, returning empty suggestions"),[];try{return Ht()?await this.getTauriSuggestions(e,t):await this.getMCPSuggestions(e,t,"autocomplete_terms")}catch(n){return console.error("Error getting autocomplete suggestions:",n),[]}}async getTauriSuggestions(e,t){const n=await ze("get_autocomplete_suggestions",{query:e.trim(),role_name:this.currentRole,limit:t});return console.log("Tauri autocomplete response:",n),n&&n.status==="success"&&n.suggestions?n.suggestions.map(o=>({text:o.term||o.text||"",snippet:o.url||o.snippet||"",score:o.score||1})).filter(o=>o.text.length>0):(n&&n.error&&console.error("Tauri autocomplete error:",n.error),[])}async getMCPSuggestions(e,t,n){const o=Date.now(),c=await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:o,method:"tools/call",params:{name:n,arguments:{query:e.trim(),limit:t,role:this.currentRole}}}),signal:AbortSignal.timeout(5e3)});if(!c.ok)return console.error(`MCP ${n} request failed:`,c.status,c.statusText),[];const r=await c.json();return console.log(`MCP ${n} response:`,r),r.result&&!r.result.is_error&&r.result.content?n==="autocomplete_with_snippets"?this.parseAutocompleteWithSnippetsContent(r.result.content):this.parseAutocompleteContent(r.result.content):(r.error&&console.error(`MCP ${n} error:`,r.error),[])}async getSuggestionsWithSnippets(e,t=10){if(!e||e.trim().length===0)return[];if(!this.autocompleteIndexBuilt&&!await this.buildAutocompleteIndex())return console.warn("Autocomplete index not built, returning empty suggestions with snippets"),[];try{return Ht()?await this.getTauriSuggestions(e,t):await this.getMCPSuggestions(e,t,"autocomplete_with_snippets")}catch(n){return console.error("Error getting autocomplete suggestions with snippets:",n),[]}}extractLastWord(e){const t=e.trim().split(/\s+/);return t[t.length-1]||""}parseAutocompleteContent(e){const t=[];for(const n of e)if(n.type==="text"&&n.text){if(!n.text.startsWith("Found")&&!n.text.startsWith("‚Ä¢"))t.push({text:n.text.trim()});else if(n.text.startsWith("‚Ä¢")){const o=n.text.replace("‚Ä¢","").trim();o&&t.push({text:o})}}return t}parseAutocompleteWithSnippetsContent(e){const t=[];for(const n of e)if(n.type==="text"&&n.text){if(!n.text.startsWith("Found")&&!n.text.startsWith("‚Ä¢")){const o=n.text.split(" ‚Äî ");o.length===2?t.push({text:o[0].trim(),snippet:o[1].trim()}):t.push({text:n.text.trim()})}else if(n.text.startsWith("‚Ä¢")){const o=n.text.replace("‚Ä¢","").trim();o&&t.push({text:o})}}return t}isReady(){return this.autocompleteIndexBuilt}getStatus(){return{ready:this.autocompleteIndexBuilt,baseUrl:this.baseUrl,sessionId:this.sessionId,usingTauri:Ht(),currentRole:this.currentRole,connectionRetries:this.connectionRetries,isConnecting:this.isConnecting}}async refreshIndex(){return this.autocompleteIndexBuilt=!1,this.connectionRetries=0,await this.buildAutocompleteIndex()}async testConnection(){try{if(Ht()){const e=await ze("get_autocomplete_suggestions",{query:"test",role_name:this.currentRole,limit:1});return e&&(e.status==="success"||e.status==="error")}else return(await fetch(`${this.baseUrl}/message?sessionId=${this.sessionId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:Date.now(),method:"tools/list",params:{}}),signal:AbortSignal.timeout(3e3)})).ok}catch(e){return console.warn("Connection test failed:",e),!1}}}const Nt=new Fr;function zr(l){var e;const{char:t,allowSpaces:n,allowToIncludeChar:o,allowedPrefixes:c,startOfLine:r,$position:u}=l,a=n&&!o,d=Xs(t),m=new RegExp(`\\s${d}$`),p=r?"^":"",_=o?"":d,g=a?new RegExp(`${p}${d}.*?(?=\\s${_}|$)`,"gm"):new RegExp(`${p}(?:^)?${d}[^\\s${_}]*`,"gm"),y=((e=u.nodeBefore)===null||e===void 0?void 0:e.isText)&&u.nodeBefore.text;if(!y)return null;const b=u.pos-y.length,k=Array.from(y.matchAll(g)).pop();if(!k||k.input===void 0||k.index===void 0)return null;const w=k.input.slice(Math.max(0,k.index-1),k.index),C=new RegExp(`^[${c==null?void 0:c.join("")}\0]?$`).test(w);if(c!==null&&!C)return null;const v=b+k.index;let T=v+k[0].length;return a&&m.test(y.slice(T-1,T+1))&&(k[0]+=" ",T+=1),v<u.pos&&T>=u.pos?{range:{from:v,to:T},query:k[0].slice(t.length),text:k[0]}:null}const Kr=new ws("suggestion");function qr({pluginKey:l=Kr,editor:e,char:t="@",allowSpaces:n=!1,allowToIncludeChar:o=!1,allowedPrefixes:c=[" "],startOfLine:r=!1,decorationTag:u="span",decorationClass:a="suggestion",decorationContent:d="",decorationEmptyClass:m="is-empty",command:p=()=>null,items:_=()=>[],render:g=()=>({}),allow:y=()=>!0,findSuggestionMatch:b=zr}){let k;const w=g==null?void 0:g(),C=new Qs({key:l,view(){return{update:async(v,T)=>{var z,O,N,E,G,te,J;const A=(z=this.key)===null||z===void 0?void 0:z.getState(T),R=(O=this.key)===null||O===void 0?void 0:O.getState(v.state),se=A.active&&R.active&&A.range.from!==R.range.from,U=!A.active&&R.active,Y=A.active&&!R.active,le=!U&&!Y&&A.query!==R.query,Q=U||se&&le,ie=le||se,D=Y||se&&le;if(!Q&&!ie&&!D)return;const M=D&&!Q?A:R,V=v.dom.querySelector(`[data-decoration-id="${M.decorationId}"]`);k={editor:e,range:M.range,query:M.query,text:M.text,items:[],command:K=>p({editor:e,range:M.range,props:K}),decorationNode:V,clientRect:V?()=>{var K;const{decorationId:x}=(K=this.key)===null||K===void 0?void 0:K.getState(e.state),I=v.dom.querySelector(`[data-decoration-id="${x}"]`);return(I==null?void 0:I.getBoundingClientRect())||null}:null},Q&&((N=w==null?void 0:w.onBeforeStart)===null||N===void 0||N.call(w,k)),ie&&((E=w==null?void 0:w.onBeforeUpdate)===null||E===void 0||E.call(w,k)),(ie||Q)&&(k.items=await _({editor:e,query:M.query})),D&&((G=w==null?void 0:w.onExit)===null||G===void 0||G.call(w,k)),ie&&((te=w==null?void 0:w.onUpdate)===null||te===void 0||te.call(w,k)),Q&&((J=w==null?void 0:w.onStart)===null||J===void 0||J.call(w,k))},destroy:()=>{var v;k&&((v=w==null?void 0:w.onExit)===null||v===void 0||v.call(w,k))}}},state:{init(){return{active:!1,range:{from:0,to:0},query:null,text:null,composing:!1}},apply(v,T,z,O){const{isEditable:N}=e,{composing:E}=e.view,{selection:G}=v,{empty:te,from:J}=G,A={...T};if(A.composing=E,N&&(te||e.view.composing)){(J<T.range.from||J>T.range.to)&&!E&&!T.composing&&(A.active=!1);const R=b({char:t,allowSpaces:n,allowToIncludeChar:o,allowedPrefixes:c,startOfLine:r,$position:G.$from}),se=`id_${Math.floor(Math.random()*4294967295)}`;R&&y({editor:e,state:O,range:R.range,isActive:T.active})?(A.active=!0,A.decorationId=T.decorationId?T.decorationId:se,A.range=R.range,A.query=R.query,A.text=R.text):A.active=!1}else A.active=!1;return A.active||(A.decorationId=null,A.range={from:0,to:0},A.query=null,A.text=null),A}},props:{handleKeyDown(v,T){var z;const{active:O,range:N}=C.getState(v.state);return O&&((z=w==null?void 0:w.onKeyDown)===null||z===void 0?void 0:z.call(w,{view:v,event:T,range:N}))||!1},decorations(v){const{active:T,range:z,decorationId:O,query:N}=C.getState(v);if(!T)return null;const E=!(N!=null&&N.length),G=[a];return E&&G.push(m),Ys.create(v.doc,[Zs.inline(z.from,z.to,{nodeName:u,class:G.join(" "),"data-decoration-id":O,"data-decoration-content":d})])}}});return C}const wn=xs.create({name:"terraphimSuggestion",addOptions(){return{trigger:"++",pluginKey:new ws("terraphimSuggestion"),allowSpaces:!1,limit:8,minLength:1,debounce:300}},addCommands(){return{insertSuggestion:l=>({commands:e,chain:t})=>t().insertContent(l.text).run()}},addProseMirrorPlugins(){const l={editor:this.editor,char:this.options.trigger,pluginKey:this.options.pluginKey,allowSpaces:this.options.allowSpaces,startOfLine:!1,command:({editor:e,range:t,props:n})=>{const o=n;e.chain().focus().insertContentAt(t,o.text+" ").run()},items:async({query:e,editor:t})=>new Promise(n=>{setTimeout(async()=>{if(e.length<this.options.minLength){n([]);return}try{const o=await Nt.getSuggestionsWithSnippets(e,this.options.limit);console.log(`TerraphimSuggestion: Found ${o.length} suggestions for "${e}"`),n(o)}catch(o){console.error("TerraphimSuggestion: Error getting suggestions:",o),n([])}},this.options.debounce)}),render:()=>{let e,t;return{onStart:n=>{e=new Gr({items:n.items,command:n.command}),n.clientRect&&(t=or("body",{getReferenceClientRect:n.clientRect,appendTo:()=>document.body,content:e.element,showOnCreate:!0,interactive:!0,trigger:"manual",placement:"bottom-start",theme:"terraphim-suggestion",maxWidth:"none"})[0])},onUpdate(n){e==null||e.updateItems(n.items),n.clientRect&&(t==null||t.setProps({getReferenceClientRect:n.clientRect}))},onKeyDown(n){return n.event.key==="Escape"?(t==null||t.hide(),!0):(e==null?void 0:e.onKeyDown(n))??!1},onExit(){t==null||t.destroy(),e==null||e.destroy()}}}};return[qr(l)]}});class Gr{constructor(e){Ct(this,"element");Ct(this,"items",[]);Ct(this,"selectedIndex",0);Ct(this,"command");this.items=e.items,this.command=e.command,this.element=document.createElement("div"),this.element.className="terraphim-suggestion-dropdown",this.render()}updateItems(e){this.items=e,this.selectedIndex=0,this.render()}onKeyDown({event:e}){return e.key==="ArrowUp"?(this.selectPrevious(),!0):e.key==="ArrowDown"?(this.selectNext(),!0):e.key==="Enter"||e.key==="Tab"?(this.selectItem(this.selectedIndex),!0):!1}selectPrevious(){this.selectedIndex=Math.max(0,this.selectedIndex-1),this.render()}selectNext(){this.selectedIndex=Math.min(this.items.length-1,this.selectedIndex+1),this.render()}selectItem(e){const t=this.items[e];t&&this.command({id:t.text,...t})}render(){if(this.element.innerHTML="",this.items.length===0){this.element.innerHTML=`
        <div class="terraphim-suggestion-item terraphim-suggestion-empty">
          <div class="terraphim-suggestion-text">No suggestions found</div>
          <div class="terraphim-suggestion-hint">Try a different search term</div>
        </div>
      `;return}const e=document.createElement("div");e.className="terraphim-suggestion-header",e.innerHTML=`
      <div class="terraphim-suggestion-count">${this.items.length} suggestions</div>
      <div class="terraphim-suggestion-hint">‚Üë‚Üì Navigate ‚Ä¢ Tab/Enter Select ‚Ä¢ Esc Cancel</div>
    `,this.element.appendChild(e),this.items.forEach((t,n)=>{const o=document.createElement("div");o.className=`terraphim-suggestion-item ${n===this.selectedIndex?"terraphim-suggestion-selected":""}`,o.innerHTML=`
        <div class="terraphim-suggestion-main">
          <div class="terraphim-suggestion-text">${this.escapeHtml(t.text)}</div>
          ${t.snippet?`<div class="terraphim-suggestion-snippet">${this.escapeHtml(t.snippet)}</div>`:""}
        </div>
        ${t.score?`<div class="terraphim-suggestion-score">${Math.round(t.score*100)}%</div>`:""}
      `,o.addEventListener("click",()=>this.selectItem(n)),o.addEventListener("mouseenter",()=>{this.selectedIndex=n,this.render()}),this.element.appendChild(o)})}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}destroy(){this.element.remove()}}const Wr=`
.terraphim-suggestion-dropdown {
  background: white;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  box-shadow: 0 10px 38px -10px rgba(22, 23, 24, 0.35), 0 10px 20px -15px rgba(22, 23, 24, 0.2);
  max-height: 300px;
  min-width: 300px;
  overflow-y: auto;
  z-index: 1000;
}

.terraphim-suggestion-header {
  padding: 8px 12px;
  border-bottom: 1px solid #f1f5f9;
  background: #f8fafc;
  font-size: 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.terraphim-suggestion-count {
  font-weight: 600;
  color: #475569;
}

.terraphim-suggestion-hint {
  color: #64748b;
}

.terraphim-suggestion-item {
  padding: 8px 12px;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  border-bottom: 1px solid #f1f5f9;
}

.terraphim-suggestion-item:hover {
  background: #f8fafc;
}

.terraphim-suggestion-selected {
  background: #eff6ff !important;
  border-left: 3px solid #3b82f6;
}

.terraphim-suggestion-empty {
  color: #64748b;
  font-style: italic;
  text-align: center;
  cursor: default;
}

.terraphim-suggestion-main {
  flex: 1;
}

.terraphim-suggestion-text {
  font-weight: 500;
  color: #1e293b;
  margin-bottom: 2px;
}

.terraphim-suggestion-snippet {
  font-size: 12px;
  color: #64748b;
  line-height: 1.3;
}

.terraphim-suggestion-score {
  font-size: 11px;
  color: #10b981;
  font-weight: 600;
  background: #ecfdf5;
  padding: 2px 6px;
  border-radius: 4px;
  margin-left: 8px;
}

/* Dark theme support */
@media (prefers-color-scheme: dark) {
  .terraphim-suggestion-dropdown {
    background: #1e293b;
    border-color: #334155;
  }

  .terraphim-suggestion-header {
    background: #0f172a;
    border-color: #334155;
  }

  .terraphim-suggestion-item:hover {
    background: #334155;
  }

  .terraphim-suggestion-selected {
    background: #1e40af !important;
  }

  .terraphim-suggestion-text {
    color: #f1f5f9;
  }

  .terraphim-suggestion-snippet {
    color: #94a3b8;
  }
}

/* Tippy.js theme */
.tippy-box[data-theme~='terraphim-suggestion'] {
  background: transparent;
  box-shadow: none;
}

.tippy-box[data-theme~='terraphim-suggestion'] > .tippy-backdrop {
  background: transparent;
}

.tippy-box[data-theme~='terraphim-suggestion'] > .tippy-arrow {
  display: none;
}
`;function yn(l){let e,t,n,o,c,r,u,a,d,m,p,_,g,y,b,k,w,C,v,T,z,O,N,E,G,te,J=l[12]?"Tauri (native)":`MCP Server (${Nt.getStatus().baseUrl})`,A,R,se,U,Y,le,Q,ie,D,M,V,K,x,I,F,P,L,W,oe,Z,ee=l[6]!==1?"s":"",me,_e,fe,de,pe,he,$e,We,je,Le,Re,ae,ye,Ne,Be,qe,Te,De,et=l[3]?"Enabled":"Disabled",Je,Me,He,tt,ue=l[11]&&!l[8]&&Cn(l);function Ae(H,ce){if(H[8])return Qr;if(H[11])return Vr}let j=Ae(l),B=j&&j(l);return{c(){e=f("div"),t=f("div"),n=f("strong"),n.textContent="Local Autocomplete Status:",o=h(),c=f("div"),r=f("button"),u=q("Test"),d=h(),m=f("button"),m.textContent="Rebuild Index",p=h(),_=f("button"),g=q("Demo"),b=h(),k=f("div"),w=q(l[10]),C=h(),ue&&ue.c(),v=h(),T=f("div"),z=f("strong"),z.textContent="Configuration:",O=h(),N=f("br"),E=q("‚Ä¢ "),G=f("strong"),G.textContent="Backend:",te=h(),A=q(J),R=h(),se=f("br"),U=q("‚Ä¢ "),Y=f("strong"),Y.textContent="Role:",le=h(),Q=q(l[9]),ie=h(),D=f("br"),M=q("‚Ä¢ "),V=f("strong"),V.textContent="Trigger:",K=q(' "'),x=q(l[4]),I=q(`" + text
      `),F=f("br"),P=q("‚Ä¢ "),L=f("strong"),L.textContent="Min Length:",W=h(),oe=q(l[6]),Z=q(" character"),me=q(ee),_e=h(),fe=f("br"),de=q("‚Ä¢ "),pe=f("strong"),pe.textContent="Max Results:",he=h(),$e=q(l[5]),We=h(),je=f("br"),Le=q("‚Ä¢ "),Re=f("strong"),Re.textContent="Debounce:",ae=h(),ye=q(l[7]),Ne=q(`ms
      `),Be=f("br"),qe=q("‚Ä¢ "),Te=f("strong"),Te.textContent="Snippets:",De=h(),Je=q(et),Me=h(),B&&B.c(),ge(n,"color","#495057"),ge(r,"padding","4px 8px"),ge(r,"background","#007bff"),ge(r,"color","white"),ge(r,"border","none"),ge(r,"border-radius","4px"),ge(r,"cursor","pointer"),ge(r,"font-size","12px"),r.disabled=a=!l[8],ge(m,"padding","4px 8px"),ge(m,"background","#28a745"),ge(m,"color","white"),ge(m,"border","none"),ge(m,"border-radius","4px"),ge(m,"cursor","pointer"),ge(m,"font-size","12px"),ge(_,"padding","4px 8px"),ge(_,"background","#ffc107"),ge(_,"color","#212529"),ge(_,"border","none"),ge(_,"border-radius","4px"),ge(_,"cursor","pointer"),ge(_,"font-size","12px"),_.disabled=y=!l[8],ge(c,"display","flex"),ge(c,"gap","8px"),ge(t,"display","flex"),ge(t,"justify-content","space-between"),ge(t,"align-items","center"),ge(t,"margin-bottom","8px"),ge(k,"font-size","13px"),ge(k,"color","#6c757d"),ge(k,"margin-bottom","8px"),ge(k,"font-family","monospace"),ge(T,"font-size","12px"),ge(T,"color","#6c757d"),ge(e,"margin-top","10px"),ge(e,"padding","12px"),ge(e,"background","#f8f9fa"),ge(e,"border-radius","6px"),ge(e,"border","1px solid #e9ecef")},m(H,ce){$(H,e,ce),s(e,t),s(t,n),s(t,o),s(t,c),s(c,r),s(r,u),s(c,d),s(c,m),s(c,p),s(c,_),s(_,g),s(e,b),s(e,k),s(k,w),s(e,C),ue&&ue.m(e,null),s(e,v),s(e,T),s(T,z),s(T,O),s(T,N),s(T,E),s(T,G),s(T,te),s(T,A),s(T,R),s(T,se),s(T,U),s(T,Y),s(T,le),s(T,Q),s(T,ie),s(T,D),s(T,M),s(T,V),s(T,K),s(T,x),s(T,I),s(T,F),s(T,P),s(T,L),s(T,W),s(T,oe),s(T,Z),s(T,me),s(T,_e),s(T,fe),s(T,de),s(T,pe),s(T,he),s(T,$e),s(T,We),s(T,je),s(T,Le),s(T,Re),s(T,ae),s(T,ye),s(T,Ne),s(T,Be),s(T,qe),s(T,Te),s(T,De),s(T,Je),s(e,Me),B&&B.m(e,null),He||(tt=[ne(r,"click",l[14]),ne(m,"click",l[15]),ne(_,"click",l[16])],He=!0)},p(H,ce){ce&256&&a!==(a=!H[8])&&(r.disabled=a),ce&256&&y!==(y=!H[8])&&(_.disabled=y),ce&1024&&we(w,H[10]),H[11]&&!H[8]?ue?ue.p(H,ce):(ue=Cn(H),ue.c(),ue.m(e,v)):ue&&(ue.d(1),ue=null),ce&4096&&J!==(J=H[12]?"Tauri (native)":`MCP Server (${Nt.getStatus().baseUrl})`)&&we(A,J),ce&512&&we(Q,H[9]),ce&16&&we(x,H[4]),ce&64&&we(oe,H[6]),ce&64&&ee!==(ee=H[6]!==1?"s":"")&&we(me,ee),ce&32&&we($e,H[5]),ce&128&&we(ye,H[7]),ce&8&&et!==(et=H[3]?"Enabled":"Disabled")&&we(Je,et),j===(j=Ae(H))&&B?B.p(H,ce):(B&&B.d(1),B=j&&j(H),B&&(B.c(),B.m(e,null)))},d(H){H&&S(e),ue&&ue.d(),B&&B.d(),He=!1,Qe(tt)}}}function Cn(l){let e,t,n,o;function c(a,d){return a[12]?Jr:Br}let r=c(l),u=r(l);return{c(){e=f("div"),t=f("strong"),t.textContent="‚ö†Ô∏è Autocomplete Not Available",n=f("br"),o=h(),u.c(),ge(e,"font-size","12px"),ge(e,"color","#dc3545"),ge(e,"margin-bottom","8px"),ge(e,"padding","6px"),ge(e,"background","#f8d7da"),ge(e,"border-radius","4px")},m(a,d){$(a,e,d),s(e,t),s(e,n),s(e,o),u.m(e,null)},p(a,d){r===(r=c(a))&&u?u.p(a,d):(u.d(1),u=r(a),u&&(u.c(),u.m(e,null)))},d(a){a&&S(e),u.d()}}}function Br(l){let e,t=Nt.getStatus().baseUrl+"",n;return{c(){e=q("MCP server not responding. Ensure the server is running on "),n=q(t)},m(o,c){$(o,e,c),$(o,n,c)},p:Pe,d(o){o&&S(e),o&&S(n)}}}function Jr(l){let e;return{c(){e=q("Tauri backend connection failed. Ensure the application has proper permissions.")},m(t,n){$(t,e,n)},p:Pe,d(t){t&&S(e)}}}function Vr(l){let e;return{c(){e=f("div"),e.innerHTML=`<strong>‚ùå Autocomplete Unavailable</strong> 
        <div style="font-size: 11px; margin-top: 4px; color: #721c24;">Click &quot;Rebuild Index&quot; to retry or check server/backend status.</div>`,ge(e,"margin-top","8px"),ge(e,"padding","8px"),ge(e,"background","#f8d7da"),ge(e,"border","1px solid #f5c6cb"),ge(e,"border-radius","4px")},m(t,n){$(t,e,n)},p:Pe,d(t){t&&S(e)}}}function Qr(l){let e,t,n,o,c,r,u,a,d,m,p,_,g,y,b,k,w;return{c(){e=f("div"),t=f("strong"),t.textContent="üéØ Autocomplete Active",n=h(),o=f("div"),c=q("Type "),r=f("code"),u=q(l[4]),a=q(" in the editor above to trigger suggestions."),d=f("br"),m=q(`
          Example: `),p=f("code"),_=q(l[4]),g=q("terraphim"),y=q(" or "),b=f("code"),k=q(l[4]),w=q("graph"),ge(o,"font-size","11px"),ge(o,"margin-top","4px"),ge(o,"color","#0056b3"),ge(e,"margin-top","8px"),ge(e,"padding","8px"),ge(e,"background","#d1edff"),ge(e,"border","1px solid #b3d9ff"),ge(e,"border-radius","4px")},m(C,v){$(C,e,v),s(e,t),s(e,n),s(e,o),s(o,c),s(o,r),s(r,u),s(o,a),s(o,d),s(o,m),s(o,p),s(p,_),s(p,g),s(o,y),s(o,b),s(b,k),s(b,w)},p(C,v){v&16&&we(u,C[4]),v&16&&we(_,C[4]),v&16&&we(k,C[4])},d(C){C&&S(e)}}}function Yr(l){let e,t,n,o;e=new sr({props:{defaultValue:l[0],isEditable:!l[1],disableLocalStorage:!0,onUpdate:l[13],extensions:[_n,...l[2]?[wn.configure({trigger:l[4],allowSpaces:!1,limit:l[5],minLength:l[6],debounce:l[7]})]:[]]}});let c=l[2]&&yn(l);return{c(){ve(e.$$.fragment),t=h(),c&&c.c(),n=rt()},m(r,u){be(e,r,u),$(r,t,u),c&&c.m(r,u),$(r,n,u),o=!0},p(r,[u]){const a={};u&1&&(a.defaultValue=r[0]),u&2&&(a.isEditable=!r[1]),u&244&&(a.extensions=[_n,...r[2]?[wn.configure({trigger:r[4],allowSpaces:!1,limit:r[5],minLength:r[6],debounce:r[7]})]:[]]),e.$set(a),r[2]?c?c.p(r,u):(c=yn(r),c.c(),c.m(n.parentNode,n)):c&&(c.d(1),c=null)},i(r){o||(X(e.$$.fragment,r),o=!0)},o(r){re(e.$$.fragment,r),o=!1},d(r){ke(e,r),r&&S(t),c&&c.d(r),r&&S(n)}}}function Zr(l,e,t){let n,o;Ue(l,Et,E=>t(9,n=E)),Ue(l,ot,E=>t(12,o=E));let{html:c=""}=e,{readOnly:r=!1}=e,{outputFormat:u="html"}=e,{enableAutocomplete:a=!0}=e,{showSnippets:d=!0}=e,{suggestionTrigger:m="++"}=e,{maxSuggestions:p=8}=e,{minQueryLength:_=1}=e,{debounceDelay:g=300}=e,y=null,b="‚è≥ Initializing...",k=!1,w=!1,C=null;Qt(async()=>{a&&await v(),typeof document<"u"&&(C=document.createElement("style"),C.textContent=Wr,document.head.appendChild(C))}),Hs(()=>{C&&C.parentNode&&C.parentNode.removeChild(C)});async function v(){t(10,b="‚è≥ Initializing autocomplete..."),t(8,k=!1),t(11,w=!1);try{Nt.setRole(n),t(10,b="üîó Testing connection...");const E=await Nt.testConnection();t(11,w=!0),E?(t(10,b="üî® Building autocomplete index..."),await Nt.buildAutocompleteIndex()?(o?t(10,b="‚úÖ Ready - Using Tauri backend"):t(10,b="‚úÖ Ready - Using MCP server backend"),t(8,k=!0)):t(10,b="‚ùå Failed to build autocomplete index")):o?t(10,b="‚ùå Tauri backend not available"):t(10,b="‚ùå MCP server not responding")}catch(E){console.error("Error initializing autocomplete:",E),t(10,b="‚ùå Autocomplete initialization error")}}const T=E=>{y=E,u==="markdown"?t(0,c=E.storage.markdown.getMarkdown()):t(0,c=E.getHTML())},z=async()=>{if(!w){alert("Please wait for connection test to complete");return}if(!k){alert("Autocomplete service not ready. Check the status above.");return}try{t(10,b="üß™ Testing autocomplete...");const E="terraphim",G=await Nt.getSuggestions(E,5);if(console.log("Autocomplete test results:",G),G.length>0){const te=G.map((J,A)=>`${A+1}. ${J.text}${J.snippet?` (${J.snippet})`:""}`).join(`
`);alert(`‚úÖ Found ${G.length} suggestions for '${E}':

${te}`),o?t(10,b="‚úÖ Ready - Using Tauri backend"):t(10,b="‚úÖ Ready - Using MCP server backend")}else alert(`‚ö†Ô∏è No suggestions found for '${E}'. This might be normal if the term isn't in your knowledge graph.`)}catch(E){console.error("Autocomplete test failed:",E),alert(`‚ùå Autocomplete test failed: ${E.message}`),t(10,b="‚ùå Test failed - check console for details")}},O=async()=>{t(10,b="‚è≥ Rebuilding index..."),t(8,k=!1);try{await Nt.refreshIndex()?(o?t(10,b="‚úÖ Ready - Tauri index rebuilt successfully"):t(10,b="‚úÖ Ready - MCP server index rebuilt successfully"),t(8,k=!0)):t(10,b="‚ùå Failed to rebuild index")}catch(E){console.error("Error rebuilding index:",E),t(10,b="‚ùå Index rebuild failed - check console for details")}},N=()=>{if(!y){alert("Editor not ready yet");return}const E=`# Terraphim Autocomplete Demo

This is a demonstration of the integrated Terraphim autocomplete system.

## How to Use:
1. Type "${m}" to trigger autocomplete
2. Start typing any term (e.g., "${m}terraphim", "${m}graph")
3. Use ‚Üë‚Üì arrows to navigate suggestions
4. Press Tab or Enter to select
5. Press Esc to cancel

## Try these queries:
- ${m}terraphim
- ${m}graph
- ${m}service
- ${m}automata
- ${m}role

The autocomplete system uses your local knowledge graph to provide intelligent suggestions based on your selected role: **${n}**.

---

Start typing below:`;y.commands.setContent(E),setTimeout(()=>{y.commands.focus("end")},100),alert(`Demo content inserted!

Type "${m}" followed by any term to see autocomplete suggestions.

Example: "${m}terraphim"`)};return l.$$set=E=>{"html"in E&&t(0,c=E.html),"readOnly"in E&&t(1,r=E.readOnly),"outputFormat"in E&&t(17,u=E.outputFormat),"enableAutocomplete"in E&&t(2,a=E.enableAutocomplete),"showSnippets"in E&&t(3,d=E.showSnippets),"suggestionTrigger"in E&&t(4,m=E.suggestionTrigger),"maxSuggestions"in E&&t(5,p=E.maxSuggestions),"minQueryLength"in E&&t(6,_=E.minQueryLength),"debounceDelay"in E&&t(7,g=E.debounceDelay)},l.$$.update=()=>{l.$$.dirty&772&&n&&a&&k&&(Nt.setRole(n),v())},[c,r,a,d,m,p,_,g,k,n,b,w,o,T,z,O,N,u]}class Xr extends dt{constructor(e){super(),pt(this,e,Zr,Yr,ut,{html:0,readOnly:1,outputFormat:17,enableAutocomplete:2,showSnippets:3,suggestionTrigger:4,maxSuggestions:5,minQueryLength:6,debounceDelay:7})}}function Tn(l){let e,t,n,o,c,r,u,a,d,m,p;return{c(){e=f("div"),t=f("h3"),n=f("span"),n.textContent="Knowledge Graph",o=q(`
          Term: `),c=f("strong"),r=q(l[2]),u=q(" | Rank: "),a=f("strong"),d=q(l[3]),m=h(),p=f("hr"),i(n,"class","tag is-info svelte-329px1"),i(t,"class","subtitle is-6 svelte-329px1"),i(p,"class","svelte-329px1"),i(e,"class","kg-context svelte-329px1")},m(_,g){$(_,e,g),s(e,t),s(t,n),s(t,o),s(t,c),s(c,r),s(t,u),s(t,a),s(a,d),s(e,m),s(e,p)},p(_,g){g&4&&we(r,_[2]),g&8&&we(d,_[3])},d(_){_&&S(e)}}}function xr(l){let e,t,n,o,c,r,u,a;const d=[li,ti],m=[];function p(_,g){return _[5]?0:1}return t=p(l),n=m[t]=d[t](l),{c(){e=f("div"),n.c(),o=h(),c=f("div"),c.innerHTML='<span class="hint-text svelte-329px1">Double-click to edit ‚Ä¢ Ctrl+E to edit ‚Ä¢ Ctrl+S to save ‚Ä¢ Click KG links to explore</span>',i(c,"class","edit-hint svelte-329px1"),i(e,"class","content-viewer svelte-329px1"),i(e,"tabindex","0"),i(e,"role","button"),i(e,"aria-label","Double-click to edit article content")},m(_,g){$(_,e,g),m[t].m(e,null),s(e,o),s(e,c),l[20](e),r=!0,u||(a=[ne(e,"dblclick",l[14]),ne(e,"keydown",l[15]),ne(e,"click",l[13])],u=!0)},p(_,g){let y=t;t=p(_),t===y?m[t].p(_,g):(Ze(),re(m[y],1,1,()=>{m[y]=null}),Xe(),n=m[t],n?n.p(_,g):(n=m[t]=d[t](_),n.c()),X(n,1),n.m(e,o))},i(_){r||(X(n),r=!0)},o(_){re(n),r=!1},d(_){_&&S(e),m[t].d(),l[20](null),u=!1,Qe(a)}}}function ei(l){let e,t,n,o,c,r,u,a,d,m;function p(g){l[18](g)}let _={outputFormat:l[11]};return l[1].body!==void 0&&(_.html=l[1].body),e=new Xr({props:_}),st.push(()=>at(e,"html",p)),{c(){ve(e.$$.fragment),n=h(),o=f("div"),c=f("button"),c.textContent="Save",r=h(),u=f("button"),u.textContent="Cancel",i(c,"class","button is-primary"),i(u,"class","button is-light"),i(o,"class","edit-controls svelte-329px1")},m(g,y){be(e,g,y),$(g,n,y),$(g,o,y),s(o,c),s(o,r),s(o,u),a=!0,d||(m=[ne(c,"click",l[12]),ne(u,"click",l[19])],d=!0)},p(g,y){const b={};y&2048&&(b.outputFormat=g[11]),!t&&y&2&&(t=!0,b.html=g[1].body,ct(()=>t=!1)),e.$set(b)},i(g){a||(X(e.$$.fragment,g),a=!0)},o(g){re(e.$$.fragment,g),a=!1},d(g){ke(e,g),g&&S(n),g&&S(o),d=!1,Qe(m)}}}function ti(l){let e,t,n;return t=new Ml({props:{source:l[1].body}}),{c(){e=f("div"),ve(t.$$.fragment),i(e,"class","markdown-content svelte-329px1")},m(o,c){$(o,e,c),be(t,e,null),n=!0},p(o,c){const r={};c&2&&(r.source=o[1].body),t.$set(r)},i(o){n||(X(t.$$.fragment,o),n=!0)},o(o){re(t.$$.fragment,o),n=!1},d(o){o&&S(e),ke(t)}}}function li(l){let e,t=l[1].body+"";return{c(){e=f("div"),i(e,"class","prose svelte-329px1")},m(n,o){$(n,e,o),e.innerHTML=t},p(n,o){o&2&&t!==(t=n[1].body+"")&&(e.innerHTML=t)},i:Pe,o:Pe,d(n){n&&S(e)}}}function ni(l){let e,t,n,o,c,r=l[1].title+"",u,a,d,m,p,_,g,y=l[2]&&l[3]!==null&&Tn(l);const b=[ei,xr],k=[];function w(C,v){return C[4]?0:1}return d=w(l),m=k[d]=b[d](l),{c(){e=f("div"),t=f("button"),n=h(),y&&y.c(),o=h(),c=f("h2"),u=q(r),a=h(),m.c(),i(t,"class","delete is-large modal-close-btn svelte-329px1"),i(t,"aria-label","close"),i(c,"class","svelte-329px1"),i(e,"class","box wrapper svelte-329px1")},m(C,v){$(C,e,v),s(e,t),s(e,n),y&&y.m(e,null),s(e,o),s(e,c),s(c,u),s(e,a),k[d].m(e,null),p=!0,_||(g=ne(t,"click",l[17]),_=!0)},p(C,v){C[2]&&C[3]!==null?y?y.p(C,v):(y=Tn(C),y.c(),y.m(e,o)):y&&(y.d(1),y=null),(!p||v&2)&&r!==(r=C[1].title+"")&&we(u,r);let T=d;d=w(C),d===T?k[d].p(C,v):(Ze(),re(k[T],1,1,()=>{k[T]=null}),Xe(),m=k[d],m?m.p(C,v):(m=k[d]=b[d](C),m.c()),X(m,1),m.m(e,null))},i(C){p||(X(m),p=!0)},o(C){re(m),p=!1},d(C){C&&S(e),y&&y.d(),k[d].d(),_=!1,g()}}}function Sn(l){let e,t,n;function o(r){l[23](r)}let c={$$slots:{default:[ri]},$$scope:{ctx:l}};return l[7]!==void 0&&(c.active=l[7]),e=new Nl({props:c}),st.push(()=>at(e,"active",o)),{c(){ve(e.$$.fragment)},m(r,u){be(e,r,u),n=!0},p(r,u){const a={};u&536872832&&(a.$$scope={dirty:u,ctx:r}),!t&&u&128&&(t=!0,a.active=r[7],ct(()=>t=!1)),e.$set(a)},i(r){n||(X(e.$$.fragment,r),n=!0)},o(r){re(e.$$.fragment,r),n=!1},d(r){ke(e,r)}}}function $n(l){let e,t,n,o,c,r,u,a,d,m,p;return{c(){e=f("div"),t=f("h3"),n=f("span"),n.textContent="Knowledge Graph",o=q(`
            Term: `),c=f("strong"),r=q(l[9]),u=q(" | Rank: "),a=f("strong"),d=q(l[10]),m=h(),p=f("hr"),i(n,"class","tag is-info svelte-329px1"),i(t,"class","subtitle is-6 svelte-329px1"),i(p,"class","svelte-329px1"),i(e,"class","kg-context svelte-329px1")},m(_,g){$(_,e,g),s(e,t),s(t,n),s(t,o),s(t,c),s(c,r),s(t,u),s(t,a),s(a,d),s(e,m),s(e,p)},p(_,g){g&512&&we(r,_[9]),g&1024&&we(d,_[10])},d(_){_&&S(e)}}}function oi(l){let e,t,n;return t=new Ml({props:{source:l[8].body}}),{c(){e=f("div"),ve(t.$$.fragment),i(e,"class","markdown-content svelte-329px1")},m(o,c){$(o,e,c),be(t,e,null),n=!0},p(o,c){const r={};c&256&&(r.source=o[8].body),t.$set(r)},i(o){n||(X(t.$$.fragment,o),n=!0)},o(o){re(t.$$.fragment,o),n=!1},d(o){o&&S(e),ke(t)}}}function si(l){let e,t=l[8].body+"";return{c(){e=f("div"),i(e,"class","prose svelte-329px1")},m(n,o){$(n,e,o),e.innerHTML=t},p(n,o){o&256&&t!==(t=n[8].body+"")&&(e.innerHTML=t)},i:Pe,o:Pe,d(n){n&&S(e)}}}function ri(l){let e,t,n,o,c,r=l[8].title+"",u,a,d,m,p,_,g,y,b,k,w,C=l[9]&&l[10]!==null&&$n(l);const v=[si,oi],T=[];function z(O,N){return N&256&&(m=null),m==null&&(m=!!(O[8].body&&(/<html/i.test(O[8].body)||/<body/i.test(O[8].body)||/<head/i.test(O[8].body)))),m?0:1}return p=z(l,-1),_=T[p]=v[p](l),{c(){e=f("div"),t=f("button"),n=h(),C&&C.c(),o=h(),c=f("h2"),u=q(r),a=h(),d=f("div"),_.c(),g=h(),y=f("div"),y.innerHTML='<span class="hint-text svelte-329px1">Knowledge Graph document ‚Ä¢ Click KG links to explore further</span>',i(t,"class","delete is-large modal-close-btn svelte-329px1"),i(t,"aria-label","close"),i(c,"class","svelte-329px1"),i(y,"class","edit-hint svelte-329px1"),i(d,"class","content-viewer svelte-329px1"),i(d,"tabindex","0"),i(d,"role","button"),i(d,"aria-label","KG document content - click KG links to explore further"),i(e,"class","box wrapper svelte-329px1")},m(O,N){$(O,e,N),s(e,t),s(e,n),C&&C.m(e,null),s(e,o),s(e,c),s(c,u),s(e,a),s(e,d),T[p].m(d,null),s(d,g),s(d,y),b=!0,k||(w=[ne(t,"click",l[22]),ne(d,"click",l[13])],k=!0)},p(O,N){O[9]&&O[10]!==null?C?C.p(O,N):(C=$n(O),C.c(),C.m(e,o)):C&&(C.d(1),C=null),(!b||N&256)&&r!==(r=O[8].title+"")&&we(u,r);let E=p;p=z(O,N),p===E?T[p].p(O,N):(Ze(),re(T[E],1,1,()=>{T[E]=null}),Xe(),_=T[p],_?_.p(O,N):(_=T[p]=v[p](O),_.c()),X(_,1),_.m(d,g))},i(O){b||(X(_),b=!0)},o(O){re(_),b=!1},d(O){O&&S(e),C&&C.d(),T[p].d(),k=!1,Qe(w)}}}function ii(l){let e,t,n,o,c;function r(d){l[21](d)}let u={$$slots:{default:[ni]},$$scope:{ctx:l}};l[0]!==void 0&&(u.active=l[0]),e=new Nl({props:u}),st.push(()=>at(e,"active",r));let a=l[8]&&Sn(l);return{c(){ve(e.$$.fragment),n=h(),a&&a.c(),o=rt()},m(d,m){be(e,d,m),$(d,n,m),a&&a.m(d,m),$(d,o,m),c=!0},p(d,[m]){const p={};m&536873087&&(p.$$scope={dirty:m,ctx:d}),!t&&m&1&&(t=!0,p.active=d[0],ct(()=>t=!1)),e.$set(p),d[8]?a?(a.p(d,m),m&256&&X(a,1)):(a=Sn(d),a.c(),X(a,1),a.m(o.parentNode,o)):a&&(Ze(),re(a,1,1,()=>{a=null}),Xe())},i(d){c||(X(e.$$.fragment,d),X(a),c=!0)},o(d){re(e.$$.fragment,d),re(a),c=!1},d(d){ke(e,d),d&&S(n),a&&a.d(d),d&&S(o)}}}function ai(l,e,t){let n,o,c,r;Ue(l,ot,U=>t(25,c=U)),Ue(l,Et,U=>t(26,r=U));let{active:u=!1}=e,{item:a}=e,{initialEdit:d=!1}=e,{kgTerm:m=null}=e,{kgRank:p=null}=e,_=!1,g,y=!1,b=null,k=null,w=null;async function C(){if(c)try{const U=await ze("get_document",{documentId:a.id});U!=null&&U.document&&t(1,a=U.document)}catch(U){console.error("Failed to load document",U)}}async function v(){if(!c){t(4,_=!1);return}try{await ze("create_document",{document:a}),t(4,_=!1)}catch(U){console.error("Failed to save document",U)}}async function T(U){var Y,le,Q,ie,D;t(9,k=U),console.log("üîç KG Link Click Debug Info:"),console.log("  Term clicked:",U),console.log("  Current role:",r),console.log("  Is Tauri mode:",c);try{if(c){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:r,term:U});const M=await ze("find_documents_for_kg_term",{roleName:r,term:U});console.log("  üì• Tauri response received:"),console.log("    Status:",M.status),console.log("    Results count:",((Y=M.results)==null?void 0:Y.length)||0),console.log("    Total:",M.total||0),console.log("    Full response:",JSON.stringify(M,null,2)),M.status==="success"&&M.results&&M.results.length>0?(t(8,b=M.results[0]),t(10,w=b.rank||0),console.log("  ‚úÖ Found KG document:"),console.log("    Title:",b.title),console.log("    Rank:",w),console.log("    Body length:",((le=b.body)==null?void 0:le.length)||0,"characters"),t(7,y=!0)):(console.warn(`  ‚ö†Ô∏è  No KG documents found for term: "${U}" in role: "${r}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const M=Ye.ServerURL,V=encodeURIComponent(r),K=encodeURIComponent(U),x=`${M}/roles/${V}/kg_search?term=${K}`;console.log("  üì§ HTTP Request details:"),console.log("    Base URL:",M),console.log("    Role (encoded):",V),console.log("    Term (encoded):",K),console.log("    Full URL:",x);const I=await fetch(x);if(console.log("  üì• HTTP Response received:"),console.log("    Status code:",I.status),console.log("    Status text:",I.statusText),console.log("    Headers:",Object.fromEntries(I.headers.entries())),!I.ok)throw new Error(`HTTP error! Status: ${I.status} - ${I.statusText}`);const F=await I.json();console.log("  üìÑ Response data:"),console.log("    Status:",F.status),console.log("    Results count:",((Q=F.results)==null?void 0:Q.length)||0),console.log("    Total:",F.total||0),console.log("    Full response:",JSON.stringify(F,null,2)),F.status==="success"&&F.results&&F.results.length>0?(t(8,b=F.results[0]),t(10,w=b.rank||0),console.log("  ‚úÖ Found KG document:"),console.log("    Title:",b.title),console.log("    Rank:",w),console.log("    Body length:",((ie=b.body)==null?void 0:ie.length)||0,"characters"),t(7,y=!0)):(console.warn(`  ‚ö†Ô∏è  No KG documents found for term: "${U}" in role: "${r}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",x))}}catch(M){console.error("‚ùå Error fetching KG document:"),console.error("  Error type:",M.constructor.name),console.error("  Error message:",M.message||M),console.error("  Request details:",{term:U,role:r,isTauri:c,timestamp:new Date().toISOString()}),!c&&((D=M.message)!=null&&D.includes("Failed to fetch"))&&(console.error("  üí° Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{}}function z(U){const Y=U.target;if(Y.tagName==="A"){const le=Y.getAttribute("href");if(le&&le.startsWith("kg:")){U.preventDefault();const Q=le.substring(3);T(Q)}}}function O(){t(4,_=!0)}function N(U){U.type!=="dblclick"&&((U.ctrlKey||U.metaKey)&&U.key==="e"&&(U.preventDefault(),t(4,_=!0)),_&&(U.ctrlKey||U.metaKey)&&U.key==="s"&&(U.preventDefault(),v()),U.key==="Escape"&&(U.preventDefault(),_?t(4,_=!1):t(0,u=!1)))}const E=()=>t(0,u=!1);function G(U){l.$$.not_equal(a.body,U)&&(a.body=U,t(1,a))}const te=()=>t(4,_=!1);function J(U){st[U?"unshift":"push"](()=>{g=U,t(6,g)})}function A(U){u=U,t(0,u)}const R=()=>t(7,y=!1);function se(U){y=U,t(7,y)}return l.$$set=U=>{"active"in U&&t(0,u=U.active),"item"in U&&t(1,a=U.item),"initialEdit"in U&&t(16,d=U.initialEdit),"kgTerm"in U&&t(2,m=U.kgTerm),"kgRank"in U&&t(3,p=U.kgRank)},l.$$.update=()=>{l.$$.dirty&65537&&u&&d&&t(4,_=!0),l.$$.dirty&19&&u&&a&&!_&&C(),l.$$.dirty&2&&t(5,n=a!=null&&a.body?/<html/i.test(a.body)||/<body/i.test(a.body)||/<head/i.test(a.body)||/^\s*<(!DOCTYPE|html|head|body|div|p|span)/i.test(a.body.trim()):!1),l.$$.dirty&32&&t(11,o=n?"html":"markdown")},[u,a,m,p,_,n,g,y,b,k,w,o,v,z,O,N,d,E,G,te,J,A,R,se]}class ql extends dt{constructor(e){super(),pt(this,e,ai,ii,ut,{active:0,item:1,initialEdit:16,kgTerm:2,kgRank:3})}}function Rn(l,e,t){const n=l.slice();return n[33]=e[t],n}function En(l,e,t){const n=l.slice();return n[36]=e[t],n}function Ln(l,e,t){const n=l.slice();return n[39]=e[t],n}function An(l){let e,t;return e=new hs({props:{type:"is-success",$$slots:{default:[ci]},$$scope:{ctx:l}}}),{c(){ve(e.$$.fragment)},m(n,o){be(e,n,o),t=!0},i(n){t||(X(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){ke(e,n)}}}function ci(l){let e,t,n;return{c(){e=f("p"),e.innerHTML="<strong>Success!</strong> Article saved to atomic server successfully.",t=h(),n=f("p"),n.textContent="The modal will close automatically..."},m(o,c){$(o,e,c),$(o,t,c),$(o,n,c)},p:Pe,d(o){o&&S(e),o&&S(t),o&&S(n)}}}function Pn(l){let e,t;return e=new hs({props:{type:"is-danger",$$slots:{default:[ui]},$$scope:{ctx:l}}}),{c(){ve(e.$$.fragment)},m(n,o){be(e,n,o),t=!0},p(n,o){const c={};o[0]&8|o[1]&2048&&(c.$$scope={dirty:o,ctx:n}),e.$set(c)},i(n){t||(X(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){ke(e,n)}}}function ui(l){let e,t,n,o;return{c(){e=f("p"),t=f("strong"),t.textContent="Error:",n=h(),o=q(l[3])},m(c,r){$(c,e,r),s(e,t),s(e,n),s(e,o)},p(c,r){r[0]&8&&we(o,c[3])},d(c){c&&S(e)}}}function On(l){var se,U,Y,le;let e,t,n,o,c,r=(((se=l[1])==null?void 0:se.title)||"Untitled")+"",u,a,d,m,p,_,g=(((U=l[1])==null?void 0:U.rank)||0)+"",y,b,k,w,C,v,T,z,O,N,E=((Y=l[1])==null?void 0:Y.description)&&Nn(l),G=((le=l[1])==null?void 0:le.tags)&&Dn(l);function te(Q,ie){return Q[10].length>0?di:fi}let J=te(l),A=J(l),R=l[10].length>0&&Un(l);return{c(){e=f("div"),t=f("label"),t.textContent="Document to Save",n=h(),o=f("div"),c=f("h5"),u=q(r),a=h(),E&&E.c(),d=h(),m=f("div"),p=f("span"),_=q("Rank: "),y=q(g),b=h(),G&&G.c(),k=h(),w=f("div"),C=f("label"),C.textContent="Atomic Server",v=h(),T=f("div"),A.c(),z=h(),R&&R.c(),O=rt(),i(t,"class","label"),i(c,"class","title is-6"),i(p,"class","tag is-info svelte-48g63o"),i(m,"class","tags svelte-48g63o"),i(o,"class","box document-preview svelte-48g63o"),i(e,"class","field"),i(C,"class","label"),i(C,"for","atomic-server-select"),i(T,"class","control"),i(w,"class","field")},m(Q,ie){$(Q,e,ie),s(e,t),s(e,n),s(e,o),s(o,c),s(c,u),s(o,a),E&&E.m(o,null),s(o,d),s(o,m),s(m,p),s(p,_),s(p,y),s(m,b),G&&G.m(m,null),$(Q,k,ie),$(Q,w,ie),s(w,C),s(w,v),s(w,T),A.m(T,null),$(Q,z,ie),R&&R.m(Q,ie),$(Q,O,ie),N=!0},p(Q,ie){var D,M,V,K;(!N||ie[0]&2)&&r!==(r=(((D=Q[1])==null?void 0:D.title)||"Untitled")+"")&&we(u,r),(M=Q[1])!=null&&M.description?E?E.p(Q,ie):(E=Nn(Q),E.c(),E.m(o,d)):E&&(E.d(1),E=null),(!N||ie[0]&2)&&g!==(g=(((V=Q[1])==null?void 0:V.rank)||0)+"")&&we(y,g),(K=Q[1])!=null&&K.tags?G?G.p(Q,ie):(G=Dn(Q),G.c(),G.m(m,null)):G&&(G.d(1),G=null),J===(J=te(Q))&&A?A.p(Q,ie):(A.d(1),A=J(Q),A&&(A.c(),A.m(T,null))),Q[10].length>0?R?(R.p(Q,ie),ie[0]&1024&&X(R,1)):(R=Un(Q),R.c(),X(R,1),R.m(O.parentNode,O)):R&&(Ze(),re(R,1,1,()=>{R=null}),Xe())},i(Q){N||(X(R),N=!0)},o(Q){re(R),N=!1},d(Q){Q&&S(e),E&&E.d(),G&&G.d(),Q&&S(k),Q&&S(w),A.d(),Q&&S(z),R&&R.d(Q),Q&&S(O)}}}function Nn(l){let e,t=l[1].description+"",n;return{c(){e=f("p"),n=q(t),i(e,"class","content")},m(o,c){$(o,e,c),s(e,n)},p(o,c){c[0]&2&&t!==(t=o[1].description+"")&&we(n,t)},d(o){o&&S(e)}}}function Dn(l){let e,t=l[1].tags,n=[];for(let o=0;o<t.length;o+=1)n[o]=Mn(Ln(l,t,o));return{c(){for(let o=0;o<n.length;o+=1)n[o].c();e=rt()},m(o,c){for(let r=0;r<n.length;r+=1)n[r]&&n[r].m(o,c);$(o,e,c)},p(o,c){if(c[0]&2){t=o[1].tags;let r;for(r=0;r<t.length;r+=1){const u=Ln(o,t,r);n[r]?n[r].p(u,c):(n[r]=Mn(u),n[r].c(),n[r].m(e.parentNode,e))}for(;r<n.length;r+=1)n[r].d(1);n.length=t.length}},d(o){xe(n,o),o&&S(e)}}}function Mn(l){let e,t=l[39]+"",n;return{c(){e=f("span"),n=q(t),i(e,"class","tag svelte-48g63o")},m(o,c){$(o,e,c),s(e,n)},p(o,c){c[0]&2&&t!==(t=o[39]+"")&&we(n,t)},d(o){o&&S(e)}}}function fi(l){let e,t,n,o,c,r,u,a,d;return{c(){e=f("div"),t=f("p"),t.innerHTML="<strong>No atomic servers available</strong>",n=h(),o=f("p"),c=q('Your current role "'),r=q(l[12]),u=q(`" doesn't have any writable atomic server configurations.`),a=h(),d=f("p"),d.textContent="Please configure an atomic server haystack in your role settings.",i(e,"class","notification is-warning")},m(m,p){$(m,e,p),s(e,t),s(e,n),s(e,o),s(o,c),s(o,r),s(o,u),s(e,a),s(e,d)},p(m,p){p[0]&4096&&we(r,m[12])},d(m){m&&S(e)}}}function di(l){let e,t,n,o,c,r,u=l[10],a=[];for(let d=0;d<u.length;d+=1)a[d]=In(En(l,u,d));return{c(){e=f("div"),t=f("select");for(let d=0;d<a.length;d+=1)a[d].c();n=h(),o=f("p"),o.textContent=`Select the atomic server from your current role configuration.
              üîê = Authenticated, ‚ö†Ô∏è = Anonymous access`,i(t,"id","atomic-server-select"),t.disabled=l[2],l[11]===void 0&&it(()=>l[18].call(t)),i(e,"class","select is-fullwidth"),i(o,"class","help svelte-48g63o")},m(d,m){$(d,e,m),s(e,t);for(let p=0;p<a.length;p+=1)a[p]&&a[p].m(t,null);Ke(t,l[11],!0),$(d,n,m),$(d,o,m),c||(r=ne(t,"change",l[18]),c=!0)},p(d,m){if(m[0]&1024){u=d[10];let p;for(p=0;p<u.length;p+=1){const _=En(d,u,p);a[p]?a[p].p(_,m):(a[p]=In(_),a[p].c(),a[p].m(t,null))}for(;p<a.length;p+=1)a[p].d(1);a.length=u.length}m[0]&4&&(t.disabled=d[2]),m[0]&3072&&Ke(t,d[11])},d(d){d&&S(e),xe(a,d),d&&S(n),d&&S(o),c=!1,r()}}}function pi(l){let e;return{c(){e=f("span"),e.textContent="‚ö†Ô∏è No Auth",i(e,"class","has-text-warning")},m(t,n){$(t,e,n)},d(t){t&&S(e)}}}function mi(l){let e;return{c(){e=f("span"),e.textContent="üîê",i(e,"class","has-text-success")},m(t,n){$(t,e,n)},d(t){t&&S(e)}}}function In(l){let e,t=l[36].location+"",n,o,c,r;function u(m,p){return m[36].atomic_server_secret?mi:pi}let a=u(l),d=a(l);return{c(){e=f("option"),n=q(t),o=h(),d.c(),c=h(),e.__value=r=l[36].location,e.value=e.__value},m(m,p){$(m,e,p),s(e,n),s(e,o),d.m(e,null),s(e,c)},p(m,p){p[0]&1024&&t!==(t=m[36].location+"")&&we(n,t),a!==(a=u(m))&&(d.d(1),d=a(m),d&&(d.c(),d.m(e,c))),p[0]&1024&&r!==(r=m[36].location)&&(e.__value=r,e.value=e.__value)},d(m){m&&S(e),d.d()}}}function Un(l){var j,B;let e,t,n,o,c,r,u,a,d,m,p,_,g,y,b,k,w,C,v,T,z,O,N,E,G,te,J,A,R,se,U,Y,le,Q,ie,D,M,V,K,x,I,F,P,L=(l[8]||"Untitled")+"",W,oe,Z,ee,me,_e=(((B=(j=l[1])==null?void 0:j.body)==null?void 0:B.length)||0)+"",fe,de,pe,he,$e,We,je=l[14]()+"",Le,Re,ae,ye,Ne,Be=l[15]()+"",qe,Te,De,et,Je;function Me(H){l[19](H)}let He={id:"article-title",placeholder:"Enter article title",disabled:l[2],required:!0};l[8]!==void 0&&(He.value=l[8]),c=new Yt({props:He}),st.push(()=>at(c,"value",Me));const tt=[hi,_i],ue=[];function Ae(H,ce){return H[7]?1:0}return te=Ae(l),J=ue[te]=tt[te](l),U=new Pl({props:{type:"is-primary",loading:l[2],disabled:l[2]||!l[8].trim()||!l[11],$$slots:{default:[gi]},$$scope:{ctx:l}}}),U.$on("click",l[16]),Q=new Pl({props:{type:"is-light",disabled:l[2],$$slots:{default:[vi]},$$scope:{ctx:l}}}),Q.$on("click",l[17]),De=gs(l[22][0]),{c(){e=f("div"),t=f("label"),t.textContent="Article Title",n=h(),o=f("div"),ve(c.$$.fragment),u=h(),a=f("div"),d=f("label"),d.textContent="Description",m=h(),p=f("div"),_=f("textarea"),g=h(),y=f("div"),b=f("label"),b.textContent="Parent Collection",k=h(),w=f("div"),C=f("label"),v=f("input"),T=q(`
              Use predefined collection`),z=h(),O=f("label"),N=f("input"),E=q(`
              Custom parent URL/path`),G=h(),J.c(),A=h(),R=f("div"),se=f("div"),ve(U.$$.fragment),Y=h(),le=f("div"),ve(Q.$$.fragment),ie=h(),D=f("div"),M=f("div"),V=f("p"),V.innerHTML="<strong>What will be saved:</strong>",K=h(),x=f("ul"),I=f("li"),F=f("strong"),F.textContent="Title:",P=h(),W=q(L),oe=h(),Z=f("li"),ee=f("strong"),ee.textContent="Body:",me=q(" Original document content ("),fe=q(_e),de=q(" characters)"),pe=h(),he=f("li"),$e=f("strong"),$e.textContent="Parent:",We=h(),Le=q(je),Re=h(),ae=f("li"),ye=f("strong"),ye.textContent="Subject URL:",Ne=h(),qe=q(Be),i(t,"class","label"),i(t,"for","article-title"),i(o,"class","control"),i(e,"class","field"),i(d,"class","label"),i(d,"for","article-description"),i(_,"id","article-description"),i(_,"class","textarea"),i(_,"placeholder","Brief description of the article"),_.disabled=l[2],i(_,"rows","3"),i(p,"class","control"),i(a,"class","field"),i(b,"class","label"),i(v,"type","radio"),v.__value=!1,v.value=v.__value,v.disabled=l[2],i(C,"class","radio svelte-48g63o"),i(N,"type","radio"),N.__value=!0,N.value=N.__value,N.disabled=l[2],i(O,"class","radio svelte-48g63o"),i(w,"class","control"),i(y,"class","field"),i(se,"class","control"),i(le,"class","control"),i(R,"class","field is-grouped"),i(I,"class","svelte-48g63o"),i(Z,"class","svelte-48g63o"),i(he,"class","svelte-48g63o"),i(ae,"class","svelte-48g63o"),i(x,"class","svelte-48g63o"),i(M,"class","notification is-info is-light svelte-48g63o"),i(D,"class","field"),De.p(v,N)},m(H,ce){$(H,e,ce),s(e,t),s(e,n),s(e,o),be(c,o,null),$(H,u,ce),$(H,a,ce),s(a,d),s(a,m),s(a,p),s(p,_),Oe(_,l[9]),$(H,g,ce),$(H,y,ce),s(y,b),s(y,k),s(y,w),s(w,C),s(C,v),v.checked=v.__value===l[7],s(C,T),s(w,z),s(w,O),s(O,N),N.checked=N.__value===l[7],s(O,E),$(H,G,ce),ue[te].m(H,ce),$(H,A,ce),$(H,R,ce),s(R,se),be(U,se,null),s(R,Y),s(R,le),be(Q,le,null),$(H,ie,ce),$(H,D,ce),s(D,M),s(M,V),s(M,K),s(M,x),s(x,I),s(I,F),s(I,P),s(I,W),s(x,oe),s(x,Z),s(Z,ee),s(Z,me),s(Z,fe),s(Z,de),s(x,pe),s(x,he),s(he,$e),s(he,We),s(he,Le),s(x,Re),s(x,ae),s(ae,ye),s(ae,Ne),s(ae,qe),Te=!0,et||(Je=[ne(_,"input",l[20]),ne(v,"change",l[21]),ne(N,"change",l[23])],et=!0)},p(H,ce){var Fe,lt;const Se={};ce[0]&4&&(Se.disabled=H[2]),!r&&ce[0]&256&&(r=!0,Se.value=H[8],ct(()=>r=!1)),c.$set(Se),(!Te||ce[0]&4)&&(_.disabled=H[2]),ce[0]&512&&Oe(_,H[9]),(!Te||ce[0]&4)&&(v.disabled=H[2]),ce[0]&128&&(v.checked=v.__value===H[7]),(!Te||ce[0]&4)&&(N.disabled=H[2]),ce[0]&128&&(N.checked=N.__value===H[7]);let Ce=te;te=Ae(H),te===Ce?ue[te].p(H,ce):(Ze(),re(ue[Ce],1,1,()=>{ue[Ce]=null}),Xe(),J=ue[te],J?J.p(H,ce):(J=ue[te]=tt[te](H),J.c()),X(J,1),J.m(A.parentNode,A));const Ve={};ce[0]&4&&(Ve.loading=H[2]),ce[0]&2308&&(Ve.disabled=H[2]||!H[8].trim()||!H[11]),ce[1]&2048&&(Ve.$$scope={dirty:ce,ctx:H}),U.$set(Ve);const nt={};ce[0]&4&&(nt.disabled=H[2]),ce[1]&2048&&(nt.$$scope={dirty:ce,ctx:H}),Q.$set(nt),(!Te||ce[0]&256)&&L!==(L=(H[8]||"Untitled")+"")&&we(W,L),(!Te||ce[0]&2)&&_e!==(_e=(((lt=(Fe=H[1])==null?void 0:Fe.body)==null?void 0:lt.length)||0)+"")&&we(fe,_e)},i(H){Te||(X(c.$$.fragment,H),X(J),X(U.$$.fragment,H),X(Q.$$.fragment,H),Te=!0)},o(H){re(c.$$.fragment,H),re(J),re(U.$$.fragment,H),re(Q.$$.fragment,H),Te=!1},d(H){H&&S(e),ke(c),H&&S(u),H&&S(a),H&&S(g),H&&S(y),H&&S(G),ue[te].d(H),H&&S(A),H&&S(R),ke(U),ke(Q),H&&S(ie),H&&S(D),De.r(),et=!1,Qe(Je)}}}function _i(l){let e,t,n,o,c,r,u;function a(m){l[25](m)}let d={placeholder:"e.g., my-collection or http://server/custom-parent",disabled:l[2]};return l[6]!==void 0&&(d.value=l[6]),n=new Yt({props:d}),st.push(()=>at(n,"value",a)),{c(){e=f("div"),t=f("div"),ve(n.$$.fragment),c=h(),r=f("p"),r.textContent=`Enter a collection name (e.g., "my-articles") or full URL.
              If the collection doesn't exist, it will be created.`,i(t,"class","control"),i(r,"class","help svelte-48g63o"),i(e,"class","field")},m(m,p){$(m,e,p),s(e,t),be(n,t,null),s(e,c),s(e,r),u=!0},p(m,p){const _={};p[0]&4&&(_.disabled=m[2]),!o&&p[0]&64&&(o=!0,_.value=m[6],ct(()=>o=!1)),n.$set(_)},i(m){u||(X(n.$$.fragment,m),u=!0)},o(m){re(n.$$.fragment,m),u=!1},d(m){m&&S(e),ke(n)}}}function hi(l){let e,t,n,o,c,r,u=l[13],a=[];for(let d=0;d<u.length;d+=1)a[d]=jn(Rn(l,u,d));return{c(){e=f("div"),t=f("div"),n=f("div"),o=f("select");for(let d=0;d<a.length;d+=1)a[d].c();o.disabled=l[2],l[5]===void 0&&it(()=>l[24].call(o)),i(n,"class","select is-fullwidth"),i(t,"class","control"),i(e,"class","field")},m(d,m){$(d,e,m),s(e,t),s(t,n),s(n,o);for(let p=0;p<a.length;p+=1)a[p]&&a[p].m(o,null);Ke(o,l[5],!0),c||(r=ne(o,"change",l[24]),c=!0)},p(d,m){if(m[0]&8192){u=d[13];let p;for(p=0;p<u.length;p+=1){const _=Rn(d,u,p);a[p]?a[p].p(_,m):(a[p]=jn(_),a[p].c(),a[p].m(o,null))}for(;p<a.length;p+=1)a[p].d(1);a.length=u.length}m[0]&4&&(o.disabled=d[2]),m[0]&8224&&Ke(o,d[5])},i:Pe,o:Pe,d(d){d&&S(e),xe(a,d),c=!1,r()}}}function jn(l){let e,t=l[33].label+"",n;return{c(){e=f("option"),n=q(t),e.__value=l[33].value,e.value=e.__value},m(o,c){$(o,e,c),s(e,n)},p:Pe,d(o){o&&S(e)}}}function gi(l){let e,t,n;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-cloud-upload-alt"></i>',t=h(),n=f("span"),n.textContent="Save to Atomic Server",i(e,"class","icon")},m(o,c){$(o,e,c),$(o,t,c),$(o,n,c)},p:Pe,d(o){o&&S(e),o&&S(t),o&&S(n)}}}function vi(l){let e;return{c(){e=q("Cancel")},m(t,n){$(t,e,n)},d(t){t&&S(e)}}}function bi(l){let e,t,n,o,c,r,u,a,d,m,p,_,g,y=l[4]&&An(l),b=l[3]&&Pn(l),k=!l[4]&&On(l);return{c(){e=f("div"),t=f("div"),n=f("div"),n.innerHTML=`<div class="level-item"><h3 class="title is-4"><span class="icon"><i class="fas fa-save"></i></span>
            Save to Atomic Server</h3></div>`,o=h(),c=f("div"),r=f("div"),u=f("button"),a=h(),y&&y.c(),d=h(),b&&b.c(),m=h(),k&&k.c(),i(n,"class","level-left"),i(u,"class","delete is-large"),u.disabled=l[2],i(u,"aria-label","close"),i(r,"class","level-item"),i(c,"class","level-right"),i(t,"class","level svelte-48g63o"),i(e,"class","box")},m(w,C){$(w,e,C),s(e,t),s(t,n),s(t,o),s(t,c),s(c,r),s(r,u),s(e,a),y&&y.m(e,null),s(e,d),b&&b.m(e,null),s(e,m),k&&k.m(e,null),p=!0,_||(g=ne(u,"click",l[17]),_=!0)},p(w,C){(!p||C[0]&4)&&(u.disabled=w[2]),w[4]?y?C[0]&16&&X(y,1):(y=An(w),y.c(),X(y,1),y.m(e,d)):y&&(Ze(),re(y,1,1,()=>{y=null}),Xe()),w[3]?b?(b.p(w,C),C[0]&8&&X(b,1)):(b=Pn(w),b.c(),X(b,1),b.m(e,m)):b&&(Ze(),re(b,1,1,()=>{b=null}),Xe()),w[4]?k&&(Ze(),re(k,1,1,()=>{k=null}),Xe()):k?(k.p(w,C),C[0]&16&&X(k,1)):(k=On(w),k.c(),X(k,1),k.m(e,null))},i(w){p||(X(y),X(b),X(k),p=!0)},o(w){re(y),re(b),re(k),p=!1},d(w){w&&S(e),y&&y.d(),b&&b.d(),k&&k.d(),_=!1,g()}}}function ki(l){let e,t,n;function o(r){l[26](r)}let c={$$slots:{default:[bi]},$$scope:{ctx:l}};return l[0]!==void 0&&(c.active=l[0]),e=new Nl({props:c}),st.push(()=>at(e,"active",o)),e.$on("close",l[17]),{c(){ve(e.$$.fragment)},m(r,u){be(e,r,u),n=!0},p(r,u){const a={};u[0]&8190|u[1]&2048&&(a.$$scope={dirty:u,ctx:r}),!t&&u[0]&1&&(t=!0,a.active=r[0],ct(()=>t=!1)),e.$set(a)},i(r){n||(X(e.$$.fragment,r),n=!0)},o(r){re(e.$$.fragment,r),n=!1},d(r){ke(e,r)}}}function wi(l,e,t){let n,o,c;Ue(l,ot,D=>t(27,n=D)),Ue(l,Lt,D=>t(28,o=D)),Ue(l,Et,D=>t(12,c=D));let{active:r=!1}=e,{document:u}=e,a=!1,d=null,m=!1,p="",_="",g=!1,y="",b="",k=[],w="";const C=[{label:"Root (Server Root)",value:""},{label:"Articles Collection",value:"articles"},{label:"Documents Collection",value:"documents"},{label:"Knowledge Base",value:"knowledge-base"},{label:"Research",value:"research"},{label:"Projects",value:"projects"}];function v(){t(2,a=!1),t(3,d=null),t(4,m=!1),t(5,p=""),t(6,_=""),t(7,g=!1),t(8,y=(u==null?void 0:u.title)||""),t(9,b=(u==null?void 0:u.description)||`Article saved from Terraphim search: ${u==null?void 0:u.title}`),t(10,k=[]),t(11,w="")}function T(){var K;const D=c,M=o;if(!(M!=null&&M.roles)||!D){console.warn("No role configuration found");return}let V=null;try{for(const[x,I]of Object.entries(M.roles)){const F=I,P=typeof F.name=="object"?F.name.original:String(F.name);if(x===D||P===D){V=F;break}}}catch(x){console.warn("Error checking role configuration:",x);return}if(!V){console.warn(`Role "${D}" not found in configuration`);return}t(10,k=((K=V.haystacks)==null?void 0:K.filter(x=>x.service==="Atomic"&&x.location&&!x.read_only))||[]),k.length>0&&t(11,w=k[0].location),console.log("Loaded atomic servers:",k)}function z(){const D=k.find(M=>M.location===w);return D==null?void 0:D.atomic_server_secret}function O(){const D=w.replace(/\/$/,"");if(g&&_.trim()){const M=_.trim();return M.startsWith("http://")||M.startsWith("https://")?M:`${D}/${M.replace(/^\//,"")}`}else return p?`${D}/${p}`:D}function N(){return y.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,50)}function E(){const D=w.replace(/\/$/,""),M=N(),V=Date.now();return`${D}/${M}-${V}`}async function G(){if(!w||!y.trim()){t(3,d="Please select an atomic server and provide a title");return}t(2,a=!0),t(3,d=null);try{const D=E(),M=O(),V=z();console.log("üîÑ Saving article to atomic server:",{subject:D,parent:M,server:w,hasSecret:!!V});const K={subject:D,title:y.trim(),description:b.trim(),body:u.body,parent:M,shortname:N(),original_id:u.id,original_url:u.url,original_rank:u.rank,tags:u.tags||[]};if(n)await ze("save_article_to_atomic",{article:K,serverUrl:w,atomicSecret:V});else{const x=await fetch(`${Ye.ServerURL}/atomic/save`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({article:K,server_url:w,atomic_secret:V})});if(!x.ok){const I=await x.json().catch(()=>({error:x.statusText}));throw new Error(I.error||`HTTP ${x.status}: ${x.statusText}`)}}t(4,m=!0),console.log("‚úÖ Article saved successfully to atomic server"),setTimeout(()=>{t(0,r=!1)},2e3)}catch(D){console.error("‚ùå Failed to save article to atomic server:",D),t(3,d=D.message||"Failed to save article to atomic server")}finally{t(2,a=!1)}}function te(){a||t(0,r=!1)}const J=[[]];function A(){w=St(this),t(11,w),t(10,k)}function R(D){y=D,t(8,y)}function se(){b=this.value,t(9,b)}function U(){g=this.__value,t(7,g)}function Y(){g=this.__value,t(7,g)}function le(){p=St(this),t(5,p),t(13,C)}function Q(D){_=D,t(6,_)}function ie(D){r=D,t(0,r)}return l.$$set=D=>{"active"in D&&t(0,r=D.active),"document"in D&&t(1,u=D.document)},l.$$.update=()=>{l.$$.dirty[0]&3&&r&&u&&(v(),T())},[r,u,a,d,m,p,_,g,y,b,k,w,c,C,O,E,G,te,A,R,se,U,J,Y,le,Q,ie]}class yi extends dt{constructor(e){super(),pt(this,e,wi,ki,ut,{active:0,document:1},null,[-1,-1])}}async function Gl(l){return ze("tauri",l)}async function Ci(l,e){return Gl({__tauriModule:"Event",message:{cmd:"unlisten",event:l,eventId:e}})}async function Ti(l,e,t){return Gl({__tauriModule:"Event",message:{cmd:"listen",event:l,windowLabel:e,handler:zl(t)}}).then(n=>async()=>Ci(l,n))}var Hn;(function(l){l.WINDOW_RESIZED="tauri://resize",l.WINDOW_MOVED="tauri://move",l.WINDOW_CLOSE_REQUESTED="tauri://close-requested",l.WINDOW_CREATED="tauri://window-created",l.WINDOW_DESTROYED="tauri://destroyed",l.WINDOW_FOCUS="tauri://focus",l.WINDOW_BLUR="tauri://blur",l.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",l.WINDOW_THEME_CHANGED="tauri://theme-changed",l.WINDOW_FILE_DROP="tauri://file-drop",l.WINDOW_FILE_DROP_HOVER="tauri://file-drop-hover",l.WINDOW_FILE_DROP_CANCELLED="tauri://file-drop-cancelled",l.MENU="tauri://menu",l.CHECK_UPDATE="tauri://update",l.UPDATE_AVAILABLE="tauri://update-available",l.INSTALL_UPDATE="tauri://update-install",l.STATUS_UPDATE="tauri://update-status",l.DOWNLOAD_PROGRESS="tauri://update-download-progress"})(Hn||(Hn={}));async function Si(l,e){return Ti(l,null,e)}function Fn(l,e,t){const n=l.slice();return n[9]=e[t],n}function zn(l){let e,t=l[9].name+"",n,o;return{c(){e=f("option"),n=q(t),e.__value=o=l[9].name,e.value=e.__value},m(c,r){$(c,e,r),s(e,n)},p(c,r){r&1&&t!==(t=c[9].name+"")&&we(n,t),r&1&&o!==(o=c[9].name)&&(e.__value=o,e.value=e.__value)},d(c){c&&S(e)}}}function $i(l){let e,t,n,o,c,r,u=l[0],a=[];for(let d=0;d<u.length;d+=1)a[d]=zn(Fn(l,u,d));return{c(){e=f("div"),t=f("div"),n=f("div"),o=f("select");for(let d=0;d<a.length;d+=1)a[d].c();i(n,"class","select"),i(t,"class","control"),i(e,"class","field is-grouped is-grouped-right")},m(d,m){$(d,e,m),s(e,t),s(t,n),s(n,o);for(let p=0;p<a.length;p+=1)a[p]&&a[p].m(o,null);Ke(o,l[1]),c||(r=ne(o,"change",l[2]),c=!0)},p(d,[m]){if(m&1){u=d[0];let p;for(p=0;p<u.length;p+=1){const _=Fn(d,u,p);a[p]?a[p].p(_,m):(a[p]=zn(_),a[p].c(),a[p].m(o,null))}for(;p<a.length;p+=1)a[p].d(1);a.length=u.length}m&3&&Ke(o,d[1])},i:Pe,o:Pe,d(d){d&&S(e),xe(a,d),c=!1,r()}}}function Ri(l,e,t){let n,o,c,r;Ue(l,Lt,_=>t(5,n=_)),Ue(l,ot,_=>t(6,o=_)),Ue(l,hn,_=>t(0,c=_)),Ue(l,Et,_=>t(1,r=_));let u="";async function a(){try{ot.set(window.__TAURI__!==void 0),o?(console.log("Loading config from Tauri"),ze("get_config").then(_=>{console.log("get_config response",_),_&&_.status==="success"&&d(_.config)}).catch(_=>console.error("Error fetching config in Tauri:",_))):(console.log("Loading config from server"),u=`${Ye.ServerURL}/config/`,fetch(u).then(_=>_.json()).then(_=>{console.log("Config received",_),_&&_.status==="success"&&d(_.config)}).catch(_=>console.error("Error fetching config:",_)))}catch(_){console.error("Unhandled error in loadConfig:",_)}}function d(_){var k;console.log("Updating stores from config:",_);const g={default_role:_.selected_role,..._};Lt.set(g);const y=Object.entries(_.roles).map(([w,C])=>({name:w,...C}));hn.set(y),Et.set(_.selected_role);const b=_.roles[_.selected_role];if(console.log("Selected role settings:",b),b){const w=b.theme||"spacelab";console.log("Setting theme to:",w),_l.set(w),(k=b.kg)!=null&&k.publish?o?ze("publish_thesaurus",{roleName:_.selected_role}).then(C=>{console.log("publish_thesaurus response",C),ml.set(C),Tt.set(!0)}).catch(C=>{console.error("Error publishing thesaurus:",C),Tt.set(!1)}):(console.log("Fetching thesaurus from HTTP endpoint for role",_.selected_role),fetch(`${Ye.ServerURL}/thesaurus/${encodeURIComponent(_.selected_role)}`).then(C=>C.json()).then(C=>{console.log("thesaurus HTTP response",C),C&&C.status==="success"&&C.thesaurus?(ml.set(C.thesaurus),Tt.set(!0)):(console.error("Failed to fetch thesaurus:",C),Tt.set(!1))}).catch(C=>{console.error("Error fetching thesaurus:",C),Tt.set(!1)})):Tt.set(!1)}else console.warn("No role settings found for:",_.selected_role),_l.set("spacelab")}typeof window<"u"&&window.__TAURI__&&Si("role_changed",_=>{console.log("Role changed event received from backend:",_.payload),d(_.payload)});async function m(){await a()}m(),console.log("Using Terraphim Server URL:",Ye.ServerURL);function p(_){var w,C;const y=_.currentTarget.value;console.log("Role change requested:",y),Et.set(y);const b=c.find(v=>v.name===y);if(!b){console.error(`No role settings found for role: ${y}.`);return}const k=b.theme||"spacelab";_l.set(k),console.log(`Theme changed to ${k}`),Lt.update(v=>(v.selected_role=y,v)),o?(ze("select_role",{roleName:y}).catch(v=>console.error("Error selecting role:",v)),(w=b.kg)!=null&&w.publish?(console.log("Publishing thesaurus for role",y),ze("publish_thesaurus",{roleName:y}).then(v=>{ml.set(v),Tt.set(!0)})):Tt.set(!1)):(fetch(`${Ye.ServerURL}/config/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).catch(v=>console.error("Error updating config on server:",v)),(C=b.kg)!=null&&C.publish?(console.log("Fetching thesaurus from HTTP endpoint for role",y),fetch(`${Ye.ServerURL}/thesaurus/${encodeURIComponent(y)}`).then(v=>v.json()).then(v=>{console.log("thesaurus HTTP response",v),v&&v.status==="success"&&v.thesaurus?(ml.set(v.thesaurus),Tt.set(!0)):(console.error("Failed to fetch thesaurus:",v),Tt.set(!1))}).catch(v=>{console.error("Error fetching thesaurus:",v),Tt.set(!1)})):Tt.set(!1))}return[c,r,p,a]}class Al extends dt{constructor(e){super(),pt(this,e,Ri,$i,ut,{loadConfig:3})}get loadConfig(){return this.$$.ctx[3]}}function Kn(l,e,t){const n=l.slice();return n[41]=e[t],n}function qn(l,e,t){const n=l.slice();return n[44]=e[t],n}function Gn(l){let e,t;return e=new vs({props:{$$slots:{default:[Li]},$$scope:{ctx:l}}}),{c(){ve(e.$$.fragment)},m(n,o){be(e,n,o),t=!0},p(n,o){const c={};o[0]&129|o[1]&65536&&(c.$$scope={dirty:o,ctx:n}),e.$set(c)},i(n){t||(X(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){ke(e,n)}}}function Ei(l){let e=l[44]+"",t;return{c(){t=q(e)},m(n,o){$(n,t,o)},p(n,o){o[0]&1&&e!==(e=n[44]+"")&&we(t,e)},d(n){n&&S(t)}}}function Wn(l){let e,t,n,o,c,r;t=new bs({props:{rounded:!0,$$slots:{default:[Ei]},$$scope:{ctx:l}}});function u(){return l[19](l[44])}return{c(){e=f("button"),ve(t.$$.fragment),n=h(),i(e,"class","tag-button svelte-2smypa"),e.disabled=l[7],i(e,"title","Click to view knowledge graph document")},m(a,d){$(a,e,d),be(t,e,null),s(e,n),o=!0,c||(r=ne(e,"click",u),c=!0)},p(a,d){l=a;const m={};d[0]&1|d[1]&65536&&(m.$$scope={dirty:d,ctx:l}),t.$set(m),(!o||d[0]&128)&&(e.disabled=l[7])},i(a){o||(X(t.$$.fragment,a),o=!0)},o(a){re(t.$$.fragment,a),o=!1},d(a){a&&S(e),ke(t),c=!1,r()}}}function Li(l){let e,t,n=l[0].tags,o=[];for(let r=0;r<n.length;r+=1)o[r]=Wn(qn(l,n,r));const c=r=>re(o[r],1,1,()=>{o[r]=null});return{c(){for(let r=0;r<o.length;r+=1)o[r].c();e=rt()},m(r,u){for(let a=0;a<o.length;a+=1)o[a]&&o[a].m(r,u);$(r,e,u),t=!0},p(r,u){if(u[0]&131201){n=r[0].tags;let a;for(a=0;a<n.length;a+=1){const d=qn(r,n,a);o[a]?(o[a].p(d,u),X(o[a],1)):(o[a]=Wn(d),o[a].c(),X(o[a],1),o[a].m(e.parentNode,e))}for(Ze(),a=n.length;a<o.length;a+=1)c(a);Xe()}},i(r){if(!t){for(let u=0;u<n.length;u+=1)X(o[u]);t=!0}},o(r){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)re(o[u]);t=!1},d(r){xe(o,r),r&&S(e)}}}function Ai(l){let e,t=(l[0].rank||0)+"",n;return{c(){e=q("Rank "),n=q(t)},m(o,c){$(o,e,c),$(o,n,c)},p(o,c){c[0]&1&&t!==(t=(o[0].rank||0)+"")&&we(n,t)},d(o){o&&S(e),o&&S(n)}}}function Pi(l){let e,t;return e=new bs({props:{rounded:!0,$$slots:{default:[Ai]},$$scope:{ctx:l}}}),{c(){ve(e.$$.fragment)},m(n,o){be(e,n,o),t=!0},p(n,o){const c={};o[0]&1|o[1]&65536&&(c.$$scope={dirty:o,ctx:n}),e.$set(c)},i(n){t||(X(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){ke(e,n)}}}function Oi(l){let e;return{c(){e=f("small"),e.textContent="No description available",i(e,"class","no-description svelte-2smypa")},m(t,n){$(t,e,n)},p:Pe,i:Pe,o:Pe,d(t){t&&S(e)}}}function Ni(l){let e,t;return e=new Ml({props:{source:l[0].description}}),{c(){ve(e.$$.fragment)},m(n,o){be(e,n,o),t=!0},p(n,o){const c={};o[0]&1&&(c.source=n[0].description),e.$set(c)},i(n){t||(X(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){ke(e,n)}}}function Bn(l){let e,t,n,o,c,r;return{c(){e=f("button"),t=f("span"),t.innerHTML='<i class="fas fa-magic" aria-hidden="true"></i>',n=h(),o=f("span"),o.textContent="AI Summary",i(t,"class","icon is-small"),i(e,"class","button is-small is-info is-outlined ai-summary-button svelte-2smypa"),e.disabled=l[9],i(e,"title","Generate AI-powered summary using OpenRouter")},m(u,a){$(u,e,a),s(e,t),s(e,n),s(e,o),c||(r=ne(e,"click",l[18]),c=!0)},p(u,a){a[0]&512&&(e.disabled=u[9])},d(u){u&&S(e),c=!1,r()}}}function Jn(l){let e;return{c(){e=f("div"),e.innerHTML=`<span class="icon"><i class="fas fa-spinner fa-spin" aria-hidden="true"></i></span> 
                <small>Generating AI summary...</small>`,i(e,"class","ai-summary-loading svelte-2smypa")},m(t,n){$(t,e,n)},d(t){t&&S(e)}}}function Vn(l){let e,t,n,o,c,r,u,a,d,m;return{c(){e=f("div"),t=f("span"),t.innerHTML='<i class="fas fa-exclamation-triangle" aria-hidden="true"></i>',n=h(),o=f("small"),c=q("Summary error: "),r=q(l[10]),u=h(),a=f("button"),a.textContent="Retry",i(t,"class","icon has-text-danger"),i(o,"class","has-text-danger"),i(a,"class","button is-small is-text svelte-2smypa"),i(a,"title","Retry generating summary"),i(e,"class","ai-summary-error svelte-2smypa")},m(p,_){$(p,e,_),s(e,t),s(e,n),s(e,o),s(o,c),s(o,r),s(e,u),s(e,a),d||(m=ne(a,"click",l[20]),d=!0)},p(p,_){_[0]&1024&&we(r,p[10])},d(p){p&&S(e),d=!1,m()}}}function Qn(l){let e,t,n,o,c,r,u,a,d,m,p,_,g,y,b,k,w,C,v,T;function z(E,G){return E[12]?Mi:Di}let O=z(l),N=O(l);return m=new Ml({props:{source:l[8]}}),{c(){e=f("div"),t=f("div"),n=f("small"),o=f("span"),o.innerHTML='<i class="fas fa-robot" aria-hidden="true"></i>',c=q(`
                    AI Summary
                    `),N.c(),r=h(),u=f("button"),u.innerHTML='<span class="icon is-small"><i class="fas fa-times" aria-hidden="true"></i></span>',a=h(),d=f("div"),ve(m.$$.fragment),p=h(),_=f("div"),g=f("button"),y=f("span"),y.innerHTML='<i class="fas fa-redo" aria-hidden="true"></i>',b=h(),k=f("span"),k.textContent="Regenerate",i(o,"class","icon is-small"),i(n,"class","ai-summary-label svelte-2smypa"),i(u,"class","button is-small is-text svelte-2smypa"),i(u,"title","Hide AI summary"),i(t,"class","ai-summary-header svelte-2smypa"),i(d,"class","ai-summary-content svelte-2smypa"),i(y,"class","icon is-small"),i(g,"class","button is-small is-text svelte-2smypa"),g.disabled=l[9],i(g,"title","Regenerate summary"),i(_,"class","ai-summary-actions svelte-2smypa"),i(e,"class","ai-summary svelte-2smypa")},m(E,G){$(E,e,G),s(e,t),s(t,n),s(n,o),s(n,c),N.m(n,null),s(t,r),s(t,u),s(e,a),s(e,d),be(m,d,null),s(e,p),s(e,_),s(_,g),s(g,y),s(g,b),s(g,k),C=!0,v||(T=[ne(u,"click",l[21]),ne(g,"click",l[22])],v=!0)},p(E,G){O!==(O=z(E))&&(N.d(1),N=O(E),N&&(N.c(),N.m(n,null)));const te={};G[0]&256&&(te.source=E[8]),m.$set(te),(!C||G[0]&512)&&(g.disabled=E[9])},i(E){C||(X(m.$$.fragment,E),it(()=>{C&&(w||(w=il(e,al,{},!0)),w.run(1))}),C=!0)},o(E){re(m.$$.fragment,E),w||(w=il(e,al,{},!1)),w.run(0),C=!1},d(E){E&&S(e),N.d(),ke(m),E&&w&&w.end(),v=!1,Qe(T)}}}function Di(l){let e;return{c(){e=f("span"),e.textContent="fresh",i(e,"class","tag is-small is-success")},m(t,n){$(t,e,n)},d(t){t&&S(e)}}}function Mi(l){let e;return{c(){e=f("span"),e.textContent="cached",i(e,"class","tag is-small is-light")},m(t,n){$(t,e,n)},d(t){t&&S(e)}}}function Yn(l){let e;function t(c,r){return c[41].disabled?ji:c[41].isLink?Ui:Ii}let n=t(l),o=n(l);return{c(){o.c(),e=rt()},m(c,r){o.m(c,r),$(c,e,r)},p(c,r){n===(n=t(c))&&o?o.p(c,r):(o.d(1),o=n(c),o&&(o.c(),o.m(e.parentNode,e)))},d(c){o.d(c),c&&S(e)}}}function Ii(l){let e,t,n,o,c,r,u,a,d,m;return{c(){var p,_,g;e=f("button"),t=f("span"),n=f("i"),c=h(),i(n,"class",o=Dt(l[41].icon)+" svelte-2smypa"),i(t,"class","icon is-medium"),ft(t,"has-text-primary",(p=l[41].className)==null?void 0:p.includes("primary")),ft(t,"has-text-success",(_=l[41].className)==null?void 0:_.includes("success")),ft(t,"has-text-danger",(g=l[41].className)==null?void 0:g.includes("danger")),i(e,"type","button"),i(e,"class","level-item button is-ghost svelte-2smypa"),i(e,"aria-label",r=l[41].title),i(e,"title",u=l[41].title),i(e,"data-testid",a=l[41].testId||"")},m(p,_){$(p,e,_),s(e,t),s(t,n),s(e,c),d||(m=ne(e,"click",function(){Dl(l[41].action)&&l[41].action.apply(this,arguments)}),d=!0)},p(p,_){var g,y,b;l=p,_[0]&32768&&o!==(o=Dt(l[41].icon)+" svelte-2smypa")&&i(n,"class",o),_[0]&32768&&ft(t,"has-text-primary",(g=l[41].className)==null?void 0:g.includes("primary")),_[0]&32768&&ft(t,"has-text-success",(y=l[41].className)==null?void 0:y.includes("success")),_[0]&32768&&ft(t,"has-text-danger",(b=l[41].className)==null?void 0:b.includes("danger")),_[0]&32768&&r!==(r=l[41].title)&&i(e,"aria-label",r),_[0]&32768&&u!==(u=l[41].title)&&i(e,"title",u),_[0]&32768&&a!==(a=l[41].testId||"")&&i(e,"data-testid",a)},d(p){p&&S(e),d=!1,m()}}}function Ui(l){let e,t,n,o,c,r,u,a;return{c(){e=f("a"),t=f("span"),n=f("i"),c=h(),i(n,"class",o=Dt(l[41].icon)+" svelte-2smypa"),i(t,"class","icon is-medium"),ft(t,"has-text-primary",l[41].className),i(e,"href",r=l[41].href),i(e,"target","_blank"),i(e,"class","level-item"),i(e,"aria-label",u=l[41].title),i(e,"title",a=l[41].title)},m(d,m){$(d,e,m),s(e,t),s(t,n),s(e,c)},p(d,m){m[0]&32768&&o!==(o=Dt(d[41].icon)+" svelte-2smypa")&&i(n,"class",o),m[0]&32768&&ft(t,"has-text-primary",d[41].className),m[0]&32768&&r!==(r=d[41].href)&&i(e,"href",r),m[0]&32768&&u!==(u=d[41].title)&&i(e,"aria-label",u),m[0]&32768&&a!==(a=d[41].title)&&i(e,"title",a)},d(d){d&&S(e)}}}function ji(l){let e,t,n,o,c,r,u;return{c(){e=f("button"),t=f("span"),n=f("i"),c=h(),i(n,"class",o=Dt(l[41].icon)+" svelte-2smypa"),i(t,"class","icon is-medium"),ft(t,"has-text-primary",l[41].className),i(e,"type","button"),i(e,"class","level-item button is-ghost svelte-2smypa"),i(e,"aria-label",r=l[41].title),i(e,"title",u=l[41].title),e.disabled=!0},m(a,d){$(a,e,d),s(e,t),s(t,n),s(e,c)},p(a,d){d[0]&32768&&o!==(o=Dt(a[41].icon)+" svelte-2smypa")&&i(n,"class",o),d[0]&32768&&ft(t,"has-text-primary",a[41].className),d[0]&32768&&r!==(r=a[41].title)&&i(e,"aria-label",r),d[0]&32768&&u!==(u=a[41].title)&&i(e,"title",u)},d(a){a&&S(e)}}}function Zn(l){let e,t=l[41].visible&&Yn(l);return{c(){t&&t.c(),e=rt()},m(n,o){t&&t.m(n,o),$(n,e,o)},p(n,o){n[41].visible?t?t.p(n,o):(t=Yn(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(n){t&&t.d(n),n&&S(e)}}}function Xn(l){let e,t,n,o,c,r;return{c(){e=f("div"),t=f("button"),n=h(),o=q(l[13]),i(t,"class","delete svelte-2smypa"),i(e,"class","notification is-danger is-light mt-2")},m(u,a){$(u,e,a),s(e,t),s(e,n),s(e,o),c||(r=ne(t,"click",l[23]),c=!0)},p(u,a){a[0]&8192&&we(o,u[13])},d(u){u&&S(e),c=!1,r()}}}function xn(l){let e,t,n;function o(r){l[25](r)}let c={item:l[4],kgTerm:l[5],kgRank:l[6]};return l[2]!==void 0&&(c.active=l[2]),e=new ql({props:c}),st.push(()=>at(e,"active",o)),{c(){ve(e.$$.fragment)},m(r,u){be(e,r,u),n=!0},p(r,u){const a={};u[0]&16&&(a.item=r[4]),u[0]&32&&(a.kgTerm=r[5]),u[0]&64&&(a.kgRank=r[6]),!t&&u[0]&4&&(t=!0,a.active=r[2],ct(()=>t=!1)),e.$set(a)},i(r){n||(X(e.$$.fragment,r),n=!0)},o(r){re(e.$$.fragment,r),n=!1},d(r){ke(e,r)}}}function eo(l){let e,t,n;function o(r){l[26](r)}let c={document:l[0]};return l[3]!==void 0&&(c.active=l[3]),e=new yi({props:c}),st.push(()=>at(e,"active",o)),{c(){ve(e.$$.fragment)},m(r,u){be(e,r,u),n=!0},p(r,u){const a={};u[0]&1&&(a.document=r[0]),!t&&u[0]&8&&(t=!0,a.active=r[3],ct(()=>t=!1)),e.$set(a)},i(r){n||(X(e.$$.fragment,r),n=!0)},o(r){re(e.$$.fragment,r),n=!1},d(r){ke(e,r)}}}function Hi(l){let e,t,n,o,c,r,u,a,d,m,p,_,g=l[0].title+"",y,b,k,w,C,v,T,z,O,N,E,G,te,J,A,R,se,U,Y,le,Q,ie,D,M,V,K,x,I,F,P,L,W=l[0].tags&&Gn(l);a=new vs({props:{$$slots:{default:[Pi]},$$scope:{ctx:l}}});const oe=[Ni,Oi],Z=[];function ee(ae,ye){return ae[0].description?0:1}T=ee(l),z=Z[T]=oe[T](l);let me=!l[11]&&!l[9]&&!l[10]&&Bn(l),_e=l[9]&&Jn(),fe=l[10]&&Vn(l),de=l[11]&&l[8]&&Qn(l),pe=l[15],he=[];for(let ae=0;ae<pe.length;ae+=1)he[ae]=Zn(Kn(l,pe,ae));let $e=l[13]&&Xn(l);function We(ae){l[24](ae)}let je={item:l[0]};l[1]!==void 0&&(je.active=l[1]),M=new ql({props:je}),st.push(()=>at(M,"active",We));let Le=l[4]&&xn(l),Re=l[14]&&eo(l);return{c(){e=f("div"),t=f("article"),n=f("div"),o=f("div"),c=f("div"),W&&W.c(),r=h(),u=f("div"),ve(a.$$.fragment),d=h(),m=f("div"),p=f("button"),_=f("h2"),y=q(g),b=h(),k=f("div"),w=f("small"),w.textContent="Description:",C=h(),v=f("div"),z.c(),O=h(),N=f("div"),me&&me.c(),E=h(),_e&&_e.c(),G=h(),fe&&fe.c(),te=h(),de&&de.c(),J=h(),A=f("br"),se=h(),U=f("div"),Y=f("nav"),le=f("div");for(let ae=0;ae<he.length;ae+=1)he[ae].c();ie=h(),$e&&$e.c(),D=h(),ve(M.$$.fragment),K=h(),Le&&Le.c(),x=h(),Re&&Re.c(),I=rt(),i(c,"class","level-right"),i(u,"class","level-right"),i(_,"class","title svelte-2smypa"),i(p,"class","svelte-2smypa"),i(w,"class","description-label svelte-2smypa"),i(v,"class","description-content svelte-2smypa"),i(k,"class","description svelte-2smypa"),i(N,"class","ai-summary-section svelte-2smypa"),i(o,"class","content"),i(le,"class","level-right"),i(Y,"class","level is-mobile"),i(U,"class","level-right"),i(n,"class","media-content"),i(t,"class","media"),i(e,"class","box")},m(ae,ye){$(ae,e,ye),s(e,t),s(t,n),s(n,o),s(o,c),W&&W.m(c,null),s(o,r),s(o,u),be(a,u,null),s(o,d),s(o,m),s(m,p),s(p,_),s(_,y),s(m,b),s(m,k),s(k,w),s(k,C),s(k,v),Z[T].m(v,null),s(m,O),s(m,N),me&&me.m(N,null),s(N,E),_e&&_e.m(N,null),s(N,G),fe&&fe.m(N,null),s(N,te),de&&de.m(N,null),s(m,J),s(m,A),s(n,se),s(n,U),s(U,Y),s(Y,le);for(let Ne=0;Ne<he.length;Ne+=1)he[Ne]&&he[Ne].m(le,null);s(e,ie),$e&&$e.m(e,null),$(ae,D,ye),be(M,ae,ye),$(ae,K,ye),Le&&Le.m(ae,ye),$(ae,x,ye),Re&&Re.m(ae,ye),$(ae,I,ye),F=!0,P||(L=ne(p,"click",l[16]),P=!0)},p(ae,ye){ae[0].tags?W?(W.p(ae,ye),ye[0]&1&&X(W,1)):(W=Gn(ae),W.c(),X(W,1),W.m(c,null)):W&&(Ze(),re(W,1,1,()=>{W=null}),Xe());const Ne={};ye[0]&1|ye[1]&65536&&(Ne.$$scope={dirty:ye,ctx:ae}),a.$set(Ne),(!F||ye[0]&1)&&g!==(g=ae[0].title+"")&&we(y,g);let Be=T;if(T=ee(ae),T===Be?Z[T].p(ae,ye):(Ze(),re(Z[Be],1,1,()=>{Z[Be]=null}),Xe(),z=Z[T],z?z.p(ae,ye):(z=Z[T]=oe[T](ae),z.c()),X(z,1),z.m(v,null)),!ae[11]&&!ae[9]&&!ae[10]?me?me.p(ae,ye):(me=Bn(ae),me.c(),me.m(N,E)):me&&(me.d(1),me=null),ae[9]?_e||(_e=Jn(),_e.c(),_e.m(N,G)):_e&&(_e.d(1),_e=null),ae[10]?fe?fe.p(ae,ye):(fe=Vn(ae),fe.c(),fe.m(N,te)):fe&&(fe.d(1),fe=null),ae[11]&&ae[8]?de?(de.p(ae,ye),ye[0]&2304&&X(de,1)):(de=Qn(ae),de.c(),X(de,1),de.m(N,null)):de&&(Ze(),re(de,1,1,()=>{de=null}),Xe()),ye[0]&32768){pe=ae[15];let Te;for(Te=0;Te<pe.length;Te+=1){const De=Kn(ae,pe,Te);he[Te]?he[Te].p(De,ye):(he[Te]=Zn(De),he[Te].c(),he[Te].m(le,null))}for(;Te<he.length;Te+=1)he[Te].d(1);he.length=pe.length}ae[13]?$e?$e.p(ae,ye):($e=Xn(ae),$e.c(),$e.m(e,null)):$e&&($e.d(1),$e=null);const qe={};ye[0]&1&&(qe.item=ae[0]),!V&&ye[0]&2&&(V=!0,qe.active=ae[1],ct(()=>V=!1)),M.$set(qe),ae[4]?Le?(Le.p(ae,ye),ye[0]&16&&X(Le,1)):(Le=xn(ae),Le.c(),X(Le,1),Le.m(x.parentNode,x)):Le&&(Ze(),re(Le,1,1,()=>{Le=null}),Xe()),ae[14]?Re?(Re.p(ae,ye),ye[0]&16384&&X(Re,1)):(Re=eo(ae),Re.c(),X(Re,1),Re.m(I.parentNode,I)):Re&&(Ze(),re(Re,1,1,()=>{Re=null}),Xe())},i(ae){F||(X(W),X(a.$$.fragment,ae),X(z),X(de),it(()=>{F&&(R||(R=il(m,al,{},!0)),R.run(1))}),it(()=>{F&&(Q||(Q=il(Y,al,{},!0)),Q.run(1))}),X(M.$$.fragment,ae),X(Le),X(Re),F=!0)},o(ae){re(W),re(a.$$.fragment,ae),re(z),re(de),R||(R=il(m,al,{},!1)),R.run(0),Q||(Q=il(Y,al,{},!1)),Q.run(0),re(M.$$.fragment,ae),re(Le),re(Re),F=!1},d(ae){ae&&S(e),W&&W.d(),ke(a),Z[T].d(),me&&me.d(),_e&&_e.d(),fe&&fe.d(),de&&de.d(),ae&&R&&R.end(),xe(he,ae),ae&&Q&&Q.end(),$e&&$e.d(),ae&&S(D),ke(M,ae),ae&&S(K),Le&&Le.d(ae),ae&&S(x),Re&&Re.d(ae),ae&&S(I),P=!1,L()}}}function Fi(l,e,t){let n,o,c,r,u;Ue(l,Et,L=>t(31,c=L)),Ue(l,ot,L=>t(32,r=L)),Ue(l,Lt,L=>t(33,u=L));let{document:a}=e,d=!1,m=!1,p=!1,_=null,g=null,y=null,b=!1,k=null,w=!1,C=null,v=!1,T=!1,z=!1,O=!1,N=null,E=!1,G=!1;function te(){const L=[];return L.push({id:"download-markdown",label:"Download to Markdown",icon:"fas fa-download",action:()=>Y(),visible:!0,title:"Download document as markdown file"}),n&&L.push({id:"save-atomic",label:"Save to Atomic Server",icon:"fas fa-cloud-upload-alt",action:()=>R(),visible:!0,title:"Save article to Atomic Server",className:"has-text-primary"}),a.url&&L.push({id:"external-url",label:"Open URL",icon:"fas fa-link",action:()=>window.open(a.url,"_blank"),visible:!0,title:"Open original URL in new tab",isLink:!0,href:a.url}),L.push({id:"open-vscode",label:"Open in VSCode",icon:"fas fa-code",action:()=>le(),visible:!0,title:"Open document in VSCode",isLink:!0,href:`vscode://${encodeURIComponent(a.title)}.md?${encodeURIComponent(a.body)}`}),L.push({id:"add-context",label:O?"Added to Context ‚úì":z?"Adding...":"Add to Context",icon:O?"fas fa-check-circle":z?"fas fa-spinner fa-spin":"fas fa-plus-circle",action:()=>Q(),visible:!0,title:O?"Document successfully added to chat context. Go to Chat tab to see it.":"Add document to LLM conversation context",disabled:z||O,className:O?"has-text-success":N?"has-text-danger":"",testId:"add-to-context-button"}),L.push({id:"chat-with-document",label:G?"Opening Chat...":E?"Adding to Chat...":"Chat with Document",icon:G?"fas fa-external-link-alt":E?"fas fa-spinner fa-spin":"fas fa-comment-dots",action:()=>ie(),visible:!0,title:G?"Opening chat with this document":"Add document to context and open chat",disabled:E||G||z,className:G?"has-text-info":N?"has-text-danger":"has-text-primary",testId:"chat-with-document-button"}),L}function J(){var ee;const L=c,W=u;if(!(W!=null&&W.roles)||!L)return!1;let oe=null;try{for(const[me,_e]of Object.entries(W.roles)){const fe=_e,de=typeof fe.name=="object"?fe.name.original:String(fe.name);if(me===L||de===L){oe=fe;break}}}catch(me){return console.warn("Error checking role configuration:",me),!1}return oe?(((ee=oe.haystacks)==null?void 0:ee.filter(me=>me.service==="Atomic"&&me.location&&!me.read_only))||[]).length>0:!1}const A=()=>{t(1,d=!0)},R=()=>{console.log("üîÑ Opening atomic save modal for document:",a.title),t(3,p=!0)};async function se(L){var W,oe,Z,ee,me;t(7,b=!0),t(5,g=L),console.log("üîç KG Search Debug Info:"),console.log("  Tag clicked:",L),console.log("  Current role:",c),console.log("  Is Tauri mode:",r);try{if(r){console.log("  Making Tauri invoke call..."),console.log("  Tauri command: find_documents_for_kg_term"),console.log("  Tauri params:",{roleName:c,term:L});const _e=await ze("find_documents_for_kg_term",{roleName:c,term:L});console.log("  üì• Tauri response received:"),console.log("    Status:",_e.status),console.log("    Results count:",((W=_e.results)==null?void 0:W.length)||0),console.log("    Total:",_e.total||0),console.log("    Full response:",JSON.stringify(_e,null,2)),_e.status==="success"&&_e.results&&_e.results.length>0?(t(4,_=_e.results[0]),t(6,y=_.rank||0),console.log("  ‚úÖ Found KG document:"),console.log("    Title:",_.title),console.log("    Rank:",y),console.log("    Body length:",((oe=_.body)==null?void 0:oe.length)||0,"characters"),t(2,m=!0)):(console.warn(`  ‚ö†Ô∏è  No KG documents found for term: "${L}" in role: "${c}"`),console.warn("    This could indicate:"),console.warn("    1. Knowledge graph not built for this role"),console.warn("    2. Term not found in knowledge graph"),console.warn("    3. Role not configured with TerraphimGraph relevance function"),console.warn("    Suggestion: Check server logs for KG building status"))}else{console.log("  Making HTTP fetch call...");const _e=Ye.ServerURL,fe=encodeURIComponent(c),de=encodeURIComponent(L),pe=`${_e}/roles/${fe}/kg_search?term=${de}`;console.log("  üì§ HTTP Request details:"),console.log("    Base URL:",_e),console.log("    Role (encoded):",fe),console.log("    Term (encoded):",de),console.log("    Full URL:",pe);const he=await fetch(pe);if(console.log("  üì• HTTP Response received:"),console.log("    Status code:",he.status),console.log("    Status text:",he.statusText),console.log("    Headers:",Object.fromEntries(he.headers.entries())),!he.ok)throw new Error(`HTTP error! Status: ${he.status} - ${he.statusText}`);const $e=await he.json();console.log("  üìÑ Response data:"),console.log("    Status:",$e.status),console.log("    Results count:",((Z=$e.results)==null?void 0:Z.length)||0),console.log("    Total:",$e.total||0),console.log("    Full response:",JSON.stringify($e,null,2)),$e.status==="success"&&$e.results&&$e.results.length>0?(t(4,_=$e.results[0]),t(6,y=_.rank||0),console.log("  ‚úÖ Found KG document:"),console.log("    Title:",_.title),console.log("    Rank:",y),console.log("    Body length:",((ee=_.body)==null?void 0:ee.length)||0,"characters"),t(2,m=!0)):(console.warn(`  ‚ö†Ô∏è  No KG documents found for term: "${L}" in role: "${c}"`),console.warn("    This could indicate:"),console.warn("    1. Server not configured with Terraphim Engineer role"),console.warn("    2. Knowledge graph not built on server"),console.warn("    3. Term not found in knowledge graph"),console.warn("    Suggestion: Check server logs at startup for KG building status"),console.warn("    API URL tested:",pe))}}catch(_e){console.error("‚ùå Error fetching KG document:"),console.error("  Error type:",_e.constructor.name),console.error("  Error message:",_e.message||_e),console.error("  Request details:",{tag:L,role:c,isTauri:r,timestamp:new Date().toISOString()}),!r&&((me=_e.message)!=null&&me.includes("Failed to fetch"))&&(console.error("  üí° Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Check CORS configuration"),console.error("    3. Verify server URL in CONFIG.ServerURL"))}finally{t(7,b=!1)}}async function U(){var L;if(!(w||!a.id||!c)){t(9,w=!0),t(10,C=null),console.log("ü§ñ AI Summary Debug Info:"),console.log("  Document ID:",a.id),console.log("  Current role:",c),console.log("  Is Tauri mode:",r);try{const W={document_id:a.id,role:c,max_length:250,force_regenerate:!1};console.log("  üì§ Summarization request:",W);let oe;if(r){const me=`${Ye.ServerURL}/documents/summarize`;oe=await fetch(me,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(W)})}else{const me=`${Ye.ServerURL}/documents/summarize`;oe=await fetch(me,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(W)})}if(console.log("  üì• Summary response received:"),console.log("    Status code:",oe.status),console.log("    Status text:",oe.statusText),!oe.ok)throw new Error(`HTTP error! Status: ${oe.status} - ${oe.statusText}`);const Z=await oe.json();console.log("  üìÑ Summary response data:",Z),Z.status==="success"&&Z.summary?(t(8,k=Z.summary),t(12,T=Z.from_cache||!1),t(11,v=!0),console.log("  ‚úÖ Summary generated successfully"),console.log("    Summary length:",k.length,"characters"),console.log("    From cache:",T),console.log("    Model used:",Z.model_used)):(t(10,C=Z.error||"Failed to generate summary"),console.error("  ‚ùå Summary generation failed:",C))}catch(W){console.error("‚ùå Error generating summary:"),console.error("  Error type:",W.constructor.name),console.error("  Error message:",W.message||W),console.error("  Request details:",{document_id:a.id,role:c,isTauri:r,timestamp:new Date().toISOString()}),t(10,C=W.message||"Network error occurred"),(L=W.message)!=null&&L.includes("Failed to fetch")&&(console.error("  üí° Network error suggestions:"),console.error("    1. Check if server is running on expected port"),console.error("    2. Verify OpenRouter is enabled for this role"),console.error("    3. Check OPENROUTER_KEY environment variable"),console.error("    4. Verify server URL in CONFIG.ServerURL"))}finally{t(9,w=!1)}}}function Y(){console.log("üì• Downloading document as markdown:",a.title);let L=`# ${a.title}

`;L+=`**Source:** Terraphim Search
`,L+=`**Rank:** ${a.rank||"N/A"}
`,a.url&&(L+=`**URL:** ${a.url}
`),a.tags&&a.tags.length>0&&(L+=`**Tags:** ${a.tags.join(", ")}
`),L+=`**Downloaded:** ${new Date().toISOString()}

`,a.description&&(L+=`## Description

${a.description}

`),L+=`## Content

${a.body}
`;const W=`${a.title.replace(/[^a-z0-9]/gi,"_").toLowerCase()}_${Date.now()}.md`,oe=new Blob([L],{type:"text/markdown"}),Z=URL.createObjectURL(oe),ee=window.document.createElement("a");ee.href=Z,ee.download=W,window.document.body.appendChild(ee),ee.click(),window.document.body.removeChild(ee),URL.revokeObjectURL(Z),console.log("‚úÖ Markdown file downloaded:",W)}function le(){const L=`vscode://${encodeURIComponent(a.title)}.md?${encodeURIComponent(a.body)}`;window.open(L,"_blank")}async function Q(){console.log("üìù Adding document to LLM context:",a.title),z=!0,O=!1,t(13,N=null);try{let L=null;if(r){try{const ee=await ze("list_conversations");if(console.log("üìã Available conversations:",ee),ee!=null&&ee.conversations&&ee.conversations.length>0)L=ee.conversations[0].id,console.log("üéØ Using existing conversation:",L);else{const me=await ze("create_conversation",{title:"Search Context",role:c||"default"});if(me.status==="success"&&me.conversation_id)L=me.conversation_id,console.log("üÜï Created new conversation:",L);else throw new Error("Failed to create conversation: "+(me.error||"Unknown error"))}}catch(ee){throw console.error("‚ùå Failed to manage conversations:",ee),new Error("Could not create or find conversation: "+ee.message)}const oe={source_type:"document",document_id:a.id};a.url&&(oe.url=a.url),a.tags&&a.tags.length>0&&(oe.tags=a.tags.join(", ")),a.rank!==void 0&&(oe.rank=a.rank.toString());const Z=await ze("add_context_to_conversation",{conversationId:L,contextType:"document",title:a.title,content:a.body,metadata:oe});console.log("‚úÖ Document added to context via Tauri:",Z)}else{const oe=Ye.ServerURL;try{const _e=await fetch(`${oe}/conversations`);if(_e.ok){const fe=await _e.json();if(fe.conversations&&fe.conversations.length>0)L=fe.conversations[0].id,console.log("üéØ Using existing conversation:",L);else{const de=await fetch(`${oe}/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"Search Context",role:c||"default"})});if(de.ok){const pe=await de.json();if(pe.status==="success"&&pe.conversation_id)L=pe.conversation_id,console.log("üÜï Created new conversation:",L);else throw new Error("Failed to create conversation: "+(pe.error||"Unknown error"))}else throw new Error(`Failed to create conversation: ${de.status} ${de.statusText}`)}}else throw new Error(`Failed to list conversations: ${_e.status} ${_e.statusText}`)}catch(_e){throw console.error("‚ùå Failed to manage conversations:",_e),new Error("Could not create or find conversation: "+_e.message)}const Z=`${oe}/conversations/${L}/context`,ee=await fetch(Z,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context_type:"document",title:a.title,content:a.body,metadata:{source_type:"document",document_id:a.id,url:a.url||"",tags:a.tags?a.tags.join(", "):"",rank:a.rank?a.rank.toString():"0"}})});if(!ee.ok)throw new Error(`HTTP error! Status: ${ee.status} - ${ee.statusText}`);const me=await ee.json();console.log("‚úÖ Document added to context via HTTP:",me)}console.log("‚úÖ Successfully added document to LLM context"),O=!0;const W=window.document.createElement("div");W.className="notification is-success is-light",W.innerHTML=`
        <button class="delete" onclick="this.parentElement.remove()"></button>
        <strong>‚úì Added to Chat Context</strong><br>
        <small>Document added successfully. <a href="/chat" class="has-text-success has-text-weight-bold">Go to Chat ‚Üí</a> to see it in the context panel.</small>
      `,W.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(W),setTimeout(()=>{W.remove()},8e3),setTimeout(()=>{O=!1},5e3)}catch(L){console.error("‚ùå Error adding document to context:",L),t(13,N=L.message||"Failed to add document to context");const W=window.document.createElement("div");W.className="notification is-danger is-light",W.innerHTML=`
        <button class="delete" onclick="this.parentElement.remove()"></button>
        <strong>‚úó Failed to Add Context</strong><br>
        <small>${N}</small>
      `,W.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(W),setTimeout(()=>{W.remove()},8e3),setTimeout(()=>{t(13,N=null)},5e3)}finally{z=!1}}async function ie(){console.log("üí¨ Adding document to context and opening chat:",a.title),E=!0,G=!1,t(13,N=null);try{let L=null;if(r){try{const ee=await ze("list_conversations");if(console.log("üìã Available conversations:",ee),ee!=null&&ee.conversations&&ee.conversations.length>0)L=ee.conversations[0].id,console.log("üéØ Using existing conversation:",L);else{const me=await ze("create_conversation",{title:"Chat with Documents",role:c||"default"});if(me.status==="success"&&me.conversation_id)L=me.conversation_id,console.log("üÜï Created new conversation:",L);else throw new Error("Failed to create conversation: "+(me.error||"Unknown error"))}}catch(ee){throw console.error("‚ùå Failed to manage conversations:",ee),new Error("Could not create or find conversation: "+ee.message)}const oe={source_type:"document",document_id:a.id};a.url&&(oe.url=a.url),a.tags&&a.tags.length>0&&(oe.tags=a.tags.join(", ")),a.rank!==void 0&&(oe.rank=a.rank.toString());const Z=await ze("add_context_to_conversation",{conversationId:L,contextType:"document",title:a.title,content:a.body,metadata:oe});console.log("‚úÖ Document added to context via Tauri:",Z)}else{const oe=Ye.ServerURL;try{const _e=await fetch(`${oe}/conversations`);if(_e.ok){const fe=await _e.json();if(fe.conversations&&fe.conversations.length>0)L=fe.conversations[0].id,console.log("üéØ Using existing conversation:",L);else{const de=await fetch(`${oe}/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"Chat with Documents",role:c||"default"})});if(de.ok){const pe=await de.json();if(pe.status==="success"&&pe.conversation_id)L=pe.conversation_id,console.log("üÜï Created new conversation:",L);else throw new Error("Failed to create conversation: "+(pe.error||"Unknown error"))}else throw new Error(`Failed to create conversation: ${de.status} ${de.statusText}`)}}else throw new Error(`Failed to list conversations: ${_e.status} ${_e.statusText}`)}catch(_e){throw console.error("‚ùå Failed to manage conversations:",_e),new Error("Could not create or find conversation: "+_e.message)}const Z=`${oe}/conversations/${L}/context`,ee=await fetch(Z,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context_type:"document",title:a.title,content:a.body,metadata:{source_type:"document",document_id:a.id,url:a.url||"",tags:a.tags?a.tags.join(", "):"",rank:a.rank?a.rank.toString():"0"}})});if(!ee.ok)throw new Error(`HTTP error! Status: ${ee.status} - ${ee.statusText}`);const me=await ee.json();console.log("‚úÖ Document added to context via HTTP:",me)}console.log("‚úÖ Successfully added document to chat context, navigating to chat..."),G=!0;const W=window.document.createElement("div");W.className="notification is-success is-light",W.innerHTML=`
        <strong>üí¨ Opening Chat with Document</strong><br>
        <small>Context added successfully. Redirecting to chat...</small>
      `,W.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(W),setTimeout(()=>{W.remove(),Js.goto("/chat")},1500),setTimeout(()=>{G=!1},2e3)}catch(L){console.error("‚ùå Error adding document to context and opening chat:",L),t(13,N=L.message||"Failed to add document to context");const W=window.document.createElement("div");W.className="notification is-danger is-light",W.innerHTML=`
        <button class="delete" onclick="this.parentElement.remove()"></button>
        <strong>‚úó Failed to Open Chat with Document</strong><br>
        <small>${N}</small>
      `,W.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 350px;",window.document.body.appendChild(W),setTimeout(()=>{W.remove()},8e3),setTimeout(()=>{t(13,N=null)},5e3)}finally{E=!1}}Al[c]!==void 0&&(console.log("Have attribute",Al[c]),Al[c].hasOwnProperty("enableLogseq")?console.log("enable logseq True"):console.log("Didn't make it"));const D=L=>se(L),M=()=>{t(10,C=null),U()},V=()=>t(11,v=!1),K=()=>{U()},x=()=>t(13,N=null);function I(L){d=L,t(1,d)}function F(L){m=L,t(2,m)}function P(L){p=L,t(3,p)}return l.$$set=L=>{"document"in L&&t(0,a=L.document)},t(14,n=J()),t(15,o=te()),[a,d,m,p,_,g,y,b,k,w,C,v,T,N,n,o,A,se,U,D,M,V,K,x,I,F,P]}class zi extends dt{constructor(e){super(),pt(this,e,Fi,Hi,ut,{document:0},null,[-1,-1])}}const Ki="/assets/terraphim_gray.png";function Fl(l){const e=l.trim();if(!e)return{hasOperator:!1,operator:null,terms:[l],originalQuery:l};const t=/\b(and)\b/i,n=/\b(or)\b/i,o=t.test(e),c=n.test(e);if(o&&!c)return{hasOperator:!0,operator:"AND",terms:e.split(t).filter((u,a)=>a%2===0).map(u=>u.trim()).filter(u=>u.length>0),originalQuery:l};if(c&&!o)return{hasOperator:!0,operator:"OR",terms:e.split(n).filter((u,a)=>a%2===0).map(u=>u.trim()).filter(u=>u.length>0),originalQuery:l};if(o&&c){const r=e.toLowerCase().indexOf(" and "),u=e.toLowerCase().indexOf(" or ");if(r!==-1&&(u===-1||r<u))return{hasOperator:!0,operator:"AND",terms:e.split(t).filter((d,m)=>m%2===0).map(d=>d.trim()).filter(d=>d.length>0),originalQuery:l};if(u!==-1)return{hasOperator:!0,operator:"OR",terms:e.split(n).filter((d,m)=>m%2===0).map(d=>d.trim()).filter(d=>d.length>0),originalQuery:l}}return{hasOperator:!1,operator:null,terms:[e],originalQuery:l}}function to(l,e){var n,o;if(l.hasOperator&&l.terms.length>1){const c=l.terms.filter(r=>r.trim().length>0);if(c.length>1)return{search_term:c[0],search_terms:c,operator:(n=l.operator)==null?void 0:n.toLowerCase(),skip:0,limit:50,role:e||null}}return{search_term:((o=l.terms[0])==null?void 0:o.trim())||"",search_terms:void 0,operator:void 0,skip:0,limit:50,role:e||null}}function lo(l){let e,t,n,o,c;return{c(){e=f("button"),t=q("√ó"),i(e,"class","remove-btn"),i(e,"aria-label",n=`Remove term: ${l[0]}`)},m(r,u){$(r,e,u),s(e,t),o||(c=ne(e,"click",Fs(function(){Dl(l[2])&&l[2].apply(this,arguments)})),o=!0)},p(r,u){l=r,u&1&&n!==(n=`Remove term: ${l[0]}`)&&i(e,"aria-label",n)},d(r){r&&S(e),o=!1,c()}}}function qi(l){let e,t,n,o=l[2]&&lo(l);return{c(){e=f("span"),t=q(l[0]),n=h(),o&&o.c(),i(e,"class","term-chip"),ft(e,"from-kg",l[1])},m(c,r){$(c,e,r),s(e,t),s(e,n),o&&o.m(e,null)},p(c,[r]){r&1&&we(t,c[0]),c[2]?o?o.p(c,r):(o=lo(c),o.c(),o.m(e,null)):o&&(o.d(1),o=null),r&2&&ft(e,"from-kg",c[1])},i:Pe,o:Pe,d(c){c&&S(e),o&&o.d()}}}function Gi(l,e,t){let{term:n}=e,{isFromKG:o=!1}=e,{onRemove:c=null}=e;return l.$$set=r=>{"term"in r&&t(0,n=r.term),"isFromKG"in r&&t(1,o=r.isFromKG),"onRemove"in r&&t(2,c=r.onRemove)},[n,o,c]}class Wi extends dt{constructor(e){super(),pt(this,e,Gi,qi,ut,{term:0,isFromKG:1,onRemove:2})}}function no(l,e,t){const n=l.slice();return n[38]=e[t],n}function oo(l,e,t){const n=l.slice();return n[41]=e[t],n[43]=t,n}function so(l,e,t){const n=l.slice();return n[44]=e[t],n[43]=t,n}function ro(l){let e,t=l[3],n=[];for(let o=0;o<t.length;o+=1)n[o]=io(so(l,t,o));return{c(){e=f("ul");for(let o=0;o<n.length;o+=1)n[o].c();i(e,"class","suggestions svelte-tdawt3")},m(o,c){$(o,e,c);for(let r=0;r<n.length;r+=1)n[r]&&n[r].m(e,null)},p(o,c){if(c[0]&8216){t=o[3];let r;for(r=0;r<t.length;r+=1){const u=so(o,t,r);n[r]?n[r].p(u,c):(n[r]=io(u),n[r].c(),n[r].m(e,null))}for(;r<n.length;r+=1)n[r].d(1);n.length=t.length}},d(o){o&&S(e),xe(n,o)}}}function io(l){let e,t=l[44]+"",n,o,c,r,u,a;function d(){return l[20](l[44])}function m(...p){return l[21](l[44],...p)}return{c(){e=f("li"),n=q(t),o=h(),i(e,"tabindex","0"),i(e,"role","option"),i(e,"aria-selected",c=l[43]===l[4]),i(e,"aria-label",r=`Apply suggestion: ${l[44]}`),i(e,"class","svelte-tdawt3"),ft(e,"active",l[43]===l[4])},m(p,_){$(p,e,_),s(e,n),s(e,o),u||(a=[ne(e,"click",d),ne(e,"keydown",m)],u=!0)},p(p,_){l=p,_[0]&8&&t!==(t=l[44]+"")&&we(n,t),_[0]&16&&c!==(c=l[43]===l[4])&&i(e,"aria-selected",c),_[0]&8&&r!==(r=`Apply suggestion: ${l[44]}`)&&i(e,"aria-label",r),_[0]&16&&ft(e,"active",l[43]===l[4])},d(p){p&&S(e),u=!1,Qe(a)}}}function ao(l){let e,t,n,o,c,r,u,a=l[6],d=[];for(let p=0;p<a.length;p+=1)d[p]=uo(oo(l,a,p));const m=p=>re(d[p],1,1,()=>{d[p]=null});return{c(){e=f("div"),t=f("div");for(let p=0;p<d.length;p+=1)d[p].c();n=h(),o=f("button"),o.textContent="Clear all",i(t,"class","search-terms"),i(o,"type","button"),i(o,"class","clear-terms-btn svelte-tdawt3"),i(e,"class","selected-terms-section svelte-tdawt3")},m(p,_){$(p,e,_),s(e,t);for(let g=0;g<d.length;g+=1)d[g]&&d[g].m(t,null);s(e,n),s(e,o),c=!0,r||(u=ne(o,"click",l[15]),r=!0)},p(p,_){if(_[0]&16576){a=p[6];let g;for(g=0;g<a.length;g+=1){const y=oo(p,a,g);d[g]?(d[g].p(y,_),X(d[g],1)):(d[g]=uo(y),d[g].c(),X(d[g],1),d[g].m(t,null))}for(Ze(),g=a.length;g<d.length;g+=1)m(g);Xe()}},i(p){if(!c){for(let _=0;_<a.length;_+=1)X(d[_]);c=!0}},o(p){d=d.filter(Boolean);for(let _=0;_<d.length;_+=1)re(d[_]);c=!1},d(p){p&&S(e),xe(d,p),r=!1,u()}}}function co(l){let e,t=(l[7]||"AND")+"",n;return{c(){e=f("span"),n=q(t),i(e,"class","operator-chip")},m(o,c){$(o,e,c),s(e,n)},p(o,c){c[0]&128&&t!==(t=(o[7]||"AND")+"")&&we(n,t)},d(o){o&&S(e)}}}function uo(l){let e,t,n,o;function c(){return l[22](l[41])}e=new Wi({props:{term:l[41].value,isFromKG:l[41].isFromKG,onRemove:c}});let r=l[43]<l[6].length-1&&co(l);return{c(){ve(e.$$.fragment),t=h(),r&&r.c(),n=rt()},m(u,a){be(e,u,a),$(u,t,a),r&&r.m(u,a),$(u,n,a),o=!0},p(u,a){l=u;const d={};a[0]&64&&(d.term=l[41].value),a[0]&64&&(d.isFromKG=l[41].isFromKG),a[0]&64&&(d.onRemove=c),e.$set(d),l[43]<l[6].length-1?r?r.p(l,a):(r=co(l),r.c(),r.m(n.parentNode,n)):r&&(r.d(1),r=null)},i(u){o||(X(e.$$.fragment,u),o=!0)},o(u){re(e.$$.fragment,u),o=!1},d(u){ke(e,u),u&&S(t),r&&r.d(u),u&&S(n)}}}function fo(l){let e,t,n;return{c(){e=f("button"),e.textContent="Parse Terms",i(e,"type","button"),i(e,"class","button is-small is-info")},m(o,c){$(o,e,c),t||(n=ne(e,"click",l[27]),t=!0)},p:Pe,d(o){o&&S(e),t=!1,n()}}}function Bi(l){let e,t,n,o,c,r,u,a,d,m,p,_,g,y,b,k,w,C,v,T,z,O=l[0]&&(l[0].includes(" AND ")||l[0].includes(" OR "))&&l[6].length===0,N,E,G,te;function J(Y){l[19](Y)}let A={type:"search",placeholder:l[9]?`Search over Knowledge graph for ${l[8]}`:"Search",icon:"search",expanded:!0,autofocus:!0};l[0]!==void 0&&(A.value=l[0]),n=new Yt({props:A}),st.push(()=>at(n,"value",J)),n.$on("click",l[16]),n.$on("submit",l[16]),n.$on("keydown",l[12]),n.$on("input",l[11]);let R=l[3].length>0&&ro(l),se=l[6].length>0&&ao(l),U=O&&fo(l);return E=gs(l[24][0]),{c(){e=f("div"),t=f("div"),ve(n.$$.fragment),c=h(),R&&R.c(),r=h(),se&&se.c(),u=h(),a=f("div"),d=f("div"),m=f("label"),p=f("input"),_=q(`
            Exact`),g=h(),y=f("label"),b=f("input"),k=q(`
            All (AND)`),w=h(),C=f("label"),v=f("input"),T=q(`
            Any (OR)`),z=h(),U&&U.c(),i(t,"class","input-wrapper svelte-tdawt3"),i(p,"type","radio"),p.__value="none",p.value=p.__value,i(p,"class","svelte-tdawt3"),i(m,"class","radio svelte-tdawt3"),i(b,"type","radio"),b.__value="and",b.value=b.__value,i(b,"class","svelte-tdawt3"),i(y,"class","radio svelte-tdawt3"),i(v,"type","radio"),v.__value="or",v.value=v.__value,i(v,"class","svelte-tdawt3"),i(C,"class","radio svelte-tdawt3"),i(d,"class","control svelte-tdawt3"),i(a,"class","operator-controls svelte-tdawt3"),i(e,"class","search-row svelte-tdawt3"),E.p(p,b,v)},m(Y,le){$(Y,e,le),s(e,t),be(n,t,null),s(t,c),R&&R.m(t,null),s(e,r),se&&se.m(e,null),s(e,u),s(e,a),s(a,d),s(d,m),s(m,p),p.checked=p.__value===l[5],s(m,_),s(d,g),s(d,y),s(y,b),b.checked=b.__value===l[5],s(y,k),s(d,w),s(d,C),s(C,v),v.checked=v.__value===l[5],s(C,T),s(a,z),U&&U.m(a,null),N=!0,G||(te=[ne(p,"change",l[23]),ne(b,"change",l[25]),ne(v,"change",l[26])],G=!0)},p(Y,le){const Q={};le[0]&768&&(Q.placeholder=Y[9]?`Search over Knowledge graph for ${Y[8]}`:"Search"),!o&&le[0]&1&&(o=!0,Q.value=Y[0],ct(()=>o=!1)),n.$set(Q),Y[3].length>0?R?R.p(Y,le):(R=ro(Y),R.c(),R.m(t,null)):R&&(R.d(1),R=null),Y[6].length>0?se?(se.p(Y,le),le[0]&64&&X(se,1)):(se=ao(Y),se.c(),X(se,1),se.m(e,u)):se&&(Ze(),re(se,1,1,()=>{se=null}),Xe()),le[0]&32&&(p.checked=p.__value===Y[5]),le[0]&32&&(b.checked=b.__value===Y[5]),le[0]&32&&(v.checked=v.__value===Y[5]),le[0]&65&&(O=Y[0]&&(Y[0].includes(" AND ")||Y[0].includes(" OR "))&&Y[6].length===0),O?U?U.p(Y,le):(U=fo(Y),U.c(),U.m(a,null)):U&&(U.d(1),U=null)},i(Y){N||(X(n.$$.fragment,Y),X(se),N=!0)},o(Y){re(n.$$.fragment,Y),re(se),N=!1},d(Y){Y&&S(e),ke(n),R&&R.d(),se&&se.d(),U&&U.d(),E.r(),G=!1,Qe(te)}}}function Ji(l){let e,t,n,o,c,r,u,a,d,m;return{c(){e=f("section"),t=f("div"),n=f("img"),c=h(),r=f("p"),r.textContent="I am Terraphim, your personal assistant.",u=h(),a=f("button"),a.innerHTML=`<span class="icon"><i class="fas fa-magic"></i></span> 
        <span>Configuration Wizard</span>`,Ks(n.src,o=Ki)||i(n,"src",o),i(n,"alt","Terraphim Logo"),i(n,"class","svelte-tdawt3"),i(a,"class","button is-primary"),i(a,"data-testid","wizard-start"),i(t,"class","content has-text-grey has-text-centered svelte-tdawt3"),i(e,"class","section")},m(p,_){$(p,e,_),s(e,t),s(t,n),s(t,c),s(t,r),s(t,u),s(t,a),d||(m=ne(a,"click",l[28]),d=!0)},p:Pe,i:Pe,o:Pe,d(p){p&&S(e),d=!1,m()}}}function Vi(l){let e,t,n=l[1],o=[];for(let r=0;r<n.length;r+=1)o[r]=po(no(l,n,r));const c=r=>re(o[r],1,1,()=>{o[r]=null});return{c(){for(let r=0;r<o.length;r+=1)o[r].c();e=rt()},m(r,u){for(let a=0;a<o.length;a+=1)o[a]&&o[a].m(r,u);$(r,e,u),t=!0},p(r,u){if(u[0]&2){n=r[1];let a;for(a=0;a<n.length;a+=1){const d=no(r,n,a);o[a]?(o[a].p(d,u),X(o[a],1)):(o[a]=po(d),o[a].c(),X(o[a],1),o[a].m(e.parentNode,e))}for(Ze(),a=n.length;a<o.length;a+=1)c(a);Xe()}},i(r){if(!t){for(let u=0;u<n.length;u+=1)X(o[u]);t=!0}},o(r){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)re(o[u]);t=!1},d(r){xe(o,r),r&&S(e)}}}function Qi(l){let e,t;return{c(){e=f("p"),t=q(l[2]),i(e,"class","error svelte-tdawt3")},m(n,o){$(n,e,o),s(e,t)},p(n,o){o[0]&4&&we(t,n[2])},i:Pe,o:Pe,d(n){n&&S(e)}}}function po(l){let e,t;return e=new zi({props:{document:l[38]}}),{c(){ve(e.$$.fragment)},m(n,o){be(e,n,o),t=!0},p(n,o){const c={};o[0]&2&&(c.document=n[38]),e.$set(c)},i(n){t||(X(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){ke(e,n)}}}function Yi(l){let e,t,n,o,c,r,u,a,d,m,p;e=new cl({props:{fallbackPath:"/"}}),o=new zt({props:{$$slots:{default:[Bi]},$$scope:{ctx:l}}});const _=[Qi,Vi,Ji],g=[];function y(b,k){return b[2]?0:b[1].length?1:2}return r=y(l),u=g[r]=_[r](l),{c(){ve(e.$$.fragment),t=h(),n=f("form"),ve(o.$$.fragment),c=h(),u.c(),a=rt()},m(b,k){be(e,b,k),$(b,t,k),$(b,n,k),be(o,n,null),$(b,c,k),g[r].m(b,k),$(b,a,k),d=!0,m||(p=ne(n,"submit",zs(l[16])),m=!0)},p(b,k){const w={};k[0]&1017|k[1]&32768&&(w.$$scope={dirty:k,ctx:b}),o.$set(w);let C=r;r=y(b),r===C?g[r].p(b,k):(Ze(),re(g[C],1,1,()=>{g[C]=null}),Xe(),u=g[r],u?u.p(b,k):(u=g[r]=_[r](b),u.c()),X(u,1),u.m(a.parentNode,a))},i(b){d||(X(e.$$.fragment,b),X(o.$$.fragment,b),X(u),d=!0)},o(b){re(e.$$.fragment,b),re(o.$$.fragment,b),re(u),d=!1},d(b){ke(e,b),b&&S(t),b&&S(n),ke(o),b&&S(c),g[r].d(b),b&&S(a),m=!1,p()}}}function Zi(l,e,t){let n,o,c,r,u,a,d;Ue(l,_r,I=>t(30,o=I)),Ue(l,Jt,I=>t(0,c=I)),Ue(l,ot,I=>t(31,r=I)),Ue(l,Et,I=>t(8,u=I)),Ue(l,ml,I=>t(18,a=I)),Ue(l,Tt,I=>t(9,d=I));let m=[],p=null,_=[],g=-1,y="none",b=[],k=null,w=!1;function C(I){const F=Fl(I);if(F.hasOperator&&F.terms.length>1){const P=F.terms.map(oe=>{const Z=n.some(([ee])=>ee.toLowerCase()===oe.toLowerCase());return{value:oe,isFromKG:Z}}),L=b.map(oe=>oe.value),W=P.map(oe=>oe.value);(JSON.stringify(L)!==JSON.stringify(W)||k!==F.operator)&&(t(6,b=P),t(7,k=F.operator))}else F.terms.length===1&&b.length>0?(t(6,b=[]),t(7,k=null)):F.terms.length===0&&(t(6,b=[]),t(7,k=null))}async function v(I){try{if(r){const F=await ze("get_autocomplete_suggestions",{query:I,roleName:u,limit:8});if(F.status==="success"&&F.suggestions)return F.suggestions.map(P=>P.term)}else{const F=await fetch(`${o.replace("/documents/search","")}/autocomplete/${encodeURIComponent(u)}/${encodeURIComponent(I)}`);if(F.ok){const P=await F.json();if(P.status==="success"&&P.suggestions)return P.suggestions.map(L=>L.term)}}return n.filter(([F])=>F.toLowerCase().includes(I.toLowerCase())).map(([F])=>F).slice(0,8)}catch(F){return console.warn("Error fetching term suggestions:",F),[]}}async function T(I){const F=I.trim();if(F.length===0)return[];if(y!=="none"){const Z=F.split(/\s+/),ee=Z[Z.length-1].toLowerCase();return ee.length<2?[]:v(ee)}const L=F.split(/\s+/),W=L[L.length-1].toLowerCase();if(L.length>1&&y==="none"){const Z=[];if("and".startsWith(W)&&Z.push("AND"),"or".startsWith(W)&&Z.push("OR"),Z.length>0)return Z}const oe=F.toLowerCase();if(oe.includes(" and ")||oe.includes(" or ")){const Z=W;return Z.length<2?[]:v(Z)}try{const Z=await v(F);return L.length===1&&L[0].length>2&&y==="none"?[...Z.slice(0,6),"AND","OR"]:Z}catch(Z){console.warn("Error fetching autocomplete suggestions:",Z);const ee=n.filter(([me])=>me.toLowerCase().includes(F.toLowerCase())).map(([me])=>me).slice(0,6);return L.length===1&&L[0].length>2&&y==="none"?[...ee,"AND","OR"]:ee}}async function z(I){const F=I.target;if(!F||F.selectionStart==null)return;const P=F.selectionStart,L=c.slice(0,P),W=L.split(/\s+/),oe=W[W.length-1];if(oe.toLowerCase()==="a"||oe.toLowerCase()==="an")t(3,_=["AND"]);else if(oe.toLowerCase()==="o"||oe.toLowerCase()==="or")t(3,_=["OR"]);else if(oe.length>=2)try{const Z=await T(oe);W.length>1&&!L.includes(" AND ")&&!L.includes(" OR ")?t(3,_=[...Z,"AND","OR"]):t(3,_=Z)}catch(Z){console.warn("Failed to get suggestions:",Z),t(3,_=[])}else t(3,_=[]);t(4,g=-1)}function O(I){_.length>0?I.key==="ArrowDown"?(I.preventDefault(),t(4,g=(g+1)%_.length)):I.key==="ArrowUp"?(I.preventDefault(),t(4,g=(g-1+_.length)%_.length)):(I.key==="Enter"||I.key==="Tab")&&g!==-1?(I.preventDefault(),E(_[g])):I.key==="Escape"&&(I.preventDefault(),t(3,_=[]),t(4,g=-1)):I.key==="Enter"&&(I.preventDefault(),N())}function N(){C(c),se()}function E(I){if(I==="AND"||I==="OR"){t(7,k=I);const F=Fl(c);F.terms.length>0&&!b.some(P=>P.value===F.terms[F.terms.length-1])&&te(F.terms[F.terms.length-1]),Ft(Jt,c=c+` ${I} `,c)}else te(I,k);t(3,_=[]),t(4,g=-1)}function G(){const I=c.trim();if(!I)return null;if(y!=="none"){const L=I.split(/\s+/).filter(W=>W.length>0);return L.length>1?{...to({hasOperator:!0,operator:y==="and"?"AND":"OR",terms:L,originalQuery:I},u),skip:0,limit:10}:{search_term:I,skip:0,limit:10,role:u}}const F=Fl(I);return{...to(F,u),skip:0,limit:10}}function te(I,F=null){const P=n.some(([L])=>L.toLowerCase()===I.toLowerCase());b.some(L=>L.value.toLowerCase()===I.toLowerCase())||(t(6,b=[...b,{value:I,isFromKG:P}]),F&&b.length>1&&t(7,k=F),A())}function J(I){t(6,b=b.filter(F=>F.value!==I)),A()}function A(){if(t(17,w=!0),b.length===0)Ft(Jt,c="",c),t(7,k=null);else if(b.length===1)Ft(Jt,c=b[0].value,c),t(7,k=null);else{const I=k||"AND";Ft(Jt,c=b.map(F=>F.value).join(` ${I} `),c)}setTimeout(()=>{t(17,w=!1)},10)}function R(){t(6,b=[]),t(7,k=null),Ft(Jt,c="",c)}async function se(){if(t(2,p=null),r){if(!c.trim())return;try{const I=G();if(!I)return;const F=await ze("search",{searchQuery:I});F.status==="success"?(t(1,m=F.results),console.log("Response results"),console.log(m)):(t(2,p=`Search failed: ${F.status}`),console.error("Search failed:",F))}catch(I){t(2,p=`Error in Tauri search: ${I}`),console.error("Error in Tauri search:",I)}}else{if(!c.trim())return;const I=G();if(!I)return;const F=JSON.stringify(I);try{const P=await fetch(o,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:F}),L=await P.json();if(!P.ok)throw new Error(`HTTP error! Status: ${P.status}`);t(1,m=L.results)}catch(P){console.error("Error fetching data:",P),t(2,p=`Error fetching data: ${P}`)}}}const U=[[]];function Y(I){c=I,Jt.set(c)}const le=I=>E(I),Q=(I,F)=>{(F.key==="Enter"||F.key===" ")&&(F.preventDefault(),E(I))},ie=I=>J(I.value);function D(){y=this.__value,t(5,y)}function M(){y=this.__value,t(5,y)}function V(){y=this.__value,t(5,y)}const K=()=>C(c),x=()=>window.location.href="/config/wizard";return l.$$.update=()=>{l.$$.dirty[0]&262144&&(n=Object.entries(a)),l.$$.dirty[0]&131073&&c&&!w&&(c.includes(" AND ")||c.includes(" OR "))&&C(c)},[c,m,p,_,g,y,b,k,u,d,C,z,O,E,J,R,se,w,a,Y,le,Q,ie,D,U,M,V,K,x]}class Xi extends dt{constructor(e){super(),pt(this,e,Zi,Yi,ut,{},null,[-1,-1])}}async function mo(l={}){return typeof l=="object"&&Object.freeze(l),Gl({__tauriModule:"Dialog",message:{cmd:"openDialog",options:l}})}function _o(l,e,t){const n=l.slice();return n[71]=e[t],n[79]=t,n}function ho(l,e,t){const n=l.slice();return n[77]=e[t],n[78]=e,n[79]=t,n}function go(l,e,t){const n=l.slice();return n[80]=e[t],n}function vo(l,e,t){const n=l.slice();return n[80]=e[t],n}function bo(l,e,t){const n=l.slice();return n[85]=e[t],n[86]=e,n[87]=t,n}function ko(l,e,t){const n=l.slice();return n[88]=e[t][0],n[89]=e[t][1],n[90]=e,n[91]=t,n}function wo(l,e,t){const n=l.slice();return n[74]=e[t],n}function yo(l,e,t){const n=l.slice();return n[71]=e[t],n}function Co(l,e,t){const n=l.slice();return n[74]=e[t],n}function To(l){let e,t,n,o,c;return{c(){e=f("div"),t=f("button"),n=q(`
      Configuration saved successfully!`),i(t,"class","delete"),i(e,"class","notification is-success"),i(e,"data-testid","wizard-success")},m(r,u){$(r,e,u),s(e,t),s(e,n),o||(c=ne(t,"click",l[20]),o=!0)},p:Pe,d(r){r&&S(e),o=!1,c()}}}function So(l){let e,t,n,o,c;return{c(){e=f("div"),t=f("button"),n=q(`
      Failed to save configuration. Please try again.`),i(t,"class","delete"),i(e,"class","notification is-danger"),i(e,"data-testid","wizard-error")},m(r,u){$(r,e,u),s(e,t),s(e,n),o||(c=ne(t,"click",l[21]),o=!0)},p:Pe,d(r){r&&S(e),o=!1,c()}}}function xi(l){let e,t,n,o,c,r,u,a,d,m=l[3].id+"",p,_,g,y,b,k=l[3].global_shortcut+"",w,C,v,T,z,O=l[3].default_theme+"",N,E,G,te,J,A=l[3].default_role+"",R,se,U,Y,le,Q,ie=JSON.stringify(l[3],null,2)+"",D,M=l[3].roles,V=[];for(let K=0;K<M.length;K+=1)V[K]=$o(_o(l,M,K));return{c(){e=f("h4"),e.textContent="Review",t=h(),n=f("div"),o=f("h5"),o.textContent="Configuration Summary:",c=h(),r=f("ul"),u=f("li"),a=f("strong"),a.textContent="Configuration ID:",d=h(),p=q(m),_=h(),g=f("li"),y=f("strong"),y.textContent="Global Shortcut:",b=h(),w=q(k),C=h(),v=f("li"),T=f("strong"),T.textContent="Default Theme:",z=h(),N=q(O),E=h(),G=f("li"),te=f("strong"),te.textContent="Default Role:",J=h(),R=q(A),se=h(),U=f("h5"),U.textContent="Roles:",Y=h();for(let K=0;K<V.length;K+=1)V[K].c();le=h(),Q=f("pre"),D=q(ie),i(e,"class","title is-5"),i(n,"class","content"),ge(Q,"max-height","300px"),ge(Q,"overflow","auto")},m(K,x){$(K,e,x),$(K,t,x),$(K,n,x),s(n,o),s(n,c),s(n,r),s(r,u),s(u,a),s(u,d),s(u,p),s(r,_),s(r,g),s(g,y),s(g,b),s(g,w),s(r,C),s(r,v),s(v,T),s(v,z),s(v,N),s(r,E),s(r,G),s(G,te),s(G,J),s(G,R),s(n,se),s(n,U),s(n,Y);for(let I=0;I<V.length;I+=1)V[I]&&V[I].m(n,null);$(K,le,x),$(K,Q,x),s(Q,D)},p(K,x){if(x[0]&8&&m!==(m=K[3].id+"")&&we(p,m),x[0]&8&&k!==(k=K[3].global_shortcut+"")&&we(w,k),x[0]&8&&O!==(O=K[3].default_theme+"")&&we(N,O),x[0]&8&&A!==(A=K[3].default_role+"")&&we(R,A),x[0]&10){M=K[3].roles;let I;for(I=0;I<M.length;I+=1){const F=_o(K,M,I);V[I]?V[I].p(F,x):(V[I]=$o(F),V[I].c(),V[I].m(n,null))}for(;I<V.length;I+=1)V[I].d(1);V.length=M.length}x[0]&8&&ie!==(ie=JSON.stringify(K[3],null,2)+"")&&we(D,ie)},d(K){K&&S(e),K&&S(t),K&&S(n),xe(V,K),K&&S(le),K&&S(Q)}}}function ea(l){let e,t,n=[],o=new Map,c,r,u,a,d=l[3].roles;const m=p=>p[77].name;for(let p=0;p<d.length;p+=1){let _=ho(l,d,p),g=m(_);o.set(g,n[p]=zo(g,_))}return{c(){e=f("h4"),e.textContent="Roles",t=h();for(let p=0;p<n.length;p+=1)n[p].c();c=h(),r=f("button"),r.textContent="Add Role",i(e,"class","title is-5"),i(r,"class","button is-link is-light"),i(r,"data-testid","add-role")},m(p,_){$(p,e,_),$(p,t,_);for(let g=0;g<n.length;g+=1)n[g]&&n[g].m(p,_);$(p,c,_),$(p,r,_),u||(a=ne(r,"click",l[12]),u=!0)},p(p,_){_[0]&516985&&(d=p[3].roles,n=qs(n,_,m,1,p,d,o,c.parentNode,Gs,zo,c,ho))},d(p){p&&S(e),p&&S(t);for(let _=0;_<n.length;_+=1)n[_].d(p);p&&S(c),p&&S(r),u=!1,a()}}}function ta(l){let e,t,n,o,c,r,u,a,d,m,p,_,g,y,b,k,w,C,v,T,z,O,N,E,G,te,J,A,R,se,U,Y=l[8],le=[];for(let D=0;D<Y.length;D+=1)le[D]=Ko(Co(l,Y,D));let Q=l[3].roles,ie=[];for(let D=0;D<Q.length;D+=1)ie[D]=qo(yo(l,Q,D));return{c(){e=f("div"),t=f("label"),t.textContent="Configuration ID",n=h(),o=f("div"),c=f("div"),r=f("select"),u=f("option"),u.textContent="Desktop",a=f("option"),a.textContent="Server",d=f("option"),d.textContent="Embedded",m=h(),p=f("div"),_=f("label"),_.textContent="Global shortcut",g=h(),y=f("div"),b=f("input"),k=h(),w=f("div"),C=f("label"),C.textContent="Default theme",v=h(),T=f("div"),z=f("div"),O=f("select");for(let D=0;D<le.length;D+=1)le[D].c();N=h(),E=f("div"),G=f("label"),G.textContent="Default Role",te=h(),J=f("div"),A=f("div"),R=f("select");for(let D=0;D<ie.length;D+=1)ie[D].c();i(t,"class","label"),i(t,"for","config-id"),u.__value="Desktop",u.value=u.__value,a.__value="Server",a.value=a.__value,d.__value="Embedded",d.value=d.__value,i(r,"id","config-id"),l[3].id===void 0&&it(()=>l[22].call(r)),i(c,"class","select"),i(o,"class","control"),i(e,"class","field"),i(_,"class","label"),i(_,"for","global-shortcut"),i(b,"class","input"),i(b,"id","global-shortcut"),i(b,"type","text"),i(y,"class","control"),i(p,"class","field"),i(C,"class","label"),i(C,"for","default-theme"),i(O,"id","default-theme"),l[3].default_theme===void 0&&it(()=>l[24].call(O)),i(z,"class","select is-fullwidth"),i(T,"class","control"),i(w,"class","field"),i(G,"class","label"),i(G,"for","default-role"),i(R,"id","default-role"),l[3].default_role===void 0&&it(()=>l[25].call(R)),i(A,"class","select"),i(J,"class","control"),i(E,"class","field")},m(D,M){$(D,e,M),s(e,t),s(e,n),s(e,o),s(o,c),s(c,r),s(r,u),s(r,a),s(r,d),Ke(r,l[3].id,!0),$(D,m,M),$(D,p,M),s(p,_),s(p,g),s(p,y),s(y,b),Oe(b,l[3].global_shortcut),$(D,k,M),$(D,w,M),s(w,C),s(w,v),s(w,T),s(T,z),s(z,O);for(let V=0;V<le.length;V+=1)le[V]&&le[V].m(O,null);Ke(O,l[3].default_theme,!0),$(D,N,M),$(D,E,M),s(E,G),s(E,te),s(E,J),s(J,A),s(A,R);for(let V=0;V<ie.length;V+=1)ie[V]&&ie[V].m(R,null);Ke(R,l[3].default_role,!0),se||(U=[ne(r,"change",l[22]),ne(b,"input",l[23]),ne(O,"change",l[24]),ne(R,"change",l[25])],se=!0)},p(D,M){if(M[0]&264&&Ke(r,D[3].id),M[0]&264&&b.value!==D[3].global_shortcut&&Oe(b,D[3].global_shortcut),M[0]&256){Y=D[8];let V;for(V=0;V<Y.length;V+=1){const K=Co(D,Y,V);le[V]?le[V].p(K,M):(le[V]=Ko(K),le[V].c(),le[V].m(O,null))}for(;V<le.length;V+=1)le[V].d(1);le.length=Y.length}if(M[0]&264&&Ke(O,D[3].default_theme),M[0]&8){Q=D[3].roles;let V;for(V=0;V<Q.length;V+=1){const K=yo(D,Q,V);ie[V]?ie[V].p(K,M):(ie[V]=qo(K),ie[V].c(),ie[V].m(R,null))}for(;V<ie.length;V+=1)ie[V].d(1);ie.length=Q.length}M[0]&264&&Ke(R,D[3].default_role)},d(D){D&&S(e),D&&S(m),D&&S(p),D&&S(k),D&&S(w),xe(le,D),D&&S(N),D&&S(E),xe(ie,D),se=!1,Qe(U)}}}function $o(l){let e,t,n=l[71].name+"",o,c,r,u,a,d=l[71].shortname+"",m,p,_,g,y,b=l[71].theme+"",k,w,C,v,T,z=l[71].relevance_function+"",O,N,E,G,te,J;return{c(){e=f("div"),t=f("h6"),o=q(n),c=h(),r=f("p"),u=f("strong"),u.textContent="Shortname:",a=h(),m=q(d),p=h(),_=f("p"),g=f("strong"),g.textContent="Theme:",y=h(),k=q(b),w=h(),C=f("p"),v=f("strong"),v.textContent="Relevance Function:",T=h(),O=q(z),N=h(),E=f("button"),E.textContent="Edit Role",G=h(),i(t,"data-testid","review-role-name-"+l[79]),i(E,"class","button is-small"),i(E,"data-testid","edit-role-"+l[79]),i(e,"class","box")},m(A,R){$(A,e,R),s(e,t),s(t,o),s(e,c),s(e,r),s(r,u),s(r,a),s(r,m),s(e,p),s(e,_),s(_,g),s(_,y),s(_,k),s(e,w),s(e,C),s(C,v),s(C,T),s(C,O),s(e,N),s(e,E),s(e,G),te||(J=ne(E,"click",l[68]),te=!0)},p(A,R){R[0]&8&&n!==(n=A[71].name+"")&&we(o,n),R[0]&8&&d!==(d=A[71].shortname+"")&&we(m,d),R[0]&8&&b!==(b=A[71].theme+"")&&we(k,b),R[0]&8&&z!==(z=A[71].relevance_function+"")&&we(O,z)},d(A){A&&S(e),te=!1,J()}}}function Ro(l){let e,t=l[74]+"",n;return{c(){e=f("option"),n=q(t),e.__value=l[74],e.value=e.__value},m(o,c){$(o,e,c),s(e,n)},p:Pe,d(o){o&&S(e)}}}function la(l){let e;return{c(){e=q("Directory Path")},m(t,n){$(t,e,n)},d(t){t&&S(e)}}}function na(l){let e;return{c(){e=q("Server URL")},m(t,n){$(t,e,n)},d(t){t&&S(e)}}}function Eo(l){let e;return{c(){e=f("p"),e.textContent="Click to select directory",i(e,"class","help")},m(t,n){$(t,e,n)},d(t){t&&S(e)}}}function Lo(l){let e,t,n,o,c,r,u,a,d,m,p,_;function g(){l[34].call(u,l[79],l[87])}return{c(){e=f("div"),t=f("label"),n=q("Atomic Server Secret"),c=h(),r=f("div"),u=f("input"),d=h(),m=f("p"),m.textContent="Leave empty for anonymous access",i(t,"class","label"),i(t,"for",o=`haystack-secret-${l[79]}-${l[87]}`),i(u,"class","input"),i(u,"id",a=`haystack-secret-${l[79]}-${l[87]}`),i(u,"type","password"),i(u,"placeholder","Base64 encoded secret (optional)"),i(r,"class","control"),i(m,"class","help"),i(e,"class","field")},m(y,b){$(y,e,b),s(e,t),s(t,n),s(e,c),s(e,r),s(r,u),Oe(u,l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret),s(e,d),s(e,m),p||(_=ne(u,"input",g),p=!0)},p(y,b){l=y,b[0]&264&&o!==(o=`haystack-secret-${l[79]}-${l[87]}`)&&i(t,"for",o),b[0]&264&&a!==(a=`haystack-secret-${l[79]}-${l[87]}`)&&i(u,"id",a),b[0]&264&&u.value!==l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret&&Oe(u,l[3].roles[l[79]].haystacks[l[87]].atomic_server_secret)},d(y){y&&S(e),p=!1,_()}}}function Ao(l){let e,t,n,o,c,r,u,a,d,m,p,_,g,y,b,k,w,C,v,T,z,O,N,E,G,te,J,A,R,se,U,Y,le,Q,ie,D,M,V,K,x,I,F,P;function L(){l[35].call(m,l[79],l[87])}function W(...fe){return l[36](l[79],l[87],...fe)}let oe=Object.entries(l[3].roles[l[79]].haystacks[l[87]].extra_parameters||{}),Z=[];for(let fe=0;fe<oe.length;fe+=1)Z[fe]=Po(ko(l,oe,fe));function ee(){return l[40](l[79],l[87])}function me(){return l[41](l[79],l[87])}function _e(){return l[42](l[79],l[87])}return{c(){e=f("div"),t=f("label"),t.textContent="Extra Parameters (for filtering)",n=h(),o=f("div"),c=f("div"),r=f("label"),u=q("Hashtag"),d=h(),m=f("input"),_=h(),g=f("div"),y=f("div"),b=f("label"),k=q("Presets"),C=h(),v=f("div"),T=f("select"),z=f("option"),z.textContent="(choose)",O=f("option"),O.textContent="#rust",N=f("option"),N.textContent="#docs",E=f("option"),E.textContent="#test",G=f("option"),G.textContent="#todo",J=h(),A=f("p"),A.innerHTML="When set, searches will enforce the hashtag alongside your query (AND), e.g. <code>-e &quot;search&quot; -e &quot;#rust&quot;</code>.",R=h();for(let fe=0;fe<Z.length;fe+=1)Z[fe].c();se=h(),U=f("div"),Y=f("div"),le=f("button"),le.textContent="+ Tag Filter",Q=h(),ie=f("div"),D=f("button"),D.textContent="+ Max Results",M=h(),V=f("div"),K=f("button"),K.textContent="+ Custom Parameter",x=h(),I=f("p"),I.innerHTML=`Common parameters: <code>tag</code> (e.g., &quot;#rust&quot;), <code>glob</code> (e.g., &quot;*.md&quot;),
                  <code>max_count</code> (e.g., &quot;10&quot;), <code>context</code> (e.g., &quot;5&quot;)`,i(t,"class","label"),i(r,"class","label"),i(r,"for",a=`ripgrep-hashtag-${l[79]}-${l[87]}`),i(m,"class","input"),i(m,"id",p=`ripgrep-hashtag-${l[79]}-${l[87]}`),i(m,"type","text"),i(m,"placeholder","#rust"),i(c,"class","control"),i(o,"class","field is-grouped"),i(b,"class","label"),i(b,"for",w=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`),z.__value="",z.value=z.__value,O.__value="#rust",O.value=O.__value,N.__value="#docs",N.value=N.__value,E.__value="#test",E.value=E.__value,G.__value="#todo",G.value=G.__value,i(T,"id",te=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`),i(v,"class","select is-small"),i(y,"class","control"),i(g,"class","field is-grouped"),ge(g,"margin-bottom",".5rem"),i(A,"class","help"),i(le,"class","button is-small is-link is-light"),i(Y,"class","control"),i(D,"class","button is-small is-link is-light"),i(ie,"class","control"),i(K,"class","button is-small is-link is-light"),i(V,"class","control"),i(U,"class","field is-grouped"),i(I,"class","help"),i(e,"class","field")},m(fe,de){$(fe,e,de),s(e,t),s(e,n),s(e,o),s(o,c),s(c,r),s(r,u),s(c,d),s(c,m),Oe(m,l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag),s(e,_),s(e,g),s(g,y),s(y,b),s(b,k),s(y,C),s(y,v),s(v,T),s(T,z),s(T,O),s(T,N),s(T,E),s(T,G),s(e,J),s(e,A),s(e,R);for(let pe=0;pe<Z.length;pe+=1)Z[pe]&&Z[pe].m(e,null);s(e,se),s(e,U),s(U,Y),s(Y,le),s(U,Q),s(U,ie),s(ie,D),s(U,M),s(U,V),s(V,K),s(e,x),s(e,I),F||(P=[ne(m,"input",L),ne(T,"change",W),ne(le,"click",ee),ne(D,"click",me),ne(K,"click",_e)],F=!0)},p(fe,de){if(l=fe,de[0]&264&&a!==(a=`ripgrep-hashtag-${l[79]}-${l[87]}`)&&i(r,"for",a),de[0]&264&&p!==(p=`ripgrep-hashtag-${l[79]}-${l[87]}`)&&i(m,"id",p),de[0]&264&&m.value!==l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag&&Oe(m,l[3].roles[l[79]].haystacks[l[87]].extra_parameters.tag),de[0]&264&&w!==(w=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`)&&i(b,"for",w),de[0]&264&&te!==(te=`ripgrep-hashtag-preset-${l[79]}-${l[87]}`)&&i(T,"id",te),de[0]&393224){oe=Object.entries(l[3].roles[l[79]].haystacks[l[87]].extra_parameters||{});let pe;for(pe=0;pe<oe.length;pe+=1){const he=ko(l,oe,pe);Z[pe]?Z[pe].p(he,de):(Z[pe]=Po(he),Z[pe].c(),Z[pe].m(e,se))}for(;pe<Z.length;pe+=1)Z[pe].d(1);Z.length=oe.length}},d(fe){fe&&S(e),xe(Z,fe),F=!1,Qe(P)}}}function Po(l){let e,t,n,o,c,r,u,a,d,m,p,_,g;function y(...w){return l[37](l[79],l[87],l[88],...w)}function b(){l[38].call(u,l[79],l[87],l[88])}function k(){return l[39](l[79],l[87],l[88])}return{c(){e=f("div"),t=f("div"),n=f("input"),c=h(),r=f("div"),u=f("input"),a=h(),d=f("div"),m=f("button"),m.textContent="√ó",p=h(),i(n,"class","input"),i(n,"type","text"),i(n,"placeholder","Parameter name"),n.value=o=l[88],i(t,"class","control"),i(u,"class","input"),i(u,"type","text"),i(u,"placeholder","Parameter value"),i(r,"class","control is-expanded"),i(m,"class","button is-small is-danger"),i(d,"class","control"),i(e,"class","field is-grouped")},m(w,C){$(w,e,C),s(e,t),s(t,n),s(e,c),s(e,r),s(r,u),Oe(u,l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]]),s(e,a),s(e,d),s(d,m),s(e,p),_||(g=[ne(n,"blur",y),ne(u,"input",b),ne(m,"click",k)],_=!0)},p(w,C){l=w,C[0]&264&&o!==(o=l[88])&&n.value!==o&&(n.value=o),C[0]&264&&u.value!==l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]]&&Oe(u,l[3].roles[l[79]].haystacks[l[87]].extra_parameters[l[88]])},d(w){w&&S(e),_=!1,Qe(g)}}}function Oo(l){let e,t,n,o,c,r,u,a,d,m,p,_,g,y,b,k,w,C,v,T,z,O,N,E,G,te,J,A,R,se,U,Y,le,Q,ie,D,M,V,K;function x(){l[31].call(d,l[79],l[87])}function I(fe,de){return fe[3].roles[fe[79]].haystacks[fe[87]].service==="Atomic"?na:la}let F=I(l),P=F(l);function L(){l[32].call(v,l[79],l[87])}function W(){return l[33](l[79],l[87])}let oe=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"&&Eo(),Z=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"&&Lo(l),ee=l[3].roles[l[79]].haystacks[l[87]].service==="Ripgrep"&&Ao(l);function me(){l[43].call(R,l[79],l[87])}function _e(){return l[44](l[79],l[87])}return{c(){e=f("div"),t=f("div"),n=f("label"),o=q("Service Type"),r=h(),u=f("div"),a=f("div"),d=f("select"),m=f("option"),m.textContent="Ripgrep (File Search)",p=f("option"),p.textContent="Atomic Server",g=h(),y=f("div"),b=f("label"),P.c(),w=h(),C=f("div"),v=f("input"),N=h(),oe&&oe.c(),E=h(),Z&&Z.c(),G=h(),ee&&ee.c(),te=h(),J=f("div"),A=f("label"),R=f("input"),U=q(`
                ¬†Read-only`),le=h(),Q=f("div"),ie=f("button"),D=q("Remove Haystack"),i(n,"class","label"),i(n,"for",c=`haystack-service-${l[79]}-${l[87]}`),m.__value="Ripgrep",m.value=m.__value,p.__value="Atomic",p.value=p.__value,i(d,"id",_=`haystack-service-${l[79]}-${l[87]}`),l[3].roles[l[79]].haystacks[l[87]].service===void 0&&it(x),i(a,"class","select"),i(u,"class","control"),i(t,"class","field"),i(b,"class","label"),i(b,"for",k=`haystack-path-${l[79]}-${l[87]}`),i(v,"class","input"),i(v,"id",T=`haystack-path-${l[79]}-${l[87]}`),i(v,"type","text"),i(v,"placeholder",z=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?"https://localhost:9883":"/path/to/documents"),v.readOnly=O=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic",i(C,"class","control"),i(y,"class","field"),i(R,"id",se=`haystack-readonly-${l[79]}-${l[87]}`),i(R,"type","checkbox"),i(A,"class","checkbox"),i(A,"for",Y=`haystack-readonly-${l[79]}-${l[87]}`),i(J,"class","field"),i(ie,"class","button is-small is-danger"),i(ie,"data-testid",M="remove-haystack-"+l[79]+"-"+l[87]),i(Q,"class","field"),i(e,"class","box is-light")},m(fe,de){$(fe,e,de),s(e,t),s(t,n),s(n,o),s(t,r),s(t,u),s(u,a),s(a,d),s(d,m),s(d,p),Ke(d,l[3].roles[l[79]].haystacks[l[87]].service,!0),s(e,g),s(e,y),s(y,b),P.m(b,null),s(y,w),s(y,C),s(C,v),Oe(v,l[3].roles[l[79]].haystacks[l[87]].path),s(C,N),oe&&oe.m(C,null),s(e,E),Z&&Z.m(e,null),s(e,G),ee&&ee.m(e,null),s(e,te),s(e,J),s(J,A),s(A,R),R.checked=l[3].roles[l[79]].haystacks[l[87]].read_only,s(A,U),s(e,le),s(e,Q),s(Q,ie),s(ie,D),V||(K=[ne(d,"change",x),ne(v,"input",L),ne(v,"click",function(){Dl(l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?W:void 0)&&(l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?W:void 0).apply(this,arguments)}),ne(R,"change",me),ne(ie,"click",_e)],V=!0)},p(fe,de){l=fe,de[0]&264&&c!==(c=`haystack-service-${l[79]}-${l[87]}`)&&i(n,"for",c),de[0]&264&&_!==(_=`haystack-service-${l[79]}-${l[87]}`)&&i(d,"id",_),de[0]&264&&Ke(d,l[3].roles[l[79]].haystacks[l[87]].service),F!==(F=I(l))&&(P.d(1),P=F(l),P&&(P.c(),P.m(b,null))),de[0]&264&&k!==(k=`haystack-path-${l[79]}-${l[87]}`)&&i(b,"for",k),de[0]&264&&T!==(T=`haystack-path-${l[79]}-${l[87]}`)&&i(v,"id",T),de[0]&264&&z!==(z=l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?"https://localhost:9883":"/path/to/documents")&&i(v,"placeholder",z),de[0]&280&&O!==(O=l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic")&&(v.readOnly=O),de[0]&264&&v.value!==l[3].roles[l[79]].haystacks[l[87]].path&&Oe(v,l[3].roles[l[79]].haystacks[l[87]].path),l[4]&&l[3].roles[l[79]].haystacks[l[87]].service!=="Atomic"?oe||(oe=Eo(),oe.c(),oe.m(C,null)):oe&&(oe.d(1),oe=null),l[3].roles[l[79]].haystacks[l[87]].service==="Atomic"?Z?Z.p(l,de):(Z=Lo(l),Z.c(),Z.m(e,G)):Z&&(Z.d(1),Z=null),l[3].roles[l[79]].haystacks[l[87]].service==="Ripgrep"?ee?ee.p(l,de):(ee=Ao(l),ee.c(),ee.m(e,te)):ee&&(ee.d(1),ee=null),de[0]&264&&se!==(se=`haystack-readonly-${l[79]}-${l[87]}`)&&i(R,"id",se),de[0]&264&&(R.checked=l[3].roles[l[79]].haystacks[l[87]].read_only),de[0]&264&&Y!==(Y=`haystack-readonly-${l[79]}-${l[87]}`)&&i(A,"for",Y),de[0]&264&&M!==(M="remove-haystack-"+l[79]+"-"+l[87])&&i(ie,"data-testid",M)},d(fe){fe&&S(e),P.d(),oe&&oe.d(),Z&&Z.d(),ee&&ee.d(),V=!1,Qe(K)}}}function No(l){var ie;let e,t,n,o,c,r,u,a,d,m,p,_,g,y,b,k,w,C,v,T,z,O,N,E,G,te,J,A,R;function se(){l[47].call(u,l[79])}function U(){return l[48](l[79])}let Y=((ie=l[0][l[79]])==null?void 0:ie.length)&&Do(l);function le(){l[50].call(v,l[79])}function Q(){l[51].call(E,l[79])}return{c(){e=f("div"),t=f("label"),n=q("Model"),c=h(),r=f("div"),u=f("input"),d=h(),m=f("button"),m.textContent="Fetch models",p=h(),Y&&Y.c(),_=h(),g=f("div"),y=f("label"),b=q("Base URL"),w=h(),C=f("div"),v=f("input"),z=h(),O=f("div"),N=f("label"),E=f("input"),te=q(`
              ¬†Automatically summarize search results`),i(t,"class","label"),i(t,"for",o=`llm-model-${l[79]}`),i(u,"class","input"),i(u,"id",a=`llm-model-${l[79]}`),i(u,"type","text"),i(u,"placeholder","llama3.1"),i(r,"class","control"),i(m,"class","button is-small"),i(e,"class","field"),i(y,"class","label"),i(y,"for",k=`llm-base-url-${l[79]}`),i(v,"class","input"),i(v,"id",T=`llm-base-url-${l[79]}`),i(v,"type","text"),i(v,"placeholder","http://127.0.0.1:11434"),i(C,"class","control"),i(g,"class","field"),i(E,"id",G=`llm-auto-summarize-${l[79]}`),i(E,"type","checkbox"),i(N,"class","checkbox"),i(N,"for",J=`llm-auto-summarize-${l[79]}`),i(O,"class","field")},m(D,M){$(D,e,M),s(e,t),s(t,n),s(e,c),s(e,r),s(r,u),Oe(u,l[3].roles[l[79]].llm_model),s(e,d),s(e,m),s(e,p),Y&&Y.m(e,null),$(D,_,M),$(D,g,M),s(g,y),s(y,b),s(g,w),s(g,C),s(C,v),Oe(v,l[3].roles[l[79]].llm_base_url),$(D,z,M),$(D,O,M),s(O,N),s(N,E),E.checked=l[3].roles[l[79]].llm_auto_summarize,s(N,te),A||(R=[ne(u,"input",se),ne(m,"click",U),ne(v,"input",le),ne(E,"change",Q)],A=!0)},p(D,M){var V;l=D,M[0]&264&&o!==(o=`llm-model-${l[79]}`)&&i(t,"for",o),M[0]&264&&a!==(a=`llm-model-${l[79]}`)&&i(u,"id",a),M[0]&264&&u.value!==l[3].roles[l[79]].llm_model&&Oe(u,l[3].roles[l[79]].llm_model),(V=l[0][l[79]])!=null&&V.length?Y?Y.p(l,M):(Y=Do(l),Y.c(),Y.m(e,null)):Y&&(Y.d(1),Y=null),M[0]&264&&k!==(k=`llm-base-url-${l[79]}`)&&i(y,"for",k),M[0]&264&&T!==(T=`llm-base-url-${l[79]}`)&&i(v,"id",T),M[0]&264&&v.value!==l[3].roles[l[79]].llm_base_url&&Oe(v,l[3].roles[l[79]].llm_base_url),M[0]&264&&G!==(G=`llm-auto-summarize-${l[79]}`)&&i(E,"id",G),M[0]&264&&(E.checked=l[3].roles[l[79]].llm_auto_summarize),M[0]&264&&J!==(J=`llm-auto-summarize-${l[79]}`)&&i(N,"for",J)},d(D){D&&S(e),Y&&Y.d(),D&&S(_),D&&S(g),D&&S(z),D&&S(O),A=!1,Qe(R)}}}function Do(l){let e,t,n,o,c=l[0][l[79]],r=[];for(let a=0;a<c.length;a+=1)r[a]=Mo(vo(l,c,a));function u(...a){return l[49](l[79],...a)}return{c(){e=f("div"),t=f("select");for(let a=0;a<r.length;a+=1)r[a].c();i(e,"class","select is-fullwidth"),ge(e,"margin-top","0.5rem")},m(a,d){$(a,e,d),s(e,t);for(let m=0;m<r.length;m+=1)r[m]&&r[m].m(t,null);n||(o=ne(t,"change",u),n=!0)},p(a,d){if(l=a,d[0]&9){c=l[0][l[79]];let m;for(m=0;m<c.length;m+=1){const p=vo(l,c,m);r[m]?r[m].p(p,d):(r[m]=Mo(p),r[m].c(),r[m].m(t,null))}for(;m<r.length;m+=1)r[m].d(1);r.length=c.length}},d(a){a&&S(e),xe(r,a),n=!1,o()}}}function Mo(l){let e,t=l[80]+"",n,o;return{c(){e=f("option"),n=q(t),e.__value=o=l[80],e.value=e.__value},m(c,r){$(c,e,r),s(e,n)},p(c,r){r[0]&9&&t!==(t=c[80]+"")&&we(n,t),r[0]&265&&o!==(o=c[80])&&(e.__value=o,e.value=e.__value)},d(c){c&&S(e)}}}function Io(l){var de;let e,t,n,o,c,r,u,a,d,m,p,_,g,y,b,k,w,C,v,T,z,O,N,E,G,te,J,A,R,se,U,Y,le,Q,ie,D,M,V,K,x,I,F,P,L;function W(){l[53].call(u,l[79])}function oe(){l[54].call(C,l[79])}function Z(){return l[55](l[79])}let ee=((de=l[0][l[79]])==null?void 0:de.length)&&Uo(l);function me(){l[57].call(A,l[79])}function _e(){l[58].call(M,l[79])}let fe=l[3].roles[l[79]].openrouter_chat_enabled&&Ho(l);return{c(){e=f("div"),t=f("label"),n=q("OpenRouter API Key"),c=h(),r=f("div"),u=f("input"),d=h(),m=f("p"),m.innerHTML='Get your API key from <a href="https://openrouter.ai" target="_blank" rel="noopener">OpenRouter</a>',p=h(),_=f("div"),g=f("label"),y=q("Model"),k=h(),w=f("div"),C=f("input"),T=h(),z=f("button"),z.textContent="Fetch models",O=h(),ee&&ee.c(),N=h(),E=f("p"),E.textContent="Choose the language model for generating summaries. Different models offer different speed/quality tradeoffs.",G=h(),te=f("div"),J=f("label"),A=f("input"),se=q(`
              ¬†Automatically summarize search results`),Y=h(),le=f("p"),le.textContent="When enabled, summaries will be generated and shown in search results.",Q=h(),ie=f("div"),D=f("label"),M=f("input"),K=q(`
              ¬†Enable Chat interface (OpenRouter)`),I=h(),fe&&fe.c(),F=rt(),i(t,"class","label"),i(t,"for",o=`openrouter-api-key-${l[79]}`),i(u,"class","input"),i(u,"id",a=`openrouter-api-key-${l[79]}`),i(u,"type","password"),i(u,"placeholder","sk-or-v1-..."),i(r,"class","control"),i(m,"class","help"),i(e,"class","field"),i(g,"class","label"),i(g,"for",b=`openrouter-model-${l[79]}`),i(C,"class","input"),i(C,"id",v=`openrouter-model-${l[79]}`),i(C,"type","text"),i(C,"placeholder","openai/gpt-4-turbo"),i(w,"class","control"),i(z,"class","button is-small"),i(E,"class","help"),i(_,"class","field"),i(A,"id",R=`openrouter-auto-summarize-${l[79]}`),i(A,"type","checkbox"),i(J,"class","checkbox"),i(J,"for",U=`openrouter-auto-summarize-${l[79]}`),i(le,"class","help"),i(te,"class","field"),i(M,"id",V=`openrouter-chat-enabled-${l[79]}`),i(M,"type","checkbox"),i(D,"class","checkbox"),i(D,"for",x=`openrouter-chat-enabled-${l[79]}`),i(ie,"class","field")},m(pe,he){$(pe,e,he),s(e,t),s(t,n),s(e,c),s(e,r),s(r,u),Oe(u,l[3].roles[l[79]].openrouter_api_key),s(e,d),s(e,m),$(pe,p,he),$(pe,_,he),s(_,g),s(g,y),s(_,k),s(_,w),s(w,C),Oe(C,l[3].roles[l[79]].openrouter_model),s(_,T),s(_,z),s(_,O),ee&&ee.m(_,null),s(_,N),s(_,E),$(pe,G,he),$(pe,te,he),s(te,J),s(J,A),A.checked=l[3].roles[l[79]].openrouter_auto_summarize,s(J,se),s(te,Y),s(te,le),$(pe,Q,he),$(pe,ie,he),s(ie,D),s(D,M),M.checked=l[3].roles[l[79]].openrouter_chat_enabled,s(D,K),$(pe,I,he),fe&&fe.m(pe,he),$(pe,F,he),P||(L=[ne(u,"input",W),ne(C,"input",oe),ne(z,"click",Z),ne(A,"change",me),ne(M,"change",_e)],P=!0)},p(pe,he){var $e;l=pe,he[0]&264&&o!==(o=`openrouter-api-key-${l[79]}`)&&i(t,"for",o),he[0]&264&&a!==(a=`openrouter-api-key-${l[79]}`)&&i(u,"id",a),he[0]&264&&u.value!==l[3].roles[l[79]].openrouter_api_key&&Oe(u,l[3].roles[l[79]].openrouter_api_key),he[0]&264&&b!==(b=`openrouter-model-${l[79]}`)&&i(g,"for",b),he[0]&264&&v!==(v=`openrouter-model-${l[79]}`)&&i(C,"id",v),he[0]&264&&C.value!==l[3].roles[l[79]].openrouter_model&&Oe(C,l[3].roles[l[79]].openrouter_model),($e=l[0][l[79]])!=null&&$e.length?ee?ee.p(l,he):(ee=Uo(l),ee.c(),ee.m(_,N)):ee&&(ee.d(1),ee=null),he[0]&264&&R!==(R=`openrouter-auto-summarize-${l[79]}`)&&i(A,"id",R),he[0]&264&&(A.checked=l[3].roles[l[79]].openrouter_auto_summarize),he[0]&264&&U!==(U=`openrouter-auto-summarize-${l[79]}`)&&i(J,"for",U),he[0]&264&&V!==(V=`openrouter-chat-enabled-${l[79]}`)&&i(M,"id",V),he[0]&264&&(M.checked=l[3].roles[l[79]].openrouter_chat_enabled),he[0]&264&&x!==(x=`openrouter-chat-enabled-${l[79]}`)&&i(D,"for",x),l[3].roles[l[79]].openrouter_chat_enabled?fe?fe.p(l,he):(fe=Ho(l),fe.c(),fe.m(F.parentNode,F)):fe&&(fe.d(1),fe=null)},d(pe){pe&&S(e),pe&&S(p),pe&&S(_),ee&&ee.d(),pe&&S(G),pe&&S(te),pe&&S(Q),pe&&S(ie),pe&&S(I),fe&&fe.d(pe),pe&&S(F),P=!1,Qe(L)}}}function Uo(l){let e,t,n,o,c=l[0][l[79]],r=[];for(let a=0;a<c.length;a+=1)r[a]=jo(go(l,c,a));function u(...a){return l[56](l[79],...a)}return{c(){e=f("div"),t=f("select");for(let a=0;a<r.length;a+=1)r[a].c();i(e,"class","select is-fullwidth"),ge(e,"margin-top","0.5rem")},m(a,d){$(a,e,d),s(e,t);for(let m=0;m<r.length;m+=1)r[m]&&r[m].m(t,null);n||(o=ne(t,"change",u),n=!0)},p(a,d){if(l=a,d[0]&9){c=l[0][l[79]];let m;for(m=0;m<c.length;m+=1){const p=go(l,c,m);r[m]?r[m].p(p,d):(r[m]=jo(p),r[m].c(),r[m].m(t,null))}for(;m<r.length;m+=1)r[m].d(1);r.length=c.length}},d(a){a&&S(e),xe(r,a),n=!1,o()}}}function jo(l){let e,t=l[80]+"",n,o;return{c(){e=f("option"),n=q(t),e.__value=o=l[80],e.value=e.__value},m(c,r){$(c,e,r),s(e,n)},p(c,r){r[0]&9&&t!==(t=c[80]+"")&&we(n,t),r[0]&265&&o!==(o=c[80])&&(e.__value=o,e.value=e.__value)},d(c){c&&S(e)}}}function Ho(l){let e,t,n,o,c,r,u,a,d,m,p,_,g,y,b,k,w,C,v,T,z,O,N,E,G;function te(){l[59].call(a,l[79])}function J(){l[60].call(O,l[79])}return{c(){e=f("div"),t=f("label"),n=q("Chat Model"),c=h(),r=f("div"),u=f("div"),a=f("select"),d=f("option"),d.textContent="GPT-3.5 Turbo",m=f("option"),m.textContent="GPT-4",p=f("option"),p.textContent="Claude 3 Sonnet",_=f("option"),_.textContent="Claude 3 Haiku",g=f("option"),g.textContent="Mixtral 8x7B",b=h(),k=f("div"),w=f("label"),C=q("System Prompt (optional)"),T=h(),z=f("div"),O=f("textarea"),i(t,"class","label"),i(t,"for",o=`openrouter-chat-model-${l[79]}`),d.__value="openai/gpt-3.5-turbo",d.value=d.__value,m.__value="openai/gpt-4",m.value=m.__value,p.__value="anthropic/claude-3-sonnet",p.value=p.__value,_.__value="anthropic/claude-3-haiku",_.value=_.__value,g.__value="mistralai/mixtral-8x7b-instruct",g.value=g.__value,i(a,"id",y=`openrouter-chat-model-${l[79]}`),l[3].roles[l[79]].openrouter_chat_model===void 0&&it(te),i(u,"class","select is-fullwidth"),i(r,"class","control"),i(e,"class","field"),i(w,"class","label"),i(w,"for",v=`openrouter-chat-system-${l[79]}`),i(O,"class","textarea"),i(O,"id",N=`openrouter-chat-system-${l[79]}`),i(O,"rows","3"),i(O,"placeholder","You are a helpful Rust engineer assistant..."),i(z,"class","control"),i(k,"class","field")},m(A,R){$(A,e,R),s(e,t),s(t,n),s(e,c),s(e,r),s(r,u),s(u,a),s(a,d),s(a,m),s(a,p),s(a,_),s(a,g),Ke(a,l[3].roles[l[79]].openrouter_chat_model,!0),$(A,b,R),$(A,k,R),s(k,w),s(w,C),s(k,T),s(k,z),s(z,O),Oe(O,l[3].roles[l[79]].openrouter_chat_system_prompt),E||(G=[ne(a,"change",te),ne(O,"input",J)],E=!0)},p(A,R){l=A,R[0]&264&&o!==(o=`openrouter-chat-model-${l[79]}`)&&i(t,"for",o),R[0]&264&&y!==(y=`openrouter-chat-model-${l[79]}`)&&i(a,"id",y),R[0]&264&&Ke(a,l[3].roles[l[79]].openrouter_chat_model),R[0]&264&&v!==(v=`openrouter-chat-system-${l[79]}`)&&i(w,"for",v),R[0]&264&&N!==(N=`openrouter-chat-system-${l[79]}`)&&i(O,"id",N),R[0]&264&&Oe(O,l[3].roles[l[79]].openrouter_chat_system_prompt)},d(A){A&&S(e),A&&S(b),A&&S(k),E=!1,Qe(G)}}}function Fo(l){let e;return{c(){e=f("p"),e.textContent="Click to select directory",i(e,"class","help")},m(t,n){$(t,e,n)},d(t){t&&S(e)}}}function zo(l,e){let t,n,o,c,r,u,a,d,m,p,_,g,y,b,k,w,C,v,T,z,O,N,E,G,te,J,A,R,se,U,Y,le,Q,ie,D,M,V,K,x,I,F,P,L,W,oe,Z,ee,me,_e,fe,de,pe,he,$e,We,je,Le,Re,ae,ye,Ne,Be,qe,Te,De,et,Je,Me,He,tt,ue,Ae,j,B,H,ce,Se,Ce,Ve,nt,Fe,lt,kt,gt,ul,Kt,fl,Zt,qt,dl,Mt,wt,Wl,hl,Bl,gl,Rt,vl,Jl,Xt,xt,Vl,bl,Ql,Gt,mt,kl,Yl,Zl,wl,el,tl,Xl,yl,xl,Cl,Pt,ll,nl,Tl,en,ol,jt,It,Sl,tn,$l,ln,Wt,Ut,Rl,nn,El,on,sn,rn,Bt,an,Ll,Il,cn;function Ss(){e[26].call(d,e[79])}function $s(){e[27].call(C,e[79])}let sl=e[8],_t=[];for(let Ge=0;Ge<sl.length;Ge+=1)_t[Ge]=Ro(wo(e,sl,Ge));function un(){e[28].call(A,e[79])}function fn(){e[29].call(V,e[79])}function Rs(){e[30].call(ee,e[79])}let rl=e[77].haystacks,ht=[];for(let Ge=0;Ge<rl.length;Ge+=1)ht[Ge]=Oo(bo(e,rl,Ge));function Es(){return e[45](e[79])}function dn(){e[46].call(Me,e[79])}let vt=e[3].roles[e[79]].llm_provider==="ollama"&&No(e);function Ls(){e[52].call(Fe,e[79])}let bt=e[3].roles[e[79]].openrouter_enabled&&Io(e);function As(){e[61].call(Rt,e[79])}function Ps(){e[62].call(mt,e[79])}function pn(){return e[63](e[79])}let yt=e[4]&&Fo();function mn(){e[64].call(Pt,e[79])}function Os(){e[65].call(It,e[79])}function Ns(){e[66].call(Ut,e[79])}function Ds(){return e[67](e[79])}return{key:l,first:null,c(){t=f("div"),n=f("div"),o=f("label"),c=q("Role name"),u=h(),a=f("div"),d=f("input"),p=h(),_=f("div"),g=f("label"),y=q("Short name"),k=h(),w=f("div"),C=f("input"),T=h(),z=f("div"),O=f("label"),N=q("Theme"),G=h(),te=f("div"),J=f("div"),A=f("select");for(let Ge=0;Ge<_t.length;Ge+=1)_t[Ge].c();se=h(),U=f("div"),Y=f("label"),le=q("Relevance function"),ie=h(),D=f("div"),M=f("div"),V=f("select"),K=f("option"),K.textContent="title-scorer",x=f("option"),x.textContent="terraphim-graph",I=f("option"),I.textContent="bm25",F=f("option"),F.textContent="bm25f",P=f("option"),P.textContent="bm25plus",W=h(),oe=f("div"),Z=f("label"),ee=f("input"),_e=q(`
            Enable Terraphim IT features (KG preprocessing, auto-linking)`),de=h(),pe=f("h5"),pe.textContent="Haystacks",he=h();for(let Ge=0;Ge<ht.length;Ge+=1)ht[Ge].c();$e=h(),We=f("button"),je=q("Add Haystack"),Re=h(),ae=f("h5"),ae.textContent="AI-Enhanced Summaries (LLM Provider)",ye=h(),Ne=f("div"),Be=f("label"),qe=q("Provider"),De=h(),et=f("div"),Je=f("div"),Me=f("select"),He=f("option"),He.textContent="(none)",tt=f("option"),tt.textContent="OpenRouter",ue=f("option"),ue.textContent="Ollama (local)",j=h(),B=f("p"),B.textContent="Choose a provider. OpenRouter uses API key; Ollama runs locally.",H=h(),vt&&vt.c(),ce=h(),Se=f("h5"),Se.textContent="AI-Enhanced Summaries (OpenRouter)",Ce=h(),Ve=f("div"),nt=f("label"),Fe=f("input"),kt=q(`
            ¬†Enable AI-generated article summaries`),ul=h(),Kt=f("p"),Kt.textContent="Generate intelligent summaries using OpenRouter's language models",fl=h(),bt&&bt.c(),Zt=h(),qt=f("h5"),qt.textContent="Knowledge Graph",dl=h(),Mt=f("div"),wt=f("label"),Wl=q("Remote automata URL"),Bl=h(),gl=f("div"),Rt=f("input"),Jl=h(),Xt=f("div"),xt=f("label"),Vl=q("Local KG path"),Ql=h(),Gt=f("div"),mt=f("input"),Yl=h(),yt&&yt.c(),Zl=h(),wl=f("div"),el=f("div"),tl=f("label"),Xl=q("Local KG type"),xl=h(),Cl=f("div"),Pt=f("select"),ll=f("option"),ll.textContent="markdown",nl=f("option"),nl.textContent="json",en=h(),ol=f("div"),jt=f("label"),It=f("input"),tn=q(`
            ¬†Public`),ln=h(),Wt=f("label"),Ut=f("input"),nn=q(`
            ¬†Publish`),on=h(),sn=f("hr"),rn=h(),Bt=f("button"),an=q("Remove Role"),i(o,"class","label"),i(o,"for",r=`role-name-${e[79]}`),i(d,"class","input"),i(d,"id",m=`role-name-${e[79]}`),i(d,"type","text"),i(a,"class","control"),i(n,"class","field"),i(g,"class","label"),i(g,"for",b=`role-shortname-${e[79]}`),i(C,"class","input"),i(C,"id",v=`role-shortname-${e[79]}`),i(C,"type","text"),i(w,"class","control"),i(_,"class","field"),i(O,"class","label"),i(O,"for",E=`role-theme-${e[79]}`),i(A,"id",R=`role-theme-${e[79]}`),e[3].roles[e[79]].theme===void 0&&it(un),i(J,"class","select is-fullwidth"),i(te,"class","control"),i(z,"class","field"),i(Y,"class","label"),i(Y,"for",Q=`role-relevance-${e[79]}`),K.__value="title-scorer",K.value=K.__value,x.__value="terraphim-graph",x.value=x.__value,I.__value="bm25",I.value=I.__value,F.__value="bm25f",F.value=F.__value,P.__value="bm25plus",P.value=P.__value,i(V,"id",L=`role-relevance-${e[79]}`),e[3].roles[e[79]].relevance_function===void 0&&it(fn),i(M,"class","select is-fullwidth"),i(D,"class","control"),i(U,"class","field"),i(ee,"class","checkbox"),i(ee,"id",me=`role-terraphim-it-${e[79]}`),i(ee,"type","checkbox"),i(Z,"class","label"),i(Z,"for",fe=`role-terraphim-it-${e[79]}`),i(oe,"class","field"),i(pe,"class","title is-6"),i(We,"class","button is-small"),i(We,"data-testid",Le="add-haystack-"+e[79]),i(ae,"class","title is-6"),i(Be,"class","label"),i(Be,"for",Te=`llm-provider-${e[79]}`),He.__value="",He.value=He.__value,tt.__value="openrouter",tt.value=tt.__value,ue.__value="ollama",ue.value=ue.__value,i(Me,"id",Ae=`llm-provider-${e[79]}`),e[3].roles[e[79]].llm_provider===void 0&&it(dn),i(Je,"class","select"),i(et,"class","control"),i(B,"class","help"),i(Ne,"class","field"),i(Se,"class","title is-6"),i(Fe,"id",lt=`openrouter-enabled-${e[79]}`),i(Fe,"type","checkbox"),i(nt,"class","checkbox"),i(nt,"for",gt=`openrouter-enabled-${e[79]}`),i(Kt,"class","help"),i(Ve,"class","field"),i(qt,"class","title is-6"),i(wt,"class","label"),i(wt,"for",hl=`kg-url-${e[79]}`),i(Rt,"class","input"),i(Rt,"id",vl=`kg-url-${e[79]}`),i(Rt,"type","text"),i(Rt,"placeholder","https://example.com/thesaurus.json"),i(gl,"class","control"),i(Mt,"class","field"),i(xt,"class","label"),i(xt,"for",bl=`kg-local-path-${e[79]}`),i(mt,"class","input"),i(mt,"id",kl=`kg-local-path-${e[79]}`),i(mt,"type","text"),i(mt,"placeholder","/path/to/markdown"),mt.readOnly=e[4],i(Gt,"class","control"),i(Xt,"class","field"),i(tl,"class","label"),i(tl,"for",yl=`kg-local-type-${e[79]}`),ll.__value="markdown",ll.value=ll.__value,nl.__value="json",nl.value=nl.__value,i(Pt,"id",Tl=`kg-local-type-${e[79]}`),e[3].roles[e[79]].kg.local_type===void 0&&it(mn),i(Cl,"class","select"),i(el,"class","control"),i(wl,"class","field is-grouped"),i(It,"id",Sl=`kg-public-${e[79]}`),i(It,"type","checkbox"),i(jt,"class","checkbox"),i(jt,"for",$l=`kg-public-${e[79]}`),ge(jt,"margin-right","1rem"),i(Ut,"id",Rl=`kg-publish-${e[79]}`),i(Ut,"type","checkbox"),i(Wt,"class","checkbox"),i(Wt,"for",El=`kg-publish-${e[79]}`),i(ol,"class","field is-grouped"),i(Bt,"class","button is-small is-danger"),i(Bt,"data-testid",Ll="remove-role-"+e[79]),i(t,"class","box"),this.first=t},m(Ge,Ee){$(Ge,t,Ee),s(t,n),s(n,o),s(o,c),s(n,u),s(n,a),s(a,d),Oe(d,e[3].roles[e[79]].name),s(t,p),s(t,_),s(_,g),s(g,y),s(_,k),s(_,w),s(w,C),Oe(C,e[3].roles[e[79]].shortname),s(t,T),s(t,z),s(z,O),s(O,N),s(z,G),s(z,te),s(te,J),s(J,A);for(let Ie=0;Ie<_t.length;Ie+=1)_t[Ie]&&_t[Ie].m(A,null);Ke(A,e[3].roles[e[79]].theme,!0),s(t,se),s(t,U),s(U,Y),s(Y,le),s(U,ie),s(U,D),s(D,M),s(M,V),s(V,K),s(V,x),s(V,I),s(V,F),s(V,P),Ke(V,e[3].roles[e[79]].relevance_function,!0),s(t,W),s(t,oe),s(oe,Z),s(Z,ee),ee.checked=e[3].roles[e[79]].terraphim_it,s(Z,_e),s(t,de),s(t,pe),s(t,he);for(let Ie=0;Ie<ht.length;Ie+=1)ht[Ie]&&ht[Ie].m(t,null);s(t,$e),s(t,We),s(We,je),s(t,Re),s(t,ae),s(t,ye),s(t,Ne),s(Ne,Be),s(Be,qe),s(Ne,De),s(Ne,et),s(et,Je),s(Je,Me),s(Me,He),s(Me,tt),s(Me,ue),Ke(Me,e[3].roles[e[79]].llm_provider,!0),s(Ne,j),s(Ne,B),s(t,H),vt&&vt.m(t,null),s(t,ce),s(t,Se),s(t,Ce),s(t,Ve),s(Ve,nt),s(nt,Fe),Fe.checked=e[3].roles[e[79]].openrouter_enabled,s(nt,kt),s(Ve,ul),s(Ve,Kt),s(t,fl),bt&&bt.m(t,null),s(t,Zt),s(t,qt),s(t,dl),s(t,Mt),s(Mt,wt),s(wt,Wl),s(Mt,Bl),s(Mt,gl),s(gl,Rt),Oe(Rt,e[3].roles[e[79]].kg.url),s(t,Jl),s(t,Xt),s(Xt,xt),s(xt,Vl),s(Xt,Ql),s(Xt,Gt),s(Gt,mt),Oe(mt,e[3].roles[e[79]].kg.local_path),s(Gt,Yl),yt&&yt.m(Gt,null),s(t,Zl),s(t,wl),s(wl,el),s(el,tl),s(tl,Xl),s(el,xl),s(el,Cl),s(Cl,Pt),s(Pt,ll),s(Pt,nl),Ke(Pt,e[3].roles[e[79]].kg.local_type,!0),s(t,en),s(t,ol),s(ol,jt),s(jt,It),It.checked=e[3].roles[e[79]].kg.public,s(jt,tn),s(ol,ln),s(ol,Wt),s(Wt,Ut),Ut.checked=e[3].roles[e[79]].kg.publish,s(Wt,nn),s(t,on),s(t,sn),s(t,rn),s(t,Bt),s(Bt,an),Il||(cn=[ne(d,"input",Ss),ne(C,"input",$s),ne(A,"change",un),ne(V,"change",fn),ne(ee,"change",Rs),ne(We,"click",Es),ne(Me,"change",dn),ne(Fe,"change",Ls),ne(Rt,"input",As),ne(mt,"input",Ps),ne(mt,"click",function(){Dl(e[4]?pn:void 0)&&(e[4]?pn:void 0).apply(this,arguments)}),ne(Pt,"change",mn),ne(It,"change",Os),ne(Ut,"change",Ns),ne(Bt,"click",Ds)],Il=!0)},p(Ge,Ee){if(e=Ge,Ee[0]&264&&r!==(r=`role-name-${e[79]}`)&&i(o,"for",r),Ee[0]&264&&m!==(m=`role-name-${e[79]}`)&&i(d,"id",m),Ee[0]&264&&d.value!==e[3].roles[e[79]].name&&Oe(d,e[3].roles[e[79]].name),Ee[0]&264&&b!==(b=`role-shortname-${e[79]}`)&&i(g,"for",b),Ee[0]&264&&v!==(v=`role-shortname-${e[79]}`)&&i(C,"id",v),Ee[0]&264&&C.value!==e[3].roles[e[79]].shortname&&Oe(C,e[3].roles[e[79]].shortname),Ee[0]&264&&E!==(E=`role-theme-${e[79]}`)&&i(O,"for",E),Ee[0]&256){sl=e[8];let Ie;for(Ie=0;Ie<sl.length;Ie+=1){const pl=wo(e,sl,Ie);_t[Ie]?_t[Ie].p(pl,Ee):(_t[Ie]=Ro(pl),_t[Ie].c(),_t[Ie].m(A,null))}for(;Ie<_t.length;Ie+=1)_t[Ie].d(1);_t.length=sl.length}if(Ee[0]&264&&R!==(R=`role-theme-${e[79]}`)&&i(A,"id",R),Ee[0]&264&&Ke(A,e[3].roles[e[79]].theme),Ee[0]&264&&Q!==(Q=`role-relevance-${e[79]}`)&&i(Y,"for",Q),Ee[0]&264&&L!==(L=`role-relevance-${e[79]}`)&&i(V,"id",L),Ee[0]&264&&Ke(V,e[3].roles[e[79]].relevance_function),Ee[0]&264&&me!==(me=`role-terraphim-it-${e[79]}`)&&i(ee,"id",me),Ee[0]&264&&(ee.checked=e[3].roles[e[79]].terraphim_it),Ee[0]&264&&fe!==(fe=`role-terraphim-it-${e[79]}`)&&i(Z,"for",fe),Ee[0]&491576){rl=e[77].haystacks;let Ie;for(Ie=0;Ie<rl.length;Ie+=1){const pl=bo(e,rl,Ie);ht[Ie]?ht[Ie].p(pl,Ee):(ht[Ie]=Oo(pl),ht[Ie].c(),ht[Ie].m(t,$e))}for(;Ie<ht.length;Ie+=1)ht[Ie].d(1);ht.length=rl.length}Ee[0]&264&&Le!==(Le="add-haystack-"+e[79])&&i(We,"data-testid",Le),Ee[0]&264&&Te!==(Te=`llm-provider-${e[79]}`)&&i(Be,"for",Te),Ee[0]&264&&Ae!==(Ae=`llm-provider-${e[79]}`)&&i(Me,"id",Ae),Ee[0]&264&&Ke(Me,e[3].roles[e[79]].llm_provider),e[3].roles[e[79]].llm_provider==="ollama"?vt?vt.p(e,Ee):(vt=No(e),vt.c(),vt.m(t,ce)):vt&&(vt.d(1),vt=null),Ee[0]&264&&lt!==(lt=`openrouter-enabled-${e[79]}`)&&i(Fe,"id",lt),Ee[0]&264&&(Fe.checked=e[3].roles[e[79]].openrouter_enabled),Ee[0]&264&&gt!==(gt=`openrouter-enabled-${e[79]}`)&&i(nt,"for",gt),e[3].roles[e[79]].openrouter_enabled?bt?bt.p(e,Ee):(bt=Io(e),bt.c(),bt.m(t,Zt)):bt&&(bt.d(1),bt=null),Ee[0]&264&&hl!==(hl=`kg-url-${e[79]}`)&&i(wt,"for",hl),Ee[0]&264&&vl!==(vl=`kg-url-${e[79]}`)&&i(Rt,"id",vl),Ee[0]&264&&Rt.value!==e[3].roles[e[79]].kg.url&&Oe(Rt,e[3].roles[e[79]].kg.url),Ee[0]&264&&bl!==(bl=`kg-local-path-${e[79]}`)&&i(xt,"for",bl),Ee[0]&264&&kl!==(kl=`kg-local-path-${e[79]}`)&&i(mt,"id",kl),Ee[0]&16&&(mt.readOnly=e[4]),Ee[0]&264&&mt.value!==e[3].roles[e[79]].kg.local_path&&Oe(mt,e[3].roles[e[79]].kg.local_path),e[4]?yt||(yt=Fo(),yt.c(),yt.m(Gt,null)):yt&&(yt.d(1),yt=null),Ee[0]&264&&yl!==(yl=`kg-local-type-${e[79]}`)&&i(tl,"for",yl),Ee[0]&264&&Tl!==(Tl=`kg-local-type-${e[79]}`)&&i(Pt,"id",Tl),Ee[0]&264&&Ke(Pt,e[3].roles[e[79]].kg.local_type),Ee[0]&264&&Sl!==(Sl=`kg-public-${e[79]}`)&&i(It,"id",Sl),Ee[0]&264&&(It.checked=e[3].roles[e[79]].kg.public),Ee[0]&264&&$l!==($l=`kg-public-${e[79]}`)&&i(jt,"for",$l),Ee[0]&264&&Rl!==(Rl=`kg-publish-${e[79]}`)&&i(Ut,"id",Rl),Ee[0]&264&&(Ut.checked=e[3].roles[e[79]].kg.publish),Ee[0]&264&&El!==(El=`kg-publish-${e[79]}`)&&i(Wt,"for",El),Ee[0]&264&&Ll!==(Ll="remove-role-"+e[79])&&i(Bt,"data-testid",Ll)},d(Ge){Ge&&S(t),xe(_t,Ge),xe(ht,Ge),vt&&vt.d(),bt&&bt.d(),yt&&yt.d(),Il=!1,Qe(cn)}}}function Ko(l){let e,t=l[74]+"",n;return{c(){e=f("option"),n=q(t),e.__value=l[74],e.value=e.__value},m(o,c){$(o,e,c),s(e,n)},p:Pe,d(o){o&&S(e)}}}function qo(l){let e,t=l[71].name+"",n,o;return{c(){e=f("option"),n=q(t),e.__value=o=l[71].name,e.value=e.__value},m(c,r){$(c,e,r),s(e,n)},p(c,r){r[0]&8&&t!==(t=c[71].name+"")&&we(n,t),r[0]&264&&o!==(o=c[71].name)&&(e.__value=o,e.value=e.__value)},d(c){c&&S(e)}}}function Go(l){let e,t,n;return{c(){e=f("button"),e.textContent="Back",i(e,"class","button"),i(e,"data-testid","wizard-back")},m(o,c){$(o,e,c),t||(n=ne(e,"click",l[11]),t=!0)},p:Pe,d(o){o&&S(e),t=!1,n()}}}function oa(l){let e,t,n;return{c(){e=f("button"),e.textContent="Save",i(e,"class","button is-success"),i(e,"data-testid","wizard-save")},m(o,c){$(o,e,c),t||(n=ne(e,"click",l[19]),t=!0)},p:Pe,d(o){o&&S(e),t=!1,n()}}}function sa(l){let e,t,n;return{c(){e=f("button"),e.textContent="Next",i(e,"class","button is-primary"),i(e,"data-testid","wizard-next")},m(o,c){$(o,e,c),t||(n=ne(e,"click",l[10]),t=!0)},p:Pe,d(o){o&&S(e),t=!1,n()}}}function ra(l){let e,t,n,o,c,r,u,a,d,m,p,_,g,y,b,k,w,C;e=new cl({props:{fallbackPath:"/"}});let v=l[2]==="success"&&To(l),T=l[2]==="error"&&So(l);function z(A,R){return A[1]===1?ta:A[1]===2?ea:xi}let O=z(l),N=O(l),E=l[1]>1&&Go(l);function G(A,R){return A[1]<Ts?sa:oa}let te=G(l),J=te(l);return{c(){ve(e.$$.fragment),t=h(),n=f("div"),o=f("div"),c=f("h3"),c.textContent="Configuration Wizard",r=h(),u=f("button"),u.textContent="Close",a=h(),v&&v.c(),d=h(),T&&T.c(),m=h(),N.c(),p=h(),_=f("nav"),g=f("div"),E&&E.c(),y=h(),b=f("div"),J.c(),i(c,"class","title is-4"),ge(c,"margin-bottom","0"),i(u,"class","button is-small is-light"),i(u,"aria-label","Close configuration wizard"),i(o,"class","is-flex is-justify-content-space-between is-align-items-center"),ge(o,"gap",".5rem"),i(g,"class","level-left"),i(b,"class","level-right"),i(_,"class","level"),i(n,"class","box")},m(A,R){be(e,A,R),$(A,t,R),$(A,n,R),s(n,o),s(o,c),s(o,r),s(o,u),s(n,a),v&&v.m(n,null),s(n,d),T&&T.m(n,null),s(n,m),N.m(n,null),s(n,p),s(n,_),s(_,g),E&&E.m(g,null),s(_,y),s(_,b),J.m(b,null),k=!0,w||(C=ne(u,"click",ia),w=!0)},p(A,R){A[2]==="success"?v?v.p(A,R):(v=To(A),v.c(),v.m(n,d)):v&&(v.d(1),v=null),A[2]==="error"?T?T.p(A,R):(T=So(A),T.c(),T.m(n,m)):T&&(T.d(1),T=null),O===(O=z(A))&&N?N.p(A,R):(N.d(1),N=O(A),N&&(N.c(),N.m(n,p))),A[1]>1?E?E.p(A,R):(E=Go(A),E.c(),E.m(g,null)):E&&(E.d(1),E=null),te===(te=G(A))&&J?J.p(A,R):(J.d(1),J=te(A),J&&(J.c(),J.m(b,null)))},i(A){k||(X(e.$$.fragment,A),k=!0)},o(A){re(e.$$.fragment,A),k=!1},d(A){ke(e,A),A&&S(t),A&&S(n),v&&v.d(),T&&T.d(),N.d(),E&&E.d(),J.d(),w=!1,C()}}}const Ts=3;function ia(){typeof window<"u"&&window.history.back()}function aa(l,e,t){let n,o;Ue(l,ot,j=>t(4,o=j));const c=At(null);async function r(j,B){if($t(ot))try{const H=await mo({directory:!0,multiple:!1});H&&typeof H=="string"&&a.update(ce=>(ce.roles[j].haystacks[B].path=H,ce))}catch(H){console.error("Failed to open folder selector:",H)}}async function u(j){if($t(ot))try{const B=await mo({directory:!0,multiple:!1});B&&typeof B=="string"&&a.update(H=>(H.roles[j].kg.local_path=B,H))}catch(B){console.error("Failed to open folder selector:",B)}}const a=At({id:"Desktop",global_shortcut:"Ctrl+X",default_theme:"spacelab",default_role:"Default",roles:[]});Ue(l,a,j=>t(3,n=j));const d=["default","darkly","cerulean","cosmo","cyborg","flatly","journal","litera","lumen","lux","materia","minty","nuclear","pulse","sandstone","simplex","slate","solar","spacelab","superhero","united","yeti"];Qt(async()=>{try{let j;$t(ot)?j=await ze("get_config_schema"):j=await(await fetch("/config/schema")).json(),c.set(j);const B=$t(Lt);B&&B.id&&a.update(H=>{var ce;return{...H,id:B.id,global_shortcut:B.global_shortcut,default_theme:((ce=B.roles[B.default_role])==null?void 0:ce.theme)??"spacelab",default_role:B.default_role,roles:Object.values(B.roles).map(Se=>{var Fe,lt,kt,gt,ul,Kt,fl,Zt,qt,dl,Mt;const Ce=(Fe=Se.kg)==null?void 0:Fe.automata_path,Ve=(Ce==null?void 0:Ce.Remote)??"",nt=((kt=(lt=Se.kg)==null?void 0:lt.knowledge_graph_local)==null?void 0:kt.path)??"";return{name:Se.name,shortname:Se.shortname,relevance_function:Se.relevance_function,terraphim_it:Se.terraphim_it??!1,theme:Se.theme,haystacks:(Se.haystacks??[]).map(wt=>({path:wt.location||wt.path||"",read_only:wt.read_only??!1,service:wt.service||"Ripgrep",atomic_server_secret:wt.atomic_server_secret||"",extra_parameters:wt.extra_parameters||{}})),kg:{url:Ve,local_path:nt,local_type:((ul=(gt=Se.kg)==null?void 0:gt.knowledge_graph_local)==null?void 0:ul.input_type)??"markdown",public:((Kt=Se.kg)==null?void 0:Kt.public)??!1,publish:((fl=Se.kg)==null?void 0:fl.publish)??!1},openrouter_enabled:Se.openrouter_enabled??!1,openrouter_api_key:Se.openrouter_api_key??"",openrouter_model:Se.openrouter_model??"openai/gpt-3.5-turbo",openrouter_auto_summarize:Se.openrouter_auto_summarize??!1,openrouter_chat_enabled:Se.openrouter_chat_enabled??!1,openrouter_chat_model:Se.openrouter_chat_model??Se.openrouter_model??"openai/gpt-3.5-turbo",openrouter_chat_system_prompt:Se.openrouter_chat_system_prompt??"",llm_provider:((Zt=Se.extra)==null?void 0:Zt.llm_provider)??"",llm_model:((qt=Se.extra)==null?void 0:qt.llm_model)??"",llm_base_url:((dl=Se.extra)==null?void 0:dl.llm_base_url)??"",llm_auto_summarize:((Mt=Se.extra)==null?void 0:Mt.llm_auto_summarize)??!1}})}})}catch(j){console.error("Failed to load schema",j)}}),Qt(()=>{const j=B=>{B.key==="Escape"&&typeof window<"u"&&window.history.back()};return window.addEventListener("keydown",j),()=>window.removeEventListener("keydown",j)});let m={};async function p(j){var Ce;const H=$t(a).roles[j],ce=H.llm_provider||(H.openrouter_enabled?"openrouter":""),Se=[];try{if(ce==="ollama"){const Ve=(H.llm_base_url||"http://127.0.0.1:11434").replace(/\/$/,""),Fe=await(await fetch(`${Ve}/api/tags`)).json();if(Array.isArray(Fe==null?void 0:Fe.models))for(const lt of Fe.models)lt!=null&&lt.name&&Se.push(lt.name)}else if(ce==="openrouter"){const Ve=(Ce=H.openrouter_api_key)==null?void 0:Ce.trim();if(!Ve)throw new Error("OpenRouter API key required");const Fe=await(await fetch("https://openrouter.ai/api/v1/models",{headers:{Authorization:`Bearer ${Ve}`,"HTTP-Referer":"https://terraphim.ai","X-Title":"Terraphim Desktop"}})).json(),lt=Array.isArray(Fe==null?void 0:Fe.data)?Fe.data:[];for(const kt of lt)kt!=null&&kt.id&&Se.push(kt.id)}}catch(Ve){console.error("Failed to fetch models",Ve)}t(0,m={...m,[j]:Se})}let _=1,g="";function y(){_<Ts&&t(1,_+=1)}function b(){_>1&&t(1,_-=1)}function k(){a.update(j=>({...j,roles:[...j.roles,{name:"New Role",shortname:"new",relevance_function:"title-scorer",terraphim_it:!1,theme:"spacelab",haystacks:[],kg:{url:"",local_path:"",local_type:"markdown",public:!1,publish:!1},openrouter_enabled:!1,openrouter_api_key:"",openrouter_model:"openai/gpt-3.5-turbo",openrouter_auto_summarize:!1,openrouter_chat_enabled:!1,openrouter_chat_model:"openai/gpt-3.5-turbo",openrouter_chat_system_prompt:"",llm_provider:"",llm_model:"",llm_base_url:"",llm_auto_summarize:!1}]}))}function w(j){a.update(B=>({...B,roles:B.roles.filter((H,ce)=>ce!==j)}))}function C(j){a.update(B=>(B.roles[j].haystacks.push({path:"",read_only:!1,service:"Ripgrep",atomic_server_secret:"",extra_parameters:{}}),B))}function v(j,B){a.update(H=>(H.roles[j].haystacks=H.roles[j].haystacks.filter((ce,Se)=>Se!==B),H))}function T(j,B,H="",ce=""){a.update(Se=>{Se.roles[j].haystacks[B].extra_parameters||(Se.roles[j].haystacks[B].extra_parameters={});const Ce=H||`param_${Date.now()}`;return Se.roles[j].haystacks[B].extra_parameters[Ce]=ce,Se})}function z(j,B,H){a.update(ce=>(delete ce.roles[j].haystacks[B].extra_parameters[H],ce))}function O(j,B,H,ce){a.update(Se=>{const Ce=Se.roles[j].haystacks[B].extra_parameters;return Ce[H]!==void 0&&H!==ce&&(Ce[ce]=Ce[H],delete Ce[H]),Se})}function N(j,B,H,ce){const Se=ce.target.value;O(j,B,H,Se)}async function E(){var Se;const j=$t(a),B=$t(Lt);let H={...B};H.id=j.id,H.global_shortcut=j.global_shortcut,H.default_role=j.default_role;const ce={};j.roles.forEach(Ce=>{var lt,kt;const Ve=Ce.name,nt=Ve.replace(/^"|"$/g,"");ce[nt]={extra:((kt=(lt=B.roles)==null?void 0:lt[Ve])==null?void 0:kt.extra)??{},name:Ce.name,shortname:Ce.shortname,theme:Ce.theme,relevance_function:Ce.relevance_function,terraphim_it:Ce.terraphim_it??!1,haystacks:Ce.haystacks.map(gt=>({location:gt.path,service:gt.service,read_only:gt.read_only,atomic_server_secret:gt.service==="Atomic"?gt.atomic_server_secret:void 0,extra_parameters:gt.extra_parameters||{}})),kg:Ce.kg.url||Ce.kg.local_path?{automata_path:Ce.kg.url?{Remote:Ce.kg.url}:null,knowledge_graph_local:Ce.kg.local_path?{input_type:Ce.kg.local_type,path:Ce.kg.local_path}:null,public:Ce.kg.public,publish:Ce.kg.publish}:null,...Ce.openrouter_enabled&&{openrouter_enabled:Ce.openrouter_enabled,openrouter_api_key:Ce.openrouter_api_key,openrouter_model:Ce.openrouter_model,openrouter_auto_summarize:Ce.openrouter_auto_summarize??!1,openrouter_chat_enabled:Ce.openrouter_chat_enabled??!1,openrouter_chat_model:Ce.openrouter_chat_model??Ce.openrouter_model,openrouter_chat_system_prompt:Ce.openrouter_chat_system_prompt??""}};const Fe={};Ce.llm_provider&&(Fe.llm_provider=Ce.llm_provider),Ce.llm_model&&(Fe.llm_model=Ce.llm_model),Ce.llm_base_url&&(Fe.llm_base_url=Ce.llm_base_url),typeof Ce.llm_auto_summarize=="boolean"&&(Fe.llm_auto_summarize=Ce.llm_auto_summarize),ce[nt].extra={...ce[nt].extra||{},...Fe}}),H.roles=ce,(!H.default_role||!ce[H.default_role])&&(H.default_role=((Se=j.roles[0])==null?void 0:Se.name)??"Default"),H.selected_role=H.default_role;try{if($t(ot))await ze("update_config",{configNew:H});else{const Ce=await fetch("/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(H)});if(!Ce.ok)throw new Error(`HTTP ${Ce.status}: ${Ce.statusText}`)}Lt.set(H),t(2,g="success"),setTimeout(()=>{t(2,g="")},3e3)}catch(Ce){console.error(Ce),t(2,g="error"),setTimeout(()=>{t(2,g="")},3e3)}}const G=()=>t(2,g=""),te=()=>t(2,g="");function J(){n.id=St(this),a.set(n),t(8,d)}function A(){n.global_shortcut=this.value,a.set(n),t(8,d)}function R(){n.default_theme=St(this),a.set(n),t(8,d)}function se(){n.default_role=St(this),a.set(n),t(8,d)}function U(j){n.roles[j].name=this.value,a.set(n),t(8,d)}function Y(j){n.roles[j].shortname=this.value,a.set(n),t(8,d)}function le(j){n.roles[j].theme=St(this),a.set(n),t(8,d)}function Q(j){n.roles[j].relevance_function=St(this),a.set(n),t(8,d)}function ie(j){n.roles[j].terraphim_it=this.checked,a.set(n),t(8,d)}function D(j,B){n.roles[j].haystacks[B].service=St(this),a.set(n),t(8,d)}function M(j,B){n.roles[j].haystacks[B].path=this.value,a.set(n),t(8,d)}const V=(j,B)=>r(j,B);function K(j,B){n.roles[j].haystacks[B].atomic_server_secret=this.value,a.set(n),t(8,d)}function x(j,B){n.roles[j].haystacks[B].extra_parameters.tag=this.value,a.set(n),t(8,d)}const I=(j,B,H)=>{const ce=H.currentTarget.value;ce&&Ft(a,n.roles[j].haystacks[B].extra_parameters.tag=ce,n)},F=(j,B,H,ce)=>N(j,B,H,ce);function P(j,B,H){n.roles[j].haystacks[B].extra_parameters[H]=this.value,a.set(n),t(8,d)}const L=(j,B,H)=>z(j,B,H),W=(j,B)=>T(j,B,"tag","#rust"),oe=(j,B)=>T(j,B,"max_count","10"),Z=(j,B)=>T(j,B,"","");function ee(j,B){n.roles[j].haystacks[B].read_only=this.checked,a.set(n),t(8,d)}const me=(j,B)=>v(j,B),_e=j=>C(j);function fe(j){n.roles[j].llm_provider=St(this),a.set(n),t(8,d)}function de(j){n.roles[j].llm_model=this.value,a.set(n),t(8,d)}const pe=j=>p(j),he=(j,B)=>{Ft(a,n.roles[j].llm_model=B.currentTarget.value,n)};function $e(j){n.roles[j].llm_base_url=this.value,a.set(n),t(8,d)}function We(j){n.roles[j].llm_auto_summarize=this.checked,a.set(n),t(8,d)}function je(j){n.roles[j].openrouter_enabled=this.checked,a.set(n),t(8,d)}function Le(j){n.roles[j].openrouter_api_key=this.value,a.set(n),t(8,d)}function Re(j){n.roles[j].openrouter_model=this.value,a.set(n),t(8,d)}const ae=j=>p(j),ye=(j,B)=>{Ft(a,n.roles[j].openrouter_model=B.currentTarget.value,n)};function Ne(j){n.roles[j].openrouter_auto_summarize=this.checked,a.set(n),t(8,d)}function Be(j){n.roles[j].openrouter_chat_enabled=this.checked,a.set(n),t(8,d)}function qe(j){n.roles[j].openrouter_chat_model=St(this),a.set(n),t(8,d)}function Te(j){n.roles[j].openrouter_chat_system_prompt=this.value,a.set(n),t(8,d)}function De(j){n.roles[j].kg.url=this.value,a.set(n),t(8,d)}function et(j){n.roles[j].kg.local_path=this.value,a.set(n),t(8,d)}const Je=j=>u(j);function Me(j){n.roles[j].kg.local_type=St(this),a.set(n),t(8,d)}function He(j){n.roles[j].kg.public=this.checked,a.set(n),t(8,d)}function tt(j){n.roles[j].kg.publish=this.checked,a.set(n),t(8,d)}return[m,_,g,n,o,r,u,a,d,p,y,b,k,w,C,v,T,z,N,E,G,te,J,A,R,se,U,Y,le,Q,ie,D,M,V,K,x,I,F,P,L,W,oe,Z,ee,me,_e,fe,de,pe,he,$e,We,je,Le,Re,ae,ye,Ne,Be,qe,Te,De,et,Je,Me,He,tt,j=>w(j),()=>{t(1,_=2)}]}class ca extends dt{constructor(e){super(),pt(this,e,aa,ra,ut,{},null,[-1,-1,-1,-1])}}function ua(l){let e,t,n,o,c,r,u,a;return e=new cl({props:{fallbackPath:"/"}}),u=new ks({props:{content:l[0],onChange:l[1]}}),{c(){ve(e.$$.fragment),t=h(),n=f("div"),o=f("p"),o.innerHTML="<i>The best editing experience is to configure Atomic Server, in the meantime use editor below. You will need to refresh page via Command R or Ctrl-R to see changes</i>",c=h(),r=f("div"),ve(u.$$.fragment),i(r,"class","editor"),i(n,"class","box")},m(d,m){be(e,d,m),$(d,t,m),$(d,n,m),s(n,o),s(n,c),s(n,r),be(u,r,null),a=!0},p(d,[m]){const p={};m&1&&(p.content=d[0]),u.$set(p)},i(d){a||(X(e.$$.fragment,d),X(u.$$.fragment,d),a=!0)},o(d){re(e.$$.fragment,d),re(u.$$.fragment,d),a=!1},d(d){ke(e,d),d&&S(t),d&&S(n),ke(u)}}}function fa(l,e,t){let n,o;Ue(l,Lt,u=>t(2,n=u)),Ue(l,ot,u=>t(3,o=u));let c={json:n};function r(u){if(console.log("contents changed:",u),console.log("is tauri",o),Lt.update(a=>(a=u.json,a)),$t(ot))console.log("Updating config on server"),ze("update_config",{configNew:u.json}).then(a=>{console.log(`Message: ${a}`)}).catch(a=>console.error(a));else{let a=`${Ye.ServerURL}/config/`;fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u.json)})}t(0,c=u)}return Qt(()=>{t(0,c={json:n})}),[c,r]}class da extends dt{constructor(e){super(),pt(this,e,fa,ua,ut,{})}}const{window:Kl}=Ws;function pa(l){let e,t,n,o,c,r,u,a,d,m;return{c(){e=f("div"),t=f("div"),n=f("h3"),n.textContent="Error loading graph",o=h(),c=f("p"),r=q(l[3]),u=h(),a=f("button"),a.textContent="Retry",i(a,"class","button is-primary"),i(t,"class","error-content svelte-1ry9pkl"),i(e,"class","error-overlay svelte-1ry9pkl")},m(p,_){$(p,e,_),s(e,t),s(t,n),s(t,o),s(t,c),s(c,r),s(t,u),s(t,a),d||(m=ne(a,"click",l[11]),d=!0)},p(p,_){_&8&&we(r,p[3])},d(p){p&&S(e),d=!1,m()}}}function ma(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="loading-content svelte-1ry9pkl"><div class="loader svelte-1ry9pkl"></div> 
        <p>Loading knowledge graph...</p></div>`,i(e,"class","loading-overlay svelte-1ry9pkl")},m(t,n){$(t,e,n)},p:Pe,d(t){t&&S(e)}}}function Wo(l){let e,t,n;return{c(){e=f("button"),e.innerHTML='<i class="fas fa-times svelte-1ry9pkl"></i>',i(e,"class","close-button svelte-1ry9pkl"),i(e,"title","Close Graph")},m(o,c){$(o,e,c),t||(n=ne(e,"click",l[17]),t=!0)},p:Pe,d(o){o&&S(e),t=!1,n()}}}function Bo(l){let e;return{c(){e=f("div"),e.innerHTML="<span><strong>Left-click:</strong> View node ‚Ä¢ <strong>Right-click:</strong> Edit node ‚Ä¢ <strong>Drag:</strong> Move ‚Ä¢ <strong>Scroll:</strong> Zoom</span>",i(e,"class","controls-info svelte-1ry9pkl")},m(t,n){$(t,e,n)},d(t){t&&S(e)}}}function Jo(l){let e,t;return{c(){e=f("div"),t=q(l[8]),i(e,"class","debug-message svelte-1ry9pkl")},m(n,o){$(n,e,o),s(e,t)},p(n,o){o&256&&we(t,n[8])},d(n){n&&S(e)}}}function Vo(l){let e=l[5].id,t,n,o=Qo(l);return{c(){o.c(),t=rt()},m(c,r){o.m(c,r),$(c,t,r),n=!0},p(c,r){r&32&&ut(e,e=c[5].id)?(Ze(),re(o,1,1,Pe),Xe(),o=Qo(c),o.c(),X(o,1),o.m(t.parentNode,t)):o.p(c,r)},i(c){n||(X(o),n=!0)},o(c){re(o),n=!1},d(c){c&&S(t),o.d(c)}}}function Qo(l){let e,t,n;function o(r){l[18](r)}let c={item:l[5],initialEdit:l[7]};return l[6]!==void 0&&(c.active=l[6]),e=new ql({props:c}),st.push(()=>at(e,"active",o)),e.$on("close",l[12]),e.$on("save",l[13]),{c(){ve(e.$$.fragment)},m(r,u){be(e,r,u),n=!0},p(r,u){const a={};u&32&&(a.item=r[5]),u&128&&(a.initialEdit=r[7]),!t&&u&64&&(t=!0,a.active=r[6],ct(()=>t=!1)),e.$set(a)},i(r){n||(X(e.$$.fragment,r),n=!0)},o(r){re(e.$$.fragment,r),n=!1},d(r){ke(e,r)}}}function _a(l){let e,t,n,o,c,r,u,a,d,m,p;it(l[15]),e=new cl({props:{fallbackPath:"/"}});function _(v,T){if(v[2])return ma;if(v[3])return pa}let g=_(l),y=g&&g(l),b=l[0]&&Wo(l),k=!l[2]&&!l[3]&&l[4].length>0&&Bo(),w=l[8]&&Jo(l),C=l[5]&&Vo(l);return{c(){ve(e.$$.fragment),t=h(),n=f("div"),y&&y.c(),o=h(),b&&b.c(),c=h(),k&&k.c(),r=h(),w&&w.c(),u=h(),C&&C.c(),a=rt(),i(n,"class","graph-container svelte-1ry9pkl"),ge(n,"width",l[0]?"100vw":"600px"),ge(n,"height",l[0]?"100vh":"400px"),ft(n,"fullscreen",l[0])},m(v,T){be(e,v,T),$(v,t,T),$(v,n,T),y&&y.m(n,null),l[16](n),$(v,o,T),b&&b.m(v,T),$(v,c,T),k&&k.m(v,T),$(v,r,T),w&&w.m(v,T),$(v,u,T),C&&C.m(v,T),$(v,a,T),d=!0,m||(p=ne(Kl,"resize",l[15]),m=!0)},p(v,[T]){g===(g=_(v))&&y?y.p(v,T):(y&&y.d(1),y=g&&g(v),y&&(y.c(),y.m(n,null))),(!d||T&1)&&ge(n,"width",v[0]?"100vw":"600px"),(!d||T&1)&&ge(n,"height",v[0]?"100vh":"400px"),(!d||T&1)&&ft(n,"fullscreen",v[0]),v[0]?b?b.p(v,T):(b=Wo(v),b.c(),b.m(c.parentNode,c)):b&&(b.d(1),b=null),!v[2]&&!v[3]&&v[4].length>0?k||(k=Bo(),k.c(),k.m(r.parentNode,r)):k&&(k.d(1),k=null),v[8]?w?w.p(v,T):(w=Jo(v),w.c(),w.m(u.parentNode,u)):w&&(w.d(1),w=null),v[5]?C?(C.p(v,T),T&32&&X(C,1)):(C=Vo(v),C.c(),X(C,1),C.m(a.parentNode,a)):C&&(Ze(),re(C,1,1,()=>{C=null}),Xe())},i(v){d||(X(e.$$.fragment,v),X(C),d=!0)},o(v){re(e.$$.fragment,v),re(C),d=!1},d(v){ke(e,v),v&&S(t),v&&S(n),y&&y.d(),l[16](null),v&&S(o),b&&b.d(v),v&&S(c),k&&k.d(v),v&&S(r),w&&w.d(v),v&&S(u),C&&C.d(v),v&&S(a),m=!1,p()}}}function Yo(l){return{id:`kg-node-${l.id}`,url:`#/graph/node/${l.id}`,title:l.label,body:`# ${l.label}

**Knowledge Graph Node**

ID: ${l.id}
Rank: ${l.rank}

This is a concept node from the knowledge graph. You can edit this content to add more information about "${l.label}".`,description:`Knowledge graph concept: ${l.label}`,tags:["knowledge-graph","concept"],rank:l.rank,stub:`Knowledge graph concept: ${l.label}`}}function ha(l,e,t){let n,o;Ue(l,Et,R=>t(20,n=R)),Ue(l,ot,R=>t(21,o=R));let{apiUrl:c="/rolegraph"}=e,{fullscreen:r=!0}=e,u,a=!0,d=null,m=[],p=[],_=null,g=!1,y=!1,b="",k=window.innerWidth,w=window.innerHeight;function C(){t(9,k=window.innerWidth),t(10,w=window.innerHeight),!a&&!d&&E()}async function v(){t(2,a=!0),t(3,d=null);try{if(o){console.log("Loading rolegraph from Tauri");const R=await ze("get_rolegraph",{role_name:n||void 0});if(R&&R.status==="success")t(4,m=R.nodes),p=R.edges;else throw new Error(`Tauri rolegraph fetch failed: ${(R==null?void 0:R.status)||"unknown error"}`)}else{console.log("Loading rolegraph from server");const R=n?`${c}?role=${encodeURIComponent(n)}`:c,se=await fetch(R);if(!se.ok)throw new Error(`Failed to fetch: ${se.status}`);const U=await se.json();t(4,m=U.nodes),p=U.edges}}catch(R){t(3,d=R.message),console.error("Error fetching rolegraph:",R)}finally{t(2,a=!1)}}function T(R,se){R.stopPropagation(),console.log("Node clicked:",se.label),t(5,_=Yo(se)),t(7,y=!1),t(6,g=!0)}function z(R,se){R.preventDefault(),R.stopPropagation(),console.log("Node right-clicked:",se.label),t(8,b=`Right-clicked: ${se.label}`),t(5,_=Yo(se)),t(7,y=!0),t(6,g=!0),setTimeout(()=>{t(8,b="")},2e3)}function O(){t(6,g=!1),t(5,_=null),t(7,y=!1)}async function N(){if(_)try{const R=await fetch("/documents",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(_)});R.ok?console.log("Successfully saved KG record:",_.id):console.error("Failed to save KG record:",R.statusText)}catch(R){console.error("Error saving KG record:",R)}finally{t(6,g=!1),t(5,_=null),t(7,y=!1)}}function E(){if(!u)return;t(1,u.innerHTML="",u);const R=Hl(u).append("svg").attr("width",k).attr("height",w),se=rr().scaleExtent([.1,10]).on("zoom",K=>{U.attr("transform",K.transform)});R.call(se);const U=R.append("g"),Y=ir(m).force("link",ar(p).id(K=>K.id).distance(100)).force("charge",cr().strength(-200)).force("center",ur(k/2,w/2)).force("collision",fr().radius(20)),le=U.append("g").attr("class","links").selectAll("line").data(p).enter().append("line").attr("stroke","#666").attr("stroke-opacity",.7).attr("stroke-width",K=>{const x=K.weight||K.rank||1;return Math.max(1,Math.min(8,x*2))}),Q=U.append("g").attr("class","nodes").selectAll("circle").data(m).enter().append("circle").attr("r",K=>{const x=K.rank||1;return Math.max(6,Math.min(20,x*2))}).attr("fill",K=>{const x=K.rank||1,I=Math.min(x/10,1);return dr(.2+I*.6)}).attr("stroke","#fff").attr("stroke-width",2).style("cursor","pointer").on("click",(K,x)=>T(K,x)).on("contextmenu",(K,x)=>z(K,x)).on("mouseover",function(K,x){Hl(this).transition().duration(150).attr("stroke-width",3).attr("r",I=>{const F=I.rank||1;return Math.max(8,Math.min(24,F*2.5))})}).on("mouseout",function(K,x){Hl(this).transition().duration(150).attr("stroke-width",2).attr("r",I=>{const F=I.rank||1;return Math.max(6,Math.min(20,F*2))})}).call(pr().on("start",D).on("drag",M).on("end",V)),ie=U.append("g").attr("class","labels").selectAll("text").data(m).enter().append("text").attr("text-anchor","middle").attr("dy",".35em").attr("font-size","11px").attr("font-family","Arial, sans-serif").attr("fill","#333").attr("pointer-events","none").text(K=>K.label.length>12?K.label.substring(0,12)+"...":K.label);Y.on("tick",()=>{le.attr("x1",K=>K.source.x).attr("y1",K=>K.source.y).attr("x2",K=>K.target.x).attr("y2",K=>K.target.y),Q.attr("cx",K=>K.x).attr("cy",K=>K.y),ie.attr("x",K=>K.x).attr("y",K=>K.y)});function D(K,x){K.active||Y.alphaTarget(.3).restart(),x.fx=x.x,x.fy=x.y}function M(K,x){x.fx=K.x,x.fy=K.y}function V(K,x){K.active||Y.alphaTarget(0),x.fx=null,x.fy=null}}Qt(()=>{v().then(()=>{d||E()});const R=se=>{se.preventDefault()};return u&&u.addEventListener("contextmenu",R),window.addEventListener("resize",C),()=>{u&&u.removeEventListener("contextmenu",R),window.removeEventListener("resize",C)}});function G(){t(9,k=Kl.innerWidth),t(10,w=Kl.innerHeight)}function te(R){st[R?"unshift":"push"](()=>{u=R,t(1,u)})}const J=()=>history.back();function A(R){g=R,t(6,g)}return l.$$set=R=>{"apiUrl"in R&&t(14,c=R.apiUrl),"fullscreen"in R&&t(0,r=R.fullscreen)},[r,u,a,d,m,_,g,y,b,k,w,v,O,N,c,G,te,J,A]}class ga extends dt{constructor(e){super(),pt(this,e,ha,_a,ut,{apiUrl:14,fullscreen:0})}}function Zo(l,e,t){const n=l.slice();return n[19]=e[t][0],n[20]=e[t][1],n[21]=e,n[22]=t,n}function Xo(l,e,t){const n=l.slice();return n[23]=e[t],n}function xo(l){let e,t,n,o,c,r,u,a,d,m,p,_,g,y,b=l[2].title.trim()==="",k,w,C,v,T,z,O,N,E,G,te,J,A,R,se,U=l[2].content.trim()==="",Y,le,Q,ie,D,M,V,K,x,I,F,P,L,W,oe,Z,ee,me,_e,fe,de,pe=l[1]==="edit"?"Save Changes":"Add Context",he,$e,We,je,Le,Re,ae,ye,Ne,Be,qe=l[4],Te=[];for(let B=0;B<qe.length;B+=1)Te[B]=es(Xo(l,qe,B));let De=b&&ts();function et(B,H){return B[2].summary?ba:va}let Je=et(l),Me=Je(l),He=U&&ls();function tt(B,H){return H&4&&(F=null),F==null&&(F=Object.keys(B[2].metadata).length===0),F?wa:ka}let ue=tt(l,-1),Ae=ue(l),j=l[1]==="edit"&&os(l);return{c(){e=f("section"),t=f("div"),n=f("label"),n.textContent="Type",o=h(),c=f("div"),r=f("div"),u=f("select");for(let B=0;B<Te.length;B+=1)Te[B].c();a=h(),d=f("div"),m=f("label"),m.textContent="Title *",p=h(),_=f("div"),g=f("input"),y=h(),De&&De.c(),k=h(),w=f("div"),C=f("label"),C.textContent="Summary",v=h(),T=f("div"),z=f("textarea"),O=h(),N=f("p"),Me.c(),E=h(),G=f("div"),te=f("label"),te.textContent="Content *",J=h(),A=f("div"),R=f("textarea"),se=h(),He&&He.c(),Y=h(),le=f("details"),Q=f("summary"),Q.innerHTML=`<span class="icon-text"><span class="icon"><i class="fas fa-cog"></i></span> 
              <span>Advanced Options</span></span>`,ie=h(),D=f("div"),M=f("label"),M.textContent="Metadata",V=h(),K=f("div"),x=f("p"),x.textContent="Additional key-value pairs for this context item",I=h(),Ae.c(),P=h(),L=f("button"),L.innerHTML=`<span class="icon"><i class="fas fa-plus"></i></span> 
                <span>Add Metadata</span>`,W=h(),oe=f("footer"),Z=f("div"),ee=f("div"),me=f("button"),_e=f("span"),_e.innerHTML='<i class="fas fa-save"></i>',fe=h(),de=f("span"),he=q(pe),We=h(),je=f("div"),Le=f("button"),Le.innerHTML="<span>Cancel</span>",Re=h(),j&&j.c(),ae=h(),ye=f("div"),ye.innerHTML=`<strong>Keyboard shortcuts:</strong>
          Ctrl/Cmd + Enter to save, Escape to close`,i(n,"class","label"),i(n,"for","context-type"),i(u,"id","context-type"),i(u,"data-testid","context-type-select"),l[2].context_type===void 0&&it(()=>l[10].call(u)),i(r,"class","select is-fullwidth"),i(c,"class","control"),i(t,"class","field"),i(m,"class","label"),i(m,"for","context-title"),i(g,"id","context-title"),i(g,"class","input"),i(g,"type","text"),i(g,"placeholder","Enter title..."),i(g,"data-testid","context-title-input"),g.required=!0,i(_,"class","control"),i(d,"class","field"),i(C,"class","label"),i(C,"for","context-summary"),i(z,"id","context-summary"),i(z,"class","textarea svelte-1oesbw7"),i(z,"placeholder","Brief summary of the content (optional)..."),i(z,"data-testid","context-summary-textarea"),i(z,"rows","3"),i(z,"maxlength","500"),i(T,"class","control"),i(N,"class","help svelte-1oesbw7"),i(w,"class","field"),i(te,"class","label"),i(te,"for","context-content"),i(R,"id","context-content"),i(R,"class","textarea svelte-1oesbw7"),i(R,"placeholder","Enter the full content..."),i(R,"data-testid","context-content-textarea"),i(R,"rows","8"),R.required=!0,i(A,"class","control"),i(G,"class","field"),i(Q,"class","summary svelte-1oesbw7"),i(M,"class","label"),i(x,"class","help svelte-1oesbw7"),i(L,"class","button is-small is-light"),i(K,"class","content"),i(D,"class","field mt-4"),i(le,"class","details svelte-1oesbw7"),i(e,"class","modal-card-body svelte-1oesbw7"),i(_e,"class","icon"),i(me,"class","button is-primary"),me.disabled=$e=!l[3],i(me,"data-testid","save-context-button"),i(ee,"class","control"),i(Le,"class","button is-light"),i(Le,"data-testid","cancel-context-button"),i(je,"class","control"),i(Z,"class","field is-grouped"),i(ye,"class","help svelte-1oesbw7"),i(oe,"class","modal-card-foot")},m(B,H){$(B,e,H),s(e,t),s(t,n),s(t,o),s(t,c),s(c,r),s(r,u);for(let ce=0;ce<Te.length;ce+=1)Te[ce]&&Te[ce].m(u,null);Ke(u,l[2].context_type,!0),s(e,a),s(e,d),s(d,m),s(d,p),s(d,_),s(_,g),Oe(g,l[2].title),s(d,y),De&&De.m(d,null),s(e,k),s(e,w),s(w,C),s(w,v),s(w,T),s(T,z),Oe(z,l[2].summary),s(w,O),s(w,N),Me.m(N,null),s(e,E),s(e,G),s(G,te),s(G,J),s(G,A),s(A,R),Oe(R,l[2].content),s(G,se),He&&He.m(G,null),s(e,Y),s(e,le),s(le,Q),s(le,ie),s(le,D),s(D,M),s(D,V),s(D,K),s(K,x),s(K,I),Ae.m(K,null),s(K,P),s(K,L),$(B,W,H),$(B,oe,H),s(oe,Z),s(Z,ee),s(ee,me),s(me,_e),s(me,fe),s(me,de),s(de,he),s(Z,We),s(Z,je),s(je,Le),s(Z,Re),j&&j.m(Z,null),s(oe,ae),s(oe,ye),Ne||(Be=[ne(u,"change",l[10]),ne(g,"input",l[11]),ne(z,"input",l[12]),ne(R,"input",l[13]),ne(L,"click",l[17]),ne(me,"click",l[6]),ne(Le,"click",l[5])],Ne=!0)},p(B,H){if(H&16){qe=B[4];let ce;for(ce=0;ce<qe.length;ce+=1){const Se=Xo(B,qe,ce);Te[ce]?Te[ce].p(Se,H):(Te[ce]=es(Se),Te[ce].c(),Te[ce].m(u,null))}for(;ce<Te.length;ce+=1)Te[ce].d(1);Te.length=qe.length}H&20&&Ke(u,B[2].context_type),H&20&&g.value!==B[2].title&&Oe(g,B[2].title),H&4&&(b=B[2].title.trim()===""),b?De||(De=ts(),De.c(),De.m(d,null)):De&&(De.d(1),De=null),H&20&&Oe(z,B[2].summary),Je===(Je=et(B))&&Me?Me.p(B,H):(Me.d(1),Me=Je(B),Me&&(Me.c(),Me.m(N,null))),H&20&&Oe(R,B[2].content),H&4&&(U=B[2].content.trim()===""),U?He||(He=ls(),He.c(),He.m(G,null)):He&&(He.d(1),He=null),ue===(ue=tt(B,H))&&Ae?Ae.p(B,H):(Ae.d(1),Ae=ue(B),Ae&&(Ae.c(),Ae.m(K,P))),H&2&&pe!==(pe=B[1]==="edit"?"Save Changes":"Add Context")&&we(he,pe),H&8&&$e!==($e=!B[3])&&(me.disabled=$e),B[1]==="edit"?j?j.p(B,H):(j=os(B),j.c(),j.m(Z,null)):j&&(j.d(1),j=null)},d(B){B&&S(e),xe(Te,B),De&&De.d(),Me.d(),He&&He.d(),Ae.d(),B&&S(W),B&&S(oe),j&&j.d(),Ne=!1,Qe(Be)}}}function es(l){let e,t=l[23].label+"",n;return{c(){e=f("option"),n=q(t),e.__value=l[23].value,e.value=e.__value},m(o,c){$(o,e,c),s(e,n)},p:Pe,d(o){o&&S(e)}}}function ts(l){let e;return{c(){e=f("p"),e.textContent="Title is required",i(e,"class","help is-danger svelte-1oesbw7")},m(t,n){$(t,e,n)},d(t){t&&S(e)}}}function va(l){let e;return{c(){e=q("Optional brief summary (up to 500 characters)")},m(t,n){$(t,e,n)},p:Pe,d(t){t&&S(e)}}}function ba(l){let e=l[2].summary.length+"",t,n;return{c(){t=q(e),n=q("/500 characters")},m(o,c){$(o,t,c),$(o,n,c)},p(o,c){c&4&&e!==(e=o[2].summary.length+"")&&we(t,e)},d(o){o&&S(t),o&&S(n)}}}function ls(l){let e;return{c(){e=f("p"),e.textContent="Content is required",i(e,"class","help is-danger svelte-1oesbw7")},m(t,n){$(t,e,n)},d(t){t&&S(e)}}}function ka(l){let e,t=Object.entries(l[2].metadata),n=[];for(let o=0;o<t.length;o+=1)n[o]=ns(Zo(l,t,o));return{c(){for(let o=0;o<n.length;o+=1)n[o].c();e=rt()},m(o,c){for(let r=0;r<n.length;r+=1)n[r]&&n[r].m(o,c);$(o,e,c)},p(o,c){if(c&4){t=Object.entries(o[2].metadata);let r;for(r=0;r<t.length;r+=1){const u=Zo(o,t,r);n[r]?n[r].p(u,c):(n[r]=ns(u),n[r].c(),n[r].m(e.parentNode,e))}for(;r<n.length;r+=1)n[r].d(1);n.length=t.length}},d(o){xe(n,o),o&&S(e)}}}function wa(l){let e;return{c(){e=f("p"),e.textContent="No metadata defined",i(e,"class","has-text-grey-light")},m(t,n){$(t,e,n)},p:Pe,d(t){t&&S(e)}}}function ns(l){let e,t,n,o,c,r,u,a,d,m,p,_,g;function y(...w){return l[14](l[19],l[20],...w)}function b(){l[15].call(u,l[19])}function k(){return l[16](l[19])}return{c(){e=f("div"),t=f("div"),n=f("input"),c=h(),r=f("div"),u=f("input"),a=h(),d=f("div"),m=f("button"),m.innerHTML='<span class="icon"><i class="fas fa-times"></i></span>',p=h(),i(n,"class","input is-small"),i(n,"type","text"),i(n,"placeholder","Key"),n.value=o=l[19],i(t,"class","control is-expanded"),i(u,"class","input is-small"),i(u,"type","text"),i(u,"placeholder","Value"),i(r,"class","control is-expanded"),i(m,"class","button is-small is-danger is-outlined"),i(d,"class","control"),i(e,"class","field is-grouped")},m(w,C){$(w,e,C),s(e,t),s(t,n),s(e,c),s(e,r),s(r,u),Oe(u,l[2].metadata[l[19]]),s(e,a),s(e,d),s(d,m),s(e,p),_||(g=[ne(n,"input",y),ne(u,"input",b),ne(m,"click",k)],_=!0)},p(w,C){l=w,C&20&&o!==(o=l[19])&&n.value!==o&&(n.value=o),C&20&&u.value!==l[2].metadata[l[19]]&&Oe(u,l[2].metadata[l[19]])},d(w){w&&S(e),_=!1,Qe(g)}}}function os(l){let e,t,n,o,c,r;return{c(){e=f("div"),t=h(),n=f("div"),o=f("button"),o.innerHTML=`<span class="icon"><i class="fas fa-trash"></i></span> 
                <span>Delete</span>`,i(e,"class","control is-expanded"),i(o,"class","button is-danger is-outlined"),i(o,"data-testid","delete-context-button"),i(n,"class","control")},m(u,a){$(u,e,a),$(u,t,a),$(u,n,a),s(n,o),c||(r=ne(o,"click",l[7]),c=!0)},p:Pe,d(u){u&&S(e),u&&S(t),u&&S(n),c=!1,r()}}}function ya(l){let e,t,n,o=l[1]==="edit"?"Edit Context Item":"Add Context Item",c,r,u,a,d,m,p=l[2]&&xo(l);return{c(){e=f("div"),t=f("header"),n=f("p"),c=q(o),r=h(),u=f("button"),a=h(),p&&p.c(),i(n,"class","modal-card-title"),i(u,"class","delete"),i(u,"aria-label","close"),i(t,"class","modal-card-head"),i(e,"class","modal-card")},m(_,g){$(_,e,g),s(e,t),s(t,n),s(n,c),s(t,r),s(t,u),s(e,a),p&&p.m(e,null),d||(m=ne(u,"click",l[5]),d=!0)},p(_,g){g&2&&o!==(o=_[1]==="edit"?"Edit Context Item":"Add Context Item")&&we(c,o),_[2]?p?p.p(_,g):(p=xo(_),p.c(),p.m(e,null)):p&&(p.d(1),p=null)},d(_){_&&S(e),p&&p.d(),d=!1,m()}}}function Ca(l){let e,t,n,o;return e=new Nl({props:{active:l[0],$$slots:{default:[ya]},$$scope:{ctx:l}}}),e.$on("close",l[5]),{c(){ve(e.$$.fragment)},m(c,r){be(e,c,r),t=!0,n||(o=ne(window,"keydown",l[8]),n=!0)},p(c,[r]){const u={};r&1&&(u.active=c[0]),r&67108878&&(u.$$scope={dirty:r,ctx:c}),e.$set(u)},i(c){t||(X(e.$$.fragment,c),t=!0)},o(c){re(e.$$.fragment,c),t=!1},d(c){ke(e,c),n=!1,o()}}}function Ta(l,e,t){let n,{active:o=!1}=e,{context:c=null}=e,{mode:r="edit"}=e;const u=Bs();let a=null,d=[{value:"Document",label:"Document"},{value:"SearchResult",label:"Search Result"},{value:"UserInput",label:"User Input"},{value:"System",label:"System"},{value:"External",label:"External"}];function m(){t(0,o=!1),t(2,a=null),u("close")}function p(){!n||!a||(u(r==="edit"?"update":"create",a),m())}function _(){r==="edit"&&c&&(u("delete",c.id),m())}function g(O){O.key==="Escape"?m():O.key==="Enter"&&(O.ctrlKey||O.metaKey)&&p()}function y(){a.context_type=St(this),t(2,a),t(0,o),t(9,c),t(1,r),t(4,d)}function b(){a.title=this.value,t(2,a),t(0,o),t(9,c),t(1,r),t(4,d)}function k(){a.summary=this.value,t(2,a),t(0,o),t(9,c),t(1,r),t(4,d)}function w(){a.content=this.value,t(2,a),t(0,o),t(9,c),t(1,r),t(4,d)}const C=(O,N,E)=>{const G={...a.metadata};delete G[O],G[E.target.value]=N,t(2,a.metadata=G,a)};function v(O){a.metadata[O]=this.value,t(2,a),t(0,o),t(9,c),t(1,r),t(4,d)}const T=O=>{const N={...a.metadata};delete N[O],t(2,a.metadata=N,a)},z=()=>{t(2,a.metadata={...a.metadata,[`key_${Date.now()}`]:""},a)};return l.$$set=O=>{"active"in O&&t(0,o=O.active),"context"in O&&t(9,c=O.context),"mode"in O&&t(1,r=O.mode)},l.$$.update=()=>{l.$$.dirty&515&&(o&&c?t(2,a={...c,metadata:{...c.metadata}}):o&&r==="create"&&t(2,a={id:"",context_type:"UserInput",title:"",summary:"",content:"",metadata:{},created_at:new Date().toISOString(),relevance_score:null})),l.$$.dirty&4&&t(3,n=a&&a.title.trim()!==""&&a.content.trim()!=="")},[o,r,a,n,d,m,p,_,g,c,y,b,k,w,C,v,T,z]}class Sa extends dt{constructor(e){super(),pt(this,e,Ta,Ca,ut,{active:0,context:9,mode:1})}}function ss(l,e,t){const n=l.slice();return n[40]=e[t],n[42]=t,n}function rs(l,e,t){const n=l.slice();return n[43]=e[t],n[45]=t,n}function is(l){let e,t,n;return{c(){e=f("p"),t=q("Conversation ID: "),n=q(l[5]),i(e,"class","is-size-7 has-text-grey")},m(o,c){$(o,e,c),s(e,t),s(e,n)},p(o,c){c[0]&32&&we(n,o[5])},d(o){o&&S(e)}}}function as(l){let e,t,n,o=l[43].content+"",c,r;return{c(){e=f("div"),t=f("div"),n=f("pre"),c=q(o),i(n,"class","svelte-rbq0zi"),i(t,"class","bubble svelte-rbq0zi"),i(e,"class",r=Dt(`msg ${l[43].role}`)+" svelte-rbq0zi")},m(u,a){$(u,e,a),s(e,t),s(t,n),s(n,c)},p(u,a){a[0]&1&&o!==(o=u[43].content+"")&&we(c,o),a[0]&1&&r!==(r=Dt(`msg ${u[43].role}`)+" svelte-rbq0zi")&&i(e,"class",r)},d(u){u&&S(e)}}}function cs(l){let e;return{c(){e=f("div"),e.innerHTML=`<div class="bubble loading svelte-rbq0zi"><span class="icon is-small"><i class="fas fa-spinner fa-spin"></i></span> 
            <span>Thinking...</span></div>`,i(e,"class","msg assistant svelte-rbq0zi")},m(t,n){$(t,e,n)},d(t){t&&S(e)}}}function us(l){let e,t,n;return{c(){e=f("p"),t=q("Model: "),n=q(l[4]),i(e,"class","is-size-7 has-text-grey")},m(o,c){$(o,e,c),s(e,t),s(e,n)},p(o,c){c[0]&16&&we(n,o[4])},d(o){o&&S(e)}}}function fs(l){let e,t;return{c(){e=f("p"),t=q(l[3]),i(e,"class","has-text-danger is-size-7")},m(n,o){$(n,e,o),s(e,t)},p(n,o){o[0]&8&&we(t,n[3])},d(n){n&&S(e)}}}function $a(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-refresh"></i>',i(e,"class","icon is-small")},m(t,n){$(t,e,n)},d(t){t&&S(e)}}}function Ra(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-spinner fa-spin"></i>',i(e,"class","icon is-small")},m(t,n){$(t,e,n)},d(t){t&&S(e)}}}function ds(l){let e,t,n,o,c,r,u,a,d,m,p,_,g,y,b,k,w,C,v,T,z,O,N,E,G,te,J,A,R,se,U,Y,le,Q,ie,D,M,V;function K(F,P){return F[12]?La:Ea}let x=K(l),I=x(l);return{c(){e=f("div"),t=f("div"),n=f("label"),n.textContent="Context Type",o=h(),c=f("div"),r=f("div"),u=f("select"),a=f("option"),a.textContent="Document",d=f("option"),d.textContent="Search Result",m=f("option"),m.textContent="User Input",p=f("option"),p.textContent="Note",_=h(),g=f("div"),y=f("label"),y.textContent="Title",b=h(),k=f("div"),w=f("input"),C=h(),v=f("div"),T=f("label"),T.textContent="Content",z=h(),O=f("div"),N=f("textarea"),E=h(),G=f("div"),te=f("div"),J=f("button"),I.c(),A=h(),R=f("span"),R.textContent="Save Context",U=h(),Y=f("div"),le=f("button"),Q=f("span"),Q.innerHTML='<i class="fas fa-times"></i>',ie=h(),D=f("span"),D.textContent="Cancel",i(n,"class","label is-small"),a.__value="document",a.value=a.__value,d.__value="search_result",d.value=d.__value,m.__value="user_input",m.value=m.__value,p.__value="note",p.value=p.__value,i(u,"data-testid","context-type-select"),l[11]===void 0&&it(()=>l[26].call(u)),i(r,"class","select is-small is-fullwidth"),i(c,"class","control"),i(t,"class","field"),i(y,"class","label is-small"),i(w,"class","input is-small"),i(w,"type","text"),i(w,"placeholder","Enter context title"),i(w,"data-testid","context-title-input"),i(k,"class","control"),i(g,"class","field"),i(T,"class","label is-small"),i(N,"class","textarea is-small"),i(N,"rows","4"),i(N,"placeholder","Enter context content"),i(N,"data-testid","context-content-textarea"),i(O,"class","control"),i(v,"class","field"),i(J,"class","button is-primary is-small"),J.disabled=se=l[12]||!l[9].trim()||!l[10].trim(),i(J,"data-testid","add-context-submit-button"),i(te,"class","control"),i(Q,"class","icon is-small"),i(le,"class","button is-light is-small"),le.disabled=l[12],i(Y,"class","control"),i(G,"class","field is-grouped"),i(e,"class","box has-background-light mb-4"),i(e,"data-testid","add-context-form")},m(F,P){$(F,e,P),s(e,t),s(t,n),s(t,o),s(t,c),s(c,r),s(r,u),s(u,a),s(u,d),s(u,m),s(u,p),Ke(u,l[11],!0),s(e,_),s(e,g),s(g,y),s(g,b),s(g,k),s(k,w),Oe(w,l[9]),s(e,C),s(e,v),s(v,T),s(v,z),s(v,O),s(O,N),Oe(N,l[10]),s(e,E),s(e,G),s(G,te),s(te,J),I.m(J,null),s(J,A),s(J,R),s(G,U),s(G,Y),s(Y,le),s(le,Q),s(le,ie),s(le,D),M||(V=[ne(u,"change",l[26]),ne(w,"input",l[27]),ne(N,"input",l[28]),ne(J,"click",l[18]),ne(le,"click",l[17])],M=!0)},p(F,P){P[0]&2048&&Ke(u,F[11]),P[0]&512&&w.value!==F[9]&&Oe(w,F[9]),P[0]&1024&&Oe(N,F[10]),x!==(x=K(F))&&(I.d(1),I=x(F),I&&(I.c(),I.m(J,A))),P[0]&5632&&se!==(se=F[12]||!F[9].trim()||!F[10].trim())&&(J.disabled=se),P[0]&4096&&(le.disabled=F[12])},d(F){F&&S(e),I.d(),M=!1,Qe(V)}}}function Ea(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-save"></i>',i(e,"class","icon is-small")},m(t,n){$(t,e,n)},d(t){t&&S(e)}}}function La(l){let e;return{c(){e=f("span"),e.innerHTML='<i class="fas fa-spinner fa-spin"></i>',i(e,"class","icon is-small")},m(t,n){$(t,e,n)},d(t){t&&S(e)}}}function Aa(l){let e,t=l[6],n=[];for(let o=0;o<t.length;o+=1)n[o]=_s(ss(l,t,o));return{c(){e=f("div");for(let o=0;o<n.length;o+=1)n[o].c();i(e,"class","context-items svelte-rbq0zi"),i(e,"data-testid","conversation-context")},m(o,c){$(o,e,c);for(let r=0;r<n.length;r+=1)n[r]&&n[r].m(e,null)},p(o,c){if(c[0]&1572928){t=o[6];let r;for(r=0;r<t.length;r+=1){const u=ss(o,t,r);n[r]?n[r].p(u,c):(n[r]=_s(u),n[r].c(),n[r].m(e,null))}for(;r<n.length;r+=1)n[r].d(1);n.length=t.length}},d(o){o&&S(e),xe(n,o)}}}function Pa(l){let e;return{c(){e=f("div"),e.innerHTML=`<span class="icon is-large"><i class="fas fa-inbox fa-2x"></i></span> 
              <p class="is-size-6">No context items yet</p> 
              <p class="is-size-7">Add documents from search results to provide context for your chat.</p>`,i(e,"class","has-text-centered has-text-grey-light"),i(e,"data-testid","empty-context-message")},m(t,n){$(t,e,n)},p:Pe,d(t){t&&S(e)}}}function ps(l){let e,t=l[40].relevance_score.toFixed(1)+"",n;return{c(){e=f("span"),n=q(t),i(e,"class","tag is-light is-small")},m(o,c){$(o,e,c),s(e,n)},p(o,c){c[0]&64&&t!==(t=o[40].relevance_score.toFixed(1)+"")&&we(n,t)},d(o){o&&S(e)}}}function Oa(l){let e,t=l[40].content.substring(0,150)+"",n,o=l[40].content.length>150?"...":"",c;return{c(){e=f("p"),n=q(t),c=q(o),i(e,"class","context-preview svelte-rbq0zi"),i(e,"data-testid",`context-content-${l[42]}`)},m(r,u){$(r,e,u),s(e,n),s(e,c)},p(r,u){u[0]&64&&t!==(t=r[40].content.substring(0,150)+"")&&we(n,t),u[0]&64&&o!==(o=r[40].content.length>150?"...":"")&&we(c,o)},d(r){r&&S(e)}}}function Na(l){let e,t=l[40].summary+"",n;return{c(){e=f("p"),n=q(t),i(e,"class","context-summary svelte-rbq0zi"),i(e,"data-testid",`context-summary-${l[42]}`)},m(o,c){$(o,e,c),s(e,n)},p(o,c){c[0]&64&&t!==(t=o[40].summary+"")&&we(n,t)},d(o){o&&S(e)}}}function ms(l){let e;return{c(){e=f("hr"),i(e,"class","context-divider svelte-rbq0zi")},m(t,n){$(t,e,n)},d(t){t&&S(e)}}}function _s(l){let e,t,n,o,c,r=l[40].context_type.replace(/([A-Z])/g," $1").trim()+"",u,a,d,m,p,_,g,y,b,k,w,C,v,T,z,O=l[40].title+"",N,E,G,te,J,A,R=new Date(l[40].created_at).toLocaleString()+"",se,U,Y,le,Q,ie,D,M=l[40].relevance_score&&ps(l);function V(){return l[29](l[40])}function K(){return l[30](l[40])}function x(L,W){return L[40].summary?Na:Oa}let I=x(l),F=I(l),P=l[42]<l[6].length-1&&ms();return{c(){e=f("div"),t=f("div"),n=f("div"),o=f("div"),c=f("span"),u=q(r),d=h(),m=f("div"),p=f("div"),M&&M.c(),_=h(),g=f("div"),y=f("div"),b=f("div"),k=f("button"),k.innerHTML='<span class="icon is-small"><i class="fas fa-edit"></i></span>',w=h(),C=f("div"),v=f("button"),v.innerHTML='<span class="icon is-small"><i class="fas fa-trash"></i></span>',T=h(),z=f("h6"),N=q(O),E=h(),G=f("div"),F.c(),te=h(),J=f("div"),A=q("Added: "),se=q(R),le=h(),P&&P.c(),Q=rt(),i(c,"class",a="tag is-small "+(l[40].context_type==="Document"?"is-info":l[40].context_type==="SearchResult"?"is-primary":l[40].context_type==="UserInput"?"is-warning":"is-light")),i(c,"data-testid",`context-type-${l[42]}`),i(o,"class","level-item"),i(n,"class","level-left"),i(p,"class","level-item"),i(k,"class","button is-small is-light"),i(k,"data-testid",`edit-context-${l[42]}`),i(k,"title","Edit context"),i(b,"class","control"),i(v,"class","button is-small is-light is-danger"),i(v,"data-testid",`delete-context-${l[42]}`),i(v,"title","Delete context"),i(C,"class","control"),i(y,"class","field is-grouped"),i(g,"class","level-item context-actions svelte-rbq0zi"),i(m,"class","level-right"),i(t,"class","level is-mobile"),i(z,"class","title is-6 has-text-dark"),i(z,"data-testid",`context-title-${l[42]}`),i(G,"class","content is-small"),i(J,"class","is-size-7 has-text-grey"),i(e,"class","context-item svelte-rbq0zi"),i(e,"data-context-id",U=l[40].id),i(e,"data-testid",`context-item-${l[42]}`),i(e,"data-context-type",Y=l[40].context_type)},m(L,W){$(L,e,W),s(e,t),s(t,n),s(n,o),s(o,c),s(c,u),s(t,d),s(t,m),s(m,p),M&&M.m(p,null),s(m,_),s(m,g),s(g,y),s(y,b),s(b,k),s(y,w),s(y,C),s(C,v),s(e,T),s(e,z),s(z,N),s(e,E),s(e,G),F.m(G,null),s(e,te),s(e,J),s(J,A),s(J,se),$(L,le,W),P&&P.m(L,W),$(L,Q,W),ie||(D=[ne(k,"click",V),ne(v,"click",K)],ie=!0)},p(L,W){l=L,W[0]&64&&r!==(r=l[40].context_type.replace(/([A-Z])/g," $1").trim()+"")&&we(u,r),W[0]&64&&a!==(a="tag is-small "+(l[40].context_type==="Document"?"is-info":l[40].context_type==="SearchResult"?"is-primary":l[40].context_type==="UserInput"?"is-warning":"is-light"))&&i(c,"class",a),l[40].relevance_score?M?M.p(l,W):(M=ps(l),M.c(),M.m(p,null)):M&&(M.d(1),M=null),W[0]&64&&O!==(O=l[40].title+"")&&we(N,O),I===(I=x(l))&&F?F.p(l,W):(F.d(1),F=I(l),F&&(F.c(),F.m(G,null))),W[0]&64&&R!==(R=new Date(l[40].created_at).toLocaleString()+"")&&we(se,R),W[0]&64&&U!==(U=l[40].id)&&i(e,"data-context-id",U),W[0]&64&&Y!==(Y=l[40].context_type)&&i(e,"data-context-type",Y),l[42]<l[6].length-1?P||(P=ms(),P.c(),P.m(Q.parentNode,Q)):P&&(P.d(1),P=null)},d(L){L&&S(e),M&&M.d(),F.d(),L&&S(le),P&&P.d(L),L&&S(Q),ie=!1,Qe(D)}}}function Da(l){let e,t,n,o,c,r,u,a,d,m,p,_,g,y,b,k,w,C,v,T,z,O,N,E,G,te,J,A,R,se,U,Y,le,Q,ie,D,M,V,K,x,I,F,P,L,W,oe=l[6].length+"",Z,ee,me,_e,fe,de,pe,he,$e,We;e=new cl({props:{fallbackPath:"/"}});let je=l[5]&&is(l),Le=l[0],Re=[];for(let ue=0;ue<Le.length;ue+=1)Re[ue]=as(rs(l,Le,ue));let ae=l[2]&&cs(),ye=l[4]&&us(l),Ne=l[3]&&fs(l);function Be(ue,Ae){return ue[7]?Ra:$a}let qe=Be(l),Te=qe(l),De=l[8]&&ds(l);function et(ue,Ae){return ue[6].length===0?Pa:Aa}let Je=et(l),Me=Je(l);function He(ue){l[31](ue)}let tt={context:l[14],mode:l[15]};return l[13]!==void 0&&(tt.active=l[13]),de=new Sa({props:tt}),st.push(()=>at(de,"active",He)),de.$on("update",l[32]),de.$on("delete",l[33]),de.$on("close",l[34]),{c(){ve(e.$$.fragment),t=h(),n=f("section"),o=f("div"),c=f("div"),r=f("div"),u=f("h2"),u.textContent="Chat",a=h(),d=f("p"),d.textContent=`Role: ${$t(Et)}`,m=h(),je&&je.c(),p=h(),_=f("div");for(let ue=0;ue<Re.length;ue+=1)Re[ue].c();g=h(),ae&&ae.c(),y=h(),ye&&ye.c(),b=h(),Ne&&Ne.c(),k=h(),w=f("div"),C=f("div"),v=f("textarea"),T=h(),z=f("div"),O=f("button"),N=f("span"),N.innerHTML='<i class="fas fa-paper-plane"></i>',G=h(),te=f("div"),J=f("div"),A=f("div"),R=f("div"),se=f("div"),U=f("h4"),U.textContent="Context",Y=h(),le=f("button"),le.innerHTML=`<span class="icon is-small"><i class="fas fa-plus"></i></span> 
                  <span>Add Context</span>`,Q=h(),ie=f("div"),D=f("div"),M=f("button"),Te.c(),V=h(),De&&De.c(),K=h(),Me.c(),x=h(),I=f("div"),F=f("div"),P=f("div"),L=f("div"),W=f("span"),Z=q(oe),ee=q(" context items"),me=h(),_e=f("div"),_e.innerHTML='<div class="level-item"><span class="is-size-7 has-text-grey">Context is automatically included in your chat</span></div>',fe=h(),ve(de.$$.fragment),i(u,"class","title is-4"),i(d,"class","subtitle is-6"),i(_,"class","chat-window svelte-rbq0zi"),i(_,"data-testid","chat-messages"),i(v,"class","textarea"),i(v,"rows","3"),i(v,"placeholder","Type your message and press Enter..."),i(v,"data-testid","chat-input"),i(C,"class","control is-expanded"),i(N,"class","icon"),i(O,"class","button is-primary"),O.disabled=E=l[2]||!l[1].trim(),i(O,"data-testid","send-message-button"),i(z,"class","control"),i(w,"class","field has-addons chat-input svelte-rbq0zi"),i(r,"class","column is-8"),i(U,"class","title is-5"),i(le,"class","button is-small is-primary"),i(le,"data-testid","show-add-context-button"),i(se,"class","level-item"),i(R,"class","level-left"),i(M,"class","button is-small is-light"),M.disabled=l[7],i(M,"data-testid","refresh-context-button"),i(D,"class","level-item"),i(ie,"class","level-right"),i(A,"class","level is-mobile"),i(W,"class","tag is-light is-small"),i(W,"data-testid","context-summary"),i(L,"class","level-item"),i(P,"class","level-left"),i(_e,"class","level-right"),i(F,"class","level is-mobile"),i(I,"class","mt-4"),i(J,"class","box context-panel svelte-rbq0zi"),i(J,"data-testid","context-panel"),i(te,"class","column is-4"),i(c,"class","columns svelte-rbq0zi"),i(o,"class","container"),i(n,"class","section"),i(n,"data-testid","chat-interface")},m(ue,Ae){be(e,ue,Ae),$(ue,t,Ae),$(ue,n,Ae),s(n,o),s(o,c),s(c,r),s(r,u),s(r,a),s(r,d),s(r,m),je&&je.m(r,null),s(r,p),s(r,_);for(let j=0;j<Re.length;j+=1)Re[j]&&Re[j].m(_,null);s(_,g),ae&&ae.m(_,null),s(r,y),ye&&ye.m(r,null),s(r,b),Ne&&Ne.m(r,null),s(r,k),s(r,w),s(w,C),s(C,v),Oe(v,l[1]),s(w,T),s(w,z),s(z,O),s(O,N),s(c,G),s(c,te),s(te,J),s(J,A),s(A,R),s(R,se),s(se,U),s(se,Y),s(se,le),s(A,Q),s(A,ie),s(ie,D),s(D,M),Te.m(M,null),s(J,V),De&&De.m(J,null),s(J,K),Me.m(J,null),s(J,x),s(J,I),s(I,F),s(F,P),s(P,L),s(L,W),s(W,Z),s(W,ee),s(F,me),s(F,_e),$(ue,fe,Ae),be(de,ue,Ae),he=!0,$e||(We=[ne(v,"input",l[25]),ne(v,"keydown",l[24]),ne(O,"click",l[23]),ne(le,"click",l[17]),ne(M,"click",l[16])],$e=!0)},p(ue,Ae){if(ue[5]?je?je.p(ue,Ae):(je=is(ue),je.c(),je.m(r,p)):je&&(je.d(1),je=null),Ae[0]&1){Le=ue[0];let B;for(B=0;B<Le.length;B+=1){const H=rs(ue,Le,B);Re[B]?Re[B].p(H,Ae):(Re[B]=as(H),Re[B].c(),Re[B].m(_,g))}for(;B<Re.length;B+=1)Re[B].d(1);Re.length=Le.length}ue[2]?ae||(ae=cs(),ae.c(),ae.m(_,null)):ae&&(ae.d(1),ae=null),ue[4]?ye?ye.p(ue,Ae):(ye=us(ue),ye.c(),ye.m(r,b)):ye&&(ye.d(1),ye=null),ue[3]?Ne?Ne.p(ue,Ae):(Ne=fs(ue),Ne.c(),Ne.m(r,k)):Ne&&(Ne.d(1),Ne=null),Ae[0]&2&&Oe(v,ue[1]),(!he||Ae[0]&6&&E!==(E=ue[2]||!ue[1].trim()))&&(O.disabled=E),qe!==(qe=Be(ue))&&(Te.d(1),Te=qe(ue),Te&&(Te.c(),Te.m(M,null))),(!he||Ae[0]&128)&&(M.disabled=ue[7]),ue[8]?De?De.p(ue,Ae):(De=ds(ue),De.c(),De.m(J,K)):De&&(De.d(1),De=null),Je===(Je=et(ue))&&Me?Me.p(ue,Ae):(Me.d(1),Me=Je(ue),Me&&(Me.c(),Me.m(J,x))),(!he||Ae[0]&64)&&oe!==(oe=ue[6].length+"")&&we(Z,oe);const j={};Ae[0]&16384&&(j.context=ue[14]),Ae[0]&32768&&(j.mode=ue[15]),!pe&&Ae[0]&8192&&(pe=!0,j.active=ue[13],ct(()=>pe=!1)),de.$set(j)},i(ue){he||(X(e.$$.fragment,ue),X(de.$$.fragment,ue),he=!0)},o(ue){re(e.$$.fragment,ue),re(de.$$.fragment,ue),he=!1},d(ue){ke(e,ue),ue&&S(t),ue&&S(n),je&&je.d(),xe(Re,ue),ae&&ae.d(),ye&&ye.d(),Ne&&Ne.d(),Te.d(),De&&De.d(),Me.d(),ue&&S(fe),ke(de,ue),$e=!1,Qe(We)}}}function Ma(l,e,t){let n;Ue(l,ot,P=>t(36,n=P));let o=[],c="",r=!1,u=null,a=null,d=null,m=[],p=!1,_=!1,g="",y="",b="document",k=!1,w=!1,C=null,v="edit",T=null;function z(P){t(0,o=[...o,{role:"user",content:P}])}async function O(){try{if(n){const P=await ze("list_conversations");P!=null&&P.conversations&&P.conversations.length>0?(t(5,d=P.conversations[0].id),console.log("üéØ Using existing conversation:",d),await E()):await N()}else{const P=await fetch(`${Ye.ServerURL}/conversations`);if(P.ok){const L=await P.json();L.conversations&&L.conversations.length>0?(t(5,d=L.conversations[0].id),console.log("üéØ Using existing conversation:",d),await E()):await N()}else await N()}}catch(P){console.error("‚ùå Error initializing conversation:",P)}}async function N(){try{const P=$t(Et);if(n){const L=await ze("create_conversation",{title:"Chat Conversation",role:P});L.status==="success"&&L.conversation_id&&(t(5,d=L.conversation_id),console.log("üÜï Created new conversation:",d))}else{const L=await fetch(`${Ye.ServerURL}/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"Chat Conversation",role:P})});if(L.ok){const W=await L.json();W.status==="Success"&&W.conversation_id&&(t(5,d=W.conversation_id),console.log("üÜï Created new conversation:",d))}}}catch(P){console.error("‚ùå Error creating conversation:",P)}}async function E(){if(!d){console.warn("‚ö†Ô∏è Cannot load context: no conversation ID available");return}t(7,p=!0),console.log("üîÑ Loading conversation context for:",d);try{if(n){console.log("üì± Loading context via Tauri...");const P=await ze("get_conversation",{conversationId:d});if(console.log("üì• Tauri response:",P),P.status==="success"&&P.conversation){const L=P.conversation.global_context||[];t(6,m=L),console.log(`‚úÖ Loaded ${L.length} context items via Tauri`)}else console.error("‚ùå Failed to get conversation via Tauri:",P.error||"Unknown error"),t(6,m=[])}else{console.log("üåê Loading context via HTTP...");const P=await fetch(`${Ye.ServerURL}/conversations/${d}`);if(console.log("üì• HTTP response status:",P.status,P.statusText),P.ok){const L=await P.json();if(console.log("üìÑ HTTP response data:",L),L.status==="success"&&L.conversation){const W=L.conversation.global_context||[];t(6,m=W),console.log(`‚úÖ Loaded ${W.length} context items via HTTP`)}else console.error("‚ùå Failed to get conversation via HTTP:",L.error||"Unknown error"),t(6,m=[])}else console.error("‚ùå HTTP request failed:",P.status,P.statusText),t(6,m=[])}}catch(P){console.error("‚ùå Error loading conversation context:",{error:P.message||P,conversationId:d,isTauri:n,timestamp:new Date().toISOString()}),t(6,m=[])}finally{t(7,p=!1),console.log("üèÅ Context loading completed. Items count:",m.length)}}function G(){t(8,_=!_),_||(t(9,g=""),t(10,y=""),t(11,b="document"))}async function te(){if(!(!d||!g.trim()||!y.trim())){t(12,k=!0);try{const P={title:g.trim(),summary:null,content:y.trim(),context_type:b};if(n){const L=await ze("add_context_to_conversation",{conversationId:d,contextData:P});L.status==="success"?(await E(),G(),console.log("‚úÖ Context added successfully via Tauri")):console.error("‚ùå Failed to add context via Tauri:",L.error)}else{const L=await fetch(`${Ye.ServerURL}/conversations/${d}/context`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(P)});if(L.ok){const W=await L.json();W.status==="success"?(await E(),G(),console.log("‚úÖ Context added successfully via HTTP")):console.error("‚ùå Failed to add context via HTTP:",W.error)}else console.error("‚ùå HTTP request failed:",L.status,L.statusText)}}catch(P){console.error("‚ùå Error adding manual context:",P)}finally{t(12,k=!1)}}}function J(P){t(14,C=P),t(15,v="edit"),t(13,w=!0)}function A(P){confirm(`Are you sure you want to delete "${P.title}"?`)&&R(P.id)}async function R(P){if(!(!d||T)){T=P,console.log("üóëÔ∏è Deleting context:",P);try{if(n){const L=await ze("delete_context",{conversationId:d,contextId:P});(L==null?void 0:L.status)==="success"?(console.log("‚úÖ Context deleted successfully via Tauri"),await E()):console.error("‚ùå Failed to delete context via Tauri:",L==null?void 0:L.error)}else{const L=await fetch(`${Ye.ServerURL}/conversations/${d}/context/${P}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(L.ok){const W=await L.json();W.status==="Success"?(console.log("‚úÖ Context deleted successfully via HTTP"),await E()):console.error("‚ùå Failed to delete context via HTTP:",W.error)}else console.error("‚ùå HTTP delete request failed:",L.status)}}catch(L){console.error("‚ùå Error deleting context:",L)}finally{T=null}}}async function se(P){if(d){console.log("üìù Updating context:",P.id);try{const L={context_type:P.context_type,title:P.title,summary:P.summary,content:P.content,metadata:P.metadata};if(n){const W=await ze("update_context",{conversationId:d,contextId:P.id,request:L});(W==null?void 0:W.status)==="success"?(console.log("‚úÖ Context updated successfully via Tauri"),await E()):console.error("‚ùå Failed to update context via Tauri:",W==null?void 0:W.error)}else{const W=await fetch(`${Ye.ServerURL}/conversations/${d}/context/${P.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(L)});if(W.ok){const oe=await W.json();oe.status==="Success"?(console.log("‚úÖ Context updated successfully via HTTP"),await E()):console.error("‚ùå Failed to update context via HTTP:",oe.error)}else console.error("‚ùå HTTP update request failed:",W.status)}}catch(L){console.error("‚ùå Error updating context:",L)}}}async function U(){var W;if(!c.trim()||r)return;t(3,u=null);const P=$t(Et),L=c.trim();t(1,c=""),d||await O(),z(L),t(2,r=!0);try{const oe={role:P,messages:o};d&&(oe.conversation_id=d);const Z=await fetch(`${Ye.ServerURL}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(oe)});if(!Z.ok)throw new Error(`HTTP ${Z.status}`);const ee=await Z.json();t(4,a=ee.model_used??null),((W=ee.status)==null?void 0:W.toLowerCase())==="success"&&ee.message?t(0,o=[...o,{role:"assistant",content:ee.message}]):t(3,u=ee.error||"Chat failed")}catch(oe){t(3,u=(oe==null?void 0:oe.message)||String(oe))}finally{t(2,r=!1)}}function Y(P){(P.key==="Enter"||P.key==="Return")&&!P.shiftKey&&(P.preventDefault(),U())}Qt(()=>{if(t(0,o=[{role:"assistant",content:"Hi! How can I help you? Ask me anything about your search results or documents."}]),O(),typeof window<"u"){const P=()=>{d&&E()};return window.addEventListener("focus",P),()=>{window.removeEventListener("focus",P)}}});function le(){c=this.value,t(1,c)}function Q(){b=St(this),t(11,b)}function ie(){g=this.value,t(9,g)}function D(){y=this.value,t(10,y)}const M=P=>J(P),V=P=>A(P);function K(P){w=P,t(13,w)}return[o,c,r,u,a,d,m,p,_,g,y,b,k,w,C,v,E,G,te,J,A,R,se,U,Y,le,Q,ie,D,M,V,K,P=>se(P.detail),P=>R(P.detail),()=>{t(13,w=!1),t(14,C=null)}]}class Ia extends dt{constructor(e){super(),pt(this,e,Ma,Da,ut,{},null,[-1,-1])}}function Ua(l){let e,t;return e=new Xi({}),{c(){ve(e.$$.fragment)},m(n,o){be(e,n,o),t=!0},i(n){t||(X(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){ke(e,n)}}}function ja(l){let e,t;return e=new Ia({}),{c(){ve(e.$$.fragment)},m(n,o){be(e,n,o),t=!0},i(n){t||(X(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){ke(e,n)}}}function Ha(l){let e,t;return e=new ga({}),{c(){ve(e.$$.fragment)},m(n,o){be(e,n,o),t=!0},i(n){t||(X(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){ke(e,n)}}}function Fa(l){let e,t;return e=new Hr({}),{c(){ve(e.$$.fragment)},m(n,o){be(e,n,o),t=!0},i(n){t||(X(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){ke(e,n)}}}function za(l){let e,t;return e=new ca({}),{c(){ve(e.$$.fragment)},m(n,o){be(e,n,o),t=!0},i(n){t||(X(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){ke(e,n)}}}function Ka(l){let e,t;return e=new da({}),{c(){ve(e.$$.fragment)},m(n,o){be(e,n,o),t=!0},i(n){t||(X(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){ke(e,n)}}}function qa(l){let e;return{c(){e=f("nav"),e.innerHTML=`<div class="navbar-brand"><a class="navbar-item" href="/"><span class="icon" style="color: #333;"><i class="fas fa-home"></i></span></a> 
            <a class="navbar-item" href="/config/wizard">Wizard</a> 
            <a class="navbar-item" href="/config/json">JSON¬†Editor</a> 
            <a class="navbar-item" href="/graph">Graph</a> 
            <a class="navbar-item" href="/chat">Chat</a></div>`,i(e,"class","navbar")},m(t,n){$(t,e,n)},p:Pe,d(t){t&&S(e)}}}function Ga(l){let e,t,n,o,c,r,u,a,d,m,p,_,g,y,b,k,w,C,v,T,z,O,N,E,G,te,J,A,R,se,U,Y,le,Q,ie,D,M,V,K,x,I,F;return v=new Al({}),O=new Ot({props:{path:"/",$$slots:{default:[Ua]},$$scope:{ctx:l}}}),E=new Ot({props:{path:"/chat",$$slots:{default:[ja]},$$scope:{ctx:l}}}),te=new Ot({props:{path:"/graph",$$slots:{default:[Ha]},$$scope:{ctx:l}}}),se=new Ot({props:{path:"/fetch/*",$$slots:{default:[Fa]},$$scope:{ctx:l}}}),Y=new Ot({props:{path:"/config/wizard",$$slots:{default:[za]},$$scope:{ctx:l}}}),Q=new Ot({props:{path:"/config/json",$$slots:{default:[Ka]},$$scope:{ctx:l}}}),V=new Ot({props:{path:"/",$$slots:{default:[qa]},$$scope:{ctx:l}}}),{c(){e=f("meta"),t=h(),n=f("div"),o=f("main"),c=f("div"),r=f("div"),u=f("div"),a=f("ul"),d=f("li"),m=f("a"),m.innerHTML=`<span class="icon is-small"><i class="fas fa-search"></i></span> 
                <span>Search</span>`,p=h(),_=f("li"),g=f("a"),g.innerHTML=`<span class="icon is-small"><i class="fas fa-comments"></i></span> 
                <span>Chat</span>`,y=h(),b=f("li"),k=f("a"),k.innerHTML=`<span class="icon is-small"><i class="fas fa-project-diagram"></i></span> 
                <span>Graph</span>`,w=h(),C=f("div"),ve(v.$$.fragment),T=h(),z=f("div"),ve(O.$$.fragment),N=h(),ve(E.$$.fragment),G=h(),ve(te.$$.fragment),J=h(),A=f("br"),R=h(),ve(se.$$.fragment),U=h(),ve(Y.$$.fragment),le=h(),ve(Q.$$.fragment),ie=h(),D=f("footer"),M=f("div"),ve(V.$$.fragment),i(e,"name","color-scheme"),i(e,"content",l[1]),document.title="Terraphim",i(m,"href","/"),i(m,"data-exact",""),i(m,"data-testid","search-tab"),i(d,"class","svelte-1nmgbjk"),i(g,"href","/chat"),i(g,"data-testid","chat-tab"),i(_,"class","svelte-1nmgbjk"),i(k,"href","/graph"),i(k,"data-testid","graph-tab"),i(b,"class","svelte-1nmgbjk"),i(u,"class","tabs is-boxed svelte-1nmgbjk"),i(r,"class","main-navigation svelte-1nmgbjk"),i(C,"class","role-selector svelte-1nmgbjk"),i(c,"class","top-controls svelte-1nmgbjk"),i(z,"class","main-area svelte-1nmgbjk"),i(o,"class","main-content svelte-1nmgbjk"),i(M,"class",K=Dt(l[0])+" svelte-1nmgbjk"),i(D,"class","svelte-1nmgbjk"),i(n,"class","is-full-height svelte-1nmgbjk")},m(P,L){s(document.head,e),$(P,t,L),$(P,n,L),s(n,o),s(o,c),s(c,r),s(r,u),s(u,a),s(a,d),s(d,m),s(a,p),s(a,_),s(_,g),s(a,y),s(a,b),s(b,k),s(c,w),s(c,C),be(v,C,null),s(o,T),s(o,z),be(O,z,null),s(z,N),be(E,z,null),s(z,G),be(te,z,null),s(o,J),s(o,A),s(o,R),be(se,o,null),s(o,U),be(Y,o,null),s(o,le),be(Q,o,null),s(n,ie),s(n,D),s(D,M),be(V,M,null),x=!0,I||(F=[Ul(jl.call(null,m)),Ul(jl.call(null,g)),Ul(jl.call(null,k)),ne(D,"mouseover",l[2]),ne(D,"focus",l[2])],I=!0)},p(P,[L]){(!x||L&2)&&i(e,"content",P[1]);const W={};L&16&&(W.$$scope={dirty:L,ctx:P}),O.$set(W);const oe={};L&16&&(oe.$$scope={dirty:L,ctx:P}),E.$set(oe);const Z={};L&16&&(Z.$$scope={dirty:L,ctx:P}),te.$set(Z);const ee={};L&16&&(ee.$$scope={dirty:L,ctx:P}),se.$set(ee);const me={};L&16&&(me.$$scope={dirty:L,ctx:P}),Y.$set(me);const _e={};L&16&&(_e.$$scope={dirty:L,ctx:P}),Q.$set(_e);const fe={};L&16&&(fe.$$scope={dirty:L,ctx:P}),V.$set(fe),(!x||L&1&&K!==(K=Dt(P[0])+" svelte-1nmgbjk"))&&i(M,"class",K)},i(P){x||(X(v.$$.fragment,P),X(O.$$.fragment,P),X(E.$$.fragment,P),X(te.$$.fragment,P),X(se.$$.fragment,P),X(Y.$$.fragment,P),X(Q.$$.fragment,P),X(V.$$.fragment,P),x=!0)},o(P){re(v.$$.fragment,P),re(O.$$.fragment,P),re(E.$$.fragment,P),re(te.$$.fragment,P),re(se.$$.fragment,P),re(Y.$$.fragment,P),re(Q.$$.fragment,P),re(V.$$.fragment,P),x=!1},d(P){S(e),P&&S(t),P&&S(n),ke(v),ke(O),ke(E),ke(te),ke(se),ke(Y),ke(Q),ke(V),I=!1,Qe(F)}}}function Wa(l,e,t){let n;Ue(l,_l,r=>t(1,n=r));let o="is-hidden";function c(){t(0,o="")}return[o,n,c]}class Ba extends dt{constructor(e){super(),pt(this,e,Wa,Ga,ut,{})}}const Ja=new lr;nr(Ja);new Ba({target:document.getElementById("app")});
