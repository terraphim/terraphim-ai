# Maintainer: Terraphim Contributors <team@terraphim.ai>
pkgname=terraphim-tui
pkgver=0.2.3
pkgrel=1
pkgdesc="Terraphim TUI - Terminal User Interface for Terraphim AI"
arch=('x86_64')
url="https://terraphim.ai"
license=('Apache-2.0')
depends=('glibc' 'openssl')
makedepends=('rust' 'cargo')
source=("$pkgname-$pkgver.tar.gz::https://github.com/terraphim/terraphim-ai/archive/refs/tags/v$pkgver.tar.gz")
sha256sums=('SKIP')

prepare() {
    cd "$pkgname-$pkgver"
    export RUSTFLAGS="-C link-arg=-fuse-ld=lld"
    # Temporarily disable panic abort for building
    sed -i 's/panic = "abort"/# panic = "abort"/' .cargo/config.toml
}

build() {
    cd "$pkgname-$pkgver"
    export RUSTFLAGS="-C link-arg=-fuse-ld=lld"
    cargo build --release --package terraphim_tui --features repl-full
}

check() {
    cd "$pkgname-$pkgver"
    cargo test --package terraphim_tui --features repl-full
}

package() {
    cd "$pkgname-$pkgver"
    install -Dm755 target/release/terraphim-tui "$pkgdir/usr/bin/terraphim-tui"
    install -Dm644 README.md -t "$pkgdir/usr/share/doc/$pkgname/"
    install -Dm644 LICENSE-Apache-2.0 -t "$pkgdir/usr/share/licenses/$pkgname/"
}